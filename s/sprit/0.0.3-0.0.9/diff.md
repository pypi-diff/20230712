# Comparing `tmp/sprit-0.0.3.tar.gz` & `tmp/sprit-0.0.9.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "sprit-0.0.3.tar", last modified: Tue May 23 17:16:53 2023, max compression
+gzip compressed data, was "sprit-0.0.9.tar", last modified: Tue May 23 18:49:46 2023, max compression
```

## Comparing `sprit-0.0.3.tar` & `sprit-0.0.9.tar`

### file list

```diff
@@ -1,17 +1,17 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 17:16:53.717922 sprit-0.0.3/
--rw-r--r--   0 runner    (1001) docker     (123)     1067 2023-05-23 17:16:33.000000 sprit-0.0.3/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     6888 2023-05-23 17:16:53.713922 sprit-0.0.3/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     4923 2023-05-23 17:16:33.000000 sprit-0.0.3/README.md
--rw-r--r--   0 runner    (1001) docker     (123)      912 2023-05-23 17:16:33.000000 sprit-0.0.3/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)       38 2023-05-23 17:16:53.717922 sprit-0.0.3/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)      361 2023-05-23 17:16:33.000000 sprit-0.0.3/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 17:16:53.713922 sprit-0.0.3/sprit/
--rw-r--r--   0 runner    (1001) docker     (123)     1176 2023-05-23 17:16:33.000000 sprit-0.0.3/sprit/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   172447 2023-05-23 17:16:33.000000 sprit-0.0.3/sprit/sprit.py
--rw-r--r--   0 runner    (1001) docker     (123)   124938 2023-05-23 17:16:33.000000 sprit-0.0.3/sprit/sprit_gui.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 17:16:53.713922 sprit-0.0.3/sprit.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     6888 2023-05-23 17:16:53.000000 sprit-0.0.3/sprit.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)      237 2023-05-23 17:16:53.000000 sprit-0.0.3/sprit.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-23 17:16:53.000000 sprit-0.0.3/sprit.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)       53 2023-05-23 17:16:53.000000 sprit-0.0.3/sprit.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)        6 2023-05-23 17:16:53.000000 sprit-0.0.3/sprit.egg-info/top_level.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 18:49:46.286528 sprit-0.0.9/
+-rw-r--r--   0 runner    (1001) docker     (123)     1067 2023-05-23 18:49:35.000000 sprit-0.0.9/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     6888 2023-05-23 18:49:46.286528 sprit-0.0.9/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     4923 2023-05-23 18:49:35.000000 sprit-0.0.9/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)      912 2023-05-23 18:49:35.000000 sprit-0.0.9/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)       38 2023-05-23 18:49:46.286528 sprit-0.0.9/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)      361 2023-05-23 18:49:35.000000 sprit-0.0.9/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 18:49:46.286528 sprit-0.0.9/sprit/
+-rw-r--r--   0 runner    (1001) docker     (123)     1176 2023-05-23 18:49:35.000000 sprit-0.0.9/sprit/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   172433 2023-05-23 18:49:35.000000 sprit-0.0.9/sprit/sprit.py
+-rw-r--r--   0 runner    (1001) docker     (123)   124938 2023-05-23 18:49:35.000000 sprit-0.0.9/sprit/sprit_gui.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 18:49:46.286528 sprit-0.0.9/sprit.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     6888 2023-05-23 18:49:46.000000 sprit-0.0.9/sprit.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)      237 2023-05-23 18:49:46.000000 sprit-0.0.9/sprit.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-23 18:49:46.000000 sprit-0.0.9/sprit.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       53 2023-05-23 18:49:46.000000 sprit-0.0.9/sprit.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        6 2023-05-23 18:49:46.000000 sprit-0.0.9/sprit.egg-info/top_level.txt
```

### Comparing `sprit-0.0.3/LICENSE` & `sprit-0.0.9/LICENSE`

 * *Files identical despite different names*

### Comparing `sprit-0.0.3/PKG-INFO` & `sprit-0.0.9/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: sprit
-Version: 0.0.3
+Version: 0.0.9
 Summary: A package for processing and analyzing HVSR (Horizontal to Vertical Spectral Ratio) data
 Author: Riley Balikian
 Author-email: balikian@illinois.edu
 License: MIT License
         
         Copyright (c) 2023 RJbalikian
```

### Comparing `sprit-0.0.3/README.md` & `sprit-0.0.9/README.md`

 * *Files identical despite different names*

### Comparing `sprit-0.0.3/pyproject.toml` & `sprit-0.0.9/pyproject.toml`

 * *Files 2% similar despite different names*

```diff
@@ -2,15 +2,15 @@
 requires = ["setuptools>=61.0"]
 build-backend = "setuptools.build_meta"
 
 [project]
 name = "sprit"
 dynamic = ["readme"]
 license = {file = "LICENSE"}
-version="0.0.3"
+version="0.0.9"
 description = "A package for processing and analyzing HVSR (Horizontal to Vertical Spectral Ratio) data"
 keywords = ["HVSR", "seismic", "horizontal to vertical spectral ratio", "obspy", 'geology', 'geophysics', 'geotechnical']
 requires-python = ">=3.0"
 dependencies =  ["obspy", "scipy", "matplotlib", "pandas", "numpy", "pyqt5", "tkcalendar"]
 classifiers = [
     "Programming Language :: Python :: 3",
     "Intended Audience :: Science/Research",
```

### Comparing `sprit-0.0.3/sprit/__init__.py` & `sprit-0.0.9/sprit/__init__.py`

 * *Files identical despite different names*

### Comparing `sprit-0.0.3/sprit/sprit.py` & `sprit-0.0.9/sprit/sprit.py`

 * *Files 0% similar despite different names*

```diff
@@ -933,9846 +933,9846 @@
 00003a40: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
 00003a50: 2020 2070 7269 6e74 2827 5370 6563 6966     print('Specif
 00003a60: 6965 6420 6d65 7461 6461 7461 2066 696c  ied metadata fil
 00003a70: 6520 6361 6e6e 6f74 2062 6520 7265 6164  e cannot be read
 00003a80: 2127 290a 2020 2020 2020 2020 7265 706f  !').        repo
 00003a90: 4469 7220 3d20 7061 7468 6c69 622e 5061  Dir = pathlib.Pa
 00003aa0: 7468 286f 732e 7061 7468 2e64 6972 6e61  th(os.path.dirna
-00003ab0: 6d65 285f 5f66 696c 655f 5f29 2e70 6172  me(__file__).par
-00003ac0: 656e 7429 0a20 2020 2020 2020 206d 6574  ent).        met
-00003ad0: 6150 6174 683d 2072 6570 6f44 6972 2e6a  aPath= repoDir.j
-00003ae0: 6f69 6e70 6174 6828 272f 7265 736f 7572  oinpath('/resour
-00003af0: 6365 732f 7273 3364 7637 5f6d 6574 6164  ces/rs3dv7_metad
-00003b00: 6174 612e 696e 7627 292e 6173 5f70 6f73  ata.inv').as_pos
-00003b10: 6978 2829 0a20 2020 2020 2020 2070 7269  ix().        pri
-00003b20: 6e74 2827 5573 696e 6720 6465 6661 756c  nt('Using defaul
-00003b30: 7420 6d65 7461 6461 7461 2066 696c 6520  t metadata file 
-00003b40: 666f 7220 5261 7370 6265 7272 7920 5368  for Raspberry Sh
-00003b50: 616b 6520 762e 3720 636f 6e74 6169 6e65  ake v.7 containe
-00003b60: 6420 696e 2072 6570 6f73 6974 6f72 7920  d in repository 
-00003b70: 6174 5c6e 272c 206d 6574 6150 6174 6829  at\n', metaPath)
-00003b80: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00003b90: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00003ba0: 286d 6574 6150 6174 682c 2070 6174 686c  (metaPath, pathl
-00003bb0: 6962 2e50 7572 6550 6174 6829 3a0a 2020  ib.PurePath):.  
-00003bc0: 2020 2020 2020 2020 2020 6d65 7461 5061            metaPa
-00003bd0: 7468 203d 206d 6574 6150 6174 682e 6173  th = metaPath.as
-00003be0: 5f70 6f73 6978 2829 0a20 2020 2020 2020  _posix().       
-00003bf0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00003c00: 2020 206d 6574 6150 6174 6820 3d20 7061     metaPath = pa
-00003c10: 7468 6c69 622e 5061 7468 286d 6574 6150  thlib.Path(metaP
-00003c20: 6174 6829 2e61 735f 706f 7369 7828 290a  ath).as_posix().
-00003c30: 0a20 2020 2023 5265 666f 726d 6174 2074  .    #Reformat t
-00003c40: 696d 6573 0a20 2020 2069 6620 7479 7065  imes.    if type
-00003c50: 2861 6371 5f64 6174 6529 2069 7320 6461  (acq_date) is da
-00003c60: 7465 7469 6d65 2e64 6174 6574 696d 653a  tetime.datetime:
-00003c70: 0a20 2020 2020 2020 2064 6174 6520 3d20  .        date = 
-00003c80: 7374 7228 6163 715f 6461 7465 2e64 6174  str(acq_date.dat
-00003c90: 6528 2929 0a20 2020 2065 6c69 6620 7479  e()).    elif ty
-00003ca0: 7065 2861 6371 5f64 6174 6529 2069 7320  pe(acq_date) is 
-00003cb0: 6461 7465 7469 6d65 2e64 6174 653a 0a20  datetime.date:. 
-00003cc0: 2020 2020 2020 2064 6174 653d 7374 7228         date=str(
-00003cd0: 6163 715f 6461 7465 290a 2020 2020 656c  acq_date).    el
-00003ce0: 6966 2074 7970 6528 6163 715f 6461 7465  if type(acq_date
-00003cf0: 2920 6973 2073 7472 3a0a 2020 2020 2020  ) is str:.      
-00003d00: 2020 6461 7465 203d 2061 6371 5f64 6174    date = acq_dat
-00003d10: 650a 2020 2020 656c 6966 2074 7970 6528  e.    elif type(
-00003d20: 6163 715f 6461 7465 2920 6973 2069 6e74  acq_date) is int
-00003d30: 3a0a 2020 2020 2020 2020 7965 6172 3d64  :.        year=d
-00003d40: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-00003d50: 2e74 6f64 6179 2829 2e79 6561 720a 2020  .today().year.  
-00003d60: 2020 2020 2020 6461 7465 203d 2073 7472        date = str
-00003d70: 2828 6461 7465 7469 6d65 2e64 6174 6574  ((datetime.datet
-00003d80: 696d 6528 7965 6172 2c20 312c 2031 2920  ime(year, 1, 1) 
-00003d90: 2b20 6461 7465 7469 6d65 2e74 696d 6564  + datetime.timed
-00003da0: 656c 7461 2861 6371 5f64 6174 6520 2d20  elta(acq_date - 
-00003db0: 3129 292e 6461 7465 2829 290a 2020 2020  1)).date()).    
-00003dc0: 0a20 2020 2069 6620 7479 7065 2873 7461  .    if type(sta
-00003dd0: 7274 7469 6d65 2920 6973 2073 7472 3a0a  rttime) is str:.
-00003de0: 2020 2020 2020 2020 6966 2027 5427 2069          if 'T' i
-00003df0: 6e20 7374 6172 7474 696d 653a 0a20 2020  n starttime:.   
-00003e00: 2020 2020 2020 2020 2064 6174 653d 7374           date=st
-00003e10: 6172 7474 696d 652e 7370 6c69 7428 2754  arttime.split('T
-00003e20: 2729 5b30 5d0a 2020 2020 2020 2020 2020  ')[0].          
-00003e30: 2020 7374 6172 7474 696d 6520 3d20 7374    starttime = st
-00003e40: 6172 7474 696d 652e 7370 6c69 7428 2754  arttime.split('T
-00003e50: 2729 5b31 5d0a 2020 2020 656c 6966 2074  ')[1].    elif t
-00003e60: 7970 6528 7374 6172 7474 696d 6529 2069  ype(starttime) i
-00003e70: 7320 6461 7465 7469 6d65 2e64 6174 6574  s datetime.datet
-00003e80: 696d 653a 0a20 2020 2020 2020 2064 6174  ime:.        dat
-00003e90: 6520 3d20 7374 7228 7374 6172 7474 696d  e = str(starttim
-00003ea0: 652e 6461 7465 2829 290a 2020 2020 2020  e.date()).      
-00003eb0: 2020 7374 6172 7474 696d 6520 3d20 7374    starttime = st
-00003ec0: 7228 7374 6172 7474 696d 652e 7469 6d65  r(starttime.time
-00003ed0: 2829 290a 2020 2020 656c 6966 2074 7970  ()).    elif typ
-00003ee0: 6528 7374 6172 7474 696d 6529 2069 7320  e(starttime) is 
-00003ef0: 6461 7465 7469 6d65 2e74 696d 6528 293a  datetime.time():
-00003f00: 0a20 2020 2020 2020 2073 7461 7274 7469  .        startti
-00003f10: 6d65 203d 2073 7472 2873 7461 7274 7469  me = str(startti
-00003f20: 6d65 290a 2020 2020 0a20 2020 2073 7461  me).    .    sta
-00003f30: 7274 7469 6d65 203d 2064 6174 652b 2254  rttime = date+"T
-00003f40: 222b 7374 6172 7474 696d 650a 2020 2020  "+starttime.    
-00003f50: 7374 6172 7474 696d 6520 3d20 6f62 7370  starttime = obsp
-00003f60: 792e 5554 4344 6174 6554 696d 6528 5f5f  y.UTCDateTime(__
-00003f70: 666f 726d 6174 5469 6d65 2873 7461 7274  formatTime(start
-00003f80: 7469 6d65 2c20 747a 6f6e 653d 747a 6f6e  time, tzone=tzon
-00003f90: 652c 2064 7374 3d64 7374 2929 0a0a 2020  e, dst=dst))..  
-00003fa0: 2020 6966 2074 7970 6528 656e 6474 696d    if type(endtim
-00003fb0: 6529 2069 7320 7374 723a 0a20 2020 2020  e) is str:.     
-00003fc0: 2020 2069 6620 2754 2720 696e 2065 6e64     if 'T' in end
-00003fd0: 7469 6d65 3a0a 2020 2020 2020 2020 2020  time:.          
-00003fe0: 2020 6461 7465 3d65 6e64 7469 6d65 2e73    date=endtime.s
-00003ff0: 706c 6974 2827 5427 295b 305d 0a20 2020  plit('T')[0].   
-00004000: 2020 2020 2020 2020 2065 6e64 7469 6d65           endtime
-00004010: 203d 2065 6e64 7469 6d65 2e73 706c 6974   = endtime.split
-00004020: 2827 5427 295b 315d 0a20 2020 2065 6c69  ('T')[1].    eli
-00004030: 6620 7479 7065 2865 6e64 7469 6d65 2920  f type(endtime) 
-00004040: 6973 2064 6174 6574 696d 652e 6461 7465  is datetime.date
-00004050: 7469 6d65 3a0a 2020 2020 2020 2020 6461  time:.        da
-00004060: 7465 203d 2073 7472 2865 6e64 7469 6d65  te = str(endtime
-00004070: 2e64 6174 6528 2929 0a20 2020 2020 2020  .date()).       
-00004080: 2065 6e64 7469 6d65 203d 2073 7472 2865   endtime = str(e
-00004090: 6e64 7469 6d65 2e74 696d 6528 2929 0a20  ndtime.time()). 
-000040a0: 2020 2065 6c69 6620 7479 7065 2865 6e64     elif type(end
-000040b0: 7469 6d65 2920 6973 2064 6174 6574 696d  time) is datetim
-000040c0: 652e 7469 6d65 2829 3a0a 2020 2020 2020  e.time():.      
-000040d0: 2020 656e 6474 696d 6520 3d20 7374 7228    endtime = str(
-000040e0: 656e 6474 696d 6529 0a0a 2020 2020 656e  endtime)..    en
-000040f0: 6474 696d 6520 3d20 6461 7465 2b22 5422  dtime = date+"T"
-00004100: 2b65 6e64 7469 6d65 0a20 2020 2065 6e64  +endtime.    end
-00004110: 7469 6d65 203d 206f 6273 7079 2e55 5443  time = obspy.UTC
-00004120: 4461 7465 5469 6d65 285f 5f66 6f72 6d61  DateTime(__forma
-00004130: 7454 696d 6528 656e 6474 696d 652c 2074  tTime(endtime, t
-00004140: 7a6f 6e65 3d74 7a6f 6e65 2c20 6473 743d  zone=tzone, dst=
-00004150: 6473 7429 290a 0a20 2020 2061 6371 5f64  dst))..    acq_d
-00004160: 6174 6520 3d20 6461 7465 7469 6d65 2e64  ate = datetime.d
-00004170: 6174 6528 7965 6172 3d69 6e74 2864 6174  ate(year=int(dat
-00004180: 652e 7370 6c69 7428 272d 2729 5b30 5d29  e.split('-')[0])
-00004190: 2c20 6d6f 6e74 683d 696e 7428 6461 7465  , month=int(date
-000041a0: 2e73 706c 6974 2827 2d27 295b 315d 292c  .split('-')[1]),
-000041b0: 2064 6179 3d69 6e74 2864 6174 652e 7370   day=int(date.sp
-000041c0: 6c69 7428 272d 2729 5b32 5d29 290a 2020  lit('-')[2])).  
-000041d0: 2020 7261 7370 5368 616b 6549 6e73 744e    raspShakeInstN
-000041e0: 616d 654c 6973 7420 3d20 5b27 7261 7370  ameList = ['rasp
-000041f0: 6265 7272 7920 7368 616b 6527 2c20 2773  berry shake', 's
-00004200: 6861 6b65 272c 2027 7261 7370 6265 7272  hake', 'raspberr
-00004210: 7927 2c20 2772 7327 2c20 2772 7333 6427  y', 'rs', 'rs3d'
-00004220: 2c20 2772 6173 702e 2073 6861 6b65 272c  , 'rasp. shake',
-00004230: 2027 7261 7370 7368 616b 6527 5d0a 2020   'raspshake'].  
-00004240: 2020 0a20 2020 2023 5261 7370 6265 7272    .    #Raspberr
-00004250: 7920 7368 616b 6520 7374 6174 696f 6e78  y shake stationx
-00004260: 6d6c 2069 7320 696e 2074 6865 2072 6573  ml is in the res
-00004270: 6f75 7263 6573 2066 6f6c 6465 722c 2064  ources folder, d
-00004280: 6f75 626c 6520 6368 6563 6b20 7765 2068  ouble check we h
-00004290: 6176 6520 7269 6768 7420 7061 7468 0a20  ave right path. 
-000042a0: 2020 2069 6620 696e 7374 7275 6d65 6e74     if instrument
-000042b0: 2e6c 6f77 6572 2829 2069 6e20 2072 6173  .lower() in  ras
-000042c0: 7053 6861 6b65 496e 7374 4e61 6d65 4c69  pShakeInstNameLi
-000042d0: 7374 3a0a 2020 2020 2020 2020 6966 206d  st:.        if m
-000042e0: 6574 6150 6174 6820 3d3d 2072 2772 6573  etaPath == r'res
-000042f0: 6f75 7263 6573 2f72 7333 6476 375f 6d65  ources/rs3dv7_me
-00004300: 7461 6461 7461 2e69 6e76 273a 0a20 2020  tadata.inv':.   
-00004310: 2020 2020 2020 2020 206d 6574 6150 6174           metaPat
-00004320: 6820 3d20 7061 7468 6c69 622e 5061 7468  h = pathlib.Path
-00004330: 286f 732e 7061 7468 2e72 6561 6c70 6174  (os.path.realpat
-00004340: 6828 5f5f 6669 6c65 5f5f 2929 2e70 6172  h(__file__)).par
-00004350: 656e 742e 6a6f 696e 7061 7468 2827 2f72  ent.joinpath('/r
-00004360: 6573 6f75 7263 6573 2f72 7333 6476 375f  esources/rs3dv7_
-00004370: 6d65 7461 6461 7461 2e69 6e76 2729 0a0a  metadata.inv')..
-00004380: 2020 2020 2341 6464 206b 6579 2f76 616c      #Add key/val
-00004390: 7565 7320 746f 2069 6e70 7574 2070 6172  ues to input par
-000043a0: 616d 6574 6572 2064 6963 7469 6f6e 6172  ameter dictionar
-000043b0: 790a 2020 2020 696e 7075 7450 6172 616d  y.    inputParam
-000043c0: 4469 6374 203d 207b 276e 6574 273a 6e65  Dict = {'net':ne
-000043d0: 7477 6f72 6b2c 2773 7461 273a 7374 6174  twork,'sta':stat
-000043e0: 696f 6e2c 2027 6c6f 6327 3a6c 6f63 2c20  ion, 'loc':loc, 
-000043f0: 2763 6861 273a 6368 616e 6e65 6c73 2c20  'cha':channels, 
-00004400: 2769 6e73 7472 756d 656e 7427 3a69 6e73  'instrument':ins
-00004410: 7472 756d 656e 742c 0a20 2020 2020 2020  trument,.       
-00004420: 2020 2020 2020 2020 2020 2020 2027 6163               'ac
-00004430: 715f 6461 7465 273a 6163 715f 6461 7465  q_date':acq_date
-00004440: 2c27 7374 6172 7474 696d 6527 3a73 7461  ,'starttime':sta
-00004450: 7274 7469 6d65 2c27 656e 6474 696d 6527  rttime,'endtime'
-00004460: 3a65 6e64 7469 6d65 2c20 2774 696d 657a  :endtime, 'timez
-00004470: 6f6e 6527 3a27 5554 4327 2c0a 2020 2020  one':'UTC',.    
-00004480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004490: 276c 6f6e 6769 7475 6465 273a 6c6f 6e2c  'longitude':lon,
-000044a0: 276c 6174 6974 7564 6527 3a6c 6174 2c27  'latitude':lat,'
-000044b0: 656c 6576 6174 696f 6e27 3a65 6c65 7661  elevation':eleva
-000044c0: 7469 6f6e 2c27 6465 7074 6827 3a64 6570  tion,'depth':dep
-000044d0: 7468 2c20 2773 6974 6527 3a73 6974 652c  th, 'site':site,
-000044e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000044f0: 2020 2020 2027 6461 7461 5061 7468 273a       'dataPath':
-00004500: 6461 7461 5061 7468 2c20 276d 6574 6150  dataPath, 'metaP
-00004510: 6174 6827 3a6d 6574 6150 6174 682c 2027  ath':metaPath, '
-00004520: 6876 7372 5f62 616e 6427 3a68 7673 725f  hvsr_band':hvsr_
-00004530: 6261 6e64 0a20 2020 2020 2020 2020 2020  band.           
-00004540: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
-00004550: 7265 7475 726e 2069 6e70 7574 5061 7261  return inputPara
-00004560: 6d44 6963 740a 0a23 5265 6164 2069 6e20  mDict..#Read in 
-00004570: 6d65 7461 6461 7461 202e 696e 7620 6669  metadata .inv fi
-00004580: 6c65 2c20 7370 6563 6966 6963 616c 6c79  le, specifically
-00004590: 2066 6f72 2052 6173 7053 6861 6b65 0a64   for RaspShake.d
-000045a0: 6566 2075 7064 6174 655f 7368 616b 655f  ef update_shake_
-000045b0: 6d65 7461 6461 7461 2866 696c 6570 6174  metadata(filepat
-000045c0: 682c 2070 6172 616d 732c 2077 7269 7465  h, params, write
-000045d0: 5f70 6174 683d 2727 293a 0a20 2020 2022  _path=''):.    "
-000045e0: 2222 5265 6164 7320 7374 6174 6963 206d  ""Reads static m
-000045f0: 6574 6164 6174 6120 6669 6c65 2070 726f  etadata file pro
-00004600: 7669 6465 6420 666f 7220 5261 7370 2053  vided for Rasp S
-00004610: 6861 6b65 2061 6e64 2075 7064 6174 6573  hake and updates
-00004620: 2077 6974 6820 696e 7075 7420 7061 7261   with input para
-00004630: 6d65 7465 7273 2e20 5573 6564 2070 7269  meters. Used pri
-00004640: 6d61 7269 6c79 2069 6e20 7468 6520 6765  marily in the ge
-00004650: 745f 6d65 7461 6461 7461 2829 2066 756e  t_metadata() fun
-00004660: 6374 696f 6e2e 0a0a 2020 2020 2020 2020  ction...        
-00004670: 5041 5241 4d45 5445 5253 0a20 2020 2020  PARAMETERS.     
-00004680: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00004690: 2020 2020 2020 6669 6c65 7061 7468 203a        filepath :
-000046a0: 2073 7472 206f 7220 7061 7468 6c69 622e   str or pathlib.
-000046b0: 5061 7468 206f 626a 6563 740a 2020 2020  Path object.    
-000046c0: 2020 2020 2020 2020 4669 6c65 7061 7468          Filepath
-000046d0: 2074 6f20 6d65 7461 6461 7461 2066 696c   to metadata fil
-000046e0: 652e 2053 686f 756c 6420 6265 2061 2066  e. Should be a f
-000046f0: 696c 6520 666f 726d 6174 2073 7570 706f  ile format suppo
-00004700: 7274 6564 2062 7920 6f62 7370 792e 7265  rted by obspy.re
-00004710: 6164 5f69 6e76 656e 746f 7279 2829 2e0a  ad_inventory()..
-00004720: 2020 2020 2020 2020 7061 7261 6d73 203a          params :
-00004730: 2064 6963 740a 2020 2020 2020 2020 2020   dict.          
-00004740: 2020 4469 6374 696f 6e61 7279 2063 6f6e    Dictionary con
-00004750: 7461 696e 696e 6720 6e65 6365 7373 6172  taining necessar
-00004760: 7920 6b65 7973 2f76 616c 7565 7320 666f  y keys/values fo
-00004770: 7220 7570 6461 7469 6e67 2c20 6375 7272  r updating, curr
-00004780: 656e 746c 7920 6f6e 6c79 2073 7570 706f  ently only suppo
-00004790: 7274 6564 2066 6f72 2053 5441 5449 4f4e  rted for STATION
-000047a0: 584d 4c20 7769 7468 2052 6173 7062 6572  XML with Raspber
-000047b0: 7279 2053 6861 6b65 732e 0a20 2020 2020  ry Shakes..     
-000047c0: 2020 2020 2020 2020 2020 204e 6563 6573             Neces
-000047d0: 7361 7279 206b 6579 733a 2027 6e65 7427  sary keys: 'net'
-000047e0: 2c20 2773 7461 272c 200a 2020 2020 2020  , 'sta', .      
-000047f0: 2020 2020 2020 2020 2020 4f70 7469 6f6e            Option
-00004800: 616c 206b 6579 733a 2027 6c6f 6e67 6974  al keys: 'longit
-00004810: 7564 6527 2c20 276c 6174 6974 7564 6527  ude', 'latitude'
-00004820: 2c20 2765 6c65 7661 7469 6f6e 272c 2027  , 'elevation', '
-00004830: 6465 7074 6827 0a20 2020 2020 2020 2077  depth'.        w
-00004840: 7269 7465 5f70 6174 6820 2020 3a20 7374  rite_path   : st
-00004850: 722c 2064 6566 6175 6c74 3d27 270a 2020  r, default=''.  
-00004860: 2020 2020 2020 2020 2020 4966 2073 7065            If spe
-00004870: 6369 6669 6564 2c20 6669 6c65 7061 7468  cified, filepath
-00004880: 2074 6f20 7772 6974 6520 746f 2075 7064   to write to upd
-00004890: 6174 6564 2069 6e76 656e 746f 7279 2066  ated inventory f
-000048a0: 696c 6520 746f 2e0a 0a20 2020 2020 2020  ile to...       
-000048b0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-000048c0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-000048d0: 2070 6172 616d 7320 3a20 6469 6374 0a20   params : dict. 
-000048e0: 2020 2020 2020 2020 2020 2055 7064 6174             Updat
-000048f0: 6564 2070 6172 616d 7320 6469 6374 2077  ed params dict w
-00004900: 6974 6820 6e65 7720 6b65 793a 7661 6c75  ith new key:valu
-00004910: 6520 7061 6972 2077 6974 6820 7570 6461  e pair with upda
-00004920: 7465 6420 7570 6461 7465 6420 6f62 7370  ted updated obsp
-00004930: 792e 696e 7665 6e74 6f72 7920 6f62 6a65  y.inventory obje
-00004940: 6374 2028 6b65 793d 2269 6e76 2229 0a20  ct (key="inv"). 
-00004950: 2020 2022 2222 0a0a 2020 2020 6e65 7477     """..    netw
-00004960: 6f72 6b20 3d20 7061 7261 6d73 5b27 6e65  ork = params['ne
-00004970: 7427 5d0a 2020 2020 7374 6174 696f 6e20  t'].    station 
-00004980: 3d20 7061 7261 6d73 5b27 7374 6127 5d0a  = params['sta'].
-00004990: 2020 2020 6f70 744b 6579 7320 3d20 5b27      optKeys = ['
-000049a0: 6c6f 6e67 6974 7564 6527 2c20 276c 6174  longitude', 'lat
-000049b0: 6974 7564 6527 2c20 2765 6c65 7661 7469  itude', 'elevati
-000049c0: 6f6e 272c 2027 6465 7074 6827 5d0a 2020  on', 'depth'].  
-000049d0: 2020 666f 7220 6b20 696e 206f 7074 4b65    for k in optKe
-000049e0: 7973 3a0a 2020 2020 2020 2020 6966 206b  ys:.        if k
-000049f0: 206e 6f74 2069 6e20 7061 7261 6d73 2e6b   not in params.k
-00004a00: 6579 7328 293a 0a20 2020 2020 2020 2020  eys():.         
-00004a10: 2020 2070 6172 616d 735b 6b5d 203d 2027     params[k] = '
-00004a20: 3027 0a20 2020 206c 6f6e 203d 2073 7472  0'.    lon = str
-00004a30: 2870 6172 616d 735b 276c 6f6e 6769 7475  (params['longitu
-00004a40: 6465 275d 290a 2020 2020 6c61 7420 3d20  de']).    lat = 
-00004a50: 7374 7228 7061 7261 6d73 5b27 6c61 7469  str(params['lati
-00004a60: 7475 6465 275d 290a 2020 2020 656c 6576  tude']).    elev
-00004a70: 6174 696f 6e20 3d20 7374 7228 7061 7261  ation = str(para
-00004a80: 6d73 5b27 656c 6576 6174 696f 6e27 5d29  ms['elevation'])
-00004a90: 0a20 2020 2064 6570 7468 203d 2073 7472  .    depth = str
-00004aa0: 2870 6172 616d 735b 2764 6570 7468 275d  (params['depth']
-00004ab0: 290a 2020 2020 0a20 2020 2073 7461 7274  ).    .    start
-00004ac0: 6461 7465 203d 2073 7472 2864 6174 6574  date = str(datet
-00004ad0: 696d 652e 6461 7465 7469 6d65 2879 6561  ime.datetime(yea
-00004ae0: 723d 3230 3233 2c20 6d6f 6e74 683d 322c  r=2023, month=2,
-00004af0: 2064 6179 3d31 3529 2920 2346 6972 7374   day=15)) #First
-00004b00: 2064 6179 2077 6974 6820 776f 726b 696e   day with workin
-00004b10: 6720 636f 6465 0a20 2020 2065 6e64 6461  g code.    endda
-00004b20: 7465 3d73 7472 2864 6174 6574 696d 652e  te=str(datetime.
-00004b30: 6461 7465 7469 6d65 2e74 6f64 6179 2829  datetime.today()
-00004b40: 290a 0a20 2020 2066 696c 6570 6174 6820  )..    filepath 
-00004b50: 3d20 6368 6563 6b69 6670 6174 6828 6669  = checkifpath(fi
-00004b60: 6c65 7061 7468 290a 0a20 2020 2074 7265  lepath)..    tre
-00004b70: 6520 3d20 4554 2e70 6172 7365 2873 7472  e = ET.parse(str
-00004b80: 2866 696c 6570 6174 6829 290a 2020 2020  (filepath)).    
-00004b90: 726f 6f74 203d 2074 7265 652e 6765 7472  root = tree.getr
-00004ba0: 6f6f 7428 290a 0a20 2020 2070 7265 6669  oot()..    prefi
-00004bb0: 783d 2022 7b68 7474 703a 2f2f 7777 772e  x= "{http://www.
-00004bc0: 6664 736e 2e6f 7267 2f78 6d6c 2f73 7461  fdsn.org/xml/sta
-00004bd0: 7469 6f6e 2f31 7d22 0a0a 2020 2020 666f  tion/1}"..    fo
-00004be0: 7220 6974 656d 2069 6e20 726f 6f74 2e69  r item in root.i
-00004bf0: 7465 7228 7072 6566 6978 2b27 4368 616e  ter(prefix+'Chan
-00004c00: 6e65 6c27 293a 0a20 2020 2020 2020 2069  nel'):.        i
-00004c10: 7465 6d2e 6174 7472 6962 5b27 7374 6172  tem.attrib['star
-00004c20: 7444 6174 6527 5d20 3d20 7374 6172 7464  tDate'] = startd
-00004c30: 6174 650a 2020 2020 2020 2020 6974 656d  ate.        item
-00004c40: 2e61 7474 7269 625b 2765 6e64 4461 7465  .attrib['endDate
-00004c50: 275d 203d 2065 6e64 6461 7465 0a0a 2020  '] = enddate..  
-00004c60: 2020 666f 7220 6974 656d 2069 6e20 726f    for item in ro
-00004c70: 6f74 2e69 7465 7228 7072 6566 6978 2b27  ot.iter(prefix+'
-00004c80: 5374 6174 696f 6e27 293a 0a20 2020 2020  Station'):.     
-00004c90: 2020 2069 7465 6d2e 6174 7472 6962 5b27     item.attrib['
-00004ca0: 636f 6465 275d 203d 2073 7461 7469 6f6e  code'] = station
-00004cb0: 0a20 2020 2020 2020 2069 7465 6d2e 6174  .        item.at
-00004cc0: 7472 6962 5b27 7374 6172 7444 6174 6527  trib['startDate'
-00004cd0: 5d20 3d20 7374 6172 7464 6174 650a 2020  ] = startdate.  
-00004ce0: 2020 2020 2020 6974 656d 2e61 7474 7269        item.attri
-00004cf0: 625b 2765 6e64 4461 7465 275d 203d 2065  b['endDate'] = e
-00004d00: 6e64 6461 7465 0a0a 2020 2020 666f 7220  nddate..    for 
-00004d10: 6974 656d 2069 6e20 726f 6f74 2e69 7465  item in root.ite
-00004d20: 7228 7072 6566 6978 2b27 4e65 7477 6f72  r(prefix+'Networ
-00004d30: 6b27 293a 0a20 2020 2020 2020 2069 7465  k'):.        ite
-00004d40: 6d2e 6174 7472 6962 5b27 636f 6465 275d  m.attrib['code']
-00004d50: 203d 206e 6574 776f 726b 0a20 2020 2020   = network.     
-00004d60: 2020 200a 2020 2020 666f 7220 6974 656d     .    for item
-00004d70: 2069 6e20 726f 6f74 2e69 7465 7228 7072   in root.iter(pr
-00004d80: 6566 6978 2b27 4c61 7469 7475 6465 2729  efix+'Latitude')
-00004d90: 3a0a 2020 2020 2020 2020 6974 656d 2e74  :.        item.t
-00004da0: 6578 7420 3d20 6c61 740a 0a20 2020 2066  ext = lat..    f
-00004db0: 6f72 2069 7465 6d20 696e 2072 6f6f 742e  or item in root.
-00004dc0: 6974 6572 2870 7265 6669 782b 274c 6f6e  iter(prefix+'Lon
-00004dd0: 6769 7475 6465 2729 3a0a 2020 2020 2020  gitude'):.      
-00004de0: 2020 6974 656d 2e74 6578 7420 3d20 6c6f    item.text = lo
-00004df0: 6e0a 0a20 2020 2066 6f72 2069 7465 6d20  n..    for item 
-00004e00: 696e 2072 6f6f 742e 6974 6572 2870 7265  in root.iter(pre
-00004e10: 6669 782b 2743 7265 6174 6564 2729 3a0a  fix+'Created'):.
-00004e20: 2020 2020 2020 2020 6e6f 7754 696d 6520          nowTime 
-00004e30: 3d20 7374 7228 6461 7465 7469 6d65 2e64  = str(datetime.d
-00004e40: 6174 6574 696d 652e 6e6f 7728 2929 0a20  atetime.now()). 
-00004e50: 2020 2020 2020 2069 7465 6d2e 7465 7874         item.text
-00004e60: 203d 206e 6f77 5469 6d65 0a0a 2020 2020   = nowTime..    
-00004e70: 666f 7220 6974 656d 2069 6e20 726f 6f74  for item in root
-00004e80: 2e69 7465 7228 7072 6566 6978 2b27 456c  .iter(prefix+'El
-00004e90: 6576 6174 696f 6e27 293a 0a20 2020 2020  evation'):.     
-00004ea0: 2020 2069 7465 6d2e 7465 7874 3d20 656c     item.text= el
-00004eb0: 6576 6174 696f 6e0a 0a20 2020 2066 6f72  evation..    for
-00004ec0: 2069 7465 6d20 696e 2072 6f6f 742e 6974   item in root.it
-00004ed0: 6572 2870 7265 6669 782b 2744 6570 7468  er(prefix+'Depth
-00004ee0: 2729 3a0a 2020 2020 2020 2020 6974 656d  '):.        item
-00004ef0: 2e74 6578 743d 6465 7074 680a 0a20 2020  .text=depth..   
-00004f00: 2023 5365 7420 7570 2028 616e 6429 2065   #Set up (and) e
-00004f10: 7870 6f72 740a 2020 2020 2366 696c 6574  xport.    #filet
-00004f20: 6167 203d 2027 5f27 2b73 7472 2864 6174  ag = '_'+str(dat
-00004f30: 6574 696d 652e 6461 7465 7469 6d65 2e74  etime.datetime.t
-00004f40: 6f64 6179 2829 2e64 6174 6528 2929 0a20  oday().date()). 
-00004f50: 2020 2023 6f75 7466 696c 6520 3d20 7374     #outfile = st
-00004f60: 7228 7061 7265 6e74 5061 7468 292b 275c  r(parentPath)+'\
-00004f70: 5c27 2b66 696c 656e 616d 652b 6669 6c65  \'+filename+file
-00004f80: 7461 672b 272e 696e 7627 0a0a 2020 2020  tag+'.inv'..    
-00004f90: 6966 2077 7269 7465 5f70 6174 6820 213d  if write_path !=
-00004fa0: 2027 273a 0a20 2020 2020 2020 2074 7265   '':.        tre
-00004fb0: 652e 7772 6974 6528 7772 6974 655f 7061  e.write(write_pa
-00004fc0: 7468 2c20 786d 6c5f 6465 636c 6172 6174  th, xml_declarat
-00004fd0: 696f 6e3d 5472 7565 2c20 6d65 7468 6f64  ion=True, method
-00004fe0: 3d27 786d 6c27 2c65 6e63 6f64 696e 673d  ='xml',encoding=
-00004ff0: 2755 5446 2d38 2729 0a20 2020 2020 2020  'UTF-8').       
-00005000: 2069 6e76 203d 206f 6273 7079 2e72 6561   inv = obspy.rea
-00005010: 645f 696e 7665 6e74 6f72 7928 7772 6974  d_inventory(writ
-00005020: 655f 7061 7468 2c20 666f 726d 6174 3d27  e_path, format='
-00005030: 5354 4154 494f 4e58 4d4c 272c 206c 6576  STATIONXML', lev
-00005040: 656c 3d27 7265 7370 6f6e 7365 2729 0a20  el='response'). 
-00005050: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00005060: 2023 4372 6561 7465 2074 656d 706f 7261   #Create tempora
-00005070: 7279 2066 696c 6520 666f 7220 7265 6164  ry file for read
-00005080: 696e 6720 696e 746f 206f 6273 7079 0a20  ing into obspy. 
-00005090: 2020 2020 2020 2074 7066 203d 2074 656d         tpf = tem
-000050a0: 7066 696c 652e 4e61 6d65 6454 656d 706f  pfile.NamedTempo
-000050b0: 7261 7279 4669 6c65 2864 656c 6574 653d  raryFile(delete=
-000050c0: 4661 6c73 6529 0a20 2020 2020 2020 2073  False).        s
-000050d0: 7472 696e 6752 6f6f 7420 3d20 4554 2e74  tringRoot = ET.t
-000050e0: 6f73 7472 696e 6728 726f 6f74 2c20 656e  ostring(root, en
-000050f0: 636f 6469 6e67 3d27 5554 462d 3827 2c20  coding='UTF-8', 
-00005100: 6d65 7468 6f64 3d27 786d 6c27 290a 2020  method='xml').  
-00005110: 2020 2020 2020 7470 662e 7772 6974 6528        tpf.write(
-00005120: 7374 7269 6e67 526f 6f74 290a 0a20 2020  stringRoot)..   
-00005130: 2020 2020 2069 6e76 203d 206f 6273 7079       inv = obspy
-00005140: 2e72 6561 645f 696e 7665 6e74 6f72 7928  .read_inventory(
-00005150: 7470 662e 6e61 6d65 2c20 666f 726d 6174  tpf.name, format
-00005160: 3d27 5354 4154 494f 4e58 4d4c 272c 206c  ='STATIONXML', l
-00005170: 6576 656c 3d27 7265 7370 6f6e 7365 2729  evel='response')
-00005180: 0a20 2020 2020 2020 2074 7066 2e63 6c6f  .        tpf.clo
-00005190: 7365 2829 0a0a 2020 2020 2020 2020 6f73  se()..        os
-000051a0: 2e72 656d 6f76 6528 7470 662e 6e61 6d65  .remove(tpf.name
-000051b0: 290a 2020 2020 7061 7261 6d73 5b27 696e  ).    params['in
-000051c0: 7627 5d20 3d20 696e 760a 2020 2020 7265  v'] = inv.    re
-000051d0: 7475 726e 2070 6172 616d 730a 0a23 436f  turn params..#Co
-000051e0: 6465 2074 6f20 6865 6c70 2073 6574 7570  de to help setup
-000051f0: 2065 6e76 6972 6f6e 6d65 6e74 2069 6e20   environment in 
-00005200: 476f 6f67 6c65 2043 6f6c 6162 0a64 6566  Google Colab.def
-00005210: 2073 6574 7570 5f63 6f6c 6162 286f 7074   setup_colab(opt
-00005220: 696f 6e3d 2727 2c20 7265 706f 5f64 6972  ion='', repo_dir
-00005230: 3d27 2729 3a0a 2020 2020 2222 2246 756e  =''):.    """Fun
-00005240: 6374 696f 6e20 746f 2068 656c 7020 7365  ction to help se
-00005250: 7420 7570 2047 6f6f 676c 6520 436f 6c61  t up Google Cola
-00005260: 6220 656e 7669 726f 6e6d 656e 7420 666f  b environment fo
-00005270: 7220 5350 5249 540a 2020 2020 0a20 2020  r SPRIT.    .   
-00005280: 2054 6869 7320 6973 2064 6573 6967 6e65   This is designe
-00005290: 6420 746f 2062 6520 7275 6e20 7477 6963  d to be run twic
-000052a0: 6520 696e 2061 2047 6f6f 676c 6520 436f  e in a Google Co
-000052b0: 6c61 6220 656e 7669 726f 6e6d 656e 7420  lab environment 
-000052c0: 7769 7468 6f75 7420 616e 7920 7061 7261  without any para
-000052d0: 6d65 7465 7273 2c20 616e 6420 6174 2074  meters, and at t
-000052e0: 6865 2062 6567 696e 6e69 6e67 206f 6620  he beginning of 
-000052f0: 7468 6520 476f 6f67 6c65 2043 6f6c 6162  the Google Colab
-00005300: 206e 6f74 6562 6f6f 6b2e 200a 2020 2020   notebook. .    
-00005310: 5468 6520 6669 7273 7420 7275 6e20 7769  The first run wi
-00005320: 6c6c 2069 6e73 7461 6c6c 206f 6273 7079  ll install obspy
-00005330: 2028 7768 6963 6820 6973 206e 6f74 2069   (which is not i
-00005340: 6e73 7461 6c6c 6564 206f 6e20 436f 6c61  nstalled on Cola
-00005350: 6220 6279 2064 6566 6175 6c74 292c 2074  b by default), t
-00005360: 6865 6e20 7265 7374 6172 7420 7468 6520  hen restart the 
-00005370: 6b65 726e 656c 2028 6e65 6365 7373 6172  kernel (necessar
-00005380: 7920 666f 7220 436f 6c61 6220 746f 2072  y for Colab to r
-00005390: 756e 206f 6273 7079 2065 6666 6563 7469  un obspy effecti
-000053a0: 7665 6c79 292e 0a20 2020 2054 6865 2073  vely)..    The s
-000053b0: 6563 6f6e 6420 7275 6e20 7769 6c6c 2022  econd run will "
-000053c0: 696e 7374 616c 6c22 2074 6865 2072 6570  install" the rep
-000053d0: 6f73 6974 6f72 792e 200a 2020 2020 0a20  ository. .    . 
-000053e0: 2020 2054 6869 7320 7769 6c6c 2062 6520     This will be 
-000053f0: 6368 616e 6765 6420 6472 616d 6174 6963  changed dramatic
-00005400: 616c 6c79 206f 6e63 6520 7468 6520 7265  ally once the re
-00005410: 706f 7369 746f 7279 2069 7320 7265 6164  pository is read
-00005420: 7920 666f 7220 6469 7374 7275 6275 7469  y for distrubuti
-00005430: 6f6e 2076 6961 2070 7970 692e 0a20 2020  on via pypi..   
-00005440: 200a 2020 2020 5061 7261 6d65 7465 7273   .    Parameters
-00005450: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-00005460: 2020 2020 6f70 7469 6f6e 203a 2073 7472      option : str
-00005470: 2c20 6465 6661 756c 743d 2727 0a20 2020  , default=''.   
-00005480: 2020 2020 2057 6869 6368 2069 7465 7261       Which itera
-00005490: 7469 6f6e 2074 6f20 7275 6e20 6f66 2073  tion to run of s
-000054a0: 6574 7570 5f63 6f6c 6162 2e20 4265 2064  etup_colab. Be d
-000054b0: 6566 6175 6c74 2c20 7468 6973 2066 756e  efault, this fun
-000054c0: 6374 696f 6e20 6361 6e20 6465 7465 726d  ction can determ
-000054d0: 696e 6520 7768 6963 6820 2269 7465 7261  ine which "itera
-000054e0: 7469 6f6e 2220 6974 206e 6565 6473 2074  tion" it needs t
-000054f0: 6f20 7275 6e2c 2062 7574 2069 7420 6361  o run, but it ca
-00005500: 6e20 6265 2073 7065 6369 6669 6564 206d  n be specified m
-00005510: 616e 7561 6c6c 792e 0a20 2020 2072 6570  anually..    rep
-00005520: 6f5f 6469 7220 3a20 7374 7220 6f72 2070  o_dir : str or p
-00005530: 6174 686c 6962 2e50 6174 682c 2064 6566  athlib.Path, def
-00005540: 6175 6c74 3d27 270a 2020 2020 2020 2020  ault=''.        
-00005550: 5768 6572 6520 7468 6520 7265 706f 7369  Where the reposi
-00005560: 746f 7279 2068 6173 2062 6565 6e20 2269  tory has been "i
-00005570: 6e73 7461 6c6c 6564 222f 6578 7472 6163  nstalled"/extrac
-00005580: 7465 6420 696e 2074 6865 2043 6f6c 6162  ted in the Colab
-00005590: 2066 6f6c 6465 7220 7374 7275 6374 7572   folder structur
-000055a0: 652e 0a20 2020 2020 2020 200a 2020 2020  e..        .    
-000055b0: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-000055c0: 2d2d 2d0a 2020 2020 4e6f 6e65 0a0a 2020  ---.    None..  
-000055d0: 2020 2222 220a 2020 2020 696d 706f 7274    """.    import
-000055e0: 2064 6174 6574 696d 650a 2020 2020 696d   datetime.    im
-000055f0: 706f 7274 206d 6174 680a 2020 2020 696d  port math.    im
-00005600: 706f 7274 206f 730a 2020 2020 696d 706f  port os.    impo
-00005610: 7274 2070 6174 686c 6962 0a20 2020 2069  rt pathlib.    i
-00005620: 6d70 6f72 7420 7469 6d65 0a20 2020 2069  mport time.    i
-00005630: 6d70 6f72 7420 7379 730a 2020 2020 696d  mport sys.    im
-00005640: 706f 7274 2073 7562 7072 6f63 6573 730a  port subprocess.
-00005650: 0a20 2020 2069 6d70 6f72 7420 6d61 7470  .    import matp
-00005660: 6c6f 746c 6962 2e70 7970 6c6f 7420 6173  lotlib.pyplot as
-00005670: 2070 6c74 0a20 2020 2069 6d70 6f72 7420   plt.    import 
-00005680: 6e75 6d70 7920 6173 206e 700a 2020 2020  numpy as np.    
-00005690: 696d 706f 7274 2073 6369 7079 0a0a 2020  import scipy..  
-000056a0: 2020 6672 6f6d 2067 6f6f 676c 652e 636f    from google.co
-000056b0: 6c61 6220 696d 706f 7274 2066 696c 6573  lab import files
-000056c0: 0a20 2020 2066 726f 6d20 7a69 7066 696c  .    from zipfil
-000056d0: 6520 696d 706f 7274 205a 6970 4669 6c65  e import ZipFile
-000056e0: 0a20 2020 2023 256d 6174 706c 6f74 6c69  .    #%matplotli
-000056f0: 6220 2352 756e 2074 6869 7320 6c69 6e65  b #Run this line
-00005700: 2069 6620 796f 7520 7761 6e74 2069 6e74   if you want int
-00005710: 6572 6163 7469 7665 2070 6c6f 7473 0a20  eractive plots. 
-00005720: 2020 2023 6874 7470 733a 2f2f 6769 7468     #https://gith
-00005730: 7562 2e63 6f6d 2f67 6f6f 676c 6563 6f6c  ub.com/googlecol
-00005740: 6162 2f63 6f6c 6162 746f 6f6c 732f 626c  ab/colabtools/bl
-00005750: 6f62 2f6d 6169 6e2f 676f 6f67 6c65 2f63  ob/main/google/c
-00005760: 6f6c 6162 2f5f 7379 7374 656d 5f63 6f6d  olab/_system_com
-00005770: 6d61 6e64 732e 7079 0a20 2020 2066 726f  mands.py.    fro
-00005780: 6d20 676f 6f67 6c65 2e63 6f6c 6162 2069  m google.colab i
-00005790: 6d70 6f72 7420 5f73 7973 7465 6d5f 636f  mport _system_co
-000057a0: 6d6d 616e 6473 0a20 2020 2070 7976 6572  mmands.    pyver
-000057b0: 7320 3d20 5f73 7973 7465 6d5f 636f 6d6d  s = _system_comm
-000057c0: 616e 6473 2e5f 7275 6e5f 636f 6d6d 616e  ands._run_comman
-000057d0: 6428 2770 7974 686f 6e20 2d2d 7665 7273  d('python --vers
-000057e0: 696f 6e27 2c20 4661 6c73 6529 0a20 2020  ion', False).   
-000057f0: 2070 7976 6572 7320 3d20 7079 7665 7273   pyvers = pyvers
-00005800: 2e6f 7574 7075 742e 7370 6c69 7428 2720  .output.split(' 
-00005810: 2729 232b 7079 7665 7273 2e6f 7574 7075  ')#+pyvers.outpu
-00005820: 742e 7370 6c69 7428 272e 2729 5b31 5d0a  t.split('.')[1].
-00005830: 2020 2020 7079 7665 7273 203d 2070 7976      pyvers = pyv
-00005840: 6572 735b 305d 2e6c 6f77 6572 2829 2b70  ers[0].lower()+p
-00005850: 7976 6572 735b 315d 2e73 706c 6974 2827  yvers[1].split('
-00005860: 2e27 295b 305d 2b27 2e27 2b70 7976 6572  .')[0]+'.'+pyver
-00005870: 735b 315d 2e73 706c 6974 2827 2e27 295b  s[1].split('.')[
-00005880: 315d 0a0a 2020 2020 2353 6574 7570 206d  1]..    #Setup m
-00005890: 6174 706c 6f74 6c69 6220 746f 6f3f 0a20  atplotlib too?. 
-000058a0: 2020 2023 5f73 7973 7465 6d5f 636f 6d6d     #_system_comm
-000058b0: 616e 6473 2e5f 7275 6e5f 636f 6d6d 616e  ands._run_comman
-000058c0: 6428 276d 6174 706c 6f74 6c69 6220 7174  d('matplotlib qt
-000058d0: 272c 2046 616c 7365 290a 0a20 2020 2070  ', False)..    p
-000058e0: 6163 6b50 6174 6820 3d20 272f 7573 722f  ackPath = '/usr/
-000058f0: 6c6f 6361 6c2f 6c69 622f 272b 7079 7665  local/lib/'+pyve
-00005900: 7273 2b27 2f64 6973 742d 7061 636b 6167  rs+'/dist-packag
-00005910: 6573 270a 2020 2020 7061 636b 5061 7468  es'.    packPath
-00005920: 203d 2070 6174 686c 6962 2e50 6174 6828   = pathlib.Path(
-00005930: 7061 636b 5061 7468 290a 2020 2020 0a20  packPath).    . 
-00005940: 2020 2023 4d61 6b65 2064 6972 6563 746f     #Make directo
-00005950: 7269 6573 0a20 2020 2064 6174 6144 6972  ries.    dataDir
-00005960: 203d 2027 2f63 6f6e 7465 6e74 2f44 6174   = '/content/Dat
-00005970: 612f 270a 2020 2020 6f75 7470 7574 4469  a/'.    outputDi
-00005980: 7220 3d20 272f 636f 6e74 656e 742f 4f75  r = '/content/Ou
-00005990: 7470 7574 270a 2020 2020 6966 206e 6f74  tput'.    if not
-000059a0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-000059b0: 6461 7461 4469 7229 3a0a 2020 2020 2020  dataDir):.      
-000059c0: 2020 6f73 2e6d 616b 6564 6972 7328 6461    os.makedirs(da
-000059d0: 7461 4469 7229 0a20 2020 2069 6620 6e6f  taDir).    if no
-000059e0: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-000059f0: 286f 7574 7075 7444 6972 293a 0a20 2020  (outputDir):.   
-00005a00: 2020 2020 206f 732e 6d61 6b65 6469 7273       os.makedirs
-00005a10: 286f 7574 7075 7444 6972 2920 2020 200a  (outputDir)    .
-00005a20: 2020 2020 0a20 2020 206f 6273 7079 496e      .    obspyIn
-00005a30: 7374 616c 6c65 643d 4661 6c73 650a 2020  stalled=False.  
-00005a40: 2020 666f 7220 6620 696e 2070 6163 6b50    for f in packP
-00005a50: 6174 682e 6974 6572 6469 7228 293a 0a20  ath.iterdir():. 
-00005a60: 2020 2020 2020 2069 6620 276f 6273 7079         if 'obspy
-00005a70: 2720 696e 2066 2e6e 616d 653a 0a20 2020  ' in f.name:.   
-00005a80: 2020 2020 2020 2020 206f 6273 7079 496e           obspyIn
-00005a90: 7374 616c 6c65 643d 5472 7565 0a20 2020  stalled=True.   
-00005aa0: 2020 2020 2020 2020 2067 6c6f 6261 6c20           global 
-00005ab0: 6f62 7370 790a 2020 2020 2020 2020 2020  obspy.          
-00005ac0: 2020 696d 706f 7274 206f 6273 7079 0a20    import obspy. 
-00005ad0: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00005ae0: 0a20 2020 2020 2020 200a 2020 2020 6966  .        .    if
-00005af0: 2027 6f62 7370 7927 2069 6e20 6f70 7469   'obspy' in opti
-00005b00: 6f6e 206f 7220 6f70 7469 6f6e 3d3d 2727  on or option==''
-00005b10: 3a0a 2020 2020 2020 2020 6966 206e 6f74  :.        if not
-00005b20: 206f 6273 7079 496e 7374 616c 6c65 643a   obspyInstalled:
-00005b30: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00005b40: 6e74 2827 496e 7374 616c 6c69 6e67 204f  nt('Installing O
-00005b50: 6273 7079 2729 0a20 2020 2020 2020 2020  bspy').         
-00005b60: 2020 205f 7379 7374 656d 5f63 6f6d 6d61     _system_comma
-00005b70: 6e64 732e 5f72 756e 5f63 6f6d 6d61 6e64  nds._run_command
-00005b80: 2827 7069 7020 696e 7374 616c 6c20 6f62  ('pip install ob
-00005b90: 7370 7927 2c20 4661 6c73 6529 0a20 2020  spy', False).   
-00005ba0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-00005bb0: 5275 6e74 696d 6520 7769 6c6c 206e 6f77  Runtime will now
-00005bc0: 2062 6520 7265 7365 7420 746f 2070 726f   be reset to pro
-00005bd0: 7065 726c 7920 6c6f 6164 206f 6273 7079  perly load obspy
-00005be0: 2229 0a20 2020 2020 2020 2020 2020 2070  ").            p
-00005bf0: 7269 6e74 2827 506c 6561 7365 2072 756e  rint('Please run
-00005c00: 2073 6574 7570 5f63 6f6c 6162 2829 2074   setup_colab() t
-00005c10: 6f20 7570 6c6f 6164 2064 6174 6120 616e  o upload data an
-00005c20: 6420 656e 7465 7220 636f 6465 2065 6e76  d enter code env
-00005c30: 6972 6f6e 6d65 6e74 2e27 290a 2020 2020  ironment.').    
-00005c40: 2020 2020 2020 2020 6f73 2e6b 696c 6c28          os.kill(
-00005c50: 6f73 2e67 6574 7069 6428 292c 2039 290a  os.getpid(), 9).
-00005c60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00005c70: 2020 2020 2020 2020 2020 676c 6f62 616c            global
-00005c80: 206f 6273 7079 0a20 2020 2020 2020 2020   obspy.         
-00005c90: 2020 2069 6d70 6f72 7420 6f62 7370 790a     import obspy.
-00005ca0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00005cb0: 7428 274f 6273 7079 2068 6173 2062 6565  t('Obspy has bee
-00005cc0: 6e20 696d 706f 7274 6564 2e27 2920 0a20  n imported.') . 
-00005cd0: 2020 2065 6c69 6620 2764 6174 6127 2069     elif 'data' i
-00005ce0: 6e20 6f70 7469 6f6e 3a0a 2020 2020 2020  n option:.      
-00005cf0: 2020 676c 6f62 616c 206f 6273 7079 0a20    global obspy. 
-00005d00: 2020 2020 2020 2069 6d70 6f72 7420 6f62         import ob
-00005d10: 7370 790a 2020 2020 2020 2020 7072 696e  spy.        prin
-00005d20: 7428 274f 6273 7079 2068 6173 2062 6565  t('Obspy has bee
-00005d30: 6e20 696e 7374 616c 6c65 6420 696d 706f  n installed impo
-00005d40: 7274 6564 2e27 290a 0a20 2020 2020 2020  rted.')..       
-00005d50: 206f 732e 6368 6469 7228 6461 7461 4469   os.chdir(dataDi
-00005d60: 7229 0a20 2020 2020 2020 2070 7269 6e74  r).        print
-00005d70: 2827 5c6e 5570 6c6f 6164 2064 6174 6120  ('\nUpload data 
-00005d80: 6669 6c65 2873 293a 205c 6e28 6669 6c65  file(s): \n(file
-00005d90: 2873 2920 7769 6c6c 2062 6520 706c 6163  (s) will be plac
-00005da0: 6564 2069 6e20 272b 6461 7461 4469 722b  ed in '+dataDir+
-00005db0: 2729 2729 0a20 2020 2020 2020 2066 696c  ')').        fil
-00005dc0: 6573 2e75 706c 6f61 6428 2920 2355 706c  es.upload() #Upl
-00005dd0: 6f61 6420 7468 6520 3320 6461 7461 2066  oad the 3 data f
-00005de0: 696c 6573 2074 6f20 6265 2075 7365 640a  iles to be used.
-00005df0: 2020 2020 2020 2020 6966 2072 6570 6f5f          if repo_
-00005e00: 6469 7220 3d3d 2027 273a 0a20 2020 2020  dir == '':.     
-00005e10: 2020 2020 2020 2072 6570 6f5f 6469 723d         repo_dir=
-00005e20: 272f 636f 6e74 656e 742f 5350 5249 5427  '/content/SPRIT'
-00005e30: 0a20 2020 2020 2020 206f 732e 6368 6469  .        os.chdi
-00005e40: 7228 7265 706f 5f64 6972 290a 2020 2020  r(repo_dir).    
-00005e50: 7265 7475 726e 0a0a 234c 6175 6e63 6820  return..#Launch 
-00005e60: 7468 6520 6775 690a 6465 6620 6775 6928  the gui.def gui(
-00005e70: 293a 0a20 2020 2022 2222 4675 6e63 7469  ):.    """Functi
-00005e80: 6f6e 2074 6f20 6f70 656e 2061 2077 696e  on to open a win
-00005e90: 646f 7720 7769 7468 2061 2067 7261 7068  dow with a graph
-00005ea0: 6963 616c 2075 7365 7220 696e 7465 7266  ical user interf
-00005eb0: 6163 6520 2867 7569 290a 2020 2020 0a20  ace (gui).    . 
-00005ec0: 2020 204e 6f20 7061 7261 6d65 7465 7273     No parameters
-00005ed0: 2c20 6e6f 2072 6574 7572 6e73 3b20 6a75  , no returns; ju
-00005ee0: 7374 206f 7065 6e73 2074 6865 2067 7569  st opens the gui
-00005ef0: 2077 696e 646f 772e 0a20 2020 2022 2222   window..    """
-00005f00: 0a20 2020 2023 6775 6950 6174 6820 3d20  .    #guiPath = 
-00005f10: 7061 7468 6c69 622e 5061 7468 286f 732e  pathlib.Path(os.
-00005f20: 7061 7468 2e72 6561 6c70 6174 6828 5f5f  path.realpath(__
-00005f30: 6669 6c65 5f5f 2929 0a20 2020 2023 7072  file__)).    #pr
-00005f40: 696e 7428 6775 6950 6174 682e 6a6f 696e  int(guiPath.join
-00005f50: 7061 7468 2827 6775 692f 746b 6775 692e  path('gui/tkgui.
-00005f60: 7079 2729 2e61 735f 706f 7369 7828 2929  py').as_posix())
-00005f70: 0a20 2020 2066 726f 6d20 7370 7269 742e  .    from sprit.
-00005f80: 7370 7269 745f 6775 6920 696d 706f 7274  sprit_gui import
-00005f90: 2041 7070 0a20 2020 2069 6d70 6f72 7420   App.    import 
-00005fa0: 746b 696e 7465 7220 6173 2074 6b0a 0a20  tkinter as tk.. 
-00005fb0: 2020 2064 6566 206f 6e5f 6775 695f 636c     def on_gui_cl
-00005fc0: 6f73 696e 6728 293a 0a20 2020 2020 2020  osing():.       
-00005fd0: 2070 6c74 2e63 6c6f 7365 2827 616c 6c27   plt.close('all'
-00005fe0: 290a 2020 2020 2020 2020 6775 695f 726f  ).        gui_ro
-00005ff0: 6f74 2e71 7569 7428 290a 2020 2020 2020  ot.quit().      
-00006000: 2020 6775 695f 726f 6f74 2e64 6573 7472    gui_root.destr
-00006010: 6f79 2829 0a0a 2020 2020 6775 695f 726f  oy()..    gui_ro
-00006020: 6f74 203d 2074 6b2e 546b 2829 0a20 2020  ot = tk.Tk().   
-00006030: 2067 7569 5f72 6f6f 742e 6963 6f6e 6269   gui_root.iconbi
-00006040: 746d 6170 2870 6174 686c 6962 2e50 6174  tmap(pathlib.Pat
-00006050: 6828 6f73 2e70 6174 682e 6469 726e 616d  h(os.path.dirnam
-00006060: 6528 5f5f 6669 6c65 5f5f 292e 7061 7265  e(__file__).pare
-00006070: 6e74 292e 6a6f 696e 7061 7468 2822 2f72  nt).joinpath("/r
-00006080: 6573 6f75 7263 6573 2f73 7072 6974 5f69  esources/sprit_i
-00006090: 636f 6e5f 616c 7068 612e 6963 6f22 2929  con_alpha.ico"))
-000060a0: 0a20 2020 2041 7070 286d 6173 7465 723d  .    App(master=
-000060b0: 6775 695f 726f 6f74 2920 234f 7065 6e20  gui_root) #Open 
-000060c0: 7468 6520 6170 7020 7769 7468 2061 2074  the app with a t
-000060d0: 6b2e 546b 2072 6f6f 740a 0a20 2020 2067  k.Tk root..    g
-000060e0: 7569 5f72 6f6f 742e 7072 6f74 6f63 6f6c  ui_root.protocol
-000060f0: 2822 574d 5f44 454c 4554 455f 5749 4e44  ("WM_DELETE_WIND
-00006100: 4f57 222c 206f 6e5f 6775 695f 636c 6f73  OW", on_gui_clos
-00006110: 696e 6729 2020 2020 0a20 2020 2067 7569  ing)    .    gui
-00006120: 5f72 6f6f 742e 6d61 696e 6c6f 6f70 2829  _root.mainloop()
-00006130: 2023 5275 6e20 7468 6520 6d61 696e 206c   #Run the main l
-00006140: 6f6f 700a 2020 2020 0a23 5375 7070 6f72  oop.    .#Suppor
-00006150: 7420 6675 6e63 7469 6f6e 2066 6f72 2067  t function for g
-00006160: 6574 5f6d 6574 6164 6174 6128 290a 6465  et_metadata().de
-00006170: 6620 5f72 6561 645f 5253 5f4d 6574 6164  f _read_RS_Metad
-00006180: 6174 6128 7061 7261 6d73 293a 0a20 2020  ata(params):.   
-00006190: 2022 2222 4675 6e63 7469 6f6e 2074 6f20   """Function to 
-000061a0: 7265 6164 2074 6865 206d 6574 6164 6174  read the metadat
-000061b0: 6120 6672 6f6d 2052 6173 7062 6572 7279  a from Raspberry
-000061c0: 2053 6861 6b65 2075 7369 6e67 2074 6865   Shake using the
-000061d0: 2053 7461 7469 6f6e 584d 4c20 6669 6c65   StationXML file
-000061e0: 2070 726f 7669 6465 6420 6279 2074 6865   provided by the
-000061f0: 2063 6f6d 7061 6e79 2e0a 2020 2020 496e   company..    In
-00006200: 7465 6e64 6564 2074 6f20 6265 2075 7365  tended to be use
-00006210: 6420 7769 7468 696e 2074 6865 2067 6574  d within the get
-00006220: 5f6d 6574 6164 6174 6128 2920 6675 6e63  _metadata() func
-00006230: 7469 6f6e 2e0a 0a20 2020 2050 6172 616d  tion...    Param
-00006240: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-00006250: 2d2d 2d2d 0a20 2020 2070 6172 616d 7320  ----.    params 
-00006260: 3a20 6469 6374 0a20 2020 2020 2020 2054  : dict.        T
-00006270: 6865 2070 6172 616d 6574 6572 2064 6963  he parameter dic
-00006280: 7469 6f6e 6172 7920 6f75 7470 7574 2066  tionary output f
-00006290: 726f 6d20 696e 7075 745f 7061 7261 6d73  rom input_params
-000062a0: 2829 2061 6e64 2072 6561 6420 696e 746f  () and read into
-000062b0: 2067 6574 5f6d 6574 6164 6174 6128 290a   get_metadata().
-000062c0: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
-000062d0: 202d 2d2d 2d2d 2d2d 0a20 2020 2070 6172   -------.    par
-000062e0: 616d 7320 3a20 6469 6374 0a20 2020 2020  ams : dict.     
-000062f0: 2020 2046 7572 7468 6572 206d 6f64 6966     Further modif
-00006300: 6965 6420 7061 7261 6d65 7465 7220 6469  ied parameter di
-00006310: 6374 696f 6e61 7279 0a20 2020 2022 2222  ctionary.    """
-00006320: 0a20 2020 2069 6e76 203d 2070 6172 616d  .    inv = param
-00006330: 735b 2769 6e76 275d 0a0a 2020 2020 6966  s['inv']..    if
-00006340: 2069 7369 6e73 7461 6e63 6528 696e 762c   isinstance(inv,
-00006350: 2070 6174 686c 6962 2e50 7572 6550 6174   pathlib.PurePat
-00006360: 6829 206f 7220 7479 7065 2869 6e76 2920  h) or type(inv) 
-00006370: 6973 2073 7472 3a0a 2020 2020 2020 2020  is str:.        
-00006380: 696e 7620 3d20 6368 6563 6b69 6670 6174  inv = checkifpat
-00006390: 6828 696e 7629 0a20 2020 2020 2020 2074  h(inv).        t
-000063a0: 7265 6520 3d20 4554 2e70 6172 7365 2869  ree = ET.parse(i
-000063b0: 6e76 290a 2020 2020 2020 2020 726f 6f74  nv).        root
-000063c0: 203d 2074 7265 652e 6765 7472 6f6f 7428   = tree.getroot(
-000063d0: 290a 0a20 2020 2073 7461 7469 6f6e 203d  )..    station =
-000063e0: 2070 6172 616d 735b 2773 7461 275d 0a20   params['sta']. 
-000063f0: 2020 206e 6574 776f 726b 203d 2070 6172     network = par
-00006400: 616d 735b 276e 6574 275d 0a20 2020 2063  ams['net'].    c
-00006410: 6861 6e6e 656c 7320 3d20 7061 7261 6d73  hannels = params
-00006420: 5b27 6368 6127 5d0a 0a20 2020 2069 6620  ['cha']..    if 
-00006430: 6973 696e 7374 616e 6365 2869 6e76 2c20  isinstance(inv, 
-00006440: 7061 7468 6c69 622e 5075 7265 5061 7468  pathlib.PurePath
-00006450: 293a 0a20 2020 2020 2020 2069 6e76 203d  ):.        inv =
-00006460: 2063 6865 636b 6966 7061 7468 2869 6e76   checkifpath(inv
-00006470: 290a 2020 2020 2020 2020 7472 6565 203d  ).        tree =
-00006480: 2045 542e 7061 7273 6528 696e 7629 0a20   ET.parse(inv). 
-00006490: 2020 2020 2020 2072 6f6f 7420 3d20 7472         root = tr
-000064a0: 6565 2e67 6574 726f 6f74 2829 0a20 2020  ee.getroot().   
-000064b0: 2065 6c73 653a 0a20 2020 2020 2020 2023   else:.        #
-000064c0: 4372 6561 7465 2074 656d 706f 7261 7279  Create temporary
-000064d0: 2066 696c 6520 6672 6f6d 2069 6e76 656e   file from inven
-000064e0: 746f 7279 206f 626a 6563 740a 2020 2020  tory object.    
-000064f0: 2020 2020 7470 6620 3d20 7465 6d70 6669      tpf = tempfi
-00006500: 6c65 2e4e 616d 6564 5465 6d70 6f72 6172  le.NamedTemporar
-00006510: 7946 696c 6528 6465 6c65 7465 3d46 616c  yFile(delete=Fal
-00006520: 7365 290a 2020 2020 2020 2020 696e 762e  se).        inv.
-00006530: 7772 6974 6528 7470 662e 6e61 6d65 2c20  write(tpf.name, 
-00006540: 666f 726d 6174 3d27 5354 4154 494f 4e58  format='STATIONX
-00006550: 4d4c 2729 0a0a 2020 2020 2020 2020 2352  ML')..        #R
-00006560: 6561 6420 6461 7461 2069 6e74 6f20 786d  ead data into xm
-00006570: 6c54 7265 650a 2020 2020 2020 2020 7472  lTree.        tr
-00006580: 6565 203d 2045 542e 7061 7273 6528 7470  ee = ET.parse(tp
-00006590: 662e 6e61 6d65 290a 2020 2020 2020 2020  f.name).        
-000065a0: 726f 6f74 203d 2074 7265 652e 6765 7472  root = tree.getr
-000065b0: 6f6f 7428 290a 0a20 2020 2020 2020 2023  oot()..        #
-000065c0: 436c 6f73 6520 616e 6420 7265 6d6f 7665  Close and remove
-000065d0: 2074 656d 706f 7261 7279 2066 696c 650a   temporary file.
-000065e0: 2020 2020 2020 2020 7470 662e 636c 6f73          tpf.clos
-000065f0: 6528 290a 2020 2020 2020 2020 6f73 2e72  e().        os.r
-00006600: 656d 6f76 6528 7470 662e 6e61 6d65 290a  emove(tpf.name).
-00006610: 0a20 2020 2023 6966 2077 7269 7465 5f70  .    #if write_p
-00006620: 6174 6820 213d 2027 273a 0a20 2020 2023  ath != '':.    #
-00006630: 2020 2020 696e 762e 7772 6974 6528 7772      inv.write(wr
-00006640: 6974 655f 7061 7468 2c20 666f 726d 6174  ite_path, format
-00006650: 3d27 5354 4154 494f 4e58 4d4c 2729 0a0a  ='STATIONXML')..
-00006660: 2020 2020 2354 6869 7320 6973 2073 7065      #This is spe
-00006670: 6369 6669 6320 746f 2052 6173 7053 6861  cific to RaspSha
-00006680: 6b65 0a20 2020 2063 3d63 6861 6e6e 656c  ke.    c=channel
-00006690: 735b 305d 0a20 2020 2070 7a4c 6973 7420  s[0].    pzList 
-000066a0: 3d20 5b73 7472 286e 2920 666f 7220 6e20  = [str(n) for n 
-000066b0: 696e 206c 6973 7428 7261 6e67 6528 3729  in list(range(7)
-000066c0: 295d 0a20 2020 2073 3d70 7a4c 6973 745b  )].    s=pzList[
-000066d0: 305d 0a0a 2020 2020 7072 6566 6978 3d20  0]..    prefix= 
-000066e0: 227b 6874 7470 3a2f 2f77 7777 2e66 6473  "{http://www.fds
-000066f0: 6e2e 6f72 672f 786d 6c2f 7374 6174 696f  n.org/xml/statio
-00006700: 6e2f 317d 220a 0a20 2020 2073 656e 7369  n/1}"..    sensi
-00006710: 7469 7669 7479 5061 7468 203d 2022 2e2f  tivityPath = "./
-00006720: 222b 7072 6566 6978 2b22 4e65 7477 6f72  "+prefix+"Networ
-00006730: 6b5b 4063 6f64 653d 2722 2b6e 6574 776f  k[@code='"+netwo
-00006740: 726b 2b22 275d 2f22 2b70 7265 6669 782b  rk+"']/"+prefix+
-00006750: 2253 7461 7469 6f6e 5b40 636f 6465 3d27  "Station[@code='
-00006760: 222b 7374 6174 696f 6e2b 2227 5d2f 222b  "+station+"']/"+
-00006770: 7072 6566 6978 2b22 4368 616e 6e65 6c5b  prefix+"Channel[
-00006780: 4063 6f64 653d 2722 2b63 2b22 275d 2f22  @code='"+c+"']/"
-00006790: 2b70 7265 6669 782b 2252 6573 706f 6e73  +prefix+"Respons
-000067a0: 652f 222b 7072 6566 6978 2b22 496e 7374  e/"+prefix+"Inst
-000067b0: 7275 6d65 6e74 5365 6e73 6974 6976 6974  rumentSensitivit
-000067c0: 792f 222b 7072 6566 6978 2b22 5661 6c75  y/"+prefix+"Valu
-000067d0: 6522 0a20 2020 2067 6169 6e50 6174 6820  e".    gainPath 
-000067e0: 3d20 222e 2f22 2b70 7265 6669 782b 224e  = "./"+prefix+"N
-000067f0: 6574 776f 726b 5b40 636f 6465 3d27 222b  etwork[@code='"+
-00006800: 6e65 7477 6f72 6b2b 2227 5d2f 222b 7072  network+"']/"+pr
-00006810: 6566 6978 2b22 5374 6174 696f 6e5b 4063  efix+"Station[@c
-00006820: 6f64 653d 2722 2b73 7461 7469 6f6e 2b22  ode='"+station+"
-00006830: 275d 2f22 2b70 7265 6669 782b 2243 6861  ']/"+prefix+"Cha
-00006840: 6e6e 656c 5b40 636f 6465 3d27 222b 632b  nnel[@code='"+c+
-00006850: 2227 5d2f 222b 7072 6566 6978 2b22 5265  "']/"+prefix+"Re
-00006860: 7370 6f6e 7365 2f22 2b70 7265 6669 782b  sponse/"+prefix+
-00006870: 2253 7461 6765 5b40 6e75 6d62 6572 3d27  "Stage[@number='
-00006880: 3127 5d2f 222b 7072 6566 6978 2b22 5374  1']/"+prefix+"St
-00006890: 6167 6547 6169 6e2f 222b 7072 6566 6978  ageGain/"+prefix
-000068a0: 2b22 5661 6c75 6522 0a0a 2020 2020 2370  +"Value"..    #p
-000068b0: 617a 203d 205b 5d0a 2020 2020 7273 434c  az = [].    rsCL
-000068c0: 6973 7420 3d20 5b27 4548 5a27 2c20 2745  ist = ['EHZ', 'E
-000068d0: 484e 272c 2027 4548 4527 5d0a 2020 2020  HN', 'EHE'].    
-000068e0: 7061 7a20 3d20 7b7d 0a20 2020 2066 6f72  paz = {}.    for
-000068f0: 2063 2069 6e20 6368 616e 6e65 6c73 3a0a   c in channels:.
-00006900: 2020 2020 2020 2020 6368 616e 6e65 6c50          channelP
-00006910: 617a 203d 207b 7d0a 2020 2020 2020 2020  az = {}.        
-00006920: 2363 6861 6e6e 656c 5061 7a5b 2763 6861  #channelPaz['cha
-00006930: 6e6e 656c 275d 203d 2063 0a20 2020 2020  nnel'] = c.     
-00006940: 2020 2066 6f72 2069 7465 6d20 696e 2072     for item in r
-00006950: 6f6f 742e 6669 6e64 616c 6c28 7365 6e73  oot.findall(sens
-00006960: 6974 6976 6974 7950 6174 6829 3a0a 2020  itivityPath):.  
-00006970: 2020 2020 2020 2020 2020 6368 616e 6e65            channe
-00006980: 6c50 617a 5b27 7365 6e73 6974 6976 6974  lPaz['sensitivit
-00006990: 7927 5d3d 666c 6f61 7428 6974 656d 2e74  y']=float(item.t
-000069a0: 6578 7429 0a0a 2020 2020 2020 2020 666f  ext)..        fo
-000069b0: 7220 6974 656d 2069 6e20 726f 6f74 2e66  r item in root.f
-000069c0: 696e 6461 6c6c 2867 6169 6e50 6174 6829  indall(gainPath)
-000069d0: 3a0a 2020 2020 2020 2020 2020 2020 6368  :.            ch
-000069e0: 616e 6e65 6c50 617a 5b27 6761 696e 275d  annelPaz['gain']
-000069f0: 3d66 6c6f 6174 2869 7465 6d2e 7465 7874  =float(item.text
-00006a00: 290a 2020 2020 2020 2020 0a20 2020 2020  ).        .     
-00006a10: 2020 2070 6f6c 654c 6973 7420 3d20 5b5d     poleList = []
-00006a20: 0a20 2020 2020 2020 207a 6572 6f4c 6973  .        zeroLis
-00006a30: 7420 3d20 5b5d 0a20 2020 2020 2020 2066  t = [].        f
-00006a40: 6f72 2073 2069 6e20 707a 4c69 7374 3a0a  or s in pzList:.
-00006a50: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00006a60: 6e74 2873 2920 3c20 343a 0a20 2020 2020  nt(s) < 4:.     
-00006a70: 2020 2020 2020 2020 2020 2070 6f6c 6550             poleP
-00006a80: 6174 6852 6561 6c20 3d20 222e 2f22 2b70  athReal = "./"+p
-00006a90: 7265 6669 782b 224e 6574 776f 726b 5b40  refix+"Network[@
-00006aa0: 636f 6465 3d27 222b 6e65 7477 6f72 6b2b  code='"+network+
-00006ab0: 2227 5d2f 222b 7072 6566 6978 2b22 5374  "']/"+prefix+"St
-00006ac0: 6174 696f 6e5b 4063 6f64 653d 2722 2b73  ation[@code='"+s
-00006ad0: 7461 7469 6f6e 2b22 275d 2f22 2b70 7265  tation+"']/"+pre
-00006ae0: 6669 782b 2243 6861 6e6e 656c 5b40 636f  fix+"Channel[@co
-00006af0: 6465 3d27 222b 632b 2227 5d2f 222b 7072  de='"+c+"']/"+pr
-00006b00: 6566 6978 2b22 5265 7370 6f6e 7365 2f22  efix+"Response/"
-00006b10: 2b70 7265 6669 782b 2253 7461 6765 5b40  +prefix+"Stage[@
-00006b20: 6e75 6d62 6572 3d27 3127 5d2f 222b 7072  number='1']/"+pr
-00006b30: 6566 6978 2b22 506f 6c65 735a 6572 6f73  efix+"PolesZeros
-00006b40: 2f22 2b70 7265 6669 782b 2250 6f6c 655b  /"+prefix+"Pole[
-00006b50: 406e 756d 6265 723d 2722 2b73 2b22 275d  @number='"+s+"']
-00006b60: 2f22 2b70 7265 6669 782b 2252 6561 6c22  /"+prefix+"Real"
-00006b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006b80: 2070 6f6c 6550 6174 6849 6d61 6720 3d20   polePathImag = 
-00006b90: 222e 2f22 2b70 7265 6669 782b 224e 6574  "./"+prefix+"Net
-00006ba0: 776f 726b 5b40 636f 6465 3d27 222b 6e65  work[@code='"+ne
-00006bb0: 7477 6f72 6b2b 2227 5d2f 222b 7072 6566  twork+"']/"+pref
-00006bc0: 6978 2b22 5374 6174 696f 6e5b 4063 6f64  ix+"Station[@cod
-00006bd0: 653d 2722 2b73 7461 7469 6f6e 2b22 275d  e='"+station+"']
-00006be0: 2f22 2b70 7265 6669 782b 2243 6861 6e6e  /"+prefix+"Chann
-00006bf0: 656c 5b40 636f 6465 3d27 222b 632b 2227  el[@code='"+c+"'
-00006c00: 5d2f 222b 7072 6566 6978 2b22 5265 7370  ]/"+prefix+"Resp
-00006c10: 6f6e 7365 2f22 2b70 7265 6669 782b 2253  onse/"+prefix+"S
-00006c20: 7461 6765 5b40 6e75 6d62 6572 3d27 3127  tage[@number='1'
-00006c30: 5d2f 222b 7072 6566 6978 2b22 506f 6c65  ]/"+prefix+"Pole
-00006c40: 735a 6572 6f73 2f22 2b70 7265 6669 782b  sZeros/"+prefix+
-00006c50: 2250 6f6c 655b 406e 756d 6265 723d 2722  "Pole[@number='"
-00006c60: 2b73 2b22 275d 2f22 2b70 7265 6669 782b  +s+"']/"+prefix+
-00006c70: 2249 6d61 6769 6e61 7279 220a 2020 2020  "Imaginary".    
-00006c80: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00006c90: 706f 6c65 4974 656d 2069 6e20 726f 6f74  poleItem in root
-00006ca0: 2e66 696e 6461 6c6c 2870 6f6c 6550 6174  .findall(polePat
-00006cb0: 6852 6561 6c29 3a0a 2020 2020 2020 2020  hReal):.        
-00006cc0: 2020 2020 2020 2020 2020 2020 706f 6c65              pole
-00006cd0: 5265 616c 203d 2070 6f6c 6549 7465 6d2e  Real = poleItem.
-00006ce0: 7465 7874 0a20 2020 2020 2020 2020 2020  text.           
-00006cf0: 2020 2020 2066 6f72 2070 6f6c 6549 7465       for poleIte
-00006d00: 6d20 696e 2072 6f6f 742e 6669 6e64 616c  m in root.findal
-00006d10: 6c28 706f 6c65 5061 7468 496d 6167 293a  l(polePathImag):
-00006d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006d30: 2020 2020 2070 6f6c 6520 3d20 636f 6d70       pole = comp
-00006d40: 6c65 7828 666c 6f61 7428 706f 6c65 5265  lex(float(poleRe
-00006d50: 616c 292c 2066 6c6f 6174 2870 6f6c 6549  al), float(poleI
-00006d60: 7465 6d2e 7465 7874 2929 0a20 2020 2020  tem.text)).     
-00006d70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00006d80: 6f6c 654c 6973 742e 6170 7065 6e64 2870  oleList.append(p
-00006d90: 6f6c 6529 0a20 2020 2020 2020 2020 2020  ole).           
-00006da0: 2020 2020 2020 2020 2063 6861 6e6e 656c           channel
-00006db0: 5061 7a5b 2770 6f6c 6573 275d 203d 2070  Paz['poles'] = p
-00006dc0: 6f6c 654c 6973 740a 2020 2020 2020 2020  oleList.        
-00006dd0: 2020 2020 2020 2020 2020 2020 2363 6861              #cha
-00006de0: 6e6e 656c 5061 7a5b 2770 6f6c 6573 275d  nnelPaz['poles']
-00006df0: 203d 206c 6973 7428 7365 7428 706f 6c65   = list(set(pole
-00006e00: 4c69 7374 2929 0a20 2020 2020 2020 2020  List)).         
-00006e10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00006e20: 2020 2020 2020 2020 207a 6572 6f50 6174           zeroPat
-00006e30: 6852 6561 6c20 3d20 222e 2f22 2b70 7265  hReal = "./"+pre
-00006e40: 6669 782b 224e 6574 776f 726b 5b40 636f  fix+"Network[@co
-00006e50: 6465 3d27 222b 6e65 7477 6f72 6b2b 2227  de='"+network+"'
-00006e60: 5d2f 222b 7072 6566 6978 2b22 5374 6174  ]/"+prefix+"Stat
-00006e70: 696f 6e5b 4063 6f64 653d 2722 2b73 7461  ion[@code='"+sta
-00006e80: 7469 6f6e 2b22 275d 2f22 2b70 7265 6669  tion+"']/"+prefi
-00006e90: 782b 2243 6861 6e6e 656c 5b40 636f 6465  x+"Channel[@code
-00006ea0: 3d27 222b 632b 2227 5d2f 222b 7072 6566  ='"+c+"']/"+pref
-00006eb0: 6978 2b22 5265 7370 6f6e 7365 2f22 2b70  ix+"Response/"+p
-00006ec0: 7265 6669 782b 2253 7461 6765 5b40 6e75  refix+"Stage[@nu
-00006ed0: 6d62 6572 3d27 3127 5d2f 222b 7072 6566  mber='1']/"+pref
-00006ee0: 6978 2b22 506f 6c65 735a 6572 6f73 2f22  ix+"PolesZeros/"
-00006ef0: 2b70 7265 6669 782b 225a 6572 6f5b 406e  +prefix+"Zero[@n
-00006f00: 756d 6265 723d 2722 2b73 2b22 275d 2f22  umber='"+s+"']/"
-00006f10: 2b70 7265 6669 782b 2252 6561 6c22 0a20  +prefix+"Real". 
-00006f20: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-00006f30: 6572 6f50 6174 6849 6d61 6720 3d20 222e  eroPathImag = ".
-00006f40: 2f22 2b70 7265 6669 782b 224e 6574 776f  /"+prefix+"Netwo
-00006f50: 726b 5b40 636f 6465 3d27 222b 6e65 7477  rk[@code='"+netw
-00006f60: 6f72 6b2b 2227 5d2f 222b 7072 6566 6978  ork+"']/"+prefix
-00006f70: 2b22 5374 6174 696f 6e5b 4063 6f64 653d  +"Station[@code=
-00006f80: 2722 2b73 7461 7469 6f6e 2b22 275d 2f22  '"+station+"']/"
-00006f90: 2b70 7265 6669 782b 2243 6861 6e6e 656c  +prefix+"Channel
-00006fa0: 5b40 636f 6465 3d27 222b 632b 2227 5d2f  [@code='"+c+"']/
-00006fb0: 222b 7072 6566 6978 2b22 5265 7370 6f6e  "+prefix+"Respon
-00006fc0: 7365 2f22 2b70 7265 6669 782b 2253 7461  se/"+prefix+"Sta
-00006fd0: 6765 5b40 6e75 6d62 6572 3d27 3127 5d2f  ge[@number='1']/
-00006fe0: 222b 7072 6566 6978 2b22 506f 6c65 735a  "+prefix+"PolesZ
-00006ff0: 6572 6f73 2f22 2b70 7265 6669 782b 225a  eros/"+prefix+"Z
-00007000: 6572 6f5b 406e 756d 6265 723d 2722 2b73  ero[@number='"+s
-00007010: 2b22 275d 2f22 2b70 7265 6669 782b 2249  +"']/"+prefix+"I
-00007020: 6d61 6769 6e61 7279 220a 2020 2020 2020  maginary".      
-00007030: 2020 2020 2020 2020 2020 666f 7220 7a65            for ze
-00007040: 726f 4974 656d 2069 6e20 726f 6f74 2e66  roItem in root.f
-00007050: 696e 6461 6c6c 287a 6572 6f50 6174 6852  indall(zeroPathR
-00007060: 6561 6c29 3a0a 2020 2020 2020 2020 2020  eal):.          
-00007070: 2020 2020 2020 2020 2020 7a65 726f 5265            zeroRe
-00007080: 616c 203d 207a 6572 6f49 7465 6d2e 7465  al = zeroItem.te
-00007090: 7874 0a20 2020 2020 2020 2020 2020 2020  xt.             
-000070a0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-000070b0: 2020 2020 666f 7220 7a65 726f 4974 656d      for zeroItem
-000070c0: 2069 6e20 726f 6f74 2e66 696e 6461 6c6c   in root.findall
-000070d0: 287a 6572 6f50 6174 6849 6d61 6729 3a0a  (zeroPathImag):.
-000070e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000070f0: 2020 2020 7a65 726f 203d 2063 6f6d 706c      zero = compl
-00007100: 6578 2866 6c6f 6174 287a 6572 6f52 6561  ex(float(zeroRea
-00007110: 6c29 2c20 666c 6f61 7428 7a65 726f 4974  l), float(zeroIt
-00007120: 656d 2e74 6578 7429 290a 2020 2020 2020  em.text)).      
-00007130: 2020 2020 2020 2020 2020 2020 2020 237a                #z
-00007140: 6572 6f20 3d20 7a65 726f 5265 616c 202b  ero = zeroReal +
-00007150: 2022 2b22 202b 207a 6572 6f49 7465 6d2e   "+" + zeroItem.
-00007160: 7465 7874 2b27 6a27 0a20 2020 2020 2020  text+'j'.       
-00007170: 2020 2020 2020 2020 2020 2020 207a 6572               zer
-00007180: 6f4c 6973 742e 6170 7065 6e64 287a 6572  oList.append(zer
-00007190: 6f29 0a20 2020 2020 2020 2020 2020 2020  o).             
-000071a0: 2020 2020 2020 2023 6368 616e 6e65 6c50         #channelP
-000071b0: 617a 5b27 7a65 726f 7327 5d20 3d20 6c69  az['zeros'] = li
-000071c0: 7374 2873 6574 287a 6572 6f4c 6973 7429  st(set(zeroList)
-000071d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000071e0: 2020 2020 2020 6368 616e 6e65 6c50 617a        channelPaz
-000071f0: 5b27 7a65 726f 7327 5d20 3d20 7a65 726f  ['zeros'] = zero
-00007200: 4c69 7374 0a20 2020 2020 2020 2069 6620  List.        if 
-00007210: 7374 7228 6329 2e75 7070 6572 2829 2069  str(c).upper() i
-00007220: 6e20 7273 434c 6973 743a 0a20 2020 2020  n rsCList:.     
-00007230: 2020 2020 2020 2063 203d 2073 7472 2863         c = str(c
-00007240: 295b 2d31 5d2e 7570 7065 7228 290a 2020  )[-1].upper().  
-00007250: 2020 2020 2020 7061 7a5b 7374 7228 6329        paz[str(c)
-00007260: 5d20 3d20 6368 616e 6e65 6c50 617a 0a20  ] = channelPaz. 
-00007270: 2020 2070 6172 616d 735b 2770 617a 275d     params['paz']
-00007280: 203d 2070 617a 0a20 2020 2072 6574 7572   = paz.    retur
-00007290: 6e20 7061 7261 6d73 0a0a 2347 6574 7320  n params..#Gets 
-000072a0: 7468 6520 6d65 7461 6461 7461 2066 6f72  the metadata for
-000072b0: 2052 6173 7062 6572 7279 2053 6861 6b65   Raspberry Shake
-000072c0: 2c20 7370 6563 6966 6963 616c 6c79 2066  , specifically f
-000072d0: 6f72 2033 4420 762e 370a 6465 6620 6765  or 3D v.7.def ge
-000072e0: 745f 6d65 7461 6461 7461 2870 6172 616d  t_metadata(param
-000072f0: 732c 2077 7269 7465 5f70 6174 683d 2727  s, write_path=''
-00007300: 293a 0a20 2020 2022 2222 4765 7420 6d65  ):.    """Get me
-00007310: 7461 6461 7461 2061 6e64 2063 616c 6375  tadata and calcu
-00007320: 6c61 7465 206f 7220 6765 7420 7061 7a20  late or get paz 
-00007330: 7061 7261 6d65 7465 7220 6e65 6564 6564  parameter needed
-00007340: 2066 6f72 2050 5053 440a 0a20 2020 2050   for PPSD..    P
-00007350: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-00007360: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2070 6172  --------.    par
-00007370: 616d 7320 3a20 6469 6374 0a20 2020 2020  ams : dict.     
-00007380: 2020 2044 6963 7469 6f6e 6172 7920 636f     Dictionary co
-00007390: 6e74 6169 6e69 6e67 2061 6c6c 2074 6865  ntaining all the
-000073a0: 2069 6e70 7574 2061 6e64 206f 7468 6572   input and other
-000073b0: 2070 6172 616d 6574 6572 7320 6e65 6564   parameters need
-000073c0: 6564 2066 6f72 2070 726f 6365 7373 696e  ed for processin
-000073d0: 670a 2020 2020 2020 2020 2020 2020 4f75  g.            Ou
-000073e0: 7075 7420 6672 6f6d 2069 6e70 7574 5f70  put from input_p
-000073f0: 6172 616d 7328 2920 6675 6e63 7469 6f6e  arams() function
-00007400: 0a20 2020 2077 7269 7465 5f70 6174 6820  .    write_path 
-00007410: 3a20 7374 720a 2020 2020 2020 2020 5374  : str.        St
-00007420: 7269 6e67 2077 6974 6820 6f75 7470 7574  ring with output
-00007430: 2066 696c 6570 6174 6820 6f66 2077 6865   filepath of whe
-00007440: 7265 2074 6f20 7772 6974 6520 7570 6461  re to write upda
-00007450: 7465 6420 696e 7665 6e74 6f72 7920 6f72  ted inventory or
-00007460: 206d 6574 6164 6174 6120 6669 6c65 0a20   metadata file. 
-00007470: 2020 2020 2020 2020 2020 2049 6620 6e6f             If no
-00007480: 7420 7370 6563 6966 6965 642c 2064 6f65  t specified, doe
-00007490: 7320 6e6f 7420 7772 6974 6520 6669 6c65  s not write file
-000074a0: 200a 0a20 2020 2052 6574 7572 6e73 0a20   ..    Returns. 
-000074b0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2070     -------.    p
-000074c0: 6172 616d 7320 3a20 6469 6374 0a20 2020  arams : dict.   
-000074d0: 2020 2020 204d 6f64 6966 6965 6420 696e       Modified in
-000074e0: 7075 7420 6469 6374 696f 6e61 7279 2077  put dictionary w
-000074f0: 6974 6820 6164 6469 7469 6f6e 616c 206b  ith additional k
-00007500: 6579 3a76 616c 7565 2070 6169 7220 636f  ey:value pair co
-00007510: 6e74 6169 6e69 6e67 2070 617a 2064 6963  ntaining paz dic
-00007520: 7469 6f6e 6172 7920 286b 6579 203d 2022  tionary (key = "
-00007530: 7061 7a22 290a 2020 2020 2222 220a 2020  paz").    """.  
-00007540: 2020 696e 7650 6174 6820 3d20 7061 7261    invPath = para
-00007550: 6d73 5b27 6d65 7461 5061 7468 275d 0a20  ms['metaPath']. 
-00007560: 2020 2072 6173 7053 6861 6b65 496e 7374     raspShakeInst
-00007570: 4e61 6d65 4c69 7374 203d 205b 2772 6173  NameList = ['ras
-00007580: 7062 6572 7279 2073 6861 6b65 272c 2027  pberry shake', '
-00007590: 7368 616b 6527 2c20 2772 6173 7062 6572  shake', 'raspber
-000075a0: 7279 272c 2027 7273 272c 2027 7273 3364  ry', 'rs', 'rs3d
-000075b0: 272c 2027 7261 7370 2e20 7368 616b 6527  ', 'rasp. shake'
-000075c0: 2c20 2772 6173 7073 6861 6b65 275d 0a20  , 'raspshake']. 
-000075d0: 2020 2069 6620 7061 7261 6d73 5b27 696e     if params['in
-000075e0: 7374 7275 6d65 6e74 275d 2e6c 6f77 6572  strument'].lower
-000075f0: 2829 2069 6e20 2072 6173 7053 6861 6b65  () in  raspShake
-00007600: 496e 7374 4e61 6d65 4c69 7374 3a0a 2020  InstNameList:.  
-00007610: 2020 2020 2020 7061 7261 6d73 203d 2075        params = u
-00007620: 7064 6174 655f 7368 616b 655f 6d65 7461  pdate_shake_meta
-00007630: 6461 7461 2866 696c 6570 6174 683d 696e  data(filepath=in
-00007640: 7650 6174 682c 2070 6172 616d 733d 7061  vPath, params=pa
-00007650: 7261 6d73 2c20 7772 6974 655f 7061 7468  rams, write_path
-00007660: 3d77 7269 7465 5f70 6174 6829 0a20 2020  =write_path).   
-00007670: 2020 2020 2070 6172 616d 7320 3d20 5f72       params = _r
-00007680: 6561 645f 5253 5f4d 6574 6164 6174 6128  ead_RS_Metadata(
-00007690: 7061 7261 6d73 290a 2020 2020 656c 7365  params).    else
-000076a0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-000076b0: 277b 7d20 6e6f 7420 6375 7272 656e 746c  '{} not currentl
-000076c0: 7920 7375 7070 6f72 7465 645c 6e20 5265  y supported\n Re
-000076d0: 7475 726e 696e 6720 696e 7075 7420 7061  turning input pa
-000076e0: 7261 6d73 2064 6963 7469 6f6e 6172 792e  rams dictionary.
-000076f0: 272e 666f 726d 6174 2870 6172 616d 735b  '.format(params[
-00007700: 2769 6e73 7472 756d 656e 7427 5d29 290a  'instrument'])).
-00007710: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-00007720: 6172 616d 730a 2020 2020 0a20 2020 2072  arams.    .    r
-00007730: 6574 7572 6e20 7061 7261 6d73 0a0a 2352  eturn params..#R
-00007740: 6561 6473 2069 6e20 7472 6163 6573 2074  eads in traces t
-00007750: 6f20 6f62 7370 7920 7374 7265 616d 0a64  o obspy stream.d
-00007760: 6566 2066 6574 6368 5f64 6174 6128 7061  ef fetch_data(pa
-00007770: 7261 6d73 2c20 696e 763d 4e6f 6e65 2c20  rams, inv=None, 
-00007780: 736f 7572 6365 3d27 7261 7727 2c20 7472  source='raw', tr
-00007790: 696d 5f64 6972 3d4e 6f6e 652c 2065 7870  im_dir=None, exp
-000077a0: 6f72 745f 666f 726d 6174 3d27 6d73 6565  ort_format='msee
-000077b0: 6427 2c20 6465 7472 656e 643d 2773 706c  d', detrend='spl
-000077c0: 696e 6527 2c20 6465 7472 656e 645f 6f72  ine', detrend_or
-000077d0: 6465 723d 3229 3a0a 2020 2020 2222 2246  der=2):.    """F
-000077e0: 6574 6368 2061 6d62 6965 6e74 2073 6569  etch ambient sei
-000077f0: 736d 6963 2064 6174 6120 6672 6f6d 2061  smic data from a
-00007800: 2073 6f75 7263 6520 746f 2072 6561 6420   source to read 
-00007810: 696e 746f 206f 6273 7079 2073 7472 6561  into obspy strea
-00007820: 6d0a 2020 2020 2020 2020 0a20 2020 2020  m.        .     
-00007830: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00007840: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00007850: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
-00007860: 203a 2064 6963 740a 2020 2020 2020 2020   : dict.        
-00007870: 2020 2020 4469 6374 696f 6e61 7279 2063      Dictionary c
-00007880: 6f6e 7461 696e 696e 6720 616c 6c20 7468  ontaining all th
-00007890: 6520 6e65 6365 7373 6172 7920 7061 7261  e necessary para
-000078a0: 6d73 2074 6f20 6765 7420 6461 7461 2e0a  ms to get data..
-000078b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000078c0: 5061 7261 6d65 7465 7273 2064 6566 696e  Parameters defin
-000078d0: 6564 2075 7369 6e67 2069 6e70 7574 5f70  ed using input_p
-000078e0: 6172 616d 7328 2920 6675 6e63 7469 6f6e  arams() function
-000078f0: 2e0a 2020 2020 2020 2020 696e 7620 2020  ..        inv   
-00007900: 2020 3a20 6f62 7370 7920 696e 7665 6e74    : obspy invent
-00007910: 6f72 7920 6f62 6a65 6374 2c20 6465 6661  ory object, defa
-00007920: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00007930: 2020 2020 204f 6273 7079 2069 6e76 656e       Obspy inven
-00007940: 746f 7279 206f 626a 6563 7420 636f 6e74  tory object cont
-00007950: 6169 6e69 6e67 206d 6574 6164 6174 6120  aining metadata 
-00007960: 666f 7220 696e 7374 7275 6d65 6e74 2074  for instrument t
-00007970: 6861 7420 636f 6c6c 6563 7465 6420 6461  hat collected da
-00007980: 7461 2074 6f20 6265 2066 6574 6368 6564  ta to be fetched
-00007990: 2e20 4279 2064 6566 6175 6c74 2c20 7468  . By default, th
-000079a0: 6520 696e 7665 6e74 6f72 7920 6f62 6a65  e inventory obje
-000079b0: 6374 2069 7320 7265 6164 2066 726f 6d20  ct is read from 
-000079c0: 7061 7261 6d73 5b27 696e 7627 5d2c 2062  params['inv'], b
-000079d0: 7574 2074 6869 7320 6361 6e20 6265 206d  ut this can be m
-000079e0: 616e 7561 6c6c 7920 7370 6563 6966 6965  anually specifie
-000079f0: 6420 6865 7265 2074 6f6f 2e0a 2020 2020  d here too..    
-00007a00: 2020 2020 736f 7572 6365 2020 3a20 7374      source  : st
-00007a10: 722c 207b 2772 6177 272c 2027 6469 7227  r, {'raw', 'dir'
-00007a20: 2c20 2766 696c 6527 7d0a 2020 2020 2020  , 'file'}.      
-00007a30: 2020 2020 2020 5374 7269 6e67 2069 6e64        String ind
-00007a40: 6963 6174 696e 6720 7768 6572 652f 686f  icating where/ho
-00007a50: 7720 6461 7461 2066 696c 6520 7761 7320  w data file was 
-00007a60: 6372 6561 7465 642e 2046 6f72 2065 7861  created. For exa
-00007a70: 6d70 6c65 2c20 6966 2072 6177 2064 6174  mple, if raw dat
-00007a80: 612c 2077 696c 6c20 6e65 6564 2074 6f20  a, will need to 
-00007a90: 6669 6e64 2063 6f72 7265 6374 2063 6861  find correct cha
-00007aa0: 6e6e 656c 732e 0a20 2020 2020 2020 2020  nnels..         
-00007ab0: 2020 2020 2020 2027 7261 7727 2066 696e         'raw' fin
-00007ac0: 6473 2072 6173 7062 6572 7279 2073 6861  ds raspberry sha
-00007ad0: 6b65 2064 6174 612c 2066 726f 6d20 7261  ke data, from ra
-00007ae0: 7720 6f75 7470 7574 2063 6f70 6965 6420  w output copied 
-00007af0: 7573 696e 6720 7363 7020 6469 7265 6374  using scp direct
-00007b00: 6c79 2066 726f 6d20 5261 7370 6265 7272  ly from Raspberr
-00007b10: 7920 5368 616b 652c 2065 6974 6865 7220  y Shake, either 
-00007b20: 696e 2066 6f6c 6465 7220 6f72 2073 7562  in folder or sub
-00007b30: 666f 6c64 6572 733b 200a 2020 2020 2020  folders; .      
-00007b40: 2020 2020 2020 2020 2020 2764 6972 2720            'dir' 
-00007b50: 6973 2075 7365 6420 6966 2074 6865 2064  is used if the d
-00007b60: 6179 2773 2033 2063 6f6d 706f 6e65 6e74  ay's 3 component
-00007b70: 2066 696c 6573 2028 6375 7272 656e 746c   files (currentl
-00007b80: 7920 5261 7370 6265 7272 7920 5368 616b  y Raspberry Shak
-00007b90: 6520 7375 7070 6f72 7465 6420 6f6e 6c79  e supported only
-00007ba0: 2920 6172 6520 616c 6c20 3320 636f 6e74  ) are all 3 cont
-00007bb0: 6169 6e65 6420 696e 2061 2064 6972 6563  ained in a direc
-00007bc0: 746f 7279 2062 7920 7468 656d 7365 6c76  tory by themselv
-00007bd0: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
-00007be0: 2020 2020 2766 696c 6527 2069 7320 7573      'file' is us
-00007bf0: 6564 2069 6620 7468 6520 6461 7461 7061  ed if the datapa
-00007c00: 7468 2073 7065 6369 6669 6564 2069 6e20  th specified in 
-00007c10: 696e 7075 745f 7061 7261 6d73 2829 2069  input_params() i
-00007c20: 7320 7468 6520 6469 7265 6374 2066 696c  s the direct fil
-00007c30: 6570 6174 6820 746f 2061 2073 696e 676c  epath to a singl
-00007c40: 6520 6669 6c65 2074 6f20 6265 2072 6561  e file to be rea
-00007c50: 6420 6469 7265 6374 6c79 2069 6e74 6f20  d directly into 
-00007c60: 616e 206f 6273 7079 2073 7472 6561 6d2e  an obspy stream.
-00007c70: 0a20 2020 2020 2020 2074 7269 6d5f 6469  .        trim_di
-00007c80: 7220 3a20 4e6f 6e65 206f 7220 7374 7220  r : None or str 
-00007c90: 6f72 2070 6174 686c 6962 206f 626a 2c20  or pathlib obj, 
-00007ca0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-00007cb0: 2020 2020 2020 2020 2049 6620 4e6f 6e65           If None
-00007cc0: 2028 6f72 2046 616c 7365 292c 2064 6174   (or False), dat
-00007cd0: 6120 6973 206e 6f74 2074 7269 6d6d 6564  a is not trimmed
-00007ce0: 2069 6e20 7468 6973 2066 756e 6374 696f   in this functio
-00007cf0: 6e2e 0a20 2020 2020 2020 2020 2020 204f  n..            O
-00007d00: 7468 6572 7769 7365 2c20 7468 6973 2069  therwise, this i
-00007d10: 7320 7468 6520 6469 7265 6374 6f72 7920  s the directory 
-00007d20: 746f 2073 6176 6520 7472 696d 6d65 6420  to save trimmed 
-00007d30: 616e 6420 6578 706f 7274 6564 2064 6174  and exported dat
-00007d40: 612e 0a20 2020 2020 2020 2065 7870 6f72  a..        expor
-00007d50: 745f 666f 726d 6174 3a20 7374 723d 276d  t_format: str='m
-00007d60: 7365 6564 270a 2020 2020 2020 2020 2020  seed'.          
-00007d70: 2020 4966 2074 7269 6d5f 6469 7220 6973    If trim_dir is
-00007d80: 206e 6f74 2046 616c 7365 2c20 7468 6973   not False, this
-00007d90: 2069 7320 7468 6520 666f 726d 6174 2069   is the format i
-00007da0: 6e20 7768 6963 6820 746f 2073 6176 6520  n which to save 
-00007db0: 7468 6520 6461 7461 0a20 2020 2020 2020  the data.       
-00007dc0: 2064 6574 7265 6e64 203a 2073 7472 206f   detrend : str o
-00007dd0: 7220 626f 6f6c 2c20 6465 6661 756c 743d  r bool, default=
-00007de0: 2773 706c 696e 6527 0a20 2020 2020 2020  'spline'.       
-00007df0: 2020 2020 2049 6620 4661 6c73 652c 2064       If False, d
-00007e00: 6174 6120 6973 206e 6f74 2064 6574 7265  ata is not detre
-00007e10: 6e64 6564 2e0a 2020 2020 2020 2020 2020  nded..          
-00007e20: 2020 4f74 6865 7277 6973 652c 2074 6869    Otherwise, thi
-00007e30: 7320 7368 6f75 6c64 2062 6520 6120 7374  s should be a st
-00007e40: 7269 6e67 2061 6363 6570 7465 6420 6279  ring accepted by
-00007e50: 2074 6865 2074 7970 6520 7061 7261 6d65   the type parame
-00007e60: 7465 7220 6f66 2074 6865 206f 6273 7079  ter of the obspy
-00007e70: 2e63 6f72 652e 7472 6163 652e 5472 6163  .core.trace.Trac
-00007e80: 652e 6465 7472 656e 6420 6d65 7468 6f64  e.detrend method
-00007e90: 3a20 6874 7470 733a 2f2f 646f 6373 2e6f  : https://docs.o
-00007ea0: 6273 7079 2e6f 7267 2f70 6163 6b61 6765  bspy.org/package
-00007eb0: 732f 6175 746f 6765 6e2f 6f62 7370 792e  s/autogen/obspy.
-00007ec0: 636f 7265 2e74 7261 6365 2e54 7261 6365  core.trace.Trace
-00007ed0: 2e64 6574 7265 6e64 2e68 746d 6c0a 2020  .detrend.html.  
-00007ee0: 2020 2020 2020 6465 7472 656e 645f 6f72        detrend_or
-00007ef0: 6465 7220 3a20 696e 742c 2064 6566 6175  der : int, defau
-00007f00: 6c74 3d32 0a20 2020 2020 2020 2020 2020  lt=2.           
-00007f10: 2049 6620 6465 7472 656e 6420 7061 7261   If detrend para
-00007f20: 6d65 7465 7220 6973 2027 7370 6c69 6e65  meter is 'spline
-00007f30: 2720 6f72 2027 706f 6c79 6e6f 6d69 616c  ' or 'polynomial
-00007f40: 272c 2074 6869 7320 6973 2070 6173 7365  ', this is passe
-00007f50: 6420 6469 7265 6374 6c79 2074 6f20 7468  d directly to th
-00007f60: 6520 6f72 6465 7220 7061 7261 6d65 7465  e order paramete
-00007f70: 7220 6f66 206f 6273 7079 2e63 6f72 652e  r of obspy.core.
-00007f80: 7472 6163 652e 5472 6163 652e 6465 7472  trace.Trace.detr
-00007f90: 656e 6420 6d65 7468 6f64 2e0a 2020 2020  end method..    
-00007fa0: 2020 2020 0a20 2020 2020 2020 2052 6574      .        Ret
-00007fb0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-00007fc0: 2d2d 2d2d 0a20 2020 2020 2020 2064 6174  ----.        dat
-00007fd0: 6149 4e20 3a20 6f62 7370 7920 7374 7265  aIN : obspy stre
-00007fe0: 616d 0a20 2020 2020 2020 2020 2020 204f  am.            O
-00007ff0: 6273 7079 2064 6174 6120 7374 7265 616d  bspy data stream
-00008000: 2077 6974 6820 3320 7472 6163 6573 3a20   with 3 traces: 
-00008010: 5a20 2876 6572 7469 6361 6c29 2c20 4e20  Z (vertical), N 
-00008020: 284e 6f72 7468 2d73 6f75 7468 292c 2061  (North-south), a
-00008030: 6e64 2045 2028 4561 7374 2d77 6573 7429  nd E (East-west)
-00008040: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00008050: 2020 2222 220a 2020 2020 6461 7461 7061    """.    datapa
-00008060: 7468 203d 2070 6172 616d 735b 2764 6174  th = params['dat
-00008070: 6150 6174 6827 5d0a 2020 2020 6966 2069  aPath'].    if i
-00008080: 6e76 2069 7320 4e6f 6e65 3a0a 2020 2020  nv is None:.    
-00008090: 2020 2020 696e 7620 3d20 7061 7261 6d73      inv = params
-000080a0: 5b27 696e 7627 5d2c 200a 2020 2020 6461  ['inv'], .    da
-000080b0: 7465 3d70 6172 616d 735b 2761 6371 5f64  te=params['acq_d
-000080c0: 6174 6527 5d0a 2020 2020 6461 7461 7061  ate'].    datapa
-000080d0: 7468 203d 2063 6865 636b 6966 7061 7468  th = checkifpath
-000080e0: 2864 6174 6170 6174 6829 0a20 2020 2069  (datapath).    i
-000080f0: 6e73 7420 3d20 7061 7261 6d73 5b27 696e  nst = params['in
-00008100: 7374 7275 6d65 6e74 275d 0a0a 2020 2020  strument']..    
-00008110: 234e 6565 6420 746f 2070 7574 2064 6174  #Need to put dat
-00008120: 6573 2061 6e64 2074 696d 6573 2069 6e20  es and times in 
-00008130: 7269 6768 7420 666f 726d 6174 7320 6669  right formats fi
-00008140: 7273 740a 2020 2020 6966 2074 7970 6528  rst.    if type(
-00008150: 6461 7465 2920 6973 2064 6174 6574 696d  date) is datetim
-00008160: 652e 6461 7465 7469 6d65 3a0a 2020 2020  e.datetime:.    
-00008170: 2020 2020 646f 7920 3d20 6461 7465 2e74      doy = date.t
-00008180: 696d 6574 7570 6c65 2829 2e74 6d5f 7964  imetuple().tm_yd
-00008190: 6179 0a20 2020 2020 2020 2079 6561 7220  ay.        year 
-000081a0: 3d20 6461 7465 2e79 6561 720a 2020 2020  = date.year.    
-000081b0: 656c 6966 2074 7970 6528 6461 7465 2920  elif type(date) 
-000081c0: 6973 2064 6174 6574 696d 652e 6461 7465  is datetime.date
-000081d0: 3a0a 2020 2020 2020 2020 6461 7465 203d  :.        date =
-000081e0: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
-000081f0: 6d65 2e63 6f6d 6269 6e65 2864 6174 652c  me.combine(date,
-00008200: 2064 6174 6574 696d 652e 7469 6d65 2868   datetime.time(h
-00008210: 6f75 723d 302c 206d 696e 7574 653d 302c  our=0, minute=0,
-00008220: 2073 6563 6f6e 643d 3029 290a 2020 2020   second=0)).    
-00008230: 2020 2020 646f 7920 3d20 6461 7465 2e74      doy = date.t
-00008240: 696d 6574 7570 6c65 2829 2e74 6d5f 7964  imetuple().tm_yd
-00008250: 6179 0a20 2020 2020 2020 2079 6561 7220  ay.        year 
-00008260: 3d20 6461 7465 2e79 6561 720a 2020 2020  = date.year.    
-00008270: 656c 6966 2074 7970 6528 6461 7465 2920  elif type(date) 
-00008280: 6973 2074 7570 6c65 3a0a 2020 2020 2020  is tuple:.      
-00008290: 2020 6966 2064 6174 655b 305d 3e33 3636    if date[0]>366
-000082a0: 3a0a 2020 2020 2020 2020 2020 2020 6572  :.            er
-000082b0: 726f 7228 2746 6972 7374 2069 7465 6d20  ror('First item 
-000082c0: 696e 2064 6174 6520 7475 706c 6520 6d75  in date tuple mu
-000082d0: 7374 2062 6520 6461 7920 6f66 2079 6561  st be day of yea
-000082e0: 7220 2830 2d33 3636 2927 2c20 3029 0a20  r (0-366)', 0). 
-000082f0: 2020 2020 2020 2065 6c69 6620 6461 7465         elif date
-00008300: 5b31 5d20 3e20 6461 7465 7469 6d65 2e64  [1] > datetime.d
-00008310: 6174 6574 696d 652e 6e6f 7728 292e 7965  atetime.now().ye
-00008320: 6172 3a0a 2020 2020 2020 2020 2020 2020  ar:.            
-00008330: 6572 726f 7228 2753 6563 6f6e 6420 6974  error('Second it
-00008340: 656d 2069 6e20 6461 7465 2074 7570 6c65  em in date tuple
-00008350: 2073 686f 756c 6420 6265 2079 6561 722c   should be year,
-00008360: 2062 7574 2067 6976 656e 2069 7465 6d20   but given item 
-00008370: 6973 2069 6e20 7468 6520 6675 7475 7265  is in the future
-00008380: 272c 2030 290a 2020 2020 2020 2020 656c  ', 0).        el
-00008390: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000083a0: 646f 7920 3d20 6461 7465 5b30 5d0a 2020  doy = date[0].  
-000083b0: 2020 2020 2020 2020 2020 7965 6172 203d            year =
-000083c0: 2064 6174 655b 315d 0a20 2020 2065 6c69   date[1].    eli
-000083d0: 6620 7479 7065 2864 6174 6529 2069 7320  f type(date) is 
-000083e0: 7374 723a 0a20 2020 2020 2020 2069 6620  str:.        if 
-000083f0: 272f 2720 696e 2064 6174 653a 0a20 2020  '/' in date:.   
-00008400: 2020 2020 2020 2020 2064 6174 6553 706c           dateSpl
-00008410: 6974 203d 2064 6174 652e 7370 6c69 7428  it = date.split(
-00008420: 272f 2729 2020 2020 2020 2020 2020 2020  '/')            
-00008430: 0a20 2020 2020 2020 2065 6c69 6620 272d  .        elif '-
-00008440: 2720 696e 2064 6174 653a 0a20 2020 2020  ' in date:.     
-00008450: 2020 2020 2020 2064 6174 6553 706c 6974         dateSplit
-00008460: 203d 2064 6174 652e 7370 6c69 7428 272d   = date.split('-
-00008470: 2729 0a20 2020 2020 2020 2065 6c73 653a  ').        else:
-00008480: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-00008490: 6553 706c 6974 203d 2064 6174 650a 0a20  eSplit = date.. 
-000084a0: 2020 2020 2020 2069 6620 696e 7428 6461         if int(da
-000084b0: 7465 5370 6c69 745b 305d 2920 3e20 3331  teSplit[0]) > 31
-000084c0: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
-000084d0: 7465 203d 2064 6174 6574 696d 652e 6461  te = datetime.da
-000084e0: 7465 7469 6d65 2869 6e74 2864 6174 6553  tetime(int(dateS
-000084f0: 706c 6974 5b30 5d29 2c20 696e 7428 6461  plit[0]), int(da
-00008500: 7465 5370 6c69 745b 315d 292c 2069 6e74  teSplit[1]), int
-00008510: 2864 6174 6553 706c 6974 5b32 5d29 290a  (dateSplit[2])).
-00008520: 2020 2020 2020 2020 2020 2020 646f 7920              doy 
-00008530: 3d20 6461 7465 2e74 696d 6574 7570 6c65  = date.timetuple
-00008540: 2829 2e74 6d5f 7964 6179 0a20 2020 2020  ().tm_yday.     
-00008550: 2020 2020 2020 2079 6561 7220 3d20 6461         year = da
-00008560: 7465 2e79 6561 720a 2020 2020 2020 2020  te.year.        
-00008570: 656c 6966 2069 6e74 2864 6174 6553 706c  elif int(dateSpl
-00008580: 6974 5b30 5d29 3c3d 3132 2061 6e64 2069  it[0])<=12 and i
-00008590: 6e74 2864 6174 6553 706c 6974 5b32 5d29  nt(dateSplit[2])
-000085a0: 203e 2033 313a 0a20 2020 2020 2020 2020   > 31:.         
-000085b0: 2020 2069 6e66 6f28 2250 7265 6665 7272     info("Preferr
-000085c0: 6564 2064 6174 6520 666f 726d 6174 2069  ed date format i
-000085d0: 7320 2779 7979 792d 6d6d 2d64 6427 206f  s 'yyyy-mm-dd' o
-000085e0: 7220 2779 7979 792f 6d6d 2f64 6427 2e20  r 'yyyy/mm/dd'. 
-000085f0: 5769 6c6c 2061 7474 656d 7074 2074 6f20  Will attempt to 
-00008600: 7061 7273 6520 6461 7465 2e22 290a 2020  parse date.").  
-00008610: 2020 2020 2020 2020 2020 6461 7465 203d            date =
-00008620: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
-00008630: 6d65 2869 6e74 2864 6174 6553 706c 6974  me(int(dateSplit
-00008640: 5b32 5d29 2c20 696e 7428 6461 7465 5370  [2]), int(dateSp
-00008650: 6c69 745b 305d 292c 2069 6e74 2864 6174  lit[0]), int(dat
-00008660: 6553 706c 6974 5b31 5d29 290a 2020 2020  eSplit[1])).    
-00008670: 2020 2020 2020 2020 646f 7920 3d20 6461          doy = da
-00008680: 7465 2e74 696d 6574 7570 6c65 2829 2e74  te.timetuple().t
-00008690: 6d5f 7964 6179 0a20 2020 2020 2020 2020  m_yday.         
-000086a0: 2020 2079 6561 7220 3d20 6461 7465 2e79     year = date.y
-000086b0: 6561 720a 2020 2020 2020 2020 656c 7365  ear.        else
-000086c0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
-000086d0: 666f 2822 5072 6566 6572 7265 6420 6461  fo("Preferred da
-000086e0: 7465 2066 6f72 6d61 7420 6973 2027 7979  te format is 'yy
-000086f0: 7979 2d6d 6d2d 6464 2720 6f72 2027 7979  yy-mm-dd' or 'yy
-00008700: 7979 2f6d 6d2f 6464 272e 2043 616e 6e6f  yy/mm/dd'. Canno
-00008710: 7420 7061 7273 6520 6461 7465 2e22 290a  t parse date.").
-00008720: 2020 2020 656c 6966 2074 7970 6528 6461      elif type(da
-00008730: 7465 2920 6973 2069 6e74 3a0a 2020 2020  te) is int:.    
-00008740: 2020 2020 646f 7920 3d20 6461 7465 0a20      doy = date. 
-00008750: 2020 2020 2020 2079 6561 7220 3d20 6461         year = da
-00008760: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
-00008770: 746f 6461 7928 292e 7965 6172 0a20 2020  today().year.   
-00008780: 2065 6c73 653a 2023 464f 5220 4e4f 572c   else: #FOR NOW,
-00008790: 206e 6565 6420 746f 2075 7064 6174 650a   need to update.
-000087a0: 2020 2020 2020 2020 6461 7465 203d 2064          date = d
-000087b0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-000087c0: 2e6e 6f77 2829 0a20 2020 2020 2020 2064  .now().        d
-000087d0: 6f79 203d 2064 6174 652e 7469 6d65 7475  oy = date.timetu
-000087e0: 706c 6528 292e 746d 5f79 6461 790a 2020  ple().tm_yday.  
-000087f0: 2020 2020 2020 7965 6172 203d 2064 6174        year = dat
-00008800: 652e 7965 6172 0a20 2020 2020 2020 2070  e.year.        p
-00008810: 7269 6e74 2822 4469 6420 6e6f 7420 7265  rint("Did not re
-00008820: 636f 676e 697a 6520 6461 7465 2c20 7573  cognize date, us
-00008830: 696e 6720 7965 6172 207b 7d20 616e 6420  ing year {} and 
-00008840: 6461 7920 7b7d 222e 666f 726d 6174 2879  day {}".format(y
-00008850: 6561 722c 2064 6f79 2929 0a0a 2020 2020  ear, doy))..    
-00008860: 2353 656c 6563 7420 7768 6963 6820 696e  #Select which in
-00008870: 7374 7275 6d65 6e74 2077 6520 6172 6520  strument we are 
-00008880: 7265 6164 696e 6720 6672 6f6d 2028 7265  reading from (re
-00008890: 7175 6972 6573 2064 6966 6665 7265 6e74  quires different
-000088a0: 2070 726f 6365 7373 6573 2066 6f72 2065   processes for e
-000088b0: 6163 6820 696e 7374 7275 6d65 6e74 290a  ach instrument).
-000088c0: 2020 2020 7261 7370 5368 616b 6549 6e73      raspShakeIns
-000088d0: 744e 616d 654c 6973 7420 3d20 5b27 7261  tNameList = ['ra
-000088e0: 7370 6265 7272 7920 7368 616b 6527 2c20  spberry shake', 
-000088f0: 2773 6861 6b65 272c 2027 7261 7370 6265  'shake', 'raspbe
-00008900: 7272 7927 2c20 2772 7327 2c20 2772 7333  rry', 'rs', 'rs3
-00008910: 6427 2c20 2772 6173 702e 2073 6861 6b65  d', 'rasp. shake
-00008920: 272c 2027 7261 7370 7368 616b 6527 5d0a  ', 'raspshake'].
-00008930: 2020 2020 6966 2073 6f75 7263 653d 3d27      if source=='
-00008940: 7261 7727 3a0a 2020 2020 2020 2020 6966  raw':.        if
-00008950: 2069 6e73 742e 6c6f 7765 7228 2920 696e   inst.lower() in
-00008960: 2072 6173 7053 6861 6b65 496e 7374 4e61   raspShakeInstNa
-00008970: 6d65 4c69 7374 3a0a 2020 2020 2020 2020  meList:.        
-00008980: 2020 2020 7261 7744 6174 6149 4e20 3d20      rawDataIN = 
-00008990: 5f5f 7265 6164 5f52 535f 6461 7461 2864  __read_RS_data(d
-000089a0: 6174 6170 6174 682c 2073 6f75 7263 652c  atapath, source,
-000089b0: 2079 6561 722c 2064 6f79 2c20 696e 762c   year, doy, inv,
-000089c0: 2070 6172 616d 7329 0a20 2020 2065 6c69   params).    eli
-000089d0: 6620 736f 7572 6365 3d3d 2764 6972 273a  f source=='dir':
-000089e0: 0a20 2020 2020 2020 2069 6620 696e 7374  .        if inst
-000089f0: 2e6c 6f77 6572 2829 2069 6e20 7261 7370  .lower() in rasp
-00008a00: 5368 616b 6549 6e73 744e 616d 654c 6973  ShakeInstNameLis
-00008a10: 743a 0a20 2020 2020 2020 2020 2020 2072  t:.            r
-00008a20: 6177 4461 7461 494e 203d 205f 5f72 6561  awDataIN = __rea
-00008a30: 645f 5253 5f64 6174 6128 6461 7461 7061  d_RS_data(datapa
-00008a40: 7468 2c20 736f 7572 6365 2c20 7965 6172  th, source, year
-00008a50: 2c20 646f 792c 2069 6e76 2c20 7061 7261  , doy, inv, para
-00008a60: 6d73 290a 2020 2020 656c 6966 2073 6f75  ms).    elif sou
-00008a70: 7263 653d 3d27 6669 6c65 273a 0a20 2020  rce=='file':.   
-00008a80: 2020 2020 2072 6177 4461 7461 494e 203d       rawDataIN =
-00008a90: 206f 6273 7079 2e72 6561 6428 6461 7461   obspy.read(data
-00008aa0: 7061 7468 2923 2c20 7374 6172 7474 696d  path)#, starttim
-00008ab0: 653d 6f62 7370 792e 636f 7265 2e55 5443  e=obspy.core.UTC
-00008ac0: 4461 7465 5469 6d65 2870 6172 616d 735b  DateTime(params[
-00008ad0: 2773 7461 7274 7469 6d65 275d 292c 2065  'starttime']), e
-00008ae0: 6e64 7474 696d 653d 6f62 7370 792e 636f  ndttime=obspy.co
-00008af0: 7265 2e55 5443 4461 7465 5469 6d65 2870  re.UTCDateTime(p
-00008b00: 6172 616d 735b 2765 6e64 7469 6d65 275d  arams['endtime']
-00008b10: 292c 206e 6561 7265 7374 5f73 616d 706c  ), nearest_sampl
-00008b20: 6520 3d54 7275 6529 0a20 2020 2020 2020  e =True).       
-00008b30: 2072 6177 4461 7461 494e 2e61 7474 6163   rawDataIN.attac
-00008b40: 685f 7265 7370 6f6e 7365 2869 6e76 290a  h_response(inv).
-00008b50: 0a20 2020 2069 6620 7261 7744 6174 6149  .    if rawDataI
-00008b60: 4e20 6973 204e 6f6e 653a 0a20 2020 2020  N is None:.     
-00008b70: 2020 2072 6574 7572 6e0a 2020 2020 656c     return.    el
-00008b80: 6966 2069 7369 6e73 7461 6e63 6528 7261  if isinstance(ra
-00008b90: 7744 6174 6149 4e2c 206f 6273 7079 2e63  wDataIN, obspy.c
-00008ba0: 6f72 652e 7374 7265 616d 2e53 7472 6561  ore.stream.Strea
-00008bb0: 6d29 3a0a 2020 2020 2020 2020 234d 616b  m):.        #Mak
-00008bc0: 6520 7375 7265 207a 2063 6f6d 706f 6e65  e sure z compone
-00008bd0: 6e74 2069 7320 6669 7273 740a 2020 2020  nt is first.    
-00008be0: 2020 2020 6966 2027 5a27 2069 6e20 7261      if 'Z' in ra
-00008bf0: 7744 6174 6149 4e5b 305d 2e73 7461 7473  wDataIN[0].stats
-00008c00: 5b27 6368 616e 6e65 6c27 5d3a 2329 2e73  ['channel']:#).s
-00008c10: 706c 6974 2827 2e27 295b 335d 3a23 5b31  plit('.')[3]:#[1
-00008c20: 323a 3135 5d3a 0a20 2020 2020 2020 2020  2:15]:.         
-00008c30: 2020 2064 6174 6149 4e20 3d20 7261 7744     dataIN = rawD
-00008c40: 6174 6149 4e0a 2020 2020 2020 2020 656c  ataIN.        el
-00008c50: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00008c60: 6461 7461 494e 203d 2072 6177 4461 7461  dataIN = rawData
-00008c70: 494e 2e73 6f72 7428 5b27 6368 616e 6e65  IN.sort(['channe
-00008c80: 6c27 5d2c 2072 6576 6572 7365 3d54 7275  l'], reverse=Tru
-00008c90: 6529 2023 7a2c 206e 2c20 6520 6f72 6465  e) #z, n, e orde
-00008ca0: 720a 2020 2020 656c 7365 3a0a 2020 2020  r.    else:.    
-00008cb0: 2020 2020 6461 7461 494e 203d 205b 5d0a      dataIN = [].
-00008cc0: 2020 2020 2020 2020 666f 7220 692c 2073          for i, s
-00008cd0: 7420 696e 2065 6e75 6d65 7261 7465 2872  t in enumerate(r
-00008ce0: 6177 4461 7461 494e 293a 0a20 2020 2020  awDataIN):.     
-00008cf0: 2020 2020 2020 2069 6620 275a 2720 696e         if 'Z' in
-00008d00: 2073 745b 305d 2e73 7461 7473 5b27 6368   st[0].stats['ch
-00008d10: 616e 6e65 6c27 5d3a 2329 2e73 706c 6974  annel']:#).split
-00008d20: 2827 2e27 295b 335d 3a23 5b31 323a 3135  ('.')[3]:#[12:15
-00008d30: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00008d40: 2020 2064 6174 6149 4e2e 6170 7065 6e64     dataIN.append
-00008d50: 2872 6177 4461 7461 494e 5b69 5d29 0a20  (rawDataIN[i]). 
-00008d60: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00008d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008d80: 2064 6174 6149 4e2e 6170 7065 6e64 2872   dataIN.append(r
-00008d90: 6177 4461 7461 494e 5b69 5d2e 736f 7274  awDataIN[i].sort
-00008da0: 285b 2763 6861 6e6e 656c 275d 2c20 7265  (['channel'], re
-00008db0: 7665 7273 653d 5472 7565 2929 2023 7a2c  verse=True)) #z,
-00008dc0: 206e 2c20 6520 6f72 6465 7220 2020 2020   n, e order     
-00008dd0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00008de0: 0a20 2020 2069 6620 6e6f 7420 7472 696d  .    if not trim
-00008df0: 5f64 6972 3a0a 2020 2020 2020 2020 7061  _dir:.        pa
-00008e00: 7373 0a20 2020 2065 6c73 653a 0a20 2020  ss.    else:.   
-00008e10: 2020 2020 2064 6174 6149 4e20 3d20 7472       dataIN = tr
-00008e20: 696d 5f64 6174 6128 7374 7265 616d 3d64  im_data(stream=d
-00008e30: 6174 6149 4e2c 2070 6172 616d 733d 7061  ataIN, params=pa
-00008e40: 7261 6d73 2c20 6578 706f 7274 5f64 6972  rams, export_dir
-00008e50: 3d74 7269 6d5f 6469 722c 2065 7870 6f72  =trim_dir, expor
-00008e60: 745f 666f 726d 6174 3d65 7870 6f72 745f  t_format=export_
-00008e70: 666f 726d 6174 290a 0a20 2020 2069 6620  format)..    if 
-00008e80: 6465 7472 656e 643d 3d46 616c 7365 3a0a  detrend==False:.
-00008e90: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-00008ea0: 2065 6c69 6620 6465 7472 656e 643d 3d54   elif detrend==T
-00008eb0: 7275 653a 0a20 2020 2020 2020 2023 4279  rue:.        #By
-00008ec0: 2064 6566 6175 6c74 2c20 646f 2061 2073   default, do a s
-00008ed0: 706c 696e 6520 7265 6d6f 7661 6c0a 2020  pline removal.  
-00008ee0: 2020 2020 2020 666f 7220 7472 2069 6e20        for tr in 
-00008ef0: 6461 7461 494e 3a0a 2020 2020 2020 2020  dataIN:.        
-00008f00: 2020 2020 7472 2e64 6574 7265 6e64 2874      tr.detrend(t
-00008f10: 7970 653d 2773 706c 696e 6527 2c20 6f72  ype='spline', or
-00008f20: 6465 723d 6465 7472 656e 645f 6f72 6465  der=detrend_orde
-00008f30: 722c 2064 7370 6c69 6e65 3d31 3030 3029  r, dspline=1000)
-00008f40: 2020 2020 2020 2020 0a20 2020 2065 6c73          .    els
-00008f50: 653a 0a20 2020 2020 2020 2069 6620 6465  e:.        if de
-00008f60: 7472 656e 643d 3d27 7369 6d70 6c65 273a  trend=='simple':
-00008f70: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00008f80: 2074 7220 696e 2064 6174 6149 4e3a 0a20   tr in dataIN:. 
-00008f90: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00008fa0: 722e 6465 7472 656e 6428 7479 7065 3d64  r.detrend(type=d
-00008fb0: 6574 7265 6e64 290a 2020 2020 2020 2020  etrend).        
-00008fc0: 6966 2064 6574 7265 6e64 3d3d 276c 696e  if detrend=='lin
-00008fd0: 6561 7227 3a0a 2020 2020 2020 2020 2020  ear':.          
-00008fe0: 2020 666f 7220 7472 2069 6e20 6461 7461    for tr in data
-00008ff0: 494e 3a0a 2020 2020 2020 2020 2020 2020  IN:.            
-00009000: 2020 2020 7472 2e64 6574 7265 6e64 2874      tr.detrend(t
-00009010: 7970 653d 6465 7472 656e 6429 0a20 2020  ype=detrend).   
-00009020: 2020 2020 2069 6620 6465 7472 656e 643d       if detrend=
-00009030: 3d27 636f 6e73 7461 6e74 2720 6f72 2064  ='constant' or d
-00009040: 6574 7265 6e64 3d3d 2764 656d 6561 6e27  etrend=='demean'
-00009050: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00009060: 7220 7472 2069 6e20 6461 7461 494e 3a0a  r tr in dataIN:.
-00009070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009080: 7472 2e64 6574 7265 6e64 2874 7970 653d  tr.detrend(type=
-00009090: 6465 7472 656e 6429 2020 2020 2020 2020  detrend)        
-000090a0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000090b0: 2069 6620 6465 7472 656e 643d 3d27 706f   if detrend=='po
-000090c0: 6c79 6e6f 6d69 616c 273a 0a20 2020 2020  lynomial':.     
-000090d0: 2020 2020 2020 2066 6f72 2074 7220 696e         for tr in
-000090e0: 2064 6174 6149 4e3a 0a20 2020 2020 2020   dataIN:.       
-000090f0: 2020 2020 2020 2020 2074 722e 6465 7472           tr.detr
-00009100: 656e 6428 7479 7065 3d64 6574 7265 6e64  end(type=detrend
-00009110: 2c20 6f72 6465 723d 6465 7472 656e 645f  , order=detrend_
-00009120: 6f72 6465 7229 2020 200a 2020 2020 2020  order)   .      
-00009130: 2020 6966 2064 6574 7265 6e64 3d3d 2773    if detrend=='s
-00009140: 706c 696e 6527 3a0a 2020 2020 2020 2020  pline':.        
-00009150: 2020 2020 666f 7220 7472 2069 6e20 6461      for tr in da
-00009160: 7461 494e 3a0a 2020 2020 2020 2020 2020  taIN:.          
-00009170: 2020 2020 2020 7472 2e64 6574 7265 6e64        tr.detrend
-00009180: 2874 7970 653d 6465 7472 656e 642c 206f  (type=detrend, o
-00009190: 7264 6572 3d64 6574 7265 6e64 5f6f 7264  rder=detrend_ord
-000091a0: 6572 2c20 6473 706c 696e 653d 3130 3030  er, dspline=1000
-000091b0: 2920 2020 2020 2020 0a20 2020 200a 2020  )       .    .  
-000091c0: 2020 7061 7261 6d73 5b27 7374 7265 616d    params['stream
-000091d0: 275d 203d 2064 6174 6149 4e0a 0a20 2020  '] = dataIN..   
-000091e0: 2072 6574 7572 6e20 7061 7261 6d73 0a0a   return params..
-000091f0: 2352 6561 6420 6461 7461 2066 726f 6d20  #Read data from 
-00009200: 7261 7370 6265 7272 7920 7368 616b 650a  raspberry shake.
-00009210: 6465 6620 5f5f 7265 6164 5f52 535f 6461  def __read_RS_da
-00009220: 7461 2864 6174 6170 6174 682c 2073 6f75  ta(datapath, sou
-00009230: 7263 652c 2079 6561 722c 2064 6f79 2c20  rce, year, doy, 
-00009240: 696e 762c 2070 6172 616d 7329 3a0a 2020  inv, params):.  
-00009250: 2020 2222 2222 5072 6976 6174 6520 6675    """"Private fu
-00009260: 6e63 7469 6f6e 2075 7365 6420 6279 2066  nction used by f
-00009270: 6574 6368 5f64 6174 6128 2920 746f 2072  etch_data() to r
-00009280: 6561 6420 696e 2052 6173 7062 6572 7279  ead in Raspberry
-00009290: 2053 6861 6b65 2064 6174 6122 2222 0a20   Shake data""". 
-000092a0: 2020 2066 726f 6d20 6f62 7370 792e 636f     from obspy.co
-000092b0: 7265 2069 6d70 6f72 7420 5554 4344 6174  re import UTCDat
-000092c0: 6554 696d 650a 2020 2020 6669 6c65 4c69  eTime.    fileLi
-000092d0: 7374 203d 205b 5d0a 2020 2020 666f 6c64  st = [].    fold
-000092e0: 6572 5061 7468 4c69 7374 203d 205b 5d0a  erPathList = [].
-000092f0: 2020 2020 6669 6c65 7369 6e66 6f6c 6465      filesinfolde
-00009300: 7220 3d20 4661 6c73 650a 2020 2020 0a20  r = False.    . 
-00009310: 2020 2064 6174 6170 6174 6820 3d20 6368     datapath = ch
-00009320: 6563 6b69 6670 6174 6828 6461 7461 7061  eckifpath(datapa
-00009330: 7468 290a 0a20 2020 2023 5265 6164 2052  th)..    #Read R
-00009340: 5320 6669 6c65 730a 2020 2020 6966 2073  S files.    if s
-00009350: 6f75 7263 653d 3d27 7261 7727 3a20 2372  ource=='raw': #r
-00009360: 6177 2064 6174 6120 7769 7468 2069 6e64  aw data with ind
-00009370: 6976 6964 7561 6c20 6669 6c65 7320 7065  ividual files pe
-00009380: 7220 7472 6163 650a 2020 2020 2020 2020  r trace.        
-00009390: 6966 2064 6174 6170 6174 682e 6973 5f64  if datapath.is_d
-000093a0: 6972 2829 3a0a 2020 2020 2020 2020 2020  ir():.          
-000093b0: 2020 666f 7220 6368 696c 6420 696e 2064    for child in d
-000093c0: 6174 6170 6174 682e 6974 6572 6469 7228  atapath.iterdir(
-000093d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000093e0: 2020 2069 6620 6368 696c 642e 6973 5f66     if child.is_f
-000093f0: 696c 6528 2920 616e 6420 6368 696c 642e  ile() and child.
-00009400: 6e61 6d65 2e73 7461 7274 7377 6974 6828  name.startswith(
-00009410: 2741 4d27 2920 616e 6420 7374 7228 646f  'AM') and str(do
-00009420: 7929 2e7a 6669 6c6c 2833 2920 696e 2063  y).zfill(3) in c
-00009430: 6869 6c64 2e6e 616d 6520 616e 6420 7374  hild.name and st
-00009440: 7228 7965 6172 2920 696e 2063 6869 6c64  r(year) in child
-00009450: 2e6e 616d 653a 0a20 2020 2020 2020 2020  .name:.         
-00009460: 2020 2020 2020 2020 2020 2066 696c 6573             files
-00009470: 696e 666f 6c64 6572 203d 2054 7275 650a  infolder = True.
-00009480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009490: 2020 2020 666f 6c64 6572 5061 7468 4c69      folderPathLi
-000094a0: 7374 2e61 7070 656e 6428 6461 7461 7061  st.append(datapa
-000094b0: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
-000094c0: 2020 2020 2020 2020 6669 6c65 4c69 7374          fileList
-000094d0: 2e61 7070 656e 6428 6368 696c 6429 0a20  .append(child). 
-000094e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000094f0: 6c69 6620 6368 696c 642e 6973 5f64 6972  lif child.is_dir
-00009500: 2829 2061 6e64 2063 6869 6c64 2e6e 616d  () and child.nam
-00009510: 652e 7374 6172 7473 7769 7468 2827 4548  e.startswith('EH
-00009520: 2729 2061 6e64 206e 6f74 2066 696c 6573  ') and not files
-00009530: 696e 666f 6c64 6572 3a0a 2020 2020 2020  infolder:.      
-00009540: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00009550: 6c64 6572 5061 7468 4c69 7374 2e61 7070  lderPathList.app
-00009560: 656e 6428 6368 696c 6429 0a20 2020 2020  end(child).     
-00009570: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00009580: 6f72 2063 2069 6e20 6368 696c 642e 6974  or c in child.it
-00009590: 6572 6469 7228 293a 0a20 2020 2020 2020  erdir():.       
-000095a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095b0: 2069 6620 632e 6973 5f66 696c 6528 2920   if c.is_file() 
-000095c0: 616e 6420 632e 6e61 6d65 2e73 7461 7274  and c.name.start
-000095d0: 7377 6974 6828 2741 4d27 2920 616e 6420  swith('AM') and 
-000095e0: 632e 6e61 6d65 2e65 6e64 7377 6974 6828  c.name.endswith(
-000095f0: 7374 7228 646f 7929 2e7a 6669 6c6c 2833  str(doy).zfill(3
-00009600: 2929 2061 6e64 2073 7472 2879 6561 7229  )) and str(year)
-00009610: 2069 6e20 632e 6e61 6d65 3a0a 2020 2020   in c.name:.    
-00009620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009630: 2020 2020 2020 2020 6669 6c65 4c69 7374          fileList
-00009640: 2e61 7070 656e 6428 6329 0a0a 2020 2020  .append(c)..    
-00009650: 2020 2020 2020 2020 6966 206c 656e 2866          if len(f
-00009660: 696c 654c 6973 7429 2021 3d33 3a0a 2020  ileList) !=3:.  
-00009670: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00009680: 726f 7228 2733 2063 6861 6e6e 656c 7320  ror('3 channels 
-00009690: 6e65 6564 6564 2120 7b7d 2066 6f75 6e64  needed! {} found
-000096a0: 2e27 2e66 6f72 6d61 7428 6c65 6e28 666f  .'.format(len(fo
-000096b0: 6c64 6572 5061 7468 4c69 7374 2929 2c20  lderPathList)), 
-000096c0: 3129 0a20 2020 2020 2020 2020 2020 2065  1).            e
-000096d0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000096e0: 2020 2020 2070 7269 6e74 2827 5265 6164       print('Read
-000096f0: 696e 6720 6669 6c65 733a 205c 6e5c 747b  ing files: \n\t{
-00009700: 7d5c 6e5c 747b 7d5c 6e5c 747b 7d27 2e66  }\n\t{}\n\t{}'.f
-00009710: 6f72 6d61 7428 6669 6c65 4c69 7374 5b30  ormat(fileList[0
-00009720: 5d2e 6e61 6d65 2c20 6669 6c65 4c69 7374  ].name, fileList
-00009730: 5b31 5d2e 6e61 6d65 2c20 6669 6c65 4c69  [1].name, fileLi
-00009740: 7374 5b32 5d2e 6e61 6d65 2929 0a20 2020  st[2].name)).   
-00009750: 2020 2020 2020 2020 2066 696c 654c 6973           fileLis
-00009760: 742e 736f 7274 2872 6576 6572 7365 3d54  t.sort(reverse=T
-00009770: 7275 6529 2023 2050 7574 7320 7a20 6368  rue) # Puts z ch
-00009780: 616e 6e65 6c20 6669 7273 740a 2020 2020  annel first.    
-00009790: 2020 2020 2020 2020 666f 6c64 6572 5061          folderPa
-000097a0: 7468 4c69 7374 2e73 6f72 7428 7265 7665  thList.sort(reve
-000097b0: 7273 653d 5472 7565 290a 0a20 2020 2020  rse=True)..     
-000097c0: 2020 2020 2020 2069 6620 6c65 6e28 6669         if len(fi
-000097d0: 6c65 4c69 7374 2920 3d3d 2030 3a0a 2020  leList) == 0:.  
-000097e0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-000097f0: 666f 2827 4e6f 2066 696c 6520 666f 756e  fo('No file foun
-00009800: 6420 666f 7220 7370 6563 6966 6965 6420  d for specified 
-00009810: 7061 7261 6d65 7465 7273 2e20 5468 6520  parameters. The 
-00009820: 666f 6c6c 6f77 696e 6720 6461 7973 2f66  following days/f
-00009830: 696c 6573 2065 7869 7374 2066 6f72 2073  iles exist for s
-00009840: 7065 6369 6669 6564 2079 6561 7220 696e  pecified year in
-00009850: 2074 6869 7320 6469 7265 6374 6f72 7927   this directory'
-00009860: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00009870: 2020 646f 794c 6973 7420 3d20 5b5d 0a20    doyList = []. 
-00009880: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00009890: 6f72 206a 2c20 666f 6c64 6572 2069 6e20  or j, folder in 
-000098a0: 656e 756d 6572 6174 6528 666f 6c64 6572  enumerate(folder
-000098b0: 5061 7468 4c69 7374 293a 0a20 2020 2020  PathList):.     
-000098c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000098d0: 6f72 2069 2c20 6669 6c65 2069 6e20 656e  or i, file in en
-000098e0: 756d 6572 6174 6528 666f 6c64 6572 2e69  umerate(folder.i
-000098f0: 7465 7264 6972 2829 293a 0a20 2020 2020  terdir()):.     
-00009900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009910: 2020 2069 6620 6a20 3d3d 303a 0a20 2020     if j ==0:.   
-00009920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009930: 2020 2020 2020 2020 2064 6f79 4c69 7374           doyList
-00009940: 2e61 7070 656e 6428 7374 7228 7965 6172  .append(str(year
-00009950: 2920 2b20 2720 2720 2b20 7374 7228 6669  ) + ' ' + str(fi
-00009960: 6c65 2e6e 616d 655b 2d33 3a5d 2929 0a20  le.name[-3:])). 
-00009970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009980: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00009990: 2864 6174 6574 696d 652e 6461 7465 7469  (datetime.dateti
-000099a0: 6d65 2e73 7472 7074 696d 6528 646f 794c  me.strptime(doyL
-000099b0: 6973 745b 695d 2c20 2725 5920 256a 2729  ist[i], '%Y %j')
-000099c0: 2e73 7472 6674 696d 6528 2725 6220 2564  .strftime('%b %d
-000099d0: 2729 2c20 277c 2044 6179 206f 6620 7965  '), '| Day of ye
-000099e0: 6172 3a27 202c 6669 6c65 2e6e 616d 655b  ar:' ,file.name[
-000099f0: 2d33 3a5d 290a 2020 2020 2020 2020 2020  -3:]).          
-00009a00: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00009a10: 650a 2020 2020 2020 2020 2020 2020 0a20  e.            . 
-00009a20: 2020 2020 2020 2020 2020 2074 7261 6365             trace
-00009a30: 4c69 7374 203d 205b 5d0a 2020 2020 2020  List = [].      
-00009a40: 2020 2020 2020 666f 7220 692c 2066 2069        for i, f i
-00009a50: 6e20 656e 756d 6572 6174 6528 6669 6c65  n enumerate(file
-00009a60: 4c69 7374 293a 0a20 2020 2020 2020 2020  List):.         
-00009a70: 2020 2020 2020 2077 6974 6820 7761 726e         with warn
-00009a80: 696e 6773 2e63 6174 6368 5f77 6172 6e69  ings.catch_warni
-00009a90: 6e67 7328 293a 0a20 2020 2020 2020 2020  ngs():.         
-00009aa0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-00009ab0: 6e67 732e 6669 6c74 6572 7761 726e 696e  ngs.filterwarnin
-00009ac0: 6773 2861 6374 696f 6e3d 2769 676e 6f72  gs(action='ignor
-00009ad0: 6527 2c20 6d65 7373 6167 653d 275e 7265  e', message='^re
-00009ae0: 6164 4d53 4545 4442 7566 6665 7228 2927  adMSEEDBuffer()'
-00009af0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00009b00: 2020 2020 2020 7374 203d 206f 6273 7079        st = obspy
-00009b10: 2e72 6561 6428 7374 7228 6629 2c20 7374  .read(str(f), st
-00009b20: 6172 7474 696d 653d 5554 4344 6174 6554  arttime=UTCDateT
-00009b30: 696d 6528 7061 7261 6d73 5b27 7374 6172  ime(params['star
-00009b40: 7474 696d 6527 5d29 2c20 656e 6474 7469  ttime']), endtti
-00009b50: 6d65 3d55 5443 4461 7465 5469 6d65 2870  me=UTCDateTime(p
-00009b60: 6172 616d 735b 2765 6e64 7469 6d65 275d  arams['endtime']
-00009b70: 292c 206e 6561 7265 7374 3d54 7275 6529  ), nearest=True)
-00009b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009b90: 2020 2020 2074 7220 3d20 2873 745b 305d       tr = (st[0]
-00009ba0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00009bb0: 2020 2020 2020 2374 723d 206f 6273 7079        #tr= obspy
-00009bc0: 2e54 7261 6365 2874 722e 6461 7461 2c68  .Trace(tr.data,h
-00009bd0: 6561 6465 723d 6d65 7461 290a 2020 2020  eader=meta).    
-00009be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bf0: 7472 6163 654c 6973 742e 6170 7065 6e64  traceList.append
-00009c00: 2874 7229 0a20 2020 2020 2020 2020 2020  (tr).           
-00009c10: 2072 6177 4461 7461 494e 203d 206f 6273   rawDataIN = obs
-00009c20: 7079 2e53 7472 6561 6d28 7472 6163 654c  py.Stream(traceL
-00009c30: 6973 7429 0a20 2020 2020 2020 2020 2020  ist).           
-00009c40: 2072 6177 4461 7461 494e 2e61 7474 6163   rawDataIN.attac
-00009c50: 685f 7265 7370 6f6e 7365 2869 6e76 290a  h_response(inv).
-00009c60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00009c70: 2020 2020 2020 2020 2020 7261 7744 6174            rawDat
-00009c80: 6149 4e20 3d20 6f62 7370 792e 7265 6164  aIN = obspy.read
-00009c90: 2873 7472 2864 6174 6170 6174 6829 2c20  (str(datapath), 
-00009ca0: 7374 6172 7474 696d 653d 5554 4344 6174  starttime=UTCDat
-00009cb0: 6554 696d 6528 7061 7261 6d73 5b27 7374  eTime(params['st
-00009cc0: 6172 7474 696d 6527 5d29 2c20 656e 6474  arttime']), endt
-00009cd0: 7469 6d65 3d55 5443 4461 7465 5469 6d65  time=UTCDateTime
-00009ce0: 2870 6172 616d 735b 2765 6e64 7469 6d65  (params['endtime
-00009cf0: 275d 292c 206e 6561 7265 7374 3d54 7275  ']), nearest=Tru
-00009d00: 6529 2020 2020 2020 200a 2020 2020 2020  e)       .      
-00009d10: 2020 2020 2020 7261 7744 6174 6149 4e2e        rawDataIN.
-00009d20: 6174 7461 6368 5f72 6573 706f 6e73 6528  attach_response(
-00009d30: 696e 7629 0a20 2020 2065 6c69 6620 736f  inv).    elif so
-00009d40: 7572 6365 3d3d 2764 6972 273a 2023 6669  urce=='dir': #fi
-00009d50: 6c65 7320 7769 7468 2033 2074 7261 6365  les with 3 trace
-00009d60: 732c 2062 7574 206d 6179 2062 6520 7365  s, but may be se
-00009d70: 7665 7261 6c20 696e 2061 2064 6972 6563  veral in a direc
-00009d80: 746f 7279 206f 7220 6f6e 6c79 2064 6972  tory or only dir
-00009d90: 6563 746f 7279 206e 616d 6520 7072 6f76  ectory name prov
-00009da0: 6964 6564 0a20 2020 2020 2020 206f 6273  ided.        obs
-00009db0: 7079 466f 726d 6174 7320 3d20 5b27 4148  pyFormats = ['AH
-00009dc0: 272c 2741 4c53 4550 5f50 5345 272c 2741  ','ALSEP_PSE','A
-00009dd0: 4c53 4550 5f57 5448 272c 2741 4c53 4550  LSEP_WTH','ALSEP
-00009de0: 5f57 544e 272c 2743 5353 272c 2744 4d58  _WTN','CSS','DMX
-00009df0: 272c 2747 4346 272c 2747 5345 3127 2c27  ','GCF','GSE1','
-00009e00: 4753 4532 272c 274b 494e 454d 4554 5249  GSE2','KINEMETRI
-00009e10: 4353 5f45 5654 272c 274d 5345 4544 272c  CS_EVT','MSEED',
-00009e20: 274e 4e53 415f 4b42 5f43 4f52 4527 2c27  'NNSA_KB_CORE','
-00009e30: 5044 4153 272c 2750 4943 4b4c 4527 2c27  PDAS','PICKLE','
-00009e40: 5127 2c27 5245 4654 454b 3133 3027 2c27  Q','REFTEK130','
-00009e50: 5247 3136 272c 2753 4143 272c 2753 4143  RG16','SAC','SAC
-00009e60: 5859 272c 2753 4547 3227 2c27 5345 4759  XY','SEG2','SEGY
-00009e70: 272c 2753 4549 5341 4e27 2c27 5348 5f41  ','SEISAN','SH_A
-00009e80: 5343 272c 2753 4c49 5354 272c 2753 5527  SC','SLIST','SU'
-00009e90: 2c27 5453 5041 4952 272c 2757 4156 272c  ,'TSPAIR','WAV',
-00009ea0: 2757 494e 272c 2759 275d 0a20 2020 2020  'WIN','Y'].     
-00009eb0: 2020 2066 6f72 2066 696c 6520 696e 2064     for file in d
-00009ec0: 6174 6170 6174 682e 6974 6572 6469 7228  atapath.iterdir(
-00009ed0: 293a 0a20 2020 2020 2020 2020 2020 2065  ):.            e
-00009ee0: 7874 203d 2066 696c 652e 7375 6666 6978  xt = file.suffix
-00009ef0: 5b31 3a5d 0a20 2020 2020 2020 2020 2020  [1:].           
-00009f00: 2072 6177 466f 726d 6174 203d 2046 616c   rawFormat = Fal
-00009f10: 7365 0a20 2020 2020 2020 2020 2020 2069  se.            i
-00009f20: 6620 6578 742e 6973 6e75 6d65 7269 6328  f ext.isnumeric(
-00009f30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00009f40: 2020 2069 6620 666c 6f61 7428 6578 7429     if float(ext)
-00009f50: 203e 3d20 3020 616e 6420 666c 6f61 7428   >= 0 and float(
-00009f60: 6578 7429 203c 2033 3637 3a0a 2020 2020  ext) < 367:.    
-00009f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f80: 7261 7746 6f72 6d61 743d 5472 7565 0a20  rawFormat=True. 
-00009f90: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00009fa0: 2020 2020 2020 2020 6966 2065 7874 2e75          if ext.u
-00009fb0: 7070 6572 2829 2069 6e20 6f62 7370 7946  pper() in obspyF
-00009fc0: 6f72 6d61 7473 206f 7220 7261 7746 6f72  ormats or rawFor
-00009fd0: 6d61 743a 0a20 2020 2020 2020 2020 2020  mat:.           
-00009fe0: 2020 2020 2066 696c 6573 696e 666f 6c64       filesinfold
-00009ff0: 6572 203d 2054 7275 650a 2020 2020 2020  er = True.      
-0000a000: 2020 2020 2020 2020 2020 666f 6c64 6572            folder
-0000a010: 5061 7468 4c69 7374 2e61 7070 656e 6428  PathList.append(
-0000a020: 6461 7461 7061 7468 290a 2020 2020 2020  datapath).      
-0000a030: 2020 2020 2020 2020 2020 6669 6c65 4c69            fileLi
-0000a040: 7374 2e61 7070 656e 6428 6669 6c65 2e6e  st.append(file.n
-0000a050: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-0000a060: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-0000a070: 2020 2020 2020 6669 6c65 7061 7468 7320        filepaths 
-0000a080: 3d20 5b5d 0a20 2020 2020 2020 2072 6177  = [].        raw
-0000a090: 4461 7461 494e 203d 206f 6273 7079 2e53  DataIN = obspy.S
-0000a0a0: 7472 6561 6d28 290a 2020 2020 2020 2020  tream().        
-0000a0b0: 666f 7220 692c 2066 2069 6e20 656e 756d  for i, f in enum
-0000a0c0: 6572 6174 6528 6669 6c65 4c69 7374 293a  erate(fileList):
-0000a0d0: 0a20 2020 2020 2020 2020 2020 2066 6f6c  .            fol
-0000a0e0: 6465 7250 6174 684c 6973 745b 695d 203d  derPathList[i] =
-0000a0f0: 2073 7472 2866 6f6c 6465 7250 6174 684c   str(folderPathL
-0000a100: 6973 745b 695d 292e 7265 706c 6163 6528  ist[i]).replace(
-0000a110: 275c 5c27 2c20 272f 2729 0a20 2020 2020  '\\', '/').     
-0000a120: 2020 2020 2020 2066 6f6c 6465 7250 6174         folderPat
-0000a130: 684c 6973 745b 695d 203d 2073 7472 2866  hList[i] = str(f
-0000a140: 6f6c 6465 7250 6174 684c 6973 745b 695d  olderPathList[i]
-0000a150: 292e 7265 706c 6163 6528 275c 5c27 5b30  ).replace('\\'[0
-0000a160: 5d2c 2027 2f27 290a 2020 2020 2020 2020  ], '/').        
-0000a170: 2020 2020 6669 6c65 7061 7468 732e 6170      filepaths.ap
-0000a180: 7065 6e64 2873 7472 2866 6f6c 6465 7250  pend(str(folderP
-0000a190: 6174 684c 6973 745b 695d 292b 272f 272b  athList[i])+'/'+
-0000a1a0: 6629 0a20 2020 2020 2020 2020 2020 2066  f).            f
-0000a1b0: 696c 6570 6174 6873 5b69 5d20 3d20 7061  ilepaths[i] = pa
-0000a1c0: 7468 6c69 622e 5061 7468 2866 696c 6570  thlib.Path(filep
-0000a1d0: 6174 6873 5b69 5d29 0a20 2020 2020 2020  aths[i]).       
-0000a1e0: 2020 2020 2063 7572 7244 6174 6120 3d20       currData = 
-0000a1f0: 6f62 7370 792e 7265 6164 2866 696c 6570  obspy.read(filep
-0000a200: 6174 6873 5b69 5d29 0a20 2020 2020 2020  aths[i]).       
-0000a210: 2020 2020 2023 7261 7744 6174 6149 4e2e       #rawDataIN.
-0000a220: 6170 7065 6e64 2863 7572 7244 6174 6129  append(currData)
-0000a230: 0a20 2020 2020 2020 2020 2020 2023 6966  .            #if
-0000a240: 2069 203d 3d20 303a 0a20 2020 2020 2020   i == 0:.       
-0000a250: 2020 2020 2023 2020 2020 7261 7744 6174       #    rawDat
-0000a260: 6149 4e20 3d20 6375 7272 4461 7461 2e63  aIN = currData.c
-0000a270: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-0000a280: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0000a290: 6375 7272 4461 7461 2c20 6f62 7370 792e  currData, obspy.
-0000a2a0: 636f 7265 2e73 7472 6561 6d2e 5374 7265  core.stream.Stre
-0000a2b0: 616d 293a 0a20 2020 2020 2020 2020 2020  am):.           
-0000a2c0: 2020 2020 2072 6177 4461 7461 494e 202b       rawDataIN +
-0000a2d0: 3d20 6375 7272 4461 7461 2e63 6f70 7928  = currData.copy(
-0000a2e0: 290a 2020 2020 2020 2020 2372 6177 4461  ).        #rawDa
-0000a2f0: 7461 494e 203d 206f 6273 7079 2e53 7472  taIN = obspy.Str
-0000a300: 6561 6d28 7261 7744 6174 6149 4e29 0a20  eam(rawDataIN). 
-0000a310: 2020 2020 2020 2072 6177 4461 7461 494e         rawDataIN
-0000a320: 2e61 7474 6163 685f 7265 7370 6f6e 7365  .attach_response
-0000a330: 2869 6e76 2920 200a 2020 2020 2020 2020  (inv)  .        
-0000a340: 6966 2074 7970 6528 7261 7744 6174 6149  if type(rawDataI
-0000a350: 4e29 2069 7320 6c69 7374 2061 6e64 206c  N) is list and l
-0000a360: 656e 2872 6177 4461 7461 494e 293d 3d31  en(rawDataIN)==1
-0000a370: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000a380: 7744 6174 6149 4e20 3d20 7261 7744 6174  wDataIN = rawDat
-0000a390: 6149 4e5b 305d 0a20 2020 2065 6c69 6620  aIN[0].    elif 
-0000a3a0: 736f 7572 6365 3d3d 2766 696c 6527 3a0a  source=='file':.
-0000a3b0: 2020 2020 2020 2020 7261 7744 6174 6149          rawDataI
-0000a3c0: 4e20 3d20 6f62 7370 792e 7265 6164 2873  N = obspy.read(s
-0000a3d0: 7472 2864 6174 6170 6174 6829 2c20 7374  tr(datapath), st
-0000a3e0: 6172 7474 696d 653d 5554 4344 6174 6554  arttime=UTCDateT
-0000a3f0: 696d 6528 7061 7261 6d73 5b27 7374 6172  ime(params['star
-0000a400: 7474 696d 6527 5d29 2c20 656e 6474 7469  ttime']), endtti
-0000a410: 6d65 3d55 5443 4461 7465 5469 6d65 2870  me=UTCDateTime(p
-0000a420: 6172 616d 735b 2765 6e64 7469 6d65 275d  arams['endtime']
-0000a430: 292c 206e 6561 7265 7374 3d54 7275 6529  ), nearest=True)
-0000a440: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0000a450: 7261 7744 6174 6149 4e2e 6174 7461 6368  rawDataIN.attach
-0000a460: 5f72 6573 706f 6e73 6528 696e 7629 0a20  _response(inv). 
-0000a470: 2020 2065 6c69 6620 7479 7065 2873 6f75     elif type(sou
-0000a480: 7263 6529 2069 7320 6c69 7374 206f 7220  rce) is list or 
-0000a490: 7479 7065 2864 6174 6170 6174 6829 2069  type(datapath) i
-0000a4a0: 7320 6c69 7374 3a0a 2020 2020 2020 2020  s list:.        
-0000a4b0: 7061 7373 2023 4576 656e 7475 616c 6c79  pass #Eventually
-0000a4c0: 2064 6f20 736f 6d65 7468 696e 670a 2020   do something.  
-0000a4d0: 2020 2020 2020 7261 7744 6174 6149 4e2e        rawDataIN.
-0000a4e0: 6174 7461 6368 5f72 6573 706f 6e73 6528  attach_response(
-0000a4f0: 696e 7629 0a20 2020 2072 6574 7572 6e20  inv).    return 
-0000a500: 7261 7744 6174 6149 4e0a 0a23 5472 696d  rawDataIN..#Trim
-0000a510: 2064 6174 6120 0a64 6566 2074 7269 6d5f   data .def trim_
-0000a520: 6461 7461 2873 7472 6561 6d2c 2070 6172  data(stream, par
-0000a530: 616d 732c 2065 7870 6f72 745f 6469 723d  ams, export_dir=
-0000a540: 4e6f 6e65 2c20 6578 706f 7274 5f66 6f72  None, export_for
-0000a550: 6d61 743d 4e6f 6e65 2c20 2a2a 6b77 6172  mat=None, **kwar
-0000a560: 6773 293a 0a20 2020 2022 2222 4675 6e63  gs):.    """Func
-0000a570: 7469 6f6e 2074 6f20 7472 696d 2064 6174  tion to trim dat
-0000a580: 6120 746f 2073 7461 7274 2061 6e64 2065  a to start and e
-0000a590: 6e64 2074 696d 650a 0a20 2020 2020 2020  nd time..       
-0000a5a0: 2054 7269 6d20 6461 7461 2074 6f20 7374   Trim data to st
-0000a5b0: 6172 7420 616e 6420 656e 6420 7469 6d65  art and end time
-0000a5c0: 7320 736f 2074 6861 7420 7374 7265 616d  s so that stream
-0000a5d0: 2062 6569 6e67 2061 6e61 6c79 7a65 6420   being analyzed 
-0000a5e0: 6f6e 6c79 2063 6f6e 7461 696e 7320 7761  only contains wa
-0000a5f0: 6e74 6564 2064 6174 612e 0a20 2020 2020  nted data..     
-0000a600: 2020 2043 616e 2061 6c73 6f20 6578 706f     Can also expo
-0000a610: 7274 2064 6174 6120 746f 2073 7065 6369  rt data to speci
-0000a620: 6669 6564 2064 6972 6563 746f 7279 2075  fied directory u
-0000a630: 7369 6e67 2061 2073 7065 6369 6669 6564  sing a specified
-0000a640: 2073 6974 6520 6e61 6d65 2061 6e64 2f6f   site name and/o
-0000a650: 7220 6578 706f 7274 5f66 6f72 6d61 740a  r export_format.
-0000a660: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-0000a670: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-0000a680: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2020  ------.         
-0000a690: 2020 2073 7472 6561 6d20 203a 206f 6273     stream  : obs
-0000a6a0: 7079 2e73 7472 6561 6d20 6f62 6a65 6374  py.stream object
-0000a6b0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-0000a6c0: 2020 204f 6273 7079 2073 7472 6561 6d20     Obspy stream 
-0000a6d0: 746f 2062 6520 7472 696d 6d65 640a 2020  to be trimmed.  
-0000a6e0: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-0000a6f0: 2020 3a20 6469 6374 0a20 2020 2020 2020    : dict.       
-0000a700: 2020 2020 2020 2020 2044 6963 7469 6f6e           Diction
-0000a710: 6172 7920 636f 6e74 6169 6e69 6e67 2069  ary containing i
-0000a720: 6e70 7574 2070 6172 616d 6574 6572 7320  nput parameters 
-0000a730: 666f 7220 7472 696d 6d69 6e67 0a20 2020  for trimming.   
-0000a740: 2020 2020 2020 2020 2065 7870 6f72 745f           export_
-0000a750: 6469 723a 2073 7472 206f 7220 7061 7468  dir: str or path
-0000a760: 6c69 6220 6f62 6a20 2020 0a20 2020 2020  lib obj   .     
-0000a770: 2020 2020 2020 2020 2020 204f 7574 7075             Outpu
-0000a780: 7420 6669 6c65 7061 7468 2074 6f20 6578  t filepath to ex
-0000a790: 706f 7274 2074 7269 6d6d 6564 2064 6174  port trimmed dat
-0000a7a0: 6120 746f 2e20 4966 206e 6f74 2073 7065  a to. If not spe
-0000a7b0: 6369 6669 6564 2c20 646f 6573 206e 6f74  cified, does not
-0000a7c0: 2065 7870 6f72 742e 200a 2020 2020 2020   export. .      
-0000a7d0: 2020 2020 2020 6578 706f 7274 5f66 6f72        export_for
-0000a7e0: 6d61 7420 203a 2073 7472 206f 7220 4e6f  mat  : str or No
-0000a7f0: 6e65 2c20 6465 6661 756c 743d 4e6f 6e65  ne, default=None
-0000a800: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-0000a810: 2020 2049 6620 4e6f 6e65 2c20 616e 6420     If None, and 
-0000a820: 6578 706f 7274 5f64 6972 2069 7320 7370  export_dir is sp
-0000a830: 6563 6966 6965 642c 2066 6f72 6d61 7420  ecified, format 
-0000a840: 6465 6661 756c 7473 2074 6f20 2e6d 7365  defaults to .mse
-0000a850: 6564 2e20 4f74 6865 7277 6973 652c 2065  ed. Otherwise, e
-0000a860: 7870 6f72 7473 2074 7269 6d6d 6564 2073  xports trimmed s
-0000a870: 7472 6561 6d20 7573 696e 6720 6f62 7370  tream using obsp
-0000a880: 792e 636f 7265 2e73 7472 6561 6d2e 5374  y.core.stream.St
-0000a890: 7265 616d 2e77 7269 7465 2829 206d 6574  ream.write() met
-0000a8a0: 686f 642c 2077 6974 6820 6578 706f 7274  hod, with export
-0000a8b0: 5f66 6f72 6d61 7420 6265 696e 6720 7061  _format being pa
-0000a8c0: 7373 6564 2074 6f20 7468 6520 666f 726d  ssed to the form
-0000a8d0: 6174 2061 7267 756d 656e 742e 200a 2020  at argument. .  
-0000a8e0: 2020 2020 2020 2020 2020 2020 2020 6874                ht
-0000a8f0: 7470 733a 2f2f 646f 6373 2e6f 6273 7079  tps://docs.obspy
-0000a900: 2e6f 7267 2f70 6163 6b61 6765 732f 6175  .org/packages/au
-0000a910: 746f 6765 6e2f 6f62 7370 792e 636f 7265  togen/obspy.core
-0000a920: 2e73 7472 6561 6d2e 5374 7265 616d 2e77  .stream.Stream.w
-0000a930: 7269 7465 2e68 746d 6c23 6f62 7370 792e  rite.html#obspy.
-0000a940: 636f 7265 2e73 7472 6561 6d2e 5374 7265  core.stream.Stre
-0000a950: 616d 2e77 7269 7465 0a20 2020 2020 2020  am.write.       
-0000a960: 2020 2020 202a 2a6b 7761 7267 730a 2020       **kwargs.  
-0000a970: 2020 2020 2020 2020 2020 2020 2020 4b65                Ke
-0000a980: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
-0000a990: 7061 7373 6564 2064 6972 6563 746c 7920  passed directly 
-0000a9a0: 746f 206f 6273 7079 2e63 6f72 652e 7374  to obspy.core.st
-0000a9b0: 7265 616d 2e53 7472 6561 6d2e 7472 696d  ream.Stream.trim
-0000a9c0: 2829 206d 6574 686f 642e 2073 7461 7274  () method. start
-0000a9d0: 7469 6d65 2061 6e64 2065 6e64 7469 6d65  time and endtime
-0000a9e0: 2070 6172 616d 6574 6572 7320 6172 6520   parameters are 
-0000a9f0: 616c 7265 6164 7920 7072 6f76 6964 6564  already provided
-0000aa00: 2074 6872 6f75 6768 2074 6865 2070 6172   through the par
-0000aa10: 616d 7320 7061 7261 6d65 7465 722c 2073  ams parameter, s
-0000aa20: 6f20 7368 6f75 6c64 206e 6f74 2062 6520  o should not be 
-0000aa30: 7061 7373 6564 2061 7320 6b77 6172 6773  passed as kwargs
-0000aa40: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000aa50: 2020 0a20 2020 2020 2020 2052 6574 7572    .        Retur
-0000aa60: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-0000aa70: 2d2d 0a20 2020 2020 2020 2020 2020 2073  --.            s
-0000aa80: 745f 7472 696d 6d65 6420 203a 206f 6273  t_trimmed  : obs
-0000aa90: 7079 2e73 7472 6561 6d20 6f62 6a65 6374  py.stream object
-0000aaa0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0000aab0: 2020 4f62 7073 7920 5374 7265 616d 2074    Obpsy Stream t
-0000aac0: 7269 6d6d 6564 2074 6f20 7374 6172 7420  rimmed to start 
-0000aad0: 616e 6420 656e 6420 7469 6d65 730a 2020  and end times.  
-0000aae0: 2020 2222 220a 2020 2020 7374 6172 7420    """.    start 
-0000aaf0: 3d20 7061 7261 6d73 5b27 7374 6172 7474  = params['startt
-0000ab00: 696d 6527 5d0a 2020 2020 656e 6420 3d20  ime'].    end = 
-0000ab10: 7061 7261 6d73 5b27 656e 6474 696d 6527  params['endtime'
-0000ab20: 5d0a 2020 2020 7369 7465 203d 2070 6172  ].    site = par
-0000ab30: 616d 735b 2773 6974 6527 5d0a 0a20 2020  ams['site']..   
-0000ab40: 2073 745f 7472 696d 6d65 6420 3d20 7374   st_trimmed = st
-0000ab50: 7265 616d 2e63 6f70 7928 290a 0a20 2020  ream.copy()..   
-0000ab60: 2074 7269 6d53 7461 7274 203d 206f 6273   trimStart = obs
-0000ab70: 7079 2e55 5443 4461 7465 5469 6d65 2873  py.UTCDateTime(s
-0000ab80: 7461 7274 290a 2020 2020 7472 696d 456e  tart).    trimEn
-0000ab90: 6420 3d20 6f62 7370 792e 5554 4344 6174  d = obspy.UTCDat
-0000aba0: 6554 696d 6528 656e 6429 0a20 2020 2066  eTime(end).    f
-0000abb0: 6f72 2074 7220 696e 2073 745f 7472 696d  or tr in st_trim
-0000abc0: 6d65 643a 0a20 2020 2020 2020 2069 6620  med:.        if 
-0000abd0: 7472 696d 5374 6172 7420 3e20 7472 2e73  trimStart > tr.s
-0000abe0: 7461 7473 2e65 6e64 7469 6d65 206f 7220  tats.endtime or 
-0000abf0: 7472 696d 456e 6420 3c20 7472 2e73 7461  trimEnd < tr.sta
-0000ac00: 7473 2e73 7461 7274 7469 6d65 3a0a 2020  ts.starttime:.  
-0000ac10: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
-0000ac20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000ac30: 2020 2020 2020 2020 2073 745f 7472 696d           st_trim
-0000ac40: 6d65 642e 7472 696d 2873 7461 7274 7469  med.trim(startti
-0000ac50: 6d65 3d74 7269 6d53 7461 7274 2c20 656e  me=trimStart, en
-0000ac60: 6474 696d 653d 7472 696d 456e 642c 202a  dtime=trimEnd, *
-0000ac70: 2a6b 7761 7267 7329 0a20 2020 2073 745f  *kwargs).    st_
-0000ac80: 7472 696d 6d65 642e 6d65 7267 6528 6d65  trimmed.merge(me
-0000ac90: 7468 6f64 3d31 290a 0a20 2020 2023 466f  thod=1)..    #Fo
-0000aca0: 726d 6174 2065 7870 6f72 7420 6669 6c65  rmat export file
-0000acb0: 7061 7468 2c20 6966 2065 7870 6f72 7469  path, if exporti
-0000acc0: 6e67 0a20 2020 2069 6620 6578 706f 7274  ng.    if export
-0000acd0: 5f66 6f72 6d61 7420 6973 206e 6f74 204e  _format is not N
-0000ace0: 6f6e 6520 616e 6420 7369 7465 2069 7320  one and site is 
-0000acf0: 6e6f 7420 4e6f 6e65 2061 6e64 2065 7870  not None and exp
-0000ad00: 6f72 745f 6469 7220 6973 206e 6f74 204e  ort_dir is not N
-0000ad10: 6f6e 653a 0a20 2020 2020 2020 2069 6620  one:.        if 
-0000ad20: 7369 7465 2069 7320 4e6f 6e65 3a0a 2020  site is None:.  
-0000ad30: 2020 2020 2020 2020 2020 7369 7465 3d27            site='
-0000ad40: 270a 2020 2020 2020 2020 656c 7365 3a0a  '.        else:.
-0000ad50: 2020 2020 2020 2020 2020 2020 7369 7465              site
-0000ad60: 203d 2073 6974 652b 275f 270a 2020 2020   = site+'_'.    
-0000ad70: 2020 2020 6578 706f 7274 5f66 6f72 6d61      export_forma
-0000ad80: 7420 3d20 272e 272b 6578 706f 7274 5f66  t = '.'+export_f
-0000ad90: 6f72 6d61 740a 2020 2020 2020 2020 6e65  ormat.        ne
-0000ada0: 7420 3d20 7374 5f74 7269 6d6d 6564 5b30  t = st_trimmed[0
-0000adb0: 5d2e 7374 6174 732e 6e65 7477 6f72 6b0a  ].stats.network.
-0000adc0: 2020 2020 2020 2020 7374 6120 3d20 7374          sta = st
-0000add0: 5f74 7269 6d6d 6564 5b30 5d2e 7374 6174  _trimmed[0].stat
-0000ade0: 732e 7374 6174 696f 6e0a 2020 2020 2020  s.station.      
-0000adf0: 2020 6c6f 6320 3d20 7374 5f74 7269 6d6d    loc = st_trimm
-0000ae00: 6564 5b30 5d2e 7374 6174 732e 6c6f 6361  ed[0].stats.loca
-0000ae10: 7469 6f6e 0a20 2020 2020 2020 2079 7220  tion.        yr 
-0000ae20: 3d20 7374 7228 7374 5f74 7269 6d6d 6564  = str(st_trimmed
-0000ae30: 5b30 5d2e 7374 6174 732e 7374 6172 7474  [0].stats.startt
-0000ae40: 696d 652e 7965 6172 290a 2020 2020 2020  ime.year).      
-0000ae50: 2020 7374 7274 443d 7374 7228 7374 5f74    strtD=str(st_t
-0000ae60: 7269 6d6d 6564 5b30 5d2e 7374 6174 732e  rimmed[0].stats.
-0000ae70: 7374 6172 7474 696d 652e 6461 7465 290a  starttime.date).
-0000ae80: 2020 2020 2020 2020 7374 7274 543d 7374          strtT=st
-0000ae90: 7228 7374 5f74 7269 6d6d 6564 5b30 5d2e  r(st_trimmed[0].
-0000aea0: 7374 6174 732e 7374 6172 7474 696d 652e  stats.starttime.
-0000aeb0: 7469 6d65 295b 303a 325d 0a20 2020 2020  time)[0:2].     
-0000aec0: 2020 2073 7472 7454 3d73 7472 7454 2b73     strtT=strtT+s
-0000aed0: 7472 2873 745f 7472 696d 6d65 645b 305d  tr(st_trimmed[0]
-0000aee0: 2e73 7461 7473 2e73 7461 7274 7469 6d65  .stats.starttime
-0000aef0: 2e74 696d 6529 5b33 3a35 5d0a 2020 2020  .time)[3:5].    
-0000af00: 2020 2020 656e 6454 203d 2073 7472 2873      endT = str(s
-0000af10: 745f 7472 696d 6d65 645b 305d 2e73 7461  t_trimmed[0].sta
-0000af20: 7473 2e65 6e64 7469 6d65 2e74 696d 6529  ts.endtime.time)
-0000af30: 5b30 3a32 5d0a 2020 2020 2020 2020 656e  [0:2].        en
-0000af40: 6454 203d 2065 6e64 542b 7374 7228 7374  dT = endT+str(st
-0000af50: 5f74 7269 6d6d 6564 5b30 5d2e 7374 6174  _trimmed[0].stat
-0000af60: 732e 656e 6474 696d 652e 7469 6d65 295b  s.endtime.time)[
-0000af70: 333a 355d 0a20 2020 2020 2020 2064 6f79  3:5].        doy
-0000af80: 203d 2073 7472 2873 745f 7472 696d 6d65   = str(st_trimme
-0000af90: 645b 305d 2e73 7461 7473 2e73 7461 7274  d[0].stats.start
-0000afa0: 7469 6d65 2e75 7463 7469 6d65 7475 706c  time.utctimetupl
-0000afb0: 6528 292e 746d 5f79 6461 7929 2e7a 6669  e().tm_yday).zfi
-0000afc0: 6c6c 2833 290a 0a20 2020 2020 2020 2065  ll(3)..        e
-0000afd0: 7870 6f72 745f 6469 7220 3d20 6368 6563  xport_dir = chec
-0000afe0: 6b69 6670 6174 6828 6578 706f 7274 5f64  kifpath(export_d
-0000aff0: 6972 290a 2020 2020 2020 2020 6578 706f  ir).        expo
-0000b000: 7274 5f64 6972 203d 2073 7472 2865 7870  rt_dir = str(exp
-0000b010: 6f72 745f 6469 7229 0a20 2020 2020 2020  ort_dir).       
-0000b020: 2065 7870 6f72 745f 6469 7220 3d20 6578   export_dir = ex
-0000b030: 706f 7274 5f64 6972 2e72 6570 6c61 6365  port_dir.replace
-0000b040: 2827 5c5c 272c 2027 2f27 290a 2020 2020  ('\\', '/').    
-0000b050: 2020 2020 6578 706f 7274 5f64 6972 203d      export_dir =
-0000b060: 2065 7870 6f72 745f 6469 722e 7265 706c   export_dir.repl
-0000b070: 6163 6528 275c 5c27 5b30 5d2c 2027 2f27  ace('\\'[0], '/'
-0000b080: 290a 0a20 2020 2020 2020 2069 6620 7479  )..        if ty
-0000b090: 7065 2865 7870 6f72 745f 666f 726d 6174  pe(export_format
-0000b0a0: 2920 6973 2073 7472 3a0a 2020 2020 2020  ) is str:.      
-0000b0b0: 2020 2020 2020 6669 6c65 6e61 6d65 203d        filename =
-0000b0c0: 2073 6974 652b 6e65 742b 272e 272b 7374   site+net+'.'+st
-0000b0d0: 612b 272e 272b 6c6f 632b 272e 272b 7972  a+'.'+loc+'.'+yr
-0000b0e0: 2b27 2e27 2b64 6f79 2b27 5f27 2b73 7472  +'.'+doy+'_'+str
-0000b0f0: 7444 2b27 5f27 2b73 7472 7454 2b27 2d27  tD+'_'+strtT+'-'
-0000b100: 2b65 6e64 542b 6578 706f 7274 5f66 6f72  +endT+export_for
-0000b110: 6d61 740a 2020 2020 2020 2020 656c 6966  mat.        elif
-0000b120: 2074 7970 6528 6578 706f 7274 5f66 6f72   type(export_for
-0000b130: 6d61 7429 2069 7320 626f 6f6c 3a0a 2020  mat) is bool:.  
-0000b140: 2020 2020 2020 2020 2020 6669 6c65 6e61            filena
-0000b150: 6d65 203d 2073 6974 652b 6e65 742b 272e  me = site+net+'.
-0000b160: 272b 7374 612b 272e 272b 6c6f 632b 272e  '+sta+'.'+loc+'.
-0000b170: 272b 7972 2b27 2e27 2b64 6f79 2b27 5f27  '+yr+'.'+doy+'_'
-0000b180: 2b73 7472 7444 2b27 5f27 2b73 7472 7454  +strtD+'_'+strtT
-0000b190: 2b27 2d27 2b65 6e64 542b 272e 6d73 6565  +'-'+endT+'.msee
-0000b1a0: 6427 0a0a 2020 2020 2020 2020 6966 2065  d'..        if e
-0000b1b0: 7870 6f72 745f 6469 725b 2d31 5d3d 3d27  xport_dir[-1]=='
-0000b1c0: 2f27 3a0a 2020 2020 2020 2020 2020 2020  /':.            
-0000b1d0: 6578 706f 7274 5f64 6972 3d65 7870 6f72  export_dir=expor
-0000b1e0: 745f 6469 725b 3a2d 315d 0a20 2020 2020  t_dir[:-1].     
-0000b1f0: 2020 200a 2020 2020 2020 2020 6578 706f     .        expo
-0000b200: 7274 4669 6c65 203d 2065 7870 6f72 745f  rtFile = export_
-0000b210: 6469 722b 272f 272b 6669 6c65 6e61 6d65  dir+'/'+filename
-0000b220: 0a0a 2020 2020 2020 2020 7374 5f74 7269  ..        st_tri
-0000b230: 6d6d 6564 2e77 7269 7465 2866 696c 656e  mmed.write(filen
-0000b240: 616d 653d 6578 706f 7274 4669 6c65 290a  ame=exportFile).
-0000b250: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000b260: 2020 7061 7373 0a0a 2020 2020 7265 7475    pass..    retu
-0000b270: 726e 2073 745f 7472 696d 6d65 640a 0a23  rn st_trimmed..#
-0000b280: 4675 6e63 7469 6f6e 2074 6f20 7365 6c65  Function to sele
-0000b290: 6374 2077 696e 646f 7773 2075 7369 6e67  ct windows using
-0000b2a0: 206f 7269 6769 6e61 6c20 7374 7265 616d   original stream
-0000b2b0: 2073 7065 6367 7261 6d2f 706c 6f74 730a   specgram/plots.
-0000b2c0: 6465 6620 7365 6c65 6374 5f77 696e 646f  def select_windo
-0000b2d0: 7773 2869 6e70 7574 293a 0a20 2020 2022  ws(input):.    "
-0000b2e0: 2222 4675 6e63 7469 6f6e 2074 6f20 6d61  ""Function to ma
-0000b2f0: 6e75 616c 6c79 2073 656c 6563 7420 7769  nually select wi
-0000b300: 6e64 6f77 7320 666f 7220 6578 636c 7573  ndows for exclus
-0000b310: 696f 6e20 6672 6f6d 2064 6174 612e 0a0a  ion from data...
-0000b320: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-0000b330: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-0000b340: 2020 696e 7075 7420 3a20 6469 6374 0a20    input : dict. 
-0000b350: 2020 2020 2020 2044 6963 7469 6f6e 6172         Dictionar
-0000b360: 7920 636f 6e74 6169 6e69 6e67 2061 6c6c  y containing all
-0000b370: 2074 6865 2068 7673 7220 696e 666f 726d   the hvsr inform
-0000b380: 6174 696f 6e2e 0a0a 2020 2020 5265 7475  ation...    Retu
-0000b390: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
-0000b3a0: 2020 2020 7857 696e 646f 7773 203a 206c      xWindows : l
-0000b3b0: 6973 740a 2020 2020 2020 2020 4c69 7374  ist.        List
-0000b3c0: 206f 6620 7477 6f2d 6974 656d 206c 6973   of two-item lis
-0000b3d0: 7473 2063 6f6e 7461 696e 696e 6720 7374  ts containing st
-0000b3e0: 6172 7420 616e 6420 656e 6420 7469 6d65  art and end time
-0000b3f0: 7320 6f66 2077 696e 646f 7773 2074 6f20  s of windows to 
-0000b400: 6265 2072 656d 6f76 6564 2e0a 2020 2020  be removed..    
-0000b410: 2222 220a 2020 2020 6672 6f6d 206d 6174  """.    from mat
-0000b420: 706c 6f74 6c69 622e 6261 636b 656e 645f  plotlib.backend_
-0000b430: 6261 7365 7320 696d 706f 7274 204d 6f75  bases import Mou
-0000b440: 7365 4275 7474 6f6e 0a20 2020 2069 6d70  seButton.    imp
-0000b450: 6f72 7420 6d61 7470 6c6f 746c 6962 2e70  ort matplotlib.p
-0000b460: 7970 6c6f 7420 6173 2070 6c74 0a20 2020  yplot as plt.   
-0000b470: 2069 6d70 6f72 7420 6d61 7470 6c6f 746c   import matplotl
-0000b480: 6962 0a20 2020 2069 6d70 6f72 7420 7469  ib.    import ti
-0000b490: 6d65 0a20 2020 2067 6c6f 6261 6c20 6669  me.    global fi
-0000b4a0: 670a 2020 2020 676c 6f62 616c 2061 780a  g.    global ax.
-0000b4b0: 0a20 2020 2069 6620 7479 7065 2869 6e70  .    if type(inp
-0000b4c0: 7574 2920 6973 2064 6963 743a 0a20 2020  ut) is dict:.   
-0000b4d0: 2020 2020 2069 6620 2768 7673 725f 6375       if 'hvsr_cu
-0000b4e0: 7276 6527 2069 6e20 696e 7075 742e 6b65  rve' in input.ke
-0000b4f0: 7973 2829 3a0a 2020 2020 2020 2020 2020  ys():.          
-0000b500: 2020 6669 672c 2061 7820 3d20 6876 706c    fig, ax = hvpl
-0000b510: 6f74 2868 7673 725f 6469 6374 3d69 6e70  ot(hvsr_dict=inp
-0000b520: 7574 2c20 6b69 6e64 3d27 7370 6563 272c  ut, kind='spec',
-0000b530: 2072 6574 7572 6e66 6967 3d54 7275 652c   returnfig=True,
-0000b540: 2063 6d61 703d 2774 7572 626f 2729 0a20   cmap='turbo'). 
-0000b550: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000b560: 2020 2020 2020 2020 2070 6172 616d 7320           params 
-0000b570: 3d20 696e 7075 742e 636f 7079 2829 0a20  = input.copy(). 
-0000b580: 2020 2020 2020 2020 2020 2069 6e70 7574             input
-0000b590: 203d 2069 6e70 7574 5b27 7374 7265 616d   = input['stream
-0000b5a0: 275d 0a20 2020 200a 2020 2020 6966 2069  '].    .    if i
-0000b5b0: 7369 6e73 7461 6e63 6528 696e 7075 742c  sinstance(input,
-0000b5c0: 206f 6273 7079 2e63 6f72 652e 7374 7265   obspy.core.stre
-0000b5d0: 616d 2e53 7472 6561 6d29 3a0a 2020 2020  am.Stream):.    
-0000b5e0: 2020 2020 6669 672c 2061 7820 3d20 706c      fig, ax = pl
-0000b5f0: 6f74 5f73 7065 6367 7261 6d5f 7374 7265  ot_specgram_stre
-0000b600: 616d 2869 6e70 7574 2c20 636f 6d70 6f6e  am(input, compon
-0000b610: 656e 743d 5b27 5a27 5d29 0a20 2020 2065  ent=['Z']).    e
-0000b620: 6c69 6620 6973 696e 7374 616e 6365 2869  lif isinstance(i
-0000b630: 6e70 7574 2c20 6f62 7370 792e 636f 7265  nput, obspy.core
-0000b640: 2e74 7261 6365 2e54 7261 6365 293a 0a20  .trace.Trace):. 
-0000b650: 2020 2020 2020 2066 6967 2c20 6178 203d         fig, ax =
-0000b660: 2070 6c6f 745f 7370 6563 6772 616d 5f73   plot_specgram_s
-0000b670: 7472 6561 6d28 696e 7075 7429 0a0a 2020  tream(input)..  
-0000b680: 2020 676c 6f62 616c 206c 696e 6541 7274    global lineArt
-0000b690: 6973 740a 2020 2020 676c 6f62 616c 2077  ist.    global w
-0000b6a0: 696e 4172 7469 7374 0a20 2020 2067 6c6f  inArtist.    glo
-0000b6b0: 6261 6c20 7769 6e64 6f77 4472 6177 6e0a  bal windowDrawn.
-0000b6c0: 2020 2020 676c 6f62 616c 2070 6174 684c      global pathL
-0000b6d0: 6973 740a 2020 2020 676c 6f62 616c 2078  ist.    global x
-0000b6e0: 5769 6e64 6f77 730a 2020 2020 676c 6f62  Windows.    glob
-0000b6f0: 616c 2063 6c69 636b 4e6f 0a20 2020 2067  al clickNo.    g
-0000b700: 6c6f 6261 6c20 7830 0a20 2020 2078 303d  lobal x0.    x0=
-0000b710: 300a 2020 2020 636c 6963 6b4e 6f20 3d20  0.    clickNo = 
-0000b720: 300a 2020 2020 7857 696e 646f 7773 203d  0.    xWindows =
-0000b730: 205b 5d0a 2020 2020 7061 7468 4c69 7374   [].    pathList
-0000b740: 203d 205b 5d0a 2020 2020 7769 6e64 6f77   = [].    window
-0000b750: 4472 6177 6e20 3d20 5b5d 0a20 2020 2077  Drawn = [].    w
-0000b760: 696e 4172 7469 7374 203d 205b 5d0a 2020  inArtist = [].  
-0000b770: 2020 6c69 6e65 4172 7469 7374 203d 205b    lineArtist = [
-0000b780: 5d0a 0a20 2020 2067 6c6f 6261 6c20 6669  ]..    global fi
-0000b790: 675f 636c 6f73 6564 0a20 2020 2066 6967  g_closed.    fig
-0000b7a0: 5f63 6c6f 7365 6420 3d20 4661 6c73 650a  _closed = False.
-0000b7b0: 2020 2020 7768 696c 6520 6669 675f 636c      while fig_cl
-0000b7c0: 6f73 6564 2069 7320 4661 6c73 653a 0a20  osed is False:. 
-0000b7d0: 2020 2020 2020 2066 6967 2e63 616e 7661         fig.canva
-0000b7e0: 732e 6d70 6c5f 636f 6e6e 6563 7428 2762  s.mpl_connect('b
-0000b7f0: 7574 746f 6e5f 7072 6573 735f 6576 656e  utton_press_even
-0000b800: 7427 2c20 5f5f 6f6e 5f63 6c69 636b 2923  t', __on_click)#
-0000b810: 2863 6c69 636b 4e6f 2c20 7857 696e 646f  (clickNo, xWindo
-0000b820: 7773 2c20 7061 7468 4c69 7374 2c20 7769  ws, pathList, wi
-0000b830: 6e64 6f77 4472 6177 6e2c 2077 696e 4172  ndowDrawn, winAr
-0000b840: 7469 7374 2c20 6c69 6e65 4172 7469 7374  tist, lineArtist
-0000b850: 2c20 7830 2c20 6669 672c 2061 7829 290a  , x0, fig, ax)).
-0000b860: 2020 2020 2020 2020 6669 672e 6361 6e76          fig.canv
-0000b870: 6173 2e6d 706c 5f63 6f6e 6e65 6374 2827  as.mpl_connect('
-0000b880: 636c 6f73 655f 6576 656e 7427 2c20 5f5f  close_event', __
-0000b890: 6f6e 5f66 6967 5f63 6c6f 7365 2923 2863  on_fig_close)#(c
-0000b8a0: 6c69 636b 4e6f 2c20 7857 696e 646f 7773  lickNo, xWindows
-0000b8b0: 2c20 7061 7468 4c69 7374 2c20 7769 6e64  , pathList, wind
-0000b8c0: 6f77 4472 6177 6e2c 2077 696e 4172 7469  owDrawn, winArti
-0000b8d0: 7374 2c20 6c69 6e65 4172 7469 7374 2c20  st, lineArtist, 
-0000b8e0: 7830 2c20 6669 672c 2061 7829 290a 2020  x0, fig, ax)).  
-0000b8f0: 2020 2020 2020 706c 742e 7061 7573 6528        plt.pause(
-0000b900: 3129 0a0a 2020 2020 7061 7261 6d73 5b27  1)..    params['
-0000b910: 7877 696e 646f 7773 5f6f 7574 275d 203d  xwindows_out'] =
-0000b920: 2078 5769 6e64 6f77 730a 2020 2020 7061   xWindows.    pa
-0000b930: 7261 6d73 5b27 6669 6727 5d20 3d20 6669  rams['fig'] = fi
-0000b940: 670a 2020 2020 7061 7261 6d73 5b27 6178  g.    params['ax
-0000b950: 275d 203d 2061 780a 2020 2020 7265 7475  '] = ax.    retu
-0000b960: 726e 2070 6172 616d 730a 0a23 5375 7070  rn params..#Supp
-0000b970: 6f72 7420 6675 6e63 7469 6f6e 2074 6f20  ort function to 
-0000b980: 6865 6c70 2073 656c 6563 745f 7769 6e64  help select_wind
-0000b990: 6f77 7320 7275 6e20 7072 6f70 6572 6c79  ows run properly
-0000b9a0: 0a64 6566 205f 5f6f 6e5f 6669 675f 636c  .def __on_fig_cl
-0000b9b0: 6f73 6528 6576 656e 7429 3a0a 2020 2020  ose(event):.    
-0000b9c0: 676c 6f62 616c 2066 6967 5f63 6c6f 7365  global fig_close
-0000b9d0: 640a 2020 2020 6669 675f 636c 6f73 6564  d.    fig_closed
-0000b9e0: 203d 2054 7275 650a 2020 2020 7265 7475   = True.    retu
-0000b9f0: 726e 0a0a 2346 756e 6374 696f 6e20 746f  rn..#Function to
-0000ba00: 2072 656d 6f76 6520 6e6f 6973 6520 7769   remove noise wi
-0000ba10: 6e64 6f77 7320 6672 6f6d 2064 6174 610a  ndows from data.
-0000ba20: 6465 6620 7265 6d6f 7665 5f6e 6f69 7365  def remove_noise
-0000ba30: 2869 6e70 7574 2c20 6b69 6e64 3d27 6175  (input, kind='au
-0000ba40: 746f 272c 2073 6174 5f70 6572 6365 6e74  to', sat_percent
-0000ba50: 3d30 2e39 3935 2c20 6e6f 6973 655f 7065  =0.995, noise_pe
-0000ba60: 7263 656e 743d 302e 3830 2c20 7374 613d  rcent=0.80, sta=
-0000ba70: 322c 206c 7461 3d33 302c 2073 7461 6c74  2, lta=30, stalt
-0000ba80: 615f 7468 7265 7368 3d5b 302e 352c 355d  a_thresh=[0.5,5]
-0000ba90: 2c20 7368 6f77 5f70 6c6f 743d 4661 6c73  , show_plot=Fals
-0000baa0: 652c 2077 6172 6d75 705f 7469 6d65 3d30  e, warmup_time=0
-0000bab0: 2c20 636f 6f6c 646f 776e 5f74 696d 653d  , cooldown_time=
-0000bac0: 302c 206d 696e 5f77 696e 5f73 697a 653d  0, min_win_size=
-0000bad0: 3129 3a0a 2020 2020 2222 2246 756e 6374  1):.    """Funct
-0000bae0: 696f 6e20 746f 2072 656d 6f76 6520 6e6f  ion to remove no
-0000baf0: 6973 7920 7769 6e64 6f77 7320 6672 6f6d  isy windows from
-0000bb00: 2064 6174 612c 2075 7369 6e67 2076 6172   data, using var
-0000bb10: 696f 7573 206d 6574 686f 6473 2e0a 2020  ious methods..  
-0000bb20: 2020 0a20 2020 204d 6574 686f 6473 2069    .    Methods i
-0000bb30: 6e63 6c75 6465 200a 2020 2020 2d20 4d61  nclude .    - Ma
-0000bb40: 6e75 616c 2077 696e 646f 7720 7365 6c65  nual window sele
-0000bb50: 6374 696f 6e20 2862 7920 636c 6963 6b69  ction (by clicki
-0000bb60: 6e67 206f 6e20 6120 6368 6172 7420 7769  ng on a chart wi
-0000bb70: 7468 2073 7065 6374 726f 6772 616d 2061  th spectrogram a
-0000bb80: 6e64 2073 7472 6561 6d20 6461 7461 292c  nd stream data),
-0000bb90: 200a 2020 2020 2d20 4175 746f 2077 696e   .    - Auto win
-0000bba0: 646f 7720 7365 6c65 6374 696f 6e2c 2077  dow selection, w
-0000bbb0: 6869 6368 2064 6f65 7320 7468 6520 666f  hich does the fo
-0000bbc0: 6c6c 6f77 696e 6720 7477 6f20 696e 2073  llowing two in s
-0000bbd0: 6571 7565 6e63 6520 2874 6865 7365 2063  equence (these c
-0000bbe0: 616e 2061 6c73 6f20 6265 2064 6f6e 6520  an also be done 
-0000bbf0: 696e 6465 7065 6e74 6c79 293a 0a20 2020  indepently):.   
-0000bc00: 2020 2020 202d 2041 2073 7461 2f6c 7461       - A sta/lta
-0000bc10: 2022 616e 7469 7472 6967 6765 7222 206d   "antitrigger" m
-0000bc20: 6574 686f 6420 2875 7369 6e67 2073 7461  ethod (using sta
-0000bc30: 6c74 6120 7661 6c75 6573 2074 6f20 6175  lta values to au
-0000bc40: 746f 6d61 7469 6361 6c6c 7920 7265 6d6f  tomatically remo
-0000bc50: 7665 2074 7269 6767 6572 6564 2077 696e  ve triggered win
-0000bc60: 646f 7773 2077 6865 7265 2074 6865 7265  dows where there
-0000bc70: 2061 7070 6561 7273 2074 6f20 6265 2074   appears to be t
-0000bc80: 6f6f 206d 7563 6820 6e6f 6973 6529 0a20  oo much noise). 
-0000bc90: 2020 2020 2020 202d 2041 206e 6f69 7365         - A noise
-0000bca0: 2074 6872 6573 686f 6c64 206d 6574 686f   threshold metho
-0000bcb0: 642c 2074 6861 7420 6375 7473 206f 6666  d, that cuts off
-0000bcc0: 2061 6c6c 2074 696d 6573 2077 6865 7265   all times where
-0000bcd0: 2074 6865 206e 6f69 7365 2074 6872 6573   the noise thres
-0000bce0: 686f 6c64 2065 7175 616c 7320 6d6f 7265  hold equals more
-0000bcf0: 2074 6861 6e20 2862 7920 6465 6661 756c   than (by defaul
-0000bd00: 7429 2039 392e 3525 206f 6620 7468 6520  t) 99.5% of the 
-0000bd10: 6869 6768 6573 7420 616d 706c 6974 7564  highest amplitud
-0000bd20: 6520 6e6f 6973 6520 7361 6d70 6c65 2e0a  e noise sample..
-0000bd30: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-0000bd40: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-0000bd50: 2020 2069 6e70 7574 203a 2064 6963 742c     input : dict,
-0000bd60: 206f 6273 7079 2e53 7472 6561 6d2c 206f   obspy.Stream, o
-0000bd70: 7220 6f62 7370 792e 5472 6163 650a 2020  r obspy.Trace.  
-0000bd80: 2020 2020 2020 4469 6374 696f 6e61 7279        Dictionary
-0000bd90: 2063 6f6e 7461 696e 696e 6720 616c 6c20   containing all 
-0000bda0: 7468 6520 6461 7461 2061 6e64 2070 6172  the data and par
-0000bdb0: 616d 6574 6572 7320 666f 7220 7468 6520  ameters for the 
-0000bdc0: 4856 5352 2061 6e61 6c79 7369 730a 2020  HVSR analysis.  
-0000bdd0: 2020 6b69 6e64 203a 2073 7472 2c20 7b27    kind : str, {'
-0000bde0: 6175 746f 272c 2027 6d61 6e75 616c 272c  auto', 'manual',
-0000bdf0: 2027 7374 616c 7461 272f 2761 6e74 6974   'stalta'/'antit
-0000be00: 7269 6767 6572 272c 2027 6e6f 6973 6520  rigger', 'noise 
-0000be10: 7468 7265 7368 6f6c 6427 2c20 2777 6172  threshold', 'war
-0000be20: 6d75 7027 2f27 6275 6666 6572 277d 0a20  mup'/'buffer'}. 
-0000be30: 2020 2020 2020 2054 6865 2064 6966 6665         The diffe
-0000be40: 7265 6e74 206d 6574 686f 6473 2066 6f72  rent methods for
-0000be50: 2072 656d 6f76 696e 6720 6e6f 6973 6520   removing noise 
-0000be60: 6672 6f6d 2074 6865 2064 6174 6173 6574  from the dataset
-0000be70: 2e20 5365 6520 6465 7363 7269 7074 696f  . See descriptio
-0000be80: 6e73 2061 626f 7665 2066 6f72 2077 6861  ns above for wha
-0000be90: 7420 686f 7720 6561 6368 206d 6574 686f  t how each metho
-0000bea0: 6420 776f 726b 732e 2042 7920 6465 6661  d works. By defa
-0000beb0: 756c 7420 2761 7574 6f2e 270a 2020 2020  ult 'auto.'.    
-0000bec0: 6e6f 6973 655f 7065 7263 656e 7420 3a20  noise_percent : 
-0000bed0: 666c 6f61 742c 2064 6566 6175 6c74 3d30  float, default=0
-0000bee0: 2e39 3935 0a20 2020 2020 2020 2050 6572  .995.        Per
-0000bef0: 6365 6e74 6167 6520 2862 6574 7765 656e  centage (between
-0000bf00: 2030 2061 6e64 2031 292c 2074 6f20 7573   0 and 1), to us
-0000bf10: 6520 6173 2074 6865 2074 6872 6573 686f  e as the thresho
-0000bf20: 6c64 2061 7420 7768 6963 6820 746f 2072  ld at which to r
-0000bf30: 656d 6f76 6520 6461 7461 2e20 5468 6973  emove data. This
-0000bf40: 2069 7320 7573 6564 2069 6e20 7468 6520   is used in the 
-0000bf50: 6e6f 6973 6520 7468 7265 7368 6f6c 6420  noise threshold 
-0000bf60: 6d65 7468 6f64 2e20 4279 2064 6566 6175  method. By defau
-0000bf70: 6c74 2030 2e39 3935 2e20 0a20 2020 2020  lt 0.995. .     
-0000bf80: 2020 2049 6620 6120 7661 6c75 6520 6973     If a value is
-0000bf90: 2070 6173 7365 6420 7468 6174 2069 7320   passed that is 
-0000bfa0: 6772 6561 7465 7220 7468 616e 2031 2c20  greater than 1, 
-0000bfb0: 6974 2077 696c 6c20 6265 2064 6976 6964  it will be divid
-0000bfc0: 6564 2062 7920 3130 3020 746f 206f 6274  ed by 100 to obt
-0000bfd0: 6169 6e20 7468 6520 7065 7263 656e 7461  ain the percenta
-0000bfe0: 6765 2e0a 2020 2020 7374 6120 3a20 696e  ge..    sta : in
-0000bff0: 742c 206f 7074 696f 6e61 6c0a 2020 2020  t, optional.    
-0000c000: 2020 2020 5368 6f72 7420 7465 726d 2061      Short term a
-0000c010: 7665 7261 6765 2028 5354 4129 2077 696e  verage (STA) win
-0000c020: 646f 7720 2869 6e20 7365 636f 6e64 7329  dow (in seconds)
-0000c030: 2c20 6279 2064 6566 6175 6c74 2032 2e0a  , by default 2..
-0000c040: 2020 2020 6c74 6120 3a20 696e 742c 206f      lta : int, o
-0000c050: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-0000c060: 4c6f 6e67 2074 6572 6d20 6176 6572 6167  Long term averag
-0000c070: 6520 2853 5441 2920 7769 6e64 6f77 2028  e (STA) window (
-0000c080: 696e 2073 6563 6f6e 6473 292c 2062 7920  in seconds), by 
-0000c090: 6465 6661 756c 7420 322e 0a20 2020 2073  default 2..    s
-0000c0a0: 7461 6c74 615f 7468 7265 7368 203a 206c  talta_thresh : l
-0000c0b0: 6973 742c 2064 6566 6175 6c74 3d5b 302e  ist, default=[0.
-0000c0c0: 352c 355d 0a20 2020 2020 2020 2054 776f  5,5].        Two
-0000c0d0: 2d69 7465 6d20 6c69 7374 206f 7220 7475  -item list or tu
-0000c0e0: 706c 6520 7769 7468 2074 6865 2074 6872  ple with the thr
-0000c0f0: 6573 686f 6c64 7320 666f 7220 7468 6520  esholds for the 
-0000c100: 7374 616c 7461 2061 6e74 6974 7269 6767  stalta antitrigg
-0000c110: 6572 2e20 5468 6520 6669 7273 7420 7661  er. The first va
-0000c120: 6c75 6520 2869 6e64 6578 205b 305d 2920  lue (index [0]) 
-0000c130: 6973 2074 6865 206c 6f77 6572 2074 6872  is the lower thr
-0000c140: 6573 686f 6c64 2c20 7468 6520 7365 636f  eshold, the seco
-0000c150: 6e64 2076 616c 7565 2028 696e 6465 7820  nd value (index 
-0000c160: 5b31 5d20 6973 2074 6865 2075 7070 6572  [1] is the upper
-0000c170: 2074 6872 6573 686f 6c64 292c 2062 7920   threshold), by 
-0000c180: 6465 6661 756c 7420 5b30 2e35 2c35 5d0a  default [0.5,5].
-0000c190: 2020 2020 7368 6f77 5f70 6c6f 7420 3a20      show_plot : 
-0000c1a0: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
-0000c1b0: 6c73 650a 2020 2020 2020 2020 4966 2054  lse.        If T
-0000c1c0: 7275 652c 2077 696c 6c20 706c 6f74 2074  rue, will plot t
-0000c1d0: 6865 2074 7269 6767 6572 2061 6e64 2073  he trigger and s
-0000c1e0: 7461 6c74 6120 7661 6c75 6573 2028 6966  talta values (if
-0000c1f0: 2073 7461 6c74 6120 616e 7469 7472 6967   stalta antitrig
-0000c200: 6765 7220 6d65 7468 6f64 292c 206f 7220  ger method), or 
-0000c210: 7468 6520 6461 7461 2077 6974 6820 7468  the data with th
-0000c220: 6520 6e65 7720 7769 6e64 6f77 7320 7265  e new windows re
-0000c230: 6d6f 7665 6420 2869 6620 6e6f 6973 6520  moved (if noise 
-0000c240: 7468 7265 7368 6f6c 6429 2c20 6279 2064  threshold), by d
-0000c250: 6566 6175 6c74 2046 616c 7365 2e20 446f  efault False. Do
-0000c260: 6573 206e 6f74 2061 7070 6c79 2074 6f20  es not apply to 
-0000c270: 276d 616e 7561 6c27 206d 6574 686f 642e  'manual' method.
-0000c280: 0a20 2020 2077 6172 6d75 705f 7469 6d65  .    warmup_time
-0000c290: 203a 2069 6e74 2c20 6465 6661 756c 743d   : int, default=
-0000c2a0: 300a 2020 2020 2020 2020 5469 6d65 2069  0.        Time i
-0000c2b0: 6e20 7365 636f 6e64 7320 746f 2061 6c6c  n seconds to all
-0000c2c0: 6f77 2066 6f72 2077 6172 6d75 7020 6f66  ow for warmup of
-0000c2d0: 2074 6865 2069 6e73 7472 756d 656e 742e   the instrument.
-0000c2e0: 2054 6869 7320 7769 6c6c 2072 656e 6f76   This will renov
-0000c2f0: 6520 616e 7920 6461 7461 2062 6566 6f72  e any data befor
-0000c300: 6520 7468 6973 2074 696d 652c 2062 7920  e this time, by 
-0000c310: 6465 6661 756c 7420 302e 0a0a 2020 2020  default 0...    
-0000c320: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-0000c330: 2d2d 2d0a 2020 2020 6f75 7470 7574 203a  ---.    output :
-0000c340: 2064 6963 740a 2020 2020 2020 2020 4469   dict.        Di
-0000c350: 6374 696f 6e61 7279 2073 696d 696c 6172  ctionary similar
-0000c360: 2074 6f20 696e 7075 742c 2062 7574 2063   to input, but c
-0000c370: 6f6e 7461 696e 696e 6720 6d6f 6469 6669  ontaining modifi
-0000c380: 6564 2064 6174 6120 7769 7468 2027 6e6f  ed data with 'no
-0000c390: 6973 6527 2072 656d 6f76 6564 0a20 2020  ise' removed.   
-0000c3a0: 2022 2222 0a20 2020 200a 2020 2020 6d61   """.    .    ma
-0000c3b0: 6e75 616c 4c69 7374 203d 205b 276d 616e  nualList = ['man
-0000c3c0: 7561 6c27 2c20 276d 616e 272c 2027 6d27  ual', 'man', 'm'
-0000c3d0: 2c20 2777 696e 646f 7727 2c20 2777 696e  , 'window', 'win
-0000c3e0: 646f 7773 272c 2027 7727 5d0a 2020 2020  dows', 'w'].    
-0000c3f0: 6175 746f 4c69 7374 203d 205b 2761 7574  autoList = ['aut
-0000c400: 6f27 2c20 2761 7574 6f6d 6174 6963 272c  o', 'automatic',
-0000c410: 2027 616c 6c27 2c20 2761 275d 0a20 2020   'all', 'a'].   
-0000c420: 2061 6e74 6974 7269 6767 6572 203d 205b   antitrigger = [
-0000c430: 2773 7461 6c74 6127 2c20 2761 6e74 6927  'stalta', 'anti'
-0000c440: 2c20 2761 6e74 6974 7269 6767 6572 272c  , 'antitrigger',
-0000c450: 2027 7472 6967 6765 7227 2c20 2761 7427   'trigger', 'at'
-0000c460: 5d0a 2020 2020 7361 7475 7261 7469 6f6e  ].    saturation
-0000c470: 5468 7265 7368 203d 205b 2773 6174 7572  Thresh = ['satur
-0000c480: 6174 696f 6e20 7468 7265 7368 6f6c 6427  ation threshold'
-0000c490: 2c20 2773 6174 7572 6174 696f 6e27 2c20  , 'saturation', 
-0000c4a0: 2773 6174 272c 2027 7327 5d0a 2020 2020  'sat', 's'].    
-0000c4b0: 6e6f 6973 6554 6872 6573 6820 3d20 5b27  noiseThresh = ['
-0000c4c0: 6e6f 6973 6520 7468 7265 7368 6f6c 6427  noise threshold'
-0000c4d0: 2c20 276e 6f69 7365 272c 2027 7468 7265  , 'noise', 'thre
-0000c4e0: 7368 6f6c 6427 2c20 276e 275d 0a20 2020  shold', 'n'].   
-0000c4f0: 2077 6172 6d75 705f 636f 6f6c 646f 776e   warmup_cooldown
-0000c500: 3d5b 2777 6172 6d75 7027 2c20 2763 6f6f  =['warmup', 'coo
-0000c510: 6c64 6f77 6e27 2c20 2777 6172 6d27 2c20  ldown', 'warm', 
-0000c520: 2763 6f6f 6c27 2c20 2762 7566 6665 7227  'cool', 'buffer'
-0000c530: 2c20 2777 6172 6d75 702d 636f 6f6c 646f  , 'warmup-cooldo
-0000c540: 776e 272c 2027 7761 726d 7570 5f63 6f6f  wn', 'warmup_coo
-0000c550: 6c64 6f77 6e27 2c20 2777 6327 2c20 2777  ldown', 'wc', 'w
-0000c560: 6172 6d5f 636f 6f6c 272c 2027 7761 726d  arm_cool', 'warm
-0000c570: 2d63 6f6f 6c27 5d0a 0a20 2020 2069 6620  -cool']..    if 
-0000c580: 6973 696e 7374 616e 6365 2869 6e70 7574  isinstance(input
-0000c590: 2c64 6963 7429 3a0a 2020 2020 2020 2020  ,dict):.        
-0000c5a0: 6966 2027 7374 7265 616d 5f65 6469 7465  if 'stream_edite
-0000c5b0: 6427 2069 6e20 696e 7075 742e 6b65 7973  d' in input.keys
-0000c5c0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0000c5d0: 696e 5374 7265 616d 203d 2069 6e70 7574  inStream = input
-0000c5e0: 5b27 7374 7265 616d 5f65 6469 7465 6427  ['stream_edited'
-0000c5f0: 5d2e 636f 7079 2829 0a20 2020 2020 2020  ].copy().       
-0000c600: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000c610: 2020 2069 6e53 7472 6561 6d20 3d20 696e     inStream = in
-0000c620: 7075 745b 2773 7472 6561 6d27 5d2e 636f  put['stream'].co
-0000c630: 7079 2829 0a20 2020 2020 2020 206f 7574  py().        out
-0000c640: 7075 7420 3d20 696e 7075 742e 636f 7079  put = input.copy
-0000c650: 2829 0a20 2020 2065 6c69 6620 6973 696e  ().    elif isin
-0000c660: 7374 616e 6365 2869 6e70 7574 2c20 6f62  stance(input, ob
-0000c670: 7370 792e 636f 7265 2e73 7472 6561 6d2e  spy.core.stream.
-0000c680: 5374 7265 616d 2920 6f72 2069 7369 6e73  Stream) or isins
-0000c690: 7461 6e63 6528 696e 7075 742c 206f 6273  tance(input, obs
-0000c6a0: 7079 2e63 6f72 652e 7472 6163 652e 5472  py.core.trace.Tr
-0000c6b0: 6163 6529 3a0a 2020 2020 2020 2020 696e  ace):.        in
-0000c6c0: 5374 7265 616d 203d 2069 6e70 7574 2e63  Stream = input.c
-0000c6d0: 6f70 7928 290a 2020 2020 2020 2020 6f75  opy().        ou
-0000c6e0: 7470 7574 203d 2069 6e53 7472 6561 6d2e  tput = inStream.
-0000c6f0: 636f 7079 2829 0a20 2020 2065 6c73 653a  copy().    else:
-0000c700: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-0000c710: 4552 524f 523a 2069 6e70 7574 2069 7320  ERROR: input is 
-0000c720: 6e6f 7420 6578 7065 6374 6564 2074 7970  not expected typ
-0000c730: 6522 290a 2020 2020 0a20 2020 2069 6620  e").    .    if 
-0000c740: 6b69 6e64 2e6c 6f77 6572 2829 2069 6e20  kind.lower() in 
-0000c750: 6d61 6e75 616c 4c69 7374 3a0a 2020 2020  manualList:.    
-0000c760: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0000c770: 6528 6f75 7470 7574 2c20 6469 6374 293a  e(output, dict):
-0000c780: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c790: 2778 7769 6e64 6f77 735f 6f75 7427 2069  'xwindows_out' i
-0000c7a0: 6e20 6f75 7470 7574 2e6b 6579 7328 293a  n output.keys():
-0000c7b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c7c0: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
-0000c7d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000c7e0: 2020 2020 2020 2020 6f75 7470 7574 203d          output =
-0000c7f0: 2073 656c 6563 745f 7769 6e64 6f77 7328   select_windows(
-0000c800: 6f75 7470 7574 290a 2020 2020 2020 2020  output).        
-0000c810: 2020 2020 7769 6e64 6f77 5f6c 6973 7420      window_list 
-0000c820: 3d20 6f75 7470 7574 5b27 7877 696e 646f  = output['xwindo
-0000c830: 7773 5f6f 7574 275d 0a0a 2020 2020 2020  ws_out']..      
-0000c840: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0000c850: 696e 5374 7265 616d 2c20 6f62 7370 792e  inStream, obspy.
-0000c860: 636f 7265 2e73 7472 6561 6d2e 5374 7265  core.stream.Stre
-0000c870: 616d 293a 0a20 2020 2020 2020 2020 2020  am):.           
-0000c880: 2069 6620 7769 6e64 6f77 5f6c 6973 7420   if window_list 
-0000c890: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000c8a0: 2020 2020 2020 2020 2020 2020 206f 7574               out
-0000c8b0: 7075 745b 2773 7472 6561 6d5f 6564 6974  put['stream_edit
-0000c8c0: 6564 275d 203d 205f 5f72 656d 6f76 655f  ed'] = __remove_
-0000c8d0: 7769 6e64 6f77 7328 696e 5374 7265 616d  windows(inStream
-0000c8e0: 2c20 7769 6e64 6f77 5f6c 6973 742c 2077  , window_list, w
-0000c8f0: 6172 6d75 705f 7469 6d65 290a 2020 2020  armup_time).    
-0000c900: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000c910: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-0000c920: 7470 7574 203d 2073 656c 6563 745f 7769  tput = select_wi
-0000c930: 6e64 6f77 7328 6f75 7470 7574 290a 2020  ndows(output).  
-0000c940: 2020 2020 2020 656c 6966 2074 7970 6528        elif type(
-0000c950: 6f75 7470 7574 2920 6973 2064 6963 743a  output) is dict:
-0000c960: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-0000c970: 730a 2020 2020 2020 2020 656c 7365 3a0a  s.        else:.
-0000c980: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000c990: 7428 2745 5252 4f52 3a20 5573 696e 6720  t('ERROR: Using 
-0000c9a0: 616e 7974 6869 6e67 206f 7468 6572 2074  anything other t
-0000c9b0: 6861 6e20 616e 206f 6273 7079 2073 7472  han an obspy str
-0000c9c0: 6561 6d20 6973 206e 6f74 2063 7572 7265  eam is not curre
-0000c9d0: 6e74 6c79 2073 7570 706f 7274 6564 2066  ntly supported f
-0000c9e0: 6f72 2074 6869 7320 6e6f 6973 6520 7265  or this noise re
-0000c9f0: 6d6f 7661 6c20 6d65 7468 6f64 2e27 290a  moval method.').
-0000ca00: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0000ca10: 2065 6c69 6620 6b69 6e64 2e6c 6f77 6572   elif kind.lower
-0000ca20: 2829 2069 6e20 6175 746f 4c69 7374 3a0a  () in autoList:.
-0000ca30: 2020 2020 2020 2020 6f75 7453 7472 6561          outStrea
-0000ca40: 6d20 3d20 5f5f 7265 6d6f 7665 5f6e 6f69  m = __remove_noi
-0000ca50: 7365 5f74 6872 6573 6828 696e 5374 7265  se_thresh(inStre
-0000ca60: 616d 2c20 6e6f 6973 655f 7065 7263 656e  am, noise_percen
-0000ca70: 743d 6e6f 6973 655f 7065 7263 656e 742c  t=noise_percent,
-0000ca80: 206c 7461 3d6c 7461 2c20 6d69 6e5f 7769   lta=lta, min_wi
-0000ca90: 6e5f 7369 7a65 3d6d 696e 5f77 696e 5f73  n_size=min_win_s
-0000caa0: 697a 6529 0a20 2020 2020 2020 206f 7574  ize).        out
-0000cab0: 5374 7265 616d 203d 205f 5f72 656d 6f76  Stream = __remov
-0000cac0: 655f 616e 7469 5f73 7461 6c74 6128 6f75  e_anti_stalta(ou
-0000cad0: 7453 7472 6561 6d2c 2073 7461 3d73 7461  tStream, sta=sta
-0000cae0: 2c20 6c74 613d 6c74 612c 2074 6872 6573  , lta=lta, thres
-0000caf0: 683d 7374 616c 7461 5f74 6872 6573 6829  h=stalta_thresh)
-0000cb00: 0a20 2020 2020 2020 206f 7574 5374 7265  .        outStre
-0000cb10: 616d 203d 205f 5f72 656d 6f76 655f 6e6f  am = __remove_no
-0000cb20: 6973 655f 7361 7475 7261 7465 286f 7574  ise_saturate(out
-0000cb30: 5374 7265 616d 2c20 7361 745f 7065 7263  Stream, sat_perc
-0000cb40: 656e 743d 7361 745f 7065 7263 656e 742c  ent=sat_percent,
-0000cb50: 206d 696e 5f77 696e 5f73 697a 653d 6d69   min_win_size=mi
-0000cb60: 6e5f 7769 6e5f 7369 7a65 290a 2020 2020  n_win_size).    
-0000cb70: 2020 2020 6f75 7453 7472 6561 6d20 3d20      outStream = 
-0000cb80: 5f5f 7265 6d6f 7665 5f77 6172 6d75 705f  __remove_warmup_
-0000cb90: 636f 6f6c 646f 776e 2873 7472 6561 6d3d  cooldown(stream=
-0000cba0: 6f75 7453 7472 6561 6d2c 2077 6172 6d75  outStream, warmu
-0000cbb0: 705f 7469 6d65 3d77 6172 6d75 705f 7469  p_time=warmup_ti
-0000cbc0: 6d65 2c20 636f 6f6c 646f 776e 5f74 696d  me, cooldown_tim
-0000cbd0: 653d 636f 6f6c 646f 776e 5f74 696d 6529  e=cooldown_time)
-0000cbe0: 0a20 2020 2065 6c69 6620 6b69 6e64 2e6c  .    elif kind.l
-0000cbf0: 6f77 6572 2829 2069 6e20 616e 7469 7472  ower() in antitr
-0000cc00: 6967 6765 723a 0a20 2020 2020 2020 206f  igger:.        o
-0000cc10: 7574 5374 7265 616d 203d 205f 5f72 656d  utStream = __rem
-0000cc20: 6f76 655f 616e 7469 5f73 7461 6c74 6128  ove_anti_stalta(
-0000cc30: 696e 5374 7265 616d 2c20 7374 613d 7374  inStream, sta=st
-0000cc40: 612c 206c 7461 3d6c 7461 2c20 7468 7265  a, lta=lta, thre
-0000cc50: 7368 3d73 7461 6c74 615f 7468 7265 7368  sh=stalta_thresh
-0000cc60: 290a 2020 2020 656c 6966 206b 696e 642e  ).    elif kind.
-0000cc70: 6c6f 7765 7228 2920 696e 2073 6174 7572  lower() in satur
-0000cc80: 6174 696f 6e54 6872 6573 683a 0a20 2020  ationThresh:.   
-0000cc90: 2020 2020 206f 7574 5374 7265 616d 203d       outStream =
-0000cca0: 205f 5f72 656d 6f76 655f 6e6f 6973 655f   __remove_noise_
-0000ccb0: 7361 7475 7261 7465 2869 6e53 7472 6561  saturate(inStrea
-0000ccc0: 6d2c 2073 6174 5f70 6572 6365 6e74 3d73  m, sat_percent=s
-0000ccd0: 6174 5f70 6572 6365 6e74 2c20 6d69 6e5f  at_percent, min_
-0000cce0: 7769 6e5f 7369 7a65 3d6d 696e 5f77 696e  win_size=min_win
-0000ccf0: 5f73 697a 6529 0a20 2020 2065 6c69 6620  _size).    elif 
-0000cd00: 6b69 6e64 2e6c 6f77 6572 2829 2069 6e20  kind.lower() in 
-0000cd10: 6e6f 6973 6554 6872 6573 683a 0a20 2020  noiseThresh:.   
-0000cd20: 2020 2020 206f 7574 5374 7265 616d 203d       outStream =
-0000cd30: 205f 5f72 656d 6f76 655f 6e6f 6973 655f   __remove_noise_
-0000cd40: 7468 7265 7368 2869 6e53 7472 6561 6d2c  thresh(inStream,
-0000cd50: 206e 6f69 7365 5f70 6572 6365 6e74 3d6e   noise_percent=n
-0000cd60: 6f69 7365 5f70 6572 6365 6e74 2c20 6c74  oise_percent, lt
-0000cd70: 613d 6c74 612c 206d 696e 5f77 696e 5f73  a=lta, min_win_s
-0000cd80: 697a 653d 6d69 6e5f 7769 6e5f 7369 7a65  ize=min_win_size
-0000cd90: 290a 2020 2020 656c 6966 206b 696e 642e  ).    elif kind.
-0000cda0: 6c6f 7765 7228 2920 696e 2077 6172 6d75  lower() in warmu
-0000cdb0: 705f 636f 6f6c 646f 776e 3a0a 2020 2020  p_cooldown:.    
-0000cdc0: 2020 2020 6f75 7453 7472 6561 6d20 3d20      outStream = 
-0000cdd0: 5f5f 7265 6d6f 7665 5f77 6172 6d75 705f  __remove_warmup_
-0000cde0: 636f 6f6c 646f 776e 2873 7472 6561 6d3d  cooldown(stream=
-0000cdf0: 696e 5374 7265 616d 2c20 7761 726d 7570  inStream, warmup
-0000ce00: 5f74 696d 653d 7761 726d 7570 5f74 696d  _time=warmup_tim
-0000ce10: 652c 2063 6f6f 6c64 6f77 6e5f 7469 6d65  e, cooldown_time
-0000ce20: 3d63 6f6f 6c64 6f77 6e5f 7469 6d65 290a  =cooldown_time).
-0000ce30: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000ce40: 2020 7072 696e 7428 226b 696e 6420 7061    print("kind pa
-0000ce50: 7261 6d65 7465 7220 6973 206e 6f74 2072  rameter is not r
-0000ce60: 6563 6f67 6e69 7a65 642e 2050 6c65 6173  ecognized. Pleas
-0000ce70: 6520 6368 6f6f 7365 206f 6e65 206f 6620  e choose one of 
-0000ce80: 7468 6520 666f 6c6c 6f77 696e 673a 2027  the following: '
-0000ce90: 6d61 6e75 616c 272c 2027 6175 746f 272c  manual', 'auto',
-0000cea0: 2027 616e 7469 7472 6967 6765 7227 2c20   'antitrigger', 
-0000ceb0: 276e 6f69 7365 2074 6872 6573 686f 6c64  'noise threshold
-0000cec0: 272c 2027 7761 726d 7570 5f63 6f6f 6c64  ', 'warmup_coold
-0000ced0: 6f77 6e22 290a 2020 2020 2020 2020 7265  own").        re
-0000cee0: 7475 726e 0a0a 2020 2020 6966 2069 7369  turn..    if isi
-0000cef0: 6e73 7461 6e63 6528 696e 7075 742c 2064  nstance(input, d
-0000cf00: 6963 7429 3a0a 2020 2020 2020 2020 6f75  ict):.        ou
-0000cf10: 7470 7574 5b27 7374 7265 616d 5f65 6469  tput['stream_edi
-0000cf20: 7465 6427 5d20 3d20 6f75 7453 7472 6561  ted'] = outStrea
-0000cf30: 6d0a 2020 2020 656c 6966 2069 7369 6e73  m.    elif isins
-0000cf40: 7461 6e63 6528 696e 7075 742c 206f 6273  tance(input, obs
-0000cf50: 7079 2e63 6f72 652e 7374 7265 616d 2e53  py.core.stream.S
-0000cf60: 7472 6561 6d29 206f 7220 6973 696e 7374  tream) or isinst
-0000cf70: 616e 6365 2869 6e70 7574 2c20 6f62 7370  ance(input, obsp
-0000cf80: 792e 636f 7265 2e74 7261 6365 2e54 7261  y.core.trace.Tra
-0000cf90: 6365 293a 0a20 2020 2020 2020 206f 7574  ce):.        out
-0000cfa0: 7075 7420 3d20 6f75 7453 7472 6561 6d0a  put = outStream.
-0000cfb0: 2020 2020 7265 7475 726e 206f 7574 7075      return outpu
-0000cfc0: 740a 0a23 5368 6f77 7320 7769 6e64 6f77  t..#Shows window
-0000cfd0: 7320 7769 7468 204e 6f6e 656f 6e20 696e  s with Noneon in
-0000cfe0: 7075 7420 706c 6f74 0a64 6566 2073 686f  put plot.def sho
-0000cff0: 775f 7265 6d6f 7665 645f 7769 6e64 6f77  w_removed_window
-0000d000: 7328 696e 7075 742c 2066 6967 3d4e 6f6e  s(input, fig=Non
-0000d010: 652c 2061 783d 4e6f 6e65 2c20 6c69 6e65  e, ax=None, line
-0000d020: 4172 7469 7374 203d 5b5d 2c20 7769 6e41  Artist =[], winA
-0000d030: 7274 6973 7420 3d20 5b5d 2c20 6578 6973  rtist = [], exis
-0000d040: 7469 6e67 5f6c 696e 6541 7274 6973 7473  ting_lineArtists
-0000d050: 3d5b 5d2c 206b 6565 705f 6c69 6e65 5f61  =[], keep_line_a
-0000d060: 7274 6973 7473 3d54 7275 652c 2074 696d  rtists=True, tim
-0000d070: 655f 7479 7065 3d27 6d61 7470 6c6f 746c  e_type='matplotl
-0000d080: 6962 2729 3a0a 2020 2020 6966 2066 6967  ib'):.    if fig
-0000d090: 2069 7320 4e6f 6e65 2061 6e64 2061 7820   is None and ax 
-0000d0a0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0000d0b0: 2066 6967 2c20 6178 203d 2070 6c74 2e73   fig, ax = plt.s
-0000d0c0: 7562 706c 6f74 7328 290a 0a20 2020 2069  ubplots()..    i
-0000d0d0: 6620 7479 7065 2869 6e70 7574 2920 6973  f type(input) is
-0000d0e0: 2064 6963 743a 0a20 2020 2020 2020 2069   dict:.        i
-0000d0f0: 6620 2773 7472 6561 6d5f 6564 6974 6564  f 'stream_edited
-0000d100: 2720 696e 2069 6e70 7574 2e6b 6579 7328  ' in input.keys(
-0000d110: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-0000d120: 7472 6561 6d20 3d20 696e 7075 745b 2773  tream = input['s
-0000d130: 7472 6561 6d5f 6564 6974 6564 275d 2e63  tream_edited'].c
-0000d140: 6f70 7928 290a 2020 2020 2020 2020 656c  opy().        el
-0000d150: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000d160: 7374 7265 616d 203d 2069 6e70 7574 5b27  stream = input['
-0000d170: 7374 7265 616d 275d 2e63 6f70 7928 290a  stream'].copy().
-0000d180: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000d190: 2020 7374 7265 616d 203d 2069 6e70 7574    stream = input
-0000d1a0: 2e63 6f70 7928 290a 0a20 2020 2023 4765  .copy()..    #Ge
-0000d1b0: 7420 6d61 736b 6564 2069 6e64 6963 6573  t masked indices
-0000d1c0: 206f 6620 7472 6163 6528 7329 0a20 2020   of trace(s).   
-0000d1d0: 2074 7261 6365 203d 2073 7472 6561 6d5b   trace = stream[
-0000d1e0: 305d 0a20 2020 2077 696e 646f 7773 203d  0].    windows =
-0000d1f0: 205b 5d0a 2020 2020 7769 6e64 6f77 732e   [].    windows.
-0000d200: 6170 7065 6e64 285b 302c 6e70 2e6e 616e  append([0,np.nan
-0000d210: 5d29 0a0a 2020 2020 236d 6173 6b20 3d20  ])..    #mask = 
-0000d220: 6e70 2e69 736e 616e 2874 7261 6365 2e64  np.isnan(trace.d
-0000d230: 6174 6129 2020 2320 4372 6561 7465 2061  ata)  # Create a
-0000d240: 206d 6173 6b20 666f 7220 4e6f 6e65 2076   mask for None v
-0000d250: 616c 7565 730a 2020 2020 236d 6173 6b65  alues.    #maske
-0000d260: 645f 6172 7261 7920 3d20 6e70 2e6d 612e  d_array = np.ma.
-0000d270: 6172 7261 7928 7472 6163 652e 6461 7461  array(trace.data
-0000d280: 2c20 6d61 736b 3d6d 6173 6b29 2e63 6f70  , mask=mask).cop
-0000d290: 7928 290a 2020 2020 6d61 736b 6564 5f61  y().    masked_a
-0000d2a0: 7272 6179 203d 2074 7261 6365 2e64 6174  rray = trace.dat
-0000d2b0: 612e 636f 7079 2829 0a0a 2020 2020 6966  a.copy()..    if
-0000d2c0: 2069 7369 6e73 7461 6e63 6528 6d61 736b   isinstance(mask
-0000d2d0: 6564 5f61 7272 6179 2c20 6e70 2e6d 612e  ed_array, np.ma.
-0000d2e0: 4d61 736b 6564 4172 7261 7929 3a0a 2020  MaskedArray):.  
-0000d2f0: 2020 2020 2020 7361 6d70 6c65 5f72 6174        sample_rat
-0000d300: 6520 3d20 7472 6163 652e 7374 6174 732e  e = trace.stats.
-0000d310: 7361 6d70 6c69 6e67 5f72 6174 650a 2020  sampling_rate.  
-0000d320: 2020 2020 2020 6d61 736b 6564 5f61 7272        masked_arr
-0000d330: 6179 203d 206d 6173 6b65 645f 6172 7261  ay = masked_arra
-0000d340: 792e 6d61 736b 2e6e 6f6e 7a65 726f 2829  y.mask.nonzero()
-0000d350: 5b30 5d0a 2020 2020 2020 2020 6c61 7374  [0].        last
-0000d360: 4d61 736b 496e 6420 3d20 6d61 736b 6564  MaskInd = masked
-0000d370: 5f61 7272 6179 5b30 5d0a 2020 2020 2020  _array[0].      
-0000d380: 2020 7749 6e64 203d 2030 0a20 2020 2020    wInd = 0.     
-0000d390: 2020 2023 6d61 736b 6564 5f61 7272 6179     #masked_array
-0000d3a0: 203d 2074 7261 6365 2e64 6174 612e 6d61   = trace.data.ma
-0000d3b0: 736b 2e6e 6f6e 7a65 726f 2829 5b30 5d0a  sk.nonzero()[0].
-0000d3c0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-0000d3d0: 2072 616e 6765 2831 2c20 6c65 6e28 6d61   range(1, len(ma
-0000d3e0: 736b 6564 5f61 7272 6179 2929 3a0a 2020  sked_array)):.  
-0000d3f0: 2020 2020 2020 2020 2020 6d61 736b 496e            maskIn
-0000d400: 6420 3d20 6d61 736b 6564 5f61 7272 6179  d = masked_array
-0000d410: 5b69 5d0a 2020 2020 2020 2020 2020 2020  [i].            
-0000d420: 6966 206d 6173 6b49 6e64 2d6c 6173 744d  if maskInd-lastM
-0000d430: 6173 6b49 6e64 203e 2031 3a0a 2020 2020  askInd > 1:.    
-0000d440: 2020 2020 2020 2020 2020 2020 7769 6e64              wind
-0000d450: 6f77 732e 6170 7065 6e64 285b 6e70 2e6e  ows.append([np.n
-0000d460: 616e 2c20 6e70 2e6e 616e 5d29 0a20 2020  an, np.nan]).   
-0000d470: 2020 2020 2020 2020 2020 2020 2077 696e               win
-0000d480: 646f 7773 5b77 496e 645d 5b31 5d20 3d20  dows[wInd][1] = 
-0000d490: 6d61 736b 6564 5f61 7272 6179 5b69 202d  masked_array[i -
-0000d4a0: 2031 5d0a 2020 2020 2020 2020 2020 2020   1].            
-0000d4b0: 2020 2020 7749 6e64 202b 3d20 310a 2020      wInd += 1.  
-0000d4c0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-0000d4d0: 6e64 6f77 735b 7749 6e64 5d5b 305d 203d  ndows[wInd][0] =
-0000d4e0: 206d 6173 6b65 645f 6172 7261 795b 695d   masked_array[i]
-0000d4f0: 0a0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
-0000d500: 7374 4d61 736b 496e 6420 3d20 6d61 736b  stMaskInd = mask
-0000d510: 496e 6420 2020 200a 2020 2020 2020 2020  Ind    .        
-0000d520: 7769 6e64 6f77 735b 7749 6e64 5d5b 315d  windows[wInd][1]
-0000d530: 203d 206d 6173 6b65 645f 6172 7261 795b   = masked_array[
-0000d540: 2d31 5d0a 0a20 2020 2020 2020 2023 5265  -1]..        #Re
-0000d550: 666f 726d 6174 2061 7820 6173 206e 6565  format ax as nee
-0000d560: 6465 640a 2020 2020 2020 2020 6966 2069  ded.        if i
-0000d570: 7369 6e73 7461 6e63 6528 6178 2c20 6e70  sinstance(ax, np
-0000d580: 2e6e 6461 7272 6179 293a 0a20 2020 2020  .ndarray):.     
-0000d590: 2020 2020 2020 206f 7269 6741 7865 7320         origAxes 
-0000d5a0: 3d20 6178 2e63 6f70 7928 290a 2020 2020  = ax.copy().    
-0000d5b0: 2020 2020 2020 2020 6e65 7741 7820 3d20          newAx = 
-0000d5c0: 7b7d 0a20 2020 2020 2020 2020 2020 2066  {}.            f
-0000d5d0: 6f72 2069 2c20 6120 696e 2065 6e75 6d65  or i, a in enume
-0000d5e0: 7261 7465 2861 7829 3a0a 2020 2020 2020  rate(ax):.      
-0000d5f0: 2020 2020 2020 2020 2020 6e65 7741 785b            newAx[
-0000d600: 695d 203d 2061 0a20 2020 2020 2020 2020  i] = a.         
-0000d610: 2020 2061 7865 7320 3d20 6e65 7741 780a     axes = newAx.
-0000d620: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-0000d630: 6e73 7461 6e63 6528 6178 2c20 6469 6374  nstance(ax, dict
-0000d640: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
-0000d650: 7269 6741 7865 7320 3d20 6178 0a20 2020  rigAxes = ax.   
-0000d660: 2020 2020 2020 2020 2061 7865 7320 3d20           axes = 
-0000d670: 6178 0a20 2020 2020 2020 2065 6c73 653a  ax.        else:
-0000d680: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
-0000d690: 6741 7865 7320 3d20 6178 0a20 2020 2020  gAxes = ax.     
-0000d6a0: 2020 2020 2020 2061 7865 7320 3d20 7b27         axes = {'
-0000d6b0: 6178 273a 6178 7d0a 0a20 2020 2020 2020  ax':ax}..       
-0000d6c0: 2073 616d 706c 6573 4c69 7374 203d 205b   samplesList = [
-0000d6d0: 2773 616d 706c 6527 2c20 2773 616d 706c  'sample', 'sampl
-0000d6e0: 6573 272c 2027 7327 5d0a 2020 2020 2020  es', 's'].      
-0000d6f0: 2020 7574 634c 6973 7420 3d20 5b27 7574    utcList = ['ut
-0000d700: 6327 2c20 2775 7463 6461 7465 7469 6d65  c', 'utcdatetime
-0000d710: 272c 2027 6f62 7370 7927 2c20 2775 272c  ', 'obspy', 'u',
-0000d720: 2027 6f27 5d0a 2020 2020 2020 2020 6d61   'o'].        ma
-0000d730: 7470 6c6f 746c 6962 4c69 7374 203d 205b  tplotlibList = [
-0000d740: 276d 6174 706c 6f74 6c69 6227 2c20 276d  'matplotlib', 'm
-0000d750: 706c 272c 2027 6d27 5d20 2020 200a 0a20  pl', 'm']    .. 
-0000d760: 2020 2020 2020 2066 6f72 2069 2c20 6120         for i, a 
-0000d770: 696e 2065 6e75 6d65 7261 7465 2861 7865  in enumerate(axe
-0000d780: 732e 6b65 7973 2829 293a 0a20 2020 2020  s.keys()):.     
-0000d790: 2020 2020 2020 2061 7820 3d20 6178 6573         ax = axes
-0000d7a0: 5b61 5d0a 2020 2020 2020 2020 2020 2020  [a].            
-0000d7b0: 7061 7468 4c69 7374 203d 205b 5d0a 2020  pathList = [].  
-0000d7c0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0000d7d0: 2020 2020 2020 2077 696e 646f 7744 7261         windowDra
-0000d7e0: 776e 203d 205b 5d0a 2020 2020 2020 2020  wn = [].        
-0000d7f0: 2020 2020 7769 6e41 7274 6973 7420 3d20      winArtist = 
-0000d800: 5b5d 0a20 2020 2020 2020 2020 2020 2069  [].            i
-0000d810: 6620 6578 6973 7469 6e67 5f6c 696e 6541  f existing_lineA
-0000d820: 7274 6973 7473 203d 3d20 5b5d 3a0a 2020  rtists == []:.  
-0000d830: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-0000d840: 6e65 4172 7469 7374 203d 205b 5d0a 2020  neArtist = [].  
-0000d850: 2020 2020 2020 2020 2020 656c 6966 206c            elif l
-0000d860: 656e 2865 7869 7374 696e 675f 6c69 6e65  en(existing_line
-0000d870: 4172 7469 7374 7329 3e3d 3120 616e 6420  Artists)>=1 and 
-0000d880: 6b65 6570 5f6c 696e 655f 6172 7469 7374  keep_line_artist
-0000d890: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000d8a0: 2020 206c 696e 6541 7274 6973 7420 3d20     lineArtist = 
-0000d8b0: 6578 6973 7469 6e67 5f6c 696e 6541 7274  existing_lineArt
-0000d8c0: 6973 7473 0a20 2020 2020 2020 2020 2020  ists.           
-0000d8d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000d8e0: 2020 2020 2020 206c 696e 6541 7274 6973         lineArtis
-0000d8f0: 7420 3d20 5b5d 0a0a 2020 2020 2020 2020  t = []..        
-0000d900: 2020 2020 666f 7220 7769 6e4e 756d 732c      for winNums,
-0000d910: 2077 696e 2069 6e20 656e 756d 6572 6174   win in enumerat
-0000d920: 6528 7769 6e64 6f77 7329 3a0a 2020 2020  e(windows):.    
-0000d930: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-0000d940: 696d 655f 7479 7065 2e6c 6f77 6572 2829  ime_type.lower()
-0000d950: 2069 6e20 7361 6d70 6c65 734c 6973 743a   in samplesList:
-0000d960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d970: 2020 2020 2078 3020 3d20 7769 6e5b 305d       x0 = win[0]
-0000d980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d990: 2020 2020 2078 3120 3d20 7769 6e5b 315d       x1 = win[1]
-0000d9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d9b0: 2065 6c69 6620 7469 6d65 5f74 7970 652e   elif time_type.
-0000d9c0: 6c6f 7765 7228 2920 696e 2075 7463 4c69  lower() in utcLi
-0000d9d0: 7374 206f 7220 7469 6d65 5f74 7970 652e  st or time_type.
-0000d9e0: 6c6f 7765 7228 2920 696e 206d 6174 706c  lower() in matpl
-0000d9f0: 6f74 6c69 624c 6973 743a 0a20 2020 2020  otlibList:.     
-0000da00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000da10: 616d 706c 655f 7261 7465 203d 2074 7261  ample_rate = tra
-0000da20: 6365 2e73 7461 7473 2e64 656c 7461 0a0a  ce.stats.delta..
-0000da30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da40: 2020 2020 7830 203d 2074 7261 6365 2e73      x0 = trace.s
-0000da50: 7461 7473 2e73 7461 7274 7469 6d65 202b  tats.starttime +
-0000da60: 2077 696e 5b30 5d20 2a20 7361 6d70 6c65   win[0] * sample
-0000da70: 5f72 6174 650a 2020 2020 2020 2020 2020  _rate.          
-0000da80: 2020 2020 2020 2020 2020 7831 203d 2074            x1 = t
-0000da90: 7261 6365 2e73 7461 7473 2e73 7461 7274  race.stats.start
-0000daa0: 7469 6d65 202b 2077 696e 5b31 5d20 2a20  time + win[1] * 
-0000dab0: 7361 6d70 6c65 5f72 6174 650a 0a20 2020  sample_rate..   
-0000dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dad0: 2069 6620 7469 6d65 5f74 7970 652e 6c6f   if time_type.lo
-0000dae0: 7765 7228 2920 696e 206d 6174 706c 6f74  wer() in matplot
-0000daf0: 6c69 624c 6973 743a 0a20 2020 2020 2020  libList:.       
-0000db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db10: 2078 3020 3d20 7830 2e6d 6174 706c 6f74   x0 = x0.matplot
-0000db20: 6c69 625f 6461 7465 0a20 2020 2020 2020  lib_date.       
-0000db30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db40: 2078 3120 3d20 7831 2e6d 6174 706c 6f74   x1 = x1.matplot
-0000db50: 6c69 625f 6461 7465 0a20 2020 2020 2020  lib_date.       
-0000db60: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db80: 2020 2070 7269 6e74 2827 7469 6d65 5f74     print('time_t
-0000db90: 7970 6520 6572 726f 7227 290a 2020 2020  ype error').    
-0000dba0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0000dbb0: 2020 2020 2020 2020 2020 2020 2079 302c               y0,
-0000dbc0: 2079 3120 3d20 6178 2e67 6574 5f79 6c69   y1 = ax.get_yli
-0000dbd0: 6d28 290a 0a20 2020 2020 2020 2020 2020  m()..           
-0000dbe0: 2020 2020 2070 6174 685f 6461 7461 203d       path_data =
-0000dbf0: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
-0000dc00: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0000dc10: 6d61 7470 6c6f 746c 6962 2e70 6174 682e  matplotlib.path.
-0000dc20: 5061 7468 2e4d 4f56 4554 4f2c 2028 7830  Path.MOVETO, (x0
-0000dc30: 2c20 7930 2929 2c0a 2020 2020 2020 2020  , y0)),.        
-0000dc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc50: 2020 2020 286d 6174 706c 6f74 6c69 622e      (matplotlib.
-0000dc60: 7061 7468 2e50 6174 682e 4c49 4e45 544f  path.Path.LINETO
-0000dc70: 2c20 2878 312c 2079 3029 292c 0a20 2020  , (x1, y0)),.   
-0000dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc90: 2020 2020 2020 2020 2028 6d61 7470 6c6f           (matplo
-0000dca0: 746c 6962 2e70 6174 682e 5061 7468 2e4c  tlib.path.Path.L
-0000dcb0: 494e 4554 4f2c 2028 7831 2c20 7931 2929  INETO, (x1, y1))
-0000dcc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000dcd0: 2020 2020 2020 2020 2020 2020 2020 286d                (m
-0000dce0: 6174 706c 6f74 6c69 622e 7061 7468 2e50  atplotlib.path.P
-0000dcf0: 6174 682e 4c49 4e45 544f 2c20 2878 302c  ath.LINETO, (x0,
-0000dd00: 2079 3129 292c 0a20 2020 2020 2020 2020   y1)),.         
-0000dd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd20: 2020 2028 6d61 7470 6c6f 746c 6962 2e70     (matplotlib.p
-0000dd30: 6174 682e 5061 7468 2e4c 494e 4554 4f2c  ath.Path.LINETO,
-0000dd40: 2028 7830 2c20 7930 2929 2c0a 2020 2020   (x0, y0)),.    
-0000dd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd60: 2020 2020 2020 2020 286d 6174 706c 6f74          (matplot
-0000dd70: 6c69 622e 7061 7468 2e50 6174 682e 434c  lib.path.Path.CL
-0000dd80: 4f53 4550 4f4c 592c 2028 7830 2c20 7930  OSEPOLY, (x0, y0
-0000dd90: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-0000dda0: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
-0000ddb0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0000ddc0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000ddd0: 6f64 6573 2c20 7665 7274 7320 3d20 7a69  odes, verts = zi
-0000dde0: 7028 2a70 6174 685f 6461 7461 290a 2020  p(*path_data).  
-0000ddf0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0000de00: 7468 203d 206d 6174 706c 6f74 6c69 622e  th = matplotlib.
-0000de10: 7061 7468 2e50 6174 6828 7665 7274 732c  path.Path(verts,
-0000de20: 2063 6f64 6573 290a 0a20 2020 2020 2020   codes)..       
-0000de30: 2020 2020 2020 2020 2023 0a20 2020 2020           #.     
-0000de40: 2020 2020 2020 2020 2020 2077 696e 646f             windo
-0000de50: 7744 7261 776e 2e61 7070 656e 6428 4661  wDrawn.append(Fa
-0000de60: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
-0000de70: 2020 2020 2077 696e 4172 7469 7374 2e61       winArtist.a
-0000de80: 7070 656e 6428 4e6f 6e65 290a 2020 2020  ppend(None).    
-0000de90: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-0000dea0: 4172 7469 7374 2e61 7070 656e 6428 5b5d  Artist.append([]
-0000deb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000dec0: 2020 6c69 6e41 7274 3020 3d20 6178 2e61    linArt0 = ax.a
-0000ded0: 7876 6c69 6e65 2878 302c 2079 302c 2079  xvline(x0, y0, y
-0000dee0: 312c 2063 6f6c 6f72 3d27 6b27 2c20 6c69  1, color='k', li
-0000def0: 6e65 7769 6474 683d 302e 352c 207a 6f72  newidth=0.5, zor
-0000df00: 6465 723d 3130 3029 0a20 2020 2020 2020  der=100).       
-0000df10: 2020 2020 2020 2020 206c 696e 4172 7431           linArt1
-0000df20: 203d 2070 6c74 2e61 7876 6c69 6e65 2878   = plt.axvline(x
-0000df30: 312c 2079 302c 2079 312c 2063 6f6c 6f72  1, y0, y1, color
-0000df40: 3d27 6b27 2c20 6c69 6e65 7769 6474 683d  ='k', linewidth=
-0000df50: 302e 352c 207a 6f72 6465 723d 3130 3029  0.5, zorder=100)
-0000df60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000df70: 206c 696e 6541 7274 6973 745b 7769 6e4e   lineArtist[winN
-0000df80: 756d 735d 2e61 7070 656e 6428 5b6c 696e  ums].append([lin
-0000df90: 4172 7430 2c20 6c69 6e41 7274 315d 290a  Art0, linArt1]).
-0000dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfb0: 230a 2020 2020 2020 2020 2020 2020 2020  #.              
-0000dfc0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-0000dfd0: 2020 2070 6174 684c 6973 742e 6170 7065     pathList.appe
-0000dfe0: 6e64 2870 6174 6829 0a0a 2020 2020 2020  nd(path)..      
-0000dff0: 2020 2020 2020 666f 7220 692c 2070 6120        for i, pa 
-0000e000: 696e 2065 6e75 6d65 7261 7465 2870 6174  in enumerate(pat
-0000e010: 684c 6973 7429 3a0a 2020 2020 2020 2020  hList):.        
-0000e020: 2020 2020 2020 2020 6966 2077 696e 646f          if windo
-0000e030: 7744 7261 776e 5b69 5d3a 0a20 2020 2020  wDrawn[i]:.     
-0000e040: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000e050: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-0000e060: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000e070: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0000e080: 7463 6820 3d20 6d61 7470 6c6f 746c 6962  tch = matplotlib
-0000e090: 2e70 6174 6368 6573 2e50 6174 6850 6174  .patches.PathPat
-0000e0a0: 6368 2870 612c 2066 6163 6563 6f6c 6f72  ch(pa, facecolor
-0000e0b0: 3d27 6b27 2c20 616c 7068 613d 302e 3735  ='k', alpha=0.75
-0000e0c0: 2920 2020 2020 2020 2020 2020 2020 2020  )               
-0000e0d0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-0000e0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e0f0: 2020 7769 6e41 7274 203d 2061 782e 6164    winArt = ax.ad
-0000e100: 645f 7061 7463 6828 7061 7463 6829 0a20  d_patch(patch). 
-0000e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e120: 2020 2077 696e 646f 7744 7261 776e 5b69     windowDrawn[i
-0000e130: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
-0000e140: 2020 2020 2020 2020 2020 2020 2077 696e               win
-0000e150: 4172 7469 7374 5b69 5d20 3d20 7769 6e41  Artist[i] = winA
-0000e160: 7274 0a20 2020 2020 2020 2020 2020 200a  rt.            .
-0000e170: 2020 2020 2020 2020 2020 2020 2352 6566              #Ref
-0000e180: 6f72 6d61 7420 6178 2061 7320 6e65 6564  ormat ax as need
-0000e190: 6564 0a20 2020 2020 2020 2020 2020 2069  ed.            i
-0000e1a0: 6620 6973 696e 7374 616e 6365 286f 7269  f isinstance(ori
-0000e1b0: 6741 7865 732c 206e 702e 6e64 6172 7261  gAxes, np.ndarra
-0000e1c0: 7929 3a0a 2020 2020 2020 2020 2020 2020  y):.            
-0000e1d0: 2020 2020 6f72 6967 4178 6573 5b69 5d20      origAxes[i] 
-0000e1e0: 3d20 6178 0a20 2020 2020 2020 2020 2020  = ax.           
-0000e1f0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-0000e200: 286f 7269 6741 7865 732c 2064 6963 7429  (origAxes, dict)
-0000e210: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000e220: 2020 6f72 6967 4178 6573 5b61 5d20 3d20    origAxes[a] = 
-0000e230: 6178 0a20 2020 2020 2020 2020 2020 2065  ax.            e
-0000e240: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000e250: 2020 2020 206f 7269 6741 7865 7320 3d20       origAxes = 
-0000e260: 6178 0a0a 2020 2020 2020 2020 6178 203d  ax..        ax =
-0000e270: 206f 7269 6741 7865 730a 0a20 2020 2020   origAxes..     
-0000e280: 2020 2066 6967 2e63 616e 7661 732e 6472     fig.canvas.dr
-0000e290: 6177 2829 0a0a 2020 2020 7265 7475 726e  aw()..    return
-0000e2a0: 2066 6967 2c20 6178 2c20 6c69 6e65 4172   fig, ax, lineAr
-0000e2b0: 7469 7374 2c20 7769 6e41 7274 6973 740a  tist, winArtist.
-0000e2c0: 0a23 4865 6c70 6572 2066 756e 6374 696f  .#Helper functio
-0000e2d0: 6e20 666f 7220 7265 6d6f 7669 6e67 2077  n for removing w
-0000e2e0: 696e 646f 7773 2066 726f 6d20 6461 7461  indows from data
-0000e2f0: 2c20 6c65 6176 696e 6720 6761 7073 0a64  , leaving gaps.d
-0000e300: 6566 205f 5f72 656d 6f76 655f 7769 6e64  ef __remove_wind
-0000e310: 6f77 7328 7374 7265 616d 2c20 7769 6e64  ows(stream, wind
-0000e320: 6f77 5f6c 6973 742c 2077 6172 6d75 705f  ow_list, warmup_
-0000e330: 7469 6d65 293a 0a20 2020 2022 2222 4865  time):.    """He
-0000e340: 6c70 6572 2066 756e 6374 696f 6e20 7468  lper function th
-0000e350: 6174 2061 6374 7561 6c6c 7920 646f 6573  at actually does
-0000e360: 2074 6865 2077 6f72 6b20 696e 206f 6273   the work in obs
-0000e370: 7079 2074 6f20 7265 6d6f 7665 2074 6865  py to remove the
-0000e380: 2077 696e 646f 7773 2063 616c 6375 6c61   windows calcula
-0000e390: 7465 6420 696e 2074 6865 2072 656d 6f76  ted in the remov
-0000e3a0: 655f 6e6f 6973 6520 6675 6e63 7469 6f6e  e_noise function
-0000e3b0: 0a73 0a20 2020 2050 6172 616d 6574 6572  .s.    Parameter
-0000e3c0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-0000e3d0: 0a20 2020 2073 7472 6561 6d20 3a20 6f62  .    stream : ob
-0000e3e0: 7370 792e 636f 7265 2e73 7472 6561 6d2e  spy.core.stream.
-0000e3f0: 5374 7265 616d 206f 626a 6563 740a 2020  Stream object.  
-0000e400: 2020 2020 2020 496e 7075 7420 7374 7265        Input stre
-0000e410: 616d 2066 726f 6d20 7768 6963 6820 746f  am from which to
-0000e420: 2072 656d 6f76 6520 7769 6e64 6f77 730a   remove windows.
-0000e430: 2020 2020 7769 6e64 6f77 5f6c 6973 7420      window_list 
-0000e440: 3a20 6c69 7374 0a20 2020 2020 2020 2041  : list.        A
-0000e450: 206c 6973 7420 6f66 2077 696e 646f 7773   list of windows
-0000e460: 2077 6974 6820 7374 6172 7420 616e 6420   with start and 
-0000e470: 656e 6420 7469 6d65 7320 666f 7220 7468  end times for th
-0000e480: 6520 7769 6e64 6f77 7320 746f 2062 6520  e windows to be 
-0000e490: 7265 6d6f 7665 640a 2020 2020 7761 726d  removed.    warm
-0000e4a0: 7570 5f74 696d 6520 3a20 696e 742c 2064  up_time : int, d
-0000e4b0: 6566 6175 6c74 203d 2030 0a20 2020 2020  efault = 0.     
-0000e4c0: 2020 2050 6173 7365 6420 6672 6f6d 2072     Passed from r
-0000e4d0: 656d 6f76 655f 6e6f 6973 652c 2074 6865  emove_noise, the
-0000e4e0: 2061 6d6f 756e 7420 6f66 2074 696d 6520   amount of time 
-0000e4f0: 696e 2073 6563 6f6e 6473 2074 6f20 616c  in seconds to al
-0000e500: 6c6f 7720 666f 7220 7761 726d 7570 2e20  low for warmup. 
-0000e510: 416e 7974 6869 6e67 2062 6566 6f72 6520  Anything before 
-0000e520: 7468 6973 2069 7320 7265 6d6f 7665 6420  this is removed 
-0000e530: 6173 2027 6e6f 6973 6527 2e0a 0a20 2020  as 'noise'...   
-0000e540: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
-0000e550: 2d2d 2d2d 0a20 2020 206f 7574 5374 7265  ----.    outStre
-0000e560: 616d 203a 206f 6273 7079 2e63 6f72 652e  am : obspy.core.
-0000e570: 7374 7265 616d 2e53 7472 6561 6d20 6f62  stream.Stream ob
-0000e580: 6a65 6374 0a20 2020 2020 2020 2053 7472  ject.        Str
-0000e590: 6561 6d20 7769 7468 2061 206d 6173 6b65  eam with a maske
-0000e5a0: 6420 6172 7261 7920 666f 7220 7468 6520  d array for the 
-0000e5b0: 6461 7461 2077 6865 7265 2027 6e6f 6973  data where 'nois
-0000e5c0: 6527 2068 6173 2062 6565 6e20 7265 6d6f  e' has been remo
-0000e5d0: 7665 640a 2020 2020 2222 220a 2020 2020  ved.    """.    
-0000e5e0: 6f67 5f73 7472 6561 6d20 3d20 7374 7265  og_stream = stre
-0000e5f0: 616d 2e63 6f70 7928 290a 0a20 2020 2023  am.copy()..    #
-0000e600: 4669 6e64 2074 6865 206c 6174 6573 7420  Find the latest 
-0000e610: 7374 6172 7420 7469 6d65 2061 6e64 2065  start time and e
-0000e620: 6172 6c69 6573 7420 656e 6474 696d 6520  arliest endtime 
-0000e630: 6f66 2061 6c6c 2074 7261 6365 7320 2869  of all traces (i
-0000e640: 6e20 6361 7365 2074 6865 7920 6172 656e  n case they aren
-0000e650: 2774 2063 6f6e 7369 7374 656e 7429 0a20  't consistent). 
-0000e660: 2020 206d 6178 5374 6172 7454 696d 6520     maxStartTime 
-0000e670: 3d20 6f62 7370 792e 5554 4344 6174 6554  = obspy.UTCDateT
-0000e680: 696d 6528 2d31 6531 3029 2023 476f 2062  ime(-1e10) #Go b
-0000e690: 6163 6b20 7072 6574 7479 2066 6172 2028  ack pretty far (
-0000e6a0: 616c 6d6f 7374 2034 3030 2079 6561 7273  almost 400 years
-0000e6b0: 2920 746f 2073 7461 7274 2077 6974 680a  ) to start with.
-0000e6c0: 2020 2020 6d69 6e45 6e64 5469 6d65 203d      minEndTime =
-0000e6d0: 206f 6273 7079 2e55 5443 4461 7465 5469   obspy.UTCDateTi
-0000e6e0: 6d65 2831 6531 3029 0a20 2020 2066 6f72  me(1e10).    for
-0000e6f0: 2063 6f6d 7020 696e 205b 2745 272c 2027   comp in ['E', '
-0000e700: 4e27 2c20 275a 275d 3a0a 2020 2020 2020  N', 'Z']:.      
-0000e710: 2020 7472 203d 2073 7472 6561 6d2e 7365    tr = stream.se
-0000e720: 6c65 6374 2863 6f6d 706f 6e65 6e74 3d63  lect(component=c
-0000e730: 6f6d 7029 2e63 6f70 7928 290a 2020 2020  omp).copy().    
-0000e740: 2020 2020 6966 2074 725b 305d 2e73 7461      if tr[0].sta
-0000e750: 7473 2e73 7461 7274 7469 6d65 203e 206d  ts.starttime > m
-0000e760: 6178 5374 6172 7454 696d 653a 0a20 2020  axStartTime:.   
-0000e770: 2020 2020 2020 2020 206d 6178 5374 6172           maxStar
-0000e780: 7454 696d 6520 3d20 7472 5b30 5d2e 7374  tTime = tr[0].st
-0000e790: 6174 732e 7374 6172 7474 696d 650a 2020  ats.starttime.  
-0000e7a0: 2020 2020 2020 6966 2074 725b 305d 2e73        if tr[0].s
-0000e7b0: 7461 7473 2e65 6e64 7469 6d65 203c 206d  tats.endtime < m
-0000e7c0: 696e 456e 6454 696d 653a 0a20 2020 2020  inEndTime:.     
-0000e7d0: 2020 2020 2020 206d 696e 456e 6454 696d         minEndTim
-0000e7e0: 6520 3d20 7472 5b30 5d2e 7374 6174 732e  e = tr[0].stats.
-0000e7f0: 656e 6474 696d 650a 0a20 2020 2023 5472  endtime..    #Tr
-0000e800: 696d 2061 6c6c 2074 7261 6365 7320 746f  im all traces to
-0000e810: 2074 6865 2073 616d 6520 7374 6172 742f   the same start/
-0000e820: 656e 6420 7469 6d65 0a20 2020 2073 7472  end time.    str
-0000e830: 6561 6d2e 7472 696d 2873 7461 7274 7469  eam.trim(startti
-0000e840: 6d65 3d6d 6178 5374 6172 7454 696d 652c  me=maxStartTime,
-0000e850: 2065 6e64 7469 6d65 3d6d 696e 456e 6454   endtime=minEndT
-0000e860: 696d 6529 2020 2020 2020 0a0a 2020 2020  ime)      ..    
-0000e870: 2353 6f72 7420 7769 6e64 6f77 7320 6279  #Sort windows by
-0000e880: 2074 6865 2073 7461 7274 206f 6620 7468   the start of th
-0000e890: 6520 7769 6e64 6f77 0a20 2020 2073 6f72  e window.    sor
-0000e8a0: 7465 645f 7769 6e64 6f77 5f6c 6973 7420  ted_window_list 
-0000e8b0: 3d20 5b5d 0a20 2020 2077 696e 646f 7753  = [].    windowS
-0000e8c0: 7461 7274 203d 205b 5d0a 2020 2020 666f  tart = [].    fo
-0000e8d0: 7220 692c 2077 696e 646f 7720 696e 2065  r i, window in e
-0000e8e0: 6e75 6d65 7261 7465 2877 696e 646f 775f  numerate(window_
-0000e8f0: 6c69 7374 293a 0a20 2020 2020 2020 2077  list):.        w
-0000e900: 696e 646f 7753 7461 7274 2e61 7070 656e  indowStart.appen
-0000e910: 6428 7769 6e64 6f77 5b30 5d29 0a20 2020  d(window[0]).   
-0000e920: 2077 696e 646f 7753 7461 7274 5f6f 6720   windowStart_og 
-0000e930: 3d20 7769 6e64 6f77 5374 6172 742e 636f  = windowStart.co
-0000e940: 7079 2829 0a20 2020 2077 696e 646f 7753  py().    windowS
-0000e950: 7461 7274 2e73 6f72 7428 290a 2020 2020  tart.sort().    
-0000e960: 736f 7274 6564 5f73 7461 7274 5f6c 6973  sorted_start_lis
-0000e970: 7420 3d20 7769 6e64 6f77 5374 6172 740a  t = windowStart.
-0000e980: 2020 2020 7261 6e6b 7320 3d20 5b77 696e      ranks = [win
-0000e990: 646f 7753 7461 7274 5f6f 672e 696e 6465  dowStart_og.inde
-0000e9a0: 7828 6974 656d 2920 666f 7220 6974 656d  x(item) for item
-0000e9b0: 2069 6e20 736f 7274 6564 5f73 7461 7274   in sorted_start
-0000e9c0: 5f6c 6973 745d 0a20 2020 2066 6f72 2072  _list].    for r
-0000e9d0: 2069 6e20 7261 6e6b 733a 0a20 2020 2020   in ranks:.     
-0000e9e0: 2020 2073 6f72 7465 645f 7769 6e64 6f77     sorted_window
-0000e9f0: 5f6c 6973 742e 6170 7065 6e64 2877 696e  _list.append(win
-0000ea00: 646f 775f 6c69 7374 5b72 5d29 0a0a 2020  dow_list[r])..  
-0000ea10: 2020 666f 7220 692c 2077 2069 6e20 656e    for i, w in en
-0000ea20: 756d 6572 6174 6528 736f 7274 6564 5f77  umerate(sorted_w
-0000ea30: 696e 646f 775f 6c69 7374 293a 0a20 2020  indow_list):.   
-0000ea40: 2020 2020 2069 6620 6920 3c20 6c65 6e28       if i < len(
-0000ea50: 736f 7274 6564 5f77 696e 646f 775f 6c69  sorted_window_li
-0000ea60: 7374 2920 2d20 313a 0a20 2020 2020 2020  st) - 1:.       
-0000ea70: 2020 2020 2069 6620 775b 315d 203e 2073       if w[1] > s
-0000ea80: 6f72 7465 645f 7769 6e64 6f77 5f6c 6973  orted_window_lis
-0000ea90: 745b 692b 315d 5b30 5d3a 0a20 2020 2020  t[i+1][0]:.     
-0000eaa0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000eab0: 2822 4552 524f 523a 204f 7665 726c 6170  ("ERROR: Overlap
-0000eac0: 7069 6e67 2077 696e 646f 7773 2e20 506c  ping windows. Pl
-0000ead0: 6561 7365 2072 6573 656c 6563 7420 7769  ease reselect wi
-0000eae0: 6e64 6f77 7320 746f 2062 6520 7265 6d6f  ndows to be remo
-0000eaf0: 7665 6420 6f72 2075 7365 2061 2064 6966  ved or use a dif
-0000eb00: 6665 7265 6e74 206e 6f69 7365 2072 656d  ferent noise rem
-0000eb10: 6f76 616c 206d 6574 686f 642e 2229 0a20  oval method."). 
-0000eb20: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000eb30: 7269 6e74 2877 5b31 5d2c 2027 3e27 2c20  rint(w[1], '>', 
-0000eb40: 736f 7274 6564 5f77 696e 646f 775f 6c69  sorted_window_li
-0000eb50: 7374 5b69 2b31 5d5b 305d 290a 2020 2020  st[i+1][0]).    
-0000eb60: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000eb70: 726e 0a20 2020 2020 2020 2020 2020 2020  rn.             
-0000eb80: 2020 200a 2020 2020 7769 6e64 6f77 5f67     .    window_g
-0000eb90: 6170 735f 6f62 7370 7920 3d20 5b5d 0a20  aps_obspy = []. 
-0000eba0: 2020 2077 696e 646f 775f 6761 7073 203d     window_gaps =
-0000ebb0: 205b 5d0a 0a20 2020 2062 7566 6665 725f   []..    buffer_
-0000ebc0: 7469 6d65 203d 206e 702e 6365 696c 2828  time = np.ceil((
-0000ebd0: 7374 7265 616d 5b30 5d2e 7374 6174 732e  stream[0].stats.
-0000ebe0: 656e 6474 696d 652d 7374 7265 616d 5b30  endtime-stream[0
-0000ebf0: 5d2e 7374 6174 732e 7374 6172 7474 696d  ].stats.starttim
-0000ec00: 6529 2a30 2e30 3129 0a0a 2020 2020 2347  e)*0.01)..    #G
-0000ec10: 6574 206f 6273 7079 2e55 5443 4461 7465  et obspy.UTCDate
-0000ec20: 5469 6d65 206f 626a 6563 7473 2066 6f72  Time objects for
-0000ec30: 2074 6865 2067 6170 2074 696d 6573 0a20   the gap times. 
-0000ec40: 2020 2077 696e 646f 775f 6761 7073 5f6f     window_gaps_o
-0000ec50: 6273 7079 2e61 7070 656e 6428 5b73 7472  bspy.append([str
-0000ec60: 6561 6d5b 305d 2e73 7461 7473 2e73 7461  eam[0].stats.sta
-0000ec70: 7274 7469 6d65 202b 2077 6172 6d75 705f  rttime + warmup_
-0000ec80: 7469 6d65 2c20 7374 7265 616d 5b30 5d2e  time, stream[0].
-0000ec90: 7374 6174 732e 7374 6172 7474 696d 6520  stats.starttime 
-0000eca0: 2b20 7761 726d 7570 5f74 696d 655d 290a  + warmup_time]).
-0000ecb0: 2020 2020 666f 7220 692c 2077 696e 646f      for i, windo
-0000ecc0: 7720 696e 2065 6e75 6d65 7261 7465 2873  w in enumerate(s
-0000ecd0: 6f72 7465 645f 7769 6e64 6f77 5f6c 6973  orted_window_lis
-0000ece0: 7429 3a0a 2020 2020 2020 2020 666f 7220  t):.        for 
-0000ecf0: 6a2c 2069 7465 6d20 696e 2065 6e75 6d65  j, item in enume
-0000ed00: 7261 7465 2877 696e 646f 7729 3a0a 2020  rate(window):.  
-0000ed10: 2020 2020 2020 2020 2020 6966 206a 203d            if j =
-0000ed20: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0000ed30: 2020 2020 2077 696e 646f 775f 6761 7073       window_gaps
-0000ed40: 5f6f 6273 7079 2e61 7070 656e 6428 5b30  _obspy.append([0
-0000ed50: 2c30 5d29 0a20 2020 2020 2020 2020 2020  ,0]).           
-0000ed60: 2077 696e 646f 775f 6761 7073 5f6f 6273   window_gaps_obs
-0000ed70: 7079 5b69 2b31 5d5b 6a5d 203d 206f 6273  py[i+1][j] = obs
-0000ed80: 7079 2e55 5443 4461 7465 5469 6d65 286d  py.UTCDateTime(m
-0000ed90: 6174 706c 6f74 6c69 622e 6461 7465 732e  atplotlib.dates.
-0000eda0: 6e75 6d32 6461 7465 2869 7465 6d29 290a  num2date(item)).
-0000edb0: 2020 2020 2020 2020 7769 6e64 6f77 5f67          window_g
-0000edc0: 6170 732e 6170 7065 6e64 2828 7769 6e64  aps.append((wind
-0000edd0: 6f77 5b31 5d2d 7769 6e64 6f77 5b30 5d29  ow[1]-window[0])
-0000ede0: 2a38 3634 3030 290a 2020 2020 7769 6e64  *86400).    wind
-0000edf0: 6f77 5f67 6170 735f 6f62 7370 792e 6170  ow_gaps_obspy.ap
-0000ee00: 7065 6e64 285b 7374 7265 616d 5b30 5d2e  pend([stream[0].
-0000ee10: 7374 6174 732e 656e 6474 696d 652d 6275  stats.endtime-bu
-0000ee20: 6666 6572 5f74 696d 652c 2073 7472 6561  ffer_time, strea
-0000ee30: 6d5b 305d 2e73 7461 7473 2e65 6e64 7469  m[0].stats.endti
-0000ee40: 6d65 2d62 7566 6665 725f 7469 6d65 5d29  me-buffer_time])
-0000ee50: 0a20 2020 2023 4e6f 7465 2c20 7765 2061  .    #Note, we a
-0000ee60: 6464 6564 2073 7461 7274 2061 6e64 2065  dded start and e
-0000ee70: 6e64 7469 6d65 7320 746f 206f 6270 7379  ndtimes to obpsy
-0000ee80: 206c 6973 7420 746f 2068 656c 7020 7769   list to help wi
-0000ee90: 7468 206c 6174 6572 2066 756e 6374 696f  th later functio
-0000eea0: 6e61 6c69 7479 0a0a 2020 2020 2343 6c65  nality..    #Cle
-0000eeb0: 616e 2075 7020 7374 7265 616d 2077 696e  an up stream win
-0000eec0: 646f 7773 2028 6573 7065 6369 616c 6c79  dows (especially
-0000eed0: 2c20 7374 6172 7420 616e 6420 656e 6429  , start and end)
-0000eee0: 0a20 2020 2066 6f72 2069 2c20 7769 6e64  .    for i, wind
-0000eef0: 6f77 2069 6e20 656e 756d 6572 6174 6528  ow in enumerate(
-0000ef00: 7769 6e64 6f77 5f67 6170 7329 3a0a 2020  window_gaps):.  
-0000ef10: 2020 2020 2020 6e65 7753 7420 3d20 7374        newSt = st
-0000ef20: 7265 616d 2e63 6f70 7928 290a 2020 2020  ream.copy().    
-0000ef30: 2020 2020 2343 6865 636b 2069 6620 6669      #Check if fi
-0000ef40: 7273 7420 7769 6e64 6f77 2073 7461 7274  rst window start
-0000ef50: 7320 6265 666f 7265 2065 6e64 206f 6620  s before end of 
-0000ef60: 7761 726d 7570 2074 696d 650a 2020 2020  warmup time.    
-0000ef70: 2020 2020 2349 6620 7468 6520 7374 6172      #If the star
-0000ef80: 7420 6f66 2074 6865 2066 6972 7374 2065  t of the first e
-0000ef90: 7863 6c75 7369 6f6e 2077 696e 646f 7720  xclusion window 
-0000efa0: 6973 2062 6566 6f72 6520 7468 6520 7761  is before the wa
-0000efb0: 726d 7570 5f74 696d 6520 6973 206f 7665  rmup_time is ove
-0000efc0: 720a 2020 2020 2020 2020 6966 2077 696e  r.        if win
-0000efd0: 646f 775f 6761 7073 5f6f 6273 7079 5b69  dow_gaps_obspy[i
-0000efe0: 2b31 5d5b 305d 202d 206e 6577 5374 5b30  +1][0] - newSt[0
-0000eff0: 5d2e 7374 6174 732e 7374 6172 7474 696d  ].stats.starttim
-0000f000: 6520 3c20 7761 726d 7570 5f74 696d 653a  e < warmup_time:
-0000f010: 0a20 2020 2020 2020 2020 2020 2023 4966  .            #If
-0000f020: 2074 6865 2065 6e64 206f 6620 6669 7273   the end of firs
-0000f030: 7420 6578 636c 7573 696f 6e20 7769 6e64  t exclusion wind
-0000f040: 6f77 2069 7320 616c 736f 2062 6566 6f72  ow is also befor
-0000f050: 6520 7468 6520 7761 726d 7570 5f74 696d  e the warmup_tim
-0000f060: 6520 6973 206f 7665 720a 2020 2020 2020  e is over.      
-0000f070: 2020 2020 2020 6966 2077 696e 646f 775f        if window_
-0000f080: 6761 7073 5f6f 6273 7079 5b69 2b31 5d5b  gaps_obspy[i+1][
-0000f090: 315d 202d 206e 6577 5374 5b30 5d2e 7374  1] - newSt[0].st
-0000f0a0: 6174 732e 7374 6172 7474 696d 6520 3c20  ats.starttime < 
-0000f0b0: 7761 726d 7570 5f74 696d 653a 0a20 2020  warmup_time:.   
-0000f0c0: 2020 2020 2020 2020 2020 2020 2023 5265               #Re
-0000f0d0: 6d6f 7665 2074 6861 7420 7769 6e64 6f77  move that window
-0000f0e0: 2063 6f6d 706c 6574 656c 792c 2069 7420   completely, it 
-0000f0f0: 6973 2075 6e6e 6563 6573 7361 7279 0a20  is unnecessary. 
-0000f100: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0000f110: 696e 646f 775f 6761 7073 2e70 6f70 2869  indow_gaps.pop(i
-0000f120: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000f130: 2020 7769 6e64 6f77 5f67 6170 735f 6f62    window_gaps_ob
-0000f140: 7370 792e 706f 7028 692b 3129 0a20 2020  spy.pop(i+1).   
-0000f150: 2020 2020 2020 2020 2020 2020 2023 2e2e               #..
-0000f160: 2e61 6e64 2072 6573 6574 2074 6865 2065  .and reset the e
-0000f170: 6e74 6972 6520 7769 6e64 6f77 2074 6f20  ntire window to 
-0000f180: 7374 6172 7420 6174 2074 6865 2077 6172  start at the war
-0000f190: 6d75 705f 7469 6d65 2065 6e64 0a20 2020  mup_time end.   
-0000f1a0: 2020 2020 2020 2020 2020 2020 2077 696e               win
-0000f1b0: 646f 775f 6761 7073 5f6f 6273 7079 5b30  dow_gaps_obspy[0
-0000f1c0: 5d5b 305d 203d 2077 696e 646f 775f 6761  ][0] = window_ga
-0000f1d0: 7073 5f6f 6273 7079 5b30 5d5b 315d 203d  ps_obspy[0][1] =
-0000f1e0: 206e 6577 5374 5b30 5d2e 7374 6174 732e   newSt[0].stats.
-0000f1f0: 7374 6172 7474 696d 6520 2b20 7761 726d  starttime + warm
-0000f200: 7570 5f74 696d 650a 2020 2020 2020 2020  up_time.        
-0000f210: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-0000f220: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000f230: 653a 2023 6966 2077 696e 646f 7720 6f76  e: #if window ov
-0000f240: 6572 6c61 7073 2074 6865 2073 7461 7274  erlaps the start
-0000f250: 206f 6620 7468 6520 7374 7265 616d 2061   of the stream a
-0000f260: 6674 6572 2077 6172 6d75 705f 7469 6d65  fter warmup_time
-0000f270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f280: 2023 5265 6d6f 7665 2074 6861 7420 7769   #Remove that wi
-0000f290: 6e64 6f77 0a20 2020 2020 2020 2020 2020  ndow.           
-0000f2a0: 2020 2020 2077 696e 646f 775f 6761 7073       window_gaps
-0000f2b0: 2e70 6f70 2869 290a 2020 2020 2020 2020  .pop(i).        
-0000f2c0: 2020 2020 2020 2020 232e 2e2e 616e 6420          #...and 
-0000f2d0: 7265 7365 7420 7468 6520 7374 6172 7420  reset the start 
-0000f2e0: 6f66 2074 6865 2077 696e 646f 7720 746f  of the window to
-0000f2f0: 2062 6520 7468 6520 656e 6420 6f66 2077   be the end of w
-0000f300: 6172 6d20 7570 2074 696d 650a 2020 2020  arm up time.    
-0000f310: 2020 2020 2020 2020 2020 2020 232e 2e2e              #...
-0000f320: 616e 6420 2072 656d 6f76 6520 7468 6174  and  remove that
-0000f330: 2066 6972 7374 2077 696e 646f 7720 6672   first window fr
-0000f340: 6f6d 2074 6865 206f 6273 7079 206c 6973  om the obspy lis
-0000f350: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0000f360: 2020 7769 6e64 6f77 5f67 6170 735f 6f62    window_gaps_ob
-0000f370: 7370 795b 305d 5b30 5d20 3d20 7769 6e64  spy[0][0] = wind
-0000f380: 6f77 5f67 6170 735f 6f62 7370 795b 305d  ow_gaps_obspy[0]
-0000f390: 5b31 5d20 3d20 2077 696e 646f 775f 6761  [1] =  window_ga
-0000f3a0: 7073 5f6f 6273 7079 5b69 2b31 5d5b 315d  ps_obspy[i+1][1]
-0000f3b0: 236e 6577 5374 5b30 5d2e 7374 6174 732e  #newSt[0].stats.
-0000f3c0: 7374 6172 7474 696d 6520 2b20 7761 726d  starttime + warm
-0000f3d0: 7570 5f74 696d 650a 2020 2020 2020 2020  up_time.        
-0000f3e0: 2020 2020 2020 2020 7769 6e64 6f77 5f67          window_g
-0000f3f0: 6170 735f 6f62 7370 792e 706f 7028 692b  aps_obspy.pop(i+
-0000f400: 3129 0a0a 0a20 2020 2020 2020 2069 6620  1)...        if 
-0000f410: 7374 7265 616d 5b30 5d2e 7374 6174 732e  stream[0].stats.
-0000f420: 656e 6474 696d 6520 2d20 7769 6e64 6f77  endtime - window
-0000f430: 5f67 6170 735f 6f62 7370 795b 692b 315d  _gaps_obspy[i+1]
-0000f440: 5b31 5d20 3e20 7374 7265 616d 5b30 5d2e  [1] > stream[0].
-0000f450: 7374 6174 732e 656e 6474 696d 6520 2d20  stats.endtime - 
-0000f460: 6275 6666 6572 5f74 696d 653a 2020 2020  buffer_time:    
-0000f470: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0000f480: 2069 6620 7374 7265 616d 5b30 5d2e 7374   if stream[0].st
-0000f490: 6174 732e 656e 6474 696d 6520 2d20 7769  ats.endtime - wi
-0000f4a0: 6e64 6f77 5f67 6170 735f 6f62 7370 795b  ndow_gaps_obspy[
-0000f4b0: 692b 315d 5b30 5d20 3e20 7374 7265 616d  i+1][0] > stream
-0000f4c0: 5b30 5d2e 7374 6174 732e 656e 6474 696d  [0].stats.endtim
-0000f4d0: 6520 2d20 6275 6666 6572 5f74 696d 653a  e - buffer_time:
-0000f4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f4f0: 2077 696e 646f 775f 6761 7073 2e70 6f70   window_gaps.pop
-0000f500: 2869 290a 2020 2020 2020 2020 2020 2020  (i).            
-0000f510: 2020 2020 7769 6e64 6f77 5f67 6170 735f      window_gaps_
-0000f520: 6f62 7370 792e 706f 7028 692b 3129 0a20  obspy.pop(i+1). 
-0000f530: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000f540: 2020 2369 6620 656e 6420 6f66 2077 696e    #if end of win
-0000f550: 646f 7720 6f76 6572 6c61 7073 2074 6865  dow overlaps the
-0000f560: 2062 7566 6665 7220 7469 6d65 2c20 6a75   buffer time, ju
-0000f570: 7374 2065 6e64 2069 7420 6174 2074 6865  st end it at the
-0000f580: 2073 7461 7274 206f 6620 7468 6520 7769   start of the wi
-0000f590: 6e64 6f77 2028 616c 7761 7973 2065 6e64  ndow (always end
-0000f5a0: 2077 6974 6820 7374 7265 616d 2c20 6e6f   with stream, no
-0000f5b0: 7420 6761 7029 0a20 2020 2020 2020 2020  t gap).         
-0000f5c0: 2020 2020 2020 2077 696e 646f 775f 6761         window_ga
-0000f5d0: 7073 2e70 6f70 2869 290a 2020 2020 2020  ps.pop(i).      
-0000f5e0: 2020 2020 2020 2020 2020 7769 6e64 6f77            window
-0000f5f0: 5f67 6170 735f 6f62 7370 795b 2d31 5d5b  _gaps_obspy[-1][
-0000f600: 305d 203d 2077 696e 646f 775f 6761 7073  0] = window_gaps
-0000f610: 5f6f 6273 7079 5b2d 315d 5b31 5d20 3d20  _obspy[-1][1] = 
-0000f620: 6e65 7753 745b 305d 2e73 7461 7473 2e65  newSt[0].stats.e
-0000f630: 6e64 7469 6d65 202d 2062 7566 6665 725f  ndtime - buffer_
-0000f640: 7469 6d65 0a20 2020 0a20 2020 2023 4164  time.   .    #Ad
-0000f650: 6420 7374 7265 616d 730a 2020 2020 7374  d streams.    st
-0000f660: 7265 616d 5f77 696e 646f 7773 203d 205b  ream_windows = [
-0000f670: 5d0a 2020 2020 6a20 3d20 300a 2020 2020  ].    j = 0.    
-0000f680: 666f 7220 692c 2077 696e 646f 7720 696e  for i, window in
-0000f690: 2065 6e75 6d65 7261 7465 2877 696e 646f   enumerate(windo
-0000f6a0: 775f 6761 7073 293a 0a20 2020 2020 2020  w_gaps):.       
-0000f6b0: 206a 3d69 0a20 2020 2020 2020 206e 6577   j=i.        new
-0000f6c0: 5374 203d 2073 7472 6561 6d2e 636f 7079  St = stream.copy
-0000f6d0: 2829 0a20 2020 2020 2020 2073 7472 6561  ().        strea
-0000f6e0: 6d5f 7769 6e64 6f77 732e 6170 7065 6e64  m_windows.append
-0000f6f0: 286e 6577 5374 2e74 7269 6d28 7374 6172  (newSt.trim(star
-0000f700: 7474 696d 653d 7769 6e64 6f77 5f67 6170  ttime=window_gap
-0000f710: 735f 6f62 7370 795b 695d 5b31 5d2c 2065  s_obspy[i][1], e
-0000f720: 6e64 7469 6d65 3d77 696e 646f 775f 6761  ndtime=window_ga
-0000f730: 7073 5f6f 6273 7079 5b69 2b31 5d5b 305d  ps_obspy[i+1][0]
-0000f740: 2929 0a20 2020 2069 203d 206a 202b 2031  )).    i = j + 1
-0000f750: 0a20 2020 206e 6577 5374 203d 2073 7472  .    newSt = str
-0000f760: 6561 6d2e 636f 7079 2829 0a20 2020 2073  eam.copy().    s
-0000f770: 7472 6561 6d5f 7769 6e64 6f77 732e 6170  tream_windows.ap
-0000f780: 7065 6e64 286e 6577 5374 2e74 7269 6d28  pend(newSt.trim(
-0000f790: 7374 6172 7474 696d 653d 7769 6e64 6f77  starttime=window
-0000f7a0: 5f67 6170 735f 6f62 7370 795b 695d 5b31  _gaps_obspy[i][1
-0000f7b0: 5d2c 2065 6e64 7469 6d65 3d77 696e 646f  ], endtime=windo
-0000f7c0: 775f 6761 7073 5f6f 6273 7079 5b69 2b31  w_gaps_obspy[i+1
-0000f7d0: 5d5b 305d 2929 0a0a 2020 2020 666f 7220  ][0]))..    for 
-0000f7e0: 692c 2073 7420 696e 2065 6e75 6d65 7261  i, st in enumera
-0000f7f0: 7465 2873 7472 6561 6d5f 7769 6e64 6f77  te(stream_window
-0000f800: 7329 3a0a 2020 2020 2020 2020 6966 2069  s):.        if i
-0000f810: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0000f820: 2020 206f 7574 5374 7265 616d 203d 2073     outStream = s
-0000f830: 742e 636f 7079 2829 0a20 2020 2020 2020  t.copy().       
-0000f840: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000f850: 2020 206e 6577 5374 203d 2073 742e 636f     newSt = st.co
-0000f860: 7079 2829 0a20 2020 2020 2020 2020 2020  py().           
-0000f870: 2067 6170 203d 2077 696e 646f 775f 6761   gap = window_ga
-0000f880: 7073 5b69 2d31 5d0a 2020 2020 2020 2020  ps[i-1].        
-0000f890: 2020 2020 6f75 7453 7472 6561 6d20 3d20      outStream = 
-0000f8a0: 6f75 7453 7472 6561 6d20 2b20 6e65 7753  outStream + newS
-0000f8b0: 742e 7472 696d 2873 7461 7274 7469 6d65  t.trim(starttime
-0000f8c0: 3d73 745b 305d 2e73 7461 7473 2e73 7461  =st[0].stats.sta
-0000f8d0: 7274 7469 6d65 202d 2067 6170 2c20 7061  rttime - gap, pa
-0000f8e0: 643d 5472 7565 2c20 6669 6c6c 5f76 616c  d=True, fill_val
-0000f8f0: 7565 3d4e 6f6e 6529 2020 2020 2020 200a  ue=None)       .
-0000f900: 2020 2020 6f75 7453 7472 6561 6d2e 6d65      outStream.me
-0000f910: 7267 6528 290a 2020 2020 7265 7475 726e  rge().    return
-0000f920: 206f 7574 5374 7265 616d 0a0a 2348 656c   outStream..#Hel
-0000f930: 7065 7220 6675 6e63 7469 6f6e 2066 6f72  per function for
-0000f940: 2072 656d 6f76 696e 6720 6761 7073 0a64   removing gaps.d
-0000f950: 6566 205f 5f72 656d 6f76 655f 6761 7073  ef __remove_gaps
-0000f960: 2873 7472 6561 6d2c 2077 696e 646f 775f  (stream, window_
-0000f970: 6761 7073 5f6f 6273 7079 293a 0a20 2020  gaps_obspy):.   
-0000f980: 2022 2222 4865 6c70 6572 2066 756e 6374   """Helper funct
-0000f990: 696f 6e20 666f 7220 7265 6d6f 7669 6e67  ion for removing
-0000f9a0: 2067 6170 7322 2222 0a20 2020 2023 636f   gaps""".    #co
-0000f9b0: 6d62 696e 6520 6f76 6572 6c61 7070 696e  mbine overlappin
-0000f9c0: 6720 7769 6e64 6f77 730a 2020 2020 2354  g windows.    #T
-0000f9d0: 4849 5320 5041 5254 204e 4545 4453 2057  HIS PART NEEDS W
-0000f9e0: 4f52 4b21 2121 2121 2023 2123 0a20 2020  ORK!!!!! #!#.   
-0000f9f0: 206f 7665 726c 6170 4c69 7374 203d 205b   overlapList = [
-0000fa00: 5d0a 2020 2020 666f 7220 6920 696e 2072  ].    for i in r
-0000fa10: 616e 6765 286c 656e 2877 696e 646f 775f  ange(len(window_
-0000fa20: 6761 7073 5f6f 6273 7079 292d 3229 3a0a  gaps_obspy)-2):.
-0000fa30: 2020 2020 2020 2020 6966 2077 696e 646f          if windo
-0000fa40: 775f 6761 7073 5f6f 6273 7079 5b69 5d5b  w_gaps_obspy[i][
-0000fa50: 315d 203e 2077 696e 646f 775f 6761 7073  1] > window_gaps
-0000fa60: 5f6f 6273 7079 5b69 2b31 5d5b 305d 3a0a  _obspy[i+1][0]:.
-0000fa70: 2020 2020 2020 2020 2020 2020 6f76 6572              over
-0000fa80: 6c61 704c 6973 742e 6170 7065 6e64 2869  lapList.append(i
-0000fa90: 290a 0a20 2020 2066 6f72 2069 2c20 7420  )..    for i, t 
-0000faa0: 696e 2065 6e75 6d65 7261 7465 286f 7665  in enumerate(ove
-0000fab0: 726c 6170 4c69 7374 293a 0a20 2020 2020  rlapList):.     
-0000fac0: 2020 2069 6620 6920 3c20 6c65 6e28 7769     if i < len(wi
-0000fad0: 6e64 6f77 5f67 6170 735f 6f62 7370 7929  ndow_gaps_obspy)
-0000fae0: 2d32 3a0a 2020 2020 2020 2020 2020 2020  -2:.            
-0000faf0: 7769 6e64 6f77 5f67 6170 735f 6f62 7370  window_gaps_obsp
-0000fb00: 795b 695d 5b31 5d20 3d20 7769 6e64 6f77  y[i][1] = window
-0000fb10: 5f67 6170 735f 6f62 7370 795b 692b 315d  _gaps_obspy[i+1]
-0000fb20: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
-0000fb30: 7769 6e64 6f77 5f67 6170 735f 6f62 7370  window_gaps_obsp
-0000fb40: 792e 706f 7028 692b 3129 0a0a 2020 2020  y.pop(i+1)..    
-0000fb50: 2341 6464 2073 7472 6561 6d73 0a20 2020  #Add streams.   
-0000fb60: 2077 696e 646f 775f 6761 7073 5f73 203d   window_gaps_s =
-0000fb70: 205b 5d0a 2020 2020 666f 7220 772c 2077   [].    for w, w
-0000fb80: 696e 2069 6e20 656e 756d 6572 6174 6528  in in enumerate(
-0000fb90: 7769 6e64 6f77 5f67 6170 735f 6f62 7370  window_gaps_obsp
-0000fba0: 7929 3a0a 2020 2020 2020 2020 6966 2077  y):.        if w
-0000fbb0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0000fbc0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-0000fbd0: 656c 6966 2077 203d 3d20 6c65 6e28 7769  elif w == len(wi
-0000fbe0: 6e64 6f77 5f67 6170 735f 6f62 7370 7929  ndow_gaps_obspy)
-0000fbf0: 2d31 3a0a 2020 2020 2020 2020 2020 2020  -1:.            
-0000fc00: 7061 7373 0a20 2020 2020 2020 2065 6c73  pass.        els
-0000fc10: 653a 0a20 2020 2020 2020 2020 2020 2077  e:.            w
-0000fc20: 696e 646f 775f 6761 7073 5f73 2e61 7070  indow_gaps_s.app
-0000fc30: 656e 6428 7769 6e5b 315d 2d77 696e 5b30  end(win[1]-win[0
-0000fc40: 5d29 0a0a 2020 2020 6966 206c 656e 2877  ])..    if len(w
-0000fc50: 696e 646f 775f 6761 7073 5f73 2920 3e20  indow_gaps_s) > 
-0000fc60: 303a 0a20 2020 2020 2020 2073 7472 6561  0:.        strea
-0000fc70: 6d5f 7769 6e64 6f77 7320 3d20 5b5d 0a20  m_windows = []. 
-0000fc80: 2020 2020 2020 206a 203d 2030 0a20 2020         j = 0.   
-0000fc90: 2020 2020 2066 6f72 2069 2c20 7769 6e64       for i, wind
-0000fca0: 6f77 2069 6e20 656e 756d 6572 6174 6528  ow in enumerate(
-0000fcb0: 7769 6e64 6f77 5f67 6170 735f 7329 3a0a  window_gaps_s):.
-0000fcc0: 2020 2020 2020 2020 2020 2020 6a3d 690a              j=i.
-0000fcd0: 2020 2020 2020 2020 2020 2020 6e65 7753              newS
-0000fce0: 7420 3d20 7374 7265 616d 2e63 6f70 7928  t = stream.copy(
-0000fcf0: 290a 2020 2020 2020 2020 2020 2020 7374  ).            st
-0000fd00: 7265 616d 5f77 696e 646f 7773 2e61 7070  ream_windows.app
-0000fd10: 656e 6428 6e65 7753 742e 7472 696d 2873  end(newSt.trim(s
-0000fd20: 7461 7274 7469 6d65 3d77 696e 646f 775f  tarttime=window_
-0000fd30: 6761 7073 5f6f 6273 7079 5b69 5d5b 315d  gaps_obspy[i][1]
-0000fd40: 2c20 656e 6474 696d 653d 7769 6e64 6f77  , endtime=window
-0000fd50: 5f67 6170 735f 6f62 7370 795b 692b 315d  _gaps_obspy[i+1]
-0000fd60: 5b30 5d29 290a 2020 2020 2020 2020 6920  [0])).        i 
-0000fd70: 3d20 6a20 2b20 310a 2020 2020 2020 2020  = j + 1.        
-0000fd80: 6e65 7753 7420 3d20 7374 7265 616d 2e63  newSt = stream.c
-0000fd90: 6f70 7928 290a 2020 2020 2020 2020 7374  opy().        st
-0000fda0: 7265 616d 5f77 696e 646f 7773 2e61 7070  ream_windows.app
-0000fdb0: 656e 6428 6e65 7753 742e 7472 696d 2873  end(newSt.trim(s
-0000fdc0: 7461 7274 7469 6d65 3d77 696e 646f 775f  tarttime=window_
-0000fdd0: 6761 7073 5f6f 6273 7079 5b69 5d5b 315d  gaps_obspy[i][1]
-0000fde0: 2c20 656e 6474 696d 653d 7769 6e64 6f77  , endtime=window
-0000fdf0: 5f67 6170 735f 6f62 7370 795b 692b 315d  _gaps_obspy[i+1]
-0000fe00: 5b30 5d29 290a 0a20 2020 2020 2020 2066  [0]))..        f
-0000fe10: 6f72 2069 2c20 7374 2069 6e20 656e 756d  or i, st in enum
-0000fe20: 6572 6174 6528 7374 7265 616d 5f77 696e  erate(stream_win
-0000fe30: 646f 7773 293a 0a20 2020 2020 2020 2020  dows):.         
-0000fe40: 2020 2069 6620 6920 3d3d 2030 3a0a 2020     if i == 0:.  
-0000fe50: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-0000fe60: 7453 7472 6561 6d20 3d20 7374 2e63 6f70  tStream = st.cop
-0000fe70: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
-0000fe80: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000fe90: 2020 2020 2020 6e65 7753 7420 3d20 7374        newSt = st
-0000fea0: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
-0000feb0: 2020 2020 2020 2020 6761 7020 3d20 7769          gap = wi
-0000fec0: 6e64 6f77 5f67 6170 735f 735b 692d 315d  ndow_gaps_s[i-1]
-0000fed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fee0: 206f 7574 5374 7265 616d 203d 206f 7574   outStream = out
-0000fef0: 5374 7265 616d 202b 206e 6577 5374 2e74  Stream + newSt.t
-0000ff00: 7269 6d28 7374 6172 7474 696d 653d 7374  rim(starttime=st
-0000ff10: 5b30 5d2e 7374 6174 732e 7374 6172 7474  [0].stats.startt
-0000ff20: 696d 6520 2d20 6761 702c 2070 6164 3d54  ime - gap, pad=T
-0000ff30: 7275 652c 2066 696c 6c5f 7661 6c75 653d  rue, fill_value=
-0000ff40: 4e6f 6e65 2920 2020 2020 2020 0a20 2020  None)       .   
-0000ff50: 2020 2020 206f 7574 5374 7265 616d 2e6d       outStream.m
-0000ff60: 6572 6765 2829 0a20 2020 2065 6c73 653a  erge().    else:
-0000ff70: 0a20 2020 2020 2020 206f 7574 5374 7265  .        outStre
-0000ff80: 616d 203d 2073 7472 6561 6d2e 636f 7079  am = stream.copy
-0000ff90: 2829 0a0a 2020 2020 7265 7475 726e 206f  ()..    return o
-0000ffa0: 7574 5374 7265 616d 0a0a 2348 656c 7065  utStream..#Helpe
-0000ffb0: 7220 6675 6e63 7469 6f6e 2066 6f72 2067  r function for g
-0000ffc0: 6574 7469 6e67 2077 696e 646f 7773 2074  etting windows t
-0000ffd0: 6f20 7265 6d6f 7665 206e 6f69 7365 2075  o remove noise u
-0000ffe0: 7369 6e67 2073 7461 6c74 6120 616e 7469  sing stalta anti
-0000fff0: 7472 6967 6765 7220 6d65 7468 6f64 0a64  trigger method.d
-00010000: 6566 205f 5f72 656d 6f76 655f 616e 7469  ef __remove_anti
-00010010: 5f73 7461 6c74 6128 7374 7265 616d 2c20  _stalta(stream, 
-00010020: 7374 612c 206c 7461 2c20 7468 7265 7368  sta, lta, thresh
-00010030: 2c20 7368 6f77 5f70 6c6f 743d 4661 6c73  , show_plot=Fals
-00010040: 6529 3a0a 2020 2020 2222 2248 656c 7065  e):.    """Helpe
-00010050: 7220 6675 6e63 7469 6f6e 2066 6f72 2067  r function for g
-00010060: 6574 7469 6e67 2077 696e 646f 7773 2074  etting windows t
-00010070: 6f20 7265 6d6f 7665 206e 6f69 7365 2075  o remove noise u
-00010080: 7369 6e67 2073 7461 6c74 6120 616e 7469  sing stalta anti
-00010090: 7472 6967 6765 7220 6d65 7468 6f64 0a0a  trigger method..
-000100a0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-000100b0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-000100c0: 2020 7374 7265 616d 203a 206f 6273 7079    stream : obspy
-000100d0: 2e63 6f72 652e 7374 7265 616d 2e53 7472  .core.stream.Str
-000100e0: 6561 6d20 6f62 6a65 6374 0a20 2020 2020  eam object.     
-000100f0: 2020 2049 6e70 7574 2073 7472 6561 6d20     Input stream 
-00010100: 6f6e 2077 6869 6368 2074 6f20 7065 7266  on which to perf
-00010110: 6f72 6d20 6e6f 6973 6520 7265 6d6f 7661  orm noise remova
-00010120: 6c0a 2020 2020 7374 6120 3a20 696e 740a  l.    sta : int.
-00010130: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
-00010140: 6620 7365 636f 6e64 7320 746f 2075 7365  f seconds to use
-00010150: 2061 7320 7368 6f72 7420 7465 726d 2077   as short term w
-00010160: 696e 646f 772c 2072 6561 6473 2066 726f  indow, reads fro
-00010170: 6d20 7265 6d6f 7665 5f6e 6f69 7365 2829  m remove_noise()
-00010180: 2066 756e 6374 696f 6e2e 0a20 2020 206c   function..    l
-00010190: 7461 203a 2069 6e74 0a20 2020 2020 2020  ta : int.       
-000101a0: 204e 756d 6265 7220 6f66 2073 6563 6f6e   Number of secon
-000101b0: 6473 2074 6f20 7573 6520 6173 206c 6f6e  ds to use as lon
-000101c0: 6720 7465 726d 2077 696e 646f 772c 2072  g term window, r
-000101d0: 6561 6473 2066 726f 6d20 7265 6d6f 7665  eads from remove
-000101e0: 5f6e 6f69 7365 2829 2066 756e 6374 696f  _noise() functio
-000101f0: 6e2e 0a20 2020 2074 6872 6573 6820 3a20  n..    thresh : 
-00010200: 6c69 7374 0a20 2020 2020 2020 2054 776f  list.        Two
-00010210: 2d69 7465 6d20 6c69 7374 206f 7220 7475  -item list or tu
-00010220: 706c 6520 7769 7468 2074 6865 2074 6872  ple with the thr
-00010230: 6573 686f 6c64 7320 666f 7220 7468 6520  esholds for the 
-00010240: 7374 616c 7461 2061 6e74 6974 7269 6767  stalta antitrigg
-00010250: 6572 2e20 5265 6164 7320 6672 6f6d 2072  er. Reads from r
-00010260: 656d 6f76 655f 6e6f 6973 6528 2920 6675  emove_noise() fu
-00010270: 6e63 7469 6f6e 2e20 5468 6520 6669 7273  nction. The firs
-00010280: 7420 7661 6c75 6520 2869 6e64 6578 205b  t value (index [
-00010290: 305d 2920 6973 2074 6865 206c 6f77 6572  0]) is the lower
-000102a0: 2074 6872 6573 686f 6c64 2c20 7468 6520   threshold, the 
-000102b0: 7365 636f 6e64 2076 616c 7565 2028 696e  second value (in
-000102c0: 6465 7820 5b31 5d20 6973 2074 6865 2075  dex [1] is the u
-000102d0: 7070 6572 2074 6872 6573 686f 6c64 292c  pper threshold),
-000102e0: 2062 7920 6465 6661 756c 7420 5b30 2e35   by default [0.5
-000102f0: 2c35 5d0a 2020 2020 7368 6f77 5f70 6c6f  ,5].    show_plo
-00010300: 7420 3a20 626f 6f6c 0a20 2020 2020 2020  t : bool.       
-00010310: 2049 6620 5472 7565 2c20 7769 6c6c 2070   If True, will p
-00010320: 6c6f 7420 7468 6520 7472 6967 6765 7220  lot the trigger 
-00010330: 616e 6420 7374 616c 7461 2076 616c 7565  and stalta value
-00010340: 732e 2052 6561 6473 2066 726f 6d20 7265  s. Reads from re
-00010350: 6d6f 7665 5f6e 6f69 7365 2829 2066 756e  move_noise() fun
-00010360: 6374 696f 6e2c 2062 7920 6465 6661 756c  ction, by defaul
-00010370: 7420 4661 6c73 652e 0a0a 2020 2020 5265  t False...    Re
-00010380: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-00010390: 2d0a 2020 2020 6f75 7453 7472 6561 6d20  -.    outStream 
-000103a0: 3a20 6f62 7370 792e 636f 7265 2e73 7472  : obspy.core.str
-000103b0: 6561 6d2e 5374 7265 616d 206f 626a 6563  eam.Stream objec
-000103c0: 740a 2020 2020 2020 2020 5374 7265 616d  t.        Stream
-000103d0: 2077 6974 6820 6120 6d61 736b 6564 2061   with a masked a
-000103e0: 7272 6179 2066 6f72 2074 6865 2064 6174  rray for the dat
-000103f0: 6120 7768 6572 6520 276e 6f69 7365 2720  a where 'noise' 
-00010400: 6861 7320 6265 656e 2072 656d 6f76 6564  has been removed
-00010410: 0a0a 2020 2020 2222 220a 2020 2020 6672  ..    """.    fr
-00010420: 6f6d 206f 6273 7079 2e73 6967 6e61 6c2e  om obspy.signal.
-00010430: 7472 6967 6765 7220 696d 706f 7274 2063  trigger import c
-00010440: 6c61 7373 6963 5f73 7461 5f6c 7461 0a0a  lassic_sta_lta..
-00010450: 2020 2020 7361 6d70 6c65 5261 7465 203d      sampleRate =
-00010460: 2066 6c6f 6174 2873 7472 6561 6d5b 305d   float(stream[0]
-00010470: 2e73 7461 7473 2e64 656c 7461 290a 0a20  .stats.delta).. 
-00010480: 2020 2073 7461 5f73 616d 706c 6573 203d     sta_samples =
-00010490: 2073 7461 202f 2073 616d 706c 6552 6174   sta / sampleRat
-000104a0: 6520 2343 6f6e 7665 7274 2074 6f20 7361  e #Convert to sa
-000104b0: 6d70 6c65 730a 2020 2020 6c74 615f 7361  mples.    lta_sa
-000104c0: 6d70 6c65 7320 3d20 6c74 6120 2f20 7361  mples = lta / sa
-000104d0: 6d70 6c65 5261 7465 2023 436f 6e76 6572  mpleRate #Conver
-000104e0: 7420 746f 2073 616d 706c 6573 0a20 2020  t to samples.   
-000104f0: 2073 7461 6c74 6153 7472 6561 6d20 3d20   staltaStream = 
-00010500: 7374 7265 616d 2e63 6f70 7928 290a 0a20  stream.copy().. 
-00010510: 2020 2066 6f72 2074 7220 696e 2073 7461     for tr in sta
-00010520: 6c74 6153 7472 6561 6d3a 0a20 2020 2020  ltaStream:.     
-00010530: 2020 2063 6861 7261 6374 6572 6973 7469     characteristi
-00010540: 635f 6675 6e20 3d20 636c 6173 7369 635f  c_fun = classic_
-00010550: 7374 615f 6c74 6128 7472 2c20 6e73 7461  sta_lta(tr, nsta
-00010560: 3d73 7461 5f73 616d 706c 6573 2c20 6e6c  =sta_samples, nl
-00010570: 7461 3d6c 7461 5f73 616d 706c 6573 290a  ta=lta_samples).
-00010580: 2020 2020 6966 2073 686f 775f 706c 6f74      if show_plot
-00010590: 3a0a 2020 2020 2020 2020 6f62 7370 792e  :.        obspy.
-000105a0: 7369 676e 616c 2e74 7269 6767 6572 2e70  signal.trigger.p
-000105b0: 6c6f 745f 7472 6967 6765 7228 7472 2c20  lot_trigger(tr, 
-000105c0: 6368 6172 6163 7465 7269 7374 6963 5f66  characteristic_f
-000105d0: 756e 2c20 7468 7265 7368 5b31 5d2c 2074  un, thresh[1], t
-000105e0: 6872 6573 685b 305d 290a 2020 2020 7769  hresh[0]).    wi
-000105f0: 6e64 6f77 735f 7361 6d70 6c65 7320 3d20  ndows_samples = 
-00010600: 6f62 7370 792e 7369 676e 616c 2e74 7269  obspy.signal.tri
-00010610: 6767 6572 2e74 7269 6767 6572 5f6f 6e73  gger.trigger_ons
-00010620: 6574 2863 6861 7261 6374 6572 6973 7469  et(characteristi
-00010630: 635f 6675 6e2c 2074 6872 6573 685b 315d  c_fun, thresh[1]
-00010640: 2c20 7468 7265 7368 5b30 5d29 0a20 2020  , thresh[0]).   
-00010650: 200a 2020 2020 7374 6172 7454 203d 2073   .    startT = s
-00010660: 7472 6561 6d5b 305d 2e73 7461 7473 2e73  tream[0].stats.s
-00010670: 7461 7274 7469 6d65 0a20 2020 2065 6e64  tarttime.    end
-00010680: 5420 3d20 7374 7265 616d 5b30 5d2e 7374  T = stream[0].st
-00010690: 6174 732e 656e 6474 696d 650a 2020 2020  ats.endtime.    
-000106a0: 7769 6e64 6f77 5f55 5443 203d 205b 5d0a  window_UTC = [].
-000106b0: 2020 2020 7769 6e64 6f77 5f4d 504c 203d      window_MPL =
-000106c0: 205b 5d0a 2020 2020 7769 6e64 6f77 5f55   [].    window_U
-000106d0: 5443 2e61 7070 656e 6428 5b73 7461 7274  TC.append([start
-000106e0: 542c 2073 7461 7274 545d 290a 2020 2020  T, startT]).    
-000106f0: 666f 7220 772c 2077 696e 2069 6e20 656e  for w, win in en
-00010700: 756d 6572 6174 6528 7769 6e64 6f77 735f  umerate(windows_
-00010710: 7361 6d70 6c65 7329 3a0a 2020 2020 2020  samples):.      
-00010720: 2020 666f 7220 692c 2074 2069 6e20 656e    for i, t in en
-00010730: 756d 6572 6174 6528 7769 6e29 3a0a 2020  umerate(win):.  
-00010740: 2020 2020 2020 2020 2020 6966 2069 203d            if i =
-00010750: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00010760: 2020 2020 2077 696e 646f 775f 5554 432e       window_UTC.
-00010770: 6170 7065 6e64 285b 5d29 0a20 2020 2020  append([]).     
-00010780: 2020 2020 2020 2020 2020 2077 696e 646f             windo
-00010790: 775f 4d50 4c2e 6170 7065 6e64 285b 5d29  w_MPL.append([])
-000107a0: 0a20 2020 2020 2020 2020 2020 2074 7269  .            tri
-000107b0: 6753 6869 6674 203d 2073 7461 0a20 2020  gShift = sta.   
-000107c0: 2020 2020 2020 2020 2069 6620 7472 6967           if trig
-000107d0: 5368 6966 7420 3e20 7420 2a20 7361 6d70  Shift > t * samp
-000107e0: 6c65 5261 7465 3a0a 2020 2020 2020 2020  leRate:.        
-000107f0: 2020 2020 2020 2020 7472 6967 5368 6966          trigShif
-00010800: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
-00010810: 2020 7453 6563 203d 2074 202a 2073 616d    tSec = t * sam
-00010820: 706c 6552 6174 6520 2d20 7472 6967 5368  pleRate - trigSh
-00010830: 6966 740a 2020 2020 2020 2020 2020 2020  ift.            
-00010840: 7769 6e64 6f77 5f55 5443 5b77 2b31 5d2e  window_UTC[w+1].
-00010850: 6170 7065 6e64 2873 7461 7274 542b 7453  append(startT+tS
-00010860: 6563 290a 2020 2020 2020 2020 2020 2020  ec).            
-00010870: 7769 6e64 6f77 5f4d 504c 5b77 5d2e 6170  window_MPL[w].ap
-00010880: 7065 6e64 2877 696e 646f 775f 5554 435b  pend(window_UTC[
-00010890: 775d 5b69 5d2e 6d61 7470 6c6f 746c 6962  w][i].matplotlib
-000108a0: 5f64 6174 6529 0a20 2020 200a 2020 2020  _date).    .    
-000108b0: 7769 6e64 6f77 5f55 5443 2e61 7070 656e  window_UTC.appen
-000108c0: 6428 5b65 6e64 542c 2065 6e64 545d 290a  d([endT, endT]).
-000108d0: 2020 2020 2377 696e 646f 775f 4d50 4c5b      #window_MPL[
-000108e0: 775d 2e61 7070 656e 6428 7769 6e64 6f77  w].append(window
-000108f0: 5f55 5443 5b77 5d5b 695d 2e6d 6174 706c  _UTC[w][i].matpl
-00010900: 6f74 6c69 625f 6461 7465 290a 2020 2020  otlib_date).    
-00010910: 6f75 7453 7472 6561 6d20 3d20 5f5f 7265  outStream = __re
-00010920: 6d6f 7665 5f67 6170 7328 7374 7265 616d  move_gaps(stream
-00010930: 2c20 7769 6e64 6f77 5f55 5443 290a 2020  , window_UTC).  
-00010940: 2020 7265 7475 726e 206f 7574 5374 7265    return outStre
-00010950: 616d 0a0a 2352 656d 6f76 6520 6e6f 6973  am..#Remove nois
-00010960: 6520 7361 7475 7261 7469 6f6e 0a64 6566  e saturation.def
-00010970: 205f 5f72 656d 6f76 655f 6e6f 6973 655f   __remove_noise_
-00010980: 7361 7475 7261 7465 2873 7472 6561 6d2c  saturate(stream,
-00010990: 2073 6174 5f70 6572 6365 6e74 2c20 6d69   sat_percent, mi
-000109a0: 6e5f 7769 6e5f 7369 7a65 293a 0a20 2020  n_win_size):.   
-000109b0: 2022 2222 4675 6e63 7469 6f6e 2074 6f20   """Function to 
-000109c0: 7265 6d6f 7665 2022 7361 7475 7261 7465  remove "saturate
-000109d0: 6422 2064 6174 6120 706f 696e 7473 2074  d" data points t
-000109e0: 6861 7420 6578 6365 6564 2061 2063 6572  hat exceed a cer
-000109f0: 7461 696e 2070 6572 6365 6e74 2028 7361  tain percent (sa
-00010a00: 745f 7065 7263 656e 7429 206f 6620 7468  t_percent) of th
-00010a10: 6520 6d61 7869 6d75 6d20 6461 7461 2076  e maximum data v
-00010a20: 616c 7565 2069 6e20 7468 6520 7374 7265  alue in the stre
-00010a30: 616d 2e20 200a 0a20 2020 2050 6172 616d  am.  ..    Param
-00010a40: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-00010a50: 2d2d 2d2d 0a20 2020 2073 7472 6561 6d20  ----.    stream 
-00010a60: 3a20 6f62 7370 792e 5374 7265 616d 0a20  : obspy.Stream. 
-00010a70: 2020 2020 2020 204f 6273 7079 2053 7472         Obspy Str
-00010a80: 6561 6d20 6f66 2069 6e74 6572 6573 740a  eam of interest.
-00010a90: 2020 2020 7361 745f 7065 7263 656e 7420      sat_percent 
-00010aa0: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
-00010ab0: 5065 7263 656e 7461 6765 206f 6620 7468  Percentage of th
-00010ac0: 6520 6d61 7869 6d75 6d20 616d 706c 6974  e maximum amplit
-00010ad0: 7564 652c 2077 6869 6368 2077 696c 6c20  ude, which will 
-00010ae0: 6265 2075 7365 6420 6173 2074 6865 2073  be used as the s
-00010af0: 6174 7572 6174 696f 6e20 7468 7265 7368  aturation thresh
-00010b00: 6f6c 6420 6162 6f76 6520 7768 6963 6820  old above which 
-00010b10: 6461 7461 2070 6f69 6e74 7320 7769 6c6c  data points will
-00010b20: 2062 6520 6578 636c 7564 6564 0a20 2020   be excluded.   
-00010b30: 206d 696e 5f77 696e 5f73 697a 6520 3a20   min_win_size : 
-00010b40: 666c 6f61 740a 2020 2020 2020 2020 5468  float.        Th
-00010b50: 6520 6d69 6e75 6d75 6d20 7369 7a65 2061  e minumum size a
-00010b60: 2077 696e 646f 7720 6d75 7374 2062 6520   window must be 
-00010b70: 2869 6e20 7365 636f 6e64 7329 2066 6f72  (in seconds) for
-00010b80: 2069 7420 746f 2062 6520 7265 6d6f 7665   it to be remove
-00010b90: 640a 0a20 2020 2052 6574 7572 6e73 0a20  d..    Returns. 
-00010ba0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 206f     -------.    o
-00010bb0: 6273 7079 2e53 7472 6561 6d0a 2020 2020  bspy.Stream.    
-00010bc0: 2020 2020 5374 7265 616d 2077 6974 6820      Stream with 
-00010bd0: 6d61 736b 6564 2061 7272 6179 2028 6966  masked array (if
-00010be0: 2064 6174 6120 7265 6d6f 7665 6429 2077   data removed) w
-00010bf0: 6974 6820 2273 6174 7572 6174 6564 2220  ith "saturated" 
-00010c00: 6461 7461 2072 656d 6f76 6564 0a20 2020  data removed.   
-00010c10: 2022 2222 0a20 2020 2069 6620 7361 745f   """.    if sat_
-00010c20: 7065 7263 656e 7420 3e20 313a 0a20 2020  percent > 1:.   
-00010c30: 2020 2020 2073 6174 5f70 6572 6365 6e74       sat_percent
-00010c40: 203d 2073 6174 5f70 6572 6365 6e74 202f   = sat_percent /
-00010c50: 2031 3030 0a0a 2020 2020 7265 6d6f 7665   100..    remove
-00010c60: 496e 6420 3d20 6e70 2e61 7272 6179 285b  Ind = np.array([
-00010c70: 5d2c 2064 7479 7065 3d69 6e74 290a 2020  ], dtype=int).  
-00010c80: 2020 666f 7220 7472 6163 6520 696e 2073    for trace in s
-00010c90: 7472 6561 6d3a 0a20 2020 2020 2020 2064  tream:.        d
-00010ca0: 6174 6141 7272 203d 2074 7261 6365 2e64  ataArr = trace.d
-00010cb0: 6174 612e 636f 7079 2829 0a0a 2020 2020  ata.copy()..    
-00010cc0: 2020 2020 7361 6d70 6c65 5f72 6174 6520      sample_rate 
-00010cd0: 3d20 7472 6163 652e 7374 6174 732e 6465  = trace.stats.de
-00010ce0: 6c74 610a 0a20 2020 2020 2020 2023 4765  lta..        #Ge
-00010cf0: 7420 6d61 7820 616d 706c 6974 7564 6520  t max amplitude 
-00010d00: 7661 6c75 650a 2020 2020 2020 2020 6d61  value.        ma
-00010d10: 7841 6d70 203d 206e 702e 6d61 7828 6e70  xAmp = np.max(np
-00010d20: 2e61 6273 6f6c 7574 6528 6461 7461 4172  .absolute(dataAr
-00010d30: 722c 2077 6865 7265 203d 206e 6f74 204e  r, where = not N
-00010d40: 6f6e 6529 290a 2020 2020 2020 2020 7468  one)).        th
-00010d50: 7265 7368 6f6c 6441 6d70 203d 206d 6178  resholdAmp = max
-00010d60: 416d 7020 2a20 7361 745f 7065 7263 656e  Amp * sat_percen
-00010d70: 740a 2020 2020 2020 2020 636f 6e64 203d  t.        cond =
-00010d80: 206e 702e 6e6f 6e7a 6572 6f28 6e70 2e61   np.nonzero(np.a
-00010d90: 6273 6f6c 7574 6528 6461 7461 4172 722c  bsolute(dataArr,
-00010da0: 2077 6865 7265 3d6e 6f74 204e 6f6e 6529   where=not None)
-00010db0: 203e 2074 6872 6573 686f 6c64 416d 7029   > thresholdAmp)
-00010dc0: 5b30 5d0a 2020 2020 2020 2020 7265 6d6f  [0].        remo
-00010dd0: 7665 496e 6420 3d20 6e70 2e68 7374 6163  veInd = np.hstac
-00010de0: 6b28 5b72 656d 6f76 6549 6e64 2c20 636f  k([removeInd, co
-00010df0: 6e64 5d29 0a20 2020 2020 2020 2023 7472  nd]).        #tr
-00010e00: 6163 652e 6461 7461 203d 206e 702e 6d61  ace.data = np.ma
-00010e10: 2e77 6865 7265 286e 702e 6162 736f 6c75  .where(np.absolu
-00010e20: 7465 2864 6174 612c 2077 6865 7265 203d  te(data, where =
-00010e30: 206e 6f74 204e 6f6e 6529 203e 2028 6e6f   not None) > (no
-00010e40: 6973 655f 7065 7263 656e 7420 2a20 6d61  ise_percent * ma
-00010e50: 7841 6d70 292c 204e 6f6e 652c 2064 6174  xAmp), None, dat
-00010e60: 6129 0a20 2020 2023 436f 6d62 696e 6520  a).    #Combine 
-00010e70: 696e 6469 6365 7320 6672 6f6d 2061 6c6c  indices from all
-00010e80: 2074 6872 6565 2074 7261 6365 730a 2020   three traces.  
-00010e90: 2020 7265 6d6f 7665 496e 6420 3d20 6e70    removeInd = np
-00010ea0: 2e75 6e69 7175 6528 7265 6d6f 7665 496e  .unique(removeIn
-00010eb0: 6429 0a20 2020 200a 2020 2020 7265 6d6f  d).    .    remo
-00010ec0: 7665 4c69 7374 203d 205b 5d20 2023 2069  veList = []  # i
-00010ed0: 6e69 7469 616c 697a 650a 2020 2020 6d69  nitialize.    mi
-00010ee0: 6e5f 7769 6e5f 7361 6d70 6c65 7320 3d20  n_win_samples = 
-00010ef0: 696e 7428 6d69 6e5f 7769 6e5f 7369 7a65  int(min_win_size
-00010f00: 202f 2073 616d 706c 655f 7261 7465 290a   / sample_rate).
-00010f10: 0a20 2020 2069 6620 6c65 6e28 7265 6d6f  .    if len(remo
-00010f20: 7665 496e 6429 203e 2030 3a0a 2020 2020  veInd) > 0:.    
-00010f30: 2020 2020 7374 6172 7449 6e64 203d 2072      startInd = r
-00010f40: 656d 6f76 6549 6e64 5b30 5d0a 2020 2020  emoveInd[0].    
-00010f50: 2020 2020 656e 6449 6e64 203d 2072 656d      endInd = rem
-00010f60: 6f76 6549 6e64 5b30 5d0a 0a20 2020 2020  oveInd[0]..     
-00010f70: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00010f80: 6528 302c 206c 656e 2872 656d 6f76 6549  e(0, len(removeI
-00010f90: 6e64 2929 3a20 2020 2020 2020 2020 2020  nd)):           
-00010fa0: 2020 0a20 2020 2020 2020 2020 2020 2069    .            i
-00010fb0: 6620 7265 6d6f 7665 496e 645b 695d 202d  f removeInd[i] -
-00010fc0: 2072 656d 6f76 6549 6e64 5b69 2d31 5d20   removeInd[i-1] 
-00010fd0: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
-00010fe0: 2020 2020 2069 6620 656e 6449 6e64 202d       if endInd -
-00010ff0: 2073 7461 7274 496e 6420 3e3d 206d 696e   startInd >= min
-00011000: 5f77 696e 5f73 616d 706c 6573 3a0a 2020  _win_samples:.  
-00011010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011020: 2020 7265 6d6f 7665 4c69 7374 2e61 7070    removeList.app
-00011030: 656e 6428 5b69 6e74 2873 7461 7274 496e  end([int(startIn
-00011040: 6429 2c20 696e 7428 656e 6449 6e64 295d  d), int(endInd)]
-00011050: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00011060: 2020 7374 6172 7449 6e64 203d 2072 656d    startInd = rem
-00011070: 6f76 6549 6e64 5b69 5d0a 2020 2020 2020  oveInd[i].      
-00011080: 2020 2020 2020 656e 6449 6e64 203d 2072        endInd = r
-00011090: 656d 6f76 6549 6e64 5b69 5d0a 0a0a 0a20  emoveInd[i].... 
-000110a0: 2020 2072 656d 6f76 654c 6973 742e 6170     removeList.ap
-000110b0: 7065 6e64 285b 2d31 2c20 2d31 5d29 2023  pend([-1, -1]) #
-000110c0: 6669 6775 7265 206f 7574 2061 2077 6179  figure out a way
-000110d0: 2074 6f20 6765 7420 7269 6420 6f66 2074   to get rid of t
-000110e0: 6869 730a 0a20 2020 2023 436f 6e76 6572  his..    #Conver
-000110f0: 7420 7265 6d6f 7665 4c69 7374 2066 726f  t removeList fro
-00011100: 6d20 7361 6d70 6c65 7320 746f 2073 6563  m samples to sec
-00011110: 6f6e 6473 2061 6674 6572 2073 7461 7274  onds after start
-00011120: 2074 6f20 5554 4344 6174 6554 696d 650a   to UTCDateTime.
-00011130: 2020 2020 7361 6d70 6c65 5261 7465 203d      sampleRate =
-00011140: 2073 7472 6561 6d5b 305d 2e73 7461 7473   stream[0].stats
-00011150: 2e64 656c 7461 0a20 2020 2073 7461 7274  .delta.    start
-00011160: 5420 3d20 7374 7265 616d 5b30 5d2e 7374  T = stream[0].st
-00011170: 6174 732e 7374 6172 7474 696d 650a 2020  ats.starttime.  
-00011180: 2020 656e 6454 203d 2073 7472 6561 6d5b    endT = stream[
-00011190: 305d 2e73 7461 7473 2e65 6e64 7469 6d65  0].stats.endtime
-000111a0: 0a20 2020 2072 656d 6f76 6553 6563 203d  .    removeSec =
-000111b0: 205b 5d0a 2020 2020 7265 6d6f 7665 5554   [].    removeUT
-000111c0: 4320 3d20 5b5d 0a20 2020 2072 656d 6f76  C = [].    remov
-000111d0: 6555 5443 2e61 7070 656e 6428 5b73 7461  eUTC.append([sta
-000111e0: 7274 542c 2073 7461 7274 545d 290a 2020  rtT, startT]).  
-000111f0: 2020 666f 7220 692c 2077 696e 2069 6e20    for i, win in 
-00011200: 656e 756d 6572 6174 6528 7265 6d6f 7665  enumerate(remove
-00011210: 4c69 7374 293a 0a20 2020 2020 2020 2072  List):.        r
-00011220: 656d 6f76 6553 6563 2e61 7070 656e 6428  emoveSec.append(
-00011230: 6c69 7374 286e 702e 726f 756e 6428 7361  list(np.round(sa
-00011240: 6d70 6c65 5261 7465 202a 206e 702e 6172  mpleRate * np.ar
-00011250: 7261 7928 7769 6e29 2c36 2929 290a 2020  ray(win),6))).  
-00011260: 2020 2020 2020 7265 6d6f 7665 5554 432e        removeUTC.
-00011270: 6170 7065 6e64 286c 6973 7428 6e70 2e61  append(list(np.a
-00011280: 6464 2873 7461 7274 542c 2072 656d 6f76  dd(startT, remov
-00011290: 6553 6563 5b69 5d29 2929 0a20 2020 2072  eSec[i]))).    r
-000112a0: 656d 6f76 6555 5443 5b2d 315d 5b30 5d20  emoveUTC[-1][0] 
-000112b0: 3d20 7265 6d6f 7665 5554 435b 2d31 5d5b  = removeUTC[-1][
-000112c0: 315d 203d 2065 6e64 540a 2020 2020 0a20  1] = endT.    . 
-000112d0: 2020 206f 7574 7374 7265 616d 2020 3d20     outstream  = 
-000112e0: 5f5f 7265 6d6f 7665 5f67 6170 7328 7374  __remove_gaps(st
-000112f0: 7265 616d 2c20 7265 6d6f 7665 5554 4329  ream, removeUTC)
-00011300: 0a20 2020 2072 6574 7572 6e20 6f75 7473  .    return outs
-00011310: 7472 6561 6d0a 0a23 4865 6c70 6572 2066  tream..#Helper f
-00011320: 756e 6374 696f 6e20 666f 7220 7265 6d6f  unction for remo
-00011330: 7669 6e67 2064 6174 6120 7573 696e 6720  ving data using 
-00011340: 7468 6520 6e6f 6973 6520 7468 7265 7368  the noise thresh
-00011350: 6f6c 6420 696e 7075 7420 6672 6f6d 2072  old input from r
-00011360: 656d 6f76 655f 6e6f 6973 6528 290a 6465  emove_noise().de
-00011370: 6620 5f5f 7265 6d6f 7665 5f6e 6f69 7365  f __remove_noise
-00011380: 5f74 6872 6573 6828 7374 7265 616d 2c20  _thresh(stream, 
-00011390: 6e6f 6973 655f 7065 7263 656e 743d 302e  noise_percent=0.
-000113a0: 382c 206c 7461 3d33 302c 206d 696e 5f77  8, lta=30, min_w
-000113b0: 696e 5f73 697a 653d 3129 3a0a 2020 2020  in_size=1):.    
-000113c0: 2222 2248 656c 7065 7220 6675 6e63 7469  """Helper functi
-000113d0: 6f6e 2066 6f72 2072 656d 6f76 696e 6720  on for removing 
-000113e0: 6461 7461 2075 7369 6e67 2074 6865 206e  data using the n
-000113f0: 6f69 7365 2074 6872 6573 686f 6c64 2069  oise threshold i
-00011400: 6e70 7574 2066 726f 6d20 7265 6d6f 7665  nput from remove
-00011410: 5f6e 6f69 7365 2829 0a0a 2020 2020 5468  _noise()..    Th
-00011420: 6520 7075 7270 6f73 6520 6f66 2074 6865  e purpose of the
-00011430: 206e 6f69 7365 2074 6872 6573 686f 6c64   noise threshold
-00011440: 206d 6574 686f 6420 6973 2074 6f20 7265   method is to re
-00011450: 6d6f 7665 206e 6f69 7379 2077 696e 646f  move noisy windo
-00011460: 7773 2028 652e 672e 2c20 6c6f 7473 206f  ws (e.g., lots o
-00011470: 6620 7472 6166 6669 6320 616c 6c20 6174  f traffic all at
-00011480: 206f 6e63 6529 2e20 0a20 2020 200a 2020   once). .    .  
-00011490: 2020 5468 6973 2066 756e 6374 696f 6e20    This function 
-000114a0: 7573 6573 2074 6865 206c 7461 2076 616c  uses the lta val
-000114b0: 7565 2028 7768 6963 6820 6361 6e20 6265  ue (which can be
-000114c0: 2073 7065 6369 6669 6564 2068 6572 6529   specified here)
-000114d0: 2c20 616e 6420 6669 6e64 7320 7469 6d65  , and finds time
-000114e0: 7320 7768 6572 6520 7468 6520 6c74 6120  s where the lta 
-000114f0: 7661 6c75 6520 6973 2061 7420 6c65 6173  value is at leas
-00011500: 7420 6174 2074 6865 206e 6f69 7365 5f70  t at the noise_p
-00011510: 6572 6365 6e74 206c 6576 656c 206f 6620  ercent level of 
-00011520: 7468 6520 6d61 7820 6c74 6120 7661 6c75  the max lta valu
-00011530: 6520 666f 7220 6174 206c 6561 7374 2061  e for at least a
-00011540: 2073 7065 6369 6669 6564 2074 696d 6520   specified time 
-00011550: 286d 696e 5f77 696e 5f73 697a 6529 0a0a  (min_win_size)..
-00011560: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00011570: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00011580: 2020 7374 7265 616d 203a 206f 6273 7079    stream : obspy
-00011590: 2e63 6f72 652e 7374 7265 616d 2e53 7472  .core.stream.Str
-000115a0: 6561 6d20 6f62 6a65 6374 0a20 2020 2020  eam object.     
-000115b0: 2020 2049 6e70 7574 2073 7472 6561 6d20     Input stream 
-000115c0: 6672 6f6d 2077 6869 6368 2074 6f20 7265  from which to re
-000115d0: 6d6f 7665 2077 696e 646f 7773 2e20 5061  move windows. Pa
-000115e0: 7373 6564 2066 726f 6d20 7265 6d6f 7665  ssed from remove
-000115f0: 5f6e 6f69 7365 2829 2e0a 2020 2020 6e6f  _noise()..    no
-00011600: 6973 655f 7065 7263 656e 7420 3a20 666c  ise_percent : fl
-00011610: 6f61 742c 2064 6566 6175 6c74 3d30 2e39  oat, default=0.9
-00011620: 3935 0a20 2020 2020 2020 2050 6572 6365  95.        Perce
-00011630: 6e74 6167 6520 2862 6574 7765 656e 2030  ntage (between 0
-00011640: 2061 6e64 2031 292c 2074 6f20 7573 6520   and 1), to use 
-00011650: 6173 2074 6865 2074 6872 6573 686f 6c64  as the threshold
-00011660: 2061 7420 7768 6963 6820 746f 2072 656d   at which to rem
-00011670: 6f76 6520 6461 7461 2e20 5468 6973 2069  ove data. This i
-00011680: 7320 7573 6564 2069 6e20 7468 6520 6e6f  s used in the no
-00011690: 6973 6520 7468 7265 7368 6f6c 6420 6d65  ise threshold me
-000116a0: 7468 6f64 2e20 4279 2064 6566 6175 6c74  thod. By default
-000116b0: 2030 2e39 3935 2e20 0a20 2020 2020 2020   0.995. .       
-000116c0: 2049 6620 6120 7661 6c75 6520 6973 2070   If a value is p
-000116d0: 6173 7365 6420 7468 6174 2069 7320 6772  assed that is gr
-000116e0: 6561 7465 7220 7468 616e 2031 2c20 6974  eater than 1, it
-000116f0: 2077 696c 6c20 6265 2064 6976 6964 6564   will be divided
-00011700: 2062 7920 3130 3020 746f 206f 6274 6169   by 100 to obtai
-00011710: 6e20 7468 6520 7065 7263 656e 7461 6765  n the percentage
-00011720: 2e20 5061 7373 6564 2066 726f 6d20 7265  . Passed from re
-00011730: 6d6f 7665 5f6e 6f69 7365 2829 2e0a 2020  move_noise()..  
-00011740: 2020 6c74 6120 3a20 696e 742c 2064 6566    lta : int, def
-00011750: 6175 6c74 203d 2033 300a 2020 2020 2020  ault = 30.      
-00011760: 2020 4c65 6e67 7468 206f 6620 6c74 6120    Length of lta 
-00011770: 746f 2075 7365 2028 696e 2073 6563 6f6e  to use (in secon
-00011780: 6473 290a 2020 2020 6d69 6e5f 7769 6e5f  ds).    min_win_
-00011790: 7369 7a65 203a 2069 6e74 2c20 6465 6661  size : int, defa
-000117a0: 756c 7420 3d20 310a 2020 2020 2020 2020  ult = 1.        
-000117b0: 4d69 6e69 6d75 6d20 616d 6f75 6e74 206f  Minimum amount o
-000117c0: 6620 7469 6d65 2028 696e 2073 6563 6f6e  f time (in secon
-000117d0: 6473 2920 6174 2077 6869 6368 206e 6f69  ds) at which noi
-000117e0: 7365 2069 7320 6162 6f76 6520 6e6f 6973  se is above nois
-000117f0: 655f 7065 7263 656e 7420 6c65 7665 6c2e  e_percent level.
-00011800: 0a20 2020 200a 2020 2020 5265 7475 726e  .    .    Return
-00011810: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-00011820: 2020 6f75 7453 7472 6561 6d20 3a20 6f62    outStream : ob
-00011830: 7370 792e 636f 7265 2e73 7472 6561 6d2e  spy.core.stream.
-00011840: 5374 7265 616d 206f 626a 6563 740a 2020  Stream object.  
-00011850: 2020 2020 2020 5374 7265 616d 2077 6974        Stream wit
-00011860: 6820 6120 6d61 736b 6564 2061 7272 6179  h a masked array
-00011870: 2066 6f72 2074 6865 2064 6174 6120 7768   for the data wh
-00011880: 6572 6520 276e 6f69 7365 2720 6861 7320  ere 'noise' has 
-00011890: 6265 656e 2072 656d 6f76 6564 2e20 5061  been removed. Pa
-000118a0: 7373 6564 2074 6f20 7265 6d6f 7665 5f6e  ssed to remove_n
-000118b0: 6f69 7365 2829 2e0a 2020 2020 2222 220a  oise()..    """.
-000118c0: 2020 2020 6966 206e 6f69 7365 5f70 6572      if noise_per
-000118d0: 6365 6e74 203e 2031 3a0a 2020 2020 2020  cent > 1:.      
-000118e0: 2020 6e6f 6973 655f 7065 7263 656e 7420    noise_percent 
-000118f0: 3d20 6e6f 6973 655f 7065 7263 656e 7420  = noise_percent 
-00011900: 2f20 3130 300a 0a20 2020 2072 656d 6f76  / 100..    remov
-00011910: 6549 6e64 203d 206e 702e 6172 7261 7928  eInd = np.array(
-00011920: 5b5d 2c20 6474 7970 653d 696e 7429 0a20  [], dtype=int). 
-00011930: 2020 2066 6f72 2074 7261 6365 2069 6e20     for trace in 
-00011940: 7374 7265 616d 3a0a 2020 2020 2020 2020  stream:.        
-00011950: 6461 7461 4172 7220 3d20 7472 6163 652e  dataArr = trace.
-00011960: 6461 7461 2e63 6f70 7928 290a 0a20 2020  data.copy()..   
-00011970: 2020 2020 2073 616d 706c 655f 7261 7465       sample_rate
-00011980: 203d 2074 7261 6365 2e73 7461 7473 2e64   = trace.stats.d
-00011990: 656c 7461 0a20 2020 2020 2020 206c 7461  elta.        lta
-000119a0: 5f73 616d 706c 6573 203d 2069 6e74 286c  _samples = int(l
-000119b0: 7461 202f 2073 616d 706c 655f 7261 7465  ta / sample_rate
-000119c0: 290a 0a20 2020 2020 2020 2023 4765 7420  )..        #Get 
-000119d0: 6c74 6120 7661 6c75 6573 2061 6372 6f73  lta values acros
-000119e0: 7320 7472 6163 6573 2064 6174 610a 2020  s traces data.  
-000119f0: 2020 2020 2020 7769 6e64 6f77 5f73 697a        window_siz
-00011a00: 6520 3d20 6c74 615f 7361 6d70 6c65 730a  e = lta_samples.
-00011a10: 2020 2020 2020 2020 6966 2077 696e 646f          if windo
-00011a20: 775f 7369 7a65 203d 3d20 303a 0a20 2020  w_size == 0:.   
-00011a30: 2020 2020 2020 2020 2077 696e 646f 775f           window_
-00011a40: 7369 7a65 203d 2031 0a20 2020 2020 2020  size = 1.       
-00011a50: 206b 6572 6e65 6c20 3d20 6e70 2e6f 6e65   kernel = np.one
-00011a60: 7328 7769 6e64 6f77 5f73 697a 6529 202f  s(window_size) /
-00011a70: 2077 696e 646f 775f 7369 7a65 0a20 2020   window_size.   
-00011a80: 2020 2020 206d 6173 6b65 6441 7272 203d       maskedArr =
-00011a90: 206e 702e 6d61 2e61 7272 6179 2864 6174   np.ma.array(dat
-00011aa0: 6141 7272 2c20 6474 7970 653d 666c 6f61  aArr, dtype=floa
-00011ab0: 742c 2066 696c 6c5f 7661 6c75 653d 4e6f  t, fill_value=No
-00011ac0: 6e65 290a 2020 2020 2020 2020 6c74 6141  ne).        ltaA
-00011ad0: 7272 203d 206e 702e 636f 6e76 6f6c 7665  rr = np.convolve
-00011ae0: 286d 6173 6b65 6441 7272 2c20 6b65 726e  (maskedArr, kern
-00011af0: 656c 2c20 6d6f 6465 3d27 7361 6d65 2729  el, mode='same')
-00011b00: 0a20 2020 2020 2020 2023 4765 7420 6d61  .        #Get ma
-00011b10: 7820 6c74 6120 7661 6c75 650a 2020 2020  x lta value.    
-00011b20: 2020 2020 6d61 784c 5441 203d 206e 702e      maxLTA = np.
-00011b30: 6d61 7828 6c74 6141 7272 2c20 7768 6572  max(ltaArr, wher
-00011b40: 6520 3d20 6e6f 7420 4e6f 6e65 290a 2020  e = not None).  
-00011b50: 2020 2020 2020 636f 6e64 203d 206e 702e        cond = np.
-00011b60: 6e6f 6e7a 6572 6f28 6e70 2e61 6273 6f6c  nonzero(np.absol
-00011b70: 7574 6528 6c74 6141 7272 2c20 7768 6572  ute(ltaArr, wher
-00011b80: 653d 6e6f 7420 4e6f 6e65 2920 3e20 286e  e=not None) > (n
-00011b90: 6f69 7365 5f70 6572 6365 6e74 202a 206d  oise_percent * m
-00011ba0: 6178 4c54 4129 295b 305d 0a20 2020 2020  axLTA))[0].     
-00011bb0: 2020 2072 656d 6f76 6549 6e64 203d 206e     removeInd = n
-00011bc0: 702e 6873 7461 636b 285b 7265 6d6f 7665  p.hstack([remove
-00011bd0: 496e 642c 2063 6f6e 645d 290a 2020 2020  Ind, cond]).    
-00011be0: 2020 2020 2374 7261 6365 2e64 6174 6120      #trace.data 
-00011bf0: 3d20 6e70 2e6d 612e 7768 6572 6528 6e70  = np.ma.where(np
-00011c00: 2e61 6273 6f6c 7574 6528 6461 7461 2c20  .absolute(data, 
-00011c10: 7768 6572 6520 3d20 6e6f 7420 4e6f 6e65  where = not None
-00011c20: 2920 3e20 286e 6f69 7365 5f70 6572 6365  ) > (noise_perce
-00011c30: 6e74 202a 206d 6178 416d 7029 2c20 4e6f  nt * maxAmp), No
-00011c40: 6e65 2c20 6461 7461 290a 2020 2020 2343  ne, data).    #C
-00011c50: 6f6d 6269 6e65 2069 6e64 6963 6573 2066  ombine indices f
-00011c60: 726f 6d20 616c 6c20 7468 7265 6520 7472  rom all three tr
-00011c70: 6163 6573 0a20 2020 2072 656d 6f76 6549  aces.    removeI
-00011c80: 6e64 203d 206e 702e 756e 6971 7565 2872  nd = np.unique(r
-00011c90: 656d 6f76 6549 6e64 290a 0a20 2020 2023  emoveInd)..    #
-00011ca0: 4d61 6b65 2073 7572 6520 7765 2772 6520  Make sure we're 
-00011cb0: 6e6f 7420 7265 6d6f 7669 6e67 2073 696e  not removing sin
-00011cc0: 676c 6520 696e 6469 6365 7320 2877 6520  gle indices (we 
-00011cd0: 6f6e 6c79 2077 616e 7420 6c6f 6e67 6572  only want longer
-00011ce0: 2074 6861 6e20 6d69 6e5f 7769 6e5f 7369   than min_win_si
-00011cf0: 7a65 290a 2020 2020 7265 6d6f 7665 4c69  ze).    removeLi
-00011d00: 7374 203d 205b 5d20 2023 2069 6e69 7469  st = []  # initi
-00011d10: 616c 697a 6520 2020 200a 2020 2020 6d69  alize    .    mi
-00011d20: 6e5f 7769 6e5f 7361 6d70 6c65 7320 3d20  n_win_samples = 
-00011d30: 696e 7428 6d69 6e5f 7769 6e5f 7369 7a65  int(min_win_size
-00011d40: 202f 2073 616d 706c 655f 7261 7465 290a   / sample_rate).
-00011d50: 0a20 2020 2069 6620 6c65 6e28 7265 6d6f  .    if len(remo
-00011d60: 7665 496e 6429 203e 2030 3a0a 2020 2020  veInd) > 0:.    
-00011d70: 2020 2020 7374 6172 7449 6e64 203d 2072      startInd = r
-00011d80: 656d 6f76 6549 6e64 5b30 5d0a 2020 2020  emoveInd[0].    
-00011d90: 2020 2020 656e 6449 6e64 203d 2072 656d      endInd = rem
-00011da0: 6f76 6549 6e64 5b30 5d0a 0a20 2020 2020  oveInd[0]..     
-00011db0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00011dc0: 6528 302c 206c 656e 2872 656d 6f76 6549  e(0, len(removeI
-00011dd0: 6e64 2929 3a0a 2020 2020 2020 2020 2020  nd)):.          
-00011de0: 2020 2349 6620 696e 6469 6365 7320 6172    #If indices ar
-00011df0: 6520 6e6f 6e2d 636f 6e73 6563 7574 6976  e non-consecutiv
-00011e00: 652e 2e2e 200a 2020 2020 2020 2020 2020  e... .          
-00011e10: 2020 6966 2072 656d 6f76 6549 6e64 5b69    if removeInd[i
-00011e20: 5d20 2d20 7265 6d6f 7665 496e 645b 692d  ] - removeInd[i-
-00011e30: 315d 203e 2031 3a0a 2020 2020 2020 2020  1] > 1:.        
-00011e40: 2020 2020 2020 2020 2349 6620 7468 6520          #If the 
-00011e50: 696e 6469 6365 7320 6172 6520 6e6f 6e2d  indices are non-
-00011e60: 636f 6e73 6563 7574 6976 6520 616e 6420  consecutive and 
-00011e70: 7468 6520 0a20 2020 2020 2020 2020 2020  the .           
-00011e80: 2020 2020 2069 6620 656e 6449 6e64 202d       if endInd -
-00011e90: 2073 7461 7274 496e 6420 3e3d 206d 696e   startInd >= min
-00011ea0: 5f77 696e 5f73 616d 706c 6573 3a0a 2020  _win_samples:.  
-00011eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ec0: 2020 7265 6d6f 7665 4c69 7374 2e61 7070    removeList.app
-00011ed0: 656e 6428 5b69 6e74 2873 7461 7274 496e  end([int(startIn
-00011ee0: 6429 2c20 696e 7428 656e 6449 6e64 295d  d), int(endInd)]
-00011ef0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00011f00: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00011f10: 2020 2020 2020 2023 5365 7420 7374 6172         #Set star
-00011f20: 7449 6e64 2061 7320 7468 6520 6375 7272  tInd as the curr
-00011f30: 656e 7420 696e 6465 780a 2020 2020 2020  ent index.      
-00011f40: 2020 2020 2020 2020 2020 7374 6172 7449            startI
-00011f50: 6e64 203d 2072 656d 6f76 6549 6e64 5b69  nd = removeInd[i
-00011f60: 5d0a 2020 2020 2020 2020 2020 2020 656e  ].            en
-00011f70: 6449 6e64 203d 2072 656d 6f76 6549 6e64  dInd = removeInd
-00011f80: 5b69 5d0a 2020 2020 2020 2020 2020 2020  [i].            
-00011f90: 0a20 2020 2072 656d 6f76 654c 6973 742e  .    removeList.
-00011fa0: 6170 7065 6e64 285b 2d31 2c20 2d31 5d29  append([-1, -1])
-00011fb0: 0a0a 2020 2020 7361 6d70 6c65 5261 7465  ..    sampleRate
-00011fc0: 203d 2073 7472 6561 6d5b 305d 2e73 7461   = stream[0].sta
-00011fd0: 7473 2e64 656c 7461 0a20 2020 2073 7461  ts.delta.    sta
-00011fe0: 7274 5420 3d20 7374 7265 616d 5b30 5d2e  rtT = stream[0].
-00011ff0: 7374 6174 732e 7374 6172 7474 696d 650a  stats.starttime.
-00012000: 2020 2020 656e 6454 203d 2073 7472 6561      endT = strea
-00012010: 6d5b 305d 2e73 7461 7473 2e65 6e64 7469  m[0].stats.endti
-00012020: 6d65 0a20 2020 2072 656d 6f76 6553 6563  me.    removeSec
-00012030: 203d 205b 5d0a 2020 2020 7265 6d6f 7665   = [].    remove
-00012040: 5554 4320 3d20 5b5d 0a0a 2020 2020 7265  UTC = []..    re
-00012050: 6d6f 7665 5554 432e 6170 7065 6e64 285b  moveUTC.append([
-00012060: 7374 6172 7454 2c20 7374 6172 7454 5d29  startT, startT])
-00012070: 0a20 2020 2066 6f72 2069 2c20 7769 6e20  .    for i, win 
-00012080: 696e 2065 6e75 6d65 7261 7465 2872 656d  in enumerate(rem
-00012090: 6f76 654c 6973 7429 3a0a 2020 2020 2020  oveList):.      
-000120a0: 2020 7265 6d6f 7665 5365 632e 6170 7065    removeSec.appe
-000120b0: 6e64 286c 6973 7428 6e70 2e72 6f75 6e64  nd(list(np.round
-000120c0: 2873 616d 706c 6552 6174 6520 2a20 6e70  (sampleRate * np
-000120d0: 2e61 7272 6179 2877 696e 292c 3629 2929  .array(win),6)))
-000120e0: 0a20 2020 2020 2020 2072 656d 6f76 6555  .        removeU
-000120f0: 5443 2e61 7070 656e 6428 6c69 7374 286e  TC.append(list(n
-00012100: 702e 6164 6428 7374 6172 7454 2c20 7265  p.add(startT, re
-00012110: 6d6f 7665 5365 635b 695d 2929 290a 2020  moveSec[i]))).  
-00012120: 2020 7265 6d6f 7665 5554 435b 2d31 5d5b    removeUTC[-1][
-00012130: 305d 203d 2072 656d 6f76 6555 5443 5b2d  0] = removeUTC[-
-00012140: 315d 5b31 5d20 3d20 656e 6454 0a0a 2020  1][1] = endT..  
-00012150: 2020 6f75 7473 7472 6561 6d20 203d 205f    outstream  = _
-00012160: 5f72 656d 6f76 655f 6761 7073 2873 7472  _remove_gaps(str
-00012170: 6561 6d2c 2072 656d 6f76 6555 5443 290a  eam, removeUTC).
-00012180: 0a20 2020 2072 6574 7572 6e20 6f75 7473  .    return outs
-00012190: 7472 6561 6d0a 0a23 4865 6c70 6572 2066  tream..#Helper f
-000121a0: 756e 6374 696f 6e20 666f 7220 7265 6d6f  unction for remo
-000121b0: 7669 6e67 2064 6174 6120 6475 7269 6e67  ving data during
-000121c0: 2077 6172 6d75 7020 2877 6865 6e20 7365   warmup (when se
-000121d0: 6973 6d6f 6d65 7465 7273 2061 7265 2073  ismometers are s
-000121e0: 7469 6c6c 2069 6e69 7469 616c 697a 696e  till initializin
-000121f0: 6729 2061 6e64 2022 636f 6f6c 646f 776e  g) and "cooldown
-00012200: 2220 2877 6865 6e20 7468 6572 6520 6d61  " (when there ma
-00012210: 7920 6265 206e 6f69 7365 2066 726f 6d20  y be noise from 
-00012220: 6465 6163 7469 7661 7469 6e67 2073 6569  deactivating sei
-00012230: 736d 6f6d 6574 6572 2920 7469 6d65 2c20  smometer) time, 
-00012240: 6966 2064 6573 6972 6564 0a64 6566 205f  if desired.def _
-00012250: 5f72 656d 6f76 655f 7761 726d 7570 5f63  _remove_warmup_c
-00012260: 6f6f 6c64 6f77 6e28 7374 7265 616d 2c20  ooldown(stream, 
-00012270: 7761 726d 7570 5f74 696d 6520 3d20 302c  warmup_time = 0,
-00012280: 2063 6f6f 6c64 6f77 6e5f 7469 6d65 203d   cooldown_time =
-00012290: 2030 293a 0a20 2020 2073 616d 706c 6552   0):.    sampleR
-000122a0: 6174 6520 3d20 666c 6f61 7428 7374 7265  ate = float(stre
-000122b0: 616d 5b30 5d2e 7374 6174 732e 6465 6c74  am[0].stats.delt
-000122c0: 6129 0a20 2020 206f 7574 5374 7265 616d  a).    outStream
-000122d0: 203d 2073 7472 6561 6d2e 636f 7079 2829   = stream.copy()
-000122e0: 0a0a 2020 2020 7761 726d 7570 5f73 616d  ..    warmup_sam
-000122f0: 706c 6573 203d 2069 6e74 2877 6172 6d75  ples = int(warmu
-00012300: 705f 7469 6d65 202f 2073 616d 706c 6552  p_time / sampleR
-00012310: 6174 6529 2023 436f 6e76 6572 7420 746f  ate) #Convert to
-00012320: 2073 616d 706c 6573 0a20 2020 2077 696e   samples.    win
-00012330: 646f 7773 5f73 616d 706c 6573 3d5b 5d0a  dows_samples=[].
-00012340: 2020 2020 666f 7220 7472 2069 6e20 7374      for tr in st
-00012350: 7265 616d 3a0a 2020 2020 2020 2020 746f  ream:.        to
-00012360: 7461 6c53 616d 706c 6573 203d 206c 656e  talSamples = len
-00012370: 2874 722e 6461 7461 292d 3123 666c 6f61  (tr.data)-1#floa
-00012380: 7428 7472 2e73 7461 7473 2e65 6e64 7469  t(tr.stats.endti
-00012390: 6d65 202d 2074 722e 7374 6174 732e 7374  me - tr.stats.st
-000123a0: 6172 7474 696d 6529 202f 2074 722e 7374  arttime) / tr.st
-000123b0: 6174 732e 6465 6c74 610a 2020 2020 2020  ats.delta.      
-000123c0: 2020 636f 6f6c 646f 776e 5f73 616d 706c    cooldown_sampl
-000123d0: 6573 203d 2069 6e74 2874 6f74 616c 5361  es = int(totalSa
-000123e0: 6d70 6c65 7320 2d20 2863 6f6f 6c64 6f77  mples - (cooldow
-000123f0: 6e5f 7469 6d65 202f 2073 616d 706c 6552  n_time / sampleR
-00012400: 6174 6529 2920 2343 6f6e 7665 7274 2074  ate)) #Convert t
-00012410: 6f20 7361 6d70 6c65 730a 2020 2020 7769  o samples.    wi
-00012420: 6e64 6f77 735f 7361 6d70 6c65 7320 3d20  ndows_samples = 
-00012430: 5b5b 302c 2077 6172 6d75 705f 7361 6d70  [[0, warmup_samp
-00012440: 6c65 735d 2c5b 636f 6f6c 646f 776e 5f73  les],[cooldown_s
-00012450: 616d 706c 6573 2c20 746f 7461 6c53 616d  amples, totalSam
-00012460: 706c 6573 5d5d 0a20 2020 2069 6620 636f  ples]].    if co
-00012470: 6f6c 646f 776e 5f74 696d 653d 3d30 3a0a  oldown_time==0:.
-00012480: 2020 2020 2020 2020 7769 6e64 6f77 735f          windows_
-00012490: 7361 6d70 6c65 732e 706f 7028 3129 0a20  samples.pop(1). 
-000124a0: 2020 2069 6620 7761 726d 7570 5f74 696d     if warmup_tim
-000124b0: 653d 3d30 3a0a 2020 2020 2020 2020 7769  e==0:.        wi
-000124c0: 6e64 6f77 735f 7361 6d70 6c65 732e 706f  ndows_samples.po
-000124d0: 7028 3029 0a0a 2020 2020 6966 2077 696e  p(0)..    if win
-000124e0: 646f 7773 5f73 616d 706c 6573 203d 3d20  dows_samples == 
-000124f0: 5b5d 3a0a 2020 2020 2020 2020 7061 7373  []:.        pass
-00012500: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00012510: 2020 2073 7461 7274 5420 3d20 7374 7265     startT = stre
-00012520: 616d 5b30 5d2e 7374 6174 732e 7374 6172  am[0].stats.star
-00012530: 7474 696d 650a 2020 2020 2020 2020 656e  ttime.        en
-00012540: 6454 203d 2073 7472 6561 6d5b 305d 2e73  dT = stream[0].s
-00012550: 7461 7473 2e65 6e64 7469 6d65 0a20 2020  tats.endtime.   
-00012560: 2020 2020 2077 696e 646f 775f 5554 4320       window_UTC 
-00012570: 3d20 5b5d 0a20 2020 2020 2020 2077 696e  = [].        win
-00012580: 646f 775f 4d50 4c20 3d20 5b5d 0a20 2020  dow_MPL = [].   
-00012590: 2020 2020 2077 696e 646f 775f 5554 432e       window_UTC.
-000125a0: 6170 7065 6e64 285b 7374 6172 7454 2c20  append([startT, 
-000125b0: 7374 6172 7454 5d29 0a0a 2020 2020 2020  startT])..      
-000125c0: 2020 666f 7220 772c 2077 696e 2069 6e20    for w, win in 
-000125d0: 656e 756d 6572 6174 6528 7769 6e64 6f77  enumerate(window
-000125e0: 735f 7361 6d70 6c65 7329 3a0a 2020 2020  s_samples):.    
-000125f0: 2020 2020 2020 2020 666f 7220 6a2c 2074          for j, t
-00012600: 6d20 696e 2065 6e75 6d65 7261 7465 2877  m in enumerate(w
-00012610: 696e 293a 0a0a 2020 2020 2020 2020 2020  in):..          
-00012620: 2020 2020 2020 6966 206a 203d 3d20 303a        if j == 0:
-00012630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012640: 2020 2020 2077 696e 646f 775f 5554 432e       window_UTC.
-00012650: 6170 7065 6e64 285b 5d29 0a20 2020 2020  append([]).     
-00012660: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00012670: 696e 646f 775f 4d50 4c2e 6170 7065 6e64  indow_MPL.append
-00012680: 285b 5d29 0a20 2020 2020 2020 2020 2020  ([]).           
-00012690: 2020 2020 2074 5365 6320 3d20 746d 202a       tSec = tm *
-000126a0: 2073 616d 706c 6552 6174 650a 2020 2020   sampleRate.    
-000126b0: 2020 2020 2020 2020 2020 2020 7769 6e64              wind
-000126c0: 6f77 5f55 5443 5b77 2b31 5d2e 6170 7065  ow_UTC[w+1].appe
-000126d0: 6e64 2873 7461 7274 542b 7453 6563 290a  nd(startT+tSec).
-000126e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126f0: 7769 6e64 6f77 5f4d 504c 5b77 5d2e 6170  window_MPL[w].ap
-00012700: 7065 6e64 2877 696e 646f 775f 5554 435b  pend(window_UTC[
-00012710: 775d 5b6a 5d2e 6d61 7470 6c6f 746c 6962  w][j].matplotlib
-00012720: 5f64 6174 6529 0a20 2020 2020 2020 2077  _date).        w
-00012730: 696e 646f 775f 5554 432e 6170 7065 6e64  indow_UTC.append
-00012740: 285b 656e 6454 2c20 656e 6454 5d29 0a0a  ([endT, endT])..
-00012750: 2020 2020 2020 2020 2377 696e 646f 775f          #window_
-00012760: 4d50 4c5b 775d 2e61 7070 656e 6428 7769  MPL[w].append(wi
-00012770: 6e64 6f77 5f55 5443 5b77 5d5b 695d 2e6d  ndow_UTC[w][i].m
-00012780: 6174 706c 6f74 6c69 625f 6461 7465 290a  atplotlib_date).
-00012790: 2020 2020 2020 2020 6f75 7453 7472 6561          outStrea
-000127a0: 6d20 3d20 5f5f 7265 6d6f 7665 5f67 6170  m = __remove_gap
-000127b0: 7328 7374 7265 616d 2c20 7769 6e64 6f77  s(stream, window
-000127c0: 5f55 5443 290a 2020 2020 7265 7475 726e  _UTC).    return
-000127d0: 206f 7574 5374 7265 616d 0a0a 2347 656e   outStream..#Gen
-000127e0: 6572 6174 6520 5050 5344 7320 666f 7220  erate PPSDs for 
-000127f0: 6561 6368 2063 6861 6e6e 656c 0a23 6465  each channel.#de
-00012800: 6620 6765 6e65 7261 7465 5f70 7073 6473  f generate_ppsds
-00012810: 2870 6172 616d 732c 2073 7472 6561 6d2c  (params, stream,
-00012820: 2070 7073 645f 6c65 6e67 7468 3d36 302c   ppsd_length=60,
-00012830: 202a 2a6b 7761 7267 7329 3a0a 6465 6620   **kwargs):.def 
-00012840: 6765 6e65 7261 7465 5f70 7073 6473 2870  generate_ppsds(p
-00012850: 6172 616d 732c 2072 656d 6f76 655f 6f75  arams, remove_ou
-00012860: 746c 6965 7273 3d54 7275 652c 206f 7574  tliers=True, out
-00012870: 6c69 6572 5f73 7464 3d33 2c20 7665 7262  lier_std=3, verb
-00012880: 6f73 653d 4661 6c73 652c 202a 2a70 7073  ose=False, **pps
-00012890: 645f 6b77 6172 6773 293a 0a20 2020 2022  d_kwargs):.    "
-000128a0: 2222 4765 6e65 7261 7465 7320 5050 5344  ""Generates PPSD
-000128b0: 7320 666f 7220 6561 6368 2063 6861 6e6e  s for each chann
-000128c0: 656c 0a0a 2020 2020 2020 2020 4368 616e  el..        Chan
-000128d0: 6e65 6c73 206e 6565 6420 746f 2062 6520  nels need to be 
-000128e0: 696e 205a 2c20 4e2c 2045 206f 7264 6572  in Z, N, E order
-000128f0: 0a20 2020 2020 2020 2049 6e66 6f20 6f6e  .        Info on
-00012900: 2050 5053 4420 6372 6561 7469 6f6e 2068   PPSD creation h
-00012910: 6572 653a 2068 7474 7073 3a2f 2f64 6f63  ere: https://doc
-00012920: 732e 6f62 7370 792e 6f72 672f 7061 636b  s.obspy.org/pack
-00012930: 6167 6573 2f61 7574 6f67 656e 2f6f 6273  ages/autogen/obs
-00012940: 7079 2e73 6967 6e61 6c2e 7370 6563 7472  py.signal.spectr
-00012950: 616c 5f65 7374 696d 6174 696f 6e2e 5050  al_estimation.PP
-00012960: 5344 2e68 746d 6c0a 2020 2020 2020 2020  SD.html.        
-00012970: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00012980: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00012990: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2070  ------.        p
-000129a0: 6172 616d 7320 3a20 6469 6374 0a20 2020  arams : dict.   
-000129b0: 2020 2020 2020 2020 2044 6963 7469 6f6e           Diction
-000129c0: 6172 7920 636f 6e74 6169 6e69 6e67 2061  ary containing a
-000129d0: 6c6c 2074 6865 2070 6172 616d 6574 6572  ll the parameter
-000129e0: 7320 616e 6420 6f74 6865 7220 6461 7461  s and other data
-000129f0: 206f 6620 696e 7465 7265 7374 2028 7374   of interest (st
-00012a00: 7265 616d 2061 6e64 2070 617a 2c20 666f  ream and paz, fo
-00012a10: 7220 6578 616d 706c 6529 0a20 2020 2020  r example).     
-00012a20: 2020 2072 656d 6f76 655f 6f75 746c 6965     remove_outlie
-00012a30: 7273 203a 2062 6f6f 6c2c 2064 6566 6175  rs : bool, defau
-00012a40: 6c74 3d54 7275 650a 2020 2020 2020 2020  lt=True.        
-00012a50: 2020 2020 5768 6574 6865 7220 746f 2072      Whether to r
-00012a60: 656d 6f76 6520 6f75 746c 6965 7220 682f  emove outlier h/
-00012a70: 7620 6375 7276 6573 2e20 5468 6973 2069  v curves. This i
-00012a80: 7320 7265 636f 6d6d 656e 6465 642c 2070  s recommended, p
-00012a90: 6172 7469 6375 6c61 726c 7920 6966 2072  articularly if r
-00012aa0: 656d 6f76 655f 6e6f 6973 6528 2920 6861  emove_noise() ha
-00012ab0: 7320 6265 656e 2075 7365 642e 0a20 2020  s been used..   
-00012ac0: 2020 2020 206f 7574 6c69 6572 5f73 7464       outlier_std
-00012ad0: 203a 2020 666c 6f61 742c 2064 6566 6175   :  float, defau
-00012ae0: 6c74 3d33 0a20 2020 2020 2020 2020 2020  lt=3.           
-00012af0: 2054 6865 2073 7461 6e64 6172 6420 6465   The standard de
-00012b00: 7669 6174 696f 6e20 7661 6c75 6520 746f  viation value to
-00012b10: 2075 7365 2061 7320 6120 7468 7265 7368   use as a thresh
-00012b20: 6f6c 6420 666f 7220 6465 7465 726d 696e  old for determin
-00012b30: 696e 6720 7768 6574 6865 7220 6120 6375  ing whether a cu
-00012b40: 7276 6520 6973 2061 6e20 6f75 746c 6965  rve is an outlie
-00012b50: 722e 200a 2020 2020 2020 2020 2020 2020  r. .            
-00012b60: 5468 6973 2061 7665 7261 6765 7320 6f76  This averages ov
-00012b70: 6572 2074 6865 2065 6e74 6972 6520 6375  er the entire cu
-00012b80: 7276 6520 736f 2074 6861 7420 6375 7276  rve so that curv
-00012b90: 6573 2077 6974 6820 7665 7279 2061 6262  es with very abb
-00012ba0: 6572 616e 7420 6461 7461 2028 6f66 7465  erant data (ofte
-00012bb0: 6e20 6f63 6375 7273 2077 6865 6e20 7573  n occurs when us
-00012bc0: 696e 6720 7468 6520 7265 6d6f 7665 5f6e  ing the remove_n
-00012bd0: 6f69 7365 2829 206d 6574 686f 6429 2c20  oise() method), 
-00012be0: 6361 6e20 6265 2069 6465 6e74 6966 6965  can be identifie
-00012bf0: 642e 0a20 2020 2020 2020 202a 2a6b 7761  d..        **kwa
-00012c00: 7267 7320 3a20 6469 6374 0a20 2020 2020  rgs : dict.     
-00012c10: 2020 2020 2020 2044 6963 7469 6f6e 6172         Dictionar
-00012c20: 7920 7769 7468 206b 6579 776f 7264 2061  y with keyword a
-00012c30: 7267 756d 656e 7473 2074 6861 7420 6172  rguments that ar
-00012c40: 6520 7061 7373 6564 2064 6972 6563 746c  e passed directl
-00012c50: 7920 746f 206f 6273 7079 2e73 6967 6e61  y to obspy.signa
-00012c60: 6c2e 5050 5344 2e0a 2020 2020 2020 2020  l.PPSD..        
-00012c70: 2020 2020 4966 2074 6865 2066 6f6c 6c6f      If the follo
-00012c80: 7769 6e67 206b 6579 776f 7264 7320 6172  wing keywords ar
-00012c90: 6520 6e6f 7420 7370 6563 6966 6965 642c  e not specified,
-00012ca0: 2074 6865 6972 2064 6566 6175 6c74 7320   their defaults 
-00012cb0: 6172 6520 616d 656e 6465 6420 696e 2074  are amended in t
-00012cc0: 6869 7320 6675 6e63 7469 6f6e 2066 726f  his function fro
-00012cd0: 6d20 7468 6520 6f62 7370 7920 6465 6661  m the obspy defa
-00012ce0: 756c 7473 2066 6f72 2069 7473 2050 5053  ults for its PPS
-00012cf0: 4420 6675 6e63 7469 6f6e 2e20 5370 6563  D function. Spec
-00012d00: 6966 6963 616c 6c79 3a0a 2020 2020 2020  ifically:.      
-00012d10: 2020 2020 2020 2020 2020 2d20 7070 7364            - ppsd
-00012d20: 5f6c 656e 6774 6820 6465 6661 756c 7473  _length defaults
-00012d30: 2074 6f20 3630 2028 7365 636f 6e64 7329   to 60 (seconds)
-00012d40: 2068 6572 6520 696e 7374 6561 6420 6f66   here instead of
-00012d50: 2033 3630 300a 2020 2020 2020 2020 2020   3600.          
-00012d60: 2020 2020 2020 2d20 736b 6970 5f6f 6e5f        - skip_on_
-00012d70: 6761 7073 2064 6566 6175 6c74 7320 746f  gaps defaults to
-00012d80: 2054 7275 6520 696e 7374 6561 6420 6f66   True instead of
-00012d90: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-00012da0: 2020 2020 2020 202d 2070 6572 696f 645f         - period_
-00012db0: 7374 6570 5f6f 6374 6176 6573 2064 6566  step_octaves def
-00012dc0: 6175 6c74 7320 746f 2030 2e30 3331 3235  aults to 0.03125
-00012dd0: 2069 6e73 7465 6164 206f 6620 302e 3132   instead of 0.12
-00012de0: 350a 0a20 2020 2020 2020 2052 6574 7572  5..        Retur
-00012df0: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-00012e00: 2d2d 0a20 2020 2020 2020 2020 2020 2070  --.            p
-00012e10: 7073 6473 2020 203a 2020 2064 6963 740a  psds   :   dict.
-00012e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e30: 4469 6374 696f 6e61 7279 2063 6f6e 7461  Dictionary conta
-00012e40: 696e 696e 6720 656e 7472 6965 7320 7769  ining entries wi
-00012e50: 7468 2070 7073 6473 2066 6f72 2065 6163  th ppsds for eac
-00012e60: 6820 6368 616e 6e65 6c0a 2020 2020 2222  h channel.    ""
-00012e70: 220a 2020 2020 7061 7a3d 7061 7261 6d73  ".    paz=params
-00012e80: 5b27 7061 7a27 5d0a 2020 2020 7374 7265  ['paz'].    stre
-00012e90: 616d 203d 2070 6172 616d 735b 2773 7472  am = params['str
-00012ea0: 6561 6d27 5d0a 0a20 2020 2023 5365 7420  eam']..    #Set 
-00012eb0: 6465 6661 756c 7473 2068 6572 6520 7468  defaults here th
-00012ec0: 6174 2061 7265 2064 6966 6665 7265 6e74  at are different
-00012ed0: 2074 6861 6e20 6f62 7370 7920 6465 6661   than obspy defa
-00012ee0: 756c 7473 0a20 2020 2069 6620 2770 7073  ults.    if 'pps
-00012ef0: 645f 6c65 6e67 7468 2720 6e6f 7420 696e  d_length' not in
-00012f00: 2070 7073 645f 6b77 6172 6773 3a0a 2020   ppsd_kwargs:.  
-00012f10: 2020 2020 2020 7070 7364 5f6b 7761 7267        ppsd_kwarg
-00012f20: 735b 2770 7073 645f 6c65 6e67 7468 275d  s['ppsd_length']
-00012f30: 203d 2036 300a 2020 2020 6966 2027 736b   = 60.    if 'sk
-00012f40: 6970 5f6f 6e5f 6761 7073 2720 6e6f 7420  ip_on_gaps' not 
-00012f50: 696e 2070 7073 645f 6b77 6172 6773 3a0a  in ppsd_kwargs:.
-00012f60: 2020 2020 2020 2020 7070 7364 5f6b 7761          ppsd_kwa
-00012f70: 7267 735b 2773 6b69 705f 6f6e 5f67 6170  rgs['skip_on_gap
-00012f80: 7327 5d20 3d20 5472 7565 0a20 2020 2069  s'] = True.    i
-00012f90: 6620 2770 6572 696f 645f 7374 6570 5f6f  f 'period_step_o
-00012fa0: 6374 6176 6573 2720 6e6f 7420 696e 2070  ctaves' not in p
-00012fb0: 7073 645f 6b77 6172 6773 3a0a 2020 2020  psd_kwargs:.    
-00012fc0: 2020 2020 7070 7364 5f6b 7761 7267 735b      ppsd_kwargs[
-00012fd0: 2770 6572 696f 645f 7374 6570 5f6f 6374  'period_step_oct
-00012fe0: 6176 6573 275d 203d 2030 2e30 3331 3235  aves'] = 0.03125
-00012ff0: 0a0a 2020 2020 6672 6f6d 206f 6273 7079  ..    from obspy
-00013000: 2e73 6967 6e61 6c20 696d 706f 7274 2050  .signal import P
-00013010: 5053 440a 0a20 2020 2065 5374 7265 616d  PSD..    eStream
-00013020: 203d 2073 7472 6561 6d2e 7365 6c65 6374   = stream.select
-00013030: 2863 6f6d 706f 6e65 6e74 3d27 4527 290a  (component='E').
-00013040: 2020 2020 6573 7461 7473 203d 2065 5374      estats = eSt
-00013050: 7265 616d 2e74 7261 6365 735b 305d 2e73  ream.traces[0].s
-00013060: 7461 7473 0a20 2020 2070 7073 6445 203d  tats.    ppsdE =
-00013070: 2050 5053 4428 6573 7461 7473 2c20 7061   PPSD(estats, pa
-00013080: 7a5b 2745 275d 2c20 202a 2a70 7073 645f  z['E'],  **ppsd_
-00013090: 6b77 6172 6773 290a 2020 2020 2370 7073  kwargs).    #pps
-000130a0: 6445 203d 2050 5053 4428 7374 7265 616d  dE = PPSD(stream
-000130b0: 2e73 656c 6563 7428 636f 6d70 6f6e 656e  .select(componen
-000130c0: 743d 2745 2729 2e74 7261 6365 735b 305d  t='E').traces[0]
-000130d0: 2e73 7461 7473 2c20 7061 7a5b 2745 275d  .stats, paz['E']
-000130e0: 2c20 7070 7364 5f6c 656e 6774 683d 7070  , ppsd_length=pp
-000130f0: 7364 5f6c 656e 6774 682c 206b 7761 7267  sd_length, kwarg
-00013100: 733d 6b77 6172 6773 290a 2020 2020 7070  s=kwargs).    pp
-00013110: 7364 452e 6164 6428 7374 7265 616d 2c20  sdE.add(stream, 
-00013120: 7665 7262 6f73 653d 7665 7262 6f73 6529  verbose=verbose)
-00013130: 0a0a 2020 2020 6e53 7472 6561 6d20 3d20  ..    nStream = 
-00013140: 7374 7265 616d 2e73 656c 6563 7428 636f  stream.select(co
-00013150: 6d70 6f6e 656e 743d 274e 2729 0a20 2020  mponent='N').   
-00013160: 206e 7374 6174 7320 3d20 6e53 7472 6561   nstats = nStrea
-00013170: 6d2e 7472 6163 6573 5b30 5d2e 7374 6174  m.traces[0].stat
-00013180: 730a 2020 2020 7070 7364 4e20 3d20 5050  s.    ppsdN = PP
-00013190: 5344 286e 7374 6174 732c 2070 617a 5b27  SD(nstats, paz['
-000131a0: 4e27 5d2c 202a 2a70 7073 645f 6b77 6172  N'], **ppsd_kwar
-000131b0: 6773 290a 2020 2020 7070 7364 4e2e 6164  gs).    ppsdN.ad
-000131c0: 6428 7374 7265 616d 2c20 7665 7262 6f73  d(stream, verbos
-000131d0: 653d 7665 7262 6f73 6529 0a0a 2020 2020  e=verbose)..    
-000131e0: 7a53 7472 6561 6d20 3d20 7374 7265 616d  zStream = stream
-000131f0: 2e73 656c 6563 7428 636f 6d70 6f6e 656e  .select(componen
-00013200: 743d 275a 2729 0a20 2020 207a 7374 6174  t='Z').    zstat
-00013210: 7320 3d20 7a53 7472 6561 6d2e 7472 6163  s = zStream.trac
-00013220: 6573 5b30 5d2e 7374 6174 730a 2020 2020  es[0].stats.    
-00013230: 7070 7364 5a20 3d20 5050 5344 287a 7374  ppsdZ = PPSD(zst
-00013240: 6174 732c 2070 617a 5b27 5a27 5d2c 202a  ats, paz['Z'], *
-00013250: 2a70 7073 645f 6b77 6172 6773 290a 2020  *ppsd_kwargs).  
-00013260: 2020 7070 7364 5a2e 6164 6428 7374 7265    ppsdZ.add(stre
-00013270: 616d 2c20 7665 7262 6f73 653d 7665 7262  am, verbose=verb
-00013280: 6f73 6529 0a0a 2020 2020 7070 7364 7320  ose)..    ppsds 
-00013290: 3d20 7b27 5a27 3a70 7073 645a 2c20 274e  = {'Z':ppsdZ, 'N
-000132a0: 273a 7070 7364 4e2c 2027 4527 3a70 7073  ':ppsdN, 'E':pps
-000132b0: 6445 7d0a 0a20 2020 2023 4164 6420 746f  dE}..    #Add to
-000132c0: 2074 6865 2069 6e70 7574 2064 6963 7469   the input dicti
-000132d0: 6f6e 6172 792c 2073 6f20 7468 6174 2073  onary, so that s
-000132e0: 6f6d 6520 6974 656d 7320 6361 6e20 6265  ome items can be
-000132f0: 206d 616e 6970 756c 6174 6564 206c 6174   manipulated lat
-00013300: 6572 206f 6e2c 2061 6e64 206f 7269 6769  er on, and origi
-00013310: 6e61 6c20 6361 6e20 6265 2073 6176 6564  nal can be saved
-00013320: 0a20 2020 2070 6172 616d 735b 2770 7073  .    params['pps
-00013330: 6473 5f6f 6273 7079 275d 203d 2070 7073  ds_obspy'] = pps
-00013340: 6473 0a20 2020 2070 6172 616d 735b 2770  ds.    params['p
-00013350: 7073 6473 275d 203d 207b 7d0a 2020 2020  psds'] = {}.    
-00013360: 616e 794b 6579 203d 206c 6973 7428 7061  anyKey = list(pa
-00013370: 7261 6d73 5b27 7070 7364 735f 6f62 7370  rams['ppsds_obsp
-00013380: 7927 5d2e 6b65 7973 2829 295b 305d 0a20  y'].keys())[0]. 
-00013390: 2020 200a 2020 2020 2347 6574 2070 7073     .    #Get pps
-000133a0: 6420 636c 6173 7320 6d65 6d62 6572 730a  d class members.
-000133b0: 2020 2020 6d65 6d62 6572 7320 3d20 5b6d      members = [m
-000133c0: 656d 7320 666f 7220 6d65 6d73 2069 6e20  ems for mems in 
-000133d0: 6469 7228 7061 7261 6d73 5b27 7070 7364  dir(params['ppsd
-000133e0: 735f 6f62 7370 7927 5d5b 616e 794b 6579  s_obspy'][anyKey
-000133f0: 5d29 2069 6620 6e6f 7420 6361 6c6c 6162  ]) if not callab
-00013400: 6c65 286d 656d 7329 2061 6e64 206e 6f74  le(mems) and not
-00013410: 206d 656d 732e 7374 6172 7473 7769 7468   mems.startswith
-00013420: 2822 5f22 295d 0a20 2020 2070 6172 616d  ("_")].    param
-00013430: 735b 2770 7073 6473 275d 5b27 5a27 5d20  s['ppsds']['Z'] 
-00013440: 3d20 7b7d 0a20 2020 2070 6172 616d 735b  = {}.    params[
-00013450: 2770 7073 6473 275d 5b27 4527 5d20 3d20  'ppsds']['E'] = 
-00013460: 7b7d 0a20 2020 2070 6172 616d 735b 2770  {}.    params['p
-00013470: 7073 6473 275d 5b27 4e27 5d20 3d20 7b7d  psds']['N'] = {}
-00013480: 0a20 2020 200a 2020 2020 2347 6574 206c  .    .    #Get l
-00013490: 6973 7473 2074 6861 7420 7765 206d 6179  ists that we may
-000134a0: 206e 6565 6420 746f 206d 616e 6970 756c   need to manipul
-000134b0: 6174 6520 6c61 7465 7220 616e 6420 636f  ate later and co
-000134c0: 7079 2065 7665 7279 7468 696e 6720 6f76  py everything ov
-000134d0: 6572 2074 6f20 6d61 696e 2027 7070 7364  er to main 'ppsd
-000134e0: 7327 2073 7562 6469 6374 696f 6e61 7279  s' subdictionary
-000134f0: 2028 636f 6e76 6572 7420 6c69 7374 7320   (convert lists 
-00013500: 746f 206e 702e 6172 7261 7973 2066 6f72  to np.arrays for
-00013510: 2063 6f6e 7369 7374 656e 6379 290a 2020   consistency).  
-00013520: 2020 6c69 7374 4c69 7374 203d 205b 2774    listList = ['t
-00013530: 696d 6573 5f64 6174 6127 2c20 2774 696d  imes_data', 'tim
-00013540: 6573 5f67 6170 7327 2c20 2774 696d 6573  es_gaps', 'times
-00013550: 5f70 726f 6365 7373 6564 272c 2763 7572  _processed','cur
-00013560: 7265 6e74 5f74 696d 6573 5f75 7365 6427  rent_times_used'
-00013570: 2c20 2770 7364 5f76 616c 7565 7327 5d0a  , 'psd_values'].
-00013580: 2020 2020 666f 7220 6d20 696e 206d 656d      for m in mem
-00013590: 6265 7273 3a0a 2020 2020 2020 2020 7061  bers:.        pa
-000135a0: 7261 6d73 5b27 7070 7364 7327 5d5b 275a  rams['ppsds']['Z
-000135b0: 275d 5b6d 5d20 3d20 6765 7461 7474 7228  '][m] = getattr(
-000135c0: 7061 7261 6d73 5b27 7070 7364 735f 6f62  params['ppsds_ob
-000135d0: 7370 7927 5d5b 275a 275d 2c20 6d29 0a20  spy']['Z'], m). 
-000135e0: 2020 2020 2020 2070 6172 616d 735b 2770         params['p
-000135f0: 7073 6473 275d 5b27 4527 5d5b 6d5d 203d  psds']['E'][m] =
-00013600: 2067 6574 6174 7472 2870 6172 616d 735b   getattr(params[
-00013610: 2770 7073 6473 5f6f 6273 7079 275d 5b27  'ppsds_obspy']['
-00013620: 4527 5d2c 206d 290a 2020 2020 2020 2020  E'], m).        
-00013630: 7061 7261 6d73 5b27 7070 7364 7327 5d5b  params['ppsds'][
-00013640: 274e 275d 5b6d 5d20 3d20 6765 7461 7474  'N'][m] = getatt
-00013650: 7228 7061 7261 6d73 5b27 7070 7364 735f  r(params['ppsds_
-00013660: 6f62 7370 7927 5d5b 274e 275d 2c20 6d29  obspy']['N'], m)
-00013670: 0a20 2020 2020 2020 2069 6620 6d20 696e  .        if m in
-00013680: 206c 6973 744c 6973 743a 0a20 2020 2020   listList:.     
-00013690: 2020 2020 2020 2070 6172 616d 735b 2770         params['p
-000136a0: 7073 6473 275d 5b27 5a27 5d5b 6d5d 203d  psds']['Z'][m] =
-000136b0: 206e 702e 6172 7261 7928 7061 7261 6d73   np.array(params
-000136c0: 5b27 7070 7364 7327 5d5b 275a 275d 5b6d  ['ppsds']['Z'][m
-000136d0: 5d29 0a20 2020 2020 2020 2020 2020 2070  ]).            p
-000136e0: 6172 616d 735b 2770 7073 6473 275d 5b27  arams['ppsds']['
-000136f0: 4527 5d5b 6d5d 203d 206e 702e 6172 7261  E'][m] = np.arra
-00013700: 7928 7061 7261 6d73 5b27 7070 7364 7327  y(params['ppsds'
-00013710: 5d5b 2745 275d 5b6d 5d29 0a20 2020 2020  ]['E'][m]).     
-00013720: 2020 2020 2020 2070 6172 616d 735b 2770         params['p
-00013730: 7073 6473 275d 5b27 4e27 5d5b 6d5d 203d  psds']['N'][m] =
-00013740: 206e 702e 6172 7261 7928 7061 7261 6d73   np.array(params
-00013750: 5b27 7070 7364 7327 5d5b 274e 275d 5b6d  ['ppsds']['N'][m
-00013760: 5d29 0a0a 2020 2020 2343 7265 6174 6520  ])..    #Create 
-00013770: 6469 6374 2065 6e74 7279 2074 6f20 6b65  dict entry to ke
-00013780: 6570 2074 7261 636b 206f 6620 686f 7720  ep track of how 
-00013790: 6d61 6e79 206f 7574 6c69 6572 2068 7673  many outlier hvs
-000137a0: 7220 6375 7276 6573 2061 7265 2072 656d  r curves are rem
-000137b0: 6f76 6564 2028 322d 6974 656d 206c 6973  oved (2-item lis
-000137c0: 7420 7769 7468 205b 305d 3d63 7572 7265  t with [0]=curre
-000137d0: 6e74 206e 756d 6265 722c 205b 315d 3d6f  nt number, [1]=o
-000137e0: 7269 6769 6e61 6c20 6e75 6d62 6572 206f  riginal number o
-000137f0: 6620 6375 7276 6573 290a 2020 2020 7061  f curves).    pa
-00013800: 7261 6d73 5b27 7473 7465 7073 5f75 7365  rams['tsteps_use
-00013810: 6427 5d20 3d20 5b70 6172 616d 735b 2770  d'] = [params['p
-00013820: 7073 6473 275d 5b27 5a27 5d5b 2774 696d  psds']['Z']['tim
-00013830: 6573 5f70 726f 6365 7373 6564 275d 2e73  es_processed'].s
-00013840: 6861 7065 5b30 5d2c 2070 6172 616d 735b  hape[0], params[
-00013850: 2770 7073 6473 275d 5b27 5a27 5d5b 2774  'ppsds']['Z']['t
-00013860: 696d 6573 5f70 726f 6365 7373 6564 275d  imes_processed']
-00013870: 2e73 6861 7065 5b30 5d5d 0a20 2020 200a  .shape[0]].    .
-00013880: 2020 2020 2352 656d 6f76 6520 6f75 746c      #Remove outl
-00013890: 6965 7220 7070 7364 7320 2874 686f 7365  ier ppsds (those
-000138a0: 2064 6572 6976 6564 2066 726f 6d20 6461   derived from da
-000138b0: 7461 2077 6974 6869 6e20 7468 6520 7769  ta within the wi
-000138c0: 6e64 6f77 7320 746f 2062 6520 7265 6d6f  ndows to be remo
-000138d0: 7665 6429 0a20 2020 2069 6620 7265 6d6f  ved).    if remo
-000138e0: 7665 5f6f 7574 6c69 6572 7320 616e 6420  ve_outliers and 
-000138f0: 2778 7769 6e64 6f77 735f 6f75 7427 2069  'xwindows_out' i
-00013900: 6e20 7061 7261 6d73 2e6b 6579 7328 293a  n params.keys():
-00013910: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
-00013920: 3d20 7265 6d6f 7665 5f6f 7574 6c69 6572  = remove_outlier
-00013930: 5f70 7073 6473 2870 6172 616d 732c 206f  _ppsds(params, o
-00013940: 7574 6c69 6572 5f73 7464 3d6f 7574 6c69  utlier_std=outli
-00013950: 6572 5f73 7464 2c20 7070 7364 5f6c 656e  er_std, ppsd_len
-00013960: 6774 683d 7070 7364 5f6b 7761 7267 735b  gth=ppsd_kwargs[
-00013970: 2770 7073 645f 6c65 6e67 7468 275d 290a  'ppsd_length']).
-00013980: 2020 2020 7061 7261 6d73 5b27 7473 7465      params['tste
-00013990: 7073 5f75 7365 6427 5d5b 305d 203d 2070  ps_used'][0] = p
-000139a0: 6172 616d 735b 2770 7073 6473 275d 5b27  arams['ppsds']['
-000139b0: 5a27 5d5b 2763 7572 7265 6e74 5f74 696d  Z']['current_tim
-000139c0: 6573 5f75 7365 6427 5d2e 7368 6170 655b  es_used'].shape[
-000139d0: 305d 0a20 2020 200a 2020 2020 7265 7475  0].    .    retu
-000139e0: 726e 2070 6172 616d 730a 0a23 5265 6d6f  rn params..#Remo
-000139f0: 7665 206f 7574 6c69 6572 2070 7073 6473  ve outlier ppsds
-00013a00: 0a64 6566 2072 656d 6f76 655f 6f75 746c  .def remove_outl
-00013a10: 6965 725f 7070 7364 7328 7061 7261 6d73  ier_ppsds(params
-00013a20: 2c20 6f75 746c 6965 725f 7374 643d 332c  , outlier_std=3,
-00013a30: 2070 7073 645f 6c65 6e67 7468 3d36 3029   ppsd_length=60)
-00013a40: 3a0a 2020 2020 2222 2246 756e 6374 696f  :.    """Functio
-00013a50: 6e20 7573 6564 2069 6e20 6765 6e65 7261  n used in genera
-00013a60: 7465 5f70 7073 6473 2829 2074 6f20 7265  te_ppsds() to re
-00013a70: 6d6f 7665 206f 7574 6c69 6572 732e 204d  move outliers. M
-00013a80: 6179 2061 6c73 6f20 6265 2075 7365 6420  ay also be used 
-00013a90: 696e 6465 7065 6e64 656e 746c 792e 0a20  independently.. 
-00013aa0: 2020 200a 2020 2020 5468 6973 2075 7365     .    This use
-00013ab0: 7320 7468 6520 6d65 616e 2076 616c 7565  s the mean value
-00013ac0: 206f 6620 7468 6520 656e 7469 7265 7479   of the entirety
-00013ad0: 206f 6620 6561 6368 2070 7073 6420 6375   of each ppsd cu
-00013ae0: 7276 652e 2054 6869 7320 6973 206e 6f74  rve. This is not
-00013af0: 2076 6572 7920 726f 6275 7374 2c20 6275   very robust, bu
-00013b00: 7420 6974 2069 7320 696e 7465 6e64 6564  t it is intended
-00013b10: 206f 6e6c 7920 746f 2072 656d 6f76 6520   only to remove 
-00013b20: 6375 7276 6573 2077 686f 2061 7265 2077  curves who are w
-00013b30: 656c 6c20 6f75 7473 6964 6520 6f66 2074  ell outside of t
-00013b40: 6865 2077 6861 7420 776f 756c 6420 6265  he what would be
-00013b50: 2065 7870 6563 7465 642e 0a20 2020 2054   expected..    T
-00013b60: 6865 7365 2061 6262 6572 616e 7420 6375  hese abberant cu
-00013b70: 7276 6573 206f 6674 656e 206f 6363 7572  rves often occur
-00013b80: 2064 7565 2074 6f20 7468 6520 7265 6d6f   due to the remo
-00013b90: 7665 5f6e 6f69 7365 2829 2066 756e 6374  ve_noise() funct
-00013ba0: 696f 6e2e 0a0a 2020 2020 5061 7261 6d65  ion...    Parame
-00013bb0: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
-00013bc0: 2d2d 2d0a 2020 2020 7061 7261 6d73 203a  ---.    params :
-00013bd0: 2064 6963 740a 2020 2020 2020 2020 496e   dict.        In
-00013be0: 7075 7420 6469 6374 696f 6e61 7279 2063  put dictionary c
-00013bf0: 6f6e 7461 696e 696e 6720 616c 6c20 7468  ontaining all th
-00013c00: 6520 7661 6c75 6573 2061 6e64 2070 6172  e values and par
-00013c10: 616d 6574 6572 7320 6f66 2069 6e74 6572  ameters of inter
-00013c20: 6573 740a 2020 2020 6f75 746c 6965 725f  est.    outlier_
-00013c30: 7374 6420 3a20 2066 6c6f 6174 2c20 6465  std :  float, de
-00013c40: 6661 756c 743d 330a 2020 2020 2020 2020  fault=3.        
-00013c50: 5468 6520 7374 616e 6461 7264 2064 6576  The standard dev
-00013c60: 6961 7469 6f6e 2076 616c 7565 2074 6f20  iation value to 
-00013c70: 7573 6520 6173 2061 2074 6872 6573 686f  use as a thresho
-00013c80: 6c64 2066 6f72 2064 6574 6572 6d69 6e69  ld for determini
-00013c90: 6e67 2077 6865 7468 6572 2061 2063 7572  ng whether a cur
-00013ca0: 7665 2069 7320 616e 206f 7574 6c69 6572  ve is an outlier
-00013cb0: 2e20 0a20 2020 2020 2020 2054 6869 7320  . .        This 
-00013cc0: 6176 6572 6167 6573 206f 7665 7220 7468  averages over th
-00013cd0: 6520 656e 7469 7265 2063 7572 7665 2073  e entire curve s
-00013ce0: 6f20 7468 6174 2063 7572 7665 7320 7769  o that curves wi
-00013cf0: 7468 2076 6572 7920 6162 6265 7261 6e74  th very abberant
-00013d00: 2064 6174 6120 286f 6674 656e 206f 6363   data (often occ
-00013d10: 7572 7320 7768 656e 2075 7369 6e67 2074  urs when using t
-00013d20: 6865 2072 656d 6f76 655f 6e6f 6973 6528  he remove_noise(
-00013d30: 2920 6d65 7468 6f64 292c 2063 616e 2062  ) method), can b
-00013d40: 6520 6964 656e 7469 6669 6564 2e0a 2020  e identified..  
-00013d50: 2020 7070 7364 5f6c 656e 6774 6820 3a20    ppsd_length : 
-00013d60: 666c 6f61 742c 206f 7074 696f 6e61 6c0a  float, optional.
-00013d70: 2020 2020 2020 2020 4c65 6e67 7468 206f          Length o
-00013d80: 6620 6461 7461 2073 6567 6d65 6e74 7320  f data segments 
-00013d90: 7061 7373 6564 2074 6f20 7073 6420 696e  passed to psd in
-00013da0: 2073 6563 6f6e 6473 2c20 6279 2064 6566   seconds, by def
-00013db0: 6175 6c74 2036 302e 0a0a 2020 2020 5265  ault 60...    Re
-00013dc0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-00013dd0: 2d0a 2020 2020 7061 7261 6d73 203a 2064  -.    params : d
-00013de0: 6963 740a 2020 2020 2020 2020 496e 7075  ict.        Inpu
-00013df0: 7420 6469 6374 696f 6e61 7279 2077 6974  t dictionary wit
-00013e00: 6820 7661 6c75 6573 206d 6f64 6966 6965  h values modifie
-00013e10: 6420 6261 7365 6420 6f6e 2077 6f72 6b20  d based on work 
-00013e20: 6f66 2066 756e 6374 696f 6e2e 0a20 2020  of function..   
-00013e30: 2022 2222 0a20 2020 200a 2020 2020 7070   """.    .    pp
-00013e40: 7364 7320 3d20 7061 7261 6d73 5b27 7070  sds = params['pp
-00013e50: 7364 7327 5d0a 2020 2020 6e65 7750 5073  sds'].    newPPs
-00013e60: 6473 203d 207b 7d0a 2020 2020 7374 6473  ds = {}.    stds
-00013e70: 203d 207b 7d0a 2020 2020 7073 6473 5f74   = {}.    psds_t
-00013e80: 6f5f 7269 6420 3d20 5b5d 0a0a 0a20 2020  o_rid = []...   
-00013e90: 2066 6f72 206b 2069 6e20 7070 7364 733a   for k in ppsds:
-00013ea0: 0a20 2020 2020 2020 2070 7364 5661 6c73  .        psdVals
-00013eb0: 203d 206e 702e 6172 7261 7928 7070 7364   = np.array(ppsd
-00013ec0: 735b 6b5d 5b27 7073 645f 7661 6c75 6573  s[k]['psd_values
-00013ed0: 275d 290a 2020 2020 2020 2020 6d65 616e  ']).        mean
-00013ee0: 4172 7220 3d20 6e70 2e6e 616e 6d65 616e  Arr = np.nanmean
-00013ef0: 2870 7364 5661 6c73 2c20 6178 6973 3d31  (psdVals, axis=1
-00013f00: 290a 2020 2020 2020 2020 6e65 7750 5073  ).        newPPs
-00013f10: 6473 5b6b 5d20 3d20 5b5d 0a20 2020 2020  ds[k] = [].     
-00013f20: 2020 2074 6f74 4d65 616e 203d 206e 702e     totMean = np.
-00013f30: 6e61 6e6d 6561 6e28 6d65 616e 4172 7229  nanmean(meanArr)
-00013f40: 0a20 2020 2020 2020 2073 7464 735b 6b5d  .        stds[k]
-00013f50: 203d 206e 702e 7374 6428 6d65 616e 4172   = np.std(meanAr
-00013f60: 7229 0a0a 2020 2020 2020 2020 666f 7220  r)..        for 
-00013f70: 692c 206d 2069 6e20 656e 756d 6572 6174  i, m in enumerat
-00013f80: 6528 6d65 616e 4172 7229 3a0a 2020 2020  e(meanArr):.    
-00013f90: 2020 2020 2020 2020 6966 206d 203e 2074          if m > t
-00013fa0: 6f74 4d65 616e 202b 206f 7574 6c69 6572  otMean + outlier
-00013fb0: 5f73 7464 2a73 7464 735b 6b5d 206f 7220  _std*stds[k] or 
-00013fc0: 6d20 3c20 746f 744d 6561 6e20 2d20 6f75  m < totMean - ou
-00013fd0: 746c 6965 725f 7374 642a 7374 6473 5b6b  tlier_std*stds[k
-00013fe0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00013ff0: 2020 2070 7364 735f 746f 5f72 6964 2e61     psds_to_rid.a
-00014000: 7070 656e 6428 6929 0a0a 2020 2020 2020  ppend(i)..      
-00014010: 2020 6375 7272 5f74 696d 6573 5f6d 706c    curr_times_mpl
-00014020: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-00014030: 7220 692c 2074 2069 6e20 656e 756d 6572  r i, t in enumer
-00014040: 6174 6528 7070 7364 735b 6b5d 5b27 6375  ate(ppsds[k]['cu
-00014050: 7272 656e 745f 7469 6d65 735f 7573 6564  rrent_times_used
-00014060: 275d 293a 0a20 2020 2020 2020 2020 2020  ']):.           
-00014070: 2063 7572 725f 7469 6d65 735f 6d70 6c2e   curr_times_mpl.
-00014080: 6170 7065 6e64 2874 2e6d 6174 706c 6f74  append(t.matplot
-00014090: 6c69 625f 6461 7465 290a 0a20 2020 2020  lib_date)..     
-000140a0: 2020 2023 4765 7420 7070 7364 206c 656e     #Get ppsd len
-000140b0: 6774 6820 696e 2073 6563 6f6e 6473 2069  gth in seconds i
-000140c0: 6e20 6d61 7470 6c6f 746c 6962 2066 6f72  n matplotlib for
-000140d0: 6d61 740a 2020 2020 2020 2020 7070 7364  mat.        ppsd
-000140e0: 5f6c 656e 6774 685f 6d70 6c20 3d20 7070  _length_mpl = pp
-000140f0: 7364 5f6c 656e 6774 682f 3836 3430 300a  sd_length/86400.
-00014100: 0a20 2020 2020 2020 2023 2355 5044 4154  .        ##UPDAT
-00014110: 4520 5448 4953 204e 4f54 2054 4f20 5553  E THIS NOT TO US
-00014120: 4520 7857 696e 646f 7773 5f6f 7574 2028  E xWindows_out (
-00014130: 6361 6c63 756c 6174 6520 6672 6f6d 206d  calculate from m
-00014140: 6173 6b29 0a20 2020 2020 2020 2023 4368  ask).        #Ch
-00014150: 6563 6b20 6966 2061 6e79 2074 696d 6573  eck if any times
-00014160: 2066 616c 6c20 696e 2065 7863 6c75 6465   fall in exclude
-00014170: 6420 7a6f 6e65 0a20 2020 2020 2020 2066  d zone.        f
-00014180: 6f72 2069 2c20 7420 696e 2065 6e75 6d65  or i, t in enume
-00014190: 7261 7465 2863 7572 725f 7469 6d65 735f  rate(curr_times_
-000141a0: 6d70 6c29 3a0a 2020 2020 2020 2020 2020  mpl):.          
-000141b0: 2020 6e65 7874 5420 3d20 7420 2b20 7070    nextT = t + pp
-000141c0: 7364 5f6c 656e 6774 685f 6d70 6c0a 2020  sd_length_mpl.  
-000141d0: 2020 2020 2020 2020 2020 666f 7220 772c            for w,
-000141e0: 2077 696e 2069 6e20 656e 756d 6572 6174   win in enumerat
-000141f0: 6528 7061 7261 6d73 5b27 7877 696e 646f  e(params['xwindo
-00014200: 7773 5f6f 7574 275d 293a 0a20 2020 2020  ws_out']):.     
-00014210: 2020 2020 2020 2020 2020 2069 6620 7420             if t 
-00014220: 3e20 7769 6e5b 305d 2061 6e64 2074 203c  > win[0] and t <
-00014230: 2077 696e 5b31 5d3a 0a20 2020 2020 2020   win[1]:.       
-00014240: 2020 2020 2020 2020 2020 2020 2070 7364               psd
-00014250: 735f 746f 5f72 6964 2e61 7070 656e 6428  s_to_rid.append(
-00014260: 6929 0a20 2020 2020 2020 2020 2020 2020  i).             
-00014270: 2020 2065 6c69 6620 6e65 7874 5420 3e20     elif nextT > 
-00014280: 7769 6e5b 305d 2061 6e64 206e 6578 7454  win[0] and nextT
-00014290: 203c 2077 696e 5b31 5d3a 0a20 2020 2020   < win[1]:.     
-000142a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000142b0: 7364 735f 746f 5f72 6964 2e61 7070 656e  sds_to_rid.appen
-000142c0: 6428 6929 0a20 2020 200a 2020 2020 7073  d(i).    .    ps
-000142d0: 6473 5f74 6f5f 7269 6420 3d20 6e70 2e75  ds_to_rid = np.u
-000142e0: 6e69 7175 6528 7073 6473 5f74 6f5f 7269  nique(psds_to_ri
-000142f0: 6429 0a0a 2020 2020 666f 7220 6b20 696e  d)..    for k in
-00014300: 2070 6172 616d 735b 2770 7073 6473 275d   params['ppsds']
-00014310: 3a0a 2020 2020 2020 2020 666f 7220 692c  :.        for i,
-00014320: 2072 2069 6e20 656e 756d 6572 6174 6528   r in enumerate(
-00014330: 7073 6473 5f74 6f5f 7269 6429 3a0a 2020  psds_to_rid):.  
-00014340: 2020 2020 2020 2020 2020 696e 6465 7820            index 
-00014350: 3d20 696e 7428 722d 6929 0a20 2020 2020  = int(r-i).     
-00014360: 2020 2020 2020 2070 6172 616d 735b 2770         params['p
-00014370: 7073 6473 275d 5b6b 5d5b 2770 7364 5f76  psds'][k]['psd_v
-00014380: 616c 7565 7327 5d20 3d20 6e70 2e64 656c  alues'] = np.del
-00014390: 6574 6528 7061 7261 6d73 5b27 7070 7364  ete(params['ppsd
-000143a0: 7327 5d5b 6b5d 5b27 7073 645f 7661 6c75  s'][k]['psd_valu
-000143b0: 6573 275d 2c20 696e 6465 782c 2061 7869  es'], index, axi
-000143c0: 733d 3029 0a20 2020 2020 2020 2020 2020  s=0).           
-000143d0: 2070 6172 616d 735b 2770 7073 6473 275d   params['ppsds']
-000143e0: 5b6b 5d5b 2763 7572 7265 6e74 5f74 696d  [k]['current_tim
-000143f0: 6573 5f75 7365 6427 5d20 3d20 6e70 2e64  es_used'] = np.d
-00014400: 656c 6574 6528 7061 7261 6d73 5b27 7070  elete(params['pp
-00014410: 7364 7327 5d5b 6b5d 5b27 6375 7272 656e  sds'][k]['curren
-00014420: 745f 7469 6d65 735f 7573 6564 275d 2c20  t_times_used'], 
-00014430: 696e 6465 782c 2061 7869 733d 3029 0a20  index, axis=0). 
-00014440: 2020 2072 6574 7572 6e20 7061 7261 6d73     return params
-00014450: 0a0a 2343 6865 636b 2074 6865 2078 2d76  ..#Check the x-v
-00014460: 616c 7565 7320 666f 7220 6561 6368 2063  alues for each c
-00014470: 6861 6e6e 656c 2c20 746f 206d 616b 6520  hannel, to make 
-00014480: 7375 7265 2074 6865 7920 6172 6520 616c  sure they are al
-00014490: 6c20 7468 6520 7361 6d65 206c 656e 6774  l the same lengt
-000144a0: 680a 6465 6620 5f5f 6368 6563 6b5f 7876  h.def __check_xv
-000144b0: 616c 7565 7328 7070 7364 7329 3a0a 2020  alues(ppsds):.  
-000144c0: 2020 2222 2243 6865 636b 2078 5f76 616c    """Check x_val
-000144d0: 7565 7320 6f66 2050 5053 4453 2074 6f20  ues of PPSDS to 
-000144e0: 6d61 6b65 2073 7572 6520 7468 6579 2061  make sure they a
-000144f0: 7265 2061 6c6c 2074 6865 2073 616d 6520  re all the same 
-00014500: 6c65 6e67 7468 2222 220a 2020 2020 784c  length""".    xL
-00014510: 656e 6774 6873 203d 205b 5d0a 2020 2020  engths = [].    
-00014520: 666f 7220 6b20 696e 2070 7073 6473 2e6b  for k in ppsds.k
-00014530: 6579 7328 293a 0a20 2020 2020 2020 2078  eys():.        x
-00014540: 4c65 6e67 7468 732e 6170 7065 6e64 286c  Lengths.append(l
-00014550: 656e 2870 7073 6473 5b6b 5d5b 2770 6572  en(ppsds[k]['per
-00014560: 696f 645f 6269 6e5f 6365 6e74 6572 7327  iod_bin_centers'
-00014570: 5d29 290a 2020 2020 6966 206c 656e 2873  ])).    if len(s
-00014580: 6574 2878 4c65 6e67 7468 7329 2920 3c3d  et(xLengths)) <=
-00014590: 2031 3a0a 2020 2020 2020 2020 7061 7373   1:.        pass
-000145a0: 2023 5468 6973 206d 6561 6e73 2061 6c6c   #This means all
-000145b0: 2063 6861 6e6e 656c 7320 6861 7665 2073   channels have s
-000145c0: 616d 6520 6e75 6d62 6572 206f 6620 7065  ame number of pe
-000145d0: 7269 6f64 5f62 696e 5f63 656e 7465 7273  riod_bin_centers
-000145e0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-000145f0: 2020 2070 7269 6e74 2827 582d 7661 6c75     print('X-valu
-00014600: 6573 2028 7065 7269 6f64 7320 6f72 2066  es (periods or f
-00014610: 7265 7175 656e 6369 6573 2920 646f 206e  requencies) do n
-00014620: 6f74 2068 6176 6520 7468 6520 7361 6d65  ot have the same
-00014630: 2076 616c 7565 732e 205c 6e20 5468 6973   values. \n This
-00014640: 206d 6179 2072 6573 756c 7420 696e 2063   may result in c
-00014650: 6f6d 7075 7461 7469 6f6e 616c 2065 7272  omputational err
-00014660: 6f72 7327 290a 2020 2020 2020 2020 2344  ors').        #D
-00014670: 6f20 7374 7566 6620 746f 2066 6978 2069  o stuff to fix i
-00014680: 743f 0a20 2020 2072 6574 7572 6e20 7070  t?.    return pp
-00014690: 7364 730a 0a23 4368 6563 6b20 746f 206d  sds..#Check to m
-000146a0: 616b 6520 7468 6520 6e75 6d62 6572 206f  ake the number o
-000146b0: 6620 7469 6d65 2d73 7465 7073 2061 7265  f time-steps are
-000146c0: 2074 6865 2073 616d 6520 666f 7220 6561   the same for ea
-000146d0: 6368 2063 6861 6e6e 656c 0a64 6566 205f  ch channel.def _
-000146e0: 5f63 6865 636b 5f74 7374 6570 7328 6876  _check_tsteps(hv
-000146f0: 7372 5f64 6963 7429 3a0a 2020 2020 2222  sr_dict):.    ""
-00014700: 2243 6865 636b 2074 696d 6520 7374 6570  "Check time step
-00014710: 7320 6f66 2050 5053 4453 2074 6f20 6d61  s of PPSDS to ma
-00014720: 6b65 2073 7572 6520 7468 6579 2061 7265  ke sure they are
-00014730: 2061 6c6c 2074 6865 2073 616d 6520 6c65   all the same le
-00014740: 6e67 7468 2222 220a 2020 2020 7070 7364  ngth""".    ppsd
-00014750: 7320 3d20 6876 7372 5f64 6963 745b 2770  s = hvsr_dict['p
-00014760: 7073 6473 275d 0a20 2020 2074 5374 6570  psds'].    tStep
-00014770: 7320 3d20 5b5d 0a20 2020 2066 6f72 206b  s = [].    for k
-00014780: 2069 6e20 7070 7364 732e 6b65 7973 2829   in ppsds.keys()
-00014790: 3a0a 2020 2020 2020 2020 7453 7465 7073  :.        tSteps
-000147a0: 2e61 7070 656e 6428 6e70 2e61 7272 6179  .append(np.array
-000147b0: 2870 7073 6473 5b6b 5d5b 2770 7364 5f76  (ppsds[k]['psd_v
-000147c0: 616c 7565 7327 5d29 2e73 6861 7065 5b30  alues']).shape[0
-000147d0: 5d29 0a20 2020 2069 6620 6c65 6e28 7365  ]).    if len(se
-000147e0: 7428 7453 7465 7073 2929 203c 3d20 313a  t(tSteps)) <= 1:
-000147f0: 0a20 2020 2020 2020 2070 6173 7320 2354  .        pass #T
-00014800: 6869 7320 6d65 616e 7320 616c 6c20 6368  his means all ch
-00014810: 616e 6e65 6c73 2068 6176 6520 7361 6d65  annels have same
-00014820: 206e 756d 6265 7220 6f66 2070 6572 696f   number of perio
-00014830: 645f 6269 6e5f 6365 6e74 6572 730a 2020  d_bin_centers.  
-00014840: 2020 2020 2020 6d69 6e54 5374 6570 3d74        minTStep=t
-00014850: 5374 6570 735b 305d 0a20 2020 2065 6c73  Steps[0].    els
-00014860: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
-00014870: 2827 5468 6572 6520 6973 2061 2064 6966  ('There is a dif
-00014880: 6665 7265 6e74 206e 756d 6265 7220 6f66  ferent number of
-00014890: 2074 696d 652d 7374 6570 7320 7573 6564   time-steps used
-000148a0: 2074 6f20 6361 6c63 756c 6174 6520 4856   to calculate HV
-000148b0: 5352 2063 7572 7665 732e 205c 6e20 5468  SR curves. \n Th
-000148c0: 6973 206d 6179 2072 6573 756c 7420 696e  is may result in
-000148d0: 2063 6f6d 7075 7461 7469 6f6e 616c 2065   computational e
-000148e0: 7272 6f72 732e 2054 7269 6d6d 696e 6720  rrors. Trimming 
-000148f0: 6c6f 6e67 6573 742e 2729 0a20 2020 2020  longest.').     
-00014900: 2020 206d 696e 5453 7465 7020 3d20 6d69     minTStep = mi
-00014910: 6e28 7453 7465 7073 290a 2020 2020 7265  n(tSteps).    re
-00014920: 7475 726e 206d 696e 5453 7465 700a 0a23  turn minTStep..#
-00014930: 4d61 696e 2066 756e 6374 696f 6e20 666f  Main function fo
-00014940: 7220 7072 6f63 6573 7369 6e67 2048 5653  r processing HVS
-00014950: 5220 4375 7276 650a 6465 6620 7072 6f63  R Curve.def proc
-00014960: 6573 735f 6876 7372 2870 6172 616d 732c  ess_hvsr(params,
-00014970: 206d 6574 686f 643d 342c 2073 6d6f 6f74   method=4, smoot
-00014980: 683d 5472 7565 2c20 6672 6571 5f73 6d6f  h=True, freq_smo
-00014990: 6f74 683d 276b 6f6e 6e6f 206f 686d 6163  oth='konno ohmac
-000149a0: 6869 272c 2066 5f73 6d6f 6f74 685f 7769  hi', f_smooth_wi
-000149b0: 6474 683d 3430 2c20 7265 7361 6d70 6c65  dth=40, resample
-000149c0: 3d54 7275 652c 2072 656d 6f76 655f 6f75  =True, remove_ou
-000149d0: 746c 6965 725f 6375 7276 6573 3d54 7275  tlier_curves=Tru
-000149e0: 652c 206f 7574 6c69 6572 5f63 7572 7665  e, outlier_curve
-000149f0: 5f73 7464 3d31 2e37 3529 3a0a 2020 2020  _std=1.75):.    
-00014a00: 2222 2250 726f 6365 7373 2074 6865 2069  """Process the i
-00014a10: 6e70 7574 2064 6174 6120 616e 6420 6765  nput data and ge
-00014a20: 7420 4856 5352 2064 6174 610a 2020 2020  t HVSR data.    
-00014a30: 0a20 2020 2054 6869 7320 6973 2074 6865  .    This is the
-00014a40: 206d 6169 6e20 6675 6e63 7469 6f6e 2074   main function t
-00014a50: 6861 7420 7573 6573 206f 7468 6572 2028  hat uses other (
-00014a60: 7072 6976 6174 6529 2066 756e 6374 696f  private) functio
-00014a70: 6e73 2074 6f20 646f 200a 2020 2020 7468  ns to do .    th
-00014a80: 6520 6275 6c6b 206f 6620 7072 6f63 6573  e bulk of proces
-00014a90: 7369 6e67 206f 6620 7468 6520 4856 5352  sing of the HVSR
-00014aa0: 2064 6174 6120 616e 6420 7468 6520 6461   data and the da
-00014ab0: 7461 2071 7561 6c69 7479 2063 6865 636b  ta quality check
-00014ac0: 732e 0a0a 2020 2020 5061 7261 6d65 7465  s...    Paramete
-00014ad0: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00014ae0: 2d0a 2020 2020 7061 7261 6d73 2020 3a20  -.    params  : 
-00014af0: 6469 6374 0a20 2020 2020 2020 2044 6963  dict.        Dic
-00014b00: 7469 6f6e 6172 7920 636f 6e74 6169 6e69  tionary containi
-00014b10: 6e67 2061 6c6c 2074 6865 2070 6172 616d  ng all the param
-00014b20: 6574 6572 7320 696e 7075 7420 6279 2074  eters input by t
-00014b30: 6865 2075 7365 720a 2020 2020 6d65 7468  he user.    meth
-00014b40: 6f64 2020 3a20 696e 7420 6f72 2073 7472  od  : int or str
-00014b50: 0a20 2020 2020 2020 204d 6574 686f 6420  .        Method 
-00014b60: 746f 2075 7365 2066 6f72 2063 6f6d 6269  to use for combi
-00014b70: 6e69 6e67 2074 6865 2068 6f72 697a 6f6e  ning the horizon
-00014b80: 7461 6c20 636f 6d70 6f6e 656e 7473 0a20  tal components. 
-00014b90: 2020 2020 2020 2020 2020 2030 2920 4469             0) Di
-00014ba0: 6666 7573 6520 6669 656c 6420 6173 7375  ffuse field assu
-00014bb0: 6d70 7469 6f6e 2c20 6f72 2027 4446 4127  mption, or 'DFA'
-00014bc0: 2028 6e6f 7420 6375 7272 656e 746c 7920   (not currently 
-00014bd0: 696d 706c 656d 656e 7465 6429 0a20 2020  implemented).   
-00014be0: 2020 2020 2020 2020 2031 2920 2741 7269           1) 'Ari
-00014bf0: 7468 6d65 7469 6320 4d65 616e 273a 2048  thmetic Mean': H
-00014c00: 20e2 89a1 2028 484e 202b 2048 4529 2f32   ... (HN + HE)/2
-00014c10: 0a20 2020 2020 2020 2020 2020 2032 2920  .            2) 
-00014c20: 2747 656f 6d65 7472 6963 204d 6561 6e27  'Geometric Mean'
-00014c30: 3a20 4820 e289 a120 e288 9a48 4e20 c2b7  : H ... ...HN ..
-00014c40: 2048 452c 2072 6563 6f6d 6d65 6e64 6564   HE, recommended
-00014c50: 2062 7920 7468 6520 5345 5341 4d45 2070   by the SESAME p
-00014c60: 726f 6a65 6374 2028 3230 3034 290a 2020  roject (2004).  
-00014c70: 2020 2020 2020 2020 2020 3329 2027 5665            3) 'Ve
-00014c80: 6374 6f72 2053 756d 6d61 7469 6f6e 273a  ctor Summation':
-00014c90: 2048 20e2 89a1 20e2 889a 4832 204e 202b   H ... ...H2 N +
-00014ca0: 2048 3220 450a 2020 2020 2020 2020 2020   H2 E.          
-00014cb0: 2020 3429 2027 5175 6164 7261 7469 6320    4) 'Quadratic 
-00014cc0: 4d65 616e 273a 2048 20e2 89a1 20e2 889a  Mean': H ... ...
-00014cd0: 2848 3220 4e20 2b20 4832 2045 2029 2f32  (H2 N + H2 E )/2
-00014ce0: 0a20 2020 2020 2020 2020 2020 2035 2920  .            5) 
-00014cf0: 274d 6178 696d 756d 2048 6f72 697a 6f6e  'Maximum Horizon
-00014d00: 7461 6c20 5661 6c75 6527 3a20 4820 e289  tal Value': H ..
-00014d10: a120 6d61 7820 7b48 4e2c 2048 457d 0a20  . max {HN, HE}. 
-00014d20: 2020 2073 6d6f 6f74 6820 203a 2062 6f6f     smooth  : boo
-00014d30: 6c3d 5472 7565 0a20 2020 2020 2020 2062  l=True.        b
-00014d40: 6f6f 6c20 6f72 2069 6e74 2e20 0a20 2020  ool or int. .   
-00014d50: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-00014d60: 2c20 6465 6661 756c 7420 746f 2073 6d6f  , default to smo
-00014d70: 6f74 6820 482f 5620 6375 7276 6520 746f  oth H/V curve to
-00014d80: 2075 7369 6e67 2073 6176 676f 7920 6669   using savgoy fi
-00014d90: 6c74 6572 2077 6974 6820 7769 6e64 6f77  lter with window
-00014da0: 206c 656e 6774 6820 6f66 2035 3120 2877   length of 51 (w
-00014db0: 6f72 6b73 2077 656c 6c20 7769 7468 2064  orks well with d
-00014dc0: 6566 6175 6c74 2072 6573 616d 706c 6520  efault resample 
-00014dd0: 6f66 2031 3030 3020 7074 7329 0a20 2020  of 1000 pts).   
-00014de0: 2020 2020 2020 2020 2049 6620 696e 742c           If int,
-00014df0: 2074 6865 206c 656e 6774 6820 6f66 2074   the length of t
-00014e00: 6865 2077 696e 646f 7720 696e 2074 6865  he window in the
-00014e10: 2073 6176 676f 7920 6669 6c74 6572 2e0a   savgoy filter..
-00014e20: 2020 2020 6672 6571 5f73 6d6f 6f74 6820      freq_smooth 
-00014e30: 3a20 7374 7220 7b27 6b6f 6e6e 6f20 6f68  : str {'konno oh
-00014e40: 6d61 6368 6927 2c20 2763 6f6e 7374 616e  machi', 'constan
-00014e50: 7427 2c20 2770 726f 706f 7274 696f 6e61  t', 'proportiona
-00014e60: 6c27 7d0a 2020 2020 2020 2020 5768 6963  l'}.        Whic
-00014e70: 6820 6672 6571 7565 6e63 7920 736d 6f6f  h frequency smoo
-00014e80: 7468 696e 6720 6d65 7468 6f64 2074 6f20  thing method to 
-00014e90: 7573 652e 2042 7920 6465 6661 756c 742c  use. By default,
-00014ea0: 2075 7365 7320 7468 6520 276b 6f6e 6e6f   uses the 'konno
-00014eb0: 206f 686d 6163 6869 2720 6d65 7468 6f64   ohmachi' method
-00014ec0: 2e0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
-00014ed0: 5468 6520 4b6f 6e6e 6f20 2620 4f68 6d61  The Konno & Ohma
-00014ee0: 6368 6920 6d65 7468 6f64 2075 7365 7320  chi method uses 
-00014ef0: 7468 6520 6f62 7370 792e 7369 676e 616c  the obspy.signal
-00014f00: 2e6b 6f6e 6e6f 6f68 6d61 6368 6973 6d6f  .konnoohmachismo
-00014f10: 6f74 6869 6e67 2e6b 6f6e 6e6f 5f6f 686d  othing.konno_ohm
-00014f20: 6163 6869 5f73 6d6f 6f74 6869 6e67 2829  achi_smoothing()
-00014f30: 2066 756e 6374 696f 6e3a 2068 7474 7073   function: https
-00014f40: 3a2f 2f64 6f63 732e 6f62 7370 792e 6f72  ://docs.obspy.or
-00014f50: 672f 7061 636b 6167 6573 2f61 7574 6f67  g/packages/autog
-00014f60: 656e 2f6f 6273 7079 2e73 6967 6e61 6c2e  en/obspy.signal.
-00014f70: 6b6f 6e6e 6f6f 686d 6163 6869 736d 6f6f  konnoohmachismoo
-00014f80: 7468 696e 672e 6b6f 6e6e 6f5f 6f68 6d61  thing.konno_ohma
-00014f90: 6368 695f 736d 6f6f 7468 696e 672e 6874  chi_smoothing.ht
-00014fa0: 6d6c 0a20 2020 2020 2020 2020 2020 202d  ml.            -
-00014fb0: 2054 6865 2063 6f6e 7374 616e 7420 6d65   The constant me
-00014fc0: 7468 6f64 0a20 2020 2020 2020 2053 6565  thod.        See
-00014fd0: 2068 6572 6520 666f 7220 6d6f 7265 2069   here for more i
-00014fe0: 6e66 6f72 6d61 7469 6f6e 3a20 6874 7470  nformation: http
-00014ff0: 733a 2f2f 7777 772e 6765 6f70 7379 2e6f  s://www.geopsy.o
-00015000: 7267 2f64 6f63 756d 656e 7461 7469 6f6e  rg/documentation
-00015010: 2f67 656f 7073 792f 6876 2d70 726f 6365  /geopsy/hv-proce
-00015020: 7373 696e 672e 6874 6d6c 0a20 2020 2066  ssing.html.    f
-00015030: 5f73 6d6f 6f74 685f 7769 6474 6820 3a20  _smooth_width : 
-00015040: 696e 742c 2064 6566 6175 6c74 203d 2034  int, default = 4
-00015050: 300a 2020 2020 2020 2020 2d20 466f 7220  0.        - For 
-00015060: 276b 6f6e 6e6f 206f 686d 6163 6869 273a  'konno ohmachi':
-00015070: 2070 6173 7365 6420 6469 7265 6374 6c79   passed directly
-00015080: 2074 6f20 7468 6520 6261 6e64 7769 6474   to the bandwidt
-00015090: 6820 7061 7261 6d65 7465 7220 6f66 2074  h parameter of t
-000150a0: 6865 206b 6f6e 6e6f 5f6f 686d 6163 6869  he konno_ohmachi
-000150b0: 5f73 6d6f 6f74 6869 6e67 2829 2066 756e  _smoothing() fun
-000150c0: 6374 696f 6e2c 2064 6574 6572 6d69 6e65  ction, determine
-000150d0: 7320 7468 6520 7769 6474 6820 6f66 2074  s the width of t
-000150e0: 6865 2073 6d6f 6f74 6869 6e67 2070 6561  he smoothing pea
-000150f0: 6b2c 2077 6974 6820 6c6f 7765 7220 7661  k, with lower va
-00015100: 6c75 6573 2072 6573 756c 7469 6e67 2069  lues resulting i
-00015110: 6e20 6272 6f61 6465 7220 7065 616b 2e20  n broader peak. 
-00015120: 4d75 7374 2062 6520 3e20 302e 0a20 2020  Must be > 0..   
-00015130: 2020 2020 202d 2046 6f72 2027 636f 6e73       - For 'cons
-00015140: 7461 6e74 273a 2074 6865 2073 697a 6520  tant': the size 
-00015150: 6f66 2061 2074 7269 616e 6775 6c61 7220  of a triangular 
-00015160: 736d 6f6f 7468 696e 6720 7769 6e64 6f77  smoothing window
-00015170: 2069 6e20 7468 6520 6e75 6d62 6572 206f   in the number o
-00015180: 6620 6672 6571 7565 6e63 7920 7374 6570  f frequency step
-00015190: 730a 2020 2020 2020 2020 2d20 466f 7220  s.        - For 
-000151a0: 2770 726f 706f 7274 696f 6e61 6c27 3a20  'proportional': 
-000151b0: 7468 6520 7369 7a65 206f 6620 6120 7472  the size of a tr
-000151c0: 6961 6e67 756c 6172 2073 6d6f 6f74 6869  iangular smoothi
-000151d0: 6e67 2077 696e 646f 7720 696e 2070 6572  ng window in per
-000151e0: 6365 6e74 6167 6520 6f66 2074 6865 206e  centage of the n
-000151f0: 756d 6265 7220 6f66 2066 7265 7175 656e  umber of frequen
-00015200: 6379 2073 7465 7073 2028 652e 672e 2c20  cy steps (e.g., 
-00015210: 6966 2031 3030 3020 6672 6571 7565 6e63  if 1000 frequenc
-00015220: 7920 7374 6570 732f 6269 6e73 2061 6e64  y steps/bins and
-00015230: 2066 5f73 6d6f 6f74 685f 7769 6474 683d   f_smooth_width=
-00015240: 3430 2c20 7769 6e64 6f77 2077 6f75 6c64  40, window would
-00015250: 2062 6520 3430 3020 7374 6570 7320 7769   be 400 steps wi
-00015260: 6465 290a 2020 2020 7265 7361 6d70 6c65  de).    resample
-00015270: 2020 3a20 626f 6f6c 2c20 6465 6661 756c    : bool, defaul
-00015280: 7420 3d20 5472 7565 0a20 2020 2020 2020  t = True.       
-00015290: 2062 6f6f 6c20 6f72 2069 6e74 2e20 0a20   bool or int. . 
-000152a0: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
-000152b0: 7565 2c20 6465 6661 756c 7420 746f 2072  ue, default to r
-000152c0: 6573 616d 706c 6520 482f 5620 6461 7461  esample H/V data
-000152d0: 2074 6f20 696e 636c 7564 6520 3130 3030   to include 1000
-000152e0: 2066 7265 7175 656e 6379 2076 616c 7565   frequency value
-000152f0: 7320 666f 7220 7468 6520 7265 7374 206f  s for the rest o
-00015300: 6620 7468 6520 616e 616c 7973 6973 0a20  f the analysis. 
-00015310: 2020 2020 2020 2020 2020 2049 6620 696e             If in
-00015320: 742c 2074 6865 206e 756d 6265 7220 6f66  t, the number of
-00015330: 2064 6174 6120 706f 696e 7473 2074 6f20   data points to 
-00015340: 696e 7465 7270 6f6c 6174 652f 7265 7361  interpolate/resa
-00015350: 6d70 6c65 2f73 6d6f 6f74 6820 7468 6520  mple/smooth the 
-00015360: 636f 6d70 6f6e 656e 7420 7073 642f 4856  component psd/HV
-00015370: 2063 7572 7665 2064 6174 6120 746f 2e0a   curve data to..
-00015380: 2020 2020 7265 6d6f 7665 5f6f 7574 6c69      remove_outli
-00015390: 6572 5f63 7572 7665 7320 3a20 626f 6f6c  er_curves : bool
-000153a0: 2c20 6465 6661 756c 7420 3d20 5472 7565  , default = True
-000153b0: 0a20 2020 2020 2020 2057 6865 7468 6572  .        Whether
-000153c0: 2074 6f20 7265 6d6f 7665 206f 7574 6c69   to remove outli
-000153d0: 6572 2068 2f76 2063 7572 7665 732e 2052  er h/v curves. R
-000153e0: 6563 6f6d 6d65 6e64 2074 6f20 6265 2072  ecommend to be r
-000153f0: 6570 6561 7465 6420 6576 656e 2061 6674  epeated even aft
-00015400: 6572 2075 7369 6e67 2069 6e20 6765 6e65  er using in gene
-00015410: 7261 7465 5f70 7073 6473 2829 2069 6620  rate_ppsds() if 
-00015420: 7265 6d6f 7665 5f6e 6f69 7365 2829 2069  remove_noise() i
-00015430: 7320 7573 6564 2e0a 2020 2020 6f75 746c  s used..    outl
-00015440: 6965 725f 6375 7276 655f 7374 6420 3a20  ier_curve_std : 
-00015450: 666c 6f61 742c 2064 6566 6175 6c74 203d  float, default =
-00015460: 2031 2e37 350a 2020 2020 2020 2020 5374   1.75.        St
-00015470: 616e 6461 7264 2064 6576 6961 7469 6f6e  andard deviation
-00015480: 206f 6620 6d65 616e 206f 6620 6561 6368   of mean of each
-00015490: 2048 2f56 2063 7572 7665 2074 6f20 7573   H/V curve to us
-000154a0: 6520 6173 2063 7574 746f 6666 2066 6f72  e as cuttoff for
-000154b0: 2077 6865 7468 6572 2061 6e20 482f 5620   whether an H/V 
-000154c0: 6375 7276 6520 6973 2063 6f6e 7369 6465  curve is conside
-000154d0: 7265 6420 616e 2027 6f75 746c 6965 7227  red an 'outlier'
-000154e0: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
-000154f0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00015500: 2020 6876 7372 5f6f 7574 2020 2020 3a20    hvsr_out    : 
-00015510: 6469 6374 0a20 2020 2020 2020 2020 2020  dict.           
-00015520: 2044 6963 7469 6f6e 6172 7920 636f 6e74   Dictionary cont
-00015530: 6169 6e69 6e67 2061 6c6c 2074 6865 2069  aining all the i
-00015540: 6e66 6f72 6d61 7469 6f6e 2061 626f 7574  nformation about
-00015550: 2074 6865 2064 6174 612c 2069 6e63 6c75   the data, inclu
-00015560: 6469 6e67 2069 6e70 7574 2070 6172 616d  ding input param
-00015570: 6574 6572 730a 0a20 2020 2022 2222 0a20  eters..    """. 
-00015580: 2020 2070 7073 6473 203d 2070 6172 616d     ppsds = param
-00015590: 735b 2770 7073 6473 275d 2e63 6f70 7928  s['ppsds'].copy(
-000155a0: 2923 5b6b 5d5b 2770 7364 5f76 616c 7565  )#[k]['psd_value
-000155b0: 7327 5d0a 2020 2020 7070 7364 7320 3d20  s'].    ppsds = 
-000155c0: 5f5f 6368 6563 6b5f 7876 616c 7565 7328  __check_xvalues(
-000155d0: 7070 7364 7329 0a0a 2020 2020 6d65 7468  ppsds)..    meth
-000155e0: 6f64 4c69 7374 203d 205b 2744 6966 6675  odList = ['Diffu
-000155f0: 7365 2046 6965 6c64 2041 7373 756d 7074  se Field Assumpt
-00015600: 696f 6e27 2c20 2741 7269 7468 6d65 7469  ion', 'Arithmeti
-00015610: 6320 4d65 616e 272c 2027 4765 6f6d 6574  c Mean', 'Geomet
-00015620: 7269 6320 4d65 616e 272c 2027 5665 6374  ric Mean', 'Vect
-00015630: 6f72 2053 756d 6d61 7469 6f6e 272c 2027  or Summation', '
-00015640: 5175 6164 7261 7469 6320 4d65 616e 272c  Quadratic Mean',
-00015650: 2027 4d61 7869 6d75 6d20 486f 7269 7a6f   'Maximum Horizo
-00015660: 6e74 616c 2056 616c 7565 275d 0a20 2020  ntal Value'].   
-00015670: 2078 5f66 7265 7173 203d 207b 7d0a 2020   x_freqs = {}.  
-00015680: 2020 785f 7065 7269 6f64 7320 3d20 7b7d    x_periods = {}
-00015690: 0a0a 2020 2020 7073 6456 616c 7354 4176  ..    psdValsTAv
-000156a0: 6720 3d20 7b7d 0a20 2020 2073 7444 6576  g = {}.    stDev
-000156b0: 203d 207b 7d0a 2020 2020 7374 4465 7656   = {}.    stDevV
-000156c0: 616c 7350 203d 207b 7d0a 2020 2020 7374  alsP = {}.    st
-000156d0: 4465 7656 616c 734d 203d 207b 7d0a 2020  DevValsM = {}.  
-000156e0: 2020 7073 6452 6177 3d7b 7d0a 2020 2020    psdRaw={}.    
-000156f0: 6375 7272 5469 6d65 7355 7365 643d 7b7d  currTimesUsed={}
-00015700: 0a20 2020 200a 2020 2020 666f 7220 6b20  .    .    for k 
-00015710: 696e 2070 7073 6473 3a0a 2020 2020 2020  in ppsds:.      
-00015720: 2020 2369 6620 7265 6173 6d70 6c69 6e67    #if reasmpling
-00015730: 2068 6173 2062 6565 6e20 7365 6c65 6374   has been select
-00015740: 6564 0a20 2020 2020 2020 2069 6620 7265  ed.        if re
-00015750: 7361 6d70 6c65 206f 7220 7479 7065 2872  sample or type(r
-00015760: 6573 616d 706c 6529 2069 7320 696e 743a  esample) is int:
-00015770: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00015780: 7265 7361 6d70 6c65 3a0a 2020 2020 2020  resample:.      
-00015790: 2020 2020 2020 2020 2020 7265 7361 6d70            resamp
-000157a0: 6c65 203d 2031 3030 3020 2344 6566 6175  le = 1000 #Defau
-000157b0: 6c74 2073 6d6f 6f74 6820 7661 6c75 650a  lt smooth value.
-000157c0: 0a20 2020 2020 2020 2020 2020 2078 5661  .            xVa
-000157d0: 6c4d 696e 203d 206d 696e 2870 7073 6473  lMin = min(ppsds
-000157e0: 5b6b 5d5b 2770 6572 696f 645f 6269 6e5f  [k]['period_bin_
-000157f0: 6365 6e74 6572 7327 5d29 0a20 2020 2020  centers']).     
-00015800: 2020 2020 2020 2078 5661 6c4d 6178 203d         xValMax =
-00015810: 206d 6178 2870 7073 6473 5b6b 5d5b 2770   max(ppsds[k]['p
-00015820: 6572 696f 645f 6269 6e5f 6365 6e74 6572  eriod_bin_center
-00015830: 7327 5d29 0a0a 2020 2020 2020 2020 2020  s'])..          
-00015840: 2020 2352 6573 616d 706c 6520 7065 7269    #Resample peri
-00015850: 6f64 2062 696e 2076 616c 7565 730a 2020  od bin values.  
-00015860: 2020 2020 2020 2020 2020 785f 7065 7269            x_peri
-00015870: 6f64 735b 6b5d 203d 206e 702e 6c6f 6773  ods[k] = np.logs
-00015880: 7061 6365 286e 702e 6c6f 6731 3028 7856  pace(np.log10(xV
-00015890: 616c 4d69 6e29 2c20 6e70 2e6c 6f67 3130  alMin), np.log10
-000158a0: 2878 5661 6c4d 6178 292c 206e 756d 3d72  (xValMax), num=r
-000158b0: 6573 616d 706c 6529 0a0a 2020 2020 2020  esample)..      
-000158c0: 2020 2020 2020 6966 2073 6d6f 6f74 6820        if smooth 
-000158d0: 6f72 2074 7970 6528 736d 6f6f 7468 2920  or type(smooth) 
-000158e0: 6973 2069 6e74 3a0a 2020 2020 2020 2020  is int:.        
-000158f0: 2020 2020 2020 2020 6966 2073 6d6f 6f74          if smoot
-00015900: 683a 0a20 2020 2020 2020 2020 2020 2020  h:.             
-00015910: 2020 2020 2020 2073 6d6f 6f74 6820 3d20         smooth = 
-00015920: 3531 2023 4465 6661 756c 7420 736d 6f6f  51 #Default smoo
-00015930: 7468 696e 6720 7769 6e64 6f77 0a20 2020  thing window.   
-00015940: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00015950: 6620 736d 6f6f 7468 2532 3d3d 303a 0a20  f smooth%2==0:. 
-00015960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015970: 2020 2073 6d6f 6f74 6820 3d20 736d 6f6f     smooth = smoo
-00015980: 7468 2b31 0a0a 2020 2020 2020 2020 2020  th+1..          
-00015990: 2020 2352 6573 616d 706c 6520 7261 7720    #Resample raw 
-000159a0: 7070 7364 2076 616c 7565 730a 2020 2020  ppsd values.    
-000159b0: 2020 2020 2020 2020 666f 7220 692c 2074          for i, t
-000159c0: 2069 6e20 656e 756d 6572 6174 6528 7070   in enumerate(pp
-000159d0: 7364 735b 6b5d 5b27 7073 645f 7661 6c75  sds[k]['psd_valu
-000159e0: 6573 275d 293a 0a20 2020 2020 2020 2020  es']):.         
-000159f0: 2020 2020 2020 2069 6620 693d 3d30 3a0a         if i==0:.
-00015a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a10: 2020 2020 7073 6452 6177 5b6b 5d20 3d20      psdRaw[k] = 
-00015a20: 6e70 2e69 6e74 6572 7028 785f 7065 7269  np.interp(x_peri
-00015a30: 6f64 735b 6b5d 2c20 7070 7364 735b 6b5d  ods[k], ppsds[k]
-00015a40: 5b27 7065 7269 6f64 5f62 696e 5f63 656e  ['period_bin_cen
-00015a50: 7465 7273 275d 2c20 7429 0a20 2020 2020  ters'], t).     
-00015a60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00015a70: 6620 736d 6f6f 7468 2069 7320 6e6f 7420  f smooth is not 
-00015a80: 4661 6c73 653a 0a20 2020 2020 2020 2020  False:.         
-00015a90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00015aa0: 7364 5261 775b 6b5d 203d 2073 6369 7079  sdRaw[k] = scipy
-00015ab0: 2e73 6967 6e61 6c2e 7361 7667 6f6c 5f66  .signal.savgol_f
-00015ac0: 696c 7465 7228 7073 6452 6177 5b6b 5d2c  ilter(psdRaw[k],
-00015ad0: 2073 6d6f 6f74 682c 2033 290a 0a20 2020   smooth, 3)..   
-00015ae0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00015af0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00015b00: 2020 2020 2020 2070 7364 5261 775b 6b5d         psdRaw[k]
-00015b10: 203d 206e 702e 7673 7461 636b 2828 7073   = np.vstack((ps
-00015b20: 6452 6177 5b6b 5d2c 206e 702e 696e 7465  dRaw[k], np.inte
-00015b30: 7270 2878 5f70 6572 696f 6473 5b6b 5d2c  rp(x_periods[k],
-00015b40: 2070 7073 6473 5b6b 5d5b 2770 6572 696f   ppsds[k]['perio
-00015b50: 645f 6269 6e5f 6365 6e74 6572 7327 5d2c  d_bin_centers'],
-00015b60: 2074 2929 290a 2020 2020 2020 2020 2020   t))).          
-00015b70: 2020 2020 2020 2020 2020 6966 2073 6d6f            if smo
-00015b80: 6f74 6820 6973 206e 6f74 2046 616c 7365  oth is not False
-00015b90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015ba0: 2020 2020 2020 2020 2020 7073 6452 6177            psdRaw
-00015bb0: 5b6b 5d5b 695d 203d 2073 6369 7079 2e73  [k][i] = scipy.s
-00015bc0: 6967 6e61 6c2e 7361 7667 6f6c 5f66 696c  ignal.savgol_fil
-00015bd0: 7465 7228 7073 6452 6177 5b6b 5d5b 695d  ter(psdRaw[k][i]
-00015be0: 2c20 736d 6f6f 7468 2c20 3329 0a0a 2020  , smooth, 3)..  
-00015bf0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00015c00: 2020 2020 2020 2020 2349 6620 6e6f 2072          #If no r
-00015c10: 6573 616d 706c 696e 6720 6465 7369 7265  esampling desire
-00015c20: 640a 2020 2020 2020 2020 2020 2020 785f  d.            x_
-00015c30: 7065 7269 6f64 735b 6b5d 203d 206e 702e  periods[k] = np.
-00015c40: 6172 7261 7928 7070 7364 735b 6b5d 5b27  array(ppsds[k]['
-00015c50: 7065 7269 6f64 5f62 696e 5f63 656e 7465  period_bin_cente
-00015c60: 7273 275d 290a 2020 2020 2020 2020 2020  rs']).          
-00015c70: 2020 7073 6452 6177 5b6b 5d20 3d20 6e70    psdRaw[k] = np
-00015c80: 2e61 7272 6179 2870 7073 6473 5b6b 5d5b  .array(ppsds[k][
-00015c90: 2770 7364 5f76 616c 7565 7327 5d29 0a0a  'psd_values'])..
-00015ca0: 2020 2020 2020 2020 2347 6574 2061 7665          #Get ave
-00015cb0: 7261 6765 2070 7364 2076 616c 7565 2061  rage psd value a
-00015cc0: 6372 6f73 7320 7469 6d65 2066 6f72 2065  cross time for e
-00015cd0: 6163 6820 6368 616e 6e65 6c20 2875 7365  ach channel (use
-00015ce0: 6420 746f 2063 616c 6320 6d61 696e 2048  d to calc main H
-00015cf0: 2f56 2063 7572 7665 290a 2020 2020 2020  /V curve).      
-00015d00: 2020 7073 6456 616c 7354 4176 675b 6b5d    psdValsTAvg[k]
-00015d10: 203d 206e 702e 6e61 6e6d 6561 6e28 6e70   = np.nanmean(np
-00015d20: 2e61 7272 6179 2870 7364 5261 775b 6b5d  .array(psdRaw[k]
-00015d30: 292c 2061 7869 733d 3029 0a20 2020 2020  ), axis=0).     
-00015d40: 2020 2078 5f66 7265 7173 5b6b 5d20 3d20     x_freqs[k] = 
-00015d50: 6e70 2e64 6976 6964 6528 6e70 2e6f 6e65  np.divide(np.one
-00015d60: 735f 6c69 6b65 2878 5f70 6572 696f 6473  s_like(x_periods
-00015d70: 5b6b 5d29 2c20 785f 7065 7269 6f64 735b  [k]), x_periods[
-00015d80: 6b5d 2920 0a0a 2020 2020 2020 2020 7374  k]) ..        st
-00015d90: 4465 765b 6b5d 203d 206e 702e 7374 6428  Dev[k] = np.std(
-00015da0: 7073 6452 6177 5b6b 5d2c 2061 7869 733d  psdRaw[k], axis=
-00015db0: 3029 0a20 2020 2020 2020 2073 7444 6576  0).        stDev
-00015dc0: 5661 6c73 4d5b 6b5d 203d 206e 702e 6172  ValsM[k] = np.ar
-00015dd0: 7261 7928 7073 6456 616c 7354 4176 675b  ray(psdValsTAvg[
-00015de0: 6b5d 202d 2073 7444 6576 5b6b 5d29 0a20  k] - stDev[k]). 
-00015df0: 2020 2020 2020 2073 7444 6576 5661 6c73         stDevVals
-00015e00: 505b 6b5d 203d 206e 702e 6172 7261 7928  P[k] = np.array(
-00015e10: 7073 6456 616c 7354 4176 675b 6b5d 202b  psdValsTAvg[k] +
-00015e20: 2073 7444 6576 5b6b 5d29 0a0a 2020 2020   stDev[k])..    
-00015e30: 2020 2020 6375 7272 5469 6d65 7355 7365      currTimesUse
-00015e40: 645b 6b5d 203d 2070 7073 6473 5b6b 5d5b  d[k] = ppsds[k][
-00015e50: 2763 7572 7265 6e74 5f74 696d 6573 5f75  'current_times_u
-00015e60: 7365 6427 5d0a 0a20 2020 2023 4765 7420  sed']..    #Get 
-00015e70: 7374 7269 6e67 206f 6620 6d65 7468 6f64  string of method
-00015e80: 2074 7970 650a 2020 2020 6966 2074 7970   type.    if typ
-00015e90: 6528 6d65 7468 6f64 2920 6973 2069 6e74  e(method) is int
-00015ea0: 3a0a 2020 2020 2020 2020 6d65 7468 6f64  :.        method
-00015eb0: 496e 7420 3d20 6d65 7468 6f64 0a20 2020  Int = method.   
-00015ec0: 2020 2020 206d 6574 686f 6420 3d20 6d65       method = me
-00015ed0: 7468 6f64 4c69 7374 5b6d 6574 686f 645d  thodList[method]
-00015ee0: 0a0a 2020 2020 2354 6869 7320 6765 7473  ..    #This gets
-00015ef0: 2074 6865 2068 7673 7220 6375 7276 6520   the hvsr curve 
-00015f00: 6176 6572 6167 6564 2066 726f 6d20 616c  averaged from al
-00015f10: 6c20 7469 6d65 2073 7465 7073 0a20 2020  l time steps.   
-00015f20: 2061 6e79 4b20 3d20 6c69 7374 2878 5f66   anyK = list(x_f
-00015f30: 7265 7173 2e6b 6579 7328 2929 5b30 5d0a  reqs.keys())[0].
-00015f40: 2020 2020 6876 7372 5f63 7572 7665 203d      hvsr_curve =
-00015f50: 205f 5f67 6574 5f68 7673 725f 6375 7276   __get_hvsr_curv
-00015f60: 6528 783d 785f 6672 6571 735b 616e 794b  e(x=x_freqs[anyK
-00015f70: 5d2c 2070 7364 3d70 7364 5661 6c73 5441  ], psd=psdValsTA
-00015f80: 7667 2c20 6d65 7468 6f64 3d6d 6574 686f  vg, method=metho
-00015f90: 6449 6e74 290a 0a20 2020 206f 7269 6750  dInt)..    origP
-00015fa0: 5053 4420 3d20 7061 7261 6d73 5b27 7070  PSD = params['pp
-00015fb0: 7364 735f 6f62 7370 7927 5d2e 636f 7079  sds_obspy'].copy
-00015fc0: 2829 0a0a 2020 2020 2341 6464 2073 6f6d  ()..    #Add som
-00015fd0: 6520 6f74 6865 7220 7661 7269 6162 6c65  e other variable
-00015fe0: 7320 746f 206f 7572 206f 7574 7075 7420  s to our output 
-00015ff0: 6469 6374 696f 6e61 7279 0a20 2020 2068  dictionary.    h
-00016000: 7673 725f 6f75 7420 3d20 7b27 696e 7075  vsr_out = {'inpu
-00016010: 745f 7061 7261 6d73 273a 7061 7261 6d73  t_params':params
-00016020: 2e63 6f70 7928 292c 0a20 2020 2020 2020  .copy(),.       
-00016030: 2020 2020 2020 2020 2027 785f 6672 6571           'x_freq
-00016040: 7327 3a78 5f66 7265 7173 2c0a 2020 2020  s':x_freqs,.    
-00016050: 2020 2020 2020 2020 2020 2020 2768 7673              'hvs
-00016060: 725f 6375 7276 6527 3a68 7673 725f 6375  r_curve':hvsr_cu
-00016070: 7276 652c 0a20 2020 2020 2020 2020 2020  rve,.           
-00016080: 2020 2020 2027 785f 7065 7269 6f64 273a       'x_period':
-00016090: 785f 7065 7269 6f64 732c 0a20 2020 2020  x_periods,.     
-000160a0: 2020 2020 2020 2020 2020 2027 7073 645f             'psd_
-000160b0: 7261 7727 3a70 7364 5261 772c 0a20 2020  raw':psdRaw,.   
-000160c0: 2020 2020 2020 2020 2020 2020 2027 6375               'cu
-000160d0: 7272 656e 745f 7469 6d65 735f 7573 6564  rrent_times_used
-000160e0: 273a 2063 7572 7254 696d 6573 5573 6564  ': currTimesUsed
-000160f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00016100: 2020 2770 7364 5f76 616c 7565 735f 7461    'psd_values_ta
-00016110: 7667 273a 7073 6456 616c 7354 4176 672c  vg':psdValsTAvg,
-00016120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016130: 2027 7070 7364 5f73 7464 273a 7374 4465   'ppsd_std':stDe
-00016140: 762c 0a20 2020 2020 2020 2020 2020 2020  v,.             
-00016150: 2020 2027 7070 7364 5f73 7464 5f76 616c     'ppsd_std_val
-00016160: 735f 6d27 3a73 7444 6576 5661 6c73 4d2c  s_m':stDevValsM,
-00016170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016180: 2027 7070 7364 5f73 7464 5f76 616c 735f   'ppsd_std_vals_
-00016190: 7027 3a73 7444 6576 5661 6c73 502c 0a20  p':stDevValsP,. 
-000161a0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000161b0: 6d65 7468 6f64 273a 6d65 7468 6f64 2c0a  method':method,.
-000161c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161d0: 2770 7073 6473 273a 7070 7364 732c 0a20  'ppsds':ppsds,. 
-000161e0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000161f0: 7070 7364 735f 6f62 7370 7927 3a6f 7269  ppsds_obspy':ori
-00016200: 6750 5053 442c 0a20 2020 2020 2020 2020  gPPSD,.         
-00016210: 2020 2020 2020 2027 7473 7465 7073 5f75         'tsteps_u
-00016220: 7365 6427 3a20 7061 7261 6d73 5b27 7473  sed': params['ts
-00016230: 7465 7073 5f75 7365 6427 5d2e 636f 7079  teps_used'].copy
-00016240: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00016250: 2020 207d 0a0a 2020 2020 6966 2027 7877     }..    if 'xw
-00016260: 696e 646f 7773 5f6f 7574 2720 696e 2070  indows_out' in p
-00016270: 6172 616d 732e 6b65 7973 2829 3a0a 2020  arams.keys():.  
-00016280: 2020 2020 2020 6876 7372 5f6f 7574 5b27        hvsr_out['
-00016290: 7877 696e 646f 7773 5f6f 7574 275d 203d  xwindows_out'] =
-000162a0: 2070 6172 616d 735b 2778 7769 6e64 6f77   params['xwindow
-000162b0: 735f 6f75 7427 5d0a 2020 2020 656c 7365  s_out'].    else
-000162c0: 3a0a 2020 2020 2020 2020 6876 7372 5f6f  :.        hvsr_o
-000162d0: 7574 5b27 7877 696e 646f 7773 5f6f 7574  ut['xwindows_out
-000162e0: 275d 203d 205b 5d0a 0a20 2020 2064 656c  '] = []..    del
-000162f0: 2068 7673 725f 6f75 745b 2769 6e70 7574   hvsr_out['input
-00016300: 5f70 6172 616d 7327 5d5b 2770 7073 6473  _params']['ppsds
-00016310: 5f6f 6273 7079 275d 0a20 2020 2064 656c  _obspy'].    del
-00016320: 2068 7673 725f 6f75 745b 2769 6e70 7574   hvsr_out['input
-00016330: 5f70 6172 616d 7327 5d5b 2770 7073 6473  _params']['ppsds
-00016340: 275d 0a20 2020 2064 656c 2068 7673 725f  '].    del hvsr_
-00016350: 6f75 745b 2769 6e70 7574 5f70 6172 616d  out['input_param
-00016360: 7327 5d5b 2774 7374 6570 735f 7573 6564  s']['tsteps_used
-00016370: 275d 0a0a 2020 2020 6672 6571 5f73 6d6f  ']..    freq_smo
-00016380: 6f74 685f 6b6f 203d 205b 276b 6f6e 6e6f  oth_ko = ['konno
-00016390: 206f 686d 6163 6869 272c 2027 6b6f 6e6e   ohmachi', 'konn
-000163a0: 6f2d 6f68 6d61 6368 6927 2c20 276b 6f6e  o-ohmachi', 'kon
-000163b0: 6e6f 6f68 6d61 6368 6927 2c20 276b 6f6e  noohmachi', 'kon
-000163c0: 6e6f 686d 6163 6869 272c 2027 6b6f 272c  nohmachi', 'ko',
-000163d0: 2027 6b27 5d0a 2020 2020 6672 6571 5f73   'k'].    freq_s
-000163e0: 6d6f 6f74 685f 636f 6e73 7461 6e74 203d  mooth_constant =
-000163f0: 205b 2763 6f6e 7374 616e 7427 2c20 2763   ['constant', 'c
-00016400: 6f6e 7374 272c 2027 6327 5d0a 2020 2020  onst', 'c'].    
-00016410: 6672 6571 5f73 6d6f 6f74 685f 7072 6f70  freq_smooth_prop
-00016420: 6f72 7420 3d20 5b27 7072 6f70 6f72 7469  ort = ['proporti
-00016430: 6f6e 616c 272c 2027 7072 6f70 6f72 7469  onal', 'proporti
-00016440: 6f6e 272c 2027 7072 6f70 272c 2027 7027  on', 'prop', 'p'
-00016450: 5d0a 0a20 2020 2023 4672 6571 7565 6e63  ]..    #Frequenc
-00016460: 7920 536d 6f6f 7468 696e 670a 2020 2020  y Smoothing.    
-00016470: 6966 2066 7265 715f 736d 6f6f 7468 2069  if freq_smooth i
-00016480: 7320 4661 6c73 653a 0a20 2020 2020 2020  s False:.       
-00016490: 2070 7269 6e74 2827 4e6f 2066 7265 7175   print('No frequ
-000164a0: 656e 6379 2073 6d6f 6f74 6869 6e67 2069  ency smoothing i
-000164b0: 7320 6265 696e 6720 6170 706c 6965 642e  s being applied.
-000164c0: 2054 6869 7320 6973 206e 6f74 2072 6563   This is not rec
-000164d0: 6f6d 6d65 6e64 6564 2066 6f72 206e 6f69  ommended for noi
-000164e0: 7379 2064 6174 6173 6574 732e 2729 0a20  sy datasets.'). 
-000164f0: 2020 2065 6c69 6620 6672 6571 5f73 6d6f     elif freq_smo
-00016500: 6f74 6820 6973 2054 7275 6520 6f72 2066  oth is True or f
-00016510: 7265 715f 736d 6f6f 7468 2e6c 6f77 6572  req_smooth.lower
-00016520: 2829 2069 6e20 6672 6571 5f73 6d6f 6f74  () in freq_smoot
-00016530: 685f 6b6f 3a0a 2020 2020 2020 2020 6672  h_ko:.        fr
-00016540: 6f6d 206f 6273 7079 2e73 6967 6e61 6c20  om obspy.signal 
-00016550: 696d 706f 7274 206b 6f6e 6e6f 6f68 6d61  import konnoohma
-00016560: 6368 6973 6d6f 6f74 6869 6e67 0a20 2020  chismoothing.   
-00016570: 2020 2020 2066 6f72 206b 2069 6e20 6876       for k in hv
-00016580: 7372 5f6f 7574 5b27 7073 645f 7261 7727  sr_out['psd_raw'
-00016590: 5d3a 0a20 2020 2020 2020 2020 2020 2070  ]:.            p
-000165a0: 7073 645f 6461 7461 203d 2068 7673 725f  psd_data = hvsr_
-000165b0: 6f75 745b 2770 7364 5f72 6177 275d 5b6b  out['psd_raw'][k
-000165c0: 5d0a 2020 2020 2020 2020 2020 2020 6672  ].            fr
-000165d0: 6571 7320 3d20 6876 7372 5f6f 7574 5b27  eqs = hvsr_out['
-000165e0: 785f 6672 6571 7327 5d5b 6b5d 0a20 2020  x_freqs'][k].   
-000165f0: 2020 2020 2020 2020 2073 6d6f 6f74 6865           smoothe
-00016600: 645f 7070 7364 5f64 6174 6120 3d20 6b6f  d_ppsd_data = ko
-00016610: 6e6e 6f6f 686d 6163 6869 736d 6f6f 7468  nnoohmachismooth
-00016620: 696e 672e 6b6f 6e6e 6f5f 6f68 6d61 6368  ing.konno_ohmach
-00016630: 695f 736d 6f6f 7468 696e 6728 7070 7364  i_smoothing(ppsd
-00016640: 5f64 6174 612c 2066 7265 7173 2c20 6261  _data, freqs, ba
-00016650: 6e64 7769 6474 683d 665f 736d 6f6f 7468  ndwidth=f_smooth
-00016660: 5f77 6964 7468 2c20 6e6f 726d 616c 697a  _width, normaliz
-00016670: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-00016680: 2020 2020 6876 7372 5f6f 7574 5b27 7073      hvsr_out['ps
-00016690: 645f 7261 7727 5d5b 6b5d 203d 2073 6d6f  d_raw'][k] = smo
-000166a0: 6f74 6865 645f 7070 7364 5f64 6174 610a  othed_ppsd_data.
-000166b0: 2020 2020 656c 6966 2066 7265 715f 736d      elif freq_sm
-000166c0: 6f6f 7468 2e6c 6f77 6572 2829 2069 6e20  ooth.lower() in 
-000166d0: 6672 6571 5f73 6d6f 6f74 685f 636f 6e73  freq_smooth_cons
-000166e0: 7461 6e74 3a0a 2020 2020 2020 2020 6876  tant:.        hv
-000166f0: 7372 5f6f 7574 203d 205f 5f66 7265 715f  sr_out = __freq_
-00016700: 736d 6f6f 7468 5f77 696e 646f 7728 6876  smooth_window(hv
-00016710: 7372 5f6f 7574 2c20 665f 736d 6f6f 7468  sr_out, f_smooth
-00016720: 5f77 6964 7468 2c20 6b69 6e64 3d27 636f  _width, kind='co
-00016730: 6e73 7461 6e74 2729 0a20 2020 2065 6c69  nstant').    eli
-00016740: 6620 6672 6571 5f73 6d6f 6f74 682e 6c6f  f freq_smooth.lo
-00016750: 7765 7228 2920 696e 2066 7265 715f 736d  wer() in freq_sm
-00016760: 6f6f 7468 5f70 726f 706f 7274 3a0a 2020  ooth_proport:.  
-00016770: 2020 2020 2020 6876 7372 5f6f 7574 203d        hvsr_out =
-00016780: 205f 5f66 7265 715f 736d 6f6f 7468 5f77   __freq_smooth_w
-00016790: 696e 646f 7728 6876 7372 5f6f 7574 2c20  indow(hvsr_out, 
-000167a0: 665f 736d 6f6f 7468 5f77 6964 7468 2c20  f_smooth_width, 
-000167b0: 6b69 6e64 3d27 7072 6f70 6f72 7469 6f6e  kind='proportion
-000167c0: 616c 2729 0a20 2020 2065 6c73 653a 0a20  al').    else:. 
-000167d0: 2020 2020 2020 2070 7269 6e74 2827 4e6f         print('No
-000167e0: 2066 7265 7175 656e 6379 2073 6d6f 6f74   frequency smoot
-000167f0: 6869 6e67 2069 7320 6265 696e 6720 6170  hing is being ap
-00016800: 706c 6965 642e 2054 6869 7320 6973 206e  plied. This is n
-00016810: 6f74 2072 6563 6f6d 6d65 6e64 6564 2066  ot recommended f
-00016820: 6f72 206e 6f69 7379 2064 6174 6173 6574  or noisy dataset
-00016830: 732e 2729 0a0a 0a20 2020 2023 4765 7420  s.')...    #Get 
-00016840: 6876 7372 2063 7572 7665 2066 726f 6d20  hvsr curve from 
-00016850: 7468 7265 6520 636f 6d70 6f6e 656e 7473  three components
-00016860: 2061 7420 6561 6368 2074 696d 6520 7374   at each time st
-00016870: 6570 0a20 2020 2068 7673 725f 7453 7465  ep.    hvsr_tSte
-00016880: 7073 203d 205b 5d0a 2020 2020 616e 794b  ps = [].    anyK
-00016890: 203d 206c 6973 7428 6876 7372 5f6f 7574   = list(hvsr_out
-000168a0: 5b27 7073 645f 7261 7727 5d2e 6b65 7973  ['psd_raw'].keys
-000168b0: 2829 295b 305d 0a20 2020 2066 6f72 2074  ())[0].    for t
-000168c0: 5374 6570 2069 6e20 7261 6e67 6528 6c65  Step in range(le
-000168d0: 6e28 6876 7372 5f6f 7574 5b27 7073 645f  n(hvsr_out['psd_
-000168e0: 7261 7727 5d5b 616e 794b 5d29 293a 0a20  raw'][anyK])):. 
-000168f0: 2020 2020 2020 2074 5374 6570 4469 6374         tStepDict
-00016900: 203d 207b 7d0a 2020 2020 2020 2020 666f   = {}.        fo
-00016910: 7220 6b20 696e 2068 7673 725f 6f75 745b  r k in hvsr_out[
-00016920: 2770 7364 5f72 6177 275d 3a0a 2020 2020  'psd_raw']:.    
-00016930: 2020 2020 2020 2020 7453 7465 7044 6963          tStepDic
-00016940: 745b 6b5d 203d 2068 7673 725f 6f75 745b  t[k] = hvsr_out[
-00016950: 2770 7364 5f72 6177 275d 5b6b 5d5b 7453  'psd_raw'][k][tS
-00016960: 7465 705d 0a20 2020 2020 2020 2068 7673  tep].        hvs
-00016970: 725f 7453 7465 7073 2e61 7070 656e 6428  r_tSteps.append(
-00016980: 5f5f 6765 745f 6876 7372 5f63 7572 7665  __get_hvsr_curve
-00016990: 2878 3d68 7673 725f 6f75 745b 2778 5f66  (x=hvsr_out['x_f
-000169a0: 7265 7173 275d 5b61 6e79 4b5d 2c20 7073  reqs'][anyK], ps
-000169b0: 643d 7453 7465 7044 6963 742c 206d 6574  d=tStepDict, met
-000169c0: 686f 643d 6d65 7468 6f64 496e 7429 290a  hod=methodInt)).
-000169d0: 2020 2020 6876 7372 5f74 5374 6570 7320      hvsr_tSteps 
-000169e0: 3d20 6e70 2e61 7272 6179 2868 7673 725f  = np.array(hvsr_
-000169f0: 7453 7465 7073 290a 2020 2020 0a20 2020  tSteps).    .   
-00016a00: 2068 7673 725f 6f75 745b 2769 6e64 5f68   hvsr_out['ind_h
-00016a10: 7673 725f 6375 7276 6573 275d 203d 2068  vsr_curves'] = h
-00016a20: 7673 725f 7453 7465 7073 0a0a 2020 2020  vsr_tSteps..    
-00016a30: 2375 7365 2074 6865 2073 7461 6e64 6172  #use the standar
-00016a40: 6420 6465 7669 6174 696f 6e20 6f66 2065  d deviation of e
-00016a50: 6163 6820 696e 6469 7669 6475 616c 2063  ach individual c
-00016a60: 7572 7665 2074 6f20 6465 7465 726d 696e  urve to determin
-00016a70: 6520 6966 2069 7420 6f76 6572 6c61 7070  e if it overlapp
-00016a80: 6564 0a20 2020 2069 6620 7265 6d6f 7665  ed.    if remove
-00016a90: 5f6f 7574 6c69 6572 5f63 7572 7665 733a  _outlier_curves:
-00016aa0: 0a20 2020 2020 2020 2073 7464 5420 3d20  .        stdT = 
-00016ab0: 6e70 2e73 7464 2868 7673 725f 6f75 745b  np.std(hvsr_out[
-00016ac0: 2769 6e64 5f68 7673 725f 6375 7276 6573  'ind_hvsr_curves
-00016ad0: 275d 2c20 6178 6973 3d31 290a 2020 2020  '], axis=1).    
-00016ae0: 2020 2020 7374 645f 7374 6454 3d20 6e70      std_stdT= np
-00016af0: 2e73 7464 2873 7464 5429 0a20 2020 2020  .std(stdT).     
-00016b00: 2020 2061 7667 5f73 7464 543d 206e 702e     avg_stdT= np.
-00016b10: 6e61 6e6d 6561 6e28 7374 6454 290a 0a20  nanmean(stdT).. 
-00016b20: 2020 2020 2020 2070 7364 735f 746f 5f72         psds_to_r
-00016b30: 6964 203d 205b 5d0a 2020 2020 2020 2020  id = [].        
-00016b40: 666f 7220 692c 7420 696e 2065 6e75 6d65  for i,t in enume
-00016b50: 7261 7465 2868 7673 725f 6f75 745b 2769  rate(hvsr_out['i
-00016b60: 6e64 5f68 7673 725f 6375 7276 6573 275d  nd_hvsr_curves']
-00016b70: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00016b80: 6620 7374 6454 5b69 5d20 3c20 6176 675f  f stdT[i] < avg_
-00016b90: 7374 6454 202d 2073 7464 5f73 7464 542a  stdT - std_stdT*
-00016ba0: 6f75 746c 6965 725f 6375 7276 655f 7374  outlier_curve_st
-00016bb0: 6420 6f72 2073 7464 545b 695d 203e 2061  d or stdT[i] > a
-00016bc0: 7667 5f73 7464 5420 2b20 7374 645f 7374  vg_stdT + std_st
-00016bd0: 6454 2a6f 7574 6c69 6572 5f63 7572 7665  dT*outlier_curve
-00016be0: 5f73 7464 3a0a 2020 2020 2020 2020 2020  _std:.          
-00016bf0: 2020 2020 2020 7073 6473 5f74 6f5f 7269        psds_to_ri
-00016c00: 642e 6170 7065 6e64 2869 290a 0a20 2020  d.append(i)..   
-00016c10: 2020 2020 2066 6f72 2069 2c20 7220 696e       for i, r in
-00016c20: 2065 6e75 6d65 7261 7465 2870 7364 735f   enumerate(psds_
-00016c30: 746f 5f72 6964 293a 0a20 2020 2020 2020  to_rid):.       
-00016c40: 2020 2020 2069 6e64 6578 203d 2069 6e74       index = int
-00016c50: 2872 2d69 290a 2020 2020 2020 2020 2020  (r-i).          
-00016c60: 2020 6876 7372 5f6f 7574 5b27 696e 645f    hvsr_out['ind_
-00016c70: 6876 7372 5f63 7572 7665 7327 5d20 3d20  hvsr_curves'] = 
-00016c80: 6e70 2e64 656c 6574 6528 6876 7372 5f6f  np.delete(hvsr_o
-00016c90: 7574 5b27 696e 645f 6876 7372 5f63 7572  ut['ind_hvsr_cur
-00016ca0: 7665 7327 5d2c 2069 6e64 6578 2c20 6178  ves'], index, ax
-00016cb0: 6973 3d30 290a 0a20 2020 2020 2020 2020  is=0)..         
-00016cc0: 2020 2066 6f72 206b 2069 6e20 6876 7372     for k in hvsr
-00016cd0: 5f6f 7574 5b27 7070 7364 7327 5d3a 0a20  _out['ppsds']:. 
-00016ce0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00016cf0: 7673 725f 6f75 745b 2770 7364 5f72 6177  vsr_out['psd_raw
-00016d00: 275d 5b6b 5d20 3d20 6e70 2e64 656c 6574  '][k] = np.delet
-00016d10: 6528 6876 7372 5f6f 7574 5b27 7073 645f  e(hvsr_out['psd_
-00016d20: 7261 7727 5d5b 6b5d 2c20 696e 6465 782c  raw'][k], index,
-00016d30: 2061 7869 733d 3029 2020 2020 2020 2020   axis=0)        
-00016d40: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00016d50: 2020 6876 7372 5f6f 7574 5b27 6375 7272    hvsr_out['curr
-00016d60: 656e 745f 7469 6d65 735f 7573 6564 275d  ent_times_used']
-00016d70: 5b6b 5d20 3d20 6e70 2e64 656c 6574 6528  [k] = np.delete(
-00016d80: 6876 7372 5f6f 7574 5b27 6375 7272 656e  hvsr_out['curren
-00016d90: 745f 7469 6d65 735f 7573 6564 275d 5b6b  t_times_used'][k
-00016da0: 5d2c 2069 6e64 6578 290a 2020 2020 2020  ], index).      
-00016db0: 2020 6876 7372 5f6f 7574 5b27 7473 7465    hvsr_out['tste
-00016dc0: 7073 5f75 7365 6427 5d5b 305d 203d 2068  ps_used'][0] = h
-00016dd0: 7673 725f 6f75 745b 2770 7073 6473 275d  vsr_out['ppsds']
-00016de0: 5b6b 5d5b 2763 7572 7265 6e74 5f74 696d  [k]['current_tim
-00016df0: 6573 5f75 7365 6427 5d2e 7368 6170 655b  es_used'].shape[
-00016e00: 305d 0a0a 2020 2020 6876 7372 5f6f 7574  0]..    hvsr_out
-00016e10: 5b27 696e 645f 6876 7372 5f73 7464 4465  ['ind_hvsr_stdDe
-00016e20: 7627 5d20 3d20 6e70 2e73 7464 2868 7673  v'] = np.std(hvs
-00016e30: 725f 6f75 745b 2769 6e64 5f68 7673 725f  r_out['ind_hvsr_
-00016e40: 6375 7276 6573 275d 2c20 6178 6973 3d30  curves'], axis=0
-00016e50: 290a 0a20 2020 2023 4765 7420 7065 616b  )..    #Get peak
-00016e60: 7320 666f 7220 6561 6368 2074 696d 6520  s for each time 
-00016e70: 7374 6570 0a20 2020 2074 5374 6570 5065  step.    tStepPe
-00016e80: 616b 7320 3d20 5b5d 0a20 2020 2066 6f72  aks = [].    for
-00016e90: 2074 5374 6570 4856 5352 2069 6e20 6876   tStepHVSR in hv
-00016ea0: 7372 5f74 5374 6570 733a 0a20 2020 2020  sr_tSteps:.     
-00016eb0: 2020 2074 5374 6570 5065 616b 732e 6170     tStepPeaks.ap
-00016ec0: 7065 6e64 285f 5f66 696e 645f 7065 616b  pend(__find_peak
-00016ed0: 7328 7453 7465 7048 5653 5229 290a 2020  s(tStepHVSR)).  
-00016ee0: 2020 6876 7372 5f6f 7574 5b27 696e 645f    hvsr_out['ind_
-00016ef0: 6876 7372 5f70 6561 6b5f 696e 6469 6365  hvsr_peak_indice
-00016f00: 7327 5d20 3d20 7453 7465 7050 6561 6b73  s'] = tStepPeaks
-00016f10: 0a20 2020 2023 4765 7420 7065 616b 7320  .    #Get peaks 
-00016f20: 6f66 206d 6169 6e20 4856 2063 7572 7665  of main HV curve
-00016f30: 0a20 2020 2068 7673 725f 6f75 745b 2768  .    hvsr_out['h
-00016f40: 7673 725f 7065 616b 5f69 6e64 6963 6573  vsr_peak_indices
-00016f50: 275d 203d 205f 5f66 696e 645f 7065 616b  '] = __find_peak
-00016f60: 7328 6876 7372 5f6f 7574 5b27 6876 7372  s(hvsr_out['hvsr
-00016f70: 5f63 7572 7665 275d 290a 2020 2020 0a20  _curve']).    . 
-00016f80: 2020 2023 4765 7420 6672 6571 7565 6e63     #Get frequenc
-00016f90: 7920 7661 6c75 6573 2061 7420 4856 2070  y values at HV p
-00016fa0: 6561 6b73 2069 6e20 6d61 696e 2063 7572  eaks in main cur
-00016fb0: 7665 0a20 2020 2068 7673 7250 463d 5b5d  ve.    hvsrPF=[]
-00016fc0: 0a20 2020 2066 6f72 2070 2069 6e20 6876  .    for p in hv
-00016fd0: 7372 5f6f 7574 5b27 6876 7372 5f70 6561  sr_out['hvsr_pea
-00016fe0: 6b5f 696e 6469 6365 7327 5d3a 0a20 2020  k_indices']:.   
-00016ff0: 2020 2020 2068 7673 7250 462e 6170 7065       hvsrPF.appe
-00017000: 6e64 2868 7673 725f 6f75 745b 2778 5f66  nd(hvsr_out['x_f
-00017010: 7265 7173 275d 5b61 6e79 4b5d 5b70 5d29  reqs'][anyK][p])
-00017020: 0a20 2020 2068 7673 725f 6f75 745b 2768  .    hvsr_out['h
-00017030: 7673 725f 7065 616b 5f66 7265 7173 275d  vsr_peak_freqs']
-00017040: 203d 206e 702e 6172 7261 7928 6876 7372   = np.array(hvsr
-00017050: 5046 290a 0a0a 2020 2020 2347 6574 206f  PF)...    #Get o
-00017060: 7468 6572 2048 5653 5220 7061 7261 6d65  ther HVSR parame
-00017070: 7465 7273 2028 692e 652e 2c20 7374 616e  ters (i.e., stan
-00017080: 6461 7264 2064 6576 6961 7469 6f6e 732c  dard deviations,
-00017090: 2077 6174 6572 206c 6576 656c 732c 2065   water levels, e
-000170a0: 7463 2e29 0a20 2020 2068 7673 725f 6f75  tc.).    hvsr_ou
-000170b0: 7420 3d20 5f5f 6765 7468 7673 7270 6172  t = __gethvsrpar
-000170c0: 616d 7328 6876 7372 5f6f 7574 290a 0a20  ams(hvsr_out).. 
-000170d0: 2020 2023 496e 636c 7564 6520 7468 6520     #Include the 
-000170e0: 6f72 6967 696e 616c 206f 6273 7079 2073  original obspy s
-000170f0: 7472 6561 6d20 696e 2074 6865 206f 7574  tream in the out
-00017100: 7075 740a 2020 2020 6876 7372 5f6f 7574  put.    hvsr_out
-00017110: 5b27 7374 7265 616d 275d 203d 2070 6172  ['stream'] = par
-00017120: 616d 735b 2773 7472 6561 6d27 5d0a 0a20  ams['stream'].. 
-00017130: 2020 2072 6574 7572 6e20 6876 7372 5f6f     return hvsr_o
-00017140: 7574 0a0a 2348 656c 7065 7220 6675 6e63  ut..#Helper func
-00017150: 7469 6f6e 2066 6f72 2073 6d6f 6f74 6869  tion for smoothi
-00017160: 6e67 2061 6372 6f73 7320 6672 6571 7565  ng across freque
-00017170: 6e63 6965 730a 6465 6620 5f5f 6672 6571  ncies.def __freq
-00017180: 5f73 6d6f 6f74 685f 7769 6e64 6f77 2868  _smooth_window(h
-00017190: 7673 725f 6f75 742c 2066 5f73 6d6f 6f74  vsr_out, f_smoot
-000171a0: 685f 7769 6474 682c 206b 696e 6429 3a0a  h_width, kind):.
-000171b0: 2020 2020 2222 2248 656c 7065 7220 6675      """Helper fu
-000171c0: 6e63 7469 6f6e 2074 6f20 736d 6f6f 7468  nction to smooth
-000171d0: 2066 7265 7175 656e 6379 2069 6620 2763   frequency if 'c
-000171e0: 6f6e 7374 616e 7427 206f 7220 2770 726f  onstant' or 'pro
-000171f0: 706f 7274 696f 6e61 6c27 2069 7320 7061  portional' is pa
-00017200: 7373 6564 2074 6f20 6672 6571 5f73 6d6f  ssed to freq_smo
-00017210: 6f74 6820 7061 7261 6d65 7465 7220 6f66  oth parameter of
-00017220: 2070 726f 6365 7373 5f68 7673 7228 2920   process_hvsr() 
-00017230: 6675 6e63 7469 6f6e 2222 220a 2020 2020  function""".    
-00017240: 6966 206b 696e 6420 3d3d 2027 636f 6e73  if kind == 'cons
-00017250: 7461 6e74 273a 0a20 2020 2020 2020 2066  tant':.        f
-00017260: 7769 6474 6848 616c 6620 3d20 665f 736d  widthHalf = f_sm
-00017270: 6f6f 7468 5f77 6964 7468 2f2f 320a 2020  ooth_width//2.  
-00017280: 2020 656c 6966 206b 696e 6420 3d3d 2027    elif kind == '
-00017290: 7072 6f70 6f72 7469 6f6e 616c 273a 0a20  proportional':. 
-000172a0: 2020 2020 2020 2061 6e79 4b65 7920 3d20         anyKey = 
-000172b0: 6c69 7374 2868 7673 725f 6f75 745b 2770  list(hvsr_out['p
-000172c0: 7364 5f72 6177 275d 2e6b 6579 7328 2929  sd_raw'].keys())
-000172d0: 5b30 5d0a 2020 2020 2020 2020 6672 6571  [0].        freq
-000172e0: 4c65 6e67 7468 203d 2068 7673 725f 6f75  Length = hvsr_ou
-000172f0: 745b 2770 7364 5f72 6177 275d 5b61 6e79  t['psd_raw'][any
-00017300: 4b65 795d 2e73 6861 7065 5b31 5d0a 2020  Key].shape[1].  
-00017310: 2020 2020 2020 6966 2066 5f73 6d6f 6f74        if f_smoot
-00017320: 685f 7769 6474 6820 3e20 313a 0a20 2020  h_width > 1:.   
-00017330: 2020 2020 2020 2020 2066 7769 6474 6848           fwidthH
-00017340: 616c 6620 3d20 696e 7428 665f 736d 6f6f  alf = int(f_smoo
-00017350: 7468 5f77 6964 7468 2f31 3030 202a 2066  th_width/100 * f
-00017360: 7265 714c 656e 6774 6829 0a20 2020 2020  reqLength).     
-00017370: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00017380: 2020 2020 2066 7769 6474 6848 616c 6620       fwidthHalf 
-00017390: 3d20 696e 7428 665f 736d 6f6f 7468 5f77  = int(f_smooth_w
-000173a0: 6964 7468 202a 2066 7265 714c 656e 6774  idth * freqLengt
-000173b0: 6829 0a20 2020 2065 6c73 653a 0a20 2020  h).    else:.   
-000173c0: 2020 2020 2070 7269 6e74 2827 4f6f 7073       print('Oops
-000173d0: 2c20 7479 706f 2073 6f6d 6577 6865 7265  , typo somewhere
-000173e0: 2729 0a0a 2020 2020 666f 7220 6b20 696e  ')..    for k in
-000173f0: 2068 7673 725f 6f75 745b 2770 7364 5f72   hvsr_out['psd_r
-00017400: 6177 275d 3a0a 2020 2020 2020 2020 6e65  aw']:.        ne
-00017410: 7754 5053 4420 3d20 6c69 7374 286e 702e  wTPSD = list(np.
-00017420: 6f6e 6573 5f6c 696b 6528 6876 7372 5f6f  ones_like(hvsr_o
-00017430: 7574 5b27 7073 645f 7261 7727 5d5b 6b5d  ut['psd_raw'][k]
-00017440: 2929 0a20 2020 2020 2020 2066 6f72 2074  )).        for t
-00017450: 2c20 7450 5344 2069 6e20 656e 756d 6572  , tPSD in enumer
-00017460: 6174 6528 6876 7372 5f6f 7574 5b27 7073  ate(hvsr_out['ps
-00017470: 645f 7261 7727 5d5b 6b5d 293a 0a20 2020  d_raw'][k]):.   
-00017480: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
-00017490: 6656 616c 2069 6e20 656e 756d 6572 6174  fVal in enumerat
-000174a0: 6528 7450 5344 293a 0a20 2020 2020 2020  e(tPSD):.       
-000174b0: 2020 2020 2020 2020 2069 6620 6920 3c20           if i < 
-000174c0: 6677 6964 7468 4861 6c66 3a0a 2020 2020  fwidthHalf:.    
-000174d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174e0: 646f 776e 5769 6e20 3d20 690a 2020 2020  downWin = i.    
-000174f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017500: 696e 6420 3d20 2d31 2a28 6677 6964 7468  ind = -1*(fwidth
-00017510: 4861 6c66 2d64 6f77 6e57 696e 290a 2020  Half-downWin).  
-00017520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017530: 2020 7769 6e64 4d75 6c74 6970 6c69 6572    windMultiplier
-00017540: 5f64 6f77 6e20 3d20 6e70 2e6c 696e 7370  _down = np.linsp
-00017550: 6163 6528 312f 6677 6964 7468 4861 6c66  ace(1/fwidthHalf
-00017560: 2c20 312d 312f 6677 6964 7468 4861 6c66  , 1-1/fwidthHalf
-00017570: 2c20 6677 6964 7468 4861 6c66 290a 2020  , fwidthHalf).  
-00017580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017590: 2020 7769 6e64 4d75 6c74 6970 6c69 6572    windMultiplier
-000175a0: 5f64 6f77 6e20 3d20 7769 6e64 4d75 6c74  _down = windMult
-000175b0: 6970 6c69 6572 5f64 6f77 6e5b 3a69 6e64  iplier_down[:ind
-000175c0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000175d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000175e0: 2020 2020 2020 2020 2020 2020 646f 776e              down
-000175f0: 5769 6e20 3d20 6677 6964 7468 4861 6c66  Win = fwidthHalf
-00017600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017610: 2020 2020 2077 696e 644d 756c 7469 706c       windMultipl
-00017620: 6965 725f 646f 776e 203d 2020 6e70 2e6c  ier_down =  np.l
-00017630: 696e 7370 6163 6528 312f 6677 6964 7468  inspace(1/fwidth
-00017640: 4861 6c66 2c20 312d 312f 6677 6964 7468  Half, 1-1/fwidth
-00017650: 4861 6c66 2c20 6677 6964 7468 4861 6c66  Half, fwidthHalf
-00017660: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00017670: 2020 6966 2069 202b 2066 7769 6474 6848    if i + fwidthH
-00017680: 616c 6620 3e3d 206c 656e 2874 5053 4429  alf >= len(tPSD)
-00017690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000176a0: 2020 2020 2020 7570 5769 6e20 3d20 286c        upWin = (l
-000176b0: 656e 2874 5053 4429 202d 2069 290a 2020  en(tPSD) - i).  
-000176c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176d0: 2020 696e 6420 3d20 2d31 202a 2028 6677    ind = -1 * (fw
-000176e0: 6964 7468 4861 6c66 2d75 7057 696e 2b31  idthHalf-upWin+1
-000176f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00017700: 2020 2020 2020 7769 6e64 4d75 6c74 6970        windMultip
-00017710: 6c69 6572 5f75 7020 3d20 6e70 2e6c 696e  lier_up = np.lin
-00017720: 7370 6163 6528 312d 312f 6677 6964 7468  space(1-1/fwidth
-00017730: 4861 6c66 2c20 302c 2066 7769 6474 6848  Half, 0, fwidthH
-00017740: 616c 6629 0a20 2020 2020 2020 2020 2020  alf).           
-00017750: 2020 2020 2020 2020 2077 696e 644d 756c           windMul
-00017760: 7469 706c 6965 725f 7570 203d 2077 696e  tiplier_up = win
-00017770: 644d 756c 7469 706c 6965 725f 7570 5b3a  dMultiplier_up[:
-00017780: 696e 645d 0a0a 2020 2020 2020 2020 2020  ind]..          
-00017790: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000177a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000177b0: 7570 5769 6e20 3d20 6677 6964 7468 4861  upWin = fwidthHa
-000177c0: 6c66 2b31 0a20 2020 2020 2020 2020 2020  lf+1.           
-000177d0: 2020 2020 2020 2020 2077 696e 644d 756c           windMul
-000177e0: 7469 706c 6965 725f 7570 203d 206e 702e  tiplier_up = np.
-000177f0: 6c69 6e73 7061 6365 2831 202d 2031 2f66  linspace(1 - 1/f
-00017800: 7769 6474 6848 616c 662c 2030 2c20 6677  widthHalf, 0, fw
-00017810: 6964 7468 4861 6c66 290a 2020 2020 2020  idthHalf).      
-00017820: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00017830: 2020 2020 2020 2077 696e 644d 756c 7469         windMulti
-00017840: 706c 6965 7220 3d20 6c69 7374 286e 702e  plier = list(np.
-00017850: 6873 7461 636b 285b 7769 6e64 4d75 6c74  hstack([windMult
-00017860: 6970 6c69 6572 5f64 6f77 6e2c 2077 696e  iplier_down, win
-00017870: 644d 756c 7469 706c 6965 725f 7570 5d29  dMultiplier_up])
-00017880: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00017890: 2020 6d69 6449 6e64 203d 206e 702e 6172    midInd = np.ar
-000178a0: 676d 6178 2877 696e 644d 756c 7469 706c  gmax(windMultipl
-000178b0: 6965 7229 0a20 2020 2020 2020 2020 2020  ier).           
-000178c0: 2020 2020 2069 6620 6920 3e20 303a 0a20       if i > 0:. 
-000178d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000178e0: 2020 206d 6964 496e 642b 3d31 0a20 2020     midInd+=1.   
-000178f0: 2020 2020 2020 2020 2020 2020 2077 696e               win
-00017900: 644d 756c 7469 706c 6965 722e 696e 7365  dMultiplier.inse
-00017910: 7274 286d 6964 496e 642c 2031 290a 2020  rt(midInd, 1).  
-00017920: 2020 2020 2020 2020 2020 2020 2020 736d                sm
-00017930: 6f6f 7468 5661 6c20 3d20 6e70 2e64 6976  oothVal = np.div
-00017940: 6964 6528 6e70 2e73 756d 286e 702e 6d75  ide(np.sum(np.mu
-00017950: 6c74 6970 6c79 2874 5053 445b 692d 646f  ltiply(tPSD[i-do
-00017960: 776e 5769 6e3a 692b 7570 5769 6e5d 2c20  wnWin:i+upWin], 
-00017970: 7769 6e64 4d75 6c74 6970 6c69 6572 2929  windMultiplier))
-00017980: 2c20 6e70 2e73 756d 2877 696e 644d 756c  , np.sum(windMul
-00017990: 7469 706c 6965 7229 290a 2020 2020 2020  tiplier)).      
-000179a0: 2020 2020 2020 2020 2020 6e65 7754 5053            newTPS
-000179b0: 445b 745d 5b69 5d20 3d20 736d 6f6f 7468  D[t][i] = smooth
-000179c0: 5661 6c0a 0a20 2020 2020 2020 2068 7673  Val..        hvs
-000179d0: 725f 6f75 745b 2770 7364 5f72 6177 275d  r_out['psd_raw']
-000179e0: 5b6b 5d20 3d20 6e65 7754 5053 440a 2020  [k] = newTPSD.  
-000179f0: 2020 0a20 2020 2072 6574 7572 6e20 6876    .    return hv
-00017a00: 7372 5f6f 7574 0a0a 2344 6966 6675 7365  sr_out..#Diffuse
-00017a10: 2066 6965 6c64 2061 7373 756d 7074 696f   field assumptio
-00017a20: 6e2c 206e 6f74 2063 7572 7265 6e74 6c79  n, not currently
-00017a30: 2069 6d70 6c65 6d65 6e74 6564 0a64 6566   implemented.def
-00017a40: 2064 6661 2870 6172 616d 732c 2064 6179   dfa(params, day
-00017a50: 5f74 696d 655f 7661 6c75 6573 2c20 6461  _time_values, da
-00017a60: 795f 7469 6d65 5f70 7364 2c20 785f 7661  y_time_psd, x_va
-00017a70: 6c75 6573 2c20 6571 7561 6c5f 6461 696c  lues, equal_dail
-00017a80: 795f 656e 6572 6779 2c20 6d65 6469 616e  y_energy, median
-00017a90: 5f64 6169 6c79 5f70 7364 2c20 7665 7262  _daily_psd, verb
-00017aa0: 6f73 6529 3a0a 2020 2020 2222 2246 756e  ose):.    """Fun
-00017ab0: 6374 696f 6e20 666f 7220 7065 7266 6f72  ction for perfor
-00017ac0: 6d69 6e67 2044 6966 6675 7365 2046 6965  ming Diffuse Fie
-00017ad0: 6c64 2041 7373 756d 7074 696f 6e20 2844  ld Assumption (D
-00017ae0: 4641 2920 616e 616c 7973 6973 0a20 2020  FA) analysis.   
-00017af0: 200a 2020 2020 2020 2020 5468 6973 2066   .        This f
-00017b00: 6561 7475 7265 2069 7320 6e6f 7420 7965  eature is not ye
-00017b10: 7420 696d 706c 656d 656e 7465 642e 0a20  t implemented.. 
-00017b20: 2020 2022 2222 0a20 2020 2023 2041 7265     """.    # Are
-00017b30: 2077 6520 646f 696e 6720 4446 413f 0a20   we doing DFA?. 
-00017b40: 2020 2023 2055 7365 2065 7175 616c 2065     # Use equal e
-00017b50: 6e65 7267 7920 666f 7220 6461 696c 7920  nergy for daily 
-00017b60: 5053 4473 2074 6f20 6769 7665 2073 6d61  PSDs to give sma
-00017b70: 6c6c 2027 6576 656e 7473 2720 6120 6368  ll 'events' a ch
-00017b80: 616e 6365 2074 6f20 636f 6e74 7269 6275  ance to contribu
-00017b90: 7465 0a20 2020 2023 2074 6865 2073 616d  te.    # the sam
-00017ba0: 6520 6173 206c 6172 6765 206f 6e65 732c  e as large ones,
-00017bb0: 2073 6f20 7468 6174 2050 312b 5032 2b50   so that P1+P2+P
-00017bc0: 333d 310a 2020 2020 0a20 2020 206d 6574  3=1.    .    met
-00017bd0: 686f 643d 7061 7261 6d73 5b27 6d65 7468  hod=params['meth
-00017be0: 6f64 275d 0a20 2020 200a 2020 2020 6d65  od'].    .    me
-00017bf0: 7468 6f64 4c69 7374 203d 205b 2744 6966  thodList = ['Dif
-00017c00: 6675 7365 2046 6965 6c64 2041 7373 756d  fuse Field Assum
-00017c10: 7074 696f 6e27 2c20 2741 7269 7468 6d65  ption', 'Arithme
-00017c20: 7469 6320 4d65 616e 272c 2027 4765 6f6d  tic Mean', 'Geom
-00017c30: 6574 7269 6320 4d65 616e 272c 2027 5665  etric Mean', 'Ve
-00017c40: 6374 6f72 2053 756d 6d61 7469 6f6e 272c  ctor Summation',
-00017c50: 2027 5175 6164 7261 7469 6320 4d65 616e   'Quadratic Mean
-00017c60: 272c 2027 4d61 7869 6d75 6d20 486f 7269  ', 'Maximum Hori
-00017c70: 7a6f 6e74 616c 2056 616c 7565 275d 0a20  zontal Value']. 
-00017c80: 2020 2064 6661 4c69 7374 203d 205b 2764     dfaList = ['d
-00017c90: 6661 272c 2027 6469 6666 7573 6520 6669  fa', 'diffuse fi
-00017ca0: 656c 6427 2c20 2764 6966 6675 7365 2066  eld', 'diffuse f
-00017cb0: 6965 6c64 2061 7373 756d 7074 696f 6e27  ield assumption'
-00017cc0: 5d0a 2020 2020 6966 2074 7970 6528 6d65  ].    if type(me
-00017cd0: 7468 6f64 2920 6973 2069 6e74 3a0a 2020  thod) is int:.  
-00017ce0: 2020 2020 2020 6d65 7468 6f64 203d 206d        method = m
-00017cf0: 6574 686f 644c 6973 745b 6d65 7468 6f64  ethodList[method
-00017d00: 5d0a 2020 2020 2020 2020 0a20 2020 2069  ].        .    i
-00017d10: 6620 6d65 7468 6f64 2069 6e20 6466 614c  f method in dfaL
-00017d20: 6973 743a 0a20 2020 2020 2020 2069 6620  ist:.        if 
-00017d30: 7665 7262 6f73 653a 0a20 2020 2020 2020  verbose:.       
-00017d40: 2020 2020 2070 7269 6e74 2827 5b49 4e46       print('[INF
-00017d50: 4f5d 2044 6966 6675 7365 2046 6965 6c64  O] Diffuse Field
-00017d60: 2041 7373 756d 7074 696f 6e27 2c20 666c   Assumption', fl
-00017d70: 7573 683d 5472 7565 290a 2020 2020 2020  ush=True).      
-00017d80: 2020 2020 2020 6469 7370 6c61 7920 3d20        display = 
-00017d90: 4661 6c73 650a 2020 2020 2020 2020 7375  False.        su
-00017da0: 6d5f 6e73 5f70 6f77 6572 203d 206c 6973  m_ns_power = lis
-00017db0: 7428 290a 2020 2020 2020 2020 7375 6d5f  t().        sum_
-00017dc0: 6577 5f70 6f77 6572 203d 206c 6973 7428  ew_power = list(
-00017dd0: 290a 2020 2020 2020 2020 7375 6d5f 7a5f  ).        sum_z_
-00017de0: 706f 7765 7220 3d20 6c69 7374 2829 0a20  power = list(). 
-00017df0: 2020 2020 2020 2064 6169 6c79 5f70 7364         daily_psd
-00017e00: 203d 205b 7b7d 2c20 7b7d 2c20 7b7d 5d0a   = [{}, {}, {}].
-00017e10: 2020 2020 2020 2020 6461 795f 7661 6c75          day_valu
-00017e20: 6573 203d 206c 6973 7428 290a 0a20 2020  es = list()..   
-00017e30: 2020 2020 2023 204d 616b 6520 7375 7265       # Make sure
-00017e40: 2077 6520 6861 7665 2061 6c6c 2033 2063   we have all 3 c
-00017e50: 6f6d 706f 6e65 6e74 7320 666f 7220 6576  omponents for ev
-00017e60: 6572 7920 7469 6d65 2073 616d 706c 650a  ery time sample.
-00017e70: 2020 2020 2020 2020 666f 7220 6461 795f          for day_
-00017e80: 7469 6d65 2069 6e20 6461 795f 7469 6d65  time in day_time
-00017e90: 5f76 616c 7565 733a 0a20 2020 2020 2020  _values:.       
-00017ea0: 2020 2020 2069 6620 6461 795f 7469 6d65       if day_time
-00017eb0: 206e 6f74 2069 6e20 2864 6179 5f74 696d   not in (day_tim
-00017ec0: 655f 7073 645b 305d 2e6b 6579 7328 2929  e_psd[0].keys())
-00017ed0: 206f 7220 6461 795f 7469 6d65 206e 6f74   or day_time not
-00017ee0: 2069 6e20 2864 6179 5f74 696d 655f 7073   in (day_time_ps
-00017ef0: 645b 315d 2e6b 6579 7328 2929 206f 7220  d[1].keys()) or 
-00017f00: 6461 795f 7469 6d65 206e 6f74 2069 6e20  day_time not in 
-00017f10: 280a 2020 2020 2020 2020 2020 2020 6461  (.            da
-00017f20: 795f 7469 6d65 5f70 7364 5b32 5d2e 6b65  y_time_psd[2].ke
-00017f30: 7973 2829 293a 0a20 2020 2020 2020 2020  ys()):.         
-00017f40: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00017f50: 2020 2020 2020 2020 2020 2020 6461 7920              day 
-00017f60: 3d20 6461 795f 7469 6d65 2e73 706c 6974  = day_time.split
-00017f70: 2827 5427 295b 305d 0a20 2020 2020 2020  ('T')[0].       
-00017f80: 2020 2020 2069 6620 6461 7920 6e6f 7420       if day not 
-00017f90: 696e 2064 6179 5f76 616c 7565 733a 0a20  in day_values:. 
-00017fa0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00017fb0: 6179 5f76 616c 7565 732e 6170 7065 6e64  ay_values.append
-00017fc0: 2864 6179 290a 0a20 2020 2020 2020 2020  (day)..         
-00017fd0: 2020 2023 2049 6e69 7469 616c 697a 6520     # Initialize 
-00017fe0: 7468 6520 6461 696c 7920 5053 4473 2e0a  the daily PSDs..
-00017ff0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00018000: 6179 206e 6f74 2069 6e20 6461 696c 795f  ay not in daily_
-00018010: 7073 645b 305d 2e6b 6579 7328 293a 0a20  psd[0].keys():. 
-00018020: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00018030: 6169 6c79 5f70 7364 5b30 5d5b 6461 795d  aily_psd[0][day]
-00018040: 203d 206c 6973 7428 290a 2020 2020 2020   = list().      
-00018050: 2020 2020 2020 2020 2020 6461 696c 795f            daily_
-00018060: 7073 645b 315d 5b64 6179 5d20 3d20 6c69  psd[1][day] = li
-00018070: 7374 2829 0a20 2020 2020 2020 2020 2020  st().           
-00018080: 2020 2020 2064 6169 6c79 5f70 7364 5b32       daily_psd[2
-00018090: 5d5b 6461 795d 203d 206c 6973 7428 290a  ][day] = list().
-000180a0: 0a20 2020 2020 2020 2020 2020 2064 6169  .            dai
-000180b0: 6c79 5f70 7364 5b30 5d5b 6461 795d 2e61  ly_psd[0][day].a
-000180c0: 7070 656e 6428 6461 795f 7469 6d65 5f70  ppend(day_time_p
-000180d0: 7364 5b30 5d5b 6461 795f 7469 6d65 5d29  sd[0][day_time])
-000180e0: 0a20 2020 2020 2020 2020 2020 2064 6169  .            dai
-000180f0: 6c79 5f70 7364 5b31 5d5b 6461 795d 2e61  ly_psd[1][day].a
-00018100: 7070 656e 6428 6461 795f 7469 6d65 5f70  ppend(day_time_p
-00018110: 7364 5b31 5d5b 6461 795f 7469 6d65 5d29  sd[1][day_time])
-00018120: 0a20 2020 2020 2020 2020 2020 2064 6169  .            dai
-00018130: 6c79 5f70 7364 5b32 5d5b 6461 795d 2e61  ly_psd[2][day].a
-00018140: 7070 656e 6428 6461 795f 7469 6d65 5f70  ppend(day_time_p
-00018150: 7364 5b32 5d5b 6461 795f 7469 6d65 5d29  sd[2][day_time])
-00018160: 0a0a 2020 2020 2020 2020 2320 466f 7220  ..        # For 
-00018170: 6561 6368 2064 6179 2065 7175 616c 697a  each day equaliz
-00018180: 6520 656e 6572 6779 0a20 2020 2020 2020  e energy.       
-00018190: 2066 6f72 2064 6179 2069 6e20 6461 795f   for day in day_
-000181a0: 7661 6c75 6573 3a0a 0a20 2020 2020 2020  values:..       
-000181b0: 2020 2020 2023 2045 6163 6820 5053 4420       # Each PSD 
-000181c0: 666f 7220 7468 6520 6461 790a 2020 2020  for the day.    
-000181d0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-000181e0: 2072 616e 6765 286c 656e 2864 6169 6c79   range(len(daily
-000181f0: 5f70 7364 5b30 5d5b 6461 795d 2929 3a0a  _psd[0][day])):.
-00018200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018210: 507a 203d 206c 6973 7428 290a 2020 2020  Pz = list().    
-00018220: 2020 2020 2020 2020 2020 2020 5031 203d              P1 =
-00018230: 206c 6973 7428 290a 2020 2020 2020 2020   list().        
-00018240: 2020 2020 2020 2020 5032 203d 206c 6973          P2 = lis
-00018250: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00018260: 2020 2020 7375 6d5f 707a 203d 2030 0a20      sum_pz = 0. 
-00018270: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00018280: 756d 5f70 3120 3d20 300a 2020 2020 2020  um_p1 = 0.      
-00018290: 2020 2020 2020 2020 2020 7375 6d5f 7032            sum_p2
-000182a0: 203d 2030 0a0a 2020 2020 2020 2020 2020   = 0..          
-000182b0: 2020 2020 2020 2320 4561 6368 2073 616d        # Each sam
-000182c0: 706c 6520 6f66 2074 6865 2050 5344 202c  ple of the PSD ,
-000182d0: 2063 6f6e 7665 7274 2074 6f20 706f 7765   convert to powe
-000182e0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-000182f0: 2020 666f 7220 6a20 696e 2072 616e 6765    for j in range
-00018300: 286c 656e 2878 5f76 616c 7565 7329 202d  (len(x_values) -
-00018310: 2031 293a 0a20 2020 2020 2020 2020 2020   1):.           
-00018320: 2020 2020 2020 2020 2070 7a20 3d20 5f5f           pz = __
-00018330: 6765 745f 706f 7765 7228 5b64 6169 6c79  get_power([daily
-00018340: 5f70 7364 5b30 5d5b 6461 795d 5b69 5d5b  _psd[0][day][i][
-00018350: 6a5d 2c20 6461 696c 795f 7073 645b 305d  j], daily_psd[0]
-00018360: 5b64 6179 5d5b 695d 5b6a 202b 2031 5d5d  [day][i][j + 1]]
-00018370: 2c20 5b78 5f76 616c 7565 735b 6a5d 2c20  , [x_values[j], 
-00018380: 785f 7661 6c75 6573 5b6a 202b 2031 5d5d  x_values[j + 1]]
-00018390: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000183a0: 2020 2020 2020 507a 2e61 7070 656e 6428        Pz.append(
-000183b0: 707a 290a 2020 2020 2020 2020 2020 2020  pz).            
-000183c0: 2020 2020 2020 2020 7375 6d5f 707a 202b          sum_pz +
-000183d0: 3d20 707a 0a20 2020 2020 2020 2020 2020  = pz.           
-000183e0: 2020 2020 2020 2020 2070 3120 3d20 5f5f           p1 = __
-000183f0: 6765 745f 706f 7765 7228 5b64 6169 6c79  get_power([daily
-00018400: 5f70 7364 5b31 5d5b 6461 795d 5b69 5d5b  _psd[1][day][i][
-00018410: 6a5d 2c20 6461 696c 795f 7073 645b 315d  j], daily_psd[1]
-00018420: 5b64 6179 5d5b 695d 5b6a 202b 2031 5d5d  [day][i][j + 1]]
-00018430: 2c20 5b78 5f76 616c 7565 735b 6a5d 2c20  , [x_values[j], 
-00018440: 785f 7661 6c75 6573 5b6a 202b 2031 5d5d  x_values[j + 1]]
-00018450: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00018460: 2020 2020 2020 5031 2e61 7070 656e 6428        P1.append(
-00018470: 7031 290a 2020 2020 2020 2020 2020 2020  p1).            
-00018480: 2020 2020 2020 2020 7375 6d5f 7031 202b          sum_p1 +
-00018490: 3d20 7031 0a20 2020 2020 2020 2020 2020  = p1.           
-000184a0: 2020 2020 2020 2020 2070 3220 3d20 5f5f           p2 = __
-000184b0: 6765 745f 706f 7765 7228 5b64 6169 6c79  get_power([daily
-000184c0: 5f70 7364 5b32 5d5b 6461 795d 5b69 5d5b  _psd[2][day][i][
-000184d0: 6a5d 2c20 6461 696c 795f 7073 645b 325d  j], daily_psd[2]
-000184e0: 5b64 6179 5d5b 695d 5b6a 202b 2031 5d5d  [day][i][j + 1]]
-000184f0: 2c20 5b78 5f76 616c 7565 735b 6a5d 2c20  , [x_values[j], 
-00018500: 785f 7661 6c75 6573 5b6a 202b 2031 5d5d  x_values[j + 1]]
-00018510: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00018520: 2020 2020 2020 5032 2e61 7070 656e 6428        P2.append(
-00018530: 7032 290a 2020 2020 2020 2020 2020 2020  p2).            
-00018540: 2020 2020 2020 2020 7375 6d5f 7032 202b          sum_p2 +
-00018550: 3d20 7032 0a0a 2020 2020 2020 2020 2020  = p2..          
-00018560: 2020 2020 2020 7375 6d5f 706f 7765 7220        sum_power 
-00018570: 3d20 7375 6d5f 707a 202b 2073 756d 5f70  = sum_pz + sum_p
-00018580: 3120 2b20 7375 6d5f 7032 2020 2320 746f  1 + sum_p2  # to
-00018590: 7461 6c20 706f 7765 720a 0a20 2020 2020  tal power..     
-000185a0: 2020 2020 2020 2020 2020 2023 204d 6f72             # Mor
-000185b0: 6d61 6c69 7a65 6420 706f 7765 720a 2020  malized power.  
-000185c0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000185d0: 7220 6a20 696e 2072 616e 6765 286c 656e  r j in range(len
-000185e0: 2878 5f76 616c 7565 7329 202d 2031 293a  (x_values) - 1):
-000185f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018600: 2020 2020 2023 2049 6e69 7469 616c 697a       # Initializ
-00018610: 6520 6966 2074 6869 7320 6973 2074 6865  e if this is the
-00018620: 2066 6972 7374 2073 616d 706c 6520 6f66   first sample of
-00018630: 2074 6865 2064 6179 0a20 2020 2020 2020   the day.       
-00018640: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00018650: 6920 3d3d 2030 3a0a 2020 2020 2020 2020  i == 0:.        
-00018660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018670: 7375 6d5f 7a5f 706f 7765 722e 6170 7065  sum_z_power.appe
-00018680: 6e64 2850 7a5b 6a5d 202f 2073 756d 5f70  nd(Pz[j] / sum_p
-00018690: 6f77 6572 290a 2020 2020 2020 2020 2020  ower).          
-000186a0: 2020 2020 2020 2020 2020 2020 2020 7375                su
-000186b0: 6d5f 6e73 5f70 6f77 6572 2e61 7070 656e  m_ns_power.appen
-000186c0: 6428 5031 5b6a 5d20 2f20 7375 6d5f 706f  d(P1[j] / sum_po
-000186d0: 7765 7229 0a20 2020 2020 2020 2020 2020  wer).           
-000186e0: 2020 2020 2020 2020 2020 2020 2073 756d               sum
-000186f0: 5f65 775f 706f 7765 722e 6170 7065 6e64  _ew_power.append
-00018700: 2850 325b 6a5d 202f 2073 756d 5f70 6f77  (P2[j] / sum_pow
-00018710: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-00018720: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00018730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018740: 2020 2020 2020 7375 6d5f 7a5f 706f 7765        sum_z_powe
-00018750: 725b 6a5d 202b 3d20 2850 7a5b 6a5d 202f  r[j] += (Pz[j] /
-00018760: 2073 756d 5f70 6f77 6572 290a 2020 2020   sum_power).    
-00018770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018780: 2020 2020 7375 6d5f 6e73 5f70 6f77 6572      sum_ns_power
-00018790: 5b6a 5d20 2b3d 2028 5031 5b6a 5d20 2f20  [j] += (P1[j] / 
-000187a0: 7375 6d5f 706f 7765 7229 0a20 2020 2020  sum_power).     
-000187b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187c0: 2020 2073 756d 5f65 775f 706f 7765 725b     sum_ew_power[
-000187d0: 6a5d 202b 3d20 2850 325b 6a5d 202f 2073  j] += (P2[j] / s
-000187e0: 756d 5f70 6f77 6572 290a 2020 2020 2020  um_power).      
-000187f0: 2020 2020 2020 2320 4176 6572 6167 6520        # Average 
-00018800: 7468 6520 6e6f 726d 616c 697a 6564 2064  the normalized d
-00018810: 6169 6c79 2070 6f77 6572 0a20 2020 2020  aily power.     
-00018820: 2020 2020 2020 2066 6f72 206a 2069 6e20         for j in 
-00018830: 7261 6e67 6528 6c65 6e28 785f 7661 6c75  range(len(x_valu
-00018840: 6573 2920 2d20 3129 3a0a 2020 2020 2020  es) - 1):.      
-00018850: 2020 2020 2020 2020 2020 7375 6d5f 7a5f            sum_z_
-00018860: 706f 7765 725b 6a5d 202f 3d20 6c65 6e28  power[j] /= len(
-00018870: 6461 696c 795f 7073 645b 305d 5b64 6179  daily_psd[0][day
-00018880: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00018890: 2020 2073 756d 5f6e 735f 706f 7765 725b     sum_ns_power[
-000188a0: 6a5d 202f 3d20 6c65 6e28 6461 696c 795f  j] /= len(daily_
-000188b0: 7073 645b 305d 5b64 6179 5d29 0a20 2020  psd[0][day]).   
-000188c0: 2020 2020 2020 2020 2020 2020 2073 756d               sum
-000188d0: 5f65 775f 706f 7765 725b 6a5d 202f 3d20  _ew_power[j] /= 
-000188e0: 6c65 6e28 6461 696c 795f 7073 645b 305d  len(daily_psd[0]
-000188f0: 5b64 6179 5d29 0a0a 2020 2020 2020 2020  [day])..        
-00018900: 2020 2020 6571 7561 6c5f 6461 696c 795f      equal_daily_
-00018910: 656e 6572 6779 5b30 5d5b 6461 795d 203d  energy[0][day] =
-00018920: 2073 756d 5f7a 5f70 6f77 6572 0a20 2020   sum_z_power.   
-00018930: 2020 2020 2020 2020 2065 7175 616c 5f64           equal_d
-00018940: 6169 6c79 5f65 6e65 7267 795b 315d 5b64  aily_energy[1][d
-00018950: 6179 5d20 3d20 7375 6d5f 6e73 5f70 6f77  ay] = sum_ns_pow
-00018960: 6572 0a20 2020 2020 2020 2020 2020 2065  er.            e
-00018970: 7175 616c 5f64 6169 6c79 5f65 6e65 7267  qual_daily_energ
-00018980: 795b 325d 5b64 6179 5d20 3d20 7375 6d5f  y[2][day] = sum_
-00018990: 6577 5f70 6f77 6572 0a0a 2020 2020 7265  ew_power..    re
-000189a0: 7475 726e 200a 0a20 2020 200a 2020 2020  turn ..    .    
-000189b0: 7265 7475 726e 0a0a 2347 6574 2061 6e20  return..#Get an 
-000189c0: 4856 5352 2063 7572 7665 2c20 6769 7665  HVSR curve, give
-000189d0: 6e20 616e 2061 7272 6179 206f 6620 7820  n an array of x 
-000189e0: 7661 6c75 6573 2028 6672 6571 7329 2c20  values (freqs), 
-000189f0: 616e 6420 6120 6469 6374 2077 6974 6820  and a dict with 
-00018a00: 7073 6473 2066 6f72 2074 6872 6565 2063  psds for three c
-00018a10: 6f6d 706f 6e65 6e74 730a 6465 6620 5f5f  omponents.def __
-00018a20: 6765 745f 6876 7372 5f63 7572 7665 2878  get_hvsr_curve(x
-00018a30: 2c20 7073 642c 206d 6574 686f 643d 3429  , psd, method=4)
-00018a40: 3a0a 2020 2020 2222 2220 4765 7420 616e  :.    """ Get an
-00018a50: 2048 5653 5220 6375 7276 6520 6672 6f6d   HVSR curve from
-00018a60: 2074 6872 6565 2063 6f6d 706f 6e65 6e74   three component
-00018a70: 7320 6f76 6572 2074 6865 2073 616d 6520  s over the same 
-00018a80: 7469 6d65 2070 6572 696f 642f 6672 6571  time period/freq
-00018a90: 7565 6e63 7920 696e 7465 7276 616c 730a  uency intervals.
-00018aa0: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-00018ab0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00018ac0: 2020 2020 2020 2078 2020 203a 206c 6973         x   : lis
-00018ad0: 7420 6f72 2061 7272 6179 5f6c 696b 650a  t or array_like.
-00018ae0: 2020 2020 2020 2020 2020 2020 7820 7661              x va
-00018af0: 6c75 6520 2866 7265 7175 656e 6379 206f  lue (frequency o
-00018b00: 7220 7065 7269 6f64 290a 2020 2020 2020  r period).      
-00018b10: 2020 7073 6420 3a20 6469 6374 0a20 2020    psd : dict.   
-00018b20: 2020 2020 2020 2020 2044 6963 7469 6f6e           Diction
-00018b30: 6172 7920 7769 7468 2070 7364 2076 616c  ary with psd val
-00018b40: 7565 7320 666f 7220 7468 7265 6520 636f  ues for three co
-00018b50: 6d70 6f6e 656e 7473 2e20 5573 7561 6c6c  mponents. Usuall
-00018b60: 7920 7265 6164 2069 6e20 6173 2070 6172  y read in as par
-00018b70: 7420 6f66 2068 7673 725f 6469 6374 2066  t of hvsr_dict f
-00018b80: 726f 6d20 7072 6f63 6573 735f 6876 7372  rom process_hvsr
-00018b90: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
-00018ba0: 3a20 696e 7420 6f72 2073 7472 0a20 2020  : int or str.   
-00018bb0: 2020 2020 2020 2020 2049 6e74 6567 6572           Integer
-00018bc0: 206f 7220 7374 7269 6e67 2c20 7265 6164   or string, read
-00018bd0: 2069 6e20 6672 6f6d 2070 726f 6365 7373   in from process
-00018be0: 5f68 7673 7220 6d65 7468 6f64 2070 6172  _hvsr method par
-00018bf0: 616d 6574 6572 0a20 2020 200a 2020 2020  ameter.    .    
-00018c00: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-00018c10: 2d2d 2d0a 2020 2020 2020 2020 6876 7372  ---.        hvsr
-00018c20: 5f63 7572 7665 2020 3a20 6c69 7374 0a20  _curve  : list. 
-00018c30: 2020 2020 2020 2020 2020 204c 6973 7420             List 
-00018c40: 636f 6e74 6169 6e69 6e67 2048 2f56 2072  containing H/V r
-00018c50: 6174 696f 7320 6174 2065 6163 6820 6672  atios at each fr
-00018c60: 6571 7565 6e63 792f 7065 7269 6f64 2069  equency/period i
-00018c70: 6e20 780a 2020 2020 2222 220a 2020 2020  n x.    """.    
-00018c80: 6966 206d 6574 686f 643d 3d30 206f 7220  if method==0 or 
-00018c90: 6d65 7468 6f64 203d 3d27 6466 6127 206f  method =='dfa' o
-00018ca0: 7220 6d65 7468 6f64 3d3d 2744 6966 6675  r method=='Diffu
-00018cb0: 7365 2046 6965 6c64 2041 7373 756d 7074  se Field Assumpt
-00018cc0: 696f 6e27 3a0a 2020 2020 2020 2020 7061  ion':.        pa
-00018cd0: 7373 0a20 2020 2020 2020 2070 7269 6e74  ss.        print
-00018ce0: 2827 4446 4120 6d65 7468 6f64 206e 6f74  ('DFA method not
-00018cf0: 2063 7572 7265 6e74 6c79 2073 7570 706f   currently suppo
-00018d00: 7274 6564 2729 0a20 2020 200a 2020 2020  rted').    .    
-00018d10: 6876 7372 5f63 7572 7665 203d 205b 5d0a  hvsr_curve = [].
-00018d20: 2020 2020 666f 7220 6a20 696e 2072 616e      for j in ran
-00018d30: 6765 286c 656e 2878 292d 3129 3a0a 2020  ge(len(x)-1):.  
-00018d40: 2020 2020 2020 7073 6430 203d 205b 7073        psd0 = [ps
-00018d50: 645b 275a 275d 5b6a 5d2c 2070 7364 5b27  d['Z'][j], psd['
-00018d60: 5a27 5d5b 6a20 2b20 315d 5d0a 2020 2020  Z'][j + 1]].    
-00018d70: 2020 2020 7073 6431 203d 205b 7073 645b      psd1 = [psd[
-00018d80: 2745 275d 5b6a 5d2c 2070 7364 5b27 4527  'E'][j], psd['E'
-00018d90: 5d5b 6a20 2b20 315d 5d0a 2020 2020 2020  ][j + 1]].      
-00018da0: 2020 7073 6432 203d 205b 7073 645b 274e    psd2 = [psd['N
-00018db0: 275d 5b6a 5d2c 2070 7364 5b27 4e27 5d5b  '][j], psd['N'][
-00018dc0: 6a20 2b20 315d 5d0a 2020 2020 2020 2020  j + 1]].        
-00018dd0: 6620 3d20 2020 205b 785b 6a5d 2c20 785b  f =    [x[j], x[
-00018de0: 6a20 2b20 315d 5d0a 0a20 2020 2020 2020  j + 1]]..       
-00018df0: 2068 7673 7220 3d20 5f5f 6765 745f 6876   hvsr = __get_hv
-00018e00: 7372 2870 7364 302c 2070 7364 312c 2070  sr(psd0, psd1, p
-00018e10: 7364 322c 2066 2c20 7573 655f 6d65 7468  sd2, f, use_meth
-00018e20: 6f64 3d6d 6574 686f 6429 0a20 2020 2020  od=method).     
-00018e30: 2020 2068 7673 725f 6375 7276 652e 6170     hvsr_curve.ap
-00018e40: 7065 6e64 2868 7673 7229 2020 0a0a 2020  pend(hvsr)  ..  
-00018e50: 2020 7265 7475 726e 206e 702e 6172 7261    return np.arra
-00018e60: 7928 6876 7372 5f63 7572 7665 290a 0a23  y(hvsr_curve)..#
-00018e70: 4765 7420 4856 5352 0a64 6566 205f 5f67  Get HVSR.def __g
-00018e80: 6574 5f68 7673 7228 5f64 627a 2c20 5f64  et_hvsr(_dbz, _d
-00018e90: 6231 2c20 5f64 6232 2c20 5f78 2c20 7573  b1, _db2, _x, us
-00018ea0: 655f 6d65 7468 6f64 3d34 293a 0a20 2020  e_method=4):.   
-00018eb0: 2022 2222 0a20 2020 205f 6462 7a20 3a20   """.    _dbz : 
-00018ec0: 6c69 7374 0a20 2020 2020 2020 2054 776f  list.        Two
-00018ed0: 2069 7465 6d20 6c69 7374 2077 6974 6820   item list with 
-00018ee0: 6465 6369 4265 6c20 7661 6c75 6520 6f66  deciBel value of
-00018ef0: 207a 2063 6f6d 706f 6e65 6e74 2061 7420   z component at 
-00018f00: 6569 7468 6572 2065 6e64 206f 6620 7061  either end of pa
-00018f10: 7274 6963 756c 6172 2066 7265 7175 656e  rticular frequen
-00018f20: 6379 2073 7465 700a 2020 2020 5f64 6231  cy step.    _db1
-00018f30: 203a 206c 6973 740a 2020 2020 2020 2020   : list.        
-00018f40: 5477 6f20 6974 656d 206c 6973 7420 7769  Two item list wi
-00018f50: 7468 2064 6563 6942 656c 2076 616c 7565  th deciBel value
-00018f60: 206f 6620 6569 7468 6572 2065 206f 7220   of either e or 
-00018f70: 6e20 636f 6d70 6f6e 656e 7420 2864 6f65  n component (doe
-00018f80: 7320 6e6f 7420 6d61 7474 6572 2077 6869  s not matter whi
-00018f90: 6368 2920 6174 2065 6974 6865 7220 656e  ch) at either en
-00018fa0: 6420 6f66 2070 6172 7469 6375 6c61 7220  d of particular 
-00018fb0: 6672 6571 7565 6e63 7920 7374 6570 0a20  frequency step. 
-00018fc0: 2020 205f 6462 3220 3a20 6c69 7374 0a20     _db2 : list. 
-00018fd0: 2020 2020 2020 2054 776f 2069 7465 6d20         Two item 
-00018fe0: 6c69 7374 2077 6974 6820 6465 6369 4265  list with deciBe
-00018ff0: 6c20 7661 6c75 6520 6f66 2065 6974 6865  l value of eithe
-00019000: 7220 6520 6f72 206e 2063 6f6d 706f 6e65  r e or n compone
-00019010: 6e74 2028 646f 6573 206e 6f74 206d 6174  nt (does not mat
-00019020: 7465 7220 7768 6963 6829 2061 7420 6569  ter which) at ei
-00019030: 7468 6572 2065 6e64 206f 6620 7061 7274  ther end of part
-00019040: 6963 756c 6172 2066 7265 7175 656e 6379  icular frequency
-00019050: 2073 7465 700a 2020 2020 5f78 203a 206c   step.    _x : l
-00019060: 6973 740a 2020 2020 2020 2020 5477 6f20  ist.        Two 
-00019070: 6974 656d 206c 6973 7420 636f 6e74 6169  item list contai
-00019080: 6e69 6e67 2066 7265 7175 656e 6379 2076  ning frequency v
-00019090: 616c 7565 7320 6174 2065 6974 6865 7220  alues at either 
-000190a0: 656e 6420 6f66 2066 7265 7175 656e 6379  end of frequency
-000190b0: 2073 7465 7020 6f66 2069 6e74 6572 6573   step of interes
-000190c0: 740a 2020 2020 7573 655f 6d65 7468 6f64  t.    use_method
-000190d0: 203a 2069 6e74 2c20 6465 6661 756c 7420   : int, default 
-000190e0: 3d20 340a 2020 2020 2020 2020 4820 6973  = 4.        H is
-000190f0: 2063 6f6d 7075 7465 6420 6261 7365 6420   computed based 
-00019100: 6f6e 2074 6865 2073 656c 6563 7465 6420  on the selected 
-00019110: 7573 655f 6d65 7468 6f64 2073 6565 3a20  use_method see: 
-00019120: 6874 7470 733a 2f2f 6163 6164 656d 6963  https://academic
-00019130: 2e6f 7570 2e63 6f6d 2f67 6a69 2f61 7274  .oup.com/gji/art
-00019140: 6963 6c65 2f31 3934 2f32 2f39 3336 2f35  icle/194/2/936/5
-00019150: 3937 3431 350a 2020 2020 2020 2020 2020  97415.          
-00019160: 2020 7573 655f 6d65 7468 6f64 3a0a 2020    use_method:.  
-00019170: 2020 2020 2020 2020 2020 2831 2920 4469            (1) Di
-00019180: 6666 7573 6520 4669 656c 6420 4173 7375  ffuse Field Assu
-00019190: 6d70 7469 6f6e 2028 4446 4129 0a20 2020  mption (DFA).   
-000191a0: 2020 2020 2020 2020 2028 3229 2061 7269           (2) ari
-000191b0: 7468 6d65 7469 6320 6d65 616e 2c20 7468  thmetic mean, th
-000191c0: 6174 2069 732c 2048 20e2 89a1 2028 484e  at is, H ... (HN
-000191d0: 202b 2048 4529 2f32 0a20 2020 2020 2020   + HE)/2.       
-000191e0: 2020 2020 2028 3329 2067 656f 6d65 7472       (3) geometr
-000191f0: 6963 206d 6561 6e2c 2074 6861 7420 6973  ic mean, that is
-00019200: 2c20 4820 e289 a120 e288 9a48 4e20 c2b7  , H ... ...HN ..
-00019210: 2048 452c 2072 6563 6f6d 6d65 6e64 6564   HE, recommended
-00019220: 2062 7920 7468 6520 5345 5341 4d45 2070   by the SESAME p
-00019230: 726f 6a65 6374 2028 3230 3034 290a 2020  roject (2004).  
-00019240: 2020 2020 2020 2020 2020 2834 2920 7665            (4) ve
-00019250: 6374 6f72 2073 756d 6d61 7469 6f6e 2c20  ctor summation, 
-00019260: 7468 6174 2069 732c 2048 20e2 89a1 20e2  that is, H ... .
-00019270: 889a 4832 204e 202b 2048 3220 450a 2020  ..H2 N + H2 E.  
-00019280: 2020 2020 2020 2020 2020 2835 2920 7175            (5) qu
-00019290: 6164 7261 7469 6320 6d65 616e 2c20 7468  adratic mean, th
-000192a0: 6174 2069 732c 2048 20e2 89a1 20e2 889a  at is, H ... ...
-000192b0: 2848 3220 4e20 2b20 4832 2045 2029 2f32  (H2 N + H2 E )/2
-000192c0: 0a20 2020 2020 2020 2020 2020 2028 3629  .            (6)
-000192d0: 206d 6178 696d 756d 2068 6f72 697a 6f6e   maximum horizon
-000192e0: 7461 6c20 7661 6c75 652c 2074 6861 7420  tal value, that 
-000192f0: 6973 2c20 4820 e289 a120 6d61 7820 7b48  is, H ... max {H
-00019300: 4e2c 2048 457d 0a20 2020 2020 2020 2022  N, HE}.        "
-00019310: 2222 0a0a 2020 2020 5f70 7a20 3d20 5f5f  ""..    _pz = __
-00019320: 6765 745f 706f 7765 7228 5f64 627a 2c20  get_power(_dbz, 
-00019330: 5f78 290a 2020 2020 5f70 3120 3d20 5f5f  _x).    _p1 = __
-00019340: 6765 745f 706f 7765 7228 5f64 6231 2c20  get_power(_db1, 
-00019350: 5f78 290a 2020 2020 5f70 3220 3d20 5f5f  _x).    _p2 = __
-00019360: 6765 745f 706f 7765 7228 5f64 6232 2c20  get_power(_db2, 
-00019370: 5f78 290a 2020 2020 0a20 2020 205f 687a  _x).    .    _hz
-00019380: 203d 206d 6174 682e 7371 7274 285f 707a   = math.sqrt(_pz
-00019390: 290a 2020 2020 5f68 3120 3d20 6d61 7468  ).    _h1 = math
-000193a0: 2e73 7172 7428 5f70 3129 0a20 2020 205f  .sqrt(_p1).    _
-000193b0: 6832 203d 206d 6174 682e 7371 7274 285f  h2 = math.sqrt(_
-000193c0: 7032 290a 0a20 2020 205f 6820 3d20 7b20  p2)..    _h = { 
-000193d0: 2032 3a20 285f 6831 202b 205f 6832 2920   2: (_h1 + _h2) 
-000193e0: 2f20 322e 302c 2023 4172 6974 686d 6574  / 2.0, #Arithmet
-000193f0: 6963 206d 6561 6e0a 2020 2020 2020 2020  ic mean.        
-00019400: 2020 2020 333a 206d 6174 682e 7371 7274      3: math.sqrt
-00019410: 285f 6831 202a 205f 6832 292c 2023 4765  (_h1 * _h2), #Ge
-00019420: 6f6d 6574 7269 6320 6d65 616e 0a20 2020  ometric mean.   
-00019430: 2020 2020 2020 2020 2034 3a20 6d61 7468           4: math
-00019440: 2e73 7172 7428 5f70 3120 2b20 5f70 3229  .sqrt(_p1 + _p2)
-00019450: 2c20 2356 6563 746f 7220 7375 6d6d 6174  , #Vector summat
-00019460: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00019470: 353a 206d 6174 682e 7371 7274 2828 5f70  5: math.sqrt((_p
-00019480: 3120 2b20 5f70 3229 202f 2032 2e30 292c  1 + _p2) / 2.0),
-00019490: 2023 5175 6164 7261 7469 6320 6d65 616e   #Quadratic mean
-000194a0: 0a20 2020 2020 2020 2020 2020 2036 3a20  .            6: 
-000194b0: 6d61 7828 5f68 312c 205f 6832 297d 2023  max(_h1, _h2)} #
-000194c0: 4d61 7820 686f 7269 7a6f 6e74 616c 2076  Max horizontal v
-000194d0: 616c 7565 0a20 2020 205f 6876 7372 203d  alue.    _hvsr =
-000194e0: 205f 685b 7573 655f 6d65 7468 6f64 5d20   _h[use_method] 
-000194f0: 2f20 5f68 7a0a 2020 2020 7265 7475 726e  / _hz.    return
-00019500: 205f 6876 7372 0a0a 2346 6f72 2063 6f6e   _hvsr..#For con
-00019510: 7665 7274 696e 6720 6442 2073 6361 6c65  verting dB scale
-00019520: 6420 6461 7461 2074 6f20 706f 7765 7220  d data to power 
-00019530: 756e 6974 730a 6465 6620 5f5f 6765 745f  units.def __get_
-00019540: 706f 7765 7228 5f64 622c 205f 7829 3a0a  power(_db, _x):.
-00019550: 2020 2020 2222 2243 616c 6375 6c61 7465      """Calculate
-00019560: 2048 5653 520a 0a20 2020 2023 4652 4f4d   HVSR..    #FROM
-00019570: 204f 5249 4749 4e41 4c20 2849 2074 6869   ORIGINAL (I thi
-00019580: 6e6b 2074 6869 7320 6973 206f 6e6c 7920  nk this is only 
-00019590: 7374 6570 2036 290a 2020 2020 2020 2020  step 6).        
-000195a0: 556e 646f 2064 6563 6942 656c 2063 616c  Undo deciBel cal
-000195b0: 6375 6c61 7469 6f6e 7320 6173 206f 7574  culations as out
-000195c0: 6c69 6e65 6420 6265 6c6f 773a 0a20 2020  lined below:.   
-000195d0: 2020 2020 2020 2020 2031 2e20 4469 7669           1. Divi
-000195e0: 6469 6e67 2074 6865 2077 696e 646f 7720  ding the window 
-000195f0: 696e 746f 2031 3320 7365 676d 656e 7473  into 13 segments
-00019600: 2068 6176 696e 6720 3735 2520 6f76 6572   having 75% over
-00019610: 6c61 700a 2020 2020 2020 2020 2020 2020  lap.            
-00019620: 322e 2046 6f72 2065 6163 6820 7365 676d  2. For each segm
-00019630: 656e 743a 0a20 2020 2020 2020 2020 2020  ent:.           
-00019640: 2020 2020 2032 2e31 2052 656d 6f76 696e       2.1 Removin
-00019650: 6720 7468 6520 7472 656e 6420 616e 6420  g the trend and 
-00019660: 6d65 616e 0a20 2020 2020 2020 2020 2020  mean.           
-00019670: 2020 2020 2032 2e32 2041 7070 6c79 2061       2.2 Apply a
-00019680: 2031 3025 2073 696e 6520 7461 7065 720a   10% sine taper.
-00019690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196a0: 322e 3320 4646 540a 2020 2020 2020 2020  2.3 FFT.        
-000196b0: 2020 2020 332e 2043 616c 6375 6c61 7465      3. Calculate
-000196c0: 2074 6865 206e 6f72 6d61 6c69 7a65 6420   the normalized 
-000196d0: 5053 440a 2020 2020 2020 2020 2020 2020  PSD.            
-000196e0: 342e 2041 7665 7261 6765 2074 6865 2031  4. Average the 1
-000196f0: 3320 5053 4473 2026 2073 6361 6c65 2074  3 PSDs & scale t
-00019700: 6f20 636f 6d70 656e 7361 7465 2066 6f72  o compensate for
-00019710: 2074 6170 6572 696e 670a 2020 2020 2020   tapering.      
-00019720: 2020 2020 2020 352e 2046 7265 7175 656e        5. Frequen
-00019730: 6379 2d73 6d6f 6f74 6820 7468 6520 6176  cy-smooth the av
-00019740: 6572 6167 6564 2050 5344 206f 7665 7220  eraged PSD over 
-00019750: 312d 6f63 7461 7665 2069 6e74 6572 7661  1-octave interva
-00019760: 6c73 2061 7420 312f 382d 6f63 7461 7665  ls at 1/8-octave
-00019770: 2069 6e63 7265 6d65 6e74 730a 2020 2020   increments.    
-00019780: 2020 2020 2020 2020 362e 2043 6f6e 7665          6. Conve
-00019790: 7274 2070 6f77 6572 2074 6f20 6465 6369  rt power to deci
-000197a0: 6265 6c73 0a20 2020 2023 454e 4420 4652  bels.    #END FR
-000197b0: 4f4d 204f 5249 4749 4e41 4c0a 0a20 2020  OM ORIGINAL..   
-000197c0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-000197d0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 205f  ----------.    _
-000197e0: 6462 203a 206c 6973 740a 2020 2020 2020  db : list.      
-000197f0: 2020 5477 6f2d 6974 656d 206c 6973 7420    Two-item list 
-00019800: 7769 7468 2069 6e64 6976 6964 7561 6c20  with individual 
-00019810: 706f 7765 7220 7661 6c75 6573 2069 6e20  power values in 
-00019820: 6465 6369 6265 6c73 2066 6f72 2073 7065  decibels for spe
-00019830: 6369 6669 6564 2066 7265 7120 7374 6570  cified freq step
-00019840: 2e0a 2020 2020 5f78 203a 206c 6973 740a  ..    _x : list.
-00019850: 2020 2020 2020 2020 5477 6f2d 6974 656d          Two-item
-00019860: 206c 6973 7420 7769 7468 2049 6e64 6976   list with Indiv
-00019870: 6964 7561 6c20 7820 7661 6c75 6520 2865  idual x value (e
-00019880: 6974 6865 7220 6672 6571 7565 6e63 7920  ither frequency 
-00019890: 6f72 2070 6572 696f 6429 0a20 2020 200a  or period).    .
-000198a0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-000198b0: 2d2d 2d2d 2d2d 2d0a 2020 2020 5f70 203a  -------.    _p :
-000198c0: 2066 6c6f 6174 0a20 2020 2020 2020 2049   float.        I
-000198d0: 6e64 6976 6964 7561 6c20 706f 7765 7220  ndividual power 
-000198e0: 7661 6c75 652c 2063 6f6e 7665 7274 6564  value, converted
-000198f0: 2066 726f 6d20 6465 6369 6265 6c73 0a0a   from decibels..
-00019900: 2020 2020 4e4f 5445 0a20 2020 202d 2d2d      NOTE.    ---
-00019910: 2d0a 2020 2020 2020 2020 5053 4420 6973  -.        PSD is
-00019920: 2065 7175 616c 2074 6f20 7468 6520 706f   equal to the po
-00019930: 7765 7220 6469 7669 6465 6420 6279 2074  wer divided by t
-00019940: 6865 2077 6964 7468 206f 6620 7468 6520  he width of the 
-00019950: 6269 6e0a 2020 2020 2020 2020 2020 5053  bin.          PS
-00019960: 4420 3d20 5020 2f20 570a 2020 2020 2020  D = P / W.      
-00019970: 2020 2020 6c6f 6728 5053 4429 203d 204c      log(PSD) = L
-00019980: 6f67 2850 2920 2d20 6c6f 6728 5729 0a20  og(P) - log(W). 
-00019990: 2020 2020 2020 2020 206c 6f67 2850 2920           log(P) 
-000199a0: 3d20 6c6f 6728 5053 4429 202b 206c 6f67  = log(PSD) + log
-000199b0: 2857 2920 2068 6572 6520 5720 6973 2077  (W)  here W is w
-000199c0: 6964 7468 2069 6e20 6672 6571 7565 6e63  idth in frequenc
-000199d0: 790a 2020 2020 2020 2020 2020 6c6f 6728  y.          log(
-000199e0: 5029 203d 206c 6f67 2850 5344 2920 2d20  P) = log(PSD) - 
-000199f0: 6c6f 6728 5774 2920 6865 7265 2057 7420  log(Wt) here Wt 
-00019a00: 6973 2077 6964 7468 2069 6e20 7065 7269  is width in peri
-00019a10: 6f64 0a0a 2020 2020 666f 7220 6561 6368  od..    for each
-00019a20: 2062 696e 2070 6572 666f 726d 2072 6563   bin perform rec
-00019a30: 7461 6e67 756c 6172 2069 6e74 6567 7261  tangular integra
-00019a40: 7469 6f6e 2074 6f20 636f 6d70 7574 6520  tion to compute 
-00019a50: 706f 7765 720a 2020 2020 706f 7765 7220  power.    power 
-00019a60: 6973 2061 7373 6967 6e65 6420 746f 2074  is assigned to t
-00019a70: 6865 2070 6f69 6e74 2061 7420 7468 6520  he point at the 
-00019a80: 6265 6769 6e69 6e67 206f 6620 7468 6520  begining of the 
-00019a90: 696e 7465 7276 616c 0a20 2020 2020 2020  interval.       
-00019aa0: 2020 5f20 2020 5f0a 2020 2020 2020 2020    _   _.        
-00019ab0: 7c20 7c5f 7c20 7c0a 2020 2020 2020 2020  | |_| |.        
-00019ac0: 7c5f 7c5f 7c5f 7c0a 0a20 2020 2020 4865  |_|_|_|..     He
-00019ad0: 7265 2077 6520 6172 6520 636f 6d70 7574  re we are comput
-00019ae0: 696e 6720 706f 7765 7220 666f 7220 696e  ing power for in
-00019af0: 6469 7669 6475 616c 2070 6f6e 7473 2c20  dividual ponts, 
-00019b00: 736f 2c20 6e6f 2069 6e74 6567 7261 7469  so, no integrati
-00019b10: 6f6e 2069 7320 6e65 6365 7373 6172 792c  on is necessary,
-00019b20: 206a 7573 740a 2020 2020 2063 6f6d 7075   just.     compu
-00019b30: 7465 2061 7265 612e 0a20 2020 2022 2222  te area..    """
-00019b40: 0a20 2020 205f 6478 203d 2061 6273 286e  .    _dx = abs(n
-00019b50: 702e 6469 6666 285f 7829 5b30 5d29 0a20  p.diff(_x)[0]). 
-00019b60: 2020 205f 7020 3d20 6e70 2e6d 756c 7469     _p = np.multi
-00019b70: 706c 7928 6e70 2e6d 6561 6e28 5f5f 7265  ply(np.mean(__re
-00019b80: 6d6f 7665 5f64 6228 5f64 6229 292c 205f  move_db(_db)), _
-00019b90: 6478 290a 2020 2020 7265 7475 726e 205f  dx).    return _
-00019ba0: 700a 0a23 5265 6d6f 7665 2064 6563 6962  p..#Remove decib
-00019bb0: 656c 2073 6361 6c69 6e67 0a64 6566 205f  el scaling.def _
-00019bc0: 5f72 656d 6f76 655f 6462 285f 6462 5f76  _remove_db(_db_v
-00019bd0: 616c 7565 293a 0a20 2020 2022 2222 636f  alue):.    """co
-00019be0: 6e76 6572 7420 6442 2070 6f77 6572 2074  nvert dB power t
-00019bf0: 6f20 706f 7765 7222 2222 0a20 2020 205f  o power""".    _
-00019c00: 7661 6c75 6573 203d 206c 6973 7428 290a  values = list().
-00019c10: 2020 2020 666f 7220 5f64 2069 6e20 5f64      for _d in _d
-00019c20: 625f 7661 6c75 653a 0a20 2020 2020 2020  b_value:.       
-00019c30: 205f 7661 6c75 6573 2e61 7070 656e 6428   _values.append(
-00019c40: 3130 202a 2a20 2866 6c6f 6174 285f 6429  10 ** (float(_d)
-00019c50: 202f 2031 302e 3029 290a 2020 2020 7265   / 10.0)).    re
-00019c60: 7475 726e 205f 7661 6c75 6573 0a0a 2346  turn _values..#F
-00019c70: 696e 6420 7065 616b 7320 696e 2074 6865  ind peaks in the
-00019c80: 2068 7673 7220 6363 7275 7665 0a64 6566   hvsr ccruve.def
-00019c90: 205f 5f66 696e 645f 7065 616b 7328 5f79   __find_peaks(_y
-00019ca0: 293a 0a20 2020 2022 2222 4669 6e64 7320  ):.    """Finds 
-00019cb0: 616c 6c20 706f 7373 6962 6c65 2070 6561  all possible pea
-00019cc0: 6b73 206f 6e20 6876 7372 2063 7572 7665  ks on hvsr curve
-00019cd0: 730a 2020 2020 5061 7261 6d65 7465 7273  s.    Parameters
-00019ce0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-00019cf0: 2020 2020 5f79 203a 206c 6973 7420 6f72      _y : list or
-00019d00: 2061 7272 6179 0a20 2020 2020 2020 205f   array.        _
-00019d10: 7920 696e 7075 7420 6973 206c 6973 7420  y input is list 
-00019d20: 6f72 2061 7272 6179 206f 6620 6120 6375  or array of a cu
-00019d30: 7276 652e 0a20 2020 2020 2020 2020 2049  rve..          I
-00019d40: 6e20 7468 6973 2063 6173 652c 2074 6869  n this case, thi
-00019d50: 7320 6973 2065 6974 6865 7220 6d61 696e  s is either main
-00019d60: 2068 7673 7220 6375 7276 6520 6f72 2069   hvsr curve or i
-00019d70: 6e64 6976 6964 7561 6c20 7469 6d65 2073  ndividual time s
-00019d80: 7465 7020 6375 7276 6573 0a20 2020 2022  tep curves.    "
-00019d90: 2222 0a20 2020 205f 696e 6465 785f 6c69  "".    _index_li
-00019da0: 7374 203d 2073 6369 7079 2e73 6967 6e61  st = scipy.signa
-00019db0: 6c2e 6172 6772 656c 6578 7472 656d 6128  l.argrelextrema(
-00019dc0: 6e70 2e61 7272 6179 285f 7929 2c20 6e70  np.array(_y), np
-00019dd0: 2e67 7265 6174 6572 290a 0a20 2020 2072  .greater)..    r
-00019de0: 6574 7572 6e20 5f69 6e64 6578 5f6c 6973  eturn _index_lis
-00019df0: 745b 305d 0a0a 2347 6574 2061 6464 6974  t[0]..#Get addit
-00019e00: 696f 6e61 6c20 4856 5352 2070 6172 616d  ional HVSR param
-00019e10: 7320 666f 7220 6c61 7465 7220 6361 6c63  s for later calc
-00019e20: 7561 6c74 696f 6e73 0a64 6566 205f 5f67  ualtions.def __g
-00019e30: 6574 6876 7372 7061 7261 6d73 2868 7673  ethvsrparams(hvs
-00019e40: 725f 6f75 7429 3a0a 2020 2020 2222 2250  r_out):.    """P
-00019e50: 7269 7661 7465 2066 756e 6374 696f 6e20  rivate function 
-00019e60: 746f 2067 6574 2048 5653 5220 7061 7261  to get HVSR para
-00019e70: 6d65 7465 7273 2066 6f72 206c 6174 6572  meters for later
-00019e80: 2063 616c 6375 6c61 7469 6f6e 7320 2874   calculations (t
-00019e90: 6869 6e67 7320 6c69 6b65 2073 7461 6e64  hings like stand
-00019ea0: 6172 6420 6465 7669 6174 696f 6e2c 2065  ard deviation, e
-00019eb0: 7463 2922 2222 0a0a 2020 2020 6876 7372  tc)"""..    hvsr
-00019ec0: 7032 203d 207b 7d0a 2020 2020 6876 7372  p2 = {}.    hvsr
-00019ed0: 6d32 203d 207b 7d0a 2020 2020 0a20 2020  m2 = {}.    .   
-00019ee0: 2070 6561 6b5f 7761 7465 725f 6c65 7665   peak_water_leve
-00019ef0: 6c20 3d20 5b5d 0a20 2020 2070 6561 6b5f  l = [].    peak_
-00019f00: 7761 7465 725f 6c65 7665 6c5f 703d 5b5d  water_level_p=[]
-00019f10: 0a20 2020 2068 7673 7270 323d 5b5d 0a20  .    hvsrp2=[]. 
-00019f20: 2020 2068 7673 726d 3d5b 5d0a 2020 2020     hvsrm=[].    
-00019f30: 7065 616b 5f77 6174 6572 5f6c 6576 656c  peak_water_level
-00019f40: 5f6d 3d5b 5d0a 2020 2020 7761 7465 725f  _m=[].    water_
-00019f50: 6c65 7665 6c3d 312e 3820 234d 616b 6520  level=1.8 #Make 
-00019f60: 7468 6973 2061 6e20 696e 7075 7420 7061  this an input pa
-00019f70: 7261 6d65 7465 7220 6576 656e 7475 616c  rameter eventual
-00019f80: 6c79 2121 212a 2a2a 2a0a 2020 2020 0a20  ly!!!****.    . 
-00019f90: 2020 2068 7673 725f 6c6f 675f 7374 6420     hvsr_log_std 
-00019fa0: 3d20 7b7d 0a0a 2020 2020 7065 616b 5f77  = {}..    peak_w
-00019fb0: 6174 6572 5f6c 6576 656c 2e61 7070 656e  ater_level.appen
-00019fc0: 6428 7761 7465 725f 6c65 7665 6c29 0a0a  d(water_level)..
-00019fd0: 2020 2020 6876 7372 3d68 7673 725f 6f75      hvsr=hvsr_ou
-00019fe0: 745b 2768 7673 725f 6375 7276 6527 5d0a  t['hvsr_curve'].
-00019ff0: 2020 2020 6966 2068 7673 725f 6f75 745b      if hvsr_out[
-0001a000: 2769 6e64 5f68 7673 725f 6375 7276 6573  'ind_hvsr_curves
-0001a010: 275d 2e73 6861 7065 5b30 5d20 3e20 303a  '].shape[0] > 0:
-0001a020: 0a20 2020 2020 2020 2068 7673 7270 203d  .        hvsrp =
-0001a030: 206e 702e 6164 6428 6876 7372 5f6f 7574   np.add(hvsr_out
-0001a040: 5b27 6876 7372 5f63 7572 7665 275d 2c20  ['hvsr_curve'], 
-0001a050: 6876 7372 5f6f 7574 5b27 696e 645f 6876  hvsr_out['ind_hv
-0001a060: 7372 5f73 7464 4465 7627 5d29 0a20 2020  sr_stdDev']).   
-0001a070: 2020 2020 2068 7673 726d 203d 206e 702e       hvsrm = np.
-0001a080: 7375 6274 7261 6374 2868 7673 725f 6f75  subtract(hvsr_ou
-0001a090: 745b 2768 7673 725f 6375 7276 6527 5d2c  t['hvsr_curve'],
-0001a0a0: 2068 7673 725f 6f75 745b 2769 6e64 5f68   hvsr_out['ind_h
-0001a0b0: 7673 725f 7374 6444 6576 275d 290a 0a20  vsr_stdDev']).. 
-0001a0c0: 2020 2020 2020 2068 7673 725f 6c6f 675f         hvsr_log_
-0001a0d0: 7374 6420 3d20 6e70 2e73 7464 286e 702e  std = np.std(np.
-0001a0e0: 6c6f 6731 3028 6876 7372 5f6f 7574 5b27  log10(hvsr_out['
-0001a0f0: 696e 645f 6876 7372 5f63 7572 7665 7327  ind_hvsr_curves'
-0001a100: 5d29 2c20 6178 6973 3d30 290a 2020 2020  ]), axis=0).    
-0001a110: 2020 2020 6876 7372 7032 203d 206e 702e      hvsrp2 = np.
-0001a120: 6d75 6c74 6970 6c79 2868 7673 722c 206e  multiply(hvsr, n
-0001a130: 702e 6578 7028 6876 7372 5f6c 6f67 5f73  p.exp(hvsr_log_s
-0001a140: 7464 2929 0a20 2020 2020 2020 2068 7673  td)).        hvs
-0001a150: 726d 3220 3d20 6e70 2e64 6976 6964 6528  rm2 = np.divide(
-0001a160: 6876 7372 2c20 6e70 2e65 7870 2868 7673  hvsr, np.exp(hvs
-0001a170: 725f 6c6f 675f 7374 6429 290a 0a20 2020  r_log_std))..   
-0001a180: 2020 2020 2070 6561 6b5f 7761 7465 725f       peak_water_
-0001a190: 6c65 7665 6c5f 7020 3d20 7761 7465 725f  level_p = water_
-0001a1a0: 6c65 7665 6c20 2b20 6876 7372 5f6f 7574  level + hvsr_out
-0001a1b0: 5b27 696e 645f 6876 7372 5f73 7464 4465  ['ind_hvsr_stdDe
-0001a1c0: 7627 5d0a 2020 2020 2020 2020 7065 616b  v'].        peak
-0001a1d0: 5f77 6174 6572 5f6c 6576 656c 5f6d 203d  _water_level_m =
-0001a1e0: 2077 6174 6572 5f6c 6576 656c 202d 2068   water_level - h
-0001a1f0: 7673 725f 6f75 745b 2769 6e64 5f68 7673  vsr_out['ind_hvs
-0001a200: 725f 7374 6444 6576 275d 0a0a 2020 2020  r_stdDev']..    
-0001a210: 6e65 774b 6579 7320 3d20 5b27 6876 7372  newKeys = ['hvsr
-0001a220: 5f6c 6f67 5f73 7464 272c 2027 7065 616b  _log_std', 'peak
-0001a230: 5f77 6174 6572 5f6c 6576 656c 272c 2027  _water_level', '
-0001a240: 7065 616b 5f77 6174 6572 5f6c 6576 656c  peak_water_level
-0001a250: 5f70 272c 2027 7065 616b 5f77 6174 6572  _p', 'peak_water
-0001a260: 5f6c 6576 656c 5f6d 272c 2768 7673 7270  _level_m','hvsrp
-0001a270: 272c 2768 7673 726d 272c 2027 6876 7372  ','hvsrm', 'hvsr
-0001a280: 7032 272c 2768 7673 726d 3227 5d0a 2020  p2','hvsrm2'].  
-0001a290: 2020 6e65 7756 616c 7320 3d20 5b68 7673    newVals = [hvs
-0001a2a0: 725f 6c6f 675f 7374 642c 2020 2020 7065  r_log_std,    pe
-0001a2b0: 616b 5f77 6174 6572 5f6c 6576 656c 2c20  ak_water_level, 
-0001a2c0: 2020 7065 616b 5f77 6174 6572 5f6c 6576    peak_water_lev
-0001a2d0: 656c 5f70 2c20 2020 7065 616b 5f77 6174  el_p,   peak_wat
-0001a2e0: 6572 5f6c 6576 656c 5f6d 2c20 2068 7673  er_level_m,  hvs
-0001a2f0: 7270 2c20 2068 7673 726d 2c20 2020 6876  rp,  hvsrm,   hv
-0001a300: 7372 7032 2c20 2068 7673 726d 325d 0a20  srp2,  hvsrm2]. 
-0001a310: 2020 2066 6f72 2069 2c20 6e6b 2069 6e20     for i, nk in 
-0001a320: 656e 756d 6572 6174 6528 6e65 774b 6579  enumerate(newKey
-0001a330: 7329 3a0a 2020 2020 2020 2020 6876 7372  s):.        hvsr
-0001a340: 5f6f 7574 5b6e 6b5d 203d 206e 702e 6172  _out[nk] = np.ar
-0001a350: 7261 7928 6e65 7756 616c 735b 695d 290a  ray(newVals[i]).
-0001a360: 0a20 2020 2072 6574 7572 6e20 6876 7372  .    return hvsr
-0001a370: 5f6f 7574 0a0a 2350 6c6f 7420 4f62 7370  _out..#Plot Obsp
-0001a380: 7920 5472 6163 6520 696e 2061 7869 7320  y Trace in axis 
-0001a390: 7573 696e 6720 6d61 7470 6c6f 746c 6962  using matplotlib
-0001a3a0: 0a64 6566 2070 6c6f 745f 7374 7265 616d  .def plot_stream
-0001a3b0: 2873 7472 6561 6d2c 2070 6172 616d 732c  (stream, params,
-0001a3c0: 2066 6967 3d4e 6f6e 652c 2061 7865 733d   fig=None, axes=
-0001a3d0: 4e6f 6e65 2c20 7265 7475 726e 5f66 6967  None, return_fig
-0001a3e0: 3d54 7275 6529 3a0a 2020 2020 6966 2066  =True):.    if f
-0001a3f0: 6967 2069 7320 4e6f 6e65 2061 6e64 2061  ig is None and a
-0001a400: 7820 6973 204e 6f6e 653a 0a20 2020 2020  x is None:.     
-0001a410: 2020 2066 6967 2c20 6178 6573 203d 2070     fig, axes = p
-0001a420: 6c74 2e73 7562 706c 6f74 5f6d 6f73 6169  lt.subplot_mosai
-0001a430: 6328 5b5b 275a 275d 2c5b 274e 275d 2c5b  c([['Z'],['N'],[
-0001a440: 2745 275d 5d2c 2073 6861 7265 783d 5472  'E']], sharex=Tr
-0001a450: 7565 2c20 7368 6172 6579 3d46 616c 7365  ue, sharey=False
-0001a460: 290a 2020 2020 0a20 2020 206e 6577 5f73  ).    .    new_s
-0001a470: 7472 6561 6d20 3d20 7374 7265 616d 2e63  tream = stream.c
-0001a480: 6f70 7928 290a 2020 2020 2361 7869 732e  opy().    #axis.
-0001a490: 706c 6f74 2874 7261 6365 2e74 696d 6573  plot(trace.times
-0001a4a0: 2c20 7472 6163 652e 6461 7461 290a 2020  , trace.data).  
-0001a4b0: 2020 0a20 2020 2073 5469 6d65 203d 2073    .    sTime = s
-0001a4c0: 7472 6561 6d5b 305d 2e73 7461 7473 2e73  tream[0].stats.s
-0001a4d0: 7461 7274 7469 6d65 0a20 2020 2074 696d  tarttime.    tim
-0001a4e0: 654c 6973 7420 3d20 7b7d 0a20 2020 206d  eList = {}.    m
-0001a4f0: 706c 5469 6d65 7320 3d20 7b7d 0a0a 2020  plTimes = {}..  
-0001a500: 2020 6e65 775f 7374 7265 616d 2e64 6563    new_stream.dec
-0001a510: 696d 6174 6528 3130 290a 2020 2020 7a74  imate(10).    zt
-0001a520: 7261 6365 203d 206e 6577 5f73 7472 6561  race = new_strea
-0001a530: 6d2e 7365 6c65 6374 2863 6f6d 706f 6e65  m.select(compone
-0001a540: 6e74 3d27 5a27 295b 305d 0a20 2020 2065  nt='Z')[0].    e
-0001a550: 7472 6163 6520 3d20 6e65 775f 7374 7265  trace = new_stre
-0001a560: 616d 2e73 656c 6563 7428 636f 6d70 6f6e  am.select(compon
-0001a570: 656e 743d 2745 2729 5b30 5d0a 2020 2020  ent='E')[0].    
-0001a580: 6e74 7261 6365 203d 206e 6577 5f73 7472  ntrace = new_str
-0001a590: 6561 6d2e 7365 6c65 6374 2863 6f6d 706f  eam.select(compo
-0001a5a0: 6e65 6e74 3d27 4e27 295b 305d 0a20 2020  nent='N')[0].   
-0001a5b0: 2074 7261 6365 7320 3d20 5b7a 7472 6163   traces = [ztrac
-0001a5c0: 652c 2065 7472 6163 652c 206e 7472 6163  e, etrace, ntrac
-0001a5d0: 655d 0a20 2020 2066 6f72 2074 7220 696e  e].    for tr in
-0001a5e0: 2074 7261 6365 733a 0a20 2020 2020 2020   traces:.       
-0001a5f0: 206b 6579 203d 2074 722e 7374 6174 732e   key = tr.stats.
-0001a600: 636f 6d70 6f6e 656e 740a 2020 2020 2020  component.      
-0001a610: 2020 7469 6d65 4c69 7374 5b6b 6579 5d20    timeList[key] 
-0001a620: 3d20 5b5d 0a20 2020 2020 2020 206d 706c  = [].        mpl
-0001a630: 5469 6d65 735b 6b65 795d 203d 205b 5d0a  Times[key] = [].
-0001a640: 2020 2020 2020 2020 666f 7220 7420 696e          for t in
-0001a650: 2074 722e 7469 6d65 7328 293a 0a20 2020   tr.times():.   
-0001a660: 2020 2020 2020 2020 2074 203d 2073 5469           t = sTi
-0001a670: 6d65 202b 2074 0a20 2020 2020 2020 2020  me + t.         
-0001a680: 2020 2074 696d 654c 6973 745b 6b65 795d     timeList[key]
-0001a690: 2e61 7070 656e 6428 7429 0a20 2020 2020  .append(t).     
-0001a6a0: 2020 2020 2020 206d 706c 5469 6d65 735b         mplTimes[
-0001a6b0: 6b65 795d 2e61 7070 656e 6428 742e 6d61  key].append(t.ma
-0001a6c0: 7470 6c6f 746c 6962 5f64 6174 6529 0a20  tplotlib_date). 
-0001a6d0: 2020 2066 6f72 2069 2c20 6b20 696e 2065     for i, k in e
-0001a6e0: 6e75 6d65 7261 7465 286d 706c 5469 6d65  numerate(mplTime
-0001a6f0: 732e 6b65 7973 2829 293a 0a20 2020 2020  s.keys()):.     
-0001a700: 2020 2069 6620 6920 3d3d 2030 3a0a 2020     if i == 0:.  
-0001a710: 2020 2020 2020 2020 2020 786d 696e 203d            xmin =
-0001a720: 206e 702e 6d69 6e28 6d70 6c54 696d 6573   np.min(mplTimes
-0001a730: 5b6b 5d29 0a20 2020 2020 2020 2020 2020  [k]).           
-0001a740: 2078 6d61 7820 3d20 6e70 2e6d 6178 286d   xmax = np.max(m
-0001a750: 706c 5469 6d65 735b 6b5d 290a 2020 2020  plTimes[k]).    
-0001a760: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001a770: 2020 2020 2020 6966 2078 6d69 6e20 3e20        if xmin > 
-0001a780: 6e70 2e6d 696e 286d 706c 5469 6d65 735b  np.min(mplTimes[
-0001a790: 6b5d 293a 0a20 2020 2020 2020 2020 2020  k]):.           
-0001a7a0: 2020 2020 2078 6d69 6e20 3d20 6e70 2e6d       xmin = np.m
-0001a7b0: 696e 286d 706c 5469 6d65 735b 6b5d 290a  in(mplTimes[k]).
-0001a7c0: 2020 2020 2020 2020 2020 2020 6966 2078              if x
-0001a7d0: 6d61 7820 3c20 6e70 2e6d 6178 286d 706c  max < np.max(mpl
-0001a7e0: 5469 6d65 735b 6b5d 293a 0a20 2020 2020  Times[k]):.     
-0001a7f0: 2020 2020 2020 2020 2020 2078 6d61 7820             xmax 
-0001a800: 3d20 6e70 2e6d 6178 286d 706c 5469 6d65  = np.max(mplTime
-0001a810: 735b 6b5d 2920 0a0a 2020 2020 6178 6573  s[k]) ..    axes
-0001a820: 5b27 5a27 5d2e 7861 7869 735f 6461 7465  ['Z'].xaxis_date
-0001a830: 2829 0a20 2020 2061 7865 735b 274e 275d  ().    axes['N']
-0001a840: 2e78 6178 6973 5f64 6174 6528 290a 2020  .xaxis_date().  
-0001a850: 2020 6178 6573 5b27 4527 5d2e 7861 7869    axes['E'].xaxi
-0001a860: 735f 6461 7465 2829 0a0a 2020 2020 2374  s_date()..    #t
-0001a870: 5469 636b 7320 3d20 6d64 6174 6573 2e4d  Ticks = mdates.M
-0001a880: 696e 7574 654c 6f63 6174 6f72 2869 6e74  inuteLocator(int
-0001a890: 6572 7661 6c3d 3529 0a20 2020 2023 6178  erval=5).    #ax
-0001a8a0: 6973 2e78 6178 6973 2e73 6574 5f6d 616a  is.xaxis.set_maj
-0001a8b0: 6f72 5f6c 6f63 6174 6f72 2874 5469 636b  or_locator(tTick
-0001a8c0: 7329 0a20 2020 2061 7865 735b 2745 275d  s).    axes['E']
-0001a8d0: 2e78 6178 6973 2e73 6574 5f6d 616a 6f72  .xaxis.set_major
-0001a8e0: 5f6c 6f63 6174 6f72 286d 6461 7465 732e  _locator(mdates.
-0001a8f0: 4d69 6e75 7465 4c6f 6361 746f 7228 6279  MinuteLocator(by
-0001a900: 6d69 6e75 7465 3d72 616e 6765 2830 2c36  minute=range(0,6
-0001a910: 302c 3529 2929 0a20 2020 2061 7865 735b  0,5))).    axes[
-0001a920: 2745 275d 2e78 6178 6973 2e73 6574 5f6d  'E'].xaxis.set_m
-0001a930: 616a 6f72 5f66 6f72 6d61 7474 6572 286d  ajor_formatter(m
-0001a940: 6461 7465 732e 4461 7465 466f 726d 6174  dates.DateFormat
-0001a950: 7465 7228 2725 483a 254d 2729 290a 2020  ter('%H:%M')).  
-0001a960: 2020 6178 6573 5b22 4522 5d2e 7861 7869    axes["E"].xaxi
-0001a970: 732e 7365 745f 6d69 6e6f 725f 6c6f 6361  s.set_minor_loca
-0001a980: 746f 7228 6d64 6174 6573 2e4d 696e 7574  tor(mdates.Minut
-0001a990: 654c 6f63 6174 6f72 2869 6e74 6572 7661  eLocator(interva
-0001a9a0: 6c3d 3129 290a 2020 2020 6178 6573 5b22  l=1)).    axes["
-0001a9b0: 4522 5d2e 7469 636b 5f70 6172 616d 7328  E"].tick_params(
-0001a9c0: 6178 6973 3d27 7827 2c20 6c61 6265 6c73  axis='x', labels
-0001a9d0: 697a 653d 3829 0a20 2020 200a 2020 2020  ize=8).    .    
-0001a9e0: 6178 6573 5b27 5a27 5d2e 706c 6f74 286d  axes['Z'].plot(m
-0001a9f0: 706c 5469 6d65 735b 275a 275d 2c20 7a74  plTimes['Z'], zt
-0001aa00: 7261 6365 2e64 6174 612c 2063 6f6c 6f72  race.data, color
-0001aa10: 3d27 6b27 2c20 6c69 6e65 7769 6474 683d  ='k', linewidth=
-0001aa20: 302e 3135 290a 2020 2020 6178 6573 5b27  0.15).    axes['
-0001aa30: 4e27 5d2e 706c 6f74 286d 706c 5469 6d65  N'].plot(mplTime
-0001aa40: 735b 274e 275d 2c20 6e74 7261 6365 2e64  s['N'], ntrace.d
-0001aa50: 6174 612c 2063 6f6c 6f72 3d27 6227 2c20  ata, color='b', 
-0001aa60: 6c69 6e65 7769 6474 683d 302e 3135 290a  linewidth=0.15).
-0001aa70: 2020 2020 6178 6573 5b27 4527 5d2e 706c      axes['E'].pl
-0001aa80: 6f74 286d 706c 5469 6d65 735b 2745 275d  ot(mplTimes['E']
-0001aa90: 2c20 6574 7261 6365 2e64 6174 612c 2063  , etrace.data, c
-0001aaa0: 6f6c 6f72 3d27 7227 2c20 6c69 6e65 7769  olor='r', linewi
-0001aab0: 6474 683d 302e 3135 290a 0a20 2020 2061  dth=0.15)..    a
-0001aac0: 7865 735b 275a 275d 2e73 6574 5f79 6c61  xes['Z'].set_yla
-0001aad0: 6265 6c28 275a 2729 0a20 2020 2061 7865  bel('Z').    axe
-0001aae0: 735b 274e 275d 2e73 6574 5f79 6c61 6265  s['N'].set_ylabe
-0001aaf0: 6c28 274e 2729 0a20 2020 2061 7865 735b  l('N').    axes[
-0001ab00: 2745 275d 2e73 6574 5f79 6c61 6265 6c28  'E'].set_ylabel(
-0001ab10: 2745 2729 0a20 2020 200a 2020 2020 2373  'E').    .    #s
-0001ab20: 7444 7a20 3d20 6e70 2e61 6273 286e 702e  tDz = np.abs(np.
-0001ab30: 6e61 6e73 7464 2873 7472 6561 6d2e 7365  nanstd(stream.se
-0001ab40: 6c65 6374 2863 6f6d 706f 6e65 6e74 3d27  lect(component='
-0001ab50: 5a27 295b 305d 2e64 6174 6129 290a 2020  Z')[0].data)).  
-0001ab60: 2020 2373 7444 6e20 3d20 6e70 2e61 6273    #stDn = np.abs
-0001ab70: 286e 702e 6e61 6e73 7464 2873 7472 6561  (np.nanstd(strea
-0001ab80: 6d2e 7365 6c65 6374 2863 6f6d 706f 6e65  m.select(compone
-0001ab90: 6e74 3d27 4e27 295b 305d 2e64 6174 6129  nt='N')[0].data)
-0001aba0: 290a 2020 2020 2373 7444 6520 3d20 6e70  ).    #stDe = np
-0001abb0: 2e61 6273 286e 702e 6e61 6e73 7464 2873  .abs(np.nanstd(s
-0001abc0: 7472 6561 6d2e 7365 6c65 6374 2863 6f6d  tream.select(com
-0001abd0: 706f 6e65 6e74 3d27 4527 295b 305d 2e64  ponent='E')[0].d
-0001abe0: 6174 6129 290a 2020 2020 2373 7444 203d  ata)).    #stD =
-0001abf0: 206d 6178 285b 7374 447a 2c20 7374 446e   max([stDz, stDn
-0001ac00: 2c20 7374 4465 5d29 0a20 2020 200a 2020  , stDe]).    .  
-0001ac10: 2020 666f 7220 692c 2063 6f6d 7020 696e    for i, comp in
-0001ac20: 2065 6e75 6d65 7261 7465 286c 6973 7428   enumerate(list(
-0001ac30: 6d70 6c54 696d 6573 2e6b 6579 7328 2929  mplTimes.keys())
-0001ac40: 293a 0a20 2020 2020 2020 2073 7444 203d  ):.        stD =
-0001ac50: 206e 702e 6162 7328 6e70 2e6e 616e 7374   np.abs(np.nanst
-0001ac60: 6428 7374 7265 616d 2e73 656c 6563 7428  d(stream.select(
-0001ac70: 636f 6d70 6f6e 656e 743d 636f 6d70 295b  component=comp)[
-0001ac80: 305d 2e64 6174 6129 290a 2020 2020 2020  0].data)).      
-0001ac90: 2020 646d 6564 203d 206e 702e 6e61 6e6d    dmed = np.nanm
-0001aca0: 6564 6961 6e28 7374 7265 616d 2e73 656c  edian(stream.sel
-0001acb0: 6563 7428 636f 6d70 6f6e 656e 743d 636f  ect(component=co
-0001acc0: 6d70 295b 305d 2e64 6174 6129 0a0a 2020  mp)[0].data)..  
-0001acd0: 2020 2020 2020 6178 6573 5b63 6f6d 705d        axes[comp]
-0001ace0: 2e73 6574 5f79 6c69 6d28 5b64 6d65 642d  .set_ylim([dmed-
-0001acf0: 302e 3735 2a73 7444 2c20 646d 6564 2b30  0.75*stD, dmed+0
-0001ad00: 2e37 352a 7374 445d 290a 2020 2020 2020  .75*stD]).      
-0001ad10: 2020 6178 6573 5b63 6f6d 705d 2e73 6574    axes[comp].set
-0001ad20: 5f78 6c69 6d28 5b78 6d69 6e2c 2078 6d61  _xlim([xmin, xma
-0001ad30: 785d 290a 0a20 2020 2066 6967 2e73 7570  x])..    fig.sup
-0001ad40: 7469 746c 6528 7061 7261 6d73 5b27 7369  title(params['si
-0001ad50: 7465 275d 290a 2020 2020 0a20 2020 2064  te']).    .    d
-0001ad60: 6179 203d 2022 7b7d 2d7b 7d2d 7b7d 222e  ay = "{}-{}-{}".
-0001ad70: 666f 726d 6174 2873 7472 6561 6d5b 305d  format(stream[0]
-0001ad80: 2e73 7461 7473 2e73 7461 7274 7469 6d65  .stats.starttime
-0001ad90: 2e79 6561 722c 2073 7472 6561 6d5b 305d  .year, stream[0]
-0001ada0: 2e73 7461 7473 2e73 7461 7274 7469 6d65  .stats.starttime
-0001adb0: 2e6d 6f6e 7468 2c20 7374 7265 616d 5b30  .month, stream[0
-0001adc0: 5d2e 7374 6174 732e 7374 6172 7474 696d  ].stats.starttim
-0001add0: 652e 6461 7929 0a20 2020 2061 7865 735b  e.day).    axes[
-0001ade0: 2745 275d 2e73 6574 5f78 6c61 6265 6c28  'E'].set_xlabel(
-0001adf0: 2755 5443 2054 696d 6520 5c6e 272b 6461  'UTC Time \n'+da
-0001ae00: 7929 0a0a 2020 2020 2370 6c74 2e72 6350  y)..    #plt.rcP
-0001ae10: 6172 616d 735b 2766 6967 7572 652e 6470  arams['figure.dp
-0001ae20: 6927 5d20 3d20 3130 300a 2020 2020 2370  i'] = 100.    #p
-0001ae30: 6c74 2e72 6350 6172 616d 735b 2766 6967  lt.rcParams['fig
-0001ae40: 7572 652e 6669 6773 697a 6527 5d20 3d20  ure.figsize'] = 
-0001ae50: 2835 2c34 290a 2020 2020 0a20 2020 2066  (5,4).    .    f
-0001ae60: 6967 2e74 6967 6874 5f6c 6179 6f75 7428  ig.tight_layout(
-0001ae70: 290a 0a20 2020 2069 6620 7265 7475 726e  )..    if return
-0001ae80: 5f66 6967 3a0a 2020 2020 2020 2020 7265  _fig:.        re
-0001ae90: 7475 726e 2066 6967 2c20 6178 6573 0a20  turn fig, axes. 
-0001aea0: 2020 2066 6967 2e63 616e 7661 732e 6472     fig.canvas.dr
-0001aeb0: 6177 2829 0a20 2020 2072 6574 7572 6e20  aw().    return 
-0001aec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aed0: 0a0a 6465 6620 6876 706c 6f74 2868 7673  ..def hvplot(hvs
-0001aee0: 725f 6469 6374 2c20 6b69 6e64 3d27 4856  r_dict, kind='HV
-0001aef0: 5352 272c 2075 7365 5f73 7562 706c 6f74  SR', use_subplot
-0001af00: 733d 5472 7565 2c20 7874 7970 653d 2766  s=True, xtype='f
-0001af10: 7265 7127 2c20 6669 673d 4e6f 6e65 2c20  req', fig=None, 
-0001af20: 6178 3d4e 6f6e 652c 2072 6574 7572 6e5f  ax=None, return_
-0001af30: 6669 673d 4661 6c73 652c 2020 7361 7665  fig=False,  save
-0001af40: 5f64 6972 3d4e 6f6e 652c 2073 6176 655f  _dir=None, save_
-0001af50: 7375 6666 6978 3d27 272c 2073 686f 773d  suffix='', show=
-0001af60: 5472 7565 2c2a 2a6b 7761 7267 7329 3a0a  True,**kwargs):.
-0001af70: 2020 2020 2222 2246 756e 6374 696f 6e20      """Function 
-0001af80: 746f 2070 6c6f 7420 4856 5352 2064 6174  to plot HVSR dat
-0001af90: 610a 0a20 2020 2050 6172 616d 6574 6572  a..    Parameter
-0001afa0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-0001afb0: 0a20 2020 2068 7673 725f 6469 6374 203a  .    hvsr_dict :
-0001afc0: 2064 6963 7420 2020 2020 2020 2020 2020   dict           
-0001afd0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0001afe0: 4469 6374 696f 6e61 7279 2063 6f6e 7461  Dictionary conta
-0001aff0: 696e 696e 6720 6f75 7470 7574 2066 726f  ining output fro
-0001b000: 6d20 7072 6f63 6573 735f 6876 7372 2066  m process_hvsr f
-0001b010: 756e 6374 696f 6e0a 2020 2020 6b69 6e64  unction.    kind
-0001b020: 203a 2073 7472 3d27 4856 5352 2720 6f72   : str='HVSR' or
-0001b030: 206c 6973 7420 2020 200a 2020 2020 2020   list    .      
-0001b040: 2020 5468 6520 6b69 6e64 206f 6620 706c    The kind of pl
-0001b050: 6f74 2873 2920 746f 2070 6c6f 742e 2049  ot(s) to plot. I
-0001b060: 6620 6c69 7374 2c20 7769 6c6c 2070 6c6f  f list, will plo
-0001b070: 7420 616c 6c20 706c 6f74 7320 6c69 7374  t all plots list
-0001b080: 6564 0a20 2020 2020 2020 2027 4856 5352  ed.        'HVSR
-0001b090: 2720 3a20 5374 616e 6461 7264 2048 5653  ' : Standard HVS
-0001b0a0: 5220 706c 6f74 2c20 696e 636c 7564 696e  R plot, includin
-0001b0b0: 6720 7374 616e 6461 7264 2064 6576 6961  g standard devia
-0001b0c0: 7469 6f6e 0a20 2020 2020 2020 202d 2027  tion.        - '
-0001b0d0: 5b48 5653 525d 2070 2720 3a20 4856 5352  [HVSR] p' : HVSR
-0001b0e0: 2070 6c6f 7420 7769 7468 2062 6573 7420   plot with best 
-0001b0f0: 7065 616b 7320 7368 6f77 6e0a 2020 2020  peaks shown.    
-0001b100: 2020 2020 2d20 275b 4856 5352 5d20 7027      - '[HVSR] p'
-0001b110: 203a 2048 5653 5220 706c 6f74 2077 6974   : HVSR plot wit
-0001b120: 6820 6265 7374 2070 6963 6b65 6420 7065  h best picked pe
-0001b130: 616b 2073 686f 776e 2020 2020 2020 2020  ak shown        
-0001b140: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0001b150: 202d 2027 5b48 5653 525d 2070 2a20 616c   - '[HVSR] p* al
-0001b160: 6c27 203a 2048 5653 5220 706c 6f74 2077  l' : HVSR plot w
-0001b170: 6974 6820 616c 6c20 7069 636b 6564 2070  ith all picked p
-0001b180: 6561 6b73 2073 686f 776e 2020 2020 2020  eaks shown      
-0001b190: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0001b1a0: 2020 202d 2027 5b48 5653 525d 2070 2a20     - '[HVSR] p* 
-0001b1b0: 7427 203a 2048 5653 5220 706c 6f74 2077  t' : HVSR plot w
-0001b1c0: 6974 6820 7065 616b 7320 6672 6f6d 2061  ith peaks from a
-0001b1d0: 6c6c 2074 696d 6520 7374 6570 7320 696e  ll time steps in
-0001b1e0: 2062 6163 6b67 726f 756e 6420 2020 2020   background     
-0001b1f0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0001b200: 2020 2020 2d20 275b 4856 5352 2070 2a20      - '[HVSR p* 
-0001b210: 616e 6e5d 203a 2041 6e6e 6f74 6174 6573  ann] : Annotates
-0001b220: 2070 6c6f 7420 7769 7468 2070 6561 6b73   plot with peaks
-0001b230: 0a20 2020 2020 2020 202d 2027 5b48 5653  .        - '[HVS
-0001b240: 525d 202d 7327 203a 2048 5653 5220 706c  R] -s' : HVSR pl
-0001b250: 6f74 7320 646f 6e27 7420 7368 6f77 2073  ots don't show s
-0001b260: 7461 6e64 6172 6420 6465 7669 6174 696f  tandard deviatio
-0001b270: 6e0a 2020 2020 2020 2020 2d20 275b 4856  n.        - '[HV
-0001b280: 5352 5d20 7427 203a 2048 5653 5220 706c  SR] t' : HVSR pl
-0001b290: 6f74 2077 6974 6820 696e 6469 7669 6475  ot with individu
-0001b2a0: 616c 2068 7620 6375 7276 6573 2066 6f72  al hv curves for
-0001b2b0: 2065 6163 6820 7469 6d65 2073 7465 7020   each time step 
-0001b2c0: 7368 6f77 6e0a 2020 2020 2020 2020 2d20  shown.        - 
-0001b2d0: 275b 4856 5352 5d20 6327 203a 2048 5653  '[HVSR] c' : HVS
-0001b2e0: 5220 706c 6f74 2077 6974 6820 6561 6368  R plot with each
-0001b2f0: 2063 6f6d 706f 6e65 6e74 7327 2073 7065   components' spe
-0001b300: 6374 7261 2e20 5265 636f 6d6d 656e 6465  ctra. Recommende
-0001b310: 6420 746f 2064 6f20 7468 6973 206c 6173  d to do this las
-0001b320: 7420 286f 7220 6a75 7374 2062 6566 6f72  t (or just befor
-0001b330: 6520 2773 7065 6367 7261 6d27 292c 2073  e 'specgram'), s
-0001b340: 696e 6365 2064 6f69 6e67 2063 2b20 6361  ince doing c+ ca
-0001b350: 6e20 6d61 6b65 2074 6865 2063 6f6d 706f  n make the compo
-0001b360: 6e65 6e74 2063 6861 7274 2069 7473 206f  nent chart its o
-0001b370: 776e 2063 6861 7274 0a20 2020 2020 2020  wn chart.       
-0001b380: 2027 5370 6563 6772 616d 2720 3a20 436f   'Specgram' : Co
-0001b390: 6d62 696e 6564 2073 7065 6374 726f 6772  mbined spectrogr
-0001b3a0: 616d 206f 6620 616c 6c20 636f 6d70 6f6e  am of all compon
-0001b3b0: 656e 7473 0a20 2020 2020 2020 202d 2027  ents.        - '
-0001b3c0: 5b73 7065 635d 2720 3a20 6261 7369 6320  [spec]' : basic 
-0001b3d0: 7370 6563 7472 6f67 7261 6d20 706c 6f74  spectrogram plot
-0001b3e0: 206f 6620 482f 5620 6375 7276 650a 2020   of H/V curve.  
-0001b3f0: 2020 7573 655f 7375 6270 6c6f 7473 203a    use_subplots :
-0001b400: 2062 6f6f 6c2c 2064 6566 6175 6c74 203d   bool, default =
-0001b410: 2054 7275 650a 2020 2020 2020 2020 5768   True.        Wh
-0001b420: 6574 6865 7220 746f 206f 7574 7075 7420  ether to output 
-0001b430: 7468 6520 706c 6f74 7320 6173 2073 7562  the plots as sub
-0001b440: 706c 6f74 7320 2854 7275 6529 206f 7220  plots (True) or 
-0001b450: 6173 2073 6570 6172 6174 6520 706c 6f74  as separate plot
-0001b460: 7320 2846 616c 7365 290a 2020 2020 7874  s (False).    xt
-0001b470: 7970 6520 3a20 7374 722c 2064 6566 6175  ype : str, defau
-0001b480: 6c74 203d 2027 6672 6571 2720 2020 200a  lt = 'freq'    .
-0001b490: 2020 2020 2020 2020 5374 7269 6e67 2066          String f
-0001b4a0: 6f72 2077 6861 7420 746f 2075 7365 2c20  or what to use, 
-0001b4b0: 6265 7477 6565 6e20 6672 6571 7565 6e63  between frequenc
-0001b4c0: 7920 6f72 2070 6572 696f 640a 2020 2020  y or period.    
-0001b4d0: 2020 2020 2020 2020 466f 7220 6672 6571          For freq
-0001b4e0: 7565 6e63 792c 2074 6865 2066 6f6c 6c6f  uency, the follo
-0001b4f0: 7769 6e67 2061 7265 2061 6363 6570 7465  wing are accepte
-0001b500: 6420 2863 6173 6520 646f 6573 206e 6f74  d (case does not
-0001b510: 206d 6174 7465 7229 3a20 2766 272c 2027   matter): 'f', '
-0001b520: 487a 272c 2027 6672 6571 272c 2027 6672  Hz', 'freq', 'fr
-0001b530: 6571 7565 6e63 7927 0a20 2020 2020 2020  equency'.       
-0001b540: 2020 2020 2046 6f72 2070 6572 696f 642c       For period,
-0001b550: 2074 6865 2066 6f6c 6c6f 7769 6e67 2061   the following a
-0001b560: 7265 2061 6363 6570 7465 6420 2863 6173  re accepted (cas
-0001b570: 6520 646f 6573 206e 6f74 206d 6174 7465  e does not matte
-0001b580: 7229 3a20 2770 272c 2027 5427 2c20 2773  r): 'p', 'T', 's
-0001b590: 272c 2027 7365 6327 2c20 2773 6563 6f6e  ', 'sec', 'secon
-0001b5a0: 6427 2c20 2770 6572 272c 2027 7065 7269  d', 'per', 'peri
-0001b5b0: 6f64 270a 2020 2020 7265 7475 726e 5f66  od'.    return_f
-0001b5c0: 6967 2020 203a 2062 6f6f 6c0a 2020 2020  ig   : bool.    
-0001b5d0: 2020 2020 5768 6574 6865 7220 746f 2072      Whether to r
-0001b5e0: 6574 7572 6e20 6669 6775 7265 2061 6e64  eturn figure and
-0001b5f0: 2061 7869 7320 6f62 6a65 6374 730a 2020   axis objects.  
-0001b600: 2020 7361 7665 5f64 6972 2020 2020 203a    save_dir     :
-0001b610: 2073 7472 206f 7220 4e6f 6e65 0a20 2020   str or None.   
-0001b620: 2020 2020 2044 6972 6563 746f 7279 2069       Directory i
-0001b630: 6e20 7768 6963 6820 746f 2073 6176 6520  n which to save 
-0001b640: 6669 6775 7265 730a 2020 2020 7361 7665  figures.    save
-0001b650: 5f73 7566 6669 7820 203a 2073 7472 0a20  _suffix  : str. 
-0001b660: 2020 2020 2020 2053 7566 6669 7820 746f         Suffix to
-0001b670: 2061 6464 2074 6f20 656e 6420 6f66 2066   add to end of f
-0001b680: 6967 7572 6520 6669 6c65 6e61 6d65 2873  igure filename(s
-0001b690: 292c 2069 6620 7361 7665 5f64 6972 2069  ), if save_dir i
-0001b6a0: 7320 7573 6564 0a20 2020 2073 686f 7720  s used.    show 
-0001b6b0: 2020 203a 2062 6f6f 6c0a 2020 2020 2020     : bool.      
-0001b6c0: 2020 5768 6574 6865 7220 746f 2073 686f    Whether to sho
-0001b6d0: 7720 706c 6f74 0a20 2020 202a 2a6b 7761  w plot.    **kwa
-0001b6e0: 7267 7320 2020 203a 206b 6579 776f 7264  rgs    : keyword
-0001b6f0: 2061 7267 756d 656e 7473 0a20 2020 2020   arguments.     
-0001b700: 2020 204b 6579 776f 7264 2061 7267 756d     Keyword argum
-0001b710: 656e 7473 2066 6f72 206d 6174 706c 6f74  ents for matplot
-0001b720: 6c69 622e 7079 706c 6f74 0a0a 2020 2020  lib.pyplot..    
-0001b730: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-0001b740: 2d2d 2d0a 2020 2020 6669 672c 2061 7820  ---.    fig, ax 
-0001b750: 3a20 6d61 7470 6c6f 746c 6962 2066 6967  : matplotlib fig
-0001b760: 7572 6520 616e 6420 6178 6973 206f 626a  ure and axis obj
-0001b770: 6563 7473 0a20 2020 2020 2020 2052 6574  ects.        Ret
-0001b780: 7572 6e73 2066 6967 7572 6520 616e 6420  urns figure and 
-0001b790: 6178 6973 206d 6174 706c 6f74 6c69 622e  axis matplotlib.
-0001b7a0: 7079 706c 6f74 206f 626a 6563 7473 2069  pyplot objects i
-0001b7b0: 6620 7265 7475 726e 5f66 6967 3d54 7275  f return_fig=Tru
-0001b7c0: 652c 206f 7468 6572 7769 7365 2c20 7369  e, otherwise, si
-0001b7d0: 6d70 6c79 2070 6c6f 7473 2074 6865 2066  mply plots the f
-0001b7e0: 6967 7572 6573 0a20 2020 2022 2222 0a0a  igures.    """..
-0001b7f0: 2020 2020 636f 6d70 4c69 7374 203d 205b      compList = [
-0001b800: 2763 272c 2027 636f 6d70 272c 2027 636f  'c', 'comp', 'co
-0001b810: 6d70 6f6e 656e 7427 2c20 2763 6f6d 706f  mponent', 'compo
-0001b820: 6e65 6e74 7327 5d0a 2020 2020 7370 6563  nents'].    spec
-0001b830: 6772 616d 4c69 7374 203d 205b 2773 7065  gramList = ['spe
-0001b840: 6327 2c20 2773 7065 6367 7261 6d27 2c20  c', 'specgram', 
-0001b850: 2773 7065 6374 726f 6772 616d 275d 0a20  'spectrogram']. 
-0001b860: 2020 2068 7673 724c 6973 7420 3d20 5b27     hvsrList = ['
-0001b870: 6876 7372 272c 2027 6876 272c 2027 6827  hvsr', 'hv', 'h'
-0001b880: 5d0a 0a20 2020 2068 7673 7249 6e64 203d  ]..    hvsrInd =
-0001b890: 206e 702e 6e61 6e0a 2020 2020 636f 6d70   np.nan.    comp
-0001b8a0: 496e 6420 3d20 6e70 2e6e 616e 0a20 2020  Ind = np.nan.   
-0001b8b0: 2073 7065 6349 6e64 203d 206e 702e 6e61   specInd = np.na
-0001b8c0: 6e0a 0a20 2020 206b 4c69 7374 203d 206b  n..    kList = k
-0001b8d0: 696e 642e 7370 6c69 7428 2720 2729 0a20  ind.split(' '). 
-0001b8e0: 2020 2066 6f72 2069 2c20 6b20 696e 2065     for i, k in e
-0001b8f0: 6e75 6d65 7261 7465 286b 4c69 7374 293a  numerate(kList):
-0001b900: 0a20 2020 2020 2020 206b 4c69 7374 5b69  .        kList[i
-0001b910: 5d20 3d20 6b2e 6c6f 7765 7228 290a 0a20  ] = k.lower().. 
-0001b920: 2020 2023 4856 5352 2069 6e64 6578 0a20     #HVSR index. 
-0001b930: 2020 2069 6620 6c65 6e28 7365 7428 6876     if len(set(hv
-0001b940: 7372 4c69 7374 292e 696e 7465 7273 6563  srList).intersec
-0001b950: 7469 6f6e 286b 4c69 7374 2929 3a0a 2020  tion(kList)):.  
-0001b960: 2020 2020 2020 666f 7220 692c 2068 7620        for i, hv 
-0001b970: 696e 2065 6e75 6d65 7261 7465 2868 7673  in enumerate(hvs
-0001b980: 724c 6973 7429 3a0a 2020 2020 2020 2020  rList):.        
-0001b990: 2020 2020 6966 2068 7620 696e 206b 4c69      if hv in kLi
-0001b9a0: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-0001b9b0: 2020 2020 6876 7372 496e 6420 3d20 6b4c      hvsrInd = kL
-0001b9c0: 6973 742e 696e 6465 7828 6876 290a 2020  ist.index(hv).  
-0001b9d0: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0001b9e0: 6561 6b0a 2020 2020 2343 6f6d 706f 6e65  eak.    #Compone
-0001b9f0: 6e74 2069 6e64 6578 0a20 2020 2023 6966  nt index.    #if
-0001ba00: 206c 656e 2873 6574 2863 6f6d 704c 6973   len(set(compLis
-0001ba10: 7429 2e69 6e74 6572 7365 6374 696f 6e28  t).intersection(
-0001ba20: 6b4c 6973 7429 293a 0a20 2020 2066 6f72  kList)):.    for
-0001ba30: 2069 2c20 6320 696e 2065 6e75 6d65 7261   i, c in enumera
-0001ba40: 7465 286b 4c69 7374 293a 0a20 2020 2020  te(kList):.     
-0001ba50: 2020 2069 6620 272b 2720 696e 2063 2061     if '+' in c a
-0001ba60: 6e64 2063 5b3a 2d31 5d20 696e 2063 6f6d  nd c[:-1] in com
-0001ba70: 704c 6973 743a 0a20 2020 2020 2020 2020  pList:.         
-0001ba80: 2020 2063 6f6d 7049 6e64 203d 206b 4c69     compInd = kLi
-0001ba90: 7374 2e69 6e64 6578 2863 290a 2020 2020  st.index(c).    
-0001baa0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-0001bab0: 2020 2020 2020 0a20 2020 2023 5370 6563        .    #Spec
-0001bac0: 6772 616d 2069 6e64 6578 0a20 2020 2069  gram index.    i
-0001bad0: 6620 6c65 6e28 7365 7428 7370 6563 6772  f len(set(specgr
-0001bae0: 616d 4c69 7374 292e 696e 7465 7273 6563  amList).intersec
-0001baf0: 7469 6f6e 286b 4c69 7374 2929 3a0a 2020  tion(kList)):.  
-0001bb00: 2020 2020 2020 666f 7220 692c 2073 7020        for i, sp 
-0001bb10: 696e 2065 6e75 6d65 7261 7465 2873 7065  in enumerate(spe
-0001bb20: 6367 7261 6d4c 6973 7429 3a0a 2020 2020  cgramList):.    
-0001bb30: 2020 2020 2020 2020 6966 2073 7020 696e          if sp in
-0001bb40: 206b 4c69 7374 3a0a 2020 2020 2020 2020   kList:.        
-0001bb50: 2020 2020 2020 2020 7370 6563 496e 6420          specInd 
-0001bb60: 3d20 6b4c 6973 742e 696e 6465 7828 7370  = kList.index(sp
-0001bb70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001bb80: 2020 6272 6561 6b20 2020 2020 2020 200a    break        .
-0001bb90: 0a20 2020 2069 6e64 4c69 7374 203d 205b  .    indList = [
-0001bba0: 6876 7372 496e 642c 2063 6f6d 7049 6e64  hvsrInd, compInd
-0001bbb0: 2c20 7370 6563 496e 645d 0a20 2020 2069  , specInd].    i
-0001bbc0: 6e64 4c69 7374 436f 7079 203d 2069 6e64  ndListCopy = ind
-0001bbd0: 4c69 7374 2e63 6f70 7928 290a 2020 2020  List.copy().    
-0001bbe0: 706c 6f74 5479 7065 4c69 7374 203d 205b  plotTypeList = [
-0001bbf0: 2768 7673 7227 2c20 2763 6f6d 7027 2c20  'hvsr', 'comp', 
-0001bc00: 2773 7065 6327 5d0a 0a20 2020 2070 6c6f  'spec']..    plo
-0001bc10: 7454 7970 654f 7264 6572 203d 205b 5d0a  tTypeOrder = [].
-0001bc20: 2020 2020 706c 6f74 496e 644f 7264 6572      plotIndOrder
-0001bc30: 203d 205b 5d0a 0a20 2020 206c 6173 7456   = []..    lastV
-0001bc40: 616c 203d 2030 0a20 2020 2077 6869 6c65  al = 0.    while
-0001bc50: 206c 6173 7456 616c 2021 3d20 3939 3a0a   lastVal != 99:.
-0001bc60: 2020 2020 2020 2020 6669 7273 7449 6e64          firstInd
-0001bc70: 203d 206e 702e 6e61 6e61 7267 6d69 6e28   = np.nanargmin(
-0001bc80: 696e 644c 6973 7443 6f70 7929 0a20 2020  indListCopy).   
-0001bc90: 2020 2020 2070 6c6f 7454 7970 654f 7264       plotTypeOrd
-0001bca0: 6572 2e61 7070 656e 6428 706c 6f74 5479  er.append(plotTy
-0001bcb0: 7065 4c69 7374 5b66 6972 7374 496e 645d  peList[firstInd]
-0001bcc0: 290a 2020 2020 2020 2020 706c 6f74 496e  ).        plotIn
-0001bcd0: 644f 7264 6572 2e61 7070 656e 6428 696e  dOrder.append(in
-0001bce0: 644c 6973 745b 6669 7273 7449 6e64 5d29  dList[firstInd])
-0001bcf0: 0a20 2020 2020 2020 206c 6173 7456 616c  .        lastVal
-0001bd00: 203d 2069 6e64 4c69 7374 436f 7079 5b66   = indListCopy[f
-0001bd10: 6972 7374 496e 645d 0a20 2020 2020 2020  irstInd].       
-0001bd20: 2069 6e64 4c69 7374 436f 7079 5b66 6972   indListCopy[fir
-0001bd30: 7374 496e 645d 203d 2039 3920 2368 6967  stInd] = 99 #hig
-0001bd40: 6820 6e75 6d62 6572 0a0a 2020 2020 706c  h number..    pl
-0001bd50: 6f74 5479 7065 4f72 6465 722e 706f 7028  otTypeOrder.pop(
-0001bd60: 290a 2020 2020 706c 6f74 496e 644f 7264  ).    plotIndOrd
-0001bd70: 6572 5b2d 315d 3d6c 656e 286b 4c69 7374  er[-1]=len(kList
-0001bd80: 290a 0a20 2020 2066 6f72 2069 2c20 7020  )..    for i, p 
-0001bd90: 696e 2065 6e75 6d65 7261 7465 2870 6c6f  in enumerate(plo
-0001bda0: 7454 7970 654f 7264 6572 293a 0a20 2020  tTypeOrder):.   
-0001bdb0: 2020 2020 2070 5374 6172 7449 6e64 203d       pStartInd =
-0001bdc0: 2070 6c6f 7449 6e64 4f72 6465 725b 695d   plotIndOrder[i]
-0001bdd0: 0a20 2020 2020 2020 2070 456e 6449 6e64  .        pEndInd
-0001bde0: 203d 2070 6c6f 7449 6e64 4f72 6465 725b   = plotIndOrder[
-0001bdf0: 692b 315d 0a20 2020 2020 2020 2070 6c6f  i+1].        plo
-0001be00: 7443 6f6d 706f 6e65 6e74 7320 3d20 6b4c  tComponents = kL
-0001be10: 6973 745b 7053 7461 7274 496e 643a 7045  ist[pStartInd:pE
-0001be20: 6e64 496e 645d 0a0a 2020 2020 2020 2020  ndInd]..        
-0001be30: 6966 2075 7365 5f73 7562 706c 6f74 7320  if use_subplots 
-0001be40: 616e 6420 693d 3d30 2061 6e64 2066 6967  and i==0 and fig
-0001be50: 2069 7320 4e6f 6e65 2061 6e64 2061 7820   is None and ax 
-0001be60: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0001be70: 2020 2020 206d 6f73 6169 6350 6c6f 7473       mosaicPlots
-0001be80: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0001be90: 2020 666f 7220 7074 6f20 696e 2070 6c6f    for pto in plo
-0001bea0: 7454 7970 654f 7264 6572 3a0a 2020 2020  tTypeOrder:.    
-0001beb0: 2020 2020 2020 2020 2020 2020 6d6f 7361              mosa
-0001bec0: 6963 506c 6f74 732e 6170 7065 6e64 285b  icPlots.append([
-0001bed0: 7074 6f5d 290a 2020 2020 2020 2020 2020  pto]).          
-0001bee0: 2020 6669 672c 2061 7820 3d20 706c 742e    fig, ax = plt.
-0001bef0: 7375 6270 6c6f 745f 6d6f 7361 6963 286d  subplot_mosaic(m
-0001bf00: 6f73 6169 6350 6c6f 7473 290a 2020 2020  osaicPlots).    
-0001bf10: 2020 2020 2020 2020 6178 6973 203d 2061          axis = a
-0001bf20: 785b 705d 0a20 2020 2020 2020 2065 6c69  x[p].        eli
-0001bf30: 6620 7573 655f 7375 6270 6c6f 7473 3a0a  f use_subplots:.
-0001bf40: 2020 2020 2020 2020 2020 2020 6178 6973              axis
-0001bf50: 203d 2061 785b 705d 0a20 2020 2020 2020   = ax[p].       
-0001bf60: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001bf70: 2020 2066 6967 2c20 6178 6973 203d 2070     fig, axis = p
-0001bf80: 6c74 2e73 7562 706c 6f74 7328 290a 2020  lt.subplots().  
-0001bf90: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0001bfa0: 2020 2069 6620 7020 3d3d 2027 6876 7372     if p == 'hvsr
-0001bfb0: 273a 0a20 2020 2020 2020 2020 2020 2070  ':.            p
-0001bfc0: 6c6f 745f 6876 7372 2868 7673 725f 6469  lot_hvsr(hvsr_di
-0001bfd0: 6374 2c20 6669 673d 6669 672c 2061 783d  ct, fig=fig, ax=
-0001bfe0: 6178 6973 2c20 6b69 6e64 3d70 6c6f 7443  axis, kind=plotC
-0001bff0: 6f6d 706f 6e65 6e74 732c 2078 7479 7065  omponents, xtype
-0001c000: 3d27 785f 6672 6571 7327 290a 2020 2020  ='x_freqs').    
-0001c010: 2020 2020 656c 6966 2070 3d3d 2763 6f6d      elif p=='com
-0001c020: 7027 3a0a 2020 2020 2020 2020 2020 2020  p':.            
-0001c030: 706c 6f74 436f 6d70 6f6e 656e 7473 5b30  plotComponents[0
-0001c040: 5d20 3d20 706c 6f74 436f 6d70 6f6e 656e  ] = plotComponen
-0001c050: 7473 5b30 5d5b 3a2d 315d 0a20 2020 2020  ts[0][:-1].     
-0001c060: 2020 2020 2020 2070 6c6f 745f 6876 7372         plot_hvsr
-0001c070: 2868 7673 725f 6469 6374 2c20 6669 673d  (hvsr_dict, fig=
-0001c080: 6669 672c 2061 783d 6178 6973 2c20 6b69  fig, ax=axis, ki
-0001c090: 6e64 3d70 6c6f 7443 6f6d 706f 6e65 6e74  nd=plotComponent
-0001c0a0: 732c 2078 7479 7065 3d27 785f 6672 6571  s, xtype='x_freq
-0001c0b0: 7327 290a 2020 2020 2020 2020 656c 6966  s').        elif
-0001c0c0: 2070 3d3d 2773 7065 6327 3a0a 2020 2020   p=='spec':.    
-0001c0d0: 2020 2020 2020 2020 706c 6f74 5f73 7065          plot_spe
-0001c0e0: 6367 7261 6d5f 6876 7372 2868 7673 725f  cgram_hvsr(hvsr_
-0001c0f0: 6469 6374 2c20 6669 673d 6669 672c 2061  dict, fig=fig, a
-0001c100: 783d 6178 6973 290a 2020 2020 2020 2020  x=axis).        
-0001c110: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001c120: 2020 7072 696e 7428 2745 7272 6f72 2729    print('Error')
-0001c130: 2020 2020 0a20 2020 200a 2020 2020 6966      .    .    if
-0001c140: 2072 6574 7572 6e5f 6669 673a 0a20 2020   return_fig:.   
-0001c150: 2020 2020 2072 6574 7572 6e20 6669 672c       return fig,
-0001c160: 2061 780a 2020 2020 7265 7475 726e 0a0a   ax.    return..
-0001c170: 2350 6c6f 7420 4856 5352 2064 6174 6120  #Plot HVSR data 
-0001c180: 284f 4c44 290a 6465 6620 5f5f 6f6c 645f  (OLD).def __old_
-0001c190: 6876 706c 6f74 2868 7673 725f 6469 6374  hvplot(hvsr_dict
-0001c1a0: 2c20 6b69 6e64 3d27 4856 5352 272c 2078  , kind='HVSR', x
-0001c1b0: 7479 7065 3d27 6672 6571 272c 2072 6574  type='freq', ret
-0001c1c0: 7572 6e5f 6669 673d 4661 6c73 652c 2020  urn_fig=False,  
-0001c1d0: 7361 7665 5f64 6972 3d4e 6f6e 652c 2073  save_dir=None, s
-0001c1e0: 6176 655f 7375 6666 6978 3d27 272c 2073  ave_suffix='', s
-0001c1f0: 686f 773d 5472 7565 2c2a 2a6b 7761 7267  how=True,**kwarg
-0001c200: 7329 3a0a 2020 2020 2222 2246 756e 6374  s):.    """Funct
-0001c210: 696f 6e20 746f 2070 6c6f 7420 4856 5352  ion to plot HVSR
-0001c220: 2064 6174 610a 0a20 2020 2020 2020 2050   data..        P
-0001c230: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-0001c240: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0001c250: 2020 2020 2068 7673 725f 6469 6374 203a       hvsr_dict :
-0001c260: 2064 6963 7420 2020 2020 2020 2020 2020   dict           
-0001c270: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0001c280: 2020 2020 4469 6374 696f 6e61 7279 2063      Dictionary c
-0001c290: 6f6e 7461 696e 696e 6720 6f75 7470 7574  ontaining output
-0001c2a0: 2066 726f 6d20 7072 6f63 6573 735f 6876   from process_hv
-0001c2b0: 7372 2066 756e 6374 696f 6e0a 2020 2020  sr function.    
-0001c2c0: 2020 2020 6b69 6e64 203a 2073 7472 3d27      kind : str='
-0001c2d0: 4856 5352 2720 6f72 206c 6973 7420 2020  HVSR' or list   
-0001c2e0: 200a 2020 2020 2020 2020 2020 2020 5468   .            Th
-0001c2f0: 6520 6b69 6e64 206f 6620 706c 6f74 2873  e kind of plot(s
-0001c300: 2920 746f 2070 6c6f 742e 2049 6620 6c69  ) to plot. If li
-0001c310: 7374 2c20 7769 6c6c 2070 6c6f 7420 616c  st, will plot al
-0001c320: 6c20 706c 6f74 7320 6c69 7374 6564 0a20  l plots listed. 
-0001c330: 2020 2020 2020 2020 2020 2027 4856 5352             'HVSR
-0001c340: 2720 3a20 5374 616e 6461 7264 2048 5653  ' : Standard HVS
-0001c350: 5220 706c 6f74 2c20 696e 636c 7564 696e  R plot, includin
-0001c360: 6720 7374 616e 6461 7264 2064 6576 6961  g standard devia
-0001c370: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-0001c380: 202d 2027 5b48 5653 525d 2070 2720 3a20   - '[HVSR] p' : 
-0001c390: 4856 5352 2070 6c6f 7420 7769 7468 2062  HVSR plot with b
-0001c3a0: 6573 7420 7065 616b 7320 7368 6f77 6e0a  est peaks shown.
-0001c3b0: 2020 2020 2020 2020 2020 2020 2d20 275b              - '[
-0001c3c0: 4856 5352 5d20 7027 203a 2048 5653 5220  HVSR] p' : HVSR 
-0001c3d0: 706c 6f74 2077 6974 6820 6265 7374 2070  plot with best p
-0001c3e0: 6963 6b65 6420 7065 616b 2073 686f 776e  icked peak shown
-0001c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c400: 0a20 2020 2020 2020 2020 2020 202d 2027  .            - '
-0001c410: 5b48 5653 525d 2070 2a20 616c 6c27 203a  [HVSR] p* all' :
-0001c420: 2048 5653 5220 706c 6f74 2077 6974 6820   HVSR plot with 
-0001c430: 616c 6c20 7069 636b 6564 2070 6561 6b73  all picked peaks
-0001c440: 2073 686f 776e 2020 2020 2020 2020 2020   shown          
-0001c450: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-0001c460: 2020 202d 2027 5b48 5653 525d 2070 2a20     - '[HVSR] p* 
-0001c470: 7427 203a 2048 5653 5220 706c 6f74 2077  t' : HVSR plot w
-0001c480: 6974 6820 7065 616b 7320 6672 6f6d 2061  ith peaks from a
-0001c490: 6c6c 2074 696d 6520 7374 6570 7320 696e  ll time steps in
-0001c4a0: 2062 6163 6b67 726f 756e 6420 2020 2020   background     
-0001c4b0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0001c4c0: 2020 2020 2020 2020 2d20 275b 4856 5352          - '[HVSR
-0001c4d0: 2070 2a20 616e 6e5d 203a 2041 6e6e 6f74   p* ann] : Annot
-0001c4e0: 6174 6573 2070 6c6f 7420 7769 7468 2070  ates plot with p
-0001c4f0: 6561 6b73 0a20 2020 2020 2020 2020 2020  eaks.           
-0001c500: 202d 2027 5b48 5653 525d 202d 7327 203a   - '[HVSR] -s' :
-0001c510: 2048 5653 5220 706c 6f74 7320 646f 6e27   HVSR plots don'
-0001c520: 7420 7368 6f77 2073 7461 6e64 6172 6420  t show standard 
-0001c530: 6465 7669 6174 696f 6e0a 2020 2020 2020  deviation.      
-0001c540: 2020 2020 2020 2d20 275b 4856 5352 5d20        - '[HVSR] 
-0001c550: 7427 203a 2048 5653 5220 706c 6f74 2077  t' : HVSR plot w
-0001c560: 6974 6820 696e 6469 7669 6475 616c 2068  ith individual h
-0001c570: 7620 6375 7276 6573 2066 6f72 2065 6163  v curves for eac
-0001c580: 6820 7469 6d65 2073 7465 7020 7368 6f77  h time step show
-0001c590: 6e0a 2020 2020 2020 2020 2020 2020 2d20  n.            - 
-0001c5a0: 275b 4856 5352 5d20 6327 203a 2048 5653  '[HVSR] c' : HVS
-0001c5b0: 5220 706c 6f74 2077 6974 6820 6561 6368  R plot with each
-0001c5c0: 2063 6f6d 706f 6e65 6e74 7327 2073 7065   components' spe
-0001c5d0: 6374 7261 2e20 5265 636f 6d6d 656e 6465  ctra. Recommende
-0001c5e0: 6420 746f 2064 6f20 7468 6973 206c 6173  d to do this las
-0001c5f0: 7420 286f 7220 6a75 7374 2062 6566 6f72  t (or just befor
-0001c600: 6520 2773 7065 6367 7261 6d27 292c 2073  e 'specgram'), s
-0001c610: 696e 6365 2064 6f69 6e67 2063 2b20 6361  ince doing c+ ca
-0001c620: 6e20 6d61 6b65 2074 6865 2063 6f6d 706f  n make the compo
-0001c630: 6e65 6e74 2063 6861 7274 2069 7473 206f  nent chart its o
-0001c640: 776e 2063 6861 7274 0a20 2020 2020 2020  wn chart.       
-0001c650: 2020 2020 2027 5370 6563 6772 616d 2720       'Specgram' 
-0001c660: 3a20 436f 6d62 696e 6564 2073 7065 6374  : Combined spect
-0001c670: 726f 6772 616d 206f 6620 616c 6c20 636f  rogram of all co
-0001c680: 6d70 6f6e 656e 7473 0a20 2020 2020 2020  mponents.       
-0001c690: 2020 2020 202d 2027 5b73 7065 635d 2720       - '[spec]' 
-0001c6a0: 3a20 6261 7369 6320 7370 6563 7472 6f67  : basic spectrog
-0001c6b0: 7261 6d20 706c 6f74 206f 6620 482f 5620  ram plot of H/V 
-0001c6c0: 6375 7276 650a 2020 2020 2020 2020 7874  curve.        xt
-0001c6d0: 7970 6520 3a20 7374 722c 2064 6566 6175  ype : str, defau
-0001c6e0: 6c74 203d 2027 6672 6571 2720 2020 200a  lt = 'freq'    .
-0001c6f0: 2020 2020 2020 2020 2020 2020 5374 7269              Stri
-0001c700: 6e67 2066 6f72 2077 6861 7420 746f 2075  ng for what to u
-0001c710: 7365 2c20 6265 7477 6565 6e20 6672 6571  se, between freq
-0001c720: 7565 6e63 7920 6f72 2070 6572 696f 640a  uency or period.
-0001c730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c740: 466f 7220 6672 6571 7565 6e63 792c 2074  For frequency, t
-0001c750: 6865 2066 6f6c 6c6f 7769 6e67 2061 7265  he following are
-0001c760: 2061 6363 6570 7465 6420 2863 6173 6520   accepted (case 
-0001c770: 646f 6573 206e 6f74 206d 6174 7465 7229  does not matter)
-0001c780: 3a20 2766 272c 2027 487a 272c 2027 6672  : 'f', 'Hz', 'fr
-0001c790: 6571 272c 2027 6672 6571 7565 6e63 7927  eq', 'frequency'
-0001c7a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c7b0: 2046 6f72 2070 6572 696f 642c 2074 6865   For period, the
-0001c7c0: 2066 6f6c 6c6f 7769 6e67 2061 7265 2061   following are a
-0001c7d0: 6363 6570 7465 6420 2863 6173 6520 646f  ccepted (case do
-0001c7e0: 6573 206e 6f74 206d 6174 7465 7229 3a20  es not matter): 
-0001c7f0: 2770 272c 2027 5427 2c20 2773 272c 2027  'p', 'T', 's', '
-0001c800: 7365 6327 2c20 2773 6563 6f6e 6427 2c20  sec', 'second', 
-0001c810: 2770 6572 272c 2027 7065 7269 6f64 270a  'per', 'period'.
-0001c820: 2020 2020 2020 2020 7265 7475 726e 5f66          return_f
-0001c830: 6967 2020 203a 2062 6f6f 6c0a 2020 2020  ig   : bool.    
-0001c840: 2020 2020 2020 2020 5768 6574 6865 7220          Whether 
-0001c850: 746f 2072 6574 7572 6e20 6669 6775 7265  to return figure
-0001c860: 2061 6e64 2061 7869 7320 6f62 6a65 6374   and axis object
-0001c870: 730a 2020 2020 2020 2020 7361 7665 5f64  s.        save_d
-0001c880: 6972 2020 2020 203a 2073 7472 206f 7220  ir     : str or 
-0001c890: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0001c8a0: 2044 6972 6563 746f 7279 2069 6e20 7768   Directory in wh
-0001c8b0: 6963 6820 746f 2073 6176 6520 6669 6775  ich to save figu
-0001c8c0: 7265 730a 2020 2020 2020 2020 7361 7665  res.        save
-0001c8d0: 5f73 7566 6669 7820 203a 2073 7472 0a20  _suffix  : str. 
-0001c8e0: 2020 2020 2020 2020 2020 2053 7566 6669             Suffi
-0001c8f0: 7820 746f 2061 6464 2074 6f20 656e 6420  x to add to end 
-0001c900: 6f66 2066 6967 7572 6520 6669 6c65 6e61  of figure filena
-0001c910: 6d65 2873 292c 2069 6620 7361 7665 5f64  me(s), if save_d
-0001c920: 6972 2069 7320 7573 6564 0a20 2020 2020  ir is used.     
-0001c930: 2020 2073 686f 7720 2020 203a 2062 6f6f     show    : boo
-0001c940: 6c0a 2020 2020 2020 2020 2020 2020 5768  l.            Wh
-0001c950: 6574 6865 7220 746f 2073 686f 7720 706c  ether to show pl
-0001c960: 6f74 0a20 2020 2020 2020 202a 2a6b 7761  ot.        **kwa
-0001c970: 7267 7320 2020 203a 206b 6579 776f 7264  rgs    : keyword
-0001c980: 2061 7267 756d 656e 7473 0a20 2020 2020   arguments.     
-0001c990: 2020 2020 2020 204b 6579 776f 7264 2061         Keyword a
-0001c9a0: 7267 756d 656e 7473 2066 6f72 206d 6174  rguments for mat
-0001c9b0: 706c 6f74 6c69 622e 7079 706c 6f74 0a0a  plotlib.pyplot..
-0001c9c0: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-0001c9d0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-0001c9e0: 2020 2020 2020 2020 6669 672c 2061 7820          fig, ax 
-0001c9f0: 3a20 6d61 7470 6c6f 746c 6962 2066 6967  : matplotlib fig
-0001ca00: 7572 6520 616e 6420 6178 6973 206f 626a  ure and axis obj
-0001ca10: 6563 7473 0a20 2020 2020 2020 2020 2020  ects.           
-0001ca20: 2052 6574 7572 6e73 2066 6967 7572 6520   Returns figure 
-0001ca30: 616e 6420 6178 6973 206d 6174 706c 6f74  and axis matplot
-0001ca40: 6c69 622e 7079 706c 6f74 206f 626a 6563  lib.pyplot objec
-0001ca50: 7473 2069 6620 7265 7475 726e 5f66 6967  ts if return_fig
-0001ca60: 3d54 7275 652c 206f 7468 6572 7769 7365  =True, otherwise
-0001ca70: 2c20 7369 6d70 6c79 2070 6c6f 7473 2074  , simply plots t
-0001ca80: 6865 2066 6967 7572 6573 0a20 2020 2022  he figures.    "
-0001ca90: 2222 0a20 2020 2023 706c 742e 7263 5061  "".    #plt.rcPa
-0001caa0: 7261 6d73 5b27 6669 6775 7265 2e64 7069  rams['figure.dpi
-0001cab0: 275d 203d 2035 3030 0a20 2020 2023 706c  '] = 500.    #pl
-0001cac0: 742e 7263 5061 7261 6d73 5b27 6669 6775  t.rcParams['figu
-0001cad0: 7265 2e66 6967 7369 7a65 275d 203d 2028  re.figsize'] = (
-0001cae0: 3132 2c20 3329 0a0a 2020 2020 6672 6571  12, 3)..    freq
-0001caf0: 4c69 7374 203d 205b 2746 272c 2027 485a  List = ['F', 'HZ
-0001cb00: 272c 2027 4652 4551 272c 2027 4652 4551  ', 'FREQ', 'FREQ
-0001cb10: 5545 4e43 5927 5d0a 2020 2020 7065 724c  UENCY'].    perL
-0001cb20: 6973 7420 3d20 2750 272c 2027 5427 2c20  ist = 'P', 'T', 
-0001cb30: 2753 272c 2027 5345 4327 2c20 2753 4543  'S', 'SEC', 'SEC
-0001cb40: 4f4e 4427 2027 5045 5227 2c20 2750 4552  OND' 'PER', 'PER
-0001cb50: 494f 4427 0a0a 2020 2020 6966 2078 7479  IOD'..    if xty
-0001cb60: 7065 2e75 7070 6572 2829 2069 6e20 6672  pe.upper() in fr
-0001cb70: 6571 4c69 7374 3a0a 2020 2020 2020 2020  eqList:.        
-0001cb80: 7874 7970 653d 2778 5f66 7265 7173 270a  xtype='x_freqs'.
-0001cb90: 2020 2020 656c 6966 2078 7479 7065 2e75      elif xtype.u
-0001cba0: 7070 6572 2829 2069 6e20 7065 724c 6973  pper() in perLis
-0001cbb0: 743a 0a20 2020 2020 2020 2078 7479 7065  t:.        xtype
-0001cbc0: 3d27 785f 7065 7269 6f64 270a 2020 2020  ='x_period'.    
-0001cbd0: 656c 7365 3a0a 2020 2020 2020 2020 7072  else:.        pr
-0001cbe0: 696e 7428 2778 7479 7065 206e 6f74 2076  int('xtype not v
-0001cbf0: 616c 6964 2729 0a20 2020 2020 2020 2072  alid').        r
-0001cc00: 6574 7572 6e0a 2020 2020 0a20 2020 2073  eturn.    .    s
-0001cc10: 7065 6367 7261 6d4c 6973 7420 3d20 5b27  pecgramList = ['
-0001cc20: 7370 6563 272c 2027 7370 6563 6772 616d  spec', 'specgram
-0001cc30: 272c 2027 7370 6563 7472 6f67 7261 6d27  ', 'spectrogram'
-0001cc40: 5d0a 2020 2020 6876 7372 4c69 7374 203d  ].    hvsrList =
-0001cc50: 205b 2768 7673 7227 2c20 2768 7627 2c20   ['hvsr', 'hv', 
-0001cc60: 2768 275d 0a0a 2020 2020 6b4c 6973 7420  'h']..    kList 
-0001cc70: 3d20 6b69 6e64 2e73 706c 6974 2827 2027  = kind.split(' '
-0001cc80: 290a 2020 2020 6368 6172 7453 7472 203d  ).    chartStr =
-0001cc90: 205b 5d0a 2020 2020 6920 3d20 300a 2020   [].    i = 0.  
-0001cca0: 2020 666f 7220 6b20 696e 206b 4c69 7374    for k in kList
-0001ccb0: 3a0a 2020 2020 2020 2020 6b20 3d20 6b2e  :.        k = k.
-0001ccc0: 7374 7269 7028 292e 6c6f 7765 7228 290a  strip().lower().
-0001ccd0: 2020 2020 2020 2020 6966 2069 203d 3d20          if i == 
-0001cce0: 3020 616e 6420 286b 2069 6e20 6876 7372  0 and (k in hvsr
-0001ccf0: 4c69 7374 206f 7220 6b20 696e 2073 7065  List or k in spe
-0001cd00: 6367 7261 6d4c 6973 7429 3a0a 2020 2020  cgramList):.    
-0001cd10: 2020 2020 2020 2020 6368 6172 7454 7970          chartTyp
-0001cd20: 6520 3d20 6b20 2020 2020 2020 200a 2020  e = k        .  
-0001cd30: 2020 2020 2020 6966 2027 2b27 2069 6e20        if '+' in 
-0001cd40: 6b20 6f72 2028 6b20 696e 2068 7673 724c  k or (k in hvsrL
-0001cd50: 6973 7420 616e 6420 6920 3e20 3029 206f  ist and i > 0) o
-0001cd60: 7220 286b 2069 6e20 7370 6563 6772 616d  r (k in specgram
-0001cd70: 4c69 7374 2061 6e64 2069 203e 2030 293a  List and i > 0):
-0001cd80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001cd90: 6368 6172 7454 7970 6520 696e 2073 7065  chartType in spe
-0001cda0: 6367 7261 6d4c 6973 743a 0a20 2020 2020  cgramList:.     
-0001cdb0: 2020 2020 2020 2020 2020 2066 6967 2c20             fig, 
-0001cdc0: 6178 203d 2070 6c6f 745f 7370 6563 6772  ax = plot_specgr
-0001cdd0: 616d 5f68 7673 7228 6876 7372 5f64 6963  am_hvsr(hvsr_dic
-0001cde0: 742c 2073 6176 6564 6972 3d73 6176 655f  t, savedir=save_
-0001cdf0: 6469 722c 2073 6176 655f 7375 6666 6978  dir, save_suffix
-0001ce00: 3d73 6176 655f 7375 6666 6978 2c20 7368  =save_suffix, sh
-0001ce10: 6f77 3d73 686f 772c 206b 7761 7267 733d  ow=show, kwargs=
-0001ce20: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-0001ce30: 2020 2020 2020 2020 693d 300a 2020 2020          i=0.    
-0001ce40: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001ce50: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0001ce60: 672c 2061 7820 3d20 706c 6f74 5f68 7673  g, ax = plot_hvs
-0001ce70: 7228 6876 7372 5f64 6963 742c 206b 696e  r(hvsr_dict, kin
-0001ce80: 643d 6368 6172 7453 7472 2c20 7874 7970  d=chartStr, xtyp
-0001ce90: 653d 7874 7970 652c 2020 7361 7665 6469  e=xtype,  savedi
-0001cea0: 723d 7361 7665 5f64 6972 2c20 7361 7665  r=save_dir, save
-0001ceb0: 5f73 7566 6669 783d 7361 7665 5f73 7566  _suffix=save_suf
-0001cec0: 6669 782c 2073 686f 773d 7368 6f77 2c20  fix, show=show, 
-0001ced0: 6b77 6172 6773 3d6b 7761 7267 7329 2020  kwargs=kwargs)  
-0001cee0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0001cef0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001cf00: 3d30 0a0a 2020 2020 2020 2020 2020 2020  =0..            
-0001cf10: 6966 2027 2b27 2069 6e20 6b3a 0a20 2020  if '+' in k:.   
-0001cf20: 2020 2020 2020 2020 2020 2020 206b 203d               k =
-0001cf30: 206b 2e72 6570 6c61 6365 2827 2b27 2c20   k.replace('+', 
-0001cf40: 2727 2920 2020 200a 2020 2020 2020 2020  '')    .        
-0001cf50: 2020 2020 2020 2020 6368 6172 7453 7472          chartStr
-0001cf60: 203d 205b 6b5d 0a20 2020 2020 2020 2020   = [k].         
-0001cf70: 2020 2020 2020 2066 6967 2c20 6178 203d         fig, ax =
-0001cf80: 2070 6c6f 745f 6876 7372 2868 7673 725f   plot_hvsr(hvsr_
-0001cf90: 6469 6374 2c20 6b69 6e64 3d63 6861 7274  dict, kind=chart
-0001cfa0: 5374 722c 2078 7479 7065 3d78 7479 7065  Str, xtype=xtype
-0001cfb0: 2c20 2073 6176 6564 6972 3d73 6176 655f  ,  savedir=save_
-0001cfc0: 6469 722c 2073 6176 655f 7375 6666 6978  dir, save_suffix
-0001cfd0: 3d73 6176 655f 7375 6666 6978 2c20 7368  =save_suffix, sh
-0001cfe0: 6f77 3d73 686f 772c 206b 7761 7267 733d  ow=show, kwargs=
-0001cff0: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-0001d000: 2020 2020 6368 6172 7453 7472 203d 205b      chartStr = [
-0001d010: 6b5d 0a20 2020 2020 2020 2065 6c73 653a  k].        else:
-0001d020: 0a20 2020 2020 2020 2020 2020 2069 2b3d  .            i+=
-0001d030: 310a 2020 2020 2020 2020 2020 2020 6368  1.            ch
-0001d040: 6172 7453 7472 2e61 7070 656e 6428 6b29  artStr.append(k)
-0001d050: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-0001d060: 2020 6966 206c 656e 2863 6861 7274 5374    if len(chartSt
-0001d070: 7229 203e 2030 3a0a 2020 2020 2020 2020  r) > 0:.        
-0001d080: 6966 2069 203d 3d20 3020 616e 6420 286b  if i == 0 and (k
-0001d090: 2069 6e20 6876 7372 4c69 7374 206f 7220   in hvsrList or 
-0001d0a0: 6b20 696e 2073 7065 6367 7261 6d4c 6973  k in specgramLis
-0001d0b0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0001d0c0: 6368 6172 7454 7970 6520 3d20 6b20 2020  chartType = k   
-0001d0d0: 2020 0a0a 2020 2020 2020 2020 6966 2063    ..        if c
-0001d0e0: 6861 7274 5479 7065 2069 6e20 7370 6563  hartType in spec
-0001d0f0: 6772 616d 4c69 7374 3a0a 2020 2020 2020  gramList:.      
-0001d100: 2020 2020 2020 6669 672c 2061 7820 3d20        fig, ax = 
-0001d110: 706c 6f74 5f73 7065 6367 7261 6d5f 6876  plot_specgram_hv
-0001d120: 7372 2868 7673 725f 6469 6374 2c20 2073  sr(hvsr_dict,  s
-0001d130: 6176 6564 6972 3d73 6176 655f 6469 722c  avedir=save_dir,
-0001d140: 2073 6176 655f 7375 6666 6978 3d73 6176   save_suffix=sav
-0001d150: 655f 7375 6666 6978 2c20 7368 6f77 3d73  e_suffix, show=s
-0001d160: 686f 772c 206b 7761 7267 733d 6b77 6172  how, kwargs=kwar
-0001d170: 6773 290a 2020 2020 2020 2020 656c 7365  gs).        else
-0001d180: 3a0a 2020 2020 2020 2020 2020 2020 6669  :.            fi
-0001d190: 672c 2061 7820 3d20 706c 6f74 5f68 7673  g, ax = plot_hvs
-0001d1a0: 7228 6876 7372 5f64 6963 742c 206b 696e  r(hvsr_dict, kin
-0001d1b0: 643d 6368 6172 7453 7472 2c20 7874 7970  d=chartStr, xtyp
-0001d1c0: 653d 7874 7970 652c 2020 7361 7665 6469  e=xtype,  savedi
-0001d1d0: 723d 7361 7665 5f64 6972 2c20 7361 7665  r=save_dir, save
-0001d1e0: 5f73 7566 6669 783d 7361 7665 5f73 7566  _suffix=save_suf
-0001d1f0: 6669 782c 2073 686f 773d 7368 6f77 2c20  fix, show=show, 
-0001d200: 6b77 6172 6773 3d6b 7761 7267 7329 0a0a  kwargs=kwargs)..
-0001d210: 2020 2020 6966 2072 6574 7572 6e5f 6669      if return_fi
-0001d220: 673a 0a20 2020 2020 2020 2072 6574 7572  g:.        retur
-0001d230: 6e20 6669 672c 2061 780a 2020 2020 0a20  n fig, ax.    . 
-0001d240: 2020 2072 6574 7572 6e0a 2020 2020 0a23     return.    .#
-0001d250: 506c 6f74 2068 7673 7220 6375 7276 652c  Plot hvsr curve,
-0001d260: 2070 7269 7661 7465 2073 7570 706f 7274   private support
-0001d270: 696e 6720 6675 6e63 7469 6f6e 2066 6f72  ing function for
-0001d280: 2068 7670 6c6f 740a 6465 6620 706c 6f74   hvplot.def plot
-0001d290: 5f68 7673 7228 6876 7372 5f64 6963 742c  _hvsr(hvsr_dict,
-0001d2a0: 206b 696e 642c 2078 7479 7065 2c20 6669   kind, xtype, fi
-0001d2b0: 673d 4e6f 6e65 2c20 6178 3d4e 6f6e 652c  g=None, ax=None,
-0001d2c0: 2073 6176 655f 6469 723d 4e6f 6e65 2c20   save_dir=None, 
-0001d2d0: 7361 7665 5f73 7566 6669 783d 2727 2c20  save_suffix='', 
-0001d2e0: 7368 6f77 3d54 7275 652c 202a 2a6b 7761  show=True, **kwa
-0001d2f0: 7267 7329 3a0a 2020 2020 2222 2250 7269  rgs):.    """Pri
-0001d300: 7661 7465 2066 756e 6374 696f 6e20 666f  vate function fo
-0001d310: 7220 706c 6f74 7469 6e67 2068 7673 7220  r plotting hvsr 
-0001d320: 6375 7276 6520 286f 7220 6375 7276 6573  curve (or curves
-0001d330: 2077 6974 6820 636f 6d70 6f6e 656e 7473   with components
-0001d340: 290a 2020 2020 2222 220a 2020 2020 6966  ).    """.    if
-0001d350: 2027 6b77 6172 6773 2720 696e 206b 7761   'kwargs' in kwa
-0001d360: 7267 732e 6b65 7973 2829 3a0a 2020 2020  rgs.keys():.    
-0001d370: 2020 2020 6b77 6172 6773 203d 206b 7761      kwargs = kwa
-0001d380: 7267 735b 276b 7761 7267 7327 5d0a 0a20  rgs['kwargs'].. 
-0001d390: 2020 2069 6620 6669 6720 6973 204e 6f6e     if fig is Non
-0001d3a0: 6520 616e 6420 6178 2069 7320 4e6f 6e65  e and ax is None
-0001d3b0: 3a0a 2020 2020 2020 2020 6669 672c 2061  :.        fig, a
-0001d3c0: 7820 3d20 706c 742e 7375 6270 6c6f 7473  x = plt.subplots
-0001d3d0: 2829 0a0a 2020 2020 6966 2027 786c 696d  ()..    if 'xlim
-0001d3e0: 2720 6e6f 7420 696e 206b 7761 7267 732e  ' not in kwargs.
-0001d3f0: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
-0001d400: 786c 696d 203d 2068 7673 725f 6469 6374  xlim = hvsr_dict
-0001d410: 5b27 6876 7372 5f62 616e 6427 5d0a 2020  ['hvsr_band'].  
-0001d420: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001d430: 786c 696d 203d 206b 7761 7267 735b 2778  xlim = kwargs['x
-0001d440: 6c69 6d27 5d0a 2020 2020 0a20 2020 2069  lim'].    .    i
-0001d450: 6620 2779 6c69 6d27 206e 6f74 2069 6e20  f 'ylim' not in 
-0001d460: 6b77 6172 6773 2e6b 6579 7328 293a 0a20  kwargs.keys():. 
-0001d470: 2020 2020 2020 2079 6c69 6d20 3d20 5b30         ylim = [0
-0001d480: 2c20 6d61 7828 6876 7372 5f64 6963 745b  , max(hvsr_dict[
-0001d490: 2768 7673 7270 3227 5d29 5d0a 2020 2020  'hvsrp2'])].    
-0001d4a0: 656c 7365 3a0a 2020 2020 2020 2020 796c  else:.        yl
-0001d4b0: 696d 203d 206b 7761 7267 735b 2779 6c69  im = kwargs['yli
-0001d4c0: 6d27 5d0a 2020 2020 0a20 2020 2069 6620  m'].    .    if 
-0001d4d0: 2767 7269 6427 2069 6e20 6b77 6172 6773  'grid' in kwargs
-0001d4e0: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
-0001d4f0: 2070 6c74 2e67 7269 6428 7768 6963 683d   plt.grid(which=
-0001d500: 6b77 6172 6773 5b27 6772 6964 275d 2c20  kwargs['grid'], 
-0001d510: 616c 7068 613d 302e 3235 290a 0a20 2020  alpha=0.25)..   
-0001d520: 2069 6620 7874 7970 653d 3d27 785f 6672   if xtype=='x_fr
-0001d530: 6571 7327 3a0a 2020 2020 2020 2020 786c  eqs':.        xl
-0001d540: 6162 656c 203d 2027 4672 6571 7565 6e63  abel = 'Frequenc
-0001d550: 7920 5b48 7a5d 270a 2020 2020 656c 7365  y [Hz]'.    else
-0001d560: 3a0a 2020 2020 2020 2020 786c 6162 656c  :.        xlabel
-0001d570: 203d 2027 5065 7269 6f64 205b 735d 270a   = 'Period [s]'.
-0001d580: 0a20 2020 2069 6620 7361 7665 5f64 6972  .    if save_dir
-0001d590: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0001d5a0: 2020 2020 2020 6669 6c65 6e61 6d65 203d        filename =
-0001d5b0: 2068 7673 725f 6469 6374 5b27 696e 7075   hvsr_dict['inpu
-0001d5c0: 745f 7061 7261 6d73 275d 5b27 7369 7465  t_params']['site
-0001d5d0: 275d 0a20 2020 2065 6c73 653a 0a20 2020  '].    else:.   
-0001d5e0: 2020 2020 2066 696c 656e 616d 6520 3d20       filename = 
-0001d5f0: 2222 0a0a 2020 2020 2361 7820 3d20 706c  ""..    #ax = pl
-0001d600: 742e 6763 6128 290a 2020 2020 2366 6967  t.gca().    #fig
-0001d610: 203d 2070 6c74 2e67 6366 2829 0a0a 2020   = plt.gcf()..  
-0001d620: 2020 616e 794b 6579 203d 206c 6973 7428    anyKey = list(
-0001d630: 6876 7372 5f64 6963 745b 7874 7970 655d  hvsr_dict[xtype]
-0001d640: 2e6b 6579 7328 2929 5b30 5d0a 2020 2020  .keys())[0].    
-0001d650: 7820 3d20 6876 7372 5f64 6963 745b 7874  x = hvsr_dict[xt
-0001d660: 7970 655d 5b61 6e79 4b65 795d 5b3a 2d31  ype][anyKey][:-1
-0001d670: 5d0a 2020 2020 7920 3d20 6876 7372 5f64  ].    y = hvsr_d
-0001d680: 6963 745b 2768 7673 725f 6375 7276 6527  ict['hvsr_curve'
-0001d690: 5d0a 2020 2020 0a20 2020 2070 6c6f 7453  ].    .    plotS
-0001d6a0: 7566 663d 2727 0a20 2020 206c 6567 656e  uff=''.    legen
-0001d6b0: 644c 6f63 203d 2027 7570 7065 7220 7269  dLoc = 'upper ri
-0001d6c0: 6768 7427 0a20 2020 200a 2020 2020 706c  ght'.    .    pl
-0001d6d0: 6f74 4856 5352 203d 2046 616c 7365 0a20  otHVSR = False. 
-0001d6e0: 2020 2066 6f72 2069 7465 6d20 696e 206b     for item in k
-0001d6f0: 696e 643a 0a20 2020 2020 2020 2069 6620  ind:.        if 
-0001d700: 6974 656d 2e6c 6f77 6572 2829 3d3d 2768  item.lower()=='h
-0001d710: 7673 7227 3a0a 2020 2020 2020 2020 2020  vsr':.          
-0001d720: 2020 706c 6f74 4856 5352 3d54 7275 650a    plotHVSR=True.
-0001d730: 2020 2020 2020 2020 2020 2020 6178 2e70              ax.p
-0001d740: 6c6f 7428 782c 2079 2c20 636f 6c6f 723d  lot(x, y, color=
-0001d750: 276b 272c 206c 6162 656c 3d27 482f 5620  'k', label='H/V 
-0001d760: 5261 7469 6f27 2c20 7a6f 7264 6572 3d31  Ratio', zorder=1
-0001d770: 3030 3029 0a20 2020 2020 2020 2020 2020  000).           
-0001d780: 2070 6c6f 7453 7566 663d 2748 5653 5243   plotSuff='HVSRC
-0001d790: 7572 7665 5f27 0a20 2020 2020 2020 2020  urve_'.         
-0001d7a0: 2020 2069 6620 272d 7327 206e 6f74 2069     if '-s' not i
-0001d7b0: 6e20 6b69 6e64 3a0a 2020 2020 2020 2020  n kind:.        
-0001d7c0: 2020 2020 2020 2020 6178 2e66 696c 6c5f          ax.fill_
-0001d7d0: 6265 7477 6565 6e28 782c 2068 7673 725f  between(x, hvsr_
-0001d7e0: 6469 6374 5b27 6876 7372 6d32 275d 2c20  dict['hvsrm2'], 
-0001d7f0: 6876 7372 5f64 6963 745b 2768 7673 7270  hvsr_dict['hvsrp
-0001d800: 3227 5d2c 2063 6f6c 6f72 3d27 6b27 2c20  2'], color='k', 
-0001d810: 616c 7068 613d 302e 322c 206c 6162 656c  alpha=0.2, label
-0001d820: 3d27 5374 4465 7627 2c7a 6f72 6465 723d  ='StDev',zorder=
-0001d830: 3939 3729 0a20 2020 2020 2020 2020 2020  997).           
-0001d840: 2020 2020 2061 782e 706c 6f74 2878 2c20       ax.plot(x, 
-0001d850: 6876 7372 5f64 6963 745b 2768 7673 726d  hvsr_dict['hvsrm
-0001d860: 3227 5d2c 2063 6f6c 6f72 3d27 6b27 2c20  2'], color='k', 
-0001d870: 616c 7068 613d 302e 3235 2c20 6c69 6e65  alpha=0.25, line
-0001d880: 7769 6474 683d 302e 352c 207a 6f72 6465  width=0.5, zorde
-0001d890: 723d 3939 3829 0a20 2020 2020 2020 2020  r=998).         
-0001d8a0: 2020 2020 2020 2061 782e 706c 6f74 2878         ax.plot(x
-0001d8b0: 2c20 6876 7372 5f64 6963 745b 2768 7673  , hvsr_dict['hvs
-0001d8c0: 7270 3227 5d2c 2063 6f6c 6f72 3d27 6b27  rp2'], color='k'
-0001d8d0: 2c20 616c 7068 613d 302e 3235 2c20 6c69  , alpha=0.25, li
-0001d8e0: 6e65 7769 6474 683d 302e 352c 207a 6f72  newidth=0.5, zor
-0001d8f0: 6465 723d 3939 3929 0a20 2020 2020 2020  der=999).       
-0001d900: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001d910: 2020 2020 2020 2020 2020 2070 6c6f 7453             plotS
-0001d920: 7566 6620 3d20 706c 6f74 5375 6666 2b27  uff = plotSuff+'
-0001d930: 6e6f 5374 6444 6576 5f27 0a20 2020 2020  noStdDev_'.     
-0001d940: 2020 2020 2020 2062 7265 616b 0a0a 2020         break..  
-0001d950: 2020 6178 2e73 656d 696c 6f67 7828 290a    ax.semilogx().
-0001d960: 2020 2020 6178 2e73 6574 5f79 6c69 6d28      ax.set_ylim(
-0001d970: 796c 696d 290a 2020 2020 6178 2e73 6574  ylim).    ax.set
-0001d980: 5f78 6c69 6d28 786c 696d 290a 2020 2020  _xlim(xlim).    
-0001d990: 6178 2e73 6574 5f78 6c61 6265 6c28 786c  ax.set_xlabel(xl
-0001d9a0: 6162 656c 290a 2020 2020 6178 2e73 6574  abel).    ax.set
-0001d9b0: 5f79 6c61 6265 6c28 2748 2f56 2052 6174  _ylabel('H/V Rat
-0001d9c0: 696f 272b 275c 6e5b 272b 6876 7372 5f64  io'+'\n['+hvsr_d
-0001d9d0: 6963 745b 276d 6574 686f 6427 5d2b 275d  ict['method']+']
-0001d9e0: 2729 0a20 2020 2061 782e 7365 745f 7469  ').    ax.set_ti
-0001d9f0: 746c 6528 6876 7372 5f64 6963 745b 2769  tle(hvsr_dict['i
-0001da00: 6e70 7574 5f70 6172 616d 7327 5d5b 2773  nput_params']['s
-0001da10: 6974 6527 5d29 0a0a 0a20 2020 2066 6f72  ite'])...    for
-0001da20: 206b 2069 6e20 6b69 6e64 3a20 2020 0a20   k in kind:   . 
-0001da30: 2020 2020 2020 2069 6620 6b3d 3d27 7027         if k=='p'
-0001da40: 2061 6e64 2027 616c 6c27 206e 6f74 2069   and 'all' not i
-0001da50: 6e20 6b69 6e64 3a0a 2020 2020 2020 2020  n kind:.        
-0001da60: 2020 2020 706c 6f74 5375 6666 3d70 6c6f      plotSuff=plo
-0001da70: 7453 7566 662b 2742 6573 7450 6561 6b5f  tSuff+'BestPeak_
-0001da80: 270a 2020 2020 2020 2020 2020 2020 0a20  '.            . 
-0001da90: 2020 2020 2020 2020 2020 2062 6573 7450             bestP
-0001daa0: 6561 6b53 636f 7265 203d 2030 0a20 2020  eakScore = 0.   
-0001dab0: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
-0001dac0: 7020 696e 2065 6e75 6d65 7261 7465 2868  p in enumerate(h
-0001dad0: 7673 725f 6469 6374 5b27 5065 616b 2052  vsr_dict['Peak R
-0001dae0: 6570 6f72 7427 5d29 3a0a 2020 2020 2020  eport']):.      
-0001daf0: 2020 2020 2020 2020 2020 6966 2070 5b27            if p['
-0001db00: 5363 6f72 6527 5d20 3e20 6265 7374 5065  Score'] > bestPe
-0001db10: 616b 5363 6f72 653a 0a20 2020 2020 2020  akScore:.       
-0001db20: 2020 2020 2020 2020 2020 2020 2062 6573               bes
-0001db30: 7450 6561 6b53 636f 7265 203d 2070 5b27  tPeakScore = p['
-0001db40: 5363 6f72 6527 5d0a 2020 2020 2020 2020  Score'].        
-0001db50: 2020 2020 2020 2020 2020 2020 6265 7374              best
-0001db60: 5065 616b 203d 2070 0a0a 2020 2020 2020  Peak = p..      
-0001db70: 2020 2020 2020 6178 2e61 7876 6c69 6e65        ax.axvline
-0001db80: 2862 6573 7450 6561 6b5b 2766 3027 5d2c  (bestPeak['f0'],
-0001db90: 636f 6c6f 723d 276b 272c 206c 696e 6573  color='k', lines
-0001dba0: 7479 6c65 3d27 646f 7474 6564 272c 206c  tyle='dotted', l
-0001dbb0: 6162 656c 3d27 5065 616b 2729 2020 2020  abel='Peak')    
-0001dbc0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-0001dbd0: 2020 2069 6620 2761 6e6e 2720 696e 206b     if 'ann' in k
-0001dbe0: 696e 643a 0a20 2020 2020 2020 2020 2020  ind:.           
-0001dbf0: 2020 2020 2061 782e 616e 6e6f 7461 7465       ax.annotate
-0001dc00: 2827 5065 616b 2061 7420 272b 7374 7228  ('Peak at '+str(
-0001dc10: 726f 756e 6428 6265 7374 5065 616b 5b27  round(bestPeak['
-0001dc20: 6630 275d 2c32 2929 2b27 487a 272c 2028  f0'],2))+'Hz', (
-0001dc30: 6265 7374 5065 616b 5b27 6630 275d 2c20  bestPeak['f0'], 
-0001dc40: 6178 2e67 6574 5f79 6c69 6d28 295b 305d  ax.get_ylim()[0]
-0001dc50: 292c 2078 7963 6f6f 7264 733d 2764 6174  ), xycoords='dat
-0001dc60: 6127 2c20 0a20 2020 2020 2020 2020 2020  a', .           
-0001dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc80: 2020 2020 2068 6f72 697a 6f6e 7461 6c61       horizontala
-0001dc90: 6c69 676e 6d65 6e74 3d27 6365 6e74 6572  lignment='center
-0001dca0: 272c 2076 6572 7469 6361 6c61 6c69 676e  ', verticalalign
-0001dcb0: 6d65 6e74 3d27 626f 7474 6f6d 272c 200a  ment='bottom', .
+00003ab0: 6d65 285f 5f66 696c 655f 5f29 290a 2020  me(__file__)).  
+00003ac0: 2020 2020 2020 6d65 7461 5061 7468 3d20        metaPath= 
+00003ad0: 7265 706f 4469 722e 6a6f 696e 7061 7468  repoDir.joinpath
+00003ae0: 2827 2f72 6573 6f75 7263 6573 2f72 7333  ('/resources/rs3
+00003af0: 6476 375f 6d65 7461 6461 7461 2e69 6e76  dv7_metadata.inv
+00003b00: 2729 2e61 735f 706f 7369 7828 290a 2020  ').as_posix().  
+00003b10: 2020 2020 2020 7072 696e 7428 2755 7369        print('Usi
+00003b20: 6e67 2064 6566 6175 6c74 206d 6574 6164  ng default metad
+00003b30: 6174 6120 6669 6c65 2066 6f72 2052 6173  ata file for Ras
+00003b40: 7062 6572 7279 2053 6861 6b65 2076 2e37  pberry Shake v.7
+00003b50: 2063 6f6e 7461 696e 6564 2069 6e20 7265   contained in re
+00003b60: 706f 7369 746f 7279 2061 745c 6e27 2c20  pository at\n', 
+00003b70: 6d65 7461 5061 7468 290a 2020 2020 656c  metaPath).    el
+00003b80: 7365 3a0a 2020 2020 2020 2020 6966 2069  se:.        if i
+00003b90: 7369 6e73 7461 6e63 6528 6d65 7461 5061  sinstance(metaPa
+00003ba0: 7468 2c20 7061 7468 6c69 622e 5075 7265  th, pathlib.Pure
+00003bb0: 5061 7468 293a 0a20 2020 2020 2020 2020  Path):.         
+00003bc0: 2020 206d 6574 6150 6174 6820 3d20 6d65     metaPath = me
+00003bd0: 7461 5061 7468 2e61 735f 706f 7369 7828  taPath.as_posix(
+00003be0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00003bf0: 2020 2020 2020 2020 2020 2020 6d65 7461              meta
+00003c00: 5061 7468 203d 2070 6174 686c 6962 2e50  Path = pathlib.P
+00003c10: 6174 6828 6d65 7461 5061 7468 292e 6173  ath(metaPath).as
+00003c20: 5f70 6f73 6978 2829 0a0a 2020 2020 2352  _posix()..    #R
+00003c30: 6566 6f72 6d61 7420 7469 6d65 730a 2020  eformat times.  
+00003c40: 2020 6966 2074 7970 6528 6163 715f 6461    if type(acq_da
+00003c50: 7465 2920 6973 2064 6174 6574 696d 652e  te) is datetime.
+00003c60: 6461 7465 7469 6d65 3a0a 2020 2020 2020  datetime:.      
+00003c70: 2020 6461 7465 203d 2073 7472 2861 6371    date = str(acq
+00003c80: 5f64 6174 652e 6461 7465 2829 290a 2020  _date.date()).  
+00003c90: 2020 656c 6966 2074 7970 6528 6163 715f    elif type(acq_
+00003ca0: 6461 7465 2920 6973 2064 6174 6574 696d  date) is datetim
+00003cb0: 652e 6461 7465 3a0a 2020 2020 2020 2020  e.date:.        
+00003cc0: 6461 7465 3d73 7472 2861 6371 5f64 6174  date=str(acq_dat
+00003cd0: 6529 0a20 2020 2065 6c69 6620 7479 7065  e).    elif type
+00003ce0: 2861 6371 5f64 6174 6529 2069 7320 7374  (acq_date) is st
+00003cf0: 723a 0a20 2020 2020 2020 2064 6174 6520  r:.        date 
+00003d00: 3d20 6163 715f 6461 7465 0a20 2020 2065  = acq_date.    e
+00003d10: 6c69 6620 7479 7065 2861 6371 5f64 6174  lif type(acq_dat
+00003d20: 6529 2069 7320 696e 743a 0a20 2020 2020  e) is int:.     
+00003d30: 2020 2079 6561 723d 6461 7465 7469 6d65     year=datetime
+00003d40: 2e64 6174 6574 696d 652e 746f 6461 7928  .datetime.today(
+00003d50: 292e 7965 6172 0a20 2020 2020 2020 2064  ).year.        d
+00003d60: 6174 6520 3d20 7374 7228 2864 6174 6574  ate = str((datet
+00003d70: 696d 652e 6461 7465 7469 6d65 2879 6561  ime.datetime(yea
+00003d80: 722c 2031 2c20 3129 202b 2064 6174 6574  r, 1, 1) + datet
+00003d90: 696d 652e 7469 6d65 6465 6c74 6128 6163  ime.timedelta(ac
+00003da0: 715f 6461 7465 202d 2031 2929 2e64 6174  q_date - 1)).dat
+00003db0: 6528 2929 0a20 2020 200a 2020 2020 6966  e()).    .    if
+00003dc0: 2074 7970 6528 7374 6172 7474 696d 6529   type(starttime)
+00003dd0: 2069 7320 7374 723a 0a20 2020 2020 2020   is str:.       
+00003de0: 2069 6620 2754 2720 696e 2073 7461 7274   if 'T' in start
+00003df0: 7469 6d65 3a0a 2020 2020 2020 2020 2020  time:.          
+00003e00: 2020 6461 7465 3d73 7461 7274 7469 6d65    date=starttime
+00003e10: 2e73 706c 6974 2827 5427 295b 305d 0a20  .split('T')[0]. 
+00003e20: 2020 2020 2020 2020 2020 2073 7461 7274             start
+00003e30: 7469 6d65 203d 2073 7461 7274 7469 6d65  time = starttime
+00003e40: 2e73 706c 6974 2827 5427 295b 315d 0a20  .split('T')[1]. 
+00003e50: 2020 2065 6c69 6620 7479 7065 2873 7461     elif type(sta
+00003e60: 7274 7469 6d65 2920 6973 2064 6174 6574  rttime) is datet
+00003e70: 696d 652e 6461 7465 7469 6d65 3a0a 2020  ime.datetime:.  
+00003e80: 2020 2020 2020 6461 7465 203d 2073 7472        date = str
+00003e90: 2873 7461 7274 7469 6d65 2e64 6174 6528  (starttime.date(
+00003ea0: 2929 0a20 2020 2020 2020 2073 7461 7274  )).        start
+00003eb0: 7469 6d65 203d 2073 7472 2873 7461 7274  time = str(start
+00003ec0: 7469 6d65 2e74 696d 6528 2929 0a20 2020  time.time()).   
+00003ed0: 2065 6c69 6620 7479 7065 2873 7461 7274   elif type(start
+00003ee0: 7469 6d65 2920 6973 2064 6174 6574 696d  time) is datetim
+00003ef0: 652e 7469 6d65 2829 3a0a 2020 2020 2020  e.time():.      
+00003f00: 2020 7374 6172 7474 696d 6520 3d20 7374    starttime = st
+00003f10: 7228 7374 6172 7474 696d 6529 0a20 2020  r(starttime).   
+00003f20: 200a 2020 2020 7374 6172 7474 696d 6520   .    starttime 
+00003f30: 3d20 6461 7465 2b22 5422 2b73 7461 7274  = date+"T"+start
+00003f40: 7469 6d65 0a20 2020 2073 7461 7274 7469  time.    startti
+00003f50: 6d65 203d 206f 6273 7079 2e55 5443 4461  me = obspy.UTCDa
+00003f60: 7465 5469 6d65 285f 5f66 6f72 6d61 7454  teTime(__formatT
+00003f70: 696d 6528 7374 6172 7474 696d 652c 2074  ime(starttime, t
+00003f80: 7a6f 6e65 3d74 7a6f 6e65 2c20 6473 743d  zone=tzone, dst=
+00003f90: 6473 7429 290a 0a20 2020 2069 6620 7479  dst))..    if ty
+00003fa0: 7065 2865 6e64 7469 6d65 2920 6973 2073  pe(endtime) is s
+00003fb0: 7472 3a0a 2020 2020 2020 2020 6966 2027  tr:.        if '
+00003fc0: 5427 2069 6e20 656e 6474 696d 653a 0a20  T' in endtime:. 
+00003fd0: 2020 2020 2020 2020 2020 2064 6174 653d             date=
+00003fe0: 656e 6474 696d 652e 7370 6c69 7428 2754  endtime.split('T
+00003ff0: 2729 5b30 5d0a 2020 2020 2020 2020 2020  ')[0].          
+00004000: 2020 656e 6474 696d 6520 3d20 656e 6474    endtime = endt
+00004010: 696d 652e 7370 6c69 7428 2754 2729 5b31  ime.split('T')[1
+00004020: 5d0a 2020 2020 656c 6966 2074 7970 6528  ].    elif type(
+00004030: 656e 6474 696d 6529 2069 7320 6461 7465  endtime) is date
+00004040: 7469 6d65 2e64 6174 6574 696d 653a 0a20  time.datetime:. 
+00004050: 2020 2020 2020 2064 6174 6520 3d20 7374         date = st
+00004060: 7228 656e 6474 696d 652e 6461 7465 2829  r(endtime.date()
+00004070: 290a 2020 2020 2020 2020 656e 6474 696d  ).        endtim
+00004080: 6520 3d20 7374 7228 656e 6474 696d 652e  e = str(endtime.
+00004090: 7469 6d65 2829 290a 2020 2020 656c 6966  time()).    elif
+000040a0: 2074 7970 6528 656e 6474 696d 6529 2069   type(endtime) i
+000040b0: 7320 6461 7465 7469 6d65 2e74 696d 6528  s datetime.time(
+000040c0: 293a 0a20 2020 2020 2020 2065 6e64 7469  ):.        endti
+000040d0: 6d65 203d 2073 7472 2865 6e64 7469 6d65  me = str(endtime
+000040e0: 290a 0a20 2020 2065 6e64 7469 6d65 203d  )..    endtime =
+000040f0: 2064 6174 652b 2254 222b 656e 6474 696d   date+"T"+endtim
+00004100: 650a 2020 2020 656e 6474 696d 6520 3d20  e.    endtime = 
+00004110: 6f62 7370 792e 5554 4344 6174 6554 696d  obspy.UTCDateTim
+00004120: 6528 5f5f 666f 726d 6174 5469 6d65 2865  e(__formatTime(e
+00004130: 6e64 7469 6d65 2c20 747a 6f6e 653d 747a  ndtime, tzone=tz
+00004140: 6f6e 652c 2064 7374 3d64 7374 2929 0a0a  one, dst=dst))..
+00004150: 2020 2020 6163 715f 6461 7465 203d 2064      acq_date = d
+00004160: 6174 6574 696d 652e 6461 7465 2879 6561  atetime.date(yea
+00004170: 723d 696e 7428 6461 7465 2e73 706c 6974  r=int(date.split
+00004180: 2827 2d27 295b 305d 292c 206d 6f6e 7468  ('-')[0]), month
+00004190: 3d69 6e74 2864 6174 652e 7370 6c69 7428  =int(date.split(
+000041a0: 272d 2729 5b31 5d29 2c20 6461 793d 696e  '-')[1]), day=in
+000041b0: 7428 6461 7465 2e73 706c 6974 2827 2d27  t(date.split('-'
+000041c0: 295b 325d 2929 0a20 2020 2072 6173 7053  )[2])).    raspS
+000041d0: 6861 6b65 496e 7374 4e61 6d65 4c69 7374  hakeInstNameList
+000041e0: 203d 205b 2772 6173 7062 6572 7279 2073   = ['raspberry s
+000041f0: 6861 6b65 272c 2027 7368 616b 6527 2c20  hake', 'shake', 
+00004200: 2772 6173 7062 6572 7279 272c 2027 7273  'raspberry', 'rs
+00004210: 272c 2027 7273 3364 272c 2027 7261 7370  ', 'rs3d', 'rasp
+00004220: 2e20 7368 616b 6527 2c20 2772 6173 7073  . shake', 'rasps
+00004230: 6861 6b65 275d 0a20 2020 200a 2020 2020  hake'].    .    
+00004240: 2352 6173 7062 6572 7279 2073 6861 6b65  #Raspberry shake
+00004250: 2073 7461 7469 6f6e 786d 6c20 6973 2069   stationxml is i
+00004260: 6e20 7468 6520 7265 736f 7572 6365 7320  n the resources 
+00004270: 666f 6c64 6572 2c20 646f 7562 6c65 2063  folder, double c
+00004280: 6865 636b 2077 6520 6861 7665 2072 6967  heck we have rig
+00004290: 6874 2070 6174 680a 2020 2020 6966 2069  ht path.    if i
+000042a0: 6e73 7472 756d 656e 742e 6c6f 7765 7228  nstrument.lower(
+000042b0: 2920 696e 2020 7261 7370 5368 616b 6549  ) in  raspShakeI
+000042c0: 6e73 744e 616d 654c 6973 743a 0a20 2020  nstNameList:.   
+000042d0: 2020 2020 2069 6620 6d65 7461 5061 7468       if metaPath
+000042e0: 203d 3d20 7227 7265 736f 7572 6365 732f   == r'resources/
+000042f0: 7273 3364 7637 5f6d 6574 6164 6174 612e  rs3dv7_metadata.
+00004300: 696e 7627 3a0a 2020 2020 2020 2020 2020  inv':.          
+00004310: 2020 6d65 7461 5061 7468 203d 2070 6174    metaPath = pat
+00004320: 686c 6962 2e50 6174 6828 6f73 2e70 6174  hlib.Path(os.pat
+00004330: 682e 7265 616c 7061 7468 285f 5f66 696c  h.realpath(__fil
+00004340: 655f 5f29 292e 7061 7265 6e74 2e6a 6f69  e__)).parent.joi
+00004350: 6e70 6174 6828 272f 7265 736f 7572 6365  npath('/resource
+00004360: 732f 7273 3364 7637 5f6d 6574 6164 6174  s/rs3dv7_metadat
+00004370: 612e 696e 7627 290a 0a20 2020 2023 4164  a.inv')..    #Ad
+00004380: 6420 6b65 792f 7661 6c75 6573 2074 6f20  d key/values to 
+00004390: 696e 7075 7420 7061 7261 6d65 7465 7220  input parameter 
+000043a0: 6469 6374 696f 6e61 7279 0a20 2020 2069  dictionary.    i
+000043b0: 6e70 7574 5061 7261 6d44 6963 7420 3d20  nputParamDict = 
+000043c0: 7b27 6e65 7427 3a6e 6574 776f 726b 2c27  {'net':network,'
+000043d0: 7374 6127 3a73 7461 7469 6f6e 2c20 276c  sta':station, 'l
+000043e0: 6f63 273a 6c6f 632c 2027 6368 6127 3a63  oc':loc, 'cha':c
+000043f0: 6861 6e6e 656c 732c 2027 696e 7374 7275  hannels, 'instru
+00004400: 6d65 6e74 273a 696e 7374 7275 6d65 6e74  ment':instrument
+00004410: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004420: 2020 2020 2020 2761 6371 5f64 6174 6527        'acq_date'
+00004430: 3a61 6371 5f64 6174 652c 2773 7461 7274  :acq_date,'start
+00004440: 7469 6d65 273a 7374 6172 7474 696d 652c  time':starttime,
+00004450: 2765 6e64 7469 6d65 273a 656e 6474 696d  'endtime':endtim
+00004460: 652c 2027 7469 6d65 7a6f 6e65 273a 2755  e, 'timezone':'U
+00004470: 5443 272c 0a20 2020 2020 2020 2020 2020  TC',.           
+00004480: 2020 2020 2020 2020 2027 6c6f 6e67 6974           'longit
+00004490: 7564 6527 3a6c 6f6e 2c27 6c61 7469 7475  ude':lon,'latitu
+000044a0: 6465 273a 6c61 742c 2765 6c65 7661 7469  de':lat,'elevati
+000044b0: 6f6e 273a 656c 6576 6174 696f 6e2c 2764  on':elevation,'d
+000044c0: 6570 7468 273a 6465 7074 682c 2027 7369  epth':depth, 'si
+000044d0: 7465 273a 7369 7465 2c0a 2020 2020 2020  te':site,.      
+000044e0: 2020 2020 2020 2020 2020 2020 2020 2764                'd
+000044f0: 6174 6150 6174 6827 3a64 6174 6150 6174  ataPath':dataPat
+00004500: 682c 2027 6d65 7461 5061 7468 273a 6d65  h, 'metaPath':me
+00004510: 7461 5061 7468 2c20 2768 7673 725f 6261  taPath, 'hvsr_ba
+00004520: 6e64 273a 6876 7372 5f62 616e 640a 2020  nd':hvsr_band.  
+00004530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004540: 2020 7d0a 0a20 2020 2072 6574 7572 6e20    }..    return 
+00004550: 696e 7075 7450 6172 616d 4469 6374 0a0a  inputParamDict..
+00004560: 2352 6561 6420 696e 206d 6574 6164 6174  #Read in metadat
+00004570: 6120 2e69 6e76 2066 696c 652c 2073 7065  a .inv file, spe
+00004580: 6369 6669 6361 6c6c 7920 666f 7220 5261  cifically for Ra
+00004590: 7370 5368 616b 650a 6465 6620 7570 6461  spShake.def upda
+000045a0: 7465 5f73 6861 6b65 5f6d 6574 6164 6174  te_shake_metadat
+000045b0: 6128 6669 6c65 7061 7468 2c20 7061 7261  a(filepath, para
+000045c0: 6d73 2c20 7772 6974 655f 7061 7468 3d27  ms, write_path='
+000045d0: 2729 3a0a 2020 2020 2222 2252 6561 6473  '):.    """Reads
+000045e0: 2073 7461 7469 6320 6d65 7461 6461 7461   static metadata
+000045f0: 2066 696c 6520 7072 6f76 6964 6564 2066   file provided f
+00004600: 6f72 2052 6173 7020 5368 616b 6520 616e  or Rasp Shake an
+00004610: 6420 7570 6461 7465 7320 7769 7468 2069  d updates with i
+00004620: 6e70 7574 2070 6172 616d 6574 6572 732e  nput parameters.
+00004630: 2055 7365 6420 7072 696d 6172 696c 7920   Used primarily 
+00004640: 696e 2074 6865 2067 6574 5f6d 6574 6164  in the get_metad
+00004650: 6174 6128 2920 6675 6e63 7469 6f6e 2e0a  ata() function..
+00004660: 0a20 2020 2020 2020 2050 4152 414d 4554  .        PARAMET
+00004670: 4552 530a 2020 2020 2020 2020 2d2d 2d2d  ERS.        ----
+00004680: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2066  ------.        f
+00004690: 696c 6570 6174 6820 3a20 7374 7220 6f72  ilepath : str or
+000046a0: 2070 6174 686c 6962 2e50 6174 6820 6f62   pathlib.Path ob
+000046b0: 6a65 6374 0a20 2020 2020 2020 2020 2020  ject.           
+000046c0: 2046 696c 6570 6174 6820 746f 206d 6574   Filepath to met
+000046d0: 6164 6174 6120 6669 6c65 2e20 5368 6f75  adata file. Shou
+000046e0: 6c64 2062 6520 6120 6669 6c65 2066 6f72  ld be a file for
+000046f0: 6d61 7420 7375 7070 6f72 7465 6420 6279  mat supported by
+00004700: 206f 6273 7079 2e72 6561 645f 696e 7665   obspy.read_inve
+00004710: 6e74 6f72 7928 292e 0a20 2020 2020 2020  ntory()..       
+00004720: 2070 6172 616d 7320 3a20 6469 6374 0a20   params : dict. 
+00004730: 2020 2020 2020 2020 2020 2044 6963 7469             Dicti
+00004740: 6f6e 6172 7920 636f 6e74 6169 6e69 6e67  onary containing
+00004750: 206e 6563 6573 7361 7279 206b 6579 732f   necessary keys/
+00004760: 7661 6c75 6573 2066 6f72 2075 7064 6174  values for updat
+00004770: 696e 672c 2063 7572 7265 6e74 6c79 206f  ing, currently o
+00004780: 6e6c 7920 7375 7070 6f72 7465 6420 666f  nly supported fo
+00004790: 7220 5354 4154 494f 4e58 4d4c 2077 6974  r STATIONXML wit
+000047a0: 6820 5261 7370 6265 7272 7920 5368 616b  h Raspberry Shak
+000047b0: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
+000047c0: 2020 2020 4e65 6365 7373 6172 7920 6b65      Necessary ke
+000047d0: 7973 3a20 276e 6574 272c 2027 7374 6127  ys: 'net', 'sta'
+000047e0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+000047f0: 2020 204f 7074 696f 6e61 6c20 6b65 7973     Optional keys
+00004800: 3a20 276c 6f6e 6769 7475 6465 272c 2027  : 'longitude', '
+00004810: 6c61 7469 7475 6465 272c 2027 656c 6576  latitude', 'elev
+00004820: 6174 696f 6e27 2c20 2764 6570 7468 270a  ation', 'depth'.
+00004830: 2020 2020 2020 2020 7772 6974 655f 7061          write_pa
+00004840: 7468 2020 203a 2073 7472 2c20 6465 6661  th   : str, defa
+00004850: 756c 743d 2727 0a20 2020 2020 2020 2020  ult=''.         
+00004860: 2020 2049 6620 7370 6563 6966 6965 642c     If specified,
+00004870: 2066 696c 6570 6174 6820 746f 2077 7269   filepath to wri
+00004880: 7465 2074 6f20 7570 6461 7465 6420 696e  te to updated in
+00004890: 7665 6e74 6f72 7920 6669 6c65 2074 6f2e  ventory file to.
+000048a0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+000048b0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+000048c0: 2d0a 2020 2020 2020 2020 7061 7261 6d73  -.        params
+000048d0: 203a 2064 6963 740a 2020 2020 2020 2020   : dict.        
+000048e0: 2020 2020 5570 6461 7465 6420 7061 7261      Updated para
+000048f0: 6d73 2064 6963 7420 7769 7468 206e 6577  ms dict with new
+00004900: 206b 6579 3a76 616c 7565 2070 6169 7220   key:value pair 
+00004910: 7769 7468 2075 7064 6174 6564 2075 7064  with updated upd
+00004920: 6174 6564 206f 6273 7079 2e69 6e76 656e  ated obspy.inven
+00004930: 746f 7279 206f 626a 6563 7420 286b 6579  tory object (key
+00004940: 3d22 696e 7622 290a 2020 2020 2222 220a  ="inv").    """.
+00004950: 0a20 2020 206e 6574 776f 726b 203d 2070  .    network = p
+00004960: 6172 616d 735b 276e 6574 275d 0a20 2020  arams['net'].   
+00004970: 2073 7461 7469 6f6e 203d 2070 6172 616d   station = param
+00004980: 735b 2773 7461 275d 0a20 2020 206f 7074  s['sta'].    opt
+00004990: 4b65 7973 203d 205b 276c 6f6e 6769 7475  Keys = ['longitu
+000049a0: 6465 272c 2027 6c61 7469 7475 6465 272c  de', 'latitude',
+000049b0: 2027 656c 6576 6174 696f 6e27 2c20 2764   'elevation', 'd
+000049c0: 6570 7468 275d 0a20 2020 2066 6f72 206b  epth'].    for k
+000049d0: 2069 6e20 6f70 744b 6579 733a 0a20 2020   in optKeys:.   
+000049e0: 2020 2020 2069 6620 6b20 6e6f 7420 696e       if k not in
+000049f0: 2070 6172 616d 732e 6b65 7973 2829 3a0a   params.keys():.
+00004a00: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00004a10: 6d73 5b6b 5d20 3d20 2730 270a 2020 2020  ms[k] = '0'.    
+00004a20: 6c6f 6e20 3d20 7374 7228 7061 7261 6d73  lon = str(params
+00004a30: 5b27 6c6f 6e67 6974 7564 6527 5d29 0a20  ['longitude']). 
+00004a40: 2020 206c 6174 203d 2073 7472 2870 6172     lat = str(par
+00004a50: 616d 735b 276c 6174 6974 7564 6527 5d29  ams['latitude'])
+00004a60: 0a20 2020 2065 6c65 7661 7469 6f6e 203d  .    elevation =
+00004a70: 2073 7472 2870 6172 616d 735b 2765 6c65   str(params['ele
+00004a80: 7661 7469 6f6e 275d 290a 2020 2020 6465  vation']).    de
+00004a90: 7074 6820 3d20 7374 7228 7061 7261 6d73  pth = str(params
+00004aa0: 5b27 6465 7074 6827 5d29 0a20 2020 200a  ['depth']).    .
+00004ab0: 2020 2020 7374 6172 7464 6174 6520 3d20      startdate = 
+00004ac0: 7374 7228 6461 7465 7469 6d65 2e64 6174  str(datetime.dat
+00004ad0: 6574 696d 6528 7965 6172 3d32 3032 332c  etime(year=2023,
+00004ae0: 206d 6f6e 7468 3d32 2c20 6461 793d 3135   month=2, day=15
+00004af0: 2929 2023 4669 7273 7420 6461 7920 7769  )) #First day wi
+00004b00: 7468 2077 6f72 6b69 6e67 2063 6f64 650a  th working code.
+00004b10: 2020 2020 656e 6464 6174 653d 7374 7228      enddate=str(
+00004b20: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
+00004b30: 652e 746f 6461 7928 2929 0a0a 2020 2020  e.today())..    
+00004b40: 6669 6c65 7061 7468 203d 2063 6865 636b  filepath = check
+00004b50: 6966 7061 7468 2866 696c 6570 6174 6829  ifpath(filepath)
+00004b60: 0a0a 2020 2020 7472 6565 203d 2045 542e  ..    tree = ET.
+00004b70: 7061 7273 6528 7374 7228 6669 6c65 7061  parse(str(filepa
+00004b80: 7468 2929 0a20 2020 2072 6f6f 7420 3d20  th)).    root = 
+00004b90: 7472 6565 2e67 6574 726f 6f74 2829 0a0a  tree.getroot()..
+00004ba0: 2020 2020 7072 6566 6978 3d20 227b 6874      prefix= "{ht
+00004bb0: 7470 3a2f 2f77 7777 2e66 6473 6e2e 6f72  tp://www.fdsn.or
+00004bc0: 672f 786d 6c2f 7374 6174 696f 6e2f 317d  g/xml/station/1}
+00004bd0: 220a 0a20 2020 2066 6f72 2069 7465 6d20  "..    for item 
+00004be0: 696e 2072 6f6f 742e 6974 6572 2870 7265  in root.iter(pre
+00004bf0: 6669 782b 2743 6861 6e6e 656c 2729 3a0a  fix+'Channel'):.
+00004c00: 2020 2020 2020 2020 6974 656d 2e61 7474          item.att
+00004c10: 7269 625b 2773 7461 7274 4461 7465 275d  rib['startDate']
+00004c20: 203d 2073 7461 7274 6461 7465 0a20 2020   = startdate.   
+00004c30: 2020 2020 2069 7465 6d2e 6174 7472 6962       item.attrib
+00004c40: 5b27 656e 6444 6174 6527 5d20 3d20 656e  ['endDate'] = en
+00004c50: 6464 6174 650a 0a20 2020 2066 6f72 2069  ddate..    for i
+00004c60: 7465 6d20 696e 2072 6f6f 742e 6974 6572  tem in root.iter
+00004c70: 2870 7265 6669 782b 2753 7461 7469 6f6e  (prefix+'Station
+00004c80: 2729 3a0a 2020 2020 2020 2020 6974 656d  '):.        item
+00004c90: 2e61 7474 7269 625b 2763 6f64 6527 5d20  .attrib['code'] 
+00004ca0: 3d20 7374 6174 696f 6e0a 2020 2020 2020  = station.      
+00004cb0: 2020 6974 656d 2e61 7474 7269 625b 2773    item.attrib['s
+00004cc0: 7461 7274 4461 7465 275d 203d 2073 7461  tartDate'] = sta
+00004cd0: 7274 6461 7465 0a20 2020 2020 2020 2069  rtdate.        i
+00004ce0: 7465 6d2e 6174 7472 6962 5b27 656e 6444  tem.attrib['endD
+00004cf0: 6174 6527 5d20 3d20 656e 6464 6174 650a  ate'] = enddate.
+00004d00: 0a20 2020 2066 6f72 2069 7465 6d20 696e  .    for item in
+00004d10: 2072 6f6f 742e 6974 6572 2870 7265 6669   root.iter(prefi
+00004d20: 782b 274e 6574 776f 726b 2729 3a0a 2020  x+'Network'):.  
+00004d30: 2020 2020 2020 6974 656d 2e61 7474 7269        item.attri
+00004d40: 625b 2763 6f64 6527 5d20 3d20 6e65 7477  b['code'] = netw
+00004d50: 6f72 6b0a 2020 2020 2020 2020 0a20 2020  ork.        .   
+00004d60: 2066 6f72 2069 7465 6d20 696e 2072 6f6f   for item in roo
+00004d70: 742e 6974 6572 2870 7265 6669 782b 274c  t.iter(prefix+'L
+00004d80: 6174 6974 7564 6527 293a 0a20 2020 2020  atitude'):.     
+00004d90: 2020 2069 7465 6d2e 7465 7874 203d 206c     item.text = l
+00004da0: 6174 0a0a 2020 2020 666f 7220 6974 656d  at..    for item
+00004db0: 2069 6e20 726f 6f74 2e69 7465 7228 7072   in root.iter(pr
+00004dc0: 6566 6978 2b27 4c6f 6e67 6974 7564 6527  efix+'Longitude'
+00004dd0: 293a 0a20 2020 2020 2020 2069 7465 6d2e  ):.        item.
+00004de0: 7465 7874 203d 206c 6f6e 0a0a 2020 2020  text = lon..    
+00004df0: 666f 7220 6974 656d 2069 6e20 726f 6f74  for item in root
+00004e00: 2e69 7465 7228 7072 6566 6978 2b27 4372  .iter(prefix+'Cr
+00004e10: 6561 7465 6427 293a 0a20 2020 2020 2020  eated'):.       
+00004e20: 206e 6f77 5469 6d65 203d 2073 7472 2864   nowTime = str(d
+00004e30: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
+00004e40: 2e6e 6f77 2829 290a 2020 2020 2020 2020  .now()).        
+00004e50: 6974 656d 2e74 6578 7420 3d20 6e6f 7754  item.text = nowT
+00004e60: 696d 650a 0a20 2020 2066 6f72 2069 7465  ime..    for ite
+00004e70: 6d20 696e 2072 6f6f 742e 6974 6572 2870  m in root.iter(p
+00004e80: 7265 6669 782b 2745 6c65 7661 7469 6f6e  refix+'Elevation
+00004e90: 2729 3a0a 2020 2020 2020 2020 6974 656d  '):.        item
+00004ea0: 2e74 6578 743d 2065 6c65 7661 7469 6f6e  .text= elevation
+00004eb0: 0a0a 2020 2020 666f 7220 6974 656d 2069  ..    for item i
+00004ec0: 6e20 726f 6f74 2e69 7465 7228 7072 6566  n root.iter(pref
+00004ed0: 6978 2b27 4465 7074 6827 293a 0a20 2020  ix+'Depth'):.   
+00004ee0: 2020 2020 2069 7465 6d2e 7465 7874 3d64       item.text=d
+00004ef0: 6570 7468 0a0a 2020 2020 2353 6574 2075  epth..    #Set u
+00004f00: 7020 2861 6e64 2920 6578 706f 7274 0a20  p (and) export. 
+00004f10: 2020 2023 6669 6c65 7461 6720 3d20 275f     #filetag = '_
+00004f20: 272b 7374 7228 6461 7465 7469 6d65 2e64  '+str(datetime.d
+00004f30: 6174 6574 696d 652e 746f 6461 7928 292e  atetime.today().
+00004f40: 6461 7465 2829 290a 2020 2020 236f 7574  date()).    #out
+00004f50: 6669 6c65 203d 2073 7472 2870 6172 656e  file = str(paren
+00004f60: 7450 6174 6829 2b27 5c5c 272b 6669 6c65  tPath)+'\\'+file
+00004f70: 6e61 6d65 2b66 696c 6574 6167 2b27 2e69  name+filetag+'.i
+00004f80: 6e76 270a 0a20 2020 2069 6620 7772 6974  nv'..    if writ
+00004f90: 655f 7061 7468 2021 3d20 2727 3a0a 2020  e_path != '':.  
+00004fa0: 2020 2020 2020 7472 6565 2e77 7269 7465        tree.write
+00004fb0: 2877 7269 7465 5f70 6174 682c 2078 6d6c  (write_path, xml
+00004fc0: 5f64 6563 6c61 7261 7469 6f6e 3d54 7275  _declaration=Tru
+00004fd0: 652c 206d 6574 686f 643d 2778 6d6c 272c  e, method='xml',
+00004fe0: 656e 636f 6469 6e67 3d27 5554 462d 3827  encoding='UTF-8'
+00004ff0: 290a 2020 2020 2020 2020 696e 7620 3d20  ).        inv = 
+00005000: 6f62 7370 792e 7265 6164 5f69 6e76 656e  obspy.read_inven
+00005010: 746f 7279 2877 7269 7465 5f70 6174 682c  tory(write_path,
+00005020: 2066 6f72 6d61 743d 2753 5441 5449 4f4e   format='STATION
+00005030: 584d 4c27 2c20 6c65 7665 6c3d 2772 6573  XML', level='res
+00005040: 706f 6e73 6527 290a 2020 2020 656c 7365  ponse').    else
+00005050: 3a0a 2020 2020 2020 2020 2343 7265 6174  :.        #Creat
+00005060: 6520 7465 6d70 6f72 6172 7920 6669 6c65  e temporary file
+00005070: 2066 6f72 2072 6561 6469 6e67 2069 6e74   for reading int
+00005080: 6f20 6f62 7370 790a 2020 2020 2020 2020  o obspy.        
+00005090: 7470 6620 3d20 7465 6d70 6669 6c65 2e4e  tpf = tempfile.N
+000050a0: 616d 6564 5465 6d70 6f72 6172 7946 696c  amedTemporaryFil
+000050b0: 6528 6465 6c65 7465 3d46 616c 7365 290a  e(delete=False).
+000050c0: 2020 2020 2020 2020 7374 7269 6e67 526f          stringRo
+000050d0: 6f74 203d 2045 542e 746f 7374 7269 6e67  ot = ET.tostring
+000050e0: 2872 6f6f 742c 2065 6e63 6f64 696e 673d  (root, encoding=
+000050f0: 2755 5446 2d38 272c 206d 6574 686f 643d  'UTF-8', method=
+00005100: 2778 6d6c 2729 0a20 2020 2020 2020 2074  'xml').        t
+00005110: 7066 2e77 7269 7465 2873 7472 696e 6752  pf.write(stringR
+00005120: 6f6f 7429 0a0a 2020 2020 2020 2020 696e  oot)..        in
+00005130: 7620 3d20 6f62 7370 792e 7265 6164 5f69  v = obspy.read_i
+00005140: 6e76 656e 746f 7279 2874 7066 2e6e 616d  nventory(tpf.nam
+00005150: 652c 2066 6f72 6d61 743d 2753 5441 5449  e, format='STATI
+00005160: 4f4e 584d 4c27 2c20 6c65 7665 6c3d 2772  ONXML', level='r
+00005170: 6573 706f 6e73 6527 290a 2020 2020 2020  esponse').      
+00005180: 2020 7470 662e 636c 6f73 6528 290a 0a20    tpf.close().. 
+00005190: 2020 2020 2020 206f 732e 7265 6d6f 7665         os.remove
+000051a0: 2874 7066 2e6e 616d 6529 0a20 2020 2070  (tpf.name).    p
+000051b0: 6172 616d 735b 2769 6e76 275d 203d 2069  arams['inv'] = i
+000051c0: 6e76 0a20 2020 2072 6574 7572 6e20 7061  nv.    return pa
+000051d0: 7261 6d73 0a0a 2343 6f64 6520 746f 2068  rams..#Code to h
+000051e0: 656c 7020 7365 7475 7020 656e 7669 726f  elp setup enviro
+000051f0: 6e6d 656e 7420 696e 2047 6f6f 676c 6520  nment in Google 
+00005200: 436f 6c61 620a 6465 6620 7365 7475 705f  Colab.def setup_
+00005210: 636f 6c61 6228 6f70 7469 6f6e 3d27 272c  colab(option='',
+00005220: 2072 6570 6f5f 6469 723d 2727 293a 0a20   repo_dir=''):. 
+00005230: 2020 2022 2222 4675 6e63 7469 6f6e 2074     """Function t
+00005240: 6f20 6865 6c70 2073 6574 2075 7020 476f  o help set up Go
+00005250: 6f67 6c65 2043 6f6c 6162 2065 6e76 6972  ogle Colab envir
+00005260: 6f6e 6d65 6e74 2066 6f72 2053 5052 4954  onment for SPRIT
+00005270: 0a20 2020 200a 2020 2020 5468 6973 2069  .    .    This i
+00005280: 7320 6465 7369 676e 6564 2074 6f20 6265  s designed to be
+00005290: 2072 756e 2074 7769 6365 2069 6e20 6120   run twice in a 
+000052a0: 476f 6f67 6c65 2043 6f6c 6162 2065 6e76  Google Colab env
+000052b0: 6972 6f6e 6d65 6e74 2077 6974 686f 7574  ironment without
+000052c0: 2061 6e79 2070 6172 616d 6574 6572 732c   any parameters,
+000052d0: 2061 6e64 2061 7420 7468 6520 6265 6769   and at the begi
+000052e0: 6e6e 696e 6720 6f66 2074 6865 2047 6f6f  nning of the Goo
+000052f0: 676c 6520 436f 6c61 6220 6e6f 7465 626f  gle Colab notebo
+00005300: 6f6b 2e20 0a20 2020 2054 6865 2066 6972  ok. .    The fir
+00005310: 7374 2072 756e 2077 696c 6c20 696e 7374  st run will inst
+00005320: 616c 6c20 6f62 7370 7920 2877 6869 6368  all obspy (which
+00005330: 2069 7320 6e6f 7420 696e 7374 616c 6c65   is not installe
+00005340: 6420 6f6e 2043 6f6c 6162 2062 7920 6465  d on Colab by de
+00005350: 6661 756c 7429 2c20 7468 656e 2072 6573  fault), then res
+00005360: 7461 7274 2074 6865 206b 6572 6e65 6c20  tart the kernel 
+00005370: 286e 6563 6573 7361 7279 2066 6f72 2043  (necessary for C
+00005380: 6f6c 6162 2074 6f20 7275 6e20 6f62 7370  olab to run obsp
+00005390: 7920 6566 6665 6374 6976 656c 7929 2e0a  y effectively)..
+000053a0: 2020 2020 5468 6520 7365 636f 6e64 2072      The second r
+000053b0: 756e 2077 696c 6c20 2269 6e73 7461 6c6c  un will "install
+000053c0: 2220 7468 6520 7265 706f 7369 746f 7279  " the repository
+000053d0: 2e20 0a20 2020 200a 2020 2020 5468 6973  . .    .    This
+000053e0: 2077 696c 6c20 6265 2063 6861 6e67 6564   will be changed
+000053f0: 2064 7261 6d61 7469 6361 6c6c 7920 6f6e   dramatically on
+00005400: 6365 2074 6865 2072 6570 6f73 6974 6f72  ce the repositor
+00005410: 7920 6973 2072 6561 6479 2066 6f72 2064  y is ready for d
+00005420: 6973 7472 7562 7574 696f 6e20 7669 6120  istrubution via 
+00005430: 7079 7069 2e0a 2020 2020 0a20 2020 2050  pypi..    .    P
+00005440: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00005450: 2d2d 2d2d 2d2d 2d2d 0a20 2020 206f 7074  --------.    opt
+00005460: 696f 6e20 3a20 7374 722c 2064 6566 6175  ion : str, defau
+00005470: 6c74 3d27 270a 2020 2020 2020 2020 5768  lt=''.        Wh
+00005480: 6963 6820 6974 6572 6174 696f 6e20 746f  ich iteration to
+00005490: 2072 756e 206f 6620 7365 7475 705f 636f   run of setup_co
+000054a0: 6c61 622e 2042 6520 6465 6661 756c 742c  lab. Be default,
+000054b0: 2074 6869 7320 6675 6e63 7469 6f6e 2063   this function c
+000054c0: 616e 2064 6574 6572 6d69 6e65 2077 6869  an determine whi
+000054d0: 6368 2022 6974 6572 6174 696f 6e22 2069  ch "iteration" i
+000054e0: 7420 6e65 6564 7320 746f 2072 756e 2c20  t needs to run, 
+000054f0: 6275 7420 6974 2063 616e 2062 6520 7370  but it can be sp
+00005500: 6563 6966 6965 6420 6d61 6e75 616c 6c79  ecified manually
+00005510: 2e0a 2020 2020 7265 706f 5f64 6972 203a  ..    repo_dir :
+00005520: 2073 7472 206f 7220 7061 7468 6c69 622e   str or pathlib.
+00005530: 5061 7468 2c20 6465 6661 756c 743d 2727  Path, default=''
+00005540: 0a20 2020 2020 2020 2057 6865 7265 2074  .        Where t
+00005550: 6865 2072 6570 6f73 6974 6f72 7920 6861  he repository ha
+00005560: 7320 6265 656e 2022 696e 7374 616c 6c65  s been "installe
+00005570: 6422 2f65 7874 7261 6374 6564 2069 6e20  d"/extracted in 
+00005580: 7468 6520 436f 6c61 6220 666f 6c64 6572  the Colab folder
+00005590: 2073 7472 7563 7475 7265 2e0a 2020 2020   structure..    
+000055a0: 2020 2020 0a20 2020 2052 6574 7572 6e73      .    Returns
+000055b0: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+000055c0: 204e 6f6e 650a 0a20 2020 2022 2222 0a20   None..    """. 
+000055d0: 2020 2069 6d70 6f72 7420 6461 7465 7469     import dateti
+000055e0: 6d65 0a20 2020 2069 6d70 6f72 7420 6d61  me.    import ma
+000055f0: 7468 0a20 2020 2069 6d70 6f72 7420 6f73  th.    import os
+00005600: 0a20 2020 2069 6d70 6f72 7420 7061 7468  .    import path
+00005610: 6c69 620a 2020 2020 696d 706f 7274 2074  lib.    import t
+00005620: 696d 650a 2020 2020 696d 706f 7274 2073  ime.    import s
+00005630: 7973 0a20 2020 2069 6d70 6f72 7420 7375  ys.    import su
+00005640: 6270 726f 6365 7373 0a0a 2020 2020 696d  bprocess..    im
+00005650: 706f 7274 206d 6174 706c 6f74 6c69 622e  port matplotlib.
+00005660: 7079 706c 6f74 2061 7320 706c 740a 2020  pyplot as plt.  
+00005670: 2020 696d 706f 7274 206e 756d 7079 2061    import numpy a
+00005680: 7320 6e70 0a20 2020 2069 6d70 6f72 7420  s np.    import 
+00005690: 7363 6970 790a 0a20 2020 2066 726f 6d20  scipy..    from 
+000056a0: 676f 6f67 6c65 2e63 6f6c 6162 2069 6d70  google.colab imp
+000056b0: 6f72 7420 6669 6c65 730a 2020 2020 6672  ort files.    fr
+000056c0: 6f6d 207a 6970 6669 6c65 2069 6d70 6f72  om zipfile impor
+000056d0: 7420 5a69 7046 696c 650a 2020 2020 2325  t ZipFile.    #%
+000056e0: 6d61 7470 6c6f 746c 6962 2023 5275 6e20  matplotlib #Run 
+000056f0: 7468 6973 206c 696e 6520 6966 2079 6f75  this line if you
+00005700: 2077 616e 7420 696e 7465 7261 6374 6976   want interactiv
+00005710: 6520 706c 6f74 730a 2020 2020 2368 7474  e plots.    #htt
+00005720: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+00005730: 676f 6f67 6c65 636f 6c61 622f 636f 6c61  googlecolab/cola
+00005740: 6274 6f6f 6c73 2f62 6c6f 622f 6d61 696e  btools/blob/main
+00005750: 2f67 6f6f 676c 652f 636f 6c61 622f 5f73  /google/colab/_s
+00005760: 7973 7465 6d5f 636f 6d6d 616e 6473 2e70  ystem_commands.p
+00005770: 790a 2020 2020 6672 6f6d 2067 6f6f 676c  y.    from googl
+00005780: 652e 636f 6c61 6220 696d 706f 7274 205f  e.colab import _
+00005790: 7379 7374 656d 5f63 6f6d 6d61 6e64 730a  system_commands.
+000057a0: 2020 2020 7079 7665 7273 203d 205f 7379      pyvers = _sy
+000057b0: 7374 656d 5f63 6f6d 6d61 6e64 732e 5f72  stem_commands._r
+000057c0: 756e 5f63 6f6d 6d61 6e64 2827 7079 7468  un_command('pyth
+000057d0: 6f6e 202d 2d76 6572 7369 6f6e 272c 2046  on --version', F
+000057e0: 616c 7365 290a 2020 2020 7079 7665 7273  alse).    pyvers
+000057f0: 203d 2070 7976 6572 732e 6f75 7470 7574   = pyvers.output
+00005800: 2e73 706c 6974 2827 2027 2923 2b70 7976  .split(' ')#+pyv
+00005810: 6572 732e 6f75 7470 7574 2e73 706c 6974  ers.output.split
+00005820: 2827 2e27 295b 315d 0a20 2020 2070 7976  ('.')[1].    pyv
+00005830: 6572 7320 3d20 7079 7665 7273 5b30 5d2e  ers = pyvers[0].
+00005840: 6c6f 7765 7228 292b 7079 7665 7273 5b31  lower()+pyvers[1
+00005850: 5d2e 7370 6c69 7428 272e 2729 5b30 5d2b  ].split('.')[0]+
+00005860: 272e 272b 7079 7665 7273 5b31 5d2e 7370  '.'+pyvers[1].sp
+00005870: 6c69 7428 272e 2729 5b31 5d0a 0a20 2020  lit('.')[1]..   
+00005880: 2023 5365 7475 7020 6d61 7470 6c6f 746c   #Setup matplotl
+00005890: 6962 2074 6f6f 3f0a 2020 2020 235f 7379  ib too?.    #_sy
+000058a0: 7374 656d 5f63 6f6d 6d61 6e64 732e 5f72  stem_commands._r
+000058b0: 756e 5f63 6f6d 6d61 6e64 2827 6d61 7470  un_command('matp
+000058c0: 6c6f 746c 6962 2071 7427 2c20 4661 6c73  lotlib qt', Fals
+000058d0: 6529 0a0a 2020 2020 7061 636b 5061 7468  e)..    packPath
+000058e0: 203d 2027 2f75 7372 2f6c 6f63 616c 2f6c   = '/usr/local/l
+000058f0: 6962 2f27 2b70 7976 6572 732b 272f 6469  ib/'+pyvers+'/di
+00005900: 7374 2d70 6163 6b61 6765 7327 0a20 2020  st-packages'.   
+00005910: 2070 6163 6b50 6174 6820 3d20 7061 7468   packPath = path
+00005920: 6c69 622e 5061 7468 2870 6163 6b50 6174  lib.Path(packPat
+00005930: 6829 0a20 2020 200a 2020 2020 234d 616b  h).    .    #Mak
+00005940: 6520 6469 7265 6374 6f72 6965 730a 2020  e directories.  
+00005950: 2020 6461 7461 4469 7220 3d20 272f 636f    dataDir = '/co
+00005960: 6e74 656e 742f 4461 7461 2f27 0a20 2020  ntent/Data/'.   
+00005970: 206f 7574 7075 7444 6972 203d 2027 2f63   outputDir = '/c
+00005980: 6f6e 7465 6e74 2f4f 7574 7075 7427 0a20  ontent/Output'. 
+00005990: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
+000059a0: 682e 6578 6973 7473 2864 6174 6144 6972  h.exists(dataDir
+000059b0: 293a 0a20 2020 2020 2020 206f 732e 6d61  ):.        os.ma
+000059c0: 6b65 6469 7273 2864 6174 6144 6972 290a  kedirs(dataDir).
+000059d0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+000059e0: 7468 2e65 7869 7374 7328 6f75 7470 7574  th.exists(output
+000059f0: 4469 7229 3a0a 2020 2020 2020 2020 6f73  Dir):.        os
+00005a00: 2e6d 616b 6564 6972 7328 6f75 7470 7574  .makedirs(output
+00005a10: 4469 7229 2020 2020 0a20 2020 200a 2020  Dir)    .    .  
+00005a20: 2020 6f62 7370 7949 6e73 7461 6c6c 6564    obspyInstalled
+00005a30: 3d46 616c 7365 0a20 2020 2066 6f72 2066  =False.    for f
+00005a40: 2069 6e20 7061 636b 5061 7468 2e69 7465   in packPath.ite
+00005a50: 7264 6972 2829 3a0a 2020 2020 2020 2020  rdir():.        
+00005a60: 6966 2027 6f62 7370 7927 2069 6e20 662e  if 'obspy' in f.
+00005a70: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
+00005a80: 2020 6f62 7370 7949 6e73 7461 6c6c 6564    obspyInstalled
+00005a90: 3d54 7275 650a 2020 2020 2020 2020 2020  =True.          
+00005aa0: 2020 676c 6f62 616c 206f 6273 7079 0a20    global obspy. 
+00005ab0: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
+00005ac0: 7420 6f62 7370 790a 2020 2020 2020 2020  t obspy.        
+00005ad0: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+00005ae0: 2020 0a20 2020 2069 6620 276f 6273 7079    .    if 'obspy
+00005af0: 2720 696e 206f 7074 696f 6e20 6f72 206f  ' in option or o
+00005b00: 7074 696f 6e3d 3d27 273a 0a20 2020 2020  ption=='':.     
+00005b10: 2020 2069 6620 6e6f 7420 6f62 7370 7949     if not obspyI
+00005b20: 6e73 7461 6c6c 6564 3a0a 2020 2020 2020  nstalled:.      
+00005b30: 2020 2020 2020 7072 696e 7428 2749 6e73        print('Ins
+00005b40: 7461 6c6c 696e 6720 4f62 7370 7927 290a  talling Obspy').
+00005b50: 2020 2020 2020 2020 2020 2020 5f73 7973              _sys
+00005b60: 7465 6d5f 636f 6d6d 616e 6473 2e5f 7275  tem_commands._ru
+00005b70: 6e5f 636f 6d6d 616e 6428 2770 6970 2069  n_command('pip i
+00005b80: 6e73 7461 6c6c 206f 6273 7079 272c 2046  nstall obspy', F
+00005b90: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
+00005ba0: 2020 7072 696e 7428 2252 756e 7469 6d65    print("Runtime
+00005bb0: 2077 696c 6c20 6e6f 7720 6265 2072 6573   will now be res
+00005bc0: 6574 2074 6f20 7072 6f70 6572 6c79 206c  et to properly l
+00005bd0: 6f61 6420 6f62 7370 7922 290a 2020 2020  oad obspy").    
+00005be0: 2020 2020 2020 2020 7072 696e 7428 2750          print('P
+00005bf0: 6c65 6173 6520 7275 6e20 7365 7475 705f  lease run setup_
+00005c00: 636f 6c61 6228 2920 746f 2075 706c 6f61  colab() to uploa
+00005c10: 6420 6461 7461 2061 6e64 2065 6e74 6572  d data and enter
+00005c20: 2063 6f64 6520 656e 7669 726f 6e6d 656e   code environmen
+00005c30: 742e 2729 0a20 2020 2020 2020 2020 2020  t.').           
+00005c40: 206f 732e 6b69 6c6c 286f 732e 6765 7470   os.kill(os.getp
+00005c50: 6964 2829 2c20 3929 0a20 2020 2020 2020  id(), 9).       
+00005c60: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00005c70: 2020 2067 6c6f 6261 6c20 6f62 7370 790a     global obspy.
+00005c80: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+00005c90: 7274 206f 6273 7079 0a20 2020 2020 2020  rt obspy.       
+00005ca0: 2020 2020 2070 7269 6e74 2827 4f62 7370       print('Obsp
+00005cb0: 7920 6861 7320 6265 656e 2069 6d70 6f72  y has been impor
+00005cc0: 7465 642e 2729 200a 2020 2020 656c 6966  ted.') .    elif
+00005cd0: 2027 6461 7461 2720 696e 206f 7074 696f   'data' in optio
+00005ce0: 6e3a 0a20 2020 2020 2020 2067 6c6f 6261  n:.        globa
+00005cf0: 6c20 6f62 7370 790a 2020 2020 2020 2020  l obspy.        
+00005d00: 696d 706f 7274 206f 6273 7079 0a20 2020  import obspy.   
+00005d10: 2020 2020 2070 7269 6e74 2827 4f62 7370       print('Obsp
+00005d20: 7920 6861 7320 6265 656e 2069 6e73 7461  y has been insta
+00005d30: 6c6c 6564 2069 6d70 6f72 7465 642e 2729  lled imported.')
+00005d40: 0a0a 2020 2020 2020 2020 6f73 2e63 6864  ..        os.chd
+00005d50: 6972 2864 6174 6144 6972 290a 2020 2020  ir(dataDir).    
+00005d60: 2020 2020 7072 696e 7428 275c 6e55 706c      print('\nUpl
+00005d70: 6f61 6420 6461 7461 2066 696c 6528 7329  oad data file(s)
+00005d80: 3a20 5c6e 2866 696c 6528 7329 2077 696c  : \n(file(s) wil
+00005d90: 6c20 6265 2070 6c61 6365 6420 696e 2027  l be placed in '
+00005da0: 2b64 6174 6144 6972 2b27 2927 290a 2020  +dataDir+')').  
+00005db0: 2020 2020 2020 6669 6c65 732e 7570 6c6f        files.uplo
+00005dc0: 6164 2829 2023 5570 6c6f 6164 2074 6865  ad() #Upload the
+00005dd0: 2033 2064 6174 6120 6669 6c65 7320 746f   3 data files to
+00005de0: 2062 6520 7573 6564 0a20 2020 2020 2020   be used.       
+00005df0: 2069 6620 7265 706f 5f64 6972 203d 3d20   if repo_dir == 
+00005e00: 2727 3a0a 2020 2020 2020 2020 2020 2020  '':.            
+00005e10: 7265 706f 5f64 6972 3d27 2f63 6f6e 7465  repo_dir='/conte
+00005e20: 6e74 2f53 5052 4954 270a 2020 2020 2020  nt/SPRIT'.      
+00005e30: 2020 6f73 2e63 6864 6972 2872 6570 6f5f    os.chdir(repo_
+00005e40: 6469 7229 0a20 2020 2072 6574 7572 6e0a  dir).    return.
+00005e50: 0a23 4c61 756e 6368 2074 6865 2067 7569  .#Launch the gui
+00005e60: 0a64 6566 2067 7569 2829 3a0a 2020 2020  .def gui():.    
+00005e70: 2222 2246 756e 6374 696f 6e20 746f 206f  """Function to o
+00005e80: 7065 6e20 6120 7769 6e64 6f77 2077 6974  pen a window wit
+00005e90: 6820 6120 6772 6170 6869 6361 6c20 7573  h a graphical us
+00005ea0: 6572 2069 6e74 6572 6661 6365 2028 6775  er interface (gu
+00005eb0: 6929 0a20 2020 200a 2020 2020 4e6f 2070  i).    .    No p
+00005ec0: 6172 616d 6574 6572 732c 206e 6f20 7265  arameters, no re
+00005ed0: 7475 726e 733b 206a 7573 7420 6f70 656e  turns; just open
+00005ee0: 7320 7468 6520 6775 6920 7769 6e64 6f77  s the gui window
+00005ef0: 2e0a 2020 2020 2222 220a 2020 2020 2367  ..    """.    #g
+00005f00: 7569 5061 7468 203d 2070 6174 686c 6962  uiPath = pathlib
+00005f10: 2e50 6174 6828 6f73 2e70 6174 682e 7265  .Path(os.path.re
+00005f20: 616c 7061 7468 285f 5f66 696c 655f 5f29  alpath(__file__)
+00005f30: 290a 2020 2020 2370 7269 6e74 2867 7569  ).    #print(gui
+00005f40: 5061 7468 2e6a 6f69 6e70 6174 6828 2767  Path.joinpath('g
+00005f50: 7569 2f74 6b67 7569 2e70 7927 292e 6173  ui/tkgui.py').as
+00005f60: 5f70 6f73 6978 2829 290a 2020 2020 6672  _posix()).    fr
+00005f70: 6f6d 2073 7072 6974 2e73 7072 6974 5f67  om sprit.sprit_g
+00005f80: 7569 2069 6d70 6f72 7420 4170 700a 2020  ui import App.  
+00005f90: 2020 696d 706f 7274 2074 6b69 6e74 6572    import tkinter
+00005fa0: 2061 7320 746b 0a0a 2020 2020 6465 6620   as tk..    def 
+00005fb0: 6f6e 5f67 7569 5f63 6c6f 7369 6e67 2829  on_gui_closing()
+00005fc0: 3a0a 2020 2020 2020 2020 706c 742e 636c  :.        plt.cl
+00005fd0: 6f73 6528 2761 6c6c 2729 0a20 2020 2020  ose('all').     
+00005fe0: 2020 2067 7569 5f72 6f6f 742e 7175 6974     gui_root.quit
+00005ff0: 2829 0a20 2020 2020 2020 2067 7569 5f72  ().        gui_r
+00006000: 6f6f 742e 6465 7374 726f 7928 290a 0a20  oot.destroy().. 
+00006010: 2020 2067 7569 5f72 6f6f 7420 3d20 746b     gui_root = tk
+00006020: 2e54 6b28 290a 2020 2020 6775 695f 726f  .Tk().    gui_ro
+00006030: 6f74 2e69 636f 6e62 6974 6d61 7028 7061  ot.iconbitmap(pa
+00006040: 7468 6c69 622e 5061 7468 286f 732e 7061  thlib.Path(os.pa
+00006050: 7468 2e64 6972 6e61 6d65 285f 5f66 696c  th.dirname(__fil
+00006060: 655f 5f29 292e 6a6f 696e 7061 7468 2822  e__)).joinpath("
+00006070: 2f72 6573 6f75 7263 6573 2f73 7072 6974  /resources/sprit
+00006080: 5f69 636f 6e5f 616c 7068 612e 6963 6f22  _icon_alpha.ico"
+00006090: 2929 0a20 2020 2041 7070 286d 6173 7465  )).    App(maste
+000060a0: 723d 6775 695f 726f 6f74 2920 234f 7065  r=gui_root) #Ope
+000060b0: 6e20 7468 6520 6170 7020 7769 7468 2061  n the app with a
+000060c0: 2074 6b2e 546b 2072 6f6f 740a 0a20 2020   tk.Tk root..   
+000060d0: 2067 7569 5f72 6f6f 742e 7072 6f74 6f63   gui_root.protoc
+000060e0: 6f6c 2822 574d 5f44 454c 4554 455f 5749  ol("WM_DELETE_WI
+000060f0: 4e44 4f57 222c 206f 6e5f 6775 695f 636c  NDOW", on_gui_cl
+00006100: 6f73 696e 6729 2020 2020 0a20 2020 2067  osing)    .    g
+00006110: 7569 5f72 6f6f 742e 6d61 696e 6c6f 6f70  ui_root.mainloop
+00006120: 2829 2023 5275 6e20 7468 6520 6d61 696e  () #Run the main
+00006130: 206c 6f6f 700a 2020 2020 0a23 5375 7070   loop.    .#Supp
+00006140: 6f72 7420 6675 6e63 7469 6f6e 2066 6f72  ort function for
+00006150: 2067 6574 5f6d 6574 6164 6174 6128 290a   get_metadata().
+00006160: 6465 6620 5f72 6561 645f 5253 5f4d 6574  def _read_RS_Met
+00006170: 6164 6174 6128 7061 7261 6d73 293a 0a20  adata(params):. 
+00006180: 2020 2022 2222 4675 6e63 7469 6f6e 2074     """Function t
+00006190: 6f20 7265 6164 2074 6865 206d 6574 6164  o read the metad
+000061a0: 6174 6120 6672 6f6d 2052 6173 7062 6572  ata from Raspber
+000061b0: 7279 2053 6861 6b65 2075 7369 6e67 2074  ry Shake using t
+000061c0: 6865 2053 7461 7469 6f6e 584d 4c20 6669  he StationXML fi
+000061d0: 6c65 2070 726f 7669 6465 6420 6279 2074  le provided by t
+000061e0: 6865 2063 6f6d 7061 6e79 2e0a 2020 2020  he company..    
+000061f0: 496e 7465 6e64 6564 2074 6f20 6265 2075  Intended to be u
+00006200: 7365 6420 7769 7468 696e 2074 6865 2067  sed within the g
+00006210: 6574 5f6d 6574 6164 6174 6128 2920 6675  et_metadata() fu
+00006220: 6e63 7469 6f6e 2e0a 0a20 2020 2050 6172  nction...    Par
+00006230: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+00006240: 2d2d 2d2d 2d2d 0a20 2020 2070 6172 616d  ------.    param
+00006250: 7320 3a20 6469 6374 0a20 2020 2020 2020  s : dict.       
+00006260: 2054 6865 2070 6172 616d 6574 6572 2064   The parameter d
+00006270: 6963 7469 6f6e 6172 7920 6f75 7470 7574  ictionary output
+00006280: 2066 726f 6d20 696e 7075 745f 7061 7261   from input_para
+00006290: 6d73 2829 2061 6e64 2072 6561 6420 696e  ms() and read in
+000062a0: 746f 2067 6574 5f6d 6574 6164 6174 6128  to get_metadata(
+000062b0: 290a 0a20 2020 2052 6574 7572 6e73 0a20  )..    Returns. 
+000062c0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2070     -------.    p
+000062d0: 6172 616d 7320 3a20 6469 6374 0a20 2020  arams : dict.   
+000062e0: 2020 2020 2046 7572 7468 6572 206d 6f64       Further mod
+000062f0: 6966 6965 6420 7061 7261 6d65 7465 7220  ified parameter 
+00006300: 6469 6374 696f 6e61 7279 0a20 2020 2022  dictionary.    "
+00006310: 2222 0a20 2020 2069 6e76 203d 2070 6172  "".    inv = par
+00006320: 616d 735b 2769 6e76 275d 0a0a 2020 2020  ams['inv']..    
+00006330: 6966 2069 7369 6e73 7461 6e63 6528 696e  if isinstance(in
+00006340: 762c 2070 6174 686c 6962 2e50 7572 6550  v, pathlib.PureP
+00006350: 6174 6829 206f 7220 7479 7065 2869 6e76  ath) or type(inv
+00006360: 2920 6973 2073 7472 3a0a 2020 2020 2020  ) is str:.      
+00006370: 2020 696e 7620 3d20 6368 6563 6b69 6670    inv = checkifp
+00006380: 6174 6828 696e 7629 0a20 2020 2020 2020  ath(inv).       
+00006390: 2074 7265 6520 3d20 4554 2e70 6172 7365   tree = ET.parse
+000063a0: 2869 6e76 290a 2020 2020 2020 2020 726f  (inv).        ro
+000063b0: 6f74 203d 2074 7265 652e 6765 7472 6f6f  ot = tree.getroo
+000063c0: 7428 290a 0a20 2020 2073 7461 7469 6f6e  t()..    station
+000063d0: 203d 2070 6172 616d 735b 2773 7461 275d   = params['sta']
+000063e0: 0a20 2020 206e 6574 776f 726b 203d 2070  .    network = p
+000063f0: 6172 616d 735b 276e 6574 275d 0a20 2020  arams['net'].   
+00006400: 2063 6861 6e6e 656c 7320 3d20 7061 7261   channels = para
+00006410: 6d73 5b27 6368 6127 5d0a 0a20 2020 2069  ms['cha']..    i
+00006420: 6620 6973 696e 7374 616e 6365 2869 6e76  f isinstance(inv
+00006430: 2c20 7061 7468 6c69 622e 5075 7265 5061  , pathlib.PurePa
+00006440: 7468 293a 0a20 2020 2020 2020 2069 6e76  th):.        inv
+00006450: 203d 2063 6865 636b 6966 7061 7468 2869   = checkifpath(i
+00006460: 6e76 290a 2020 2020 2020 2020 7472 6565  nv).        tree
+00006470: 203d 2045 542e 7061 7273 6528 696e 7629   = ET.parse(inv)
+00006480: 0a20 2020 2020 2020 2072 6f6f 7420 3d20  .        root = 
+00006490: 7472 6565 2e67 6574 726f 6f74 2829 0a20  tree.getroot(). 
+000064a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000064b0: 2023 4372 6561 7465 2074 656d 706f 7261   #Create tempora
+000064c0: 7279 2066 696c 6520 6672 6f6d 2069 6e76  ry file from inv
+000064d0: 656e 746f 7279 206f 626a 6563 740a 2020  entory object.  
+000064e0: 2020 2020 2020 7470 6620 3d20 7465 6d70        tpf = temp
+000064f0: 6669 6c65 2e4e 616d 6564 5465 6d70 6f72  file.NamedTempor
+00006500: 6172 7946 696c 6528 6465 6c65 7465 3d46  aryFile(delete=F
+00006510: 616c 7365 290a 2020 2020 2020 2020 696e  alse).        in
+00006520: 762e 7772 6974 6528 7470 662e 6e61 6d65  v.write(tpf.name
+00006530: 2c20 666f 726d 6174 3d27 5354 4154 494f  , format='STATIO
+00006540: 4e58 4d4c 2729 0a0a 2020 2020 2020 2020  NXML')..        
+00006550: 2352 6561 6420 6461 7461 2069 6e74 6f20  #Read data into 
+00006560: 786d 6c54 7265 650a 2020 2020 2020 2020  xmlTree.        
+00006570: 7472 6565 203d 2045 542e 7061 7273 6528  tree = ET.parse(
+00006580: 7470 662e 6e61 6d65 290a 2020 2020 2020  tpf.name).      
+00006590: 2020 726f 6f74 203d 2074 7265 652e 6765    root = tree.ge
+000065a0: 7472 6f6f 7428 290a 0a20 2020 2020 2020  troot()..       
+000065b0: 2023 436c 6f73 6520 616e 6420 7265 6d6f   #Close and remo
+000065c0: 7665 2074 656d 706f 7261 7279 2066 696c  ve temporary fil
+000065d0: 650a 2020 2020 2020 2020 7470 662e 636c  e.        tpf.cl
+000065e0: 6f73 6528 290a 2020 2020 2020 2020 6f73  ose().        os
+000065f0: 2e72 656d 6f76 6528 7470 662e 6e61 6d65  .remove(tpf.name
+00006600: 290a 0a20 2020 2023 6966 2077 7269 7465  )..    #if write
+00006610: 5f70 6174 6820 213d 2027 273a 0a20 2020  _path != '':.   
+00006620: 2023 2020 2020 696e 762e 7772 6974 6528   #    inv.write(
+00006630: 7772 6974 655f 7061 7468 2c20 666f 726d  write_path, form
+00006640: 6174 3d27 5354 4154 494f 4e58 4d4c 2729  at='STATIONXML')
+00006650: 0a0a 2020 2020 2354 6869 7320 6973 2073  ..    #This is s
+00006660: 7065 6369 6669 6320 746f 2052 6173 7053  pecific to RaspS
+00006670: 6861 6b65 0a20 2020 2063 3d63 6861 6e6e  hake.    c=chann
+00006680: 656c 735b 305d 0a20 2020 2070 7a4c 6973  els[0].    pzLis
+00006690: 7420 3d20 5b73 7472 286e 2920 666f 7220  t = [str(n) for 
+000066a0: 6e20 696e 206c 6973 7428 7261 6e67 6528  n in list(range(
+000066b0: 3729 295d 0a20 2020 2073 3d70 7a4c 6973  7))].    s=pzLis
+000066c0: 745b 305d 0a0a 2020 2020 7072 6566 6978  t[0]..    prefix
+000066d0: 3d20 227b 6874 7470 3a2f 2f77 7777 2e66  = "{http://www.f
+000066e0: 6473 6e2e 6f72 672f 786d 6c2f 7374 6174  dsn.org/xml/stat
+000066f0: 696f 6e2f 317d 220a 0a20 2020 2073 656e  ion/1}"..    sen
+00006700: 7369 7469 7669 7479 5061 7468 203d 2022  sitivityPath = "
+00006710: 2e2f 222b 7072 6566 6978 2b22 4e65 7477  ./"+prefix+"Netw
+00006720: 6f72 6b5b 4063 6f64 653d 2722 2b6e 6574  ork[@code='"+net
+00006730: 776f 726b 2b22 275d 2f22 2b70 7265 6669  work+"']/"+prefi
+00006740: 782b 2253 7461 7469 6f6e 5b40 636f 6465  x+"Station[@code
+00006750: 3d27 222b 7374 6174 696f 6e2b 2227 5d2f  ='"+station+"']/
+00006760: 222b 7072 6566 6978 2b22 4368 616e 6e65  "+prefix+"Channe
+00006770: 6c5b 4063 6f64 653d 2722 2b63 2b22 275d  l[@code='"+c+"']
+00006780: 2f22 2b70 7265 6669 782b 2252 6573 706f  /"+prefix+"Respo
+00006790: 6e73 652f 222b 7072 6566 6978 2b22 496e  nse/"+prefix+"In
+000067a0: 7374 7275 6d65 6e74 5365 6e73 6974 6976  strumentSensitiv
+000067b0: 6974 792f 222b 7072 6566 6978 2b22 5661  ity/"+prefix+"Va
+000067c0: 6c75 6522 0a20 2020 2067 6169 6e50 6174  lue".    gainPat
+000067d0: 6820 3d20 222e 2f22 2b70 7265 6669 782b  h = "./"+prefix+
+000067e0: 224e 6574 776f 726b 5b40 636f 6465 3d27  "Network[@code='
+000067f0: 222b 6e65 7477 6f72 6b2b 2227 5d2f 222b  "+network+"']/"+
+00006800: 7072 6566 6978 2b22 5374 6174 696f 6e5b  prefix+"Station[
+00006810: 4063 6f64 653d 2722 2b73 7461 7469 6f6e  @code='"+station
+00006820: 2b22 275d 2f22 2b70 7265 6669 782b 2243  +"']/"+prefix+"C
+00006830: 6861 6e6e 656c 5b40 636f 6465 3d27 222b  hannel[@code='"+
+00006840: 632b 2227 5d2f 222b 7072 6566 6978 2b22  c+"']/"+prefix+"
+00006850: 5265 7370 6f6e 7365 2f22 2b70 7265 6669  Response/"+prefi
+00006860: 782b 2253 7461 6765 5b40 6e75 6d62 6572  x+"Stage[@number
+00006870: 3d27 3127 5d2f 222b 7072 6566 6978 2b22  ='1']/"+prefix+"
+00006880: 5374 6167 6547 6169 6e2f 222b 7072 6566  StageGain/"+pref
+00006890: 6978 2b22 5661 6c75 6522 0a0a 2020 2020  ix+"Value"..    
+000068a0: 2370 617a 203d 205b 5d0a 2020 2020 7273  #paz = [].    rs
+000068b0: 434c 6973 7420 3d20 5b27 4548 5a27 2c20  CList = ['EHZ', 
+000068c0: 2745 484e 272c 2027 4548 4527 5d0a 2020  'EHN', 'EHE'].  
+000068d0: 2020 7061 7a20 3d20 7b7d 0a20 2020 2066    paz = {}.    f
+000068e0: 6f72 2063 2069 6e20 6368 616e 6e65 6c73  or c in channels
+000068f0: 3a0a 2020 2020 2020 2020 6368 616e 6e65  :.        channe
+00006900: 6c50 617a 203d 207b 7d0a 2020 2020 2020  lPaz = {}.      
+00006910: 2020 2363 6861 6e6e 656c 5061 7a5b 2763    #channelPaz['c
+00006920: 6861 6e6e 656c 275d 203d 2063 0a20 2020  hannel'] = c.   
+00006930: 2020 2020 2066 6f72 2069 7465 6d20 696e       for item in
+00006940: 2072 6f6f 742e 6669 6e64 616c 6c28 7365   root.findall(se
+00006950: 6e73 6974 6976 6974 7950 6174 6829 3a0a  nsitivityPath):.
+00006960: 2020 2020 2020 2020 2020 2020 6368 616e              chan
+00006970: 6e65 6c50 617a 5b27 7365 6e73 6974 6976  nelPaz['sensitiv
+00006980: 6974 7927 5d3d 666c 6f61 7428 6974 656d  ity']=float(item
+00006990: 2e74 6578 7429 0a0a 2020 2020 2020 2020  .text)..        
+000069a0: 666f 7220 6974 656d 2069 6e20 726f 6f74  for item in root
+000069b0: 2e66 696e 6461 6c6c 2867 6169 6e50 6174  .findall(gainPat
+000069c0: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
+000069d0: 6368 616e 6e65 6c50 617a 5b27 6761 696e  channelPaz['gain
+000069e0: 275d 3d66 6c6f 6174 2869 7465 6d2e 7465  ']=float(item.te
+000069f0: 7874 290a 2020 2020 2020 2020 0a20 2020  xt).        .   
+00006a00: 2020 2020 2070 6f6c 654c 6973 7420 3d20       poleList = 
+00006a10: 5b5d 0a20 2020 2020 2020 207a 6572 6f4c  [].        zeroL
+00006a20: 6973 7420 3d20 5b5d 0a20 2020 2020 2020  ist = [].       
+00006a30: 2066 6f72 2073 2069 6e20 707a 4c69 7374   for s in pzList
+00006a40: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00006a50: 2069 6e74 2873 2920 3c20 343a 0a20 2020   int(s) < 4:.   
+00006a60: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
+00006a70: 6550 6174 6852 6561 6c20 3d20 222e 2f22  ePathReal = "./"
+00006a80: 2b70 7265 6669 782b 224e 6574 776f 726b  +prefix+"Network
+00006a90: 5b40 636f 6465 3d27 222b 6e65 7477 6f72  [@code='"+networ
+00006aa0: 6b2b 2227 5d2f 222b 7072 6566 6978 2b22  k+"']/"+prefix+"
+00006ab0: 5374 6174 696f 6e5b 4063 6f64 653d 2722  Station[@code='"
+00006ac0: 2b73 7461 7469 6f6e 2b22 275d 2f22 2b70  +station+"']/"+p
+00006ad0: 7265 6669 782b 2243 6861 6e6e 656c 5b40  refix+"Channel[@
+00006ae0: 636f 6465 3d27 222b 632b 2227 5d2f 222b  code='"+c+"']/"+
+00006af0: 7072 6566 6978 2b22 5265 7370 6f6e 7365  prefix+"Response
+00006b00: 2f22 2b70 7265 6669 782b 2253 7461 6765  /"+prefix+"Stage
+00006b10: 5b40 6e75 6d62 6572 3d27 3127 5d2f 222b  [@number='1']/"+
+00006b20: 7072 6566 6978 2b22 506f 6c65 735a 6572  prefix+"PolesZer
+00006b30: 6f73 2f22 2b70 7265 6669 782b 2250 6f6c  os/"+prefix+"Pol
+00006b40: 655b 406e 756d 6265 723d 2722 2b73 2b22  e[@number='"+s+"
+00006b50: 275d 2f22 2b70 7265 6669 782b 2252 6561  ']/"+prefix+"Rea
+00006b60: 6c22 0a20 2020 2020 2020 2020 2020 2020  l".             
+00006b70: 2020 2070 6f6c 6550 6174 6849 6d61 6720     polePathImag 
+00006b80: 3d20 222e 2f22 2b70 7265 6669 782b 224e  = "./"+prefix+"N
+00006b90: 6574 776f 726b 5b40 636f 6465 3d27 222b  etwork[@code='"+
+00006ba0: 6e65 7477 6f72 6b2b 2227 5d2f 222b 7072  network+"']/"+pr
+00006bb0: 6566 6978 2b22 5374 6174 696f 6e5b 4063  efix+"Station[@c
+00006bc0: 6f64 653d 2722 2b73 7461 7469 6f6e 2b22  ode='"+station+"
+00006bd0: 275d 2f22 2b70 7265 6669 782b 2243 6861  ']/"+prefix+"Cha
+00006be0: 6e6e 656c 5b40 636f 6465 3d27 222b 632b  nnel[@code='"+c+
+00006bf0: 2227 5d2f 222b 7072 6566 6978 2b22 5265  "']/"+prefix+"Re
+00006c00: 7370 6f6e 7365 2f22 2b70 7265 6669 782b  sponse/"+prefix+
+00006c10: 2253 7461 6765 5b40 6e75 6d62 6572 3d27  "Stage[@number='
+00006c20: 3127 5d2f 222b 7072 6566 6978 2b22 506f  1']/"+prefix+"Po
+00006c30: 6c65 735a 6572 6f73 2f22 2b70 7265 6669  lesZeros/"+prefi
+00006c40: 782b 2250 6f6c 655b 406e 756d 6265 723d  x+"Pole[@number=
+00006c50: 2722 2b73 2b22 275d 2f22 2b70 7265 6669  '"+s+"']/"+prefi
+00006c60: 782b 2249 6d61 6769 6e61 7279 220a 2020  x+"Imaginary".  
+00006c70: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00006c80: 7220 706f 6c65 4974 656d 2069 6e20 726f  r poleItem in ro
+00006c90: 6f74 2e66 696e 6461 6c6c 2870 6f6c 6550  ot.findall(poleP
+00006ca0: 6174 6852 6561 6c29 3a0a 2020 2020 2020  athReal):.      
+00006cb0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00006cc0: 6c65 5265 616c 203d 2070 6f6c 6549 7465  leReal = poleIte
+00006cd0: 6d2e 7465 7874 0a20 2020 2020 2020 2020  m.text.         
+00006ce0: 2020 2020 2020 2066 6f72 2070 6f6c 6549         for poleI
+00006cf0: 7465 6d20 696e 2072 6f6f 742e 6669 6e64  tem in root.find
+00006d00: 616c 6c28 706f 6c65 5061 7468 496d 6167  all(polePathImag
+00006d10: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00006d20: 2020 2020 2020 2070 6f6c 6520 3d20 636f         pole = co
+00006d30: 6d70 6c65 7828 666c 6f61 7428 706f 6c65  mplex(float(pole
+00006d40: 5265 616c 292c 2066 6c6f 6174 2870 6f6c  Real), float(pol
+00006d50: 6549 7465 6d2e 7465 7874 2929 0a20 2020  eItem.text)).   
+00006d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d70: 2070 6f6c 654c 6973 742e 6170 7065 6e64   poleList.append
+00006d80: 2870 6f6c 6529 0a20 2020 2020 2020 2020  (pole).         
+00006d90: 2020 2020 2020 2020 2020 2063 6861 6e6e             chann
+00006da0: 656c 5061 7a5b 2770 6f6c 6573 275d 203d  elPaz['poles'] =
+00006db0: 2070 6f6c 654c 6973 740a 2020 2020 2020   poleList.      
+00006dc0: 2020 2020 2020 2020 2020 2020 2020 2363                #c
+00006dd0: 6861 6e6e 656c 5061 7a5b 2770 6f6c 6573  hannelPaz['poles
+00006de0: 275d 203d 206c 6973 7428 7365 7428 706f  '] = list(set(po
+00006df0: 6c65 4c69 7374 2929 0a20 2020 2020 2020  leList)).       
+00006e00: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00006e10: 2020 2020 2020 2020 2020 207a 6572 6f50             zeroP
+00006e20: 6174 6852 6561 6c20 3d20 222e 2f22 2b70  athReal = "./"+p
+00006e30: 7265 6669 782b 224e 6574 776f 726b 5b40  refix+"Network[@
+00006e40: 636f 6465 3d27 222b 6e65 7477 6f72 6b2b  code='"+network+
+00006e50: 2227 5d2f 222b 7072 6566 6978 2b22 5374  "']/"+prefix+"St
+00006e60: 6174 696f 6e5b 4063 6f64 653d 2722 2b73  ation[@code='"+s
+00006e70: 7461 7469 6f6e 2b22 275d 2f22 2b70 7265  tation+"']/"+pre
+00006e80: 6669 782b 2243 6861 6e6e 656c 5b40 636f  fix+"Channel[@co
+00006e90: 6465 3d27 222b 632b 2227 5d2f 222b 7072  de='"+c+"']/"+pr
+00006ea0: 6566 6978 2b22 5265 7370 6f6e 7365 2f22  efix+"Response/"
+00006eb0: 2b70 7265 6669 782b 2253 7461 6765 5b40  +prefix+"Stage[@
+00006ec0: 6e75 6d62 6572 3d27 3127 5d2f 222b 7072  number='1']/"+pr
+00006ed0: 6566 6978 2b22 506f 6c65 735a 6572 6f73  efix+"PolesZeros
+00006ee0: 2f22 2b70 7265 6669 782b 225a 6572 6f5b  /"+prefix+"Zero[
+00006ef0: 406e 756d 6265 723d 2722 2b73 2b22 275d  @number='"+s+"']
+00006f00: 2f22 2b70 7265 6669 782b 2252 6561 6c22  /"+prefix+"Real"
+00006f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006f20: 207a 6572 6f50 6174 6849 6d61 6720 3d20   zeroPathImag = 
+00006f30: 222e 2f22 2b70 7265 6669 782b 224e 6574  "./"+prefix+"Net
+00006f40: 776f 726b 5b40 636f 6465 3d27 222b 6e65  work[@code='"+ne
+00006f50: 7477 6f72 6b2b 2227 5d2f 222b 7072 6566  twork+"']/"+pref
+00006f60: 6978 2b22 5374 6174 696f 6e5b 4063 6f64  ix+"Station[@cod
+00006f70: 653d 2722 2b73 7461 7469 6f6e 2b22 275d  e='"+station+"']
+00006f80: 2f22 2b70 7265 6669 782b 2243 6861 6e6e  /"+prefix+"Chann
+00006f90: 656c 5b40 636f 6465 3d27 222b 632b 2227  el[@code='"+c+"'
+00006fa0: 5d2f 222b 7072 6566 6978 2b22 5265 7370  ]/"+prefix+"Resp
+00006fb0: 6f6e 7365 2f22 2b70 7265 6669 782b 2253  onse/"+prefix+"S
+00006fc0: 7461 6765 5b40 6e75 6d62 6572 3d27 3127  tage[@number='1'
+00006fd0: 5d2f 222b 7072 6566 6978 2b22 506f 6c65  ]/"+prefix+"Pole
+00006fe0: 735a 6572 6f73 2f22 2b70 7265 6669 782b  sZeros/"+prefix+
+00006ff0: 225a 6572 6f5b 406e 756d 6265 723d 2722  "Zero[@number='"
+00007000: 2b73 2b22 275d 2f22 2b70 7265 6669 782b  +s+"']/"+prefix+
+00007010: 2249 6d61 6769 6e61 7279 220a 2020 2020  "Imaginary".    
+00007020: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00007030: 7a65 726f 4974 656d 2069 6e20 726f 6f74  zeroItem in root
+00007040: 2e66 696e 6461 6c6c 287a 6572 6f50 6174  .findall(zeroPat
+00007050: 6852 6561 6c29 3a0a 2020 2020 2020 2020  hReal):.        
+00007060: 2020 2020 2020 2020 2020 2020 7a65 726f              zero
+00007070: 5265 616c 203d 207a 6572 6f49 7465 6d2e  Real = zeroItem.
+00007080: 7465 7874 0a20 2020 2020 2020 2020 2020  text.           
+00007090: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+000070a0: 2020 2020 2020 666f 7220 7a65 726f 4974        for zeroIt
+000070b0: 656d 2069 6e20 726f 6f74 2e66 696e 6461  em in root.finda
+000070c0: 6c6c 287a 6572 6f50 6174 6849 6d61 6729  ll(zeroPathImag)
+000070d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000070e0: 2020 2020 2020 7a65 726f 203d 2063 6f6d        zero = com
+000070f0: 706c 6578 2866 6c6f 6174 287a 6572 6f52  plex(float(zeroR
+00007100: 6561 6c29 2c20 666c 6f61 7428 7a65 726f  eal), float(zero
+00007110: 4974 656d 2e74 6578 7429 290a 2020 2020  Item.text)).    
+00007120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007130: 237a 6572 6f20 3d20 7a65 726f 5265 616c  #zero = zeroReal
+00007140: 202b 2022 2b22 202b 207a 6572 6f49 7465   + "+" + zeroIte
+00007150: 6d2e 7465 7874 2b27 6a27 0a20 2020 2020  m.text+'j'.     
+00007160: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+00007170: 6572 6f4c 6973 742e 6170 7065 6e64 287a  eroList.append(z
+00007180: 6572 6f29 0a20 2020 2020 2020 2020 2020  ero).           
+00007190: 2020 2020 2020 2020 2023 6368 616e 6e65           #channe
+000071a0: 6c50 617a 5b27 7a65 726f 7327 5d20 3d20  lPaz['zeros'] = 
+000071b0: 6c69 7374 2873 6574 287a 6572 6f4c 6973  list(set(zeroLis
+000071c0: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
+000071d0: 2020 2020 2020 2020 6368 616e 6e65 6c50          channelP
+000071e0: 617a 5b27 7a65 726f 7327 5d20 3d20 7a65  az['zeros'] = ze
+000071f0: 726f 4c69 7374 0a20 2020 2020 2020 2069  roList.        i
+00007200: 6620 7374 7228 6329 2e75 7070 6572 2829  f str(c).upper()
+00007210: 2069 6e20 7273 434c 6973 743a 0a20 2020   in rsCList:.   
+00007220: 2020 2020 2020 2020 2063 203d 2073 7472           c = str
+00007230: 2863 295b 2d31 5d2e 7570 7065 7228 290a  (c)[-1].upper().
+00007240: 2020 2020 2020 2020 7061 7a5b 7374 7228          paz[str(
+00007250: 6329 5d20 3d20 6368 616e 6e65 6c50 617a  c)] = channelPaz
+00007260: 0a20 2020 2070 6172 616d 735b 2770 617a  .    params['paz
+00007270: 275d 203d 2070 617a 0a20 2020 2072 6574  '] = paz.    ret
+00007280: 7572 6e20 7061 7261 6d73 0a0a 2347 6574  urn params..#Get
+00007290: 7320 7468 6520 6d65 7461 6461 7461 2066  s the metadata f
+000072a0: 6f72 2052 6173 7062 6572 7279 2053 6861  or Raspberry Sha
+000072b0: 6b65 2c20 7370 6563 6966 6963 616c 6c79  ke, specifically
+000072c0: 2066 6f72 2033 4420 762e 370a 6465 6620   for 3D v.7.def 
+000072d0: 6765 745f 6d65 7461 6461 7461 2870 6172  get_metadata(par
+000072e0: 616d 732c 2077 7269 7465 5f70 6174 683d  ams, write_path=
+000072f0: 2727 293a 0a20 2020 2022 2222 4765 7420  ''):.    """Get 
+00007300: 6d65 7461 6461 7461 2061 6e64 2063 616c  metadata and cal
+00007310: 6375 6c61 7465 206f 7220 6765 7420 7061  culate or get pa
+00007320: 7a20 7061 7261 6d65 7465 7220 6e65 6564  z parameter need
+00007330: 6564 2066 6f72 2050 5053 440a 0a20 2020  ed for PPSD..   
+00007340: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00007350: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2070  ----------.    p
+00007360: 6172 616d 7320 3a20 6469 6374 0a20 2020  arams : dict.   
+00007370: 2020 2020 2044 6963 7469 6f6e 6172 7920       Dictionary 
+00007380: 636f 6e74 6169 6e69 6e67 2061 6c6c 2074  containing all t
+00007390: 6865 2069 6e70 7574 2061 6e64 206f 7468  he input and oth
+000073a0: 6572 2070 6172 616d 6574 6572 7320 6e65  er parameters ne
+000073b0: 6564 6564 2066 6f72 2070 726f 6365 7373  eded for process
+000073c0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+000073d0: 4f75 7075 7420 6672 6f6d 2069 6e70 7574  Ouput from input
+000073e0: 5f70 6172 616d 7328 2920 6675 6e63 7469  _params() functi
+000073f0: 6f6e 0a20 2020 2077 7269 7465 5f70 6174  on.    write_pat
+00007400: 6820 3a20 7374 720a 2020 2020 2020 2020  h : str.        
+00007410: 5374 7269 6e67 2077 6974 6820 6f75 7470  String with outp
+00007420: 7574 2066 696c 6570 6174 6820 6f66 2077  ut filepath of w
+00007430: 6865 7265 2074 6f20 7772 6974 6520 7570  here to write up
+00007440: 6461 7465 6420 696e 7665 6e74 6f72 7920  dated inventory 
+00007450: 6f72 206d 6574 6164 6174 6120 6669 6c65  or metadata file
+00007460: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00007470: 6e6f 7420 7370 6563 6966 6965 642c 2064  not specified, d
+00007480: 6f65 7320 6e6f 7420 7772 6974 6520 6669  oes not write fi
+00007490: 6c65 200a 0a20 2020 2052 6574 7572 6e73  le ..    Returns
+000074a0: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+000074b0: 2070 6172 616d 7320 3a20 6469 6374 0a20   params : dict. 
+000074c0: 2020 2020 2020 204d 6f64 6966 6965 6420         Modified 
+000074d0: 696e 7075 7420 6469 6374 696f 6e61 7279  input dictionary
+000074e0: 2077 6974 6820 6164 6469 7469 6f6e 616c   with additional
+000074f0: 206b 6579 3a76 616c 7565 2070 6169 7220   key:value pair 
+00007500: 636f 6e74 6169 6e69 6e67 2070 617a 2064  containing paz d
+00007510: 6963 7469 6f6e 6172 7920 286b 6579 203d  ictionary (key =
+00007520: 2022 7061 7a22 290a 2020 2020 2222 220a   "paz").    """.
+00007530: 2020 2020 696e 7650 6174 6820 3d20 7061      invPath = pa
+00007540: 7261 6d73 5b27 6d65 7461 5061 7468 275d  rams['metaPath']
+00007550: 0a20 2020 2072 6173 7053 6861 6b65 496e  .    raspShakeIn
+00007560: 7374 4e61 6d65 4c69 7374 203d 205b 2772  stNameList = ['r
+00007570: 6173 7062 6572 7279 2073 6861 6b65 272c  aspberry shake',
+00007580: 2027 7368 616b 6527 2c20 2772 6173 7062   'shake', 'raspb
+00007590: 6572 7279 272c 2027 7273 272c 2027 7273  erry', 'rs', 'rs
+000075a0: 3364 272c 2027 7261 7370 2e20 7368 616b  3d', 'rasp. shak
+000075b0: 6527 2c20 2772 6173 7073 6861 6b65 275d  e', 'raspshake']
+000075c0: 0a20 2020 2069 6620 7061 7261 6d73 5b27  .    if params['
+000075d0: 696e 7374 7275 6d65 6e74 275d 2e6c 6f77  instrument'].low
+000075e0: 6572 2829 2069 6e20 2072 6173 7053 6861  er() in  raspSha
+000075f0: 6b65 496e 7374 4e61 6d65 4c69 7374 3a0a  keInstNameList:.
+00007600: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+00007610: 2075 7064 6174 655f 7368 616b 655f 6d65   update_shake_me
+00007620: 7461 6461 7461 2866 696c 6570 6174 683d  tadata(filepath=
+00007630: 696e 7650 6174 682c 2070 6172 616d 733d  invPath, params=
+00007640: 7061 7261 6d73 2c20 7772 6974 655f 7061  params, write_pa
+00007650: 7468 3d77 7269 7465 5f70 6174 6829 0a20  th=write_path). 
+00007660: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
+00007670: 5f72 6561 645f 5253 5f4d 6574 6164 6174  _read_RS_Metadat
+00007680: 6128 7061 7261 6d73 290a 2020 2020 656c  a(params).    el
+00007690: 7365 3a0a 2020 2020 2020 2020 7072 696e  se:.        prin
+000076a0: 7428 277b 7d20 6e6f 7420 6375 7272 656e  t('{} not curren
+000076b0: 746c 7920 7375 7070 6f72 7465 645c 6e20  tly supported\n 
+000076c0: 5265 7475 726e 696e 6720 696e 7075 7420  Returning input 
+000076d0: 7061 7261 6d73 2064 6963 7469 6f6e 6172  params dictionar
+000076e0: 792e 272e 666f 726d 6174 2870 6172 616d  y.'.format(param
+000076f0: 735b 2769 6e73 7472 756d 656e 7427 5d29  s['instrument'])
+00007700: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00007710: 2070 6172 616d 730a 2020 2020 0a20 2020   params.    .   
+00007720: 2072 6574 7572 6e20 7061 7261 6d73 0a0a   return params..
+00007730: 2352 6561 6473 2069 6e20 7472 6163 6573  #Reads in traces
+00007740: 2074 6f20 6f62 7370 7920 7374 7265 616d   to obspy stream
+00007750: 0a64 6566 2066 6574 6368 5f64 6174 6128  .def fetch_data(
+00007760: 7061 7261 6d73 2c20 696e 763d 4e6f 6e65  params, inv=None
+00007770: 2c20 736f 7572 6365 3d27 7261 7727 2c20  , source='raw', 
+00007780: 7472 696d 5f64 6972 3d4e 6f6e 652c 2065  trim_dir=None, e
+00007790: 7870 6f72 745f 666f 726d 6174 3d27 6d73  xport_format='ms
+000077a0: 6565 6427 2c20 6465 7472 656e 643d 2773  eed', detrend='s
+000077b0: 706c 696e 6527 2c20 6465 7472 656e 645f  pline', detrend_
+000077c0: 6f72 6465 723d 3229 3a0a 2020 2020 2222  order=2):.    ""
+000077d0: 2246 6574 6368 2061 6d62 6965 6e74 2073  "Fetch ambient s
+000077e0: 6569 736d 6963 2064 6174 6120 6672 6f6d  eismic data from
+000077f0: 2061 2073 6f75 7263 6520 746f 2072 6561   a source to rea
+00007800: 6420 696e 746f 206f 6273 7079 2073 7472  d into obspy str
+00007810: 6561 6d0a 2020 2020 2020 2020 0a20 2020  eam.        .   
+00007820: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00007830: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00007840: 2d2d 0a20 2020 2020 2020 2070 6172 616d  --.        param
+00007850: 7320 203a 2064 6963 740a 2020 2020 2020  s  : dict.      
+00007860: 2020 2020 2020 4469 6374 696f 6e61 7279        Dictionary
+00007870: 2063 6f6e 7461 696e 696e 6720 616c 6c20   containing all 
+00007880: 7468 6520 6e65 6365 7373 6172 7920 7061  the necessary pa
+00007890: 7261 6d73 2074 6f20 6765 7420 6461 7461  rams to get data
+000078a0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000078b0: 2020 5061 7261 6d65 7465 7273 2064 6566    Parameters def
+000078c0: 696e 6564 2075 7369 6e67 2069 6e70 7574  ined using input
+000078d0: 5f70 6172 616d 7328 2920 6675 6e63 7469  _params() functi
+000078e0: 6f6e 2e0a 2020 2020 2020 2020 696e 7620  on..        inv 
+000078f0: 2020 2020 3a20 6f62 7370 7920 696e 7665      : obspy inve
+00007900: 6e74 6f72 7920 6f62 6a65 6374 2c20 6465  ntory object, de
+00007910: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00007920: 2020 2020 2020 204f 6273 7079 2069 6e76         Obspy inv
+00007930: 656e 746f 7279 206f 626a 6563 7420 636f  entory object co
+00007940: 6e74 6169 6e69 6e67 206d 6574 6164 6174  ntaining metadat
+00007950: 6120 666f 7220 696e 7374 7275 6d65 6e74  a for instrument
+00007960: 2074 6861 7420 636f 6c6c 6563 7465 6420   that collected 
+00007970: 6461 7461 2074 6f20 6265 2066 6574 6368  data to be fetch
+00007980: 6564 2e20 4279 2064 6566 6175 6c74 2c20  ed. By default, 
+00007990: 7468 6520 696e 7665 6e74 6f72 7920 6f62  the inventory ob
+000079a0: 6a65 6374 2069 7320 7265 6164 2066 726f  ject is read fro
+000079b0: 6d20 7061 7261 6d73 5b27 696e 7627 5d2c  m params['inv'],
+000079c0: 2062 7574 2074 6869 7320 6361 6e20 6265   but this can be
+000079d0: 206d 616e 7561 6c6c 7920 7370 6563 6966   manually specif
+000079e0: 6965 6420 6865 7265 2074 6f6f 2e0a 2020  ied here too..  
+000079f0: 2020 2020 2020 736f 7572 6365 2020 3a20        source  : 
+00007a00: 7374 722c 207b 2772 6177 272c 2027 6469  str, {'raw', 'di
+00007a10: 7227 2c20 2766 696c 6527 7d0a 2020 2020  r', 'file'}.    
+00007a20: 2020 2020 2020 2020 5374 7269 6e67 2069          String i
+00007a30: 6e64 6963 6174 696e 6720 7768 6572 652f  ndicating where/
+00007a40: 686f 7720 6461 7461 2066 696c 6520 7761  how data file wa
+00007a50: 7320 6372 6561 7465 642e 2046 6f72 2065  s created. For e
+00007a60: 7861 6d70 6c65 2c20 6966 2072 6177 2064  xample, if raw d
+00007a70: 6174 612c 2077 696c 6c20 6e65 6564 2074  ata, will need t
+00007a80: 6f20 6669 6e64 2063 6f72 7265 6374 2063  o find correct c
+00007a90: 6861 6e6e 656c 732e 0a20 2020 2020 2020  hannels..       
+00007aa0: 2020 2020 2020 2020 2027 7261 7727 2066           'raw' f
+00007ab0: 696e 6473 2072 6173 7062 6572 7279 2073  inds raspberry s
+00007ac0: 6861 6b65 2064 6174 612c 2066 726f 6d20  hake data, from 
+00007ad0: 7261 7720 6f75 7470 7574 2063 6f70 6965  raw output copie
+00007ae0: 6420 7573 696e 6720 7363 7020 6469 7265  d using scp dire
+00007af0: 6374 6c79 2066 726f 6d20 5261 7370 6265  ctly from Raspbe
+00007b00: 7272 7920 5368 616b 652c 2065 6974 6865  rry Shake, eithe
+00007b10: 7220 696e 2066 6f6c 6465 7220 6f72 2073  r in folder or s
+00007b20: 7562 666f 6c64 6572 733b 200a 2020 2020  ubfolders; .    
+00007b30: 2020 2020 2020 2020 2020 2020 2764 6972              'dir
+00007b40: 2720 6973 2075 7365 6420 6966 2074 6865  ' is used if the
+00007b50: 2064 6179 2773 2033 2063 6f6d 706f 6e65   day's 3 compone
+00007b60: 6e74 2066 696c 6573 2028 6375 7272 656e  nt files (curren
+00007b70: 746c 7920 5261 7370 6265 7272 7920 5368  tly Raspberry Sh
+00007b80: 616b 6520 7375 7070 6f72 7465 6420 6f6e  ake supported on
+00007b90: 6c79 2920 6172 6520 616c 6c20 3320 636f  ly) are all 3 co
+00007ba0: 6e74 6169 6e65 6420 696e 2061 2064 6972  ntained in a dir
+00007bb0: 6563 746f 7279 2062 7920 7468 656d 7365  ectory by themse
+00007bc0: 6c76 6573 2e0a 2020 2020 2020 2020 2020  lves..          
+00007bd0: 2020 2020 2020 2766 696c 6527 2069 7320        'file' is 
+00007be0: 7573 6564 2069 6620 7468 6520 6461 7461  used if the data
+00007bf0: 7061 7468 2073 7065 6369 6669 6564 2069  path specified i
+00007c00: 6e20 696e 7075 745f 7061 7261 6d73 2829  n input_params()
+00007c10: 2069 7320 7468 6520 6469 7265 6374 2066   is the direct f
+00007c20: 696c 6570 6174 6820 746f 2061 2073 696e  ilepath to a sin
+00007c30: 676c 6520 6669 6c65 2074 6f20 6265 2072  gle file to be r
+00007c40: 6561 6420 6469 7265 6374 6c79 2069 6e74  ead directly int
+00007c50: 6f20 616e 206f 6273 7079 2073 7472 6561  o an obspy strea
+00007c60: 6d2e 0a20 2020 2020 2020 2074 7269 6d5f  m..        trim_
+00007c70: 6469 7220 3a20 4e6f 6e65 206f 7220 7374  dir : None or st
+00007c80: 7220 6f72 2070 6174 686c 6962 206f 626a  r or pathlib obj
+00007c90: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+00007ca0: 2020 2020 2020 2020 2020 2049 6620 4e6f             If No
+00007cb0: 6e65 2028 6f72 2046 616c 7365 292c 2064  ne (or False), d
+00007cc0: 6174 6120 6973 206e 6f74 2074 7269 6d6d  ata is not trimm
+00007cd0: 6564 2069 6e20 7468 6973 2066 756e 6374  ed in this funct
+00007ce0: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
+00007cf0: 204f 7468 6572 7769 7365 2c20 7468 6973   Otherwise, this
+00007d00: 2069 7320 7468 6520 6469 7265 6374 6f72   is the director
+00007d10: 7920 746f 2073 6176 6520 7472 696d 6d65  y to save trimme
+00007d20: 6420 616e 6420 6578 706f 7274 6564 2064  d and exported d
+00007d30: 6174 612e 0a20 2020 2020 2020 2065 7870  ata..        exp
+00007d40: 6f72 745f 666f 726d 6174 3a20 7374 723d  ort_format: str=
+00007d50: 276d 7365 6564 270a 2020 2020 2020 2020  'mseed'.        
+00007d60: 2020 2020 4966 2074 7269 6d5f 6469 7220      If trim_dir 
+00007d70: 6973 206e 6f74 2046 616c 7365 2c20 7468  is not False, th
+00007d80: 6973 2069 7320 7468 6520 666f 726d 6174  is is the format
+00007d90: 2069 6e20 7768 6963 6820 746f 2073 6176   in which to sav
+00007da0: 6520 7468 6520 6461 7461 0a20 2020 2020  e the data.     
+00007db0: 2020 2064 6574 7265 6e64 203a 2073 7472     detrend : str
+00007dc0: 206f 7220 626f 6f6c 2c20 6465 6661 756c   or bool, defaul
+00007dd0: 743d 2773 706c 696e 6527 0a20 2020 2020  t='spline'.     
+00007de0: 2020 2020 2020 2049 6620 4661 6c73 652c         If False,
+00007df0: 2064 6174 6120 6973 206e 6f74 2064 6574   data is not det
+00007e00: 7265 6e64 6564 2e0a 2020 2020 2020 2020  rended..        
+00007e10: 2020 2020 4f74 6865 7277 6973 652c 2074      Otherwise, t
+00007e20: 6869 7320 7368 6f75 6c64 2062 6520 6120  his should be a 
+00007e30: 7374 7269 6e67 2061 6363 6570 7465 6420  string accepted 
+00007e40: 6279 2074 6865 2074 7970 6520 7061 7261  by the type para
+00007e50: 6d65 7465 7220 6f66 2074 6865 206f 6273  meter of the obs
+00007e60: 7079 2e63 6f72 652e 7472 6163 652e 5472  py.core.trace.Tr
+00007e70: 6163 652e 6465 7472 656e 6420 6d65 7468  ace.detrend meth
+00007e80: 6f64 3a20 6874 7470 733a 2f2f 646f 6373  od: https://docs
+00007e90: 2e6f 6273 7079 2e6f 7267 2f70 6163 6b61  .obspy.org/packa
+00007ea0: 6765 732f 6175 746f 6765 6e2f 6f62 7370  ges/autogen/obsp
+00007eb0: 792e 636f 7265 2e74 7261 6365 2e54 7261  y.core.trace.Tra
+00007ec0: 6365 2e64 6574 7265 6e64 2e68 746d 6c0a  ce.detrend.html.
+00007ed0: 2020 2020 2020 2020 6465 7472 656e 645f          detrend_
+00007ee0: 6f72 6465 7220 3a20 696e 742c 2064 6566  order : int, def
+00007ef0: 6175 6c74 3d32 0a20 2020 2020 2020 2020  ault=2.         
+00007f00: 2020 2049 6620 6465 7472 656e 6420 7061     If detrend pa
+00007f10: 7261 6d65 7465 7220 6973 2027 7370 6c69  rameter is 'spli
+00007f20: 6e65 2720 6f72 2027 706f 6c79 6e6f 6d69  ne' or 'polynomi
+00007f30: 616c 272c 2074 6869 7320 6973 2070 6173  al', this is pas
+00007f40: 7365 6420 6469 7265 6374 6c79 2074 6f20  sed directly to 
+00007f50: 7468 6520 6f72 6465 7220 7061 7261 6d65  the order parame
+00007f60: 7465 7220 6f66 206f 6273 7079 2e63 6f72  ter of obspy.cor
+00007f70: 652e 7472 6163 652e 5472 6163 652e 6465  e.trace.Trace.de
+00007f80: 7472 656e 6420 6d65 7468 6f64 2e0a 2020  trend method..  
+00007f90: 2020 2020 2020 0a20 2020 2020 2020 2052        .        R
+00007fa0: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+00007fb0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
+00007fc0: 6174 6149 4e20 3a20 6f62 7370 7920 7374  ataIN : obspy st
+00007fd0: 7265 616d 0a20 2020 2020 2020 2020 2020  ream.           
+00007fe0: 204f 6273 7079 2064 6174 6120 7374 7265   Obspy data stre
+00007ff0: 616d 2077 6974 6820 3320 7472 6163 6573  am with 3 traces
+00008000: 3a20 5a20 2876 6572 7469 6361 6c29 2c20  : Z (vertical), 
+00008010: 4e20 284e 6f72 7468 2d73 6f75 7468 292c  N (North-south),
+00008020: 2061 6e64 2045 2028 4561 7374 2d77 6573   and E (East-wes
+00008030: 7429 0a20 2020 2020 2020 200a 2020 2020  t).        .    
+00008040: 2020 2020 2222 220a 2020 2020 6461 7461      """.    data
+00008050: 7061 7468 203d 2070 6172 616d 735b 2764  path = params['d
+00008060: 6174 6150 6174 6827 5d0a 2020 2020 6966  ataPath'].    if
+00008070: 2069 6e76 2069 7320 4e6f 6e65 3a0a 2020   inv is None:.  
+00008080: 2020 2020 2020 696e 7620 3d20 7061 7261        inv = para
+00008090: 6d73 5b27 696e 7627 5d2c 200a 2020 2020  ms['inv'], .    
+000080a0: 6461 7465 3d70 6172 616d 735b 2761 6371  date=params['acq
+000080b0: 5f64 6174 6527 5d0a 2020 2020 6461 7461  _date'].    data
+000080c0: 7061 7468 203d 2063 6865 636b 6966 7061  path = checkifpa
+000080d0: 7468 2864 6174 6170 6174 6829 0a20 2020  th(datapath).   
+000080e0: 2069 6e73 7420 3d20 7061 7261 6d73 5b27   inst = params['
+000080f0: 696e 7374 7275 6d65 6e74 275d 0a0a 2020  instrument']..  
+00008100: 2020 234e 6565 6420 746f 2070 7574 2064    #Need to put d
+00008110: 6174 6573 2061 6e64 2074 696d 6573 2069  ates and times i
+00008120: 6e20 7269 6768 7420 666f 726d 6174 7320  n right formats 
+00008130: 6669 7273 740a 2020 2020 6966 2074 7970  first.    if typ
+00008140: 6528 6461 7465 2920 6973 2064 6174 6574  e(date) is datet
+00008150: 696d 652e 6461 7465 7469 6d65 3a0a 2020  ime.datetime:.  
+00008160: 2020 2020 2020 646f 7920 3d20 6461 7465        doy = date
+00008170: 2e74 696d 6574 7570 6c65 2829 2e74 6d5f  .timetuple().tm_
+00008180: 7964 6179 0a20 2020 2020 2020 2079 6561  yday.        yea
+00008190: 7220 3d20 6461 7465 2e79 6561 720a 2020  r = date.year.  
+000081a0: 2020 656c 6966 2074 7970 6528 6461 7465    elif type(date
+000081b0: 2920 6973 2064 6174 6574 696d 652e 6461  ) is datetime.da
+000081c0: 7465 3a0a 2020 2020 2020 2020 6461 7465  te:.        date
+000081d0: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
+000081e0: 7469 6d65 2e63 6f6d 6269 6e65 2864 6174  time.combine(dat
+000081f0: 652c 2064 6174 6574 696d 652e 7469 6d65  e, datetime.time
+00008200: 2868 6f75 723d 302c 206d 696e 7574 653d  (hour=0, minute=
+00008210: 302c 2073 6563 6f6e 643d 3029 290a 2020  0, second=0)).  
+00008220: 2020 2020 2020 646f 7920 3d20 6461 7465        doy = date
+00008230: 2e74 696d 6574 7570 6c65 2829 2e74 6d5f  .timetuple().tm_
+00008240: 7964 6179 0a20 2020 2020 2020 2079 6561  yday.        yea
+00008250: 7220 3d20 6461 7465 2e79 6561 720a 2020  r = date.year.  
+00008260: 2020 656c 6966 2074 7970 6528 6461 7465    elif type(date
+00008270: 2920 6973 2074 7570 6c65 3a0a 2020 2020  ) is tuple:.    
+00008280: 2020 2020 6966 2064 6174 655b 305d 3e33      if date[0]>3
+00008290: 3636 3a0a 2020 2020 2020 2020 2020 2020  66:.            
+000082a0: 6572 726f 7228 2746 6972 7374 2069 7465  error('First ite
+000082b0: 6d20 696e 2064 6174 6520 7475 706c 6520  m in date tuple 
+000082c0: 6d75 7374 2062 6520 6461 7920 6f66 2079  must be day of y
+000082d0: 6561 7220 2830 2d33 3636 2927 2c20 3029  ear (0-366)', 0)
+000082e0: 0a20 2020 2020 2020 2065 6c69 6620 6461  .        elif da
+000082f0: 7465 5b31 5d20 3e20 6461 7465 7469 6d65  te[1] > datetime
+00008300: 2e64 6174 6574 696d 652e 6e6f 7728 292e  .datetime.now().
+00008310: 7965 6172 3a0a 2020 2020 2020 2020 2020  year:.          
+00008320: 2020 6572 726f 7228 2753 6563 6f6e 6420    error('Second 
+00008330: 6974 656d 2069 6e20 6461 7465 2074 7570  item in date tup
+00008340: 6c65 2073 686f 756c 6420 6265 2079 6561  le should be yea
+00008350: 722c 2062 7574 2067 6976 656e 2069 7465  r, but given ite
+00008360: 6d20 6973 2069 6e20 7468 6520 6675 7475  m is in the futu
+00008370: 7265 272c 2030 290a 2020 2020 2020 2020  re', 0).        
+00008380: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00008390: 2020 646f 7920 3d20 6461 7465 5b30 5d0a    doy = date[0].
+000083a0: 2020 2020 2020 2020 2020 2020 7965 6172              year
+000083b0: 203d 2064 6174 655b 315d 0a20 2020 2065   = date[1].    e
+000083c0: 6c69 6620 7479 7065 2864 6174 6529 2069  lif type(date) i
+000083d0: 7320 7374 723a 0a20 2020 2020 2020 2069  s str:.        i
+000083e0: 6620 272f 2720 696e 2064 6174 653a 0a20  f '/' in date:. 
+000083f0: 2020 2020 2020 2020 2020 2064 6174 6553             dateS
+00008400: 706c 6974 203d 2064 6174 652e 7370 6c69  plit = date.spli
+00008410: 7428 272f 2729 2020 2020 2020 2020 2020  t('/')          
+00008420: 2020 0a20 2020 2020 2020 2065 6c69 6620    .        elif 
+00008430: 272d 2720 696e 2064 6174 653a 0a20 2020  '-' in date:.   
+00008440: 2020 2020 2020 2020 2064 6174 6553 706c           dateSpl
+00008450: 6974 203d 2064 6174 652e 7370 6c69 7428  it = date.split(
+00008460: 272d 2729 0a20 2020 2020 2020 2065 6c73  '-').        els
+00008470: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
+00008480: 6174 6553 706c 6974 203d 2064 6174 650a  ateSplit = date.
+00008490: 0a20 2020 2020 2020 2069 6620 696e 7428  .        if int(
+000084a0: 6461 7465 5370 6c69 745b 305d 2920 3e20  dateSplit[0]) > 
+000084b0: 3331 3a0a 2020 2020 2020 2020 2020 2020  31:.            
+000084c0: 6461 7465 203d 2064 6174 6574 696d 652e  date = datetime.
+000084d0: 6461 7465 7469 6d65 2869 6e74 2864 6174  datetime(int(dat
+000084e0: 6553 706c 6974 5b30 5d29 2c20 696e 7428  eSplit[0]), int(
+000084f0: 6461 7465 5370 6c69 745b 315d 292c 2069  dateSplit[1]), i
+00008500: 6e74 2864 6174 6553 706c 6974 5b32 5d29  nt(dateSplit[2])
+00008510: 290a 2020 2020 2020 2020 2020 2020 646f  ).            do
+00008520: 7920 3d20 6461 7465 2e74 696d 6574 7570  y = date.timetup
+00008530: 6c65 2829 2e74 6d5f 7964 6179 0a20 2020  le().tm_yday.   
+00008540: 2020 2020 2020 2020 2079 6561 7220 3d20           year = 
+00008550: 6461 7465 2e79 6561 720a 2020 2020 2020  date.year.      
+00008560: 2020 656c 6966 2069 6e74 2864 6174 6553    elif int(dateS
+00008570: 706c 6974 5b30 5d29 3c3d 3132 2061 6e64  plit[0])<=12 and
+00008580: 2069 6e74 2864 6174 6553 706c 6974 5b32   int(dateSplit[2
+00008590: 5d29 203e 2033 313a 0a20 2020 2020 2020  ]) > 31:.       
+000085a0: 2020 2020 2069 6e66 6f28 2250 7265 6665       info("Prefe
+000085b0: 7272 6564 2064 6174 6520 666f 726d 6174  rred date format
+000085c0: 2069 7320 2779 7979 792d 6d6d 2d64 6427   is 'yyyy-mm-dd'
+000085d0: 206f 7220 2779 7979 792f 6d6d 2f64 6427   or 'yyyy/mm/dd'
+000085e0: 2e20 5769 6c6c 2061 7474 656d 7074 2074  . Will attempt t
+000085f0: 6f20 7061 7273 6520 6461 7465 2e22 290a  o parse date.").
+00008600: 2020 2020 2020 2020 2020 2020 6461 7465              date
+00008610: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
+00008620: 7469 6d65 2869 6e74 2864 6174 6553 706c  time(int(dateSpl
+00008630: 6974 5b32 5d29 2c20 696e 7428 6461 7465  it[2]), int(date
+00008640: 5370 6c69 745b 305d 292c 2069 6e74 2864  Split[0]), int(d
+00008650: 6174 6553 706c 6974 5b31 5d29 290a 2020  ateSplit[1])).  
+00008660: 2020 2020 2020 2020 2020 646f 7920 3d20            doy = 
+00008670: 6461 7465 2e74 696d 6574 7570 6c65 2829  date.timetuple()
+00008680: 2e74 6d5f 7964 6179 0a20 2020 2020 2020  .tm_yday.       
+00008690: 2020 2020 2079 6561 7220 3d20 6461 7465       year = date
+000086a0: 2e79 6561 720a 2020 2020 2020 2020 656c  .year.        el
+000086b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000086c0: 696e 666f 2822 5072 6566 6572 7265 6420  info("Preferred 
+000086d0: 6461 7465 2066 6f72 6d61 7420 6973 2027  date format is '
+000086e0: 7979 7979 2d6d 6d2d 6464 2720 6f72 2027  yyyy-mm-dd' or '
+000086f0: 7979 7979 2f6d 6d2f 6464 272e 2043 616e  yyyy/mm/dd'. Can
+00008700: 6e6f 7420 7061 7273 6520 6461 7465 2e22  not parse date."
+00008710: 290a 2020 2020 656c 6966 2074 7970 6528  ).    elif type(
+00008720: 6461 7465 2920 6973 2069 6e74 3a0a 2020  date) is int:.  
+00008730: 2020 2020 2020 646f 7920 3d20 6461 7465        doy = date
+00008740: 0a20 2020 2020 2020 2079 6561 7220 3d20  .        year = 
+00008750: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
+00008760: 652e 746f 6461 7928 292e 7965 6172 0a20  e.today().year. 
+00008770: 2020 2065 6c73 653a 2023 464f 5220 4e4f     else: #FOR NO
+00008780: 572c 206e 6565 6420 746f 2075 7064 6174  W, need to updat
+00008790: 650a 2020 2020 2020 2020 6461 7465 203d  e.        date =
+000087a0: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
+000087b0: 6d65 2e6e 6f77 2829 0a20 2020 2020 2020  me.now().       
+000087c0: 2064 6f79 203d 2064 6174 652e 7469 6d65   doy = date.time
+000087d0: 7475 706c 6528 292e 746d 5f79 6461 790a  tuple().tm_yday.
+000087e0: 2020 2020 2020 2020 7965 6172 203d 2064          year = d
+000087f0: 6174 652e 7965 6172 0a20 2020 2020 2020  ate.year.       
+00008800: 2070 7269 6e74 2822 4469 6420 6e6f 7420   print("Did not 
+00008810: 7265 636f 676e 697a 6520 6461 7465 2c20  recognize date, 
+00008820: 7573 696e 6720 7965 6172 207b 7d20 616e  using year {} an
+00008830: 6420 6461 7920 7b7d 222e 666f 726d 6174  d day {}".format
+00008840: 2879 6561 722c 2064 6f79 2929 0a0a 2020  (year, doy))..  
+00008850: 2020 2353 656c 6563 7420 7768 6963 6820    #Select which 
+00008860: 696e 7374 7275 6d65 6e74 2077 6520 6172  instrument we ar
+00008870: 6520 7265 6164 696e 6720 6672 6f6d 2028  e reading from (
+00008880: 7265 7175 6972 6573 2064 6966 6665 7265  requires differe
+00008890: 6e74 2070 726f 6365 7373 6573 2066 6f72  nt processes for
+000088a0: 2065 6163 6820 696e 7374 7275 6d65 6e74   each instrument
+000088b0: 290a 2020 2020 7261 7370 5368 616b 6549  ).    raspShakeI
+000088c0: 6e73 744e 616d 654c 6973 7420 3d20 5b27  nstNameList = ['
+000088d0: 7261 7370 6265 7272 7920 7368 616b 6527  raspberry shake'
+000088e0: 2c20 2773 6861 6b65 272c 2027 7261 7370  , 'shake', 'rasp
+000088f0: 6265 7272 7927 2c20 2772 7327 2c20 2772  berry', 'rs', 'r
+00008900: 7333 6427 2c20 2772 6173 702e 2073 6861  s3d', 'rasp. sha
+00008910: 6b65 272c 2027 7261 7370 7368 616b 6527  ke', 'raspshake'
+00008920: 5d0a 2020 2020 6966 2073 6f75 7263 653d  ].    if source=
+00008930: 3d27 7261 7727 3a0a 2020 2020 2020 2020  ='raw':.        
+00008940: 6966 2069 6e73 742e 6c6f 7765 7228 2920  if inst.lower() 
+00008950: 696e 2072 6173 7053 6861 6b65 496e 7374  in raspShakeInst
+00008960: 4e61 6d65 4c69 7374 3a0a 2020 2020 2020  NameList:.      
+00008970: 2020 2020 2020 7261 7744 6174 6149 4e20        rawDataIN 
+00008980: 3d20 5f5f 7265 6164 5f52 535f 6461 7461  = __read_RS_data
+00008990: 2864 6174 6170 6174 682c 2073 6f75 7263  (datapath, sourc
+000089a0: 652c 2079 6561 722c 2064 6f79 2c20 696e  e, year, doy, in
+000089b0: 762c 2070 6172 616d 7329 0a20 2020 2065  v, params).    e
+000089c0: 6c69 6620 736f 7572 6365 3d3d 2764 6972  lif source=='dir
+000089d0: 273a 0a20 2020 2020 2020 2069 6620 696e  ':.        if in
+000089e0: 7374 2e6c 6f77 6572 2829 2069 6e20 7261  st.lower() in ra
+000089f0: 7370 5368 616b 6549 6e73 744e 616d 654c  spShakeInstNameL
+00008a00: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
+00008a10: 2072 6177 4461 7461 494e 203d 205f 5f72   rawDataIN = __r
+00008a20: 6561 645f 5253 5f64 6174 6128 6461 7461  ead_RS_data(data
+00008a30: 7061 7468 2c20 736f 7572 6365 2c20 7965  path, source, ye
+00008a40: 6172 2c20 646f 792c 2069 6e76 2c20 7061  ar, doy, inv, pa
+00008a50: 7261 6d73 290a 2020 2020 656c 6966 2073  rams).    elif s
+00008a60: 6f75 7263 653d 3d27 6669 6c65 273a 0a20  ource=='file':. 
+00008a70: 2020 2020 2020 2072 6177 4461 7461 494e         rawDataIN
+00008a80: 203d 206f 6273 7079 2e72 6561 6428 6461   = obspy.read(da
+00008a90: 7461 7061 7468 2923 2c20 7374 6172 7474  tapath)#, startt
+00008aa0: 696d 653d 6f62 7370 792e 636f 7265 2e55  ime=obspy.core.U
+00008ab0: 5443 4461 7465 5469 6d65 2870 6172 616d  TCDateTime(param
+00008ac0: 735b 2773 7461 7274 7469 6d65 275d 292c  s['starttime']),
+00008ad0: 2065 6e64 7474 696d 653d 6f62 7370 792e   endttime=obspy.
+00008ae0: 636f 7265 2e55 5443 4461 7465 5469 6d65  core.UTCDateTime
+00008af0: 2870 6172 616d 735b 2765 6e64 7469 6d65  (params['endtime
+00008b00: 275d 292c 206e 6561 7265 7374 5f73 616d  ']), nearest_sam
+00008b10: 706c 6520 3d54 7275 6529 0a20 2020 2020  ple =True).     
+00008b20: 2020 2072 6177 4461 7461 494e 2e61 7474     rawDataIN.att
+00008b30: 6163 685f 7265 7370 6f6e 7365 2869 6e76  ach_response(inv
+00008b40: 290a 0a20 2020 2069 6620 7261 7744 6174  )..    if rawDat
+00008b50: 6149 4e20 6973 204e 6f6e 653a 0a20 2020  aIN is None:.   
+00008b60: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00008b70: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+00008b80: 7261 7744 6174 6149 4e2c 206f 6273 7079  rawDataIN, obspy
+00008b90: 2e63 6f72 652e 7374 7265 616d 2e53 7472  .core.stream.Str
+00008ba0: 6561 6d29 3a0a 2020 2020 2020 2020 234d  eam):.        #M
+00008bb0: 616b 6520 7375 7265 207a 2063 6f6d 706f  ake sure z compo
+00008bc0: 6e65 6e74 2069 7320 6669 7273 740a 2020  nent is first.  
+00008bd0: 2020 2020 2020 6966 2027 5a27 2069 6e20        if 'Z' in 
+00008be0: 7261 7744 6174 6149 4e5b 305d 2e73 7461  rawDataIN[0].sta
+00008bf0: 7473 5b27 6368 616e 6e65 6c27 5d3a 2329  ts['channel']:#)
+00008c00: 2e73 706c 6974 2827 2e27 295b 335d 3a23  .split('.')[3]:#
+00008c10: 5b31 323a 3135 5d3a 0a20 2020 2020 2020  [12:15]:.       
+00008c20: 2020 2020 2064 6174 6149 4e20 3d20 7261       dataIN = ra
+00008c30: 7744 6174 6149 4e0a 2020 2020 2020 2020  wDataIN.        
+00008c40: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00008c50: 2020 6461 7461 494e 203d 2072 6177 4461    dataIN = rawDa
+00008c60: 7461 494e 2e73 6f72 7428 5b27 6368 616e  taIN.sort(['chan
+00008c70: 6e65 6c27 5d2c 2072 6576 6572 7365 3d54  nel'], reverse=T
+00008c80: 7275 6529 2023 7a2c 206e 2c20 6520 6f72  rue) #z, n, e or
+00008c90: 6465 720a 2020 2020 656c 7365 3a0a 2020  der.    else:.  
+00008ca0: 2020 2020 2020 6461 7461 494e 203d 205b        dataIN = [
+00008cb0: 5d0a 2020 2020 2020 2020 666f 7220 692c  ].        for i,
+00008cc0: 2073 7420 696e 2065 6e75 6d65 7261 7465   st in enumerate
+00008cd0: 2872 6177 4461 7461 494e 293a 0a20 2020  (rawDataIN):.   
+00008ce0: 2020 2020 2020 2020 2069 6620 275a 2720           if 'Z' 
+00008cf0: 696e 2073 745b 305d 2e73 7461 7473 5b27  in st[0].stats['
+00008d00: 6368 616e 6e65 6c27 5d3a 2329 2e73 706c  channel']:#).spl
+00008d10: 6974 2827 2e27 295b 335d 3a23 5b31 323a  it('.')[3]:#[12:
+00008d20: 3135 5d3a 0a20 2020 2020 2020 2020 2020  15]:.           
+00008d30: 2020 2020 2064 6174 6149 4e2e 6170 7065       dataIN.appe
+00008d40: 6e64 2872 6177 4461 7461 494e 5b69 5d29  nd(rawDataIN[i])
+00008d50: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00008d60: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00008d70: 2020 2064 6174 6149 4e2e 6170 7065 6e64     dataIN.append
+00008d80: 2872 6177 4461 7461 494e 5b69 5d2e 736f  (rawDataIN[i].so
+00008d90: 7274 285b 2763 6861 6e6e 656c 275d 2c20  rt(['channel'], 
+00008da0: 7265 7665 7273 653d 5472 7565 2929 2023  reverse=True)) #
+00008db0: 7a2c 206e 2c20 6520 6f72 6465 7220 2020  z, n, e order   
+00008dc0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00008dd0: 2020 0a20 2020 2069 6620 6e6f 7420 7472    .    if not tr
+00008de0: 696d 5f64 6972 3a0a 2020 2020 2020 2020  im_dir:.        
+00008df0: 7061 7373 0a20 2020 2065 6c73 653a 0a20  pass.    else:. 
+00008e00: 2020 2020 2020 2064 6174 6149 4e20 3d20         dataIN = 
+00008e10: 7472 696d 5f64 6174 6128 7374 7265 616d  trim_data(stream
+00008e20: 3d64 6174 6149 4e2c 2070 6172 616d 733d  =dataIN, params=
+00008e30: 7061 7261 6d73 2c20 6578 706f 7274 5f64  params, export_d
+00008e40: 6972 3d74 7269 6d5f 6469 722c 2065 7870  ir=trim_dir, exp
+00008e50: 6f72 745f 666f 726d 6174 3d65 7870 6f72  ort_format=expor
+00008e60: 745f 666f 726d 6174 290a 0a20 2020 2069  t_format)..    i
+00008e70: 6620 6465 7472 656e 643d 3d46 616c 7365  f detrend==False
+00008e80: 3a0a 2020 2020 2020 2020 7061 7373 0a20  :.        pass. 
+00008e90: 2020 2065 6c69 6620 6465 7472 656e 643d     elif detrend=
+00008ea0: 3d54 7275 653a 0a20 2020 2020 2020 2023  =True:.        #
+00008eb0: 4279 2064 6566 6175 6c74 2c20 646f 2061  By default, do a
+00008ec0: 2073 706c 696e 6520 7265 6d6f 7661 6c0a   spline removal.
+00008ed0: 2020 2020 2020 2020 666f 7220 7472 2069          for tr i
+00008ee0: 6e20 6461 7461 494e 3a0a 2020 2020 2020  n dataIN:.      
+00008ef0: 2020 2020 2020 7472 2e64 6574 7265 6e64        tr.detrend
+00008f00: 2874 7970 653d 2773 706c 696e 6527 2c20  (type='spline', 
+00008f10: 6f72 6465 723d 6465 7472 656e 645f 6f72  order=detrend_or
+00008f20: 6465 722c 2064 7370 6c69 6e65 3d31 3030  der, dspline=100
+00008f30: 3029 2020 2020 2020 2020 0a20 2020 2065  0)        .    e
+00008f40: 6c73 653a 0a20 2020 2020 2020 2069 6620  lse:.        if 
+00008f50: 6465 7472 656e 643d 3d27 7369 6d70 6c65  detrend=='simple
+00008f60: 273a 0a20 2020 2020 2020 2020 2020 2066  ':.            f
+00008f70: 6f72 2074 7220 696e 2064 6174 6149 4e3a  or tr in dataIN:
+00008f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008f90: 2074 722e 6465 7472 656e 6428 7479 7065   tr.detrend(type
+00008fa0: 3d64 6574 7265 6e64 290a 2020 2020 2020  =detrend).      
+00008fb0: 2020 6966 2064 6574 7265 6e64 3d3d 276c    if detrend=='l
+00008fc0: 696e 6561 7227 3a0a 2020 2020 2020 2020  inear':.        
+00008fd0: 2020 2020 666f 7220 7472 2069 6e20 6461      for tr in da
+00008fe0: 7461 494e 3a0a 2020 2020 2020 2020 2020  taIN:.          
+00008ff0: 2020 2020 2020 7472 2e64 6574 7265 6e64        tr.detrend
+00009000: 2874 7970 653d 6465 7472 656e 6429 0a20  (type=detrend). 
+00009010: 2020 2020 2020 2069 6620 6465 7472 656e         if detren
+00009020: 643d 3d27 636f 6e73 7461 6e74 2720 6f72  d=='constant' or
+00009030: 2064 6574 7265 6e64 3d3d 2764 656d 6561   detrend=='demea
+00009040: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
+00009050: 666f 7220 7472 2069 6e20 6461 7461 494e  for tr in dataIN
+00009060: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00009070: 2020 7472 2e64 6574 7265 6e64 2874 7970    tr.detrend(typ
+00009080: 653d 6465 7472 656e 6429 2020 2020 2020  e=detrend)      
+00009090: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+000090a0: 2020 2069 6620 6465 7472 656e 643d 3d27     if detrend=='
+000090b0: 706f 6c79 6e6f 6d69 616c 273a 0a20 2020  polynomial':.   
+000090c0: 2020 2020 2020 2020 2066 6f72 2074 7220           for tr 
+000090d0: 696e 2064 6174 6149 4e3a 0a20 2020 2020  in dataIN:.     
+000090e0: 2020 2020 2020 2020 2020 2074 722e 6465             tr.de
+000090f0: 7472 656e 6428 7479 7065 3d64 6574 7265  trend(type=detre
+00009100: 6e64 2c20 6f72 6465 723d 6465 7472 656e  nd, order=detren
+00009110: 645f 6f72 6465 7229 2020 200a 2020 2020  d_order)   .    
+00009120: 2020 2020 6966 2064 6574 7265 6e64 3d3d      if detrend==
+00009130: 2773 706c 696e 6527 3a0a 2020 2020 2020  'spline':.      
+00009140: 2020 2020 2020 666f 7220 7472 2069 6e20        for tr in 
+00009150: 6461 7461 494e 3a0a 2020 2020 2020 2020  dataIN:.        
+00009160: 2020 2020 2020 2020 7472 2e64 6574 7265          tr.detre
+00009170: 6e64 2874 7970 653d 6465 7472 656e 642c  nd(type=detrend,
+00009180: 206f 7264 6572 3d64 6574 7265 6e64 5f6f   order=detrend_o
+00009190: 7264 6572 2c20 6473 706c 696e 653d 3130  rder, dspline=10
+000091a0: 3030 2920 2020 2020 2020 0a20 2020 200a  00)       .    .
+000091b0: 2020 2020 7061 7261 6d73 5b27 7374 7265      params['stre
+000091c0: 616d 275d 203d 2064 6174 6149 4e0a 0a20  am'] = dataIN.. 
+000091d0: 2020 2072 6574 7572 6e20 7061 7261 6d73     return params
+000091e0: 0a0a 2352 6561 6420 6461 7461 2066 726f  ..#Read data fro
+000091f0: 6d20 7261 7370 6265 7272 7920 7368 616b  m raspberry shak
+00009200: 650a 6465 6620 5f5f 7265 6164 5f52 535f  e.def __read_RS_
+00009210: 6461 7461 2864 6174 6170 6174 682c 2073  data(datapath, s
+00009220: 6f75 7263 652c 2079 6561 722c 2064 6f79  ource, year, doy
+00009230: 2c20 696e 762c 2070 6172 616d 7329 3a0a  , inv, params):.
+00009240: 2020 2020 2222 2222 5072 6976 6174 6520      """"Private 
+00009250: 6675 6e63 7469 6f6e 2075 7365 6420 6279  function used by
+00009260: 2066 6574 6368 5f64 6174 6128 2920 746f   fetch_data() to
+00009270: 2072 6561 6420 696e 2052 6173 7062 6572   read in Raspber
+00009280: 7279 2053 6861 6b65 2064 6174 6122 2222  ry Shake data"""
+00009290: 0a20 2020 2066 726f 6d20 6f62 7370 792e  .    from obspy.
+000092a0: 636f 7265 2069 6d70 6f72 7420 5554 4344  core import UTCD
+000092b0: 6174 6554 696d 650a 2020 2020 6669 6c65  ateTime.    file
+000092c0: 4c69 7374 203d 205b 5d0a 2020 2020 666f  List = [].    fo
+000092d0: 6c64 6572 5061 7468 4c69 7374 203d 205b  lderPathList = [
+000092e0: 5d0a 2020 2020 6669 6c65 7369 6e66 6f6c  ].    filesinfol
+000092f0: 6465 7220 3d20 4661 6c73 650a 2020 2020  der = False.    
+00009300: 0a20 2020 2064 6174 6170 6174 6820 3d20  .    datapath = 
+00009310: 6368 6563 6b69 6670 6174 6828 6461 7461  checkifpath(data
+00009320: 7061 7468 290a 0a20 2020 2023 5265 6164  path)..    #Read
+00009330: 2052 5320 6669 6c65 730a 2020 2020 6966   RS files.    if
+00009340: 2073 6f75 7263 653d 3d27 7261 7727 3a20   source=='raw': 
+00009350: 2372 6177 2064 6174 6120 7769 7468 2069  #raw data with i
+00009360: 6e64 6976 6964 7561 6c20 6669 6c65 7320  ndividual files 
+00009370: 7065 7220 7472 6163 650a 2020 2020 2020  per trace.      
+00009380: 2020 6966 2064 6174 6170 6174 682e 6973    if datapath.is
+00009390: 5f64 6972 2829 3a0a 2020 2020 2020 2020  _dir():.        
+000093a0: 2020 2020 666f 7220 6368 696c 6420 696e      for child in
+000093b0: 2064 6174 6170 6174 682e 6974 6572 6469   datapath.iterdi
+000093c0: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
+000093d0: 2020 2020 2069 6620 6368 696c 642e 6973       if child.is
+000093e0: 5f66 696c 6528 2920 616e 6420 6368 696c  _file() and chil
+000093f0: 642e 6e61 6d65 2e73 7461 7274 7377 6974  d.name.startswit
+00009400: 6828 2741 4d27 2920 616e 6420 7374 7228  h('AM') and str(
+00009410: 646f 7929 2e7a 6669 6c6c 2833 2920 696e  doy).zfill(3) in
+00009420: 2063 6869 6c64 2e6e 616d 6520 616e 6420   child.name and 
+00009430: 7374 7228 7965 6172 2920 696e 2063 6869  str(year) in chi
+00009440: 6c64 2e6e 616d 653a 0a20 2020 2020 2020  ld.name:.       
+00009450: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00009460: 6573 696e 666f 6c64 6572 203d 2054 7275  esinfolder = Tru
+00009470: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00009480: 2020 2020 2020 666f 6c64 6572 5061 7468        folderPath
+00009490: 4c69 7374 2e61 7070 656e 6428 6461 7461  List.append(data
+000094a0: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
+000094b0: 2020 2020 2020 2020 2020 6669 6c65 4c69            fileLi
+000094c0: 7374 2e61 7070 656e 6428 6368 696c 6429  st.append(child)
+000094d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000094e0: 2065 6c69 6620 6368 696c 642e 6973 5f64   elif child.is_d
+000094f0: 6972 2829 2061 6e64 2063 6869 6c64 2e6e  ir() and child.n
+00009500: 616d 652e 7374 6172 7473 7769 7468 2827  ame.startswith('
+00009510: 4548 2729 2061 6e64 206e 6f74 2066 696c  EH') and not fil
+00009520: 6573 696e 666f 6c64 6572 3a0a 2020 2020  esinfolder:.    
+00009530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009540: 666f 6c64 6572 5061 7468 4c69 7374 2e61  folderPathList.a
+00009550: 7070 656e 6428 6368 696c 6429 0a20 2020  ppend(child).   
+00009560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009570: 2066 6f72 2063 2069 6e20 6368 696c 642e   for c in child.
+00009580: 6974 6572 6469 7228 293a 0a20 2020 2020  iterdir():.     
+00009590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095a0: 2020 2069 6620 632e 6973 5f66 696c 6528     if c.is_file(
+000095b0: 2920 616e 6420 632e 6e61 6d65 2e73 7461  ) and c.name.sta
+000095c0: 7274 7377 6974 6828 2741 4d27 2920 616e  rtswith('AM') an
+000095d0: 6420 632e 6e61 6d65 2e65 6e64 7377 6974  d c.name.endswit
+000095e0: 6828 7374 7228 646f 7929 2e7a 6669 6c6c  h(str(doy).zfill
+000095f0: 2833 2929 2061 6e64 2073 7472 2879 6561  (3)) and str(yea
+00009600: 7229 2069 6e20 632e 6e61 6d65 3a0a 2020  r) in c.name:.  
+00009610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009620: 2020 2020 2020 2020 2020 6669 6c65 4c69            fileLi
+00009630: 7374 2e61 7070 656e 6428 6329 0a0a 2020  st.append(c)..  
+00009640: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00009650: 2866 696c 654c 6973 7429 2021 3d33 3a0a  (fileList) !=3:.
+00009660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009670: 6572 726f 7228 2733 2063 6861 6e6e 656c  error('3 channel
+00009680: 7320 6e65 6564 6564 2120 7b7d 2066 6f75  s needed! {} fou
+00009690: 6e64 2e27 2e66 6f72 6d61 7428 6c65 6e28  nd.'.format(len(
+000096a0: 666f 6c64 6572 5061 7468 4c69 7374 2929  folderPathList))
+000096b0: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
+000096c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000096d0: 2020 2020 2020 2070 7269 6e74 2827 5265         print('Re
+000096e0: 6164 696e 6720 6669 6c65 733a 205c 6e5c  ading files: \n\
+000096f0: 747b 7d5c 6e5c 747b 7d5c 6e5c 747b 7d27  t{}\n\t{}\n\t{}'
+00009700: 2e66 6f72 6d61 7428 6669 6c65 4c69 7374  .format(fileList
+00009710: 5b30 5d2e 6e61 6d65 2c20 6669 6c65 4c69  [0].name, fileLi
+00009720: 7374 5b31 5d2e 6e61 6d65 2c20 6669 6c65  st[1].name, file
+00009730: 4c69 7374 5b32 5d2e 6e61 6d65 2929 0a20  List[2].name)). 
+00009740: 2020 2020 2020 2020 2020 2066 696c 654c             fileL
+00009750: 6973 742e 736f 7274 2872 6576 6572 7365  ist.sort(reverse
+00009760: 3d54 7275 6529 2023 2050 7574 7320 7a20  =True) # Puts z 
+00009770: 6368 616e 6e65 6c20 6669 7273 740a 2020  channel first.  
+00009780: 2020 2020 2020 2020 2020 666f 6c64 6572            folder
+00009790: 5061 7468 4c69 7374 2e73 6f72 7428 7265  PathList.sort(re
+000097a0: 7665 7273 653d 5472 7565 290a 0a20 2020  verse=True)..   
+000097b0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+000097c0: 6669 6c65 4c69 7374 2920 3d3d 2030 3a0a  fileList) == 0:.
+000097d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000097e0: 696e 666f 2827 4e6f 2066 696c 6520 666f  info('No file fo
+000097f0: 756e 6420 666f 7220 7370 6563 6966 6965  und for specifie
+00009800: 6420 7061 7261 6d65 7465 7273 2e20 5468  d parameters. Th
+00009810: 6520 666f 6c6c 6f77 696e 6720 6461 7973  e following days
+00009820: 2f66 696c 6573 2065 7869 7374 2066 6f72  /files exist for
+00009830: 2073 7065 6369 6669 6564 2079 6561 7220   specified year 
+00009840: 696e 2074 6869 7320 6469 7265 6374 6f72  in this director
+00009850: 7927 290a 2020 2020 2020 2020 2020 2020  y').            
+00009860: 2020 2020 646f 794c 6973 7420 3d20 5b5d      doyList = []
+00009870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009880: 2066 6f72 206a 2c20 666f 6c64 6572 2069   for j, folder i
+00009890: 6e20 656e 756d 6572 6174 6528 666f 6c64  n enumerate(fold
+000098a0: 6572 5061 7468 4c69 7374 293a 0a20 2020  erPathList):.   
+000098b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000098c0: 2066 6f72 2069 2c20 6669 6c65 2069 6e20   for i, file in 
+000098d0: 656e 756d 6572 6174 6528 666f 6c64 6572  enumerate(folder
+000098e0: 2e69 7465 7264 6972 2829 293a 0a20 2020  .iterdir()):.   
+000098f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009900: 2020 2020 2069 6620 6a20 3d3d 303a 0a20       if j ==0:. 
+00009910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009920: 2020 2020 2020 2020 2020 2064 6f79 4c69             doyLi
+00009930: 7374 2e61 7070 656e 6428 7374 7228 7965  st.append(str(ye
+00009940: 6172 2920 2b20 2720 2720 2b20 7374 7228  ar) + ' ' + str(
+00009950: 6669 6c65 2e6e 616d 655b 2d33 3a5d 2929  file.name[-3:]))
+00009960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009970: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00009980: 6e74 2864 6174 6574 696d 652e 6461 7465  nt(datetime.date
+00009990: 7469 6d65 2e73 7472 7074 696d 6528 646f  time.strptime(do
+000099a0: 794c 6973 745b 695d 2c20 2725 5920 256a  yList[i], '%Y %j
+000099b0: 2729 2e73 7472 6674 696d 6528 2725 6220  ').strftime('%b 
+000099c0: 2564 2729 2c20 277c 2044 6179 206f 6620  %d'), '| Day of 
+000099d0: 7965 6172 3a27 202c 6669 6c65 2e6e 616d  year:' ,file.nam
+000099e0: 655b 2d33 3a5d 290a 2020 2020 2020 2020  e[-3:]).        
+000099f0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00009a00: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00009a10: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+00009a20: 6365 4c69 7374 203d 205b 5d0a 2020 2020  ceList = [].    
+00009a30: 2020 2020 2020 2020 666f 7220 692c 2066          for i, f
+00009a40: 2069 6e20 656e 756d 6572 6174 6528 6669   in enumerate(fi
+00009a50: 6c65 4c69 7374 293a 0a20 2020 2020 2020  leList):.       
+00009a60: 2020 2020 2020 2020 2077 6974 6820 7761           with wa
+00009a70: 726e 696e 6773 2e63 6174 6368 5f77 6172  rnings.catch_war
+00009a80: 6e69 6e67 7328 293a 0a20 2020 2020 2020  nings():.       
+00009a90: 2020 2020 2020 2020 2020 2020 2077 6172               war
+00009aa0: 6e69 6e67 732e 6669 6c74 6572 7761 726e  nings.filterwarn
+00009ab0: 696e 6773 2861 6374 696f 6e3d 2769 676e  ings(action='ign
+00009ac0: 6f72 6527 2c20 6d65 7373 6167 653d 275e  ore', message='^
+00009ad0: 7265 6164 4d53 4545 4442 7566 6665 7228  readMSEEDBuffer(
+00009ae0: 2927 290a 2020 2020 2020 2020 2020 2020  )').            
+00009af0: 2020 2020 2020 2020 7374 203d 206f 6273          st = obs
+00009b00: 7079 2e72 6561 6428 7374 7228 6629 2c20  py.read(str(f), 
+00009b10: 7374 6172 7474 696d 653d 5554 4344 6174  starttime=UTCDat
+00009b20: 6554 696d 6528 7061 7261 6d73 5b27 7374  eTime(params['st
+00009b30: 6172 7474 696d 6527 5d29 2c20 656e 6474  arttime']), endt
+00009b40: 7469 6d65 3d55 5443 4461 7465 5469 6d65  time=UTCDateTime
+00009b50: 2870 6172 616d 735b 2765 6e64 7469 6d65  (params['endtime
+00009b60: 275d 292c 206e 6561 7265 7374 3d54 7275  ']), nearest=Tru
+00009b70: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00009b80: 2020 2020 2020 2074 7220 3d20 2873 745b         tr = (st[
+00009b90: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
+00009ba0: 2020 2020 2020 2020 2374 723d 206f 6273          #tr= obs
+00009bb0: 7079 2e54 7261 6365 2874 722e 6461 7461  py.Trace(tr.data
+00009bc0: 2c68 6561 6465 723d 6d65 7461 290a 2020  ,header=meta).  
+00009bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009be0: 2020 7472 6163 654c 6973 742e 6170 7065    traceList.appe
+00009bf0: 6e64 2874 7229 0a20 2020 2020 2020 2020  nd(tr).         
+00009c00: 2020 2072 6177 4461 7461 494e 203d 206f     rawDataIN = o
+00009c10: 6273 7079 2e53 7472 6561 6d28 7472 6163  bspy.Stream(trac
+00009c20: 654c 6973 7429 0a20 2020 2020 2020 2020  eList).         
+00009c30: 2020 2072 6177 4461 7461 494e 2e61 7474     rawDataIN.att
+00009c40: 6163 685f 7265 7370 6f6e 7365 2869 6e76  ach_response(inv
+00009c50: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00009c60: 2020 2020 2020 2020 2020 2020 7261 7744              rawD
+00009c70: 6174 6149 4e20 3d20 6f62 7370 792e 7265  ataIN = obspy.re
+00009c80: 6164 2873 7472 2864 6174 6170 6174 6829  ad(str(datapath)
+00009c90: 2c20 7374 6172 7474 696d 653d 5554 4344  , starttime=UTCD
+00009ca0: 6174 6554 696d 6528 7061 7261 6d73 5b27  ateTime(params['
+00009cb0: 7374 6172 7474 696d 6527 5d29 2c20 656e  starttime']), en
+00009cc0: 6474 7469 6d65 3d55 5443 4461 7465 5469  dttime=UTCDateTi
+00009cd0: 6d65 2870 6172 616d 735b 2765 6e64 7469  me(params['endti
+00009ce0: 6d65 275d 292c 206e 6561 7265 7374 3d54  me']), nearest=T
+00009cf0: 7275 6529 2020 2020 2020 200a 2020 2020  rue)       .    
+00009d00: 2020 2020 2020 2020 7261 7744 6174 6149          rawDataI
+00009d10: 4e2e 6174 7461 6368 5f72 6573 706f 6e73  N.attach_respons
+00009d20: 6528 696e 7629 0a20 2020 2065 6c69 6620  e(inv).    elif 
+00009d30: 736f 7572 6365 3d3d 2764 6972 273a 2023  source=='dir': #
+00009d40: 6669 6c65 7320 7769 7468 2033 2074 7261  files with 3 tra
+00009d50: 6365 732c 2062 7574 206d 6179 2062 6520  ces, but may be 
+00009d60: 7365 7665 7261 6c20 696e 2061 2064 6972  several in a dir
+00009d70: 6563 746f 7279 206f 7220 6f6e 6c79 2064  ectory or only d
+00009d80: 6972 6563 746f 7279 206e 616d 6520 7072  irectory name pr
+00009d90: 6f76 6964 6564 0a20 2020 2020 2020 206f  ovided.        o
+00009da0: 6273 7079 466f 726d 6174 7320 3d20 5b27  bspyFormats = ['
+00009db0: 4148 272c 2741 4c53 4550 5f50 5345 272c  AH','ALSEP_PSE',
+00009dc0: 2741 4c53 4550 5f57 5448 272c 2741 4c53  'ALSEP_WTH','ALS
+00009dd0: 4550 5f57 544e 272c 2743 5353 272c 2744  EP_WTN','CSS','D
+00009de0: 4d58 272c 2747 4346 272c 2747 5345 3127  MX','GCF','GSE1'
+00009df0: 2c27 4753 4532 272c 274b 494e 454d 4554  ,'GSE2','KINEMET
+00009e00: 5249 4353 5f45 5654 272c 274d 5345 4544  RICS_EVT','MSEED
+00009e10: 272c 274e 4e53 415f 4b42 5f43 4f52 4527  ','NNSA_KB_CORE'
+00009e20: 2c27 5044 4153 272c 2750 4943 4b4c 4527  ,'PDAS','PICKLE'
+00009e30: 2c27 5127 2c27 5245 4654 454b 3133 3027  ,'Q','REFTEK130'
+00009e40: 2c27 5247 3136 272c 2753 4143 272c 2753  ,'RG16','SAC','S
+00009e50: 4143 5859 272c 2753 4547 3227 2c27 5345  ACXY','SEG2','SE
+00009e60: 4759 272c 2753 4549 5341 4e27 2c27 5348  GY','SEISAN','SH
+00009e70: 5f41 5343 272c 2753 4c49 5354 272c 2753  _ASC','SLIST','S
+00009e80: 5527 2c27 5453 5041 4952 272c 2757 4156  U','TSPAIR','WAV
+00009e90: 272c 2757 494e 272c 2759 275d 0a20 2020  ','WIN','Y'].   
+00009ea0: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
+00009eb0: 2064 6174 6170 6174 682e 6974 6572 6469   datapath.iterdi
+00009ec0: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
+00009ed0: 2065 7874 203d 2066 696c 652e 7375 6666   ext = file.suff
+00009ee0: 6978 5b31 3a5d 0a20 2020 2020 2020 2020  ix[1:].         
+00009ef0: 2020 2072 6177 466f 726d 6174 203d 2046     rawFormat = F
+00009f00: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00009f10: 2069 6620 6578 742e 6973 6e75 6d65 7269   if ext.isnumeri
+00009f20: 6328 293a 0a20 2020 2020 2020 2020 2020  c():.           
+00009f30: 2020 2020 2069 6620 666c 6f61 7428 6578       if float(ex
+00009f40: 7429 203e 3d20 3020 616e 6420 666c 6f61  t) >= 0 and floa
+00009f50: 7428 6578 7429 203c 2033 3637 3a0a 2020  t(ext) < 367:.  
+00009f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f70: 2020 7261 7746 6f72 6d61 743d 5472 7565    rawFormat=True
+00009f80: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00009f90: 2020 2020 2020 2020 2020 6966 2065 7874            if ext
+00009fa0: 2e75 7070 6572 2829 2069 6e20 6f62 7370  .upper() in obsp
+00009fb0: 7946 6f72 6d61 7473 206f 7220 7261 7746  yFormats or rawF
+00009fc0: 6f72 6d61 743a 0a20 2020 2020 2020 2020  ormat:.         
+00009fd0: 2020 2020 2020 2066 696c 6573 696e 666f         filesinfo
+00009fe0: 6c64 6572 203d 2054 7275 650a 2020 2020  lder = True.    
+00009ff0: 2020 2020 2020 2020 2020 2020 666f 6c64              fold
+0000a000: 6572 5061 7468 4c69 7374 2e61 7070 656e  erPathList.appen
+0000a010: 6428 6461 7461 7061 7468 290a 2020 2020  d(datapath).    
+0000a020: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0000a030: 4c69 7374 2e61 7070 656e 6428 6669 6c65  List.append(file
+0000a040: 2e6e 616d 6529 0a20 2020 2020 2020 2020  .name).         
+0000a050: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+0000a060: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
+0000a070: 7320 3d20 5b5d 0a20 2020 2020 2020 2072  s = [].        r
+0000a080: 6177 4461 7461 494e 203d 206f 6273 7079  awDataIN = obspy
+0000a090: 2e53 7472 6561 6d28 290a 2020 2020 2020  .Stream().      
+0000a0a0: 2020 666f 7220 692c 2066 2069 6e20 656e    for i, f in en
+0000a0b0: 756d 6572 6174 6528 6669 6c65 4c69 7374  umerate(fileList
+0000a0c0: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
+0000a0d0: 6f6c 6465 7250 6174 684c 6973 745b 695d  olderPathList[i]
+0000a0e0: 203d 2073 7472 2866 6f6c 6465 7250 6174   = str(folderPat
+0000a0f0: 684c 6973 745b 695d 292e 7265 706c 6163  hList[i]).replac
+0000a100: 6528 275c 5c27 2c20 272f 2729 0a20 2020  e('\\', '/').   
+0000a110: 2020 2020 2020 2020 2066 6f6c 6465 7250           folderP
+0000a120: 6174 684c 6973 745b 695d 203d 2073 7472  athList[i] = str
+0000a130: 2866 6f6c 6465 7250 6174 684c 6973 745b  (folderPathList[
+0000a140: 695d 292e 7265 706c 6163 6528 275c 5c27  i]).replace('\\'
+0000a150: 5b30 5d2c 2027 2f27 290a 2020 2020 2020  [0], '/').      
+0000a160: 2020 2020 2020 6669 6c65 7061 7468 732e        filepaths.
+0000a170: 6170 7065 6e64 2873 7472 2866 6f6c 6465  append(str(folde
+0000a180: 7250 6174 684c 6973 745b 695d 292b 272f  rPathList[i])+'/
+0000a190: 272b 6629 0a20 2020 2020 2020 2020 2020  '+f).           
+0000a1a0: 2066 696c 6570 6174 6873 5b69 5d20 3d20   filepaths[i] = 
+0000a1b0: 7061 7468 6c69 622e 5061 7468 2866 696c  pathlib.Path(fil
+0000a1c0: 6570 6174 6873 5b69 5d29 0a20 2020 2020  epaths[i]).     
+0000a1d0: 2020 2020 2020 2063 7572 7244 6174 6120         currData 
+0000a1e0: 3d20 6f62 7370 792e 7265 6164 2866 696c  = obspy.read(fil
+0000a1f0: 6570 6174 6873 5b69 5d29 0a20 2020 2020  epaths[i]).     
+0000a200: 2020 2020 2020 2023 7261 7744 6174 6149         #rawDataI
+0000a210: 4e2e 6170 7065 6e64 2863 7572 7244 6174  N.append(currDat
+0000a220: 6129 0a20 2020 2020 2020 2020 2020 2023  a).            #
+0000a230: 6966 2069 203d 3d20 303a 0a20 2020 2020  if i == 0:.     
+0000a240: 2020 2020 2020 2023 2020 2020 7261 7744         #    rawD
+0000a250: 6174 6149 4e20 3d20 6375 7272 4461 7461  ataIN = currData
+0000a260: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+0000a270: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000a280: 6528 6375 7272 4461 7461 2c20 6f62 7370  e(currData, obsp
+0000a290: 792e 636f 7265 2e73 7472 6561 6d2e 5374  y.core.stream.St
+0000a2a0: 7265 616d 293a 0a20 2020 2020 2020 2020  ream):.         
+0000a2b0: 2020 2020 2020 2072 6177 4461 7461 494e         rawDataIN
+0000a2c0: 202b 3d20 6375 7272 4461 7461 2e63 6f70   += currData.cop
+0000a2d0: 7928 290a 2020 2020 2020 2020 2372 6177  y().        #raw
+0000a2e0: 4461 7461 494e 203d 206f 6273 7079 2e53  DataIN = obspy.S
+0000a2f0: 7472 6561 6d28 7261 7744 6174 6149 4e29  tream(rawDataIN)
+0000a300: 0a20 2020 2020 2020 2072 6177 4461 7461  .        rawData
+0000a310: 494e 2e61 7474 6163 685f 7265 7370 6f6e  IN.attach_respon
+0000a320: 7365 2869 6e76 2920 200a 2020 2020 2020  se(inv)  .      
+0000a330: 2020 6966 2074 7970 6528 7261 7744 6174    if type(rawDat
+0000a340: 6149 4e29 2069 7320 6c69 7374 2061 6e64  aIN) is list and
+0000a350: 206c 656e 2872 6177 4461 7461 494e 293d   len(rawDataIN)=
+0000a360: 3d31 3a0a 2020 2020 2020 2020 2020 2020  =1:.            
+0000a370: 7261 7744 6174 6149 4e20 3d20 7261 7744  rawDataIN = rawD
+0000a380: 6174 6149 4e5b 305d 0a20 2020 2065 6c69  ataIN[0].    eli
+0000a390: 6620 736f 7572 6365 3d3d 2766 696c 6527  f source=='file'
+0000a3a0: 3a0a 2020 2020 2020 2020 7261 7744 6174  :.        rawDat
+0000a3b0: 6149 4e20 3d20 6f62 7370 792e 7265 6164  aIN = obspy.read
+0000a3c0: 2873 7472 2864 6174 6170 6174 6829 2c20  (str(datapath), 
+0000a3d0: 7374 6172 7474 696d 653d 5554 4344 6174  starttime=UTCDat
+0000a3e0: 6554 696d 6528 7061 7261 6d73 5b27 7374  eTime(params['st
+0000a3f0: 6172 7474 696d 6527 5d29 2c20 656e 6474  arttime']), endt
+0000a400: 7469 6d65 3d55 5443 4461 7465 5469 6d65  time=UTCDateTime
+0000a410: 2870 6172 616d 735b 2765 6e64 7469 6d65  (params['endtime
+0000a420: 275d 292c 206e 6561 7265 7374 3d54 7275  ']), nearest=Tru
+0000a430: 6529 2020 2020 2020 200a 2020 2020 2020  e)       .      
+0000a440: 2020 7261 7744 6174 6149 4e2e 6174 7461    rawDataIN.atta
+0000a450: 6368 5f72 6573 706f 6e73 6528 696e 7629  ch_response(inv)
+0000a460: 0a20 2020 2065 6c69 6620 7479 7065 2873  .    elif type(s
+0000a470: 6f75 7263 6529 2069 7320 6c69 7374 206f  ource) is list o
+0000a480: 7220 7479 7065 2864 6174 6170 6174 6829  r type(datapath)
+0000a490: 2069 7320 6c69 7374 3a0a 2020 2020 2020   is list:.      
+0000a4a0: 2020 7061 7373 2023 4576 656e 7475 616c    pass #Eventual
+0000a4b0: 6c79 2064 6f20 736f 6d65 7468 696e 670a  ly do something.
+0000a4c0: 2020 2020 2020 2020 7261 7744 6174 6149          rawDataI
+0000a4d0: 4e2e 6174 7461 6368 5f72 6573 706f 6e73  N.attach_respons
+0000a4e0: 6528 696e 7629 0a20 2020 2072 6574 7572  e(inv).    retur
+0000a4f0: 6e20 7261 7744 6174 6149 4e0a 0a23 5472  n rawDataIN..#Tr
+0000a500: 696d 2064 6174 6120 0a64 6566 2074 7269  im data .def tri
+0000a510: 6d5f 6461 7461 2873 7472 6561 6d2c 2070  m_data(stream, p
+0000a520: 6172 616d 732c 2065 7870 6f72 745f 6469  arams, export_di
+0000a530: 723d 4e6f 6e65 2c20 6578 706f 7274 5f66  r=None, export_f
+0000a540: 6f72 6d61 743d 4e6f 6e65 2c20 2a2a 6b77  ormat=None, **kw
+0000a550: 6172 6773 293a 0a20 2020 2022 2222 4675  args):.    """Fu
+0000a560: 6e63 7469 6f6e 2074 6f20 7472 696d 2064  nction to trim d
+0000a570: 6174 6120 746f 2073 7461 7274 2061 6e64  ata to start and
+0000a580: 2065 6e64 2074 696d 650a 0a20 2020 2020   end time..     
+0000a590: 2020 2054 7269 6d20 6461 7461 2074 6f20     Trim data to 
+0000a5a0: 7374 6172 7420 616e 6420 656e 6420 7469  start and end ti
+0000a5b0: 6d65 7320 736f 2074 6861 7420 7374 7265  mes so that stre
+0000a5c0: 616d 2062 6569 6e67 2061 6e61 6c79 7a65  am being analyze
+0000a5d0: 6420 6f6e 6c79 2063 6f6e 7461 696e 7320  d only contains 
+0000a5e0: 7761 6e74 6564 2064 6174 612e 0a20 2020  wanted data..   
+0000a5f0: 2020 2020 2043 616e 2061 6c73 6f20 6578       Can also ex
+0000a600: 706f 7274 2064 6174 6120 746f 2073 7065  port data to spe
+0000a610: 6369 6669 6564 2064 6972 6563 746f 7279  cified directory
+0000a620: 2075 7369 6e67 2061 2073 7065 6369 6669   using a specifi
+0000a630: 6564 2073 6974 6520 6e61 6d65 2061 6e64  ed site name and
+0000a640: 2f6f 7220 6578 706f 7274 5f66 6f72 6d61  /or export_forma
+0000a650: 740a 0a20 2020 2020 2020 2050 6172 616d  t..        Param
+0000a660: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+0000a670: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0000a680: 2020 2020 2073 7472 6561 6d20 203a 206f       stream  : o
+0000a690: 6273 7079 2e73 7472 6561 6d20 6f62 6a65  bspy.stream obje
+0000a6a0: 6374 2020 0a20 2020 2020 2020 2020 2020  ct  .           
+0000a6b0: 2020 2020 204f 6273 7079 2073 7472 6561       Obspy strea
+0000a6c0: 6d20 746f 2062 6520 7472 696d 6d65 640a  m to be trimmed.
+0000a6d0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+0000a6e0: 6d73 2020 3a20 6469 6374 0a20 2020 2020  ms  : dict.     
+0000a6f0: 2020 2020 2020 2020 2020 2044 6963 7469             Dicti
+0000a700: 6f6e 6172 7920 636f 6e74 6169 6e69 6e67  onary containing
+0000a710: 2069 6e70 7574 2070 6172 616d 6574 6572   input parameter
+0000a720: 7320 666f 7220 7472 696d 6d69 6e67 0a20  s for trimming. 
+0000a730: 2020 2020 2020 2020 2020 2065 7870 6f72             expor
+0000a740: 745f 6469 723a 2073 7472 206f 7220 7061  t_dir: str or pa
+0000a750: 7468 6c69 6220 6f62 6a20 2020 0a20 2020  thlib obj   .   
+0000a760: 2020 2020 2020 2020 2020 2020 204f 7574               Out
+0000a770: 7075 7420 6669 6c65 7061 7468 2074 6f20  put filepath to 
+0000a780: 6578 706f 7274 2074 7269 6d6d 6564 2064  export trimmed d
+0000a790: 6174 6120 746f 2e20 4966 206e 6f74 2073  ata to. If not s
+0000a7a0: 7065 6369 6669 6564 2c20 646f 6573 206e  pecified, does n
+0000a7b0: 6f74 2065 7870 6f72 742e 200a 2020 2020  ot export. .    
+0000a7c0: 2020 2020 2020 2020 6578 706f 7274 5f66          export_f
+0000a7d0: 6f72 6d61 7420 203a 2073 7472 206f 7220  ormat  : str or 
+0000a7e0: 4e6f 6e65 2c20 6465 6661 756c 743d 4e6f  None, default=No
+0000a7f0: 6e65 2020 0a20 2020 2020 2020 2020 2020  ne  .           
+0000a800: 2020 2020 2049 6620 4e6f 6e65 2c20 616e       If None, an
+0000a810: 6420 6578 706f 7274 5f64 6972 2069 7320  d export_dir is 
+0000a820: 7370 6563 6966 6965 642c 2066 6f72 6d61  specified, forma
+0000a830: 7420 6465 6661 756c 7473 2074 6f20 2e6d  t defaults to .m
+0000a840: 7365 6564 2e20 4f74 6865 7277 6973 652c  seed. Otherwise,
+0000a850: 2065 7870 6f72 7473 2074 7269 6d6d 6564   exports trimmed
+0000a860: 2073 7472 6561 6d20 7573 696e 6720 6f62   stream using ob
+0000a870: 7370 792e 636f 7265 2e73 7472 6561 6d2e  spy.core.stream.
+0000a880: 5374 7265 616d 2e77 7269 7465 2829 206d  Stream.write() m
+0000a890: 6574 686f 642c 2077 6974 6820 6578 706f  ethod, with expo
+0000a8a0: 7274 5f66 6f72 6d61 7420 6265 696e 6720  rt_format being 
+0000a8b0: 7061 7373 6564 2074 6f20 7468 6520 666f  passed to the fo
+0000a8c0: 726d 6174 2061 7267 756d 656e 742e 200a  rmat argument. .
+0000a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a8e0: 6874 7470 733a 2f2f 646f 6373 2e6f 6273  https://docs.obs
+0000a8f0: 7079 2e6f 7267 2f70 6163 6b61 6765 732f  py.org/packages/
+0000a900: 6175 746f 6765 6e2f 6f62 7370 792e 636f  autogen/obspy.co
+0000a910: 7265 2e73 7472 6561 6d2e 5374 7265 616d  re.stream.Stream
+0000a920: 2e77 7269 7465 2e68 746d 6c23 6f62 7370  .write.html#obsp
+0000a930: 792e 636f 7265 2e73 7472 6561 6d2e 5374  y.core.stream.St
+0000a940: 7265 616d 2e77 7269 7465 0a20 2020 2020  ream.write.     
+0000a950: 2020 2020 2020 202a 2a6b 7761 7267 730a         **kwargs.
+0000a960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a970: 4b65 7977 6f72 6420 6172 6775 6d65 6e74  Keyword argument
+0000a980: 7320 7061 7373 6564 2064 6972 6563 746c  s passed directl
+0000a990: 7920 746f 206f 6273 7079 2e63 6f72 652e  y to obspy.core.
+0000a9a0: 7374 7265 616d 2e53 7472 6561 6d2e 7472  stream.Stream.tr
+0000a9b0: 696d 2829 206d 6574 686f 642e 2073 7461  im() method. sta
+0000a9c0: 7274 7469 6d65 2061 6e64 2065 6e64 7469  rttime and endti
+0000a9d0: 6d65 2070 6172 616d 6574 6572 7320 6172  me parameters ar
+0000a9e0: 6520 616c 7265 6164 7920 7072 6f76 6964  e already provid
+0000a9f0: 6564 2074 6872 6f75 6768 2074 6865 2070  ed through the p
+0000aa00: 6172 616d 7320 7061 7261 6d65 7465 722c  arams parameter,
+0000aa10: 2073 6f20 7368 6f75 6c64 206e 6f74 2062   so should not b
+0000aa20: 6520 7061 7373 6564 2061 7320 6b77 6172  e passed as kwar
+0000aa30: 6773 2e0a 2020 2020 2020 2020 2020 2020  gs..            
+0000aa40: 2020 2020 0a20 2020 2020 2020 2052 6574      .        Ret
+0000aa50: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+0000aa60: 2d2d 2d2d 0a20 2020 2020 2020 2020 2020  ----.           
+0000aa70: 2073 745f 7472 696d 6d65 6420 203a 206f   st_trimmed  : o
+0000aa80: 6273 7079 2e73 7472 6561 6d20 6f62 6a65  bspy.stream obje
+0000aa90: 6374 200a 2020 2020 2020 2020 2020 2020  ct .            
+0000aaa0: 2020 2020 4f62 7073 7920 5374 7265 616d      Obpsy Stream
+0000aab0: 2074 7269 6d6d 6564 2074 6f20 7374 6172   trimmed to star
+0000aac0: 7420 616e 6420 656e 6420 7469 6d65 730a  t and end times.
+0000aad0: 2020 2020 2222 220a 2020 2020 7374 6172      """.    star
+0000aae0: 7420 3d20 7061 7261 6d73 5b27 7374 6172  t = params['star
+0000aaf0: 7474 696d 6527 5d0a 2020 2020 656e 6420  ttime'].    end 
+0000ab00: 3d20 7061 7261 6d73 5b27 656e 6474 696d  = params['endtim
+0000ab10: 6527 5d0a 2020 2020 7369 7465 203d 2070  e'].    site = p
+0000ab20: 6172 616d 735b 2773 6974 6527 5d0a 0a20  arams['site'].. 
+0000ab30: 2020 2073 745f 7472 696d 6d65 6420 3d20     st_trimmed = 
+0000ab40: 7374 7265 616d 2e63 6f70 7928 290a 0a20  stream.copy().. 
+0000ab50: 2020 2074 7269 6d53 7461 7274 203d 206f     trimStart = o
+0000ab60: 6273 7079 2e55 5443 4461 7465 5469 6d65  bspy.UTCDateTime
+0000ab70: 2873 7461 7274 290a 2020 2020 7472 696d  (start).    trim
+0000ab80: 456e 6420 3d20 6f62 7370 792e 5554 4344  End = obspy.UTCD
+0000ab90: 6174 6554 696d 6528 656e 6429 0a20 2020  ateTime(end).   
+0000aba0: 2066 6f72 2074 7220 696e 2073 745f 7472   for tr in st_tr
+0000abb0: 696d 6d65 643a 0a20 2020 2020 2020 2069  immed:.        i
+0000abc0: 6620 7472 696d 5374 6172 7420 3e20 7472  f trimStart > tr
+0000abd0: 2e73 7461 7473 2e65 6e64 7469 6d65 206f  .stats.endtime o
+0000abe0: 7220 7472 696d 456e 6420 3c20 7472 2e73  r trimEnd < tr.s
+0000abf0: 7461 7473 2e73 7461 7274 7469 6d65 3a0a  tats.starttime:.
+0000ac00: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+0000ac10: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000ac20: 2020 2020 2020 2020 2020 2073 745f 7472             st_tr
+0000ac30: 696d 6d65 642e 7472 696d 2873 7461 7274  immed.trim(start
+0000ac40: 7469 6d65 3d74 7269 6d53 7461 7274 2c20  time=trimStart, 
+0000ac50: 656e 6474 696d 653d 7472 696d 456e 642c  endtime=trimEnd,
+0000ac60: 202a 2a6b 7761 7267 7329 0a20 2020 2073   **kwargs).    s
+0000ac70: 745f 7472 696d 6d65 642e 6d65 7267 6528  t_trimmed.merge(
+0000ac80: 6d65 7468 6f64 3d31 290a 0a20 2020 2023  method=1)..    #
+0000ac90: 466f 726d 6174 2065 7870 6f72 7420 6669  Format export fi
+0000aca0: 6c65 7061 7468 2c20 6966 2065 7870 6f72  lepath, if expor
+0000acb0: 7469 6e67 0a20 2020 2069 6620 6578 706f  ting.    if expo
+0000acc0: 7274 5f66 6f72 6d61 7420 6973 206e 6f74  rt_format is not
+0000acd0: 204e 6f6e 6520 616e 6420 7369 7465 2069   None and site i
+0000ace0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2065  s not None and e
+0000acf0: 7870 6f72 745f 6469 7220 6973 206e 6f74  xport_dir is not
+0000ad00: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
+0000ad10: 6620 7369 7465 2069 7320 4e6f 6e65 3a0a  f site is None:.
+0000ad20: 2020 2020 2020 2020 2020 2020 7369 7465              site
+0000ad30: 3d27 270a 2020 2020 2020 2020 656c 7365  =''.        else
+0000ad40: 3a0a 2020 2020 2020 2020 2020 2020 7369  :.            si
+0000ad50: 7465 203d 2073 6974 652b 275f 270a 2020  te = site+'_'.  
+0000ad60: 2020 2020 2020 6578 706f 7274 5f66 6f72        export_for
+0000ad70: 6d61 7420 3d20 272e 272b 6578 706f 7274  mat = '.'+export
+0000ad80: 5f66 6f72 6d61 740a 2020 2020 2020 2020  _format.        
+0000ad90: 6e65 7420 3d20 7374 5f74 7269 6d6d 6564  net = st_trimmed
+0000ada0: 5b30 5d2e 7374 6174 732e 6e65 7477 6f72  [0].stats.networ
+0000adb0: 6b0a 2020 2020 2020 2020 7374 6120 3d20  k.        sta = 
+0000adc0: 7374 5f74 7269 6d6d 6564 5b30 5d2e 7374  st_trimmed[0].st
+0000add0: 6174 732e 7374 6174 696f 6e0a 2020 2020  ats.station.    
+0000ade0: 2020 2020 6c6f 6320 3d20 7374 5f74 7269      loc = st_tri
+0000adf0: 6d6d 6564 5b30 5d2e 7374 6174 732e 6c6f  mmed[0].stats.lo
+0000ae00: 6361 7469 6f6e 0a20 2020 2020 2020 2079  cation.        y
+0000ae10: 7220 3d20 7374 7228 7374 5f74 7269 6d6d  r = str(st_trimm
+0000ae20: 6564 5b30 5d2e 7374 6174 732e 7374 6172  ed[0].stats.star
+0000ae30: 7474 696d 652e 7965 6172 290a 2020 2020  ttime.year).    
+0000ae40: 2020 2020 7374 7274 443d 7374 7228 7374      strtD=str(st
+0000ae50: 5f74 7269 6d6d 6564 5b30 5d2e 7374 6174  _trimmed[0].stat
+0000ae60: 732e 7374 6172 7474 696d 652e 6461 7465  s.starttime.date
+0000ae70: 290a 2020 2020 2020 2020 7374 7274 543d  ).        strtT=
+0000ae80: 7374 7228 7374 5f74 7269 6d6d 6564 5b30  str(st_trimmed[0
+0000ae90: 5d2e 7374 6174 732e 7374 6172 7474 696d  ].stats.starttim
+0000aea0: 652e 7469 6d65 295b 303a 325d 0a20 2020  e.time)[0:2].   
+0000aeb0: 2020 2020 2073 7472 7454 3d73 7472 7454       strtT=strtT
+0000aec0: 2b73 7472 2873 745f 7472 696d 6d65 645b  +str(st_trimmed[
+0000aed0: 305d 2e73 7461 7473 2e73 7461 7274 7469  0].stats.startti
+0000aee0: 6d65 2e74 696d 6529 5b33 3a35 5d0a 2020  me.time)[3:5].  
+0000aef0: 2020 2020 2020 656e 6454 203d 2073 7472        endT = str
+0000af00: 2873 745f 7472 696d 6d65 645b 305d 2e73  (st_trimmed[0].s
+0000af10: 7461 7473 2e65 6e64 7469 6d65 2e74 696d  tats.endtime.tim
+0000af20: 6529 5b30 3a32 5d0a 2020 2020 2020 2020  e)[0:2].        
+0000af30: 656e 6454 203d 2065 6e64 542b 7374 7228  endT = endT+str(
+0000af40: 7374 5f74 7269 6d6d 6564 5b30 5d2e 7374  st_trimmed[0].st
+0000af50: 6174 732e 656e 6474 696d 652e 7469 6d65  ats.endtime.time
+0000af60: 295b 333a 355d 0a20 2020 2020 2020 2064  )[3:5].        d
+0000af70: 6f79 203d 2073 7472 2873 745f 7472 696d  oy = str(st_trim
+0000af80: 6d65 645b 305d 2e73 7461 7473 2e73 7461  med[0].stats.sta
+0000af90: 7274 7469 6d65 2e75 7463 7469 6d65 7475  rttime.utctimetu
+0000afa0: 706c 6528 292e 746d 5f79 6461 7929 2e7a  ple().tm_yday).z
+0000afb0: 6669 6c6c 2833 290a 0a20 2020 2020 2020  fill(3)..       
+0000afc0: 2065 7870 6f72 745f 6469 7220 3d20 6368   export_dir = ch
+0000afd0: 6563 6b69 6670 6174 6828 6578 706f 7274  eckifpath(export
+0000afe0: 5f64 6972 290a 2020 2020 2020 2020 6578  _dir).        ex
+0000aff0: 706f 7274 5f64 6972 203d 2073 7472 2865  port_dir = str(e
+0000b000: 7870 6f72 745f 6469 7229 0a20 2020 2020  xport_dir).     
+0000b010: 2020 2065 7870 6f72 745f 6469 7220 3d20     export_dir = 
+0000b020: 6578 706f 7274 5f64 6972 2e72 6570 6c61  export_dir.repla
+0000b030: 6365 2827 5c5c 272c 2027 2f27 290a 2020  ce('\\', '/').  
+0000b040: 2020 2020 2020 6578 706f 7274 5f64 6972        export_dir
+0000b050: 203d 2065 7870 6f72 745f 6469 722e 7265   = export_dir.re
+0000b060: 706c 6163 6528 275c 5c27 5b30 5d2c 2027  place('\\'[0], '
+0000b070: 2f27 290a 0a20 2020 2020 2020 2069 6620  /')..        if 
+0000b080: 7479 7065 2865 7870 6f72 745f 666f 726d  type(export_form
+0000b090: 6174 2920 6973 2073 7472 3a0a 2020 2020  at) is str:.    
+0000b0a0: 2020 2020 2020 2020 6669 6c65 6e61 6d65          filename
+0000b0b0: 203d 2073 6974 652b 6e65 742b 272e 272b   = site+net+'.'+
+0000b0c0: 7374 612b 272e 272b 6c6f 632b 272e 272b  sta+'.'+loc+'.'+
+0000b0d0: 7972 2b27 2e27 2b64 6f79 2b27 5f27 2b73  yr+'.'+doy+'_'+s
+0000b0e0: 7472 7444 2b27 5f27 2b73 7472 7454 2b27  trtD+'_'+strtT+'
+0000b0f0: 2d27 2b65 6e64 542b 6578 706f 7274 5f66  -'+endT+export_f
+0000b100: 6f72 6d61 740a 2020 2020 2020 2020 656c  ormat.        el
+0000b110: 6966 2074 7970 6528 6578 706f 7274 5f66  if type(export_f
+0000b120: 6f72 6d61 7429 2069 7320 626f 6f6c 3a0a  ormat) is bool:.
+0000b130: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0000b140: 6e61 6d65 203d 2073 6974 652b 6e65 742b  name = site+net+
+0000b150: 272e 272b 7374 612b 272e 272b 6c6f 632b  '.'+sta+'.'+loc+
+0000b160: 272e 272b 7972 2b27 2e27 2b64 6f79 2b27  '.'+yr+'.'+doy+'
+0000b170: 5f27 2b73 7472 7444 2b27 5f27 2b73 7472  _'+strtD+'_'+str
+0000b180: 7454 2b27 2d27 2b65 6e64 542b 272e 6d73  tT+'-'+endT+'.ms
+0000b190: 6565 6427 0a0a 2020 2020 2020 2020 6966  eed'..        if
+0000b1a0: 2065 7870 6f72 745f 6469 725b 2d31 5d3d   export_dir[-1]=
+0000b1b0: 3d27 2f27 3a0a 2020 2020 2020 2020 2020  ='/':.          
+0000b1c0: 2020 6578 706f 7274 5f64 6972 3d65 7870    export_dir=exp
+0000b1d0: 6f72 745f 6469 725b 3a2d 315d 0a20 2020  ort_dir[:-1].   
+0000b1e0: 2020 2020 200a 2020 2020 2020 2020 6578       .        ex
+0000b1f0: 706f 7274 4669 6c65 203d 2065 7870 6f72  portFile = expor
+0000b200: 745f 6469 722b 272f 272b 6669 6c65 6e61  t_dir+'/'+filena
+0000b210: 6d65 0a0a 2020 2020 2020 2020 7374 5f74  me..        st_t
+0000b220: 7269 6d6d 6564 2e77 7269 7465 2866 696c  rimmed.write(fil
+0000b230: 656e 616d 653d 6578 706f 7274 4669 6c65  ename=exportFile
+0000b240: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+0000b250: 2020 2020 7061 7373 0a0a 2020 2020 7265      pass..    re
+0000b260: 7475 726e 2073 745f 7472 696d 6d65 640a  turn st_trimmed.
+0000b270: 0a23 4675 6e63 7469 6f6e 2074 6f20 7365  .#Function to se
+0000b280: 6c65 6374 2077 696e 646f 7773 2075 7369  lect windows usi
+0000b290: 6e67 206f 7269 6769 6e61 6c20 7374 7265  ng original stre
+0000b2a0: 616d 2073 7065 6367 7261 6d2f 706c 6f74  am specgram/plot
+0000b2b0: 730a 6465 6620 7365 6c65 6374 5f77 696e  s.def select_win
+0000b2c0: 646f 7773 2869 6e70 7574 293a 0a20 2020  dows(input):.   
+0000b2d0: 2022 2222 4675 6e63 7469 6f6e 2074 6f20   """Function to 
+0000b2e0: 6d61 6e75 616c 6c79 2073 656c 6563 7420  manually select 
+0000b2f0: 7769 6e64 6f77 7320 666f 7220 6578 636c  windows for excl
+0000b300: 7573 696f 6e20 6672 6f6d 2064 6174 612e  usion from data.
+0000b310: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+0000b320: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+0000b330: 2020 2020 696e 7075 7420 3a20 6469 6374      input : dict
+0000b340: 0a20 2020 2020 2020 2044 6963 7469 6f6e  .        Diction
+0000b350: 6172 7920 636f 6e74 6169 6e69 6e67 2061  ary containing a
+0000b360: 6c6c 2074 6865 2068 7673 7220 696e 666f  ll the hvsr info
+0000b370: 726d 6174 696f 6e2e 0a0a 2020 2020 5265  rmation...    Re
+0000b380: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+0000b390: 2d0a 2020 2020 7857 696e 646f 7773 203a  -.    xWindows :
+0000b3a0: 206c 6973 740a 2020 2020 2020 2020 4c69   list.        Li
+0000b3b0: 7374 206f 6620 7477 6f2d 6974 656d 206c  st of two-item l
+0000b3c0: 6973 7473 2063 6f6e 7461 696e 696e 6720  ists containing 
+0000b3d0: 7374 6172 7420 616e 6420 656e 6420 7469  start and end ti
+0000b3e0: 6d65 7320 6f66 2077 696e 646f 7773 2074  mes of windows t
+0000b3f0: 6f20 6265 2072 656d 6f76 6564 2e0a 2020  o be removed..  
+0000b400: 2020 2222 220a 2020 2020 6672 6f6d 206d    """.    from m
+0000b410: 6174 706c 6f74 6c69 622e 6261 636b 656e  atplotlib.backen
+0000b420: 645f 6261 7365 7320 696d 706f 7274 204d  d_bases import M
+0000b430: 6f75 7365 4275 7474 6f6e 0a20 2020 2069  ouseButton.    i
+0000b440: 6d70 6f72 7420 6d61 7470 6c6f 746c 6962  mport matplotlib
+0000b450: 2e70 7970 6c6f 7420 6173 2070 6c74 0a20  .pyplot as plt. 
+0000b460: 2020 2069 6d70 6f72 7420 6d61 7470 6c6f     import matplo
+0000b470: 746c 6962 0a20 2020 2069 6d70 6f72 7420  tlib.    import 
+0000b480: 7469 6d65 0a20 2020 2067 6c6f 6261 6c20  time.    global 
+0000b490: 6669 670a 2020 2020 676c 6f62 616c 2061  fig.    global a
+0000b4a0: 780a 0a20 2020 2069 6620 7479 7065 2869  x..    if type(i
+0000b4b0: 6e70 7574 2920 6973 2064 6963 743a 0a20  nput) is dict:. 
+0000b4c0: 2020 2020 2020 2069 6620 2768 7673 725f         if 'hvsr_
+0000b4d0: 6375 7276 6527 2069 6e20 696e 7075 742e  curve' in input.
+0000b4e0: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
+0000b4f0: 2020 2020 6669 672c 2061 7820 3d20 6876      fig, ax = hv
+0000b500: 706c 6f74 2868 7673 725f 6469 6374 3d69  plot(hvsr_dict=i
+0000b510: 6e70 7574 2c20 6b69 6e64 3d27 7370 6563  nput, kind='spec
+0000b520: 272c 2072 6574 7572 6e66 6967 3d54 7275  ', returnfig=Tru
+0000b530: 652c 2063 6d61 703d 2774 7572 626f 2729  e, cmap='turbo')
+0000b540: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000b550: 2020 2020 2020 2020 2020 2070 6172 616d             param
+0000b560: 7320 3d20 696e 7075 742e 636f 7079 2829  s = input.copy()
+0000b570: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
+0000b580: 7574 203d 2069 6e70 7574 5b27 7374 7265  ut = input['stre
+0000b590: 616d 275d 0a20 2020 200a 2020 2020 6966  am'].    .    if
+0000b5a0: 2069 7369 6e73 7461 6e63 6528 696e 7075   isinstance(inpu
+0000b5b0: 742c 206f 6273 7079 2e63 6f72 652e 7374  t, obspy.core.st
+0000b5c0: 7265 616d 2e53 7472 6561 6d29 3a0a 2020  ream.Stream):.  
+0000b5d0: 2020 2020 2020 6669 672c 2061 7820 3d20        fig, ax = 
+0000b5e0: 706c 6f74 5f73 7065 6367 7261 6d5f 7374  plot_specgram_st
+0000b5f0: 7265 616d 2869 6e70 7574 2c20 636f 6d70  ream(input, comp
+0000b600: 6f6e 656e 743d 5b27 5a27 5d29 0a20 2020  onent=['Z']).   
+0000b610: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+0000b620: 2869 6e70 7574 2c20 6f62 7370 792e 636f  (input, obspy.co
+0000b630: 7265 2e74 7261 6365 2e54 7261 6365 293a  re.trace.Trace):
+0000b640: 0a20 2020 2020 2020 2066 6967 2c20 6178  .        fig, ax
+0000b650: 203d 2070 6c6f 745f 7370 6563 6772 616d   = plot_specgram
+0000b660: 5f73 7472 6561 6d28 696e 7075 7429 0a0a  _stream(input)..
+0000b670: 2020 2020 676c 6f62 616c 206c 696e 6541      global lineA
+0000b680: 7274 6973 740a 2020 2020 676c 6f62 616c  rtist.    global
+0000b690: 2077 696e 4172 7469 7374 0a20 2020 2067   winArtist.    g
+0000b6a0: 6c6f 6261 6c20 7769 6e64 6f77 4472 6177  lobal windowDraw
+0000b6b0: 6e0a 2020 2020 676c 6f62 616c 2070 6174  n.    global pat
+0000b6c0: 684c 6973 740a 2020 2020 676c 6f62 616c  hList.    global
+0000b6d0: 2078 5769 6e64 6f77 730a 2020 2020 676c   xWindows.    gl
+0000b6e0: 6f62 616c 2063 6c69 636b 4e6f 0a20 2020  obal clickNo.   
+0000b6f0: 2067 6c6f 6261 6c20 7830 0a20 2020 2078   global x0.    x
+0000b700: 303d 300a 2020 2020 636c 6963 6b4e 6f20  0=0.    clickNo 
+0000b710: 3d20 300a 2020 2020 7857 696e 646f 7773  = 0.    xWindows
+0000b720: 203d 205b 5d0a 2020 2020 7061 7468 4c69   = [].    pathLi
+0000b730: 7374 203d 205b 5d0a 2020 2020 7769 6e64  st = [].    wind
+0000b740: 6f77 4472 6177 6e20 3d20 5b5d 0a20 2020  owDrawn = [].   
+0000b750: 2077 696e 4172 7469 7374 203d 205b 5d0a   winArtist = [].
+0000b760: 2020 2020 6c69 6e65 4172 7469 7374 203d      lineArtist =
+0000b770: 205b 5d0a 0a20 2020 2067 6c6f 6261 6c20   []..    global 
+0000b780: 6669 675f 636c 6f73 6564 0a20 2020 2066  fig_closed.    f
+0000b790: 6967 5f63 6c6f 7365 6420 3d20 4661 6c73  ig_closed = Fals
+0000b7a0: 650a 2020 2020 7768 696c 6520 6669 675f  e.    while fig_
+0000b7b0: 636c 6f73 6564 2069 7320 4661 6c73 653a  closed is False:
+0000b7c0: 0a20 2020 2020 2020 2066 6967 2e63 616e  .        fig.can
+0000b7d0: 7661 732e 6d70 6c5f 636f 6e6e 6563 7428  vas.mpl_connect(
+0000b7e0: 2762 7574 746f 6e5f 7072 6573 735f 6576  'button_press_ev
+0000b7f0: 656e 7427 2c20 5f5f 6f6e 5f63 6c69 636b  ent', __on_click
+0000b800: 2923 2863 6c69 636b 4e6f 2c20 7857 696e  )#(clickNo, xWin
+0000b810: 646f 7773 2c20 7061 7468 4c69 7374 2c20  dows, pathList, 
+0000b820: 7769 6e64 6f77 4472 6177 6e2c 2077 696e  windowDrawn, win
+0000b830: 4172 7469 7374 2c20 6c69 6e65 4172 7469  Artist, lineArti
+0000b840: 7374 2c20 7830 2c20 6669 672c 2061 7829  st, x0, fig, ax)
+0000b850: 290a 2020 2020 2020 2020 6669 672e 6361  ).        fig.ca
+0000b860: 6e76 6173 2e6d 706c 5f63 6f6e 6e65 6374  nvas.mpl_connect
+0000b870: 2827 636c 6f73 655f 6576 656e 7427 2c20  ('close_event', 
+0000b880: 5f5f 6f6e 5f66 6967 5f63 6c6f 7365 2923  __on_fig_close)#
+0000b890: 2863 6c69 636b 4e6f 2c20 7857 696e 646f  (clickNo, xWindo
+0000b8a0: 7773 2c20 7061 7468 4c69 7374 2c20 7769  ws, pathList, wi
+0000b8b0: 6e64 6f77 4472 6177 6e2c 2077 696e 4172  ndowDrawn, winAr
+0000b8c0: 7469 7374 2c20 6c69 6e65 4172 7469 7374  tist, lineArtist
+0000b8d0: 2c20 7830 2c20 6669 672c 2061 7829 290a  , x0, fig, ax)).
+0000b8e0: 2020 2020 2020 2020 706c 742e 7061 7573          plt.paus
+0000b8f0: 6528 3129 0a0a 2020 2020 7061 7261 6d73  e(1)..    params
+0000b900: 5b27 7877 696e 646f 7773 5f6f 7574 275d  ['xwindows_out']
+0000b910: 203d 2078 5769 6e64 6f77 730a 2020 2020   = xWindows.    
+0000b920: 7061 7261 6d73 5b27 6669 6727 5d20 3d20  params['fig'] = 
+0000b930: 6669 670a 2020 2020 7061 7261 6d73 5b27  fig.    params['
+0000b940: 6178 275d 203d 2061 780a 2020 2020 7265  ax'] = ax.    re
+0000b950: 7475 726e 2070 6172 616d 730a 0a23 5375  turn params..#Su
+0000b960: 7070 6f72 7420 6675 6e63 7469 6f6e 2074  pport function t
+0000b970: 6f20 6865 6c70 2073 656c 6563 745f 7769  o help select_wi
+0000b980: 6e64 6f77 7320 7275 6e20 7072 6f70 6572  ndows run proper
+0000b990: 6c79 0a64 6566 205f 5f6f 6e5f 6669 675f  ly.def __on_fig_
+0000b9a0: 636c 6f73 6528 6576 656e 7429 3a0a 2020  close(event):.  
+0000b9b0: 2020 676c 6f62 616c 2066 6967 5f63 6c6f    global fig_clo
+0000b9c0: 7365 640a 2020 2020 6669 675f 636c 6f73  sed.    fig_clos
+0000b9d0: 6564 203d 2054 7275 650a 2020 2020 7265  ed = True.    re
+0000b9e0: 7475 726e 0a0a 2346 756e 6374 696f 6e20  turn..#Function 
+0000b9f0: 746f 2072 656d 6f76 6520 6e6f 6973 6520  to remove noise 
+0000ba00: 7769 6e64 6f77 7320 6672 6f6d 2064 6174  windows from dat
+0000ba10: 610a 6465 6620 7265 6d6f 7665 5f6e 6f69  a.def remove_noi
+0000ba20: 7365 2869 6e70 7574 2c20 6b69 6e64 3d27  se(input, kind='
+0000ba30: 6175 746f 272c 2073 6174 5f70 6572 6365  auto', sat_perce
+0000ba40: 6e74 3d30 2e39 3935 2c20 6e6f 6973 655f  nt=0.995, noise_
+0000ba50: 7065 7263 656e 743d 302e 3830 2c20 7374  percent=0.80, st
+0000ba60: 613d 322c 206c 7461 3d33 302c 2073 7461  a=2, lta=30, sta
+0000ba70: 6c74 615f 7468 7265 7368 3d5b 302e 352c  lta_thresh=[0.5,
+0000ba80: 355d 2c20 7368 6f77 5f70 6c6f 743d 4661  5], show_plot=Fa
+0000ba90: 6c73 652c 2077 6172 6d75 705f 7469 6d65  lse, warmup_time
+0000baa0: 3d30 2c20 636f 6f6c 646f 776e 5f74 696d  =0, cooldown_tim
+0000bab0: 653d 302c 206d 696e 5f77 696e 5f73 697a  e=0, min_win_siz
+0000bac0: 653d 3129 3a0a 2020 2020 2222 2246 756e  e=1):.    """Fun
+0000bad0: 6374 696f 6e20 746f 2072 656d 6f76 6520  ction to remove 
+0000bae0: 6e6f 6973 7920 7769 6e64 6f77 7320 6672  noisy windows fr
+0000baf0: 6f6d 2064 6174 612c 2075 7369 6e67 2076  om data, using v
+0000bb00: 6172 696f 7573 206d 6574 686f 6473 2e0a  arious methods..
+0000bb10: 2020 2020 0a20 2020 204d 6574 686f 6473      .    Methods
+0000bb20: 2069 6e63 6c75 6465 200a 2020 2020 2d20   include .    - 
+0000bb30: 4d61 6e75 616c 2077 696e 646f 7720 7365  Manual window se
+0000bb40: 6c65 6374 696f 6e20 2862 7920 636c 6963  lection (by clic
+0000bb50: 6b69 6e67 206f 6e20 6120 6368 6172 7420  king on a chart 
+0000bb60: 7769 7468 2073 7065 6374 726f 6772 616d  with spectrogram
+0000bb70: 2061 6e64 2073 7472 6561 6d20 6461 7461   and stream data
+0000bb80: 292c 200a 2020 2020 2d20 4175 746f 2077  ), .    - Auto w
+0000bb90: 696e 646f 7720 7365 6c65 6374 696f 6e2c  indow selection,
+0000bba0: 2077 6869 6368 2064 6f65 7320 7468 6520   which does the 
+0000bbb0: 666f 6c6c 6f77 696e 6720 7477 6f20 696e  following two in
+0000bbc0: 2073 6571 7565 6e63 6520 2874 6865 7365   sequence (these
+0000bbd0: 2063 616e 2061 6c73 6f20 6265 2064 6f6e   can also be don
+0000bbe0: 6520 696e 6465 7065 6e74 6c79 293a 0a20  e indepently):. 
+0000bbf0: 2020 2020 2020 202d 2041 2073 7461 2f6c         - A sta/l
+0000bc00: 7461 2022 616e 7469 7472 6967 6765 7222  ta "antitrigger"
+0000bc10: 206d 6574 686f 6420 2875 7369 6e67 2073   method (using s
+0000bc20: 7461 6c74 6120 7661 6c75 6573 2074 6f20  talta values to 
+0000bc30: 6175 746f 6d61 7469 6361 6c6c 7920 7265  automatically re
+0000bc40: 6d6f 7665 2074 7269 6767 6572 6564 2077  move triggered w
+0000bc50: 696e 646f 7773 2077 6865 7265 2074 6865  indows where the
+0000bc60: 7265 2061 7070 6561 7273 2074 6f20 6265  re appears to be
+0000bc70: 2074 6f6f 206d 7563 6820 6e6f 6973 6529   too much noise)
+0000bc80: 0a20 2020 2020 2020 202d 2041 206e 6f69  .        - A noi
+0000bc90: 7365 2074 6872 6573 686f 6c64 206d 6574  se threshold met
+0000bca0: 686f 642c 2074 6861 7420 6375 7473 206f  hod, that cuts o
+0000bcb0: 6666 2061 6c6c 2074 696d 6573 2077 6865  ff all times whe
+0000bcc0: 7265 2074 6865 206e 6f69 7365 2074 6872  re the noise thr
+0000bcd0: 6573 686f 6c64 2065 7175 616c 7320 6d6f  eshold equals mo
+0000bce0: 7265 2074 6861 6e20 2862 7920 6465 6661  re than (by defa
+0000bcf0: 756c 7429 2039 392e 3525 206f 6620 7468  ult) 99.5% of th
+0000bd00: 6520 6869 6768 6573 7420 616d 706c 6974  e highest amplit
+0000bd10: 7564 6520 6e6f 6973 6520 7361 6d70 6c65  ude noise sample
+0000bd20: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+0000bd30: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+0000bd40: 0a20 2020 2069 6e70 7574 203a 2064 6963  .    input : dic
+0000bd50: 742c 206f 6273 7079 2e53 7472 6561 6d2c  t, obspy.Stream,
+0000bd60: 206f 7220 6f62 7370 792e 5472 6163 650a   or obspy.Trace.
+0000bd70: 2020 2020 2020 2020 4469 6374 696f 6e61          Dictiona
+0000bd80: 7279 2063 6f6e 7461 696e 696e 6720 616c  ry containing al
+0000bd90: 6c20 7468 6520 6461 7461 2061 6e64 2070  l the data and p
+0000bda0: 6172 616d 6574 6572 7320 666f 7220 7468  arameters for th
+0000bdb0: 6520 4856 5352 2061 6e61 6c79 7369 730a  e HVSR analysis.
+0000bdc0: 2020 2020 6b69 6e64 203a 2073 7472 2c20      kind : str, 
+0000bdd0: 7b27 6175 746f 272c 2027 6d61 6e75 616c  {'auto', 'manual
+0000bde0: 272c 2027 7374 616c 7461 272f 2761 6e74  ', 'stalta'/'ant
+0000bdf0: 6974 7269 6767 6572 272c 2027 6e6f 6973  itrigger', 'nois
+0000be00: 6520 7468 7265 7368 6f6c 6427 2c20 2777  e threshold', 'w
+0000be10: 6172 6d75 7027 2f27 6275 6666 6572 277d  armup'/'buffer'}
+0000be20: 0a20 2020 2020 2020 2054 6865 2064 6966  .        The dif
+0000be30: 6665 7265 6e74 206d 6574 686f 6473 2066  ferent methods f
+0000be40: 6f72 2072 656d 6f76 696e 6720 6e6f 6973  or removing nois
+0000be50: 6520 6672 6f6d 2074 6865 2064 6174 6173  e from the datas
+0000be60: 6574 2e20 5365 6520 6465 7363 7269 7074  et. See descript
+0000be70: 696f 6e73 2061 626f 7665 2066 6f72 2077  ions above for w
+0000be80: 6861 7420 686f 7720 6561 6368 206d 6574  hat how each met
+0000be90: 686f 6420 776f 726b 732e 2042 7920 6465  hod works. By de
+0000bea0: 6661 756c 7420 2761 7574 6f2e 270a 2020  fault 'auto.'.  
+0000beb0: 2020 6e6f 6973 655f 7065 7263 656e 7420    noise_percent 
+0000bec0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+0000bed0: 3d30 2e39 3935 0a20 2020 2020 2020 2050  =0.995.        P
+0000bee0: 6572 6365 6e74 6167 6520 2862 6574 7765  ercentage (betwe
+0000bef0: 656e 2030 2061 6e64 2031 292c 2074 6f20  en 0 and 1), to 
+0000bf00: 7573 6520 6173 2074 6865 2074 6872 6573  use as the thres
+0000bf10: 686f 6c64 2061 7420 7768 6963 6820 746f  hold at which to
+0000bf20: 2072 656d 6f76 6520 6461 7461 2e20 5468   remove data. Th
+0000bf30: 6973 2069 7320 7573 6564 2069 6e20 7468  is is used in th
+0000bf40: 6520 6e6f 6973 6520 7468 7265 7368 6f6c  e noise threshol
+0000bf50: 6420 6d65 7468 6f64 2e20 4279 2064 6566  d method. By def
+0000bf60: 6175 6c74 2030 2e39 3935 2e20 0a20 2020  ault 0.995. .   
+0000bf70: 2020 2020 2049 6620 6120 7661 6c75 6520       If a value 
+0000bf80: 6973 2070 6173 7365 6420 7468 6174 2069  is passed that i
+0000bf90: 7320 6772 6561 7465 7220 7468 616e 2031  s greater than 1
+0000bfa0: 2c20 6974 2077 696c 6c20 6265 2064 6976  , it will be div
+0000bfb0: 6964 6564 2062 7920 3130 3020 746f 206f  ided by 100 to o
+0000bfc0: 6274 6169 6e20 7468 6520 7065 7263 656e  btain the percen
+0000bfd0: 7461 6765 2e0a 2020 2020 7374 6120 3a20  tage..    sta : 
+0000bfe0: 696e 742c 206f 7074 696f 6e61 6c0a 2020  int, optional.  
+0000bff0: 2020 2020 2020 5368 6f72 7420 7465 726d        Short term
+0000c000: 2061 7665 7261 6765 2028 5354 4129 2077   average (STA) w
+0000c010: 696e 646f 7720 2869 6e20 7365 636f 6e64  indow (in second
+0000c020: 7329 2c20 6279 2064 6566 6175 6c74 2032  s), by default 2
+0000c030: 2e0a 2020 2020 6c74 6120 3a20 696e 742c  ..    lta : int,
+0000c040: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0000c050: 2020 4c6f 6e67 2074 6572 6d20 6176 6572    Long term aver
+0000c060: 6167 6520 2853 5441 2920 7769 6e64 6f77  age (STA) window
+0000c070: 2028 696e 2073 6563 6f6e 6473 292c 2062   (in seconds), b
+0000c080: 7920 6465 6661 756c 7420 322e 0a20 2020  y default 2..   
+0000c090: 2073 7461 6c74 615f 7468 7265 7368 203a   stalta_thresh :
+0000c0a0: 206c 6973 742c 2064 6566 6175 6c74 3d5b   list, default=[
+0000c0b0: 302e 352c 355d 0a20 2020 2020 2020 2054  0.5,5].        T
+0000c0c0: 776f 2d69 7465 6d20 6c69 7374 206f 7220  wo-item list or 
+0000c0d0: 7475 706c 6520 7769 7468 2074 6865 2074  tuple with the t
+0000c0e0: 6872 6573 686f 6c64 7320 666f 7220 7468  hresholds for th
+0000c0f0: 6520 7374 616c 7461 2061 6e74 6974 7269  e stalta antitri
+0000c100: 6767 6572 2e20 5468 6520 6669 7273 7420  gger. The first 
+0000c110: 7661 6c75 6520 2869 6e64 6578 205b 305d  value (index [0]
+0000c120: 2920 6973 2074 6865 206c 6f77 6572 2074  ) is the lower t
+0000c130: 6872 6573 686f 6c64 2c20 7468 6520 7365  hreshold, the se
+0000c140: 636f 6e64 2076 616c 7565 2028 696e 6465  cond value (inde
+0000c150: 7820 5b31 5d20 6973 2074 6865 2075 7070  x [1] is the upp
+0000c160: 6572 2074 6872 6573 686f 6c64 292c 2062  er threshold), b
+0000c170: 7920 6465 6661 756c 7420 5b30 2e35 2c35  y default [0.5,5
+0000c180: 5d0a 2020 2020 7368 6f77 5f70 6c6f 7420  ].    show_plot 
+0000c190: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+0000c1a0: 4661 6c73 650a 2020 2020 2020 2020 4966  False.        If
+0000c1b0: 2054 7275 652c 2077 696c 6c20 706c 6f74   True, will plot
+0000c1c0: 2074 6865 2074 7269 6767 6572 2061 6e64   the trigger and
+0000c1d0: 2073 7461 6c74 6120 7661 6c75 6573 2028   stalta values (
+0000c1e0: 6966 2073 7461 6c74 6120 616e 7469 7472  if stalta antitr
+0000c1f0: 6967 6765 7220 6d65 7468 6f64 292c 206f  igger method), o
+0000c200: 7220 7468 6520 6461 7461 2077 6974 6820  r the data with 
+0000c210: 7468 6520 6e65 7720 7769 6e64 6f77 7320  the new windows 
+0000c220: 7265 6d6f 7665 6420 2869 6620 6e6f 6973  removed (if nois
+0000c230: 6520 7468 7265 7368 6f6c 6429 2c20 6279  e threshold), by
+0000c240: 2064 6566 6175 6c74 2046 616c 7365 2e20   default False. 
+0000c250: 446f 6573 206e 6f74 2061 7070 6c79 2074  Does not apply t
+0000c260: 6f20 276d 616e 7561 6c27 206d 6574 686f  o 'manual' metho
+0000c270: 642e 0a20 2020 2077 6172 6d75 705f 7469  d..    warmup_ti
+0000c280: 6d65 203a 2069 6e74 2c20 6465 6661 756c  me : int, defaul
+0000c290: 743d 300a 2020 2020 2020 2020 5469 6d65  t=0.        Time
+0000c2a0: 2069 6e20 7365 636f 6e64 7320 746f 2061   in seconds to a
+0000c2b0: 6c6c 6f77 2066 6f72 2077 6172 6d75 7020  llow for warmup 
+0000c2c0: 6f66 2074 6865 2069 6e73 7472 756d 656e  of the instrumen
+0000c2d0: 742e 2054 6869 7320 7769 6c6c 2072 656e  t. This will ren
+0000c2e0: 6f76 6520 616e 7920 6461 7461 2062 6566  ove any data bef
+0000c2f0: 6f72 6520 7468 6973 2074 696d 652c 2062  ore this time, b
+0000c300: 7920 6465 6661 756c 7420 302e 0a0a 2020  y default 0...  
+0000c310: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+0000c320: 2d2d 2d2d 2d0a 2020 2020 6f75 7470 7574  -----.    output
+0000c330: 203a 2064 6963 740a 2020 2020 2020 2020   : dict.        
+0000c340: 4469 6374 696f 6e61 7279 2073 696d 696c  Dictionary simil
+0000c350: 6172 2074 6f20 696e 7075 742c 2062 7574  ar to input, but
+0000c360: 2063 6f6e 7461 696e 696e 6720 6d6f 6469   containing modi
+0000c370: 6669 6564 2064 6174 6120 7769 7468 2027  fied data with '
+0000c380: 6e6f 6973 6527 2072 656d 6f76 6564 0a20  noise' removed. 
+0000c390: 2020 2022 2222 0a20 2020 200a 2020 2020     """.    .    
+0000c3a0: 6d61 6e75 616c 4c69 7374 203d 205b 276d  manualList = ['m
+0000c3b0: 616e 7561 6c27 2c20 276d 616e 272c 2027  anual', 'man', '
+0000c3c0: 6d27 2c20 2777 696e 646f 7727 2c20 2777  m', 'window', 'w
+0000c3d0: 696e 646f 7773 272c 2027 7727 5d0a 2020  indows', 'w'].  
+0000c3e0: 2020 6175 746f 4c69 7374 203d 205b 2761    autoList = ['a
+0000c3f0: 7574 6f27 2c20 2761 7574 6f6d 6174 6963  uto', 'automatic
+0000c400: 272c 2027 616c 6c27 2c20 2761 275d 0a20  ', 'all', 'a']. 
+0000c410: 2020 2061 6e74 6974 7269 6767 6572 203d     antitrigger =
+0000c420: 205b 2773 7461 6c74 6127 2c20 2761 6e74   ['stalta', 'ant
+0000c430: 6927 2c20 2761 6e74 6974 7269 6767 6572  i', 'antitrigger
+0000c440: 272c 2027 7472 6967 6765 7227 2c20 2761  ', 'trigger', 'a
+0000c450: 7427 5d0a 2020 2020 7361 7475 7261 7469  t'].    saturati
+0000c460: 6f6e 5468 7265 7368 203d 205b 2773 6174  onThresh = ['sat
+0000c470: 7572 6174 696f 6e20 7468 7265 7368 6f6c  uration threshol
+0000c480: 6427 2c20 2773 6174 7572 6174 696f 6e27  d', 'saturation'
+0000c490: 2c20 2773 6174 272c 2027 7327 5d0a 2020  , 'sat', 's'].  
+0000c4a0: 2020 6e6f 6973 6554 6872 6573 6820 3d20    noiseThresh = 
+0000c4b0: 5b27 6e6f 6973 6520 7468 7265 7368 6f6c  ['noise threshol
+0000c4c0: 6427 2c20 276e 6f69 7365 272c 2027 7468  d', 'noise', 'th
+0000c4d0: 7265 7368 6f6c 6427 2c20 276e 275d 0a20  reshold', 'n']. 
+0000c4e0: 2020 2077 6172 6d75 705f 636f 6f6c 646f     warmup_cooldo
+0000c4f0: 776e 3d5b 2777 6172 6d75 7027 2c20 2763  wn=['warmup', 'c
+0000c500: 6f6f 6c64 6f77 6e27 2c20 2777 6172 6d27  ooldown', 'warm'
+0000c510: 2c20 2763 6f6f 6c27 2c20 2762 7566 6665  , 'cool', 'buffe
+0000c520: 7227 2c20 2777 6172 6d75 702d 636f 6f6c  r', 'warmup-cool
+0000c530: 646f 776e 272c 2027 7761 726d 7570 5f63  down', 'warmup_c
+0000c540: 6f6f 6c64 6f77 6e27 2c20 2777 6327 2c20  ooldown', 'wc', 
+0000c550: 2777 6172 6d5f 636f 6f6c 272c 2027 7761  'warm_cool', 'wa
+0000c560: 726d 2d63 6f6f 6c27 5d0a 0a20 2020 2069  rm-cool']..    i
+0000c570: 6620 6973 696e 7374 616e 6365 2869 6e70  f isinstance(inp
+0000c580: 7574 2c64 6963 7429 3a0a 2020 2020 2020  ut,dict):.      
+0000c590: 2020 6966 2027 7374 7265 616d 5f65 6469    if 'stream_edi
+0000c5a0: 7465 6427 2069 6e20 696e 7075 742e 6b65  ted' in input.ke
+0000c5b0: 7973 2829 3a0a 2020 2020 2020 2020 2020  ys():.          
+0000c5c0: 2020 696e 5374 7265 616d 203d 2069 6e70    inStream = inp
+0000c5d0: 7574 5b27 7374 7265 616d 5f65 6469 7465  ut['stream_edite
+0000c5e0: 6427 5d2e 636f 7079 2829 0a20 2020 2020  d'].copy().     
+0000c5f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000c600: 2020 2020 2069 6e53 7472 6561 6d20 3d20       inStream = 
+0000c610: 696e 7075 745b 2773 7472 6561 6d27 5d2e  input['stream'].
+0000c620: 636f 7079 2829 0a20 2020 2020 2020 206f  copy().        o
+0000c630: 7574 7075 7420 3d20 696e 7075 742e 636f  utput = input.co
+0000c640: 7079 2829 0a20 2020 2065 6c69 6620 6973  py().    elif is
+0000c650: 696e 7374 616e 6365 2869 6e70 7574 2c20  instance(input, 
+0000c660: 6f62 7370 792e 636f 7265 2e73 7472 6561  obspy.core.strea
+0000c670: 6d2e 5374 7265 616d 2920 6f72 2069 7369  m.Stream) or isi
+0000c680: 6e73 7461 6e63 6528 696e 7075 742c 206f  nstance(input, o
+0000c690: 6273 7079 2e63 6f72 652e 7472 6163 652e  bspy.core.trace.
+0000c6a0: 5472 6163 6529 3a0a 2020 2020 2020 2020  Trace):.        
+0000c6b0: 696e 5374 7265 616d 203d 2069 6e70 7574  inStream = input
+0000c6c0: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+0000c6d0: 6f75 7470 7574 203d 2069 6e53 7472 6561  output = inStrea
+0000c6e0: 6d2e 636f 7079 2829 0a20 2020 2065 6c73  m.copy().    els
+0000c6f0: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
+0000c700: 2822 4552 524f 523a 2069 6e70 7574 2069  ("ERROR: input i
+0000c710: 7320 6e6f 7420 6578 7065 6374 6564 2074  s not expected t
+0000c720: 7970 6522 290a 2020 2020 0a20 2020 2069  ype").    .    i
+0000c730: 6620 6b69 6e64 2e6c 6f77 6572 2829 2069  f kind.lower() i
+0000c740: 6e20 6d61 6e75 616c 4c69 7374 3a0a 2020  n manualList:.  
+0000c750: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0000c760: 6e63 6528 6f75 7470 7574 2c20 6469 6374  nce(output, dict
+0000c770: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+0000c780: 6620 2778 7769 6e64 6f77 735f 6f75 7427  f 'xwindows_out'
+0000c790: 2069 6e20 6f75 7470 7574 2e6b 6579 7328   in output.keys(
+0000c7a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000c7b0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+0000c7c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000c7d0: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+0000c7e0: 203d 2073 656c 6563 745f 7769 6e64 6f77   = select_window
+0000c7f0: 7328 6f75 7470 7574 290a 2020 2020 2020  s(output).      
+0000c800: 2020 2020 2020 7769 6e64 6f77 5f6c 6973        window_lis
+0000c810: 7420 3d20 6f75 7470 7574 5b27 7877 696e  t = output['xwin
+0000c820: 646f 7773 5f6f 7574 275d 0a0a 2020 2020  dows_out']..    
+0000c830: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000c840: 6528 696e 5374 7265 616d 2c20 6f62 7370  e(inStream, obsp
+0000c850: 792e 636f 7265 2e73 7472 6561 6d2e 5374  y.core.stream.St
+0000c860: 7265 616d 293a 0a20 2020 2020 2020 2020  ream):.         
+0000c870: 2020 2069 6620 7769 6e64 6f77 5f6c 6973     if window_lis
+0000c880: 7420 6973 206e 6f74 204e 6f6e 653a 0a20  t is not None:. 
+0000c890: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0000c8a0: 7574 7075 745b 2773 7472 6561 6d5f 6564  utput['stream_ed
+0000c8b0: 6974 6564 275d 203d 205f 5f72 656d 6f76  ited'] = __remov
+0000c8c0: 655f 7769 6e64 6f77 7328 696e 5374 7265  e_windows(inStre
+0000c8d0: 616d 2c20 7769 6e64 6f77 5f6c 6973 742c  am, window_list,
+0000c8e0: 2077 6172 6d75 705f 7469 6d65 290a 2020   warmup_time).  
+0000c8f0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c910: 6f75 7470 7574 203d 2073 656c 6563 745f  output = select_
+0000c920: 7769 6e64 6f77 7328 6f75 7470 7574 290a  windows(output).
+0000c930: 2020 2020 2020 2020 656c 6966 2074 7970          elif typ
+0000c940: 6528 6f75 7470 7574 2920 6973 2064 6963  e(output) is dic
+0000c950: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
+0000c960: 6173 730a 2020 2020 2020 2020 656c 7365  ass.        else
+0000c970: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+0000c980: 696e 7428 2745 5252 4f52 3a20 5573 696e  int('ERROR: Usin
+0000c990: 6720 616e 7974 6869 6e67 206f 7468 6572  g anything other
+0000c9a0: 2074 6861 6e20 616e 206f 6273 7079 2073   than an obspy s
+0000c9b0: 7472 6561 6d20 6973 206e 6f74 2063 7572  tream is not cur
+0000c9c0: 7265 6e74 6c79 2073 7570 706f 7274 6564  rently supported
+0000c9d0: 2066 6f72 2074 6869 7320 6e6f 6973 6520   for this noise 
+0000c9e0: 7265 6d6f 7661 6c20 6d65 7468 6f64 2e27  removal method.'
+0000c9f0: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
+0000ca00: 2020 2065 6c69 6620 6b69 6e64 2e6c 6f77     elif kind.low
+0000ca10: 6572 2829 2069 6e20 6175 746f 4c69 7374  er() in autoList
+0000ca20: 3a0a 2020 2020 2020 2020 6f75 7453 7472  :.        outStr
+0000ca30: 6561 6d20 3d20 5f5f 7265 6d6f 7665 5f6e  eam = __remove_n
+0000ca40: 6f69 7365 5f74 6872 6573 6828 696e 5374  oise_thresh(inSt
+0000ca50: 7265 616d 2c20 6e6f 6973 655f 7065 7263  ream, noise_perc
+0000ca60: 656e 743d 6e6f 6973 655f 7065 7263 656e  ent=noise_percen
+0000ca70: 742c 206c 7461 3d6c 7461 2c20 6d69 6e5f  t, lta=lta, min_
+0000ca80: 7769 6e5f 7369 7a65 3d6d 696e 5f77 696e  win_size=min_win
+0000ca90: 5f73 697a 6529 0a20 2020 2020 2020 206f  _size).        o
+0000caa0: 7574 5374 7265 616d 203d 205f 5f72 656d  utStream = __rem
+0000cab0: 6f76 655f 616e 7469 5f73 7461 6c74 6128  ove_anti_stalta(
+0000cac0: 6f75 7453 7472 6561 6d2c 2073 7461 3d73  outStream, sta=s
+0000cad0: 7461 2c20 6c74 613d 6c74 612c 2074 6872  ta, lta=lta, thr
+0000cae0: 6573 683d 7374 616c 7461 5f74 6872 6573  esh=stalta_thres
+0000caf0: 6829 0a20 2020 2020 2020 206f 7574 5374  h).        outSt
+0000cb00: 7265 616d 203d 205f 5f72 656d 6f76 655f  ream = __remove_
+0000cb10: 6e6f 6973 655f 7361 7475 7261 7465 286f  noise_saturate(o
+0000cb20: 7574 5374 7265 616d 2c20 7361 745f 7065  utStream, sat_pe
+0000cb30: 7263 656e 743d 7361 745f 7065 7263 656e  rcent=sat_percen
+0000cb40: 742c 206d 696e 5f77 696e 5f73 697a 653d  t, min_win_size=
+0000cb50: 6d69 6e5f 7769 6e5f 7369 7a65 290a 2020  min_win_size).  
+0000cb60: 2020 2020 2020 6f75 7453 7472 6561 6d20        outStream 
+0000cb70: 3d20 5f5f 7265 6d6f 7665 5f77 6172 6d75  = __remove_warmu
+0000cb80: 705f 636f 6f6c 646f 776e 2873 7472 6561  p_cooldown(strea
+0000cb90: 6d3d 6f75 7453 7472 6561 6d2c 2077 6172  m=outStream, war
+0000cba0: 6d75 705f 7469 6d65 3d77 6172 6d75 705f  mup_time=warmup_
+0000cbb0: 7469 6d65 2c20 636f 6f6c 646f 776e 5f74  time, cooldown_t
+0000cbc0: 696d 653d 636f 6f6c 646f 776e 5f74 696d  ime=cooldown_tim
+0000cbd0: 6529 0a20 2020 2065 6c69 6620 6b69 6e64  e).    elif kind
+0000cbe0: 2e6c 6f77 6572 2829 2069 6e20 616e 7469  .lower() in anti
+0000cbf0: 7472 6967 6765 723a 0a20 2020 2020 2020  trigger:.       
+0000cc00: 206f 7574 5374 7265 616d 203d 205f 5f72   outStream = __r
+0000cc10: 656d 6f76 655f 616e 7469 5f73 7461 6c74  emove_anti_stalt
+0000cc20: 6128 696e 5374 7265 616d 2c20 7374 613d  a(inStream, sta=
+0000cc30: 7374 612c 206c 7461 3d6c 7461 2c20 7468  sta, lta=lta, th
+0000cc40: 7265 7368 3d73 7461 6c74 615f 7468 7265  resh=stalta_thre
+0000cc50: 7368 290a 2020 2020 656c 6966 206b 696e  sh).    elif kin
+0000cc60: 642e 6c6f 7765 7228 2920 696e 2073 6174  d.lower() in sat
+0000cc70: 7572 6174 696f 6e54 6872 6573 683a 0a20  urationThresh:. 
+0000cc80: 2020 2020 2020 206f 7574 5374 7265 616d         outStream
+0000cc90: 203d 205f 5f72 656d 6f76 655f 6e6f 6973   = __remove_nois
+0000cca0: 655f 7361 7475 7261 7465 2869 6e53 7472  e_saturate(inStr
+0000ccb0: 6561 6d2c 2073 6174 5f70 6572 6365 6e74  eam, sat_percent
+0000ccc0: 3d73 6174 5f70 6572 6365 6e74 2c20 6d69  =sat_percent, mi
+0000ccd0: 6e5f 7769 6e5f 7369 7a65 3d6d 696e 5f77  n_win_size=min_w
+0000cce0: 696e 5f73 697a 6529 0a20 2020 2065 6c69  in_size).    eli
+0000ccf0: 6620 6b69 6e64 2e6c 6f77 6572 2829 2069  f kind.lower() i
+0000cd00: 6e20 6e6f 6973 6554 6872 6573 683a 0a20  n noiseThresh:. 
+0000cd10: 2020 2020 2020 206f 7574 5374 7265 616d         outStream
+0000cd20: 203d 205f 5f72 656d 6f76 655f 6e6f 6973   = __remove_nois
+0000cd30: 655f 7468 7265 7368 2869 6e53 7472 6561  e_thresh(inStrea
+0000cd40: 6d2c 206e 6f69 7365 5f70 6572 6365 6e74  m, noise_percent
+0000cd50: 3d6e 6f69 7365 5f70 6572 6365 6e74 2c20  =noise_percent, 
+0000cd60: 6c74 613d 6c74 612c 206d 696e 5f77 696e  lta=lta, min_win
+0000cd70: 5f73 697a 653d 6d69 6e5f 7769 6e5f 7369  _size=min_win_si
+0000cd80: 7a65 290a 2020 2020 656c 6966 206b 696e  ze).    elif kin
+0000cd90: 642e 6c6f 7765 7228 2920 696e 2077 6172  d.lower() in war
+0000cda0: 6d75 705f 636f 6f6c 646f 776e 3a0a 2020  mup_cooldown:.  
+0000cdb0: 2020 2020 2020 6f75 7453 7472 6561 6d20        outStream 
+0000cdc0: 3d20 5f5f 7265 6d6f 7665 5f77 6172 6d75  = __remove_warmu
+0000cdd0: 705f 636f 6f6c 646f 776e 2873 7472 6561  p_cooldown(strea
+0000cde0: 6d3d 696e 5374 7265 616d 2c20 7761 726d  m=inStream, warm
+0000cdf0: 7570 5f74 696d 653d 7761 726d 7570 5f74  up_time=warmup_t
+0000ce00: 696d 652c 2063 6f6f 6c64 6f77 6e5f 7469  ime, cooldown_ti
+0000ce10: 6d65 3d63 6f6f 6c64 6f77 6e5f 7469 6d65  me=cooldown_time
+0000ce20: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+0000ce30: 2020 2020 7072 696e 7428 226b 696e 6420      print("kind 
+0000ce40: 7061 7261 6d65 7465 7220 6973 206e 6f74  parameter is not
+0000ce50: 2072 6563 6f67 6e69 7a65 642e 2050 6c65   recognized. Ple
+0000ce60: 6173 6520 6368 6f6f 7365 206f 6e65 206f  ase choose one o
+0000ce70: 6620 7468 6520 666f 6c6c 6f77 696e 673a  f the following:
+0000ce80: 2027 6d61 6e75 616c 272c 2027 6175 746f   'manual', 'auto
+0000ce90: 272c 2027 616e 7469 7472 6967 6765 7227  ', 'antitrigger'
+0000cea0: 2c20 276e 6f69 7365 2074 6872 6573 686f  , 'noise thresho
+0000ceb0: 6c64 272c 2027 7761 726d 7570 5f63 6f6f  ld', 'warmup_coo
+0000cec0: 6c64 6f77 6e22 290a 2020 2020 2020 2020  ldown").        
+0000ced0: 7265 7475 726e 0a0a 2020 2020 6966 2069  return..    if i
+0000cee0: 7369 6e73 7461 6e63 6528 696e 7075 742c  sinstance(input,
+0000cef0: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
+0000cf00: 6f75 7470 7574 5b27 7374 7265 616d 5f65  output['stream_e
+0000cf10: 6469 7465 6427 5d20 3d20 6f75 7453 7472  dited'] = outStr
+0000cf20: 6561 6d0a 2020 2020 656c 6966 2069 7369  eam.    elif isi
+0000cf30: 6e73 7461 6e63 6528 696e 7075 742c 206f  nstance(input, o
+0000cf40: 6273 7079 2e63 6f72 652e 7374 7265 616d  bspy.core.stream
+0000cf50: 2e53 7472 6561 6d29 206f 7220 6973 696e  .Stream) or isin
+0000cf60: 7374 616e 6365 2869 6e70 7574 2c20 6f62  stance(input, ob
+0000cf70: 7370 792e 636f 7265 2e74 7261 6365 2e54  spy.core.trace.T
+0000cf80: 7261 6365 293a 0a20 2020 2020 2020 206f  race):.        o
+0000cf90: 7574 7075 7420 3d20 6f75 7453 7472 6561  utput = outStrea
+0000cfa0: 6d0a 2020 2020 7265 7475 726e 206f 7574  m.    return out
+0000cfb0: 7075 740a 0a23 5368 6f77 7320 7769 6e64  put..#Shows wind
+0000cfc0: 6f77 7320 7769 7468 204e 6f6e 656f 6e20  ows with Noneon 
+0000cfd0: 696e 7075 7420 706c 6f74 0a64 6566 2073  input plot.def s
+0000cfe0: 686f 775f 7265 6d6f 7665 645f 7769 6e64  how_removed_wind
+0000cff0: 6f77 7328 696e 7075 742c 2066 6967 3d4e  ows(input, fig=N
+0000d000: 6f6e 652c 2061 783d 4e6f 6e65 2c20 6c69  one, ax=None, li
+0000d010: 6e65 4172 7469 7374 203d 5b5d 2c20 7769  neArtist =[], wi
+0000d020: 6e41 7274 6973 7420 3d20 5b5d 2c20 6578  nArtist = [], ex
+0000d030: 6973 7469 6e67 5f6c 696e 6541 7274 6973  isting_lineArtis
+0000d040: 7473 3d5b 5d2c 206b 6565 705f 6c69 6e65  ts=[], keep_line
+0000d050: 5f61 7274 6973 7473 3d54 7275 652c 2074  _artists=True, t
+0000d060: 696d 655f 7479 7065 3d27 6d61 7470 6c6f  ime_type='matplo
+0000d070: 746c 6962 2729 3a0a 2020 2020 6966 2066  tlib'):.    if f
+0000d080: 6967 2069 7320 4e6f 6e65 2061 6e64 2061  ig is None and a
+0000d090: 7820 6973 204e 6f6e 653a 0a20 2020 2020  x is None:.     
+0000d0a0: 2020 2066 6967 2c20 6178 203d 2070 6c74     fig, ax = plt
+0000d0b0: 2e73 7562 706c 6f74 7328 290a 0a20 2020  .subplots()..   
+0000d0c0: 2069 6620 7479 7065 2869 6e70 7574 2920   if type(input) 
+0000d0d0: 6973 2064 6963 743a 0a20 2020 2020 2020  is dict:.       
+0000d0e0: 2069 6620 2773 7472 6561 6d5f 6564 6974   if 'stream_edit
+0000d0f0: 6564 2720 696e 2069 6e70 7574 2e6b 6579  ed' in input.key
+0000d100: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0000d110: 2073 7472 6561 6d20 3d20 696e 7075 745b   stream = input[
+0000d120: 2773 7472 6561 6d5f 6564 6974 6564 275d  'stream_edited']
+0000d130: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+0000d140: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000d150: 2020 7374 7265 616d 203d 2069 6e70 7574    stream = input
+0000d160: 5b27 7374 7265 616d 275d 2e63 6f70 7928  ['stream'].copy(
+0000d170: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+0000d180: 2020 2020 7374 7265 616d 203d 2069 6e70      stream = inp
+0000d190: 7574 2e63 6f70 7928 290a 0a20 2020 2023  ut.copy()..    #
+0000d1a0: 4765 7420 6d61 736b 6564 2069 6e64 6963  Get masked indic
+0000d1b0: 6573 206f 6620 7472 6163 6528 7329 0a20  es of trace(s). 
+0000d1c0: 2020 2074 7261 6365 203d 2073 7472 6561     trace = strea
+0000d1d0: 6d5b 305d 0a20 2020 2077 696e 646f 7773  m[0].    windows
+0000d1e0: 203d 205b 5d0a 2020 2020 7769 6e64 6f77   = [].    window
+0000d1f0: 732e 6170 7065 6e64 285b 302c 6e70 2e6e  s.append([0,np.n
+0000d200: 616e 5d29 0a0a 2020 2020 236d 6173 6b20  an])..    #mask 
+0000d210: 3d20 6e70 2e69 736e 616e 2874 7261 6365  = np.isnan(trace
+0000d220: 2e64 6174 6129 2020 2320 4372 6561 7465  .data)  # Create
+0000d230: 2061 206d 6173 6b20 666f 7220 4e6f 6e65   a mask for None
+0000d240: 2076 616c 7565 730a 2020 2020 236d 6173   values.    #mas
+0000d250: 6b65 645f 6172 7261 7920 3d20 6e70 2e6d  ked_array = np.m
+0000d260: 612e 6172 7261 7928 7472 6163 652e 6461  a.array(trace.da
+0000d270: 7461 2c20 6d61 736b 3d6d 6173 6b29 2e63  ta, mask=mask).c
+0000d280: 6f70 7928 290a 2020 2020 6d61 736b 6564  opy().    masked
+0000d290: 5f61 7272 6179 203d 2074 7261 6365 2e64  _array = trace.d
+0000d2a0: 6174 612e 636f 7079 2829 0a0a 2020 2020  ata.copy()..    
+0000d2b0: 6966 2069 7369 6e73 7461 6e63 6528 6d61  if isinstance(ma
+0000d2c0: 736b 6564 5f61 7272 6179 2c20 6e70 2e6d  sked_array, np.m
+0000d2d0: 612e 4d61 736b 6564 4172 7261 7929 3a0a  a.MaskedArray):.
+0000d2e0: 2020 2020 2020 2020 7361 6d70 6c65 5f72          sample_r
+0000d2f0: 6174 6520 3d20 7472 6163 652e 7374 6174  ate = trace.stat
+0000d300: 732e 7361 6d70 6c69 6e67 5f72 6174 650a  s.sampling_rate.
+0000d310: 2020 2020 2020 2020 6d61 736b 6564 5f61          masked_a
+0000d320: 7272 6179 203d 206d 6173 6b65 645f 6172  rray = masked_ar
+0000d330: 7261 792e 6d61 736b 2e6e 6f6e 7a65 726f  ray.mask.nonzero
+0000d340: 2829 5b30 5d0a 2020 2020 2020 2020 6c61  ()[0].        la
+0000d350: 7374 4d61 736b 496e 6420 3d20 6d61 736b  stMaskInd = mask
+0000d360: 6564 5f61 7272 6179 5b30 5d0a 2020 2020  ed_array[0].    
+0000d370: 2020 2020 7749 6e64 203d 2030 0a20 2020      wInd = 0.   
+0000d380: 2020 2020 2023 6d61 736b 6564 5f61 7272       #masked_arr
+0000d390: 6179 203d 2074 7261 6365 2e64 6174 612e  ay = trace.data.
+0000d3a0: 6d61 736b 2e6e 6f6e 7a65 726f 2829 5b30  mask.nonzero()[0
+0000d3b0: 5d0a 2020 2020 2020 2020 666f 7220 6920  ].        for i 
+0000d3c0: 696e 2072 616e 6765 2831 2c20 6c65 6e28  in range(1, len(
+0000d3d0: 6d61 736b 6564 5f61 7272 6179 2929 3a0a  masked_array)):.
+0000d3e0: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+0000d3f0: 496e 6420 3d20 6d61 736b 6564 5f61 7272  Ind = masked_arr
+0000d400: 6179 5b69 5d0a 2020 2020 2020 2020 2020  ay[i].          
+0000d410: 2020 6966 206d 6173 6b49 6e64 2d6c 6173    if maskInd-las
+0000d420: 744d 6173 6b49 6e64 203e 2031 3a0a 2020  tMaskInd > 1:.  
+0000d430: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+0000d440: 6e64 6f77 732e 6170 7065 6e64 285b 6e70  ndows.append([np
+0000d450: 2e6e 616e 2c20 6e70 2e6e 616e 5d29 0a20  .nan, np.nan]). 
+0000d460: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000d470: 696e 646f 7773 5b77 496e 645d 5b31 5d20  indows[wInd][1] 
+0000d480: 3d20 6d61 736b 6564 5f61 7272 6179 5b69  = masked_array[i
+0000d490: 202d 2031 5d0a 2020 2020 2020 2020 2020   - 1].          
+0000d4a0: 2020 2020 2020 7749 6e64 202b 3d20 310a        wInd += 1.
+0000d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d4c0: 7769 6e64 6f77 735b 7749 6e64 5d5b 305d  windows[wInd][0]
+0000d4d0: 203d 206d 6173 6b65 645f 6172 7261 795b   = masked_array[
+0000d4e0: 695d 0a0a 2020 2020 2020 2020 2020 2020  i]..            
+0000d4f0: 6c61 7374 4d61 736b 496e 6420 3d20 6d61  lastMaskInd = ma
+0000d500: 736b 496e 6420 2020 200a 2020 2020 2020  skInd    .      
+0000d510: 2020 7769 6e64 6f77 735b 7749 6e64 5d5b    windows[wInd][
+0000d520: 315d 203d 206d 6173 6b65 645f 6172 7261  1] = masked_arra
+0000d530: 795b 2d31 5d0a 0a20 2020 2020 2020 2023  y[-1]..        #
+0000d540: 5265 666f 726d 6174 2061 7820 6173 206e  Reformat ax as n
+0000d550: 6565 6465 640a 2020 2020 2020 2020 6966  eeded.        if
+0000d560: 2069 7369 6e73 7461 6e63 6528 6178 2c20   isinstance(ax, 
+0000d570: 6e70 2e6e 6461 7272 6179 293a 0a20 2020  np.ndarray):.   
+0000d580: 2020 2020 2020 2020 206f 7269 6741 7865           origAxe
+0000d590: 7320 3d20 6178 2e63 6f70 7928 290a 2020  s = ax.copy().  
+0000d5a0: 2020 2020 2020 2020 2020 6e65 7741 7820            newAx 
+0000d5b0: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
+0000d5c0: 2066 6f72 2069 2c20 6120 696e 2065 6e75   for i, a in enu
+0000d5d0: 6d65 7261 7465 2861 7829 3a0a 2020 2020  merate(ax):.    
+0000d5e0: 2020 2020 2020 2020 2020 2020 6e65 7741              newA
+0000d5f0: 785b 695d 203d 2061 0a20 2020 2020 2020  x[i] = a.       
+0000d600: 2020 2020 2061 7865 7320 3d20 6e65 7741       axes = newA
+0000d610: 780a 2020 2020 2020 2020 656c 6966 2069  x.        elif i
+0000d620: 7369 6e73 7461 6e63 6528 6178 2c20 6469  sinstance(ax, di
+0000d630: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
+0000d640: 206f 7269 6741 7865 7320 3d20 6178 0a20   origAxes = ax. 
+0000d650: 2020 2020 2020 2020 2020 2061 7865 7320             axes 
+0000d660: 3d20 6178 0a20 2020 2020 2020 2065 6c73  = ax.        els
+0000d670: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
+0000d680: 7269 6741 7865 7320 3d20 6178 0a20 2020  rigAxes = ax.   
+0000d690: 2020 2020 2020 2020 2061 7865 7320 3d20           axes = 
+0000d6a0: 7b27 6178 273a 6178 7d0a 0a20 2020 2020  {'ax':ax}..     
+0000d6b0: 2020 2073 616d 706c 6573 4c69 7374 203d     samplesList =
+0000d6c0: 205b 2773 616d 706c 6527 2c20 2773 616d   ['sample', 'sam
+0000d6d0: 706c 6573 272c 2027 7327 5d0a 2020 2020  ples', 's'].    
+0000d6e0: 2020 2020 7574 634c 6973 7420 3d20 5b27      utcList = ['
+0000d6f0: 7574 6327 2c20 2775 7463 6461 7465 7469  utc', 'utcdateti
+0000d700: 6d65 272c 2027 6f62 7370 7927 2c20 2775  me', 'obspy', 'u
+0000d710: 272c 2027 6f27 5d0a 2020 2020 2020 2020  ', 'o'].        
+0000d720: 6d61 7470 6c6f 746c 6962 4c69 7374 203d  matplotlibList =
+0000d730: 205b 276d 6174 706c 6f74 6c69 6227 2c20   ['matplotlib', 
+0000d740: 276d 706c 272c 2027 6d27 5d20 2020 200a  'mpl', 'm']    .
+0000d750: 0a20 2020 2020 2020 2066 6f72 2069 2c20  .        for i, 
+0000d760: 6120 696e 2065 6e75 6d65 7261 7465 2861  a in enumerate(a
+0000d770: 7865 732e 6b65 7973 2829 293a 0a20 2020  xes.keys()):.   
+0000d780: 2020 2020 2020 2020 2061 7820 3d20 6178           ax = ax
+0000d790: 6573 5b61 5d0a 2020 2020 2020 2020 2020  es[a].          
+0000d7a0: 2020 7061 7468 4c69 7374 203d 205b 5d0a    pathList = [].
+0000d7b0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0000d7c0: 2020 2020 2020 2020 2077 696e 646f 7744           windowD
+0000d7d0: 7261 776e 203d 205b 5d0a 2020 2020 2020  rawn = [].      
+0000d7e0: 2020 2020 2020 7769 6e41 7274 6973 7420        winArtist 
+0000d7f0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+0000d800: 2069 6620 6578 6973 7469 6e67 5f6c 696e   if existing_lin
+0000d810: 6541 7274 6973 7473 203d 3d20 5b5d 3a0a  eArtists == []:.
+0000d820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d830: 6c69 6e65 4172 7469 7374 203d 205b 5d0a  lineArtist = [].
+0000d840: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0000d850: 206c 656e 2865 7869 7374 696e 675f 6c69   len(existing_li
+0000d860: 6e65 4172 7469 7374 7329 3e3d 3120 616e  neArtists)>=1 an
+0000d870: 6420 6b65 6570 5f6c 696e 655f 6172 7469  d keep_line_arti
+0000d880: 7374 733a 0a20 2020 2020 2020 2020 2020  sts:.           
+0000d890: 2020 2020 206c 696e 6541 7274 6973 7420       lineArtist 
+0000d8a0: 3d20 6578 6973 7469 6e67 5f6c 696e 6541  = existing_lineA
+0000d8b0: 7274 6973 7473 0a20 2020 2020 2020 2020  rtists.         
+0000d8c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000d8d0: 2020 2020 2020 2020 206c 696e 6541 7274           lineArt
+0000d8e0: 6973 7420 3d20 5b5d 0a0a 2020 2020 2020  ist = []..      
+0000d8f0: 2020 2020 2020 666f 7220 7769 6e4e 756d        for winNum
+0000d900: 732c 2077 696e 2069 6e20 656e 756d 6572  s, win in enumer
+0000d910: 6174 6528 7769 6e64 6f77 7329 3a0a 2020  ate(windows):.  
+0000d920: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000d930: 2074 696d 655f 7479 7065 2e6c 6f77 6572   time_type.lower
+0000d940: 2829 2069 6e20 7361 6d70 6c65 734c 6973  () in samplesLis
+0000d950: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0000d960: 2020 2020 2020 2078 3020 3d20 7769 6e5b         x0 = win[
+0000d970: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+0000d980: 2020 2020 2020 2078 3120 3d20 7769 6e5b         x1 = win[
+0000d990: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
+0000d9a0: 2020 2065 6c69 6620 7469 6d65 5f74 7970     elif time_typ
+0000d9b0: 652e 6c6f 7765 7228 2920 696e 2075 7463  e.lower() in utc
+0000d9c0: 4c69 7374 206f 7220 7469 6d65 5f74 7970  List or time_typ
+0000d9d0: 652e 6c6f 7765 7228 2920 696e 206d 6174  e.lower() in mat
+0000d9e0: 706c 6f74 6c69 624c 6973 743a 0a20 2020  plotlibList:.   
+0000d9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000da00: 2073 616d 706c 655f 7261 7465 203d 2074   sample_rate = t
+0000da10: 7261 6365 2e73 7461 7473 2e64 656c 7461  race.stats.delta
+0000da20: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000da30: 2020 2020 2020 7830 203d 2074 7261 6365        x0 = trace
+0000da40: 2e73 7461 7473 2e73 7461 7274 7469 6d65  .stats.starttime
+0000da50: 202b 2077 696e 5b30 5d20 2a20 7361 6d70   + win[0] * samp
+0000da60: 6c65 5f72 6174 650a 2020 2020 2020 2020  le_rate.        
+0000da70: 2020 2020 2020 2020 2020 2020 7831 203d              x1 =
+0000da80: 2074 7261 6365 2e73 7461 7473 2e73 7461   trace.stats.sta
+0000da90: 7274 7469 6d65 202b 2077 696e 5b31 5d20  rttime + win[1] 
+0000daa0: 2a20 7361 6d70 6c65 5f72 6174 650a 0a20  * sample_rate.. 
+0000dab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dac0: 2020 2069 6620 7469 6d65 5f74 7970 652e     if time_type.
+0000dad0: 6c6f 7765 7228 2920 696e 206d 6174 706c  lower() in matpl
+0000dae0: 6f74 6c69 624c 6973 743a 0a20 2020 2020  otlibList:.     
+0000daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db00: 2020 2078 3020 3d20 7830 2e6d 6174 706c     x0 = x0.matpl
+0000db10: 6f74 6c69 625f 6461 7465 0a20 2020 2020  otlib_date.     
+0000db20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db30: 2020 2078 3120 3d20 7831 2e6d 6174 706c     x1 = x1.matpl
+0000db40: 6f74 6c69 625f 6461 7465 0a20 2020 2020  otlib_date.     
+0000db50: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000db60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000db70: 2020 2020 2070 7269 6e74 2827 7469 6d65       print('time
+0000db80: 5f74 7970 6520 6572 726f 7227 290a 2020  _type error').  
+0000db90: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+0000dba0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+0000dbb0: 302c 2079 3120 3d20 6178 2e67 6574 5f79  0, y1 = ax.get_y
+0000dbc0: 6c69 6d28 290a 0a20 2020 2020 2020 2020  lim()..         
+0000dbd0: 2020 2020 2020 2070 6174 685f 6461 7461         path_data
+0000dbe0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+0000dbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc00: 2028 6d61 7470 6c6f 746c 6962 2e70 6174   (matplotlib.pat
+0000dc10: 682e 5061 7468 2e4d 4f56 4554 4f2c 2028  h.Path.MOVETO, (
+0000dc20: 7830 2c20 7930 2929 2c0a 2020 2020 2020  x0, y0)),.      
+0000dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc40: 2020 2020 2020 286d 6174 706c 6f74 6c69        (matplotli
+0000dc50: 622e 7061 7468 2e50 6174 682e 4c49 4e45  b.path.Path.LINE
+0000dc60: 544f 2c20 2878 312c 2079 3029 292c 0a20  TO, (x1, y0)),. 
+0000dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc80: 2020 2020 2020 2020 2020 2028 6d61 7470             (matp
+0000dc90: 6c6f 746c 6962 2e70 6174 682e 5061 7468  lotlib.path.Path
+0000dca0: 2e4c 494e 4554 4f2c 2028 7831 2c20 7931  .LINETO, (x1, y1
+0000dcb0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+0000dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dcd0: 286d 6174 706c 6f74 6c69 622e 7061 7468  (matplotlib.path
+0000dce0: 2e50 6174 682e 4c49 4e45 544f 2c20 2878  .Path.LINETO, (x
+0000dcf0: 302c 2079 3129 292c 0a20 2020 2020 2020  0, y1)),.       
+0000dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd10: 2020 2020 2028 6d61 7470 6c6f 746c 6962       (matplotlib
+0000dd20: 2e70 6174 682e 5061 7468 2e4c 494e 4554  .path.Path.LINET
+0000dd30: 4f2c 2028 7830 2c20 7930 2929 2c0a 2020  O, (x0, y0)),.  
+0000dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd50: 2020 2020 2020 2020 2020 286d 6174 706c            (matpl
+0000dd60: 6f74 6c69 622e 7061 7468 2e50 6174 682e  otlib.path.Path.
+0000dd70: 434c 4f53 4550 4f4c 592c 2028 7830 2c20  CLOSEPOLY, (x0, 
+0000dd80: 7930 2929 2c0a 2020 2020 2020 2020 2020  y0)),.          
+0000dd90: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+0000dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ddb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ddc0: 2063 6f64 6573 2c20 7665 7274 7320 3d20   codes, verts = 
+0000ddd0: 7a69 7028 2a70 6174 685f 6461 7461 290a  zip(*path_data).
+0000dde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ddf0: 7061 7468 203d 206d 6174 706c 6f74 6c69  path = matplotli
+0000de00: 622e 7061 7468 2e50 6174 6828 7665 7274  b.path.Path(vert
+0000de10: 732c 2063 6f64 6573 290a 0a20 2020 2020  s, codes)..     
+0000de20: 2020 2020 2020 2020 2020 2023 0a20 2020             #.   
+0000de30: 2020 2020 2020 2020 2020 2020 2077 696e               win
+0000de40: 646f 7744 7261 776e 2e61 7070 656e 6428  dowDrawn.append(
+0000de50: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+0000de60: 2020 2020 2020 2077 696e 4172 7469 7374         winArtist
+0000de70: 2e61 7070 656e 6428 4e6f 6e65 290a 2020  .append(None).  
+0000de80: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+0000de90: 6e65 4172 7469 7374 2e61 7070 656e 6428  neArtist.append(
+0000dea0: 5b5d 290a 2020 2020 2020 2020 2020 2020  []).            
+0000deb0: 2020 2020 6c69 6e41 7274 3020 3d20 6178      linArt0 = ax
+0000dec0: 2e61 7876 6c69 6e65 2878 302c 2079 302c  .axvline(x0, y0,
+0000ded0: 2079 312c 2063 6f6c 6f72 3d27 6b27 2c20   y1, color='k', 
+0000dee0: 6c69 6e65 7769 6474 683d 302e 352c 207a  linewidth=0.5, z
+0000def0: 6f72 6465 723d 3130 3029 0a20 2020 2020  order=100).     
+0000df00: 2020 2020 2020 2020 2020 206c 696e 4172             linAr
+0000df10: 7431 203d 2070 6c74 2e61 7876 6c69 6e65  t1 = plt.axvline
+0000df20: 2878 312c 2079 302c 2079 312c 2063 6f6c  (x1, y0, y1, col
+0000df30: 6f72 3d27 6b27 2c20 6c69 6e65 7769 6474  or='k', linewidt
+0000df40: 683d 302e 352c 207a 6f72 6465 723d 3130  h=0.5, zorder=10
+0000df50: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
+0000df60: 2020 206c 696e 6541 7274 6973 745b 7769     lineArtist[wi
+0000df70: 6e4e 756d 735d 2e61 7070 656e 6428 5b6c  nNums].append([l
+0000df80: 696e 4172 7430 2c20 6c69 6e41 7274 315d  inArt0, linArt1]
+0000df90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000dfa0: 2020 230a 2020 2020 2020 2020 2020 2020    #.            
+0000dfb0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0000dfc0: 2020 2020 2070 6174 684c 6973 742e 6170       pathList.ap
+0000dfd0: 7065 6e64 2870 6174 6829 0a0a 2020 2020  pend(path)..    
+0000dfe0: 2020 2020 2020 2020 666f 7220 692c 2070          for i, p
+0000dff0: 6120 696e 2065 6e75 6d65 7261 7465 2870  a in enumerate(p
+0000e000: 6174 684c 6973 7429 3a0a 2020 2020 2020  athList):.      
+0000e010: 2020 2020 2020 2020 2020 6966 2077 696e            if win
+0000e020: 646f 7744 7261 776e 5b69 5d3a 0a20 2020  dowDrawn[i]:.   
+0000e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e040: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
+0000e050: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e070: 7061 7463 6820 3d20 6d61 7470 6c6f 746c  patch = matplotl
+0000e080: 6962 2e70 6174 6368 6573 2e50 6174 6850  ib.patches.PathP
+0000e090: 6174 6368 2870 612c 2066 6163 6563 6f6c  atch(pa, facecol
+0000e0a0: 6f72 3d27 6b27 2c20 616c 7068 613d 302e  or='k', alpha=0.
+0000e0b0: 3735 2920 2020 2020 2020 2020 2020 2020  75)             
+0000e0c0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+0000e0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0e0: 2020 2020 7769 6e41 7274 203d 2061 782e      winArt = ax.
+0000e0f0: 6164 645f 7061 7463 6828 7061 7463 6829  add_patch(patch)
+0000e100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e110: 2020 2020 2077 696e 646f 7744 7261 776e       windowDrawn
+0000e120: 5b69 5d20 3d20 5472 7565 0a20 2020 2020  [i] = True.     
+0000e130: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000e140: 696e 4172 7469 7374 5b69 5d20 3d20 7769  inArtist[i] = wi
+0000e150: 6e41 7274 0a20 2020 2020 2020 2020 2020  nArt.           
+0000e160: 200a 2020 2020 2020 2020 2020 2020 2352   .            #R
+0000e170: 6566 6f72 6d61 7420 6178 2061 7320 6e65  eformat ax as ne
+0000e180: 6564 6564 0a20 2020 2020 2020 2020 2020  eded.           
+0000e190: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
+0000e1a0: 7269 6741 7865 732c 206e 702e 6e64 6172  rigAxes, np.ndar
+0000e1b0: 7261 7929 3a0a 2020 2020 2020 2020 2020  ray):.          
+0000e1c0: 2020 2020 2020 6f72 6967 4178 6573 5b69        origAxes[i
+0000e1d0: 5d20 3d20 6178 0a20 2020 2020 2020 2020  ] = ax.         
+0000e1e0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+0000e1f0: 6365 286f 7269 6741 7865 732c 2064 6963  ce(origAxes, dic
+0000e200: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0000e210: 2020 2020 6f72 6967 4178 6573 5b61 5d20      origAxes[a] 
+0000e220: 3d20 6178 0a20 2020 2020 2020 2020 2020  = ax.           
+0000e230: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000e240: 2020 2020 2020 206f 7269 6741 7865 7320         origAxes 
+0000e250: 3d20 6178 0a0a 2020 2020 2020 2020 6178  = ax..        ax
+0000e260: 203d 206f 7269 6741 7865 730a 0a20 2020   = origAxes..   
+0000e270: 2020 2020 2066 6967 2e63 616e 7661 732e       fig.canvas.
+0000e280: 6472 6177 2829 0a0a 2020 2020 7265 7475  draw()..    retu
+0000e290: 726e 2066 6967 2c20 6178 2c20 6c69 6e65  rn fig, ax, line
+0000e2a0: 4172 7469 7374 2c20 7769 6e41 7274 6973  Artist, winArtis
+0000e2b0: 740a 0a23 4865 6c70 6572 2066 756e 6374  t..#Helper funct
+0000e2c0: 696f 6e20 666f 7220 7265 6d6f 7669 6e67  ion for removing
+0000e2d0: 2077 696e 646f 7773 2066 726f 6d20 6461   windows from da
+0000e2e0: 7461 2c20 6c65 6176 696e 6720 6761 7073  ta, leaving gaps
+0000e2f0: 0a64 6566 205f 5f72 656d 6f76 655f 7769  .def __remove_wi
+0000e300: 6e64 6f77 7328 7374 7265 616d 2c20 7769  ndows(stream, wi
+0000e310: 6e64 6f77 5f6c 6973 742c 2077 6172 6d75  ndow_list, warmu
+0000e320: 705f 7469 6d65 293a 0a20 2020 2022 2222  p_time):.    """
+0000e330: 4865 6c70 6572 2066 756e 6374 696f 6e20  Helper function 
+0000e340: 7468 6174 2061 6374 7561 6c6c 7920 646f  that actually do
+0000e350: 6573 2074 6865 2077 6f72 6b20 696e 206f  es the work in o
+0000e360: 6273 7079 2074 6f20 7265 6d6f 7665 2074  bspy to remove t
+0000e370: 6865 2077 696e 646f 7773 2063 616c 6375  he windows calcu
+0000e380: 6c61 7465 6420 696e 2074 6865 2072 656d  lated in the rem
+0000e390: 6f76 655f 6e6f 6973 6520 6675 6e63 7469  ove_noise functi
+0000e3a0: 6f6e 0a73 0a20 2020 2050 6172 616d 6574  on.s.    Paramet
+0000e3b0: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+0000e3c0: 2d2d 0a20 2020 2073 7472 6561 6d20 3a20  --.    stream : 
+0000e3d0: 6f62 7370 792e 636f 7265 2e73 7472 6561  obspy.core.strea
+0000e3e0: 6d2e 5374 7265 616d 206f 626a 6563 740a  m.Stream object.
+0000e3f0: 2020 2020 2020 2020 496e 7075 7420 7374          Input st
+0000e400: 7265 616d 2066 726f 6d20 7768 6963 6820  ream from which 
+0000e410: 746f 2072 656d 6f76 6520 7769 6e64 6f77  to remove window
+0000e420: 730a 2020 2020 7769 6e64 6f77 5f6c 6973  s.    window_lis
+0000e430: 7420 3a20 6c69 7374 0a20 2020 2020 2020  t : list.       
+0000e440: 2041 206c 6973 7420 6f66 2077 696e 646f   A list of windo
+0000e450: 7773 2077 6974 6820 7374 6172 7420 616e  ws with start an
+0000e460: 6420 656e 6420 7469 6d65 7320 666f 7220  d end times for 
+0000e470: 7468 6520 7769 6e64 6f77 7320 746f 2062  the windows to b
+0000e480: 6520 7265 6d6f 7665 640a 2020 2020 7761  e removed.    wa
+0000e490: 726d 7570 5f74 696d 6520 3a20 696e 742c  rmup_time : int,
+0000e4a0: 2064 6566 6175 6c74 203d 2030 0a20 2020   default = 0.   
+0000e4b0: 2020 2020 2050 6173 7365 6420 6672 6f6d       Passed from
+0000e4c0: 2072 656d 6f76 655f 6e6f 6973 652c 2074   remove_noise, t
+0000e4d0: 6865 2061 6d6f 756e 7420 6f66 2074 696d  he amount of tim
+0000e4e0: 6520 696e 2073 6563 6f6e 6473 2074 6f20  e in seconds to 
+0000e4f0: 616c 6c6f 7720 666f 7220 7761 726d 7570  allow for warmup
+0000e500: 2e20 416e 7974 6869 6e67 2062 6566 6f72  . Anything befor
+0000e510: 6520 7468 6973 2069 7320 7265 6d6f 7665  e this is remove
+0000e520: 6420 6173 2027 6e6f 6973 6527 2e0a 0a20  d as 'noise'... 
+0000e530: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
+0000e540: 2d2d 2d2d 2d2d 0a20 2020 206f 7574 5374  ------.    outSt
+0000e550: 7265 616d 203a 206f 6273 7079 2e63 6f72  ream : obspy.cor
+0000e560: 652e 7374 7265 616d 2e53 7472 6561 6d20  e.stream.Stream 
+0000e570: 6f62 6a65 6374 0a20 2020 2020 2020 2053  object.        S
+0000e580: 7472 6561 6d20 7769 7468 2061 206d 6173  tream with a mas
+0000e590: 6b65 6420 6172 7261 7920 666f 7220 7468  ked array for th
+0000e5a0: 6520 6461 7461 2077 6865 7265 2027 6e6f  e data where 'no
+0000e5b0: 6973 6527 2068 6173 2062 6565 6e20 7265  ise' has been re
+0000e5c0: 6d6f 7665 640a 2020 2020 2222 220a 2020  moved.    """.  
+0000e5d0: 2020 6f67 5f73 7472 6561 6d20 3d20 7374    og_stream = st
+0000e5e0: 7265 616d 2e63 6f70 7928 290a 0a20 2020  ream.copy()..   
+0000e5f0: 2023 4669 6e64 2074 6865 206c 6174 6573   #Find the lates
+0000e600: 7420 7374 6172 7420 7469 6d65 2061 6e64  t start time and
+0000e610: 2065 6172 6c69 6573 7420 656e 6474 696d   earliest endtim
+0000e620: 6520 6f66 2061 6c6c 2074 7261 6365 7320  e of all traces 
+0000e630: 2869 6e20 6361 7365 2074 6865 7920 6172  (in case they ar
+0000e640: 656e 2774 2063 6f6e 7369 7374 656e 7429  en't consistent)
+0000e650: 0a20 2020 206d 6178 5374 6172 7454 696d  .    maxStartTim
+0000e660: 6520 3d20 6f62 7370 792e 5554 4344 6174  e = obspy.UTCDat
+0000e670: 6554 696d 6528 2d31 6531 3029 2023 476f  eTime(-1e10) #Go
+0000e680: 2062 6163 6b20 7072 6574 7479 2066 6172   back pretty far
+0000e690: 2028 616c 6d6f 7374 2034 3030 2079 6561   (almost 400 yea
+0000e6a0: 7273 2920 746f 2073 7461 7274 2077 6974  rs) to start wit
+0000e6b0: 680a 2020 2020 6d69 6e45 6e64 5469 6d65  h.    minEndTime
+0000e6c0: 203d 206f 6273 7079 2e55 5443 4461 7465   = obspy.UTCDate
+0000e6d0: 5469 6d65 2831 6531 3029 0a20 2020 2066  Time(1e10).    f
+0000e6e0: 6f72 2063 6f6d 7020 696e 205b 2745 272c  or comp in ['E',
+0000e6f0: 2027 4e27 2c20 275a 275d 3a0a 2020 2020   'N', 'Z']:.    
+0000e700: 2020 2020 7472 203d 2073 7472 6561 6d2e      tr = stream.
+0000e710: 7365 6c65 6374 2863 6f6d 706f 6e65 6e74  select(component
+0000e720: 3d63 6f6d 7029 2e63 6f70 7928 290a 2020  =comp).copy().  
+0000e730: 2020 2020 2020 6966 2074 725b 305d 2e73        if tr[0].s
+0000e740: 7461 7473 2e73 7461 7274 7469 6d65 203e  tats.starttime >
+0000e750: 206d 6178 5374 6172 7454 696d 653a 0a20   maxStartTime:. 
+0000e760: 2020 2020 2020 2020 2020 206d 6178 5374             maxSt
+0000e770: 6172 7454 696d 6520 3d20 7472 5b30 5d2e  artTime = tr[0].
+0000e780: 7374 6174 732e 7374 6172 7474 696d 650a  stats.starttime.
+0000e790: 2020 2020 2020 2020 6966 2074 725b 305d          if tr[0]
+0000e7a0: 2e73 7461 7473 2e65 6e64 7469 6d65 203c  .stats.endtime <
+0000e7b0: 206d 696e 456e 6454 696d 653a 0a20 2020   minEndTime:.   
+0000e7c0: 2020 2020 2020 2020 206d 696e 456e 6454           minEndT
+0000e7d0: 696d 6520 3d20 7472 5b30 5d2e 7374 6174  ime = tr[0].stat
+0000e7e0: 732e 656e 6474 696d 650a 0a20 2020 2023  s.endtime..    #
+0000e7f0: 5472 696d 2061 6c6c 2074 7261 6365 7320  Trim all traces 
+0000e800: 746f 2074 6865 2073 616d 6520 7374 6172  to the same star
+0000e810: 742f 656e 6420 7469 6d65 0a20 2020 2073  t/end time.    s
+0000e820: 7472 6561 6d2e 7472 696d 2873 7461 7274  tream.trim(start
+0000e830: 7469 6d65 3d6d 6178 5374 6172 7454 696d  time=maxStartTim
+0000e840: 652c 2065 6e64 7469 6d65 3d6d 696e 456e  e, endtime=minEn
+0000e850: 6454 696d 6529 2020 2020 2020 0a0a 2020  dTime)      ..  
+0000e860: 2020 2353 6f72 7420 7769 6e64 6f77 7320    #Sort windows 
+0000e870: 6279 2074 6865 2073 7461 7274 206f 6620  by the start of 
+0000e880: 7468 6520 7769 6e64 6f77 0a20 2020 2073  the window.    s
+0000e890: 6f72 7465 645f 7769 6e64 6f77 5f6c 6973  orted_window_lis
+0000e8a0: 7420 3d20 5b5d 0a20 2020 2077 696e 646f  t = [].    windo
+0000e8b0: 7753 7461 7274 203d 205b 5d0a 2020 2020  wStart = [].    
+0000e8c0: 666f 7220 692c 2077 696e 646f 7720 696e  for i, window in
+0000e8d0: 2065 6e75 6d65 7261 7465 2877 696e 646f   enumerate(windo
+0000e8e0: 775f 6c69 7374 293a 0a20 2020 2020 2020  w_list):.       
+0000e8f0: 2077 696e 646f 7753 7461 7274 2e61 7070   windowStart.app
+0000e900: 656e 6428 7769 6e64 6f77 5b30 5d29 0a20  end(window[0]). 
+0000e910: 2020 2077 696e 646f 7753 7461 7274 5f6f     windowStart_o
+0000e920: 6720 3d20 7769 6e64 6f77 5374 6172 742e  g = windowStart.
+0000e930: 636f 7079 2829 0a20 2020 2077 696e 646f  copy().    windo
+0000e940: 7753 7461 7274 2e73 6f72 7428 290a 2020  wStart.sort().  
+0000e950: 2020 736f 7274 6564 5f73 7461 7274 5f6c    sorted_start_l
+0000e960: 6973 7420 3d20 7769 6e64 6f77 5374 6172  ist = windowStar
+0000e970: 740a 2020 2020 7261 6e6b 7320 3d20 5b77  t.    ranks = [w
+0000e980: 696e 646f 7753 7461 7274 5f6f 672e 696e  indowStart_og.in
+0000e990: 6465 7828 6974 656d 2920 666f 7220 6974  dex(item) for it
+0000e9a0: 656d 2069 6e20 736f 7274 6564 5f73 7461  em in sorted_sta
+0000e9b0: 7274 5f6c 6973 745d 0a20 2020 2066 6f72  rt_list].    for
+0000e9c0: 2072 2069 6e20 7261 6e6b 733a 0a20 2020   r in ranks:.   
+0000e9d0: 2020 2020 2073 6f72 7465 645f 7769 6e64       sorted_wind
+0000e9e0: 6f77 5f6c 6973 742e 6170 7065 6e64 2877  ow_list.append(w
+0000e9f0: 696e 646f 775f 6c69 7374 5b72 5d29 0a0a  indow_list[r])..
+0000ea00: 2020 2020 666f 7220 692c 2077 2069 6e20      for i, w in 
+0000ea10: 656e 756d 6572 6174 6528 736f 7274 6564  enumerate(sorted
+0000ea20: 5f77 696e 646f 775f 6c69 7374 293a 0a20  _window_list):. 
+0000ea30: 2020 2020 2020 2069 6620 6920 3c20 6c65         if i < le
+0000ea40: 6e28 736f 7274 6564 5f77 696e 646f 775f  n(sorted_window_
+0000ea50: 6c69 7374 2920 2d20 313a 0a20 2020 2020  list) - 1:.     
+0000ea60: 2020 2020 2020 2069 6620 775b 315d 203e         if w[1] >
+0000ea70: 2073 6f72 7465 645f 7769 6e64 6f77 5f6c   sorted_window_l
+0000ea80: 6973 745b 692b 315d 5b30 5d3a 0a20 2020  ist[i+1][0]:.   
+0000ea90: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0000eaa0: 6e74 2822 4552 524f 523a 204f 7665 726c  nt("ERROR: Overl
+0000eab0: 6170 7069 6e67 2077 696e 646f 7773 2e20  apping windows. 
+0000eac0: 506c 6561 7365 2072 6573 656c 6563 7420  Please reselect 
+0000ead0: 7769 6e64 6f77 7320 746f 2062 6520 7265  windows to be re
+0000eae0: 6d6f 7665 6420 6f72 2075 7365 2061 2064  moved or use a d
+0000eaf0: 6966 6665 7265 6e74 206e 6f69 7365 2072  ifferent noise r
+0000eb00: 656d 6f76 616c 206d 6574 686f 642e 2229  emoval method.")
+0000eb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000eb20: 2070 7269 6e74 2877 5b31 5d2c 2027 3e27   print(w[1], '>'
+0000eb30: 2c20 736f 7274 6564 5f77 696e 646f 775f  , sorted_window_
+0000eb40: 6c69 7374 5b69 2b31 5d5b 305d 290a 2020  list[i+1][0]).  
+0000eb50: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000eb60: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
+0000eb70: 2020 2020 200a 2020 2020 7769 6e64 6f77       .    window
+0000eb80: 5f67 6170 735f 6f62 7370 7920 3d20 5b5d  _gaps_obspy = []
+0000eb90: 0a20 2020 2077 696e 646f 775f 6761 7073  .    window_gaps
+0000eba0: 203d 205b 5d0a 0a20 2020 2062 7566 6665   = []..    buffe
+0000ebb0: 725f 7469 6d65 203d 206e 702e 6365 696c  r_time = np.ceil
+0000ebc0: 2828 7374 7265 616d 5b30 5d2e 7374 6174  ((stream[0].stat
+0000ebd0: 732e 656e 6474 696d 652d 7374 7265 616d  s.endtime-stream
+0000ebe0: 5b30 5d2e 7374 6174 732e 7374 6172 7474  [0].stats.startt
+0000ebf0: 696d 6529 2a30 2e30 3129 0a0a 2020 2020  ime)*0.01)..    
+0000ec00: 2347 6574 206f 6273 7079 2e55 5443 4461  #Get obspy.UTCDa
+0000ec10: 7465 5469 6d65 206f 626a 6563 7473 2066  teTime objects f
+0000ec20: 6f72 2074 6865 2067 6170 2074 696d 6573  or the gap times
+0000ec30: 0a20 2020 2077 696e 646f 775f 6761 7073  .    window_gaps
+0000ec40: 5f6f 6273 7079 2e61 7070 656e 6428 5b73  _obspy.append([s
+0000ec50: 7472 6561 6d5b 305d 2e73 7461 7473 2e73  tream[0].stats.s
+0000ec60: 7461 7274 7469 6d65 202b 2077 6172 6d75  tarttime + warmu
+0000ec70: 705f 7469 6d65 2c20 7374 7265 616d 5b30  p_time, stream[0
+0000ec80: 5d2e 7374 6174 732e 7374 6172 7474 696d  ].stats.starttim
+0000ec90: 6520 2b20 7761 726d 7570 5f74 696d 655d  e + warmup_time]
+0000eca0: 290a 2020 2020 666f 7220 692c 2077 696e  ).    for i, win
+0000ecb0: 646f 7720 696e 2065 6e75 6d65 7261 7465  dow in enumerate
+0000ecc0: 2873 6f72 7465 645f 7769 6e64 6f77 5f6c  (sorted_window_l
+0000ecd0: 6973 7429 3a0a 2020 2020 2020 2020 666f  ist):.        fo
+0000ece0: 7220 6a2c 2069 7465 6d20 696e 2065 6e75  r j, item in enu
+0000ecf0: 6d65 7261 7465 2877 696e 646f 7729 3a0a  merate(window):.
+0000ed00: 2020 2020 2020 2020 2020 2020 6966 206a              if j
+0000ed10: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0000ed20: 2020 2020 2020 2077 696e 646f 775f 6761         window_ga
+0000ed30: 7073 5f6f 6273 7079 2e61 7070 656e 6428  ps_obspy.append(
+0000ed40: 5b30 2c30 5d29 0a20 2020 2020 2020 2020  [0,0]).         
+0000ed50: 2020 2077 696e 646f 775f 6761 7073 5f6f     window_gaps_o
+0000ed60: 6273 7079 5b69 2b31 5d5b 6a5d 203d 206f  bspy[i+1][j] = o
+0000ed70: 6273 7079 2e55 5443 4461 7465 5469 6d65  bspy.UTCDateTime
+0000ed80: 286d 6174 706c 6f74 6c69 622e 6461 7465  (matplotlib.date
+0000ed90: 732e 6e75 6d32 6461 7465 2869 7465 6d29  s.num2date(item)
+0000eda0: 290a 2020 2020 2020 2020 7769 6e64 6f77  ).        window
+0000edb0: 5f67 6170 732e 6170 7065 6e64 2828 7769  _gaps.append((wi
+0000edc0: 6e64 6f77 5b31 5d2d 7769 6e64 6f77 5b30  ndow[1]-window[0
+0000edd0: 5d29 2a38 3634 3030 290a 2020 2020 7769  ])*86400).    wi
+0000ede0: 6e64 6f77 5f67 6170 735f 6f62 7370 792e  ndow_gaps_obspy.
+0000edf0: 6170 7065 6e64 285b 7374 7265 616d 5b30  append([stream[0
+0000ee00: 5d2e 7374 6174 732e 656e 6474 696d 652d  ].stats.endtime-
+0000ee10: 6275 6666 6572 5f74 696d 652c 2073 7472  buffer_time, str
+0000ee20: 6561 6d5b 305d 2e73 7461 7473 2e65 6e64  eam[0].stats.end
+0000ee30: 7469 6d65 2d62 7566 6665 725f 7469 6d65  time-buffer_time
+0000ee40: 5d29 0a20 2020 2023 4e6f 7465 2c20 7765  ]).    #Note, we
+0000ee50: 2061 6464 6564 2073 7461 7274 2061 6e64   added start and
+0000ee60: 2065 6e64 7469 6d65 7320 746f 206f 6270   endtimes to obp
+0000ee70: 7379 206c 6973 7420 746f 2068 656c 7020  sy list to help 
+0000ee80: 7769 7468 206c 6174 6572 2066 756e 6374  with later funct
+0000ee90: 696f 6e61 6c69 7479 0a0a 2020 2020 2343  ionality..    #C
+0000eea0: 6c65 616e 2075 7020 7374 7265 616d 2077  lean up stream w
+0000eeb0: 696e 646f 7773 2028 6573 7065 6369 616c  indows (especial
+0000eec0: 6c79 2c20 7374 6172 7420 616e 6420 656e  ly, start and en
+0000eed0: 6429 0a20 2020 2066 6f72 2069 2c20 7769  d).    for i, wi
+0000eee0: 6e64 6f77 2069 6e20 656e 756d 6572 6174  ndow in enumerat
+0000eef0: 6528 7769 6e64 6f77 5f67 6170 7329 3a0a  e(window_gaps):.
+0000ef00: 2020 2020 2020 2020 6e65 7753 7420 3d20          newSt = 
+0000ef10: 7374 7265 616d 2e63 6f70 7928 290a 2020  stream.copy().  
+0000ef20: 2020 2020 2020 2343 6865 636b 2069 6620        #Check if 
+0000ef30: 6669 7273 7420 7769 6e64 6f77 2073 7461  first window sta
+0000ef40: 7274 7320 6265 666f 7265 2065 6e64 206f  rts before end o
+0000ef50: 6620 7761 726d 7570 2074 696d 650a 2020  f warmup time.  
+0000ef60: 2020 2020 2020 2349 6620 7468 6520 7374        #If the st
+0000ef70: 6172 7420 6f66 2074 6865 2066 6972 7374  art of the first
+0000ef80: 2065 7863 6c75 7369 6f6e 2077 696e 646f   exclusion windo
+0000ef90: 7720 6973 2062 6566 6f72 6520 7468 6520  w is before the 
+0000efa0: 7761 726d 7570 5f74 696d 6520 6973 206f  warmup_time is o
+0000efb0: 7665 720a 2020 2020 2020 2020 6966 2077  ver.        if w
+0000efc0: 696e 646f 775f 6761 7073 5f6f 6273 7079  indow_gaps_obspy
+0000efd0: 5b69 2b31 5d5b 305d 202d 206e 6577 5374  [i+1][0] - newSt
+0000efe0: 5b30 5d2e 7374 6174 732e 7374 6172 7474  [0].stats.startt
+0000eff0: 696d 6520 3c20 7761 726d 7570 5f74 696d  ime < warmup_tim
+0000f000: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+0000f010: 4966 2074 6865 2065 6e64 206f 6620 6669  If the end of fi
+0000f020: 7273 7420 6578 636c 7573 696f 6e20 7769  rst exclusion wi
+0000f030: 6e64 6f77 2069 7320 616c 736f 2062 6566  ndow is also bef
+0000f040: 6f72 6520 7468 6520 7761 726d 7570 5f74  ore the warmup_t
+0000f050: 696d 6520 6973 206f 7665 720a 2020 2020  ime is over.    
+0000f060: 2020 2020 2020 2020 6966 2077 696e 646f          if windo
+0000f070: 775f 6761 7073 5f6f 6273 7079 5b69 2b31  w_gaps_obspy[i+1
+0000f080: 5d5b 315d 202d 206e 6577 5374 5b30 5d2e  ][1] - newSt[0].
+0000f090: 7374 6174 732e 7374 6172 7474 696d 6520  stats.starttime 
+0000f0a0: 3c20 7761 726d 7570 5f74 696d 653a 0a20  < warmup_time:. 
+0000f0b0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000f0c0: 5265 6d6f 7665 2074 6861 7420 7769 6e64  Remove that wind
+0000f0d0: 6f77 2063 6f6d 706c 6574 656c 792c 2069  ow completely, i
+0000f0e0: 7420 6973 2075 6e6e 6563 6573 7361 7279  t is unnecessary
+0000f0f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f100: 2077 696e 646f 775f 6761 7073 2e70 6f70   window_gaps.pop
+0000f110: 2869 290a 2020 2020 2020 2020 2020 2020  (i).            
+0000f120: 2020 2020 7769 6e64 6f77 5f67 6170 735f      window_gaps_
+0000f130: 6f62 7370 792e 706f 7028 692b 3129 0a20  obspy.pop(i+1). 
+0000f140: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000f150: 2e2e 2e61 6e64 2072 6573 6574 2074 6865  ...and reset the
+0000f160: 2065 6e74 6972 6520 7769 6e64 6f77 2074   entire window t
+0000f170: 6f20 7374 6172 7420 6174 2074 6865 2077  o start at the w
+0000f180: 6172 6d75 705f 7469 6d65 2065 6e64 0a20  armup_time end. 
+0000f190: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000f1a0: 696e 646f 775f 6761 7073 5f6f 6273 7079  indow_gaps_obspy
+0000f1b0: 5b30 5d5b 305d 203d 2077 696e 646f 775f  [0][0] = window_
+0000f1c0: 6761 7073 5f6f 6273 7079 5b30 5d5b 315d  gaps_obspy[0][1]
+0000f1d0: 203d 206e 6577 5374 5b30 5d2e 7374 6174   = newSt[0].stat
+0000f1e0: 732e 7374 6172 7474 696d 6520 2b20 7761  s.starttime + wa
+0000f1f0: 726d 7570 5f74 696d 650a 2020 2020 2020  rmup_time.      
+0000f200: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+0000f210: 7565 0a20 2020 2020 2020 2020 2020 2065  ue.            e
+0000f220: 6c73 653a 2023 6966 2077 696e 646f 7720  lse: #if window 
+0000f230: 6f76 6572 6c61 7073 2074 6865 2073 7461  overlaps the sta
+0000f240: 7274 206f 6620 7468 6520 7374 7265 616d  rt of the stream
+0000f250: 2061 6674 6572 2077 6172 6d75 705f 7469   after warmup_ti
+0000f260: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
+0000f270: 2020 2023 5265 6d6f 7665 2074 6861 7420     #Remove that 
+0000f280: 7769 6e64 6f77 0a20 2020 2020 2020 2020  window.         
+0000f290: 2020 2020 2020 2077 696e 646f 775f 6761         window_ga
+0000f2a0: 7073 2e70 6f70 2869 290a 2020 2020 2020  ps.pop(i).      
+0000f2b0: 2020 2020 2020 2020 2020 232e 2e2e 616e            #...an
+0000f2c0: 6420 7265 7365 7420 7468 6520 7374 6172  d reset the star
+0000f2d0: 7420 6f66 2074 6865 2077 696e 646f 7720  t of the window 
+0000f2e0: 746f 2062 6520 7468 6520 656e 6420 6f66  to be the end of
+0000f2f0: 2077 6172 6d20 7570 2074 696d 650a 2020   warm up time.  
+0000f300: 2020 2020 2020 2020 2020 2020 2020 232e                #.
+0000f310: 2e2e 616e 6420 2072 656d 6f76 6520 7468  ..and  remove th
+0000f320: 6174 2066 6972 7374 2077 696e 646f 7720  at first window 
+0000f330: 6672 6f6d 2074 6865 206f 6273 7079 206c  from the obspy l
+0000f340: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
+0000f350: 2020 2020 7769 6e64 6f77 5f67 6170 735f      window_gaps_
+0000f360: 6f62 7370 795b 305d 5b30 5d20 3d20 7769  obspy[0][0] = wi
+0000f370: 6e64 6f77 5f67 6170 735f 6f62 7370 795b  ndow_gaps_obspy[
+0000f380: 305d 5b31 5d20 3d20 2077 696e 646f 775f  0][1] =  window_
+0000f390: 6761 7073 5f6f 6273 7079 5b69 2b31 5d5b  gaps_obspy[i+1][
+0000f3a0: 315d 236e 6577 5374 5b30 5d2e 7374 6174  1]#newSt[0].stat
+0000f3b0: 732e 7374 6172 7474 696d 6520 2b20 7761  s.starttime + wa
+0000f3c0: 726d 7570 5f74 696d 650a 2020 2020 2020  rmup_time.      
+0000f3d0: 2020 2020 2020 2020 2020 7769 6e64 6f77            window
+0000f3e0: 5f67 6170 735f 6f62 7370 792e 706f 7028  _gaps_obspy.pop(
+0000f3f0: 692b 3129 0a0a 0a20 2020 2020 2020 2069  i+1)...        i
+0000f400: 6620 7374 7265 616d 5b30 5d2e 7374 6174  f stream[0].stat
+0000f410: 732e 656e 6474 696d 6520 2d20 7769 6e64  s.endtime - wind
+0000f420: 6f77 5f67 6170 735f 6f62 7370 795b 692b  ow_gaps_obspy[i+
+0000f430: 315d 5b31 5d20 3e20 7374 7265 616d 5b30  1][1] > stream[0
+0000f440: 5d2e 7374 6174 732e 656e 6474 696d 6520  ].stats.endtime 
+0000f450: 2d20 6275 6666 6572 5f74 696d 653a 2020  - buffer_time:  
+0000f460: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+0000f470: 2020 2069 6620 7374 7265 616d 5b30 5d2e     if stream[0].
+0000f480: 7374 6174 732e 656e 6474 696d 6520 2d20  stats.endtime - 
+0000f490: 7769 6e64 6f77 5f67 6170 735f 6f62 7370  window_gaps_obsp
+0000f4a0: 795b 692b 315d 5b30 5d20 3e20 7374 7265  y[i+1][0] > stre
+0000f4b0: 616d 5b30 5d2e 7374 6174 732e 656e 6474  am[0].stats.endt
+0000f4c0: 696d 6520 2d20 6275 6666 6572 5f74 696d  ime - buffer_tim
+0000f4d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000f4e0: 2020 2077 696e 646f 775f 6761 7073 2e70     window_gaps.p
+0000f4f0: 6f70 2869 290a 2020 2020 2020 2020 2020  op(i).          
+0000f500: 2020 2020 2020 7769 6e64 6f77 5f67 6170        window_gap
+0000f510: 735f 6f62 7370 792e 706f 7028 692b 3129  s_obspy.pop(i+1)
+0000f520: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0000f530: 653a 2020 2369 6620 656e 6420 6f66 2077  e:  #if end of w
+0000f540: 696e 646f 7720 6f76 6572 6c61 7073 2074  indow overlaps t
+0000f550: 6865 2062 7566 6665 7220 7469 6d65 2c20  he buffer time, 
+0000f560: 6a75 7374 2065 6e64 2069 7420 6174 2074  just end it at t
+0000f570: 6865 2073 7461 7274 206f 6620 7468 6520  he start of the 
+0000f580: 7769 6e64 6f77 2028 616c 7761 7973 2065  window (always e
+0000f590: 6e64 2077 6974 6820 7374 7265 616d 2c20  nd with stream, 
+0000f5a0: 6e6f 7420 6761 7029 0a20 2020 2020 2020  not gap).       
+0000f5b0: 2020 2020 2020 2020 2077 696e 646f 775f           window_
+0000f5c0: 6761 7073 2e70 6f70 2869 290a 2020 2020  gaps.pop(i).    
+0000f5d0: 2020 2020 2020 2020 2020 2020 7769 6e64              wind
+0000f5e0: 6f77 5f67 6170 735f 6f62 7370 795b 2d31  ow_gaps_obspy[-1
+0000f5f0: 5d5b 305d 203d 2077 696e 646f 775f 6761  ][0] = window_ga
+0000f600: 7073 5f6f 6273 7079 5b2d 315d 5b31 5d20  ps_obspy[-1][1] 
+0000f610: 3d20 6e65 7753 745b 305d 2e73 7461 7473  = newSt[0].stats
+0000f620: 2e65 6e64 7469 6d65 202d 2062 7566 6665  .endtime - buffe
+0000f630: 725f 7469 6d65 0a20 2020 0a20 2020 2023  r_time.   .    #
+0000f640: 4164 6420 7374 7265 616d 730a 2020 2020  Add streams.    
+0000f650: 7374 7265 616d 5f77 696e 646f 7773 203d  stream_windows =
+0000f660: 205b 5d0a 2020 2020 6a20 3d20 300a 2020   [].    j = 0.  
+0000f670: 2020 666f 7220 692c 2077 696e 646f 7720    for i, window 
+0000f680: 696e 2065 6e75 6d65 7261 7465 2877 696e  in enumerate(win
+0000f690: 646f 775f 6761 7073 293a 0a20 2020 2020  dow_gaps):.     
+0000f6a0: 2020 206a 3d69 0a20 2020 2020 2020 206e     j=i.        n
+0000f6b0: 6577 5374 203d 2073 7472 6561 6d2e 636f  ewSt = stream.co
+0000f6c0: 7079 2829 0a20 2020 2020 2020 2073 7472  py().        str
+0000f6d0: 6561 6d5f 7769 6e64 6f77 732e 6170 7065  eam_windows.appe
+0000f6e0: 6e64 286e 6577 5374 2e74 7269 6d28 7374  nd(newSt.trim(st
+0000f6f0: 6172 7474 696d 653d 7769 6e64 6f77 5f67  arttime=window_g
+0000f700: 6170 735f 6f62 7370 795b 695d 5b31 5d2c  aps_obspy[i][1],
+0000f710: 2065 6e64 7469 6d65 3d77 696e 646f 775f   endtime=window_
+0000f720: 6761 7073 5f6f 6273 7079 5b69 2b31 5d5b  gaps_obspy[i+1][
+0000f730: 305d 2929 0a20 2020 2069 203d 206a 202b  0])).    i = j +
+0000f740: 2031 0a20 2020 206e 6577 5374 203d 2073   1.    newSt = s
+0000f750: 7472 6561 6d2e 636f 7079 2829 0a20 2020  tream.copy().   
+0000f760: 2073 7472 6561 6d5f 7769 6e64 6f77 732e   stream_windows.
+0000f770: 6170 7065 6e64 286e 6577 5374 2e74 7269  append(newSt.tri
+0000f780: 6d28 7374 6172 7474 696d 653d 7769 6e64  m(starttime=wind
+0000f790: 6f77 5f67 6170 735f 6f62 7370 795b 695d  ow_gaps_obspy[i]
+0000f7a0: 5b31 5d2c 2065 6e64 7469 6d65 3d77 696e  [1], endtime=win
+0000f7b0: 646f 775f 6761 7073 5f6f 6273 7079 5b69  dow_gaps_obspy[i
+0000f7c0: 2b31 5d5b 305d 2929 0a0a 2020 2020 666f  +1][0]))..    fo
+0000f7d0: 7220 692c 2073 7420 696e 2065 6e75 6d65  r i, st in enume
+0000f7e0: 7261 7465 2873 7472 6561 6d5f 7769 6e64  rate(stream_wind
+0000f7f0: 6f77 7329 3a0a 2020 2020 2020 2020 6966  ows):.        if
+0000f800: 2069 203d 3d20 303a 0a20 2020 2020 2020   i == 0:.       
+0000f810: 2020 2020 206f 7574 5374 7265 616d 203d       outStream =
+0000f820: 2073 742e 636f 7079 2829 0a20 2020 2020   st.copy().     
+0000f830: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000f840: 2020 2020 206e 6577 5374 203d 2073 742e       newSt = st.
+0000f850: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
+0000f860: 2020 2067 6170 203d 2077 696e 646f 775f     gap = window_
+0000f870: 6761 7073 5b69 2d31 5d0a 2020 2020 2020  gaps[i-1].      
+0000f880: 2020 2020 2020 6f75 7453 7472 6561 6d20        outStream 
+0000f890: 3d20 6f75 7453 7472 6561 6d20 2b20 6e65  = outStream + ne
+0000f8a0: 7753 742e 7472 696d 2873 7461 7274 7469  wSt.trim(startti
+0000f8b0: 6d65 3d73 745b 305d 2e73 7461 7473 2e73  me=st[0].stats.s
+0000f8c0: 7461 7274 7469 6d65 202d 2067 6170 2c20  tarttime - gap, 
+0000f8d0: 7061 643d 5472 7565 2c20 6669 6c6c 5f76  pad=True, fill_v
+0000f8e0: 616c 7565 3d4e 6f6e 6529 2020 2020 2020  alue=None)      
+0000f8f0: 200a 2020 2020 6f75 7453 7472 6561 6d2e   .    outStream.
+0000f900: 6d65 7267 6528 290a 2020 2020 7265 7475  merge().    retu
+0000f910: 726e 206f 7574 5374 7265 616d 0a0a 2348  rn outStream..#H
+0000f920: 656c 7065 7220 6675 6e63 7469 6f6e 2066  elper function f
+0000f930: 6f72 2072 656d 6f76 696e 6720 6761 7073  or removing gaps
+0000f940: 0a64 6566 205f 5f72 656d 6f76 655f 6761  .def __remove_ga
+0000f950: 7073 2873 7472 6561 6d2c 2077 696e 646f  ps(stream, windo
+0000f960: 775f 6761 7073 5f6f 6273 7079 293a 0a20  w_gaps_obspy):. 
+0000f970: 2020 2022 2222 4865 6c70 6572 2066 756e     """Helper fun
+0000f980: 6374 696f 6e20 666f 7220 7265 6d6f 7669  ction for removi
+0000f990: 6e67 2067 6170 7322 2222 0a20 2020 2023  ng gaps""".    #
+0000f9a0: 636f 6d62 696e 6520 6f76 6572 6c61 7070  combine overlapp
+0000f9b0: 696e 6720 7769 6e64 6f77 730a 2020 2020  ing windows.    
+0000f9c0: 2354 4849 5320 5041 5254 204e 4545 4453  #THIS PART NEEDS
+0000f9d0: 2057 4f52 4b21 2121 2121 2023 2123 0a20   WORK!!!!! #!#. 
+0000f9e0: 2020 206f 7665 726c 6170 4c69 7374 203d     overlapList =
+0000f9f0: 205b 5d0a 2020 2020 666f 7220 6920 696e   [].    for i in
+0000fa00: 2072 616e 6765 286c 656e 2877 696e 646f   range(len(windo
+0000fa10: 775f 6761 7073 5f6f 6273 7079 292d 3229  w_gaps_obspy)-2)
+0000fa20: 3a0a 2020 2020 2020 2020 6966 2077 696e  :.        if win
+0000fa30: 646f 775f 6761 7073 5f6f 6273 7079 5b69  dow_gaps_obspy[i
+0000fa40: 5d5b 315d 203e 2077 696e 646f 775f 6761  ][1] > window_ga
+0000fa50: 7073 5f6f 6273 7079 5b69 2b31 5d5b 305d  ps_obspy[i+1][0]
+0000fa60: 3a0a 2020 2020 2020 2020 2020 2020 6f76  :.            ov
+0000fa70: 6572 6c61 704c 6973 742e 6170 7065 6e64  erlapList.append
+0000fa80: 2869 290a 0a20 2020 2066 6f72 2069 2c20  (i)..    for i, 
+0000fa90: 7420 696e 2065 6e75 6d65 7261 7465 286f  t in enumerate(o
+0000faa0: 7665 726c 6170 4c69 7374 293a 0a20 2020  verlapList):.   
+0000fab0: 2020 2020 2069 6620 6920 3c20 6c65 6e28       if i < len(
+0000fac0: 7769 6e64 6f77 5f67 6170 735f 6f62 7370  window_gaps_obsp
+0000fad0: 7929 2d32 3a0a 2020 2020 2020 2020 2020  y)-2:.          
+0000fae0: 2020 7769 6e64 6f77 5f67 6170 735f 6f62    window_gaps_ob
+0000faf0: 7370 795b 695d 5b31 5d20 3d20 7769 6e64  spy[i][1] = wind
+0000fb00: 6f77 5f67 6170 735f 6f62 7370 795b 692b  ow_gaps_obspy[i+
+0000fb10: 315d 5b31 5d0a 2020 2020 2020 2020 2020  1][1].          
+0000fb20: 2020 7769 6e64 6f77 5f67 6170 735f 6f62    window_gaps_ob
+0000fb30: 7370 792e 706f 7028 692b 3129 0a0a 2020  spy.pop(i+1)..  
+0000fb40: 2020 2341 6464 2073 7472 6561 6d73 0a20    #Add streams. 
+0000fb50: 2020 2077 696e 646f 775f 6761 7073 5f73     window_gaps_s
+0000fb60: 203d 205b 5d0a 2020 2020 666f 7220 772c   = [].    for w,
+0000fb70: 2077 696e 2069 6e20 656e 756d 6572 6174   win in enumerat
+0000fb80: 6528 7769 6e64 6f77 5f67 6170 735f 6f62  e(window_gaps_ob
+0000fb90: 7370 7929 3a0a 2020 2020 2020 2020 6966  spy):.        if
+0000fba0: 2077 203d 3d20 303a 0a20 2020 2020 2020   w == 0:.       
+0000fbb0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0000fbc0: 2020 656c 6966 2077 203d 3d20 6c65 6e28    elif w == len(
+0000fbd0: 7769 6e64 6f77 5f67 6170 735f 6f62 7370  window_gaps_obsp
+0000fbe0: 7929 2d31 3a0a 2020 2020 2020 2020 2020  y)-1:.          
+0000fbf0: 2020 7061 7373 0a20 2020 2020 2020 2065    pass.        e
+0000fc00: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000fc10: 2077 696e 646f 775f 6761 7073 5f73 2e61   window_gaps_s.a
+0000fc20: 7070 656e 6428 7769 6e5b 315d 2d77 696e  ppend(win[1]-win
+0000fc30: 5b30 5d29 0a0a 2020 2020 6966 206c 656e  [0])..    if len
+0000fc40: 2877 696e 646f 775f 6761 7073 5f73 2920  (window_gaps_s) 
+0000fc50: 3e20 303a 0a20 2020 2020 2020 2073 7472  > 0:.        str
+0000fc60: 6561 6d5f 7769 6e64 6f77 7320 3d20 5b5d  eam_windows = []
+0000fc70: 0a20 2020 2020 2020 206a 203d 2030 0a20  .        j = 0. 
+0000fc80: 2020 2020 2020 2066 6f72 2069 2c20 7769         for i, wi
+0000fc90: 6e64 6f77 2069 6e20 656e 756d 6572 6174  ndow in enumerat
+0000fca0: 6528 7769 6e64 6f77 5f67 6170 735f 7329  e(window_gaps_s)
+0000fcb0: 3a0a 2020 2020 2020 2020 2020 2020 6a3d  :.            j=
+0000fcc0: 690a 2020 2020 2020 2020 2020 2020 6e65  i.            ne
+0000fcd0: 7753 7420 3d20 7374 7265 616d 2e63 6f70  wSt = stream.cop
+0000fce0: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+0000fcf0: 7374 7265 616d 5f77 696e 646f 7773 2e61  stream_windows.a
+0000fd00: 7070 656e 6428 6e65 7753 742e 7472 696d  ppend(newSt.trim
+0000fd10: 2873 7461 7274 7469 6d65 3d77 696e 646f  (starttime=windo
+0000fd20: 775f 6761 7073 5f6f 6273 7079 5b69 5d5b  w_gaps_obspy[i][
+0000fd30: 315d 2c20 656e 6474 696d 653d 7769 6e64  1], endtime=wind
+0000fd40: 6f77 5f67 6170 735f 6f62 7370 795b 692b  ow_gaps_obspy[i+
+0000fd50: 315d 5b30 5d29 290a 2020 2020 2020 2020  1][0])).        
+0000fd60: 6920 3d20 6a20 2b20 310a 2020 2020 2020  i = j + 1.      
+0000fd70: 2020 6e65 7753 7420 3d20 7374 7265 616d    newSt = stream
+0000fd80: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+0000fd90: 7374 7265 616d 5f77 696e 646f 7773 2e61  stream_windows.a
+0000fda0: 7070 656e 6428 6e65 7753 742e 7472 696d  ppend(newSt.trim
+0000fdb0: 2873 7461 7274 7469 6d65 3d77 696e 646f  (starttime=windo
+0000fdc0: 775f 6761 7073 5f6f 6273 7079 5b69 5d5b  w_gaps_obspy[i][
+0000fdd0: 315d 2c20 656e 6474 696d 653d 7769 6e64  1], endtime=wind
+0000fde0: 6f77 5f67 6170 735f 6f62 7370 795b 692b  ow_gaps_obspy[i+
+0000fdf0: 315d 5b30 5d29 290a 0a20 2020 2020 2020  1][0]))..       
+0000fe00: 2066 6f72 2069 2c20 7374 2069 6e20 656e   for i, st in en
+0000fe10: 756d 6572 6174 6528 7374 7265 616d 5f77  umerate(stream_w
+0000fe20: 696e 646f 7773 293a 0a20 2020 2020 2020  indows):.       
+0000fe30: 2020 2020 2069 6620 6920 3d3d 2030 3a0a       if i == 0:.
+0000fe40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe50: 6f75 7453 7472 6561 6d20 3d20 7374 2e63  outStream = st.c
+0000fe60: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
+0000fe70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000fe80: 2020 2020 2020 2020 6e65 7753 7420 3d20          newSt = 
+0000fe90: 7374 2e63 6f70 7928 290a 2020 2020 2020  st.copy().      
+0000fea0: 2020 2020 2020 2020 2020 6761 7020 3d20            gap = 
+0000feb0: 7769 6e64 6f77 5f67 6170 735f 735b 692d  window_gaps_s[i-
+0000fec0: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
+0000fed0: 2020 206f 7574 5374 7265 616d 203d 206f     outStream = o
+0000fee0: 7574 5374 7265 616d 202b 206e 6577 5374  utStream + newSt
+0000fef0: 2e74 7269 6d28 7374 6172 7474 696d 653d  .trim(starttime=
+0000ff00: 7374 5b30 5d2e 7374 6174 732e 7374 6172  st[0].stats.star
+0000ff10: 7474 696d 6520 2d20 6761 702c 2070 6164  ttime - gap, pad
+0000ff20: 3d54 7275 652c 2066 696c 6c5f 7661 6c75  =True, fill_valu
+0000ff30: 653d 4e6f 6e65 2920 2020 2020 2020 0a20  e=None)       . 
+0000ff40: 2020 2020 2020 206f 7574 5374 7265 616d         outStream
+0000ff50: 2e6d 6572 6765 2829 0a20 2020 2065 6c73  .merge().    els
+0000ff60: 653a 0a20 2020 2020 2020 206f 7574 5374  e:.        outSt
+0000ff70: 7265 616d 203d 2073 7472 6561 6d2e 636f  ream = stream.co
+0000ff80: 7079 2829 0a0a 2020 2020 7265 7475 726e  py()..    return
+0000ff90: 206f 7574 5374 7265 616d 0a0a 2348 656c   outStream..#Hel
+0000ffa0: 7065 7220 6675 6e63 7469 6f6e 2066 6f72  per function for
+0000ffb0: 2067 6574 7469 6e67 2077 696e 646f 7773   getting windows
+0000ffc0: 2074 6f20 7265 6d6f 7665 206e 6f69 7365   to remove noise
+0000ffd0: 2075 7369 6e67 2073 7461 6c74 6120 616e   using stalta an
+0000ffe0: 7469 7472 6967 6765 7220 6d65 7468 6f64  titrigger method
+0000fff0: 0a64 6566 205f 5f72 656d 6f76 655f 616e  .def __remove_an
+00010000: 7469 5f73 7461 6c74 6128 7374 7265 616d  ti_stalta(stream
+00010010: 2c20 7374 612c 206c 7461 2c20 7468 7265  , sta, lta, thre
+00010020: 7368 2c20 7368 6f77 5f70 6c6f 743d 4661  sh, show_plot=Fa
+00010030: 6c73 6529 3a0a 2020 2020 2222 2248 656c  lse):.    """Hel
+00010040: 7065 7220 6675 6e63 7469 6f6e 2066 6f72  per function for
+00010050: 2067 6574 7469 6e67 2077 696e 646f 7773   getting windows
+00010060: 2074 6f20 7265 6d6f 7665 206e 6f69 7365   to remove noise
+00010070: 2075 7369 6e67 2073 7461 6c74 6120 616e   using stalta an
+00010080: 7469 7472 6967 6765 7220 6d65 7468 6f64  titrigger method
+00010090: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+000100a0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+000100b0: 2020 2020 7374 7265 616d 203a 206f 6273      stream : obs
+000100c0: 7079 2e63 6f72 652e 7374 7265 616d 2e53  py.core.stream.S
+000100d0: 7472 6561 6d20 6f62 6a65 6374 0a20 2020  tream object.   
+000100e0: 2020 2020 2049 6e70 7574 2073 7472 6561       Input strea
+000100f0: 6d20 6f6e 2077 6869 6368 2074 6f20 7065  m on which to pe
+00010100: 7266 6f72 6d20 6e6f 6973 6520 7265 6d6f  rform noise remo
+00010110: 7661 6c0a 2020 2020 7374 6120 3a20 696e  val.    sta : in
+00010120: 740a 2020 2020 2020 2020 4e75 6d62 6572  t.        Number
+00010130: 206f 6620 7365 636f 6e64 7320 746f 2075   of seconds to u
+00010140: 7365 2061 7320 7368 6f72 7420 7465 726d  se as short term
+00010150: 2077 696e 646f 772c 2072 6561 6473 2066   window, reads f
+00010160: 726f 6d20 7265 6d6f 7665 5f6e 6f69 7365  rom remove_noise
+00010170: 2829 2066 756e 6374 696f 6e2e 0a20 2020  () function..   
+00010180: 206c 7461 203a 2069 6e74 0a20 2020 2020   lta : int.     
+00010190: 2020 204e 756d 6265 7220 6f66 2073 6563     Number of sec
+000101a0: 6f6e 6473 2074 6f20 7573 6520 6173 206c  onds to use as l
+000101b0: 6f6e 6720 7465 726d 2077 696e 646f 772c  ong term window,
+000101c0: 2072 6561 6473 2066 726f 6d20 7265 6d6f   reads from remo
+000101d0: 7665 5f6e 6f69 7365 2829 2066 756e 6374  ve_noise() funct
+000101e0: 696f 6e2e 0a20 2020 2074 6872 6573 6820  ion..    thresh 
+000101f0: 3a20 6c69 7374 0a20 2020 2020 2020 2054  : list.        T
+00010200: 776f 2d69 7465 6d20 6c69 7374 206f 7220  wo-item list or 
+00010210: 7475 706c 6520 7769 7468 2074 6865 2074  tuple with the t
+00010220: 6872 6573 686f 6c64 7320 666f 7220 7468  hresholds for th
+00010230: 6520 7374 616c 7461 2061 6e74 6974 7269  e stalta antitri
+00010240: 6767 6572 2e20 5265 6164 7320 6672 6f6d  gger. Reads from
+00010250: 2072 656d 6f76 655f 6e6f 6973 6528 2920   remove_noise() 
+00010260: 6675 6e63 7469 6f6e 2e20 5468 6520 6669  function. The fi
+00010270: 7273 7420 7661 6c75 6520 2869 6e64 6578  rst value (index
+00010280: 205b 305d 2920 6973 2074 6865 206c 6f77   [0]) is the low
+00010290: 6572 2074 6872 6573 686f 6c64 2c20 7468  er threshold, th
+000102a0: 6520 7365 636f 6e64 2076 616c 7565 2028  e second value (
+000102b0: 696e 6465 7820 5b31 5d20 6973 2074 6865  index [1] is the
+000102c0: 2075 7070 6572 2074 6872 6573 686f 6c64   upper threshold
+000102d0: 292c 2062 7920 6465 6661 756c 7420 5b30  ), by default [0
+000102e0: 2e35 2c35 5d0a 2020 2020 7368 6f77 5f70  .5,5].    show_p
+000102f0: 6c6f 7420 3a20 626f 6f6c 0a20 2020 2020  lot : bool.     
+00010300: 2020 2049 6620 5472 7565 2c20 7769 6c6c     If True, will
+00010310: 2070 6c6f 7420 7468 6520 7472 6967 6765   plot the trigge
+00010320: 7220 616e 6420 7374 616c 7461 2076 616c  r and stalta val
+00010330: 7565 732e 2052 6561 6473 2066 726f 6d20  ues. Reads from 
+00010340: 7265 6d6f 7665 5f6e 6f69 7365 2829 2066  remove_noise() f
+00010350: 756e 6374 696f 6e2c 2062 7920 6465 6661  unction, by defa
+00010360: 756c 7420 4661 6c73 652e 0a0a 2020 2020  ult False...    
+00010370: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
+00010380: 2d2d 2d0a 2020 2020 6f75 7453 7472 6561  ---.    outStrea
+00010390: 6d20 3a20 6f62 7370 792e 636f 7265 2e73  m : obspy.core.s
+000103a0: 7472 6561 6d2e 5374 7265 616d 206f 626a  tream.Stream obj
+000103b0: 6563 740a 2020 2020 2020 2020 5374 7265  ect.        Stre
+000103c0: 616d 2077 6974 6820 6120 6d61 736b 6564  am with a masked
+000103d0: 2061 7272 6179 2066 6f72 2074 6865 2064   array for the d
+000103e0: 6174 6120 7768 6572 6520 276e 6f69 7365  ata where 'noise
+000103f0: 2720 6861 7320 6265 656e 2072 656d 6f76  ' has been remov
+00010400: 6564 0a0a 2020 2020 2222 220a 2020 2020  ed..    """.    
+00010410: 6672 6f6d 206f 6273 7079 2e73 6967 6e61  from obspy.signa
+00010420: 6c2e 7472 6967 6765 7220 696d 706f 7274  l.trigger import
+00010430: 2063 6c61 7373 6963 5f73 7461 5f6c 7461   classic_sta_lta
+00010440: 0a0a 2020 2020 7361 6d70 6c65 5261 7465  ..    sampleRate
+00010450: 203d 2066 6c6f 6174 2873 7472 6561 6d5b   = float(stream[
+00010460: 305d 2e73 7461 7473 2e64 656c 7461 290a  0].stats.delta).
+00010470: 0a20 2020 2073 7461 5f73 616d 706c 6573  .    sta_samples
+00010480: 203d 2073 7461 202f 2073 616d 706c 6552   = sta / sampleR
+00010490: 6174 6520 2343 6f6e 7665 7274 2074 6f20  ate #Convert to 
+000104a0: 7361 6d70 6c65 730a 2020 2020 6c74 615f  samples.    lta_
+000104b0: 7361 6d70 6c65 7320 3d20 6c74 6120 2f20  samples = lta / 
+000104c0: 7361 6d70 6c65 5261 7465 2023 436f 6e76  sampleRate #Conv
+000104d0: 6572 7420 746f 2073 616d 706c 6573 0a20  ert to samples. 
+000104e0: 2020 2073 7461 6c74 6153 7472 6561 6d20     staltaStream 
+000104f0: 3d20 7374 7265 616d 2e63 6f70 7928 290a  = stream.copy().
+00010500: 0a20 2020 2066 6f72 2074 7220 696e 2073  .    for tr in s
+00010510: 7461 6c74 6153 7472 6561 6d3a 0a20 2020  taltaStream:.   
+00010520: 2020 2020 2063 6861 7261 6374 6572 6973       characteris
+00010530: 7469 635f 6675 6e20 3d20 636c 6173 7369  tic_fun = classi
+00010540: 635f 7374 615f 6c74 6128 7472 2c20 6e73  c_sta_lta(tr, ns
+00010550: 7461 3d73 7461 5f73 616d 706c 6573 2c20  ta=sta_samples, 
+00010560: 6e6c 7461 3d6c 7461 5f73 616d 706c 6573  nlta=lta_samples
+00010570: 290a 2020 2020 6966 2073 686f 775f 706c  ).    if show_pl
+00010580: 6f74 3a0a 2020 2020 2020 2020 6f62 7370  ot:.        obsp
+00010590: 792e 7369 676e 616c 2e74 7269 6767 6572  y.signal.trigger
+000105a0: 2e70 6c6f 745f 7472 6967 6765 7228 7472  .plot_trigger(tr
+000105b0: 2c20 6368 6172 6163 7465 7269 7374 6963  , characteristic
+000105c0: 5f66 756e 2c20 7468 7265 7368 5b31 5d2c  _fun, thresh[1],
+000105d0: 2074 6872 6573 685b 305d 290a 2020 2020   thresh[0]).    
+000105e0: 7769 6e64 6f77 735f 7361 6d70 6c65 7320  windows_samples 
+000105f0: 3d20 6f62 7370 792e 7369 676e 616c 2e74  = obspy.signal.t
+00010600: 7269 6767 6572 2e74 7269 6767 6572 5f6f  rigger.trigger_o
+00010610: 6e73 6574 2863 6861 7261 6374 6572 6973  nset(characteris
+00010620: 7469 635f 6675 6e2c 2074 6872 6573 685b  tic_fun, thresh[
+00010630: 315d 2c20 7468 7265 7368 5b30 5d29 0a20  1], thresh[0]). 
+00010640: 2020 200a 2020 2020 7374 6172 7454 203d     .    startT =
+00010650: 2073 7472 6561 6d5b 305d 2e73 7461 7473   stream[0].stats
+00010660: 2e73 7461 7274 7469 6d65 0a20 2020 2065  .starttime.    e
+00010670: 6e64 5420 3d20 7374 7265 616d 5b30 5d2e  ndT = stream[0].
+00010680: 7374 6174 732e 656e 6474 696d 650a 2020  stats.endtime.  
+00010690: 2020 7769 6e64 6f77 5f55 5443 203d 205b    window_UTC = [
+000106a0: 5d0a 2020 2020 7769 6e64 6f77 5f4d 504c  ].    window_MPL
+000106b0: 203d 205b 5d0a 2020 2020 7769 6e64 6f77   = [].    window
+000106c0: 5f55 5443 2e61 7070 656e 6428 5b73 7461  _UTC.append([sta
+000106d0: 7274 542c 2073 7461 7274 545d 290a 2020  rtT, startT]).  
+000106e0: 2020 666f 7220 772c 2077 696e 2069 6e20    for w, win in 
+000106f0: 656e 756d 6572 6174 6528 7769 6e64 6f77  enumerate(window
+00010700: 735f 7361 6d70 6c65 7329 3a0a 2020 2020  s_samples):.    
+00010710: 2020 2020 666f 7220 692c 2074 2069 6e20      for i, t in 
+00010720: 656e 756d 6572 6174 6528 7769 6e29 3a0a  enumerate(win):.
+00010730: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00010740: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00010750: 2020 2020 2020 2077 696e 646f 775f 5554         window_UT
+00010760: 432e 6170 7065 6e64 285b 5d29 0a20 2020  C.append([]).   
+00010770: 2020 2020 2020 2020 2020 2020 2077 696e               win
+00010780: 646f 775f 4d50 4c2e 6170 7065 6e64 285b  dow_MPL.append([
+00010790: 5d29 0a20 2020 2020 2020 2020 2020 2074  ]).            t
+000107a0: 7269 6753 6869 6674 203d 2073 7461 0a20  rigShift = sta. 
+000107b0: 2020 2020 2020 2020 2020 2069 6620 7472             if tr
+000107c0: 6967 5368 6966 7420 3e20 7420 2a20 7361  igShift > t * sa
+000107d0: 6d70 6c65 5261 7465 3a0a 2020 2020 2020  mpleRate:.      
+000107e0: 2020 2020 2020 2020 2020 7472 6967 5368            trigSh
+000107f0: 6966 7420 3d20 300a 2020 2020 2020 2020  ift = 0.        
+00010800: 2020 2020 7453 6563 203d 2074 202a 2073      tSec = t * s
+00010810: 616d 706c 6552 6174 6520 2d20 7472 6967  ampleRate - trig
+00010820: 5368 6966 740a 2020 2020 2020 2020 2020  Shift.          
+00010830: 2020 7769 6e64 6f77 5f55 5443 5b77 2b31    window_UTC[w+1
+00010840: 5d2e 6170 7065 6e64 2873 7461 7274 542b  ].append(startT+
+00010850: 7453 6563 290a 2020 2020 2020 2020 2020  tSec).          
+00010860: 2020 7769 6e64 6f77 5f4d 504c 5b77 5d2e    window_MPL[w].
+00010870: 6170 7065 6e64 2877 696e 646f 775f 5554  append(window_UT
+00010880: 435b 775d 5b69 5d2e 6d61 7470 6c6f 746c  C[w][i].matplotl
+00010890: 6962 5f64 6174 6529 0a20 2020 200a 2020  ib_date).    .  
+000108a0: 2020 7769 6e64 6f77 5f55 5443 2e61 7070    window_UTC.app
+000108b0: 656e 6428 5b65 6e64 542c 2065 6e64 545d  end([endT, endT]
+000108c0: 290a 2020 2020 2377 696e 646f 775f 4d50  ).    #window_MP
+000108d0: 4c5b 775d 2e61 7070 656e 6428 7769 6e64  L[w].append(wind
+000108e0: 6f77 5f55 5443 5b77 5d5b 695d 2e6d 6174  ow_UTC[w][i].mat
+000108f0: 706c 6f74 6c69 625f 6461 7465 290a 2020  plotlib_date).  
+00010900: 2020 6f75 7453 7472 6561 6d20 3d20 5f5f    outStream = __
+00010910: 7265 6d6f 7665 5f67 6170 7328 7374 7265  remove_gaps(stre
+00010920: 616d 2c20 7769 6e64 6f77 5f55 5443 290a  am, window_UTC).
+00010930: 2020 2020 7265 7475 726e 206f 7574 5374      return outSt
+00010940: 7265 616d 0a0a 2352 656d 6f76 6520 6e6f  ream..#Remove no
+00010950: 6973 6520 7361 7475 7261 7469 6f6e 0a64  ise saturation.d
+00010960: 6566 205f 5f72 656d 6f76 655f 6e6f 6973  ef __remove_nois
+00010970: 655f 7361 7475 7261 7465 2873 7472 6561  e_saturate(strea
+00010980: 6d2c 2073 6174 5f70 6572 6365 6e74 2c20  m, sat_percent, 
+00010990: 6d69 6e5f 7769 6e5f 7369 7a65 293a 0a20  min_win_size):. 
+000109a0: 2020 2022 2222 4675 6e63 7469 6f6e 2074     """Function t
+000109b0: 6f20 7265 6d6f 7665 2022 7361 7475 7261  o remove "satura
+000109c0: 7465 6422 2064 6174 6120 706f 696e 7473  ted" data points
+000109d0: 2074 6861 7420 6578 6365 6564 2061 2063   that exceed a c
+000109e0: 6572 7461 696e 2070 6572 6365 6e74 2028  ertain percent (
+000109f0: 7361 745f 7065 7263 656e 7429 206f 6620  sat_percent) of 
+00010a00: 7468 6520 6d61 7869 6d75 6d20 6461 7461  the maximum data
+00010a10: 2076 616c 7565 2069 6e20 7468 6520 7374   value in the st
+00010a20: 7265 616d 2e20 200a 0a20 2020 2050 6172  ream.  ..    Par
+00010a30: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+00010a40: 2d2d 2d2d 2d2d 0a20 2020 2073 7472 6561  ------.    strea
+00010a50: 6d20 3a20 6f62 7370 792e 5374 7265 616d  m : obspy.Stream
+00010a60: 0a20 2020 2020 2020 204f 6273 7079 2053  .        Obspy S
+00010a70: 7472 6561 6d20 6f66 2069 6e74 6572 6573  tream of interes
+00010a80: 740a 2020 2020 7361 745f 7065 7263 656e  t.    sat_percen
+00010a90: 7420 3a20 666c 6f61 740a 2020 2020 2020  t : float.      
+00010aa0: 2020 5065 7263 656e 7461 6765 206f 6620    Percentage of 
+00010ab0: 7468 6520 6d61 7869 6d75 6d20 616d 706c  the maximum ampl
+00010ac0: 6974 7564 652c 2077 6869 6368 2077 696c  itude, which wil
+00010ad0: 6c20 6265 2075 7365 6420 6173 2074 6865  l be used as the
+00010ae0: 2073 6174 7572 6174 696f 6e20 7468 7265   saturation thre
+00010af0: 7368 6f6c 6420 6162 6f76 6520 7768 6963  shold above whic
+00010b00: 6820 6461 7461 2070 6f69 6e74 7320 7769  h data points wi
+00010b10: 6c6c 2062 6520 6578 636c 7564 6564 0a20  ll be excluded. 
+00010b20: 2020 206d 696e 5f77 696e 5f73 697a 6520     min_win_size 
+00010b30: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+00010b40: 5468 6520 6d69 6e75 6d75 6d20 7369 7a65  The minumum size
+00010b50: 2061 2077 696e 646f 7720 6d75 7374 2062   a window must b
+00010b60: 6520 2869 6e20 7365 636f 6e64 7329 2066  e (in seconds) f
+00010b70: 6f72 2069 7420 746f 2062 6520 7265 6d6f  or it to be remo
+00010b80: 7665 640a 0a20 2020 2052 6574 7572 6e73  ved..    Returns
+00010b90: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+00010ba0: 206f 6273 7079 2e53 7472 6561 6d0a 2020   obspy.Stream.  
+00010bb0: 2020 2020 2020 5374 7265 616d 2077 6974        Stream wit
+00010bc0: 6820 6d61 736b 6564 2061 7272 6179 2028  h masked array (
+00010bd0: 6966 2064 6174 6120 7265 6d6f 7665 6429  if data removed)
+00010be0: 2077 6974 6820 2273 6174 7572 6174 6564   with "saturated
+00010bf0: 2220 6461 7461 2072 656d 6f76 6564 0a20  " data removed. 
+00010c00: 2020 2022 2222 0a20 2020 2069 6620 7361     """.    if sa
+00010c10: 745f 7065 7263 656e 7420 3e20 313a 0a20  t_percent > 1:. 
+00010c20: 2020 2020 2020 2073 6174 5f70 6572 6365         sat_perce
+00010c30: 6e74 203d 2073 6174 5f70 6572 6365 6e74  nt = sat_percent
+00010c40: 202f 2031 3030 0a0a 2020 2020 7265 6d6f   / 100..    remo
+00010c50: 7665 496e 6420 3d20 6e70 2e61 7272 6179  veInd = np.array
+00010c60: 285b 5d2c 2064 7479 7065 3d69 6e74 290a  ([], dtype=int).
+00010c70: 2020 2020 666f 7220 7472 6163 6520 696e      for trace in
+00010c80: 2073 7472 6561 6d3a 0a20 2020 2020 2020   stream:.       
+00010c90: 2064 6174 6141 7272 203d 2074 7261 6365   dataArr = trace
+00010ca0: 2e64 6174 612e 636f 7079 2829 0a0a 2020  .data.copy()..  
+00010cb0: 2020 2020 2020 7361 6d70 6c65 5f72 6174        sample_rat
+00010cc0: 6520 3d20 7472 6163 652e 7374 6174 732e  e = trace.stats.
+00010cd0: 6465 6c74 610a 0a20 2020 2020 2020 2023  delta..        #
+00010ce0: 4765 7420 6d61 7820 616d 706c 6974 7564  Get max amplitud
+00010cf0: 6520 7661 6c75 650a 2020 2020 2020 2020  e value.        
+00010d00: 6d61 7841 6d70 203d 206e 702e 6d61 7828  maxAmp = np.max(
+00010d10: 6e70 2e61 6273 6f6c 7574 6528 6461 7461  np.absolute(data
+00010d20: 4172 722c 2077 6865 7265 203d 206e 6f74  Arr, where = not
+00010d30: 204e 6f6e 6529 290a 2020 2020 2020 2020   None)).        
+00010d40: 7468 7265 7368 6f6c 6441 6d70 203d 206d  thresholdAmp = m
+00010d50: 6178 416d 7020 2a20 7361 745f 7065 7263  axAmp * sat_perc
+00010d60: 656e 740a 2020 2020 2020 2020 636f 6e64  ent.        cond
+00010d70: 203d 206e 702e 6e6f 6e7a 6572 6f28 6e70   = np.nonzero(np
+00010d80: 2e61 6273 6f6c 7574 6528 6461 7461 4172  .absolute(dataAr
+00010d90: 722c 2077 6865 7265 3d6e 6f74 204e 6f6e  r, where=not Non
+00010da0: 6529 203e 2074 6872 6573 686f 6c64 416d  e) > thresholdAm
+00010db0: 7029 5b30 5d0a 2020 2020 2020 2020 7265  p)[0].        re
+00010dc0: 6d6f 7665 496e 6420 3d20 6e70 2e68 7374  moveInd = np.hst
+00010dd0: 6163 6b28 5b72 656d 6f76 6549 6e64 2c20  ack([removeInd, 
+00010de0: 636f 6e64 5d29 0a20 2020 2020 2020 2023  cond]).        #
+00010df0: 7472 6163 652e 6461 7461 203d 206e 702e  trace.data = np.
+00010e00: 6d61 2e77 6865 7265 286e 702e 6162 736f  ma.where(np.abso
+00010e10: 6c75 7465 2864 6174 612c 2077 6865 7265  lute(data, where
+00010e20: 203d 206e 6f74 204e 6f6e 6529 203e 2028   = not None) > (
+00010e30: 6e6f 6973 655f 7065 7263 656e 7420 2a20  noise_percent * 
+00010e40: 6d61 7841 6d70 292c 204e 6f6e 652c 2064  maxAmp), None, d
+00010e50: 6174 6129 0a20 2020 2023 436f 6d62 696e  ata).    #Combin
+00010e60: 6520 696e 6469 6365 7320 6672 6f6d 2061  e indices from a
+00010e70: 6c6c 2074 6872 6565 2074 7261 6365 730a  ll three traces.
+00010e80: 2020 2020 7265 6d6f 7665 496e 6420 3d20      removeInd = 
+00010e90: 6e70 2e75 6e69 7175 6528 7265 6d6f 7665  np.unique(remove
+00010ea0: 496e 6429 0a20 2020 200a 2020 2020 7265  Ind).    .    re
+00010eb0: 6d6f 7665 4c69 7374 203d 205b 5d20 2023  moveList = []  #
+00010ec0: 2069 6e69 7469 616c 697a 650a 2020 2020   initialize.    
+00010ed0: 6d69 6e5f 7769 6e5f 7361 6d70 6c65 7320  min_win_samples 
+00010ee0: 3d20 696e 7428 6d69 6e5f 7769 6e5f 7369  = int(min_win_si
+00010ef0: 7a65 202f 2073 616d 706c 655f 7261 7465  ze / sample_rate
+00010f00: 290a 0a20 2020 2069 6620 6c65 6e28 7265  )..    if len(re
+00010f10: 6d6f 7665 496e 6429 203e 2030 3a0a 2020  moveInd) > 0:.  
+00010f20: 2020 2020 2020 7374 6172 7449 6e64 203d        startInd =
+00010f30: 2072 656d 6f76 6549 6e64 5b30 5d0a 2020   removeInd[0].  
+00010f40: 2020 2020 2020 656e 6449 6e64 203d 2072        endInd = r
+00010f50: 656d 6f76 6549 6e64 5b30 5d0a 0a20 2020  emoveInd[0]..   
+00010f60: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+00010f70: 6e67 6528 302c 206c 656e 2872 656d 6f76  nge(0, len(remov
+00010f80: 6549 6e64 2929 3a20 2020 2020 2020 2020  eInd)):         
+00010f90: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00010fa0: 2069 6620 7265 6d6f 7665 496e 645b 695d   if removeInd[i]
+00010fb0: 202d 2072 656d 6f76 6549 6e64 5b69 2d31   - removeInd[i-1
+00010fc0: 5d20 3e20 313a 0a20 2020 2020 2020 2020  ] > 1:.         
+00010fd0: 2020 2020 2020 2069 6620 656e 6449 6e64         if endInd
+00010fe0: 202d 2073 7461 7274 496e 6420 3e3d 206d   - startInd >= m
+00010ff0: 696e 5f77 696e 5f73 616d 706c 6573 3a0a  in_win_samples:.
+00011000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011010: 2020 2020 7265 6d6f 7665 4c69 7374 2e61      removeList.a
+00011020: 7070 656e 6428 5b69 6e74 2873 7461 7274  ppend([int(start
+00011030: 496e 6429 2c20 696e 7428 656e 6449 6e64  Ind), int(endInd
+00011040: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
+00011050: 2020 2020 7374 6172 7449 6e64 203d 2072      startInd = r
+00011060: 656d 6f76 6549 6e64 5b69 5d0a 2020 2020  emoveInd[i].    
+00011070: 2020 2020 2020 2020 656e 6449 6e64 203d          endInd =
+00011080: 2072 656d 6f76 6549 6e64 5b69 5d0a 0a0a   removeInd[i]...
+00011090: 0a20 2020 2072 656d 6f76 654c 6973 742e  .    removeList.
+000110a0: 6170 7065 6e64 285b 2d31 2c20 2d31 5d29  append([-1, -1])
+000110b0: 2023 6669 6775 7265 206f 7574 2061 2077   #figure out a w
+000110c0: 6179 2074 6f20 6765 7420 7269 6420 6f66  ay to get rid of
+000110d0: 2074 6869 730a 0a20 2020 2023 436f 6e76   this..    #Conv
+000110e0: 6572 7420 7265 6d6f 7665 4c69 7374 2066  ert removeList f
+000110f0: 726f 6d20 7361 6d70 6c65 7320 746f 2073  rom samples to s
+00011100: 6563 6f6e 6473 2061 6674 6572 2073 7461  econds after sta
+00011110: 7274 2074 6f20 5554 4344 6174 6554 696d  rt to UTCDateTim
+00011120: 650a 2020 2020 7361 6d70 6c65 5261 7465  e.    sampleRate
+00011130: 203d 2073 7472 6561 6d5b 305d 2e73 7461   = stream[0].sta
+00011140: 7473 2e64 656c 7461 0a20 2020 2073 7461  ts.delta.    sta
+00011150: 7274 5420 3d20 7374 7265 616d 5b30 5d2e  rtT = stream[0].
+00011160: 7374 6174 732e 7374 6172 7474 696d 650a  stats.starttime.
+00011170: 2020 2020 656e 6454 203d 2073 7472 6561      endT = strea
+00011180: 6d5b 305d 2e73 7461 7473 2e65 6e64 7469  m[0].stats.endti
+00011190: 6d65 0a20 2020 2072 656d 6f76 6553 6563  me.    removeSec
+000111a0: 203d 205b 5d0a 2020 2020 7265 6d6f 7665   = [].    remove
+000111b0: 5554 4320 3d20 5b5d 0a20 2020 2072 656d  UTC = [].    rem
+000111c0: 6f76 6555 5443 2e61 7070 656e 6428 5b73  oveUTC.append([s
+000111d0: 7461 7274 542c 2073 7461 7274 545d 290a  tartT, startT]).
+000111e0: 2020 2020 666f 7220 692c 2077 696e 2069      for i, win i
+000111f0: 6e20 656e 756d 6572 6174 6528 7265 6d6f  n enumerate(remo
+00011200: 7665 4c69 7374 293a 0a20 2020 2020 2020  veList):.       
+00011210: 2072 656d 6f76 6553 6563 2e61 7070 656e   removeSec.appen
+00011220: 6428 6c69 7374 286e 702e 726f 756e 6428  d(list(np.round(
+00011230: 7361 6d70 6c65 5261 7465 202a 206e 702e  sampleRate * np.
+00011240: 6172 7261 7928 7769 6e29 2c36 2929 290a  array(win),6))).
+00011250: 2020 2020 2020 2020 7265 6d6f 7665 5554          removeUT
+00011260: 432e 6170 7065 6e64 286c 6973 7428 6e70  C.append(list(np
+00011270: 2e61 6464 2873 7461 7274 542c 2072 656d  .add(startT, rem
+00011280: 6f76 6553 6563 5b69 5d29 2929 0a20 2020  oveSec[i]))).   
+00011290: 2072 656d 6f76 6555 5443 5b2d 315d 5b30   removeUTC[-1][0
+000112a0: 5d20 3d20 7265 6d6f 7665 5554 435b 2d31  ] = removeUTC[-1
+000112b0: 5d5b 315d 203d 2065 6e64 540a 2020 2020  ][1] = endT.    
+000112c0: 0a20 2020 206f 7574 7374 7265 616d 2020  .    outstream  
+000112d0: 3d20 5f5f 7265 6d6f 7665 5f67 6170 7328  = __remove_gaps(
+000112e0: 7374 7265 616d 2c20 7265 6d6f 7665 5554  stream, removeUT
+000112f0: 4329 0a20 2020 2072 6574 7572 6e20 6f75  C).    return ou
+00011300: 7473 7472 6561 6d0a 0a23 4865 6c70 6572  tstream..#Helper
+00011310: 2066 756e 6374 696f 6e20 666f 7220 7265   function for re
+00011320: 6d6f 7669 6e67 2064 6174 6120 7573 696e  moving data usin
+00011330: 6720 7468 6520 6e6f 6973 6520 7468 7265  g the noise thre
+00011340: 7368 6f6c 6420 696e 7075 7420 6672 6f6d  shold input from
+00011350: 2072 656d 6f76 655f 6e6f 6973 6528 290a   remove_noise().
+00011360: 6465 6620 5f5f 7265 6d6f 7665 5f6e 6f69  def __remove_noi
+00011370: 7365 5f74 6872 6573 6828 7374 7265 616d  se_thresh(stream
+00011380: 2c20 6e6f 6973 655f 7065 7263 656e 743d  , noise_percent=
+00011390: 302e 382c 206c 7461 3d33 302c 206d 696e  0.8, lta=30, min
+000113a0: 5f77 696e 5f73 697a 653d 3129 3a0a 2020  _win_size=1):.  
+000113b0: 2020 2222 2248 656c 7065 7220 6675 6e63    """Helper func
+000113c0: 7469 6f6e 2066 6f72 2072 656d 6f76 696e  tion for removin
+000113d0: 6720 6461 7461 2075 7369 6e67 2074 6865  g data using the
+000113e0: 206e 6f69 7365 2074 6872 6573 686f 6c64   noise threshold
+000113f0: 2069 6e70 7574 2066 726f 6d20 7265 6d6f   input from remo
+00011400: 7665 5f6e 6f69 7365 2829 0a0a 2020 2020  ve_noise()..    
+00011410: 5468 6520 7075 7270 6f73 6520 6f66 2074  The purpose of t
+00011420: 6865 206e 6f69 7365 2074 6872 6573 686f  he noise thresho
+00011430: 6c64 206d 6574 686f 6420 6973 2074 6f20  ld method is to 
+00011440: 7265 6d6f 7665 206e 6f69 7379 2077 696e  remove noisy win
+00011450: 646f 7773 2028 652e 672e 2c20 6c6f 7473  dows (e.g., lots
+00011460: 206f 6620 7472 6166 6669 6320 616c 6c20   of traffic all 
+00011470: 6174 206f 6e63 6529 2e20 0a20 2020 200a  at once). .    .
+00011480: 2020 2020 5468 6973 2066 756e 6374 696f      This functio
+00011490: 6e20 7573 6573 2074 6865 206c 7461 2076  n uses the lta v
+000114a0: 616c 7565 2028 7768 6963 6820 6361 6e20  alue (which can 
+000114b0: 6265 2073 7065 6369 6669 6564 2068 6572  be specified her
+000114c0: 6529 2c20 616e 6420 6669 6e64 7320 7469  e), and finds ti
+000114d0: 6d65 7320 7768 6572 6520 7468 6520 6c74  mes where the lt
+000114e0: 6120 7661 6c75 6520 6973 2061 7420 6c65  a value is at le
+000114f0: 6173 7420 6174 2074 6865 206e 6f69 7365  ast at the noise
+00011500: 5f70 6572 6365 6e74 206c 6576 656c 206f  _percent level o
+00011510: 6620 7468 6520 6d61 7820 6c74 6120 7661  f the max lta va
+00011520: 6c75 6520 666f 7220 6174 206c 6561 7374  lue for at least
+00011530: 2061 2073 7065 6369 6669 6564 2074 696d   a specified tim
+00011540: 6520 286d 696e 5f77 696e 5f73 697a 6529  e (min_win_size)
+00011550: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+00011560: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+00011570: 2020 2020 7374 7265 616d 203a 206f 6273      stream : obs
+00011580: 7079 2e63 6f72 652e 7374 7265 616d 2e53  py.core.stream.S
+00011590: 7472 6561 6d20 6f62 6a65 6374 0a20 2020  tream object.   
+000115a0: 2020 2020 2049 6e70 7574 2073 7472 6561       Input strea
+000115b0: 6d20 6672 6f6d 2077 6869 6368 2074 6f20  m from which to 
+000115c0: 7265 6d6f 7665 2077 696e 646f 7773 2e20  remove windows. 
+000115d0: 5061 7373 6564 2066 726f 6d20 7265 6d6f  Passed from remo
+000115e0: 7665 5f6e 6f69 7365 2829 2e0a 2020 2020  ve_noise()..    
+000115f0: 6e6f 6973 655f 7065 7263 656e 7420 3a20  noise_percent : 
+00011600: 666c 6f61 742c 2064 6566 6175 6c74 3d30  float, default=0
+00011610: 2e39 3935 0a20 2020 2020 2020 2050 6572  .995.        Per
+00011620: 6365 6e74 6167 6520 2862 6574 7765 656e  centage (between
+00011630: 2030 2061 6e64 2031 292c 2074 6f20 7573   0 and 1), to us
+00011640: 6520 6173 2074 6865 2074 6872 6573 686f  e as the thresho
+00011650: 6c64 2061 7420 7768 6963 6820 746f 2072  ld at which to r
+00011660: 656d 6f76 6520 6461 7461 2e20 5468 6973  emove data. This
+00011670: 2069 7320 7573 6564 2069 6e20 7468 6520   is used in the 
+00011680: 6e6f 6973 6520 7468 7265 7368 6f6c 6420  noise threshold 
+00011690: 6d65 7468 6f64 2e20 4279 2064 6566 6175  method. By defau
+000116a0: 6c74 2030 2e39 3935 2e20 0a20 2020 2020  lt 0.995. .     
+000116b0: 2020 2049 6620 6120 7661 6c75 6520 6973     If a value is
+000116c0: 2070 6173 7365 6420 7468 6174 2069 7320   passed that is 
+000116d0: 6772 6561 7465 7220 7468 616e 2031 2c20  greater than 1, 
+000116e0: 6974 2077 696c 6c20 6265 2064 6976 6964  it will be divid
+000116f0: 6564 2062 7920 3130 3020 746f 206f 6274  ed by 100 to obt
+00011700: 6169 6e20 7468 6520 7065 7263 656e 7461  ain the percenta
+00011710: 6765 2e20 5061 7373 6564 2066 726f 6d20  ge. Passed from 
+00011720: 7265 6d6f 7665 5f6e 6f69 7365 2829 2e0a  remove_noise()..
+00011730: 2020 2020 6c74 6120 3a20 696e 742c 2064      lta : int, d
+00011740: 6566 6175 6c74 203d 2033 300a 2020 2020  efault = 30.    
+00011750: 2020 2020 4c65 6e67 7468 206f 6620 6c74      Length of lt
+00011760: 6120 746f 2075 7365 2028 696e 2073 6563  a to use (in sec
+00011770: 6f6e 6473 290a 2020 2020 6d69 6e5f 7769  onds).    min_wi
+00011780: 6e5f 7369 7a65 203a 2069 6e74 2c20 6465  n_size : int, de
+00011790: 6661 756c 7420 3d20 310a 2020 2020 2020  fault = 1.      
+000117a0: 2020 4d69 6e69 6d75 6d20 616d 6f75 6e74    Minimum amount
+000117b0: 206f 6620 7469 6d65 2028 696e 2073 6563   of time (in sec
+000117c0: 6f6e 6473 2920 6174 2077 6869 6368 206e  onds) at which n
+000117d0: 6f69 7365 2069 7320 6162 6f76 6520 6e6f  oise is above no
+000117e0: 6973 655f 7065 7263 656e 7420 6c65 7665  ise_percent leve
+000117f0: 6c2e 0a20 2020 200a 2020 2020 5265 7475  l..    .    Retu
+00011800: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
+00011810: 2020 2020 6f75 7453 7472 6561 6d20 3a20      outStream : 
+00011820: 6f62 7370 792e 636f 7265 2e73 7472 6561  obspy.core.strea
+00011830: 6d2e 5374 7265 616d 206f 626a 6563 740a  m.Stream object.
+00011840: 2020 2020 2020 2020 5374 7265 616d 2077          Stream w
+00011850: 6974 6820 6120 6d61 736b 6564 2061 7272  ith a masked arr
+00011860: 6179 2066 6f72 2074 6865 2064 6174 6120  ay for the data 
+00011870: 7768 6572 6520 276e 6f69 7365 2720 6861  where 'noise' ha
+00011880: 7320 6265 656e 2072 656d 6f76 6564 2e20  s been removed. 
+00011890: 5061 7373 6564 2074 6f20 7265 6d6f 7665  Passed to remove
+000118a0: 5f6e 6f69 7365 2829 2e0a 2020 2020 2222  _noise()..    ""
+000118b0: 220a 2020 2020 6966 206e 6f69 7365 5f70  ".    if noise_p
+000118c0: 6572 6365 6e74 203e 2031 3a0a 2020 2020  ercent > 1:.    
+000118d0: 2020 2020 6e6f 6973 655f 7065 7263 656e      noise_percen
+000118e0: 7420 3d20 6e6f 6973 655f 7065 7263 656e  t = noise_percen
+000118f0: 7420 2f20 3130 300a 0a20 2020 2072 656d  t / 100..    rem
+00011900: 6f76 6549 6e64 203d 206e 702e 6172 7261  oveInd = np.arra
+00011910: 7928 5b5d 2c20 6474 7970 653d 696e 7429  y([], dtype=int)
+00011920: 0a20 2020 2066 6f72 2074 7261 6365 2069  .    for trace i
+00011930: 6e20 7374 7265 616d 3a0a 2020 2020 2020  n stream:.      
+00011940: 2020 6461 7461 4172 7220 3d20 7472 6163    dataArr = trac
+00011950: 652e 6461 7461 2e63 6f70 7928 290a 0a20  e.data.copy().. 
+00011960: 2020 2020 2020 2073 616d 706c 655f 7261         sample_ra
+00011970: 7465 203d 2074 7261 6365 2e73 7461 7473  te = trace.stats
+00011980: 2e64 656c 7461 0a20 2020 2020 2020 206c  .delta.        l
+00011990: 7461 5f73 616d 706c 6573 203d 2069 6e74  ta_samples = int
+000119a0: 286c 7461 202f 2073 616d 706c 655f 7261  (lta / sample_ra
+000119b0: 7465 290a 0a20 2020 2020 2020 2023 4765  te)..        #Ge
+000119c0: 7420 6c74 6120 7661 6c75 6573 2061 6372  t lta values acr
+000119d0: 6f73 7320 7472 6163 6573 2064 6174 610a  oss traces data.
+000119e0: 2020 2020 2020 2020 7769 6e64 6f77 5f73          window_s
+000119f0: 697a 6520 3d20 6c74 615f 7361 6d70 6c65  ize = lta_sample
+00011a00: 730a 2020 2020 2020 2020 6966 2077 696e  s.        if win
+00011a10: 646f 775f 7369 7a65 203d 3d20 303a 0a20  dow_size == 0:. 
+00011a20: 2020 2020 2020 2020 2020 2077 696e 646f             windo
+00011a30: 775f 7369 7a65 203d 2031 0a20 2020 2020  w_size = 1.     
+00011a40: 2020 206b 6572 6e65 6c20 3d20 6e70 2e6f     kernel = np.o
+00011a50: 6e65 7328 7769 6e64 6f77 5f73 697a 6529  nes(window_size)
+00011a60: 202f 2077 696e 646f 775f 7369 7a65 0a20   / window_size. 
+00011a70: 2020 2020 2020 206d 6173 6b65 6441 7272         maskedArr
+00011a80: 203d 206e 702e 6d61 2e61 7272 6179 2864   = np.ma.array(d
+00011a90: 6174 6141 7272 2c20 6474 7970 653d 666c  ataArr, dtype=fl
+00011aa0: 6f61 742c 2066 696c 6c5f 7661 6c75 653d  oat, fill_value=
+00011ab0: 4e6f 6e65 290a 2020 2020 2020 2020 6c74  None).        lt
+00011ac0: 6141 7272 203d 206e 702e 636f 6e76 6f6c  aArr = np.convol
+00011ad0: 7665 286d 6173 6b65 6441 7272 2c20 6b65  ve(maskedArr, ke
+00011ae0: 726e 656c 2c20 6d6f 6465 3d27 7361 6d65  rnel, mode='same
+00011af0: 2729 0a20 2020 2020 2020 2023 4765 7420  ').        #Get 
+00011b00: 6d61 7820 6c74 6120 7661 6c75 650a 2020  max lta value.  
+00011b10: 2020 2020 2020 6d61 784c 5441 203d 206e        maxLTA = n
+00011b20: 702e 6d61 7828 6c74 6141 7272 2c20 7768  p.max(ltaArr, wh
+00011b30: 6572 6520 3d20 6e6f 7420 4e6f 6e65 290a  ere = not None).
+00011b40: 2020 2020 2020 2020 636f 6e64 203d 206e          cond = n
+00011b50: 702e 6e6f 6e7a 6572 6f28 6e70 2e61 6273  p.nonzero(np.abs
+00011b60: 6f6c 7574 6528 6c74 6141 7272 2c20 7768  olute(ltaArr, wh
+00011b70: 6572 653d 6e6f 7420 4e6f 6e65 2920 3e20  ere=not None) > 
+00011b80: 286e 6f69 7365 5f70 6572 6365 6e74 202a  (noise_percent *
+00011b90: 206d 6178 4c54 4129 295b 305d 0a20 2020   maxLTA))[0].   
+00011ba0: 2020 2020 2072 656d 6f76 6549 6e64 203d       removeInd =
+00011bb0: 206e 702e 6873 7461 636b 285b 7265 6d6f   np.hstack([remo
+00011bc0: 7665 496e 642c 2063 6f6e 645d 290a 2020  veInd, cond]).  
+00011bd0: 2020 2020 2020 2374 7261 6365 2e64 6174        #trace.dat
+00011be0: 6120 3d20 6e70 2e6d 612e 7768 6572 6528  a = np.ma.where(
+00011bf0: 6e70 2e61 6273 6f6c 7574 6528 6461 7461  np.absolute(data
+00011c00: 2c20 7768 6572 6520 3d20 6e6f 7420 4e6f  , where = not No
+00011c10: 6e65 2920 3e20 286e 6f69 7365 5f70 6572  ne) > (noise_per
+00011c20: 6365 6e74 202a 206d 6178 416d 7029 2c20  cent * maxAmp), 
+00011c30: 4e6f 6e65 2c20 6461 7461 290a 2020 2020  None, data).    
+00011c40: 2343 6f6d 6269 6e65 2069 6e64 6963 6573  #Combine indices
+00011c50: 2066 726f 6d20 616c 6c20 7468 7265 6520   from all three 
+00011c60: 7472 6163 6573 0a20 2020 2072 656d 6f76  traces.    remov
+00011c70: 6549 6e64 203d 206e 702e 756e 6971 7565  eInd = np.unique
+00011c80: 2872 656d 6f76 6549 6e64 290a 0a20 2020  (removeInd)..   
+00011c90: 2023 4d61 6b65 2073 7572 6520 7765 2772   #Make sure we'r
+00011ca0: 6520 6e6f 7420 7265 6d6f 7669 6e67 2073  e not removing s
+00011cb0: 696e 676c 6520 696e 6469 6365 7320 2877  ingle indices (w
+00011cc0: 6520 6f6e 6c79 2077 616e 7420 6c6f 6e67  e only want long
+00011cd0: 6572 2074 6861 6e20 6d69 6e5f 7769 6e5f  er than min_win_
+00011ce0: 7369 7a65 290a 2020 2020 7265 6d6f 7665  size).    remove
+00011cf0: 4c69 7374 203d 205b 5d20 2023 2069 6e69  List = []  # ini
+00011d00: 7469 616c 697a 6520 2020 200a 2020 2020  tialize    .    
+00011d10: 6d69 6e5f 7769 6e5f 7361 6d70 6c65 7320  min_win_samples 
+00011d20: 3d20 696e 7428 6d69 6e5f 7769 6e5f 7369  = int(min_win_si
+00011d30: 7a65 202f 2073 616d 706c 655f 7261 7465  ze / sample_rate
+00011d40: 290a 0a20 2020 2069 6620 6c65 6e28 7265  )..    if len(re
+00011d50: 6d6f 7665 496e 6429 203e 2030 3a0a 2020  moveInd) > 0:.  
+00011d60: 2020 2020 2020 7374 6172 7449 6e64 203d        startInd =
+00011d70: 2072 656d 6f76 6549 6e64 5b30 5d0a 2020   removeInd[0].  
+00011d80: 2020 2020 2020 656e 6449 6e64 203d 2072        endInd = r
+00011d90: 656d 6f76 6549 6e64 5b30 5d0a 0a20 2020  emoveInd[0]..   
+00011da0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+00011db0: 6e67 6528 302c 206c 656e 2872 656d 6f76  nge(0, len(remov
+00011dc0: 6549 6e64 2929 3a0a 2020 2020 2020 2020  eInd)):.        
+00011dd0: 2020 2020 2349 6620 696e 6469 6365 7320      #If indices 
+00011de0: 6172 6520 6e6f 6e2d 636f 6e73 6563 7574  are non-consecut
+00011df0: 6976 652e 2e2e 200a 2020 2020 2020 2020  ive... .        
+00011e00: 2020 2020 6966 2072 656d 6f76 6549 6e64      if removeInd
+00011e10: 5b69 5d20 2d20 7265 6d6f 7665 496e 645b  [i] - removeInd[
+00011e20: 692d 315d 203e 2031 3a0a 2020 2020 2020  i-1] > 1:.      
+00011e30: 2020 2020 2020 2020 2020 2349 6620 7468            #If th
+00011e40: 6520 696e 6469 6365 7320 6172 6520 6e6f  e indices are no
+00011e50: 6e2d 636f 6e73 6563 7574 6976 6520 616e  n-consecutive an
+00011e60: 6420 7468 6520 0a20 2020 2020 2020 2020  d the .         
+00011e70: 2020 2020 2020 2069 6620 656e 6449 6e64         if endInd
+00011e80: 202d 2073 7461 7274 496e 6420 3e3d 206d   - startInd >= m
+00011e90: 696e 5f77 696e 5f73 616d 706c 6573 3a0a  in_win_samples:.
+00011ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011eb0: 2020 2020 7265 6d6f 7665 4c69 7374 2e61      removeList.a
+00011ec0: 7070 656e 6428 5b69 6e74 2873 7461 7274  ppend([int(start
+00011ed0: 496e 6429 2c20 696e 7428 656e 6449 6e64  Ind), int(endInd
+00011ee0: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
+00011ef0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00011f00: 2020 2020 2020 2020 2023 5365 7420 7374           #Set st
+00011f10: 6172 7449 6e64 2061 7320 7468 6520 6375  artInd as the cu
+00011f20: 7272 656e 7420 696e 6465 780a 2020 2020  rrent index.    
+00011f30: 2020 2020 2020 2020 2020 2020 7374 6172              star
+00011f40: 7449 6e64 203d 2072 656d 6f76 6549 6e64  tInd = removeInd
+00011f50: 5b69 5d0a 2020 2020 2020 2020 2020 2020  [i].            
+00011f60: 656e 6449 6e64 203d 2072 656d 6f76 6549  endInd = removeI
+00011f70: 6e64 5b69 5d0a 2020 2020 2020 2020 2020  nd[i].          
+00011f80: 2020 0a20 2020 2072 656d 6f76 654c 6973    .    removeLis
+00011f90: 742e 6170 7065 6e64 285b 2d31 2c20 2d31  t.append([-1, -1
+00011fa0: 5d29 0a0a 2020 2020 7361 6d70 6c65 5261  ])..    sampleRa
+00011fb0: 7465 203d 2073 7472 6561 6d5b 305d 2e73  te = stream[0].s
+00011fc0: 7461 7473 2e64 656c 7461 0a20 2020 2073  tats.delta.    s
+00011fd0: 7461 7274 5420 3d20 7374 7265 616d 5b30  tartT = stream[0
+00011fe0: 5d2e 7374 6174 732e 7374 6172 7474 696d  ].stats.starttim
+00011ff0: 650a 2020 2020 656e 6454 203d 2073 7472  e.    endT = str
+00012000: 6561 6d5b 305d 2e73 7461 7473 2e65 6e64  eam[0].stats.end
+00012010: 7469 6d65 0a20 2020 2072 656d 6f76 6553  time.    removeS
+00012020: 6563 203d 205b 5d0a 2020 2020 7265 6d6f  ec = [].    remo
+00012030: 7665 5554 4320 3d20 5b5d 0a0a 2020 2020  veUTC = []..    
+00012040: 7265 6d6f 7665 5554 432e 6170 7065 6e64  removeUTC.append
+00012050: 285b 7374 6172 7454 2c20 7374 6172 7454  ([startT, startT
+00012060: 5d29 0a20 2020 2066 6f72 2069 2c20 7769  ]).    for i, wi
+00012070: 6e20 696e 2065 6e75 6d65 7261 7465 2872  n in enumerate(r
+00012080: 656d 6f76 654c 6973 7429 3a0a 2020 2020  emoveList):.    
+00012090: 2020 2020 7265 6d6f 7665 5365 632e 6170      removeSec.ap
+000120a0: 7065 6e64 286c 6973 7428 6e70 2e72 6f75  pend(list(np.rou
+000120b0: 6e64 2873 616d 706c 6552 6174 6520 2a20  nd(sampleRate * 
+000120c0: 6e70 2e61 7272 6179 2877 696e 292c 3629  np.array(win),6)
+000120d0: 2929 0a20 2020 2020 2020 2072 656d 6f76  )).        remov
+000120e0: 6555 5443 2e61 7070 656e 6428 6c69 7374  eUTC.append(list
+000120f0: 286e 702e 6164 6428 7374 6172 7454 2c20  (np.add(startT, 
+00012100: 7265 6d6f 7665 5365 635b 695d 2929 290a  removeSec[i]))).
+00012110: 2020 2020 7265 6d6f 7665 5554 435b 2d31      removeUTC[-1
+00012120: 5d5b 305d 203d 2072 656d 6f76 6555 5443  ][0] = removeUTC
+00012130: 5b2d 315d 5b31 5d20 3d20 656e 6454 0a0a  [-1][1] = endT..
+00012140: 2020 2020 6f75 7473 7472 6561 6d20 203d      outstream  =
+00012150: 205f 5f72 656d 6f76 655f 6761 7073 2873   __remove_gaps(s
+00012160: 7472 6561 6d2c 2072 656d 6f76 6555 5443  tream, removeUTC
+00012170: 290a 0a20 2020 2072 6574 7572 6e20 6f75  )..    return ou
+00012180: 7473 7472 6561 6d0a 0a23 4865 6c70 6572  tstream..#Helper
+00012190: 2066 756e 6374 696f 6e20 666f 7220 7265   function for re
+000121a0: 6d6f 7669 6e67 2064 6174 6120 6475 7269  moving data duri
+000121b0: 6e67 2077 6172 6d75 7020 2877 6865 6e20  ng warmup (when 
+000121c0: 7365 6973 6d6f 6d65 7465 7273 2061 7265  seismometers are
+000121d0: 2073 7469 6c6c 2069 6e69 7469 616c 697a   still initializ
+000121e0: 696e 6729 2061 6e64 2022 636f 6f6c 646f  ing) and "cooldo
+000121f0: 776e 2220 2877 6865 6e20 7468 6572 6520  wn" (when there 
+00012200: 6d61 7920 6265 206e 6f69 7365 2066 726f  may be noise fro
+00012210: 6d20 6465 6163 7469 7661 7469 6e67 2073  m deactivating s
+00012220: 6569 736d 6f6d 6574 6572 2920 7469 6d65  eismometer) time
+00012230: 2c20 6966 2064 6573 6972 6564 0a64 6566  , if desired.def
+00012240: 205f 5f72 656d 6f76 655f 7761 726d 7570   __remove_warmup
+00012250: 5f63 6f6f 6c64 6f77 6e28 7374 7265 616d  _cooldown(stream
+00012260: 2c20 7761 726d 7570 5f74 696d 6520 3d20  , warmup_time = 
+00012270: 302c 2063 6f6f 6c64 6f77 6e5f 7469 6d65  0, cooldown_time
+00012280: 203d 2030 293a 0a20 2020 2073 616d 706c   = 0):.    sampl
+00012290: 6552 6174 6520 3d20 666c 6f61 7428 7374  eRate = float(st
+000122a0: 7265 616d 5b30 5d2e 7374 6174 732e 6465  ream[0].stats.de
+000122b0: 6c74 6129 0a20 2020 206f 7574 5374 7265  lta).    outStre
+000122c0: 616d 203d 2073 7472 6561 6d2e 636f 7079  am = stream.copy
+000122d0: 2829 0a0a 2020 2020 7761 726d 7570 5f73  ()..    warmup_s
+000122e0: 616d 706c 6573 203d 2069 6e74 2877 6172  amples = int(war
+000122f0: 6d75 705f 7469 6d65 202f 2073 616d 706c  mup_time / sampl
+00012300: 6552 6174 6529 2023 436f 6e76 6572 7420  eRate) #Convert 
+00012310: 746f 2073 616d 706c 6573 0a20 2020 2077  to samples.    w
+00012320: 696e 646f 7773 5f73 616d 706c 6573 3d5b  indows_samples=[
+00012330: 5d0a 2020 2020 666f 7220 7472 2069 6e20  ].    for tr in 
+00012340: 7374 7265 616d 3a0a 2020 2020 2020 2020  stream:.        
+00012350: 746f 7461 6c53 616d 706c 6573 203d 206c  totalSamples = l
+00012360: 656e 2874 722e 6461 7461 292d 3123 666c  en(tr.data)-1#fl
+00012370: 6f61 7428 7472 2e73 7461 7473 2e65 6e64  oat(tr.stats.end
+00012380: 7469 6d65 202d 2074 722e 7374 6174 732e  time - tr.stats.
+00012390: 7374 6172 7474 696d 6529 202f 2074 722e  starttime) / tr.
+000123a0: 7374 6174 732e 6465 6c74 610a 2020 2020  stats.delta.    
+000123b0: 2020 2020 636f 6f6c 646f 776e 5f73 616d      cooldown_sam
+000123c0: 706c 6573 203d 2069 6e74 2874 6f74 616c  ples = int(total
+000123d0: 5361 6d70 6c65 7320 2d20 2863 6f6f 6c64  Samples - (coold
+000123e0: 6f77 6e5f 7469 6d65 202f 2073 616d 706c  own_time / sampl
+000123f0: 6552 6174 6529 2920 2343 6f6e 7665 7274  eRate)) #Convert
+00012400: 2074 6f20 7361 6d70 6c65 730a 2020 2020   to samples.    
+00012410: 7769 6e64 6f77 735f 7361 6d70 6c65 7320  windows_samples 
+00012420: 3d20 5b5b 302c 2077 6172 6d75 705f 7361  = [[0, warmup_sa
+00012430: 6d70 6c65 735d 2c5b 636f 6f6c 646f 776e  mples],[cooldown
+00012440: 5f73 616d 706c 6573 2c20 746f 7461 6c53  _samples, totalS
+00012450: 616d 706c 6573 5d5d 0a20 2020 2069 6620  amples]].    if 
+00012460: 636f 6f6c 646f 776e 5f74 696d 653d 3d30  cooldown_time==0
+00012470: 3a0a 2020 2020 2020 2020 7769 6e64 6f77  :.        window
+00012480: 735f 7361 6d70 6c65 732e 706f 7028 3129  s_samples.pop(1)
+00012490: 0a20 2020 2069 6620 7761 726d 7570 5f74  .    if warmup_t
+000124a0: 696d 653d 3d30 3a0a 2020 2020 2020 2020  ime==0:.        
+000124b0: 7769 6e64 6f77 735f 7361 6d70 6c65 732e  windows_samples.
+000124c0: 706f 7028 3029 0a0a 2020 2020 6966 2077  pop(0)..    if w
+000124d0: 696e 646f 7773 5f73 616d 706c 6573 203d  indows_samples =
+000124e0: 3d20 5b5d 3a0a 2020 2020 2020 2020 7061  = []:.        pa
+000124f0: 7373 0a20 2020 2065 6c73 653a 0a20 2020  ss.    else:.   
+00012500: 2020 2020 2073 7461 7274 5420 3d20 7374       startT = st
+00012510: 7265 616d 5b30 5d2e 7374 6174 732e 7374  ream[0].stats.st
+00012520: 6172 7474 696d 650a 2020 2020 2020 2020  arttime.        
+00012530: 656e 6454 203d 2073 7472 6561 6d5b 305d  endT = stream[0]
+00012540: 2e73 7461 7473 2e65 6e64 7469 6d65 0a20  .stats.endtime. 
+00012550: 2020 2020 2020 2077 696e 646f 775f 5554         window_UT
+00012560: 4320 3d20 5b5d 0a20 2020 2020 2020 2077  C = [].        w
+00012570: 696e 646f 775f 4d50 4c20 3d20 5b5d 0a20  indow_MPL = []. 
+00012580: 2020 2020 2020 2077 696e 646f 775f 5554         window_UT
+00012590: 432e 6170 7065 6e64 285b 7374 6172 7454  C.append([startT
+000125a0: 2c20 7374 6172 7454 5d29 0a0a 2020 2020  , startT])..    
+000125b0: 2020 2020 666f 7220 772c 2077 696e 2069      for w, win i
+000125c0: 6e20 656e 756d 6572 6174 6528 7769 6e64  n enumerate(wind
+000125d0: 6f77 735f 7361 6d70 6c65 7329 3a0a 2020  ows_samples):.  
+000125e0: 2020 2020 2020 2020 2020 666f 7220 6a2c            for j,
+000125f0: 2074 6d20 696e 2065 6e75 6d65 7261 7465   tm in enumerate
+00012600: 2877 696e 293a 0a0a 2020 2020 2020 2020  (win):..        
+00012610: 2020 2020 2020 2020 6966 206a 203d 3d20          if j == 
+00012620: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00012630: 2020 2020 2020 2077 696e 646f 775f 5554         window_UT
+00012640: 432e 6170 7065 6e64 285b 5d29 0a20 2020  C.append([]).   
+00012650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012660: 2077 696e 646f 775f 4d50 4c2e 6170 7065   window_MPL.appe
+00012670: 6e64 285b 5d29 0a20 2020 2020 2020 2020  nd([]).         
+00012680: 2020 2020 2020 2074 5365 6320 3d20 746d         tSec = tm
+00012690: 202a 2073 616d 706c 6552 6174 650a 2020   * sampleRate.  
+000126a0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+000126b0: 6e64 6f77 5f55 5443 5b77 2b31 5d2e 6170  ndow_UTC[w+1].ap
+000126c0: 7065 6e64 2873 7461 7274 542b 7453 6563  pend(startT+tSec
+000126d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000126e0: 2020 7769 6e64 6f77 5f4d 504c 5b77 5d2e    window_MPL[w].
+000126f0: 6170 7065 6e64 2877 696e 646f 775f 5554  append(window_UT
+00012700: 435b 775d 5b6a 5d2e 6d61 7470 6c6f 746c  C[w][j].matplotl
+00012710: 6962 5f64 6174 6529 0a20 2020 2020 2020  ib_date).       
+00012720: 2077 696e 646f 775f 5554 432e 6170 7065   window_UTC.appe
+00012730: 6e64 285b 656e 6454 2c20 656e 6454 5d29  nd([endT, endT])
+00012740: 0a0a 2020 2020 2020 2020 2377 696e 646f  ..        #windo
+00012750: 775f 4d50 4c5b 775d 2e61 7070 656e 6428  w_MPL[w].append(
+00012760: 7769 6e64 6f77 5f55 5443 5b77 5d5b 695d  window_UTC[w][i]
+00012770: 2e6d 6174 706c 6f74 6c69 625f 6461 7465  .matplotlib_date
+00012780: 290a 2020 2020 2020 2020 6f75 7453 7472  ).        outStr
+00012790: 6561 6d20 3d20 5f5f 7265 6d6f 7665 5f67  eam = __remove_g
+000127a0: 6170 7328 7374 7265 616d 2c20 7769 6e64  aps(stream, wind
+000127b0: 6f77 5f55 5443 290a 2020 2020 7265 7475  ow_UTC).    retu
+000127c0: 726e 206f 7574 5374 7265 616d 0a0a 2347  rn outStream..#G
+000127d0: 656e 6572 6174 6520 5050 5344 7320 666f  enerate PPSDs fo
+000127e0: 7220 6561 6368 2063 6861 6e6e 656c 0a23  r each channel.#
+000127f0: 6465 6620 6765 6e65 7261 7465 5f70 7073  def generate_pps
+00012800: 6473 2870 6172 616d 732c 2073 7472 6561  ds(params, strea
+00012810: 6d2c 2070 7073 645f 6c65 6e67 7468 3d36  m, ppsd_length=6
+00012820: 302c 202a 2a6b 7761 7267 7329 3a0a 6465  0, **kwargs):.de
+00012830: 6620 6765 6e65 7261 7465 5f70 7073 6473  f generate_ppsds
+00012840: 2870 6172 616d 732c 2072 656d 6f76 655f  (params, remove_
+00012850: 6f75 746c 6965 7273 3d54 7275 652c 206f  outliers=True, o
+00012860: 7574 6c69 6572 5f73 7464 3d33 2c20 7665  utlier_std=3, ve
+00012870: 7262 6f73 653d 4661 6c73 652c 202a 2a70  rbose=False, **p
+00012880: 7073 645f 6b77 6172 6773 293a 0a20 2020  psd_kwargs):.   
+00012890: 2022 2222 4765 6e65 7261 7465 7320 5050   """Generates PP
+000128a0: 5344 7320 666f 7220 6561 6368 2063 6861  SDs for each cha
+000128b0: 6e6e 656c 0a0a 2020 2020 2020 2020 4368  nnel..        Ch
+000128c0: 616e 6e65 6c73 206e 6565 6420 746f 2062  annels need to b
+000128d0: 6520 696e 205a 2c20 4e2c 2045 206f 7264  e in Z, N, E ord
+000128e0: 6572 0a20 2020 2020 2020 2049 6e66 6f20  er.        Info 
+000128f0: 6f6e 2050 5053 4420 6372 6561 7469 6f6e  on PPSD creation
+00012900: 2068 6572 653a 2068 7474 7073 3a2f 2f64   here: https://d
+00012910: 6f63 732e 6f62 7370 792e 6f72 672f 7061  ocs.obspy.org/pa
+00012920: 636b 6167 6573 2f61 7574 6f67 656e 2f6f  ckages/autogen/o
+00012930: 6273 7079 2e73 6967 6e61 6c2e 7370 6563  bspy.signal.spec
+00012940: 7472 616c 5f65 7374 696d 6174 696f 6e2e  tral_estimation.
+00012950: 5050 5344 2e68 746d 6c0a 2020 2020 2020  PPSD.html.      
+00012960: 2020 0a20 2020 2020 2020 2050 6172 616d    .        Param
+00012970: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00012980: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00012990: 2070 6172 616d 7320 3a20 6469 6374 0a20   params : dict. 
+000129a0: 2020 2020 2020 2020 2020 2044 6963 7469             Dicti
+000129b0: 6f6e 6172 7920 636f 6e74 6169 6e69 6e67  onary containing
+000129c0: 2061 6c6c 2074 6865 2070 6172 616d 6574   all the paramet
+000129d0: 6572 7320 616e 6420 6f74 6865 7220 6461  ers and other da
+000129e0: 7461 206f 6620 696e 7465 7265 7374 2028  ta of interest (
+000129f0: 7374 7265 616d 2061 6e64 2070 617a 2c20  stream and paz, 
+00012a00: 666f 7220 6578 616d 706c 6529 0a20 2020  for example).   
+00012a10: 2020 2020 2072 656d 6f76 655f 6f75 746c       remove_outl
+00012a20: 6965 7273 203a 2062 6f6f 6c2c 2064 6566  iers : bool, def
+00012a30: 6175 6c74 3d54 7275 650a 2020 2020 2020  ault=True.      
+00012a40: 2020 2020 2020 5768 6574 6865 7220 746f        Whether to
+00012a50: 2072 656d 6f76 6520 6f75 746c 6965 7220   remove outlier 
+00012a60: 682f 7620 6375 7276 6573 2e20 5468 6973  h/v curves. This
+00012a70: 2069 7320 7265 636f 6d6d 656e 6465 642c   is recommended,
+00012a80: 2070 6172 7469 6375 6c61 726c 7920 6966   particularly if
+00012a90: 2072 656d 6f76 655f 6e6f 6973 6528 2920   remove_noise() 
+00012aa0: 6861 7320 6265 656e 2075 7365 642e 0a20  has been used.. 
+00012ab0: 2020 2020 2020 206f 7574 6c69 6572 5f73         outlier_s
+00012ac0: 7464 203a 2020 666c 6f61 742c 2064 6566  td :  float, def
+00012ad0: 6175 6c74 3d33 0a20 2020 2020 2020 2020  ault=3.         
+00012ae0: 2020 2054 6865 2073 7461 6e64 6172 6420     The standard 
+00012af0: 6465 7669 6174 696f 6e20 7661 6c75 6520  deviation value 
+00012b00: 746f 2075 7365 2061 7320 6120 7468 7265  to use as a thre
+00012b10: 7368 6f6c 6420 666f 7220 6465 7465 726d  shold for determ
+00012b20: 696e 696e 6720 7768 6574 6865 7220 6120  ining whether a 
+00012b30: 6375 7276 6520 6973 2061 6e20 6f75 746c  curve is an outl
+00012b40: 6965 722e 200a 2020 2020 2020 2020 2020  ier. .          
+00012b50: 2020 5468 6973 2061 7665 7261 6765 7320    This averages 
+00012b60: 6f76 6572 2074 6865 2065 6e74 6972 6520  over the entire 
+00012b70: 6375 7276 6520 736f 2074 6861 7420 6375  curve so that cu
+00012b80: 7276 6573 2077 6974 6820 7665 7279 2061  rves with very a
+00012b90: 6262 6572 616e 7420 6461 7461 2028 6f66  bberant data (of
+00012ba0: 7465 6e20 6f63 6375 7273 2077 6865 6e20  ten occurs when 
+00012bb0: 7573 696e 6720 7468 6520 7265 6d6f 7665  using the remove
+00012bc0: 5f6e 6f69 7365 2829 206d 6574 686f 6429  _noise() method)
+00012bd0: 2c20 6361 6e20 6265 2069 6465 6e74 6966  , can be identif
+00012be0: 6965 642e 0a20 2020 2020 2020 202a 2a6b  ied..        **k
+00012bf0: 7761 7267 7320 3a20 6469 6374 0a20 2020  wargs : dict.   
+00012c00: 2020 2020 2020 2020 2044 6963 7469 6f6e           Diction
+00012c10: 6172 7920 7769 7468 206b 6579 776f 7264  ary with keyword
+00012c20: 2061 7267 756d 656e 7473 2074 6861 7420   arguments that 
+00012c30: 6172 6520 7061 7373 6564 2064 6972 6563  are passed direc
+00012c40: 746c 7920 746f 206f 6273 7079 2e73 6967  tly to obspy.sig
+00012c50: 6e61 6c2e 5050 5344 2e0a 2020 2020 2020  nal.PPSD..      
+00012c60: 2020 2020 2020 4966 2074 6865 2066 6f6c        If the fol
+00012c70: 6c6f 7769 6e67 206b 6579 776f 7264 7320  lowing keywords 
+00012c80: 6172 6520 6e6f 7420 7370 6563 6966 6965  are not specifie
+00012c90: 642c 2074 6865 6972 2064 6566 6175 6c74  d, their default
+00012ca0: 7320 6172 6520 616d 656e 6465 6420 696e  s are amended in
+00012cb0: 2074 6869 7320 6675 6e63 7469 6f6e 2066   this function f
+00012cc0: 726f 6d20 7468 6520 6f62 7370 7920 6465  rom the obspy de
+00012cd0: 6661 756c 7473 2066 6f72 2069 7473 2050  faults for its P
+00012ce0: 5053 4420 6675 6e63 7469 6f6e 2e20 5370  PSD function. Sp
+00012cf0: 6563 6966 6963 616c 6c79 3a0a 2020 2020  ecifically:.    
+00012d00: 2020 2020 2020 2020 2020 2020 2d20 7070              - pp
+00012d10: 7364 5f6c 656e 6774 6820 6465 6661 756c  sd_length defaul
+00012d20: 7473 2074 6f20 3630 2028 7365 636f 6e64  ts to 60 (second
+00012d30: 7329 2068 6572 6520 696e 7374 6561 6420  s) here instead 
+00012d40: 6f66 2033 3630 300a 2020 2020 2020 2020  of 3600.        
+00012d50: 2020 2020 2020 2020 2d20 736b 6970 5f6f          - skip_o
+00012d60: 6e5f 6761 7073 2064 6566 6175 6c74 7320  n_gaps defaults 
+00012d70: 746f 2054 7275 6520 696e 7374 6561 6420  to True instead 
+00012d80: 6f66 2046 616c 7365 0a20 2020 2020 2020  of False.       
+00012d90: 2020 2020 2020 2020 202d 2070 6572 696f           - perio
+00012da0: 645f 7374 6570 5f6f 6374 6176 6573 2064  d_step_octaves d
+00012db0: 6566 6175 6c74 7320 746f 2030 2e30 3331  efaults to 0.031
+00012dc0: 3235 2069 6e73 7465 6164 206f 6620 302e  25 instead of 0.
+00012dd0: 3132 350a 0a20 2020 2020 2020 2052 6574  125..        Ret
+00012de0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+00012df0: 2d2d 2d2d 0a20 2020 2020 2020 2020 2020  ----.           
+00012e00: 2070 7073 6473 2020 203a 2020 2064 6963   ppsds   :   dic
+00012e10: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00012e20: 2020 4469 6374 696f 6e61 7279 2063 6f6e    Dictionary con
+00012e30: 7461 696e 696e 6720 656e 7472 6965 7320  taining entries 
+00012e40: 7769 7468 2070 7073 6473 2066 6f72 2065  with ppsds for e
+00012e50: 6163 6820 6368 616e 6e65 6c0a 2020 2020  ach channel.    
+00012e60: 2222 220a 2020 2020 7061 7a3d 7061 7261  """.    paz=para
+00012e70: 6d73 5b27 7061 7a27 5d0a 2020 2020 7374  ms['paz'].    st
+00012e80: 7265 616d 203d 2070 6172 616d 735b 2773  ream = params['s
+00012e90: 7472 6561 6d27 5d0a 0a20 2020 2023 5365  tream']..    #Se
+00012ea0: 7420 6465 6661 756c 7473 2068 6572 6520  t defaults here 
+00012eb0: 7468 6174 2061 7265 2064 6966 6665 7265  that are differe
+00012ec0: 6e74 2074 6861 6e20 6f62 7370 7920 6465  nt than obspy de
+00012ed0: 6661 756c 7473 0a20 2020 2069 6620 2770  faults.    if 'p
+00012ee0: 7073 645f 6c65 6e67 7468 2720 6e6f 7420  psd_length' not 
+00012ef0: 696e 2070 7073 645f 6b77 6172 6773 3a0a  in ppsd_kwargs:.
+00012f00: 2020 2020 2020 2020 7070 7364 5f6b 7761          ppsd_kwa
+00012f10: 7267 735b 2770 7073 645f 6c65 6e67 7468  rgs['ppsd_length
+00012f20: 275d 203d 2036 300a 2020 2020 6966 2027  '] = 60.    if '
+00012f30: 736b 6970 5f6f 6e5f 6761 7073 2720 6e6f  skip_on_gaps' no
+00012f40: 7420 696e 2070 7073 645f 6b77 6172 6773  t in ppsd_kwargs
+00012f50: 3a0a 2020 2020 2020 2020 7070 7364 5f6b  :.        ppsd_k
+00012f60: 7761 7267 735b 2773 6b69 705f 6f6e 5f67  wargs['skip_on_g
+00012f70: 6170 7327 5d20 3d20 5472 7565 0a20 2020  aps'] = True.   
+00012f80: 2069 6620 2770 6572 696f 645f 7374 6570   if 'period_step
+00012f90: 5f6f 6374 6176 6573 2720 6e6f 7420 696e  _octaves' not in
+00012fa0: 2070 7073 645f 6b77 6172 6773 3a0a 2020   ppsd_kwargs:.  
+00012fb0: 2020 2020 2020 7070 7364 5f6b 7761 7267        ppsd_kwarg
+00012fc0: 735b 2770 6572 696f 645f 7374 6570 5f6f  s['period_step_o
+00012fd0: 6374 6176 6573 275d 203d 2030 2e30 3331  ctaves'] = 0.031
+00012fe0: 3235 0a0a 2020 2020 6672 6f6d 206f 6273  25..    from obs
+00012ff0: 7079 2e73 6967 6e61 6c20 696d 706f 7274  py.signal import
+00013000: 2050 5053 440a 0a20 2020 2065 5374 7265   PPSD..    eStre
+00013010: 616d 203d 2073 7472 6561 6d2e 7365 6c65  am = stream.sele
+00013020: 6374 2863 6f6d 706f 6e65 6e74 3d27 4527  ct(component='E'
+00013030: 290a 2020 2020 6573 7461 7473 203d 2065  ).    estats = e
+00013040: 5374 7265 616d 2e74 7261 6365 735b 305d  Stream.traces[0]
+00013050: 2e73 7461 7473 0a20 2020 2070 7073 6445  .stats.    ppsdE
+00013060: 203d 2050 5053 4428 6573 7461 7473 2c20   = PPSD(estats, 
+00013070: 7061 7a5b 2745 275d 2c20 202a 2a70 7073  paz['E'],  **pps
+00013080: 645f 6b77 6172 6773 290a 2020 2020 2370  d_kwargs).    #p
+00013090: 7073 6445 203d 2050 5053 4428 7374 7265  psdE = PPSD(stre
+000130a0: 616d 2e73 656c 6563 7428 636f 6d70 6f6e  am.select(compon
+000130b0: 656e 743d 2745 2729 2e74 7261 6365 735b  ent='E').traces[
+000130c0: 305d 2e73 7461 7473 2c20 7061 7a5b 2745  0].stats, paz['E
+000130d0: 275d 2c20 7070 7364 5f6c 656e 6774 683d  '], ppsd_length=
+000130e0: 7070 7364 5f6c 656e 6774 682c 206b 7761  ppsd_length, kwa
+000130f0: 7267 733d 6b77 6172 6773 290a 2020 2020  rgs=kwargs).    
+00013100: 7070 7364 452e 6164 6428 7374 7265 616d  ppsdE.add(stream
+00013110: 2c20 7665 7262 6f73 653d 7665 7262 6f73  , verbose=verbos
+00013120: 6529 0a0a 2020 2020 6e53 7472 6561 6d20  e)..    nStream 
+00013130: 3d20 7374 7265 616d 2e73 656c 6563 7428  = stream.select(
+00013140: 636f 6d70 6f6e 656e 743d 274e 2729 0a20  component='N'). 
+00013150: 2020 206e 7374 6174 7320 3d20 6e53 7472     nstats = nStr
+00013160: 6561 6d2e 7472 6163 6573 5b30 5d2e 7374  eam.traces[0].st
+00013170: 6174 730a 2020 2020 7070 7364 4e20 3d20  ats.    ppsdN = 
+00013180: 5050 5344 286e 7374 6174 732c 2070 617a  PPSD(nstats, paz
+00013190: 5b27 4e27 5d2c 202a 2a70 7073 645f 6b77  ['N'], **ppsd_kw
+000131a0: 6172 6773 290a 2020 2020 7070 7364 4e2e  args).    ppsdN.
+000131b0: 6164 6428 7374 7265 616d 2c20 7665 7262  add(stream, verb
+000131c0: 6f73 653d 7665 7262 6f73 6529 0a0a 2020  ose=verbose)..  
+000131d0: 2020 7a53 7472 6561 6d20 3d20 7374 7265    zStream = stre
+000131e0: 616d 2e73 656c 6563 7428 636f 6d70 6f6e  am.select(compon
+000131f0: 656e 743d 275a 2729 0a20 2020 207a 7374  ent='Z').    zst
+00013200: 6174 7320 3d20 7a53 7472 6561 6d2e 7472  ats = zStream.tr
+00013210: 6163 6573 5b30 5d2e 7374 6174 730a 2020  aces[0].stats.  
+00013220: 2020 7070 7364 5a20 3d20 5050 5344 287a    ppsdZ = PPSD(z
+00013230: 7374 6174 732c 2070 617a 5b27 5a27 5d2c  stats, paz['Z'],
+00013240: 202a 2a70 7073 645f 6b77 6172 6773 290a   **ppsd_kwargs).
+00013250: 2020 2020 7070 7364 5a2e 6164 6428 7374      ppsdZ.add(st
+00013260: 7265 616d 2c20 7665 7262 6f73 653d 7665  ream, verbose=ve
+00013270: 7262 6f73 6529 0a0a 2020 2020 7070 7364  rbose)..    ppsd
+00013280: 7320 3d20 7b27 5a27 3a70 7073 645a 2c20  s = {'Z':ppsdZ, 
+00013290: 274e 273a 7070 7364 4e2c 2027 4527 3a70  'N':ppsdN, 'E':p
+000132a0: 7073 6445 7d0a 0a20 2020 2023 4164 6420  psdE}..    #Add 
+000132b0: 746f 2074 6865 2069 6e70 7574 2064 6963  to the input dic
+000132c0: 7469 6f6e 6172 792c 2073 6f20 7468 6174  tionary, so that
+000132d0: 2073 6f6d 6520 6974 656d 7320 6361 6e20   some items can 
+000132e0: 6265 206d 616e 6970 756c 6174 6564 206c  be manipulated l
+000132f0: 6174 6572 206f 6e2c 2061 6e64 206f 7269  ater on, and ori
+00013300: 6769 6e61 6c20 6361 6e20 6265 2073 6176  ginal can be sav
+00013310: 6564 0a20 2020 2070 6172 616d 735b 2770  ed.    params['p
+00013320: 7073 6473 5f6f 6273 7079 275d 203d 2070  psds_obspy'] = p
+00013330: 7073 6473 0a20 2020 2070 6172 616d 735b  psds.    params[
+00013340: 2770 7073 6473 275d 203d 207b 7d0a 2020  'ppsds'] = {}.  
+00013350: 2020 616e 794b 6579 203d 206c 6973 7428    anyKey = list(
+00013360: 7061 7261 6d73 5b27 7070 7364 735f 6f62  params['ppsds_ob
+00013370: 7370 7927 5d2e 6b65 7973 2829 295b 305d  spy'].keys())[0]
+00013380: 0a20 2020 200a 2020 2020 2347 6574 2070  .    .    #Get p
+00013390: 7073 6420 636c 6173 7320 6d65 6d62 6572  psd class member
+000133a0: 730a 2020 2020 6d65 6d62 6572 7320 3d20  s.    members = 
+000133b0: 5b6d 656d 7320 666f 7220 6d65 6d73 2069  [mems for mems i
+000133c0: 6e20 6469 7228 7061 7261 6d73 5b27 7070  n dir(params['pp
+000133d0: 7364 735f 6f62 7370 7927 5d5b 616e 794b  sds_obspy'][anyK
+000133e0: 6579 5d29 2069 6620 6e6f 7420 6361 6c6c  ey]) if not call
+000133f0: 6162 6c65 286d 656d 7329 2061 6e64 206e  able(mems) and n
+00013400: 6f74 206d 656d 732e 7374 6172 7473 7769  ot mems.startswi
+00013410: 7468 2822 5f22 295d 0a20 2020 2070 6172  th("_")].    par
+00013420: 616d 735b 2770 7073 6473 275d 5b27 5a27  ams['ppsds']['Z'
+00013430: 5d20 3d20 7b7d 0a20 2020 2070 6172 616d  ] = {}.    param
+00013440: 735b 2770 7073 6473 275d 5b27 4527 5d20  s['ppsds']['E'] 
+00013450: 3d20 7b7d 0a20 2020 2070 6172 616d 735b  = {}.    params[
+00013460: 2770 7073 6473 275d 5b27 4e27 5d20 3d20  'ppsds']['N'] = 
+00013470: 7b7d 0a20 2020 200a 2020 2020 2347 6574  {}.    .    #Get
+00013480: 206c 6973 7473 2074 6861 7420 7765 206d   lists that we m
+00013490: 6179 206e 6565 6420 746f 206d 616e 6970  ay need to manip
+000134a0: 756c 6174 6520 6c61 7465 7220 616e 6420  ulate later and 
+000134b0: 636f 7079 2065 7665 7279 7468 696e 6720  copy everything 
+000134c0: 6f76 6572 2074 6f20 6d61 696e 2027 7070  over to main 'pp
+000134d0: 7364 7327 2073 7562 6469 6374 696f 6e61  sds' subdictiona
+000134e0: 7279 2028 636f 6e76 6572 7420 6c69 7374  ry (convert list
+000134f0: 7320 746f 206e 702e 6172 7261 7973 2066  s to np.arrays f
+00013500: 6f72 2063 6f6e 7369 7374 656e 6379 290a  or consistency).
+00013510: 2020 2020 6c69 7374 4c69 7374 203d 205b      listList = [
+00013520: 2774 696d 6573 5f64 6174 6127 2c20 2774  'times_data', 't
+00013530: 696d 6573 5f67 6170 7327 2c20 2774 696d  imes_gaps', 'tim
+00013540: 6573 5f70 726f 6365 7373 6564 272c 2763  es_processed','c
+00013550: 7572 7265 6e74 5f74 696d 6573 5f75 7365  urrent_times_use
+00013560: 6427 2c20 2770 7364 5f76 616c 7565 7327  d', 'psd_values'
+00013570: 5d0a 2020 2020 666f 7220 6d20 696e 206d  ].    for m in m
+00013580: 656d 6265 7273 3a0a 2020 2020 2020 2020  embers:.        
+00013590: 7061 7261 6d73 5b27 7070 7364 7327 5d5b  params['ppsds'][
+000135a0: 275a 275d 5b6d 5d20 3d20 6765 7461 7474  'Z'][m] = getatt
+000135b0: 7228 7061 7261 6d73 5b27 7070 7364 735f  r(params['ppsds_
+000135c0: 6f62 7370 7927 5d5b 275a 275d 2c20 6d29  obspy']['Z'], m)
+000135d0: 0a20 2020 2020 2020 2070 6172 616d 735b  .        params[
+000135e0: 2770 7073 6473 275d 5b27 4527 5d5b 6d5d  'ppsds']['E'][m]
+000135f0: 203d 2067 6574 6174 7472 2870 6172 616d   = getattr(param
+00013600: 735b 2770 7073 6473 5f6f 6273 7079 275d  s['ppsds_obspy']
+00013610: 5b27 4527 5d2c 206d 290a 2020 2020 2020  ['E'], m).      
+00013620: 2020 7061 7261 6d73 5b27 7070 7364 7327    params['ppsds'
+00013630: 5d5b 274e 275d 5b6d 5d20 3d20 6765 7461  ]['N'][m] = geta
+00013640: 7474 7228 7061 7261 6d73 5b27 7070 7364  ttr(params['ppsd
+00013650: 735f 6f62 7370 7927 5d5b 274e 275d 2c20  s_obspy']['N'], 
+00013660: 6d29 0a20 2020 2020 2020 2069 6620 6d20  m).        if m 
+00013670: 696e 206c 6973 744c 6973 743a 0a20 2020  in listList:.   
+00013680: 2020 2020 2020 2020 2070 6172 616d 735b           params[
+00013690: 2770 7073 6473 275d 5b27 5a27 5d5b 6d5d  'ppsds']['Z'][m]
+000136a0: 203d 206e 702e 6172 7261 7928 7061 7261   = np.array(para
+000136b0: 6d73 5b27 7070 7364 7327 5d5b 275a 275d  ms['ppsds']['Z']
+000136c0: 5b6d 5d29 0a20 2020 2020 2020 2020 2020  [m]).           
+000136d0: 2070 6172 616d 735b 2770 7073 6473 275d   params['ppsds']
+000136e0: 5b27 4527 5d5b 6d5d 203d 206e 702e 6172  ['E'][m] = np.ar
+000136f0: 7261 7928 7061 7261 6d73 5b27 7070 7364  ray(params['ppsd
+00013700: 7327 5d5b 2745 275d 5b6d 5d29 0a20 2020  s']['E'][m]).   
+00013710: 2020 2020 2020 2020 2070 6172 616d 735b           params[
+00013720: 2770 7073 6473 275d 5b27 4e27 5d5b 6d5d  'ppsds']['N'][m]
+00013730: 203d 206e 702e 6172 7261 7928 7061 7261   = np.array(para
+00013740: 6d73 5b27 7070 7364 7327 5d5b 274e 275d  ms['ppsds']['N']
+00013750: 5b6d 5d29 0a0a 2020 2020 2343 7265 6174  [m])..    #Creat
+00013760: 6520 6469 6374 2065 6e74 7279 2074 6f20  e dict entry to 
+00013770: 6b65 6570 2074 7261 636b 206f 6620 686f  keep track of ho
+00013780: 7720 6d61 6e79 206f 7574 6c69 6572 2068  w many outlier h
+00013790: 7673 7220 6375 7276 6573 2061 7265 2072  vsr curves are r
+000137a0: 656d 6f76 6564 2028 322d 6974 656d 206c  emoved (2-item l
+000137b0: 6973 7420 7769 7468 205b 305d 3d63 7572  ist with [0]=cur
+000137c0: 7265 6e74 206e 756d 6265 722c 205b 315d  rent number, [1]
+000137d0: 3d6f 7269 6769 6e61 6c20 6e75 6d62 6572  =original number
+000137e0: 206f 6620 6375 7276 6573 290a 2020 2020   of curves).    
+000137f0: 7061 7261 6d73 5b27 7473 7465 7073 5f75  params['tsteps_u
+00013800: 7365 6427 5d20 3d20 5b70 6172 616d 735b  sed'] = [params[
+00013810: 2770 7073 6473 275d 5b27 5a27 5d5b 2774  'ppsds']['Z']['t
+00013820: 696d 6573 5f70 726f 6365 7373 6564 275d  imes_processed']
+00013830: 2e73 6861 7065 5b30 5d2c 2070 6172 616d  .shape[0], param
+00013840: 735b 2770 7073 6473 275d 5b27 5a27 5d5b  s['ppsds']['Z'][
+00013850: 2774 696d 6573 5f70 726f 6365 7373 6564  'times_processed
+00013860: 275d 2e73 6861 7065 5b30 5d5d 0a20 2020  '].shape[0]].   
+00013870: 200a 2020 2020 2352 656d 6f76 6520 6f75   .    #Remove ou
+00013880: 746c 6965 7220 7070 7364 7320 2874 686f  tlier ppsds (tho
+00013890: 7365 2064 6572 6976 6564 2066 726f 6d20  se derived from 
+000138a0: 6461 7461 2077 6974 6869 6e20 7468 6520  data within the 
+000138b0: 7769 6e64 6f77 7320 746f 2062 6520 7265  windows to be re
+000138c0: 6d6f 7665 6429 0a20 2020 2069 6620 7265  moved).    if re
+000138d0: 6d6f 7665 5f6f 7574 6c69 6572 7320 616e  move_outliers an
+000138e0: 6420 2778 7769 6e64 6f77 735f 6f75 7427  d 'xwindows_out'
+000138f0: 2069 6e20 7061 7261 6d73 2e6b 6579 7328   in params.keys(
+00013900: 293a 0a20 2020 2020 2020 2070 6172 616d  ):.        param
+00013910: 7320 3d20 7265 6d6f 7665 5f6f 7574 6c69  s = remove_outli
+00013920: 6572 5f70 7073 6473 2870 6172 616d 732c  er_ppsds(params,
+00013930: 206f 7574 6c69 6572 5f73 7464 3d6f 7574   outlier_std=out
+00013940: 6c69 6572 5f73 7464 2c20 7070 7364 5f6c  lier_std, ppsd_l
+00013950: 656e 6774 683d 7070 7364 5f6b 7761 7267  ength=ppsd_kwarg
+00013960: 735b 2770 7073 645f 6c65 6e67 7468 275d  s['ppsd_length']
+00013970: 290a 2020 2020 7061 7261 6d73 5b27 7473  ).    params['ts
+00013980: 7465 7073 5f75 7365 6427 5d5b 305d 203d  teps_used'][0] =
+00013990: 2070 6172 616d 735b 2770 7073 6473 275d   params['ppsds']
+000139a0: 5b27 5a27 5d5b 2763 7572 7265 6e74 5f74  ['Z']['current_t
+000139b0: 696d 6573 5f75 7365 6427 5d2e 7368 6170  imes_used'].shap
+000139c0: 655b 305d 0a20 2020 200a 2020 2020 7265  e[0].    .    re
+000139d0: 7475 726e 2070 6172 616d 730a 0a23 5265  turn params..#Re
+000139e0: 6d6f 7665 206f 7574 6c69 6572 2070 7073  move outlier pps
+000139f0: 6473 0a64 6566 2072 656d 6f76 655f 6f75  ds.def remove_ou
+00013a00: 746c 6965 725f 7070 7364 7328 7061 7261  tlier_ppsds(para
+00013a10: 6d73 2c20 6f75 746c 6965 725f 7374 643d  ms, outlier_std=
+00013a20: 332c 2070 7073 645f 6c65 6e67 7468 3d36  3, ppsd_length=6
+00013a30: 3029 3a0a 2020 2020 2222 2246 756e 6374  0):.    """Funct
+00013a40: 696f 6e20 7573 6564 2069 6e20 6765 6e65  ion used in gene
+00013a50: 7261 7465 5f70 7073 6473 2829 2074 6f20  rate_ppsds() to 
+00013a60: 7265 6d6f 7665 206f 7574 6c69 6572 732e  remove outliers.
+00013a70: 204d 6179 2061 6c73 6f20 6265 2075 7365   May also be use
+00013a80: 6420 696e 6465 7065 6e64 656e 746c 792e  d independently.
+00013a90: 0a20 2020 200a 2020 2020 5468 6973 2075  .    .    This u
+00013aa0: 7365 7320 7468 6520 6d65 616e 2076 616c  ses the mean val
+00013ab0: 7565 206f 6620 7468 6520 656e 7469 7265  ue of the entire
+00013ac0: 7479 206f 6620 6561 6368 2070 7073 6420  ty of each ppsd 
+00013ad0: 6375 7276 652e 2054 6869 7320 6973 206e  curve. This is n
+00013ae0: 6f74 2076 6572 7920 726f 6275 7374 2c20  ot very robust, 
+00013af0: 6275 7420 6974 2069 7320 696e 7465 6e64  but it is intend
+00013b00: 6564 206f 6e6c 7920 746f 2072 656d 6f76  ed only to remov
+00013b10: 6520 6375 7276 6573 2077 686f 2061 7265  e curves who are
+00013b20: 2077 656c 6c20 6f75 7473 6964 6520 6f66   well outside of
+00013b30: 2074 6865 2077 6861 7420 776f 756c 6420   the what would 
+00013b40: 6265 2065 7870 6563 7465 642e 0a20 2020  be expected..   
+00013b50: 2054 6865 7365 2061 6262 6572 616e 7420   These abberant 
+00013b60: 6375 7276 6573 206f 6674 656e 206f 6363  curves often occ
+00013b70: 7572 2064 7565 2074 6f20 7468 6520 7265  ur due to the re
+00013b80: 6d6f 7665 5f6e 6f69 7365 2829 2066 756e  move_noise() fun
+00013b90: 6374 696f 6e2e 0a0a 2020 2020 5061 7261  ction...    Para
+00013ba0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+00013bb0: 2d2d 2d2d 2d0a 2020 2020 7061 7261 6d73  -----.    params
+00013bc0: 203a 2064 6963 740a 2020 2020 2020 2020   : dict.        
+00013bd0: 496e 7075 7420 6469 6374 696f 6e61 7279  Input dictionary
+00013be0: 2063 6f6e 7461 696e 696e 6720 616c 6c20   containing all 
+00013bf0: 7468 6520 7661 6c75 6573 2061 6e64 2070  the values and p
+00013c00: 6172 616d 6574 6572 7320 6f66 2069 6e74  arameters of int
+00013c10: 6572 6573 740a 2020 2020 6f75 746c 6965  erest.    outlie
+00013c20: 725f 7374 6420 3a20 2066 6c6f 6174 2c20  r_std :  float, 
+00013c30: 6465 6661 756c 743d 330a 2020 2020 2020  default=3.      
+00013c40: 2020 5468 6520 7374 616e 6461 7264 2064    The standard d
+00013c50: 6576 6961 7469 6f6e 2076 616c 7565 2074  eviation value t
+00013c60: 6f20 7573 6520 6173 2061 2074 6872 6573  o use as a thres
+00013c70: 686f 6c64 2066 6f72 2064 6574 6572 6d69  hold for determi
+00013c80: 6e69 6e67 2077 6865 7468 6572 2061 2063  ning whether a c
+00013c90: 7572 7665 2069 7320 616e 206f 7574 6c69  urve is an outli
+00013ca0: 6572 2e20 0a20 2020 2020 2020 2054 6869  er. .        Thi
+00013cb0: 7320 6176 6572 6167 6573 206f 7665 7220  s averages over 
+00013cc0: 7468 6520 656e 7469 7265 2063 7572 7665  the entire curve
+00013cd0: 2073 6f20 7468 6174 2063 7572 7665 7320   so that curves 
+00013ce0: 7769 7468 2076 6572 7920 6162 6265 7261  with very abbera
+00013cf0: 6e74 2064 6174 6120 286f 6674 656e 206f  nt data (often o
+00013d00: 6363 7572 7320 7768 656e 2075 7369 6e67  ccurs when using
+00013d10: 2074 6865 2072 656d 6f76 655f 6e6f 6973   the remove_nois
+00013d20: 6528 2920 6d65 7468 6f64 292c 2063 616e  e() method), can
+00013d30: 2062 6520 6964 656e 7469 6669 6564 2e0a   be identified..
+00013d40: 2020 2020 7070 7364 5f6c 656e 6774 6820      ppsd_length 
+00013d50: 3a20 666c 6f61 742c 206f 7074 696f 6e61  : float, optiona
+00013d60: 6c0a 2020 2020 2020 2020 4c65 6e67 7468  l.        Length
+00013d70: 206f 6620 6461 7461 2073 6567 6d65 6e74   of data segment
+00013d80: 7320 7061 7373 6564 2074 6f20 7073 6420  s passed to psd 
+00013d90: 696e 2073 6563 6f6e 6473 2c20 6279 2064  in seconds, by d
+00013da0: 6566 6175 6c74 2036 302e 0a0a 2020 2020  efault 60...    
+00013db0: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
+00013dc0: 2d2d 2d0a 2020 2020 7061 7261 6d73 203a  ---.    params :
+00013dd0: 2064 6963 740a 2020 2020 2020 2020 496e   dict.        In
+00013de0: 7075 7420 6469 6374 696f 6e61 7279 2077  put dictionary w
+00013df0: 6974 6820 7661 6c75 6573 206d 6f64 6966  ith values modif
+00013e00: 6965 6420 6261 7365 6420 6f6e 2077 6f72  ied based on wor
+00013e10: 6b20 6f66 2066 756e 6374 696f 6e2e 0a20  k of function.. 
+00013e20: 2020 2022 2222 0a20 2020 200a 2020 2020     """.    .    
+00013e30: 7070 7364 7320 3d20 7061 7261 6d73 5b27  ppsds = params['
+00013e40: 7070 7364 7327 5d0a 2020 2020 6e65 7750  ppsds'].    newP
+00013e50: 5073 6473 203d 207b 7d0a 2020 2020 7374  Psds = {}.    st
+00013e60: 6473 203d 207b 7d0a 2020 2020 7073 6473  ds = {}.    psds
+00013e70: 5f74 6f5f 7269 6420 3d20 5b5d 0a0a 0a20  _to_rid = []... 
+00013e80: 2020 2066 6f72 206b 2069 6e20 7070 7364     for k in ppsd
+00013e90: 733a 0a20 2020 2020 2020 2070 7364 5661  s:.        psdVa
+00013ea0: 6c73 203d 206e 702e 6172 7261 7928 7070  ls = np.array(pp
+00013eb0: 7364 735b 6b5d 5b27 7073 645f 7661 6c75  sds[k]['psd_valu
+00013ec0: 6573 275d 290a 2020 2020 2020 2020 6d65  es']).        me
+00013ed0: 616e 4172 7220 3d20 6e70 2e6e 616e 6d65  anArr = np.nanme
+00013ee0: 616e 2870 7364 5661 6c73 2c20 6178 6973  an(psdVals, axis
+00013ef0: 3d31 290a 2020 2020 2020 2020 6e65 7750  =1).        newP
+00013f00: 5073 6473 5b6b 5d20 3d20 5b5d 0a20 2020  Psds[k] = [].   
+00013f10: 2020 2020 2074 6f74 4d65 616e 203d 206e       totMean = n
+00013f20: 702e 6e61 6e6d 6561 6e28 6d65 616e 4172  p.nanmean(meanAr
+00013f30: 7229 0a20 2020 2020 2020 2073 7464 735b  r).        stds[
+00013f40: 6b5d 203d 206e 702e 7374 6428 6d65 616e  k] = np.std(mean
+00013f50: 4172 7229 0a0a 2020 2020 2020 2020 666f  Arr)..        fo
+00013f60: 7220 692c 206d 2069 6e20 656e 756d 6572  r i, m in enumer
+00013f70: 6174 6528 6d65 616e 4172 7229 3a0a 2020  ate(meanArr):.  
+00013f80: 2020 2020 2020 2020 2020 6966 206d 203e            if m >
+00013f90: 2074 6f74 4d65 616e 202b 206f 7574 6c69   totMean + outli
+00013fa0: 6572 5f73 7464 2a73 7464 735b 6b5d 206f  er_std*stds[k] o
+00013fb0: 7220 6d20 3c20 746f 744d 6561 6e20 2d20  r m < totMean - 
+00013fc0: 6f75 746c 6965 725f 7374 642a 7374 6473  outlier_std*stds
+00013fd0: 5b6b 5d3a 0a20 2020 2020 2020 2020 2020  [k]:.           
+00013fe0: 2020 2020 2070 7364 735f 746f 5f72 6964       psds_to_rid
+00013ff0: 2e61 7070 656e 6428 6929 0a0a 2020 2020  .append(i)..    
+00014000: 2020 2020 6375 7272 5f74 696d 6573 5f6d      curr_times_m
+00014010: 706c 203d 205b 5d0a 2020 2020 2020 2020  pl = [].        
+00014020: 666f 7220 692c 2074 2069 6e20 656e 756d  for i, t in enum
+00014030: 6572 6174 6528 7070 7364 735b 6b5d 5b27  erate(ppsds[k]['
+00014040: 6375 7272 656e 745f 7469 6d65 735f 7573  current_times_us
+00014050: 6564 275d 293a 0a20 2020 2020 2020 2020  ed']):.         
+00014060: 2020 2063 7572 725f 7469 6d65 735f 6d70     curr_times_mp
+00014070: 6c2e 6170 7065 6e64 2874 2e6d 6174 706c  l.append(t.matpl
+00014080: 6f74 6c69 625f 6461 7465 290a 0a20 2020  otlib_date)..   
+00014090: 2020 2020 2023 4765 7420 7070 7364 206c       #Get ppsd l
+000140a0: 656e 6774 6820 696e 2073 6563 6f6e 6473  ength in seconds
+000140b0: 2069 6e20 6d61 7470 6c6f 746c 6962 2066   in matplotlib f
+000140c0: 6f72 6d61 740a 2020 2020 2020 2020 7070  ormat.        pp
+000140d0: 7364 5f6c 656e 6774 685f 6d70 6c20 3d20  sd_length_mpl = 
+000140e0: 7070 7364 5f6c 656e 6774 682f 3836 3430  ppsd_length/8640
+000140f0: 300a 0a20 2020 2020 2020 2023 2355 5044  0..        ##UPD
+00014100: 4154 4520 5448 4953 204e 4f54 2054 4f20  ATE THIS NOT TO 
+00014110: 5553 4520 7857 696e 646f 7773 5f6f 7574  USE xWindows_out
+00014120: 2028 6361 6c63 756c 6174 6520 6672 6f6d   (calculate from
+00014130: 206d 6173 6b29 0a20 2020 2020 2020 2023   mask).        #
+00014140: 4368 6563 6b20 6966 2061 6e79 2074 696d  Check if any tim
+00014150: 6573 2066 616c 6c20 696e 2065 7863 6c75  es fall in exclu
+00014160: 6465 6420 7a6f 6e65 0a20 2020 2020 2020  ded zone.       
+00014170: 2066 6f72 2069 2c20 7420 696e 2065 6e75   for i, t in enu
+00014180: 6d65 7261 7465 2863 7572 725f 7469 6d65  merate(curr_time
+00014190: 735f 6d70 6c29 3a0a 2020 2020 2020 2020  s_mpl):.        
+000141a0: 2020 2020 6e65 7874 5420 3d20 7420 2b20      nextT = t + 
+000141b0: 7070 7364 5f6c 656e 6774 685f 6d70 6c0a  ppsd_length_mpl.
+000141c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000141d0: 772c 2077 696e 2069 6e20 656e 756d 6572  w, win in enumer
+000141e0: 6174 6528 7061 7261 6d73 5b27 7877 696e  ate(params['xwin
+000141f0: 646f 7773 5f6f 7574 275d 293a 0a20 2020  dows_out']):.   
+00014200: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00014210: 7420 3e20 7769 6e5b 305d 2061 6e64 2074  t > win[0] and t
+00014220: 203c 2077 696e 5b31 5d3a 0a20 2020 2020   < win[1]:.     
+00014230: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00014240: 7364 735f 746f 5f72 6964 2e61 7070 656e  sds_to_rid.appen
+00014250: 6428 6929 0a20 2020 2020 2020 2020 2020  d(i).           
+00014260: 2020 2020 2065 6c69 6620 6e65 7874 5420       elif nextT 
+00014270: 3e20 7769 6e5b 305d 2061 6e64 206e 6578  > win[0] and nex
+00014280: 7454 203c 2077 696e 5b31 5d3a 0a20 2020  tT < win[1]:.   
+00014290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142a0: 2070 7364 735f 746f 5f72 6964 2e61 7070   psds_to_rid.app
+000142b0: 656e 6428 6929 0a20 2020 200a 2020 2020  end(i).    .    
+000142c0: 7073 6473 5f74 6f5f 7269 6420 3d20 6e70  psds_to_rid = np
+000142d0: 2e75 6e69 7175 6528 7073 6473 5f74 6f5f  .unique(psds_to_
+000142e0: 7269 6429 0a0a 2020 2020 666f 7220 6b20  rid)..    for k 
+000142f0: 696e 2070 6172 616d 735b 2770 7073 6473  in params['ppsds
+00014300: 275d 3a0a 2020 2020 2020 2020 666f 7220  ']:.        for 
+00014310: 692c 2072 2069 6e20 656e 756d 6572 6174  i, r in enumerat
+00014320: 6528 7073 6473 5f74 6f5f 7269 6429 3a0a  e(psds_to_rid):.
+00014330: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+00014340: 7820 3d20 696e 7428 722d 6929 0a20 2020  x = int(r-i).   
+00014350: 2020 2020 2020 2020 2070 6172 616d 735b           params[
+00014360: 2770 7073 6473 275d 5b6b 5d5b 2770 7364  'ppsds'][k]['psd
+00014370: 5f76 616c 7565 7327 5d20 3d20 6e70 2e64  _values'] = np.d
+00014380: 656c 6574 6528 7061 7261 6d73 5b27 7070  elete(params['pp
+00014390: 7364 7327 5d5b 6b5d 5b27 7073 645f 7661  sds'][k]['psd_va
+000143a0: 6c75 6573 275d 2c20 696e 6465 782c 2061  lues'], index, a
+000143b0: 7869 733d 3029 0a20 2020 2020 2020 2020  xis=0).         
+000143c0: 2020 2070 6172 616d 735b 2770 7073 6473     params['ppsds
+000143d0: 275d 5b6b 5d5b 2763 7572 7265 6e74 5f74  '][k]['current_t
+000143e0: 696d 6573 5f75 7365 6427 5d20 3d20 6e70  imes_used'] = np
+000143f0: 2e64 656c 6574 6528 7061 7261 6d73 5b27  .delete(params['
+00014400: 7070 7364 7327 5d5b 6b5d 5b27 6375 7272  ppsds'][k]['curr
+00014410: 656e 745f 7469 6d65 735f 7573 6564 275d  ent_times_used']
+00014420: 2c20 696e 6465 782c 2061 7869 733d 3029  , index, axis=0)
+00014430: 0a20 2020 2072 6574 7572 6e20 7061 7261  .    return para
+00014440: 6d73 0a0a 2343 6865 636b 2074 6865 2078  ms..#Check the x
+00014450: 2d76 616c 7565 7320 666f 7220 6561 6368  -values for each
+00014460: 2063 6861 6e6e 656c 2c20 746f 206d 616b   channel, to mak
+00014470: 6520 7375 7265 2074 6865 7920 6172 6520  e sure they are 
+00014480: 616c 6c20 7468 6520 7361 6d65 206c 656e  all the same len
+00014490: 6774 680a 6465 6620 5f5f 6368 6563 6b5f  gth.def __check_
+000144a0: 7876 616c 7565 7328 7070 7364 7329 3a0a  xvalues(ppsds):.
+000144b0: 2020 2020 2222 2243 6865 636b 2078 5f76      """Check x_v
+000144c0: 616c 7565 7320 6f66 2050 5053 4453 2074  alues of PPSDS t
+000144d0: 6f20 6d61 6b65 2073 7572 6520 7468 6579  o make sure they
+000144e0: 2061 7265 2061 6c6c 2074 6865 2073 616d   are all the sam
+000144f0: 6520 6c65 6e67 7468 2222 220a 2020 2020  e length""".    
+00014500: 784c 656e 6774 6873 203d 205b 5d0a 2020  xLengths = [].  
+00014510: 2020 666f 7220 6b20 696e 2070 7073 6473    for k in ppsds
+00014520: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
+00014530: 2078 4c65 6e67 7468 732e 6170 7065 6e64   xLengths.append
+00014540: 286c 656e 2870 7073 6473 5b6b 5d5b 2770  (len(ppsds[k]['p
+00014550: 6572 696f 645f 6269 6e5f 6365 6e74 6572  eriod_bin_center
+00014560: 7327 5d29 290a 2020 2020 6966 206c 656e  s'])).    if len
+00014570: 2873 6574 2878 4c65 6e67 7468 7329 2920  (set(xLengths)) 
+00014580: 3c3d 2031 3a0a 2020 2020 2020 2020 7061  <= 1:.        pa
+00014590: 7373 2023 5468 6973 206d 6561 6e73 2061  ss #This means a
+000145a0: 6c6c 2063 6861 6e6e 656c 7320 6861 7665  ll channels have
+000145b0: 2073 616d 6520 6e75 6d62 6572 206f 6620   same number of 
+000145c0: 7065 7269 6f64 5f62 696e 5f63 656e 7465  period_bin_cente
+000145d0: 7273 0a20 2020 2065 6c73 653a 0a20 2020  rs.    else:.   
+000145e0: 2020 2020 2070 7269 6e74 2827 582d 7661       print('X-va
+000145f0: 6c75 6573 2028 7065 7269 6f64 7320 6f72  lues (periods or
+00014600: 2066 7265 7175 656e 6369 6573 2920 646f   frequencies) do
+00014610: 206e 6f74 2068 6176 6520 7468 6520 7361   not have the sa
+00014620: 6d65 2076 616c 7565 732e 205c 6e20 5468  me values. \n Th
+00014630: 6973 206d 6179 2072 6573 756c 7420 696e  is may result in
+00014640: 2063 6f6d 7075 7461 7469 6f6e 616c 2065   computational e
+00014650: 7272 6f72 7327 290a 2020 2020 2020 2020  rrors').        
+00014660: 2344 6f20 7374 7566 6620 746f 2066 6978  #Do stuff to fix
+00014670: 2069 743f 0a20 2020 2072 6574 7572 6e20   it?.    return 
+00014680: 7070 7364 730a 0a23 4368 6563 6b20 746f  ppsds..#Check to
+00014690: 206d 616b 6520 7468 6520 6e75 6d62 6572   make the number
+000146a0: 206f 6620 7469 6d65 2d73 7465 7073 2061   of time-steps a
+000146b0: 7265 2074 6865 2073 616d 6520 666f 7220  re the same for 
+000146c0: 6561 6368 2063 6861 6e6e 656c 0a64 6566  each channel.def
+000146d0: 205f 5f63 6865 636b 5f74 7374 6570 7328   __check_tsteps(
+000146e0: 6876 7372 5f64 6963 7429 3a0a 2020 2020  hvsr_dict):.    
+000146f0: 2222 2243 6865 636b 2074 696d 6520 7374  """Check time st
+00014700: 6570 7320 6f66 2050 5053 4453 2074 6f20  eps of PPSDS to 
+00014710: 6d61 6b65 2073 7572 6520 7468 6579 2061  make sure they a
+00014720: 7265 2061 6c6c 2074 6865 2073 616d 6520  re all the same 
+00014730: 6c65 6e67 7468 2222 220a 2020 2020 7070  length""".    pp
+00014740: 7364 7320 3d20 6876 7372 5f64 6963 745b  sds = hvsr_dict[
+00014750: 2770 7073 6473 275d 0a20 2020 2074 5374  'ppsds'].    tSt
+00014760: 6570 7320 3d20 5b5d 0a20 2020 2066 6f72  eps = [].    for
+00014770: 206b 2069 6e20 7070 7364 732e 6b65 7973   k in ppsds.keys
+00014780: 2829 3a0a 2020 2020 2020 2020 7453 7465  ():.        tSte
+00014790: 7073 2e61 7070 656e 6428 6e70 2e61 7272  ps.append(np.arr
+000147a0: 6179 2870 7073 6473 5b6b 5d5b 2770 7364  ay(ppsds[k]['psd
+000147b0: 5f76 616c 7565 7327 5d29 2e73 6861 7065  _values']).shape
+000147c0: 5b30 5d29 0a20 2020 2069 6620 6c65 6e28  [0]).    if len(
+000147d0: 7365 7428 7453 7465 7073 2929 203c 3d20  set(tSteps)) <= 
+000147e0: 313a 0a20 2020 2020 2020 2070 6173 7320  1:.        pass 
+000147f0: 2354 6869 7320 6d65 616e 7320 616c 6c20  #This means all 
+00014800: 6368 616e 6e65 6c73 2068 6176 6520 7361  channels have sa
+00014810: 6d65 206e 756d 6265 7220 6f66 2070 6572  me number of per
+00014820: 696f 645f 6269 6e5f 6365 6e74 6572 730a  iod_bin_centers.
+00014830: 2020 2020 2020 2020 6d69 6e54 5374 6570          minTStep
+00014840: 3d74 5374 6570 735b 305d 0a20 2020 2065  =tSteps[0].    e
+00014850: 6c73 653a 0a20 2020 2020 2020 2070 7269  lse:.        pri
+00014860: 6e74 2827 5468 6572 6520 6973 2061 2064  nt('There is a d
+00014870: 6966 6665 7265 6e74 206e 756d 6265 7220  ifferent number 
+00014880: 6f66 2074 696d 652d 7374 6570 7320 7573  of time-steps us
+00014890: 6564 2074 6f20 6361 6c63 756c 6174 6520  ed to calculate 
+000148a0: 4856 5352 2063 7572 7665 732e 205c 6e20  HVSR curves. \n 
+000148b0: 5468 6973 206d 6179 2072 6573 756c 7420  This may result 
+000148c0: 696e 2063 6f6d 7075 7461 7469 6f6e 616c  in computational
+000148d0: 2065 7272 6f72 732e 2054 7269 6d6d 696e   errors. Trimmin
+000148e0: 6720 6c6f 6e67 6573 742e 2729 0a20 2020  g longest.').   
+000148f0: 2020 2020 206d 696e 5453 7465 7020 3d20       minTStep = 
+00014900: 6d69 6e28 7453 7465 7073 290a 2020 2020  min(tSteps).    
+00014910: 7265 7475 726e 206d 696e 5453 7465 700a  return minTStep.
+00014920: 0a23 4d61 696e 2066 756e 6374 696f 6e20  .#Main function 
+00014930: 666f 7220 7072 6f63 6573 7369 6e67 2048  for processing H
+00014940: 5653 5220 4375 7276 650a 6465 6620 7072  VSR Curve.def pr
+00014950: 6f63 6573 735f 6876 7372 2870 6172 616d  ocess_hvsr(param
+00014960: 732c 206d 6574 686f 643d 342c 2073 6d6f  s, method=4, smo
+00014970: 6f74 683d 5472 7565 2c20 6672 6571 5f73  oth=True, freq_s
+00014980: 6d6f 6f74 683d 276b 6f6e 6e6f 206f 686d  mooth='konno ohm
+00014990: 6163 6869 272c 2066 5f73 6d6f 6f74 685f  achi', f_smooth_
+000149a0: 7769 6474 683d 3430 2c20 7265 7361 6d70  width=40, resamp
+000149b0: 6c65 3d54 7275 652c 2072 656d 6f76 655f  le=True, remove_
+000149c0: 6f75 746c 6965 725f 6375 7276 6573 3d54  outlier_curves=T
+000149d0: 7275 652c 206f 7574 6c69 6572 5f63 7572  rue, outlier_cur
+000149e0: 7665 5f73 7464 3d31 2e37 3529 3a0a 2020  ve_std=1.75):.  
+000149f0: 2020 2222 2250 726f 6365 7373 2074 6865    """Process the
+00014a00: 2069 6e70 7574 2064 6174 6120 616e 6420   input data and 
+00014a10: 6765 7420 4856 5352 2064 6174 610a 2020  get HVSR data.  
+00014a20: 2020 0a20 2020 2054 6869 7320 6973 2074    .    This is t
+00014a30: 6865 206d 6169 6e20 6675 6e63 7469 6f6e  he main function
+00014a40: 2074 6861 7420 7573 6573 206f 7468 6572   that uses other
+00014a50: 2028 7072 6976 6174 6529 2066 756e 6374   (private) funct
+00014a60: 696f 6e73 2074 6f20 646f 200a 2020 2020  ions to do .    
+00014a70: 7468 6520 6275 6c6b 206f 6620 7072 6f63  the bulk of proc
+00014a80: 6573 7369 6e67 206f 6620 7468 6520 4856  essing of the HV
+00014a90: 5352 2064 6174 6120 616e 6420 7468 6520  SR data and the 
+00014aa0: 6461 7461 2071 7561 6c69 7479 2063 6865  data quality che
+00014ab0: 636b 732e 0a0a 2020 2020 5061 7261 6d65  cks...    Parame
+00014ac0: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+00014ad0: 2d2d 2d0a 2020 2020 7061 7261 6d73 2020  ---.    params  
+00014ae0: 3a20 6469 6374 0a20 2020 2020 2020 2044  : dict.        D
+00014af0: 6963 7469 6f6e 6172 7920 636f 6e74 6169  ictionary contai
+00014b00: 6e69 6e67 2061 6c6c 2074 6865 2070 6172  ning all the par
+00014b10: 616d 6574 6572 7320 696e 7075 7420 6279  ameters input by
+00014b20: 2074 6865 2075 7365 720a 2020 2020 6d65   the user.    me
+00014b30: 7468 6f64 2020 3a20 696e 7420 6f72 2073  thod  : int or s
+00014b40: 7472 0a20 2020 2020 2020 204d 6574 686f  tr.        Metho
+00014b50: 6420 746f 2075 7365 2066 6f72 2063 6f6d  d to use for com
+00014b60: 6269 6e69 6e67 2074 6865 2068 6f72 697a  bining the horiz
+00014b70: 6f6e 7461 6c20 636f 6d70 6f6e 656e 7473  ontal components
+00014b80: 0a20 2020 2020 2020 2020 2020 2030 2920  .            0) 
+00014b90: 4469 6666 7573 6520 6669 656c 6420 6173  Diffuse field as
+00014ba0: 7375 6d70 7469 6f6e 2c20 6f72 2027 4446  sumption, or 'DF
+00014bb0: 4127 2028 6e6f 7420 6375 7272 656e 746c  A' (not currentl
+00014bc0: 7920 696d 706c 656d 656e 7465 6429 0a20  y implemented). 
+00014bd0: 2020 2020 2020 2020 2020 2031 2920 2741             1) 'A
+00014be0: 7269 7468 6d65 7469 6320 4d65 616e 273a  rithmetic Mean':
+00014bf0: 2048 20e2 89a1 2028 484e 202b 2048 4529   H ... (HN + HE)
+00014c00: 2f32 0a20 2020 2020 2020 2020 2020 2032  /2.            2
+00014c10: 2920 2747 656f 6d65 7472 6963 204d 6561  ) 'Geometric Mea
+00014c20: 6e27 3a20 4820 e289 a120 e288 9a48 4e20  n': H ... ...HN 
+00014c30: c2b7 2048 452c 2072 6563 6f6d 6d65 6e64  .. HE, recommend
+00014c40: 6564 2062 7920 7468 6520 5345 5341 4d45  ed by the SESAME
+00014c50: 2070 726f 6a65 6374 2028 3230 3034 290a   project (2004).
+00014c60: 2020 2020 2020 2020 2020 2020 3329 2027              3) '
+00014c70: 5665 6374 6f72 2053 756d 6d61 7469 6f6e  Vector Summation
+00014c80: 273a 2048 20e2 89a1 20e2 889a 4832 204e  ': H ... ...H2 N
+00014c90: 202b 2048 3220 450a 2020 2020 2020 2020   + H2 E.        
+00014ca0: 2020 2020 3429 2027 5175 6164 7261 7469      4) 'Quadrati
+00014cb0: 6320 4d65 616e 273a 2048 20e2 89a1 20e2  c Mean': H ... .
+00014cc0: 889a 2848 3220 4e20 2b20 4832 2045 2029  ..(H2 N + H2 E )
+00014cd0: 2f32 0a20 2020 2020 2020 2020 2020 2035  /2.            5
+00014ce0: 2920 274d 6178 696d 756d 2048 6f72 697a  ) 'Maximum Horiz
+00014cf0: 6f6e 7461 6c20 5661 6c75 6527 3a20 4820  ontal Value': H 
+00014d00: e289 a120 6d61 7820 7b48 4e2c 2048 457d  ... max {HN, HE}
+00014d10: 0a20 2020 2073 6d6f 6f74 6820 203a 2062  .    smooth  : b
+00014d20: 6f6f 6c3d 5472 7565 0a20 2020 2020 2020  ool=True.       
+00014d30: 2062 6f6f 6c20 6f72 2069 6e74 2e20 0a20   bool or int. . 
+00014d40: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+00014d50: 7565 2c20 6465 6661 756c 7420 746f 2073  ue, default to s
+00014d60: 6d6f 6f74 6820 482f 5620 6375 7276 6520  mooth H/V curve 
+00014d70: 746f 2075 7369 6e67 2073 6176 676f 7920  to using savgoy 
+00014d80: 6669 6c74 6572 2077 6974 6820 7769 6e64  filter with wind
+00014d90: 6f77 206c 656e 6774 6820 6f66 2035 3120  ow length of 51 
+00014da0: 2877 6f72 6b73 2077 656c 6c20 7769 7468  (works well with
+00014db0: 2064 6566 6175 6c74 2072 6573 616d 706c   default resampl
+00014dc0: 6520 6f66 2031 3030 3020 7074 7329 0a20  e of 1000 pts). 
+00014dd0: 2020 2020 2020 2020 2020 2049 6620 696e             If in
+00014de0: 742c 2074 6865 206c 656e 6774 6820 6f66  t, the length of
+00014df0: 2074 6865 2077 696e 646f 7720 696e 2074   the window in t
+00014e00: 6865 2073 6176 676f 7920 6669 6c74 6572  he savgoy filter
+00014e10: 2e0a 2020 2020 6672 6571 5f73 6d6f 6f74  ..    freq_smoot
+00014e20: 6820 3a20 7374 7220 7b27 6b6f 6e6e 6f20  h : str {'konno 
+00014e30: 6f68 6d61 6368 6927 2c20 2763 6f6e 7374  ohmachi', 'const
+00014e40: 616e 7427 2c20 2770 726f 706f 7274 696f  ant', 'proportio
+00014e50: 6e61 6c27 7d0a 2020 2020 2020 2020 5768  nal'}.        Wh
+00014e60: 6963 6820 6672 6571 7565 6e63 7920 736d  ich frequency sm
+00014e70: 6f6f 7468 696e 6720 6d65 7468 6f64 2074  oothing method t
+00014e80: 6f20 7573 652e 2042 7920 6465 6661 756c  o use. By defaul
+00014e90: 742c 2075 7365 7320 7468 6520 276b 6f6e  t, uses the 'kon
+00014ea0: 6e6f 206f 686d 6163 6869 2720 6d65 7468  no ohmachi' meth
+00014eb0: 6f64 2e0a 2020 2020 2020 2020 2020 2020  od..            
+00014ec0: 2d20 5468 6520 4b6f 6e6e 6f20 2620 4f68  - The Konno & Oh
+00014ed0: 6d61 6368 6920 6d65 7468 6f64 2075 7365  machi method use
+00014ee0: 7320 7468 6520 6f62 7370 792e 7369 676e  s the obspy.sign
+00014ef0: 616c 2e6b 6f6e 6e6f 6f68 6d61 6368 6973  al.konnoohmachis
+00014f00: 6d6f 6f74 6869 6e67 2e6b 6f6e 6e6f 5f6f  moothing.konno_o
+00014f10: 686d 6163 6869 5f73 6d6f 6f74 6869 6e67  hmachi_smoothing
+00014f20: 2829 2066 756e 6374 696f 6e3a 2068 7474  () function: htt
+00014f30: 7073 3a2f 2f64 6f63 732e 6f62 7370 792e  ps://docs.obspy.
+00014f40: 6f72 672f 7061 636b 6167 6573 2f61 7574  org/packages/aut
+00014f50: 6f67 656e 2f6f 6273 7079 2e73 6967 6e61  ogen/obspy.signa
+00014f60: 6c2e 6b6f 6e6e 6f6f 686d 6163 6869 736d  l.konnoohmachism
+00014f70: 6f6f 7468 696e 672e 6b6f 6e6e 6f5f 6f68  oothing.konno_oh
+00014f80: 6d61 6368 695f 736d 6f6f 7468 696e 672e  machi_smoothing.
+00014f90: 6874 6d6c 0a20 2020 2020 2020 2020 2020  html.           
+00014fa0: 202d 2054 6865 2063 6f6e 7374 616e 7420   - The constant 
+00014fb0: 6d65 7468 6f64 0a20 2020 2020 2020 2053  method.        S
+00014fc0: 6565 2068 6572 6520 666f 7220 6d6f 7265  ee here for more
+00014fd0: 2069 6e66 6f72 6d61 7469 6f6e 3a20 6874   information: ht
+00014fe0: 7470 733a 2f2f 7777 772e 6765 6f70 7379  tps://www.geopsy
+00014ff0: 2e6f 7267 2f64 6f63 756d 656e 7461 7469  .org/documentati
+00015000: 6f6e 2f67 656f 7073 792f 6876 2d70 726f  on/geopsy/hv-pro
+00015010: 6365 7373 696e 672e 6874 6d6c 0a20 2020  cessing.html.   
+00015020: 2066 5f73 6d6f 6f74 685f 7769 6474 6820   f_smooth_width 
+00015030: 3a20 696e 742c 2064 6566 6175 6c74 203d  : int, default =
+00015040: 2034 300a 2020 2020 2020 2020 2d20 466f   40.        - Fo
+00015050: 7220 276b 6f6e 6e6f 206f 686d 6163 6869  r 'konno ohmachi
+00015060: 273a 2070 6173 7365 6420 6469 7265 6374  ': passed direct
+00015070: 6c79 2074 6f20 7468 6520 6261 6e64 7769  ly to the bandwi
+00015080: 6474 6820 7061 7261 6d65 7465 7220 6f66  dth parameter of
+00015090: 2074 6865 206b 6f6e 6e6f 5f6f 686d 6163   the konno_ohmac
+000150a0: 6869 5f73 6d6f 6f74 6869 6e67 2829 2066  hi_smoothing() f
+000150b0: 756e 6374 696f 6e2c 2064 6574 6572 6d69  unction, determi
+000150c0: 6e65 7320 7468 6520 7769 6474 6820 6f66  nes the width of
+000150d0: 2074 6865 2073 6d6f 6f74 6869 6e67 2070   the smoothing p
+000150e0: 6561 6b2c 2077 6974 6820 6c6f 7765 7220  eak, with lower 
+000150f0: 7661 6c75 6573 2072 6573 756c 7469 6e67  values resulting
+00015100: 2069 6e20 6272 6f61 6465 7220 7065 616b   in broader peak
+00015110: 2e20 4d75 7374 2062 6520 3e20 302e 0a20  . Must be > 0.. 
+00015120: 2020 2020 2020 202d 2046 6f72 2027 636f         - For 'co
+00015130: 6e73 7461 6e74 273a 2074 6865 2073 697a  nstant': the siz
+00015140: 6520 6f66 2061 2074 7269 616e 6775 6c61  e of a triangula
+00015150: 7220 736d 6f6f 7468 696e 6720 7769 6e64  r smoothing wind
+00015160: 6f77 2069 6e20 7468 6520 6e75 6d62 6572  ow in the number
+00015170: 206f 6620 6672 6571 7565 6e63 7920 7374   of frequency st
+00015180: 6570 730a 2020 2020 2020 2020 2d20 466f  eps.        - Fo
+00015190: 7220 2770 726f 706f 7274 696f 6e61 6c27  r 'proportional'
+000151a0: 3a20 7468 6520 7369 7a65 206f 6620 6120  : the size of a 
+000151b0: 7472 6961 6e67 756c 6172 2073 6d6f 6f74  triangular smoot
+000151c0: 6869 6e67 2077 696e 646f 7720 696e 2070  hing window in p
+000151d0: 6572 6365 6e74 6167 6520 6f66 2074 6865  ercentage of the
+000151e0: 206e 756d 6265 7220 6f66 2066 7265 7175   number of frequ
+000151f0: 656e 6379 2073 7465 7073 2028 652e 672e  ency steps (e.g.
+00015200: 2c20 6966 2031 3030 3020 6672 6571 7565  , if 1000 freque
+00015210: 6e63 7920 7374 6570 732f 6269 6e73 2061  ncy steps/bins a
+00015220: 6e64 2066 5f73 6d6f 6f74 685f 7769 6474  nd f_smooth_widt
+00015230: 683d 3430 2c20 7769 6e64 6f77 2077 6f75  h=40, window wou
+00015240: 6c64 2062 6520 3430 3020 7374 6570 7320  ld be 400 steps 
+00015250: 7769 6465 290a 2020 2020 7265 7361 6d70  wide).    resamp
+00015260: 6c65 2020 3a20 626f 6f6c 2c20 6465 6661  le  : bool, defa
+00015270: 756c 7420 3d20 5472 7565 0a20 2020 2020  ult = True.     
+00015280: 2020 2062 6f6f 6c20 6f72 2069 6e74 2e20     bool or int. 
+00015290: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+000152a0: 5472 7565 2c20 6465 6661 756c 7420 746f  True, default to
+000152b0: 2072 6573 616d 706c 6520 482f 5620 6461   resample H/V da
+000152c0: 7461 2074 6f20 696e 636c 7564 6520 3130  ta to include 10
+000152d0: 3030 2066 7265 7175 656e 6379 2076 616c  00 frequency val
+000152e0: 7565 7320 666f 7220 7468 6520 7265 7374  ues for the rest
+000152f0: 206f 6620 7468 6520 616e 616c 7973 6973   of the analysis
+00015300: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00015310: 696e 742c 2074 6865 206e 756d 6265 7220  int, the number 
+00015320: 6f66 2064 6174 6120 706f 696e 7473 2074  of data points t
+00015330: 6f20 696e 7465 7270 6f6c 6174 652f 7265  o interpolate/re
+00015340: 7361 6d70 6c65 2f73 6d6f 6f74 6820 7468  sample/smooth th
+00015350: 6520 636f 6d70 6f6e 656e 7420 7073 642f  e component psd/
+00015360: 4856 2063 7572 7665 2064 6174 6120 746f  HV curve data to
+00015370: 2e0a 2020 2020 7265 6d6f 7665 5f6f 7574  ..    remove_out
+00015380: 6c69 6572 5f63 7572 7665 7320 3a20 626f  lier_curves : bo
+00015390: 6f6c 2c20 6465 6661 756c 7420 3d20 5472  ol, default = Tr
+000153a0: 7565 0a20 2020 2020 2020 2057 6865 7468  ue.        Wheth
+000153b0: 6572 2074 6f20 7265 6d6f 7665 206f 7574  er to remove out
+000153c0: 6c69 6572 2068 2f76 2063 7572 7665 732e  lier h/v curves.
+000153d0: 2052 6563 6f6d 6d65 6e64 2074 6f20 6265   Recommend to be
+000153e0: 2072 6570 6561 7465 6420 6576 656e 2061   repeated even a
+000153f0: 6674 6572 2075 7369 6e67 2069 6e20 6765  fter using in ge
+00015400: 6e65 7261 7465 5f70 7073 6473 2829 2069  nerate_ppsds() i
+00015410: 6620 7265 6d6f 7665 5f6e 6f69 7365 2829  f remove_noise()
+00015420: 2069 7320 7573 6564 2e0a 2020 2020 6f75   is used..    ou
+00015430: 746c 6965 725f 6375 7276 655f 7374 6420  tlier_curve_std 
+00015440: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+00015450: 203d 2031 2e37 350a 2020 2020 2020 2020   = 1.75.        
+00015460: 5374 616e 6461 7264 2064 6576 6961 7469  Standard deviati
+00015470: 6f6e 206f 6620 6d65 616e 206f 6620 6561  on of mean of ea
+00015480: 6368 2048 2f56 2063 7572 7665 2074 6f20  ch H/V curve to 
+00015490: 7573 6520 6173 2063 7574 746f 6666 2066  use as cuttoff f
+000154a0: 6f72 2077 6865 7468 6572 2061 6e20 482f  or whether an H/
+000154b0: 5620 6375 7276 6520 6973 2063 6f6e 7369  V curve is consi
+000154c0: 6465 7265 6420 616e 2027 6f75 746c 6965  dered an 'outlie
+000154d0: 7227 0a0a 2020 2020 5265 7475 726e 730a  r'..    Returns.
+000154e0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+000154f0: 2020 2020 6876 7372 5f6f 7574 2020 2020      hvsr_out    
+00015500: 3a20 6469 6374 0a20 2020 2020 2020 2020  : dict.         
+00015510: 2020 2044 6963 7469 6f6e 6172 7920 636f     Dictionary co
+00015520: 6e74 6169 6e69 6e67 2061 6c6c 2074 6865  ntaining all the
+00015530: 2069 6e66 6f72 6d61 7469 6f6e 2061 626f   information abo
+00015540: 7574 2074 6865 2064 6174 612c 2069 6e63  ut the data, inc
+00015550: 6c75 6469 6e67 2069 6e70 7574 2070 6172  luding input par
+00015560: 616d 6574 6572 730a 0a20 2020 2022 2222  ameters..    """
+00015570: 0a20 2020 2070 7073 6473 203d 2070 6172  .    ppsds = par
+00015580: 616d 735b 2770 7073 6473 275d 2e63 6f70  ams['ppsds'].cop
+00015590: 7928 2923 5b6b 5d5b 2770 7364 5f76 616c  y()#[k]['psd_val
+000155a0: 7565 7327 5d0a 2020 2020 7070 7364 7320  ues'].    ppsds 
+000155b0: 3d20 5f5f 6368 6563 6b5f 7876 616c 7565  = __check_xvalue
+000155c0: 7328 7070 7364 7329 0a0a 2020 2020 6d65  s(ppsds)..    me
+000155d0: 7468 6f64 4c69 7374 203d 205b 2744 6966  thodList = ['Dif
+000155e0: 6675 7365 2046 6965 6c64 2041 7373 756d  fuse Field Assum
+000155f0: 7074 696f 6e27 2c20 2741 7269 7468 6d65  ption', 'Arithme
+00015600: 7469 6320 4d65 616e 272c 2027 4765 6f6d  tic Mean', 'Geom
+00015610: 6574 7269 6320 4d65 616e 272c 2027 5665  etric Mean', 'Ve
+00015620: 6374 6f72 2053 756d 6d61 7469 6f6e 272c  ctor Summation',
+00015630: 2027 5175 6164 7261 7469 6320 4d65 616e   'Quadratic Mean
+00015640: 272c 2027 4d61 7869 6d75 6d20 486f 7269  ', 'Maximum Hori
+00015650: 7a6f 6e74 616c 2056 616c 7565 275d 0a20  zontal Value']. 
+00015660: 2020 2078 5f66 7265 7173 203d 207b 7d0a     x_freqs = {}.
+00015670: 2020 2020 785f 7065 7269 6f64 7320 3d20      x_periods = 
+00015680: 7b7d 0a0a 2020 2020 7073 6456 616c 7354  {}..    psdValsT
+00015690: 4176 6720 3d20 7b7d 0a20 2020 2073 7444  Avg = {}.    stD
+000156a0: 6576 203d 207b 7d0a 2020 2020 7374 4465  ev = {}.    stDe
+000156b0: 7656 616c 7350 203d 207b 7d0a 2020 2020  vValsP = {}.    
+000156c0: 7374 4465 7656 616c 734d 203d 207b 7d0a  stDevValsM = {}.
+000156d0: 2020 2020 7073 6452 6177 3d7b 7d0a 2020      psdRaw={}.  
+000156e0: 2020 6375 7272 5469 6d65 7355 7365 643d    currTimesUsed=
+000156f0: 7b7d 0a20 2020 200a 2020 2020 666f 7220  {}.    .    for 
+00015700: 6b20 696e 2070 7073 6473 3a0a 2020 2020  k in ppsds:.    
+00015710: 2020 2020 2369 6620 7265 6173 6d70 6c69      #if reasmpli
+00015720: 6e67 2068 6173 2062 6565 6e20 7365 6c65  ng has been sele
+00015730: 6374 6564 0a20 2020 2020 2020 2069 6620  cted.        if 
+00015740: 7265 7361 6d70 6c65 206f 7220 7479 7065  resample or type
+00015750: 2872 6573 616d 706c 6529 2069 7320 696e  (resample) is in
+00015760: 743a 0a20 2020 2020 2020 2020 2020 2069  t:.            i
+00015770: 6620 7265 7361 6d70 6c65 3a0a 2020 2020  f resample:.    
+00015780: 2020 2020 2020 2020 2020 2020 7265 7361              resa
+00015790: 6d70 6c65 203d 2031 3030 3020 2344 6566  mple = 1000 #Def
+000157a0: 6175 6c74 2073 6d6f 6f74 6820 7661 6c75  ault smooth valu
+000157b0: 650a 0a20 2020 2020 2020 2020 2020 2078  e..            x
+000157c0: 5661 6c4d 696e 203d 206d 696e 2870 7073  ValMin = min(pps
+000157d0: 6473 5b6b 5d5b 2770 6572 696f 645f 6269  ds[k]['period_bi
+000157e0: 6e5f 6365 6e74 6572 7327 5d29 0a20 2020  n_centers']).   
+000157f0: 2020 2020 2020 2020 2078 5661 6c4d 6178           xValMax
+00015800: 203d 206d 6178 2870 7073 6473 5b6b 5d5b   = max(ppsds[k][
+00015810: 2770 6572 696f 645f 6269 6e5f 6365 6e74  'period_bin_cent
+00015820: 6572 7327 5d29 0a0a 2020 2020 2020 2020  ers'])..        
+00015830: 2020 2020 2352 6573 616d 706c 6520 7065      #Resample pe
+00015840: 7269 6f64 2062 696e 2076 616c 7565 730a  riod bin values.
+00015850: 2020 2020 2020 2020 2020 2020 785f 7065              x_pe
+00015860: 7269 6f64 735b 6b5d 203d 206e 702e 6c6f  riods[k] = np.lo
+00015870: 6773 7061 6365 286e 702e 6c6f 6731 3028  gspace(np.log10(
+00015880: 7856 616c 4d69 6e29 2c20 6e70 2e6c 6f67  xValMin), np.log
+00015890: 3130 2878 5661 6c4d 6178 292c 206e 756d  10(xValMax), num
+000158a0: 3d72 6573 616d 706c 6529 0a0a 2020 2020  =resample)..    
+000158b0: 2020 2020 2020 2020 6966 2073 6d6f 6f74          if smoot
+000158c0: 6820 6f72 2074 7970 6528 736d 6f6f 7468  h or type(smooth
+000158d0: 2920 6973 2069 6e74 3a0a 2020 2020 2020  ) is int:.      
+000158e0: 2020 2020 2020 2020 2020 6966 2073 6d6f            if smo
+000158f0: 6f74 683a 0a20 2020 2020 2020 2020 2020  oth:.           
+00015900: 2020 2020 2020 2020 2073 6d6f 6f74 6820           smooth 
+00015910: 3d20 3531 2023 4465 6661 756c 7420 736d  = 51 #Default sm
+00015920: 6f6f 7468 696e 6720 7769 6e64 6f77 0a20  oothing window. 
+00015930: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00015940: 6c69 6620 736d 6f6f 7468 2532 3d3d 303a  lif smooth%2==0:
+00015950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015960: 2020 2020 2073 6d6f 6f74 6820 3d20 736d       smooth = sm
+00015970: 6f6f 7468 2b31 0a0a 2020 2020 2020 2020  ooth+1..        
+00015980: 2020 2020 2352 6573 616d 706c 6520 7261      #Resample ra
+00015990: 7720 7070 7364 2076 616c 7565 730a 2020  w ppsd values.  
+000159a0: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+000159b0: 2074 2069 6e20 656e 756d 6572 6174 6528   t in enumerate(
+000159c0: 7070 7364 735b 6b5d 5b27 7073 645f 7661  ppsds[k]['psd_va
+000159d0: 6c75 6573 275d 293a 0a20 2020 2020 2020  lues']):.       
+000159e0: 2020 2020 2020 2020 2069 6620 693d 3d30           if i==0
+000159f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015a00: 2020 2020 2020 7073 6452 6177 5b6b 5d20        psdRaw[k] 
+00015a10: 3d20 6e70 2e69 6e74 6572 7028 785f 7065  = np.interp(x_pe
+00015a20: 7269 6f64 735b 6b5d 2c20 7070 7364 735b  riods[k], ppsds[
+00015a30: 6b5d 5b27 7065 7269 6f64 5f62 696e 5f63  k]['period_bin_c
+00015a40: 656e 7465 7273 275d 2c20 7429 0a20 2020  enters'], t).   
+00015a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015a60: 2069 6620 736d 6f6f 7468 2069 7320 6e6f   if smooth is no
+00015a70: 7420 4661 6c73 653a 0a20 2020 2020 2020  t False:.       
+00015a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015a90: 2070 7364 5261 775b 6b5d 203d 2073 6369   psdRaw[k] = sci
+00015aa0: 7079 2e73 6967 6e61 6c2e 7361 7667 6f6c  py.signal.savgol
+00015ab0: 5f66 696c 7465 7228 7073 6452 6177 5b6b  _filter(psdRaw[k
+00015ac0: 5d2c 2073 6d6f 6f74 682c 2033 290a 0a20  ], smooth, 3).. 
+00015ad0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00015ae0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00015af0: 2020 2020 2020 2020 2070 7364 5261 775b           psdRaw[
+00015b00: 6b5d 203d 206e 702e 7673 7461 636b 2828  k] = np.vstack((
+00015b10: 7073 6452 6177 5b6b 5d2c 206e 702e 696e  psdRaw[k], np.in
+00015b20: 7465 7270 2878 5f70 6572 696f 6473 5b6b  terp(x_periods[k
+00015b30: 5d2c 2070 7073 6473 5b6b 5d5b 2770 6572  ], ppsds[k]['per
+00015b40: 696f 645f 6269 6e5f 6365 6e74 6572 7327  iod_bin_centers'
+00015b50: 5d2c 2074 2929 290a 2020 2020 2020 2020  ], t))).        
+00015b60: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00015b70: 6d6f 6f74 6820 6973 206e 6f74 2046 616c  mooth is not Fal
+00015b80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00015b90: 2020 2020 2020 2020 2020 2020 7073 6452              psdR
+00015ba0: 6177 5b6b 5d5b 695d 203d 2073 6369 7079  aw[k][i] = scipy
+00015bb0: 2e73 6967 6e61 6c2e 7361 7667 6f6c 5f66  .signal.savgol_f
+00015bc0: 696c 7465 7228 7073 6452 6177 5b6b 5d5b  ilter(psdRaw[k][
+00015bd0: 695d 2c20 736d 6f6f 7468 2c20 3329 0a0a  i], smooth, 3)..
+00015be0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00015bf0: 2020 2020 2020 2020 2020 2349 6620 6e6f            #If no
+00015c00: 2072 6573 616d 706c 696e 6720 6465 7369   resampling desi
+00015c10: 7265 640a 2020 2020 2020 2020 2020 2020  red.            
+00015c20: 785f 7065 7269 6f64 735b 6b5d 203d 206e  x_periods[k] = n
+00015c30: 702e 6172 7261 7928 7070 7364 735b 6b5d  p.array(ppsds[k]
+00015c40: 5b27 7065 7269 6f64 5f62 696e 5f63 656e  ['period_bin_cen
+00015c50: 7465 7273 275d 290a 2020 2020 2020 2020  ters']).        
+00015c60: 2020 2020 7073 6452 6177 5b6b 5d20 3d20      psdRaw[k] = 
+00015c70: 6e70 2e61 7272 6179 2870 7073 6473 5b6b  np.array(ppsds[k
+00015c80: 5d5b 2770 7364 5f76 616c 7565 7327 5d29  ]['psd_values'])
+00015c90: 0a0a 2020 2020 2020 2020 2347 6574 2061  ..        #Get a
+00015ca0: 7665 7261 6765 2070 7364 2076 616c 7565  verage psd value
+00015cb0: 2061 6372 6f73 7320 7469 6d65 2066 6f72   across time for
+00015cc0: 2065 6163 6820 6368 616e 6e65 6c20 2875   each channel (u
+00015cd0: 7365 6420 746f 2063 616c 6320 6d61 696e  sed to calc main
+00015ce0: 2048 2f56 2063 7572 7665 290a 2020 2020   H/V curve).    
+00015cf0: 2020 2020 7073 6456 616c 7354 4176 675b      psdValsTAvg[
+00015d00: 6b5d 203d 206e 702e 6e61 6e6d 6561 6e28  k] = np.nanmean(
+00015d10: 6e70 2e61 7272 6179 2870 7364 5261 775b  np.array(psdRaw[
+00015d20: 6b5d 292c 2061 7869 733d 3029 0a20 2020  k]), axis=0).   
+00015d30: 2020 2020 2078 5f66 7265 7173 5b6b 5d20       x_freqs[k] 
+00015d40: 3d20 6e70 2e64 6976 6964 6528 6e70 2e6f  = np.divide(np.o
+00015d50: 6e65 735f 6c69 6b65 2878 5f70 6572 696f  nes_like(x_perio
+00015d60: 6473 5b6b 5d29 2c20 785f 7065 7269 6f64  ds[k]), x_period
+00015d70: 735b 6b5d 2920 0a0a 2020 2020 2020 2020  s[k]) ..        
+00015d80: 7374 4465 765b 6b5d 203d 206e 702e 7374  stDev[k] = np.st
+00015d90: 6428 7073 6452 6177 5b6b 5d2c 2061 7869  d(psdRaw[k], axi
+00015da0: 733d 3029 0a20 2020 2020 2020 2073 7444  s=0).        stD
+00015db0: 6576 5661 6c73 4d5b 6b5d 203d 206e 702e  evValsM[k] = np.
+00015dc0: 6172 7261 7928 7073 6456 616c 7354 4176  array(psdValsTAv
+00015dd0: 675b 6b5d 202d 2073 7444 6576 5b6b 5d29  g[k] - stDev[k])
+00015de0: 0a20 2020 2020 2020 2073 7444 6576 5661  .        stDevVa
+00015df0: 6c73 505b 6b5d 203d 206e 702e 6172 7261  lsP[k] = np.arra
+00015e00: 7928 7073 6456 616c 7354 4176 675b 6b5d  y(psdValsTAvg[k]
+00015e10: 202b 2073 7444 6576 5b6b 5d29 0a0a 2020   + stDev[k])..  
+00015e20: 2020 2020 2020 6375 7272 5469 6d65 7355        currTimesU
+00015e30: 7365 645b 6b5d 203d 2070 7073 6473 5b6b  sed[k] = ppsds[k
+00015e40: 5d5b 2763 7572 7265 6e74 5f74 696d 6573  ]['current_times
+00015e50: 5f75 7365 6427 5d0a 0a20 2020 2023 4765  _used']..    #Ge
+00015e60: 7420 7374 7269 6e67 206f 6620 6d65 7468  t string of meth
+00015e70: 6f64 2074 7970 650a 2020 2020 6966 2074  od type.    if t
+00015e80: 7970 6528 6d65 7468 6f64 2920 6973 2069  ype(method) is i
+00015e90: 6e74 3a0a 2020 2020 2020 2020 6d65 7468  nt:.        meth
+00015ea0: 6f64 496e 7420 3d20 6d65 7468 6f64 0a20  odInt = method. 
+00015eb0: 2020 2020 2020 206d 6574 686f 6420 3d20         method = 
+00015ec0: 6d65 7468 6f64 4c69 7374 5b6d 6574 686f  methodList[metho
+00015ed0: 645d 0a0a 2020 2020 2354 6869 7320 6765  d]..    #This ge
+00015ee0: 7473 2074 6865 2068 7673 7220 6375 7276  ts the hvsr curv
+00015ef0: 6520 6176 6572 6167 6564 2066 726f 6d20  e averaged from 
+00015f00: 616c 6c20 7469 6d65 2073 7465 7073 0a20  all time steps. 
+00015f10: 2020 2061 6e79 4b20 3d20 6c69 7374 2878     anyK = list(x
+00015f20: 5f66 7265 7173 2e6b 6579 7328 2929 5b30  _freqs.keys())[0
+00015f30: 5d0a 2020 2020 6876 7372 5f63 7572 7665  ].    hvsr_curve
+00015f40: 203d 205f 5f67 6574 5f68 7673 725f 6375   = __get_hvsr_cu
+00015f50: 7276 6528 783d 785f 6672 6571 735b 616e  rve(x=x_freqs[an
+00015f60: 794b 5d2c 2070 7364 3d70 7364 5661 6c73  yK], psd=psdVals
+00015f70: 5441 7667 2c20 6d65 7468 6f64 3d6d 6574  TAvg, method=met
+00015f80: 686f 6449 6e74 290a 0a20 2020 206f 7269  hodInt)..    ori
+00015f90: 6750 5053 4420 3d20 7061 7261 6d73 5b27  gPPSD = params['
+00015fa0: 7070 7364 735f 6f62 7370 7927 5d2e 636f  ppsds_obspy'].co
+00015fb0: 7079 2829 0a0a 2020 2020 2341 6464 2073  py()..    #Add s
+00015fc0: 6f6d 6520 6f74 6865 7220 7661 7269 6162  ome other variab
+00015fd0: 6c65 7320 746f 206f 7572 206f 7574 7075  les to our outpu
+00015fe0: 7420 6469 6374 696f 6e61 7279 0a20 2020  t dictionary.   
+00015ff0: 2068 7673 725f 6f75 7420 3d20 7b27 696e   hvsr_out = {'in
+00016000: 7075 745f 7061 7261 6d73 273a 7061 7261  put_params':para
+00016010: 6d73 2e63 6f70 7928 292c 0a20 2020 2020  ms.copy(),.     
+00016020: 2020 2020 2020 2020 2020 2027 785f 6672             'x_fr
+00016030: 6571 7327 3a78 5f66 7265 7173 2c0a 2020  eqs':x_freqs,.  
+00016040: 2020 2020 2020 2020 2020 2020 2020 2768                'h
+00016050: 7673 725f 6375 7276 6527 3a68 7673 725f  vsr_curve':hvsr_
+00016060: 6375 7276 652c 0a20 2020 2020 2020 2020  curve,.         
+00016070: 2020 2020 2020 2027 785f 7065 7269 6f64         'x_period
+00016080: 273a 785f 7065 7269 6f64 732c 0a20 2020  ':x_periods,.   
+00016090: 2020 2020 2020 2020 2020 2020 2027 7073               'ps
+000160a0: 645f 7261 7727 3a70 7364 5261 772c 0a20  d_raw':psdRaw,. 
+000160b0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+000160c0: 6375 7272 656e 745f 7469 6d65 735f 7573  current_times_us
+000160d0: 6564 273a 2063 7572 7254 696d 6573 5573  ed': currTimesUs
+000160e0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+000160f0: 2020 2020 2770 7364 5f76 616c 7565 735f      'psd_values_
+00016100: 7461 7667 273a 7073 6456 616c 7354 4176  tavg':psdValsTAv
+00016110: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
+00016120: 2020 2027 7070 7364 5f73 7464 273a 7374     'ppsd_std':st
+00016130: 4465 762c 0a20 2020 2020 2020 2020 2020  Dev,.           
+00016140: 2020 2020 2027 7070 7364 5f73 7464 5f76       'ppsd_std_v
+00016150: 616c 735f 6d27 3a73 7444 6576 5661 6c73  als_m':stDevVals
+00016160: 4d2c 0a20 2020 2020 2020 2020 2020 2020  M,.             
+00016170: 2020 2027 7070 7364 5f73 7464 5f76 616c     'ppsd_std_val
+00016180: 735f 7027 3a73 7444 6576 5661 6c73 502c  s_p':stDevValsP,
+00016190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000161a0: 2027 6d65 7468 6f64 273a 6d65 7468 6f64   'method':method
+000161b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000161c0: 2020 2770 7073 6473 273a 7070 7364 732c    'ppsds':ppsds,
+000161d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000161e0: 2027 7070 7364 735f 6f62 7370 7927 3a6f   'ppsds_obspy':o
+000161f0: 7269 6750 5053 442c 0a20 2020 2020 2020  rigPPSD,.       
+00016200: 2020 2020 2020 2020 2027 7473 7465 7073           'tsteps
+00016210: 5f75 7365 6427 3a20 7061 7261 6d73 5b27  _used': params['
+00016220: 7473 7465 7073 5f75 7365 6427 5d2e 636f  tsteps_used'].co
+00016230: 7079 2829 0a20 2020 2020 2020 2020 2020  py().           
+00016240: 2020 2020 207d 0a0a 2020 2020 6966 2027       }..    if '
+00016250: 7877 696e 646f 7773 5f6f 7574 2720 696e  xwindows_out' in
+00016260: 2070 6172 616d 732e 6b65 7973 2829 3a0a   params.keys():.
+00016270: 2020 2020 2020 2020 6876 7372 5f6f 7574          hvsr_out
+00016280: 5b27 7877 696e 646f 7773 5f6f 7574 275d  ['xwindows_out']
+00016290: 203d 2070 6172 616d 735b 2778 7769 6e64   = params['xwind
+000162a0: 6f77 735f 6f75 7427 5d0a 2020 2020 656c  ows_out'].    el
+000162b0: 7365 3a0a 2020 2020 2020 2020 6876 7372  se:.        hvsr
+000162c0: 5f6f 7574 5b27 7877 696e 646f 7773 5f6f  _out['xwindows_o
+000162d0: 7574 275d 203d 205b 5d0a 0a20 2020 2064  ut'] = []..    d
+000162e0: 656c 2068 7673 725f 6f75 745b 2769 6e70  el hvsr_out['inp
+000162f0: 7574 5f70 6172 616d 7327 5d5b 2770 7073  ut_params']['pps
+00016300: 6473 5f6f 6273 7079 275d 0a20 2020 2064  ds_obspy'].    d
+00016310: 656c 2068 7673 725f 6f75 745b 2769 6e70  el hvsr_out['inp
+00016320: 7574 5f70 6172 616d 7327 5d5b 2770 7073  ut_params']['pps
+00016330: 6473 275d 0a20 2020 2064 656c 2068 7673  ds'].    del hvs
+00016340: 725f 6f75 745b 2769 6e70 7574 5f70 6172  r_out['input_par
+00016350: 616d 7327 5d5b 2774 7374 6570 735f 7573  ams']['tsteps_us
+00016360: 6564 275d 0a0a 2020 2020 6672 6571 5f73  ed']..    freq_s
+00016370: 6d6f 6f74 685f 6b6f 203d 205b 276b 6f6e  mooth_ko = ['kon
+00016380: 6e6f 206f 686d 6163 6869 272c 2027 6b6f  no ohmachi', 'ko
+00016390: 6e6e 6f2d 6f68 6d61 6368 6927 2c20 276b  nno-ohmachi', 'k
+000163a0: 6f6e 6e6f 6f68 6d61 6368 6927 2c20 276b  onnoohmachi', 'k
+000163b0: 6f6e 6e6f 686d 6163 6869 272c 2027 6b6f  onnohmachi', 'ko
+000163c0: 272c 2027 6b27 5d0a 2020 2020 6672 6571  ', 'k'].    freq
+000163d0: 5f73 6d6f 6f74 685f 636f 6e73 7461 6e74  _smooth_constant
+000163e0: 203d 205b 2763 6f6e 7374 616e 7427 2c20   = ['constant', 
+000163f0: 2763 6f6e 7374 272c 2027 6327 5d0a 2020  'const', 'c'].  
+00016400: 2020 6672 6571 5f73 6d6f 6f74 685f 7072    freq_smooth_pr
+00016410: 6f70 6f72 7420 3d20 5b27 7072 6f70 6f72  oport = ['propor
+00016420: 7469 6f6e 616c 272c 2027 7072 6f70 6f72  tional', 'propor
+00016430: 7469 6f6e 272c 2027 7072 6f70 272c 2027  tion', 'prop', '
+00016440: 7027 5d0a 0a20 2020 2023 4672 6571 7565  p']..    #Freque
+00016450: 6e63 7920 536d 6f6f 7468 696e 670a 2020  ncy Smoothing.  
+00016460: 2020 6966 2066 7265 715f 736d 6f6f 7468    if freq_smooth
+00016470: 2069 7320 4661 6c73 653a 0a20 2020 2020   is False:.     
+00016480: 2020 2070 7269 6e74 2827 4e6f 2066 7265     print('No fre
+00016490: 7175 656e 6379 2073 6d6f 6f74 6869 6e67  quency smoothing
+000164a0: 2069 7320 6265 696e 6720 6170 706c 6965   is being applie
+000164b0: 642e 2054 6869 7320 6973 206e 6f74 2072  d. This is not r
+000164c0: 6563 6f6d 6d65 6e64 6564 2066 6f72 206e  ecommended for n
+000164d0: 6f69 7379 2064 6174 6173 6574 732e 2729  oisy datasets.')
+000164e0: 0a20 2020 2065 6c69 6620 6672 6571 5f73  .    elif freq_s
+000164f0: 6d6f 6f74 6820 6973 2054 7275 6520 6f72  mooth is True or
+00016500: 2066 7265 715f 736d 6f6f 7468 2e6c 6f77   freq_smooth.low
+00016510: 6572 2829 2069 6e20 6672 6571 5f73 6d6f  er() in freq_smo
+00016520: 6f74 685f 6b6f 3a0a 2020 2020 2020 2020  oth_ko:.        
+00016530: 6672 6f6d 206f 6273 7079 2e73 6967 6e61  from obspy.signa
+00016540: 6c20 696d 706f 7274 206b 6f6e 6e6f 6f68  l import konnooh
+00016550: 6d61 6368 6973 6d6f 6f74 6869 6e67 0a20  machismoothing. 
+00016560: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
+00016570: 6876 7372 5f6f 7574 5b27 7073 645f 7261  hvsr_out['psd_ra
+00016580: 7727 5d3a 0a20 2020 2020 2020 2020 2020  w']:.           
+00016590: 2070 7073 645f 6461 7461 203d 2068 7673   ppsd_data = hvs
+000165a0: 725f 6f75 745b 2770 7364 5f72 6177 275d  r_out['psd_raw']
+000165b0: 5b6b 5d0a 2020 2020 2020 2020 2020 2020  [k].            
+000165c0: 6672 6571 7320 3d20 6876 7372 5f6f 7574  freqs = hvsr_out
+000165d0: 5b27 785f 6672 6571 7327 5d5b 6b5d 0a20  ['x_freqs'][k]. 
+000165e0: 2020 2020 2020 2020 2020 2073 6d6f 6f74             smoot
+000165f0: 6865 645f 7070 7364 5f64 6174 6120 3d20  hed_ppsd_data = 
+00016600: 6b6f 6e6e 6f6f 686d 6163 6869 736d 6f6f  konnoohmachismoo
+00016610: 7468 696e 672e 6b6f 6e6e 6f5f 6f68 6d61  thing.konno_ohma
+00016620: 6368 695f 736d 6f6f 7468 696e 6728 7070  chi_smoothing(pp
+00016630: 7364 5f64 6174 612c 2066 7265 7173 2c20  sd_data, freqs, 
+00016640: 6261 6e64 7769 6474 683d 665f 736d 6f6f  bandwidth=f_smoo
+00016650: 7468 5f77 6964 7468 2c20 6e6f 726d 616c  th_width, normal
+00016660: 697a 653d 5472 7565 290a 2020 2020 2020  ize=True).      
+00016670: 2020 2020 2020 6876 7372 5f6f 7574 5b27        hvsr_out['
+00016680: 7073 645f 7261 7727 5d5b 6b5d 203d 2073  psd_raw'][k] = s
+00016690: 6d6f 6f74 6865 645f 7070 7364 5f64 6174  moothed_ppsd_dat
+000166a0: 610a 2020 2020 656c 6966 2066 7265 715f  a.    elif freq_
+000166b0: 736d 6f6f 7468 2e6c 6f77 6572 2829 2069  smooth.lower() i
+000166c0: 6e20 6672 6571 5f73 6d6f 6f74 685f 636f  n freq_smooth_co
+000166d0: 6e73 7461 6e74 3a0a 2020 2020 2020 2020  nstant:.        
+000166e0: 6876 7372 5f6f 7574 203d 205f 5f66 7265  hvsr_out = __fre
+000166f0: 715f 736d 6f6f 7468 5f77 696e 646f 7728  q_smooth_window(
+00016700: 6876 7372 5f6f 7574 2c20 665f 736d 6f6f  hvsr_out, f_smoo
+00016710: 7468 5f77 6964 7468 2c20 6b69 6e64 3d27  th_width, kind='
+00016720: 636f 6e73 7461 6e74 2729 0a20 2020 2065  constant').    e
+00016730: 6c69 6620 6672 6571 5f73 6d6f 6f74 682e  lif freq_smooth.
+00016740: 6c6f 7765 7228 2920 696e 2066 7265 715f  lower() in freq_
+00016750: 736d 6f6f 7468 5f70 726f 706f 7274 3a0a  smooth_proport:.
+00016760: 2020 2020 2020 2020 6876 7372 5f6f 7574          hvsr_out
+00016770: 203d 205f 5f66 7265 715f 736d 6f6f 7468   = __freq_smooth
+00016780: 5f77 696e 646f 7728 6876 7372 5f6f 7574  _window(hvsr_out
+00016790: 2c20 665f 736d 6f6f 7468 5f77 6964 7468  , f_smooth_width
+000167a0: 2c20 6b69 6e64 3d27 7072 6f70 6f72 7469  , kind='proporti
+000167b0: 6f6e 616c 2729 0a20 2020 2065 6c73 653a  onal').    else:
+000167c0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+000167d0: 4e6f 2066 7265 7175 656e 6379 2073 6d6f  No frequency smo
+000167e0: 6f74 6869 6e67 2069 7320 6265 696e 6720  othing is being 
+000167f0: 6170 706c 6965 642e 2054 6869 7320 6973  applied. This is
+00016800: 206e 6f74 2072 6563 6f6d 6d65 6e64 6564   not recommended
+00016810: 2066 6f72 206e 6f69 7379 2064 6174 6173   for noisy datas
+00016820: 6574 732e 2729 0a0a 0a20 2020 2023 4765  ets.')...    #Ge
+00016830: 7420 6876 7372 2063 7572 7665 2066 726f  t hvsr curve fro
+00016840: 6d20 7468 7265 6520 636f 6d70 6f6e 656e  m three componen
+00016850: 7473 2061 7420 6561 6368 2074 696d 6520  ts at each time 
+00016860: 7374 6570 0a20 2020 2068 7673 725f 7453  step.    hvsr_tS
+00016870: 7465 7073 203d 205b 5d0a 2020 2020 616e  teps = [].    an
+00016880: 794b 203d 206c 6973 7428 6876 7372 5f6f  yK = list(hvsr_o
+00016890: 7574 5b27 7073 645f 7261 7727 5d2e 6b65  ut['psd_raw'].ke
+000168a0: 7973 2829 295b 305d 0a20 2020 2066 6f72  ys())[0].    for
+000168b0: 2074 5374 6570 2069 6e20 7261 6e67 6528   tStep in range(
+000168c0: 6c65 6e28 6876 7372 5f6f 7574 5b27 7073  len(hvsr_out['ps
+000168d0: 645f 7261 7727 5d5b 616e 794b 5d29 293a  d_raw'][anyK])):
+000168e0: 0a20 2020 2020 2020 2074 5374 6570 4469  .        tStepDi
+000168f0: 6374 203d 207b 7d0a 2020 2020 2020 2020  ct = {}.        
+00016900: 666f 7220 6b20 696e 2068 7673 725f 6f75  for k in hvsr_ou
+00016910: 745b 2770 7364 5f72 6177 275d 3a0a 2020  t['psd_raw']:.  
+00016920: 2020 2020 2020 2020 2020 7453 7465 7044            tStepD
+00016930: 6963 745b 6b5d 203d 2068 7673 725f 6f75  ict[k] = hvsr_ou
+00016940: 745b 2770 7364 5f72 6177 275d 5b6b 5d5b  t['psd_raw'][k][
+00016950: 7453 7465 705d 0a20 2020 2020 2020 2068  tStep].        h
+00016960: 7673 725f 7453 7465 7073 2e61 7070 656e  vsr_tSteps.appen
+00016970: 6428 5f5f 6765 745f 6876 7372 5f63 7572  d(__get_hvsr_cur
+00016980: 7665 2878 3d68 7673 725f 6f75 745b 2778  ve(x=hvsr_out['x
+00016990: 5f66 7265 7173 275d 5b61 6e79 4b5d 2c20  _freqs'][anyK], 
+000169a0: 7073 643d 7453 7465 7044 6963 742c 206d  psd=tStepDict, m
+000169b0: 6574 686f 643d 6d65 7468 6f64 496e 7429  ethod=methodInt)
+000169c0: 290a 2020 2020 6876 7372 5f74 5374 6570  ).    hvsr_tStep
+000169d0: 7320 3d20 6e70 2e61 7272 6179 2868 7673  s = np.array(hvs
+000169e0: 725f 7453 7465 7073 290a 2020 2020 0a20  r_tSteps).    . 
+000169f0: 2020 2068 7673 725f 6f75 745b 2769 6e64     hvsr_out['ind
+00016a00: 5f68 7673 725f 6375 7276 6573 275d 203d  _hvsr_curves'] =
+00016a10: 2068 7673 725f 7453 7465 7073 0a0a 2020   hvsr_tSteps..  
+00016a20: 2020 2375 7365 2074 6865 2073 7461 6e64    #use the stand
+00016a30: 6172 6420 6465 7669 6174 696f 6e20 6f66  ard deviation of
+00016a40: 2065 6163 6820 696e 6469 7669 6475 616c   each individual
+00016a50: 2063 7572 7665 2074 6f20 6465 7465 726d   curve to determ
+00016a60: 696e 6520 6966 2069 7420 6f76 6572 6c61  ine if it overla
+00016a70: 7070 6564 0a20 2020 2069 6620 7265 6d6f  pped.    if remo
+00016a80: 7665 5f6f 7574 6c69 6572 5f63 7572 7665  ve_outlier_curve
+00016a90: 733a 0a20 2020 2020 2020 2073 7464 5420  s:.        stdT 
+00016aa0: 3d20 6e70 2e73 7464 2868 7673 725f 6f75  = np.std(hvsr_ou
+00016ab0: 745b 2769 6e64 5f68 7673 725f 6375 7276  t['ind_hvsr_curv
+00016ac0: 6573 275d 2c20 6178 6973 3d31 290a 2020  es'], axis=1).  
+00016ad0: 2020 2020 2020 7374 645f 7374 6454 3d20        std_stdT= 
+00016ae0: 6e70 2e73 7464 2873 7464 5429 0a20 2020  np.std(stdT).   
+00016af0: 2020 2020 2061 7667 5f73 7464 543d 206e       avg_stdT= n
+00016b00: 702e 6e61 6e6d 6561 6e28 7374 6454 290a  p.nanmean(stdT).
+00016b10: 0a20 2020 2020 2020 2070 7364 735f 746f  .        psds_to
+00016b20: 5f72 6964 203d 205b 5d0a 2020 2020 2020  _rid = [].      
+00016b30: 2020 666f 7220 692c 7420 696e 2065 6e75    for i,t in enu
+00016b40: 6d65 7261 7465 2868 7673 725f 6f75 745b  merate(hvsr_out[
+00016b50: 2769 6e64 5f68 7673 725f 6375 7276 6573  'ind_hvsr_curves
+00016b60: 275d 293a 0a20 2020 2020 2020 2020 2020  ']):.           
+00016b70: 2069 6620 7374 6454 5b69 5d20 3c20 6176   if stdT[i] < av
+00016b80: 675f 7374 6454 202d 2073 7464 5f73 7464  g_stdT - std_std
+00016b90: 542a 6f75 746c 6965 725f 6375 7276 655f  T*outlier_curve_
+00016ba0: 7374 6420 6f72 2073 7464 545b 695d 203e  std or stdT[i] >
+00016bb0: 2061 7667 5f73 7464 5420 2b20 7374 645f   avg_stdT + std_
+00016bc0: 7374 6454 2a6f 7574 6c69 6572 5f63 7572  stdT*outlier_cur
+00016bd0: 7665 5f73 7464 3a0a 2020 2020 2020 2020  ve_std:.        
+00016be0: 2020 2020 2020 2020 7073 6473 5f74 6f5f          psds_to_
+00016bf0: 7269 642e 6170 7065 6e64 2869 290a 0a20  rid.append(i).. 
+00016c00: 2020 2020 2020 2066 6f72 2069 2c20 7220         for i, r 
+00016c10: 696e 2065 6e75 6d65 7261 7465 2870 7364  in enumerate(psd
+00016c20: 735f 746f 5f72 6964 293a 0a20 2020 2020  s_to_rid):.     
+00016c30: 2020 2020 2020 2069 6e64 6578 203d 2069         index = i
+00016c40: 6e74 2872 2d69 290a 2020 2020 2020 2020  nt(r-i).        
+00016c50: 2020 2020 6876 7372 5f6f 7574 5b27 696e      hvsr_out['in
+00016c60: 645f 6876 7372 5f63 7572 7665 7327 5d20  d_hvsr_curves'] 
+00016c70: 3d20 6e70 2e64 656c 6574 6528 6876 7372  = np.delete(hvsr
+00016c80: 5f6f 7574 5b27 696e 645f 6876 7372 5f63  _out['ind_hvsr_c
+00016c90: 7572 7665 7327 5d2c 2069 6e64 6578 2c20  urves'], index, 
+00016ca0: 6178 6973 3d30 290a 0a20 2020 2020 2020  axis=0)..       
+00016cb0: 2020 2020 2066 6f72 206b 2069 6e20 6876       for k in hv
+00016cc0: 7372 5f6f 7574 5b27 7070 7364 7327 5d3a  sr_out['ppsds']:
+00016cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016ce0: 2068 7673 725f 6f75 745b 2770 7364 5f72   hvsr_out['psd_r
+00016cf0: 6177 275d 5b6b 5d20 3d20 6e70 2e64 656c  aw'][k] = np.del
+00016d00: 6574 6528 6876 7372 5f6f 7574 5b27 7073  ete(hvsr_out['ps
+00016d10: 645f 7261 7727 5d5b 6b5d 2c20 696e 6465  d_raw'][k], inde
+00016d20: 782c 2061 7869 733d 3029 2020 2020 2020  x, axis=0)      
+00016d30: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00016d40: 2020 2020 6876 7372 5f6f 7574 5b27 6375      hvsr_out['cu
+00016d50: 7272 656e 745f 7469 6d65 735f 7573 6564  rrent_times_used
+00016d60: 275d 5b6b 5d20 3d20 6e70 2e64 656c 6574  '][k] = np.delet
+00016d70: 6528 6876 7372 5f6f 7574 5b27 6375 7272  e(hvsr_out['curr
+00016d80: 656e 745f 7469 6d65 735f 7573 6564 275d  ent_times_used']
+00016d90: 5b6b 5d2c 2069 6e64 6578 290a 2020 2020  [k], index).    
+00016da0: 2020 2020 6876 7372 5f6f 7574 5b27 7473      hvsr_out['ts
+00016db0: 7465 7073 5f75 7365 6427 5d5b 305d 203d  teps_used'][0] =
+00016dc0: 2068 7673 725f 6f75 745b 2770 7073 6473   hvsr_out['ppsds
+00016dd0: 275d 5b6b 5d5b 2763 7572 7265 6e74 5f74  '][k]['current_t
+00016de0: 696d 6573 5f75 7365 6427 5d2e 7368 6170  imes_used'].shap
+00016df0: 655b 305d 0a0a 2020 2020 6876 7372 5f6f  e[0]..    hvsr_o
+00016e00: 7574 5b27 696e 645f 6876 7372 5f73 7464  ut['ind_hvsr_std
+00016e10: 4465 7627 5d20 3d20 6e70 2e73 7464 2868  Dev'] = np.std(h
+00016e20: 7673 725f 6f75 745b 2769 6e64 5f68 7673  vsr_out['ind_hvs
+00016e30: 725f 6375 7276 6573 275d 2c20 6178 6973  r_curves'], axis
+00016e40: 3d30 290a 0a20 2020 2023 4765 7420 7065  =0)..    #Get pe
+00016e50: 616b 7320 666f 7220 6561 6368 2074 696d  aks for each tim
+00016e60: 6520 7374 6570 0a20 2020 2074 5374 6570  e step.    tStep
+00016e70: 5065 616b 7320 3d20 5b5d 0a20 2020 2066  Peaks = [].    f
+00016e80: 6f72 2074 5374 6570 4856 5352 2069 6e20  or tStepHVSR in 
+00016e90: 6876 7372 5f74 5374 6570 733a 0a20 2020  hvsr_tSteps:.   
+00016ea0: 2020 2020 2074 5374 6570 5065 616b 732e       tStepPeaks.
+00016eb0: 6170 7065 6e64 285f 5f66 696e 645f 7065  append(__find_pe
+00016ec0: 616b 7328 7453 7465 7048 5653 5229 290a  aks(tStepHVSR)).
+00016ed0: 2020 2020 6876 7372 5f6f 7574 5b27 696e      hvsr_out['in
+00016ee0: 645f 6876 7372 5f70 6561 6b5f 696e 6469  d_hvsr_peak_indi
+00016ef0: 6365 7327 5d20 3d20 7453 7465 7050 6561  ces'] = tStepPea
+00016f00: 6b73 0a20 2020 2023 4765 7420 7065 616b  ks.    #Get peak
+00016f10: 7320 6f66 206d 6169 6e20 4856 2063 7572  s of main HV cur
+00016f20: 7665 0a20 2020 2068 7673 725f 6f75 745b  ve.    hvsr_out[
+00016f30: 2768 7673 725f 7065 616b 5f69 6e64 6963  'hvsr_peak_indic
+00016f40: 6573 275d 203d 205f 5f66 696e 645f 7065  es'] = __find_pe
+00016f50: 616b 7328 6876 7372 5f6f 7574 5b27 6876  aks(hvsr_out['hv
+00016f60: 7372 5f63 7572 7665 275d 290a 2020 2020  sr_curve']).    
+00016f70: 0a20 2020 2023 4765 7420 6672 6571 7565  .    #Get freque
+00016f80: 6e63 7920 7661 6c75 6573 2061 7420 4856  ncy values at HV
+00016f90: 2070 6561 6b73 2069 6e20 6d61 696e 2063   peaks in main c
+00016fa0: 7572 7665 0a20 2020 2068 7673 7250 463d  urve.    hvsrPF=
+00016fb0: 5b5d 0a20 2020 2066 6f72 2070 2069 6e20  [].    for p in 
+00016fc0: 6876 7372 5f6f 7574 5b27 6876 7372 5f70  hvsr_out['hvsr_p
+00016fd0: 6561 6b5f 696e 6469 6365 7327 5d3a 0a20  eak_indices']:. 
+00016fe0: 2020 2020 2020 2068 7673 7250 462e 6170         hvsrPF.ap
+00016ff0: 7065 6e64 2868 7673 725f 6f75 745b 2778  pend(hvsr_out['x
+00017000: 5f66 7265 7173 275d 5b61 6e79 4b5d 5b70  _freqs'][anyK][p
+00017010: 5d29 0a20 2020 2068 7673 725f 6f75 745b  ]).    hvsr_out[
+00017020: 2768 7673 725f 7065 616b 5f66 7265 7173  'hvsr_peak_freqs
+00017030: 275d 203d 206e 702e 6172 7261 7928 6876  '] = np.array(hv
+00017040: 7372 5046 290a 0a0a 2020 2020 2347 6574  srPF)...    #Get
+00017050: 206f 7468 6572 2048 5653 5220 7061 7261   other HVSR para
+00017060: 6d65 7465 7273 2028 692e 652e 2c20 7374  meters (i.e., st
+00017070: 616e 6461 7264 2064 6576 6961 7469 6f6e  andard deviation
+00017080: 732c 2077 6174 6572 206c 6576 656c 732c  s, water levels,
+00017090: 2065 7463 2e29 0a20 2020 2068 7673 725f   etc.).    hvsr_
+000170a0: 6f75 7420 3d20 5f5f 6765 7468 7673 7270  out = __gethvsrp
+000170b0: 6172 616d 7328 6876 7372 5f6f 7574 290a  arams(hvsr_out).
+000170c0: 0a20 2020 2023 496e 636c 7564 6520 7468  .    #Include th
+000170d0: 6520 6f72 6967 696e 616c 206f 6273 7079  e original obspy
+000170e0: 2073 7472 6561 6d20 696e 2074 6865 206f   stream in the o
+000170f0: 7574 7075 740a 2020 2020 6876 7372 5f6f  utput.    hvsr_o
+00017100: 7574 5b27 7374 7265 616d 275d 203d 2070  ut['stream'] = p
+00017110: 6172 616d 735b 2773 7472 6561 6d27 5d0a  arams['stream'].
+00017120: 0a20 2020 2072 6574 7572 6e20 6876 7372  .    return hvsr
+00017130: 5f6f 7574 0a0a 2348 656c 7065 7220 6675  _out..#Helper fu
+00017140: 6e63 7469 6f6e 2066 6f72 2073 6d6f 6f74  nction for smoot
+00017150: 6869 6e67 2061 6372 6f73 7320 6672 6571  hing across freq
+00017160: 7565 6e63 6965 730a 6465 6620 5f5f 6672  uencies.def __fr
+00017170: 6571 5f73 6d6f 6f74 685f 7769 6e64 6f77  eq_smooth_window
+00017180: 2868 7673 725f 6f75 742c 2066 5f73 6d6f  (hvsr_out, f_smo
+00017190: 6f74 685f 7769 6474 682c 206b 696e 6429  oth_width, kind)
+000171a0: 3a0a 2020 2020 2222 2248 656c 7065 7220  :.    """Helper 
+000171b0: 6675 6e63 7469 6f6e 2074 6f20 736d 6f6f  function to smoo
+000171c0: 7468 2066 7265 7175 656e 6379 2069 6620  th frequency if 
+000171d0: 2763 6f6e 7374 616e 7427 206f 7220 2770  'constant' or 'p
+000171e0: 726f 706f 7274 696f 6e61 6c27 2069 7320  roportional' is 
+000171f0: 7061 7373 6564 2074 6f20 6672 6571 5f73  passed to freq_s
+00017200: 6d6f 6f74 6820 7061 7261 6d65 7465 7220  mooth parameter 
+00017210: 6f66 2070 726f 6365 7373 5f68 7673 7228  of process_hvsr(
+00017220: 2920 6675 6e63 7469 6f6e 2222 220a 2020  ) function""".  
+00017230: 2020 6966 206b 696e 6420 3d3d 2027 636f    if kind == 'co
+00017240: 6e73 7461 6e74 273a 0a20 2020 2020 2020  nstant':.       
+00017250: 2066 7769 6474 6848 616c 6620 3d20 665f   fwidthHalf = f_
+00017260: 736d 6f6f 7468 5f77 6964 7468 2f2f 320a  smooth_width//2.
+00017270: 2020 2020 656c 6966 206b 696e 6420 3d3d      elif kind ==
+00017280: 2027 7072 6f70 6f72 7469 6f6e 616c 273a   'proportional':
+00017290: 0a20 2020 2020 2020 2061 6e79 4b65 7920  .        anyKey 
+000172a0: 3d20 6c69 7374 2868 7673 725f 6f75 745b  = list(hvsr_out[
+000172b0: 2770 7364 5f72 6177 275d 2e6b 6579 7328  'psd_raw'].keys(
+000172c0: 2929 5b30 5d0a 2020 2020 2020 2020 6672  ))[0].        fr
+000172d0: 6571 4c65 6e67 7468 203d 2068 7673 725f  eqLength = hvsr_
+000172e0: 6f75 745b 2770 7364 5f72 6177 275d 5b61  out['psd_raw'][a
+000172f0: 6e79 4b65 795d 2e73 6861 7065 5b31 5d0a  nyKey].shape[1].
+00017300: 2020 2020 2020 2020 6966 2066 5f73 6d6f          if f_smo
+00017310: 6f74 685f 7769 6474 6820 3e20 313a 0a20  oth_width > 1:. 
+00017320: 2020 2020 2020 2020 2020 2066 7769 6474             fwidt
+00017330: 6848 616c 6620 3d20 696e 7428 665f 736d  hHalf = int(f_sm
+00017340: 6f6f 7468 5f77 6964 7468 2f31 3030 202a  ooth_width/100 *
+00017350: 2066 7265 714c 656e 6774 6829 0a20 2020   freqLength).   
+00017360: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00017370: 2020 2020 2020 2066 7769 6474 6848 616c         fwidthHal
+00017380: 6620 3d20 696e 7428 665f 736d 6f6f 7468  f = int(f_smooth
+00017390: 5f77 6964 7468 202a 2066 7265 714c 656e  _width * freqLen
+000173a0: 6774 6829 0a20 2020 2065 6c73 653a 0a20  gth).    else:. 
+000173b0: 2020 2020 2020 2070 7269 6e74 2827 4f6f         print('Oo
+000173c0: 7073 2c20 7479 706f 2073 6f6d 6577 6865  ps, typo somewhe
+000173d0: 7265 2729 0a0a 2020 2020 666f 7220 6b20  re')..    for k 
+000173e0: 696e 2068 7673 725f 6f75 745b 2770 7364  in hvsr_out['psd
+000173f0: 5f72 6177 275d 3a0a 2020 2020 2020 2020  _raw']:.        
+00017400: 6e65 7754 5053 4420 3d20 6c69 7374 286e  newTPSD = list(n
+00017410: 702e 6f6e 6573 5f6c 696b 6528 6876 7372  p.ones_like(hvsr
+00017420: 5f6f 7574 5b27 7073 645f 7261 7727 5d5b  _out['psd_raw'][
+00017430: 6b5d 2929 0a20 2020 2020 2020 2066 6f72  k])).        for
+00017440: 2074 2c20 7450 5344 2069 6e20 656e 756d   t, tPSD in enum
+00017450: 6572 6174 6528 6876 7372 5f6f 7574 5b27  erate(hvsr_out['
+00017460: 7073 645f 7261 7727 5d5b 6b5d 293a 0a20  psd_raw'][k]):. 
+00017470: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00017480: 2c20 6656 616c 2069 6e20 656e 756d 6572  , fVal in enumer
+00017490: 6174 6528 7450 5344 293a 0a20 2020 2020  ate(tPSD):.     
+000174a0: 2020 2020 2020 2020 2020 2069 6620 6920             if i 
+000174b0: 3c20 6677 6964 7468 4861 6c66 3a0a 2020  < fwidthHalf:.  
+000174c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174d0: 2020 646f 776e 5769 6e20 3d20 690a 2020    downWin = i.  
+000174e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174f0: 2020 696e 6420 3d20 2d31 2a28 6677 6964    ind = -1*(fwid
+00017500: 7468 4861 6c66 2d64 6f77 6e57 696e 290a  thHalf-downWin).
+00017510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017520: 2020 2020 7769 6e64 4d75 6c74 6970 6c69      windMultipli
+00017530: 6572 5f64 6f77 6e20 3d20 6e70 2e6c 696e  er_down = np.lin
+00017540: 7370 6163 6528 312f 6677 6964 7468 4861  space(1/fwidthHa
+00017550: 6c66 2c20 312d 312f 6677 6964 7468 4861  lf, 1-1/fwidthHa
+00017560: 6c66 2c20 6677 6964 7468 4861 6c66 290a  lf, fwidthHalf).
+00017570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017580: 2020 2020 7769 6e64 4d75 6c74 6970 6c69      windMultipli
+00017590: 6572 5f64 6f77 6e20 3d20 7769 6e64 4d75  er_down = windMu
+000175a0: 6c74 6970 6c69 6572 5f64 6f77 6e5b 3a69  ltiplier_down[:i
+000175b0: 6e64 5d0a 2020 2020 2020 2020 2020 2020  nd].            
+000175c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000175d0: 2020 2020 2020 2020 2020 2020 2020 646f                do
+000175e0: 776e 5769 6e20 3d20 6677 6964 7468 4861  wnWin = fwidthHa
+000175f0: 6c66 0a20 2020 2020 2020 2020 2020 2020  lf.             
+00017600: 2020 2020 2020 2077 696e 644d 756c 7469         windMulti
+00017610: 706c 6965 725f 646f 776e 203d 2020 6e70  plier_down =  np
+00017620: 2e6c 696e 7370 6163 6528 312f 6677 6964  .linspace(1/fwid
+00017630: 7468 4861 6c66 2c20 312d 312f 6677 6964  thHalf, 1-1/fwid
+00017640: 7468 4861 6c66 2c20 6677 6964 7468 4861  thHalf, fwidthHa
+00017650: 6c66 290a 2020 2020 2020 2020 2020 2020  lf).            
+00017660: 2020 2020 6966 2069 202b 2066 7769 6474      if i + fwidt
+00017670: 6848 616c 6620 3e3d 206c 656e 2874 5053  hHalf >= len(tPS
+00017680: 4429 3a0a 2020 2020 2020 2020 2020 2020  D):.            
+00017690: 2020 2020 2020 2020 7570 5769 6e20 3d20          upWin = 
+000176a0: 286c 656e 2874 5053 4429 202d 2069 290a  (len(tPSD) - i).
+000176b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176c0: 2020 2020 696e 6420 3d20 2d31 202a 2028      ind = -1 * (
+000176d0: 6677 6964 7468 4861 6c66 2d75 7057 696e  fwidthHalf-upWin
+000176e0: 2b31 290a 2020 2020 2020 2020 2020 2020  +1).            
+000176f0: 2020 2020 2020 2020 7769 6e64 4d75 6c74          windMult
+00017700: 6970 6c69 6572 5f75 7020 3d20 6e70 2e6c  iplier_up = np.l
+00017710: 696e 7370 6163 6528 312d 312f 6677 6964  inspace(1-1/fwid
+00017720: 7468 4861 6c66 2c20 302c 2066 7769 6474  thHalf, 0, fwidt
+00017730: 6848 616c 6629 0a20 2020 2020 2020 2020  hHalf).         
+00017740: 2020 2020 2020 2020 2020 2077 696e 644d             windM
+00017750: 756c 7469 706c 6965 725f 7570 203d 2077  ultiplier_up = w
+00017760: 696e 644d 756c 7469 706c 6965 725f 7570  indMultiplier_up
+00017770: 5b3a 696e 645d 0a0a 2020 2020 2020 2020  [:ind]..        
+00017780: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00017790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177a0: 2020 7570 5769 6e20 3d20 6677 6964 7468    upWin = fwidth
+000177b0: 4861 6c66 2b31 0a20 2020 2020 2020 2020  Half+1.         
+000177c0: 2020 2020 2020 2020 2020 2077 696e 644d             windM
+000177d0: 756c 7469 706c 6965 725f 7570 203d 206e  ultiplier_up = n
+000177e0: 702e 6c69 6e73 7061 6365 2831 202d 2031  p.linspace(1 - 1
+000177f0: 2f66 7769 6474 6848 616c 662c 2030 2c20  /fwidthHalf, 0, 
+00017800: 6677 6964 7468 4861 6c66 290a 2020 2020  fwidthHalf).    
+00017810: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00017820: 2020 2020 2020 2020 2077 696e 644d 756c           windMul
+00017830: 7469 706c 6965 7220 3d20 6c69 7374 286e  tiplier = list(n
+00017840: 702e 6873 7461 636b 285b 7769 6e64 4d75  p.hstack([windMu
+00017850: 6c74 6970 6c69 6572 5f64 6f77 6e2c 2077  ltiplier_down, w
+00017860: 696e 644d 756c 7469 706c 6965 725f 7570  indMultiplier_up
+00017870: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
+00017880: 2020 2020 6d69 6449 6e64 203d 206e 702e      midInd = np.
+00017890: 6172 676d 6178 2877 696e 644d 756c 7469  argmax(windMulti
+000178a0: 706c 6965 7229 0a20 2020 2020 2020 2020  plier).         
+000178b0: 2020 2020 2020 2069 6620 6920 3e20 303a         if i > 0:
+000178c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000178d0: 2020 2020 206d 6964 496e 642b 3d31 0a20       midInd+=1. 
+000178e0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+000178f0: 696e 644d 756c 7469 706c 6965 722e 696e  indMultiplier.in
+00017900: 7365 7274 286d 6964 496e 642c 2031 290a  sert(midInd, 1).
+00017910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017920: 736d 6f6f 7468 5661 6c20 3d20 6e70 2e64  smoothVal = np.d
+00017930: 6976 6964 6528 6e70 2e73 756d 286e 702e  ivide(np.sum(np.
+00017940: 6d75 6c74 6970 6c79 2874 5053 445b 692d  multiply(tPSD[i-
+00017950: 646f 776e 5769 6e3a 692b 7570 5769 6e5d  downWin:i+upWin]
+00017960: 2c20 7769 6e64 4d75 6c74 6970 6c69 6572  , windMultiplier
+00017970: 2929 2c20 6e70 2e73 756d 2877 696e 644d  )), np.sum(windM
+00017980: 756c 7469 706c 6965 7229 290a 2020 2020  ultiplier)).    
+00017990: 2020 2020 2020 2020 2020 2020 6e65 7754              newT
+000179a0: 5053 445b 745d 5b69 5d20 3d20 736d 6f6f  PSD[t][i] = smoo
+000179b0: 7468 5661 6c0a 0a20 2020 2020 2020 2068  thVal..        h
+000179c0: 7673 725f 6f75 745b 2770 7364 5f72 6177  vsr_out['psd_raw
+000179d0: 275d 5b6b 5d20 3d20 6e65 7754 5053 440a  '][k] = newTPSD.
+000179e0: 2020 2020 0a20 2020 2072 6574 7572 6e20      .    return 
+000179f0: 6876 7372 5f6f 7574 0a0a 2344 6966 6675  hvsr_out..#Diffu
+00017a00: 7365 2066 6965 6c64 2061 7373 756d 7074  se field assumpt
+00017a10: 696f 6e2c 206e 6f74 2063 7572 7265 6e74  ion, not current
+00017a20: 6c79 2069 6d70 6c65 6d65 6e74 6564 0a64  ly implemented.d
+00017a30: 6566 2064 6661 2870 6172 616d 732c 2064  ef dfa(params, d
+00017a40: 6179 5f74 696d 655f 7661 6c75 6573 2c20  ay_time_values, 
+00017a50: 6461 795f 7469 6d65 5f70 7364 2c20 785f  day_time_psd, x_
+00017a60: 7661 6c75 6573 2c20 6571 7561 6c5f 6461  values, equal_da
+00017a70: 696c 795f 656e 6572 6779 2c20 6d65 6469  ily_energy, medi
+00017a80: 616e 5f64 6169 6c79 5f70 7364 2c20 7665  an_daily_psd, ve
+00017a90: 7262 6f73 6529 3a0a 2020 2020 2222 2246  rbose):.    """F
+00017aa0: 756e 6374 696f 6e20 666f 7220 7065 7266  unction for perf
+00017ab0: 6f72 6d69 6e67 2044 6966 6675 7365 2046  orming Diffuse F
+00017ac0: 6965 6c64 2041 7373 756d 7074 696f 6e20  ield Assumption 
+00017ad0: 2844 4641 2920 616e 616c 7973 6973 0a20  (DFA) analysis. 
+00017ae0: 2020 200a 2020 2020 2020 2020 5468 6973     .        This
+00017af0: 2066 6561 7475 7265 2069 7320 6e6f 7420   feature is not 
+00017b00: 7965 7420 696d 706c 656d 656e 7465 642e  yet implemented.
+00017b10: 0a20 2020 2022 2222 0a20 2020 2023 2041  .    """.    # A
+00017b20: 7265 2077 6520 646f 696e 6720 4446 413f  re we doing DFA?
+00017b30: 0a20 2020 2023 2055 7365 2065 7175 616c  .    # Use equal
+00017b40: 2065 6e65 7267 7920 666f 7220 6461 696c   energy for dail
+00017b50: 7920 5053 4473 2074 6f20 6769 7665 2073  y PSDs to give s
+00017b60: 6d61 6c6c 2027 6576 656e 7473 2720 6120  mall 'events' a 
+00017b70: 6368 616e 6365 2074 6f20 636f 6e74 7269  chance to contri
+00017b80: 6275 7465 0a20 2020 2023 2074 6865 2073  bute.    # the s
+00017b90: 616d 6520 6173 206c 6172 6765 206f 6e65  ame as large one
+00017ba0: 732c 2073 6f20 7468 6174 2050 312b 5032  s, so that P1+P2
+00017bb0: 2b50 333d 310a 2020 2020 0a20 2020 206d  +P3=1.    .    m
+00017bc0: 6574 686f 643d 7061 7261 6d73 5b27 6d65  ethod=params['me
+00017bd0: 7468 6f64 275d 0a20 2020 200a 2020 2020  thod'].    .    
+00017be0: 6d65 7468 6f64 4c69 7374 203d 205b 2744  methodList = ['D
+00017bf0: 6966 6675 7365 2046 6965 6c64 2041 7373  iffuse Field Ass
+00017c00: 756d 7074 696f 6e27 2c20 2741 7269 7468  umption', 'Arith
+00017c10: 6d65 7469 6320 4d65 616e 272c 2027 4765  metic Mean', 'Ge
+00017c20: 6f6d 6574 7269 6320 4d65 616e 272c 2027  ometric Mean', '
+00017c30: 5665 6374 6f72 2053 756d 6d61 7469 6f6e  Vector Summation
+00017c40: 272c 2027 5175 6164 7261 7469 6320 4d65  ', 'Quadratic Me
+00017c50: 616e 272c 2027 4d61 7869 6d75 6d20 486f  an', 'Maximum Ho
+00017c60: 7269 7a6f 6e74 616c 2056 616c 7565 275d  rizontal Value']
+00017c70: 0a20 2020 2064 6661 4c69 7374 203d 205b  .    dfaList = [
+00017c80: 2764 6661 272c 2027 6469 6666 7573 6520  'dfa', 'diffuse 
+00017c90: 6669 656c 6427 2c20 2764 6966 6675 7365  field', 'diffuse
+00017ca0: 2066 6965 6c64 2061 7373 756d 7074 696f   field assumptio
+00017cb0: 6e27 5d0a 2020 2020 6966 2074 7970 6528  n'].    if type(
+00017cc0: 6d65 7468 6f64 2920 6973 2069 6e74 3a0a  method) is int:.
+00017cd0: 2020 2020 2020 2020 6d65 7468 6f64 203d          method =
+00017ce0: 206d 6574 686f 644c 6973 745b 6d65 7468   methodList[meth
+00017cf0: 6f64 5d0a 2020 2020 2020 2020 0a20 2020  od].        .   
+00017d00: 2069 6620 6d65 7468 6f64 2069 6e20 6466   if method in df
+00017d10: 614c 6973 743a 0a20 2020 2020 2020 2069  aList:.        i
+00017d20: 6620 7665 7262 6f73 653a 0a20 2020 2020  f verbose:.     
+00017d30: 2020 2020 2020 2070 7269 6e74 2827 5b49         print('[I
+00017d40: 4e46 4f5d 2044 6966 6675 7365 2046 6965  NFO] Diffuse Fie
+00017d50: 6c64 2041 7373 756d 7074 696f 6e27 2c20  ld Assumption', 
+00017d60: 666c 7573 683d 5472 7565 290a 2020 2020  flush=True).    
+00017d70: 2020 2020 2020 2020 6469 7370 6c61 7920          display 
+00017d80: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00017d90: 7375 6d5f 6e73 5f70 6f77 6572 203d 206c  sum_ns_power = l
+00017da0: 6973 7428 290a 2020 2020 2020 2020 7375  ist().        su
+00017db0: 6d5f 6577 5f70 6f77 6572 203d 206c 6973  m_ew_power = lis
+00017dc0: 7428 290a 2020 2020 2020 2020 7375 6d5f  t().        sum_
+00017dd0: 7a5f 706f 7765 7220 3d20 6c69 7374 2829  z_power = list()
+00017de0: 0a20 2020 2020 2020 2064 6169 6c79 5f70  .        daily_p
+00017df0: 7364 203d 205b 7b7d 2c20 7b7d 2c20 7b7d  sd = [{}, {}, {}
+00017e00: 5d0a 2020 2020 2020 2020 6461 795f 7661  ].        day_va
+00017e10: 6c75 6573 203d 206c 6973 7428 290a 0a20  lues = list().. 
+00017e20: 2020 2020 2020 2023 204d 616b 6520 7375         # Make su
+00017e30: 7265 2077 6520 6861 7665 2061 6c6c 2033  re we have all 3
+00017e40: 2063 6f6d 706f 6e65 6e74 7320 666f 7220   components for 
+00017e50: 6576 6572 7920 7469 6d65 2073 616d 706c  every time sampl
+00017e60: 650a 2020 2020 2020 2020 666f 7220 6461  e.        for da
+00017e70: 795f 7469 6d65 2069 6e20 6461 795f 7469  y_time in day_ti
+00017e80: 6d65 5f76 616c 7565 733a 0a20 2020 2020  me_values:.     
+00017e90: 2020 2020 2020 2069 6620 6461 795f 7469         if day_ti
+00017ea0: 6d65 206e 6f74 2069 6e20 2864 6179 5f74  me not in (day_t
+00017eb0: 696d 655f 7073 645b 305d 2e6b 6579 7328  ime_psd[0].keys(
+00017ec0: 2929 206f 7220 6461 795f 7469 6d65 206e  )) or day_time n
+00017ed0: 6f74 2069 6e20 2864 6179 5f74 696d 655f  ot in (day_time_
+00017ee0: 7073 645b 315d 2e6b 6579 7328 2929 206f  psd[1].keys()) o
+00017ef0: 7220 6461 795f 7469 6d65 206e 6f74 2069  r day_time not i
+00017f00: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
+00017f10: 6461 795f 7469 6d65 5f70 7364 5b32 5d2e  day_time_psd[2].
+00017f20: 6b65 7973 2829 293a 0a20 2020 2020 2020  keys()):.       
+00017f30: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00017f40: 650a 2020 2020 2020 2020 2020 2020 6461  e.            da
+00017f50: 7920 3d20 6461 795f 7469 6d65 2e73 706c  y = day_time.spl
+00017f60: 6974 2827 5427 295b 305d 0a20 2020 2020  it('T')[0].     
+00017f70: 2020 2020 2020 2069 6620 6461 7920 6e6f         if day no
+00017f80: 7420 696e 2064 6179 5f76 616c 7565 733a  t in day_values:
+00017f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017fa0: 2064 6179 5f76 616c 7565 732e 6170 7065   day_values.appe
+00017fb0: 6e64 2864 6179 290a 0a20 2020 2020 2020  nd(day)..       
+00017fc0: 2020 2020 2023 2049 6e69 7469 616c 697a       # Initializ
+00017fd0: 6520 7468 6520 6461 696c 7920 5053 4473  e the daily PSDs
+00017fe0: 2e0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00017ff0: 2064 6179 206e 6f74 2069 6e20 6461 696c   day not in dail
+00018000: 795f 7073 645b 305d 2e6b 6579 7328 293a  y_psd[0].keys():
+00018010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018020: 2064 6169 6c79 5f70 7364 5b30 5d5b 6461   daily_psd[0][da
+00018030: 795d 203d 206c 6973 7428 290a 2020 2020  y] = list().    
+00018040: 2020 2020 2020 2020 2020 2020 6461 696c              dail
+00018050: 795f 7073 645b 315d 5b64 6179 5d20 3d20  y_psd[1][day] = 
+00018060: 6c69 7374 2829 0a20 2020 2020 2020 2020  list().         
+00018070: 2020 2020 2020 2064 6169 6c79 5f70 7364         daily_psd
+00018080: 5b32 5d5b 6461 795d 203d 206c 6973 7428  [2][day] = list(
+00018090: 290a 0a20 2020 2020 2020 2020 2020 2064  )..            d
+000180a0: 6169 6c79 5f70 7364 5b30 5d5b 6461 795d  aily_psd[0][day]
+000180b0: 2e61 7070 656e 6428 6461 795f 7469 6d65  .append(day_time
+000180c0: 5f70 7364 5b30 5d5b 6461 795f 7469 6d65  _psd[0][day_time
+000180d0: 5d29 0a20 2020 2020 2020 2020 2020 2064  ]).            d
+000180e0: 6169 6c79 5f70 7364 5b31 5d5b 6461 795d  aily_psd[1][day]
+000180f0: 2e61 7070 656e 6428 6461 795f 7469 6d65  .append(day_time
+00018100: 5f70 7364 5b31 5d5b 6461 795f 7469 6d65  _psd[1][day_time
+00018110: 5d29 0a20 2020 2020 2020 2020 2020 2064  ]).            d
+00018120: 6169 6c79 5f70 7364 5b32 5d5b 6461 795d  aily_psd[2][day]
+00018130: 2e61 7070 656e 6428 6461 795f 7469 6d65  .append(day_time
+00018140: 5f70 7364 5b32 5d5b 6461 795f 7469 6d65  _psd[2][day_time
+00018150: 5d29 0a0a 2020 2020 2020 2020 2320 466f  ])..        # Fo
+00018160: 7220 6561 6368 2064 6179 2065 7175 616c  r each day equal
+00018170: 697a 6520 656e 6572 6779 0a20 2020 2020  ize energy.     
+00018180: 2020 2066 6f72 2064 6179 2069 6e20 6461     for day in da
+00018190: 795f 7661 6c75 6573 3a0a 0a20 2020 2020  y_values:..     
+000181a0: 2020 2020 2020 2023 2045 6163 6820 5053         # Each PS
+000181b0: 4420 666f 7220 7468 6520 6461 790a 2020  D for the day.  
+000181c0: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+000181d0: 696e 2072 616e 6765 286c 656e 2864 6169  in range(len(dai
+000181e0: 6c79 5f70 7364 5b30 5d5b 6461 795d 2929  ly_psd[0][day]))
+000181f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018200: 2020 507a 203d 206c 6973 7428 290a 2020    Pz = list().  
+00018210: 2020 2020 2020 2020 2020 2020 2020 5031                P1
+00018220: 203d 206c 6973 7428 290a 2020 2020 2020   = list().      
+00018230: 2020 2020 2020 2020 2020 5032 203d 206c            P2 = l
+00018240: 6973 7428 290a 2020 2020 2020 2020 2020  ist().          
+00018250: 2020 2020 2020 7375 6d5f 707a 203d 2030        sum_pz = 0
+00018260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018270: 2073 756d 5f70 3120 3d20 300a 2020 2020   sum_p1 = 0.    
+00018280: 2020 2020 2020 2020 2020 2020 7375 6d5f              sum_
+00018290: 7032 203d 2030 0a0a 2020 2020 2020 2020  p2 = 0..        
+000182a0: 2020 2020 2020 2020 2320 4561 6368 2073          # Each s
+000182b0: 616d 706c 6520 6f66 2074 6865 2050 5344  ample of the PSD
+000182c0: 202c 2063 6f6e 7665 7274 2074 6f20 706f   , convert to po
+000182d0: 7765 720a 2020 2020 2020 2020 2020 2020  wer.            
+000182e0: 2020 2020 666f 7220 6a20 696e 2072 616e      for j in ran
+000182f0: 6765 286c 656e 2878 5f76 616c 7565 7329  ge(len(x_values)
+00018300: 202d 2031 293a 0a20 2020 2020 2020 2020   - 1):.         
+00018310: 2020 2020 2020 2020 2020 2070 7a20 3d20             pz = 
+00018320: 5f5f 6765 745f 706f 7765 7228 5b64 6169  __get_power([dai
+00018330: 6c79 5f70 7364 5b30 5d5b 6461 795d 5b69  ly_psd[0][day][i
+00018340: 5d5b 6a5d 2c20 6461 696c 795f 7073 645b  ][j], daily_psd[
+00018350: 305d 5b64 6179 5d5b 695d 5b6a 202b 2031  0][day][i][j + 1
+00018360: 5d5d 2c20 5b78 5f76 616c 7565 735b 6a5d  ]], [x_values[j]
+00018370: 2c20 785f 7661 6c75 6573 5b6a 202b 2031  , x_values[j + 1
+00018380: 5d5d 290a 2020 2020 2020 2020 2020 2020  ]]).            
+00018390: 2020 2020 2020 2020 507a 2e61 7070 656e          Pz.appen
+000183a0: 6428 707a 290a 2020 2020 2020 2020 2020  d(pz).          
+000183b0: 2020 2020 2020 2020 2020 7375 6d5f 707a            sum_pz
+000183c0: 202b 3d20 707a 0a20 2020 2020 2020 2020   += pz.         
+000183d0: 2020 2020 2020 2020 2020 2070 3120 3d20             p1 = 
+000183e0: 5f5f 6765 745f 706f 7765 7228 5b64 6169  __get_power([dai
+000183f0: 6c79 5f70 7364 5b31 5d5b 6461 795d 5b69  ly_psd[1][day][i
+00018400: 5d5b 6a5d 2c20 6461 696c 795f 7073 645b  ][j], daily_psd[
+00018410: 315d 5b64 6179 5d5b 695d 5b6a 202b 2031  1][day][i][j + 1
+00018420: 5d5d 2c20 5b78 5f76 616c 7565 735b 6a5d  ]], [x_values[j]
+00018430: 2c20 785f 7661 6c75 6573 5b6a 202b 2031  , x_values[j + 1
+00018440: 5d5d 290a 2020 2020 2020 2020 2020 2020  ]]).            
+00018450: 2020 2020 2020 2020 5031 2e61 7070 656e          P1.appen
+00018460: 6428 7031 290a 2020 2020 2020 2020 2020  d(p1).          
+00018470: 2020 2020 2020 2020 2020 7375 6d5f 7031            sum_p1
+00018480: 202b 3d20 7031 0a20 2020 2020 2020 2020   += p1.         
+00018490: 2020 2020 2020 2020 2020 2070 3220 3d20             p2 = 
+000184a0: 5f5f 6765 745f 706f 7765 7228 5b64 6169  __get_power([dai
+000184b0: 6c79 5f70 7364 5b32 5d5b 6461 795d 5b69  ly_psd[2][day][i
+000184c0: 5d5b 6a5d 2c20 6461 696c 795f 7073 645b  ][j], daily_psd[
+000184d0: 325d 5b64 6179 5d5b 695d 5b6a 202b 2031  2][day][i][j + 1
+000184e0: 5d5d 2c20 5b78 5f76 616c 7565 735b 6a5d  ]], [x_values[j]
+000184f0: 2c20 785f 7661 6c75 6573 5b6a 202b 2031  , x_values[j + 1
+00018500: 5d5d 290a 2020 2020 2020 2020 2020 2020  ]]).            
+00018510: 2020 2020 2020 2020 5032 2e61 7070 656e          P2.appen
+00018520: 6428 7032 290a 2020 2020 2020 2020 2020  d(p2).          
+00018530: 2020 2020 2020 2020 2020 7375 6d5f 7032            sum_p2
+00018540: 202b 3d20 7032 0a0a 2020 2020 2020 2020   += p2..        
+00018550: 2020 2020 2020 2020 7375 6d5f 706f 7765          sum_powe
+00018560: 7220 3d20 7375 6d5f 707a 202b 2073 756d  r = sum_pz + sum
+00018570: 5f70 3120 2b20 7375 6d5f 7032 2020 2320  _p1 + sum_p2  # 
+00018580: 746f 7461 6c20 706f 7765 720a 0a20 2020  total power..   
+00018590: 2020 2020 2020 2020 2020 2020 2023 204d               # M
+000185a0: 6f72 6d61 6c69 7a65 6420 706f 7765 720a  ormalized power.
+000185b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185c0: 666f 7220 6a20 696e 2072 616e 6765 286c  for j in range(l
+000185d0: 656e 2878 5f76 616c 7565 7329 202d 2031  en(x_values) - 1
+000185e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000185f0: 2020 2020 2020 2023 2049 6e69 7469 616c         # Initial
+00018600: 697a 6520 6966 2074 6869 7320 6973 2074  ize if this is t
+00018610: 6865 2066 6972 7374 2073 616d 706c 6520  he first sample 
+00018620: 6f66 2074 6865 2064 6179 0a20 2020 2020  of the day.     
+00018630: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00018640: 6620 6920 3d3d 2030 3a0a 2020 2020 2020  f i == 0:.      
+00018650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018660: 2020 7375 6d5f 7a5f 706f 7765 722e 6170    sum_z_power.ap
+00018670: 7065 6e64 2850 7a5b 6a5d 202f 2073 756d  pend(Pz[j] / sum
+00018680: 5f70 6f77 6572 290a 2020 2020 2020 2020  _power).        
+00018690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000186a0: 7375 6d5f 6e73 5f70 6f77 6572 2e61 7070  sum_ns_power.app
+000186b0: 656e 6428 5031 5b6a 5d20 2f20 7375 6d5f  end(P1[j] / sum_
+000186c0: 706f 7765 7229 0a20 2020 2020 2020 2020  power).         
+000186d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000186e0: 756d 5f65 775f 706f 7765 722e 6170 7065  um_ew_power.appe
+000186f0: 6e64 2850 325b 6a5d 202f 2073 756d 5f70  nd(P2[j] / sum_p
+00018700: 6f77 6572 290a 2020 2020 2020 2020 2020  ower).          
+00018710: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00018720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018730: 2020 2020 2020 2020 7375 6d5f 7a5f 706f          sum_z_po
+00018740: 7765 725b 6a5d 202b 3d20 2850 7a5b 6a5d  wer[j] += (Pz[j]
+00018750: 202f 2073 756d 5f70 6f77 6572 290a 2020   / sum_power).  
+00018760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018770: 2020 2020 2020 7375 6d5f 6e73 5f70 6f77        sum_ns_pow
+00018780: 6572 5b6a 5d20 2b3d 2028 5031 5b6a 5d20  er[j] += (P1[j] 
+00018790: 2f20 7375 6d5f 706f 7765 7229 0a20 2020  / sum_power).   
+000187a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000187b0: 2020 2020 2073 756d 5f65 775f 706f 7765       sum_ew_powe
+000187c0: 725b 6a5d 202b 3d20 2850 325b 6a5d 202f  r[j] += (P2[j] /
+000187d0: 2073 756d 5f70 6f77 6572 290a 2020 2020   sum_power).    
+000187e0: 2020 2020 2020 2020 2320 4176 6572 6167          # Averag
+000187f0: 6520 7468 6520 6e6f 726d 616c 697a 6564  e the normalized
+00018800: 2064 6169 6c79 2070 6f77 6572 0a20 2020   daily power.   
+00018810: 2020 2020 2020 2020 2066 6f72 206a 2069           for j i
+00018820: 6e20 7261 6e67 6528 6c65 6e28 785f 7661  n range(len(x_va
+00018830: 6c75 6573 2920 2d20 3129 3a0a 2020 2020  lues) - 1):.    
+00018840: 2020 2020 2020 2020 2020 2020 7375 6d5f              sum_
+00018850: 7a5f 706f 7765 725b 6a5d 202f 3d20 6c65  z_power[j] /= le
+00018860: 6e28 6461 696c 795f 7073 645b 305d 5b64  n(daily_psd[0][d
+00018870: 6179 5d29 0a20 2020 2020 2020 2020 2020  ay]).           
+00018880: 2020 2020 2073 756d 5f6e 735f 706f 7765       sum_ns_powe
+00018890: 725b 6a5d 202f 3d20 6c65 6e28 6461 696c  r[j] /= len(dail
+000188a0: 795f 7073 645b 305d 5b64 6179 5d29 0a20  y_psd[0][day]). 
+000188b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000188c0: 756d 5f65 775f 706f 7765 725b 6a5d 202f  um_ew_power[j] /
+000188d0: 3d20 6c65 6e28 6461 696c 795f 7073 645b  = len(daily_psd[
+000188e0: 305d 5b64 6179 5d29 0a0a 2020 2020 2020  0][day])..      
+000188f0: 2020 2020 2020 6571 7561 6c5f 6461 696c        equal_dail
+00018900: 795f 656e 6572 6779 5b30 5d5b 6461 795d  y_energy[0][day]
+00018910: 203d 2073 756d 5f7a 5f70 6f77 6572 0a20   = sum_z_power. 
+00018920: 2020 2020 2020 2020 2020 2065 7175 616c             equal
+00018930: 5f64 6169 6c79 5f65 6e65 7267 795b 315d  _daily_energy[1]
+00018940: 5b64 6179 5d20 3d20 7375 6d5f 6e73 5f70  [day] = sum_ns_p
+00018950: 6f77 6572 0a20 2020 2020 2020 2020 2020  ower.           
+00018960: 2065 7175 616c 5f64 6169 6c79 5f65 6e65   equal_daily_ene
+00018970: 7267 795b 325d 5b64 6179 5d20 3d20 7375  rgy[2][day] = su
+00018980: 6d5f 6577 5f70 6f77 6572 0a0a 2020 2020  m_ew_power..    
+00018990: 7265 7475 726e 200a 0a20 2020 200a 2020  return ..    .  
+000189a0: 2020 7265 7475 726e 0a0a 2347 6574 2061    return..#Get a
+000189b0: 6e20 4856 5352 2063 7572 7665 2c20 6769  n HVSR curve, gi
+000189c0: 7665 6e20 616e 2061 7272 6179 206f 6620  ven an array of 
+000189d0: 7820 7661 6c75 6573 2028 6672 6571 7329  x values (freqs)
+000189e0: 2c20 616e 6420 6120 6469 6374 2077 6974  , and a dict wit
+000189f0: 6820 7073 6473 2066 6f72 2074 6872 6565  h psds for three
+00018a00: 2063 6f6d 706f 6e65 6e74 730a 6465 6620   components.def 
+00018a10: 5f5f 6765 745f 6876 7372 5f63 7572 7665  __get_hvsr_curve
+00018a20: 2878 2c20 7073 642c 206d 6574 686f 643d  (x, psd, method=
+00018a30: 3429 3a0a 2020 2020 2222 2220 4765 7420  4):.    """ Get 
+00018a40: 616e 2048 5653 5220 6375 7276 6520 6672  an HVSR curve fr
+00018a50: 6f6d 2074 6872 6565 2063 6f6d 706f 6e65  om three compone
+00018a60: 6e74 7320 6f76 6572 2074 6865 2073 616d  nts over the sam
+00018a70: 6520 7469 6d65 2070 6572 696f 642f 6672  e time period/fr
+00018a80: 6571 7565 6e63 7920 696e 7465 7276 616c  equency interval
+00018a90: 730a 0a20 2020 2050 6172 616d 6574 6572  s..    Parameter
+00018aa0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+00018ab0: 0a20 2020 2020 2020 2078 2020 203a 206c  .        x   : l
+00018ac0: 6973 7420 6f72 2061 7272 6179 5f6c 696b  ist or array_lik
+00018ad0: 650a 2020 2020 2020 2020 2020 2020 7820  e.            x 
+00018ae0: 7661 6c75 6520 2866 7265 7175 656e 6379  value (frequency
+00018af0: 206f 7220 7065 7269 6f64 290a 2020 2020   or period).    
+00018b00: 2020 2020 7073 6420 3a20 6469 6374 0a20      psd : dict. 
+00018b10: 2020 2020 2020 2020 2020 2044 6963 7469             Dicti
+00018b20: 6f6e 6172 7920 7769 7468 2070 7364 2076  onary with psd v
+00018b30: 616c 7565 7320 666f 7220 7468 7265 6520  alues for three 
+00018b40: 636f 6d70 6f6e 656e 7473 2e20 5573 7561  components. Usua
+00018b50: 6c6c 7920 7265 6164 2069 6e20 6173 2070  lly read in as p
+00018b60: 6172 7420 6f66 2068 7673 725f 6469 6374  art of hvsr_dict
+00018b70: 2066 726f 6d20 7072 6f63 6573 735f 6876   from process_hv
+00018b80: 7372 0a20 2020 2020 2020 206d 6574 686f  sr.        metho
+00018b90: 6420 3a20 696e 7420 6f72 2073 7472 0a20  d : int or str. 
+00018ba0: 2020 2020 2020 2020 2020 2049 6e74 6567             Integ
+00018bb0: 6572 206f 7220 7374 7269 6e67 2c20 7265  er or string, re
+00018bc0: 6164 2069 6e20 6672 6f6d 2070 726f 6365  ad in from proce
+00018bd0: 7373 5f68 7673 7220 6d65 7468 6f64 2070  ss_hvsr method p
+00018be0: 6172 616d 6574 6572 0a20 2020 200a 2020  arameter.    .  
+00018bf0: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+00018c00: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6876  -----.        hv
+00018c10: 7372 5f63 7572 7665 2020 3a20 6c69 7374  sr_curve  : list
+00018c20: 0a20 2020 2020 2020 2020 2020 204c 6973  .            Lis
+00018c30: 7420 636f 6e74 6169 6e69 6e67 2048 2f56  t containing H/V
+00018c40: 2072 6174 696f 7320 6174 2065 6163 6820   ratios at each 
+00018c50: 6672 6571 7565 6e63 792f 7065 7269 6f64  frequency/period
+00018c60: 2069 6e20 780a 2020 2020 2222 220a 2020   in x.    """.  
+00018c70: 2020 6966 206d 6574 686f 643d 3d30 206f    if method==0 o
+00018c80: 7220 6d65 7468 6f64 203d 3d27 6466 6127  r method =='dfa'
+00018c90: 206f 7220 6d65 7468 6f64 3d3d 2744 6966   or method=='Dif
+00018ca0: 6675 7365 2046 6965 6c64 2041 7373 756d  fuse Field Assum
+00018cb0: 7074 696f 6e27 3a0a 2020 2020 2020 2020  ption':.        
+00018cc0: 7061 7373 0a20 2020 2020 2020 2070 7269  pass.        pri
+00018cd0: 6e74 2827 4446 4120 6d65 7468 6f64 206e  nt('DFA method n
+00018ce0: 6f74 2063 7572 7265 6e74 6c79 2073 7570  ot currently sup
+00018cf0: 706f 7274 6564 2729 0a20 2020 200a 2020  ported').    .  
+00018d00: 2020 6876 7372 5f63 7572 7665 203d 205b    hvsr_curve = [
+00018d10: 5d0a 2020 2020 666f 7220 6a20 696e 2072  ].    for j in r
+00018d20: 616e 6765 286c 656e 2878 292d 3129 3a0a  ange(len(x)-1):.
+00018d30: 2020 2020 2020 2020 7073 6430 203d 205b          psd0 = [
+00018d40: 7073 645b 275a 275d 5b6a 5d2c 2070 7364  psd['Z'][j], psd
+00018d50: 5b27 5a27 5d5b 6a20 2b20 315d 5d0a 2020  ['Z'][j + 1]].  
+00018d60: 2020 2020 2020 7073 6431 203d 205b 7073        psd1 = [ps
+00018d70: 645b 2745 275d 5b6a 5d2c 2070 7364 5b27  d['E'][j], psd['
+00018d80: 4527 5d5b 6a20 2b20 315d 5d0a 2020 2020  E'][j + 1]].    
+00018d90: 2020 2020 7073 6432 203d 205b 7073 645b      psd2 = [psd[
+00018da0: 274e 275d 5b6a 5d2c 2070 7364 5b27 4e27  'N'][j], psd['N'
+00018db0: 5d5b 6a20 2b20 315d 5d0a 2020 2020 2020  ][j + 1]].      
+00018dc0: 2020 6620 3d20 2020 205b 785b 6a5d 2c20    f =    [x[j], 
+00018dd0: 785b 6a20 2b20 315d 5d0a 0a20 2020 2020  x[j + 1]]..     
+00018de0: 2020 2068 7673 7220 3d20 5f5f 6765 745f     hvsr = __get_
+00018df0: 6876 7372 2870 7364 302c 2070 7364 312c  hvsr(psd0, psd1,
+00018e00: 2070 7364 322c 2066 2c20 7573 655f 6d65   psd2, f, use_me
+00018e10: 7468 6f64 3d6d 6574 686f 6429 0a20 2020  thod=method).   
+00018e20: 2020 2020 2068 7673 725f 6375 7276 652e       hvsr_curve.
+00018e30: 6170 7065 6e64 2868 7673 7229 2020 0a0a  append(hvsr)  ..
+00018e40: 2020 2020 7265 7475 726e 206e 702e 6172      return np.ar
+00018e50: 7261 7928 6876 7372 5f63 7572 7665 290a  ray(hvsr_curve).
+00018e60: 0a23 4765 7420 4856 5352 0a64 6566 205f  .#Get HVSR.def _
+00018e70: 5f67 6574 5f68 7673 7228 5f64 627a 2c20  _get_hvsr(_dbz, 
+00018e80: 5f64 6231 2c20 5f64 6232 2c20 5f78 2c20  _db1, _db2, _x, 
+00018e90: 7573 655f 6d65 7468 6f64 3d34 293a 0a20  use_method=4):. 
+00018ea0: 2020 2022 2222 0a20 2020 205f 6462 7a20     """.    _dbz 
+00018eb0: 3a20 6c69 7374 0a20 2020 2020 2020 2054  : list.        T
+00018ec0: 776f 2069 7465 6d20 6c69 7374 2077 6974  wo item list wit
+00018ed0: 6820 6465 6369 4265 6c20 7661 6c75 6520  h deciBel value 
+00018ee0: 6f66 207a 2063 6f6d 706f 6e65 6e74 2061  of z component a
+00018ef0: 7420 6569 7468 6572 2065 6e64 206f 6620  t either end of 
+00018f00: 7061 7274 6963 756c 6172 2066 7265 7175  particular frequ
+00018f10: 656e 6379 2073 7465 700a 2020 2020 5f64  ency step.    _d
+00018f20: 6231 203a 206c 6973 740a 2020 2020 2020  b1 : list.      
+00018f30: 2020 5477 6f20 6974 656d 206c 6973 7420    Two item list 
+00018f40: 7769 7468 2064 6563 6942 656c 2076 616c  with deciBel val
+00018f50: 7565 206f 6620 6569 7468 6572 2065 206f  ue of either e o
+00018f60: 7220 6e20 636f 6d70 6f6e 656e 7420 2864  r n component (d
+00018f70: 6f65 7320 6e6f 7420 6d61 7474 6572 2077  oes not matter w
+00018f80: 6869 6368 2920 6174 2065 6974 6865 7220  hich) at either 
+00018f90: 656e 6420 6f66 2070 6172 7469 6375 6c61  end of particula
+00018fa0: 7220 6672 6571 7565 6e63 7920 7374 6570  r frequency step
+00018fb0: 0a20 2020 205f 6462 3220 3a20 6c69 7374  .    _db2 : list
+00018fc0: 0a20 2020 2020 2020 2054 776f 2069 7465  .        Two ite
+00018fd0: 6d20 6c69 7374 2077 6974 6820 6465 6369  m list with deci
+00018fe0: 4265 6c20 7661 6c75 6520 6f66 2065 6974  Bel value of eit
+00018ff0: 6865 7220 6520 6f72 206e 2063 6f6d 706f  her e or n compo
+00019000: 6e65 6e74 2028 646f 6573 206e 6f74 206d  nent (does not m
+00019010: 6174 7465 7220 7768 6963 6829 2061 7420  atter which) at 
+00019020: 6569 7468 6572 2065 6e64 206f 6620 7061  either end of pa
+00019030: 7274 6963 756c 6172 2066 7265 7175 656e  rticular frequen
+00019040: 6379 2073 7465 700a 2020 2020 5f78 203a  cy step.    _x :
+00019050: 206c 6973 740a 2020 2020 2020 2020 5477   list.        Tw
+00019060: 6f20 6974 656d 206c 6973 7420 636f 6e74  o item list cont
+00019070: 6169 6e69 6e67 2066 7265 7175 656e 6379  aining frequency
+00019080: 2076 616c 7565 7320 6174 2065 6974 6865   values at eithe
+00019090: 7220 656e 6420 6f66 2066 7265 7175 656e  r end of frequen
+000190a0: 6379 2073 7465 7020 6f66 2069 6e74 6572  cy step of inter
+000190b0: 6573 740a 2020 2020 7573 655f 6d65 7468  est.    use_meth
+000190c0: 6f64 203a 2069 6e74 2c20 6465 6661 756c  od : int, defaul
+000190d0: 7420 3d20 340a 2020 2020 2020 2020 4820  t = 4.        H 
+000190e0: 6973 2063 6f6d 7075 7465 6420 6261 7365  is computed base
+000190f0: 6420 6f6e 2074 6865 2073 656c 6563 7465  d on the selecte
+00019100: 6420 7573 655f 6d65 7468 6f64 2073 6565  d use_method see
+00019110: 3a20 6874 7470 733a 2f2f 6163 6164 656d  : https://academ
+00019120: 6963 2e6f 7570 2e63 6f6d 2f67 6a69 2f61  ic.oup.com/gji/a
+00019130: 7274 6963 6c65 2f31 3934 2f32 2f39 3336  rticle/194/2/936
+00019140: 2f35 3937 3431 350a 2020 2020 2020 2020  /597415.        
+00019150: 2020 2020 7573 655f 6d65 7468 6f64 3a0a      use_method:.
+00019160: 2020 2020 2020 2020 2020 2020 2831 2920              (1) 
+00019170: 4469 6666 7573 6520 4669 656c 6420 4173  Diffuse Field As
+00019180: 7375 6d70 7469 6f6e 2028 4446 4129 0a20  sumption (DFA). 
+00019190: 2020 2020 2020 2020 2020 2028 3229 2061             (2) a
+000191a0: 7269 7468 6d65 7469 6320 6d65 616e 2c20  rithmetic mean, 
+000191b0: 7468 6174 2069 732c 2048 20e2 89a1 2028  that is, H ... (
+000191c0: 484e 202b 2048 4529 2f32 0a20 2020 2020  HN + HE)/2.     
+000191d0: 2020 2020 2020 2028 3329 2067 656f 6d65         (3) geome
+000191e0: 7472 6963 206d 6561 6e2c 2074 6861 7420  tric mean, that 
+000191f0: 6973 2c20 4820 e289 a120 e288 9a48 4e20  is, H ... ...HN 
+00019200: c2b7 2048 452c 2072 6563 6f6d 6d65 6e64  .. HE, recommend
+00019210: 6564 2062 7920 7468 6520 5345 5341 4d45  ed by the SESAME
+00019220: 2070 726f 6a65 6374 2028 3230 3034 290a   project (2004).
+00019230: 2020 2020 2020 2020 2020 2020 2834 2920              (4) 
+00019240: 7665 6374 6f72 2073 756d 6d61 7469 6f6e  vector summation
+00019250: 2c20 7468 6174 2069 732c 2048 20e2 89a1  , that is, H ...
+00019260: 20e2 889a 4832 204e 202b 2048 3220 450a   ...H2 N + H2 E.
+00019270: 2020 2020 2020 2020 2020 2020 2835 2920              (5) 
+00019280: 7175 6164 7261 7469 6320 6d65 616e 2c20  quadratic mean, 
+00019290: 7468 6174 2069 732c 2048 20e2 89a1 20e2  that is, H ... .
+000192a0: 889a 2848 3220 4e20 2b20 4832 2045 2029  ..(H2 N + H2 E )
+000192b0: 2f32 0a20 2020 2020 2020 2020 2020 2028  /2.            (
+000192c0: 3629 206d 6178 696d 756d 2068 6f72 697a  6) maximum horiz
+000192d0: 6f6e 7461 6c20 7661 6c75 652c 2074 6861  ontal value, tha
+000192e0: 7420 6973 2c20 4820 e289 a120 6d61 7820  t is, H ... max 
+000192f0: 7b48 4e2c 2048 457d 0a20 2020 2020 2020  {HN, HE}.       
+00019300: 2022 2222 0a0a 2020 2020 5f70 7a20 3d20   """..    _pz = 
+00019310: 5f5f 6765 745f 706f 7765 7228 5f64 627a  __get_power(_dbz
+00019320: 2c20 5f78 290a 2020 2020 5f70 3120 3d20  , _x).    _p1 = 
+00019330: 5f5f 6765 745f 706f 7765 7228 5f64 6231  __get_power(_db1
+00019340: 2c20 5f78 290a 2020 2020 5f70 3220 3d20  , _x).    _p2 = 
+00019350: 5f5f 6765 745f 706f 7765 7228 5f64 6232  __get_power(_db2
+00019360: 2c20 5f78 290a 2020 2020 0a20 2020 205f  , _x).    .    _
+00019370: 687a 203d 206d 6174 682e 7371 7274 285f  hz = math.sqrt(_
+00019380: 707a 290a 2020 2020 5f68 3120 3d20 6d61  pz).    _h1 = ma
+00019390: 7468 2e73 7172 7428 5f70 3129 0a20 2020  th.sqrt(_p1).   
+000193a0: 205f 6832 203d 206d 6174 682e 7371 7274   _h2 = math.sqrt
+000193b0: 285f 7032 290a 0a20 2020 205f 6820 3d20  (_p2)..    _h = 
+000193c0: 7b20 2032 3a20 285f 6831 202b 205f 6832  {  2: (_h1 + _h2
+000193d0: 2920 2f20 322e 302c 2023 4172 6974 686d  ) / 2.0, #Arithm
+000193e0: 6574 6963 206d 6561 6e0a 2020 2020 2020  etic mean.      
+000193f0: 2020 2020 2020 333a 206d 6174 682e 7371        3: math.sq
+00019400: 7274 285f 6831 202a 205f 6832 292c 2023  rt(_h1 * _h2), #
+00019410: 4765 6f6d 6574 7269 6320 6d65 616e 0a20  Geometric mean. 
+00019420: 2020 2020 2020 2020 2020 2034 3a20 6d61             4: ma
+00019430: 7468 2e73 7172 7428 5f70 3120 2b20 5f70  th.sqrt(_p1 + _p
+00019440: 3229 2c20 2356 6563 746f 7220 7375 6d6d  2), #Vector summ
+00019450: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
+00019460: 2020 353a 206d 6174 682e 7371 7274 2828    5: math.sqrt((
+00019470: 5f70 3120 2b20 5f70 3229 202f 2032 2e30  _p1 + _p2) / 2.0
+00019480: 292c 2023 5175 6164 7261 7469 6320 6d65  ), #Quadratic me
+00019490: 616e 0a20 2020 2020 2020 2020 2020 2036  an.            6
+000194a0: 3a20 6d61 7828 5f68 312c 205f 6832 297d  : max(_h1, _h2)}
+000194b0: 2023 4d61 7820 686f 7269 7a6f 6e74 616c   #Max horizontal
+000194c0: 2076 616c 7565 0a20 2020 205f 6876 7372   value.    _hvsr
+000194d0: 203d 205f 685b 7573 655f 6d65 7468 6f64   = _h[use_method
+000194e0: 5d20 2f20 5f68 7a0a 2020 2020 7265 7475  ] / _hz.    retu
+000194f0: 726e 205f 6876 7372 0a0a 2346 6f72 2063  rn _hvsr..#For c
+00019500: 6f6e 7665 7274 696e 6720 6442 2073 6361  onverting dB sca
+00019510: 6c65 6420 6461 7461 2074 6f20 706f 7765  led data to powe
+00019520: 7220 756e 6974 730a 6465 6620 5f5f 6765  r units.def __ge
+00019530: 745f 706f 7765 7228 5f64 622c 205f 7829  t_power(_db, _x)
+00019540: 3a0a 2020 2020 2222 2243 616c 6375 6c61  :.    """Calcula
+00019550: 7465 2048 5653 520a 0a20 2020 2023 4652  te HVSR..    #FR
+00019560: 4f4d 204f 5249 4749 4e41 4c20 2849 2074  OM ORIGINAL (I t
+00019570: 6869 6e6b 2074 6869 7320 6973 206f 6e6c  hink this is onl
+00019580: 7920 7374 6570 2036 290a 2020 2020 2020  y step 6).      
+00019590: 2020 556e 646f 2064 6563 6942 656c 2063    Undo deciBel c
+000195a0: 616c 6375 6c61 7469 6f6e 7320 6173 206f  alculations as o
+000195b0: 7574 6c69 6e65 6420 6265 6c6f 773a 0a20  utlined below:. 
+000195c0: 2020 2020 2020 2020 2020 2031 2e20 4469             1. Di
+000195d0: 7669 6469 6e67 2074 6865 2077 696e 646f  viding the windo
+000195e0: 7720 696e 746f 2031 3320 7365 676d 656e  w into 13 segmen
+000195f0: 7473 2068 6176 696e 6720 3735 2520 6f76  ts having 75% ov
+00019600: 6572 6c61 700a 2020 2020 2020 2020 2020  erlap.          
+00019610: 2020 322e 2046 6f72 2065 6163 6820 7365    2. For each se
+00019620: 676d 656e 743a 0a20 2020 2020 2020 2020  gment:.         
+00019630: 2020 2020 2020 2032 2e31 2052 656d 6f76         2.1 Remov
+00019640: 696e 6720 7468 6520 7472 656e 6420 616e  ing the trend an
+00019650: 6420 6d65 616e 0a20 2020 2020 2020 2020  d mean.         
+00019660: 2020 2020 2020 2032 2e32 2041 7070 6c79         2.2 Apply
+00019670: 2061 2031 3025 2073 696e 6520 7461 7065   a 10% sine tape
+00019680: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+00019690: 2020 322e 3320 4646 540a 2020 2020 2020    2.3 FFT.      
+000196a0: 2020 2020 2020 332e 2043 616c 6375 6c61        3. Calcula
+000196b0: 7465 2074 6865 206e 6f72 6d61 6c69 7a65  te the normalize
+000196c0: 6420 5053 440a 2020 2020 2020 2020 2020  d PSD.          
+000196d0: 2020 342e 2041 7665 7261 6765 2074 6865    4. Average the
+000196e0: 2031 3320 5053 4473 2026 2073 6361 6c65   13 PSDs & scale
+000196f0: 2074 6f20 636f 6d70 656e 7361 7465 2066   to compensate f
+00019700: 6f72 2074 6170 6572 696e 670a 2020 2020  or tapering.    
+00019710: 2020 2020 2020 2020 352e 2046 7265 7175          5. Frequ
+00019720: 656e 6379 2d73 6d6f 6f74 6820 7468 6520  ency-smooth the 
+00019730: 6176 6572 6167 6564 2050 5344 206f 7665  averaged PSD ove
+00019740: 7220 312d 6f63 7461 7665 2069 6e74 6572  r 1-octave inter
+00019750: 7661 6c73 2061 7420 312f 382d 6f63 7461  vals at 1/8-octa
+00019760: 7665 2069 6e63 7265 6d65 6e74 730a 2020  ve increments.  
+00019770: 2020 2020 2020 2020 2020 362e 2043 6f6e            6. Con
+00019780: 7665 7274 2070 6f77 6572 2074 6f20 6465  vert power to de
+00019790: 6369 6265 6c73 0a20 2020 2023 454e 4420  cibels.    #END 
+000197a0: 4652 4f4d 204f 5249 4749 4e41 4c0a 0a20  FROM ORIGINAL.. 
+000197b0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+000197c0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+000197d0: 205f 6462 203a 206c 6973 740a 2020 2020   _db : list.    
+000197e0: 2020 2020 5477 6f2d 6974 656d 206c 6973      Two-item lis
+000197f0: 7420 7769 7468 2069 6e64 6976 6964 7561  t with individua
+00019800: 6c20 706f 7765 7220 7661 6c75 6573 2069  l power values i
+00019810: 6e20 6465 6369 6265 6c73 2066 6f72 2073  n decibels for s
+00019820: 7065 6369 6669 6564 2066 7265 7120 7374  pecified freq st
+00019830: 6570 2e0a 2020 2020 5f78 203a 206c 6973  ep..    _x : lis
+00019840: 740a 2020 2020 2020 2020 5477 6f2d 6974  t.        Two-it
+00019850: 656d 206c 6973 7420 7769 7468 2049 6e64  em list with Ind
+00019860: 6976 6964 7561 6c20 7820 7661 6c75 6520  ividual x value 
+00019870: 2865 6974 6865 7220 6672 6571 7565 6e63  (either frequenc
+00019880: 7920 6f72 2070 6572 696f 6429 0a20 2020  y or period).   
+00019890: 200a 2020 2020 5265 7475 726e 730a 2020   .    Returns.  
+000198a0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 5f70    -------.    _p
+000198b0: 203a 2066 6c6f 6174 0a20 2020 2020 2020   : float.       
+000198c0: 2049 6e64 6976 6964 7561 6c20 706f 7765   Individual powe
+000198d0: 7220 7661 6c75 652c 2063 6f6e 7665 7274  r value, convert
+000198e0: 6564 2066 726f 6d20 6465 6369 6265 6c73  ed from decibels
+000198f0: 0a0a 2020 2020 4e4f 5445 0a20 2020 202d  ..    NOTE.    -
+00019900: 2d2d 2d0a 2020 2020 2020 2020 5053 4420  ---.        PSD 
+00019910: 6973 2065 7175 616c 2074 6f20 7468 6520  is equal to the 
+00019920: 706f 7765 7220 6469 7669 6465 6420 6279  power divided by
+00019930: 2074 6865 2077 6964 7468 206f 6620 7468   the width of th
+00019940: 6520 6269 6e0a 2020 2020 2020 2020 2020  e bin.          
+00019950: 5053 4420 3d20 5020 2f20 570a 2020 2020  PSD = P / W.    
+00019960: 2020 2020 2020 6c6f 6728 5053 4429 203d        log(PSD) =
+00019970: 204c 6f67 2850 2920 2d20 6c6f 6728 5729   Log(P) - log(W)
+00019980: 0a20 2020 2020 2020 2020 206c 6f67 2850  .          log(P
+00019990: 2920 3d20 6c6f 6728 5053 4429 202b 206c  ) = log(PSD) + l
+000199a0: 6f67 2857 2920 2068 6572 6520 5720 6973  og(W)  here W is
+000199b0: 2077 6964 7468 2069 6e20 6672 6571 7565   width in freque
+000199c0: 6e63 790a 2020 2020 2020 2020 2020 6c6f  ncy.          lo
+000199d0: 6728 5029 203d 206c 6f67 2850 5344 2920  g(P) = log(PSD) 
+000199e0: 2d20 6c6f 6728 5774 2920 6865 7265 2057  - log(Wt) here W
+000199f0: 7420 6973 2077 6964 7468 2069 6e20 7065  t is width in pe
+00019a00: 7269 6f64 0a0a 2020 2020 666f 7220 6561  riod..    for ea
+00019a10: 6368 2062 696e 2070 6572 666f 726d 2072  ch bin perform r
+00019a20: 6563 7461 6e67 756c 6172 2069 6e74 6567  ectangular integ
+00019a30: 7261 7469 6f6e 2074 6f20 636f 6d70 7574  ration to comput
+00019a40: 6520 706f 7765 720a 2020 2020 706f 7765  e power.    powe
+00019a50: 7220 6973 2061 7373 6967 6e65 6420 746f  r is assigned to
+00019a60: 2074 6865 2070 6f69 6e74 2061 7420 7468   the point at th
+00019a70: 6520 6265 6769 6e69 6e67 206f 6620 7468  e begining of th
+00019a80: 6520 696e 7465 7276 616c 0a20 2020 2020  e interval.     
+00019a90: 2020 2020 5f20 2020 5f0a 2020 2020 2020      _   _.      
+00019aa0: 2020 7c20 7c5f 7c20 7c0a 2020 2020 2020    | |_| |.      
+00019ab0: 2020 7c5f 7c5f 7c5f 7c0a 0a20 2020 2020    |_|_|_|..     
+00019ac0: 4865 7265 2077 6520 6172 6520 636f 6d70  Here we are comp
+00019ad0: 7574 696e 6720 706f 7765 7220 666f 7220  uting power for 
+00019ae0: 696e 6469 7669 6475 616c 2070 6f6e 7473  individual ponts
+00019af0: 2c20 736f 2c20 6e6f 2069 6e74 6567 7261  , so, no integra
+00019b00: 7469 6f6e 2069 7320 6e65 6365 7373 6172  tion is necessar
+00019b10: 792c 206a 7573 740a 2020 2020 2063 6f6d  y, just.     com
+00019b20: 7075 7465 2061 7265 612e 0a20 2020 2022  pute area..    "
+00019b30: 2222 0a20 2020 205f 6478 203d 2061 6273  "".    _dx = abs
+00019b40: 286e 702e 6469 6666 285f 7829 5b30 5d29  (np.diff(_x)[0])
+00019b50: 0a20 2020 205f 7020 3d20 6e70 2e6d 756c  .    _p = np.mul
+00019b60: 7469 706c 7928 6e70 2e6d 6561 6e28 5f5f  tiply(np.mean(__
+00019b70: 7265 6d6f 7665 5f64 6228 5f64 6229 292c  remove_db(_db)),
+00019b80: 205f 6478 290a 2020 2020 7265 7475 726e   _dx).    return
+00019b90: 205f 700a 0a23 5265 6d6f 7665 2064 6563   _p..#Remove dec
+00019ba0: 6962 656c 2073 6361 6c69 6e67 0a64 6566  ibel scaling.def
+00019bb0: 205f 5f72 656d 6f76 655f 6462 285f 6462   __remove_db(_db
+00019bc0: 5f76 616c 7565 293a 0a20 2020 2022 2222  _value):.    """
+00019bd0: 636f 6e76 6572 7420 6442 2070 6f77 6572  convert dB power
+00019be0: 2074 6f20 706f 7765 7222 2222 0a20 2020   to power""".   
+00019bf0: 205f 7661 6c75 6573 203d 206c 6973 7428   _values = list(
+00019c00: 290a 2020 2020 666f 7220 5f64 2069 6e20  ).    for _d in 
+00019c10: 5f64 625f 7661 6c75 653a 0a20 2020 2020  _db_value:.     
+00019c20: 2020 205f 7661 6c75 6573 2e61 7070 656e     _values.appen
+00019c30: 6428 3130 202a 2a20 2866 6c6f 6174 285f  d(10 ** (float(_
+00019c40: 6429 202f 2031 302e 3029 290a 2020 2020  d) / 10.0)).    
+00019c50: 7265 7475 726e 205f 7661 6c75 6573 0a0a  return _values..
+00019c60: 2346 696e 6420 7065 616b 7320 696e 2074  #Find peaks in t
+00019c70: 6865 2068 7673 7220 6363 7275 7665 0a64  he hvsr ccruve.d
+00019c80: 6566 205f 5f66 696e 645f 7065 616b 7328  ef __find_peaks(
+00019c90: 5f79 293a 0a20 2020 2022 2222 4669 6e64  _y):.    """Find
+00019ca0: 7320 616c 6c20 706f 7373 6962 6c65 2070  s all possible p
+00019cb0: 6561 6b73 206f 6e20 6876 7372 2063 7572  eaks on hvsr cur
+00019cc0: 7665 730a 2020 2020 5061 7261 6d65 7465  ves.    Paramete
+00019cd0: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00019ce0: 2d0a 2020 2020 5f79 203a 206c 6973 7420  -.    _y : list 
+00019cf0: 6f72 2061 7272 6179 0a20 2020 2020 2020  or array.       
+00019d00: 205f 7920 696e 7075 7420 6973 206c 6973   _y input is lis
+00019d10: 7420 6f72 2061 7272 6179 206f 6620 6120  t or array of a 
+00019d20: 6375 7276 652e 0a20 2020 2020 2020 2020  curve..         
+00019d30: 2049 6e20 7468 6973 2063 6173 652c 2074   In this case, t
+00019d40: 6869 7320 6973 2065 6974 6865 7220 6d61  his is either ma
+00019d50: 696e 2068 7673 7220 6375 7276 6520 6f72  in hvsr curve or
+00019d60: 2069 6e64 6976 6964 7561 6c20 7469 6d65   individual time
+00019d70: 2073 7465 7020 6375 7276 6573 0a20 2020   step curves.   
+00019d80: 2022 2222 0a20 2020 205f 696e 6465 785f   """.    _index_
+00019d90: 6c69 7374 203d 2073 6369 7079 2e73 6967  list = scipy.sig
+00019da0: 6e61 6c2e 6172 6772 656c 6578 7472 656d  nal.argrelextrem
+00019db0: 6128 6e70 2e61 7272 6179 285f 7929 2c20  a(np.array(_y), 
+00019dc0: 6e70 2e67 7265 6174 6572 290a 0a20 2020  np.greater)..   
+00019dd0: 2072 6574 7572 6e20 5f69 6e64 6578 5f6c   return _index_l
+00019de0: 6973 745b 305d 0a0a 2347 6574 2061 6464  ist[0]..#Get add
+00019df0: 6974 696f 6e61 6c20 4856 5352 2070 6172  itional HVSR par
+00019e00: 616d 7320 666f 7220 6c61 7465 7220 6361  ams for later ca
+00019e10: 6c63 7561 6c74 696f 6e73 0a64 6566 205f  lcualtions.def _
+00019e20: 5f67 6574 6876 7372 7061 7261 6d73 2868  _gethvsrparams(h
+00019e30: 7673 725f 6f75 7429 3a0a 2020 2020 2222  vsr_out):.    ""
+00019e40: 2250 7269 7661 7465 2066 756e 6374 696f  "Private functio
+00019e50: 6e20 746f 2067 6574 2048 5653 5220 7061  n to get HVSR pa
+00019e60: 7261 6d65 7465 7273 2066 6f72 206c 6174  rameters for lat
+00019e70: 6572 2063 616c 6375 6c61 7469 6f6e 7320  er calculations 
+00019e80: 2874 6869 6e67 7320 6c69 6b65 2073 7461  (things like sta
+00019e90: 6e64 6172 6420 6465 7669 6174 696f 6e2c  ndard deviation,
+00019ea0: 2065 7463 2922 2222 0a0a 2020 2020 6876   etc)"""..    hv
+00019eb0: 7372 7032 203d 207b 7d0a 2020 2020 6876  srp2 = {}.    hv
+00019ec0: 7372 6d32 203d 207b 7d0a 2020 2020 0a20  srm2 = {}.    . 
+00019ed0: 2020 2070 6561 6b5f 7761 7465 725f 6c65     peak_water_le
+00019ee0: 7665 6c20 3d20 5b5d 0a20 2020 2070 6561  vel = [].    pea
+00019ef0: 6b5f 7761 7465 725f 6c65 7665 6c5f 703d  k_water_level_p=
+00019f00: 5b5d 0a20 2020 2068 7673 7270 323d 5b5d  [].    hvsrp2=[]
+00019f10: 0a20 2020 2068 7673 726d 3d5b 5d0a 2020  .    hvsrm=[].  
+00019f20: 2020 7065 616b 5f77 6174 6572 5f6c 6576    peak_water_lev
+00019f30: 656c 5f6d 3d5b 5d0a 2020 2020 7761 7465  el_m=[].    wate
+00019f40: 725f 6c65 7665 6c3d 312e 3820 234d 616b  r_level=1.8 #Mak
+00019f50: 6520 7468 6973 2061 6e20 696e 7075 7420  e this an input 
+00019f60: 7061 7261 6d65 7465 7220 6576 656e 7475  parameter eventu
+00019f70: 616c 6c79 2121 212a 2a2a 2a0a 2020 2020  ally!!!****.    
+00019f80: 0a20 2020 2068 7673 725f 6c6f 675f 7374  .    hvsr_log_st
+00019f90: 6420 3d20 7b7d 0a0a 2020 2020 7065 616b  d = {}..    peak
+00019fa0: 5f77 6174 6572 5f6c 6576 656c 2e61 7070  _water_level.app
+00019fb0: 656e 6428 7761 7465 725f 6c65 7665 6c29  end(water_level)
+00019fc0: 0a0a 2020 2020 6876 7372 3d68 7673 725f  ..    hvsr=hvsr_
+00019fd0: 6f75 745b 2768 7673 725f 6375 7276 6527  out['hvsr_curve'
+00019fe0: 5d0a 2020 2020 6966 2068 7673 725f 6f75  ].    if hvsr_ou
+00019ff0: 745b 2769 6e64 5f68 7673 725f 6375 7276  t['ind_hvsr_curv
+0001a000: 6573 275d 2e73 6861 7065 5b30 5d20 3e20  es'].shape[0] > 
+0001a010: 303a 0a20 2020 2020 2020 2068 7673 7270  0:.        hvsrp
+0001a020: 203d 206e 702e 6164 6428 6876 7372 5f6f   = np.add(hvsr_o
+0001a030: 7574 5b27 6876 7372 5f63 7572 7665 275d  ut['hvsr_curve']
+0001a040: 2c20 6876 7372 5f6f 7574 5b27 696e 645f  , hvsr_out['ind_
+0001a050: 6876 7372 5f73 7464 4465 7627 5d29 0a20  hvsr_stdDev']). 
+0001a060: 2020 2020 2020 2068 7673 726d 203d 206e         hvsrm = n
+0001a070: 702e 7375 6274 7261 6374 2868 7673 725f  p.subtract(hvsr_
+0001a080: 6f75 745b 2768 7673 725f 6375 7276 6527  out['hvsr_curve'
+0001a090: 5d2c 2068 7673 725f 6f75 745b 2769 6e64  ], hvsr_out['ind
+0001a0a0: 5f68 7673 725f 7374 6444 6576 275d 290a  _hvsr_stdDev']).
+0001a0b0: 0a20 2020 2020 2020 2068 7673 725f 6c6f  .        hvsr_lo
+0001a0c0: 675f 7374 6420 3d20 6e70 2e73 7464 286e  g_std = np.std(n
+0001a0d0: 702e 6c6f 6731 3028 6876 7372 5f6f 7574  p.log10(hvsr_out
+0001a0e0: 5b27 696e 645f 6876 7372 5f63 7572 7665  ['ind_hvsr_curve
+0001a0f0: 7327 5d29 2c20 6178 6973 3d30 290a 2020  s']), axis=0).  
+0001a100: 2020 2020 2020 6876 7372 7032 203d 206e        hvsrp2 = n
+0001a110: 702e 6d75 6c74 6970 6c79 2868 7673 722c  p.multiply(hvsr,
+0001a120: 206e 702e 6578 7028 6876 7372 5f6c 6f67   np.exp(hvsr_log
+0001a130: 5f73 7464 2929 0a20 2020 2020 2020 2068  _std)).        h
+0001a140: 7673 726d 3220 3d20 6e70 2e64 6976 6964  vsrm2 = np.divid
+0001a150: 6528 6876 7372 2c20 6e70 2e65 7870 2868  e(hvsr, np.exp(h
+0001a160: 7673 725f 6c6f 675f 7374 6429 290a 0a20  vsr_log_std)).. 
+0001a170: 2020 2020 2020 2070 6561 6b5f 7761 7465         peak_wate
+0001a180: 725f 6c65 7665 6c5f 7020 3d20 7761 7465  r_level_p = wate
+0001a190: 725f 6c65 7665 6c20 2b20 6876 7372 5f6f  r_level + hvsr_o
+0001a1a0: 7574 5b27 696e 645f 6876 7372 5f73 7464  ut['ind_hvsr_std
+0001a1b0: 4465 7627 5d0a 2020 2020 2020 2020 7065  Dev'].        pe
+0001a1c0: 616b 5f77 6174 6572 5f6c 6576 656c 5f6d  ak_water_level_m
+0001a1d0: 203d 2077 6174 6572 5f6c 6576 656c 202d   = water_level -
+0001a1e0: 2068 7673 725f 6f75 745b 2769 6e64 5f68   hvsr_out['ind_h
+0001a1f0: 7673 725f 7374 6444 6576 275d 0a0a 2020  vsr_stdDev']..  
+0001a200: 2020 6e65 774b 6579 7320 3d20 5b27 6876    newKeys = ['hv
+0001a210: 7372 5f6c 6f67 5f73 7464 272c 2027 7065  sr_log_std', 'pe
+0001a220: 616b 5f77 6174 6572 5f6c 6576 656c 272c  ak_water_level',
+0001a230: 2027 7065 616b 5f77 6174 6572 5f6c 6576   'peak_water_lev
+0001a240: 656c 5f70 272c 2027 7065 616b 5f77 6174  el_p', 'peak_wat
+0001a250: 6572 5f6c 6576 656c 5f6d 272c 2768 7673  er_level_m','hvs
+0001a260: 7270 272c 2768 7673 726d 272c 2027 6876  rp','hvsrm', 'hv
+0001a270: 7372 7032 272c 2768 7673 726d 3227 5d0a  srp2','hvsrm2'].
+0001a280: 2020 2020 6e65 7756 616c 7320 3d20 5b68      newVals = [h
+0001a290: 7673 725f 6c6f 675f 7374 642c 2020 2020  vsr_log_std,    
+0001a2a0: 7065 616b 5f77 6174 6572 5f6c 6576 656c  peak_water_level
+0001a2b0: 2c20 2020 7065 616b 5f77 6174 6572 5f6c  ,   peak_water_l
+0001a2c0: 6576 656c 5f70 2c20 2020 7065 616b 5f77  evel_p,   peak_w
+0001a2d0: 6174 6572 5f6c 6576 656c 5f6d 2c20 2068  ater_level_m,  h
+0001a2e0: 7673 7270 2c20 2068 7673 726d 2c20 2020  vsrp,  hvsrm,   
+0001a2f0: 6876 7372 7032 2c20 2068 7673 726d 325d  hvsrp2,  hvsrm2]
+0001a300: 0a20 2020 2066 6f72 2069 2c20 6e6b 2069  .    for i, nk i
+0001a310: 6e20 656e 756d 6572 6174 6528 6e65 774b  n enumerate(newK
+0001a320: 6579 7329 3a0a 2020 2020 2020 2020 6876  eys):.        hv
+0001a330: 7372 5f6f 7574 5b6e 6b5d 203d 206e 702e  sr_out[nk] = np.
+0001a340: 6172 7261 7928 6e65 7756 616c 735b 695d  array(newVals[i]
+0001a350: 290a 0a20 2020 2072 6574 7572 6e20 6876  )..    return hv
+0001a360: 7372 5f6f 7574 0a0a 2350 6c6f 7420 4f62  sr_out..#Plot Ob
+0001a370: 7370 7920 5472 6163 6520 696e 2061 7869  spy Trace in axi
+0001a380: 7320 7573 696e 6720 6d61 7470 6c6f 746c  s using matplotl
+0001a390: 6962 0a64 6566 2070 6c6f 745f 7374 7265  ib.def plot_stre
+0001a3a0: 616d 2873 7472 6561 6d2c 2070 6172 616d  am(stream, param
+0001a3b0: 732c 2066 6967 3d4e 6f6e 652c 2061 7865  s, fig=None, axe
+0001a3c0: 733d 4e6f 6e65 2c20 7265 7475 726e 5f66  s=None, return_f
+0001a3d0: 6967 3d54 7275 6529 3a0a 2020 2020 6966  ig=True):.    if
+0001a3e0: 2066 6967 2069 7320 4e6f 6e65 2061 6e64   fig is None and
+0001a3f0: 2061 7820 6973 204e 6f6e 653a 0a20 2020   ax is None:.   
+0001a400: 2020 2020 2066 6967 2c20 6178 6573 203d       fig, axes =
+0001a410: 2070 6c74 2e73 7562 706c 6f74 5f6d 6f73   plt.subplot_mos
+0001a420: 6169 6328 5b5b 275a 275d 2c5b 274e 275d  aic([['Z'],['N']
+0001a430: 2c5b 2745 275d 5d2c 2073 6861 7265 783d  ,['E']], sharex=
+0001a440: 5472 7565 2c20 7368 6172 6579 3d46 616c  True, sharey=Fal
+0001a450: 7365 290a 2020 2020 0a20 2020 206e 6577  se).    .    new
+0001a460: 5f73 7472 6561 6d20 3d20 7374 7265 616d  _stream = stream
+0001a470: 2e63 6f70 7928 290a 2020 2020 2361 7869  .copy().    #axi
+0001a480: 732e 706c 6f74 2874 7261 6365 2e74 696d  s.plot(trace.tim
+0001a490: 6573 2c20 7472 6163 652e 6461 7461 290a  es, trace.data).
+0001a4a0: 2020 2020 0a20 2020 2073 5469 6d65 203d      .    sTime =
+0001a4b0: 2073 7472 6561 6d5b 305d 2e73 7461 7473   stream[0].stats
+0001a4c0: 2e73 7461 7274 7469 6d65 0a20 2020 2074  .starttime.    t
+0001a4d0: 696d 654c 6973 7420 3d20 7b7d 0a20 2020  imeList = {}.   
+0001a4e0: 206d 706c 5469 6d65 7320 3d20 7b7d 0a0a   mplTimes = {}..
+0001a4f0: 2020 2020 6e65 775f 7374 7265 616d 2e64      new_stream.d
+0001a500: 6563 696d 6174 6528 3130 290a 2020 2020  ecimate(10).    
+0001a510: 7a74 7261 6365 203d 206e 6577 5f73 7472  ztrace = new_str
+0001a520: 6561 6d2e 7365 6c65 6374 2863 6f6d 706f  eam.select(compo
+0001a530: 6e65 6e74 3d27 5a27 295b 305d 0a20 2020  nent='Z')[0].   
+0001a540: 2065 7472 6163 6520 3d20 6e65 775f 7374   etrace = new_st
+0001a550: 7265 616d 2e73 656c 6563 7428 636f 6d70  ream.select(comp
+0001a560: 6f6e 656e 743d 2745 2729 5b30 5d0a 2020  onent='E')[0].  
+0001a570: 2020 6e74 7261 6365 203d 206e 6577 5f73    ntrace = new_s
+0001a580: 7472 6561 6d2e 7365 6c65 6374 2863 6f6d  tream.select(com
+0001a590: 706f 6e65 6e74 3d27 4e27 295b 305d 0a20  ponent='N')[0]. 
+0001a5a0: 2020 2074 7261 6365 7320 3d20 5b7a 7472     traces = [ztr
+0001a5b0: 6163 652c 2065 7472 6163 652c 206e 7472  ace, etrace, ntr
+0001a5c0: 6163 655d 0a20 2020 2066 6f72 2074 7220  ace].    for tr 
+0001a5d0: 696e 2074 7261 6365 733a 0a20 2020 2020  in traces:.     
+0001a5e0: 2020 206b 6579 203d 2074 722e 7374 6174     key = tr.stat
+0001a5f0: 732e 636f 6d70 6f6e 656e 740a 2020 2020  s.component.    
+0001a600: 2020 2020 7469 6d65 4c69 7374 5b6b 6579      timeList[key
+0001a610: 5d20 3d20 5b5d 0a20 2020 2020 2020 206d  ] = [].        m
+0001a620: 706c 5469 6d65 735b 6b65 795d 203d 205b  plTimes[key] = [
+0001a630: 5d0a 2020 2020 2020 2020 666f 7220 7420  ].        for t 
+0001a640: 696e 2074 722e 7469 6d65 7328 293a 0a20  in tr.times():. 
+0001a650: 2020 2020 2020 2020 2020 2074 203d 2073             t = s
+0001a660: 5469 6d65 202b 2074 0a20 2020 2020 2020  Time + t.       
+0001a670: 2020 2020 2074 696d 654c 6973 745b 6b65       timeList[ke
+0001a680: 795d 2e61 7070 656e 6428 7429 0a20 2020  y].append(t).   
+0001a690: 2020 2020 2020 2020 206d 706c 5469 6d65           mplTime
+0001a6a0: 735b 6b65 795d 2e61 7070 656e 6428 742e  s[key].append(t.
+0001a6b0: 6d61 7470 6c6f 746c 6962 5f64 6174 6529  matplotlib_date)
+0001a6c0: 0a20 2020 2066 6f72 2069 2c20 6b20 696e  .    for i, k in
+0001a6d0: 2065 6e75 6d65 7261 7465 286d 706c 5469   enumerate(mplTi
+0001a6e0: 6d65 732e 6b65 7973 2829 293a 0a20 2020  mes.keys()):.   
+0001a6f0: 2020 2020 2069 6620 6920 3d3d 2030 3a0a       if i == 0:.
+0001a700: 2020 2020 2020 2020 2020 2020 786d 696e              xmin
+0001a710: 203d 206e 702e 6d69 6e28 6d70 6c54 696d   = np.min(mplTim
+0001a720: 6573 5b6b 5d29 0a20 2020 2020 2020 2020  es[k]).         
+0001a730: 2020 2078 6d61 7820 3d20 6e70 2e6d 6178     xmax = np.max
+0001a740: 286d 706c 5469 6d65 735b 6b5d 290a 2020  (mplTimes[k]).  
+0001a750: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001a760: 2020 2020 2020 2020 6966 2078 6d69 6e20          if xmin 
+0001a770: 3e20 6e70 2e6d 696e 286d 706c 5469 6d65  > np.min(mplTime
+0001a780: 735b 6b5d 293a 0a20 2020 2020 2020 2020  s[k]):.         
+0001a790: 2020 2020 2020 2078 6d69 6e20 3d20 6e70         xmin = np
+0001a7a0: 2e6d 696e 286d 706c 5469 6d65 735b 6b5d  .min(mplTimes[k]
+0001a7b0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0001a7c0: 2078 6d61 7820 3c20 6e70 2e6d 6178 286d   xmax < np.max(m
+0001a7d0: 706c 5469 6d65 735b 6b5d 293a 0a20 2020  plTimes[k]):.   
+0001a7e0: 2020 2020 2020 2020 2020 2020 2078 6d61               xma
+0001a7f0: 7820 3d20 6e70 2e6d 6178 286d 706c 5469  x = np.max(mplTi
+0001a800: 6d65 735b 6b5d 2920 0a0a 2020 2020 6178  mes[k]) ..    ax
+0001a810: 6573 5b27 5a27 5d2e 7861 7869 735f 6461  es['Z'].xaxis_da
+0001a820: 7465 2829 0a20 2020 2061 7865 735b 274e  te().    axes['N
+0001a830: 275d 2e78 6178 6973 5f64 6174 6528 290a  '].xaxis_date().
+0001a840: 2020 2020 6178 6573 5b27 4527 5d2e 7861      axes['E'].xa
+0001a850: 7869 735f 6461 7465 2829 0a0a 2020 2020  xis_date()..    
+0001a860: 2374 5469 636b 7320 3d20 6d64 6174 6573  #tTicks = mdates
+0001a870: 2e4d 696e 7574 654c 6f63 6174 6f72 2869  .MinuteLocator(i
+0001a880: 6e74 6572 7661 6c3d 3529 0a20 2020 2023  nterval=5).    #
+0001a890: 6178 6973 2e78 6178 6973 2e73 6574 5f6d  axis.xaxis.set_m
+0001a8a0: 616a 6f72 5f6c 6f63 6174 6f72 2874 5469  ajor_locator(tTi
+0001a8b0: 636b 7329 0a20 2020 2061 7865 735b 2745  cks).    axes['E
+0001a8c0: 275d 2e78 6178 6973 2e73 6574 5f6d 616a  '].xaxis.set_maj
+0001a8d0: 6f72 5f6c 6f63 6174 6f72 286d 6461 7465  or_locator(mdate
+0001a8e0: 732e 4d69 6e75 7465 4c6f 6361 746f 7228  s.MinuteLocator(
+0001a8f0: 6279 6d69 6e75 7465 3d72 616e 6765 2830  byminute=range(0
+0001a900: 2c36 302c 3529 2929 0a20 2020 2061 7865  ,60,5))).    axe
+0001a910: 735b 2745 275d 2e78 6178 6973 2e73 6574  s['E'].xaxis.set
+0001a920: 5f6d 616a 6f72 5f66 6f72 6d61 7474 6572  _major_formatter
+0001a930: 286d 6461 7465 732e 4461 7465 466f 726d  (mdates.DateForm
+0001a940: 6174 7465 7228 2725 483a 254d 2729 290a  atter('%H:%M')).
+0001a950: 2020 2020 6178 6573 5b22 4522 5d2e 7861      axes["E"].xa
+0001a960: 7869 732e 7365 745f 6d69 6e6f 725f 6c6f  xis.set_minor_lo
+0001a970: 6361 746f 7228 6d64 6174 6573 2e4d 696e  cator(mdates.Min
+0001a980: 7574 654c 6f63 6174 6f72 2869 6e74 6572  uteLocator(inter
+0001a990: 7661 6c3d 3129 290a 2020 2020 6178 6573  val=1)).    axes
+0001a9a0: 5b22 4522 5d2e 7469 636b 5f70 6172 616d  ["E"].tick_param
+0001a9b0: 7328 6178 6973 3d27 7827 2c20 6c61 6265  s(axis='x', labe
+0001a9c0: 6c73 697a 653d 3829 0a20 2020 200a 2020  lsize=8).    .  
+0001a9d0: 2020 6178 6573 5b27 5a27 5d2e 706c 6f74    axes['Z'].plot
+0001a9e0: 286d 706c 5469 6d65 735b 275a 275d 2c20  (mplTimes['Z'], 
+0001a9f0: 7a74 7261 6365 2e64 6174 612c 2063 6f6c  ztrace.data, col
+0001aa00: 6f72 3d27 6b27 2c20 6c69 6e65 7769 6474  or='k', linewidt
+0001aa10: 683d 302e 3135 290a 2020 2020 6178 6573  h=0.15).    axes
+0001aa20: 5b27 4e27 5d2e 706c 6f74 286d 706c 5469  ['N'].plot(mplTi
+0001aa30: 6d65 735b 274e 275d 2c20 6e74 7261 6365  mes['N'], ntrace
+0001aa40: 2e64 6174 612c 2063 6f6c 6f72 3d27 6227  .data, color='b'
+0001aa50: 2c20 6c69 6e65 7769 6474 683d 302e 3135  , linewidth=0.15
+0001aa60: 290a 2020 2020 6178 6573 5b27 4527 5d2e  ).    axes['E'].
+0001aa70: 706c 6f74 286d 706c 5469 6d65 735b 2745  plot(mplTimes['E
+0001aa80: 275d 2c20 6574 7261 6365 2e64 6174 612c  '], etrace.data,
+0001aa90: 2063 6f6c 6f72 3d27 7227 2c20 6c69 6e65   color='r', line
+0001aaa0: 7769 6474 683d 302e 3135 290a 0a20 2020  width=0.15)..   
+0001aab0: 2061 7865 735b 275a 275d 2e73 6574 5f79   axes['Z'].set_y
+0001aac0: 6c61 6265 6c28 275a 2729 0a20 2020 2061  label('Z').    a
+0001aad0: 7865 735b 274e 275d 2e73 6574 5f79 6c61  xes['N'].set_yla
+0001aae0: 6265 6c28 274e 2729 0a20 2020 2061 7865  bel('N').    axe
+0001aaf0: 735b 2745 275d 2e73 6574 5f79 6c61 6265  s['E'].set_ylabe
+0001ab00: 6c28 2745 2729 0a20 2020 200a 2020 2020  l('E').    .    
+0001ab10: 2373 7444 7a20 3d20 6e70 2e61 6273 286e  #stDz = np.abs(n
+0001ab20: 702e 6e61 6e73 7464 2873 7472 6561 6d2e  p.nanstd(stream.
+0001ab30: 7365 6c65 6374 2863 6f6d 706f 6e65 6e74  select(component
+0001ab40: 3d27 5a27 295b 305d 2e64 6174 6129 290a  ='Z')[0].data)).
+0001ab50: 2020 2020 2373 7444 6e20 3d20 6e70 2e61      #stDn = np.a
+0001ab60: 6273 286e 702e 6e61 6e73 7464 2873 7472  bs(np.nanstd(str
+0001ab70: 6561 6d2e 7365 6c65 6374 2863 6f6d 706f  eam.select(compo
+0001ab80: 6e65 6e74 3d27 4e27 295b 305d 2e64 6174  nent='N')[0].dat
+0001ab90: 6129 290a 2020 2020 2373 7444 6520 3d20  a)).    #stDe = 
+0001aba0: 6e70 2e61 6273 286e 702e 6e61 6e73 7464  np.abs(np.nanstd
+0001abb0: 2873 7472 6561 6d2e 7365 6c65 6374 2863  (stream.select(c
+0001abc0: 6f6d 706f 6e65 6e74 3d27 4527 295b 305d  omponent='E')[0]
+0001abd0: 2e64 6174 6129 290a 2020 2020 2373 7444  .data)).    #stD
+0001abe0: 203d 206d 6178 285b 7374 447a 2c20 7374   = max([stDz, st
+0001abf0: 446e 2c20 7374 4465 5d29 0a20 2020 200a  Dn, stDe]).    .
+0001ac00: 2020 2020 666f 7220 692c 2063 6f6d 7020      for i, comp 
+0001ac10: 696e 2065 6e75 6d65 7261 7465 286c 6973  in enumerate(lis
+0001ac20: 7428 6d70 6c54 696d 6573 2e6b 6579 7328  t(mplTimes.keys(
+0001ac30: 2929 293a 0a20 2020 2020 2020 2073 7444  ))):.        stD
+0001ac40: 203d 206e 702e 6162 7328 6e70 2e6e 616e   = np.abs(np.nan
+0001ac50: 7374 6428 7374 7265 616d 2e73 656c 6563  std(stream.selec
+0001ac60: 7428 636f 6d70 6f6e 656e 743d 636f 6d70  t(component=comp
+0001ac70: 295b 305d 2e64 6174 6129 290a 2020 2020  )[0].data)).    
+0001ac80: 2020 2020 646d 6564 203d 206e 702e 6e61      dmed = np.na
+0001ac90: 6e6d 6564 6961 6e28 7374 7265 616d 2e73  nmedian(stream.s
+0001aca0: 656c 6563 7428 636f 6d70 6f6e 656e 743d  elect(component=
+0001acb0: 636f 6d70 295b 305d 2e64 6174 6129 0a0a  comp)[0].data)..
+0001acc0: 2020 2020 2020 2020 6178 6573 5b63 6f6d          axes[com
+0001acd0: 705d 2e73 6574 5f79 6c69 6d28 5b64 6d65  p].set_ylim([dme
+0001ace0: 642d 302e 3735 2a73 7444 2c20 646d 6564  d-0.75*stD, dmed
+0001acf0: 2b30 2e37 352a 7374 445d 290a 2020 2020  +0.75*stD]).    
+0001ad00: 2020 2020 6178 6573 5b63 6f6d 705d 2e73      axes[comp].s
+0001ad10: 6574 5f78 6c69 6d28 5b78 6d69 6e2c 2078  et_xlim([xmin, x
+0001ad20: 6d61 785d 290a 0a20 2020 2066 6967 2e73  max])..    fig.s
+0001ad30: 7570 7469 746c 6528 7061 7261 6d73 5b27  uptitle(params['
+0001ad40: 7369 7465 275d 290a 2020 2020 0a20 2020  site']).    .   
+0001ad50: 2064 6179 203d 2022 7b7d 2d7b 7d2d 7b7d   day = "{}-{}-{}
+0001ad60: 222e 666f 726d 6174 2873 7472 6561 6d5b  ".format(stream[
+0001ad70: 305d 2e73 7461 7473 2e73 7461 7274 7469  0].stats.startti
+0001ad80: 6d65 2e79 6561 722c 2073 7472 6561 6d5b  me.year, stream[
+0001ad90: 305d 2e73 7461 7473 2e73 7461 7274 7469  0].stats.startti
+0001ada0: 6d65 2e6d 6f6e 7468 2c20 7374 7265 616d  me.month, stream
+0001adb0: 5b30 5d2e 7374 6174 732e 7374 6172 7474  [0].stats.startt
+0001adc0: 696d 652e 6461 7929 0a20 2020 2061 7865  ime.day).    axe
+0001add0: 735b 2745 275d 2e73 6574 5f78 6c61 6265  s['E'].set_xlabe
+0001ade0: 6c28 2755 5443 2054 696d 6520 5c6e 272b  l('UTC Time \n'+
+0001adf0: 6461 7929 0a0a 2020 2020 2370 6c74 2e72  day)..    #plt.r
+0001ae00: 6350 6172 616d 735b 2766 6967 7572 652e  cParams['figure.
+0001ae10: 6470 6927 5d20 3d20 3130 300a 2020 2020  dpi'] = 100.    
+0001ae20: 2370 6c74 2e72 6350 6172 616d 735b 2766  #plt.rcParams['f
+0001ae30: 6967 7572 652e 6669 6773 697a 6527 5d20  igure.figsize'] 
+0001ae40: 3d20 2835 2c34 290a 2020 2020 0a20 2020  = (5,4).    .   
+0001ae50: 2066 6967 2e74 6967 6874 5f6c 6179 6f75   fig.tight_layou
+0001ae60: 7428 290a 0a20 2020 2069 6620 7265 7475  t()..    if retu
+0001ae70: 726e 5f66 6967 3a0a 2020 2020 2020 2020  rn_fig:.        
+0001ae80: 7265 7475 726e 2066 6967 2c20 6178 6573  return fig, axes
+0001ae90: 0a20 2020 2066 6967 2e63 616e 7661 732e  .    fig.canvas.
+0001aea0: 6472 6177 2829 0a20 2020 2072 6574 7572  draw().    retur
+0001aeb0: 6e20 2020 2020 2020 2020 2020 2020 2020  n               
+0001aec0: 2020 0a0a 6465 6620 6876 706c 6f74 2868    ..def hvplot(h
+0001aed0: 7673 725f 6469 6374 2c20 6b69 6e64 3d27  vsr_dict, kind='
+0001aee0: 4856 5352 272c 2075 7365 5f73 7562 706c  HVSR', use_subpl
+0001aef0: 6f74 733d 5472 7565 2c20 7874 7970 653d  ots=True, xtype=
+0001af00: 2766 7265 7127 2c20 6669 673d 4e6f 6e65  'freq', fig=None
+0001af10: 2c20 6178 3d4e 6f6e 652c 2072 6574 7572  , ax=None, retur
+0001af20: 6e5f 6669 673d 4661 6c73 652c 2020 7361  n_fig=False,  sa
+0001af30: 7665 5f64 6972 3d4e 6f6e 652c 2073 6176  ve_dir=None, sav
+0001af40: 655f 7375 6666 6978 3d27 272c 2073 686f  e_suffix='', sho
+0001af50: 773d 5472 7565 2c2a 2a6b 7761 7267 7329  w=True,**kwargs)
+0001af60: 3a0a 2020 2020 2222 2246 756e 6374 696f  :.    """Functio
+0001af70: 6e20 746f 2070 6c6f 7420 4856 5352 2064  n to plot HVSR d
+0001af80: 6174 610a 0a20 2020 2050 6172 616d 6574  ata..    Paramet
+0001af90: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+0001afa0: 2d2d 0a20 2020 2068 7673 725f 6469 6374  --.    hvsr_dict
+0001afb0: 203a 2064 6963 7420 2020 2020 2020 2020   : dict         
+0001afc0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0001afd0: 2020 4469 6374 696f 6e61 7279 2063 6f6e    Dictionary con
+0001afe0: 7461 696e 696e 6720 6f75 7470 7574 2066  taining output f
+0001aff0: 726f 6d20 7072 6f63 6573 735f 6876 7372  rom process_hvsr
+0001b000: 2066 756e 6374 696f 6e0a 2020 2020 6b69   function.    ki
+0001b010: 6e64 203a 2073 7472 3d27 4856 5352 2720  nd : str='HVSR' 
+0001b020: 6f72 206c 6973 7420 2020 200a 2020 2020  or list    .    
+0001b030: 2020 2020 5468 6520 6b69 6e64 206f 6620      The kind of 
+0001b040: 706c 6f74 2873 2920 746f 2070 6c6f 742e  plot(s) to plot.
+0001b050: 2049 6620 6c69 7374 2c20 7769 6c6c 2070   If list, will p
+0001b060: 6c6f 7420 616c 6c20 706c 6f74 7320 6c69  lot all plots li
+0001b070: 7374 6564 0a20 2020 2020 2020 2027 4856  sted.        'HV
+0001b080: 5352 2720 3a20 5374 616e 6461 7264 2048  SR' : Standard H
+0001b090: 5653 5220 706c 6f74 2c20 696e 636c 7564  VSR plot, includ
+0001b0a0: 696e 6720 7374 616e 6461 7264 2064 6576  ing standard dev
+0001b0b0: 6961 7469 6f6e 0a20 2020 2020 2020 202d  iation.        -
+0001b0c0: 2027 5b48 5653 525d 2070 2720 3a20 4856   '[HVSR] p' : HV
+0001b0d0: 5352 2070 6c6f 7420 7769 7468 2062 6573  SR plot with bes
+0001b0e0: 7420 7065 616b 7320 7368 6f77 6e0a 2020  t peaks shown.  
+0001b0f0: 2020 2020 2020 2d20 275b 4856 5352 5d20        - '[HVSR] 
+0001b100: 7027 203a 2048 5653 5220 706c 6f74 2077  p' : HVSR plot w
+0001b110: 6974 6820 6265 7374 2070 6963 6b65 6420  ith best picked 
+0001b120: 7065 616b 2073 686f 776e 2020 2020 2020  peak shown      
+0001b130: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0001b140: 2020 202d 2027 5b48 5653 525d 2070 2a20     - '[HVSR] p* 
+0001b150: 616c 6c27 203a 2048 5653 5220 706c 6f74  all' : HVSR plot
+0001b160: 2077 6974 6820 616c 6c20 7069 636b 6564   with all picked
+0001b170: 2070 6561 6b73 2073 686f 776e 2020 2020   peaks shown    
+0001b180: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0001b190: 2020 2020 202d 2027 5b48 5653 525d 2070       - '[HVSR] p
+0001b1a0: 2a20 7427 203a 2048 5653 5220 706c 6f74  * t' : HVSR plot
+0001b1b0: 2077 6974 6820 7065 616b 7320 6672 6f6d   with peaks from
+0001b1c0: 2061 6c6c 2074 696d 6520 7374 6570 7320   all time steps 
+0001b1d0: 696e 2062 6163 6b67 726f 756e 6420 2020  in background   
+0001b1e0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+0001b1f0: 2020 2020 2020 2d20 275b 4856 5352 2070        - '[HVSR p
+0001b200: 2a20 616e 6e5d 203a 2041 6e6e 6f74 6174  * ann] : Annotat
+0001b210: 6573 2070 6c6f 7420 7769 7468 2070 6561  es plot with pea
+0001b220: 6b73 0a20 2020 2020 2020 202d 2027 5b48  ks.        - '[H
+0001b230: 5653 525d 202d 7327 203a 2048 5653 5220  VSR] -s' : HVSR 
+0001b240: 706c 6f74 7320 646f 6e27 7420 7368 6f77  plots don't show
+0001b250: 2073 7461 6e64 6172 6420 6465 7669 6174   standard deviat
+0001b260: 696f 6e0a 2020 2020 2020 2020 2d20 275b  ion.        - '[
+0001b270: 4856 5352 5d20 7427 203a 2048 5653 5220  HVSR] t' : HVSR 
+0001b280: 706c 6f74 2077 6974 6820 696e 6469 7669  plot with indivi
+0001b290: 6475 616c 2068 7620 6375 7276 6573 2066  dual hv curves f
+0001b2a0: 6f72 2065 6163 6820 7469 6d65 2073 7465  or each time ste
+0001b2b0: 7020 7368 6f77 6e0a 2020 2020 2020 2020  p shown.        
+0001b2c0: 2d20 275b 4856 5352 5d20 6327 203a 2048  - '[HVSR] c' : H
+0001b2d0: 5653 5220 706c 6f74 2077 6974 6820 6561  VSR plot with ea
+0001b2e0: 6368 2063 6f6d 706f 6e65 6e74 7327 2073  ch components' s
+0001b2f0: 7065 6374 7261 2e20 5265 636f 6d6d 656e  pectra. Recommen
+0001b300: 6465 6420 746f 2064 6f20 7468 6973 206c  ded to do this l
+0001b310: 6173 7420 286f 7220 6a75 7374 2062 6566  ast (or just bef
+0001b320: 6f72 6520 2773 7065 6367 7261 6d27 292c  ore 'specgram'),
+0001b330: 2073 696e 6365 2064 6f69 6e67 2063 2b20   since doing c+ 
+0001b340: 6361 6e20 6d61 6b65 2074 6865 2063 6f6d  can make the com
+0001b350: 706f 6e65 6e74 2063 6861 7274 2069 7473  ponent chart its
+0001b360: 206f 776e 2063 6861 7274 0a20 2020 2020   own chart.     
+0001b370: 2020 2027 5370 6563 6772 616d 2720 3a20     'Specgram' : 
+0001b380: 436f 6d62 696e 6564 2073 7065 6374 726f  Combined spectro
+0001b390: 6772 616d 206f 6620 616c 6c20 636f 6d70  gram of all comp
+0001b3a0: 6f6e 656e 7473 0a20 2020 2020 2020 202d  onents.        -
+0001b3b0: 2027 5b73 7065 635d 2720 3a20 6261 7369   '[spec]' : basi
+0001b3c0: 6320 7370 6563 7472 6f67 7261 6d20 706c  c spectrogram pl
+0001b3d0: 6f74 206f 6620 482f 5620 6375 7276 650a  ot of H/V curve.
+0001b3e0: 2020 2020 7573 655f 7375 6270 6c6f 7473      use_subplots
+0001b3f0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+0001b400: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+0001b410: 5768 6574 6865 7220 746f 206f 7574 7075  Whether to outpu
+0001b420: 7420 7468 6520 706c 6f74 7320 6173 2073  t the plots as s
+0001b430: 7562 706c 6f74 7320 2854 7275 6529 206f  ubplots (True) o
+0001b440: 7220 6173 2073 6570 6172 6174 6520 706c  r as separate pl
+0001b450: 6f74 7320 2846 616c 7365 290a 2020 2020  ots (False).    
+0001b460: 7874 7970 6520 3a20 7374 722c 2064 6566  xtype : str, def
+0001b470: 6175 6c74 203d 2027 6672 6571 2720 2020  ault = 'freq'   
+0001b480: 200a 2020 2020 2020 2020 5374 7269 6e67   .        String
+0001b490: 2066 6f72 2077 6861 7420 746f 2075 7365   for what to use
+0001b4a0: 2c20 6265 7477 6565 6e20 6672 6571 7565  , between freque
+0001b4b0: 6e63 7920 6f72 2070 6572 696f 640a 2020  ncy or period.  
+0001b4c0: 2020 2020 2020 2020 2020 466f 7220 6672            For fr
+0001b4d0: 6571 7565 6e63 792c 2074 6865 2066 6f6c  equency, the fol
+0001b4e0: 6c6f 7769 6e67 2061 7265 2061 6363 6570  lowing are accep
+0001b4f0: 7465 6420 2863 6173 6520 646f 6573 206e  ted (case does n
+0001b500: 6f74 206d 6174 7465 7229 3a20 2766 272c  ot matter): 'f',
+0001b510: 2027 487a 272c 2027 6672 6571 272c 2027   'Hz', 'freq', '
+0001b520: 6672 6571 7565 6e63 7927 0a20 2020 2020  frequency'.     
+0001b530: 2020 2020 2020 2046 6f72 2070 6572 696f         For perio
+0001b540: 642c 2074 6865 2066 6f6c 6c6f 7769 6e67  d, the following
+0001b550: 2061 7265 2061 6363 6570 7465 6420 2863   are accepted (c
+0001b560: 6173 6520 646f 6573 206e 6f74 206d 6174  ase does not mat
+0001b570: 7465 7229 3a20 2770 272c 2027 5427 2c20  ter): 'p', 'T', 
+0001b580: 2773 272c 2027 7365 6327 2c20 2773 6563  's', 'sec', 'sec
+0001b590: 6f6e 6427 2c20 2770 6572 272c 2027 7065  ond', 'per', 'pe
+0001b5a0: 7269 6f64 270a 2020 2020 7265 7475 726e  riod'.    return
+0001b5b0: 5f66 6967 2020 203a 2062 6f6f 6c0a 2020  _fig   : bool.  
+0001b5c0: 2020 2020 2020 5768 6574 6865 7220 746f        Whether to
+0001b5d0: 2072 6574 7572 6e20 6669 6775 7265 2061   return figure a
+0001b5e0: 6e64 2061 7869 7320 6f62 6a65 6374 730a  nd axis objects.
+0001b5f0: 2020 2020 7361 7665 5f64 6972 2020 2020      save_dir    
+0001b600: 203a 2073 7472 206f 7220 4e6f 6e65 0a20   : str or None. 
+0001b610: 2020 2020 2020 2044 6972 6563 746f 7279         Directory
+0001b620: 2069 6e20 7768 6963 6820 746f 2073 6176   in which to sav
+0001b630: 6520 6669 6775 7265 730a 2020 2020 7361  e figures.    sa
+0001b640: 7665 5f73 7566 6669 7820 203a 2073 7472  ve_suffix  : str
+0001b650: 0a20 2020 2020 2020 2053 7566 6669 7820  .        Suffix 
+0001b660: 746f 2061 6464 2074 6f20 656e 6420 6f66  to add to end of
+0001b670: 2066 6967 7572 6520 6669 6c65 6e61 6d65   figure filename
+0001b680: 2873 292c 2069 6620 7361 7665 5f64 6972  (s), if save_dir
+0001b690: 2069 7320 7573 6564 0a20 2020 2073 686f   is used.    sho
+0001b6a0: 7720 2020 203a 2062 6f6f 6c0a 2020 2020  w    : bool.    
+0001b6b0: 2020 2020 5768 6574 6865 7220 746f 2073      Whether to s
+0001b6c0: 686f 7720 706c 6f74 0a20 2020 202a 2a6b  how plot.    **k
+0001b6d0: 7761 7267 7320 2020 203a 206b 6579 776f  wargs    : keywo
+0001b6e0: 7264 2061 7267 756d 656e 7473 0a20 2020  rd arguments.   
+0001b6f0: 2020 2020 204b 6579 776f 7264 2061 7267       Keyword arg
+0001b700: 756d 656e 7473 2066 6f72 206d 6174 706c  uments for matpl
+0001b710: 6f74 6c69 622e 7079 706c 6f74 0a0a 2020  otlib.pyplot..  
+0001b720: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+0001b730: 2d2d 2d2d 2d0a 2020 2020 6669 672c 2061  -----.    fig, a
+0001b740: 7820 3a20 6d61 7470 6c6f 746c 6962 2066  x : matplotlib f
+0001b750: 6967 7572 6520 616e 6420 6178 6973 206f  igure and axis o
+0001b760: 626a 6563 7473 0a20 2020 2020 2020 2052  bjects.        R
+0001b770: 6574 7572 6e73 2066 6967 7572 6520 616e  eturns figure an
+0001b780: 6420 6178 6973 206d 6174 706c 6f74 6c69  d axis matplotli
+0001b790: 622e 7079 706c 6f74 206f 626a 6563 7473  b.pyplot objects
+0001b7a0: 2069 6620 7265 7475 726e 5f66 6967 3d54   if return_fig=T
+0001b7b0: 7275 652c 206f 7468 6572 7769 7365 2c20  rue, otherwise, 
+0001b7c0: 7369 6d70 6c79 2070 6c6f 7473 2074 6865  simply plots the
+0001b7d0: 2066 6967 7572 6573 0a20 2020 2022 2222   figures.    """
+0001b7e0: 0a0a 2020 2020 636f 6d70 4c69 7374 203d  ..    compList =
+0001b7f0: 205b 2763 272c 2027 636f 6d70 272c 2027   ['c', 'comp', '
+0001b800: 636f 6d70 6f6e 656e 7427 2c20 2763 6f6d  component', 'com
+0001b810: 706f 6e65 6e74 7327 5d0a 2020 2020 7370  ponents'].    sp
+0001b820: 6563 6772 616d 4c69 7374 203d 205b 2773  ecgramList = ['s
+0001b830: 7065 6327 2c20 2773 7065 6367 7261 6d27  pec', 'specgram'
+0001b840: 2c20 2773 7065 6374 726f 6772 616d 275d  , 'spectrogram']
+0001b850: 0a20 2020 2068 7673 724c 6973 7420 3d20  .    hvsrList = 
+0001b860: 5b27 6876 7372 272c 2027 6876 272c 2027  ['hvsr', 'hv', '
+0001b870: 6827 5d0a 0a20 2020 2068 7673 7249 6e64  h']..    hvsrInd
+0001b880: 203d 206e 702e 6e61 6e0a 2020 2020 636f   = np.nan.    co
+0001b890: 6d70 496e 6420 3d20 6e70 2e6e 616e 0a20  mpInd = np.nan. 
+0001b8a0: 2020 2073 7065 6349 6e64 203d 206e 702e     specInd = np.
+0001b8b0: 6e61 6e0a 0a20 2020 206b 4c69 7374 203d  nan..    kList =
+0001b8c0: 206b 696e 642e 7370 6c69 7428 2720 2729   kind.split(' ')
+0001b8d0: 0a20 2020 2066 6f72 2069 2c20 6b20 696e  .    for i, k in
+0001b8e0: 2065 6e75 6d65 7261 7465 286b 4c69 7374   enumerate(kList
+0001b8f0: 293a 0a20 2020 2020 2020 206b 4c69 7374  ):.        kList
+0001b900: 5b69 5d20 3d20 6b2e 6c6f 7765 7228 290a  [i] = k.lower().
+0001b910: 0a20 2020 2023 4856 5352 2069 6e64 6578  .    #HVSR index
+0001b920: 0a20 2020 2069 6620 6c65 6e28 7365 7428  .    if len(set(
+0001b930: 6876 7372 4c69 7374 292e 696e 7465 7273  hvsrList).inters
+0001b940: 6563 7469 6f6e 286b 4c69 7374 2929 3a0a  ection(kList)):.
+0001b950: 2020 2020 2020 2020 666f 7220 692c 2068          for i, h
+0001b960: 7620 696e 2065 6e75 6d65 7261 7465 2868  v in enumerate(h
+0001b970: 7673 724c 6973 7429 3a0a 2020 2020 2020  vsrList):.      
+0001b980: 2020 2020 2020 6966 2068 7620 696e 206b        if hv in k
+0001b990: 4c69 7374 3a0a 2020 2020 2020 2020 2020  List:.          
+0001b9a0: 2020 2020 2020 6876 7372 496e 6420 3d20        hvsrInd = 
+0001b9b0: 6b4c 6973 742e 696e 6465 7828 6876 290a  kList.index(hv).
+0001b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b9d0: 6272 6561 6b0a 2020 2020 2343 6f6d 706f  break.    #Compo
+0001b9e0: 6e65 6e74 2069 6e64 6578 0a20 2020 2023  nent index.    #
+0001b9f0: 6966 206c 656e 2873 6574 2863 6f6d 704c  if len(set(compL
+0001ba00: 6973 7429 2e69 6e74 6572 7365 6374 696f  ist).intersectio
+0001ba10: 6e28 6b4c 6973 7429 293a 0a20 2020 2066  n(kList)):.    f
+0001ba20: 6f72 2069 2c20 6320 696e 2065 6e75 6d65  or i, c in enume
+0001ba30: 7261 7465 286b 4c69 7374 293a 0a20 2020  rate(kList):.   
+0001ba40: 2020 2020 2069 6620 272b 2720 696e 2063       if '+' in c
+0001ba50: 2061 6e64 2063 5b3a 2d31 5d20 696e 2063   and c[:-1] in c
+0001ba60: 6f6d 704c 6973 743a 0a20 2020 2020 2020  ompList:.       
+0001ba70: 2020 2020 2063 6f6d 7049 6e64 203d 206b       compInd = k
+0001ba80: 4c69 7374 2e69 6e64 6578 2863 290a 2020  List.index(c).  
+0001ba90: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+0001baa0: 2020 2020 2020 2020 0a20 2020 2023 5370          .    #Sp
+0001bab0: 6563 6772 616d 2069 6e64 6578 0a20 2020  ecgram index.   
+0001bac0: 2069 6620 6c65 6e28 7365 7428 7370 6563   if len(set(spec
+0001bad0: 6772 616d 4c69 7374 292e 696e 7465 7273  gramList).inters
+0001bae0: 6563 7469 6f6e 286b 4c69 7374 2929 3a0a  ection(kList)):.
+0001baf0: 2020 2020 2020 2020 666f 7220 692c 2073          for i, s
+0001bb00: 7020 696e 2065 6e75 6d65 7261 7465 2873  p in enumerate(s
+0001bb10: 7065 6367 7261 6d4c 6973 7429 3a0a 2020  pecgramList):.  
+0001bb20: 2020 2020 2020 2020 2020 6966 2073 7020            if sp 
+0001bb30: 696e 206b 4c69 7374 3a0a 2020 2020 2020  in kList:.      
+0001bb40: 2020 2020 2020 2020 2020 7370 6563 496e            specIn
+0001bb50: 6420 3d20 6b4c 6973 742e 696e 6465 7828  d = kList.index(
+0001bb60: 7370 290a 2020 2020 2020 2020 2020 2020  sp).            
+0001bb70: 2020 2020 6272 6561 6b20 2020 2020 2020      break       
+0001bb80: 200a 0a20 2020 2069 6e64 4c69 7374 203d   ..    indList =
+0001bb90: 205b 6876 7372 496e 642c 2063 6f6d 7049   [hvsrInd, compI
+0001bba0: 6e64 2c20 7370 6563 496e 645d 0a20 2020  nd, specInd].   
+0001bbb0: 2069 6e64 4c69 7374 436f 7079 203d 2069   indListCopy = i
+0001bbc0: 6e64 4c69 7374 2e63 6f70 7928 290a 2020  ndList.copy().  
+0001bbd0: 2020 706c 6f74 5479 7065 4c69 7374 203d    plotTypeList =
+0001bbe0: 205b 2768 7673 7227 2c20 2763 6f6d 7027   ['hvsr', 'comp'
+0001bbf0: 2c20 2773 7065 6327 5d0a 0a20 2020 2070  , 'spec']..    p
+0001bc00: 6c6f 7454 7970 654f 7264 6572 203d 205b  lotTypeOrder = [
+0001bc10: 5d0a 2020 2020 706c 6f74 496e 644f 7264  ].    plotIndOrd
+0001bc20: 6572 203d 205b 5d0a 0a20 2020 206c 6173  er = []..    las
+0001bc30: 7456 616c 203d 2030 0a20 2020 2077 6869  tVal = 0.    whi
+0001bc40: 6c65 206c 6173 7456 616c 2021 3d20 3939  le lastVal != 99
+0001bc50: 3a0a 2020 2020 2020 2020 6669 7273 7449  :.        firstI
+0001bc60: 6e64 203d 206e 702e 6e61 6e61 7267 6d69  nd = np.nanargmi
+0001bc70: 6e28 696e 644c 6973 7443 6f70 7929 0a20  n(indListCopy). 
+0001bc80: 2020 2020 2020 2070 6c6f 7454 7970 654f         plotTypeO
+0001bc90: 7264 6572 2e61 7070 656e 6428 706c 6f74  rder.append(plot
+0001bca0: 5479 7065 4c69 7374 5b66 6972 7374 496e  TypeList[firstIn
+0001bcb0: 645d 290a 2020 2020 2020 2020 706c 6f74  d]).        plot
+0001bcc0: 496e 644f 7264 6572 2e61 7070 656e 6428  IndOrder.append(
+0001bcd0: 696e 644c 6973 745b 6669 7273 7449 6e64  indList[firstInd
+0001bce0: 5d29 0a20 2020 2020 2020 206c 6173 7456  ]).        lastV
+0001bcf0: 616c 203d 2069 6e64 4c69 7374 436f 7079  al = indListCopy
+0001bd00: 5b66 6972 7374 496e 645d 0a20 2020 2020  [firstInd].     
+0001bd10: 2020 2069 6e64 4c69 7374 436f 7079 5b66     indListCopy[f
+0001bd20: 6972 7374 496e 645d 203d 2039 3920 2368  irstInd] = 99 #h
+0001bd30: 6967 6820 6e75 6d62 6572 0a0a 2020 2020  igh number..    
+0001bd40: 706c 6f74 5479 7065 4f72 6465 722e 706f  plotTypeOrder.po
+0001bd50: 7028 290a 2020 2020 706c 6f74 496e 644f  p().    plotIndO
+0001bd60: 7264 6572 5b2d 315d 3d6c 656e 286b 4c69  rder[-1]=len(kLi
+0001bd70: 7374 290a 0a20 2020 2066 6f72 2069 2c20  st)..    for i, 
+0001bd80: 7020 696e 2065 6e75 6d65 7261 7465 2870  p in enumerate(p
+0001bd90: 6c6f 7454 7970 654f 7264 6572 293a 0a20  lotTypeOrder):. 
+0001bda0: 2020 2020 2020 2070 5374 6172 7449 6e64         pStartInd
+0001bdb0: 203d 2070 6c6f 7449 6e64 4f72 6465 725b   = plotIndOrder[
+0001bdc0: 695d 0a20 2020 2020 2020 2070 456e 6449  i].        pEndI
+0001bdd0: 6e64 203d 2070 6c6f 7449 6e64 4f72 6465  nd = plotIndOrde
+0001bde0: 725b 692b 315d 0a20 2020 2020 2020 2070  r[i+1].        p
+0001bdf0: 6c6f 7443 6f6d 706f 6e65 6e74 7320 3d20  lotComponents = 
+0001be00: 6b4c 6973 745b 7053 7461 7274 496e 643a  kList[pStartInd:
+0001be10: 7045 6e64 496e 645d 0a0a 2020 2020 2020  pEndInd]..      
+0001be20: 2020 6966 2075 7365 5f73 7562 706c 6f74    if use_subplot
+0001be30: 7320 616e 6420 693d 3d30 2061 6e64 2066  s and i==0 and f
+0001be40: 6967 2069 7320 4e6f 6e65 2061 6e64 2061  ig is None and a
+0001be50: 7820 6973 204e 6f6e 653a 0a20 2020 2020  x is None:.     
+0001be60: 2020 2020 2020 206d 6f73 6169 6350 6c6f         mosaicPlo
+0001be70: 7473 203d 205b 5d0a 2020 2020 2020 2020  ts = [].        
+0001be80: 2020 2020 666f 7220 7074 6f20 696e 2070      for pto in p
+0001be90: 6c6f 7454 7970 654f 7264 6572 3a0a 2020  lotTypeOrder:.  
+0001bea0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0001beb0: 7361 6963 506c 6f74 732e 6170 7065 6e64  saicPlots.append
+0001bec0: 285b 7074 6f5d 290a 2020 2020 2020 2020  ([pto]).        
+0001bed0: 2020 2020 6669 672c 2061 7820 3d20 706c      fig, ax = pl
+0001bee0: 742e 7375 6270 6c6f 745f 6d6f 7361 6963  t.subplot_mosaic
+0001bef0: 286d 6f73 6169 6350 6c6f 7473 290a 2020  (mosaicPlots).  
+0001bf00: 2020 2020 2020 2020 2020 6178 6973 203d            axis =
+0001bf10: 2061 785b 705d 0a20 2020 2020 2020 2065   ax[p].        e
+0001bf20: 6c69 6620 7573 655f 7375 6270 6c6f 7473  lif use_subplots
+0001bf30: 3a0a 2020 2020 2020 2020 2020 2020 6178  :.            ax
+0001bf40: 6973 203d 2061 785b 705d 0a20 2020 2020  is = ax[p].     
+0001bf50: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001bf60: 2020 2020 2066 6967 2c20 6178 6973 203d       fig, axis =
+0001bf70: 2070 6c74 2e73 7562 706c 6f74 7328 290a   plt.subplots().
+0001bf80: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0001bf90: 2020 2020 2069 6620 7020 3d3d 2027 6876       if p == 'hv
+0001bfa0: 7372 273a 0a20 2020 2020 2020 2020 2020  sr':.           
+0001bfb0: 2070 6c6f 745f 6876 7372 2868 7673 725f   plot_hvsr(hvsr_
+0001bfc0: 6469 6374 2c20 6669 673d 6669 672c 2061  dict, fig=fig, a
+0001bfd0: 783d 6178 6973 2c20 6b69 6e64 3d70 6c6f  x=axis, kind=plo
+0001bfe0: 7443 6f6d 706f 6e65 6e74 732c 2078 7479  tComponents, xty
+0001bff0: 7065 3d27 785f 6672 6571 7327 290a 2020  pe='x_freqs').  
+0001c000: 2020 2020 2020 656c 6966 2070 3d3d 2763        elif p=='c
+0001c010: 6f6d 7027 3a0a 2020 2020 2020 2020 2020  omp':.          
+0001c020: 2020 706c 6f74 436f 6d70 6f6e 656e 7473    plotComponents
+0001c030: 5b30 5d20 3d20 706c 6f74 436f 6d70 6f6e  [0] = plotCompon
+0001c040: 656e 7473 5b30 5d5b 3a2d 315d 0a20 2020  ents[0][:-1].   
+0001c050: 2020 2020 2020 2020 2070 6c6f 745f 6876           plot_hv
+0001c060: 7372 2868 7673 725f 6469 6374 2c20 6669  sr(hvsr_dict, fi
+0001c070: 673d 6669 672c 2061 783d 6178 6973 2c20  g=fig, ax=axis, 
+0001c080: 6b69 6e64 3d70 6c6f 7443 6f6d 706f 6e65  kind=plotCompone
+0001c090: 6e74 732c 2078 7479 7065 3d27 785f 6672  nts, xtype='x_fr
+0001c0a0: 6571 7327 290a 2020 2020 2020 2020 656c  eqs').        el
+0001c0b0: 6966 2070 3d3d 2773 7065 6327 3a0a 2020  if p=='spec':.  
+0001c0c0: 2020 2020 2020 2020 2020 706c 6f74 5f73            plot_s
+0001c0d0: 7065 6367 7261 6d5f 6876 7372 2868 7673  pecgram_hvsr(hvs
+0001c0e0: 725f 6469 6374 2c20 6669 673d 6669 672c  r_dict, fig=fig,
+0001c0f0: 2061 783d 6178 6973 290a 2020 2020 2020   ax=axis).      
+0001c100: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001c110: 2020 2020 7072 696e 7428 2745 7272 6f72      print('Error
+0001c120: 2729 2020 2020 0a20 2020 200a 2020 2020  ')    .    .    
+0001c130: 6966 2072 6574 7572 6e5f 6669 673a 0a20  if return_fig:. 
+0001c140: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
+0001c150: 672c 2061 780a 2020 2020 7265 7475 726e  g, ax.    return
+0001c160: 0a0a 2350 6c6f 7420 4856 5352 2064 6174  ..#Plot HVSR dat
+0001c170: 6120 284f 4c44 290a 6465 6620 5f5f 6f6c  a (OLD).def __ol
+0001c180: 645f 6876 706c 6f74 2868 7673 725f 6469  d_hvplot(hvsr_di
+0001c190: 6374 2c20 6b69 6e64 3d27 4856 5352 272c  ct, kind='HVSR',
+0001c1a0: 2078 7479 7065 3d27 6672 6571 272c 2072   xtype='freq', r
+0001c1b0: 6574 7572 6e5f 6669 673d 4661 6c73 652c  eturn_fig=False,
+0001c1c0: 2020 7361 7665 5f64 6972 3d4e 6f6e 652c    save_dir=None,
+0001c1d0: 2073 6176 655f 7375 6666 6978 3d27 272c   save_suffix='',
+0001c1e0: 2073 686f 773d 5472 7565 2c2a 2a6b 7761   show=True,**kwa
+0001c1f0: 7267 7329 3a0a 2020 2020 2222 2246 756e  rgs):.    """Fun
+0001c200: 6374 696f 6e20 746f 2070 6c6f 7420 4856  ction to plot HV
+0001c210: 5352 2064 6174 610a 0a20 2020 2020 2020  SR data..       
+0001c220: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+0001c230: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+0001c240: 2020 2020 2020 2068 7673 725f 6469 6374         hvsr_dict
+0001c250: 203a 2064 6963 7420 2020 2020 2020 2020   : dict         
+0001c260: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0001c270: 2020 2020 2020 4469 6374 696f 6e61 7279        Dictionary
+0001c280: 2063 6f6e 7461 696e 696e 6720 6f75 7470   containing outp
+0001c290: 7574 2066 726f 6d20 7072 6f63 6573 735f  ut from process_
+0001c2a0: 6876 7372 2066 756e 6374 696f 6e0a 2020  hvsr function.  
+0001c2b0: 2020 2020 2020 6b69 6e64 203a 2073 7472        kind : str
+0001c2c0: 3d27 4856 5352 2720 6f72 206c 6973 7420  ='HVSR' or list 
+0001c2d0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0001c2e0: 5468 6520 6b69 6e64 206f 6620 706c 6f74  The kind of plot
+0001c2f0: 2873 2920 746f 2070 6c6f 742e 2049 6620  (s) to plot. If 
+0001c300: 6c69 7374 2c20 7769 6c6c 2070 6c6f 7420  list, will plot 
+0001c310: 616c 6c20 706c 6f74 7320 6c69 7374 6564  all plots listed
+0001c320: 0a20 2020 2020 2020 2020 2020 2027 4856  .            'HV
+0001c330: 5352 2720 3a20 5374 616e 6461 7264 2048  SR' : Standard H
+0001c340: 5653 5220 706c 6f74 2c20 696e 636c 7564  VSR plot, includ
+0001c350: 696e 6720 7374 616e 6461 7264 2064 6576  ing standard dev
+0001c360: 6961 7469 6f6e 0a20 2020 2020 2020 2020  iation.         
+0001c370: 2020 202d 2027 5b48 5653 525d 2070 2720     - '[HVSR] p' 
+0001c380: 3a20 4856 5352 2070 6c6f 7420 7769 7468  : HVSR plot with
+0001c390: 2062 6573 7420 7065 616b 7320 7368 6f77   best peaks show
+0001c3a0: 6e0a 2020 2020 2020 2020 2020 2020 2d20  n.            - 
+0001c3b0: 275b 4856 5352 5d20 7027 203a 2048 5653  '[HVSR] p' : HVS
+0001c3c0: 5220 706c 6f74 2077 6974 6820 6265 7374  R plot with best
+0001c3d0: 2070 6963 6b65 6420 7065 616b 2073 686f   picked peak sho
+0001c3e0: 776e 2020 2020 2020 2020 2020 2020 2020  wn              
+0001c3f0: 2020 0a20 2020 2020 2020 2020 2020 202d    .            -
+0001c400: 2027 5b48 5653 525d 2070 2a20 616c 6c27   '[HVSR] p* all'
+0001c410: 203a 2048 5653 5220 706c 6f74 2077 6974   : HVSR plot wit
+0001c420: 6820 616c 6c20 7069 636b 6564 2070 6561  h all picked pea
+0001c430: 6b73 2073 686f 776e 2020 2020 2020 2020  ks shown        
+0001c440: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0001c450: 2020 2020 202d 2027 5b48 5653 525d 2070       - '[HVSR] p
+0001c460: 2a20 7427 203a 2048 5653 5220 706c 6f74  * t' : HVSR plot
+0001c470: 2077 6974 6820 7065 616b 7320 6672 6f6d   with peaks from
+0001c480: 2061 6c6c 2074 696d 6520 7374 6570 7320   all time steps 
+0001c490: 696e 2062 6163 6b67 726f 756e 6420 2020  in background   
+0001c4a0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+0001c4b0: 2020 2020 2020 2020 2020 2d20 275b 4856            - '[HV
+0001c4c0: 5352 2070 2a20 616e 6e5d 203a 2041 6e6e  SR p* ann] : Ann
+0001c4d0: 6f74 6174 6573 2070 6c6f 7420 7769 7468  otates plot with
+0001c4e0: 2070 6561 6b73 0a20 2020 2020 2020 2020   peaks.         
+0001c4f0: 2020 202d 2027 5b48 5653 525d 202d 7327     - '[HVSR] -s'
+0001c500: 203a 2048 5653 5220 706c 6f74 7320 646f   : HVSR plots do
+0001c510: 6e27 7420 7368 6f77 2073 7461 6e64 6172  n't show standar
+0001c520: 6420 6465 7669 6174 696f 6e0a 2020 2020  d deviation.    
+0001c530: 2020 2020 2020 2020 2d20 275b 4856 5352          - '[HVSR
+0001c540: 5d20 7427 203a 2048 5653 5220 706c 6f74  ] t' : HVSR plot
+0001c550: 2077 6974 6820 696e 6469 7669 6475 616c   with individual
+0001c560: 2068 7620 6375 7276 6573 2066 6f72 2065   hv curves for e
+0001c570: 6163 6820 7469 6d65 2073 7465 7020 7368  ach time step sh
+0001c580: 6f77 6e0a 2020 2020 2020 2020 2020 2020  own.            
+0001c590: 2d20 275b 4856 5352 5d20 6327 203a 2048  - '[HVSR] c' : H
+0001c5a0: 5653 5220 706c 6f74 2077 6974 6820 6561  VSR plot with ea
+0001c5b0: 6368 2063 6f6d 706f 6e65 6e74 7327 2073  ch components' s
+0001c5c0: 7065 6374 7261 2e20 5265 636f 6d6d 656e  pectra. Recommen
+0001c5d0: 6465 6420 746f 2064 6f20 7468 6973 206c  ded to do this l
+0001c5e0: 6173 7420 286f 7220 6a75 7374 2062 6566  ast (or just bef
+0001c5f0: 6f72 6520 2773 7065 6367 7261 6d27 292c  ore 'specgram'),
+0001c600: 2073 696e 6365 2064 6f69 6e67 2063 2b20   since doing c+ 
+0001c610: 6361 6e20 6d61 6b65 2074 6865 2063 6f6d  can make the com
+0001c620: 706f 6e65 6e74 2063 6861 7274 2069 7473  ponent chart its
+0001c630: 206f 776e 2063 6861 7274 0a20 2020 2020   own chart.     
+0001c640: 2020 2020 2020 2027 5370 6563 6772 616d         'Specgram
+0001c650: 2720 3a20 436f 6d62 696e 6564 2073 7065  ' : Combined spe
+0001c660: 6374 726f 6772 616d 206f 6620 616c 6c20  ctrogram of all 
+0001c670: 636f 6d70 6f6e 656e 7473 0a20 2020 2020  components.     
+0001c680: 2020 2020 2020 202d 2027 5b73 7065 635d         - '[spec]
+0001c690: 2720 3a20 6261 7369 6320 7370 6563 7472  ' : basic spectr
+0001c6a0: 6f67 7261 6d20 706c 6f74 206f 6620 482f  ogram plot of H/
+0001c6b0: 5620 6375 7276 650a 2020 2020 2020 2020  V curve.        
+0001c6c0: 7874 7970 6520 3a20 7374 722c 2064 6566  xtype : str, def
+0001c6d0: 6175 6c74 203d 2027 6672 6571 2720 2020  ault = 'freq'   
+0001c6e0: 200a 2020 2020 2020 2020 2020 2020 5374   .            St
+0001c6f0: 7269 6e67 2066 6f72 2077 6861 7420 746f  ring for what to
+0001c700: 2075 7365 2c20 6265 7477 6565 6e20 6672   use, between fr
+0001c710: 6571 7565 6e63 7920 6f72 2070 6572 696f  equency or perio
+0001c720: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+0001c730: 2020 466f 7220 6672 6571 7565 6e63 792c    For frequency,
+0001c740: 2074 6865 2066 6f6c 6c6f 7769 6e67 2061   the following a
+0001c750: 7265 2061 6363 6570 7465 6420 2863 6173  re accepted (cas
+0001c760: 6520 646f 6573 206e 6f74 206d 6174 7465  e does not matte
+0001c770: 7229 3a20 2766 272c 2027 487a 272c 2027  r): 'f', 'Hz', '
+0001c780: 6672 6571 272c 2027 6672 6571 7565 6e63  freq', 'frequenc
+0001c790: 7927 0a20 2020 2020 2020 2020 2020 2020  y'.             
+0001c7a0: 2020 2046 6f72 2070 6572 696f 642c 2074     For period, t
+0001c7b0: 6865 2066 6f6c 6c6f 7769 6e67 2061 7265  he following are
+0001c7c0: 2061 6363 6570 7465 6420 2863 6173 6520   accepted (case 
+0001c7d0: 646f 6573 206e 6f74 206d 6174 7465 7229  does not matter)
+0001c7e0: 3a20 2770 272c 2027 5427 2c20 2773 272c  : 'p', 'T', 's',
+0001c7f0: 2027 7365 6327 2c20 2773 6563 6f6e 6427   'sec', 'second'
+0001c800: 2c20 2770 6572 272c 2027 7065 7269 6f64  , 'per', 'period
+0001c810: 270a 2020 2020 2020 2020 7265 7475 726e  '.        return
+0001c820: 5f66 6967 2020 203a 2062 6f6f 6c0a 2020  _fig   : bool.  
+0001c830: 2020 2020 2020 2020 2020 5768 6574 6865            Whethe
+0001c840: 7220 746f 2072 6574 7572 6e20 6669 6775  r to return figu
+0001c850: 7265 2061 6e64 2061 7869 7320 6f62 6a65  re and axis obje
+0001c860: 6374 730a 2020 2020 2020 2020 7361 7665  cts.        save
+0001c870: 5f64 6972 2020 2020 203a 2073 7472 206f  _dir     : str o
+0001c880: 7220 4e6f 6e65 0a20 2020 2020 2020 2020  r None.         
+0001c890: 2020 2044 6972 6563 746f 7279 2069 6e20     Directory in 
+0001c8a0: 7768 6963 6820 746f 2073 6176 6520 6669  which to save fi
+0001c8b0: 6775 7265 730a 2020 2020 2020 2020 7361  gures.        sa
+0001c8c0: 7665 5f73 7566 6669 7820 203a 2073 7472  ve_suffix  : str
+0001c8d0: 0a20 2020 2020 2020 2020 2020 2053 7566  .            Suf
+0001c8e0: 6669 7820 746f 2061 6464 2074 6f20 656e  fix to add to en
+0001c8f0: 6420 6f66 2066 6967 7572 6520 6669 6c65  d of figure file
+0001c900: 6e61 6d65 2873 292c 2069 6620 7361 7665  name(s), if save
+0001c910: 5f64 6972 2069 7320 7573 6564 0a20 2020  _dir is used.   
+0001c920: 2020 2020 2073 686f 7720 2020 203a 2062       show    : b
+0001c930: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
+0001c940: 5768 6574 6865 7220 746f 2073 686f 7720  Whether to show 
+0001c950: 706c 6f74 0a20 2020 2020 2020 202a 2a6b  plot.        **k
+0001c960: 7761 7267 7320 2020 203a 206b 6579 776f  wargs    : keywo
+0001c970: 7264 2061 7267 756d 656e 7473 0a20 2020  rd arguments.   
+0001c980: 2020 2020 2020 2020 204b 6579 776f 7264           Keyword
+0001c990: 2061 7267 756d 656e 7473 2066 6f72 206d   arguments for m
+0001c9a0: 6174 706c 6f74 6c69 622e 7079 706c 6f74  atplotlib.pyplot
+0001c9b0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+0001c9c0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+0001c9d0: 2d0a 2020 2020 2020 2020 6669 672c 2061  -.        fig, a
+0001c9e0: 7820 3a20 6d61 7470 6c6f 746c 6962 2066  x : matplotlib f
+0001c9f0: 6967 7572 6520 616e 6420 6178 6973 206f  igure and axis o
+0001ca00: 626a 6563 7473 0a20 2020 2020 2020 2020  bjects.         
+0001ca10: 2020 2052 6574 7572 6e73 2066 6967 7572     Returns figur
+0001ca20: 6520 616e 6420 6178 6973 206d 6174 706c  e and axis matpl
+0001ca30: 6f74 6c69 622e 7079 706c 6f74 206f 626a  otlib.pyplot obj
+0001ca40: 6563 7473 2069 6620 7265 7475 726e 5f66  ects if return_f
+0001ca50: 6967 3d54 7275 652c 206f 7468 6572 7769  ig=True, otherwi
+0001ca60: 7365 2c20 7369 6d70 6c79 2070 6c6f 7473  se, simply plots
+0001ca70: 2074 6865 2066 6967 7572 6573 0a20 2020   the figures.   
+0001ca80: 2022 2222 0a20 2020 2023 706c 742e 7263   """.    #plt.rc
+0001ca90: 5061 7261 6d73 5b27 6669 6775 7265 2e64  Params['figure.d
+0001caa0: 7069 275d 203d 2035 3030 0a20 2020 2023  pi'] = 500.    #
+0001cab0: 706c 742e 7263 5061 7261 6d73 5b27 6669  plt.rcParams['fi
+0001cac0: 6775 7265 2e66 6967 7369 7a65 275d 203d  gure.figsize'] =
+0001cad0: 2028 3132 2c20 3329 0a0a 2020 2020 6672   (12, 3)..    fr
+0001cae0: 6571 4c69 7374 203d 205b 2746 272c 2027  eqList = ['F', '
+0001caf0: 485a 272c 2027 4652 4551 272c 2027 4652  HZ', 'FREQ', 'FR
+0001cb00: 4551 5545 4e43 5927 5d0a 2020 2020 7065  EQUENCY'].    pe
+0001cb10: 724c 6973 7420 3d20 2750 272c 2027 5427  rList = 'P', 'T'
+0001cb20: 2c20 2753 272c 2027 5345 4327 2c20 2753  , 'S', 'SEC', 'S
+0001cb30: 4543 4f4e 4427 2027 5045 5227 2c20 2750  ECOND' 'PER', 'P
+0001cb40: 4552 494f 4427 0a0a 2020 2020 6966 2078  ERIOD'..    if x
+0001cb50: 7479 7065 2e75 7070 6572 2829 2069 6e20  type.upper() in 
+0001cb60: 6672 6571 4c69 7374 3a0a 2020 2020 2020  freqList:.      
+0001cb70: 2020 7874 7970 653d 2778 5f66 7265 7173    xtype='x_freqs
+0001cb80: 270a 2020 2020 656c 6966 2078 7479 7065  '.    elif xtype
+0001cb90: 2e75 7070 6572 2829 2069 6e20 7065 724c  .upper() in perL
+0001cba0: 6973 743a 0a20 2020 2020 2020 2078 7479  ist:.        xty
+0001cbb0: 7065 3d27 785f 7065 7269 6f64 270a 2020  pe='x_period'.  
+0001cbc0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001cbd0: 7072 696e 7428 2778 7479 7065 206e 6f74  print('xtype not
+0001cbe0: 2076 616c 6964 2729 0a20 2020 2020 2020   valid').       
+0001cbf0: 2072 6574 7572 6e0a 2020 2020 0a20 2020   return.    .   
+0001cc00: 2073 7065 6367 7261 6d4c 6973 7420 3d20   specgramList = 
+0001cc10: 5b27 7370 6563 272c 2027 7370 6563 6772  ['spec', 'specgr
+0001cc20: 616d 272c 2027 7370 6563 7472 6f67 7261  am', 'spectrogra
+0001cc30: 6d27 5d0a 2020 2020 6876 7372 4c69 7374  m'].    hvsrList
+0001cc40: 203d 205b 2768 7673 7227 2c20 2768 7627   = ['hvsr', 'hv'
+0001cc50: 2c20 2768 275d 0a0a 2020 2020 6b4c 6973  , 'h']..    kLis
+0001cc60: 7420 3d20 6b69 6e64 2e73 706c 6974 2827  t = kind.split('
+0001cc70: 2027 290a 2020 2020 6368 6172 7453 7472   ').    chartStr
+0001cc80: 203d 205b 5d0a 2020 2020 6920 3d20 300a   = [].    i = 0.
+0001cc90: 2020 2020 666f 7220 6b20 696e 206b 4c69      for k in kLi
+0001cca0: 7374 3a0a 2020 2020 2020 2020 6b20 3d20  st:.        k = 
+0001ccb0: 6b2e 7374 7269 7028 292e 6c6f 7765 7228  k.strip().lower(
+0001ccc0: 290a 2020 2020 2020 2020 6966 2069 203d  ).        if i =
+0001ccd0: 3d20 3020 616e 6420 286b 2069 6e20 6876  = 0 and (k in hv
+0001cce0: 7372 4c69 7374 206f 7220 6b20 696e 2073  srList or k in s
+0001ccf0: 7065 6367 7261 6d4c 6973 7429 3a0a 2020  pecgramList):.  
+0001cd00: 2020 2020 2020 2020 2020 6368 6172 7454            chartT
+0001cd10: 7970 6520 3d20 6b20 2020 2020 2020 200a  ype = k        .
+0001cd20: 2020 2020 2020 2020 6966 2027 2b27 2069          if '+' i
+0001cd30: 6e20 6b20 6f72 2028 6b20 696e 2068 7673  n k or (k in hvs
+0001cd40: 724c 6973 7420 616e 6420 6920 3e20 3029  rList and i > 0)
+0001cd50: 206f 7220 286b 2069 6e20 7370 6563 6772   or (k in specgr
+0001cd60: 616d 4c69 7374 2061 6e64 2069 203e 2030  amList and i > 0
+0001cd70: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+0001cd80: 6620 6368 6172 7454 7970 6520 696e 2073  f chartType in s
+0001cd90: 7065 6367 7261 6d4c 6973 743a 0a20 2020  pecgramList:.   
+0001cda0: 2020 2020 2020 2020 2020 2020 2066 6967               fig
+0001cdb0: 2c20 6178 203d 2070 6c6f 745f 7370 6563  , ax = plot_spec
+0001cdc0: 6772 616d 5f68 7673 7228 6876 7372 5f64  gram_hvsr(hvsr_d
+0001cdd0: 6963 742c 2073 6176 6564 6972 3d73 6176  ict, savedir=sav
+0001cde0: 655f 6469 722c 2073 6176 655f 7375 6666  e_dir, save_suff
+0001cdf0: 6978 3d73 6176 655f 7375 6666 6978 2c20  ix=save_suffix, 
+0001ce00: 7368 6f77 3d73 686f 772c 206b 7761 7267  show=show, kwarg
+0001ce10: 733d 6b77 6172 6773 290a 2020 2020 2020  s=kwargs).      
+0001ce20: 2020 2020 2020 2020 2020 693d 300a 2020            i=0.  
+0001ce30: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0001ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce50: 6669 672c 2061 7820 3d20 706c 6f74 5f68  fig, ax = plot_h
+0001ce60: 7673 7228 6876 7372 5f64 6963 742c 206b  vsr(hvsr_dict, k
+0001ce70: 696e 643d 6368 6172 7453 7472 2c20 7874  ind=chartStr, xt
+0001ce80: 7970 653d 7874 7970 652c 2020 7361 7665  ype=xtype,  save
+0001ce90: 6469 723d 7361 7665 5f64 6972 2c20 7361  dir=save_dir, sa
+0001cea0: 7665 5f73 7566 6669 783d 7361 7665 5f73  ve_suffix=save_s
+0001ceb0: 7566 6669 782c 2073 686f 773d 7368 6f77  uffix, show=show
+0001cec0: 2c20 6b77 6172 6773 3d6b 7761 7267 7329  , kwargs=kwargs)
+0001ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cef0: 2069 3d30 0a0a 2020 2020 2020 2020 2020   i=0..          
+0001cf00: 2020 6966 2027 2b27 2069 6e20 6b3a 0a20    if '+' in k:. 
+0001cf10: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0001cf20: 203d 206b 2e72 6570 6c61 6365 2827 2b27   = k.replace('+'
+0001cf30: 2c20 2727 2920 2020 200a 2020 2020 2020  , '')    .      
+0001cf40: 2020 2020 2020 2020 2020 6368 6172 7453            chartS
+0001cf50: 7472 203d 205b 6b5d 0a20 2020 2020 2020  tr = [k].       
+0001cf60: 2020 2020 2020 2020 2066 6967 2c20 6178           fig, ax
+0001cf70: 203d 2070 6c6f 745f 6876 7372 2868 7673   = plot_hvsr(hvs
+0001cf80: 725f 6469 6374 2c20 6b69 6e64 3d63 6861  r_dict, kind=cha
+0001cf90: 7274 5374 722c 2078 7479 7065 3d78 7479  rtStr, xtype=xty
+0001cfa0: 7065 2c20 2073 6176 6564 6972 3d73 6176  pe,  savedir=sav
+0001cfb0: 655f 6469 722c 2073 6176 655f 7375 6666  e_dir, save_suff
+0001cfc0: 6978 3d73 6176 655f 7375 6666 6978 2c20  ix=save_suffix, 
+0001cfd0: 7368 6f77 3d73 686f 772c 206b 7761 7267  show=show, kwarg
+0001cfe0: 733d 6b77 6172 6773 290a 2020 2020 2020  s=kwargs).      
+0001cff0: 2020 2020 2020 6368 6172 7453 7472 203d        chartStr =
+0001d000: 205b 6b5d 0a20 2020 2020 2020 2065 6c73   [k].        els
+0001d010: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+0001d020: 2b3d 310a 2020 2020 2020 2020 2020 2020  +=1.            
+0001d030: 6368 6172 7453 7472 2e61 7070 656e 6428  chartStr.append(
+0001d040: 6b29 0a20 2020 2020 2020 2020 2020 200a  k).            .
+0001d050: 2020 2020 6966 206c 656e 2863 6861 7274      if len(chart
+0001d060: 5374 7229 203e 2030 3a0a 2020 2020 2020  Str) > 0:.      
+0001d070: 2020 6966 2069 203d 3d20 3020 616e 6420    if i == 0 and 
+0001d080: 286b 2069 6e20 6876 7372 4c69 7374 206f  (k in hvsrList o
+0001d090: 7220 6b20 696e 2073 7065 6367 7261 6d4c  r k in specgramL
+0001d0a0: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
+0001d0b0: 2020 6368 6172 7454 7970 6520 3d20 6b20    chartType = k 
+0001d0c0: 2020 2020 0a0a 2020 2020 2020 2020 6966      ..        if
+0001d0d0: 2063 6861 7274 5479 7065 2069 6e20 7370   chartType in sp
+0001d0e0: 6563 6772 616d 4c69 7374 3a0a 2020 2020  ecgramList:.    
+0001d0f0: 2020 2020 2020 2020 6669 672c 2061 7820          fig, ax 
+0001d100: 3d20 706c 6f74 5f73 7065 6367 7261 6d5f  = plot_specgram_
+0001d110: 6876 7372 2868 7673 725f 6469 6374 2c20  hvsr(hvsr_dict, 
+0001d120: 2073 6176 6564 6972 3d73 6176 655f 6469   savedir=save_di
+0001d130: 722c 2073 6176 655f 7375 6666 6978 3d73  r, save_suffix=s
+0001d140: 6176 655f 7375 6666 6978 2c20 7368 6f77  ave_suffix, show
+0001d150: 3d73 686f 772c 206b 7761 7267 733d 6b77  =show, kwargs=kw
+0001d160: 6172 6773 290a 2020 2020 2020 2020 656c  args).        el
+0001d170: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001d180: 6669 672c 2061 7820 3d20 706c 6f74 5f68  fig, ax = plot_h
+0001d190: 7673 7228 6876 7372 5f64 6963 742c 206b  vsr(hvsr_dict, k
+0001d1a0: 696e 643d 6368 6172 7453 7472 2c20 7874  ind=chartStr, xt
+0001d1b0: 7970 653d 7874 7970 652c 2020 7361 7665  ype=xtype,  save
+0001d1c0: 6469 723d 7361 7665 5f64 6972 2c20 7361  dir=save_dir, sa
+0001d1d0: 7665 5f73 7566 6669 783d 7361 7665 5f73  ve_suffix=save_s
+0001d1e0: 7566 6669 782c 2073 686f 773d 7368 6f77  uffix, show=show
+0001d1f0: 2c20 6b77 6172 6773 3d6b 7761 7267 7329  , kwargs=kwargs)
+0001d200: 0a0a 2020 2020 6966 2072 6574 7572 6e5f  ..    if return_
+0001d210: 6669 673a 0a20 2020 2020 2020 2072 6574  fig:.        ret
+0001d220: 7572 6e20 6669 672c 2061 780a 2020 2020  urn fig, ax.    
+0001d230: 0a20 2020 2072 6574 7572 6e0a 2020 2020  .    return.    
+0001d240: 0a23 506c 6f74 2068 7673 7220 6375 7276  .#Plot hvsr curv
+0001d250: 652c 2070 7269 7661 7465 2073 7570 706f  e, private suppo
+0001d260: 7274 696e 6720 6675 6e63 7469 6f6e 2066  rting function f
+0001d270: 6f72 2068 7670 6c6f 740a 6465 6620 706c  or hvplot.def pl
+0001d280: 6f74 5f68 7673 7228 6876 7372 5f64 6963  ot_hvsr(hvsr_dic
+0001d290: 742c 206b 696e 642c 2078 7479 7065 2c20  t, kind, xtype, 
+0001d2a0: 6669 673d 4e6f 6e65 2c20 6178 3d4e 6f6e  fig=None, ax=Non
+0001d2b0: 652c 2073 6176 655f 6469 723d 4e6f 6e65  e, save_dir=None
+0001d2c0: 2c20 7361 7665 5f73 7566 6669 783d 2727  , save_suffix=''
+0001d2d0: 2c20 7368 6f77 3d54 7275 652c 202a 2a6b  , show=True, **k
+0001d2e0: 7761 7267 7329 3a0a 2020 2020 2222 2250  wargs):.    """P
+0001d2f0: 7269 7661 7465 2066 756e 6374 696f 6e20  rivate function 
+0001d300: 666f 7220 706c 6f74 7469 6e67 2068 7673  for plotting hvs
+0001d310: 7220 6375 7276 6520 286f 7220 6375 7276  r curve (or curv
+0001d320: 6573 2077 6974 6820 636f 6d70 6f6e 656e  es with componen
+0001d330: 7473 290a 2020 2020 2222 220a 2020 2020  ts).    """.    
+0001d340: 6966 2027 6b77 6172 6773 2720 696e 206b  if 'kwargs' in k
+0001d350: 7761 7267 732e 6b65 7973 2829 3a0a 2020  wargs.keys():.  
+0001d360: 2020 2020 2020 6b77 6172 6773 203d 206b        kwargs = k
+0001d370: 7761 7267 735b 276b 7761 7267 7327 5d0a  wargs['kwargs'].
+0001d380: 0a20 2020 2069 6620 6669 6720 6973 204e  .    if fig is N
+0001d390: 6f6e 6520 616e 6420 6178 2069 7320 4e6f  one and ax is No
+0001d3a0: 6e65 3a0a 2020 2020 2020 2020 6669 672c  ne:.        fig,
+0001d3b0: 2061 7820 3d20 706c 742e 7375 6270 6c6f   ax = plt.subplo
+0001d3c0: 7473 2829 0a0a 2020 2020 6966 2027 786c  ts()..    if 'xl
+0001d3d0: 696d 2720 6e6f 7420 696e 206b 7761 7267  im' not in kwarg
+0001d3e0: 732e 6b65 7973 2829 3a0a 2020 2020 2020  s.keys():.      
+0001d3f0: 2020 786c 696d 203d 2068 7673 725f 6469    xlim = hvsr_di
+0001d400: 6374 5b27 6876 7372 5f62 616e 6427 5d0a  ct['hvsr_band'].
+0001d410: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001d420: 2020 786c 696d 203d 206b 7761 7267 735b    xlim = kwargs[
+0001d430: 2778 6c69 6d27 5d0a 2020 2020 0a20 2020  'xlim'].    .   
+0001d440: 2069 6620 2779 6c69 6d27 206e 6f74 2069   if 'ylim' not i
+0001d450: 6e20 6b77 6172 6773 2e6b 6579 7328 293a  n kwargs.keys():
+0001d460: 0a20 2020 2020 2020 2079 6c69 6d20 3d20  .        ylim = 
+0001d470: 5b30 2c20 6d61 7828 6876 7372 5f64 6963  [0, max(hvsr_dic
+0001d480: 745b 2768 7673 7270 3227 5d29 5d0a 2020  t['hvsrp2'])].  
+0001d490: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001d4a0: 796c 696d 203d 206b 7761 7267 735b 2779  ylim = kwargs['y
+0001d4b0: 6c69 6d27 5d0a 2020 2020 0a20 2020 2069  lim'].    .    i
+0001d4c0: 6620 2767 7269 6427 2069 6e20 6b77 6172  f 'grid' in kwar
+0001d4d0: 6773 2e6b 6579 7328 293a 0a20 2020 2020  gs.keys():.     
+0001d4e0: 2020 2070 6c74 2e67 7269 6428 7768 6963     plt.grid(whic
+0001d4f0: 683d 6b77 6172 6773 5b27 6772 6964 275d  h=kwargs['grid']
+0001d500: 2c20 616c 7068 613d 302e 3235 290a 0a20  , alpha=0.25).. 
+0001d510: 2020 2069 6620 7874 7970 653d 3d27 785f     if xtype=='x_
+0001d520: 6672 6571 7327 3a0a 2020 2020 2020 2020  freqs':.        
+0001d530: 786c 6162 656c 203d 2027 4672 6571 7565  xlabel = 'Freque
+0001d540: 6e63 7920 5b48 7a5d 270a 2020 2020 656c  ncy [Hz]'.    el
+0001d550: 7365 3a0a 2020 2020 2020 2020 786c 6162  se:.        xlab
+0001d560: 656c 203d 2027 5065 7269 6f64 205b 735d  el = 'Period [s]
+0001d570: 270a 0a20 2020 2069 6620 7361 7665 5f64  '..    if save_d
+0001d580: 6972 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ir is not None:.
+0001d590: 2020 2020 2020 2020 6669 6c65 6e61 6d65          filename
+0001d5a0: 203d 2068 7673 725f 6469 6374 5b27 696e   = hvsr_dict['in
+0001d5b0: 7075 745f 7061 7261 6d73 275d 5b27 7369  put_params']['si
+0001d5c0: 7465 275d 0a20 2020 2065 6c73 653a 0a20  te'].    else:. 
+0001d5d0: 2020 2020 2020 2066 696c 656e 616d 6520         filename 
+0001d5e0: 3d20 2222 0a0a 2020 2020 2361 7820 3d20  = ""..    #ax = 
+0001d5f0: 706c 742e 6763 6128 290a 2020 2020 2366  plt.gca().    #f
+0001d600: 6967 203d 2070 6c74 2e67 6366 2829 0a0a  ig = plt.gcf()..
+0001d610: 2020 2020 616e 794b 6579 203d 206c 6973      anyKey = lis
+0001d620: 7428 6876 7372 5f64 6963 745b 7874 7970  t(hvsr_dict[xtyp
+0001d630: 655d 2e6b 6579 7328 2929 5b30 5d0a 2020  e].keys())[0].  
+0001d640: 2020 7820 3d20 6876 7372 5f64 6963 745b    x = hvsr_dict[
+0001d650: 7874 7970 655d 5b61 6e79 4b65 795d 5b3a  xtype][anyKey][:
+0001d660: 2d31 5d0a 2020 2020 7920 3d20 6876 7372  -1].    y = hvsr
+0001d670: 5f64 6963 745b 2768 7673 725f 6375 7276  _dict['hvsr_curv
+0001d680: 6527 5d0a 2020 2020 0a20 2020 2070 6c6f  e'].    .    plo
+0001d690: 7453 7566 663d 2727 0a20 2020 206c 6567  tSuff=''.    leg
+0001d6a0: 656e 644c 6f63 203d 2027 7570 7065 7220  endLoc = 'upper 
+0001d6b0: 7269 6768 7427 0a20 2020 200a 2020 2020  right'.    .    
+0001d6c0: 706c 6f74 4856 5352 203d 2046 616c 7365  plotHVSR = False
+0001d6d0: 0a20 2020 2066 6f72 2069 7465 6d20 696e  .    for item in
+0001d6e0: 206b 696e 643a 0a20 2020 2020 2020 2069   kind:.        i
+0001d6f0: 6620 6974 656d 2e6c 6f77 6572 2829 3d3d  f item.lower()==
+0001d700: 2768 7673 7227 3a0a 2020 2020 2020 2020  'hvsr':.        
+0001d710: 2020 2020 706c 6f74 4856 5352 3d54 7275      plotHVSR=Tru
+0001d720: 650a 2020 2020 2020 2020 2020 2020 6178  e.            ax
+0001d730: 2e70 6c6f 7428 782c 2079 2c20 636f 6c6f  .plot(x, y, colo
+0001d740: 723d 276b 272c 206c 6162 656c 3d27 482f  r='k', label='H/
+0001d750: 5620 5261 7469 6f27 2c20 7a6f 7264 6572  V Ratio', zorder
+0001d760: 3d31 3030 3029 0a20 2020 2020 2020 2020  =1000).         
+0001d770: 2020 2070 6c6f 7453 7566 663d 2748 5653     plotSuff='HVS
+0001d780: 5243 7572 7665 5f27 0a20 2020 2020 2020  RCurve_'.       
+0001d790: 2020 2020 2069 6620 272d 7327 206e 6f74       if '-s' not
+0001d7a0: 2069 6e20 6b69 6e64 3a0a 2020 2020 2020   in kind:.      
+0001d7b0: 2020 2020 2020 2020 2020 6178 2e66 696c            ax.fil
+0001d7c0: 6c5f 6265 7477 6565 6e28 782c 2068 7673  l_between(x, hvs
+0001d7d0: 725f 6469 6374 5b27 6876 7372 6d32 275d  r_dict['hvsrm2']
+0001d7e0: 2c20 6876 7372 5f64 6963 745b 2768 7673  , hvsr_dict['hvs
+0001d7f0: 7270 3227 5d2c 2063 6f6c 6f72 3d27 6b27  rp2'], color='k'
+0001d800: 2c20 616c 7068 613d 302e 322c 206c 6162  , alpha=0.2, lab
+0001d810: 656c 3d27 5374 4465 7627 2c7a 6f72 6465  el='StDev',zorde
+0001d820: 723d 3939 3729 0a20 2020 2020 2020 2020  r=997).         
+0001d830: 2020 2020 2020 2061 782e 706c 6f74 2878         ax.plot(x
+0001d840: 2c20 6876 7372 5f64 6963 745b 2768 7673  , hvsr_dict['hvs
+0001d850: 726d 3227 5d2c 2063 6f6c 6f72 3d27 6b27  rm2'], color='k'
+0001d860: 2c20 616c 7068 613d 302e 3235 2c20 6c69  , alpha=0.25, li
+0001d870: 6e65 7769 6474 683d 302e 352c 207a 6f72  newidth=0.5, zor
+0001d880: 6465 723d 3939 3829 0a20 2020 2020 2020  der=998).       
+0001d890: 2020 2020 2020 2020 2061 782e 706c 6f74           ax.plot
+0001d8a0: 2878 2c20 6876 7372 5f64 6963 745b 2768  (x, hvsr_dict['h
+0001d8b0: 7673 7270 3227 5d2c 2063 6f6c 6f72 3d27  vsrp2'], color='
+0001d8c0: 6b27 2c20 616c 7068 613d 302e 3235 2c20  k', alpha=0.25, 
+0001d8d0: 6c69 6e65 7769 6474 683d 302e 352c 207a  linewidth=0.5, z
+0001d8e0: 6f72 6465 723d 3939 3929 0a20 2020 2020  order=999).     
+0001d8f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001d900: 2020 2020 2020 2020 2020 2020 2070 6c6f               plo
+0001d910: 7453 7566 6620 3d20 706c 6f74 5375 6666  tSuff = plotSuff
+0001d920: 2b27 6e6f 5374 6444 6576 5f27 0a20 2020  +'noStdDev_'.   
+0001d930: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
+0001d940: 2020 2020 6178 2e73 656d 696c 6f67 7828      ax.semilogx(
+0001d950: 290a 2020 2020 6178 2e73 6574 5f79 6c69  ).    ax.set_yli
+0001d960: 6d28 796c 696d 290a 2020 2020 6178 2e73  m(ylim).    ax.s
+0001d970: 6574 5f78 6c69 6d28 786c 696d 290a 2020  et_xlim(xlim).  
+0001d980: 2020 6178 2e73 6574 5f78 6c61 6265 6c28    ax.set_xlabel(
+0001d990: 786c 6162 656c 290a 2020 2020 6178 2e73  xlabel).    ax.s
+0001d9a0: 6574 5f79 6c61 6265 6c28 2748 2f56 2052  et_ylabel('H/V R
+0001d9b0: 6174 696f 272b 275c 6e5b 272b 6876 7372  atio'+'\n['+hvsr
+0001d9c0: 5f64 6963 745b 276d 6574 686f 6427 5d2b  _dict['method']+
+0001d9d0: 275d 2729 0a20 2020 2061 782e 7365 745f  ']').    ax.set_
+0001d9e0: 7469 746c 6528 6876 7372 5f64 6963 745b  title(hvsr_dict[
+0001d9f0: 2769 6e70 7574 5f70 6172 616d 7327 5d5b  'input_params'][
+0001da00: 2773 6974 6527 5d29 0a0a 0a20 2020 2066  'site'])...    f
+0001da10: 6f72 206b 2069 6e20 6b69 6e64 3a20 2020  or k in kind:   
+0001da20: 0a20 2020 2020 2020 2069 6620 6b3d 3d27  .        if k=='
+0001da30: 7027 2061 6e64 2027 616c 6c27 206e 6f74  p' and 'all' not
+0001da40: 2069 6e20 6b69 6e64 3a0a 2020 2020 2020   in kind:.      
+0001da50: 2020 2020 2020 706c 6f74 5375 6666 3d70        plotSuff=p
+0001da60: 6c6f 7453 7566 662b 2742 6573 7450 6561  lotSuff+'BestPea
+0001da70: 6b5f 270a 2020 2020 2020 2020 2020 2020  k_'.            
+0001da80: 0a20 2020 2020 2020 2020 2020 2062 6573  .            bes
+0001da90: 7450 6561 6b53 636f 7265 203d 2030 0a20  tPeakScore = 0. 
+0001daa0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+0001dab0: 2c20 7020 696e 2065 6e75 6d65 7261 7465  , p in enumerate
+0001dac0: 2868 7673 725f 6469 6374 5b27 5065 616b  (hvsr_dict['Peak
+0001dad0: 2052 6570 6f72 7427 5d29 3a0a 2020 2020   Report']):.    
+0001dae0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+0001daf0: 5b27 5363 6f72 6527 5d20 3e20 6265 7374  ['Score'] > best
+0001db00: 5065 616b 5363 6f72 653a 0a20 2020 2020  PeakScore:.     
+0001db10: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001db20: 6573 7450 6561 6b53 636f 7265 203d 2070  estPeakScore = p
+0001db30: 5b27 5363 6f72 6527 5d0a 2020 2020 2020  ['Score'].      
+0001db40: 2020 2020 2020 2020 2020 2020 2020 6265                be
+0001db50: 7374 5065 616b 203d 2070 0a0a 2020 2020  stPeak = p..    
+0001db60: 2020 2020 2020 2020 6178 2e61 7876 6c69          ax.axvli
+0001db70: 6e65 2862 6573 7450 6561 6b5b 2766 3027  ne(bestPeak['f0'
+0001db80: 5d2c 636f 6c6f 723d 276b 272c 206c 696e  ],color='k', lin
+0001db90: 6573 7479 6c65 3d27 646f 7474 6564 272c  estyle='dotted',
+0001dba0: 206c 6162 656c 3d27 5065 616b 2729 2020   label='Peak')  
+0001dbb0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0001dbc0: 2020 2020 2069 6620 2761 6e6e 2720 696e       if 'ann' in
+0001dbd0: 206b 696e 643a 0a20 2020 2020 2020 2020   kind:.         
+0001dbe0: 2020 2020 2020 2061 782e 616e 6e6f 7461         ax.annota
+0001dbf0: 7465 2827 5065 616b 2061 7420 272b 7374  te('Peak at '+st
+0001dc00: 7228 726f 756e 6428 6265 7374 5065 616b  r(round(bestPeak
+0001dc10: 5b27 6630 275d 2c32 2929 2b27 487a 272c  ['f0'],2))+'Hz',
+0001dc20: 2028 6265 7374 5065 616b 5b27 6630 275d   (bestPeak['f0']
+0001dc30: 2c20 6178 2e67 6574 5f79 6c69 6d28 295b  , ax.get_ylim()[
+0001dc40: 305d 292c 2078 7963 6f6f 7264 733d 2764  0]), xycoords='d
+0001dc50: 6174 6127 2c20 0a20 2020 2020 2020 2020  ata', .         
+0001dc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc70: 2020 2020 2020 2068 6f72 697a 6f6e 7461         horizonta
+0001dc80: 6c61 6c69 676e 6d65 6e74 3d27 6365 6e74  lalignment='cent
+0001dc90: 6572 272c 2076 6572 7469 6361 6c61 6c69  er', verticalali
+0001dca0: 676e 6d65 6e74 3d27 626f 7474 6f6d 272c  gnment='bottom',
+0001dcb0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
 0001dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dce0: 6262 6f78 3d64 6963 7428 6661 6365 636f  bbox=dict(faceco
-0001dcf0: 6c6f 723d 2777 272c 2065 6467 6563 6f6c  lor='w', edgecol
-0001dd00: 6f72 3d27 6e6f 6e65 272c 2061 6c70 6861  or='none', alpha
-0001dd10: 3d30 2e38 2c20 7061 643d 302e 3129 290a  =0.8, pad=0.1)).
-0001dd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd30: 706c 6f74 5375 6666 203d 2070 6c6f 7453  plotSuff = plotS
-0001dd40: 7566 662b 2761 6e6e 5f27 0a0a 2020 2020  uff+'ann_'..    
-0001dd50: 2020 2020 656c 6966 206b 3d3d 2770 2720      elif k=='p' 
-0001dd60: 2061 6e64 2027 616c 6c27 2069 6e20 6b69   and 'all' in ki
-0001dd70: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
-0001dd80: 706c 6f74 5375 6666 203d 2070 6c6f 7453  plotSuff = plotS
-0001dd90: 7566 662b 2761 6c6c 5065 616b 735f 270a  uff+'allPeaks_'.
-0001dda0: 0a20 2020 2020 2020 2020 2020 2061 782e  .            ax.
-0001ddb0: 766c 696e 6573 2868 7673 725f 6469 6374  vlines(hvsr_dict
-0001ddc0: 5b27 6876 7372 5f70 6561 6b5f 6672 6571  ['hvsr_peak_freq
-0001ddd0: 7327 5d2c 2061 782e 6765 745f 796c 696d  s'], ax.get_ylim
-0001dde0: 2829 5b30 5d2c 2061 782e 6765 745f 796c  ()[0], ax.get_yl
-0001ddf0: 696d 2829 5b31 5d2c 2063 6f6c 6f72 733d  im()[1], colors=
-0001de00: 276b 272c 206c 696e 6573 7479 6c65 733d  'k', linestyles=
-0001de10: 2764 6f74 7465 6427 2c20 6c61 6265 6c3d  'dotted', label=
-0001de20: 2750 6561 6b27 2920 2020 2020 2020 2020  'Peak')         
-0001de30: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
-0001de40: 2027 616e 6e27 2069 6e20 6b69 6e64 3a0a   'ann' in kind:.
-0001de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de60: 666f 7220 692c 2070 2069 6e20 656e 756d  for i, p in enum
-0001de70: 6572 6174 6528 6876 7372 5f64 6963 745b  erate(hvsr_dict[
-0001de80: 2768 7673 725f 7065 616b 5f66 7265 7173  'hvsr_peak_freqs
-0001de90: 275d 293a 0a20 2020 2020 2020 2020 2020  ']):.           
-0001dea0: 2020 2020 2020 2020 2079 203d 2068 7673           y = hvs
-0001deb0: 725f 6469 6374 5b27 6876 7372 5f63 7572  r_dict['hvsr_cur
-0001dec0: 7665 275d 5b68 7673 725f 6469 6374 5b27  ve'][hvsr_dict['
-0001ded0: 6876 7372 5f70 6561 6b5f 696e 6469 6365  hvsr_peak_indice
-0001dee0: 7327 5d5b 695d 5d0a 2020 2020 2020 2020  s'][i]].        
-0001def0: 2020 2020 2020 2020 2020 2020 6178 2e61              ax.a
-0001df00: 6e6e 6f74 6174 6528 2750 6561 6b20 6174  nnotate('Peak at
-0001df10: 2027 2b73 7472 2872 6f75 6e64 2870 2c32   '+str(round(p,2
-0001df20: 2929 2b27 487a 272c 2028 702c 2030 2e31  ))+'Hz', (p, 0.1
-0001df30: 292c 2078 7963 6f6f 7264 733d 2764 6174  ), xycoords='dat
-0001df40: 6127 2c20 0a20 2020 2020 2020 2020 2020  a', .           
-0001df50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df60: 2020 2020 2020 2020 2068 6f72 697a 6f6e           horizon
-0001df70: 7461 6c61 6c69 676e 6d65 6e74 3d27 6365  talalignment='ce
-0001df80: 6e74 6572 272c 2076 6572 7469 6361 6c61  nter', verticala
-0001df90: 6c69 676e 6d65 6e74 3d27 626f 7474 6f6d  lignment='bottom
-0001dfa0: 272c 200a 2020 2020 2020 2020 2020 2020  ', .            
-0001dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dfc0: 2020 2020 2020 2020 6262 6f78 3d64 6963          bbox=dic
-0001dfd0: 7428 6661 6365 636f 6c6f 723d 2777 272c  t(facecolor='w',
-0001dfe0: 2065 6467 6563 6f6c 6f72 3d27 6e6f 6e65   edgecolor='none
-0001dff0: 272c 2061 6c70 6861 3d30 2e38 2c20 7061  ', alpha=0.8, pa
-0001e000: 643d 302e 3129 290a 2020 2020 2020 2020  d=0.1)).        
-0001e010: 2020 2020 2020 2020 706c 6f74 5375 6666          plotSuff
-0001e020: 3d70 6c6f 7453 7566 662b 2761 6e6e 5f27  =plotSuff+'ann_'
-0001e030: 0a0a 2020 2020 2020 2020 6966 2027 7427  ..        if 't'
-0001e040: 2069 6e20 6b3a 0a20 2020 2020 2020 2020   in k:.         
-0001e050: 2020 2070 6c6f 7453 7566 6620 3d20 706c     plotSuff = pl
-0001e060: 6f74 5375 6666 2b27 616c 6c54 5769 6e43  otSuff+'allTWinC
-0001e070: 7572 7665 735f 270a 0a20 2020 2020 2020  urves_'..       
-0001e080: 2020 2020 2069 6620 6b3d 3d27 7470 273a       if k=='tp':
-0001e090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e0a0: 2066 6f72 206a 2c20 7420 696e 2065 6e75   for j, t in enu
-0001e0b0: 6d65 7261 7465 2868 7673 725f 6469 6374  merate(hvsr_dict
-0001e0c0: 5b27 696e 645f 6876 7372 5f70 6561 6b5f  ['ind_hvsr_peak_
-0001e0d0: 696e 6469 6365 7327 5d29 3a0a 2020 2020  indices']):.    
-0001e0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0f0: 666f 7220 692c 2076 2069 6e20 656e 756d  for i, v in enum
-0001e100: 6572 6174 6528 7429 3a0a 2020 2020 2020  erate(t):.      
-0001e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e120: 2020 763d 2078 5b76 5d0a 2020 2020 2020    v= x[v].      
-0001e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e140: 2020 6966 2069 3d3d 303a 0a20 2020 2020    if i==0:.     
-0001e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e160: 2020 2020 2020 2077 6964 7468 203d 2028         width = (
-0001e170: 785b 692b 315d 2d78 5b69 5d29 2f31 360a  x[i+1]-x[i])/16.
-0001e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e190: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001e1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1b0: 2020 2020 2020 2020 2020 7769 6474 6820            width 
-0001e1c0: 3d20 2878 5b69 5d2d 785b 692d 315d 292f  = (x[i]-x[i-1])/
-0001e1d0: 3136 0a20 2020 2020 2020 2020 2020 2020  16.             
-0001e1e0: 2020 2020 2020 2020 2020 2069 6620 6a20             if j 
-0001e1f0: 3d3d 2030 2061 6e64 2069 3d3d 303a 0a20  == 0 and i==0:. 
-0001e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e210: 2020 2020 2020 2020 2020 2061 782e 6669             ax.fi
-0001e220: 6c6c 5f62 6574 7765 656e 7828 796c 696d  ll_betweenx(ylim
-0001e230: 2c76 2d77 6964 7468 2c76 2b77 6964 7468  ,v-width,v+width
-0001e240: 2c20 636f 6c6f 723d 2772 272c 2061 6c70  , color='r', alp
-0001e250: 6861 3d30 2e30 352c 206c 6162 656c 3d27  ha=0.05, label='
-0001e260: 496e 6469 7669 6475 616c 2048 2f56 2050  Individual H/V P
-0001e270: 6561 6b73 2729 0a20 2020 2020 2020 2020  eaks').         
-0001e280: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001e290: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2b0: 6178 2e66 696c 6c5f 6265 7477 6565 6e78  ax.fill_betweenx
-0001e2c0: 2879 6c69 6d2c 762d 7769 6474 682c 762b  (ylim,v-width,v+
-0001e2d0: 7769 6474 682c 2063 6f6c 6f72 3d27 7227  width, color='r'
-0001e2e0: 2c20 616c 7068 613d 302e 3035 290a 2020  , alpha=0.05).  
-0001e2f0: 2020 2020 2020 2020 2020 666f 7220 7420            for t 
-0001e300: 696e 2068 7673 725f 6469 6374 5b27 696e  in hvsr_dict['in
-0001e310: 645f 6876 7372 5f63 7572 7665 7327 5d3a  d_hvsr_curves']:
-0001e320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e330: 2061 782e 706c 6f74 2878 2c20 742c 2063   ax.plot(x, t, c
-0001e340: 6f6c 6f72 3d27 6b27 2c20 616c 7068 613d  olor='k', alpha=
-0001e350: 302e 3135 2c20 6c69 6e65 7769 6474 683d  0.15, linewidth=
-0001e360: 302e 382c 206c 696e 6573 7479 6c65 3d27  0.8, linestyle='
-0001e370: 3a27 290a 0a20 2020 2020 2020 2069 6620  :')..        if 
-0001e380: 2763 2720 696e 206b 3a0a 2020 2020 2020  'c' in k:.      
-0001e390: 2020 2020 2020 706c 6f74 5375 6666 203d        plotSuff =
-0001e3a0: 2070 6c6f 7453 7566 662b 2749 6e64 436f   plotSuff+'IndCo
-0001e3b0: 6d70 6f6e 656e 7473 5f27 0a20 2020 2020  mponents_'.     
-0001e3c0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0001e3d0: 2020 2020 6966 206b 696e 645b 305d 2021      if kind[0] !
-0001e3e0: 3d20 2763 273a 0a20 2020 2020 2020 2020  = 'c':.         
-0001e3f0: 2020 2020 2020 2066 6967 2e74 6967 6874         fig.tight
-0001e400: 5f6c 6179 6f75 7428 290a 2020 2020 2020  _layout().      
-0001e410: 2020 2020 2020 2020 2020 6178 6973 3220            axis2 
-0001e420: 3d20 6178 2e74 7769 6e78 2829 0a20 2020  = ax.twinx().   
-0001e430: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-0001e440: 7041 7869 7320 3d20 6178 6973 320a 2020  pAxis = axis2.  
-0001e450: 2020 2020 2020 2020 2020 2020 2020 2361                #a
-0001e460: 7869 7332 203d 2070 6c74 2e67 6361 2829  xis2 = plt.gca()
-0001e470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e480: 2023 6669 6720 3d20 706c 742e 6763 6628   #fig = plt.gcf(
-0001e490: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001e4a0: 2020 636f 6d70 4178 6973 2e73 6574 5f79    compAxis.set_y
-0001e4b0: 6c61 6265 6c28 2741 6d70 6c69 7475 6465  label('Amplitude
-0001e4c0: 272b 275c 6e5b 6d32 2f73 342f 487a 5d20  '+'\n[m2/s4/Hz] 
-0001e4d0: 5b64 425d 2729 0a20 2020 2020 2020 2020  [dB]').         
-0001e4e0: 2020 2020 2020 2063 6f6d 7041 7869 732e         compAxis.
-0001e4f0: 7365 745f 6661 6365 636f 6c6f 7228 5b30  set_facecolor([0
-0001e500: 2c30 2c30 2c30 5d29 0a20 2020 2020 2020  ,0,0,0]).       
-0001e510: 2020 2020 2020 2020 206c 6567 656e 644c           legendL
-0001e520: 6f63 3220 3d20 2775 7070 6572 206c 6566  oc2 = 'upper lef
-0001e530: 7427 0a20 2020 2020 2020 2020 2020 2020  t'.             
-0001e540: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0001e550: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001e560: 2020 2020 2020 6178 2e73 6574 5f74 6974        ax.set_tit
-0001e570: 6c65 2868 7673 725f 6469 6374 5b27 696e  le(hvsr_dict['in
-0001e580: 7075 745f 7061 7261 6d73 275d 5b27 7369  put_params']['si
-0001e590: 7465 275d 2b27 3a20 496e 6469 7669 6475  te']+': Individu
-0001e5a0: 616c 2043 6f6d 706f 6e65 6e74 7327 290a  al Components').
-0001e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5c0: 2361 7820 3d20 706c 742e 6763 6128 290a  #ax = plt.gca().
-0001e5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5e0: 2366 6967 203d 2070 6c74 2e67 6366 2829  #fig = plt.gcf()
-0001e5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e600: 2063 6f6d 7041 7869 7320 3d20 6178 0a20   compAxis = ax. 
-0001e610: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0001e620: 6567 656e 644c 6f63 3220 3d20 2775 7070  egendLoc2 = 'upp
-0001e630: 6572 2072 6967 6874 270a 2020 2020 2020  er right'.      
-0001e640: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0001e650: 2020 2020 2020 206d 696e 5920 3d20 5b5d         minY = []
-0001e660: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
-0001e670: 5920 3d20 5b5d 0a20 2020 2020 2020 2020  Y = [].         
-0001e680: 2020 2066 6f72 206b 6579 2069 6e20 6876     for key in hv
-0001e690: 7372 5f64 6963 745b 2770 7364 5f76 616c  sr_dict['psd_val
-0001e6a0: 7565 735f 7461 7667 275d 3a0a 2020 2020  ues_tavg']:.    
-0001e6b0: 2020 2020 2020 2020 2020 2020 6d69 6e59              minY
-0001e6c0: 2e61 7070 656e 6428 6d69 6e28 6876 7372  .append(min(hvsr
-0001e6d0: 5f64 6963 745b 2770 7073 645f 7374 645f  _dict['ppsd_std_
-0001e6e0: 7661 6c73 5f6d 275d 5b6b 6579 5d29 290a  vals_m'][key])).
-0001e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e700: 6d61 7859 2e61 7070 656e 6428 6d61 7828  maxY.append(max(
-0001e710: 6876 7372 5f64 6963 745b 2770 7073 645f  hvsr_dict['ppsd_
-0001e720: 7374 645f 7661 6c73 5f70 275d 5b6b 6579  std_vals_p'][key
-0001e730: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
-0001e740: 6d69 6e59 203d 206d 696e 286d 696e 5929  minY = min(minY)
-0001e750: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
-0001e760: 5920 3d20 6d61 7828 6d61 7859 290a 2020  Y = max(maxY).  
-0001e770: 2020 2020 2020 2020 2020 726e 6720 3d20            rng = 
-0001e780: 6d61 7859 2d6d 696e 590a 2020 2020 2020  maxY-minY.      
-0001e790: 2020 2020 2020 7061 6420 3d20 726e 6720        pad = rng 
-0001e7a0: 2a20 302e 3035 0a20 2020 2020 2020 2020  * 0.05.         
-0001e7b0: 2020 2079 6c69 6d20 3d20 5b6d 696e 592d     ylim = [minY-
-0001e7c0: 7061 642c 206d 6178 592b 7061 645d 0a20  pad, maxY+pad]. 
-0001e7d0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0001e7e0: 2020 2020 636f 6d70 4178 6973 2e73 6574      compAxis.set
-0001e7f0: 5f79 6c61 6265 6c28 2741 6d70 6c69 7475  _ylabel('Amplitu
-0001e800: 6465 272b 275c 6e5b 6d32 2f73 342f 487a  de'+'\n[m2/s4/Hz
-0001e810: 5d20 5b64 425d 2729 0a20 2020 2020 2020  ] [dB]').       
-0001e820: 2020 2020 2063 6f6d 7041 7869 732e 7365       compAxis.se
-0001e830: 745f 796c 696d 2879 6c69 6d29 0a0a 2020  t_ylim(ylim)..  
-0001e840: 2020 2020 2020 2020 2020 234d 6f64 6966            #Modif
-0001e850: 7920 6261 7365 6420 6f6e 2077 6865 7468  y based on wheth
-0001e860: 6572 2074 6865 7265 2061 7265 206d 756c  er there are mul
-0001e870: 7469 706c 6520 6368 6172 7473 0a20 2020  tiple charts.   
-0001e880: 2020 2020 2020 2020 2069 6620 706c 6f74           if plot
-0001e890: 4856 5352 3a0a 2020 2020 2020 2020 2020  HVSR:.          
-0001e8a0: 2020 2020 2020 6c69 6e61 6c70 6861 203d        linalpha =
-0001e8b0: 2030 2e32 0a20 2020 2020 2020 2020 2020   0.2.           
-0001e8c0: 2020 2020 2073 7464 616c 7068 6120 3d20       stdalpha = 
-0001e8d0: 302e 3035 0a20 2020 2020 2020 2020 2020  0.05.           
-0001e8e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001e8f0: 2020 2020 2020 206c 696e 616c 7068 613d         linalpha=
-0001e900: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-0001e910: 2020 7374 6461 6c70 6861 3d30 2e32 0a20    stdalpha=0.2. 
-0001e920: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0001e930: 2020 2020 2020 2020 2350 6c6f 7420 696e          #Plot in
-0001e940: 6469 7669 6475 616c 2063 6f6d 706f 6e65  dividual compone
-0001e950: 6e74 730a 2020 2020 2020 2020 2020 2020  nts.            
-0001e960: 793d 7b7d 0a20 2020 2020 2020 2020 2020  y={}.           
-0001e970: 2066 6f72 206b 6579 2069 6e20 6876 7372   for key in hvsr
-0001e980: 5f64 6963 745b 2770 7364 5f76 616c 7565  _dict['psd_value
-0001e990: 735f 7461 7667 275d 3a0a 2020 2020 2020  s_tavg']:.      
-0001e9a0: 2020 2020 2020 2020 2020 795b 6b65 795d            y[key]
-0001e9b0: 203d 2068 7673 725f 6469 6374 5b27 7073   = hvsr_dict['ps
-0001e9c0: 645f 7661 6c75 6573 5f74 6176 6727 5d5b  d_values_tavg'][
-0001e9d0: 6b65 795d 5b3a 2d31 5d0a 0a20 2020 2020  key][:-1]..     
-0001e9e0: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
-0001e9f0: 7920 3d3d 2027 5a27 3a0a 2020 2020 2020  y == 'Z':.      
-0001ea00: 2020 2020 2020 2020 2020 2020 2020 706c                pl
-0001ea10: 7443 6f6c 6f72 203d 2027 6b27 0a20 2020  tColor = 'k'.   
-0001ea20: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-0001ea30: 6620 6b65 7920 3d3d 2745 273a 0a20 2020  f key =='E':.   
-0001ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea50: 2070 6c74 436f 6c6f 7220 3d20 2762 270a   pltColor = 'b'.
-0001ea60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea70: 656c 6966 206b 6579 203d 3d20 274e 273a  elif key == 'N':
-0001ea80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ea90: 2020 2020 2070 6c74 436f 6c6f 7220 3d20       pltColor = 
-0001eaa0: 2772 270a 0a20 2020 2020 2020 2020 2020  'r'..           
-0001eab0: 2020 2020 2063 6f6d 7041 7869 732e 706c       compAxis.pl
-0001eac0: 6f74 2878 2c20 795b 6b65 795d 2c20 633d  ot(x, y[key], c=
-0001ead0: 706c 7443 6f6c 6f72 2c20 6c61 6265 6c3d  pltColor, label=
-0001eae0: 6b65 792c 2061 6c70 6861 3d6c 696e 616c  key, alpha=linal
-0001eaf0: 7068 6129 0a20 2020 2020 2020 2020 2020  pha).           
-0001eb00: 2020 2020 2069 6620 272d 7327 206e 6f74       if '-s' not
-0001eb10: 2069 6e20 6b69 6e64 3a0a 2020 2020 2020   in kind:.      
-0001eb20: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001eb30: 6d70 4178 6973 2e66 696c 6c5f 6265 7477  mpAxis.fill_betw
-0001eb40: 6565 6e28 782c 2068 7673 725f 6469 6374  een(x, hvsr_dict
-0001eb50: 5b27 7070 7364 5f73 7464 5f76 616c 735f  ['ppsd_std_vals_
-0001eb60: 6d27 5d5b 6b65 795d 5b3a 2d31 5d2c 2068  m'][key][:-1], h
-0001eb70: 7673 725f 6469 6374 5b27 7070 7364 5f73  vsr_dict['ppsd_s
-0001eb80: 7464 5f76 616c 735f 7027 5d5b 6b65 795d  td_vals_p'][key]
-0001eb90: 5b3a 2d31 5d2c 2063 6f6c 6f72 3d70 6c74  [:-1], color=plt
-0001eba0: 436f 6c6f 722c 2061 6c70 6861 3d73 7464  Color, alpha=std
-0001ebb0: 616c 7068 6129 0a20 2020 2020 2020 2020  alpha).         
-0001ebc0: 2020 2020 2020 2069 6620 6b69 6e64 5b30         if kind[0
-0001ebd0: 5d20 213d 2027 6327 3a0a 2020 2020 2020  ] != 'c':.      
-0001ebe0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001ebf0: 6d70 4178 6973 2e6c 6567 656e 6428 6c6f  mpAxis.legend(lo
-0001ec00: 633d 6c65 6765 6e64 4c6f 6332 290a 2020  c=legendLoc2).  
-0001ec10: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0001ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ec30: 7061 7373 2361 782e 6c65 6765 6e64 286c  pass#ax.legend(l
-0001ec40: 6f63 3d6c 6567 656e 644c 6f63 290a 0a20  oc=legendLoc).. 
-0001ec50: 2020 2062 626f 7820 3d20 6178 2e67 6574     bbox = ax.get
-0001ec60: 5f77 696e 646f 775f 6578 7465 6e74 2829  _window_extent()
-0001ec70: 0a20 2020 2062 626f 7853 7461 7274 203d  .    bboxStart =
-0001ec80: 2062 626f 782e 5f5f 7374 725f 5f28 292e   bbox.__str__().
-0001ec90: 6669 6e64 2827 4262 6f78 2827 2c30 2c35  find('Bbox(',0,5
-0001eca0: 3029 2b35 0a20 2020 2062 626f 7853 7472  0)+5.    bboxStr
-0001ecb0: 203d 2062 626f 782e 5f5f 7374 725f 5f28   = bbox.__str__(
-0001ecc0: 295b 6262 6f78 5374 6172 743a 5d2e 7370  )[bboxStart:].sp
-0001ecd0: 6c69 7428 272c 2729 5b3a 345d 0a20 2020  lit(',')[:4].   
-0001ece0: 2061 7869 7362 6f78 203d 205b 5d0a 2020   axisbox = [].  
-0001ecf0: 2020 666f 7220 6920 696e 2062 626f 7853    for i in bboxS
-0001ed00: 7472 3a0a 2020 2020 2020 2020 6920 3d20  tr:.        i = 
-0001ed10: 692e 7370 6c69 7428 273d 2729 5b31 5d0a  i.split('=')[1].
-0001ed20: 2020 2020 2020 2020 6966 2027 2927 2069          if ')' i
-0001ed30: 6e20 693a 0a20 2020 2020 2020 2020 2020  n i:.           
-0001ed40: 2069 203d 2069 5b3a 2d31 5d0a 2020 2020   i = i[:-1].    
-0001ed50: 2020 2020 6178 6973 626f 782e 6170 7065      axisbox.appe
-0001ed60: 6e64 2866 6c6f 6174 2869 2929 0a20 2020  nd(float(i)).   
-0001ed70: 2023 7072 696e 7428 6178 6973 626f 7829   #print(axisbox)
-0001ed80: 0a20 2020 2023 7072 696e 7428 6178 2e67  .    #print(ax.g
-0001ed90: 6574 5f70 6f73 6974 696f 6e28 2929 0a0a  et_position())..
-0001eda0: 2020 2020 6178 2e6c 6567 656e 6428 6c6f      ax.legend(lo
-0001edb0: 633d 6c65 6765 6e64 4c6f 6329 0a0a 2020  c=legendLoc)..  
-0001edc0: 2020 5f5f 706c 6f74 5f63 7572 7265 6e74    __plot_current
-0001edd0: 5f66 6967 2873 6176 655f 6469 723d 7361  _fig(save_dir=sa
-0001ede0: 7665 5f64 6972 2c20 0a20 2020 2020 2020  ve_dir, .       
-0001edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee00: 2066 696c 656e 616d 653d 6669 6c65 6e61   filename=filena
-0001ee10: 6d65 2c20 0a20 2020 2020 2020 2020 2020  me, .           
-0001ee20: 2020 2020 2020 2020 2020 2020 2066 6967               fig
-0001ee30: 3d66 6967 2c20 6178 3d61 782c 0a20 2020  =fig, ax=ax,.   
-0001ee40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee50: 2020 2020 2070 6c6f 745f 7375 6666 6978       plot_suffix
-0001ee60: 3d70 6c6f 7453 7566 662c 200a 2020 2020  =plotSuff, .    
-0001ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee80: 2020 2020 7573 6572 5f73 7566 6669 783d      user_suffix=
-0001ee90: 7361 7665 5f73 7566 6669 782c 200a 2020  save_suffix, .  
-0001eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eeb0: 2020 2020 2020 7368 6f77 3d73 686f 7729        show=show)
-0001eec0: 0a20 2020 200a 2020 2020 7265 7475 726e  .    .    return
-0001eed0: 2066 6967 2c20 6178 0a0a 2350 7269 7661   fig, ax..#Priva
-0001eee0: 7465 2066 756e 6374 696f 6e20 746f 2068  te function to h
-0001eef0: 656c 7020 666f 7220 7768 656e 2074 6f20  elp for when to 
-0001ef00: 7368 6f77 2061 6e64 2066 6f72 6d61 7420  show and format 
-0001ef10: 616e 6420 7361 7665 2070 6c6f 7473 0a64  and save plots.d
-0001ef20: 6566 205f 5f70 6c6f 745f 6375 7272 656e  ef __plot_curren
-0001ef30: 745f 6669 6728 7361 7665 5f64 6972 2c20  t_fig(save_dir, 
-0001ef40: 6669 6c65 6e61 6d65 2c20 6669 672c 2061  filename, fig, a
-0001ef50: 782c 2070 6c6f 745f 7375 6666 6978 2c20  x, plot_suffix, 
-0001ef60: 7573 6572 5f73 7566 6669 782c 2073 686f  user_suffix, sho
-0001ef70: 7729 3a0a 2020 2020 2222 2250 7269 7661  w):.    """Priva
-0001ef80: 7465 2066 756e 6374 696f 6e20 746f 2073  te function to s
-0001ef90: 7570 706f 7274 2068 7670 6c6f 742c 2066  upport hvplot, f
-0001efa0: 6f72 2070 6c6f 7474 696e 6720 616e 6420  or plotting and 
-0001efb0: 7368 6f77 696e 6720 706c 6f74 7322 2222  showing plots"""
-0001efc0: 0a20 2020 2023 706c 742e 6763 6128 290a  .    #plt.gca().
-0001efd0: 2020 2020 2370 6c74 2e67 6366 2829 0a20      #plt.gcf(). 
-0001efe0: 2020 2066 6967 2e74 6967 6874 5f6c 6179     fig.tight_lay
-0001eff0: 6f75 7428 290a 0a20 2020 2023 706c 742e  out()..    #plt.
-0001f000: 7375 6270 6c6f 7473 5f61 646a 7573 7428  subplots_adjust(
-0001f010: 746f 7020 3d20 312c 2062 6f74 746f 6d20  top = 1, bottom 
-0001f020: 3d20 302c 2072 6967 6874 203d 2031 2c20  = 0, right = 1, 
-0001f030: 6c65 6674 203d 2030 2c20 6873 7061 6365  left = 0, hspace
-0001f040: 203d 2030 2c20 7773 7061 6365 203d 2030   = 0, wspace = 0
-0001f050: 290a 0a20 2020 2069 6620 7361 7665 5f64  )..    if save_d
-0001f060: 6972 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ir is not None:.
-0001f070: 2020 2020 2020 2020 6f75 7446 696c 6520          outFile 
-0001f080: 3d20 7361 7665 5f64 6972 2b27 2f27 2b66  = save_dir+'/'+f
-0001f090: 696c 656e 616d 652b 275f 272b 706c 6f74  ilename+'_'+plot
-0001f0a0: 5f73 7566 6669 782b 7374 7228 6461 7465  _suffix+str(date
-0001f0b0: 7469 6d65 2e64 6174 6574 696d 652e 746f  time.datetime.to
-0001f0c0: 6461 7928 292e 6461 7465 2829 292b 275f  day().date())+'_
-0001f0d0: 272b 7573 6572 5f73 7566 6669 782b 272e  '+user_suffix+'.
-0001f0e0: 706e 6727 0a20 2020 2020 2020 2066 6967  png'.        fig
-0001f0f0: 2e73 6176 6566 6967 286f 7574 4669 6c65  .savefig(outFile
-0001f100: 2c20 6262 6f78 5f69 6e63 6865 733d 2774  , bbox_inches='t
-0001f110: 6967 6874 272c 2070 6164 5f69 6e63 6865  ight', pad_inche
-0001f120: 733d 302e 3229 0a20 2020 2069 6620 7368  s=0.2).    if sh
-0001f130: 6f77 3a0a 2020 2020 2020 2020 6669 672e  ow:.        fig.
-0001f140: 6361 6e76 6173 2e64 7261 7728 2923 2e73  canvas.draw()#.s
-0001f150: 686f 7728 290a 2020 2020 2020 2020 6669  how().        fi
-0001f160: 672e 7469 6768 745f 6c61 796f 7574 2829  g.tight_layout()
-0001f170: 0a20 2020 2020 2020 2023 706c 742e 696f  .        #plt.io
-0001f180: 6e28 290a 2020 2020 7265 7475 726e 0a0a  n().    return..
-0001f190: 2350 6c6f 7420 7370 6563 6774 726f 6772  #Plot specgtrogr
-0001f1a0: 616d 2c20 7072 6976 6174 6520 7375 7070  am, private supp
-0001f1b0: 6f72 7469 6e67 2066 756e 6374 696f 6e20  orting function 
-0001f1c0: 666f 7220 6876 706c 6f74 0a64 6566 2070  for hvplot.def p
-0001f1d0: 6c6f 745f 7370 6563 6772 616d 5f68 7673  lot_specgram_hvs
-0001f1e0: 7228 6876 7372 5f64 6963 742c 2066 6967  r(hvsr_dict, fig
-0001f1f0: 3d4e 6f6e 652c 2061 783d 4e6f 6e65 2c20  =None, ax=None, 
-0001f200: 7361 7665 5f64 6972 3d4e 6f6e 652c 2073  save_dir=None, s
-0001f210: 6176 655f 7375 6666 6978 3d27 272c 2a2a  ave_suffix='',**
-0001f220: 6b77 6172 6773 293a 0a20 2020 2022 2222  kwargs):.    """
-0001f230: 5072 6976 6174 6520 6675 6e63 7469 6f6e  Private function
-0001f240: 2066 6f72 2070 6c6f 7474 696e 6720 6176   for plotting av
-0001f250: 6572 6167 6520 7370 6563 7472 6f67 7261  erage spectrogra
-0001f260: 6d20 6f66 2061 6c6c 2074 6872 6565 2063  m of all three c
-0001f270: 6861 6e6e 656c 7320 6672 6f6d 2070 7073  hannels from pps
-0001f280: 6473 0a20 2020 2022 2222 0a20 2020 2069  ds.    """.    i
-0001f290: 6620 6669 6720 6973 204e 6f6e 6520 616e  f fig is None an
-0001f2a0: 6420 6178 2069 7320 4e6f 6e65 3a0a 2020  d ax is None:.  
-0001f2b0: 2020 2020 2020 6669 672c 2061 7820 3d20        fig, ax = 
-0001f2c0: 706c 742e 7375 6270 6c6f 7473 2829 2020  plt.subplots()  
-0001f2d0: 2020 0a0a 2020 2020 6966 2027 6b77 6172    ..    if 'kwar
-0001f2e0: 6773 2720 696e 206b 7761 7267 732e 6b65  gs' in kwargs.ke
-0001f2f0: 7973 2829 3a0a 2020 2020 2020 2020 6b77  ys():.        kw
-0001f300: 6172 6773 203d 206b 7761 7267 735b 276b  args = kwargs['k
-0001f310: 7761 7267 7327 5d0a 0a20 2020 2069 6620  wargs']..    if 
-0001f320: 2770 6561 6b5f 706c 6f74 2720 696e 206b  'peak_plot' in k
-0001f330: 7761 7267 732e 6b65 7973 2829 3a0a 2020  wargs.keys():.  
-0001f340: 2020 2020 2020 7065 616b 5f70 6c6f 743d        peak_plot=
-0001f350: 5472 7565 0a20 2020 2020 2020 2064 656c  True.        del
-0001f360: 206b 7761 7267 735b 2770 6561 6b5f 706c   kwargs['peak_pl
-0001f370: 6f74 275d 0a20 2020 2065 6c73 653a 0a20  ot'].    else:. 
-0001f380: 2020 2020 2020 2070 6561 6b5f 706c 6f74         peak_plot
-0001f390: 3d46 616c 7365 0a20 2020 2020 2020 200a  =False.        .
-0001f3a0: 0a20 2020 2069 6620 2767 7269 6427 2069  .    if 'grid' i
-0001f3b0: 6e20 6b77 6172 6773 2e6b 6579 7328 293a  n kwargs.keys():
-0001f3c0: 0a20 2020 2020 2020 2061 782e 6772 6964  .        ax.grid
-0001f3d0: 2877 6869 6368 3d6b 7761 7267 735b 2767  (which=kwargs['g
-0001f3e0: 7269 6427 5d2c 2061 6c70 6861 3d30 2e32  rid'], alpha=0.2
-0001f3f0: 3529 0a20 2020 2020 2020 2064 656c 206b  5).        del k
-0001f400: 7761 7267 735b 2767 7269 6427 5d0a 2020  wargs['grid'].  
-0001f410: 2020 2020 2020 0a20 2020 2069 6620 2779        .    if 'y
-0001f420: 7479 7065 2720 696e 206b 7761 7267 733a  type' in kwargs:
-0001f430: 0a20 2020 2020 2020 2069 6620 6b77 6172  .        if kwar
-0001f440: 6773 5b27 7974 7970 6527 5d3d 3d27 6672  gs['ytype']=='fr
-0001f450: 6571 273a 0a20 2020 2020 2020 2020 2020  eq':.           
-0001f460: 2079 6c61 6265 6c20 3d20 2746 7265 7175   ylabel = 'Frequ
-0001f470: 656e 6379 205b 487a 5d27 0a20 2020 2020  ency [Hz]'.     
-0001f480: 2020 2020 2020 2064 656c 206b 7761 7267         del kwarg
-0001f490: 735b 2779 7479 7065 275d 0a20 2020 2020  s['ytype'].     
-0001f4a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001f4b0: 2020 2020 2079 6c61 6265 6c20 3d20 2750       ylabel = 'P
-0001f4c0: 6572 696f 6420 5b73 5d27 0a20 2020 2020  eriod [s]'.     
-0001f4d0: 2020 2064 656c 206b 7761 7267 735b 2779     del kwargs['y
-0001f4e0: 7479 7065 275d 0a20 2020 2065 6c73 653a  type'].    else:
-0001f4f0: 0a20 2020 2020 2020 2079 6c61 6265 6c3d  .        ylabel=
-0001f500: 2746 7265 7175 656e 6379 205b 487a 5d27  'Frequency [Hz]'
-0001f510: 0a20 2020 2020 2020 200a 2020 2020 6966  .        .    if
-0001f520: 2027 6465 7472 656e 6427 2069 6e20 6b77   'detrend' in kw
-0001f530: 6172 6773 2e6b 6579 7328 293a 0a20 2020  args.keys():.   
-0001f540: 2020 2020 2064 6574 7265 6e64 3d20 6b77       detrend= kw
-0001f550: 6172 6773 5b27 6465 7472 656e 6427 5d0a  args['detrend'].
-0001f560: 2020 2020 2020 2020 6465 6c20 6b77 6172          del kwar
-0001f570: 6773 5b27 6465 7472 656e 6427 5d0a 2020  gs['detrend'].  
-0001f580: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001f590: 6465 7472 656e 643d 5472 7565 0a0a 2020  detrend=True..  
-0001f5a0: 2020 6966 2027 636f 6c6f 7262 6172 2720    if 'colorbar' 
-0001f5b0: 696e 206b 7761 7267 732e 6b65 7973 2829  in kwargs.keys()
-0001f5c0: 3a0a 2020 2020 2020 2020 636f 6c6f 7262  :.        colorb
-0001f5d0: 6172 203d 206b 7761 7267 735b 2763 6f6c  ar = kwargs['col
-0001f5e0: 6f72 6261 7227 5d0a 2020 2020 2020 2020  orbar'].        
-0001f5f0: 6465 6c20 6b77 6172 6773 5b27 636f 6c6f  del kwargs['colo
-0001f600: 7262 6172 275d 0a20 2020 2065 6c73 653a  rbar'].    else:
-0001f610: 0a20 2020 2020 2020 2063 6f6c 6f72 6261  .        colorba
-0001f620: 723d 5472 7565 0a0a 2020 2020 6966 2027  r=True..    if '
-0001f630: 636d 6170 2720 696e 206b 7761 7267 732e  cmap' in kwargs.
-0001f640: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
-0001f650: 7061 7373 0a20 2020 2065 6c73 653a 0a20  pass.    else:. 
-0001f660: 2020 2020 2020 206b 7761 7267 735b 2763         kwargs['c
-0001f670: 6d61 7027 5d20 3d20 2774 7572 626f 270a  map'] = 'turbo'.
-0001f680: 0a20 2020 2070 7073 6473 203d 2068 7673  .    ppsds = hvs
-0001f690: 725f 6469 6374 5b27 7070 7364 7327 5d23  r_dict['ppsds']#
-0001f6a0: 5b6b 5d5b 2763 7572 7265 6e74 5f74 696d  [k]['current_tim
-0001f6b0: 6573 5f75 7365 6427 5d0a 2020 2020 696d  es_used'].    im
-0001f6c0: 706f 7274 206d 6174 706c 6f74 6c69 622e  port matplotlib.
-0001f6d0: 6461 7465 7320 6173 206d 6461 7465 730a  dates as mdates.
-0001f6e0: 2020 2020 616e 794b 6579 203d 206c 6973      anyKey = lis
-0001f6f0: 7428 7070 7364 732e 6b65 7973 2829 295b  t(ppsds.keys())[
-0001f700: 305d 0a0a 2020 2020 7073 6448 4c69 7374  0]..    psdHList
-0001f710: 203d 5b5d 0a20 2020 2070 7364 5a4c 6973   =[].    psdZLis
-0001f720: 7420 3d5b 5d0a 2020 2020 666f 7220 6b20  t =[].    for k 
-0001f730: 696e 2068 7673 725f 6469 6374 5b27 7073  in hvsr_dict['ps
-0001f740: 645f 7261 7727 5d3a 0a20 2020 2020 2020  d_raw']:.       
-0001f750: 2069 6620 277a 2720 696e 206b 2e6c 6f77   if 'z' in k.low
-0001f760: 6572 2829 3a0a 2020 2020 2020 2020 2020  er():.          
-0001f770: 2020 7073 645a 4c69 7374 2e61 7070 656e    psdZList.appen
-0001f780: 6428 6876 7372 5f64 6963 745b 2770 7364  d(hvsr_dict['psd
-0001f790: 5f72 6177 275d 5b6b 5d29 2020 2020 0a20  _raw'][k])    . 
-0001f7a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001f7b0: 2020 2020 2020 2020 2070 7364 484c 6973           psdHLis
-0001f7c0: 742e 6170 7065 6e64 2868 7673 725f 6469  t.append(hvsr_di
-0001f7d0: 6374 5b27 7073 645f 7261 7727 5d5b 6b5d  ct['psd_raw'][k]
-0001f7e0: 290a 2020 2020 0a20 2020 2023 6966 2064  ).    .    #if d
-0001f7f0: 6574 7265 6e64 3a0a 2020 2020 2320 2020  etrend:.    #   
-0001f800: 2070 7364 4172 7220 3d20 6e70 2e73 7562   psdArr = np.sub
-0001f810: 7472 6163 7428 7073 6441 7272 2c20 6e70  tract(psdArr, np
-0001f820: 2e6d 6564 6961 6e28 7073 6441 7272 2c20  .median(psdArr, 
-0001f830: 6178 6973 3d30 2929 0a20 2020 2070 7364  axis=0)).    psd
-0001f840: 4172 7220 3d20 6876 7372 5f64 6963 745b  Arr = hvsr_dict[
-0001f850: 2769 6e64 5f68 7673 725f 6375 7276 6573  'ind_hvsr_curves
-0001f860: 275d 2e54 0a0a 2020 2020 786d 696e 203d  '].T..    xmin =
-0001f870: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
-0001f880: 6d65 2e73 7472 7074 696d 6528 6d69 6e28  me.strptime(min(
-0001f890: 6876 7372 5f64 6963 745b 2770 7073 6473  hvsr_dict['ppsds
-0001f8a0: 275d 5b61 6e79 4b65 795d 5b27 6375 7272  '][anyKey]['curr
-0001f8b0: 656e 745f 7469 6d65 735f 7573 6564 275d  ent_times_used']
-0001f8c0: 5b3a 2d31 5d29 2e69 736f 666f 726d 6174  [:-1]).isoformat
-0001f8d0: 2829 2c20 2725 592d 256d 2d25 6454 2548  (), '%Y-%m-%dT%H
-0001f8e0: 3a25 4d3a 2553 2e25 6627 290a 2020 2020  :%M:%S.%f').    
-0001f8f0: 786d 6178 203d 2064 6174 6574 696d 652e  xmax = datetime.
-0001f900: 6461 7465 7469 6d65 2e73 7472 7074 696d  datetime.strptim
-0001f910: 6528 6d61 7828 6876 7372 5f64 6963 745b  e(max(hvsr_dict[
-0001f920: 2770 7073 6473 275d 5b61 6e79 4b65 795d  'ppsds'][anyKey]
-0001f930: 5b27 6375 7272 656e 745f 7469 6d65 735f  ['current_times_
-0001f940: 7573 6564 275d 5b3a 2d31 5d29 2e69 736f  used'][:-1]).iso
-0001f950: 666f 726d 6174 2829 2c20 2725 592d 256d  format(), '%Y-%m
-0001f960: 2d25 6454 2548 3a25 4d3a 2553 2e25 6627  -%dT%H:%M:%S.%f'
-0001f970: 290a 2020 2020 786d 696e 203d 206d 6461  ).    xmin = mda
-0001f980: 7465 732e 6461 7465 326e 756d 2878 6d69  tes.date2num(xmi
-0001f990: 6e29 0a20 2020 2078 6d61 7820 3d20 6d64  n).    xmax = md
-0001f9a0: 6174 6573 2e64 6174 6532 6e75 6d28 786d  ates.date2num(xm
-0001f9b0: 6178 290a 0a20 2020 2074 5469 636b 7320  ax)..    tTicks 
-0001f9c0: 3d20 6d64 6174 6573 2e4d 696e 7574 654c  = mdates.MinuteL
-0001f9d0: 6f63 6174 6f72 2862 796d 696e 7574 653d  ocator(byminute=
-0001f9e0: 7261 6e67 6528 302c 3630 2c35 2929 0a20  range(0,60,5)). 
-0001f9f0: 2020 2061 782e 7861 7869 732e 7365 745f     ax.xaxis.set_
-0001fa00: 6d61 6a6f 725f 6c6f 6361 746f 7228 7454  major_locator(tT
-0001fa10: 6963 6b73 290a 2020 2020 7454 6963 6b73  icks).    tTicks
-0001fa20: 5f6d 696e 6f72 203d 206d 6461 7465 732e  _minor = mdates.
-0001fa30: 5365 636f 6e64 4c6f 6361 746f 7228 6279  SecondLocator(by
-0001fa40: 7365 636f 6e64 3d5b 305d 290a 2020 2020  second=[0]).    
-0001fa50: 6178 2e78 6178 6973 2e73 6574 5f6d 696e  ax.xaxis.set_min
-0001fa60: 6f72 5f6c 6f63 6174 6f72 2874 5469 636b  or_locator(tTick
-0001fa70: 735f 6d69 6e6f 7229 0a0a 2020 2020 744c  s_minor)..    tL
-0001fa80: 6162 656c 7320 3d20 6d64 6174 6573 2e44  abels = mdates.D
-0001fa90: 6174 6546 6f72 6d61 7474 6572 2827 2548  ateFormatter('%H
-0001faa0: 3a25 4d27 290a 2020 2020 6178 2e78 6178  :%M').    ax.xax
-0001fab0: 6973 2e73 6574 5f6d 616a 6f72 5f66 6f72  is.set_major_for
-0001fac0: 6d61 7474 6572 2874 4c61 6265 6c73 290a  matter(tLabels).
-0001fad0: 2020 2020 6178 2e74 6963 6b5f 7061 7261      ax.tick_para
-0001fae0: 6d73 2861 7869 733d 2778 272c 206c 6162  ms(axis='x', lab
-0001faf0: 656c 7369 7a65 3d38 290a 0a20 2020 2069  elsize=8)..    i
-0001fb00: 6620 6876 7372 5f64 6963 745b 2770 7073  f hvsr_dict['pps
-0001fb10: 6473 275d 5b61 6e79 4b65 795d 5b27 6375  ds'][anyKey]['cu
-0001fb20: 7272 656e 745f 7469 6d65 735f 7573 6564  rrent_times_used
-0001fb30: 275d 5b30 5d2e 6461 7465 2021 3d20 6876  '][0].date != hv
-0001fb40: 7372 5f64 6963 745b 2770 7073 6473 275d  sr_dict['ppsds']
-0001fb50: 5b61 6e79 4b65 795d 5b27 6375 7272 656e  [anyKey]['curren
-0001fb60: 745f 7469 6d65 735f 7573 6564 275d 5b2d  t_times_used'][-
-0001fb70: 315d 2e64 6174 653a 0a20 2020 2020 2020  1].date:.       
-0001fb80: 2064 6179 203d 2073 7472 2868 7673 725f   day = str(hvsr_
-0001fb90: 6469 6374 5b27 7070 7364 7327 5d5b 616e  dict['ppsds'][an
-0001fba0: 794b 6579 5d5b 2763 7572 7265 6e74 5f74  yKey]['current_t
-0001fbb0: 696d 6573 5f75 7365 6427 5d5b 305d 2e64  imes_used'][0].d
-0001fbc0: 6174 6529 2b27 202d 2027 2b73 7472 2868  ate)+' - '+str(h
-0001fbd0: 7673 725f 6469 6374 5b27 7070 7364 7327  vsr_dict['ppsds'
-0001fbe0: 5d5b 616e 794b 6579 5d5b 2763 7572 7265  ][anyKey]['curre
-0001fbf0: 6e74 5f74 696d 6573 5f75 7365 6427 5d5b  nt_times_used'][
-0001fc00: 315d 2e64 6174 6529 0a20 2020 2065 6c73  1].date).    els
-0001fc10: 653a 0a20 2020 2020 2020 2064 6179 203d  e:.        day =
-0001fc20: 2073 7472 2868 7673 725f 6469 6374 5b27   str(hvsr_dict['
-0001fc30: 7070 7364 7327 5d5b 616e 794b 6579 5d5b  ppsds'][anyKey][
-0001fc40: 2763 7572 7265 6e74 5f74 696d 6573 5f75  'current_times_u
-0001fc50: 7365 6427 5d5b 305d 2e64 6174 6529 0a0a  sed'][0].date)..
-0001fc60: 2020 2020 796d 696e 203d 2068 7673 725f      ymin = hvsr_
-0001fc70: 6469 6374 5b27 696e 7075 745f 7061 7261  dict['input_para
-0001fc80: 6d73 275d 5b27 6876 7372 5f62 616e 6427  ms']['hvsr_band'
-0001fc90: 5d5b 305d 0a20 2020 2079 6d61 7820 3d20  ][0].    ymax = 
-0001fca0: 6876 7372 5f64 6963 745b 2769 6e70 7574  hvsr_dict['input
-0001fcb0: 5f70 6172 616d 7327 5d5b 2768 7673 725f  _params']['hvsr_
-0001fcc0: 6261 6e64 275d 5b31 5d0a 0a20 2020 2065  band'][1]..    e
-0001fcd0: 7874 4c69 7374 203d 205b 786d 696e 2c20  xtList = [xmin, 
-0001fce0: 786d 6178 2c20 796d 696e 2c20 796d 6178  xmax, ymin, ymax
-0001fcf0: 5d0a 2020 0a20 2020 2023 6178 203d 2070  ].  .    #ax = p
-0001fd00: 6c74 2e67 6361 2829 0a20 2020 2023 6669  lt.gca().    #fi
-0001fd10: 6720 3d20 706c 742e 6763 6628 290a 0a20  g = plt.gcf().. 
-0001fd20: 2020 2066 7265 7174 6963 6b73 203d 206e     freqticks = n
-0001fd30: 702e 666c 6970 2868 7673 725f 6469 6374  p.flip(hvsr_dict
-0001fd40: 5b27 785f 6672 6571 7327 5d5b 616e 794b  ['x_freqs'][anyK
-0001fd50: 6579 5d29 0a20 2020 2079 6d69 6e69 6e64  ey]).    yminind
-0001fd60: 203d 206e 702e 6172 676d 696e 286e 702e   = np.argmin(np.
-0001fd70: 6162 7328 796d 696e 2d66 7265 7174 6963  abs(ymin-freqtic
-0001fd80: 6b73 2929 0a20 2020 2079 6d61 7869 6e64  ks)).    ymaxind
-0001fd90: 203d 206e 702e 6172 676d 696e 286e 702e   = np.argmin(np.
-0001fda0: 6162 7328 796d 6178 2d66 7265 7174 6963  abs(ymax-freqtic
-0001fdb0: 6b73 2929 0a20 2020 2066 7265 7174 6963  ks)).    freqtic
-0001fdc0: 6b73 203d 2066 7265 7174 6963 6b73 5b79  ks = freqticks[y
-0001fdd0: 6d69 6e69 6e64 3a79 6d61 7869 6e64 5d0a  minind:ymaxind].
-0001fde0: 0a20 2020 2023 5365 7420 7570 2061 7865  .    #Set up axe
-0001fdf0: 732c 2073 696e 6365 2064 6174 6120 6973  s, since data is
-0001fe00: 2061 6c72 6561 6479 2069 6e20 7365 6d69   already in semi
-0001fe10: 6c6f 670a 2020 2020 6178 7920 3d20 6178  log.    axy = ax
-0001fe20: 2e74 7769 6e78 2829 0a20 2020 2061 7879  .twinx().    axy
-0001fe30: 2e7a 6f72 6465 723d 300a 2020 2020 6178  .zorder=0.    ax
-0001fe40: 2e7a 6f72 6465 723d 310a 2020 2020 6178  .zorder=1.    ax
-0001fe50: 2e73 6574 5f66 6163 6563 6f6c 6f72 2827  .set_facecolor('
-0001fe60: 2366 6666 6666 6630 3027 2920 2343 7265  #ffffff00') #Cre
-0001fe70: 6174 6520 7472 616e 7370 6172 656e 7420  ate transparent 
-0001fe80: 6261 636b 6772 6f75 6e64 2066 6f72 2066  background for f
-0001fe90: 726f 6e74 2061 7869 730a 2020 2020 2370  ront axis.    #p
-0001fea0: 6c74 2e73 6361 2861 7879 290a 2020 2020  lt.sca(axy).    
-0001feb0: 696d 203d 2061 782e 696d 7368 6f77 2870  im = ax.imshow(p
-0001fec0: 7364 4172 722c 206f 7269 6769 6e3d 276c  sdArr, origin='l
-0001fed0: 6f77 6572 272c 2065 7874 656e 743d 6578  ower', extent=ex
-0001fee0: 744c 6973 742c 2061 7370 6563 743d 2761  tList, aspect='a
-0001fef0: 7574 6f27 2c20 696e 7465 7270 6f6c 6174  uto', interpolat
-0001ff00: 696f 6e3d 276e 6561 7265 7374 272c 202a  ion='nearest', *
-0001ff10: 2a6b 7761 7267 7329 0a20 2020 2061 782e  *kwargs).    ax.
-0001ff20: 7469 636b 5f70 6172 616d 7328 6c65 6674  tick_params(left
-0001ff30: 3d46 616c 7365 2c20 7269 6768 743d 4661  =False, right=Fa
-0001ff40: 6c73 6529 0a20 2020 2061 782e 7365 745f  lse).    ax.set_
-0001ff50: 7974 6963 6b73 285b 5d2c 206c 6162 656c  yticks([], label
-0001ff60: 733d 2727 290a 2020 2020 2370 6c74 2e73  s='').    #plt.s
-0001ff70: 6361 2861 7829 0a20 2020 2069 6620 7065  ca(ax).    if pe
-0001ff80: 616b 5f70 6c6f 743a 0a20 2020 2020 2020  ak_plot:.       
-0001ff90: 2061 782e 686c 696e 6573 2868 7673 725f   ax.hlines(hvsr_
-0001ffa0: 6469 6374 5b27 4265 7374 2050 6561 6b27  dict['Best Peak'
-0001ffb0: 5d5b 2766 3027 5d2c 2078 6d69 6e2c 2078  ]['f0'], xmin, x
-0001ffc0: 6d61 782c 2063 6f6c 6f72 733d 276b 272c  max, colors='k',
-0001ffd0: 206c 696e 6573 7479 6c65 733d 2764 6173   linestyles='das
-0001ffe0: 6865 6427 2c20 616c 7068 613d 302e 3529  hed', alpha=0.5)
-0001fff0: 0a0a 2020 2020 2346 7265 7154 6963 6b73  ..    #FreqTicks
-00020000: 203d 6e70 2e61 7261 6e67 6528 312c 6e70   =np.arange(1,np
-00020010: 2e72 6f75 6e64 286d 6178 2868 7673 725f  .round(max(hvsr_
-00020020: 6469 6374 5b27 785f 6672 6571 7327 5d5b  dict['x_freqs'][
-00020030: 616e 794b 6579 5d29 2c30 292c 2031 3029  anyKey]),0), 10)
-00020040: 0a20 2020 2061 782e 7365 745f 7469 746c  .    ax.set_titl
-00020050: 6528 6876 7372 5f64 6963 745b 2769 6e70  e(hvsr_dict['inp
-00020060: 7574 5f70 6172 616d 7327 5d5b 2773 6974  ut_params']['sit
-00020070: 6527 5d2b 273a 2053 7065 6374 726f 6772  e']+': Spectrogr
-00020080: 616d 2729 0a20 2020 2061 782e 7365 745f  am').    ax.set_
-00020090: 786c 6162 656c 2827 5554 4320 5469 6d65  xlabel('UTC Time
-000200a0: 205c 6e27 2b64 6179 290a 2020 2020 0a20   \n'+day).    . 
-000200b0: 2020 2069 6620 636f 6c6f 7262 6172 3a0a     if colorbar:.
-000200c0: 2020 2020 2020 2020 6362 6172 203d 2070          cbar = p
-000200d0: 6c74 2e63 6f6c 6f72 6261 7228 6d61 7070  lt.colorbar(mapp
-000200e0: 6162 6c65 3d69 6d29 0a20 2020 2020 2020  able=im).       
-000200f0: 2063 6261 722e 7365 745f 6c61 6265 6c28   cbar.set_label(
-00020100: 2748 2f56 2052 6174 696f 2729 0a0a 2020  'H/V Ratio')..  
-00020110: 2020 6178 2e73 6574 5f79 6c61 6265 6c28    ax.set_ylabel(
-00020120: 796c 6162 656c 290a 2020 2020 2370 6c74  ylabel).    #plt
-00020130: 2e79 7469 636b 7328 6672 6571 7469 636b  .yticks(freqtick
-00020140: 7329 0a20 2020 2023 6178 2e73 656d 696c  s).    #ax.semil
-00020150: 6f67 7928 290a 2020 2020 6178 2e73 6574  ogy().    ax.set
-00020160: 5f79 6c69 6d28 6876 7372 5f64 6963 745b  _ylim(hvsr_dict[
-00020170: 2769 6e70 7574 5f70 6172 616d 7327 5d5b  'input_params'][
-00020180: 2768 7673 725f 6261 6e64 275d 290a 0a20  'hvsr_band']).. 
-00020190: 2020 2023 706c 742e 7263 5061 7261 6d73     #plt.rcParams
-000201a0: 5b27 6669 6775 7265 2e64 7069 275d 203d  ['figure.dpi'] =
-000201b0: 2035 3030 0a20 2020 2023 706c 742e 7263   500.    #plt.rc
-000201c0: 5061 7261 6d73 5b27 6669 6775 7265 2e66  Params['figure.f
-000201d0: 6967 7369 7a65 275d 203d 2028 3132 2c34  igsize'] = (12,4
-000201e0: 290a 2020 2020 6669 672e 6361 6e76 6173  ).    fig.canvas
-000201f0: 2e64 7261 7728 290a 2020 2020 6669 672e  .draw().    fig.
-00020200: 7469 6768 745f 6c61 796f 7574 2829 0a20  tight_layout(). 
-00020210: 2020 2023 706c 742e 7368 6f77 2829 0a20     #plt.show(). 
-00020220: 2020 2072 6574 7572 6e20 6669 672c 2061     return fig, a
-00020230: 780a 0a23 506c 6f74 2073 7065 6374 726f  x..#Plot spectro
-00020240: 6772 616d 2066 726f 6d20 7374 7265 616d  gram from stream
-00020250: 0a64 6566 2070 6c6f 745f 7370 6563 6772  .def plot_specgr
-00020260: 616d 5f73 7472 6561 6d28 7374 7265 616d  am_stream(stream
-00020270: 2c20 7061 7261 6d73 3d4e 6f6e 652c 2063  , params=None, c
-00020280: 6f6d 706f 6e65 6e74 3d27 5a27 2c20 7374  omponent='Z', st
-00020290: 6163 6b5f 7479 7065 3d27 6c69 6e65 6172  ack_type='linear
-000202a0: 272c 2064 6574 7265 6e64 3d27 6d65 616e  ', detrend='mean
-000202b0: 272c 2064 6273 6361 6c65 3d54 7275 652c  ', dbscale=True,
-000202c0: 2072 6574 7572 6e5f 6669 673d 5472 7565   return_fig=True
-000202d0: 2c20 6669 673d 4e6f 6e65 2c20 6178 3d4e  , fig=None, ax=N
-000202e0: 6f6e 652c 2063 6d61 705f 7065 723d 5b30  one, cmap_per=[0
-000202f0: 2e31 2c30 2e39 5d2c 202a 2a6b 7761 7267  .1,0.9], **kwarg
-00020300: 7329 3a0a 2020 2020 2222 2246 756e 6374  s):.    """Funct
-00020310: 696f 6e20 666f 7220 706c 6f74 7469 6e67  ion for plotting
-00020320: 2073 7065 6374 726f 6772 616d 2069 6e20   spectrogram in 
-00020330: 6120 6e69 6365 206d 6174 706c 6f74 6c69  a nice matplotli
-00020340: 6220 6368 6172 7420 6672 6f6d 2061 6e20  b chart from an 
-00020350: 6f62 7370 792e 7374 7265 616d 0a0a 2020  obspy.stream..  
-00020360: 2020 466f 7220 6d6f 7265 2064 6574 6169    For more detai
-00020370: 6c73 206f 6e20 6d61 696e 2066 756e 6374  ls on main funct
-00020380: 696f 6e20 6265 696e 6720 6361 6c6c 6564  ion being called
-00020390: 2c20 7365 6520 6874 7470 733a 2f2f 6d61  , see https://ma
-000203a0: 7470 6c6f 746c 6962 2e6f 7267 2f73 7461  tplotlib.org/sta
-000203b0: 626c 652f 6170 692f 5f61 735f 6765 6e2f  ble/api/_as_gen/
-000203c0: 6d61 7470 6c6f 746c 6962 2e70 7970 6c6f  matplotlib.pyplo
-000203d0: 742e 7370 6563 6772 616d 2e68 746d 6c20  t.specgram.html 
-000203e0: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-000203f0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-00020400: 2020 2020 7374 7265 616d 203a 206f 6273      stream : obs
-00020410: 7079 2e63 6f72 652e 7374 7265 616d 2e53  py.core.stream.S
-00020420: 7472 6561 6d20 6f62 6a65 6374 0a20 2020  tream object.   
-00020430: 2020 2020 2053 7472 6561 6d20 666f 7220       Stream for 
-00020440: 7768 6963 6820 746f 2070 6c6f 7420 7370  which to plot sp
-00020450: 6563 7472 6f67 7261 6d0a 2020 2020 7061  ectrogram.    pa
-00020460: 7261 6d73 203a 2064 6963 742c 206f 7074  rams : dict, opt
-00020470: 696f 6e61 6c0a 2020 2020 2020 2020 4966  ional.        If
-00020480: 2064 6963 742c 2077 696c 6c20 7265 6164   dict, will read
-00020490: 2074 6865 2068 7673 725f 6261 6e64 2066   the hvsr_band f
-000204a0: 726f 6d20 7468 6520 6120 6469 6374 696f  rom the a dictio
-000204b0: 6e61 7279 2077 6974 6820 6120 6b65 7920  nary with a key 
-000204c0: 5b27 6876 7372 5f62 616e 6427 5d20 286c  ['hvsr_band'] (l
-000204d0: 696b 6520 7468 6520 7061 7261 6d65 7465  ike the paramete
-000204e0: 7273 2064 6963 7469 6f6e 6172 7929 2e20  rs dictionary). 
-000204f0: 4f74 6865 7277 6973 652c 2063 616e 2072  Otherwise, can r
-00020500: 6561 6420 696e 2074 6865 2068 7673 725f  ead in the hvsr_
-00020510: 6261 6e64 2061 7320 6120 7477 6f2d 6974  band as a two-it
-00020520: 656d 206c 6973 742e 204f 722c 2069 6620  em list. Or, if 
-00020530: 4e6f 6e65 2c20 6465 6661 756c 7473 2074  None, defaults t
-00020540: 6f20 5b30 2e34 2c34 305d 2c20 6279 2064  o [0.4,40], by d
-00020550: 6566 6175 6c74 204e 6f6e 652e 0a20 2020  efault None..   
-00020560: 2063 6f6d 706f 6e65 6e74 203a 2073 7472   component : str
-00020570: 206f 7220 6c69 7374 2c20 6465 6661 756c   or list, defaul
-00020580: 743d 275a 270a 2020 2020 2020 2020 4966  t='Z'.        If
-00020590: 2073 7472 696e 672c 2073 686f 756c 6420   string, should 
-000205a0: 6265 206f 6e65 2063 6861 7261 6374 6572  be one character
-000205b0: 206c 6f6e 6720 636f 6d70 6f6e 656e 742c   long component,
-000205c0: 2062 7920 6465 6661 756c 7420 275a 2e27   by default 'Z.'
-000205d0: 2049 6620 6c69 7374 2c20 6361 6e20 636f   If list, can co
-000205e0: 6e74 6169 6e20 2745 272c 2027 4e27 2c20  ntain 'E', 'N', 
-000205f0: 275a 272c 2061 6e64 2077 696c 6c20 7374  'Z', and will st
-00020600: 6163 6b20 7468 656d 2070 6572 2073 7461  ack them per sta
-00020610: 636b 5f74 7970 6520 616e 6420 7374 7265  ck_type and stre
-00020620: 616d 2e73 7461 636b 2829 206d 6574 686f  am.stack() metho
-00020630: 6420 696e 206f 6273 7079 2074 6f20 6d61  d in obspy to ma
-00020640: 6b65 2073 7065 6374 726f 6772 616d 2e0a  ke spectrogram..
-00020650: 2020 2020 7374 6163 6b5f 7479 7065 203a      stack_type :
-00020660: 2073 7472 2c20 6465 6661 756c 7420 3d20   str, default = 
-00020670: 276c 696e 6561 7227 0a20 2020 2020 2020  'linear'.       
-00020680: 2050 6172 616d 6574 6572 2074 6f20 6265   Parameter to be
-00020690: 2072 6561 6420 6469 7265 6374 6c79 2069   read directly i
-000206a0: 6e74 6f20 7374 6163 6b5f 7479 7065 2070  nto stack_type p
-000206b0: 6172 616d 6574 6572 206f 6620 5374 7265  arameter of Stre
-000206c0: 616d 2e73 7461 636b 2829 206d 6574 686f  am.stack() metho
-000206d0: 6420 6f66 206f 6273 7079 2073 7472 6561  d of obspy strea
-000206e0: 6d73 2c20 6279 2064 6566 6175 6c74 2027  ms, by default '
-000206f0: 6c69 6e65 6172 272e 2053 6565 2068 7474  linear'. See htt
-00020700: 7073 3a2f 2f64 6f63 732e 6f62 7370 792e  ps://docs.obspy.
-00020710: 6f72 672f 7061 636b 6167 6573 2f61 7574  org/packages/aut
-00020720: 6f67 656e 2f6f 6273 7079 2e63 6f72 652e  ogen/obspy.core.
-00020730: 7374 7265 616d 2e53 7472 6561 6d2e 7374  stream.Stream.st
-00020740: 6163 6b2e 6874 6d6c 0a20 2020 2020 2020  ack.html.       
-00020750: 204f 6e6c 7920 6d61 7474 6572 7320 6966   Only matters if
-00020760: 206d 6f72 6520 7468 616e 206f 6e65 2063   more than one c
-00020770: 6f6d 706f 6e65 6e74 2075 7365 642e 0a20  omponent used.. 
-00020780: 2020 2064 6574 7265 6e64 203a 2073 7472     detrend : str
-00020790: 2c20 6465 6661 756c 7420 3d20 276d 6561  , default = 'mea
-000207a0: 6e27 0a20 2020 2020 2020 2050 6172 616d  n'.        Param
-000207b0: 6574 6572 2074 6f20 6265 2072 6561 6420  eter to be read 
-000207c0: 6469 7265 6374 6c79 2069 6e74 6f20 6465  directly into de
-000207d0: 7472 656e 6420 7061 7261 6d65 7465 7220  trend parameter 
-000207e0: 6f66 206d 6174 706c 6f74 6c69 622e 7079  of matplotlib.py
-000207f0: 706c 6f74 2e73 7065 6367 7261 6d2c 2062  plot.specgram, b
-00020800: 7920 6465 6661 756c 7420 276d 6561 6e27  y default 'mean'
-00020810: 2e20 5365 653a 2068 7474 7073 3a2f 2f6d  . See: https://m
-00020820: 6174 706c 6f74 6c69 622e 6f72 672f 7374  atplotlib.org/st
-00020830: 6162 6c65 2f61 7069 2f5f 6173 5f67 656e  able/api/_as_gen
-00020840: 2f6d 6174 706c 6f74 6c69 622e 7079 706c  /matplotlib.pypl
-00020850: 6f74 2e73 7065 6367 7261 6d2e 6874 6d6c  ot.specgram.html
-00020860: 0a20 2020 2064 6273 6361 6c65 203a 2062  .    dbscale : b
-00020870: 6f6f 6c2c 2064 6566 6175 6c74 203d 2054  ool, default = T
-00020880: 7275 650a 2020 2020 2020 2020 4966 2054  rue.        If T
-00020890: 7275 652c 2073 6361 6c65 2070 6172 616d  rue, scale param
-000208a0: 6574 6572 206f 6620 6d61 7470 6c6f 746c  eter of matplotl
-000208b0: 6962 2e70 7970 6c6f 742e 7370 6563 6772  ib.pyplot.specgr
-000208c0: 616d 2073 6574 2074 6f20 2764 4227 2c20  am set to 'dB', 
-000208d0: 6279 2064 6566 6175 6c74 2054 7275 650a  by default True.
-000208e0: 2020 2020 7265 7475 726e 5f66 6967 203a      return_fig :
-000208f0: 2062 6f6f 6c2c 2064 6566 6175 6c74 203d   bool, default =
-00020900: 2054 7275 650a 2020 2020 2020 2020 5768   True.        Wh
-00020910: 6574 6865 7220 746f 2072 6574 7572 6e20  ether to return 
-00020920: 7468 6520 6669 6775 7265 2066 726f 6d20  the figure from 
-00020930: 7468 6520 6675 6e63 7469 6f6e 206f 7220  the function or 
-00020940: 6a75 7374 2073 686f 7720 6974 2c20 6279  just show it, by
-00020950: 2064 6566 6175 6c74 2054 7275 650a 2020   default True.  
-00020960: 2020 636d 6170 5f70 6572 203a 206c 6973    cmap_per : lis
-00020970: 742c 2064 6566 6175 6c74 203d 205b 302e  t, default = [0.
-00020980: 312c 2030 2e39 5d0a 2020 2020 2020 2020  1, 0.9].        
-00020990: 5477 6f2d 6974 656d 206c 6973 7420 7777  Two-item list ww
-000209a0: 6974 6820 636c 6970 206c 696d 6974 7320  ith clip limits 
-000209b0: 6173 2070 6572 6365 6e74 6167 6520 6f66  as percentage of
-000209c0: 2076 616c 7565 7320 6f66 2063 6f6c 6f72   values of color
-000209d0: 6d61 702c 2073 6f20 6578 7472 656d 6573  map, so extremes
-000209e0: 2064 6f20 6e6f 7420 7461 696e 7420 636f   do not taint co
-000209f0: 6c6f 726d 6170 2c20 6279 2064 6566 6175  lormap, by defau
-00020a00: 6c74 205b 302e 312c 302e 395d 0a0a 2020  lt [0.1,0.9]..  
-00020a10: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
-00020a20: 2d2d 2d2d 2d0a 2020 2020 6669 670a 2020  -----.    fig.  
-00020a30: 2020 2020 2020 4966 2072 6574 7572 6e5f        If return_
-00020a40: 6669 6720 6973 2054 7275 652c 206d 6174  fig is True, mat
-00020a50: 706c 6f74 6c69 6220 6669 6775 7265 2069  plotlib figure i
-00020a60: 7320 7265 7475 726e 6564 0a20 2020 2061  s returned.    a
-00020a70: 780a 2020 2020 2020 2020 4966 2072 6574  x.        If ret
-00020a80: 7572 6e5f 6669 6720 6973 2054 7275 652c  urn_fig is True,
-00020a90: 206d 6174 706c 6f74 6c69 6220 6178 6973   matplotlib axis
-00020aa0: 2069 7320 7265 7475 726e 6564 0a20 2020   is returned.   
-00020ab0: 2022 2222 0a20 2020 206f 675f 7374 7265   """.    og_stre
-00020ac0: 616d 203d 2073 7472 6561 6d2e 636f 7079  am = stream.copy
-00020ad0: 2829 0a0a 2020 2020 2347 6574 2074 6865  ()..    #Get the
-00020ae0: 206c 6174 6573 7420 7374 6172 7420 7469   latest start ti
-00020af0: 6d65 2061 6e64 2065 6172 6c69 6573 7420  me and earliest 
-00020b00: 656e 6420 7469 6d65 7320 6f66 2061 6c6c  end times of all
-00020b10: 2063 6f6d 706f 6e65 6e74 730a 2020 2020   components.    
-00020b20: 7472 6163 654c 6973 7420 3d20 5b5d 0a20  traceList = []. 
-00020b30: 2020 206d 6178 5374 6172 7454 696d 6520     maxStartTime 
-00020b40: 3d20 6f62 7370 792e 5554 4344 6174 6554  = obspy.UTCDateT
-00020b50: 696d 6528 2d31 6531 3029 2023 476f 2062  ime(-1e10) #Go b
-00020b60: 6163 6b20 7072 6574 7479 2066 6172 2028  ack pretty far (
-00020b70: 616c 6d6f 7374 2034 3030 2079 6561 7273  almost 400 years
-00020b80: 2920 746f 2073 7461 7274 2077 6974 680a  ) to start with.
-00020b90: 2020 2020 6d69 6e45 6e64 5469 6d65 203d      minEndTime =
-00020ba0: 206f 6273 7079 2e55 5443 4461 7465 5469   obspy.UTCDateTi
-00020bb0: 6d65 2831 6531 3029 0a20 2020 2066 6f72  me(1e10).    for
-00020bc0: 2063 6f6d 7020 696e 205b 2745 272c 2027   comp in ['E', '
-00020bd0: 4e27 2c20 275a 275d 3a0a 2020 2020 2020  N', 'Z']:.      
-00020be0: 2020 7472 203d 2073 7472 6561 6d2e 7365    tr = stream.se
-00020bf0: 6c65 6374 2863 6f6d 706f 6e65 6e74 3d63  lect(component=c
-00020c00: 6f6d 7029 2e63 6f70 7928 290a 2020 2020  omp).copy().    
-00020c10: 2020 2020 6966 2063 6f6d 7020 696e 2063      if comp in c
-00020c20: 6f6d 706f 6e65 6e74 3a0a 2020 2020 2020  omponent:.      
-00020c30: 2020 2020 2020 7472 6163 654c 6973 742e        traceList.
-00020c40: 6170 7065 6e64 2874 725b 305d 290a 2020  append(tr[0]).  
-00020c50: 2020 2020 2020 6966 2074 725b 305d 2e73        if tr[0].s
-00020c60: 7461 7473 2e73 7461 7274 7469 6d65 203e  tats.starttime >
-00020c70: 206d 6178 5374 6172 7454 696d 653a 0a20   maxStartTime:. 
-00020c80: 2020 2020 2020 2020 2020 206d 6178 5374             maxSt
-00020c90: 6172 7454 696d 6520 3d20 7472 5b30 5d2e  artTime = tr[0].
-00020ca0: 7374 6174 732e 7374 6172 7474 696d 650a  stats.starttime.
-00020cb0: 2020 2020 2020 2020 6966 2074 725b 305d          if tr[0]
-00020cc0: 2e73 7461 7473 2e65 6e64 7469 6d65 203c  .stats.endtime <
-00020cd0: 206d 696e 456e 6454 696d 653a 0a20 2020   minEndTime:.   
-00020ce0: 2020 2020 2020 2020 206d 696e 456e 6454           minEndT
-00020cf0: 696d 6520 3d20 7472 5b30 5d2e 7374 6174  ime = tr[0].stat
-00020d00: 732e 656e 6474 696d 650a 0a20 2020 2023  s.endtime..    #
-00020d10: 5472 696d 2061 6c6c 2074 7261 6365 7320  Trim all traces 
-00020d20: 746f 2074 6865 2073 616d 6520 7374 6172  to the same star
-00020d30: 742f 656e 6420 7469 6d65 0a20 2020 2066  t/end time.    f
-00020d40: 6f72 2074 7220 696e 2074 7261 6365 4c69  or tr in traceLi
-00020d50: 7374 3a0a 2020 2020 2020 2020 7472 2e74  st:.        tr.t
-00020d60: 7269 6d28 7374 6172 7474 696d 653d 6d61  rim(starttime=ma
-00020d70: 7853 7461 7274 5469 6d65 2c20 656e 6474  xStartTime, endt
-00020d80: 696d 653d 6d69 6e45 6e64 5469 6d65 290a  ime=minEndTime).
-00020d90: 2020 2020 6f67 5f73 7472 6561 6d2e 7472      og_stream.tr
-00020da0: 696d 2873 7461 7274 7469 6d65 3d6d 6178  im(starttime=max
-00020db0: 5374 6172 7454 696d 652c 2065 6e64 7469  StartTime, endti
-00020dc0: 6d65 3d6d 696e 456e 6454 696d 6529 2020  me=minEndTime)  
-00020dd0: 2020 2020 0a0a 2020 2020 2343 6f6d 6269      ..    #Combi
-00020de0: 6e65 2061 6c6c 2074 7261 6365 7320 696e  ne all traces in
-00020df0: 746f 2073 696e 676c 652c 2073 7461 636b  to single, stack
-00020e00: 6564 2074 7261 6365 2f73 7472 6561 6d0a  ed trace/stream.
-00020e10: 2020 2020 7374 7265 616d 203d 206f 6273      stream = obs
-00020e20: 7079 2e53 7472 6561 6d28 7472 6163 654c  py.Stream(traceL
-00020e30: 6973 7429 0a20 2020 2073 7472 6561 6d2e  ist).    stream.
-00020e40: 7374 6163 6b28 6772 6f75 705f 6279 3d27  stack(group_by='
-00020e50: 616c 6c27 2c20 6e70 7473 5f74 6f6c 3d32  all', npts_tol=2
-00020e60: 3030 2c20 7374 6163 6b5f 7479 7065 3d73  00, stack_type=s
-00020e70: 7461 636b 5f74 7970 6529 2020 0a0a 2020  tack_type)  ..  
-00020e80: 2020 6966 2066 6967 2069 7320 4e6f 6e65    if fig is None
-00020e90: 2061 6e64 2061 7820 6973 204e 6f6e 653a   and ax is None:
-00020ea0: 0a20 2020 2020 2020 2023 4f72 6761 6e69  .        #Organi
-00020eb0: 7a65 2074 6865 2063 6861 7274 206c 6179  ze the chart lay
-00020ec0: 6f75 740a 2020 2020 2020 2020 6d6f 7361  out.        mosa
-00020ed0: 6963 203d 205b 5b27 7370 6563 275d 2c5b  ic = [['spec'],[
-00020ee0: 2773 7065 6327 5d2c 5b27 7370 6563 275d  'spec'],['spec']
-00020ef0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00020f00: 2020 5b27 7370 6563 275d 2c5b 2773 7065    ['spec'],['spe
-00020f10: 6327 5d2c 5b27 7370 6563 275d 2c0a 2020  c'],['spec'],.  
-00020f20: 2020 2020 2020 2020 2020 2020 2020 5b27                ['
-00020f30: 7369 676e 616c 7a27 5d2c 5b27 7369 676e  signalz'],['sign
-00020f40: 616c 7a27 5d2c 205b 2773 6967 6e61 6c6e  alz'], ['signaln
-00020f50: 275d 2c20 5b27 7369 676e 616c 6527 5d5d  '], ['signale']]
-00020f60: 0a20 2020 2020 2020 2066 6967 2c20 6178  .        fig, ax
-00020f70: 203d 2070 6c74 2e73 7562 706c 6f74 5f6d   = plt.subplot_m
-00020f80: 6f73 6169 6328 6d6f 7361 6963 2c20 7368  osaic(mosaic, sh
-00020f90: 6172 6578 3d54 7275 6529 2020 0a20 2020  arex=True)  .   
-00020fa0: 2020 2020 2023 6669 672c 2061 7820 3d20       #fig, ax = 
-00020fb0: 706c 742e 7375 6270 6c6f 7473 286e 726f  plt.subplots(nro
-00020fc0: 7773 3d32 2c20 6e63 6f6c 733d 312c 2073  ws=2, ncols=1, s
-00020fd0: 6861 7265 783d 5472 7565 2920 200a 0a20  harex=True)  .. 
-00020fe0: 2020 2064 6174 6120 3d20 7374 7265 616d     data = stream
-00020ff0: 5b30 5d2e 6461 7461 0a20 2020 2073 616d  [0].data.    sam
-00021000: 706c 655f 7261 7465 203d 2073 7472 6561  ple_rate = strea
-00021010: 6d5b 305d 2e73 7461 7473 2e73 616d 706c  m[0].stats.sampl
-00021020: 696e 675f 7261 7465 0a0a 2020 2020 6966  ing_rate..    if
-00021030: 2027 636d 6170 2720 696e 206b 7761 7267   'cmap' in kwarg
-00021040: 732e 6b65 7973 2829 3a0a 2020 2020 2020  s.keys():.      
-00021050: 2020 636d 6170 3d6b 7761 7267 735b 2763    cmap=kwargs['c
-00021060: 6d61 7027 5d0a 2020 2020 656c 7365 3a0a  map'].    else:.
-00021070: 2020 2020 2020 2020 636d 6170 3d27 7475          cmap='tu
-00021080: 7262 6f27 0a0a 2020 2020 6966 2070 6172  rbo'..    if par
-00021090: 616d 7320 6973 204e 6f6e 653a 0a20 2020  ams is None:.   
-000210a0: 2020 2020 2068 7673 725f 6261 6e64 203d       hvsr_band =
-000210b0: 205b 302e 342c 2034 305d 0a20 2020 2065   [0.4, 40].    e
-000210c0: 6c73 653a 0a20 2020 2020 2020 2068 7673  lse:.        hvs
-000210d0: 725f 6261 6e64 203d 2070 6172 616d 735b  r_band = params[
-000210e0: 2768 7673 725f 6261 6e64 275d 0a20 2020  'hvsr_band'].   
-000210f0: 2079 6d69 6e20 3d20 6876 7372 5f62 616e   ymin = hvsr_ban
-00021100: 645b 305d 0a20 2020 2079 6d61 7820 3d20  d[0].    ymax = 
-00021110: 6876 7372 5f62 616e 645b 315d 0a0a 2020  hvsr_band[1]..  
-00021120: 2020 6966 2064 6273 6361 6c65 3a0a 2020    if dbscale:.  
-00021130: 2020 2020 2020 7363 616c 653d 2764 4227        scale='dB'
-00021140: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00021150: 2020 2073 6361 6c65 3d4e 6f6e 650a 2020     scale=None.  
-00021160: 2020 7370 6563 2c20 6672 6571 732c 2074    spec, freqs, t
-00021170: 696d 6573 2c20 696d 203d 2061 785b 2773  imes, im = ax['s
-00021180: 7065 6327 5d2e 7370 6563 6772 616d 2878  pec'].specgram(x
-00021190: 3d64 6174 612c 2046 733d 7361 6d70 6c65  =data, Fs=sample
-000211a0: 5f72 6174 652c 2064 6574 7265 6e64 3d64  _rate, detrend=d
-000211b0: 6574 7265 6e64 2c20 7363 616c 655f 6279  etrend, scale_by
-000211c0: 5f66 7265 713d 5472 7565 2c20 7363 616c  _freq=True, scal
-000211d0: 653d 7363 616c 6529 0a20 2020 2069 6d2e  e=scale).    im.
-000211e0: 7265 6d6f 7665 2829 0a0a 2020 2020 6469  remove()..    di
-000211f0: 6666 6572 656e 6365 5f61 7272 6179 203d  fference_array =
-00021200: 2066 7265 7173 2d79 6d69 6e0a 2020 2020   freqs-ymin.    
-00021210: 666f 7220 692c 2064 2069 6e20 656e 756d  for i, d in enum
-00021220: 6572 6174 6528 6469 6666 6572 656e 6365  erate(difference
-00021230: 5f61 7272 6179 293a 0a20 2020 2020 2020  _array):.       
-00021240: 2069 6620 6420 3e20 303a 0a20 2020 2020   if d > 0:.     
-00021250: 2020 2020 2020 2069 6620 692d 3120 3c20         if i-1 < 
-00021260: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00021270: 2020 2069 3d31 0a20 2020 2020 2020 2020     i=1.         
-00021280: 2020 206d 696e 6672 6571 496e 6420 3d20     minfreqInd = 
-00021290: 692d 310a 2020 2020 2020 2020 2020 2020  i-1.            
-000212a0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-000212b0: 2020 0a20 2020 2064 6966 6665 7265 6e63    .    differenc
-000212c0: 655f 6172 7261 7920 3d20 6672 6571 732d  e_array = freqs-
-000212d0: 796d 6178 0a20 2020 2066 6f72 2069 2c20  ymax.    for i, 
-000212e0: 6420 696e 2065 6e75 6d65 7261 7465 2864  d in enumerate(d
-000212f0: 6966 6665 7265 6e63 655f 6172 7261 7929  ifference_array)
-00021300: 3a0a 2020 2020 2020 2020 6966 2064 203e  :.        if d >
-00021310: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00021320: 6d61 7866 7265 7149 6e64 203d 2069 2d31  maxfreqInd = i-1
-00021330: 0a20 2020 2020 2020 2020 2020 2062 7265  .            bre
-00021340: 616b 0a0a 2020 2020 6172 7261 795f 6469  ak..    array_di
-00021350: 7370 6c61 7965 6420 3d20 7370 6563 5b6d  splayed = spec[m
-00021360: 696e 6672 6571 496e 643a 6d61 7866 7265  infreqInd:maxfre
-00021370: 7149 6e64 2c3a 5d0a 2020 2020 2366 7265  qInd,:].    #fre
-00021380: 7173 5f64 6973 706c 6179 6564 203d 2066  qs_displayed = f
-00021390: 7265 7173 5b6d 696e 6672 6571 496e 643a  reqs[minfreqInd:
-000213a0: 6d61 7866 7265 7149 6e64 5d0a 2020 2020  maxfreqInd].    
-000213b0: 2369 6d2e 7365 745f 6461 7461 2861 7272  #im.set_data(arr
-000213c0: 6179 5f64 6973 706c 6179 6564 290a 2020  ay_displayed).  
-000213d0: 2020 766d 696e 203d 206e 702e 7065 7263    vmin = np.perc
-000213e0: 656e 7469 6c65 2861 7272 6179 5f64 6973  entile(array_dis
-000213f0: 706c 6179 6564 2c20 636d 6170 5f70 6572  played, cmap_per
-00021400: 5b30 5d2a 3130 3029 0a20 2020 2076 6d61  [0]*100).    vma
-00021410: 7820 3d20 6e70 2e70 6572 6365 6e74 696c  x = np.percentil
-00021420: 6528 6172 7261 795f 6469 7370 6c61 7965  e(array_displaye
-00021430: 642c 2063 6d61 705f 7065 725b 315d 2a31  d, cmap_per[1]*1
-00021440: 3030 290a 2020 2020 0a20 2020 2064 6563  00).    .    dec
-00021450: 696d 6174 696f 6e5f 6661 6374 6f72 203d  imation_factor =
-00021460: 2031 300a 0a20 2020 2073 5469 6d65 203d   10..    sTime =
-00021470: 2073 7472 6561 6d5b 305d 2e73 7461 7473   stream[0].stats
-00021480: 2e73 7461 7274 7469 6d65 0a20 2020 2074  .starttime.    t
-00021490: 696d 654c 6973 7420 3d20 7b7d 0a20 2020  imeList = {}.   
-000214a0: 206d 706c 5469 6d65 7320 3d20 7b7d 0a20   mplTimes = {}. 
-000214b0: 2020 200a 2020 2020 2344 6563 696d 6174     .    #Decimat
-000214c0: 6520 6461 7461 2028 7365 656d 7320 746f  e data (seems to
-000214d0: 2062 7269 6e67 2075 7020 6c6f 7473 206f   bring up lots o
-000214e0: 6620 6973 7375 6573 206c 6174 6572 290a  f issues later).
-000214f0: 2020 2020 2369 6620 6973 696e 7374 616e      #if isinstan
-00021500: 6365 286f 675f 7374 7265 616d 5b30 5d2e  ce(og_stream[0].
-00021510: 6461 7461 2c20 6e70 2e6d 612e 4d61 736b  data, np.ma.Mask
-00021520: 6564 4172 7261 7929 3a0a 2020 2020 2320  edArray):.    # 
-00021530: 2020 2066 6f72 2074 7261 6365 2069 6e20     for trace in 
-00021540: 6f67 5f73 7472 6561 6d3a 0a20 2020 2023  og_stream:.    #
-00021550: 2020 2020 2020 2020 2375 6e6d 6173 6b65          #unmaske
-00021560: 6420 3d20 7472 6163 652e 6461 7461 5b7e  d = trace.data[~
-00021570: 6e70 2e6d 612e 6765 746d 6173 6b28 7472  np.ma.getmask(tr
-00021580: 6163 652e 6461 7461 295d 0a20 2020 2023  ace.data)].    #
-00021590: 2020 2020 2020 2020 6465 6369 6d61 7465          decimate
-000215a0: 645f 6461 7461 203d 2073 6369 7079 2e73  d_data = scipy.s
-000215b0: 6967 6e61 6c2e 6465 6369 6d61 7465 2874  ignal.decimate(t
-000215c0: 7261 6365 2e64 6174 612c 2064 6563 696d  race.data, decim
-000215d0: 6174 696f 6e5f 6661 6374 6f72 290a 2020  ation_factor).  
-000215e0: 2020 2320 2020 2020 2020 2064 6563 696d    #        decim
-000215f0: 6174 6564 5f6d 6173 6b20 3d20 7472 6163  ated_mask = trac
-00021600: 652e 6461 7461 2e6d 6173 6b5b 3a3a 6465  e.data.mask[::de
-00021610: 6369 6d61 7469 6f6e 5f66 6163 746f 725d  cimation_factor]
-00021620: 0a20 2020 2023 2020 2020 2020 2020 7072  .    #        pr
-00021630: 696e 7428 6c65 6e28 6465 6369 6d61 7465  int(len(decimate
-00021640: 645f 6461 7461 2929 0a20 2020 2023 2020  d_data)).    #  
-00021650: 2020 2020 2020 7072 696e 7428 6c65 6e28        print(len(
-00021660: 6465 6369 6d61 7465 645f 6d61 736b 2929  decimated_mask))
-00021670: 0a20 2020 2023 2020 2020 2020 2020 7472  .    #        tr
-00021680: 6163 652e 6461 7461 203d 206e 702e 6d61  ace.data = np.ma
-00021690: 2e61 7272 6179 2864 6563 696d 6174 6564  .array(decimated
-000216a0: 5f64 6174 612c 206d 6173 6b3d 6465 6369  _data, mask=deci
-000216b0: 6d61 7465 645f 6d61 736b 290a 2020 2020  mated_mask).    
-000216c0: 2320 2020 2020 2020 2074 7261 6365 2e64  #        trace.d
-000216d0: 6174 6120 3d20 6e70 2e6d 612e 6669 6c6c  ata = np.ma.fill
-000216e0: 6564 2874 7261 6365 2e64 6174 612c 206e  ed(trace.data, n
-000216f0: 702e 6e61 6e29 0a20 2020 2023 656c 7365  p.nan).    #else
-00021700: 3a0a 2020 2020 2320 2020 206f 675f 7374  :.    #    og_st
-00021710: 7265 616d 2e64 6563 696d 6174 6528 6465  ream.decimate(de
-00021720: 6369 6d61 7469 6f6e 5f66 6163 746f 7229  cimation_factor)
-00021730: 0a20 2020 206f 675f 7374 7265 616d 2e64  .    og_stream.d
-00021740: 6563 696d 6174 6528 6465 6369 6d61 7469  ecimate(decimati
-00021750: 6f6e 5f66 6163 746f 7229 0a20 2020 2066  on_factor).    f
-00021760: 6f72 2069 2c20 7472 2069 6e20 656e 756d  or i, tr in enum
-00021770: 6572 6174 6528 6f67 5f73 7472 6561 6d29  erate(og_stream)
-00021780: 3a0a 2020 2020 2020 2020 6b65 7920 3d20  :.        key = 
-00021790: 7472 2e73 7461 7473 2e63 6f6d 706f 6e65  tr.stats.compone
-000217a0: 6e74 0a20 2020 2020 2020 2074 696d 654c  nt.        timeL
-000217b0: 6973 745b 6b65 795d 203d 205b 5d20 0a20  ist[key] = [] . 
-000217c0: 2020 2020 2020 206d 706c 5469 6d65 735b         mplTimes[
-000217d0: 6b65 795d 203d 205b 5d0a 2020 2020 2020  key] = [].      
-000217e0: 2020 666f 7220 7420 696e 2074 722e 7469    for t in tr.ti
-000217f0: 6d65 7328 293a 0a20 2020 2020 2020 2020  mes():.         
-00021800: 2020 2074 203d 2073 5469 6d65 202b 2074     t = sTime + t
-00021810: 0a20 2020 2020 2020 2020 2020 2074 696d  .            tim
-00021820: 654c 6973 745b 6b65 795d 2e61 7070 656e  eList[key].appen
-00021830: 6428 7429 0a20 2020 2020 2020 2020 2020  d(t).           
-00021840: 206d 706c 5469 6d65 735b 6b65 795d 2e61   mplTimes[key].a
-00021850: 7070 656e 6428 742e 6d61 7470 6c6f 746c  ppend(t.matplotl
-00021860: 6962 5f64 6174 6529 0a20 2020 200a 2020  ib_date).    .  
-00021870: 2020 666f 7220 692c 206b 2069 6e20 656e    for i, k in en
-00021880: 756d 6572 6174 6528 6d70 6c54 696d 6573  umerate(mplTimes
-00021890: 2e6b 6579 7328 2929 3a0a 2020 2020 2020  .keys()):.      
-000218a0: 2020 6966 2069 203d 3d20 303a 0a20 2020    if i == 0:.   
-000218b0: 2020 2020 2020 2020 2078 6d69 6e20 3d20           xmin = 
-000218c0: 6e70 2e6d 696e 286d 706c 5469 6d65 735b  np.min(mplTimes[
-000218d0: 6b5d 290a 2020 2020 2020 2020 2020 2020  k]).            
-000218e0: 786d 6178 203d 206e 702e 6d61 7828 6d70  xmax = np.max(mp
-000218f0: 6c54 696d 6573 5b6b 5d29 0a20 2020 2020  lTimes[k]).     
-00021900: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00021910: 2020 2020 2069 6620 786d 696e 203e 206e       if xmin > n
-00021920: 702e 6d69 6e28 6d70 6c54 696d 6573 5b6b  p.min(mplTimes[k
-00021930: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-00021940: 2020 2020 786d 696e 203d 206e 702e 6d69      xmin = np.mi
-00021950: 6e28 6d70 6c54 696d 6573 5b6b 5d29 0a20  n(mplTimes[k]). 
-00021960: 2020 2020 2020 2020 2020 2069 6620 786d             if xm
-00021970: 6178 203c 206e 702e 6d61 7828 6d70 6c54  ax < np.max(mplT
-00021980: 696d 6573 5b6b 5d29 3a0a 2020 2020 2020  imes[k]):.      
-00021990: 2020 2020 2020 2020 2020 786d 6178 203d            xmax =
-000219a0: 206e 702e 6d61 7828 6d70 6c54 696d 6573   np.max(mplTimes
-000219b0: 5b6b 5d29 2020 2020 2020 2020 200a 2020  [k])         .  
-000219c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000219d0: 200a 2020 2020 6e6f 726d 203d 206d 6174   .    norm = mat
-000219e0: 706c 6f74 6c69 622e 636f 6c6f 7273 2e4e  plotlib.colors.N
-000219f0: 6f72 6d61 6c69 7a65 2876 6d69 6e3d 766d  ormalize(vmin=vm
-00021a00: 696e 2c20 766d 6178 3d76 6d61 7829 0a20  in, vmax=vmax). 
-00021a10: 2020 2069 6d20 3d20 6178 5b27 7370 6563     im = ax['spec
-00021a20: 275d 2e69 6d73 686f 7728 6172 7261 795f  '].imshow(array_
-00021a30: 6469 7370 6c61 7965 642c 206e 6f72 6d3d  displayed, norm=
-00021a40: 6e6f 726d 2c20 636d 6170 3d63 6d61 702c  norm, cmap=cmap,
-00021a50: 2061 7370 6563 743d 2761 7574 6f27 2c20   aspect='auto', 
-00021a60: 696e 7465 7270 6f6c 6174 696f 6e3d 4e6f  interpolation=No
-00021a70: 6e65 2c20 6578 7465 6e74 3d5b 786d 696e  ne, extent=[xmin
-00021a80: 2c78 6d61 782c 796d 6178 2c79 6d69 6e5d  ,xmax,ymax,ymin]
-00021a90: 290a 0a20 2020 2061 785b 2773 7065 6327  )..    ax['spec'
-00021aa0: 5d2e 7365 745f 786c 696d 285b 786d 696e  ].set_xlim([xmin
-00021ab0: 2c20 786d 6178 5d29 0a20 2020 2061 785b  , xmax]).    ax[
-00021ac0: 2773 7065 6327 5d2e 7365 745f 796c 696d  'spec'].set_ylim
-00021ad0: 285b 796d 696e 2c20 796d 6178 5d29 0a20  ([ymin, ymax]). 
-00021ae0: 2020 2061 785b 2773 7065 6327 5d2e 7365     ax['spec'].se
-00021af0: 6d69 6c6f 6779 2829 200a 2020 2020 0a20  milogy() .    . 
-00021b00: 2020 2023 6362 6172 203d 2070 6c74 2e63     #cbar = plt.c
-00021b10: 6f6c 6f72 6261 7228 6d61 7070 6162 6c65  olorbar(mappable
-00021b20: 3d69 6d29 0a20 2020 2023 6362 6172 2e73  =im).    #cbar.s
-00021b30: 6574 5f6c 6162 656c 2827 506f 7765 7220  et_label('Power 
-00021b40: 5370 6563 7472 616c 2044 656e 7369 7479  Spectral Density
-00021b50: 205b 6442 5d27 290a 2020 2020 2373 7472   [dB]').    #str
-00021b60: 6561 6d2e 7370 6563 7472 6f67 7261 6d28  eam.spectrogram(
-00021b70: 7361 6d70 5f72 6174 653d 7361 6d70 6c65  samp_rate=sample
-00021b80: 5f72 6174 652c 2061 7865 733d 6178 2c20  _rate, axes=ax, 
-00021b90: 7065 725f 6c61 703d 302e 3735 2c20 6c6f  per_lap=0.75, lo
-00021ba0: 673d 5472 7565 2c20 7469 746c 653d 7469  g=True, title=ti
-00021bb0: 746c 652c 2063 6d61 703d 2774 7572 626f  tle, cmap='turbo
-00021bc0: 272c 2064 6273 6361 6c65 3d64 6273 6361  ', dbscale=dbsca
-00021bd0: 6c65 2c20 7368 6f77 3d46 616c 7365 290a  le, show=False).
-00021be0: 2020 2020 0a20 2020 2061 785b 2773 7065      .    ax['spe
-00021bf0: 6327 5d2e 7861 7869 735f 6461 7465 2829  c'].xaxis_date()
-00021c00: 0a20 2020 2061 785b 2773 6967 6e61 6c7a  .    ax['signalz
-00021c10: 275d 2e78 6178 6973 5f64 6174 6528 290a  '].xaxis_date().
-00021c20: 2020 2020 6178 5b27 7369 676e 616c 6e27      ax['signaln'
-00021c30: 5d2e 7861 7869 735f 6461 7465 2829 0a20  ].xaxis_date(). 
-00021c40: 2020 2061 785b 2773 6967 6e61 6c65 275d     ax['signale']
-00021c50: 2e78 6178 6973 5f64 6174 6528 290a 2020  .xaxis_date().  
-00021c60: 2020 2374 5469 636b 7320 3d20 6d64 6174    #tTicks = mdat
-00021c70: 6573 2e4d 696e 7574 654c 6f63 6174 6f72  es.MinuteLocator
-00021c80: 2869 6e74 6572 7661 6c3d 3529 0a20 2020  (interval=5).   
-00021c90: 2023 6178 5b30 5d2e 7861 7869 732e 7365   #ax[0].xaxis.se
-00021ca0: 745f 6d61 6a6f 725f 6c6f 6361 746f 7228  t_major_locator(
-00021cb0: 7454 6963 6b73 290a 2020 2020 6178 5b27  tTicks).    ax['
-00021cc0: 7369 676e 616c 6527 5d2e 7861 7869 732e  signale'].xaxis.
-00021cd0: 7365 745f 6d61 6a6f 725f 6c6f 6361 746f  set_major_locato
-00021ce0: 7228 6d64 6174 6573 2e4d 696e 7574 654c  r(mdates.MinuteL
-00021cf0: 6f63 6174 6f72 2862 796d 696e 7574 653d  ocator(byminute=
-00021d00: 7261 6e67 6528 302c 3630 2c35 2929 290a  range(0,60,5))).
-00021d10: 2020 2020 6178 5b27 7369 676e 616c 6527      ax['signale'
-00021d20: 5d2e 7861 7869 732e 7365 745f 6d61 6a6f  ].xaxis.set_majo
-00021d30: 725f 666f 726d 6174 7465 7228 6d64 6174  r_formatter(mdat
-00021d40: 6573 2e44 6174 6546 6f72 6d61 7474 6572  es.DateFormatter
-00021d50: 2827 2548 3a25 4d27 2929 0a20 2020 2061  ('%H:%M')).    a
-00021d60: 785b 2773 6967 6e61 6c65 275d 2e78 6178  x['signale'].xax
-00021d70: 6973 2e73 6574 5f6d 696e 6f72 5f6c 6f63  is.set_minor_loc
-00021d80: 6174 6f72 286d 6461 7465 732e 4d69 6e75  ator(mdates.Minu
-00021d90: 7465 4c6f 6361 746f 7228 696e 7465 7276  teLocator(interv
-00021da0: 616c 3d31 2929 0a20 2020 2061 785b 2773  al=1)).    ax['s
-00021db0: 6967 6e61 6c65 275d 2e74 6963 6b5f 7061  ignale'].tick_pa
-00021dc0: 7261 6d73 2861 7869 733d 2778 272c 206c  rams(axis='x', l
-00021dd0: 6162 656c 7369 7a65 3d38 290a 2020 2020  abelsize=8).    
-00021de0: 0a20 2020 2061 785b 2773 6967 6e61 6c7a  .    ax['signalz
-00021df0: 275d 2e70 6c6f 7428 6d70 6c54 696d 6573  '].plot(mplTimes
-00021e00: 5b27 5a27 5d2c 6f67 5f73 7472 6561 6d2e  ['Z'],og_stream.
-00021e10: 7365 6c65 6374 2863 6f6d 706f 6e65 6e74  select(component
-00021e20: 3d27 5a27 295b 305d 2e64 6174 612c 2063  ='Z')[0].data, c
-00021e30: 6f6c 6f72 3d27 6b27 2c20 6c69 6e65 7769  olor='k', linewi
-00021e40: 6474 683d 302e 3235 290a 2020 2020 6178  dth=0.25).    ax
-00021e50: 5b27 7369 676e 616c 6e27 5d2e 706c 6f74  ['signaln'].plot
-00021e60: 286d 706c 5469 6d65 735b 274e 275d 2c6f  (mplTimes['N'],o
-00021e70: 675f 7374 7265 616d 2e73 656c 6563 7428  g_stream.select(
-00021e80: 636f 6d70 6f6e 656e 743d 274e 2729 5b30  component='N')[0
-00021e90: 5d2e 6461 7461 2c20 636f 6c6f 723d 276b  ].data, color='k
-00021ea0: 272c 206c 696e 6577 6964 7468 3d30 2e31  ', linewidth=0.1
-00021eb0: 290a 2020 2020 6178 5b27 7369 676e 616c  ).    ax['signal
-00021ec0: 6527 5d2e 706c 6f74 286d 706c 5469 6d65  e'].plot(mplTime
-00021ed0: 735b 2745 275d 2c6f 675f 7374 7265 616d  s['E'],og_stream
-00021ee0: 2e73 656c 6563 7428 636f 6d70 6f6e 656e  .select(componen
-00021ef0: 743d 2745 2729 5b30 5d2e 6461 7461 2c20  t='E')[0].data, 
-00021f00: 636f 6c6f 723d 276b 272c 206c 696e 6577  color='k', linew
-00021f10: 6964 7468 3d30 2e31 290a 0a20 2020 2061  idth=0.1)..    a
-00021f20: 785b 2773 7065 6327 5d2e 7365 745f 796c  x['spec'].set_yl
-00021f30: 6162 656c 2827 5370 6563 7472 6f67 7261  abel('Spectrogra
-00021f40: 6d3a 207b 7d27 2e66 6f72 6d61 7428 636f  m: {}'.format(co
-00021f50: 6d70 6f6e 656e 7429 290a 2020 2020 6178  mponent)).    ax
-00021f60: 5b27 7369 676e 616c 7a27 5d2e 7365 745f  ['signalz'].set_
-00021f70: 796c 6162 656c 2827 5a27 290a 2020 2020  ylabel('Z').    
-00021f80: 6178 5b27 7369 676e 616c 6e27 5d2e 7365  ax['signaln'].se
-00021f90: 745f 796c 6162 656c 2827 4e27 290a 2020  t_ylabel('N').  
-00021fa0: 2020 6178 5b27 7369 676e 616c 6527 5d2e    ax['signale'].
-00021fb0: 7365 745f 796c 6162 656c 2827 4527 290a  set_ylabel('E').
-00021fc0: 2020 2020 0a20 2020 2066 6f72 2063 6f6d      .    for com
-00021fd0: 7020 696e 206d 706c 5469 6d65 732e 6b65  p in mplTimes.ke
-00021fe0: 7973 2829 3a0a 2020 2020 2020 2020 7374  ys():.        st
-00021ff0: 4420 3d20 6e70 2e6e 616e 7374 6428 6f67  D = np.nanstd(og
-00022000: 5f73 7472 6561 6d2e 7365 6c65 6374 2863  _stream.select(c
-00022010: 6f6d 706f 6e65 6e74 3d63 6f6d 7029 5b30  omponent=comp)[0
-00022020: 5d2e 6461 7461 290a 2020 2020 2020 2020  ].data).        
-00022030: 646d 6564 203d 206e 702e 6e61 6e6d 6564  dmed = np.nanmed
-00022040: 6961 6e28 6f67 5f73 7472 6561 6d2e 7365  ian(og_stream.se
-00022050: 6c65 6374 2863 6f6d 706f 6e65 6e74 3d63  lect(component=c
-00022060: 6f6d 7029 5b30 5d2e 6461 7461 290a 2020  omp)[0].data).  
-00022070: 2020 2020 2020 6b65 7920 3d20 2773 6967        key = 'sig
-00022080: 6e61 6c27 2b63 6f6d 702e 6c6f 7765 7228  nal'+comp.lower(
-00022090: 290a 2020 2020 2020 2020 6178 5b6b 6579  ).        ax[key
-000220a0: 5d2e 7365 745f 796c 696d 285b 646d 6564  ].set_ylim([dmed
-000220b0: 2d35 2a73 7444 2c20 646d 6564 2b35 2a73  -5*stD, dmed+5*s
-000220c0: 7444 5d29 0a20 2020 200a 2020 2020 6966  tD]).    .    if
-000220d0: 2070 6172 616d 7320 6973 204e 6f6e 653a   params is None:
-000220e0: 0a20 2020 2020 2020 2066 6967 2e73 7570  .        fig.sup
-000220f0: 7469 746c 6528 2748 5653 5220 5369 7465  title('HVSR Site
-00022100: 3a20 5370 6563 7472 6f67 7261 6d20 616e  : Spectrogram an
-00022110: 6420 4461 7461 2729 0a20 2020 2065 6c69  d Data').    eli
-00022120: 6620 2774 6974 6c65 2720 696e 206b 7761  f 'title' in kwa
-00022130: 7267 732e 6b65 7973 2829 3a0a 2020 2020  rgs.keys():.    
-00022140: 2020 2020 6669 672e 7375 7074 6974 6c65      fig.suptitle
-00022150: 286b 7761 7267 735b 2774 6974 6c65 275d  (kwargs['title']
-00022160: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
-00022170: 2020 2020 6669 672e 7375 7074 6974 6c65      fig.suptitle
-00022180: 2870 6172 616d 735b 2773 6974 6527 5d2b  (params['site']+
-00022190: 2753 7065 6374 726f 6772 616d 2061 6e64  'Spectrogram and
-000221a0: 2044 6174 6127 290a 2020 2020 0a20 2020   Data').    .   
-000221b0: 2064 6179 203d 2022 7b7d 2d7b 7d2d 7b7d   day = "{}-{}-{}
-000221c0: 222e 666f 726d 6174 2873 7472 6561 6d5b  ".format(stream[
-000221d0: 305d 2e73 7461 7473 2e73 7461 7274 7469  0].stats.startti
-000221e0: 6d65 2e79 6561 722c 2073 7472 6561 6d5b  me.year, stream[
-000221f0: 305d 2e73 7461 7473 2e73 7461 7274 7469  0].stats.startti
-00022200: 6d65 2e6d 6f6e 7468 2c20 7374 7265 616d  me.month, stream
-00022210: 5b30 5d2e 7374 6174 732e 7374 6172 7474  [0].stats.startt
-00022220: 696d 652e 6461 7929 0a20 2020 2061 785b  ime.day).    ax[
-00022230: 2773 6967 6e61 6c65 275d 2e73 6574 5f78  'signale'].set_x
-00022240: 6c61 6265 6c28 2755 5443 2054 696d 6520  label('UTC Time 
-00022250: 5c6e 272b 6461 7929 0a0a 2020 2020 2370  \n'+day)..    #p
-00022260: 6c74 2e72 6350 6172 616d 735b 2766 6967  lt.rcParams['fig
-00022270: 7572 652e 6470 6927 5d20 3d20 3130 300a  ure.dpi'] = 100.
-00022280: 2020 2020 2370 6c74 2e72 6350 6172 616d      #plt.rcParam
-00022290: 735b 2766 6967 7572 652e 6669 6773 697a  s['figure.figsiz
-000222a0: 6527 5d20 3d20 2835 2c34 290a 2020 2020  e'] = (5,4).    
-000222b0: 0a20 2020 2023 6669 672e 7469 6768 745f  .    #fig.tight_
-000222c0: 6c61 796f 7574 2829 0a20 2020 2066 6967  layout().    fig
-000222d0: 2e63 616e 7661 732e 6472 6177 2829 0a20  .canvas.draw(). 
-000222e0: 2020 2069 6620 7265 7475 726e 5f66 6967     if return_fig
-000222f0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00022300: 2066 6967 2c20 6178 0a20 2020 2072 6574   fig, ax.    ret
-00022310: 7572 6e0a 0a23 4865 6c70 6572 2066 756e  urn..#Helper fun
-00022320: 6374 696f 6e20 666f 7220 6d61 6e75 616c  ction for manual
-00022330: 2077 696e 646f 7720 7365 6c65 6374 696f   window selectio
-00022340: 6e20 0a64 6566 205f 5f64 7261 775f 626f  n .def __draw_bo
-00022350: 7865 7328 6576 656e 742c 2063 6c69 636b  xes(event, click
-00022360: 4e6f 2c20 7857 696e 646f 7773 2c20 7061  No, xWindows, pa
-00022370: 7468 4c69 7374 2c20 7769 6e64 6f77 4472  thList, windowDr
-00022380: 6177 6e2c 2077 696e 4172 7469 7374 2c20  awn, winArtist, 
-00022390: 6c69 6e65 4172 7469 7374 2c20 7830 2c20  lineArtist, x0, 
-000223a0: 6669 672c 2061 7829 3a0a 2020 2020 2222  fig, ax):.    ""
-000223b0: 2248 656c 7065 7220 6675 6e63 7469 6f6e  "Helper function
-000223c0: 2066 6f72 206d 616e 7561 6c20 7769 6e64   for manual wind
-000223d0: 6f77 2073 656c 6563 7469 6f6e 2074 6f20  ow selection to 
-000223e0: 6472 6177 2062 6f78 6573 2074 6f20 7368  draw boxes to sh
-000223f0: 6f77 2077 6865 7265 2077 696e 646f 7773  ow where windows
-00022400: 2068 6176 6520 6265 656e 2073 656c 6563   have been selec
-00022410: 7465 6420 666f 7220 7265 6d6f 7661 6c22  ted for removal"
-00022420: 2222 0a20 2020 2023 4372 6561 7465 2061  "".    #Create a
-00022430: 6e20 6178 6973 2064 6963 7469 6f6e 6172  n axis dictionar
-00022440: 7920 6966 2069 7420 646f 6573 206e 6f74  y if it does not
-00022450: 2061 6c72 6561 6479 2065 7869 7374 2073   already exist s
-00022460: 6f20 616c 6c20 6675 6e63 7469 6f6e 7320  o all functions 
-00022470: 6172 6520 7468 6520 7361 6d65 0a0a 2020  are the same..  
-00022480: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00022490: 6178 2c20 6e70 2e6e 6461 7272 6179 2920  ax, np.ndarray) 
-000224a0: 6f72 2069 7369 6e73 7461 6e63 6528 6178  or isinstance(ax
-000224b0: 2c20 6469 6374 293a 0a20 2020 2020 2020  , dict):.       
-000224c0: 2061 7820 3d20 6178 0a20 2020 2065 6c73   ax = ax.    els
-000224d0: 653a 0a20 2020 2020 2020 2061 7820 3d20  e:.        ax = 
-000224e0: 7b27 6127 3a61 787d 0a0a 2020 2020 0a20  {'a':ax}..    . 
-000224f0: 2020 2069 6620 6c65 6e28 6178 2920 3e20     if len(ax) > 
-00022500: 313a 0a20 2020 2020 2020 2069 6620 7479  1:.        if ty
-00022510: 7065 2861 7829 2069 7320 6e6f 7420 6469  pe(ax) is not di
-00022520: 6374 3a0a 2020 2020 2020 2020 2020 2020  ct:.            
-00022530: 6178 4469 6374 203d 207b 7d0a 2020 2020  axDict = {}.    
-00022540: 2020 2020 2020 2020 666f 7220 692c 2061          for i, a
-00022550: 2069 6e20 656e 756d 6572 6174 6528 6178   in enumerate(ax
-00022560: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00022570: 2020 2061 7844 6963 745b 7374 7228 6929     axDict[str(i)
-00022580: 5d20 3d20 610a 2020 2020 2020 2020 2020  ] = a.          
-00022590: 2020 6178 203d 2061 7844 6963 740a 2020    ax = axDict.  
-000225a0: 2020 2365 6c73 653a 0a20 2020 2023 2020    #else:.    #  
-000225b0: 2020 6178 203d 207b 2761 273a 6178 7d0a    ax = {'a':ax}.
-000225c0: 2020 2020 0a20 2020 2023 6966 2065 7665      .    #if eve
-000225d0: 6e74 2e69 6e61 7865 7321 3d61 783a 2072  nt.inaxes!=ax: r
-000225e0: 6574 7572 6e0a 2020 2020 2379 302c 2079  eturn.    #y0, y
-000225f0: 3120 3d20 6178 2e67 6574 5f79 6c69 6d28  1 = ax.get_ylim(
-00022600: 290a 2020 2020 7930 203d 205b 5d0a 2020  ).    y0 = [].  
-00022610: 2020 7931 203d 205b 5d0a 2020 2020 6b4c    y1 = [].    kL
-00022620: 6973 7420 3d20 5b5d 0a20 2020 2066 6f72  ist = [].    for
-00022630: 206b 2069 6e20 6178 2e6b 6579 7328 293a   k in ax.keys():
-00022640: 0a20 2020 2020 2020 206b 4c69 7374 2e61  .        kList.a
-00022650: 7070 656e 6428 6b29 0a20 2020 2020 2020  ppend(k).       
-00022660: 2079 302e 6170 7065 6e64 2861 785b 6b5d   y0.append(ax[k]
-00022670: 2e67 6574 5f79 6c69 6d28 295b 305d 290a  .get_ylim()[0]).
-00022680: 2020 2020 2020 2020 7931 2e61 7070 656e          y1.appen
-00022690: 6428 6178 5b6b 5d2e 6765 745f 796c 696d  d(ax[k].get_ylim
-000226a0: 2829 5b31 5d29 0a20 2020 2023 656c 7365  ()[1]).    #else
-000226b0: 3a0a 2020 2020 2320 2020 2079 3020 3d20  :.    #    y0 = 
-000226c0: 5b61 782e 6765 745f 796c 696d 2829 5b30  [ax.get_ylim()[0
-000226d0: 5d5d 0a20 2020 2023 2020 2020 7931 203d  ]].    #    y1 =
-000226e0: 205b 6178 2e67 6574 5f79 6c69 6d28 295b   [ax.get_ylim()[
-000226f0: 315d 5d0a 0a20 2020 2069 6620 636c 6963  1]]..    if clic
-00022700: 6b4e 6f20 3d3d 2030 3a0a 2020 2020 2020  kNo == 0:.      
-00022710: 2020 2379 203d 206e 702e 6c69 6e73 7061    #y = np.linspa
-00022720: 6365 2861 782e 6765 745f 796c 696d 2829  ce(ax.get_ylim()
-00022730: 5b30 5d2c 2061 782e 6765 745f 796c 696d  [0], ax.get_ylim
-00022740: 2829 5b31 5d2c 2032 290a 2020 2020 2020  ()[1], 2).      
-00022750: 2020 7830 203d 2065 7665 6e74 2e78 6461    x0 = event.xda
-00022760: 7461 0a20 2020 2020 2020 2063 6c69 636b  ta.        click
-00022770: 4e6f 203d 2031 2020 200a 2020 2020 2020  No = 1   .      
-00022780: 2020 6c69 6e65 4172 7469 7374 2e61 7070    lineArtist.app
-00022790: 656e 6428 5b5d 290a 2020 2020 2020 2020  end([]).        
-000227a0: 7769 6e4e 756d 7320 3d20 6c65 6e28 7857  winNums = len(xW
-000227b0: 696e 646f 7773 290a 2020 2020 2020 2020  indows).        
-000227c0: 666f 7220 692c 206b 2069 6e20 656e 756d  for i, k in enum
-000227d0: 6572 6174 6528 6178 2e6b 6579 7328 2929  erate(ax.keys())
-000227e0: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
-000227f0: 6e41 7274 203d 2061 785b 6b5d 2e61 7876  nArt = ax[k].axv
-00022800: 6c69 6e65 2878 302c 2030 2c20 312c 2063  line(x0, 0, 1, c
-00022810: 6f6c 6f72 3d27 6b27 2c20 6c69 6e65 7769  olor='k', linewi
-00022820: 6474 683d 312c 207a 6f72 6465 723d 3130  dth=1, zorder=10
-00022830: 3029 0a20 2020 2020 2020 2020 2020 206c  0).            l
-00022840: 696e 6541 7274 6973 745b 7769 6e4e 756d  ineArtist[winNum
-00022850: 735d 2e61 7070 656e 6428 5b6c 696e 4172  s].append([linAr
-00022860: 742c 206c 696e 4172 745d 290a 2020 2020  t, linArt]).    
-00022870: 2020 2020 2365 6c73 653a 0a20 2020 2020      #else:.     
-00022880: 2020 2023 2020 2020 6c69 6e41 7274 203d     #    linArt =
-00022890: 2070 6c74 2e61 7876 6c69 6e65 2878 302c   plt.axvline(x0,
-000228a0: 2079 305b 695d 2c20 7931 5b69 5d2c 2063   y0[i], y1[i], c
-000228b0: 6f6c 6f72 3d27 6b27 2c20 6c69 6e65 7769  olor='k', linewi
-000228c0: 6474 683d 312c 207a 6f72 6465 723d 3130  dth=1, zorder=10
-000228d0: 3029 0a20 2020 2020 2020 2023 2020 2020  0).        #    
-000228e0: 6c69 6e65 4172 7469 7374 2e61 7070 656e  lineArtist.appen
-000228f0: 6428 5b6c 696e 4172 742c 206c 696e 4172  d([linArt, linAr
-00022900: 745d 290a 2020 2020 656c 7365 3a0a 2020  t]).    else:.  
-00022910: 2020 2020 2020 7831 203d 2065 7665 6e74        x1 = event
-00022920: 2e78 6461 7461 0a20 2020 2020 2020 2063  .xdata.        c
-00022930: 6c69 636b 4e6f 203d 2030 0a0a 2020 2020  lickNo = 0..    
-00022940: 2020 2020 7769 6e64 6f77 4472 6177 6e2e      windowDrawn.
-00022950: 6170 7065 6e64 285b 5d29 0a20 2020 2020  append([]).     
-00022960: 2020 2077 696e 4172 7469 7374 2e61 7070     winArtist.app
-00022970: 656e 6428 5b5d 2920 200a 2020 2020 2020  end([])  .      
-00022980: 2020 7061 7468 4c69 7374 2e61 7070 656e    pathList.appen
-00022990: 6428 5b5d 290a 2020 2020 2020 2020 7769  d([]).        wi
-000229a0: 6e4e 756d 7320 3d20 6c65 6e28 7857 696e  nNums = len(xWin
-000229b0: 646f 7773 290a 2020 2020 2020 2020 666f  dows).        fo
-000229c0: 7220 692c 206b 6579 2069 6e20 656e 756d  r i, key in enum
-000229d0: 6572 6174 6528 6b4c 6973 7429 3a0a 2020  erate(kList):.  
-000229e0: 2020 2020 2020 2020 2020 7061 7468 5f64            path_d
-000229f0: 6174 6120 3d20 5b0a 2020 2020 2020 2020  ata = [.        
-00022a00: 2020 2020 2020 2020 286d 6174 706c 6f74          (matplot
-00022a10: 6c69 622e 7061 7468 2e50 6174 682e 4d4f  lib.path.Path.MO
-00022a20: 5645 544f 2c20 2878 302c 2079 305b 695d  VETO, (x0, y0[i]
-00022a30: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-00022a40: 2020 2020 286d 6174 706c 6f74 6c69 622e      (matplotlib.
-00022a50: 7061 7468 2e50 6174 682e 4c49 4e45 544f  path.Path.LINETO
-00022a60: 2c20 2878 312c 2079 305b 695d 2929 2c0a  , (x1, y0[i])),.
-00022a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022a80: 286d 6174 706c 6f74 6c69 622e 7061 7468  (matplotlib.path
-00022a90: 2e50 6174 682e 4c49 4e45 544f 2c20 2878  .Path.LINETO, (x
-00022aa0: 312c 2079 315b 695d 2929 2c0a 2020 2020  1, y1[i])),.    
-00022ab0: 2020 2020 2020 2020 2020 2020 286d 6174              (mat
-00022ac0: 706c 6f74 6c69 622e 7061 7468 2e50 6174  plotlib.path.Pat
-00022ad0: 682e 4c49 4e45 544f 2c20 2878 302c 2079  h.LINETO, (x0, y
-00022ae0: 315b 695d 2929 2c0a 2020 2020 2020 2020  1[i])),.        
-00022af0: 2020 2020 2020 2020 286d 6174 706c 6f74          (matplot
-00022b00: 6c69 622e 7061 7468 2e50 6174 682e 4c49  lib.path.Path.LI
-00022b10: 4e45 544f 2c20 2878 302c 2079 305b 695d  NETO, (x0, y0[i]
-00022b20: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-00022b30: 2020 2020 286d 6174 706c 6f74 6c69 622e      (matplotlib.
-00022b40: 7061 7468 2e50 6174 682e 434c 4f53 4550  path.Path.CLOSEP
-00022b50: 4f4c 592c 2028 7830 2c20 7930 5b69 5d29  OLY, (x0, y0[i])
-00022b60: 292c 0a20 2020 2020 2020 2020 2020 205d  ),.            ]
-00022b70: 0a20 2020 2020 2020 2020 2020 2063 6f64  .            cod
-00022b80: 6573 2c20 7665 7274 7320 3d20 7a69 7028  es, verts = zip(
-00022b90: 2a70 6174 685f 6461 7461 290a 2020 2020  *path_data).    
-00022ba0: 2020 2020 2020 2020 7061 7468 203d 206d          path = m
-00022bb0: 6174 706c 6f74 6c69 622e 7061 7468 2e50  atplotlib.path.P
-00022bc0: 6174 6828 7665 7274 732c 2063 6f64 6573  ath(verts, codes
-00022bd0: 290a 0a20 2020 2020 2020 2020 2020 2077  )..            w
-00022be0: 696e 646f 7744 7261 776e 5b77 696e 4e75  indowDrawn[winNu
-00022bf0: 6d73 5d2e 6170 7065 6e64 2846 616c 7365  ms].append(False
-00022c00: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
-00022c10: 6e41 7274 6973 745b 7769 6e4e 756d 735d  nArtist[winNums]
-00022c20: 2e61 7070 656e 6428 4e6f 6e65 290a 0a20  .append(None).. 
-00022c30: 2020 2020 2020 2020 2020 2070 6174 684c             pathL
-00022c40: 6973 745b 7769 6e4e 756d 735d 2e61 7070  ist[winNums].app
-00022c50: 656e 6428 7061 7468 290a 2020 2020 2020  end(path).      
-00022c60: 2020 2020 2020 5f5f 6472 6177 5f77 696e        __draw_win
-00022c70: 646f 7773 2865 7665 6e74 3d65 7665 6e74  dows(event=event
-00022c80: 2c20 7061 7468 6c69 7374 3d70 6174 684c  , pathlist=pathL
-00022c90: 6973 742c 2061 785f 6b65 793d 6b65 792c  ist, ax_key=key,
-00022ca0: 2077 696e 646f 7744 7261 776e 3d77 696e   windowDrawn=win
-00022cb0: 646f 7744 7261 776e 2c20 7769 6e41 7274  dowDrawn, winArt
-00022cc0: 6973 743d 7769 6e41 7274 6973 742c 2078  ist=winArtist, x
-00022cd0: 5769 6e64 6f77 733d 7857 696e 646f 7773  Windows=xWindows
-00022ce0: 2c20 6669 673d 6669 672c 2061 783d 6178  , fig=fig, ax=ax
-00022cf0: 290a 2020 2020 2020 2020 2020 2020 6c69  ).            li
-00022d00: 6e41 7274 203d 2070 6c74 2e61 7876 6c69  nArt = plt.axvli
-00022d10: 6e65 2878 312c 2030 2c20 312c 2063 6f6c  ne(x1, 0, 1, col
-00022d20: 6f72 3d27 6b27 2c20 6c69 6e65 7769 6474  or='k', linewidt
-00022d30: 683d 302e 352c 207a 6f72 6465 723d 3130  h=0.5, zorder=10
-00022d40: 3029 0a0a 2020 2020 2020 2020 2020 2020  0)..            
-00022d50: 5b6c 696e 6541 7274 6973 745b 7769 6e4e  [lineArtist[winN
-00022d60: 756d 735d 5b69 5d2e 706f 7028 2d31 295d  ums][i].pop(-1)]
-00022d70: 0a20 2020 2020 2020 2020 2020 206c 696e  .            lin
-00022d80: 6541 7274 6973 745b 7769 6e4e 756d 735d  eArtist[winNums]
-00022d90: 5b69 5d2e 6170 7065 6e64 286c 696e 4172  [i].append(linAr
-00022da0: 7429 0a20 2020 2020 2020 2078 5f77 696e  t).        x_win
-00022db0: 203d 205b 7830 2c20 7831 5d0a 2020 2020   = [x0, x1].    
-00022dc0: 2020 2020 785f 7769 6e2e 736f 7274 2829      x_win.sort()
-00022dd0: 2023 4d61 6b65 2073 7572 6520 7468 6579   #Make sure they
-00022de0: 2061 7265 2069 6e20 7468 6520 7269 6768   are in the righ
-00022df0: 7420 6f72 6465 720a 2020 2020 2020 2020  t order.        
-00022e00: 7857 696e 646f 7773 2e61 7070 656e 6428  xWindows.append(
-00022e10: 785f 7769 6e29 0a20 2020 2066 6967 2e63  x_win).    fig.c
-00022e20: 616e 7661 732e 6472 6177 2829 0a20 2020  anvas.draw().   
-00022e30: 2072 6574 7572 6e20 636c 6963 6b4e 6f2c   return clickNo,
-00022e40: 2078 300a 0a23 4865 6c70 6572 2066 756e   x0..#Helper fun
-00022e50: 6374 696f 6e20 666f 7220 6d61 6e75 616c  ction for manual
-00022e60: 2077 696e 646f 7720 7365 6c65 6374 696f   window selectio
-00022e70: 6e20 746f 2064 7261 7720 626f 7865 7320  n to draw boxes 
-00022e80: 746f 2064 6573 6c65 6374 2077 696e 646f  to deslect windo
-00022e90: 7773 2066 6f72 2072 656d 6f76 616c 0a64  ws for removal.d
-00022ea0: 6566 205f 5f72 656d 6f76 655f 6f6e 5f72  ef __remove_on_r
-00022eb0: 6967 6874 2865 7665 6e74 2c20 7857 696e  ight(event, xWin
-00022ec0: 646f 7773 2c20 7061 7468 4c69 7374 2c20  dows, pathList, 
-00022ed0: 7769 6e64 6f77 4472 6177 6e2c 2077 696e  windowDrawn, win
-00022ee0: 4172 7469 7374 2c20 206c 696e 6541 7274  Artist,  lineArt
-00022ef0: 6973 742c 2066 6967 2c20 6178 293a 0a20  ist, fig, ax):. 
-00022f00: 2020 2022 2222 4865 6c70 6572 2066 756e     """Helper fun
-00022f10: 6374 696f 6e20 666f 7220 6d61 6e75 616c  ction for manual
-00022f20: 2077 696e 646f 7720 7365 6c65 6374 696f   window selectio
-00022f30: 6e20 746f 2064 7261 7720 626f 7865 7320  n to draw boxes 
-00022f40: 746f 2064 6573 6c65 6374 2077 696e 646f  to deslect windo
-00022f50: 7773 2066 6f72 2072 656d 6f76 616c 2222  ws for removal""
-00022f60: 220a 0a20 2020 2069 6620 7857 696e 646f  "..    if xWindo
-00022f70: 7773 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ws is not None:.
-00022f80: 2020 2020 2020 2020 666f 7220 692c 2078          for i, x
-00022f90: 5769 6e73 2069 6e20 656e 756d 6572 6174  Wins in enumerat
-00022fa0: 6528 7857 696e 646f 7773 293a 0a20 2020  e(xWindows):.   
-00022fb0: 2020 2020 2020 2020 2069 6620 6576 656e           if even
-00022fc0: 742e 7864 6174 6120 3e20 7857 696e 735b  t.xdata > xWins[
-00022fd0: 305d 2061 6e64 2065 7665 6e74 2e78 6461  0] and event.xda
-00022fe0: 7461 203c 2078 5769 6e73 5b31 5d3a 0a20  ta < xWins[1]:. 
-00022ff0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00023000: 696e 4172 7469 7374 7320 3d20 6c69 6e65  inArtists = line
-00023010: 4172 7469 7374 5b69 5d0a 2020 2020 2020  Artist[i].      
-00023020: 2020 2020 2020 2020 2020 7061 7468 4c69            pathLi
-00023030: 7374 2e70 6f70 2869 290a 2020 2020 2020  st.pop(i).      
-00023040: 2020 2020 2020 2020 2020 666f 7220 6a2c            for j,
-00023050: 2061 2069 6e20 656e 756d 6572 6174 6528   a in enumerate(
-00023060: 6c69 6e41 7274 6973 7473 293a 0a20 2020  linArtists):.   
-00023070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023080: 2077 696e 4172 7469 7374 5b69 5d5b 6a5d   winArtist[i][j]
-00023090: 2e72 656d 6f76 6528 2923 2e70 6f70 2869  .remove()#.pop(i
-000230a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000230b0: 2020 2020 2020 6c69 6e65 4172 7469 7374        lineArtist
-000230c0: 5b69 5d5b 6a5d 5b30 5d2e 7265 6d6f 7665  [i][j][0].remove
-000230d0: 2829 232e 706f 7028 6929 235b 695d 2e70  ()#.pop(i)#[i].p
-000230e0: 6f70 286a 290a 2020 2020 2020 2020 2020  op(j).          
-000230f0: 2020 2020 2020 2020 2020 6c69 6e65 4172            lineAr
-00023100: 7469 7374 5b69 5d5b 6a5d 5b31 5d2e 7265  tist[i][j][1].re
-00023110: 6d6f 7665 2829 0a20 2020 2020 2020 2020  move().         
-00023120: 2020 2020 2020 2077 696e 646f 7744 7261         windowDra
-00023130: 776e 2e70 6f70 2869 290a 2020 2020 2020  wn.pop(i).      
-00023140: 2020 2020 2020 2020 2020 6c69 6e65 4172            lineAr
-00023150: 7469 7374 2e70 6f70 2869 2923 5b69 5d2e  tist.pop(i)#[i].
-00023160: 706f 7028 6a29 0a20 2020 2020 2020 2020  pop(j).         
-00023170: 2020 2020 2020 2077 696e 4172 7469 7374         winArtist
-00023180: 2e70 6f70 2869 2923 5b69 5d2e 706f 7028  .pop(i)#[i].pop(
-00023190: 6a29 0a20 2020 2020 2020 2020 2020 2020  j).             
-000231a0: 2020 2078 5769 6e64 6f77 732e 706f 7028     xWindows.pop(
-000231b0: 6929 0a20 2020 2066 6967 2e63 616e 7661  i).    fig.canva
-000231c0: 732e 6472 6177 2829 200a 0a23 4865 6c70  s.draw() ..#Help
-000231d0: 6572 2066 756e 6374 696f 6e20 666f 7220  er function for 
-000231e0: 7570 6461 7469 6e67 2074 6865 2063 616e  updating the can
-000231f0: 7661 7320 616e 6420 6472 6177 696e 672f  vas and drawing/
-00023200: 6465 6c65 7465 6420 7468 6520 626f 7865  deleted the boxe
-00023210: 730a 6465 6620 5f5f 6472 6177 5f77 696e  s.def __draw_win
-00023220: 646f 7773 2865 7665 6e74 2c20 7061 7468  dows(event, path
-00023230: 6c69 7374 2c20 6178 5f6b 6579 2c20 7769  list, ax_key, wi
-00023240: 6e64 6f77 4472 6177 6e2c 2077 696e 4172  ndowDrawn, winAr
-00023250: 7469 7374 2c20 7857 696e 646f 7773 2c20  tist, xWindows, 
-00023260: 6669 672c 2061 7829 3a0a 2020 2020 2222  fig, ax):.    ""
-00023270: 2248 656c 7065 7220 6675 6e63 7469 6f6e  "Helper function
-00023280: 2066 6f72 2075 7064 6174 696e 6720 7468   for updating th
-00023290: 6520 6361 6e76 6173 2061 6e64 2064 7261  e canvas and dra
-000232a0: 7769 6e67 2f64 656c 6574 6564 2074 6865  wing/deleted the
-000232b0: 2062 6f78 6573 2222 220a 2020 2020 666f   boxes""".    fo
-000232c0: 7220 692c 2070 6120 696e 2065 6e75 6d65  r i, pa in enume
-000232d0: 7261 7465 2870 6174 686c 6973 7429 3a0a  rate(pathlist):.
-000232e0: 2020 2020 2020 2020 666f 7220 6a2c 2070          for j, p
-000232f0: 2069 6e20 656e 756d 6572 6174 6528 7061   in enumerate(pa
-00023300: 293a 200a 2020 2020 2020 2020 2020 2020  ): .            
-00023310: 6966 2077 696e 646f 7744 7261 776e 5b69  if windowDrawn[i
-00023320: 5d5b 6a5d 3a0a 2020 2020 2020 2020 2020  ][j]:.          
-00023330: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-00023340: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00023350: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-00023360: 6368 203d 206d 6174 706c 6f74 6c69 622e  ch = matplotlib.
-00023370: 7061 7463 6865 732e 5061 7468 5061 7463  patches.PathPatc
-00023380: 6828 702c 2066 6163 6563 6f6c 6f72 3d27  h(p, facecolor='
-00023390: 6b27 2c20 616c 7068 613d 302e 3735 2920  k', alpha=0.75) 
-000233a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000233b0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-000233c0: 2020 2020 2020 2020 2020 2020 7769 6e41              winA
-000233d0: 7274 203d 2061 785b 6178 5f6b 6579 5d2e  rt = ax[ax_key].
-000233e0: 6164 645f 7061 7463 6828 7061 7463 6829  add_patch(patch)
-000233f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023400: 2077 696e 646f 7744 7261 776e 5b69 5d5b   windowDrawn[i][
-00023410: 6a5d 203d 2054 7275 650a 2020 2020 2020  j] = True.      
-00023420: 2020 2020 2020 2020 2020 7769 6e41 7274            winArt
-00023430: 6973 745b 695d 5b6a 5d20 3d20 7769 6e41  ist[i][j] = winA
-00023440: 7274 0a0a 2020 2020 6966 2065 7665 6e74  rt..    if event
-00023450: 2e62 7574 746f 6e20 6973 204d 6f75 7365  .button is Mouse
-00023460: 4275 7474 6f6e 2e52 4947 4854 3a0a 2020  Button.RIGHT:.  
-00023470: 2020 2020 2020 6669 672e 6361 6e76 6173        fig.canvas
-00023480: 2e64 7261 7728 290a 0a23 4865 6c70 6572  .draw()..#Helper
-00023490: 2066 756e 6374 696f 6e20 666f 7220 6765   function for ge
-000234a0: 7474 696e 6720 636c 6963 6b20 6576 656e  tting click even
-000234b0: 7420 696e 666f 726d 6174 696f 6e0a 6465  t information.de
-000234c0: 6620 5f5f 6f6e 5f63 6c69 636b 2865 7665  f __on_click(eve
-000234d0: 6e74 293a 0a20 2020 2022 2222 4865 6c70  nt):.    """Help
-000234e0: 6572 2066 756e 6374 696f 6e20 666f 7220  er function for 
-000234f0: 6765 7474 696e 6720 636c 6963 6b20 6576  getting click ev
-00023500: 656e 7420 696e 666f 726d 6174 696f 6e22  ent information"
-00023510: 2222 0a20 2020 2067 6c6f 6261 6c20 636c  "".    global cl
-00023520: 6963 6b4e 6f0a 2020 2020 676c 6f62 616c  ickNo.    global
-00023530: 2078 300a 2020 2020 6966 2065 7665 6e74   x0.    if event
-00023540: 2e62 7574 746f 6e20 6973 204d 6f75 7365  .button is Mouse
-00023550: 4275 7474 6f6e 2e52 4947 4854 3a0a 2020  Button.RIGHT:.  
-00023560: 2020 2020 2020 5f5f 7265 6d6f 7665 5f6f        __remove_o
-00023570: 6e5f 7269 6768 7428 6576 656e 742c 2078  n_right(event, x
-00023580: 5769 6e64 6f77 732c 2070 6174 684c 6973  Windows, pathLis
-00023590: 742c 2077 696e 646f 7744 7261 776e 2c20  t, windowDrawn, 
-000235a0: 7769 6e41 7274 6973 742c 206c 696e 6541  winArtist, lineA
-000235b0: 7274 6973 742c 2066 6967 2c20 6178 290a  rtist, fig, ax).
-000235c0: 0a20 2020 2069 6620 6576 656e 742e 6275  .    if event.bu
-000235d0: 7474 6f6e 2069 7320 4d6f 7573 6542 7574  tton is MouseBut
-000235e0: 746f 6e2e 4c45 4654 3a20 2020 2020 2020  ton.LEFT:       
-000235f0: 2020 2020 200a 2020 2020 2020 2020 636c       .        cl
-00023600: 6963 6b4e 6f2c 2078 3020 3d20 5f5f 6472  ickNo, x0 = __dr
-00023610: 6177 5f62 6f78 6573 2865 7665 6e74 2c20  aw_boxes(event, 
-00023620: 636c 6963 6b4e 6f2c 2078 5769 6e64 6f77  clickNo, xWindow
-00023630: 732c 2070 6174 684c 6973 742c 2077 696e  s, pathList, win
-00023640: 646f 7744 7261 776e 2c20 7769 6e41 7274  dowDrawn, winArt
-00023650: 6973 742c 206c 696e 6541 7274 6973 742c  ist, lineArtist,
-00023660: 2078 302c 2066 6967 2c20 6178 2920 2020   x0, fig, ax)   
-00023670: 200a 0a23 5175 616c 6974 7920 6368 6563   ..#Quality chec
-00023680: 6b73 2c20 7374 6162 696c 6974 7920 7465  ks, stability te
-00023690: 7374 732c 2063 6c61 7269 7479 2074 6573  sts, clarity tes
-000236a0: 7473 0a23 6465 6620 6368 6563 6b5f 7065  ts.#def check_pe
-000236b0: 616b 7328 6876 7372 2c20 782c 2079 2c20  aks(hvsr, x, y, 
-000236c0: 696e 6465 785f 6c69 7374 2c20 7065 616b  index_list, peak
-000236d0: 2c20 7065 616b 6d2c 2070 6561 6b70 2c20  , peakm, peakp, 
-000236e0: 6876 7372 5f70 6561 6b73 2c20 7374 6466  hvsr_peaks, stdf
-000236f0: 2c20 6876 7372 5f6c 6f67 5f73 7464 2c20  , hvsr_log_std, 
-00023700: 7261 6e6b 2c20 6876 7372 5f62 616e 643d  rank, hvsr_band=
-00023710: 5b30 2e34 2c20 3430 5d2c 2070 6561 6b5f  [0.4, 40], peak_
-00023720: 7761 7465 725f 6c65 7665 6c3d 312e 382c  water_level=1.8,
-00023730: 2064 6f5f 7261 6e6b 3d46 616c 7365 293a   do_rank=False):
-00023740: 0a64 6566 2063 6865 636b 5f70 6561 6b73  .def check_peaks
-00023750: 2868 7673 725f 6469 6374 2c20 6876 7372  (hvsr_dict, hvsr
-00023760: 5f62 616e 643d 5b30 2e34 2c20 3430 5d2c  _band=[0.4, 40],
-00023770: 2070 6561 6b5f 7761 7465 725f 6c65 7665   peak_water_leve
-00023780: 6c3d 312e 3829 3a0a 2020 2020 2222 2246  l=1.8):.    """F
-00023790: 756e 6374 696f 6e20 746f 2072 756e 2074  unction to run t
-000237a0: 6573 7473 206f 6e20 4856 5352 2070 6561  ests on HVSR pea
-000237b0: 6b73 2074 6f20 6669 6e64 2062 6573 7420  ks to find best 
-000237c0: 6f6e 6520 616e 6420 7365 6520 6966 2069  one and see if i
-000237d0: 7420 7061 7373 6573 2071 7561 6c69 7479  t passes quality
-000237e0: 2063 6865 636b 730a 0a20 2020 2020 2020   checks..       
-000237f0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00023800: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00023810: 2020 2020 2020 2068 7673 725f 6469 6374         hvsr_dict
-00023820: 203a 2064 6963 740a 2020 2020 2020 2020   : dict.        
-00023830: 2020 2020 4469 6374 696f 6e61 7279 2063      Dictionary c
-00023840: 6f6e 7461 696e 696e 6720 616c 6c20 7468  ontaining all th
-00023850: 6520 6361 6c63 756c 6174 6564 2069 6e66  e calculated inf
-00023860: 6f72 6d61 7469 6f6e 2061 626f 7574 2074  ormation about t
-00023870: 6865 2048 5653 5220 6461 7461 2028 692e  he HVSR data (i.
-00023880: 652e 2c20 6876 7372 5f6f 7574 2072 6574  e., hvsr_out ret
-00023890: 7572 6e65 6420 6672 6f6d 2070 726f 6365  urned from proce
-000238a0: 7373 5f68 7673 7229 0a20 2020 2020 2020  ss_hvsr).       
-000238b0: 2068 7673 725f 6261 6e64 2020 3a20 7475   hvsr_band  : tu
-000238c0: 706c 6520 6f72 206c 6973 742c 2064 6566  ple or list, def
-000238d0: 6175 6c74 3d5b 302e 342c 2034 305d 0a20  ault=[0.4, 40]. 
-000238e0: 2020 2020 2020 2020 2020 2032 2d69 7465             2-ite
-000238f0: 6d20 7475 706c 6520 6f72 206c 6973 7420  m tuple or list 
-00023900: 7769 7468 206c 6f77 6572 2061 6e64 2075  with lower and u
-00023910: 7070 6572 206c 696d 6974 206f 6620 6672  pper limit of fr
-00023920: 6571 7565 6e63 6965 7320 746f 2061 6e61  equencies to ana
-00023930: 6c79 7a65 0a20 2020 2020 2020 2070 6561  lyze.        pea
-00023940: 6b5f 7761 7465 725f 6c65 7665 6c3a 2066  k_water_level: f
-00023950: 6c6f 6174 2c20 6465 6661 756c 743d 312e  loat, default=1.
-00023960: 380a 2020 2020 2020 2020 2020 2020 5661  8.            Va
-00023970: 6c75 6520 6f66 2070 6561 6b20 7761 7465  lue of peak wate
-00023980: 7220 6c65 7665 6c0a 0a20 2020 2020 2020  r level..       
-00023990: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-000239a0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-000239b0: 2068 7673 725f 6469 6374 2020 203a 2064   hvsr_dict   : d
-000239c0: 6963 740a 2020 2020 2020 2020 2020 2020  ict.            
-000239d0: 4469 6374 696f 6e61 7279 2063 6f6e 7461  Dictionary conta
-000239e0: 696e 696e 6720 7072 6576 696f 7573 2069  ining previous i
-000239f0: 6e70 7574 2064 6174 612c 2070 6c75 7320  nput data, plus 
-00023a00: 696e 666f 726d 6174 696f 6e20 6162 6f75  information abou
-00023a10: 7420 5065 616b 2074 6573 7473 0a20 2020  t Peak tests.   
-00023a20: 2022 2222 0a0a 2020 2020 6966 206e 6f74   """..    if not
-00023a30: 2068 7673 725f 6261 6e64 3a0a 2020 2020   hvsr_band:.    
-00023a40: 2020 2020 6876 7372 5f62 616e 6420 3d20      hvsr_band = 
-00023a50: 5b30 2e34 2c34 305d 0a20 2020 2068 7673  [0.4,40].    hvs
-00023a60: 725f 6469 6374 5b27 6876 7372 5f62 616e  r_dict['hvsr_ban
-00023a70: 6427 5d20 3d20 6876 7372 5f62 616e 640a  d'] = hvsr_band.
-00023a80: 0a20 2020 2061 6e79 4b20 3d20 6c69 7374  .    anyK = list
-00023a90: 2868 7673 725f 6469 6374 5b27 785f 6672  (hvsr_dict['x_fr
-00023aa0: 6571 7327 5d2e 6b65 7973 2829 295b 305d  eqs'].keys())[0]
-00023ab0: 0a20 2020 2078 203d 2068 7673 725f 6469  .    x = hvsr_di
-00023ac0: 6374 5b27 785f 6672 6571 7327 5d5b 616e  ct['x_freqs'][an
-00023ad0: 794b 5d0a 2020 2020 7920 3d20 6876 7372  yK].    y = hvsr
-00023ae0: 5f64 6963 745b 2768 7673 725f 6375 7276  _dict['hvsr_curv
-00023af0: 6527 5d0a 2020 2020 696e 6465 785f 6c69  e'].    index_li
-00023b00: 7374 203d 2068 7673 725f 6469 6374 5b27  st = hvsr_dict['
-00023b10: 6876 7372 5f70 6561 6b5f 696e 6469 6365  hvsr_peak_indice
-00023b20: 7327 5d0a 2020 2020 7065 616b 5f77 6174  s'].    peak_wat
-00023b30: 6572 5f6c 6576 656c 2020 3d20 6876 7372  er_level  = hvsr
-00023b40: 5f64 6963 745b 2770 6561 6b5f 7761 7465  _dict['peak_wate
-00023b50: 725f 6c65 7665 6c27 5d0a 2020 2020 6876  r_level'].    hv
-00023b60: 7372 7020 3d20 6876 7372 5f64 6963 745b  srp = hvsr_dict[
-00023b70: 2768 7673 7270 275d 0a20 2020 2070 6561  'hvsrp'].    pea
-00023b80: 6b5f 7761 7465 725f 6c65 7665 6c5f 7020  k_water_level_p 
-00023b90: 203d 2068 7673 725f 6469 6374 5b27 7065   = hvsr_dict['pe
-00023ba0: 616b 5f77 6174 6572 5f6c 6576 656c 5f70  ak_water_level_p
-00023bb0: 275d 0a20 2020 2068 7673 726d 203d 2068  '].    hvsrm = h
-00023bc0: 7673 725f 6469 6374 5b27 6876 7372 6d27  vsr_dict['hvsrm'
-00023bd0: 5d0a 2020 2020 6876 7372 5065 616b 7320  ].    hvsrPeaks 
-00023be0: 3d20 6876 7372 5f64 6963 745b 2769 6e64  = hvsr_dict['ind
-00023bf0: 5f68 7673 725f 7065 616b 5f69 6e64 6963  _hvsr_peak_indic
-00023c00: 6573 275d 0a20 2020 2068 7673 725f 6c6f  es'].    hvsr_lo
-00023c10: 675f 7374 6420 3d20 6876 7372 5f64 6963  g_std = hvsr_dic
-00023c20: 745b 2768 7673 725f 6c6f 675f 7374 6427  t['hvsr_log_std'
-00023c30: 5d0a 0a20 2020 2023 446f 2066 6f72 2068  ]..    #Do for h
-00023c40: 7673 720a 2020 2020 7065 616b 203d 205f  vsr.    peak = _
-00023c50: 5f69 6e69 745f 7065 616b 7328 782c 2079  _init_peaks(x, y
-00023c60: 2c20 696e 6465 785f 6c69 7374 2c20 6876  , index_list, hv
-00023c70: 7372 5f62 616e 642c 2070 6561 6b5f 7761  sr_band, peak_wa
-00023c80: 7465 725f 6c65 7665 6c29 0a0a 2020 2020  ter_level)..    
-00023c90: 7065 616b 203d 205f 5f63 6865 636b 5f63  peak = __check_c
-00023ca0: 7572 7665 5f72 656c 6961 6269 6c69 7479  urve_reliability
-00023cb0: 2868 7673 725f 6469 6374 2c20 7065 616b  (hvsr_dict, peak
-00023cc0: 290a 2020 2020 7065 616b 203d 205f 5f63  ).    peak = __c
-00023cd0: 6865 636b 5f63 6c61 7269 7479 2878 2c20  heck_clarity(x, 
-00023ce0: 792c 2070 6561 6b2c 2064 6f5f 7261 6e6b  y, peak, do_rank
-00023cf0: 3d54 7275 6529 0a0a 2020 2020 2344 6f20  =True)..    #Do 
-00023d00: 666f 7220 6876 7372 700a 2020 2020 2320  for hvsrp.    # 
-00023d10: 4669 6e64 2020 7468 6520 7265 6c61 7469  Find  the relati
-00023d20: 7665 2065 7874 7265 6d61 206f 6620 6876  ve extrema of hv
-00023d30: 7372 7020 2868 7673 7220 2b20 3120 7374  srp (hvsr + 1 st
-00023d40: 616e 6461 7264 2064 6576 6961 7469 6f6e  andard deviation
-00023d50: 290a 2020 2020 6966 206e 6f74 206e 702e  ).    if not np.
-00023d60: 6973 6e61 6e28 6e70 2e73 756d 2868 7673  isnan(np.sum(hvs
-00023d70: 7270 2929 3a0a 2020 2020 2020 2020 696e  rp)):.        in
-00023d80: 6465 785f 7020 3d20 5f5f 6669 6e64 5f70  dex_p = __find_p
-00023d90: 6561 6b73 2868 7673 7270 290a 2020 2020  eaks(hvsrp).    
-00023da0: 656c 7365 3a0a 2020 2020 2020 2020 696e  else:.        in
-00023db0: 6465 785f 7020 3d20 6c69 7374 2829 0a0a  dex_p = list()..
-00023dc0: 2020 2020 7065 616b 7020 3d20 5f5f 696e      peakp = __in
-00023dd0: 6974 5f70 6561 6b73 2878 2c20 6876 7372  it_peaks(x, hvsr
-00023de0: 702c 2069 6e64 6578 5f70 2c20 6876 7372  p, index_p, hvsr
-00023df0: 5f62 616e 642c 2070 6561 6b5f 7761 7465  _band, peak_wate
-00023e00: 725f 6c65 7665 6c5f 7029 0a20 2020 2070  r_level_p).    p
-00023e10: 6561 6b70 203d 205f 5f63 6865 636b 5f63  eakp = __check_c
-00023e20: 6c61 7269 7479 2878 2c20 6876 7372 702c  larity(x, hvsrp,
-00023e30: 2070 6561 6b70 2c20 646f 5f72 616e 6b3d   peakp, do_rank=
-00023e40: 5472 7565 290a 0a20 2020 2023 446f 2066  True)..    #Do f
-00023e50: 6f72 2068 7673 726d 0a20 2020 2023 2046  or hvsrm.    # F
-00023e60: 696e 6420 2074 6865 2072 656c 6174 6976  ind  the relativ
-00023e70: 6520 6578 7472 656d 6120 6f66 2068 7673  e extrema of hvs
-00023e80: 726d 2028 6876 7372 202d 2031 2073 7461  rm (hvsr - 1 sta
-00023e90: 6e64 6172 6420 6465 7669 6174 696f 6e29  ndard deviation)
-00023ea0: 0a20 2020 2069 6620 6e6f 7420 6e70 2e69  .    if not np.i
-00023eb0: 736e 616e 286e 702e 7375 6d28 6876 7372  snan(np.sum(hvsr
-00023ec0: 6d29 293a 0a20 2020 2020 2020 2069 6e64  m)):.        ind
-00023ed0: 6578 5f6d 203d 205f 5f66 696e 645f 7065  ex_m = __find_pe
-00023ee0: 616b 7328 6876 7372 6d29 0a20 2020 2065  aks(hvsrm).    e
-00023ef0: 6c73 653a 0a20 2020 2020 2020 2069 6e64  lse:.        ind
-00023f00: 6578 5f6d 203d 206c 6973 7428 290a 0a20  ex_m = list().. 
-00023f10: 2020 2070 6561 6b5f 7761 7465 725f 6c65     peak_water_le
-00023f20: 7665 6c5f 6d20 203d 2068 7673 725f 6469  vel_m  = hvsr_di
-00023f30: 6374 5b27 7065 616b 5f77 6174 6572 5f6c  ct['peak_water_l
-00023f40: 6576 656c 5f6d 275d 0a0a 2020 2020 7065  evel_m']..    pe
-00023f50: 616b 6d20 3d20 5f5f 696e 6974 5f70 6561  akm = __init_pea
-00023f60: 6b73 2878 2c20 6876 7372 6d2c 2069 6e64  ks(x, hvsrm, ind
-00023f70: 6578 5f6d 2c20 6876 7372 5f62 616e 642c  ex_m, hvsr_band,
-00023f80: 2070 6561 6b5f 7761 7465 725f 6c65 7665   peak_water_leve
-00023f90: 6c5f 6d29 0a20 2020 2070 6561 6b6d 203d  l_m).    peakm =
-00023fa0: 205f 5f63 6865 636b 5f63 6c61 7269 7479   __check_clarity
-00023fb0: 2878 2c20 6876 7372 6d2c 2070 6561 6b6d  (x, hvsrm, peakm
-00023fc0: 2c20 646f 5f72 616e 6b3d 5472 7565 290a  , do_rank=True).
-00023fd0: 0a20 2020 2073 7464 6620 3d20 5f5f 6765  .    stdf = __ge
-00023fe0: 745f 7374 6466 2878 2c20 696e 6465 785f  t_stdf(x, index_
-00023ff0: 6c69 7374 2c20 6876 7372 5065 616b 7329  list, hvsrPeaks)
-00024000: 0a0a 2020 2020 7065 616b 203d 205f 5f63  ..    peak = __c
-00024010: 6865 636b 5f66 7265 715f 7374 6162 696c  heck_freq_stabil
-00024020: 6974 7928 7065 616b 2c20 7065 616b 6d2c  ity(peak, peakm,
-00024030: 2070 6561 6b70 290a 2020 2020 7065 616b   peakp).    peak
-00024040: 203d 205f 5f63 6865 636b 5f73 7461 6269   = __check_stabi
-00024050: 6c69 7479 2873 7464 662c 2070 6561 6b2c  lity(stdf, peak,
-00024060: 2068 7673 725f 6c6f 675f 7374 642c 2072   hvsr_log_std, r
-00024070: 616e 6b3d 5472 7565 290a 0a20 2020 2068  ank=True)..    h
-00024080: 7673 725f 6469 6374 5b27 5065 616b 2052  vsr_dict['Peak R
-00024090: 6570 6f72 7427 5d20 3d20 7065 616b 0a0a  eport'] = peak..
-000240a0: 2020 2020 2349 7465 7261 7465 2074 6872      #Iterate thr
-000240b0: 6f75 6768 2070 6561 6b73 2061 6e64 200a  ough peaks and .
-000240c0: 2020 2020 2320 2020 4765 7420 7468 6520      #   Get the 
-000240d0: 6265 7374 2070 6561 6b20 6261 7365 6420  best peak based 
-000240e0: 6f6e 2074 6865 2070 6561 6b20 7363 6f72  on the peak scor
-000240f0: 650a 2020 2020 2320 2020 4361 6c63 756c  e.    #   Calcul
-00024100: 6174 6520 7768 6574 6865 7220 6561 6368  ate whether each
-00024110: 2070 6561 6b20 7061 7373 6573 2065 6e6f   peak passes eno
-00024120: 7567 6820 7465 7374 730a 2020 2020 6375  ugh tests.    cu
-00024130: 7276 6554 6573 7473 203d 205b 2757 696e  rveTests = ['Win
-00024140: 646f 7720 4c65 6e67 7468 2046 7265 712e  dow Length Freq.
-00024150: 272c 2753 6967 6e69 6669 6361 6e74 2043  ','Significant C
-00024160: 7963 6c65 7327 2c20 274c 6f77 2043 7572  ycles', 'Low Cur
-00024170: 7665 2053 7444 6576 2e20 6f76 6572 2074  ve StDev. over t
-00024180: 696d 6527 5d0a 2020 2020 7065 616b 5465  ime'].    peakTe
-00024190: 7374 7320 3d20 5b27 5065 616b 2046 7265  sts = ['Peak Fre
-000241a0: 712e 2043 6c61 7269 7479 2042 656c 6f77  q. Clarity Below
-000241b0: 272c 2027 5065 616b 2046 7265 712e 2043  ', 'Peak Freq. C
-000241c0: 6c61 7269 7479 2041 626f 7665 272c 2027  larity Above', '
-000241d0: 5065 616b 2041 6d70 2e20 436c 6172 6974  Peak Amp. Clarit
-000241e0: 7927 2c20 2746 7265 712e 2053 7461 6269  y', 'Freq. Stabi
-000241f0: 6c69 7479 272c 2027 5065 616b 2053 7461  lity', 'Peak Sta
-00024200: 6269 6c69 7479 2028 6672 6571 2e20 7374  bility (freq. st
-00024210: 6429 272c 2027 5065 616b 2053 7461 6269  d)', 'Peak Stabi
-00024220: 6c69 7479 2028 616d 702e 2073 7464 2927  lity (amp. std)'
-00024230: 5d0a 2020 2020 6265 7374 5065 616b 5363  ].    bestPeakSc
-00024240: 6f72 6520 3d20 300a 2020 2020 666f 7220  ore = 0.    for 
-00024250: 7020 696e 2068 7673 725f 6469 6374 5b27  p in hvsr_dict['
-00024260: 5065 616b 2052 6570 6f72 7427 5d3a 0a20  Peak Report']:. 
-00024270: 2020 2020 2020 2023 4765 7420 6265 7374         #Get best
-00024280: 2070 6561 6b0a 2020 2020 2020 2020 6966   peak.        if
-00024290: 2070 5b27 5363 6f72 6527 5d20 3e20 6265   p['Score'] > be
-000242a0: 7374 5065 616b 5363 6f72 653a 0a20 2020  stPeakScore:.   
-000242b0: 2020 2020 2020 2020 2062 6573 7450 6561           bestPea
-000242c0: 6b53 636f 7265 203d 2070 5b27 5363 6f72  kScore = p['Scor
-000242d0: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
-000242e0: 6265 7374 5065 616b 203d 2070 0a0a 2020  bestPeak = p..  
-000242f0: 2020 2020 2020 2343 616c 6375 6c61 7465        #Calculate
-00024300: 2069 6620 7065 616b 2070 6173 7365 7320   if peak passes 
-00024310: 6372 6974 6572 6961 0a20 2020 2020 2020  criteria.       
-00024320: 2063 5465 7374 7350 6173 7320 3d20 300a   cTestsPass = 0.
-00024330: 2020 2020 2020 2020 7054 6573 7473 5061          pTestsPa
-00024340: 7373 203d 2030 0a20 2020 2020 2020 2066  ss = 0.        f
-00024350: 6f72 2074 6573 744e 616d 6520 696e 2070  or testName in p
-00024360: 5b27 5061 7373 204c 6973 7427 5d2e 6b65  ['Pass List'].ke
-00024370: 7973 2829 3a0a 2020 2020 2020 2020 2020  ys():.          
-00024380: 2020 6966 2074 6573 744e 616d 6520 696e    if testName in
-00024390: 2063 7572 7665 5465 7374 733a 0a20 2020   curveTests:.   
-000243a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000243b0: 705b 2750 6173 7320 4c69 7374 275d 5b74  p['Pass List'][t
-000243c0: 6573 744e 616d 655d 3a0a 2020 2020 2020  estName]:.      
-000243d0: 2020 2020 2020 2020 2020 2020 2020 6354                cT
-000243e0: 6573 7473 5061 7373 202b 3d20 310a 2020  estsPass += 1.  
-000243f0: 2020 2020 2020 2020 2020 656c 6966 2074            elif t
-00024400: 6573 744e 616d 6520 696e 2070 6561 6b54  estName in peakT
-00024410: 6573 7473 3a0a 2020 2020 2020 2020 2020  ests:.          
-00024420: 2020 2020 2020 6966 2070 5b27 5061 7373        if p['Pass
-00024430: 204c 6973 7427 5d5b 7465 7374 4e61 6d65   List'][testName
-00024440: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00024450: 2020 2020 2020 2070 5465 7374 7350 6173         pTestsPas
-00024460: 7320 2b3d 2031 0a0a 2020 2020 2020 2020  s += 1..        
-00024470: 6966 2063 5465 7374 7350 6173 7320 3d3d  if cTestsPass ==
-00024480: 2033 2061 6e64 2070 5465 7374 7350 6173   3 and pTestsPas
-00024490: 7320 3e3d 2035 3a0a 2020 2020 2020 2020  s >= 5:.        
-000244a0: 2020 2020 705b 2750 6561 6b20 5061 7373      p['Peak Pass
-000244b0: 6573 275d 203d 2054 7275 650a 2020 2020  es'] = True.    
-000244c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000244d0: 2020 2020 2020 705b 2750 6561 6b20 5061        p['Peak Pa
-000244e0: 7373 6573 275d 203d 2046 616c 7365 0a20  sses'] = False. 
-000244f0: 2020 2020 2020 200a 2020 2020 2344 6573         .    #Des
-00024500: 6967 6e61 7465 2062 6573 7420 7065 616b  ignate best peak
-00024510: 2069 6e20 6f75 7470 7574 2064 6963 740a   in output dict.
-00024520: 2020 2020 6966 206c 656e 2868 7673 725f      if len(hvsr_
-00024530: 6469 6374 5b27 5065 616b 2052 6570 6f72  dict['Peak Repor
-00024540: 7427 5d29 203d 3d20 303a 0a20 2020 2020  t']) == 0:.     
-00024550: 2020 2062 6573 7450 6561 6b3d 7b7d 0a20     bestPeak={}. 
-00024560: 2020 2020 2020 2070 7269 6e74 2827 4e6f         print('No
-00024570: 2042 6573 7420 5065 616b 2069 6465 6e74   Best Peak ident
-00024580: 6966 6965 6427 290a 0a20 2020 2068 7673  ified')..    hvs
-00024590: 725f 6469 6374 5b27 4265 7374 2050 6561  r_dict['Best Pea
-000245a0: 6b27 5d20 3d20 6265 7374 5065 616b 0a20  k'] = bestPeak. 
-000245b0: 2020 2072 6574 7572 6e20 6876 7372 5f64     return hvsr_d
-000245c0: 6963 740a 0a23 496e 6974 6961 6c69 7a65  ict..#Initialize
-000245d0: 2070 6561 6b73 0a64 6566 205f 5f69 6e69   peaks.def __ini
-000245e0: 745f 7065 616b 7328 5f78 2c20 5f79 2c20  t_peaks(_x, _y, 
-000245f0: 5f69 6e64 6578 5f6c 6973 742c 205f 6876  _index_list, _hv
-00024600: 7372 5f62 616e 642c 205f 7065 616b 5f77  sr_band, _peak_w
-00024610: 6174 6572 5f6c 6576 656c 293a 0a20 2020  ater_level):.   
-00024620: 2022 2222 2049 6e69 7469 616c 697a 6520   """ Initialize 
-00024630: 7065 616b 732e 0a20 2020 2020 2020 200a  peaks..        .
-00024640: 2020 2020 2020 2020 4372 6561 7465 7320          Creates 
-00024650: 6469 6374 696f 6e61 7279 2077 6974 6820  dictionary with 
-00024660: 7265 6c65 7661 6e74 2069 6e66 6f72 6d61  relevant informa
-00024670: 7469 6f6e 2061 6e64 2072 656d 6f76 6573  tion and removes
-00024680: 2070 6561 6b73 2069 6e20 6876 7372 2063   peaks in hvsr c
-00024690: 7572 7665 2074 6861 7420 6172 6520 6e6f  urve that are no
-000246a0: 7420 7265 6c65 7661 6e74 2066 6f72 2064  t relevant for d
-000246b0: 6174 6120 616e 616c 7973 6973 2028 6f75  ata analysis (ou
-000246c0: 7473 6964 6520 4856 5352 5f62 616e 6429  tside HVSR_band)
-000246d0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-000246e0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-000246f0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00024700: 7820 3a20 6c69 7374 2d6c 696b 6520 6f62  x : list-like ob
-00024710: 6a20 0a20 2020 2020 2020 2020 2020 204c  j .            L
-00024720: 6973 7420 7769 7468 2078 2d76 616c 7565  ist with x-value
-00024730: 7320 2866 7265 7175 656e 6379 206f 7220  s (frequency or 
-00024740: 7065 7269 6f64 2076 616c 7565 7329 0a20  period values). 
-00024750: 2020 2020 2020 2079 203a 206c 6973 742d         y : list-
-00024760: 6c69 6b65 206f 626a 200a 2020 2020 2020  like obj .      
-00024770: 2020 2020 2020 4c69 7374 2077 6974 6820        List with 
-00024780: 6876 7372 2063 7572 7665 2076 616c 7565  hvsr curve value
-00024790: 730a 2020 2020 2020 2020 696e 6465 785f  s.        index_
-000247a0: 6c69 7374 203a 206c 6973 7420 6f72 2061  list : list or a
-000247b0: 7272 6179 5f6c 696b 6520 0a20 2020 2020  rray_like .     
-000247c0: 2020 2020 2020 204c 6973 7420 7769 7468         List with
-000247d0: 2069 6e64 6963 6573 206f 6620 7065 616b   indices of peak
-000247e0: 730a 2020 2020 2020 2020 5f68 7673 725f  s.        _hvsr_
-000247f0: 6261 6e64 203a 206c 6973 740a 2020 2020  band : list.    
-00024800: 2020 2020 2020 2020 5477 6f2d 6974 656d          Two-item
-00024810: 206c 6973 7420 7769 7468 206c 6f77 2061   list with low a
-00024820: 6e64 2068 6967 6820 6672 6571 7565 6e63  nd high frequenc
-00024830: 7920 746f 206c 696d 6974 2061 7373 6573  y to limit asses
-00024840: 736d 656e 7420 6578 7465 6e74 0a20 2020  sment extent.   
-00024850: 2020 2020 205f 7065 616b 5f77 6174 6572       _peak_water
-00024860: 5f6c 6576 656c 203a 2066 6c6f 6174 0a20  _level : float. 
-00024870: 2020 2020 2020 2020 2020 2050 6561 6b20             Peak 
-00024880: 7761 7465 7220 6c65 7665 6c20 7661 6c75  water level valu
-00024890: 650a 2020 2020 2020 2020 0a20 2020 2020  e.        .     
-000248a0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-000248b0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-000248c0: 2020 205f 7065 616b 2020 2020 2020 2020     _peak        
-000248d0: 2020 2020 2020 203a 206c 6973 7420 0a20         : list . 
-000248e0: 2020 2020 2020 2020 2020 204c 6973 7420             List 
-000248f0: 6f66 2064 6963 7469 6f6e 6172 6965 732c  of dictionaries,
-00024900: 206f 6e65 2066 6f72 2065 6163 6820 696e   one for each in
-00024910: 7075 7420 7065 616b 0a20 2020 2022 2222  put peak.    """
-00024920: 0a20 2020 205f 7065 616b 203d 206c 6973  .    _peak = lis
-00024930: 7428 290a 2020 2020 666f 7220 5f69 2069  t().    for _i i
-00024940: 6e20 5f69 6e64 6578 5f6c 6973 743a 0a20  n _index_list:. 
-00024950: 2020 2020 2020 2069 6620 5f79 5b5f 695d         if _y[_i]
-00024960: 203e 205f 7065 616b 5f77 6174 6572 5f6c   > _peak_water_l
-00024970: 6576 656c 5b30 5d20 616e 6420 285f 6876  evel[0] and (_hv
-00024980: 7372 5f62 616e 645b 305d 203c 3d20 5f78  sr_band[0] <= _x
-00024990: 5b5f 695d 203c 3d20 5f68 7673 725f 6261  [_i] <= _hvsr_ba
-000249a0: 6e64 5b31 5d29 3a0a 2020 2020 2020 2020  nd[1]):.        
-000249b0: 2020 2020 5f70 6561 6b2e 6170 7065 6e64      _peak.append
-000249c0: 287b 2766 3027 3a20 666c 6f61 7428 5f78  ({'f0': float(_x
-000249d0: 5b5f 695d 292c 2027 4130 273a 2066 6c6f  [_i]), 'A0': flo
-000249e0: 6174 285f 795b 5f69 5d29 2c20 0a20 2020  at(_y[_i]), .   
-000249f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024a00: 2020 2020 2020 2027 662d 273a 204e 6f6e         'f-': Non
-00024a10: 652c 2027 662b 273a 204e 6f6e 652c 2027  e, 'f+': None, '
-00024a20: 5366 273a 204e 6f6e 652c 2027 5361 273a  Sf': None, 'Sa':
-00024a30: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-00024a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024a50: 2027 5363 6f72 6527 3a20 302c 200a 2020   'Score': 0, .  
-00024a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024a70: 2020 2020 2020 2020 2752 6570 6f72 7427          'Report'
-00024a80: 3a20 7b27 4c77 273a 2727 2c20 274e 6327  : {'Lw':'', 'Nc'
-00024a90: 3a27 272c 2027 cf83 5f41 2866 2927 3a27  :'', '.._A(f)':'
-00024aa0: 272c 2027 4128 662d 2927 3a27 272c 2027  ', 'A(f-)':'', '
-00024ab0: 4128 662b 2927 3a27 272c 2027 4130 273a  A(f+)':'', 'A0':
-00024ac0: 2027 272c 2027 502b 273a 2027 272c 2027   '', 'P+': '', '
-00024ad0: 502d 273a 2027 272c 2027 5366 273a 2027  P-': '', 'Sf': '
-00024ae0: 272c 2027 5361 273a 2027 277d 2c0a 2020  ', 'Sa': ''},.  
-00024af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024b00: 2020 2020 2020 2020 2750 6173 7320 4c69          'Pass Li
-00024b10: 7374 273a 7b7d 2c0a 2020 2020 2020 2020  st':{},.        
-00024b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024b30: 2020 2750 6561 6b20 5061 7373 6573 273a    'Peak Passes':
-00024b40: 4661 6c73 657d 290a 2020 2020 7265 7475  False}).    retu
-00024b50: 726e 205f 7065 616b 0a0a 2343 6865 636b  rn _peak..#Check
-00024b60: 2072 656c 6961 6269 6c69 7479 206f 6620   reliability of 
-00024b70: 4856 5352 206f 6620 6375 7276 650a 6465  HVSR of curve.de
-00024b80: 6620 5f5f 6368 6563 6b5f 6375 7276 655f  f __check_curve_
-00024b90: 7265 6c69 6162 696c 6974 7928 6876 7372  reliability(hvsr
-00024ba0: 5f64 6963 742c 205f 7065 616b 293a 0a20  _dict, _peak):. 
-00024bb0: 2020 2022 2222 5465 7374 7320 746f 2063     """Tests to c
-00024bc0: 6865 636b 2066 6f72 2072 656c 6961 626c  heck for reliabl
-00024bd0: 6520 482f 5620 6375 7276 650a 0a20 2020  e H/V curve..   
-00024be0: 2054 6573 7473 2069 6e63 6c75 6465 3a0a   Tests include:.
-00024bf0: 2020 2020 2020 2020 3129 2050 6561 6b20          1) Peak 
-00024c00: 6672 6571 7565 6e63 7920 6973 2067 7265  frequency is gre
-00024c10: 6174 6572 2074 6861 6e20 3130 202f 2077  ater than 10 / w
-00024c20: 696e 646f 7720 6c65 6e67 7468 2028 6630  indow length (f0
-00024c30: 203e 2031 3020 2f20 4c77 290a 2020 2020   > 10 / Lw).    
-00024c40: 2020 2020 2020 2020 6630 203d 2070 6561          f0 = pea
-00024c50: 6b20 6672 6571 7565 6e63 7920 5b48 7a5d  k frequency [Hz]
-00024c60: 0a20 2020 2020 2020 2020 2020 204c 7720  .            Lw 
-00024c70: 3d20 7769 6e64 6f77 206c 656e 6774 6820  = window length 
-00024c80: 5b73 6563 6f6e 6473 5d0a 2020 2020 2020  [seconds].      
-00024c90: 2020 3229 204e 756d 6265 7220 6f66 2073    2) Number of s
-00024ca0: 6967 6e69 6669 6361 6e74 2063 7963 6c65  ignificant cycle
-00024cb0: 7320 284e 6329 2069 7320 6772 6561 7465  s (Nc) is greate
-00024cc0: 7220 7468 616e 2032 3030 2028 4e63 2866  r than 200 (Nc(f
-00024cd0: 3029 203e 2032 3030 290a 2020 2020 2020  0) > 200).      
-00024ce0: 2020 2020 2020 4e63 203d 204c 7720 2a20        Nc = Lw * 
-00024cf0: 4e77 202a 2066 300a 2020 2020 2020 2020  Nw * f0.        
-00024d00: 2020 2020 2020 2020 4c77 203d 2077 696e          Lw = win
-00024d10: 646f 7720 6c65 6e67 7468 205b 7365 635d  dow length [sec]
-00024d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024d30: 204e 7720 3d20 4e75 6d62 6572 206f 6620   Nw = Number of 
-00024d40: 7769 6e64 6f77 7320 7573 6564 2069 6e20  windows used in 
-00024d50: 616e 616c 7973 6973 0a20 2020 2020 2020  analysis.       
-00024d60: 2020 2020 2020 2020 2066 3020 3d20 7065           f0 = pe
-00024d70: 616b 2066 7265 7175 656e 6379 205b 487a  ak frequency [Hz
-00024d80: 5d0a 2020 2020 2020 2020 3329 2053 7444  ].        3) StD
-00024d90: 6576 206f 6620 616d 706c 6974 7564 6520  ev of amplitude 
-00024da0: 6f66 2048 2f56 2063 7572 7665 2069 7320  of H/V curve is 
-00024db0: 6c65 7373 2074 6861 6e20 3220 6174 2061  less than 2 at a
-00024dc0: 6c6c 2066 7265 7175 656e 6369 6573 2062  ll frequencies b
-00024dd0: 6574 7765 656e 2030 2e35 6630 2061 6e64  etween 0.5f0 and
-00024de0: 2032 6630 0a20 2020 2020 2020 2020 2020   2f0.           
-00024df0: 2028 6c65 7373 2074 6861 6e20 3320 6966   (less than 3 if
-00024e00: 2066 3020 6973 206c 6573 7320 7468 616e   f0 is less than
-00024e10: 2030 2e35 2048 7a29 0a20 2020 2020 2020   0.5 Hz).       
-00024e20: 2020 2020 2066 3020 3d20 7065 616b 2066       f0 = peak f
-00024e30: 7265 7175 656e 6379 205b 487a 5d0a 2020  requency [Hz].  
-00024e40: 2020 2020 2020 2020 2020 5374 4465 7620            StDev 
-00024e50: 6973 2061 206d 6561 7375 7265 206f 6620  is a measure of 
-00024e60: 7468 6520 7661 7269 6174 696f 6e20 6f66  the variation of
-00024e70: 2061 6c6c 2074 6865 2048 2f56 2063 7572   all the H/V cur
-00024e80: 7665 7320 6765 6e65 7261 7465 6420 666f  ves generated fo
-00024e90: 7220 6561 6368 2074 696d 6520 7769 6e64  r each time wind
-00024ea0: 6f77 0a20 2020 2020 2020 2020 2020 2020  ow.             
-00024eb0: 2020 204f 7572 206d 6169 6e20 482f 5620     Our main H/V 
-00024ec0: 6375 7276 6520 6973 2074 6865 206d 6564  curve is the med
-00024ed0: 6961 6e20 6f66 2074 6865 7365 0a0a 2020  ian of these..  
-00024ee0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00024ef0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00024f00: 6876 7372 5f64 6963 7420 2020 3a20 6469  hvsr_dict   : di
-00024f10: 6374 0a20 2020 2020 2020 2044 6963 7469  ct.        Dicti
-00024f20: 6f6e 6172 7920 636f 6e74 6169 6e69 6e67  onary containing
-00024f30: 2061 6c6c 2069 6d70 6f72 7461 6e74 2069   all important i
-00024f40: 6e66 6f72 6d61 7469 6f6e 2067 656e 6572  nformation gener
-00024f50: 6174 6564 2061 626f 7574 2048 5653 5220  ated about HVSR 
-00024f60: 6375 7276 650a 2020 2020 5f70 6561 6b20  curve.    _peak 
-00024f70: 2020 2020 2020 3a20 6c69 7374 0a20 2020        : list.   
-00024f80: 2020 2020 2041 206c 6973 7420 6f66 2064       A list of d
-00024f90: 6963 7469 6f6e 6172 6965 732c 2077 6974  ictionaries, wit
-00024fa0: 6820 6561 6368 2064 6963 7469 6f6e 6172  h each dictionar
-00024fb0: 7920 636f 6e74 6169 6e69 6e67 2069 6e66  y containing inf
-00024fc0: 6f72 6d61 7469 6f6e 2061 626f 7574 2065  ormation about e
-00024fd0: 6163 6820 7065 616b 0a0a 2020 2020 5265  ach peak..    Re
-00024fe0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-00024ff0: 2d0a 2020 2020 5f70 6561 6b20 2020 3a20  -.    _peak   : 
-00025000: 6c69 7374 0a20 2020 2020 2020 204c 6973  list.        Lis
-00025010: 7420 6f66 2064 6963 7469 6f6e 6172 6965  t of dictionarie
-00025020: 732c 2073 616d 6520 6173 2061 626f 7665  s, same as above
-00025030: 2c20 6578 6365 7074 2077 6974 6820 696e  , except with in
-00025040: 666f 726d 6174 696f 6e20 6162 6f75 7420  formation about 
-00025050: 6375 7276 6520 7265 6c69 6162 696c 6974  curve reliabilit
-00025060: 7920 7465 7374 7320 6164 6465 640a 2020  y tests added.  
-00025070: 2020 2222 220a 2020 2020 616e 794b 6579    """.    anyKey
-00025080: 203d 206c 6973 7428 6876 7372 5f64 6963   = list(hvsr_dic
-00025090: 745b 2770 7073 6473 275d 2e6b 6579 7328  t['ppsds'].keys(
-000250a0: 2929 5b30 5d23 446f 6573 6e27 7420 6d61  ))[0]#Doesn't ma
-000250b0: 7474 6572 2077 6869 6368 2063 6861 6e6e  tter which chann
-000250c0: 656c 2077 6520 7573 6520 6173 206b 6579  el we use as key
-000250d0: 0a0a 2020 2020 6465 6c74 6120 3d20 6876  ..    delta = hv
-000250e0: 7372 5f64 6963 745b 2770 7073 6473 275d  sr_dict['ppsds']
-000250f0: 5b61 6e79 4b65 795d 5b27 6465 6c74 6127  [anyKey]['delta'
-00025100: 5d0a 2020 2020 7769 6e64 6f77 5f6c 656e  ].    window_len
-00025110: 203d 2028 6876 7372 5f64 6963 745b 2770   = (hvsr_dict['p
-00025120: 7073 6473 275d 5b61 6e79 4b65 795d 5b27  psds'][anyKey]['
-00025130: 6c65 6e27 5d20 2a20 6465 6c74 6129 2023  len'] * delta) #
-00025140: 5769 6e64 6f77 206c 656e 6774 6820 696e  Window length in
-00025150: 2073 6563 6f6e 6473 0a20 2020 2077 696e   seconds.    win
-00025160: 646f 775f 6e75 6d20 3d20 6e70 2e61 7272  dow_num = np.arr
-00025170: 6179 2868 7673 725f 6469 6374 5b27 7073  ay(hvsr_dict['ps
-00025180: 645f 7261 7727 5d5b 616e 794b 6579 5d29  d_raw'][anyKey])
-00025190: 2e73 6861 7065 5b30 5d0a 0a20 2020 2066  .shape[0]..    f
-000251a0: 6f72 205f 6920 696e 2072 616e 6765 286c  or _i in range(l
-000251b0: 656e 285f 7065 616b 2929 3a0a 2020 2020  en(_peak)):.    
-000251c0: 2020 2020 7065 616b 4672 6571 3d20 5f70      peakFreq= _p
-000251d0: 6561 6b5b 5f69 5d5b 2766 3027 5d0a 2020  eak[_i]['f0'].  
-000251e0: 2020 2020 2020 7465 7374 3120 3d20 7065        test1 = pe
-000251f0: 616b 4672 6571 203e 2031 302f 7769 6e64  akFreq > 10/wind
-00025200: 6f77 5f6c 656e 0a0a 2020 2020 2020 2020  ow_len..        
-00025210: 6e63 203d 2077 696e 646f 775f 6c65 6e20  nc = window_len 
-00025220: 2a20 7769 6e64 6f77 5f6e 756d 202a 2070  * window_num * p
-00025230: 6561 6b46 7265 710a 2020 2020 2020 2020  eakFreq.        
-00025240: 7465 7374 3220 3d20 6e63 203e 2032 3030  test2 = nc > 200
-00025250: 0a0a 2020 2020 2020 2020 6861 6c66 4630  ..        halfF0
-00025260: 203d 2070 6561 6b46 7265 712f 320a 2020   = peakFreq/2.  
-00025270: 2020 2020 2020 646f 7562 6c65 6630 203d        doublef0 =
-00025280: 2070 6561 6b46 7265 712a 320a 2020 2020   peakFreq*2.    
-00025290: 2020 2020 0a20 2020 2020 2020 2074 6573      .        tes
-000252a0: 7433 203d 2054 7275 650a 2020 2020 2020  t3 = True.      
-000252b0: 2020 6661 696c 436f 756e 7420 3d20 300a    failCount = 0.
-000252c0: 2020 2020 2020 2020 666f 7220 692c 2066          for i, f
-000252d0: 7265 7120 696e 2065 6e75 6d65 7261 7465  req in enumerate
-000252e0: 2868 7673 725f 6469 6374 5b27 785f 6672  (hvsr_dict['x_fr
-000252f0: 6571 7327 5d5b 616e 794b 6579 5d5b 3a2d  eqs'][anyKey][:-
-00025300: 315d 293a 0a20 2020 2020 2020 2020 2020  1]):.           
-00025310: 2023 2323 4953 2054 4849 5320 5249 4748   ###IS THIS RIGH
-00025320: 543f 3f3f 0a20 2020 2020 2020 2020 2020  T???.           
-00025330: 2069 6620 6672 6571 203e 3d20 6861 6c66   if freq >= half
-00025340: 4630 2061 6e64 2066 7265 7120 3c64 6f75  F0 and freq <dou
-00025350: 626c 6566 303a 0a20 2020 2020 2020 2020  blef0:.         
-00025360: 2020 2020 2020 2069 6620 7065 616b 4672         if peakFr
-00025370: 6571 203e 3d20 302e 353a 0a20 2020 2020  eq >= 0.5:.     
-00025380: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00025390: 6620 6876 7372 5f64 6963 745b 2768 7673  f hvsr_dict['hvs
-000253a0: 725f 6c6f 675f 7374 6427 5d5b 695d 203e  r_log_std'][i] >
-000253b0: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
-000253c0: 2020 2020 2020 2020 2020 2020 2074 6573               tes
-000253d0: 7433 3d46 616c 7365 0a20 2020 2020 2020  t3=False.       
-000253e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000253f0: 2066 6169 6c43 6f75 6e74 202b 3d31 0a20   failCount +=1. 
-00025400: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00025410: 6c73 653a 2023 6966 2070 6561 6b20 6672  lse: #if peak fr
-00025420: 6571 2069 7320 6c65 7373 2074 6861 6e20  eq is less than 
-00025430: 302e 350a 2020 2020 2020 2020 2020 2020  0.5.            
-00025440: 2020 2020 2020 2020 6966 2068 7673 725f          if hvsr_
-00025450: 6469 6374 5b27 6876 7372 5f6c 6f67 5f73  dict['hvsr_log_s
-00025460: 7464 275d 5b69 5d20 3e3d 2033 3a0a 2020  td'][i] >= 3:.  
-00025470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025480: 2020 2020 2020 7465 7374 333d 4661 6c73        test3=Fals
-00025490: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000254a0: 2020 2020 2020 2020 2020 6661 696c 436f            failCo
-000254b0: 756e 7420 2b3d 310a 0a20 2020 2020 2020  unt +=1..       
-000254c0: 2069 6620 7465 7374 313a 0a20 2020 2020   if test1:.     
-000254d0: 2020 2020 2020 205f 7065 616b 5b5f 695d         _peak[_i]
-000254e0: 5b27 5265 706f 7274 275d 5b27 4c77 275d  ['Report']['Lw']
-000254f0: 203d 2027 7b7d 203e 2031 3020 2f20 7b7d   = '{} > 10 / {}
-00025500: 2020 7b7d 272e 666f 726d 6174 2872 6f75    {}'.format(rou
-00025510: 6e64 2870 6561 6b46 7265 712c 3329 2c20  nd(peakFreq,3), 
-00025520: 696e 7428 7769 6e64 6f77 5f6c 656e 292c  int(window_len),
-00025530: 2063 6865 636b 5f6d 6172 6b28 2929 0a20   check_mark()). 
-00025540: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00025550: 2020 2020 2020 2020 205f 7065 616b 5b5f           _peak[_
-00025560: 695d 5b27 5265 706f 7274 275d 5b27 4c77  i]['Report']['Lw
-00025570: 275d 203d 2027 7b7d 203e 2031 3020 2f20  '] = '{} > 10 / 
-00025580: 7b7d 2020 7b7d 272e 666f 726d 6174 2872  {}  {}'.format(r
-00025590: 6f75 6e64 2870 6561 6b46 7265 712c 3329  ound(peakFreq,3)
-000255a0: 2c20 696e 7428 7769 6e64 6f77 5f6c 656e  , int(window_len
-000255b0: 292c 2027 e29c 9827 290a 0a20 2020 2020  ), '...')..     
-000255c0: 2020 2069 6620 7465 7374 323a 0a20 2020     if test2:.   
-000255d0: 2020 2020 2020 2020 205f 7065 616b 5b5f           _peak[_
-000255e0: 695d 5b27 5265 706f 7274 275d 5b27 4e63  i]['Report']['Nc
-000255f0: 275d 203d 2027 7b7d 203e 2032 3030 2020  '] = '{} > 200  
-00025600: 7b7d 272e 666f 726d 6174 2872 6f75 6e64  {}'.format(round
-00025610: 286e 632c 3029 2c20 6368 6563 6b5f 6d61  (nc,0), check_ma
-00025620: 726b 2829 290a 2020 2020 2020 2020 656c  rk()).        el
-00025630: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00025640: 5f70 6561 6b5b 5f69 5d5b 2752 6570 6f72  _peak[_i]['Repor
-00025650: 7427 5d5b 274e 6327 5d20 3d20 277b 7d20  t']['Nc'] = '{} 
-00025660: 3e20 3230 3020 207b 7d27 2e66 6f72 6d61  > 200  {}'.forma
-00025670: 7428 726f 756e 6428 6e63 2c30 292c 2027  t(round(nc,0), '
-00025680: e29c 9827 290a 0a20 2020 2020 2020 2069  ...')..        i
-00025690: 6620 7465 7374 333a 0a20 2020 2020 2020  f test3:.       
-000256a0: 2020 2020 2069 6620 7065 616b 4672 6571       if peakFreq
-000256b0: 203e 3d20 302e 353a 0a20 2020 2020 2020   >= 0.5:.       
-000256c0: 2020 2020 2020 2020 2063 6f6d 7056 616c           compVal
-000256d0: 203d 2032 0a20 2020 2020 2020 2020 2020   = 2.           
-000256e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000256f0: 2020 2020 2020 2063 6f6d 7056 616c 203d         compVal =
-00025700: 2033 0a20 2020 2020 2020 2020 2020 205f   3.            _
-00025710: 7065 616b 5b5f 695d 5b27 5265 706f 7274  peak[_i]['Report
-00025720: 275d 5b27 cf83 5f41 2866 2927 5d20 3d20  ']['.._A(f)'] = 
-00025730: 27cf 835f 4120 666f 7220 616c 6c20 6672  '.._A for all fr
-00025740: 6571 7320 7b7d 2d7b 7d20 3c20 7b7d 2020  eqs {}-{} < {}  
-00025750: 7b7d 272e 666f 726d 6174 2872 6f75 6e64  {}'.format(round
-00025760: 2870 6561 6b46 7265 712a 302e 352c 2033  (peakFreq*0.5, 3
-00025770: 292c 2072 6f75 6e64 2870 6561 6b46 7265  ), round(peakFre
-00025780: 712a 322c 2033 292c 2063 6f6d 7056 616c  q*2, 3), compVal
-00025790: 2c20 6368 6563 6b5f 6d61 726b 2829 290a  , check_mark()).
-000257a0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000257b0: 2020 2020 2020 2020 2020 5f70 6561 6b5b            _peak[
-000257c0: 5f69 5d5b 2752 6570 6f72 7427 5d5b 27cf  _i]['Report']['.
-000257d0: 835f 4128 6629 275d 203d 2027 cf83 5f41  ._A(f)'] = '.._A
-000257e0: 2066 6f72 2061 6c6c 2066 7265 7173 207b   for all freqs {
-000257f0: 7d2d 7b7d 203c 207b 7d20 207b 7d27 2e66  }-{} < {}  {}'.f
-00025800: 6f72 6d61 7428 726f 756e 6428 7065 616b  ormat(round(peak
-00025810: 4672 6571 2a30 2e35 2c20 3329 2c20 726f  Freq*0.5, 3), ro
-00025820: 756e 6428 7065 616b 4672 6571 2a32 2c20  und(peakFreq*2, 
-00025830: 3329 2c20 636f 6d70 5661 6c2c 2027 e29c  3), compVal, '..
-00025840: 9827 290a 0a20 2020 2020 2020 205f 7065  .')..        _pe
-00025850: 616b 5b5f 695d 5b27 5061 7373 204c 6973  ak[_i]['Pass Lis
-00025860: 7427 5d5b 2757 696e 646f 7720 4c65 6e67  t']['Window Leng
-00025870: 7468 2046 7265 712e 275d 203d 2074 6573  th Freq.'] = tes
-00025880: 7431 0a20 2020 2020 2020 205f 7065 616b  t1.        _peak
-00025890: 5b5f 695d 5b27 5061 7373 204c 6973 7427  [_i]['Pass List'
-000258a0: 5d5b 2753 6967 6e69 6669 6361 6e74 2043  ]['Significant C
-000258b0: 7963 6c65 7327 5d20 3d20 7465 7374 320a  ycles'] = test2.
-000258c0: 2020 2020 2020 2020 5f70 6561 6b5b 5f69          _peak[_i
-000258d0: 5d5b 2750 6173 7320 4c69 7374 275d 5b27  ]['Pass List']['
-000258e0: 4c6f 7720 4375 7276 6520 5374 4465 762e  Low Curve StDev.
-000258f0: 206f 7665 7220 7469 6d65 275d 203d 2074   over time'] = t
-00025900: 6573 7433 0a20 2020 2072 6574 7572 6e20  est3.    return 
-00025910: 5f70 6561 6b0a 0a23 4368 6563 6b20 636c  _peak..#Check cl
-00025920: 6172 6974 7920 6f66 2070 6561 6b73 0a64  arity of peaks.d
-00025930: 6566 205f 5f63 6865 636b 5f63 6c61 7269  ef __check_clari
-00025940: 7479 285f 782c 205f 792c 205f 7065 616b  ty(_x, _y, _peak
-00025950: 2c20 646f 5f72 616e 6b3d 5472 7565 293a  , do_rank=True):
-00025960: 0a20 2020 2022 2222 4368 6563 6b20 636c  .    """Check cl
-00025970: 6172 6974 7920 6f66 2070 6561 6b20 616d  arity of peak am
-00025980: 706c 6974 7564 6528 7329 0a0a 2020 2020  plitude(s)..    
-00025990: 2020 2054 6573 7420 7065 616b 7320 666f     Test peaks fo
-000259a0: 7220 7361 7469 7366 7969 6e67 2061 6d70  r satisfying amp
-000259b0: 6c69 7475 6465 2063 6c61 7269 7479 2063  litude clarity c
-000259c0: 6f6e 6469 7469 6f6e 7320 6173 206f 7574  onditions as out
-000259d0: 6c69 6e65 6420 6279 2053 4553 414d 4520  lined by SESAME 
-000259e0: 3230 3034 3a0a 2020 2020 2020 2020 2020  2004:.          
-000259f0: 202d 2074 6865 7265 2065 7869 7374 206f   - there exist o
-00025a00: 6e65 2066 7265 7175 656e 6379 2066 2d2c  ne frequency f-,
-00025a10: 206c 7969 6e67 2062 6574 7765 656e 2066   lying between f
-00025a20: 302f 3420 616e 6420 6630 2c20 7375 6368  0/4 and f0, such
-00025a30: 2074 6861 7420 4130 202f 2041 2866 2d29   that A0 / A(f-)
-00025a40: 203e 2032 0a20 2020 2020 2020 2020 2020   > 2.           
-00025a50: 2d20 7468 6572 6520 6578 6973 7420 6f6e  - there exist on
-00025a60: 6520 6672 6571 7565 6e63 7920 662b 2c20  e frequency f+, 
-00025a70: 6c79 696e 6720 6265 7477 6565 6e20 6630  lying between f0
-00025a80: 2061 6e64 2034 2a66 302c 2073 7563 6820   and 4*f0, such 
-00025a90: 7468 6174 2041 3020 2f20 4128 662b 2920  that A0 / A(f+) 
-00025aa0: 3e20 320a 2020 2020 2020 2020 2020 202d  > 2.           -
-00025ab0: 2041 3020 3e20 320a 0a20 2020 2020 2020   A0 > 2..       
-00025ac0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00025ad0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00025ae0: 2020 2020 2020 2078 203a 206c 6973 742d         x : list-
-00025af0: 6c69 6b65 206f 626a 200a 2020 2020 2020  like obj .      
-00025b00: 2020 2020 2020 4c69 7374 2077 6974 6820        List with 
-00025b10: 782d 7661 6c75 6573 2028 6672 6571 7565  x-values (freque
-00025b20: 6e63 7920 6f72 2070 6572 696f 6420 7661  ncy or period va
-00025b30: 6c75 6573 290a 2020 2020 2020 2020 7920  lues).        y 
-00025b40: 3a20 6c69 7374 2d6c 696b 6520 6f62 6a20  : list-like obj 
-00025b50: 0a20 2020 2020 2020 2020 2020 204c 6973  .            Lis
-00025b60: 7420 7769 7468 2068 7673 7220 6375 7276  t with hvsr curv
-00025b70: 6520 7661 6c75 6573 0a20 2020 2020 2020  e values.       
-00025b80: 205f 7065 616b 203a 206c 6973 740a 2020   _peak : list.  
-00025b90: 2020 2020 2020 2020 2020 4c69 7374 2077            List w
-00025ba0: 6974 6820 6469 6374 696f 6e61 7269 6573  ith dictionaries
-00025bb0: 2066 6f72 2065 6163 6820 7065 616b 2c20   for each peak, 
-00025bc0: 636f 6e74 6169 6e69 6e67 2069 6e66 6f20  containing info 
-00025bd0: 6162 6f75 7420 7468 6174 2070 6561 6b0a  about that peak.
-00025be0: 2020 2020 2020 2020 646f 5f72 616e 6b20          do_rank 
-00025bf0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-00025c00: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00025c10: 2020 496e 636c 7564 6520 5261 6e6b 2069    Include Rank i
-00025c20: 6e20 6f75 7470 7574 0a0a 2020 2020 2020  n output..      
-00025c30: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-00025c40: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00025c50: 2020 5f70 6561 6b20 3a20 6c69 7374 0a20    _peak : list. 
-00025c60: 2020 2020 2020 2020 2020 204c 6973 7420             List 
-00025c70: 6f66 2064 6963 7469 6f6e 6172 6965 732c  of dictionaries,
-00025c80: 2065 6163 6820 636f 6e74 6169 6e69 6e67   each containing
-00025c90: 2074 6865 2063 6c61 7269 7479 2074 6573   the clarity tes
-00025ca0: 7420 696e 666f 726d 6174 696f 6e20 666f  t information fo
-00025cb0: 7220 7468 6520 6469 6666 6572 656e 7420  r the different 
-00025cc0: 7065 616b 7320 7468 6174 2077 6572 6520  peaks that were 
-00025cd0: 7265 6164 2069 6e0a 2020 2020 2222 220a  read in.    """.
-00025ce0: 2020 2020 676c 6f62 616c 206d 6178 5f72      global max_r
-00025cf0: 616e 6b0a 0a20 2020 2023 2054 6573 7420  ank..    # Test 
-00025d00: 6561 6368 205f 7065 616b 2066 6f72 2063  each _peak for c
-00025d10: 6c61 7269 7479 2e0a 2020 2020 6966 2064  larity..    if d
-00025d20: 6f5f 7261 6e6b 3a0a 2020 2020 2020 2020  o_rank:.        
-00025d30: 6d61 785f 7261 6e6b 202b 3d20 310a 0a20  max_rank += 1.. 
-00025d40: 2020 2069 6620 6e70 2e61 7272 6179 285f     if np.array(_
-00025d50: 7829 2e73 6861 7065 5b30 5d20 3d3d 2031  x).shape[0] == 1
-00025d60: 3030 303a 0a20 2020 2020 2020 206a 7374  000:.        jst
-00025d70: 6172 7420 3d20 6c65 6e28 5f78 292d 320a  art = len(_x)-2.
-00025d80: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00025d90: 2020 6a73 7461 7274 203d 206c 656e 285f    jstart = len(_
-00025da0: 7829 2d31 0a0a 2020 2020 666f 7220 5f69  x)-1..    for _i
-00025db0: 2069 6e20 7261 6e67 6528 6c65 6e28 5f70   in range(len(_p
-00025dc0: 6561 6b29 293a 0a20 2020 2020 2020 2023  eak)):.        #
-00025dd0: 496e 6974 6961 6c69 7a65 2061 7320 4661  Initialize as Fa
-00025de0: 6c73 650a 2020 2020 2020 2020 5f70 6561  lse.        _pea
-00025df0: 6b5b 5f69 5d5b 2766 2d27 5d20 3d20 27e2  k[_i]['f-'] = '.
-00025e00: 9c98 270a 2020 2020 2020 2020 5f70 6561  ..'.        _pea
-00025e10: 6b5b 5f69 5d5b 2752 6570 6f72 7427 5d5b  k[_i]['Report'][
-00025e20: 2741 2866 2d29 275d 203d 2027 4e6f 2041  'A(f-)'] = 'No A
-00025e30: 5f68 2f76 2069 6e20 6672 6571 7320 7b7d  _h/v in freqs {}
-00025e40: 2d7b 7d20 3c20 7b7d 2020 7b7d 272e 666f  -{} < {}  {}'.fo
-00025e50: 726d 6174 2872 6f75 6e64 285f 7065 616b  rmat(round(_peak
-00025e60: 5b5f 695d 5b27 4130 275d 2f34 2c20 3329  [_i]['A0']/4, 3)
-00025e70: 2c20 726f 756e 6428 5f70 6561 6b5b 5f69  , round(_peak[_i
-00025e80: 5d5b 2741 3027 5d2c 2033 292c 2072 6f75  ]['A0'], 3), rou
-00025e90: 6e64 285f 7065 616b 5b5f 695d 5b27 4130  nd(_peak[_i]['A0
-00025ea0: 275d 2f32 2c20 3329 2c20 27e2 9c98 2729  ']/2, 3), '...')
-00025eb0: 0a20 2020 2020 2020 205f 7065 616b 5b5f  .        _peak[_
-00025ec0: 695d 5b27 5061 7373 204c 6973 7427 5d5b  i]['Pass List'][
-00025ed0: 2750 6561 6b20 4672 6571 2e20 436c 6172  'Peak Freq. Clar
-00025ee0: 6974 7920 4265 6c6f 7727 5d20 3d20 4661  ity Below'] = Fa
-00025ef0: 6c73 650a 2020 2020 2020 2020 666f 7220  lse.        for 
-00025f00: 5f6a 2069 6e20 7261 6e67 6528 6a73 7461  _j in range(jsta
-00025f10: 7274 2c20 2d31 2c20 2d31 293a 0a0a 2020  rt, -1, -1):..  
-00025f20: 2020 2020 2020 2020 2020 2320 5468 6572            # Ther
-00025f30: 6520 6578 6973 7420 6f6e 6520 6672 6571  e exist one freq
-00025f40: 7565 6e63 7920 662d 2c20 6c79 696e 6720  uency f-, lying 
-00025f50: 6265 7477 6565 6e20 6630 2f34 2061 6e64  between f0/4 and
-00025f60: 2066 302c 2073 7563 6820 7468 6174 2041   f0, such that A
-00025f70: 3020 2f20 4128 662d 2920 3e20 322e 0a20  0 / A(f-) > 2.. 
-00025f80: 2020 2020 2020 2020 2020 2069 6620 2866             if (f
-00025f90: 6c6f 6174 285f 7065 616b 5b5f 695d 5b27  loat(_peak[_i]['
-00025fa0: 6630 275d 2920 2f20 342e 3020 3c3d 205f  f0']) / 4.0 <= _
-00025fb0: 785b 5f6a 5d20 3c20 666c 6f61 7428 5f70  x[_j] < float(_p
-00025fc0: 6561 6b5b 5f69 5d5b 2766 3027 5d29 2920  eak[_i]['f0'])) 
-00025fd0: 616e 6420 5c0a 2020 2020 2020 2020 2020  and \.          
-00025fe0: 2020 2020 2020 2020 2020 666c 6f61 7428            float(
-00025ff0: 5f70 6561 6b5b 5f69 5d5b 2741 3027 5d29  _peak[_i]['A0'])
-00026000: 202f 205f 795b 5f6a 5d20 3e20 322e 303a   / _y[_j] > 2.0:
-00026010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026020: 205f 7065 616b 5b5f 695d 5b27 5363 6f72   _peak[_i]['Scor
-00026030: 6527 5d20 2b3d 2031 0a20 2020 2020 2020  e'] += 1.       
-00026040: 2020 2020 2020 2020 205f 7065 616b 5b5f           _peak[_
-00026050: 695d 5b27 662d 275d 203d 2027 2531 302e  i]['f-'] = '%10.
-00026060: 3366 2025 3173 2720 2520 285f 785b 5f6a  3f %1s' % (_x[_j
-00026070: 5d2c 2063 6865 636b 5f6d 6172 6b28 2929  ], check_mark())
-00026080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026090: 205f 7065 616b 5b5f 695d 5b27 5265 706f   _peak[_i]['Repo
-000260a0: 7274 275d 5b27 4128 662d 2927 5d20 3d20  rt']['A(f-)'] = 
-000260b0: 2741 287b 7d29 3a20 7b7d 203c 207b 7d20  'A({}): {} < {} 
-000260c0: 207b 7d27 2e66 6f72 6d61 7428 726f 756e   {}'.format(roun
-000260d0: 6428 5f78 5b5f 6a5d 2c20 3329 2c20 726f  d(_x[_j], 3), ro
-000260e0: 756e 6428 5f79 5b5f 6a5d 2c20 3329 2c20  und(_y[_j], 3), 
-000260f0: 726f 756e 6428 5f70 6561 6b5b 5f69 5d5b  round(_peak[_i][
-00026100: 2741 3027 5d2f 322c 3329 2c20 6368 6563  'A0']/2,3), chec
-00026110: 6b5f 6d61 726b 2829 290a 2020 2020 2020  k_mark()).      
-00026120: 2020 2020 2020 2020 2020 5f70 6561 6b5b            _peak[
-00026130: 5f69 5d5b 2750 6173 7320 4c69 7374 275d  _i]['Pass List']
-00026140: 5b27 5065 616b 2046 7265 712e 2043 6c61  ['Peak Freq. Cla
-00026150: 7269 7479 2042 656c 6f77 275d 203d 2054  rity Below'] = T
-00026160: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00026170: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-00026180: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00026190: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-000261a0: 0a20 2020 200a 2020 2020 6966 2064 6f5f  .    .    if do_
-000261b0: 7261 6e6b 3a0a 2020 2020 2020 2020 6d61  rank:.        ma
-000261c0: 785f 7261 6e6b 202b 3d20 310a 2020 2020  x_rank += 1.    
-000261d0: 666f 7220 5f69 2069 6e20 7261 6e67 6528  for _i in range(
-000261e0: 6c65 6e28 5f70 6561 6b29 293a 0a20 2020  len(_peak)):.   
-000261f0: 2020 2020 2023 496e 6974 6961 6c69 7a65       #Initialize
-00026200: 2061 7320 4661 6c73 650a 2020 2020 2020   as False.      
-00026210: 2020 5f70 6561 6b5b 5f69 5d5b 2766 2b27    _peak[_i]['f+'
-00026220: 5d20 3d20 27e2 9c98 270a 2020 2020 2020  ] = '...'.      
-00026230: 2020 5f70 6561 6b5b 5f69 5d5b 2752 6570    _peak[_i]['Rep
-00026240: 6f72 7427 5d5b 2741 2866 2b29 275d 203d  ort']['A(f+)'] =
-00026250: 2027 4e6f 2041 5f68 2f76 2069 6e20 6672   'No A_h/v in fr
-00026260: 6571 7320 7b7d 2d7b 7d20 3c20 7b7d 2020  eqs {}-{} < {}  
-00026270: 7b7d 272e 666f 726d 6174 2872 6f75 6e64  {}'.format(round
-00026280: 285f 7065 616b 5b5f 695d 5b27 4130 275d  (_peak[_i]['A0']
-00026290: 2c20 3329 2c20 726f 756e 6428 5f70 6561  , 3), round(_pea
-000262a0: 6b5b 5f69 5d5b 2741 3027 5d2a 342c 2033  k[_i]['A0']*4, 3
-000262b0: 292c 2072 6f75 6e64 285f 7065 616b 5b5f  ), round(_peak[_
-000262c0: 695d 5b27 4130 275d 2f32 2c20 3329 2c20  i]['A0']/2, 3), 
-000262d0: 27e2 9c98 2729 0a20 2020 2020 2020 205f  '...').        _
-000262e0: 7065 616b 5b5f 695d 5b27 5061 7373 204c  peak[_i]['Pass L
-000262f0: 6973 7427 5d5b 2750 6561 6b20 4672 6571  ist']['Peak Freq
-00026300: 2e20 436c 6172 6974 7920 4162 6f76 6527  . Clarity Above'
-00026310: 5d20 3d20 4661 6c73 650a 2020 2020 2020  ] = False.      
-00026320: 2020 666f 7220 5f6a 2069 6e20 7261 6e67    for _j in rang
-00026330: 6528 6c65 6e28 5f78 2920 2d20 3129 3a0a  e(len(_x) - 1):.
-00026340: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-00026350: 6865 7265 2065 7869 7374 206f 6e65 2066  here exist one f
-00026360: 7265 7175 656e 6379 2066 2b2c 206c 7969  requency f+, lyi
-00026370: 6e67 2062 6574 7765 656e 2066 3020 616e  ng between f0 an
-00026380: 6420 342a 6630 2c20 7375 6368 2074 6861  d 4*f0, such tha
-00026390: 7420 4130 202f 2041 2866 2b29 203e 2032  t A0 / A(f+) > 2
-000263a0: 2e0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000263b0: 2066 6c6f 6174 285f 7065 616b 5b5f 695d   float(_peak[_i]
-000263c0: 5b27 6630 275d 2920 2a20 342e 3020 3e3d  ['f0']) * 4.0 >=
-000263d0: 205f 785b 5f6a 5d20 3e20 666c 6f61 7428   _x[_j] > float(
-000263e0: 5f70 6561 6b5b 5f69 5d5b 2766 3027 5d29  _peak[_i]['f0'])
-000263f0: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
-00026400: 2020 2020 2020 2020 2020 2066 6c6f 6174             float
-00026410: 285f 7065 616b 5b5f 695d 5b27 4130 275d  (_peak[_i]['A0']
-00026420: 2920 2f20 5f79 5b5f 6a5d 203e 2032 2e30  ) / _y[_j] > 2.0
-00026430: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00026440: 2020 5f70 6561 6b5b 5f69 5d5b 2753 636f    _peak[_i]['Sco
-00026450: 7265 275d 202b 3d20 310a 2020 2020 2020  re'] += 1.      
-00026460: 2020 2020 2020 2020 2020 5f70 6561 6b5b            _peak[
-00026470: 5f69 5d5b 2766 2b27 5d20 3d20 2725 3130  _i]['f+'] = '%10
-00026480: 2e33 6620 2531 7327 2025 2028 5f78 5b5f  .3f %1s' % (_x[_
-00026490: 6a5d 2c20 6368 6563 6b5f 6d61 726b 2829  j], check_mark()
-000264a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000264b0: 2020 5f70 6561 6b5b 5f69 5d5b 2752 6570    _peak[_i]['Rep
-000264c0: 6f72 7427 5d5b 2741 2866 2b29 275d 203d  ort']['A(f+)'] =
-000264d0: 2027 4128 7b7d 293a 207b 7d20 3c20 7b7d   'A({}): {} < {}
-000264e0: 2020 7b7d 272e 666f 726d 6174 2872 6f75    {}'.format(rou
-000264f0: 6e64 285f 785b 5f6a 5d2c 2033 292c 2072  nd(_x[_j], 3), r
-00026500: 6f75 6e64 285f 795b 5f6a 5d2c 2033 292c  ound(_y[_j], 3),
-00026510: 2072 6f75 6e64 285f 7065 616b 5b5f 695d   round(_peak[_i]
-00026520: 5b27 4130 275d 2f32 2c33 292c 2063 6865  ['A0']/2,3), che
-00026530: 636b 5f6d 6172 6b28 2929 0a20 2020 2020  ck_mark()).     
-00026540: 2020 2020 2020 2020 2020 205f 7065 616b             _peak
-00026550: 5b5f 695d 5b27 5061 7373 204c 6973 7427  [_i]['Pass List'
-00026560: 5d5b 2750 6561 6b20 4672 6571 2e20 436c  ]['Peak Freq. Cl
-00026570: 6172 6974 7920 4162 6f76 6527 5d20 3d20  arity Above'] = 
-00026580: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00026590: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-000265a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000265b0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-000265c0: 730a 2320 2020 2020 2020 2069 6620 4661  s.#        if Fa
-000265d0: 6c73 6520 696e 2063 6c61 7269 7479 5061  lse in clarityPa
-000265e0: 7373 3a0a 2320 2020 2020 2020 2020 2020  ss:.#           
-000265f0: 205f 7065 616b 5b5f 695d 5b27 5061 7373   _peak[_i]['Pass
-00026600: 204c 6973 7427 5d5b 2750 6561 6b20 4672   List']['Peak Fr
-00026610: 6571 2e20 436c 6172 6974 7920 4265 6c6f  eq. Clarity Belo
-00026620: 7727 5d20 3d20 4661 6c73 650a 2320 2020  w'] = False.#   
-00026630: 2020 2020 2065 6c73 653a 0a23 2020 2020       else:.#    
-00026640: 2020 2020 2020 2020 5f70 6561 6b5b 5f69          _peak[_i
-00026650: 5d5b 2750 6173 7320 4c69 7374 275d 5b27  ]['Pass List']['
-00026660: 5065 616b 2046 7265 712e 2043 6c61 7269  Peak Freq. Clari
-00026670: 7479 2041 626f 7665 275d 203d 2054 7275  ty Above'] = Tru
-00026680: 650a 0a20 2020 2023 416d 706c 6974 7564  e..    #Amplitud
-00026690: 6520 436c 6172 6974 7920 7465 7374 0a20  e Clarity test. 
-000266a0: 2020 2023 204f 6e6c 7920 7065 616b 7320     # Only peaks 
-000266b0: 7769 7468 2041 3020 3e20 3220 7061 7373  with A0 > 2 pass
-000266c0: 0a20 2020 2069 6620 646f 5f72 616e 6b3a  .    if do_rank:
-000266d0: 0a20 2020 2020 2020 206d 6178 5f72 616e  .        max_ran
-000266e0: 6b20 2b3d 2031 0a20 2020 205f 6130 203d  k += 1.    _a0 =
-000266f0: 2032 2e30 0a20 2020 2066 6f72 205f 6920   2.0.    for _i 
-00026700: 696e 2072 616e 6765 286c 656e 285f 7065  in range(len(_pe
-00026710: 616b 2929 3a0a 0a20 2020 2020 2020 2069  ak)):..        i
-00026720: 6620 666c 6f61 7428 5f70 6561 6b5b 5f69  f float(_peak[_i
-00026730: 5d5b 2741 3027 5d29 203e 205f 6130 3a0a  ]['A0']) > _a0:.
-00026740: 2020 2020 2020 2020 2020 2020 5f70 6561              _pea
-00026750: 6b5b 5f69 5d5b 2752 6570 6f72 7427 5d5b  k[_i]['Report'][
-00026760: 2741 3027 5d20 3d20 2725 3130 2e32 6620  'A0'] = '%10.2f 
-00026770: 3e20 2530 2e31 6620 2531 7327 2025 2028  > %0.1f %1s' % (
-00026780: 5f70 6561 6b5b 5f69 5d5b 2741 3027 5d2c  _peak[_i]['A0'],
-00026790: 205f 6130 2c20 6368 6563 6b5f 6d61 726b   _a0, check_mark
-000267a0: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
-000267b0: 5f70 6561 6b5b 5f69 5d5b 2753 636f 7265  _peak[_i]['Score
-000267c0: 275d 202b 3d20 310a 2020 2020 2020 2020  '] += 1.        
-000267d0: 2020 2020 5f70 6561 6b5b 5f69 5d5b 2750      _peak[_i]['P
-000267e0: 6173 7320 4c69 7374 275d 5b27 5065 616b  ass List']['Peak
-000267f0: 2041 6d70 2e20 436c 6172 6974 7927 5d20   Amp. Clarity'] 
-00026800: 3d20 5472 7565 0a20 2020 2020 2020 2065  = True.        e
-00026810: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00026820: 205f 7065 616b 5b5f 695d 5b27 5265 706f   _peak[_i]['Repo
-00026830: 7274 275d 5b27 4130 275d 203d 2027 2531  rt']['A0'] = '%1
-00026840: 302e 3266 203e 2025 302e 3166 2025 3173  0.2f > %0.1f %1s
-00026850: 2720 2520 285f 7065 616b 5b5f 695d 5b27  ' % (_peak[_i]['
-00026860: 4130 275d 2c20 5f61 302c 2027 e29c 9827  A0'], _a0, '...'
-00026870: 290a 2020 2020 2020 2020 2020 2020 5f70  ).            _p
-00026880: 6561 6b5b 5f69 5d5b 2750 6173 7320 4c69  eak[_i]['Pass Li
-00026890: 7374 275d 5b27 5065 616b 2041 6d70 2e20  st']['Peak Amp. 
-000268a0: 436c 6172 6974 7927 5d20 3d20 4661 6c73  Clarity'] = Fals
-000268b0: 650a 0a20 2020 2072 6574 7572 6e20 5f70  e..    return _p
-000268c0: 6561 6b0a 0a23 4368 6563 6b20 7468 6520  eak..#Check the 
-000268d0: 7374 6162 696c 6974 7920 6f66 2074 6865  stability of the
-000268e0: 2066 7265 7175 656e 6379 2070 6561 6b0a   frequency peak.
-000268f0: 6465 6620 5f5f 6368 6563 6b5f 6672 6571  def __check_freq
-00026900: 5f73 7461 6269 6c69 7479 285f 7065 616b  _stability(_peak
-00026910: 2c20 5f70 6561 6b6d 2c20 5f70 6561 6b70  , _peakm, _peakp
-00026920: 293a 0a20 2020 2022 2222 5465 7374 2070  ):.    """Test p
-00026930: 6561 6b73 2066 6f72 2073 6174 6973 6679  eaks for satisfy
-00026940: 696e 6720 7374 6162 696c 6974 7920 636f  ing stability co
-00026950: 6e64 6974 696f 6e73 200a 0a20 2020 2054  nditions ..    T
-00026960: 6573 7420 6173 206f 7574 6c69 6e65 6420  est as outlined 
-00026970: 6279 2053 4553 414d 4520 3230 3034 3a0a  by SESAME 2004:.
-00026980: 2020 2020 2020 2020 2d20 7468 6520 5f70          - the _p
-00026990: 6561 6b20 7368 6f75 6c64 2061 7070 6561  eak should appea
-000269a0: 7220 6174 2074 6865 2073 616d 6520 6672  r at the same fr
-000269b0: 6571 7565 6e63 7920 2877 6974 6869 6e20  equency (within 
-000269c0: 6120 7065 7263 656e 7461 6765 20c2 b120  a percentage .. 
-000269d0: 3525 2920 6f6e 2074 6865 2048 2f56 0a20  5%) on the H/V. 
-000269e0: 2020 2020 2020 2020 2020 2063 7572 7665             curve
-000269f0: 7320 636f 7272 6573 706f 6e64 696e 6720  s corresponding 
-00026a00: 746f 206d 6561 6e20 2b20 616e 6420 2d20  to mean + and - 
-00026a10: 6f6e 6520 7374 616e 6461 7264 2064 6576  one standard dev
-00026a20: 6961 7469 6f6e 2e0a 0a20 2020 2050 6172  iation...    Par
-00026a30: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-00026a40: 2d2d 2d2d 2d2d 0a20 2020 205f 7065 616b  ------.    _peak
-00026a50: 203a 206c 6973 740a 2020 2020 2020 2020   : list.        
-00026a60: 4c69 7374 206f 6620 6469 6374 696f 6e61  List of dictiona
-00026a70: 7269 6573 2063 6f6e 7461 696e 696e 6720  ries containing 
-00026a80: 696e 7075 7420 696e 666f 726d 6174 696f  input informatio
-00026a90: 6e20 6162 6f75 7420 7065 616b 2c20 7769  n about peak, wi
-00026aa0: 7468 6f75 7420 6672 6571 2073 7461 6269  thout freq stabi
-00026ab0: 6c69 7479 2074 6573 740a 2020 2020 5f70  lity test.    _p
-00026ac0: 6561 6b6d 203a 206c 6973 740a 2020 2020  eakm : list.    
-00026ad0: 2020 2020 4c69 7374 206f 6620 6469 6374      List of dict
-00026ae0: 696f 6e61 7269 6573 2063 6f6e 7461 696e  ionaries contain
-00026af0: 696e 6720 696e 7075 7420 696e 666f 726d  ing input inform
-00026b00: 6174 696f 6e20 6162 6f75 7420 7065 616b  ation about peak
-00026b10: 6d20 2870 6561 6b20 6d69 6e75 7320 6f6e  m (peak minus on
-00026b20: 6520 5374 4465 7620 696e 2066 7265 7129  e StDev in freq)
-00026b30: 0a20 2020 205f 7065 616b 7020 3a20 6c69  .    _peakp : li
-00026b40: 7374 0a20 2020 2020 2020 204c 6973 7420  st.        List 
-00026b50: 6f66 2064 6963 7469 6f6e 6172 6965 7320  of dictionaries 
-00026b60: 636f 6e74 6169 6e69 6e67 2069 6e70 7574  containing input
-00026b70: 2069 6e66 6f72 6d61 7469 6f6e 2061 626f   information abo
-00026b80: 7574 2070 6561 6b20 2870 6561 6b20 706c  ut peak (peak pl
-00026b90: 7573 206f 6e65 2053 7444 6576 2069 6e20  us one StDev in 
-00026ba0: 6672 6571 2920 200a 0a20 2020 2052 6574  freq)  ..    Ret
-00026bb0: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
-00026bc0: 0a20 2020 205f 7065 616b 203a 206c 6973  .    _peak : lis
-00026bd0: 740a 2020 2020 2020 2020 4c69 7374 206f  t.        List o
-00026be0: 6620 6469 6374 696f 6e61 7269 6573 2063  f dictionaries c
-00026bf0: 6f6e 7461 696e 696e 6720 6f75 7470 7574  ontaining output
-00026c00: 2069 6e66 6f72 6d61 7469 6f6e 2061 626f   information abo
-00026c10: 7574 2070 6561 6b20 7465 7374 2020 0a20  ut peak test  . 
-00026c20: 2020 2022 2222 0a20 2020 2067 6c6f 6261     """.    globa
-00026c30: 6c20 6d61 785f 7261 6e6b 0a0a 2020 2020  l max_rank..    
-00026c40: 230a 2020 2020 2320 6368 6563 6b20 cf83  #.    # check ..
-00026c50: 6620 616e 6420 cf83 410a 2020 2020 230a  f and ..A.    #.
-00026c60: 2020 2020 6d61 785f 7261 6e6b 202b 3d20      max_rank += 
-00026c70: 310a 0a20 2020 2023 4669 7273 7420 6368  1..    #First ch
-00026c80: 6563 6b20 6265 6c6f 770a 2020 2020 5f66  eck below.    _f
-00026c90: 6f75 6e64 5f6d 203d 206c 6973 7428 290a  ound_m = list().
-00026ca0: 2020 2020 666f 7220 5f69 2069 6e20 7261      for _i in ra
-00026cb0: 6e67 6528 6c65 6e28 5f70 6561 6b29 293a  nge(len(_peak)):
-00026cc0: 0a20 2020 2020 2020 205f 6478 203d 2031  .        _dx = 1
-00026cd0: 3030 3030 3030 2e0a 2020 2020 2020 2020  000000..        
-00026ce0: 5f66 6f75 6e64 5f6d 2e61 7070 656e 6428  _found_m.append(
-00026cf0: 4661 6c73 6529 0a20 2020 2020 2020 205f  False).        _
-00026d00: 7065 616b 5b5f 695d 5b27 5265 706f 7274  peak[_i]['Report
-00026d10: 275d 5b27 502d 275d 203d 2027 e29c 9827  ']['P-'] = '...'
-00026d20: 0a20 2020 2020 2020 2066 6f72 205f 6a20  .        for _j 
-00026d30: 696e 2072 616e 6765 286c 656e 285f 7065  in range(len(_pe
-00026d40: 616b 6d29 293a 0a20 2020 2020 2020 2020  akm)):.         
-00026d50: 2020 2069 6620 6162 7328 5f70 6561 6b6d     if abs(_peakm
-00026d60: 5b5f 6a5d 5b27 6630 275d 202d 205f 7065  [_j]['f0'] - _pe
-00026d70: 616b 5b5f 695d 5b27 6630 275d 2920 3c20  ak[_i]['f0']) < 
-00026d80: 5f64 783a 0a20 2020 2020 2020 2020 2020  _dx:.           
-00026d90: 2020 2020 205f 696e 6465 7820 3d20 5f6a       _index = _j
-00026da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026db0: 205f 6478 203d 2061 6273 285f 7065 616b   _dx = abs(_peak
-00026dc0: 6d5b 5f6a 5d5b 2766 3027 5d20 2d20 5f70  m[_j]['f0'] - _p
-00026dd0: 6561 6b5b 5f69 5d5b 2766 3027 5d29 0a20  eak[_i]['f0']). 
-00026de0: 2020 2020 2020 2020 2020 2069 6620 5f70             if _p
-00026df0: 6561 6b5b 5f69 5d5b 2766 3027 5d20 2a20  eak[_i]['f0'] * 
-00026e00: 302e 3935 203c 3d20 5f70 6561 6b6d 5b5f  0.95 <= _peakm[_
-00026e10: 6a5d 5b27 6630 275d 203c 3d20 5f70 6561  j]['f0'] <= _pea
-00026e20: 6b5b 5f69 5d5b 2766 3027 5d20 2a20 312e  k[_i]['f0'] * 1.
-00026e30: 3035 3a0a 2020 2020 2020 2020 2020 2020  05:.            
-00026e40: 2020 2020 5f70 6561 6b5b 5f69 5d5b 2752      _peak[_i]['R
-00026e50: 6570 6f72 7427 5d5b 2750 2d27 5d20 3d20  eport']['P-'] = 
-00026e60: 2725 302e 3366 2077 6974 6869 6e20 c2b1  '%0.3f within ..
-00026e70: 3525 7320 6f66 2025 302e 3366 2025 3173  5%s of %0.3f %1s
-00026e80: 2720 2520 285f 7065 616b 6d5b 5f6a 5d5b  ' % (_peakm[_j][
-00026e90: 2766 3027 5d2c 2027 2527 2c0a 2020 2020  'f0'], '%',.    
+0001dcd0: 2020 6262 6f78 3d64 6963 7428 6661 6365    bbox=dict(face
+0001dce0: 636f 6c6f 723d 2777 272c 2065 6467 6563  color='w', edgec
+0001dcf0: 6f6c 6f72 3d27 6e6f 6e65 272c 2061 6c70  olor='none', alp
+0001dd00: 6861 3d30 2e38 2c20 7061 643d 302e 3129  ha=0.8, pad=0.1)
+0001dd10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001dd20: 2020 706c 6f74 5375 6666 203d 2070 6c6f    plotSuff = plo
+0001dd30: 7453 7566 662b 2761 6e6e 5f27 0a0a 2020  tSuff+'ann_'..  
+0001dd40: 2020 2020 2020 656c 6966 206b 3d3d 2770        elif k=='p
+0001dd50: 2720 2061 6e64 2027 616c 6c27 2069 6e20  '  and 'all' in 
+0001dd60: 6b69 6e64 3a0a 2020 2020 2020 2020 2020  kind:.          
+0001dd70: 2020 706c 6f74 5375 6666 203d 2070 6c6f    plotSuff = plo
+0001dd80: 7453 7566 662b 2761 6c6c 5065 616b 735f  tSuff+'allPeaks_
+0001dd90: 270a 0a20 2020 2020 2020 2020 2020 2061  '..            a
+0001dda0: 782e 766c 696e 6573 2868 7673 725f 6469  x.vlines(hvsr_di
+0001ddb0: 6374 5b27 6876 7372 5f70 6561 6b5f 6672  ct['hvsr_peak_fr
+0001ddc0: 6571 7327 5d2c 2061 782e 6765 745f 796c  eqs'], ax.get_yl
+0001ddd0: 696d 2829 5b30 5d2c 2061 782e 6765 745f  im()[0], ax.get_
+0001dde0: 796c 696d 2829 5b31 5d2c 2063 6f6c 6f72  ylim()[1], color
+0001ddf0: 733d 276b 272c 206c 696e 6573 7479 6c65  s='k', linestyle
+0001de00: 733d 2764 6f74 7465 6427 2c20 6c61 6265  s='dotted', labe
+0001de10: 6c3d 2750 6561 6b27 2920 2020 2020 2020  l='Peak')       
+0001de20: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0001de30: 6966 2027 616e 6e27 2069 6e20 6b69 6e64  if 'ann' in kind
+0001de40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001de50: 2020 666f 7220 692c 2070 2069 6e20 656e    for i, p in en
+0001de60: 756d 6572 6174 6528 6876 7372 5f64 6963  umerate(hvsr_dic
+0001de70: 745b 2768 7673 725f 7065 616b 5f66 7265  t['hvsr_peak_fre
+0001de80: 7173 275d 293a 0a20 2020 2020 2020 2020  qs']):.         
+0001de90: 2020 2020 2020 2020 2020 2079 203d 2068             y = h
+0001dea0: 7673 725f 6469 6374 5b27 6876 7372 5f63  vsr_dict['hvsr_c
+0001deb0: 7572 7665 275d 5b68 7673 725f 6469 6374  urve'][hvsr_dict
+0001dec0: 5b27 6876 7372 5f70 6561 6b5f 696e 6469  ['hvsr_peak_indi
+0001ded0: 6365 7327 5d5b 695d 5d0a 2020 2020 2020  ces'][i]].      
+0001dee0: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+0001def0: 2e61 6e6e 6f74 6174 6528 2750 6561 6b20  .annotate('Peak 
+0001df00: 6174 2027 2b73 7472 2872 6f75 6e64 2870  at '+str(round(p
+0001df10: 2c32 2929 2b27 487a 272c 2028 702c 2030  ,2))+'Hz', (p, 0
+0001df20: 2e31 292c 2078 7963 6f6f 7264 733d 2764  .1), xycoords='d
+0001df30: 6174 6127 2c20 0a20 2020 2020 2020 2020  ata', .         
+0001df40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df50: 2020 2020 2020 2020 2020 2068 6f72 697a             horiz
+0001df60: 6f6e 7461 6c61 6c69 676e 6d65 6e74 3d27  ontalalignment='
+0001df70: 6365 6e74 6572 272c 2076 6572 7469 6361  center', vertica
+0001df80: 6c61 6c69 676e 6d65 6e74 3d27 626f 7474  lalignment='bott
+0001df90: 6f6d 272c 200a 2020 2020 2020 2020 2020  om', .          
+0001dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dfb0: 2020 2020 2020 2020 2020 6262 6f78 3d64            bbox=d
+0001dfc0: 6963 7428 6661 6365 636f 6c6f 723d 2777  ict(facecolor='w
+0001dfd0: 272c 2065 6467 6563 6f6c 6f72 3d27 6e6f  ', edgecolor='no
+0001dfe0: 6e65 272c 2061 6c70 6861 3d30 2e38 2c20  ne', alpha=0.8, 
+0001dff0: 7061 643d 302e 3129 290a 2020 2020 2020  pad=0.1)).      
+0001e000: 2020 2020 2020 2020 2020 706c 6f74 5375            plotSu
+0001e010: 6666 3d70 6c6f 7453 7566 662b 2761 6e6e  ff=plotSuff+'ann
+0001e020: 5f27 0a0a 2020 2020 2020 2020 6966 2027  _'..        if '
+0001e030: 7427 2069 6e20 6b3a 0a20 2020 2020 2020  t' in k:.       
+0001e040: 2020 2020 2070 6c6f 7453 7566 6620 3d20       plotSuff = 
+0001e050: 706c 6f74 5375 6666 2b27 616c 6c54 5769  plotSuff+'allTWi
+0001e060: 6e43 7572 7665 735f 270a 0a20 2020 2020  nCurves_'..     
+0001e070: 2020 2020 2020 2069 6620 6b3d 3d27 7470         if k=='tp
+0001e080: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+0001e090: 2020 2066 6f72 206a 2c20 7420 696e 2065     for j, t in e
+0001e0a0: 6e75 6d65 7261 7465 2868 7673 725f 6469  numerate(hvsr_di
+0001e0b0: 6374 5b27 696e 645f 6876 7372 5f70 6561  ct['ind_hvsr_pea
+0001e0c0: 6b5f 696e 6469 6365 7327 5d29 3a0a 2020  k_indices']):.  
+0001e0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e0e0: 2020 666f 7220 692c 2076 2069 6e20 656e    for i, v in en
+0001e0f0: 756d 6572 6174 6528 7429 3a0a 2020 2020  umerate(t):.    
+0001e100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e110: 2020 2020 763d 2078 5b76 5d0a 2020 2020      v= x[v].    
+0001e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e130: 2020 2020 6966 2069 3d3d 303a 0a20 2020      if i==0:.   
+0001e140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e150: 2020 2020 2020 2020 2077 6964 7468 203d           width =
+0001e160: 2028 785b 692b 315d 2d78 5b69 5d29 2f31   (x[i+1]-x[i])/1
+0001e170: 360a 2020 2020 2020 2020 2020 2020 2020  6.              
+0001e180: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0001e190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e1a0: 2020 2020 2020 2020 2020 2020 7769 6474              widt
+0001e1b0: 6820 3d20 2878 5b69 5d2d 785b 692d 315d  h = (x[i]-x[i-1]
+0001e1c0: 292f 3136 0a20 2020 2020 2020 2020 2020  )/16.           
+0001e1d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001e1e0: 6a20 3d3d 2030 2061 6e64 2069 3d3d 303a  j == 0 and i==0:
+0001e1f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e200: 2020 2020 2020 2020 2020 2020 2061 782e               ax.
+0001e210: 6669 6c6c 5f62 6574 7765 656e 7828 796c  fill_betweenx(yl
+0001e220: 696d 2c76 2d77 6964 7468 2c76 2b77 6964  im,v-width,v+wid
+0001e230: 7468 2c20 636f 6c6f 723d 2772 272c 2061  th, color='r', a
+0001e240: 6c70 6861 3d30 2e30 352c 206c 6162 656c  lpha=0.05, label
+0001e250: 3d27 496e 6469 7669 6475 616c 2048 2f56  ='Individual H/V
+0001e260: 2050 6561 6b73 2729 0a20 2020 2020 2020   Peaks').       
+0001e270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e280: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001e290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e2a0: 2020 6178 2e66 696c 6c5f 6265 7477 6565    ax.fill_betwee
+0001e2b0: 6e78 2879 6c69 6d2c 762d 7769 6474 682c  nx(ylim,v-width,
+0001e2c0: 762b 7769 6474 682c 2063 6f6c 6f72 3d27  v+width, color='
+0001e2d0: 7227 2c20 616c 7068 613d 302e 3035 290a  r', alpha=0.05).
+0001e2e0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001e2f0: 7420 696e 2068 7673 725f 6469 6374 5b27  t in hvsr_dict['
+0001e300: 696e 645f 6876 7372 5f63 7572 7665 7327  ind_hvsr_curves'
+0001e310: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+0001e320: 2020 2061 782e 706c 6f74 2878 2c20 742c     ax.plot(x, t,
+0001e330: 2063 6f6c 6f72 3d27 6b27 2c20 616c 7068   color='k', alph
+0001e340: 613d 302e 3135 2c20 6c69 6e65 7769 6474  a=0.15, linewidt
+0001e350: 683d 302e 382c 206c 696e 6573 7479 6c65  h=0.8, linestyle
+0001e360: 3d27 3a27 290a 0a20 2020 2020 2020 2069  =':')..        i
+0001e370: 6620 2763 2720 696e 206b 3a0a 2020 2020  f 'c' in k:.    
+0001e380: 2020 2020 2020 2020 706c 6f74 5375 6666          plotSuff
+0001e390: 203d 2070 6c6f 7453 7566 662b 2749 6e64   = plotSuff+'Ind
+0001e3a0: 436f 6d70 6f6e 656e 7473 5f27 0a20 2020  Components_'.   
+0001e3b0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0001e3c0: 2020 2020 2020 6966 206b 696e 645b 305d        if kind[0]
+0001e3d0: 2021 3d20 2763 273a 0a20 2020 2020 2020   != 'c':.       
+0001e3e0: 2020 2020 2020 2020 2066 6967 2e74 6967           fig.tig
+0001e3f0: 6874 5f6c 6179 6f75 7428 290a 2020 2020  ht_layout().    
+0001e400: 2020 2020 2020 2020 2020 2020 6178 6973              axis
+0001e410: 3220 3d20 6178 2e74 7769 6e78 2829 0a20  2 = ax.twinx(). 
+0001e420: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001e430: 6f6d 7041 7869 7320 3d20 6178 6973 320a  ompAxis = axis2.
+0001e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e450: 2361 7869 7332 203d 2070 6c74 2e67 6361  #axis2 = plt.gca
+0001e460: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0001e470: 2020 2023 6669 6720 3d20 706c 742e 6763     #fig = plt.gc
+0001e480: 6628 290a 2020 2020 2020 2020 2020 2020  f().            
+0001e490: 2020 2020 636f 6d70 4178 6973 2e73 6574      compAxis.set
+0001e4a0: 5f79 6c61 6265 6c28 2741 6d70 6c69 7475  _ylabel('Amplitu
+0001e4b0: 6465 272b 275c 6e5b 6d32 2f73 342f 487a  de'+'\n[m2/s4/Hz
+0001e4c0: 5d20 5b64 425d 2729 0a20 2020 2020 2020  ] [dB]').       
+0001e4d0: 2020 2020 2020 2020 2063 6f6d 7041 7869           compAxi
+0001e4e0: 732e 7365 745f 6661 6365 636f 6c6f 7228  s.set_facecolor(
+0001e4f0: 5b30 2c30 2c30 2c30 5d29 0a20 2020 2020  [0,0,0,0]).     
+0001e500: 2020 2020 2020 2020 2020 206c 6567 656e             legen
+0001e510: 644c 6f63 3220 3d20 2775 7070 6572 206c  dLoc2 = 'upper l
+0001e520: 6566 7427 0a20 2020 2020 2020 2020 2020  eft'.           
+0001e530: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0001e540: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001e550: 2020 2020 2020 2020 6178 2e73 6574 5f74          ax.set_t
+0001e560: 6974 6c65 2868 7673 725f 6469 6374 5b27  itle(hvsr_dict['
+0001e570: 696e 7075 745f 7061 7261 6d73 275d 5b27  input_params']['
+0001e580: 7369 7465 275d 2b27 3a20 496e 6469 7669  site']+': Indivi
+0001e590: 6475 616c 2043 6f6d 706f 6e65 6e74 7327  dual Components'
+0001e5a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e5b0: 2020 2361 7820 3d20 706c 742e 6763 6128    #ax = plt.gca(
+0001e5c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e5d0: 2020 2366 6967 203d 2070 6c74 2e67 6366    #fig = plt.gcf
+0001e5e0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0001e5f0: 2020 2063 6f6d 7041 7869 7320 3d20 6178     compAxis = ax
+0001e600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e610: 206c 6567 656e 644c 6f63 3220 3d20 2775   legendLoc2 = 'u
+0001e620: 7070 6572 2072 6967 6874 270a 2020 2020  pper right'.    
+0001e630: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0001e640: 2020 2020 2020 2020 206d 696e 5920 3d20           minY = 
+0001e650: 5b5d 0a20 2020 2020 2020 2020 2020 206d  [].            m
+0001e660: 6178 5920 3d20 5b5d 0a20 2020 2020 2020  axY = [].       
+0001e670: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
+0001e680: 6876 7372 5f64 6963 745b 2770 7364 5f76  hvsr_dict['psd_v
+0001e690: 616c 7565 735f 7461 7667 275d 3a0a 2020  alues_tavg']:.  
+0001e6a0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+0001e6b0: 6e59 2e61 7070 656e 6428 6d69 6e28 6876  nY.append(min(hv
+0001e6c0: 7372 5f64 6963 745b 2770 7073 645f 7374  sr_dict['ppsd_st
+0001e6d0: 645f 7661 6c73 5f6d 275d 5b6b 6579 5d29  d_vals_m'][key])
+0001e6e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e6f0: 2020 6d61 7859 2e61 7070 656e 6428 6d61    maxY.append(ma
+0001e700: 7828 6876 7372 5f64 6963 745b 2770 7073  x(hvsr_dict['pps
+0001e710: 645f 7374 645f 7661 6c73 5f70 275d 5b6b  d_std_vals_p'][k
+0001e720: 6579 5d29 290a 2020 2020 2020 2020 2020  ey])).          
+0001e730: 2020 6d69 6e59 203d 206d 696e 286d 696e    minY = min(min
+0001e740: 5929 0a20 2020 2020 2020 2020 2020 206d  Y).            m
+0001e750: 6178 5920 3d20 6d61 7828 6d61 7859 290a  axY = max(maxY).
+0001e760: 2020 2020 2020 2020 2020 2020 726e 6720              rng 
+0001e770: 3d20 6d61 7859 2d6d 696e 590a 2020 2020  = maxY-minY.    
+0001e780: 2020 2020 2020 2020 7061 6420 3d20 726e          pad = rn
+0001e790: 6720 2a20 302e 3035 0a20 2020 2020 2020  g * 0.05.       
+0001e7a0: 2020 2020 2079 6c69 6d20 3d20 5b6d 696e       ylim = [min
+0001e7b0: 592d 7061 642c 206d 6178 592b 7061 645d  Y-pad, maxY+pad]
+0001e7c0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0001e7d0: 2020 2020 2020 636f 6d70 4178 6973 2e73        compAxis.s
+0001e7e0: 6574 5f79 6c61 6265 6c28 2741 6d70 6c69  et_ylabel('Ampli
+0001e7f0: 7475 6465 272b 275c 6e5b 6d32 2f73 342f  tude'+'\n[m2/s4/
+0001e800: 487a 5d20 5b64 425d 2729 0a20 2020 2020  Hz] [dB]').     
+0001e810: 2020 2020 2020 2063 6f6d 7041 7869 732e         compAxis.
+0001e820: 7365 745f 796c 696d 2879 6c69 6d29 0a0a  set_ylim(ylim)..
+0001e830: 2020 2020 2020 2020 2020 2020 234d 6f64              #Mod
+0001e840: 6966 7920 6261 7365 6420 6f6e 2077 6865  ify based on whe
+0001e850: 7468 6572 2074 6865 7265 2061 7265 206d  ther there are m
+0001e860: 756c 7469 706c 6520 6368 6172 7473 0a20  ultiple charts. 
+0001e870: 2020 2020 2020 2020 2020 2069 6620 706c             if pl
+0001e880: 6f74 4856 5352 3a0a 2020 2020 2020 2020  otHVSR:.        
+0001e890: 2020 2020 2020 2020 6c69 6e61 6c70 6861          linalpha
+0001e8a0: 203d 2030 2e32 0a20 2020 2020 2020 2020   = 0.2.         
+0001e8b0: 2020 2020 2020 2073 7464 616c 7068 6120         stdalpha 
+0001e8c0: 3d20 302e 3035 0a20 2020 2020 2020 2020  = 0.05.         
+0001e8d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001e8e0: 2020 2020 2020 2020 206c 696e 616c 7068           linalph
+0001e8f0: 613d 310a 2020 2020 2020 2020 2020 2020  a=1.            
+0001e900: 2020 2020 7374 6461 6c70 6861 3d30 2e32      stdalpha=0.2
+0001e910: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+0001e920: 2020 2020 2020 2020 2020 2350 6c6f 7420            #Plot 
+0001e930: 696e 6469 7669 6475 616c 2063 6f6d 706f  individual compo
+0001e940: 6e65 6e74 730a 2020 2020 2020 2020 2020  nents.          
+0001e950: 2020 793d 7b7d 0a20 2020 2020 2020 2020    y={}.         
+0001e960: 2020 2066 6f72 206b 6579 2069 6e20 6876     for key in hv
+0001e970: 7372 5f64 6963 745b 2770 7364 5f76 616c  sr_dict['psd_val
+0001e980: 7565 735f 7461 7667 275d 3a0a 2020 2020  ues_tavg']:.    
+0001e990: 2020 2020 2020 2020 2020 2020 795b 6b65              y[ke
+0001e9a0: 795d 203d 2068 7673 725f 6469 6374 5b27  y] = hvsr_dict['
+0001e9b0: 7073 645f 7661 6c75 6573 5f74 6176 6727  psd_values_tavg'
+0001e9c0: 5d5b 6b65 795d 5b3a 2d31 5d0a 0a20 2020  ][key][:-1]..   
+0001e9d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001e9e0: 6b65 7920 3d3d 2027 5a27 3a0a 2020 2020  key == 'Z':.    
+0001e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea00: 706c 7443 6f6c 6f72 203d 2027 6b27 0a20  pltColor = 'k'. 
+0001ea10: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001ea20: 6c69 6620 6b65 7920 3d3d 2745 273a 0a20  lif key =='E':. 
+0001ea30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea40: 2020 2070 6c74 436f 6c6f 7220 3d20 2762     pltColor = 'b
+0001ea50: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0001ea60: 2020 656c 6966 206b 6579 203d 3d20 274e    elif key == 'N
+0001ea70: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+0001ea80: 2020 2020 2020 2070 6c74 436f 6c6f 7220         pltColor 
+0001ea90: 3d20 2772 270a 0a20 2020 2020 2020 2020  = 'r'..         
+0001eaa0: 2020 2020 2020 2063 6f6d 7041 7869 732e         compAxis.
+0001eab0: 706c 6f74 2878 2c20 795b 6b65 795d 2c20  plot(x, y[key], 
+0001eac0: 633d 706c 7443 6f6c 6f72 2c20 6c61 6265  c=pltColor, labe
+0001ead0: 6c3d 6b65 792c 2061 6c70 6861 3d6c 696e  l=key, alpha=lin
+0001eae0: 616c 7068 6129 0a20 2020 2020 2020 2020  alpha).         
+0001eaf0: 2020 2020 2020 2069 6620 272d 7327 206e         if '-s' n
+0001eb00: 6f74 2069 6e20 6b69 6e64 3a0a 2020 2020  ot in kind:.    
+0001eb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb20: 636f 6d70 4178 6973 2e66 696c 6c5f 6265  compAxis.fill_be
+0001eb30: 7477 6565 6e28 782c 2068 7673 725f 6469  tween(x, hvsr_di
+0001eb40: 6374 5b27 7070 7364 5f73 7464 5f76 616c  ct['ppsd_std_val
+0001eb50: 735f 6d27 5d5b 6b65 795d 5b3a 2d31 5d2c  s_m'][key][:-1],
+0001eb60: 2068 7673 725f 6469 6374 5b27 7070 7364   hvsr_dict['ppsd
+0001eb70: 5f73 7464 5f76 616c 735f 7027 5d5b 6b65  _std_vals_p'][ke
+0001eb80: 795d 5b3a 2d31 5d2c 2063 6f6c 6f72 3d70  y][:-1], color=p
+0001eb90: 6c74 436f 6c6f 722c 2061 6c70 6861 3d73  ltColor, alpha=s
+0001eba0: 7464 616c 7068 6129 0a20 2020 2020 2020  tdalpha).       
+0001ebb0: 2020 2020 2020 2020 2069 6620 6b69 6e64           if kind
+0001ebc0: 5b30 5d20 213d 2027 6327 3a0a 2020 2020  [0] != 'c':.    
+0001ebd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ebe0: 636f 6d70 4178 6973 2e6c 6567 656e 6428  compAxis.legend(
+0001ebf0: 6c6f 633d 6c65 6765 6e64 4c6f 6332 290a  loc=legendLoc2).
+0001ec00: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001ec10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ec20: 2020 7061 7373 2361 782e 6c65 6765 6e64    pass#ax.legend
+0001ec30: 286c 6f63 3d6c 6567 656e 644c 6f63 290a  (loc=legendLoc).
+0001ec40: 0a20 2020 2062 626f 7820 3d20 6178 2e67  .    bbox = ax.g
+0001ec50: 6574 5f77 696e 646f 775f 6578 7465 6e74  et_window_extent
+0001ec60: 2829 0a20 2020 2062 626f 7853 7461 7274  ().    bboxStart
+0001ec70: 203d 2062 626f 782e 5f5f 7374 725f 5f28   = bbox.__str__(
+0001ec80: 292e 6669 6e64 2827 4262 6f78 2827 2c30  ).find('Bbox(',0
+0001ec90: 2c35 3029 2b35 0a20 2020 2062 626f 7853  ,50)+5.    bboxS
+0001eca0: 7472 203d 2062 626f 782e 5f5f 7374 725f  tr = bbox.__str_
+0001ecb0: 5f28 295b 6262 6f78 5374 6172 743a 5d2e  _()[bboxStart:].
+0001ecc0: 7370 6c69 7428 272c 2729 5b3a 345d 0a20  split(',')[:4]. 
+0001ecd0: 2020 2061 7869 7362 6f78 203d 205b 5d0a     axisbox = [].
+0001ece0: 2020 2020 666f 7220 6920 696e 2062 626f      for i in bbo
+0001ecf0: 7853 7472 3a0a 2020 2020 2020 2020 6920  xStr:.        i 
+0001ed00: 3d20 692e 7370 6c69 7428 273d 2729 5b31  = i.split('=')[1
+0001ed10: 5d0a 2020 2020 2020 2020 6966 2027 2927  ].        if ')'
+0001ed20: 2069 6e20 693a 0a20 2020 2020 2020 2020   in i:.         
+0001ed30: 2020 2069 203d 2069 5b3a 2d31 5d0a 2020     i = i[:-1].  
+0001ed40: 2020 2020 2020 6178 6973 626f 782e 6170        axisbox.ap
+0001ed50: 7065 6e64 2866 6c6f 6174 2869 2929 0a20  pend(float(i)). 
+0001ed60: 2020 2023 7072 696e 7428 6178 6973 626f     #print(axisbo
+0001ed70: 7829 0a20 2020 2023 7072 696e 7428 6178  x).    #print(ax
+0001ed80: 2e67 6574 5f70 6f73 6974 696f 6e28 2929  .get_position())
+0001ed90: 0a0a 2020 2020 6178 2e6c 6567 656e 6428  ..    ax.legend(
+0001eda0: 6c6f 633d 6c65 6765 6e64 4c6f 6329 0a0a  loc=legendLoc)..
+0001edb0: 2020 2020 5f5f 706c 6f74 5f63 7572 7265      __plot_curre
+0001edc0: 6e74 5f66 6967 2873 6176 655f 6469 723d  nt_fig(save_dir=
+0001edd0: 7361 7665 5f64 6972 2c20 0a20 2020 2020  save_dir, .     
+0001ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001edf0: 2020 2066 696c 656e 616d 653d 6669 6c65     filename=file
+0001ee00: 6e61 6d65 2c20 0a20 2020 2020 2020 2020  name, .         
+0001ee10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001ee20: 6967 3d66 6967 2c20 6178 3d61 782c 0a20  ig=fig, ax=ax,. 
+0001ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee40: 2020 2020 2020 2070 6c6f 745f 7375 6666         plot_suff
+0001ee50: 6978 3d70 6c6f 7453 7566 662c 200a 2020  ix=plotSuff, .  
+0001ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee70: 2020 2020 2020 7573 6572 5f73 7566 6669        user_suffi
+0001ee80: 783d 7361 7665 5f73 7566 6669 782c 200a  x=save_suffix, .
+0001ee90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eea0: 2020 2020 2020 2020 7368 6f77 3d73 686f          show=sho
+0001eeb0: 7729 0a20 2020 200a 2020 2020 7265 7475  w).    .    retu
+0001eec0: 726e 2066 6967 2c20 6178 0a0a 2350 7269  rn fig, ax..#Pri
+0001eed0: 7661 7465 2066 756e 6374 696f 6e20 746f  vate function to
+0001eee0: 2068 656c 7020 666f 7220 7768 656e 2074   help for when t
+0001eef0: 6f20 7368 6f77 2061 6e64 2066 6f72 6d61  o show and forma
+0001ef00: 7420 616e 6420 7361 7665 2070 6c6f 7473  t and save plots
+0001ef10: 0a64 6566 205f 5f70 6c6f 745f 6375 7272  .def __plot_curr
+0001ef20: 656e 745f 6669 6728 7361 7665 5f64 6972  ent_fig(save_dir
+0001ef30: 2c20 6669 6c65 6e61 6d65 2c20 6669 672c  , filename, fig,
+0001ef40: 2061 782c 2070 6c6f 745f 7375 6666 6978   ax, plot_suffix
+0001ef50: 2c20 7573 6572 5f73 7566 6669 782c 2073  , user_suffix, s
+0001ef60: 686f 7729 3a0a 2020 2020 2222 2250 7269  how):.    """Pri
+0001ef70: 7661 7465 2066 756e 6374 696f 6e20 746f  vate function to
+0001ef80: 2073 7570 706f 7274 2068 7670 6c6f 742c   support hvplot,
+0001ef90: 2066 6f72 2070 6c6f 7474 696e 6720 616e   for plotting an
+0001efa0: 6420 7368 6f77 696e 6720 706c 6f74 7322  d showing plots"
+0001efb0: 2222 0a20 2020 2023 706c 742e 6763 6128  "".    #plt.gca(
+0001efc0: 290a 2020 2020 2370 6c74 2e67 6366 2829  ).    #plt.gcf()
+0001efd0: 0a20 2020 2066 6967 2e74 6967 6874 5f6c  .    fig.tight_l
+0001efe0: 6179 6f75 7428 290a 0a20 2020 2023 706c  ayout()..    #pl
+0001eff0: 742e 7375 6270 6c6f 7473 5f61 646a 7573  t.subplots_adjus
+0001f000: 7428 746f 7020 3d20 312c 2062 6f74 746f  t(top = 1, botto
+0001f010: 6d20 3d20 302c 2072 6967 6874 203d 2031  m = 0, right = 1
+0001f020: 2c20 6c65 6674 203d 2030 2c20 6873 7061  , left = 0, hspa
+0001f030: 6365 203d 2030 2c20 7773 7061 6365 203d  ce = 0, wspace =
+0001f040: 2030 290a 0a20 2020 2069 6620 7361 7665   0)..    if save
+0001f050: 5f64 6972 2069 7320 6e6f 7420 4e6f 6e65  _dir is not None
+0001f060: 3a0a 2020 2020 2020 2020 6f75 7446 696c  :.        outFil
+0001f070: 6520 3d20 7361 7665 5f64 6972 2b27 2f27  e = save_dir+'/'
+0001f080: 2b66 696c 656e 616d 652b 275f 272b 706c  +filename+'_'+pl
+0001f090: 6f74 5f73 7566 6669 782b 7374 7228 6461  ot_suffix+str(da
+0001f0a0: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
+0001f0b0: 746f 6461 7928 292e 6461 7465 2829 292b  today().date())+
+0001f0c0: 275f 272b 7573 6572 5f73 7566 6669 782b  '_'+user_suffix+
+0001f0d0: 272e 706e 6727 0a20 2020 2020 2020 2066  '.png'.        f
+0001f0e0: 6967 2e73 6176 6566 6967 286f 7574 4669  ig.savefig(outFi
+0001f0f0: 6c65 2c20 6262 6f78 5f69 6e63 6865 733d  le, bbox_inches=
+0001f100: 2774 6967 6874 272c 2070 6164 5f69 6e63  'tight', pad_inc
+0001f110: 6865 733d 302e 3229 0a20 2020 2069 6620  hes=0.2).    if 
+0001f120: 7368 6f77 3a0a 2020 2020 2020 2020 6669  show:.        fi
+0001f130: 672e 6361 6e76 6173 2e64 7261 7728 2923  g.canvas.draw()#
+0001f140: 2e73 686f 7728 290a 2020 2020 2020 2020  .show().        
+0001f150: 6669 672e 7469 6768 745f 6c61 796f 7574  fig.tight_layout
+0001f160: 2829 0a20 2020 2020 2020 2023 706c 742e  ().        #plt.
+0001f170: 696f 6e28 290a 2020 2020 7265 7475 726e  ion().    return
+0001f180: 0a0a 2350 6c6f 7420 7370 6563 6774 726f  ..#Plot specgtro
+0001f190: 6772 616d 2c20 7072 6976 6174 6520 7375  gram, private su
+0001f1a0: 7070 6f72 7469 6e67 2066 756e 6374 696f  pporting functio
+0001f1b0: 6e20 666f 7220 6876 706c 6f74 0a64 6566  n for hvplot.def
+0001f1c0: 2070 6c6f 745f 7370 6563 6772 616d 5f68   plot_specgram_h
+0001f1d0: 7673 7228 6876 7372 5f64 6963 742c 2066  vsr(hvsr_dict, f
+0001f1e0: 6967 3d4e 6f6e 652c 2061 783d 4e6f 6e65  ig=None, ax=None
+0001f1f0: 2c20 7361 7665 5f64 6972 3d4e 6f6e 652c  , save_dir=None,
+0001f200: 2073 6176 655f 7375 6666 6978 3d27 272c   save_suffix='',
+0001f210: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
+0001f220: 2222 5072 6976 6174 6520 6675 6e63 7469  ""Private functi
+0001f230: 6f6e 2066 6f72 2070 6c6f 7474 696e 6720  on for plotting 
+0001f240: 6176 6572 6167 6520 7370 6563 7472 6f67  average spectrog
+0001f250: 7261 6d20 6f66 2061 6c6c 2074 6872 6565  ram of all three
+0001f260: 2063 6861 6e6e 656c 7320 6672 6f6d 2070   channels from p
+0001f270: 7073 6473 0a20 2020 2022 2222 0a20 2020  psds.    """.   
+0001f280: 2069 6620 6669 6720 6973 204e 6f6e 6520   if fig is None 
+0001f290: 616e 6420 6178 2069 7320 4e6f 6e65 3a0a  and ax is None:.
+0001f2a0: 2020 2020 2020 2020 6669 672c 2061 7820          fig, ax 
+0001f2b0: 3d20 706c 742e 7375 6270 6c6f 7473 2829  = plt.subplots()
+0001f2c0: 2020 2020 0a0a 2020 2020 6966 2027 6b77      ..    if 'kw
+0001f2d0: 6172 6773 2720 696e 206b 7761 7267 732e  args' in kwargs.
+0001f2e0: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
+0001f2f0: 6b77 6172 6773 203d 206b 7761 7267 735b  kwargs = kwargs[
+0001f300: 276b 7761 7267 7327 5d0a 0a20 2020 2069  'kwargs']..    i
+0001f310: 6620 2770 6561 6b5f 706c 6f74 2720 696e  f 'peak_plot' in
+0001f320: 206b 7761 7267 732e 6b65 7973 2829 3a0a   kwargs.keys():.
+0001f330: 2020 2020 2020 2020 7065 616b 5f70 6c6f          peak_plo
+0001f340: 743d 5472 7565 0a20 2020 2020 2020 2064  t=True.        d
+0001f350: 656c 206b 7761 7267 735b 2770 6561 6b5f  el kwargs['peak_
+0001f360: 706c 6f74 275d 0a20 2020 2065 6c73 653a  plot'].    else:
+0001f370: 0a20 2020 2020 2020 2070 6561 6b5f 706c  .        peak_pl
+0001f380: 6f74 3d46 616c 7365 0a20 2020 2020 2020  ot=False.       
+0001f390: 200a 0a20 2020 2069 6620 2767 7269 6427   ..    if 'grid'
+0001f3a0: 2069 6e20 6b77 6172 6773 2e6b 6579 7328   in kwargs.keys(
+0001f3b0: 293a 0a20 2020 2020 2020 2061 782e 6772  ):.        ax.gr
+0001f3c0: 6964 2877 6869 6368 3d6b 7761 7267 735b  id(which=kwargs[
+0001f3d0: 2767 7269 6427 5d2c 2061 6c70 6861 3d30  'grid'], alpha=0
+0001f3e0: 2e32 3529 0a20 2020 2020 2020 2064 656c  .25).        del
+0001f3f0: 206b 7761 7267 735b 2767 7269 6427 5d0a   kwargs['grid'].
+0001f400: 2020 2020 2020 2020 0a20 2020 2069 6620          .    if 
+0001f410: 2779 7479 7065 2720 696e 206b 7761 7267  'ytype' in kwarg
+0001f420: 733a 0a20 2020 2020 2020 2069 6620 6b77  s:.        if kw
+0001f430: 6172 6773 5b27 7974 7970 6527 5d3d 3d27  args['ytype']=='
+0001f440: 6672 6571 273a 0a20 2020 2020 2020 2020  freq':.         
+0001f450: 2020 2079 6c61 6265 6c20 3d20 2746 7265     ylabel = 'Fre
+0001f460: 7175 656e 6379 205b 487a 5d27 0a20 2020  quency [Hz]'.   
+0001f470: 2020 2020 2020 2020 2064 656c 206b 7761           del kwa
+0001f480: 7267 735b 2779 7479 7065 275d 0a20 2020  rgs['ytype'].   
+0001f490: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001f4a0: 2020 2020 2020 2079 6c61 6265 6c20 3d20         ylabel = 
+0001f4b0: 2750 6572 696f 6420 5b73 5d27 0a20 2020  'Period [s]'.   
+0001f4c0: 2020 2020 2064 656c 206b 7761 7267 735b       del kwargs[
+0001f4d0: 2779 7479 7065 275d 0a20 2020 2065 6c73  'ytype'].    els
+0001f4e0: 653a 0a20 2020 2020 2020 2079 6c61 6265  e:.        ylabe
+0001f4f0: 6c3d 2746 7265 7175 656e 6379 205b 487a  l='Frequency [Hz
+0001f500: 5d27 0a20 2020 2020 2020 200a 2020 2020  ]'.        .    
+0001f510: 6966 2027 6465 7472 656e 6427 2069 6e20  if 'detrend' in 
+0001f520: 6b77 6172 6773 2e6b 6579 7328 293a 0a20  kwargs.keys():. 
+0001f530: 2020 2020 2020 2064 6574 7265 6e64 3d20         detrend= 
+0001f540: 6b77 6172 6773 5b27 6465 7472 656e 6427  kwargs['detrend'
+0001f550: 5d0a 2020 2020 2020 2020 6465 6c20 6b77  ].        del kw
+0001f560: 6172 6773 5b27 6465 7472 656e 6427 5d0a  args['detrend'].
+0001f570: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001f580: 2020 6465 7472 656e 643d 5472 7565 0a0a    detrend=True..
+0001f590: 2020 2020 6966 2027 636f 6c6f 7262 6172      if 'colorbar
+0001f5a0: 2720 696e 206b 7761 7267 732e 6b65 7973  ' in kwargs.keys
+0001f5b0: 2829 3a0a 2020 2020 2020 2020 636f 6c6f  ():.        colo
+0001f5c0: 7262 6172 203d 206b 7761 7267 735b 2763  rbar = kwargs['c
+0001f5d0: 6f6c 6f72 6261 7227 5d0a 2020 2020 2020  olorbar'].      
+0001f5e0: 2020 6465 6c20 6b77 6172 6773 5b27 636f    del kwargs['co
+0001f5f0: 6c6f 7262 6172 275d 0a20 2020 2065 6c73  lorbar'].    els
+0001f600: 653a 0a20 2020 2020 2020 2063 6f6c 6f72  e:.        color
+0001f610: 6261 723d 5472 7565 0a0a 2020 2020 6966  bar=True..    if
+0001f620: 2027 636d 6170 2720 696e 206b 7761 7267   'cmap' in kwarg
+0001f630: 732e 6b65 7973 2829 3a0a 2020 2020 2020  s.keys():.      
+0001f640: 2020 7061 7373 0a20 2020 2065 6c73 653a    pass.    else:
+0001f650: 0a20 2020 2020 2020 206b 7761 7267 735b  .        kwargs[
+0001f660: 2763 6d61 7027 5d20 3d20 2774 7572 626f  'cmap'] = 'turbo
+0001f670: 270a 0a20 2020 2070 7073 6473 203d 2068  '..    ppsds = h
+0001f680: 7673 725f 6469 6374 5b27 7070 7364 7327  vsr_dict['ppsds'
+0001f690: 5d23 5b6b 5d5b 2763 7572 7265 6e74 5f74  ]#[k]['current_t
+0001f6a0: 696d 6573 5f75 7365 6427 5d0a 2020 2020  imes_used'].    
+0001f6b0: 696d 706f 7274 206d 6174 706c 6f74 6c69  import matplotli
+0001f6c0: 622e 6461 7465 7320 6173 206d 6461 7465  b.dates as mdate
+0001f6d0: 730a 2020 2020 616e 794b 6579 203d 206c  s.    anyKey = l
+0001f6e0: 6973 7428 7070 7364 732e 6b65 7973 2829  ist(ppsds.keys()
+0001f6f0: 295b 305d 0a0a 2020 2020 7073 6448 4c69  )[0]..    psdHLi
+0001f700: 7374 203d 5b5d 0a20 2020 2070 7364 5a4c  st =[].    psdZL
+0001f710: 6973 7420 3d5b 5d0a 2020 2020 666f 7220  ist =[].    for 
+0001f720: 6b20 696e 2068 7673 725f 6469 6374 5b27  k in hvsr_dict['
+0001f730: 7073 645f 7261 7727 5d3a 0a20 2020 2020  psd_raw']:.     
+0001f740: 2020 2069 6620 277a 2720 696e 206b 2e6c     if 'z' in k.l
+0001f750: 6f77 6572 2829 3a0a 2020 2020 2020 2020  ower():.        
+0001f760: 2020 2020 7073 645a 4c69 7374 2e61 7070      psdZList.app
+0001f770: 656e 6428 6876 7372 5f64 6963 745b 2770  end(hvsr_dict['p
+0001f780: 7364 5f72 6177 275d 5b6b 5d29 2020 2020  sd_raw'][k])    
+0001f790: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0001f7a0: 2020 2020 2020 2020 2020 2070 7364 484c             psdHL
+0001f7b0: 6973 742e 6170 7065 6e64 2868 7673 725f  ist.append(hvsr_
+0001f7c0: 6469 6374 5b27 7073 645f 7261 7727 5d5b  dict['psd_raw'][
+0001f7d0: 6b5d 290a 2020 2020 0a20 2020 2023 6966  k]).    .    #if
+0001f7e0: 2064 6574 7265 6e64 3a0a 2020 2020 2320   detrend:.    # 
+0001f7f0: 2020 2070 7364 4172 7220 3d20 6e70 2e73     psdArr = np.s
+0001f800: 7562 7472 6163 7428 7073 6441 7272 2c20  ubtract(psdArr, 
+0001f810: 6e70 2e6d 6564 6961 6e28 7073 6441 7272  np.median(psdArr
+0001f820: 2c20 6178 6973 3d30 2929 0a20 2020 2070  , axis=0)).    p
+0001f830: 7364 4172 7220 3d20 6876 7372 5f64 6963  sdArr = hvsr_dic
+0001f840: 745b 2769 6e64 5f68 7673 725f 6375 7276  t['ind_hvsr_curv
+0001f850: 6573 275d 2e54 0a0a 2020 2020 786d 696e  es'].T..    xmin
+0001f860: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
+0001f870: 7469 6d65 2e73 7472 7074 696d 6528 6d69  time.strptime(mi
+0001f880: 6e28 6876 7372 5f64 6963 745b 2770 7073  n(hvsr_dict['pps
+0001f890: 6473 275d 5b61 6e79 4b65 795d 5b27 6375  ds'][anyKey]['cu
+0001f8a0: 7272 656e 745f 7469 6d65 735f 7573 6564  rrent_times_used
+0001f8b0: 275d 5b3a 2d31 5d29 2e69 736f 666f 726d  '][:-1]).isoform
+0001f8c0: 6174 2829 2c20 2725 592d 256d 2d25 6454  at(), '%Y-%m-%dT
+0001f8d0: 2548 3a25 4d3a 2553 2e25 6627 290a 2020  %H:%M:%S.%f').  
+0001f8e0: 2020 786d 6178 203d 2064 6174 6574 696d    xmax = datetim
+0001f8f0: 652e 6461 7465 7469 6d65 2e73 7472 7074  e.datetime.strpt
+0001f900: 696d 6528 6d61 7828 6876 7372 5f64 6963  ime(max(hvsr_dic
+0001f910: 745b 2770 7073 6473 275d 5b61 6e79 4b65  t['ppsds'][anyKe
+0001f920: 795d 5b27 6375 7272 656e 745f 7469 6d65  y]['current_time
+0001f930: 735f 7573 6564 275d 5b3a 2d31 5d29 2e69  s_used'][:-1]).i
+0001f940: 736f 666f 726d 6174 2829 2c20 2725 592d  soformat(), '%Y-
+0001f950: 256d 2d25 6454 2548 3a25 4d3a 2553 2e25  %m-%dT%H:%M:%S.%
+0001f960: 6627 290a 2020 2020 786d 696e 203d 206d  f').    xmin = m
+0001f970: 6461 7465 732e 6461 7465 326e 756d 2878  dates.date2num(x
+0001f980: 6d69 6e29 0a20 2020 2078 6d61 7820 3d20  min).    xmax = 
+0001f990: 6d64 6174 6573 2e64 6174 6532 6e75 6d28  mdates.date2num(
+0001f9a0: 786d 6178 290a 0a20 2020 2074 5469 636b  xmax)..    tTick
+0001f9b0: 7320 3d20 6d64 6174 6573 2e4d 696e 7574  s = mdates.Minut
+0001f9c0: 654c 6f63 6174 6f72 2862 796d 696e 7574  eLocator(byminut
+0001f9d0: 653d 7261 6e67 6528 302c 3630 2c35 2929  e=range(0,60,5))
+0001f9e0: 0a20 2020 2061 782e 7861 7869 732e 7365  .    ax.xaxis.se
+0001f9f0: 745f 6d61 6a6f 725f 6c6f 6361 746f 7228  t_major_locator(
+0001fa00: 7454 6963 6b73 290a 2020 2020 7454 6963  tTicks).    tTic
+0001fa10: 6b73 5f6d 696e 6f72 203d 206d 6461 7465  ks_minor = mdate
+0001fa20: 732e 5365 636f 6e64 4c6f 6361 746f 7228  s.SecondLocator(
+0001fa30: 6279 7365 636f 6e64 3d5b 305d 290a 2020  bysecond=[0]).  
+0001fa40: 2020 6178 2e78 6178 6973 2e73 6574 5f6d    ax.xaxis.set_m
+0001fa50: 696e 6f72 5f6c 6f63 6174 6f72 2874 5469  inor_locator(tTi
+0001fa60: 636b 735f 6d69 6e6f 7229 0a0a 2020 2020  cks_minor)..    
+0001fa70: 744c 6162 656c 7320 3d20 6d64 6174 6573  tLabels = mdates
+0001fa80: 2e44 6174 6546 6f72 6d61 7474 6572 2827  .DateFormatter('
+0001fa90: 2548 3a25 4d27 290a 2020 2020 6178 2e78  %H:%M').    ax.x
+0001faa0: 6178 6973 2e73 6574 5f6d 616a 6f72 5f66  axis.set_major_f
+0001fab0: 6f72 6d61 7474 6572 2874 4c61 6265 6c73  ormatter(tLabels
+0001fac0: 290a 2020 2020 6178 2e74 6963 6b5f 7061  ).    ax.tick_pa
+0001fad0: 7261 6d73 2861 7869 733d 2778 272c 206c  rams(axis='x', l
+0001fae0: 6162 656c 7369 7a65 3d38 290a 0a20 2020  abelsize=8)..   
+0001faf0: 2069 6620 6876 7372 5f64 6963 745b 2770   if hvsr_dict['p
+0001fb00: 7073 6473 275d 5b61 6e79 4b65 795d 5b27  psds'][anyKey]['
+0001fb10: 6375 7272 656e 745f 7469 6d65 735f 7573  current_times_us
+0001fb20: 6564 275d 5b30 5d2e 6461 7465 2021 3d20  ed'][0].date != 
+0001fb30: 6876 7372 5f64 6963 745b 2770 7073 6473  hvsr_dict['ppsds
+0001fb40: 275d 5b61 6e79 4b65 795d 5b27 6375 7272  '][anyKey]['curr
+0001fb50: 656e 745f 7469 6d65 735f 7573 6564 275d  ent_times_used']
+0001fb60: 5b2d 315d 2e64 6174 653a 0a20 2020 2020  [-1].date:.     
+0001fb70: 2020 2064 6179 203d 2073 7472 2868 7673     day = str(hvs
+0001fb80: 725f 6469 6374 5b27 7070 7364 7327 5d5b  r_dict['ppsds'][
+0001fb90: 616e 794b 6579 5d5b 2763 7572 7265 6e74  anyKey]['current
+0001fba0: 5f74 696d 6573 5f75 7365 6427 5d5b 305d  _times_used'][0]
+0001fbb0: 2e64 6174 6529 2b27 202d 2027 2b73 7472  .date)+' - '+str
+0001fbc0: 2868 7673 725f 6469 6374 5b27 7070 7364  (hvsr_dict['ppsd
+0001fbd0: 7327 5d5b 616e 794b 6579 5d5b 2763 7572  s'][anyKey]['cur
+0001fbe0: 7265 6e74 5f74 696d 6573 5f75 7365 6427  rent_times_used'
+0001fbf0: 5d5b 315d 2e64 6174 6529 0a20 2020 2065  ][1].date).    e
+0001fc00: 6c73 653a 0a20 2020 2020 2020 2064 6179  lse:.        day
+0001fc10: 203d 2073 7472 2868 7673 725f 6469 6374   = str(hvsr_dict
+0001fc20: 5b27 7070 7364 7327 5d5b 616e 794b 6579  ['ppsds'][anyKey
+0001fc30: 5d5b 2763 7572 7265 6e74 5f74 696d 6573  ]['current_times
+0001fc40: 5f75 7365 6427 5d5b 305d 2e64 6174 6529  _used'][0].date)
+0001fc50: 0a0a 2020 2020 796d 696e 203d 2068 7673  ..    ymin = hvs
+0001fc60: 725f 6469 6374 5b27 696e 7075 745f 7061  r_dict['input_pa
+0001fc70: 7261 6d73 275d 5b27 6876 7372 5f62 616e  rams']['hvsr_ban
+0001fc80: 6427 5d5b 305d 0a20 2020 2079 6d61 7820  d'][0].    ymax 
+0001fc90: 3d20 6876 7372 5f64 6963 745b 2769 6e70  = hvsr_dict['inp
+0001fca0: 7574 5f70 6172 616d 7327 5d5b 2768 7673  ut_params']['hvs
+0001fcb0: 725f 6261 6e64 275d 5b31 5d0a 0a20 2020  r_band'][1]..   
+0001fcc0: 2065 7874 4c69 7374 203d 205b 786d 696e   extList = [xmin
+0001fcd0: 2c20 786d 6178 2c20 796d 696e 2c20 796d  , xmax, ymin, ym
+0001fce0: 6178 5d0a 2020 0a20 2020 2023 6178 203d  ax].  .    #ax =
+0001fcf0: 2070 6c74 2e67 6361 2829 0a20 2020 2023   plt.gca().    #
+0001fd00: 6669 6720 3d20 706c 742e 6763 6628 290a  fig = plt.gcf().
+0001fd10: 0a20 2020 2066 7265 7174 6963 6b73 203d  .    freqticks =
+0001fd20: 206e 702e 666c 6970 2868 7673 725f 6469   np.flip(hvsr_di
+0001fd30: 6374 5b27 785f 6672 6571 7327 5d5b 616e  ct['x_freqs'][an
+0001fd40: 794b 6579 5d29 0a20 2020 2079 6d69 6e69  yKey]).    ymini
+0001fd50: 6e64 203d 206e 702e 6172 676d 696e 286e  nd = np.argmin(n
+0001fd60: 702e 6162 7328 796d 696e 2d66 7265 7174  p.abs(ymin-freqt
+0001fd70: 6963 6b73 2929 0a20 2020 2079 6d61 7869  icks)).    ymaxi
+0001fd80: 6e64 203d 206e 702e 6172 676d 696e 286e  nd = np.argmin(n
+0001fd90: 702e 6162 7328 796d 6178 2d66 7265 7174  p.abs(ymax-freqt
+0001fda0: 6963 6b73 2929 0a20 2020 2066 7265 7174  icks)).    freqt
+0001fdb0: 6963 6b73 203d 2066 7265 7174 6963 6b73  icks = freqticks
+0001fdc0: 5b79 6d69 6e69 6e64 3a79 6d61 7869 6e64  [yminind:ymaxind
+0001fdd0: 5d0a 0a20 2020 2023 5365 7420 7570 2061  ]..    #Set up a
+0001fde0: 7865 732c 2073 696e 6365 2064 6174 6120  xes, since data 
+0001fdf0: 6973 2061 6c72 6561 6479 2069 6e20 7365  is already in se
+0001fe00: 6d69 6c6f 670a 2020 2020 6178 7920 3d20  milog.    axy = 
+0001fe10: 6178 2e74 7769 6e78 2829 0a20 2020 2061  ax.twinx().    a
+0001fe20: 7879 2e7a 6f72 6465 723d 300a 2020 2020  xy.zorder=0.    
+0001fe30: 6178 2e7a 6f72 6465 723d 310a 2020 2020  ax.zorder=1.    
+0001fe40: 6178 2e73 6574 5f66 6163 6563 6f6c 6f72  ax.set_facecolor
+0001fe50: 2827 2366 6666 6666 6630 3027 2920 2343  ('#ffffff00') #C
+0001fe60: 7265 6174 6520 7472 616e 7370 6172 656e  reate transparen
+0001fe70: 7420 6261 636b 6772 6f75 6e64 2066 6f72  t background for
+0001fe80: 2066 726f 6e74 2061 7869 730a 2020 2020   front axis.    
+0001fe90: 2370 6c74 2e73 6361 2861 7879 290a 2020  #plt.sca(axy).  
+0001fea0: 2020 696d 203d 2061 782e 696d 7368 6f77    im = ax.imshow
+0001feb0: 2870 7364 4172 722c 206f 7269 6769 6e3d  (psdArr, origin=
+0001fec0: 276c 6f77 6572 272c 2065 7874 656e 743d  'lower', extent=
+0001fed0: 6578 744c 6973 742c 2061 7370 6563 743d  extList, aspect=
+0001fee0: 2761 7574 6f27 2c20 696e 7465 7270 6f6c  'auto', interpol
+0001fef0: 6174 696f 6e3d 276e 6561 7265 7374 272c  ation='nearest',
+0001ff00: 202a 2a6b 7761 7267 7329 0a20 2020 2061   **kwargs).    a
+0001ff10: 782e 7469 636b 5f70 6172 616d 7328 6c65  x.tick_params(le
+0001ff20: 6674 3d46 616c 7365 2c20 7269 6768 743d  ft=False, right=
+0001ff30: 4661 6c73 6529 0a20 2020 2061 782e 7365  False).    ax.se
+0001ff40: 745f 7974 6963 6b73 285b 5d2c 206c 6162  t_yticks([], lab
+0001ff50: 656c 733d 2727 290a 2020 2020 2370 6c74  els='').    #plt
+0001ff60: 2e73 6361 2861 7829 0a20 2020 2069 6620  .sca(ax).    if 
+0001ff70: 7065 616b 5f70 6c6f 743a 0a20 2020 2020  peak_plot:.     
+0001ff80: 2020 2061 782e 686c 696e 6573 2868 7673     ax.hlines(hvs
+0001ff90: 725f 6469 6374 5b27 4265 7374 2050 6561  r_dict['Best Pea
+0001ffa0: 6b27 5d5b 2766 3027 5d2c 2078 6d69 6e2c  k']['f0'], xmin,
+0001ffb0: 2078 6d61 782c 2063 6f6c 6f72 733d 276b   xmax, colors='k
+0001ffc0: 272c 206c 696e 6573 7479 6c65 733d 2764  ', linestyles='d
+0001ffd0: 6173 6865 6427 2c20 616c 7068 613d 302e  ashed', alpha=0.
+0001ffe0: 3529 0a0a 2020 2020 2346 7265 7154 6963  5)..    #FreqTic
+0001fff0: 6b73 203d 6e70 2e61 7261 6e67 6528 312c  ks =np.arange(1,
+00020000: 6e70 2e72 6f75 6e64 286d 6178 2868 7673  np.round(max(hvs
+00020010: 725f 6469 6374 5b27 785f 6672 6571 7327  r_dict['x_freqs'
+00020020: 5d5b 616e 794b 6579 5d29 2c30 292c 2031  ][anyKey]),0), 1
+00020030: 3029 0a20 2020 2061 782e 7365 745f 7469  0).    ax.set_ti
+00020040: 746c 6528 6876 7372 5f64 6963 745b 2769  tle(hvsr_dict['i
+00020050: 6e70 7574 5f70 6172 616d 7327 5d5b 2773  nput_params']['s
+00020060: 6974 6527 5d2b 273a 2053 7065 6374 726f  ite']+': Spectro
+00020070: 6772 616d 2729 0a20 2020 2061 782e 7365  gram').    ax.se
+00020080: 745f 786c 6162 656c 2827 5554 4320 5469  t_xlabel('UTC Ti
+00020090: 6d65 205c 6e27 2b64 6179 290a 2020 2020  me \n'+day).    
+000200a0: 0a20 2020 2069 6620 636f 6c6f 7262 6172  .    if colorbar
+000200b0: 3a0a 2020 2020 2020 2020 6362 6172 203d  :.        cbar =
+000200c0: 2070 6c74 2e63 6f6c 6f72 6261 7228 6d61   plt.colorbar(ma
+000200d0: 7070 6162 6c65 3d69 6d29 0a20 2020 2020  ppable=im).     
+000200e0: 2020 2063 6261 722e 7365 745f 6c61 6265     cbar.set_labe
+000200f0: 6c28 2748 2f56 2052 6174 696f 2729 0a0a  l('H/V Ratio')..
+00020100: 2020 2020 6178 2e73 6574 5f79 6c61 6265      ax.set_ylabe
+00020110: 6c28 796c 6162 656c 290a 2020 2020 2370  l(ylabel).    #p
+00020120: 6c74 2e79 7469 636b 7328 6672 6571 7469  lt.yticks(freqti
+00020130: 636b 7329 0a20 2020 2023 6178 2e73 656d  cks).    #ax.sem
+00020140: 696c 6f67 7928 290a 2020 2020 6178 2e73  ilogy().    ax.s
+00020150: 6574 5f79 6c69 6d28 6876 7372 5f64 6963  et_ylim(hvsr_dic
+00020160: 745b 2769 6e70 7574 5f70 6172 616d 7327  t['input_params'
+00020170: 5d5b 2768 7673 725f 6261 6e64 275d 290a  ]['hvsr_band']).
+00020180: 0a20 2020 2023 706c 742e 7263 5061 7261  .    #plt.rcPara
+00020190: 6d73 5b27 6669 6775 7265 2e64 7069 275d  ms['figure.dpi']
+000201a0: 203d 2035 3030 0a20 2020 2023 706c 742e   = 500.    #plt.
+000201b0: 7263 5061 7261 6d73 5b27 6669 6775 7265  rcParams['figure
+000201c0: 2e66 6967 7369 7a65 275d 203d 2028 3132  .figsize'] = (12
+000201d0: 2c34 290a 2020 2020 6669 672e 6361 6e76  ,4).    fig.canv
+000201e0: 6173 2e64 7261 7728 290a 2020 2020 6669  as.draw().    fi
+000201f0: 672e 7469 6768 745f 6c61 796f 7574 2829  g.tight_layout()
+00020200: 0a20 2020 2023 706c 742e 7368 6f77 2829  .    #plt.show()
+00020210: 0a20 2020 2072 6574 7572 6e20 6669 672c  .    return fig,
+00020220: 2061 780a 0a23 506c 6f74 2073 7065 6374   ax..#Plot spect
+00020230: 726f 6772 616d 2066 726f 6d20 7374 7265  rogram from stre
+00020240: 616d 0a64 6566 2070 6c6f 745f 7370 6563  am.def plot_spec
+00020250: 6772 616d 5f73 7472 6561 6d28 7374 7265  gram_stream(stre
+00020260: 616d 2c20 7061 7261 6d73 3d4e 6f6e 652c  am, params=None,
+00020270: 2063 6f6d 706f 6e65 6e74 3d27 5a27 2c20   component='Z', 
+00020280: 7374 6163 6b5f 7479 7065 3d27 6c69 6e65  stack_type='line
+00020290: 6172 272c 2064 6574 7265 6e64 3d27 6d65  ar', detrend='me
+000202a0: 616e 272c 2064 6273 6361 6c65 3d54 7275  an', dbscale=Tru
+000202b0: 652c 2072 6574 7572 6e5f 6669 673d 5472  e, return_fig=Tr
+000202c0: 7565 2c20 6669 673d 4e6f 6e65 2c20 6178  ue, fig=None, ax
+000202d0: 3d4e 6f6e 652c 2063 6d61 705f 7065 723d  =None, cmap_per=
+000202e0: 5b30 2e31 2c30 2e39 5d2c 202a 2a6b 7761  [0.1,0.9], **kwa
+000202f0: 7267 7329 3a0a 2020 2020 2222 2246 756e  rgs):.    """Fun
+00020300: 6374 696f 6e20 666f 7220 706c 6f74 7469  ction for plotti
+00020310: 6e67 2073 7065 6374 726f 6772 616d 2069  ng spectrogram i
+00020320: 6e20 6120 6e69 6365 206d 6174 706c 6f74  n a nice matplot
+00020330: 6c69 6220 6368 6172 7420 6672 6f6d 2061  lib chart from a
+00020340: 6e20 6f62 7370 792e 7374 7265 616d 0a0a  n obspy.stream..
+00020350: 2020 2020 466f 7220 6d6f 7265 2064 6574      For more det
+00020360: 6169 6c73 206f 6e20 6d61 696e 2066 756e  ails on main fun
+00020370: 6374 696f 6e20 6265 696e 6720 6361 6c6c  ction being call
+00020380: 6564 2c20 7365 6520 6874 7470 733a 2f2f  ed, see https://
+00020390: 6d61 7470 6c6f 746c 6962 2e6f 7267 2f73  matplotlib.org/s
+000203a0: 7461 626c 652f 6170 692f 5f61 735f 6765  table/api/_as_ge
+000203b0: 6e2f 6d61 7470 6c6f 746c 6962 2e70 7970  n/matplotlib.pyp
+000203c0: 6c6f 742e 7370 6563 6772 616d 2e68 746d  lot.specgram.htm
+000203d0: 6c20 0a0a 2020 2020 5061 7261 6d65 7465  l ..    Paramete
+000203e0: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+000203f0: 2d0a 2020 2020 7374 7265 616d 203a 206f  -.    stream : o
+00020400: 6273 7079 2e63 6f72 652e 7374 7265 616d  bspy.core.stream
+00020410: 2e53 7472 6561 6d20 6f62 6a65 6374 0a20  .Stream object. 
+00020420: 2020 2020 2020 2053 7472 6561 6d20 666f         Stream fo
+00020430: 7220 7768 6963 6820 746f 2070 6c6f 7420  r which to plot 
+00020440: 7370 6563 7472 6f67 7261 6d0a 2020 2020  spectrogram.    
+00020450: 7061 7261 6d73 203a 2064 6963 742c 206f  params : dict, o
+00020460: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00020470: 4966 2064 6963 742c 2077 696c 6c20 7265  If dict, will re
+00020480: 6164 2074 6865 2068 7673 725f 6261 6e64  ad the hvsr_band
+00020490: 2066 726f 6d20 7468 6520 6120 6469 6374   from the a dict
+000204a0: 696f 6e61 7279 2077 6974 6820 6120 6b65  ionary with a ke
+000204b0: 7920 5b27 6876 7372 5f62 616e 6427 5d20  y ['hvsr_band'] 
+000204c0: 286c 696b 6520 7468 6520 7061 7261 6d65  (like the parame
+000204d0: 7465 7273 2064 6963 7469 6f6e 6172 7929  ters dictionary)
+000204e0: 2e20 4f74 6865 7277 6973 652c 2063 616e  . Otherwise, can
+000204f0: 2072 6561 6420 696e 2074 6865 2068 7673   read in the hvs
+00020500: 725f 6261 6e64 2061 7320 6120 7477 6f2d  r_band as a two-
+00020510: 6974 656d 206c 6973 742e 204f 722c 2069  item list. Or, i
+00020520: 6620 4e6f 6e65 2c20 6465 6661 756c 7473  f None, defaults
+00020530: 2074 6f20 5b30 2e34 2c34 305d 2c20 6279   to [0.4,40], by
+00020540: 2064 6566 6175 6c74 204e 6f6e 652e 0a20   default None.. 
+00020550: 2020 2063 6f6d 706f 6e65 6e74 203a 2073     component : s
+00020560: 7472 206f 7220 6c69 7374 2c20 6465 6661  tr or list, defa
+00020570: 756c 743d 275a 270a 2020 2020 2020 2020  ult='Z'.        
+00020580: 4966 2073 7472 696e 672c 2073 686f 756c  If string, shoul
+00020590: 6420 6265 206f 6e65 2063 6861 7261 6374  d be one charact
+000205a0: 6572 206c 6f6e 6720 636f 6d70 6f6e 656e  er long componen
+000205b0: 742c 2062 7920 6465 6661 756c 7420 275a  t, by default 'Z
+000205c0: 2e27 2049 6620 6c69 7374 2c20 6361 6e20  .' If list, can 
+000205d0: 636f 6e74 6169 6e20 2745 272c 2027 4e27  contain 'E', 'N'
+000205e0: 2c20 275a 272c 2061 6e64 2077 696c 6c20  , 'Z', and will 
+000205f0: 7374 6163 6b20 7468 656d 2070 6572 2073  stack them per s
+00020600: 7461 636b 5f74 7970 6520 616e 6420 7374  tack_type and st
+00020610: 7265 616d 2e73 7461 636b 2829 206d 6574  ream.stack() met
+00020620: 686f 6420 696e 206f 6273 7079 2074 6f20  hod in obspy to 
+00020630: 6d61 6b65 2073 7065 6374 726f 6772 616d  make spectrogram
+00020640: 2e0a 2020 2020 7374 6163 6b5f 7479 7065  ..    stack_type
+00020650: 203a 2073 7472 2c20 6465 6661 756c 7420   : str, default 
+00020660: 3d20 276c 696e 6561 7227 0a20 2020 2020  = 'linear'.     
+00020670: 2020 2050 6172 616d 6574 6572 2074 6f20     Parameter to 
+00020680: 6265 2072 6561 6420 6469 7265 6374 6c79  be read directly
+00020690: 2069 6e74 6f20 7374 6163 6b5f 7479 7065   into stack_type
+000206a0: 2070 6172 616d 6574 6572 206f 6620 5374   parameter of St
+000206b0: 7265 616d 2e73 7461 636b 2829 206d 6574  ream.stack() met
+000206c0: 686f 6420 6f66 206f 6273 7079 2073 7472  hod of obspy str
+000206d0: 6561 6d73 2c20 6279 2064 6566 6175 6c74  eams, by default
+000206e0: 2027 6c69 6e65 6172 272e 2053 6565 2068   'linear'. See h
+000206f0: 7474 7073 3a2f 2f64 6f63 732e 6f62 7370  ttps://docs.obsp
+00020700: 792e 6f72 672f 7061 636b 6167 6573 2f61  y.org/packages/a
+00020710: 7574 6f67 656e 2f6f 6273 7079 2e63 6f72  utogen/obspy.cor
+00020720: 652e 7374 7265 616d 2e53 7472 6561 6d2e  e.stream.Stream.
+00020730: 7374 6163 6b2e 6874 6d6c 0a20 2020 2020  stack.html.     
+00020740: 2020 204f 6e6c 7920 6d61 7474 6572 7320     Only matters 
+00020750: 6966 206d 6f72 6520 7468 616e 206f 6e65  if more than one
+00020760: 2063 6f6d 706f 6e65 6e74 2075 7365 642e   component used.
+00020770: 0a20 2020 2064 6574 7265 6e64 203a 2073  .    detrend : s
+00020780: 7472 2c20 6465 6661 756c 7420 3d20 276d  tr, default = 'm
+00020790: 6561 6e27 0a20 2020 2020 2020 2050 6172  ean'.        Par
+000207a0: 616d 6574 6572 2074 6f20 6265 2072 6561  ameter to be rea
+000207b0: 6420 6469 7265 6374 6c79 2069 6e74 6f20  d directly into 
+000207c0: 6465 7472 656e 6420 7061 7261 6d65 7465  detrend paramete
+000207d0: 7220 6f66 206d 6174 706c 6f74 6c69 622e  r of matplotlib.
+000207e0: 7079 706c 6f74 2e73 7065 6367 7261 6d2c  pyplot.specgram,
+000207f0: 2062 7920 6465 6661 756c 7420 276d 6561   by default 'mea
+00020800: 6e27 2e20 5365 653a 2068 7474 7073 3a2f  n'. See: https:/
+00020810: 2f6d 6174 706c 6f74 6c69 622e 6f72 672f  /matplotlib.org/
+00020820: 7374 6162 6c65 2f61 7069 2f5f 6173 5f67  stable/api/_as_g
+00020830: 656e 2f6d 6174 706c 6f74 6c69 622e 7079  en/matplotlib.py
+00020840: 706c 6f74 2e73 7065 6367 7261 6d2e 6874  plot.specgram.ht
+00020850: 6d6c 0a20 2020 2064 6273 6361 6c65 203a  ml.    dbscale :
+00020860: 2062 6f6f 6c2c 2064 6566 6175 6c74 203d   bool, default =
+00020870: 2054 7275 650a 2020 2020 2020 2020 4966   True.        If
+00020880: 2054 7275 652c 2073 6361 6c65 2070 6172   True, scale par
+00020890: 616d 6574 6572 206f 6620 6d61 7470 6c6f  ameter of matplo
+000208a0: 746c 6962 2e70 7970 6c6f 742e 7370 6563  tlib.pyplot.spec
+000208b0: 6772 616d 2073 6574 2074 6f20 2764 4227  gram set to 'dB'
+000208c0: 2c20 6279 2064 6566 6175 6c74 2054 7275  , by default Tru
+000208d0: 650a 2020 2020 7265 7475 726e 5f66 6967  e.    return_fig
+000208e0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+000208f0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00020900: 5768 6574 6865 7220 746f 2072 6574 7572  Whether to retur
+00020910: 6e20 7468 6520 6669 6775 7265 2066 726f  n the figure fro
+00020920: 6d20 7468 6520 6675 6e63 7469 6f6e 206f  m the function o
+00020930: 7220 6a75 7374 2073 686f 7720 6974 2c20  r just show it, 
+00020940: 6279 2064 6566 6175 6c74 2054 7275 650a  by default True.
+00020950: 2020 2020 636d 6170 5f70 6572 203a 206c      cmap_per : l
+00020960: 6973 742c 2064 6566 6175 6c74 203d 205b  ist, default = [
+00020970: 302e 312c 2030 2e39 5d0a 2020 2020 2020  0.1, 0.9].      
+00020980: 2020 5477 6f2d 6974 656d 206c 6973 7420    Two-item list 
+00020990: 7777 6974 6820 636c 6970 206c 696d 6974  wwith clip limit
+000209a0: 7320 6173 2070 6572 6365 6e74 6167 6520  s as percentage 
+000209b0: 6f66 2076 616c 7565 7320 6f66 2063 6f6c  of values of col
+000209c0: 6f72 6d61 702c 2073 6f20 6578 7472 656d  ormap, so extrem
+000209d0: 6573 2064 6f20 6e6f 7420 7461 696e 7420  es do not taint 
+000209e0: 636f 6c6f 726d 6170 2c20 6279 2064 6566  colormap, by def
+000209f0: 6175 6c74 205b 302e 312c 302e 395d 0a0a  ault [0.1,0.9]..
+00020a00: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00020a10: 2d2d 2d2d 2d2d 2d0a 2020 2020 6669 670a  -------.    fig.
+00020a20: 2020 2020 2020 2020 4966 2072 6574 7572          If retur
+00020a30: 6e5f 6669 6720 6973 2054 7275 652c 206d  n_fig is True, m
+00020a40: 6174 706c 6f74 6c69 6220 6669 6775 7265  atplotlib figure
+00020a50: 2069 7320 7265 7475 726e 6564 0a20 2020   is returned.   
+00020a60: 2061 780a 2020 2020 2020 2020 4966 2072   ax.        If r
+00020a70: 6574 7572 6e5f 6669 6720 6973 2054 7275  eturn_fig is Tru
+00020a80: 652c 206d 6174 706c 6f74 6c69 6220 6178  e, matplotlib ax
+00020a90: 6973 2069 7320 7265 7475 726e 6564 0a20  is is returned. 
+00020aa0: 2020 2022 2222 0a20 2020 206f 675f 7374     """.    og_st
+00020ab0: 7265 616d 203d 2073 7472 6561 6d2e 636f  ream = stream.co
+00020ac0: 7079 2829 0a0a 2020 2020 2347 6574 2074  py()..    #Get t
+00020ad0: 6865 206c 6174 6573 7420 7374 6172 7420  he latest start 
+00020ae0: 7469 6d65 2061 6e64 2065 6172 6c69 6573  time and earlies
+00020af0: 7420 656e 6420 7469 6d65 7320 6f66 2061  t end times of a
+00020b00: 6c6c 2063 6f6d 706f 6e65 6e74 730a 2020  ll components.  
+00020b10: 2020 7472 6163 654c 6973 7420 3d20 5b5d    traceList = []
+00020b20: 0a20 2020 206d 6178 5374 6172 7454 696d  .    maxStartTim
+00020b30: 6520 3d20 6f62 7370 792e 5554 4344 6174  e = obspy.UTCDat
+00020b40: 6554 696d 6528 2d31 6531 3029 2023 476f  eTime(-1e10) #Go
+00020b50: 2062 6163 6b20 7072 6574 7479 2066 6172   back pretty far
+00020b60: 2028 616c 6d6f 7374 2034 3030 2079 6561   (almost 400 yea
+00020b70: 7273 2920 746f 2073 7461 7274 2077 6974  rs) to start wit
+00020b80: 680a 2020 2020 6d69 6e45 6e64 5469 6d65  h.    minEndTime
+00020b90: 203d 206f 6273 7079 2e55 5443 4461 7465   = obspy.UTCDate
+00020ba0: 5469 6d65 2831 6531 3029 0a20 2020 2066  Time(1e10).    f
+00020bb0: 6f72 2063 6f6d 7020 696e 205b 2745 272c  or comp in ['E',
+00020bc0: 2027 4e27 2c20 275a 275d 3a0a 2020 2020   'N', 'Z']:.    
+00020bd0: 2020 2020 7472 203d 2073 7472 6561 6d2e      tr = stream.
+00020be0: 7365 6c65 6374 2863 6f6d 706f 6e65 6e74  select(component
+00020bf0: 3d63 6f6d 7029 2e63 6f70 7928 290a 2020  =comp).copy().  
+00020c00: 2020 2020 2020 6966 2063 6f6d 7020 696e        if comp in
+00020c10: 2063 6f6d 706f 6e65 6e74 3a0a 2020 2020   component:.    
+00020c20: 2020 2020 2020 2020 7472 6163 654c 6973          traceLis
+00020c30: 742e 6170 7065 6e64 2874 725b 305d 290a  t.append(tr[0]).
+00020c40: 2020 2020 2020 2020 6966 2074 725b 305d          if tr[0]
+00020c50: 2e73 7461 7473 2e73 7461 7274 7469 6d65  .stats.starttime
+00020c60: 203e 206d 6178 5374 6172 7454 696d 653a   > maxStartTime:
+00020c70: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
+00020c80: 5374 6172 7454 696d 6520 3d20 7472 5b30  StartTime = tr[0
+00020c90: 5d2e 7374 6174 732e 7374 6172 7474 696d  ].stats.starttim
+00020ca0: 650a 2020 2020 2020 2020 6966 2074 725b  e.        if tr[
+00020cb0: 305d 2e73 7461 7473 2e65 6e64 7469 6d65  0].stats.endtime
+00020cc0: 203c 206d 696e 456e 6454 696d 653a 0a20   < minEndTime:. 
+00020cd0: 2020 2020 2020 2020 2020 206d 696e 456e             minEn
+00020ce0: 6454 696d 6520 3d20 7472 5b30 5d2e 7374  dTime = tr[0].st
+00020cf0: 6174 732e 656e 6474 696d 650a 0a20 2020  ats.endtime..   
+00020d00: 2023 5472 696d 2061 6c6c 2074 7261 6365   #Trim all trace
+00020d10: 7320 746f 2074 6865 2073 616d 6520 7374  s to the same st
+00020d20: 6172 742f 656e 6420 7469 6d65 0a20 2020  art/end time.   
+00020d30: 2066 6f72 2074 7220 696e 2074 7261 6365   for tr in trace
+00020d40: 4c69 7374 3a0a 2020 2020 2020 2020 7472  List:.        tr
+00020d50: 2e74 7269 6d28 7374 6172 7474 696d 653d  .trim(starttime=
+00020d60: 6d61 7853 7461 7274 5469 6d65 2c20 656e  maxStartTime, en
+00020d70: 6474 696d 653d 6d69 6e45 6e64 5469 6d65  dtime=minEndTime
+00020d80: 290a 2020 2020 6f67 5f73 7472 6561 6d2e  ).    og_stream.
+00020d90: 7472 696d 2873 7461 7274 7469 6d65 3d6d  trim(starttime=m
+00020da0: 6178 5374 6172 7454 696d 652c 2065 6e64  axStartTime, end
+00020db0: 7469 6d65 3d6d 696e 456e 6454 696d 6529  time=minEndTime)
+00020dc0: 2020 2020 2020 0a0a 2020 2020 2343 6f6d        ..    #Com
+00020dd0: 6269 6e65 2061 6c6c 2074 7261 6365 7320  bine all traces 
+00020de0: 696e 746f 2073 696e 676c 652c 2073 7461  into single, sta
+00020df0: 636b 6564 2074 7261 6365 2f73 7472 6561  cked trace/strea
+00020e00: 6d0a 2020 2020 7374 7265 616d 203d 206f  m.    stream = o
+00020e10: 6273 7079 2e53 7472 6561 6d28 7472 6163  bspy.Stream(trac
+00020e20: 654c 6973 7429 0a20 2020 2073 7472 6561  eList).    strea
+00020e30: 6d2e 7374 6163 6b28 6772 6f75 705f 6279  m.stack(group_by
+00020e40: 3d27 616c 6c27 2c20 6e70 7473 5f74 6f6c  ='all', npts_tol
+00020e50: 3d32 3030 2c20 7374 6163 6b5f 7479 7065  =200, stack_type
+00020e60: 3d73 7461 636b 5f74 7970 6529 2020 0a0a  =stack_type)  ..
+00020e70: 2020 2020 6966 2066 6967 2069 7320 4e6f      if fig is No
+00020e80: 6e65 2061 6e64 2061 7820 6973 204e 6f6e  ne and ax is Non
+00020e90: 653a 0a20 2020 2020 2020 2023 4f72 6761  e:.        #Orga
+00020ea0: 6e69 7a65 2074 6865 2063 6861 7274 206c  nize the chart l
+00020eb0: 6179 6f75 740a 2020 2020 2020 2020 6d6f  ayout.        mo
+00020ec0: 7361 6963 203d 205b 5b27 7370 6563 275d  saic = [['spec']
+00020ed0: 2c5b 2773 7065 6327 5d2c 5b27 7370 6563  ,['spec'],['spec
+00020ee0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+00020ef0: 2020 2020 5b27 7370 6563 275d 2c5b 2773      ['spec'],['s
+00020f00: 7065 6327 5d2c 5b27 7370 6563 275d 2c0a  pec'],['spec'],.
+00020f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f20: 5b27 7369 676e 616c 7a27 5d2c 5b27 7369  ['signalz'],['si
+00020f30: 676e 616c 7a27 5d2c 205b 2773 6967 6e61  gnalz'], ['signa
+00020f40: 6c6e 275d 2c20 5b27 7369 676e 616c 6527  ln'], ['signale'
+00020f50: 5d5d 0a20 2020 2020 2020 2066 6967 2c20  ]].        fig, 
+00020f60: 6178 203d 2070 6c74 2e73 7562 706c 6f74  ax = plt.subplot
+00020f70: 5f6d 6f73 6169 6328 6d6f 7361 6963 2c20  _mosaic(mosaic, 
+00020f80: 7368 6172 6578 3d54 7275 6529 2020 0a20  sharex=True)  . 
+00020f90: 2020 2020 2020 2023 6669 672c 2061 7820         #fig, ax 
+00020fa0: 3d20 706c 742e 7375 6270 6c6f 7473 286e  = plt.subplots(n
+00020fb0: 726f 7773 3d32 2c20 6e63 6f6c 733d 312c  rows=2, ncols=1,
+00020fc0: 2073 6861 7265 783d 5472 7565 2920 200a   sharex=True)  .
+00020fd0: 0a20 2020 2064 6174 6120 3d20 7374 7265  .    data = stre
+00020fe0: 616d 5b30 5d2e 6461 7461 0a20 2020 2073  am[0].data.    s
+00020ff0: 616d 706c 655f 7261 7465 203d 2073 7472  ample_rate = str
+00021000: 6561 6d5b 305d 2e73 7461 7473 2e73 616d  eam[0].stats.sam
+00021010: 706c 696e 675f 7261 7465 0a0a 2020 2020  pling_rate..    
+00021020: 6966 2027 636d 6170 2720 696e 206b 7761  if 'cmap' in kwa
+00021030: 7267 732e 6b65 7973 2829 3a0a 2020 2020  rgs.keys():.    
+00021040: 2020 2020 636d 6170 3d6b 7761 7267 735b      cmap=kwargs[
+00021050: 2763 6d61 7027 5d0a 2020 2020 656c 7365  'cmap'].    else
+00021060: 3a0a 2020 2020 2020 2020 636d 6170 3d27  :.        cmap='
+00021070: 7475 7262 6f27 0a0a 2020 2020 6966 2070  turbo'..    if p
+00021080: 6172 616d 7320 6973 204e 6f6e 653a 0a20  arams is None:. 
+00021090: 2020 2020 2020 2068 7673 725f 6261 6e64         hvsr_band
+000210a0: 203d 205b 302e 342c 2034 305d 0a20 2020   = [0.4, 40].   
+000210b0: 2065 6c73 653a 0a20 2020 2020 2020 2068   else:.        h
+000210c0: 7673 725f 6261 6e64 203d 2070 6172 616d  vsr_band = param
+000210d0: 735b 2768 7673 725f 6261 6e64 275d 0a20  s['hvsr_band']. 
+000210e0: 2020 2079 6d69 6e20 3d20 6876 7372 5f62     ymin = hvsr_b
+000210f0: 616e 645b 305d 0a20 2020 2079 6d61 7820  and[0].    ymax 
+00021100: 3d20 6876 7372 5f62 616e 645b 315d 0a0a  = hvsr_band[1]..
+00021110: 2020 2020 6966 2064 6273 6361 6c65 3a0a      if dbscale:.
+00021120: 2020 2020 2020 2020 7363 616c 653d 2764          scale='d
+00021130: 4227 0a20 2020 2065 6c73 653a 0a20 2020  B'.    else:.   
+00021140: 2020 2020 2073 6361 6c65 3d4e 6f6e 650a       scale=None.
+00021150: 2020 2020 7370 6563 2c20 6672 6571 732c      spec, freqs,
+00021160: 2074 696d 6573 2c20 696d 203d 2061 785b   times, im = ax[
+00021170: 2773 7065 6327 5d2e 7370 6563 6772 616d  'spec'].specgram
+00021180: 2878 3d64 6174 612c 2046 733d 7361 6d70  (x=data, Fs=samp
+00021190: 6c65 5f72 6174 652c 2064 6574 7265 6e64  le_rate, detrend
+000211a0: 3d64 6574 7265 6e64 2c20 7363 616c 655f  =detrend, scale_
+000211b0: 6279 5f66 7265 713d 5472 7565 2c20 7363  by_freq=True, sc
+000211c0: 616c 653d 7363 616c 6529 0a20 2020 2069  ale=scale).    i
+000211d0: 6d2e 7265 6d6f 7665 2829 0a0a 2020 2020  m.remove()..    
+000211e0: 6469 6666 6572 656e 6365 5f61 7272 6179  difference_array
+000211f0: 203d 2066 7265 7173 2d79 6d69 6e0a 2020   = freqs-ymin.  
+00021200: 2020 666f 7220 692c 2064 2069 6e20 656e    for i, d in en
+00021210: 756d 6572 6174 6528 6469 6666 6572 656e  umerate(differen
+00021220: 6365 5f61 7272 6179 293a 0a20 2020 2020  ce_array):.     
+00021230: 2020 2069 6620 6420 3e20 303a 0a20 2020     if d > 0:.   
+00021240: 2020 2020 2020 2020 2069 6620 692d 3120           if i-1 
+00021250: 3c20 303a 0a20 2020 2020 2020 2020 2020  < 0:.           
+00021260: 2020 2020 2069 3d31 0a20 2020 2020 2020       i=1.       
+00021270: 2020 2020 206d 696e 6672 6571 496e 6420       minfreqInd 
+00021280: 3d20 692d 310a 2020 2020 2020 2020 2020  = i-1.          
+00021290: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
+000212a0: 2020 2020 0a20 2020 2064 6966 6665 7265      .    differe
+000212b0: 6e63 655f 6172 7261 7920 3d20 6672 6571  nce_array = freq
+000212c0: 732d 796d 6178 0a20 2020 2066 6f72 2069  s-ymax.    for i
+000212d0: 2c20 6420 696e 2065 6e75 6d65 7261 7465  , d in enumerate
+000212e0: 2864 6966 6665 7265 6e63 655f 6172 7261  (difference_arra
+000212f0: 7929 3a0a 2020 2020 2020 2020 6966 2064  y):.        if d
+00021300: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+00021310: 2020 6d61 7866 7265 7149 6e64 203d 2069    maxfreqInd = i
+00021320: 2d31 0a20 2020 2020 2020 2020 2020 2062  -1.            b
+00021330: 7265 616b 0a0a 2020 2020 6172 7261 795f  reak..    array_
+00021340: 6469 7370 6c61 7965 6420 3d20 7370 6563  displayed = spec
+00021350: 5b6d 696e 6672 6571 496e 643a 6d61 7866  [minfreqInd:maxf
+00021360: 7265 7149 6e64 2c3a 5d0a 2020 2020 2366  reqInd,:].    #f
+00021370: 7265 7173 5f64 6973 706c 6179 6564 203d  reqs_displayed =
+00021380: 2066 7265 7173 5b6d 696e 6672 6571 496e   freqs[minfreqIn
+00021390: 643a 6d61 7866 7265 7149 6e64 5d0a 2020  d:maxfreqInd].  
+000213a0: 2020 2369 6d2e 7365 745f 6461 7461 2861    #im.set_data(a
+000213b0: 7272 6179 5f64 6973 706c 6179 6564 290a  rray_displayed).
+000213c0: 2020 2020 766d 696e 203d 206e 702e 7065      vmin = np.pe
+000213d0: 7263 656e 7469 6c65 2861 7272 6179 5f64  rcentile(array_d
+000213e0: 6973 706c 6179 6564 2c20 636d 6170 5f70  isplayed, cmap_p
+000213f0: 6572 5b30 5d2a 3130 3029 0a20 2020 2076  er[0]*100).    v
+00021400: 6d61 7820 3d20 6e70 2e70 6572 6365 6e74  max = np.percent
+00021410: 696c 6528 6172 7261 795f 6469 7370 6c61  ile(array_displa
+00021420: 7965 642c 2063 6d61 705f 7065 725b 315d  yed, cmap_per[1]
+00021430: 2a31 3030 290a 2020 2020 0a20 2020 2064  *100).    .    d
+00021440: 6563 696d 6174 696f 6e5f 6661 6374 6f72  ecimation_factor
+00021450: 203d 2031 300a 0a20 2020 2073 5469 6d65   = 10..    sTime
+00021460: 203d 2073 7472 6561 6d5b 305d 2e73 7461   = stream[0].sta
+00021470: 7473 2e73 7461 7274 7469 6d65 0a20 2020  ts.starttime.   
+00021480: 2074 696d 654c 6973 7420 3d20 7b7d 0a20   timeList = {}. 
+00021490: 2020 206d 706c 5469 6d65 7320 3d20 7b7d     mplTimes = {}
+000214a0: 0a20 2020 200a 2020 2020 2344 6563 696d  .    .    #Decim
+000214b0: 6174 6520 6461 7461 2028 7365 656d 7320  ate data (seems 
+000214c0: 746f 2062 7269 6e67 2075 7020 6c6f 7473  to bring up lots
+000214d0: 206f 6620 6973 7375 6573 206c 6174 6572   of issues later
+000214e0: 290a 2020 2020 2369 6620 6973 696e 7374  ).    #if isinst
+000214f0: 616e 6365 286f 675f 7374 7265 616d 5b30  ance(og_stream[0
+00021500: 5d2e 6461 7461 2c20 6e70 2e6d 612e 4d61  ].data, np.ma.Ma
+00021510: 736b 6564 4172 7261 7929 3a0a 2020 2020  skedArray):.    
+00021520: 2320 2020 2066 6f72 2074 7261 6365 2069  #    for trace i
+00021530: 6e20 6f67 5f73 7472 6561 6d3a 0a20 2020  n og_stream:.   
+00021540: 2023 2020 2020 2020 2020 2375 6e6d 6173   #        #unmas
+00021550: 6b65 6420 3d20 7472 6163 652e 6461 7461  ked = trace.data
+00021560: 5b7e 6e70 2e6d 612e 6765 746d 6173 6b28  [~np.ma.getmask(
+00021570: 7472 6163 652e 6461 7461 295d 0a20 2020  trace.data)].   
+00021580: 2023 2020 2020 2020 2020 6465 6369 6d61   #        decima
+00021590: 7465 645f 6461 7461 203d 2073 6369 7079  ted_data = scipy
+000215a0: 2e73 6967 6e61 6c2e 6465 6369 6d61 7465  .signal.decimate
+000215b0: 2874 7261 6365 2e64 6174 612c 2064 6563  (trace.data, dec
+000215c0: 696d 6174 696f 6e5f 6661 6374 6f72 290a  imation_factor).
+000215d0: 2020 2020 2320 2020 2020 2020 2064 6563      #        dec
+000215e0: 696d 6174 6564 5f6d 6173 6b20 3d20 7472  imated_mask = tr
+000215f0: 6163 652e 6461 7461 2e6d 6173 6b5b 3a3a  ace.data.mask[::
+00021600: 6465 6369 6d61 7469 6f6e 5f66 6163 746f  decimation_facto
+00021610: 725d 0a20 2020 2023 2020 2020 2020 2020  r].    #        
+00021620: 7072 696e 7428 6c65 6e28 6465 6369 6d61  print(len(decima
+00021630: 7465 645f 6461 7461 2929 0a20 2020 2023  ted_data)).    #
+00021640: 2020 2020 2020 2020 7072 696e 7428 6c65          print(le
+00021650: 6e28 6465 6369 6d61 7465 645f 6d61 736b  n(decimated_mask
+00021660: 2929 0a20 2020 2023 2020 2020 2020 2020  )).    #        
+00021670: 7472 6163 652e 6461 7461 203d 206e 702e  trace.data = np.
+00021680: 6d61 2e61 7272 6179 2864 6563 696d 6174  ma.array(decimat
+00021690: 6564 5f64 6174 612c 206d 6173 6b3d 6465  ed_data, mask=de
+000216a0: 6369 6d61 7465 645f 6d61 736b 290a 2020  cimated_mask).  
+000216b0: 2020 2320 2020 2020 2020 2074 7261 6365    #        trace
+000216c0: 2e64 6174 6120 3d20 6e70 2e6d 612e 6669  .data = np.ma.fi
+000216d0: 6c6c 6564 2874 7261 6365 2e64 6174 612c  lled(trace.data,
+000216e0: 206e 702e 6e61 6e29 0a20 2020 2023 656c   np.nan).    #el
+000216f0: 7365 3a0a 2020 2020 2320 2020 206f 675f  se:.    #    og_
+00021700: 7374 7265 616d 2e64 6563 696d 6174 6528  stream.decimate(
+00021710: 6465 6369 6d61 7469 6f6e 5f66 6163 746f  decimation_facto
+00021720: 7229 0a20 2020 206f 675f 7374 7265 616d  r).    og_stream
+00021730: 2e64 6563 696d 6174 6528 6465 6369 6d61  .decimate(decima
+00021740: 7469 6f6e 5f66 6163 746f 7229 0a20 2020  tion_factor).   
+00021750: 2066 6f72 2069 2c20 7472 2069 6e20 656e   for i, tr in en
+00021760: 756d 6572 6174 6528 6f67 5f73 7472 6561  umerate(og_strea
+00021770: 6d29 3a0a 2020 2020 2020 2020 6b65 7920  m):.        key 
+00021780: 3d20 7472 2e73 7461 7473 2e63 6f6d 706f  = tr.stats.compo
+00021790: 6e65 6e74 0a20 2020 2020 2020 2074 696d  nent.        tim
+000217a0: 654c 6973 745b 6b65 795d 203d 205b 5d20  eList[key] = [] 
+000217b0: 0a20 2020 2020 2020 206d 706c 5469 6d65  .        mplTime
+000217c0: 735b 6b65 795d 203d 205b 5d0a 2020 2020  s[key] = [].    
+000217d0: 2020 2020 666f 7220 7420 696e 2074 722e      for t in tr.
+000217e0: 7469 6d65 7328 293a 0a20 2020 2020 2020  times():.       
+000217f0: 2020 2020 2074 203d 2073 5469 6d65 202b       t = sTime +
+00021800: 2074 0a20 2020 2020 2020 2020 2020 2074   t.            t
+00021810: 696d 654c 6973 745b 6b65 795d 2e61 7070  imeList[key].app
+00021820: 656e 6428 7429 0a20 2020 2020 2020 2020  end(t).         
+00021830: 2020 206d 706c 5469 6d65 735b 6b65 795d     mplTimes[key]
+00021840: 2e61 7070 656e 6428 742e 6d61 7470 6c6f  .append(t.matplo
+00021850: 746c 6962 5f64 6174 6529 0a20 2020 200a  tlib_date).    .
+00021860: 2020 2020 666f 7220 692c 206b 2069 6e20      for i, k in 
+00021870: 656e 756d 6572 6174 6528 6d70 6c54 696d  enumerate(mplTim
+00021880: 6573 2e6b 6579 7328 2929 3a0a 2020 2020  es.keys()):.    
+00021890: 2020 2020 6966 2069 203d 3d20 303a 0a20      if i == 0:. 
+000218a0: 2020 2020 2020 2020 2020 2078 6d69 6e20             xmin 
+000218b0: 3d20 6e70 2e6d 696e 286d 706c 5469 6d65  = np.min(mplTime
+000218c0: 735b 6b5d 290a 2020 2020 2020 2020 2020  s[k]).          
+000218d0: 2020 786d 6178 203d 206e 702e 6d61 7828    xmax = np.max(
+000218e0: 6d70 6c54 696d 6573 5b6b 5d29 0a20 2020  mplTimes[k]).   
+000218f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00021900: 2020 2020 2020 2069 6620 786d 696e 203e         if xmin >
+00021910: 206e 702e 6d69 6e28 6d70 6c54 696d 6573   np.min(mplTimes
+00021920: 5b6b 5d29 3a0a 2020 2020 2020 2020 2020  [k]):.          
+00021930: 2020 2020 2020 786d 696e 203d 206e 702e        xmin = np.
+00021940: 6d69 6e28 6d70 6c54 696d 6573 5b6b 5d29  min(mplTimes[k])
+00021950: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00021960: 786d 6178 203c 206e 702e 6d61 7828 6d70  xmax < np.max(mp
+00021970: 6c54 696d 6573 5b6b 5d29 3a0a 2020 2020  lTimes[k]):.    
+00021980: 2020 2020 2020 2020 2020 2020 786d 6178              xmax
+00021990: 203d 206e 702e 6d61 7828 6d70 6c54 696d   = np.max(mplTim
+000219a0: 6573 5b6b 5d29 2020 2020 2020 2020 200a  es[k])         .
+000219b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000219c0: 2020 200a 2020 2020 6e6f 726d 203d 206d     .    norm = m
+000219d0: 6174 706c 6f74 6c69 622e 636f 6c6f 7273  atplotlib.colors
+000219e0: 2e4e 6f72 6d61 6c69 7a65 2876 6d69 6e3d  .Normalize(vmin=
+000219f0: 766d 696e 2c20 766d 6178 3d76 6d61 7829  vmin, vmax=vmax)
+00021a00: 0a20 2020 2069 6d20 3d20 6178 5b27 7370  .    im = ax['sp
+00021a10: 6563 275d 2e69 6d73 686f 7728 6172 7261  ec'].imshow(arra
+00021a20: 795f 6469 7370 6c61 7965 642c 206e 6f72  y_displayed, nor
+00021a30: 6d3d 6e6f 726d 2c20 636d 6170 3d63 6d61  m=norm, cmap=cma
+00021a40: 702c 2061 7370 6563 743d 2761 7574 6f27  p, aspect='auto'
+00021a50: 2c20 696e 7465 7270 6f6c 6174 696f 6e3d  , interpolation=
+00021a60: 4e6f 6e65 2c20 6578 7465 6e74 3d5b 786d  None, extent=[xm
+00021a70: 696e 2c78 6d61 782c 796d 6178 2c79 6d69  in,xmax,ymax,ymi
+00021a80: 6e5d 290a 0a20 2020 2061 785b 2773 7065  n])..    ax['spe
+00021a90: 6327 5d2e 7365 745f 786c 696d 285b 786d  c'].set_xlim([xm
+00021aa0: 696e 2c20 786d 6178 5d29 0a20 2020 2061  in, xmax]).    a
+00021ab0: 785b 2773 7065 6327 5d2e 7365 745f 796c  x['spec'].set_yl
+00021ac0: 696d 285b 796d 696e 2c20 796d 6178 5d29  im([ymin, ymax])
+00021ad0: 0a20 2020 2061 785b 2773 7065 6327 5d2e  .    ax['spec'].
+00021ae0: 7365 6d69 6c6f 6779 2829 200a 2020 2020  semilogy() .    
+00021af0: 0a20 2020 2023 6362 6172 203d 2070 6c74  .    #cbar = plt
+00021b00: 2e63 6f6c 6f72 6261 7228 6d61 7070 6162  .colorbar(mappab
+00021b10: 6c65 3d69 6d29 0a20 2020 2023 6362 6172  le=im).    #cbar
+00021b20: 2e73 6574 5f6c 6162 656c 2827 506f 7765  .set_label('Powe
+00021b30: 7220 5370 6563 7472 616c 2044 656e 7369  r Spectral Densi
+00021b40: 7479 205b 6442 5d27 290a 2020 2020 2373  ty [dB]').    #s
+00021b50: 7472 6561 6d2e 7370 6563 7472 6f67 7261  tream.spectrogra
+00021b60: 6d28 7361 6d70 5f72 6174 653d 7361 6d70  m(samp_rate=samp
+00021b70: 6c65 5f72 6174 652c 2061 7865 733d 6178  le_rate, axes=ax
+00021b80: 2c20 7065 725f 6c61 703d 302e 3735 2c20  , per_lap=0.75, 
+00021b90: 6c6f 673d 5472 7565 2c20 7469 746c 653d  log=True, title=
+00021ba0: 7469 746c 652c 2063 6d61 703d 2774 7572  title, cmap='tur
+00021bb0: 626f 272c 2064 6273 6361 6c65 3d64 6273  bo', dbscale=dbs
+00021bc0: 6361 6c65 2c20 7368 6f77 3d46 616c 7365  cale, show=False
+00021bd0: 290a 2020 2020 0a20 2020 2061 785b 2773  ).    .    ax['s
+00021be0: 7065 6327 5d2e 7861 7869 735f 6461 7465  pec'].xaxis_date
+00021bf0: 2829 0a20 2020 2061 785b 2773 6967 6e61  ().    ax['signa
+00021c00: 6c7a 275d 2e78 6178 6973 5f64 6174 6528  lz'].xaxis_date(
+00021c10: 290a 2020 2020 6178 5b27 7369 676e 616c  ).    ax['signal
+00021c20: 6e27 5d2e 7861 7869 735f 6461 7465 2829  n'].xaxis_date()
+00021c30: 0a20 2020 2061 785b 2773 6967 6e61 6c65  .    ax['signale
+00021c40: 275d 2e78 6178 6973 5f64 6174 6528 290a  '].xaxis_date().
+00021c50: 2020 2020 2374 5469 636b 7320 3d20 6d64      #tTicks = md
+00021c60: 6174 6573 2e4d 696e 7574 654c 6f63 6174  ates.MinuteLocat
+00021c70: 6f72 2869 6e74 6572 7661 6c3d 3529 0a20  or(interval=5). 
+00021c80: 2020 2023 6178 5b30 5d2e 7861 7869 732e     #ax[0].xaxis.
+00021c90: 7365 745f 6d61 6a6f 725f 6c6f 6361 746f  set_major_locato
+00021ca0: 7228 7454 6963 6b73 290a 2020 2020 6178  r(tTicks).    ax
+00021cb0: 5b27 7369 676e 616c 6527 5d2e 7861 7869  ['signale'].xaxi
+00021cc0: 732e 7365 745f 6d61 6a6f 725f 6c6f 6361  s.set_major_loca
+00021cd0: 746f 7228 6d64 6174 6573 2e4d 696e 7574  tor(mdates.Minut
+00021ce0: 654c 6f63 6174 6f72 2862 796d 696e 7574  eLocator(byminut
+00021cf0: 653d 7261 6e67 6528 302c 3630 2c35 2929  e=range(0,60,5))
+00021d00: 290a 2020 2020 6178 5b27 7369 676e 616c  ).    ax['signal
+00021d10: 6527 5d2e 7861 7869 732e 7365 745f 6d61  e'].xaxis.set_ma
+00021d20: 6a6f 725f 666f 726d 6174 7465 7228 6d64  jor_formatter(md
+00021d30: 6174 6573 2e44 6174 6546 6f72 6d61 7474  ates.DateFormatt
+00021d40: 6572 2827 2548 3a25 4d27 2929 0a20 2020  er('%H:%M')).   
+00021d50: 2061 785b 2773 6967 6e61 6c65 275d 2e78   ax['signale'].x
+00021d60: 6178 6973 2e73 6574 5f6d 696e 6f72 5f6c  axis.set_minor_l
+00021d70: 6f63 6174 6f72 286d 6461 7465 732e 4d69  ocator(mdates.Mi
+00021d80: 6e75 7465 4c6f 6361 746f 7228 696e 7465  nuteLocator(inte
+00021d90: 7276 616c 3d31 2929 0a20 2020 2061 785b  rval=1)).    ax[
+00021da0: 2773 6967 6e61 6c65 275d 2e74 6963 6b5f  'signale'].tick_
+00021db0: 7061 7261 6d73 2861 7869 733d 2778 272c  params(axis='x',
+00021dc0: 206c 6162 656c 7369 7a65 3d38 290a 2020   labelsize=8).  
+00021dd0: 2020 0a20 2020 2061 785b 2773 6967 6e61    .    ax['signa
+00021de0: 6c7a 275d 2e70 6c6f 7428 6d70 6c54 696d  lz'].plot(mplTim
+00021df0: 6573 5b27 5a27 5d2c 6f67 5f73 7472 6561  es['Z'],og_strea
+00021e00: 6d2e 7365 6c65 6374 2863 6f6d 706f 6e65  m.select(compone
+00021e10: 6e74 3d27 5a27 295b 305d 2e64 6174 612c  nt='Z')[0].data,
+00021e20: 2063 6f6c 6f72 3d27 6b27 2c20 6c69 6e65   color='k', line
+00021e30: 7769 6474 683d 302e 3235 290a 2020 2020  width=0.25).    
+00021e40: 6178 5b27 7369 676e 616c 6e27 5d2e 706c  ax['signaln'].pl
+00021e50: 6f74 286d 706c 5469 6d65 735b 274e 275d  ot(mplTimes['N']
+00021e60: 2c6f 675f 7374 7265 616d 2e73 656c 6563  ,og_stream.selec
+00021e70: 7428 636f 6d70 6f6e 656e 743d 274e 2729  t(component='N')
+00021e80: 5b30 5d2e 6461 7461 2c20 636f 6c6f 723d  [0].data, color=
+00021e90: 276b 272c 206c 696e 6577 6964 7468 3d30  'k', linewidth=0
+00021ea0: 2e31 290a 2020 2020 6178 5b27 7369 676e  .1).    ax['sign
+00021eb0: 616c 6527 5d2e 706c 6f74 286d 706c 5469  ale'].plot(mplTi
+00021ec0: 6d65 735b 2745 275d 2c6f 675f 7374 7265  mes['E'],og_stre
+00021ed0: 616d 2e73 656c 6563 7428 636f 6d70 6f6e  am.select(compon
+00021ee0: 656e 743d 2745 2729 5b30 5d2e 6461 7461  ent='E')[0].data
+00021ef0: 2c20 636f 6c6f 723d 276b 272c 206c 696e  , color='k', lin
+00021f00: 6577 6964 7468 3d30 2e31 290a 0a20 2020  ewidth=0.1)..   
+00021f10: 2061 785b 2773 7065 6327 5d2e 7365 745f   ax['spec'].set_
+00021f20: 796c 6162 656c 2827 5370 6563 7472 6f67  ylabel('Spectrog
+00021f30: 7261 6d3a 207b 7d27 2e66 6f72 6d61 7428  ram: {}'.format(
+00021f40: 636f 6d70 6f6e 656e 7429 290a 2020 2020  component)).    
+00021f50: 6178 5b27 7369 676e 616c 7a27 5d2e 7365  ax['signalz'].se
+00021f60: 745f 796c 6162 656c 2827 5a27 290a 2020  t_ylabel('Z').  
+00021f70: 2020 6178 5b27 7369 676e 616c 6e27 5d2e    ax['signaln'].
+00021f80: 7365 745f 796c 6162 656c 2827 4e27 290a  set_ylabel('N').
+00021f90: 2020 2020 6178 5b27 7369 676e 616c 6527      ax['signale'
+00021fa0: 5d2e 7365 745f 796c 6162 656c 2827 4527  ].set_ylabel('E'
+00021fb0: 290a 2020 2020 0a20 2020 2066 6f72 2063  ).    .    for c
+00021fc0: 6f6d 7020 696e 206d 706c 5469 6d65 732e  omp in mplTimes.
+00021fd0: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
+00021fe0: 7374 4420 3d20 6e70 2e6e 616e 7374 6428  stD = np.nanstd(
+00021ff0: 6f67 5f73 7472 6561 6d2e 7365 6c65 6374  og_stream.select
+00022000: 2863 6f6d 706f 6e65 6e74 3d63 6f6d 7029  (component=comp)
+00022010: 5b30 5d2e 6461 7461 290a 2020 2020 2020  [0].data).      
+00022020: 2020 646d 6564 203d 206e 702e 6e61 6e6d    dmed = np.nanm
+00022030: 6564 6961 6e28 6f67 5f73 7472 6561 6d2e  edian(og_stream.
+00022040: 7365 6c65 6374 2863 6f6d 706f 6e65 6e74  select(component
+00022050: 3d63 6f6d 7029 5b30 5d2e 6461 7461 290a  =comp)[0].data).
+00022060: 2020 2020 2020 2020 6b65 7920 3d20 2773          key = 's
+00022070: 6967 6e61 6c27 2b63 6f6d 702e 6c6f 7765  ignal'+comp.lowe
+00022080: 7228 290a 2020 2020 2020 2020 6178 5b6b  r().        ax[k
+00022090: 6579 5d2e 7365 745f 796c 696d 285b 646d  ey].set_ylim([dm
+000220a0: 6564 2d35 2a73 7444 2c20 646d 6564 2b35  ed-5*stD, dmed+5
+000220b0: 2a73 7444 5d29 0a20 2020 200a 2020 2020  *stD]).    .    
+000220c0: 6966 2070 6172 616d 7320 6973 204e 6f6e  if params is Non
+000220d0: 653a 0a20 2020 2020 2020 2066 6967 2e73  e:.        fig.s
+000220e0: 7570 7469 746c 6528 2748 5653 5220 5369  uptitle('HVSR Si
+000220f0: 7465 3a20 5370 6563 7472 6f67 7261 6d20  te: Spectrogram 
+00022100: 616e 6420 4461 7461 2729 0a20 2020 2065  and Data').    e
+00022110: 6c69 6620 2774 6974 6c65 2720 696e 206b  lif 'title' in k
+00022120: 7761 7267 732e 6b65 7973 2829 3a0a 2020  wargs.keys():.  
+00022130: 2020 2020 2020 6669 672e 7375 7074 6974        fig.suptit
+00022140: 6c65 286b 7761 7267 735b 2774 6974 6c65  le(kwargs['title
+00022150: 275d 290a 2020 2020 656c 7365 3a0a 2020  ']).    else:.  
+00022160: 2020 2020 2020 6669 672e 7375 7074 6974        fig.suptit
+00022170: 6c65 2870 6172 616d 735b 2773 6974 6527  le(params['site'
+00022180: 5d2b 2753 7065 6374 726f 6772 616d 2061  ]+'Spectrogram a
+00022190: 6e64 2044 6174 6127 290a 2020 2020 0a20  nd Data').    . 
+000221a0: 2020 2064 6179 203d 2022 7b7d 2d7b 7d2d     day = "{}-{}-
+000221b0: 7b7d 222e 666f 726d 6174 2873 7472 6561  {}".format(strea
+000221c0: 6d5b 305d 2e73 7461 7473 2e73 7461 7274  m[0].stats.start
+000221d0: 7469 6d65 2e79 6561 722c 2073 7472 6561  time.year, strea
+000221e0: 6d5b 305d 2e73 7461 7473 2e73 7461 7274  m[0].stats.start
+000221f0: 7469 6d65 2e6d 6f6e 7468 2c20 7374 7265  time.month, stre
+00022200: 616d 5b30 5d2e 7374 6174 732e 7374 6172  am[0].stats.star
+00022210: 7474 696d 652e 6461 7929 0a20 2020 2061  ttime.day).    a
+00022220: 785b 2773 6967 6e61 6c65 275d 2e73 6574  x['signale'].set
+00022230: 5f78 6c61 6265 6c28 2755 5443 2054 696d  _xlabel('UTC Tim
+00022240: 6520 5c6e 272b 6461 7929 0a0a 2020 2020  e \n'+day)..    
+00022250: 2370 6c74 2e72 6350 6172 616d 735b 2766  #plt.rcParams['f
+00022260: 6967 7572 652e 6470 6927 5d20 3d20 3130  igure.dpi'] = 10
+00022270: 300a 2020 2020 2370 6c74 2e72 6350 6172  0.    #plt.rcPar
+00022280: 616d 735b 2766 6967 7572 652e 6669 6773  ams['figure.figs
+00022290: 697a 6527 5d20 3d20 2835 2c34 290a 2020  ize'] = (5,4).  
+000222a0: 2020 0a20 2020 2023 6669 672e 7469 6768    .    #fig.tigh
+000222b0: 745f 6c61 796f 7574 2829 0a20 2020 2066  t_layout().    f
+000222c0: 6967 2e63 616e 7661 732e 6472 6177 2829  ig.canvas.draw()
+000222d0: 0a20 2020 2069 6620 7265 7475 726e 5f66  .    if return_f
+000222e0: 6967 3a0a 2020 2020 2020 2020 7265 7475  ig:.        retu
+000222f0: 726e 2066 6967 2c20 6178 0a20 2020 2072  rn fig, ax.    r
+00022300: 6574 7572 6e0a 0a23 4865 6c70 6572 2066  eturn..#Helper f
+00022310: 756e 6374 696f 6e20 666f 7220 6d61 6e75  unction for manu
+00022320: 616c 2077 696e 646f 7720 7365 6c65 6374  al window select
+00022330: 696f 6e20 0a64 6566 205f 5f64 7261 775f  ion .def __draw_
+00022340: 626f 7865 7328 6576 656e 742c 2063 6c69  boxes(event, cli
+00022350: 636b 4e6f 2c20 7857 696e 646f 7773 2c20  ckNo, xWindows, 
+00022360: 7061 7468 4c69 7374 2c20 7769 6e64 6f77  pathList, window
+00022370: 4472 6177 6e2c 2077 696e 4172 7469 7374  Drawn, winArtist
+00022380: 2c20 6c69 6e65 4172 7469 7374 2c20 7830  , lineArtist, x0
+00022390: 2c20 6669 672c 2061 7829 3a0a 2020 2020  , fig, ax):.    
+000223a0: 2222 2248 656c 7065 7220 6675 6e63 7469  """Helper functi
+000223b0: 6f6e 2066 6f72 206d 616e 7561 6c20 7769  on for manual wi
+000223c0: 6e64 6f77 2073 656c 6563 7469 6f6e 2074  ndow selection t
+000223d0: 6f20 6472 6177 2062 6f78 6573 2074 6f20  o draw boxes to 
+000223e0: 7368 6f77 2077 6865 7265 2077 696e 646f  show where windo
+000223f0: 7773 2068 6176 6520 6265 656e 2073 656c  ws have been sel
+00022400: 6563 7465 6420 666f 7220 7265 6d6f 7661  ected for remova
+00022410: 6c22 2222 0a20 2020 2023 4372 6561 7465  l""".    #Create
+00022420: 2061 6e20 6178 6973 2064 6963 7469 6f6e   an axis diction
+00022430: 6172 7920 6966 2069 7420 646f 6573 206e  ary if it does n
+00022440: 6f74 2061 6c72 6561 6479 2065 7869 7374  ot already exist
+00022450: 2073 6f20 616c 6c20 6675 6e63 7469 6f6e   so all function
+00022460: 7320 6172 6520 7468 6520 7361 6d65 0a0a  s are the same..
+00022470: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00022480: 6528 6178 2c20 6e70 2e6e 6461 7272 6179  e(ax, np.ndarray
+00022490: 2920 6f72 2069 7369 6e73 7461 6e63 6528  ) or isinstance(
+000224a0: 6178 2c20 6469 6374 293a 0a20 2020 2020  ax, dict):.     
+000224b0: 2020 2061 7820 3d20 6178 0a20 2020 2065     ax = ax.    e
+000224c0: 6c73 653a 0a20 2020 2020 2020 2061 7820  lse:.        ax 
+000224d0: 3d20 7b27 6127 3a61 787d 0a0a 2020 2020  = {'a':ax}..    
+000224e0: 0a20 2020 2069 6620 6c65 6e28 6178 2920  .    if len(ax) 
+000224f0: 3e20 313a 0a20 2020 2020 2020 2069 6620  > 1:.        if 
+00022500: 7479 7065 2861 7829 2069 7320 6e6f 7420  type(ax) is not 
+00022510: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
+00022520: 2020 6178 4469 6374 203d 207b 7d0a 2020    axDict = {}.  
+00022530: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+00022540: 2061 2069 6e20 656e 756d 6572 6174 6528   a in enumerate(
+00022550: 6178 293a 0a20 2020 2020 2020 2020 2020  ax):.           
+00022560: 2020 2020 2061 7844 6963 745b 7374 7228       axDict[str(
+00022570: 6929 5d20 3d20 610a 2020 2020 2020 2020  i)] = a.        
+00022580: 2020 2020 6178 203d 2061 7844 6963 740a      ax = axDict.
+00022590: 2020 2020 2365 6c73 653a 0a20 2020 2023      #else:.    #
+000225a0: 2020 2020 6178 203d 207b 2761 273a 6178      ax = {'a':ax
+000225b0: 7d0a 2020 2020 0a20 2020 2023 6966 2065  }.    .    #if e
+000225c0: 7665 6e74 2e69 6e61 7865 7321 3d61 783a  vent.inaxes!=ax:
+000225d0: 2072 6574 7572 6e0a 2020 2020 2379 302c   return.    #y0,
+000225e0: 2079 3120 3d20 6178 2e67 6574 5f79 6c69   y1 = ax.get_yli
+000225f0: 6d28 290a 2020 2020 7930 203d 205b 5d0a  m().    y0 = [].
+00022600: 2020 2020 7931 203d 205b 5d0a 2020 2020      y1 = [].    
+00022610: 6b4c 6973 7420 3d20 5b5d 0a20 2020 2066  kList = [].    f
+00022620: 6f72 206b 2069 6e20 6178 2e6b 6579 7328  or k in ax.keys(
+00022630: 293a 0a20 2020 2020 2020 206b 4c69 7374  ):.        kList
+00022640: 2e61 7070 656e 6428 6b29 0a20 2020 2020  .append(k).     
+00022650: 2020 2079 302e 6170 7065 6e64 2861 785b     y0.append(ax[
+00022660: 6b5d 2e67 6574 5f79 6c69 6d28 295b 305d  k].get_ylim()[0]
+00022670: 290a 2020 2020 2020 2020 7931 2e61 7070  ).        y1.app
+00022680: 656e 6428 6178 5b6b 5d2e 6765 745f 796c  end(ax[k].get_yl
+00022690: 696d 2829 5b31 5d29 0a20 2020 2023 656c  im()[1]).    #el
+000226a0: 7365 3a0a 2020 2020 2320 2020 2079 3020  se:.    #    y0 
+000226b0: 3d20 5b61 782e 6765 745f 796c 696d 2829  = [ax.get_ylim()
+000226c0: 5b30 5d5d 0a20 2020 2023 2020 2020 7931  [0]].    #    y1
+000226d0: 203d 205b 6178 2e67 6574 5f79 6c69 6d28   = [ax.get_ylim(
+000226e0: 295b 315d 5d0a 0a20 2020 2069 6620 636c  )[1]]..    if cl
+000226f0: 6963 6b4e 6f20 3d3d 2030 3a0a 2020 2020  ickNo == 0:.    
+00022700: 2020 2020 2379 203d 206e 702e 6c69 6e73      #y = np.lins
+00022710: 7061 6365 2861 782e 6765 745f 796c 696d  pace(ax.get_ylim
+00022720: 2829 5b30 5d2c 2061 782e 6765 745f 796c  ()[0], ax.get_yl
+00022730: 696d 2829 5b31 5d2c 2032 290a 2020 2020  im()[1], 2).    
+00022740: 2020 2020 7830 203d 2065 7665 6e74 2e78      x0 = event.x
+00022750: 6461 7461 0a20 2020 2020 2020 2063 6c69  data.        cli
+00022760: 636b 4e6f 203d 2031 2020 200a 2020 2020  ckNo = 1   .    
+00022770: 2020 2020 6c69 6e65 4172 7469 7374 2e61      lineArtist.a
+00022780: 7070 656e 6428 5b5d 290a 2020 2020 2020  ppend([]).      
+00022790: 2020 7769 6e4e 756d 7320 3d20 6c65 6e28    winNums = len(
+000227a0: 7857 696e 646f 7773 290a 2020 2020 2020  xWindows).      
+000227b0: 2020 666f 7220 692c 206b 2069 6e20 656e    for i, k in en
+000227c0: 756d 6572 6174 6528 6178 2e6b 6579 7328  umerate(ax.keys(
+000227d0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+000227e0: 6c69 6e41 7274 203d 2061 785b 6b5d 2e61  linArt = ax[k].a
+000227f0: 7876 6c69 6e65 2878 302c 2030 2c20 312c  xvline(x0, 0, 1,
+00022800: 2063 6f6c 6f72 3d27 6b27 2c20 6c69 6e65   color='k', line
+00022810: 7769 6474 683d 312c 207a 6f72 6465 723d  width=1, zorder=
+00022820: 3130 3029 0a20 2020 2020 2020 2020 2020  100).           
+00022830: 206c 696e 6541 7274 6973 745b 7769 6e4e   lineArtist[winN
+00022840: 756d 735d 2e61 7070 656e 6428 5b6c 696e  ums].append([lin
+00022850: 4172 742c 206c 696e 4172 745d 290a 2020  Art, linArt]).  
+00022860: 2020 2020 2020 2365 6c73 653a 0a20 2020        #else:.   
+00022870: 2020 2020 2023 2020 2020 6c69 6e41 7274       #    linArt
+00022880: 203d 2070 6c74 2e61 7876 6c69 6e65 2878   = plt.axvline(x
+00022890: 302c 2079 305b 695d 2c20 7931 5b69 5d2c  0, y0[i], y1[i],
+000228a0: 2063 6f6c 6f72 3d27 6b27 2c20 6c69 6e65   color='k', line
+000228b0: 7769 6474 683d 312c 207a 6f72 6465 723d  width=1, zorder=
+000228c0: 3130 3029 0a20 2020 2020 2020 2023 2020  100).        #  
+000228d0: 2020 6c69 6e65 4172 7469 7374 2e61 7070    lineArtist.app
+000228e0: 656e 6428 5b6c 696e 4172 742c 206c 696e  end([linArt, lin
+000228f0: 4172 745d 290a 2020 2020 656c 7365 3a0a  Art]).    else:.
+00022900: 2020 2020 2020 2020 7831 203d 2065 7665          x1 = eve
+00022910: 6e74 2e78 6461 7461 0a20 2020 2020 2020  nt.xdata.       
+00022920: 2063 6c69 636b 4e6f 203d 2030 0a0a 2020   clickNo = 0..  
+00022930: 2020 2020 2020 7769 6e64 6f77 4472 6177        windowDraw
+00022940: 6e2e 6170 7065 6e64 285b 5d29 0a20 2020  n.append([]).   
+00022950: 2020 2020 2077 696e 4172 7469 7374 2e61       winArtist.a
+00022960: 7070 656e 6428 5b5d 2920 200a 2020 2020  ppend([])  .    
+00022970: 2020 2020 7061 7468 4c69 7374 2e61 7070      pathList.app
+00022980: 656e 6428 5b5d 290a 2020 2020 2020 2020  end([]).        
+00022990: 7769 6e4e 756d 7320 3d20 6c65 6e28 7857  winNums = len(xW
+000229a0: 696e 646f 7773 290a 2020 2020 2020 2020  indows).        
+000229b0: 666f 7220 692c 206b 6579 2069 6e20 656e  for i, key in en
+000229c0: 756d 6572 6174 6528 6b4c 6973 7429 3a0a  umerate(kList):.
+000229d0: 2020 2020 2020 2020 2020 2020 7061 7468              path
+000229e0: 5f64 6174 6120 3d20 5b0a 2020 2020 2020  _data = [.      
+000229f0: 2020 2020 2020 2020 2020 286d 6174 706c            (matpl
+00022a00: 6f74 6c69 622e 7061 7468 2e50 6174 682e  otlib.path.Path.
+00022a10: 4d4f 5645 544f 2c20 2878 302c 2079 305b  MOVETO, (x0, y0[
+00022a20: 695d 2929 2c0a 2020 2020 2020 2020 2020  i])),.          
+00022a30: 2020 2020 2020 286d 6174 706c 6f74 6c69        (matplotli
+00022a40: 622e 7061 7468 2e50 6174 682e 4c49 4e45  b.path.Path.LINE
+00022a50: 544f 2c20 2878 312c 2079 305b 695d 2929  TO, (x1, y0[i]))
+00022a60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00022a70: 2020 286d 6174 706c 6f74 6c69 622e 7061    (matplotlib.pa
+00022a80: 7468 2e50 6174 682e 4c49 4e45 544f 2c20  th.Path.LINETO, 
+00022a90: 2878 312c 2079 315b 695d 2929 2c0a 2020  (x1, y1[i])),.  
+00022aa0: 2020 2020 2020 2020 2020 2020 2020 286d                (m
+00022ab0: 6174 706c 6f74 6c69 622e 7061 7468 2e50  atplotlib.path.P
+00022ac0: 6174 682e 4c49 4e45 544f 2c20 2878 302c  ath.LINETO, (x0,
+00022ad0: 2079 315b 695d 2929 2c0a 2020 2020 2020   y1[i])),.      
+00022ae0: 2020 2020 2020 2020 2020 286d 6174 706c            (matpl
+00022af0: 6f74 6c69 622e 7061 7468 2e50 6174 682e  otlib.path.Path.
+00022b00: 4c49 4e45 544f 2c20 2878 302c 2079 305b  LINETO, (x0, y0[
+00022b10: 695d 2929 2c0a 2020 2020 2020 2020 2020  i])),.          
+00022b20: 2020 2020 2020 286d 6174 706c 6f74 6c69        (matplotli
+00022b30: 622e 7061 7468 2e50 6174 682e 434c 4f53  b.path.Path.CLOS
+00022b40: 4550 4f4c 592c 2028 7830 2c20 7930 5b69  EPOLY, (x0, y0[i
+00022b50: 5d29 292c 0a20 2020 2020 2020 2020 2020  ])),.           
+00022b60: 205d 0a20 2020 2020 2020 2020 2020 2063   ].            c
+00022b70: 6f64 6573 2c20 7665 7274 7320 3d20 7a69  odes, verts = zi
+00022b80: 7028 2a70 6174 685f 6461 7461 290a 2020  p(*path_data).  
+00022b90: 2020 2020 2020 2020 2020 7061 7468 203d            path =
+00022ba0: 206d 6174 706c 6f74 6c69 622e 7061 7468   matplotlib.path
+00022bb0: 2e50 6174 6828 7665 7274 732c 2063 6f64  .Path(verts, cod
+00022bc0: 6573 290a 0a20 2020 2020 2020 2020 2020  es)..           
+00022bd0: 2077 696e 646f 7744 7261 776e 5b77 696e   windowDrawn[win
+00022be0: 4e75 6d73 5d2e 6170 7065 6e64 2846 616c  Nums].append(Fal
+00022bf0: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+00022c00: 7769 6e41 7274 6973 745b 7769 6e4e 756d  winArtist[winNum
+00022c10: 735d 2e61 7070 656e 6428 4e6f 6e65 290a  s].append(None).
+00022c20: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+00022c30: 684c 6973 745b 7769 6e4e 756d 735d 2e61  hList[winNums].a
+00022c40: 7070 656e 6428 7061 7468 290a 2020 2020  ppend(path).    
+00022c50: 2020 2020 2020 2020 5f5f 6472 6177 5f77          __draw_w
+00022c60: 696e 646f 7773 2865 7665 6e74 3d65 7665  indows(event=eve
+00022c70: 6e74 2c20 7061 7468 6c69 7374 3d70 6174  nt, pathlist=pat
+00022c80: 684c 6973 742c 2061 785f 6b65 793d 6b65  hList, ax_key=ke
+00022c90: 792c 2077 696e 646f 7744 7261 776e 3d77  y, windowDrawn=w
+00022ca0: 696e 646f 7744 7261 776e 2c20 7769 6e41  indowDrawn, winA
+00022cb0: 7274 6973 743d 7769 6e41 7274 6973 742c  rtist=winArtist,
+00022cc0: 2078 5769 6e64 6f77 733d 7857 696e 646f   xWindows=xWindo
+00022cd0: 7773 2c20 6669 673d 6669 672c 2061 783d  ws, fig=fig, ax=
+00022ce0: 6178 290a 2020 2020 2020 2020 2020 2020  ax).            
+00022cf0: 6c69 6e41 7274 203d 2070 6c74 2e61 7876  linArt = plt.axv
+00022d00: 6c69 6e65 2878 312c 2030 2c20 312c 2063  line(x1, 0, 1, c
+00022d10: 6f6c 6f72 3d27 6b27 2c20 6c69 6e65 7769  olor='k', linewi
+00022d20: 6474 683d 302e 352c 207a 6f72 6465 723d  dth=0.5, zorder=
+00022d30: 3130 3029 0a0a 2020 2020 2020 2020 2020  100)..          
+00022d40: 2020 5b6c 696e 6541 7274 6973 745b 7769    [lineArtist[wi
+00022d50: 6e4e 756d 735d 5b69 5d2e 706f 7028 2d31  nNums][i].pop(-1
+00022d60: 295d 0a20 2020 2020 2020 2020 2020 206c  )].            l
+00022d70: 696e 6541 7274 6973 745b 7769 6e4e 756d  ineArtist[winNum
+00022d80: 735d 5b69 5d2e 6170 7065 6e64 286c 696e  s][i].append(lin
+00022d90: 4172 7429 0a20 2020 2020 2020 2078 5f77  Art).        x_w
+00022da0: 696e 203d 205b 7830 2c20 7831 5d0a 2020  in = [x0, x1].  
+00022db0: 2020 2020 2020 785f 7769 6e2e 736f 7274        x_win.sort
+00022dc0: 2829 2023 4d61 6b65 2073 7572 6520 7468  () #Make sure th
+00022dd0: 6579 2061 7265 2069 6e20 7468 6520 7269  ey are in the ri
+00022de0: 6768 7420 6f72 6465 720a 2020 2020 2020  ght order.      
+00022df0: 2020 7857 696e 646f 7773 2e61 7070 656e    xWindows.appen
+00022e00: 6428 785f 7769 6e29 0a20 2020 2066 6967  d(x_win).    fig
+00022e10: 2e63 616e 7661 732e 6472 6177 2829 0a20  .canvas.draw(). 
+00022e20: 2020 2072 6574 7572 6e20 636c 6963 6b4e     return clickN
+00022e30: 6f2c 2078 300a 0a23 4865 6c70 6572 2066  o, x0..#Helper f
+00022e40: 756e 6374 696f 6e20 666f 7220 6d61 6e75  unction for manu
+00022e50: 616c 2077 696e 646f 7720 7365 6c65 6374  al window select
+00022e60: 696f 6e20 746f 2064 7261 7720 626f 7865  ion to draw boxe
+00022e70: 7320 746f 2064 6573 6c65 6374 2077 696e  s to deslect win
+00022e80: 646f 7773 2066 6f72 2072 656d 6f76 616c  dows for removal
+00022e90: 0a64 6566 205f 5f72 656d 6f76 655f 6f6e  .def __remove_on
+00022ea0: 5f72 6967 6874 2865 7665 6e74 2c20 7857  _right(event, xW
+00022eb0: 696e 646f 7773 2c20 7061 7468 4c69 7374  indows, pathList
+00022ec0: 2c20 7769 6e64 6f77 4472 6177 6e2c 2077  , windowDrawn, w
+00022ed0: 696e 4172 7469 7374 2c20 206c 696e 6541  inArtist,  lineA
+00022ee0: 7274 6973 742c 2066 6967 2c20 6178 293a  rtist, fig, ax):
+00022ef0: 0a20 2020 2022 2222 4865 6c70 6572 2066  .    """Helper f
+00022f00: 756e 6374 696f 6e20 666f 7220 6d61 6e75  unction for manu
+00022f10: 616c 2077 696e 646f 7720 7365 6c65 6374  al window select
+00022f20: 696f 6e20 746f 2064 7261 7720 626f 7865  ion to draw boxe
+00022f30: 7320 746f 2064 6573 6c65 6374 2077 696e  s to deslect win
+00022f40: 646f 7773 2066 6f72 2072 656d 6f76 616c  dows for removal
+00022f50: 2222 220a 0a20 2020 2069 6620 7857 696e  """..    if xWin
+00022f60: 646f 7773 2069 7320 6e6f 7420 4e6f 6e65  dows is not None
+00022f70: 3a0a 2020 2020 2020 2020 666f 7220 692c  :.        for i,
+00022f80: 2078 5769 6e73 2069 6e20 656e 756d 6572   xWins in enumer
+00022f90: 6174 6528 7857 696e 646f 7773 293a 0a20  ate(xWindows):. 
+00022fa0: 2020 2020 2020 2020 2020 2069 6620 6576             if ev
+00022fb0: 656e 742e 7864 6174 6120 3e20 7857 696e  ent.xdata > xWin
+00022fc0: 735b 305d 2061 6e64 2065 7665 6e74 2e78  s[0] and event.x
+00022fd0: 6461 7461 203c 2078 5769 6e73 5b31 5d3a  data < xWins[1]:
+00022fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022ff0: 206c 696e 4172 7469 7374 7320 3d20 6c69   linArtists = li
+00023000: 6e65 4172 7469 7374 5b69 5d0a 2020 2020  neArtist[i].    
+00023010: 2020 2020 2020 2020 2020 2020 7061 7468              path
+00023020: 4c69 7374 2e70 6f70 2869 290a 2020 2020  List.pop(i).    
+00023030: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00023040: 6a2c 2061 2069 6e20 656e 756d 6572 6174  j, a in enumerat
+00023050: 6528 6c69 6e41 7274 6973 7473 293a 0a20  e(linArtists):. 
+00023060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023070: 2020 2077 696e 4172 7469 7374 5b69 5d5b     winArtist[i][
+00023080: 6a5d 2e72 656d 6f76 6528 2923 2e70 6f70  j].remove()#.pop
+00023090: 2869 290a 2020 2020 2020 2020 2020 2020  (i).            
+000230a0: 2020 2020 2020 2020 6c69 6e65 4172 7469          lineArti
+000230b0: 7374 5b69 5d5b 6a5d 5b30 5d2e 7265 6d6f  st[i][j][0].remo
+000230c0: 7665 2829 232e 706f 7028 6929 235b 695d  ve()#.pop(i)#[i]
+000230d0: 2e70 6f70 286a 290a 2020 2020 2020 2020  .pop(j).        
+000230e0: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+000230f0: 4172 7469 7374 5b69 5d5b 6a5d 5b31 5d2e  Artist[i][j][1].
+00023100: 7265 6d6f 7665 2829 0a20 2020 2020 2020  remove().       
+00023110: 2020 2020 2020 2020 2077 696e 646f 7744           windowD
+00023120: 7261 776e 2e70 6f70 2869 290a 2020 2020  rawn.pop(i).    
+00023130: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+00023140: 4172 7469 7374 2e70 6f70 2869 2923 5b69  Artist.pop(i)#[i
+00023150: 5d2e 706f 7028 6a29 0a20 2020 2020 2020  ].pop(j).       
+00023160: 2020 2020 2020 2020 2077 696e 4172 7469           winArti
+00023170: 7374 2e70 6f70 2869 2923 5b69 5d2e 706f  st.pop(i)#[i].po
+00023180: 7028 6a29 0a20 2020 2020 2020 2020 2020  p(j).           
+00023190: 2020 2020 2078 5769 6e64 6f77 732e 706f       xWindows.po
+000231a0: 7028 6929 0a20 2020 2066 6967 2e63 616e  p(i).    fig.can
+000231b0: 7661 732e 6472 6177 2829 200a 0a23 4865  vas.draw() ..#He
+000231c0: 6c70 6572 2066 756e 6374 696f 6e20 666f  lper function fo
+000231d0: 7220 7570 6461 7469 6e67 2074 6865 2063  r updating the c
+000231e0: 616e 7661 7320 616e 6420 6472 6177 696e  anvas and drawin
+000231f0: 672f 6465 6c65 7465 6420 7468 6520 626f  g/deleted the bo
+00023200: 7865 730a 6465 6620 5f5f 6472 6177 5f77  xes.def __draw_w
+00023210: 696e 646f 7773 2865 7665 6e74 2c20 7061  indows(event, pa
+00023220: 7468 6c69 7374 2c20 6178 5f6b 6579 2c20  thlist, ax_key, 
+00023230: 7769 6e64 6f77 4472 6177 6e2c 2077 696e  windowDrawn, win
+00023240: 4172 7469 7374 2c20 7857 696e 646f 7773  Artist, xWindows
+00023250: 2c20 6669 672c 2061 7829 3a0a 2020 2020  , fig, ax):.    
+00023260: 2222 2248 656c 7065 7220 6675 6e63 7469  """Helper functi
+00023270: 6f6e 2066 6f72 2075 7064 6174 696e 6720  on for updating 
+00023280: 7468 6520 6361 6e76 6173 2061 6e64 2064  the canvas and d
+00023290: 7261 7769 6e67 2f64 656c 6574 6564 2074  rawing/deleted t
+000232a0: 6865 2062 6f78 6573 2222 220a 2020 2020  he boxes""".    
+000232b0: 666f 7220 692c 2070 6120 696e 2065 6e75  for i, pa in enu
+000232c0: 6d65 7261 7465 2870 6174 686c 6973 7429  merate(pathlist)
+000232d0: 3a0a 2020 2020 2020 2020 666f 7220 6a2c  :.        for j,
+000232e0: 2070 2069 6e20 656e 756d 6572 6174 6528   p in enumerate(
+000232f0: 7061 293a 200a 2020 2020 2020 2020 2020  pa): .          
+00023300: 2020 6966 2077 696e 646f 7744 7261 776e    if windowDrawn
+00023310: 5b69 5d5b 6a5d 3a0a 2020 2020 2020 2020  [i][j]:.        
+00023320: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00023330: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00023340: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00023350: 6174 6368 203d 206d 6174 706c 6f74 6c69  atch = matplotli
+00023360: 622e 7061 7463 6865 732e 5061 7468 5061  b.patches.PathPa
+00023370: 7463 6828 702c 2066 6163 6563 6f6c 6f72  tch(p, facecolor
+00023380: 3d27 6b27 2c20 616c 7068 613d 302e 3735  ='k', alpha=0.75
+00023390: 2920 2020 2020 2020 2020 2020 2020 2020  )               
+000233a0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+000233b0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+000233c0: 6e41 7274 203d 2061 785b 6178 5f6b 6579  nArt = ax[ax_key
+000233d0: 5d2e 6164 645f 7061 7463 6828 7061 7463  ].add_patch(patc
+000233e0: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
+000233f0: 2020 2077 696e 646f 7744 7261 776e 5b69     windowDrawn[i
+00023400: 5d5b 6a5d 203d 2054 7275 650a 2020 2020  ][j] = True.    
+00023410: 2020 2020 2020 2020 2020 2020 7769 6e41              winA
+00023420: 7274 6973 745b 695d 5b6a 5d20 3d20 7769  rtist[i][j] = wi
+00023430: 6e41 7274 0a0a 2020 2020 6966 2065 7665  nArt..    if eve
+00023440: 6e74 2e62 7574 746f 6e20 6973 204d 6f75  nt.button is Mou
+00023450: 7365 4275 7474 6f6e 2e52 4947 4854 3a0a  seButton.RIGHT:.
+00023460: 2020 2020 2020 2020 6669 672e 6361 6e76          fig.canv
+00023470: 6173 2e64 7261 7728 290a 0a23 4865 6c70  as.draw()..#Help
+00023480: 6572 2066 756e 6374 696f 6e20 666f 7220  er function for 
+00023490: 6765 7474 696e 6720 636c 6963 6b20 6576  getting click ev
+000234a0: 656e 7420 696e 666f 726d 6174 696f 6e0a  ent information.
+000234b0: 6465 6620 5f5f 6f6e 5f63 6c69 636b 2865  def __on_click(e
+000234c0: 7665 6e74 293a 0a20 2020 2022 2222 4865  vent):.    """He
+000234d0: 6c70 6572 2066 756e 6374 696f 6e20 666f  lper function fo
+000234e0: 7220 6765 7474 696e 6720 636c 6963 6b20  r getting click 
+000234f0: 6576 656e 7420 696e 666f 726d 6174 696f  event informatio
+00023500: 6e22 2222 0a20 2020 2067 6c6f 6261 6c20  n""".    global 
+00023510: 636c 6963 6b4e 6f0a 2020 2020 676c 6f62  clickNo.    glob
+00023520: 616c 2078 300a 2020 2020 6966 2065 7665  al x0.    if eve
+00023530: 6e74 2e62 7574 746f 6e20 6973 204d 6f75  nt.button is Mou
+00023540: 7365 4275 7474 6f6e 2e52 4947 4854 3a0a  seButton.RIGHT:.
+00023550: 2020 2020 2020 2020 5f5f 7265 6d6f 7665          __remove
+00023560: 5f6f 6e5f 7269 6768 7428 6576 656e 742c  _on_right(event,
+00023570: 2078 5769 6e64 6f77 732c 2070 6174 684c   xWindows, pathL
+00023580: 6973 742c 2077 696e 646f 7744 7261 776e  ist, windowDrawn
+00023590: 2c20 7769 6e41 7274 6973 742c 206c 696e  , winArtist, lin
+000235a0: 6541 7274 6973 742c 2066 6967 2c20 6178  eArtist, fig, ax
+000235b0: 290a 0a20 2020 2069 6620 6576 656e 742e  )..    if event.
+000235c0: 6275 7474 6f6e 2069 7320 4d6f 7573 6542  button is MouseB
+000235d0: 7574 746f 6e2e 4c45 4654 3a20 2020 2020  utton.LEFT:     
+000235e0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000235f0: 636c 6963 6b4e 6f2c 2078 3020 3d20 5f5f  clickNo, x0 = __
+00023600: 6472 6177 5f62 6f78 6573 2865 7665 6e74  draw_boxes(event
+00023610: 2c20 636c 6963 6b4e 6f2c 2078 5769 6e64  , clickNo, xWind
+00023620: 6f77 732c 2070 6174 684c 6973 742c 2077  ows, pathList, w
+00023630: 696e 646f 7744 7261 776e 2c20 7769 6e41  indowDrawn, winA
+00023640: 7274 6973 742c 206c 696e 6541 7274 6973  rtist, lineArtis
+00023650: 742c 2078 302c 2066 6967 2c20 6178 2920  t, x0, fig, ax) 
+00023660: 2020 200a 0a23 5175 616c 6974 7920 6368     ..#Quality ch
+00023670: 6563 6b73 2c20 7374 6162 696c 6974 7920  ecks, stability 
+00023680: 7465 7374 732c 2063 6c61 7269 7479 2074  tests, clarity t
+00023690: 6573 7473 0a23 6465 6620 6368 6563 6b5f  ests.#def check_
+000236a0: 7065 616b 7328 6876 7372 2c20 782c 2079  peaks(hvsr, x, y
+000236b0: 2c20 696e 6465 785f 6c69 7374 2c20 7065  , index_list, pe
+000236c0: 616b 2c20 7065 616b 6d2c 2070 6561 6b70  ak, peakm, peakp
+000236d0: 2c20 6876 7372 5f70 6561 6b73 2c20 7374  , hvsr_peaks, st
+000236e0: 6466 2c20 6876 7372 5f6c 6f67 5f73 7464  df, hvsr_log_std
+000236f0: 2c20 7261 6e6b 2c20 6876 7372 5f62 616e  , rank, hvsr_ban
+00023700: 643d 5b30 2e34 2c20 3430 5d2c 2070 6561  d=[0.4, 40], pea
+00023710: 6b5f 7761 7465 725f 6c65 7665 6c3d 312e  k_water_level=1.
+00023720: 382c 2064 6f5f 7261 6e6b 3d46 616c 7365  8, do_rank=False
+00023730: 293a 0a64 6566 2063 6865 636b 5f70 6561  ):.def check_pea
+00023740: 6b73 2868 7673 725f 6469 6374 2c20 6876  ks(hvsr_dict, hv
+00023750: 7372 5f62 616e 643d 5b30 2e34 2c20 3430  sr_band=[0.4, 40
+00023760: 5d2c 2070 6561 6b5f 7761 7465 725f 6c65  ], peak_water_le
+00023770: 7665 6c3d 312e 3829 3a0a 2020 2020 2222  vel=1.8):.    ""
+00023780: 2246 756e 6374 696f 6e20 746f 2072 756e  "Function to run
+00023790: 2074 6573 7473 206f 6e20 4856 5352 2070   tests on HVSR p
+000237a0: 6561 6b73 2074 6f20 6669 6e64 2062 6573  eaks to find bes
+000237b0: 7420 6f6e 6520 616e 6420 7365 6520 6966  t one and see if
+000237c0: 2069 7420 7061 7373 6573 2071 7561 6c69   it passes quali
+000237d0: 7479 2063 6865 636b 730a 0a20 2020 2020  ty checks..     
+000237e0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+000237f0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00023800: 0a20 2020 2020 2020 2068 7673 725f 6469  .        hvsr_di
+00023810: 6374 203a 2064 6963 740a 2020 2020 2020  ct : dict.      
+00023820: 2020 2020 2020 4469 6374 696f 6e61 7279        Dictionary
+00023830: 2063 6f6e 7461 696e 696e 6720 616c 6c20   containing all 
+00023840: 7468 6520 6361 6c63 756c 6174 6564 2069  the calculated i
+00023850: 6e66 6f72 6d61 7469 6f6e 2061 626f 7574  nformation about
+00023860: 2074 6865 2048 5653 5220 6461 7461 2028   the HVSR data (
+00023870: 692e 652e 2c20 6876 7372 5f6f 7574 2072  i.e., hvsr_out r
+00023880: 6574 7572 6e65 6420 6672 6f6d 2070 726f  eturned from pro
+00023890: 6365 7373 5f68 7673 7229 0a20 2020 2020  cess_hvsr).     
+000238a0: 2020 2068 7673 725f 6261 6e64 2020 3a20     hvsr_band  : 
+000238b0: 7475 706c 6520 6f72 206c 6973 742c 2064  tuple or list, d
+000238c0: 6566 6175 6c74 3d5b 302e 342c 2034 305d  efault=[0.4, 40]
+000238d0: 0a20 2020 2020 2020 2020 2020 2032 2d69  .            2-i
+000238e0: 7465 6d20 7475 706c 6520 6f72 206c 6973  tem tuple or lis
+000238f0: 7420 7769 7468 206c 6f77 6572 2061 6e64  t with lower and
+00023900: 2075 7070 6572 206c 696d 6974 206f 6620   upper limit of 
+00023910: 6672 6571 7565 6e63 6965 7320 746f 2061  frequencies to a
+00023920: 6e61 6c79 7a65 0a20 2020 2020 2020 2070  nalyze.        p
+00023930: 6561 6b5f 7761 7465 725f 6c65 7665 6c3a  eak_water_level:
+00023940: 2066 6c6f 6174 2c20 6465 6661 756c 743d   float, default=
+00023950: 312e 380a 2020 2020 2020 2020 2020 2020  1.8.            
+00023960: 5661 6c75 6520 6f66 2070 6561 6b20 7761  Value of peak wa
+00023970: 7465 7220 6c65 7665 6c0a 0a20 2020 2020  ter level..     
+00023980: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+00023990: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+000239a0: 2020 2068 7673 725f 6469 6374 2020 203a     hvsr_dict   :
+000239b0: 2064 6963 740a 2020 2020 2020 2020 2020   dict.          
+000239c0: 2020 4469 6374 696f 6e61 7279 2063 6f6e    Dictionary con
+000239d0: 7461 696e 696e 6720 7072 6576 696f 7573  taining previous
+000239e0: 2069 6e70 7574 2064 6174 612c 2070 6c75   input data, plu
+000239f0: 7320 696e 666f 726d 6174 696f 6e20 6162  s information ab
+00023a00: 6f75 7420 5065 616b 2074 6573 7473 0a20  out Peak tests. 
+00023a10: 2020 2022 2222 0a0a 2020 2020 6966 206e     """..    if n
+00023a20: 6f74 2068 7673 725f 6261 6e64 3a0a 2020  ot hvsr_band:.  
+00023a30: 2020 2020 2020 6876 7372 5f62 616e 6420        hvsr_band 
+00023a40: 3d20 5b30 2e34 2c34 305d 0a20 2020 2068  = [0.4,40].    h
+00023a50: 7673 725f 6469 6374 5b27 6876 7372 5f62  vsr_dict['hvsr_b
+00023a60: 616e 6427 5d20 3d20 6876 7372 5f62 616e  and'] = hvsr_ban
+00023a70: 640a 0a20 2020 2061 6e79 4b20 3d20 6c69  d..    anyK = li
+00023a80: 7374 2868 7673 725f 6469 6374 5b27 785f  st(hvsr_dict['x_
+00023a90: 6672 6571 7327 5d2e 6b65 7973 2829 295b  freqs'].keys())[
+00023aa0: 305d 0a20 2020 2078 203d 2068 7673 725f  0].    x = hvsr_
+00023ab0: 6469 6374 5b27 785f 6672 6571 7327 5d5b  dict['x_freqs'][
+00023ac0: 616e 794b 5d0a 2020 2020 7920 3d20 6876  anyK].    y = hv
+00023ad0: 7372 5f64 6963 745b 2768 7673 725f 6375  sr_dict['hvsr_cu
+00023ae0: 7276 6527 5d0a 2020 2020 696e 6465 785f  rve'].    index_
+00023af0: 6c69 7374 203d 2068 7673 725f 6469 6374  list = hvsr_dict
+00023b00: 5b27 6876 7372 5f70 6561 6b5f 696e 6469  ['hvsr_peak_indi
+00023b10: 6365 7327 5d0a 2020 2020 7065 616b 5f77  ces'].    peak_w
+00023b20: 6174 6572 5f6c 6576 656c 2020 3d20 6876  ater_level  = hv
+00023b30: 7372 5f64 6963 745b 2770 6561 6b5f 7761  sr_dict['peak_wa
+00023b40: 7465 725f 6c65 7665 6c27 5d0a 2020 2020  ter_level'].    
+00023b50: 6876 7372 7020 3d20 6876 7372 5f64 6963  hvsrp = hvsr_dic
+00023b60: 745b 2768 7673 7270 275d 0a20 2020 2070  t['hvsrp'].    p
+00023b70: 6561 6b5f 7761 7465 725f 6c65 7665 6c5f  eak_water_level_
+00023b80: 7020 203d 2068 7673 725f 6469 6374 5b27  p  = hvsr_dict['
+00023b90: 7065 616b 5f77 6174 6572 5f6c 6576 656c  peak_water_level
+00023ba0: 5f70 275d 0a20 2020 2068 7673 726d 203d  _p'].    hvsrm =
+00023bb0: 2068 7673 725f 6469 6374 5b27 6876 7372   hvsr_dict['hvsr
+00023bc0: 6d27 5d0a 2020 2020 6876 7372 5065 616b  m'].    hvsrPeak
+00023bd0: 7320 3d20 6876 7372 5f64 6963 745b 2769  s = hvsr_dict['i
+00023be0: 6e64 5f68 7673 725f 7065 616b 5f69 6e64  nd_hvsr_peak_ind
+00023bf0: 6963 6573 275d 0a20 2020 2068 7673 725f  ices'].    hvsr_
+00023c00: 6c6f 675f 7374 6420 3d20 6876 7372 5f64  log_std = hvsr_d
+00023c10: 6963 745b 2768 7673 725f 6c6f 675f 7374  ict['hvsr_log_st
+00023c20: 6427 5d0a 0a20 2020 2023 446f 2066 6f72  d']..    #Do for
+00023c30: 2068 7673 720a 2020 2020 7065 616b 203d   hvsr.    peak =
+00023c40: 205f 5f69 6e69 745f 7065 616b 7328 782c   __init_peaks(x,
+00023c50: 2079 2c20 696e 6465 785f 6c69 7374 2c20   y, index_list, 
+00023c60: 6876 7372 5f62 616e 642c 2070 6561 6b5f  hvsr_band, peak_
+00023c70: 7761 7465 725f 6c65 7665 6c29 0a0a 2020  water_level)..  
+00023c80: 2020 7065 616b 203d 205f 5f63 6865 636b    peak = __check
+00023c90: 5f63 7572 7665 5f72 656c 6961 6269 6c69  _curve_reliabili
+00023ca0: 7479 2868 7673 725f 6469 6374 2c20 7065  ty(hvsr_dict, pe
+00023cb0: 616b 290a 2020 2020 7065 616b 203d 205f  ak).    peak = _
+00023cc0: 5f63 6865 636b 5f63 6c61 7269 7479 2878  _check_clarity(x
+00023cd0: 2c20 792c 2070 6561 6b2c 2064 6f5f 7261  , y, peak, do_ra
+00023ce0: 6e6b 3d54 7275 6529 0a0a 2020 2020 2344  nk=True)..    #D
+00023cf0: 6f20 666f 7220 6876 7372 700a 2020 2020  o for hvsrp.    
+00023d00: 2320 4669 6e64 2020 7468 6520 7265 6c61  # Find  the rela
+00023d10: 7469 7665 2065 7874 7265 6d61 206f 6620  tive extrema of 
+00023d20: 6876 7372 7020 2868 7673 7220 2b20 3120  hvsrp (hvsr + 1 
+00023d30: 7374 616e 6461 7264 2064 6576 6961 7469  standard deviati
+00023d40: 6f6e 290a 2020 2020 6966 206e 6f74 206e  on).    if not n
+00023d50: 702e 6973 6e61 6e28 6e70 2e73 756d 2868  p.isnan(np.sum(h
+00023d60: 7673 7270 2929 3a0a 2020 2020 2020 2020  vsrp)):.        
+00023d70: 696e 6465 785f 7020 3d20 5f5f 6669 6e64  index_p = __find
+00023d80: 5f70 6561 6b73 2868 7673 7270 290a 2020  _peaks(hvsrp).  
+00023d90: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00023da0: 696e 6465 785f 7020 3d20 6c69 7374 2829  index_p = list()
+00023db0: 0a0a 2020 2020 7065 616b 7020 3d20 5f5f  ..    peakp = __
+00023dc0: 696e 6974 5f70 6561 6b73 2878 2c20 6876  init_peaks(x, hv
+00023dd0: 7372 702c 2069 6e64 6578 5f70 2c20 6876  srp, index_p, hv
+00023de0: 7372 5f62 616e 642c 2070 6561 6b5f 7761  sr_band, peak_wa
+00023df0: 7465 725f 6c65 7665 6c5f 7029 0a20 2020  ter_level_p).   
+00023e00: 2070 6561 6b70 203d 205f 5f63 6865 636b   peakp = __check
+00023e10: 5f63 6c61 7269 7479 2878 2c20 6876 7372  _clarity(x, hvsr
+00023e20: 702c 2070 6561 6b70 2c20 646f 5f72 616e  p, peakp, do_ran
+00023e30: 6b3d 5472 7565 290a 0a20 2020 2023 446f  k=True)..    #Do
+00023e40: 2066 6f72 2068 7673 726d 0a20 2020 2023   for hvsrm.    #
+00023e50: 2046 696e 6420 2074 6865 2072 656c 6174   Find  the relat
+00023e60: 6976 6520 6578 7472 656d 6120 6f66 2068  ive extrema of h
+00023e70: 7673 726d 2028 6876 7372 202d 2031 2073  vsrm (hvsr - 1 s
+00023e80: 7461 6e64 6172 6420 6465 7669 6174 696f  tandard deviatio
+00023e90: 6e29 0a20 2020 2069 6620 6e6f 7420 6e70  n).    if not np
+00023ea0: 2e69 736e 616e 286e 702e 7375 6d28 6876  .isnan(np.sum(hv
+00023eb0: 7372 6d29 293a 0a20 2020 2020 2020 2069  srm)):.        i
+00023ec0: 6e64 6578 5f6d 203d 205f 5f66 696e 645f  ndex_m = __find_
+00023ed0: 7065 616b 7328 6876 7372 6d29 0a20 2020  peaks(hvsrm).   
+00023ee0: 2065 6c73 653a 0a20 2020 2020 2020 2069   else:.        i
+00023ef0: 6e64 6578 5f6d 203d 206c 6973 7428 290a  ndex_m = list().
+00023f00: 0a20 2020 2070 6561 6b5f 7761 7465 725f  .    peak_water_
+00023f10: 6c65 7665 6c5f 6d20 203d 2068 7673 725f  level_m  = hvsr_
+00023f20: 6469 6374 5b27 7065 616b 5f77 6174 6572  dict['peak_water
+00023f30: 5f6c 6576 656c 5f6d 275d 0a0a 2020 2020  _level_m']..    
+00023f40: 7065 616b 6d20 3d20 5f5f 696e 6974 5f70  peakm = __init_p
+00023f50: 6561 6b73 2878 2c20 6876 7372 6d2c 2069  eaks(x, hvsrm, i
+00023f60: 6e64 6578 5f6d 2c20 6876 7372 5f62 616e  ndex_m, hvsr_ban
+00023f70: 642c 2070 6561 6b5f 7761 7465 725f 6c65  d, peak_water_le
+00023f80: 7665 6c5f 6d29 0a20 2020 2070 6561 6b6d  vel_m).    peakm
+00023f90: 203d 205f 5f63 6865 636b 5f63 6c61 7269   = __check_clari
+00023fa0: 7479 2878 2c20 6876 7372 6d2c 2070 6561  ty(x, hvsrm, pea
+00023fb0: 6b6d 2c20 646f 5f72 616e 6b3d 5472 7565  km, do_rank=True
+00023fc0: 290a 0a20 2020 2073 7464 6620 3d20 5f5f  )..    stdf = __
+00023fd0: 6765 745f 7374 6466 2878 2c20 696e 6465  get_stdf(x, inde
+00023fe0: 785f 6c69 7374 2c20 6876 7372 5065 616b  x_list, hvsrPeak
+00023ff0: 7329 0a0a 2020 2020 7065 616b 203d 205f  s)..    peak = _
+00024000: 5f63 6865 636b 5f66 7265 715f 7374 6162  _check_freq_stab
+00024010: 696c 6974 7928 7065 616b 2c20 7065 616b  ility(peak, peak
+00024020: 6d2c 2070 6561 6b70 290a 2020 2020 7065  m, peakp).    pe
+00024030: 616b 203d 205f 5f63 6865 636b 5f73 7461  ak = __check_sta
+00024040: 6269 6c69 7479 2873 7464 662c 2070 6561  bility(stdf, pea
+00024050: 6b2c 2068 7673 725f 6c6f 675f 7374 642c  k, hvsr_log_std,
+00024060: 2072 616e 6b3d 5472 7565 290a 0a20 2020   rank=True)..   
+00024070: 2068 7673 725f 6469 6374 5b27 5065 616b   hvsr_dict['Peak
+00024080: 2052 6570 6f72 7427 5d20 3d20 7065 616b   Report'] = peak
+00024090: 0a0a 2020 2020 2349 7465 7261 7465 2074  ..    #Iterate t
+000240a0: 6872 6f75 6768 2070 6561 6b73 2061 6e64  hrough peaks and
+000240b0: 200a 2020 2020 2320 2020 4765 7420 7468   .    #   Get th
+000240c0: 6520 6265 7374 2070 6561 6b20 6261 7365  e best peak base
+000240d0: 6420 6f6e 2074 6865 2070 6561 6b20 7363  d on the peak sc
+000240e0: 6f72 650a 2020 2020 2320 2020 4361 6c63  ore.    #   Calc
+000240f0: 756c 6174 6520 7768 6574 6865 7220 6561  ulate whether ea
+00024100: 6368 2070 6561 6b20 7061 7373 6573 2065  ch peak passes e
+00024110: 6e6f 7567 6820 7465 7374 730a 2020 2020  nough tests.    
+00024120: 6375 7276 6554 6573 7473 203d 205b 2757  curveTests = ['W
+00024130: 696e 646f 7720 4c65 6e67 7468 2046 7265  indow Length Fre
+00024140: 712e 272c 2753 6967 6e69 6669 6361 6e74  q.','Significant
+00024150: 2043 7963 6c65 7327 2c20 274c 6f77 2043   Cycles', 'Low C
+00024160: 7572 7665 2053 7444 6576 2e20 6f76 6572  urve StDev. over
+00024170: 2074 696d 6527 5d0a 2020 2020 7065 616b   time'].    peak
+00024180: 5465 7374 7320 3d20 5b27 5065 616b 2046  Tests = ['Peak F
+00024190: 7265 712e 2043 6c61 7269 7479 2042 656c  req. Clarity Bel
+000241a0: 6f77 272c 2027 5065 616b 2046 7265 712e  ow', 'Peak Freq.
+000241b0: 2043 6c61 7269 7479 2041 626f 7665 272c   Clarity Above',
+000241c0: 2027 5065 616b 2041 6d70 2e20 436c 6172   'Peak Amp. Clar
+000241d0: 6974 7927 2c20 2746 7265 712e 2053 7461  ity', 'Freq. Sta
+000241e0: 6269 6c69 7479 272c 2027 5065 616b 2053  bility', 'Peak S
+000241f0: 7461 6269 6c69 7479 2028 6672 6571 2e20  tability (freq. 
+00024200: 7374 6429 272c 2027 5065 616b 2053 7461  std)', 'Peak Sta
+00024210: 6269 6c69 7479 2028 616d 702e 2073 7464  bility (amp. std
+00024220: 2927 5d0a 2020 2020 6265 7374 5065 616b  )'].    bestPeak
+00024230: 5363 6f72 6520 3d20 300a 2020 2020 666f  Score = 0.    fo
+00024240: 7220 7020 696e 2068 7673 725f 6469 6374  r p in hvsr_dict
+00024250: 5b27 5065 616b 2052 6570 6f72 7427 5d3a  ['Peak Report']:
+00024260: 0a20 2020 2020 2020 2023 4765 7420 6265  .        #Get be
+00024270: 7374 2070 6561 6b0a 2020 2020 2020 2020  st peak.        
+00024280: 6966 2070 5b27 5363 6f72 6527 5d20 3e20  if p['Score'] > 
+00024290: 6265 7374 5065 616b 5363 6f72 653a 0a20  bestPeakScore:. 
+000242a0: 2020 2020 2020 2020 2020 2062 6573 7450             bestP
+000242b0: 6561 6b53 636f 7265 203d 2070 5b27 5363  eakScore = p['Sc
+000242c0: 6f72 6527 5d0a 2020 2020 2020 2020 2020  ore'].          
+000242d0: 2020 6265 7374 5065 616b 203d 2070 0a0a    bestPeak = p..
+000242e0: 2020 2020 2020 2020 2343 616c 6375 6c61          #Calcula
+000242f0: 7465 2069 6620 7065 616b 2070 6173 7365  te if peak passe
+00024300: 7320 6372 6974 6572 6961 0a20 2020 2020  s criteria.     
+00024310: 2020 2063 5465 7374 7350 6173 7320 3d20     cTestsPass = 
+00024320: 300a 2020 2020 2020 2020 7054 6573 7473  0.        pTests
+00024330: 5061 7373 203d 2030 0a20 2020 2020 2020  Pass = 0.       
+00024340: 2066 6f72 2074 6573 744e 616d 6520 696e   for testName in
+00024350: 2070 5b27 5061 7373 204c 6973 7427 5d2e   p['Pass List'].
+00024360: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
+00024370: 2020 2020 6966 2074 6573 744e 616d 6520      if testName 
+00024380: 696e 2063 7572 7665 5465 7374 733a 0a20  in curveTests:. 
+00024390: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000243a0: 6620 705b 2750 6173 7320 4c69 7374 275d  f p['Pass List']
+000243b0: 5b74 6573 744e 616d 655d 3a0a 2020 2020  [testName]:.    
+000243c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000243d0: 6354 6573 7473 5061 7373 202b 3d20 310a  cTestsPass += 1.
+000243e0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000243f0: 2074 6573 744e 616d 6520 696e 2070 6561   testName in pea
+00024400: 6b54 6573 7473 3a0a 2020 2020 2020 2020  kTests:.        
+00024410: 2020 2020 2020 2020 6966 2070 5b27 5061          if p['Pa
+00024420: 7373 204c 6973 7427 5d5b 7465 7374 4e61  ss List'][testNa
+00024430: 6d65 5d3a 0a20 2020 2020 2020 2020 2020  me]:.           
+00024440: 2020 2020 2020 2020 2070 5465 7374 7350           pTestsP
+00024450: 6173 7320 2b3d 2031 0a0a 2020 2020 2020  ass += 1..      
+00024460: 2020 6966 2063 5465 7374 7350 6173 7320    if cTestsPass 
+00024470: 3d3d 2033 2061 6e64 2070 5465 7374 7350  == 3 and pTestsP
+00024480: 6173 7320 3e3d 2035 3a0a 2020 2020 2020  ass >= 5:.      
+00024490: 2020 2020 2020 705b 2750 6561 6b20 5061        p['Peak Pa
+000244a0: 7373 6573 275d 203d 2054 7275 650a 2020  sses'] = True.  
+000244b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000244c0: 2020 2020 2020 2020 705b 2750 6561 6b20          p['Peak 
+000244d0: 5061 7373 6573 275d 203d 2046 616c 7365  Passes'] = False
+000244e0: 0a20 2020 2020 2020 200a 2020 2020 2344  .        .    #D
+000244f0: 6573 6967 6e61 7465 2062 6573 7420 7065  esignate best pe
+00024500: 616b 2069 6e20 6f75 7470 7574 2064 6963  ak in output dic
+00024510: 740a 2020 2020 6966 206c 656e 2868 7673  t.    if len(hvs
+00024520: 725f 6469 6374 5b27 5065 616b 2052 6570  r_dict['Peak Rep
+00024530: 6f72 7427 5d29 203d 3d20 303a 0a20 2020  ort']) == 0:.   
+00024540: 2020 2020 2062 6573 7450 6561 6b3d 7b7d       bestPeak={}
+00024550: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+00024560: 4e6f 2042 6573 7420 5065 616b 2069 6465  No Best Peak ide
+00024570: 6e74 6966 6965 6427 290a 0a20 2020 2068  ntified')..    h
+00024580: 7673 725f 6469 6374 5b27 4265 7374 2050  vsr_dict['Best P
+00024590: 6561 6b27 5d20 3d20 6265 7374 5065 616b  eak'] = bestPeak
+000245a0: 0a20 2020 2072 6574 7572 6e20 6876 7372  .    return hvsr
+000245b0: 5f64 6963 740a 0a23 496e 6974 6961 6c69  _dict..#Initiali
+000245c0: 7a65 2070 6561 6b73 0a64 6566 205f 5f69  ze peaks.def __i
+000245d0: 6e69 745f 7065 616b 7328 5f78 2c20 5f79  nit_peaks(_x, _y
+000245e0: 2c20 5f69 6e64 6578 5f6c 6973 742c 205f  , _index_list, _
+000245f0: 6876 7372 5f62 616e 642c 205f 7065 616b  hvsr_band, _peak
+00024600: 5f77 6174 6572 5f6c 6576 656c 293a 0a20  _water_level):. 
+00024610: 2020 2022 2222 2049 6e69 7469 616c 697a     """ Initializ
+00024620: 6520 7065 616b 732e 0a20 2020 2020 2020  e peaks..       
+00024630: 200a 2020 2020 2020 2020 4372 6561 7465   .        Create
+00024640: 7320 6469 6374 696f 6e61 7279 2077 6974  s dictionary wit
+00024650: 6820 7265 6c65 7661 6e74 2069 6e66 6f72  h relevant infor
+00024660: 6d61 7469 6f6e 2061 6e64 2072 656d 6f76  mation and remov
+00024670: 6573 2070 6561 6b73 2069 6e20 6876 7372  es peaks in hvsr
+00024680: 2063 7572 7665 2074 6861 7420 6172 6520   curve that are 
+00024690: 6e6f 7420 7265 6c65 7661 6e74 2066 6f72  not relevant for
+000246a0: 2064 6174 6120 616e 616c 7973 6973 2028   data analysis (
+000246b0: 6f75 7473 6964 6520 4856 5352 5f62 616e  outside HVSR_ban
+000246c0: 6429 0a0a 2020 2020 2020 2020 5061 7261  d)..        Para
+000246d0: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+000246e0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+000246f0: 2020 7820 3a20 6c69 7374 2d6c 696b 6520    x : list-like 
+00024700: 6f62 6a20 0a20 2020 2020 2020 2020 2020  obj .           
+00024710: 204c 6973 7420 7769 7468 2078 2d76 616c   List with x-val
+00024720: 7565 7320 2866 7265 7175 656e 6379 206f  ues (frequency o
+00024730: 7220 7065 7269 6f64 2076 616c 7565 7329  r period values)
+00024740: 0a20 2020 2020 2020 2079 203a 206c 6973  .        y : lis
+00024750: 742d 6c69 6b65 206f 626a 200a 2020 2020  t-like obj .    
+00024760: 2020 2020 2020 2020 4c69 7374 2077 6974          List wit
+00024770: 6820 6876 7372 2063 7572 7665 2076 616c  h hvsr curve val
+00024780: 7565 730a 2020 2020 2020 2020 696e 6465  ues.        inde
+00024790: 785f 6c69 7374 203a 206c 6973 7420 6f72  x_list : list or
+000247a0: 2061 7272 6179 5f6c 696b 6520 0a20 2020   array_like .   
+000247b0: 2020 2020 2020 2020 204c 6973 7420 7769           List wi
+000247c0: 7468 2069 6e64 6963 6573 206f 6620 7065  th indices of pe
+000247d0: 616b 730a 2020 2020 2020 2020 5f68 7673  aks.        _hvs
+000247e0: 725f 6261 6e64 203a 206c 6973 740a 2020  r_band : list.  
+000247f0: 2020 2020 2020 2020 2020 5477 6f2d 6974            Two-it
+00024800: 656d 206c 6973 7420 7769 7468 206c 6f77  em list with low
+00024810: 2061 6e64 2068 6967 6820 6672 6571 7565   and high freque
+00024820: 6e63 7920 746f 206c 696d 6974 2061 7373  ncy to limit ass
+00024830: 6573 736d 656e 7420 6578 7465 6e74 0a20  essment extent. 
+00024840: 2020 2020 2020 205f 7065 616b 5f77 6174         _peak_wat
+00024850: 6572 5f6c 6576 656c 203a 2066 6c6f 6174  er_level : float
+00024860: 0a20 2020 2020 2020 2020 2020 2050 6561  .            Pea
+00024870: 6b20 7761 7465 7220 6c65 7665 6c20 7661  k water level va
+00024880: 6c75 650a 2020 2020 2020 2020 0a20 2020  lue.        .   
+00024890: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+000248a0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+000248b0: 2020 2020 205f 7065 616b 2020 2020 2020       _peak      
+000248c0: 2020 2020 2020 2020 203a 206c 6973 7420           : list 
+000248d0: 0a20 2020 2020 2020 2020 2020 204c 6973  .            Lis
+000248e0: 7420 6f66 2064 6963 7469 6f6e 6172 6965  t of dictionarie
+000248f0: 732c 206f 6e65 2066 6f72 2065 6163 6820  s, one for each 
+00024900: 696e 7075 7420 7065 616b 0a20 2020 2022  input peak.    "
+00024910: 2222 0a20 2020 205f 7065 616b 203d 206c  "".    _peak = l
+00024920: 6973 7428 290a 2020 2020 666f 7220 5f69  ist().    for _i
+00024930: 2069 6e20 5f69 6e64 6578 5f6c 6973 743a   in _index_list:
+00024940: 0a20 2020 2020 2020 2069 6620 5f79 5b5f  .        if _y[_
+00024950: 695d 203e 205f 7065 616b 5f77 6174 6572  i] > _peak_water
+00024960: 5f6c 6576 656c 5b30 5d20 616e 6420 285f  _level[0] and (_
+00024970: 6876 7372 5f62 616e 645b 305d 203c 3d20  hvsr_band[0] <= 
+00024980: 5f78 5b5f 695d 203c 3d20 5f68 7673 725f  _x[_i] <= _hvsr_
+00024990: 6261 6e64 5b31 5d29 3a0a 2020 2020 2020  band[1]):.      
+000249a0: 2020 2020 2020 5f70 6561 6b2e 6170 7065        _peak.appe
+000249b0: 6e64 287b 2766 3027 3a20 666c 6f61 7428  nd({'f0': float(
+000249c0: 5f78 5b5f 695d 292c 2027 4130 273a 2066  _x[_i]), 'A0': f
+000249d0: 6c6f 6174 285f 795b 5f69 5d29 2c20 0a20  loat(_y[_i]), . 
+000249e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000249f0: 2020 2020 2020 2020 2027 662d 273a 204e           'f-': N
+00024a00: 6f6e 652c 2027 662b 273a 204e 6f6e 652c  one, 'f+': None,
+00024a10: 2027 5366 273a 204e 6f6e 652c 2027 5361   'Sf': None, 'Sa
+00024a20: 273a 204e 6f6e 652c 0a20 2020 2020 2020  ': None,.       
+00024a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024a40: 2020 2027 5363 6f72 6527 3a20 302c 200a     'Score': 0, .
+00024a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024a60: 2020 2020 2020 2020 2020 2752 6570 6f72            'Repor
+00024a70: 7427 3a20 7b27 4c77 273a 2727 2c20 274e  t': {'Lw':'', 'N
+00024a80: 6327 3a27 272c 2027 cf83 5f41 2866 2927  c':'', '.._A(f)'
+00024a90: 3a27 272c 2027 4128 662d 2927 3a27 272c  :'', 'A(f-)':'',
+00024aa0: 2027 4128 662b 2927 3a27 272c 2027 4130   'A(f+)':'', 'A0
+00024ab0: 273a 2027 272c 2027 502b 273a 2027 272c  ': '', 'P+': '',
+00024ac0: 2027 502d 273a 2027 272c 2027 5366 273a   'P-': '', 'Sf':
+00024ad0: 2027 272c 2027 5361 273a 2027 277d 2c0a   '', 'Sa': ''},.
+00024ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024af0: 2020 2020 2020 2020 2020 2750 6173 7320            'Pass 
+00024b00: 4c69 7374 273a 7b7d 2c0a 2020 2020 2020  List':{},.      
+00024b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b20: 2020 2020 2750 6561 6b20 5061 7373 6573      'Peak Passes
+00024b30: 273a 4661 6c73 657d 290a 2020 2020 7265  ':False}).    re
+00024b40: 7475 726e 205f 7065 616b 0a0a 2343 6865  turn _peak..#Che
+00024b50: 636b 2072 656c 6961 6269 6c69 7479 206f  ck reliability o
+00024b60: 6620 4856 5352 206f 6620 6375 7276 650a  f HVSR of curve.
+00024b70: 6465 6620 5f5f 6368 6563 6b5f 6375 7276  def __check_curv
+00024b80: 655f 7265 6c69 6162 696c 6974 7928 6876  e_reliability(hv
+00024b90: 7372 5f64 6963 742c 205f 7065 616b 293a  sr_dict, _peak):
+00024ba0: 0a20 2020 2022 2222 5465 7374 7320 746f  .    """Tests to
+00024bb0: 2063 6865 636b 2066 6f72 2072 656c 6961   check for relia
+00024bc0: 626c 6520 482f 5620 6375 7276 650a 0a20  ble H/V curve.. 
+00024bd0: 2020 2054 6573 7473 2069 6e63 6c75 6465     Tests include
+00024be0: 3a0a 2020 2020 2020 2020 3129 2050 6561  :.        1) Pea
+00024bf0: 6b20 6672 6571 7565 6e63 7920 6973 2067  k frequency is g
+00024c00: 7265 6174 6572 2074 6861 6e20 3130 202f  reater than 10 /
+00024c10: 2077 696e 646f 7720 6c65 6e67 7468 2028   window length (
+00024c20: 6630 203e 2031 3020 2f20 4c77 290a 2020  f0 > 10 / Lw).  
+00024c30: 2020 2020 2020 2020 2020 6630 203d 2070            f0 = p
+00024c40: 6561 6b20 6672 6571 7565 6e63 7920 5b48  eak frequency [H
+00024c50: 7a5d 0a20 2020 2020 2020 2020 2020 204c  z].            L
+00024c60: 7720 3d20 7769 6e64 6f77 206c 656e 6774  w = window lengt
+00024c70: 6820 5b73 6563 6f6e 6473 5d0a 2020 2020  h [seconds].    
+00024c80: 2020 2020 3229 204e 756d 6265 7220 6f66      2) Number of
+00024c90: 2073 6967 6e69 6669 6361 6e74 2063 7963   significant cyc
+00024ca0: 6c65 7320 284e 6329 2069 7320 6772 6561  les (Nc) is grea
+00024cb0: 7465 7220 7468 616e 2032 3030 2028 4e63  ter than 200 (Nc
+00024cc0: 2866 3029 203e 2032 3030 290a 2020 2020  (f0) > 200).    
+00024cd0: 2020 2020 2020 2020 4e63 203d 204c 7720          Nc = Lw 
+00024ce0: 2a20 4e77 202a 2066 300a 2020 2020 2020  * Nw * f0.      
+00024cf0: 2020 2020 2020 2020 2020 4c77 203d 2077            Lw = w
+00024d00: 696e 646f 7720 6c65 6e67 7468 205b 7365  indow length [se
+00024d10: 635d 0a20 2020 2020 2020 2020 2020 2020  c].             
+00024d20: 2020 204e 7720 3d20 4e75 6d62 6572 206f     Nw = Number o
+00024d30: 6620 7769 6e64 6f77 7320 7573 6564 2069  f windows used i
+00024d40: 6e20 616e 616c 7973 6973 0a20 2020 2020  n analysis.     
+00024d50: 2020 2020 2020 2020 2020 2066 3020 3d20             f0 = 
+00024d60: 7065 616b 2066 7265 7175 656e 6379 205b  peak frequency [
+00024d70: 487a 5d0a 2020 2020 2020 2020 3329 2053  Hz].        3) S
+00024d80: 7444 6576 206f 6620 616d 706c 6974 7564  tDev of amplitud
+00024d90: 6520 6f66 2048 2f56 2063 7572 7665 2069  e of H/V curve i
+00024da0: 7320 6c65 7373 2074 6861 6e20 3220 6174  s less than 2 at
+00024db0: 2061 6c6c 2066 7265 7175 656e 6369 6573   all frequencies
+00024dc0: 2062 6574 7765 656e 2030 2e35 6630 2061   between 0.5f0 a
+00024dd0: 6e64 2032 6630 0a20 2020 2020 2020 2020  nd 2f0.         
+00024de0: 2020 2028 6c65 7373 2074 6861 6e20 3320     (less than 3 
+00024df0: 6966 2066 3020 6973 206c 6573 7320 7468  if f0 is less th
+00024e00: 616e 2030 2e35 2048 7a29 0a20 2020 2020  an 0.5 Hz).     
+00024e10: 2020 2020 2020 2066 3020 3d20 7065 616b         f0 = peak
+00024e20: 2066 7265 7175 656e 6379 205b 487a 5d0a   frequency [Hz].
+00024e30: 2020 2020 2020 2020 2020 2020 5374 4465              StDe
+00024e40: 7620 6973 2061 206d 6561 7375 7265 206f  v is a measure o
+00024e50: 6620 7468 6520 7661 7269 6174 696f 6e20  f the variation 
+00024e60: 6f66 2061 6c6c 2074 6865 2048 2f56 2063  of all the H/V c
+00024e70: 7572 7665 7320 6765 6e65 7261 7465 6420  urves generated 
+00024e80: 666f 7220 6561 6368 2074 696d 6520 7769  for each time wi
+00024e90: 6e64 6f77 0a20 2020 2020 2020 2020 2020  ndow.           
+00024ea0: 2020 2020 204f 7572 206d 6169 6e20 482f       Our main H/
+00024eb0: 5620 6375 7276 6520 6973 2074 6865 206d  V curve is the m
+00024ec0: 6564 6961 6e20 6f66 2074 6865 7365 0a0a  edian of these..
+00024ed0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00024ee0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00024ef0: 2020 6876 7372 5f64 6963 7420 2020 3a20    hvsr_dict   : 
+00024f00: 6469 6374 0a20 2020 2020 2020 2044 6963  dict.        Dic
+00024f10: 7469 6f6e 6172 7920 636f 6e74 6169 6e69  tionary containi
+00024f20: 6e67 2061 6c6c 2069 6d70 6f72 7461 6e74  ng all important
+00024f30: 2069 6e66 6f72 6d61 7469 6f6e 2067 656e   information gen
+00024f40: 6572 6174 6564 2061 626f 7574 2048 5653  erated about HVS
+00024f50: 5220 6375 7276 650a 2020 2020 5f70 6561  R curve.    _pea
+00024f60: 6b20 2020 2020 2020 3a20 6c69 7374 0a20  k       : list. 
+00024f70: 2020 2020 2020 2041 206c 6973 7420 6f66         A list of
+00024f80: 2064 6963 7469 6f6e 6172 6965 732c 2077   dictionaries, w
+00024f90: 6974 6820 6561 6368 2064 6963 7469 6f6e  ith each diction
+00024fa0: 6172 7920 636f 6e74 6169 6e69 6e67 2069  ary containing i
+00024fb0: 6e66 6f72 6d61 7469 6f6e 2061 626f 7574  nformation about
+00024fc0: 2065 6163 6820 7065 616b 0a0a 2020 2020   each peak..    
+00024fd0: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
+00024fe0: 2d2d 2d0a 2020 2020 5f70 6561 6b20 2020  ---.    _peak   
+00024ff0: 3a20 6c69 7374 0a20 2020 2020 2020 204c  : list.        L
+00025000: 6973 7420 6f66 2064 6963 7469 6f6e 6172  ist of dictionar
+00025010: 6965 732c 2073 616d 6520 6173 2061 626f  ies, same as abo
+00025020: 7665 2c20 6578 6365 7074 2077 6974 6820  ve, except with 
+00025030: 696e 666f 726d 6174 696f 6e20 6162 6f75  information abou
+00025040: 7420 6375 7276 6520 7265 6c69 6162 696c  t curve reliabil
+00025050: 6974 7920 7465 7374 7320 6164 6465 640a  ity tests added.
+00025060: 2020 2020 2222 220a 2020 2020 616e 794b      """.    anyK
+00025070: 6579 203d 206c 6973 7428 6876 7372 5f64  ey = list(hvsr_d
+00025080: 6963 745b 2770 7073 6473 275d 2e6b 6579  ict['ppsds'].key
+00025090: 7328 2929 5b30 5d23 446f 6573 6e27 7420  s())[0]#Doesn't 
+000250a0: 6d61 7474 6572 2077 6869 6368 2063 6861  matter which cha
+000250b0: 6e6e 656c 2077 6520 7573 6520 6173 206b  nnel we use as k
+000250c0: 6579 0a0a 2020 2020 6465 6c74 6120 3d20  ey..    delta = 
+000250d0: 6876 7372 5f64 6963 745b 2770 7073 6473  hvsr_dict['ppsds
+000250e0: 275d 5b61 6e79 4b65 795d 5b27 6465 6c74  '][anyKey]['delt
+000250f0: 6127 5d0a 2020 2020 7769 6e64 6f77 5f6c  a'].    window_l
+00025100: 656e 203d 2028 6876 7372 5f64 6963 745b  en = (hvsr_dict[
+00025110: 2770 7073 6473 275d 5b61 6e79 4b65 795d  'ppsds'][anyKey]
+00025120: 5b27 6c65 6e27 5d20 2a20 6465 6c74 6129  ['len'] * delta)
+00025130: 2023 5769 6e64 6f77 206c 656e 6774 6820   #Window length 
+00025140: 696e 2073 6563 6f6e 6473 0a20 2020 2077  in seconds.    w
+00025150: 696e 646f 775f 6e75 6d20 3d20 6e70 2e61  indow_num = np.a
+00025160: 7272 6179 2868 7673 725f 6469 6374 5b27  rray(hvsr_dict['
+00025170: 7073 645f 7261 7727 5d5b 616e 794b 6579  psd_raw'][anyKey
+00025180: 5d29 2e73 6861 7065 5b30 5d0a 0a20 2020  ]).shape[0]..   
+00025190: 2066 6f72 205f 6920 696e 2072 616e 6765   for _i in range
+000251a0: 286c 656e 285f 7065 616b 2929 3a0a 2020  (len(_peak)):.  
+000251b0: 2020 2020 2020 7065 616b 4672 6571 3d20        peakFreq= 
+000251c0: 5f70 6561 6b5b 5f69 5d5b 2766 3027 5d0a  _peak[_i]['f0'].
+000251d0: 2020 2020 2020 2020 7465 7374 3120 3d20          test1 = 
+000251e0: 7065 616b 4672 6571 203e 2031 302f 7769  peakFreq > 10/wi
+000251f0: 6e64 6f77 5f6c 656e 0a0a 2020 2020 2020  ndow_len..      
+00025200: 2020 6e63 203d 2077 696e 646f 775f 6c65    nc = window_le
+00025210: 6e20 2a20 7769 6e64 6f77 5f6e 756d 202a  n * window_num *
+00025220: 2070 6561 6b46 7265 710a 2020 2020 2020   peakFreq.      
+00025230: 2020 7465 7374 3220 3d20 6e63 203e 2032    test2 = nc > 2
+00025240: 3030 0a0a 2020 2020 2020 2020 6861 6c66  00..        half
+00025250: 4630 203d 2070 6561 6b46 7265 712f 320a  F0 = peakFreq/2.
+00025260: 2020 2020 2020 2020 646f 7562 6c65 6630          doublef0
+00025270: 203d 2070 6561 6b46 7265 712a 320a 2020   = peakFreq*2.  
+00025280: 2020 2020 2020 0a20 2020 2020 2020 2074        .        t
+00025290: 6573 7433 203d 2054 7275 650a 2020 2020  est3 = True.    
+000252a0: 2020 2020 6661 696c 436f 756e 7420 3d20      failCount = 
+000252b0: 300a 2020 2020 2020 2020 666f 7220 692c  0.        for i,
+000252c0: 2066 7265 7120 696e 2065 6e75 6d65 7261   freq in enumera
+000252d0: 7465 2868 7673 725f 6469 6374 5b27 785f  te(hvsr_dict['x_
+000252e0: 6672 6571 7327 5d5b 616e 794b 6579 5d5b  freqs'][anyKey][
+000252f0: 3a2d 315d 293a 0a20 2020 2020 2020 2020  :-1]):.         
+00025300: 2020 2023 2323 4953 2054 4849 5320 5249     ###IS THIS RI
+00025310: 4748 543f 3f3f 0a20 2020 2020 2020 2020  GHT???.         
+00025320: 2020 2069 6620 6672 6571 203e 3d20 6861     if freq >= ha
+00025330: 6c66 4630 2061 6e64 2066 7265 7120 3c64  lfF0 and freq <d
+00025340: 6f75 626c 6566 303a 0a20 2020 2020 2020  oublef0:.       
+00025350: 2020 2020 2020 2020 2069 6620 7065 616b           if peak
+00025360: 4672 6571 203e 3d20 302e 353a 0a20 2020  Freq >= 0.5:.   
+00025370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025380: 2069 6620 6876 7372 5f64 6963 745b 2768   if hvsr_dict['h
+00025390: 7673 725f 6c6f 675f 7374 6427 5d5b 695d  vsr_log_std'][i]
+000253a0: 203e 3d20 323a 0a20 2020 2020 2020 2020   >= 2:.         
+000253b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000253c0: 6573 7433 3d46 616c 7365 0a20 2020 2020  est3=False.     
+000253d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000253e0: 2020 2066 6169 6c43 6f75 6e74 202b 3d31     failCount +=1
+000253f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025400: 2065 6c73 653a 2023 6966 2070 6561 6b20   else: #if peak 
+00025410: 6672 6571 2069 7320 6c65 7373 2074 6861  freq is less tha
+00025420: 6e20 302e 350a 2020 2020 2020 2020 2020  n 0.5.          
+00025430: 2020 2020 2020 2020 2020 6966 2068 7673            if hvs
+00025440: 725f 6469 6374 5b27 6876 7372 5f6c 6f67  r_dict['hvsr_log
+00025450: 5f73 7464 275d 5b69 5d20 3e3d 2033 3a0a  _std'][i] >= 3:.
+00025460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025470: 2020 2020 2020 2020 7465 7374 333d 4661          test3=Fa
+00025480: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00025490: 2020 2020 2020 2020 2020 2020 6661 696c              fail
+000254a0: 436f 756e 7420 2b3d 310a 0a20 2020 2020  Count +=1..     
+000254b0: 2020 2069 6620 7465 7374 313a 0a20 2020     if test1:.   
+000254c0: 2020 2020 2020 2020 205f 7065 616b 5b5f           _peak[_
+000254d0: 695d 5b27 5265 706f 7274 275d 5b27 4c77  i]['Report']['Lw
+000254e0: 275d 203d 2027 7b7d 203e 2031 3020 2f20  '] = '{} > 10 / 
+000254f0: 7b7d 2020 7b7d 272e 666f 726d 6174 2872  {}  {}'.format(r
+00025500: 6f75 6e64 2870 6561 6b46 7265 712c 3329  ound(peakFreq,3)
+00025510: 2c20 696e 7428 7769 6e64 6f77 5f6c 656e  , int(window_len
+00025520: 292c 2063 6865 636b 5f6d 6172 6b28 2929  ), check_mark())
+00025530: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00025540: 2020 2020 2020 2020 2020 205f 7065 616b             _peak
+00025550: 5b5f 695d 5b27 5265 706f 7274 275d 5b27  [_i]['Report']['
+00025560: 4c77 275d 203d 2027 7b7d 203e 2031 3020  Lw'] = '{} > 10 
+00025570: 2f20 7b7d 2020 7b7d 272e 666f 726d 6174  / {}  {}'.format
+00025580: 2872 6f75 6e64 2870 6561 6b46 7265 712c  (round(peakFreq,
+00025590: 3329 2c20 696e 7428 7769 6e64 6f77 5f6c  3), int(window_l
+000255a0: 656e 292c 2027 e29c 9827 290a 0a20 2020  en), '...')..   
+000255b0: 2020 2020 2069 6620 7465 7374 323a 0a20       if test2:. 
+000255c0: 2020 2020 2020 2020 2020 205f 7065 616b             _peak
+000255d0: 5b5f 695d 5b27 5265 706f 7274 275d 5b27  [_i]['Report']['
+000255e0: 4e63 275d 203d 2027 7b7d 203e 2032 3030  Nc'] = '{} > 200
+000255f0: 2020 7b7d 272e 666f 726d 6174 2872 6f75    {}'.format(rou
+00025600: 6e64 286e 632c 3029 2c20 6368 6563 6b5f  nd(nc,0), check_
+00025610: 6d61 726b 2829 290a 2020 2020 2020 2020  mark()).        
+00025620: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00025630: 2020 5f70 6561 6b5b 5f69 5d5b 2752 6570    _peak[_i]['Rep
+00025640: 6f72 7427 5d5b 274e 6327 5d20 3d20 277b  ort']['Nc'] = '{
+00025650: 7d20 3e20 3230 3020 207b 7d27 2e66 6f72  } > 200  {}'.for
+00025660: 6d61 7428 726f 756e 6428 6e63 2c30 292c  mat(round(nc,0),
+00025670: 2027 e29c 9827 290a 0a20 2020 2020 2020   '...')..       
+00025680: 2069 6620 7465 7374 333a 0a20 2020 2020   if test3:.     
+00025690: 2020 2020 2020 2069 6620 7065 616b 4672         if peakFr
+000256a0: 6571 203e 3d20 302e 353a 0a20 2020 2020  eq >= 0.5:.     
+000256b0: 2020 2020 2020 2020 2020 2063 6f6d 7056             compV
+000256c0: 616c 203d 2032 0a20 2020 2020 2020 2020  al = 2.         
+000256d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000256e0: 2020 2020 2020 2020 2063 6f6d 7056 616c           compVal
+000256f0: 203d 2033 0a20 2020 2020 2020 2020 2020   = 3.           
+00025700: 205f 7065 616b 5b5f 695d 5b27 5265 706f   _peak[_i]['Repo
+00025710: 7274 275d 5b27 cf83 5f41 2866 2927 5d20  rt']['.._A(f)'] 
+00025720: 3d20 27cf 835f 4120 666f 7220 616c 6c20  = '.._A for all 
+00025730: 6672 6571 7320 7b7d 2d7b 7d20 3c20 7b7d  freqs {}-{} < {}
+00025740: 2020 7b7d 272e 666f 726d 6174 2872 6f75    {}'.format(rou
+00025750: 6e64 2870 6561 6b46 7265 712a 302e 352c  nd(peakFreq*0.5,
+00025760: 2033 292c 2072 6f75 6e64 2870 6561 6b46   3), round(peakF
+00025770: 7265 712a 322c 2033 292c 2063 6f6d 7056  req*2, 3), compV
+00025780: 616c 2c20 6368 6563 6b5f 6d61 726b 2829  al, check_mark()
+00025790: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+000257a0: 2020 2020 2020 2020 2020 2020 5f70 6561              _pea
+000257b0: 6b5b 5f69 5d5b 2752 6570 6f72 7427 5d5b  k[_i]['Report'][
+000257c0: 27cf 835f 4128 6629 275d 203d 2027 cf83  '.._A(f)'] = '..
+000257d0: 5f41 2066 6f72 2061 6c6c 2066 7265 7173  _A for all freqs
+000257e0: 207b 7d2d 7b7d 203c 207b 7d20 207b 7d27   {}-{} < {}  {}'
+000257f0: 2e66 6f72 6d61 7428 726f 756e 6428 7065  .format(round(pe
+00025800: 616b 4672 6571 2a30 2e35 2c20 3329 2c20  akFreq*0.5, 3), 
+00025810: 726f 756e 6428 7065 616b 4672 6571 2a32  round(peakFreq*2
+00025820: 2c20 3329 2c20 636f 6d70 5661 6c2c 2027  , 3), compVal, '
+00025830: e29c 9827 290a 0a20 2020 2020 2020 205f  ...')..        _
+00025840: 7065 616b 5b5f 695d 5b27 5061 7373 204c  peak[_i]['Pass L
+00025850: 6973 7427 5d5b 2757 696e 646f 7720 4c65  ist']['Window Le
+00025860: 6e67 7468 2046 7265 712e 275d 203d 2074  ngth Freq.'] = t
+00025870: 6573 7431 0a20 2020 2020 2020 205f 7065  est1.        _pe
+00025880: 616b 5b5f 695d 5b27 5061 7373 204c 6973  ak[_i]['Pass Lis
+00025890: 7427 5d5b 2753 6967 6e69 6669 6361 6e74  t']['Significant
+000258a0: 2043 7963 6c65 7327 5d20 3d20 7465 7374   Cycles'] = test
+000258b0: 320a 2020 2020 2020 2020 5f70 6561 6b5b  2.        _peak[
+000258c0: 5f69 5d5b 2750 6173 7320 4c69 7374 275d  _i]['Pass List']
+000258d0: 5b27 4c6f 7720 4375 7276 6520 5374 4465  ['Low Curve StDe
+000258e0: 762e 206f 7665 7220 7469 6d65 275d 203d  v. over time'] =
+000258f0: 2074 6573 7433 0a20 2020 2072 6574 7572   test3.    retur
+00025900: 6e20 5f70 6561 6b0a 0a23 4368 6563 6b20  n _peak..#Check 
+00025910: 636c 6172 6974 7920 6f66 2070 6561 6b73  clarity of peaks
+00025920: 0a64 6566 205f 5f63 6865 636b 5f63 6c61  .def __check_cla
+00025930: 7269 7479 285f 782c 205f 792c 205f 7065  rity(_x, _y, _pe
+00025940: 616b 2c20 646f 5f72 616e 6b3d 5472 7565  ak, do_rank=True
+00025950: 293a 0a20 2020 2022 2222 4368 6563 6b20  ):.    """Check 
+00025960: 636c 6172 6974 7920 6f66 2070 6561 6b20  clarity of peak 
+00025970: 616d 706c 6974 7564 6528 7329 0a0a 2020  amplitude(s)..  
+00025980: 2020 2020 2054 6573 7420 7065 616b 7320       Test peaks 
+00025990: 666f 7220 7361 7469 7366 7969 6e67 2061  for satisfying a
+000259a0: 6d70 6c69 7475 6465 2063 6c61 7269 7479  mplitude clarity
+000259b0: 2063 6f6e 6469 7469 6f6e 7320 6173 206f   conditions as o
+000259c0: 7574 6c69 6e65 6420 6279 2053 4553 414d  utlined by SESAM
+000259d0: 4520 3230 3034 3a0a 2020 2020 2020 2020  E 2004:.        
+000259e0: 2020 202d 2074 6865 7265 2065 7869 7374     - there exist
+000259f0: 206f 6e65 2066 7265 7175 656e 6379 2066   one frequency f
+00025a00: 2d2c 206c 7969 6e67 2062 6574 7765 656e  -, lying between
+00025a10: 2066 302f 3420 616e 6420 6630 2c20 7375   f0/4 and f0, su
+00025a20: 6368 2074 6861 7420 4130 202f 2041 2866  ch that A0 / A(f
+00025a30: 2d29 203e 2032 0a20 2020 2020 2020 2020  -) > 2.         
+00025a40: 2020 2d20 7468 6572 6520 6578 6973 7420    - there exist 
+00025a50: 6f6e 6520 6672 6571 7565 6e63 7920 662b  one frequency f+
+00025a60: 2c20 6c79 696e 6720 6265 7477 6565 6e20  , lying between 
+00025a70: 6630 2061 6e64 2034 2a66 302c 2073 7563  f0 and 4*f0, suc
+00025a80: 6820 7468 6174 2041 3020 2f20 4128 662b  h that A0 / A(f+
+00025a90: 2920 3e20 320a 2020 2020 2020 2020 2020  ) > 2.          
+00025aa0: 202d 2041 3020 3e20 320a 0a20 2020 2020   - A0 > 2..     
+00025ab0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00025ac0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00025ad0: 0a20 2020 2020 2020 2078 203a 206c 6973  .        x : lis
+00025ae0: 742d 6c69 6b65 206f 626a 200a 2020 2020  t-like obj .    
+00025af0: 2020 2020 2020 2020 4c69 7374 2077 6974          List wit
+00025b00: 6820 782d 7661 6c75 6573 2028 6672 6571  h x-values (freq
+00025b10: 7565 6e63 7920 6f72 2070 6572 696f 6420  uency or period 
+00025b20: 7661 6c75 6573 290a 2020 2020 2020 2020  values).        
+00025b30: 7920 3a20 6c69 7374 2d6c 696b 6520 6f62  y : list-like ob
+00025b40: 6a20 0a20 2020 2020 2020 2020 2020 204c  j .            L
+00025b50: 6973 7420 7769 7468 2068 7673 7220 6375  ist with hvsr cu
+00025b60: 7276 6520 7661 6c75 6573 0a20 2020 2020  rve values.     
+00025b70: 2020 205f 7065 616b 203a 206c 6973 740a     _peak : list.
+00025b80: 2020 2020 2020 2020 2020 2020 4c69 7374              List
+00025b90: 2077 6974 6820 6469 6374 696f 6e61 7269   with dictionari
+00025ba0: 6573 2066 6f72 2065 6163 6820 7065 616b  es for each peak
+00025bb0: 2c20 636f 6e74 6169 6e69 6e67 2069 6e66  , containing inf
+00025bc0: 6f20 6162 6f75 7420 7468 6174 2070 6561  o about that pea
+00025bd0: 6b0a 2020 2020 2020 2020 646f 5f72 616e  k.        do_ran
+00025be0: 6b20 3a20 626f 6f6c 2c20 6465 6661 756c  k : bool, defaul
+00025bf0: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
+00025c00: 2020 2020 496e 636c 7564 6520 5261 6e6b      Include Rank
+00025c10: 2069 6e20 6f75 7470 7574 0a0a 2020 2020   in output..    
+00025c20: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00025c30: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+00025c40: 2020 2020 5f70 6561 6b20 3a20 6c69 7374      _peak : list
+00025c50: 0a20 2020 2020 2020 2020 2020 204c 6973  .            Lis
+00025c60: 7420 6f66 2064 6963 7469 6f6e 6172 6965  t of dictionarie
+00025c70: 732c 2065 6163 6820 636f 6e74 6169 6e69  s, each containi
+00025c80: 6e67 2074 6865 2063 6c61 7269 7479 2074  ng the clarity t
+00025c90: 6573 7420 696e 666f 726d 6174 696f 6e20  est information 
+00025ca0: 666f 7220 7468 6520 6469 6666 6572 656e  for the differen
+00025cb0: 7420 7065 616b 7320 7468 6174 2077 6572  t peaks that wer
+00025cc0: 6520 7265 6164 2069 6e0a 2020 2020 2222  e read in.    ""
+00025cd0: 220a 2020 2020 676c 6f62 616c 206d 6178  ".    global max
+00025ce0: 5f72 616e 6b0a 0a20 2020 2023 2054 6573  _rank..    # Tes
+00025cf0: 7420 6561 6368 205f 7065 616b 2066 6f72  t each _peak for
+00025d00: 2063 6c61 7269 7479 2e0a 2020 2020 6966   clarity..    if
+00025d10: 2064 6f5f 7261 6e6b 3a0a 2020 2020 2020   do_rank:.      
+00025d20: 2020 6d61 785f 7261 6e6b 202b 3d20 310a    max_rank += 1.
+00025d30: 0a20 2020 2069 6620 6e70 2e61 7272 6179  .    if np.array
+00025d40: 285f 7829 2e73 6861 7065 5b30 5d20 3d3d  (_x).shape[0] ==
+00025d50: 2031 3030 303a 0a20 2020 2020 2020 206a   1000:.        j
+00025d60: 7374 6172 7420 3d20 6c65 6e28 5f78 292d  start = len(_x)-
+00025d70: 320a 2020 2020 656c 7365 3a0a 2020 2020  2.    else:.    
+00025d80: 2020 2020 6a73 7461 7274 203d 206c 656e      jstart = len
+00025d90: 285f 7829 2d31 0a0a 2020 2020 666f 7220  (_x)-1..    for 
+00025da0: 5f69 2069 6e20 7261 6e67 6528 6c65 6e28  _i in range(len(
+00025db0: 5f70 6561 6b29 293a 0a20 2020 2020 2020  _peak)):.       
+00025dc0: 2023 496e 6974 6961 6c69 7a65 2061 7320   #Initialize as 
+00025dd0: 4661 6c73 650a 2020 2020 2020 2020 5f70  False.        _p
+00025de0: 6561 6b5b 5f69 5d5b 2766 2d27 5d20 3d20  eak[_i]['f-'] = 
+00025df0: 27e2 9c98 270a 2020 2020 2020 2020 5f70  '...'.        _p
+00025e00: 6561 6b5b 5f69 5d5b 2752 6570 6f72 7427  eak[_i]['Report'
+00025e10: 5d5b 2741 2866 2d29 275d 203d 2027 4e6f  ]['A(f-)'] = 'No
+00025e20: 2041 5f68 2f76 2069 6e20 6672 6571 7320   A_h/v in freqs 
+00025e30: 7b7d 2d7b 7d20 3c20 7b7d 2020 7b7d 272e  {}-{} < {}  {}'.
+00025e40: 666f 726d 6174 2872 6f75 6e64 285f 7065  format(round(_pe
+00025e50: 616b 5b5f 695d 5b27 4130 275d 2f34 2c20  ak[_i]['A0']/4, 
+00025e60: 3329 2c20 726f 756e 6428 5f70 6561 6b5b  3), round(_peak[
+00025e70: 5f69 5d5b 2741 3027 5d2c 2033 292c 2072  _i]['A0'], 3), r
+00025e80: 6f75 6e64 285f 7065 616b 5b5f 695d 5b27  ound(_peak[_i]['
+00025e90: 4130 275d 2f32 2c20 3329 2c20 27e2 9c98  A0']/2, 3), '...
+00025ea0: 2729 0a20 2020 2020 2020 205f 7065 616b  ').        _peak
+00025eb0: 5b5f 695d 5b27 5061 7373 204c 6973 7427  [_i]['Pass List'
+00025ec0: 5d5b 2750 6561 6b20 4672 6571 2e20 436c  ]['Peak Freq. Cl
+00025ed0: 6172 6974 7920 4265 6c6f 7727 5d20 3d20  arity Below'] = 
+00025ee0: 4661 6c73 650a 2020 2020 2020 2020 666f  False.        fo
+00025ef0: 7220 5f6a 2069 6e20 7261 6e67 6528 6a73  r _j in range(js
+00025f00: 7461 7274 2c20 2d31 2c20 2d31 293a 0a0a  tart, -1, -1):..
+00025f10: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+00025f20: 6572 6520 6578 6973 7420 6f6e 6520 6672  ere exist one fr
+00025f30: 6571 7565 6e63 7920 662d 2c20 6c79 696e  equency f-, lyin
+00025f40: 6720 6265 7477 6565 6e20 6630 2f34 2061  g between f0/4 a
+00025f50: 6e64 2066 302c 2073 7563 6820 7468 6174  nd f0, such that
+00025f60: 2041 3020 2f20 4128 662d 2920 3e20 322e   A0 / A(f-) > 2.
+00025f70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00025f80: 2866 6c6f 6174 285f 7065 616b 5b5f 695d  (float(_peak[_i]
+00025f90: 5b27 6630 275d 2920 2f20 342e 3020 3c3d  ['f0']) / 4.0 <=
+00025fa0: 205f 785b 5f6a 5d20 3c20 666c 6f61 7428   _x[_j] < float(
+00025fb0: 5f70 6561 6b5b 5f69 5d5b 2766 3027 5d29  _peak[_i]['f0'])
+00025fc0: 2920 616e 6420 5c0a 2020 2020 2020 2020  ) and \.        
+00025fd0: 2020 2020 2020 2020 2020 2020 666c 6f61              floa
+00025fe0: 7428 5f70 6561 6b5b 5f69 5d5b 2741 3027  t(_peak[_i]['A0'
+00025ff0: 5d29 202f 205f 795b 5f6a 5d20 3e20 322e  ]) / _y[_j] > 2.
+00026000: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00026010: 2020 205f 7065 616b 5b5f 695d 5b27 5363     _peak[_i]['Sc
+00026020: 6f72 6527 5d20 2b3d 2031 0a20 2020 2020  ore'] += 1.     
+00026030: 2020 2020 2020 2020 2020 205f 7065 616b             _peak
+00026040: 5b5f 695d 5b27 662d 275d 203d 2027 2531  [_i]['f-'] = '%1
+00026050: 302e 3366 2025 3173 2720 2520 285f 785b  0.3f %1s' % (_x[
+00026060: 5f6a 5d2c 2063 6865 636b 5f6d 6172 6b28  _j], check_mark(
+00026070: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00026080: 2020 205f 7065 616b 5b5f 695d 5b27 5265     _peak[_i]['Re
+00026090: 706f 7274 275d 5b27 4128 662d 2927 5d20  port']['A(f-)'] 
+000260a0: 3d20 2741 287b 7d29 3a20 7b7d 203c 207b  = 'A({}): {} < {
+000260b0: 7d20 207b 7d27 2e66 6f72 6d61 7428 726f  }  {}'.format(ro
+000260c0: 756e 6428 5f78 5b5f 6a5d 2c20 3329 2c20  und(_x[_j], 3), 
+000260d0: 726f 756e 6428 5f79 5b5f 6a5d 2c20 3329  round(_y[_j], 3)
+000260e0: 2c20 726f 756e 6428 5f70 6561 6b5b 5f69  , round(_peak[_i
+000260f0: 5d5b 2741 3027 5d2f 322c 3329 2c20 6368  ]['A0']/2,3), ch
+00026100: 6563 6b5f 6d61 726b 2829 290a 2020 2020  eck_mark()).    
+00026110: 2020 2020 2020 2020 2020 2020 5f70 6561              _pea
+00026120: 6b5b 5f69 5d5b 2750 6173 7320 4c69 7374  k[_i]['Pass List
+00026130: 275d 5b27 5065 616b 2046 7265 712e 2043  ']['Peak Freq. C
+00026140: 6c61 7269 7479 2042 656c 6f77 275d 203d  larity Below'] =
+00026150: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+00026160: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+00026170: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00026180: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00026190: 7373 0a20 2020 200a 2020 2020 6966 2064  ss.    .    if d
+000261a0: 6f5f 7261 6e6b 3a0a 2020 2020 2020 2020  o_rank:.        
+000261b0: 6d61 785f 7261 6e6b 202b 3d20 310a 2020  max_rank += 1.  
+000261c0: 2020 666f 7220 5f69 2069 6e20 7261 6e67    for _i in rang
+000261d0: 6528 6c65 6e28 5f70 6561 6b29 293a 0a20  e(len(_peak)):. 
+000261e0: 2020 2020 2020 2023 496e 6974 6961 6c69         #Initiali
+000261f0: 7a65 2061 7320 4661 6c73 650a 2020 2020  ze as False.    
+00026200: 2020 2020 5f70 6561 6b5b 5f69 5d5b 2766      _peak[_i]['f
+00026210: 2b27 5d20 3d20 27e2 9c98 270a 2020 2020  +'] = '...'.    
+00026220: 2020 2020 5f70 6561 6b5b 5f69 5d5b 2752      _peak[_i]['R
+00026230: 6570 6f72 7427 5d5b 2741 2866 2b29 275d  eport']['A(f+)']
+00026240: 203d 2027 4e6f 2041 5f68 2f76 2069 6e20   = 'No A_h/v in 
+00026250: 6672 6571 7320 7b7d 2d7b 7d20 3c20 7b7d  freqs {}-{} < {}
+00026260: 2020 7b7d 272e 666f 726d 6174 2872 6f75    {}'.format(rou
+00026270: 6e64 285f 7065 616b 5b5f 695d 5b27 4130  nd(_peak[_i]['A0
+00026280: 275d 2c20 3329 2c20 726f 756e 6428 5f70  '], 3), round(_p
+00026290: 6561 6b5b 5f69 5d5b 2741 3027 5d2a 342c  eak[_i]['A0']*4,
+000262a0: 2033 292c 2072 6f75 6e64 285f 7065 616b   3), round(_peak
+000262b0: 5b5f 695d 5b27 4130 275d 2f32 2c20 3329  [_i]['A0']/2, 3)
+000262c0: 2c20 27e2 9c98 2729 0a20 2020 2020 2020  , '...').       
+000262d0: 205f 7065 616b 5b5f 695d 5b27 5061 7373   _peak[_i]['Pass
+000262e0: 204c 6973 7427 5d5b 2750 6561 6b20 4672   List']['Peak Fr
+000262f0: 6571 2e20 436c 6172 6974 7920 4162 6f76  eq. Clarity Abov
+00026300: 6527 5d20 3d20 4661 6c73 650a 2020 2020  e'] = False.    
+00026310: 2020 2020 666f 7220 5f6a 2069 6e20 7261      for _j in ra
+00026320: 6e67 6528 6c65 6e28 5f78 2920 2d20 3129  nge(len(_x) - 1)
+00026330: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
+00026340: 2054 6865 7265 2065 7869 7374 206f 6e65   There exist one
+00026350: 2066 7265 7175 656e 6379 2066 2b2c 206c   frequency f+, l
+00026360: 7969 6e67 2062 6574 7765 656e 2066 3020  ying between f0 
+00026370: 616e 6420 342a 6630 2c20 7375 6368 2074  and 4*f0, such t
+00026380: 6861 7420 4130 202f 2041 2866 2b29 203e  hat A0 / A(f+) >
+00026390: 2032 2e0a 2020 2020 2020 2020 2020 2020   2..            
+000263a0: 6966 2066 6c6f 6174 285f 7065 616b 5b5f  if float(_peak[_
+000263b0: 695d 5b27 6630 275d 2920 2a20 342e 3020  i]['f0']) * 4.0 
+000263c0: 3e3d 205f 785b 5f6a 5d20 3e20 666c 6f61  >= _x[_j] > floa
+000263d0: 7428 5f70 6561 6b5b 5f69 5d5b 2766 3027  t(_peak[_i]['f0'
+000263e0: 5d29 2061 6e64 205c 0a20 2020 2020 2020  ]) and \.       
+000263f0: 2020 2020 2020 2020 2020 2020 2066 6c6f               flo
+00026400: 6174 285f 7065 616b 5b5f 695d 5b27 4130  at(_peak[_i]['A0
+00026410: 275d 2920 2f20 5f79 5b5f 6a5d 203e 2032  ']) / _y[_j] > 2
+00026420: 2e30 3a0a 2020 2020 2020 2020 2020 2020  .0:.            
+00026430: 2020 2020 5f70 6561 6b5b 5f69 5d5b 2753      _peak[_i]['S
+00026440: 636f 7265 275d 202b 3d20 310a 2020 2020  core'] += 1.    
+00026450: 2020 2020 2020 2020 2020 2020 5f70 6561              _pea
+00026460: 6b5b 5f69 5d5b 2766 2b27 5d20 3d20 2725  k[_i]['f+'] = '%
+00026470: 3130 2e33 6620 2531 7327 2025 2028 5f78  10.3f %1s' % (_x
+00026480: 5b5f 6a5d 2c20 6368 6563 6b5f 6d61 726b  [_j], check_mark
+00026490: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+000264a0: 2020 2020 5f70 6561 6b5b 5f69 5d5b 2752      _peak[_i]['R
+000264b0: 6570 6f72 7427 5d5b 2741 2866 2b29 275d  eport']['A(f+)']
+000264c0: 203d 2027 4128 7b7d 293a 207b 7d20 3c20   = 'A({}): {} < 
+000264d0: 7b7d 2020 7b7d 272e 666f 726d 6174 2872  {}  {}'.format(r
+000264e0: 6f75 6e64 285f 785b 5f6a 5d2c 2033 292c  ound(_x[_j], 3),
+000264f0: 2072 6f75 6e64 285f 795b 5f6a 5d2c 2033   round(_y[_j], 3
+00026500: 292c 2072 6f75 6e64 285f 7065 616b 5b5f  ), round(_peak[_
+00026510: 695d 5b27 4130 275d 2f32 2c33 292c 2063  i]['A0']/2,3), c
+00026520: 6865 636b 5f6d 6172 6b28 2929 0a20 2020  heck_mark()).   
+00026530: 2020 2020 2020 2020 2020 2020 205f 7065               _pe
+00026540: 616b 5b5f 695d 5b27 5061 7373 204c 6973  ak[_i]['Pass Lis
+00026550: 7427 5d5b 2750 6561 6b20 4672 6571 2e20  t']['Peak Freq. 
+00026560: 436c 6172 6974 7920 4162 6f76 6527 5d20  Clarity Above'] 
+00026570: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00026580: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+00026590: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000265a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000265b0: 6173 730a 2320 2020 2020 2020 2069 6620  ass.#        if 
+000265c0: 4661 6c73 6520 696e 2063 6c61 7269 7479  False in clarity
+000265d0: 5061 7373 3a0a 2320 2020 2020 2020 2020  Pass:.#         
+000265e0: 2020 205f 7065 616b 5b5f 695d 5b27 5061     _peak[_i]['Pa
+000265f0: 7373 204c 6973 7427 5d5b 2750 6561 6b20  ss List']['Peak 
+00026600: 4672 6571 2e20 436c 6172 6974 7920 4265  Freq. Clarity Be
+00026610: 6c6f 7727 5d20 3d20 4661 6c73 650a 2320  low'] = False.# 
+00026620: 2020 2020 2020 2065 6c73 653a 0a23 2020         else:.#  
+00026630: 2020 2020 2020 2020 2020 5f70 6561 6b5b            _peak[
+00026640: 5f69 5d5b 2750 6173 7320 4c69 7374 275d  _i]['Pass List']
+00026650: 5b27 5065 616b 2046 7265 712e 2043 6c61  ['Peak Freq. Cla
+00026660: 7269 7479 2041 626f 7665 275d 203d 2054  rity Above'] = T
+00026670: 7275 650a 0a20 2020 2023 416d 706c 6974  rue..    #Amplit
+00026680: 7564 6520 436c 6172 6974 7920 7465 7374  ude Clarity test
+00026690: 0a20 2020 2023 204f 6e6c 7920 7065 616b  .    # Only peak
+000266a0: 7320 7769 7468 2041 3020 3e20 3220 7061  s with A0 > 2 pa
+000266b0: 7373 0a20 2020 2069 6620 646f 5f72 616e  ss.    if do_ran
+000266c0: 6b3a 0a20 2020 2020 2020 206d 6178 5f72  k:.        max_r
+000266d0: 616e 6b20 2b3d 2031 0a20 2020 205f 6130  ank += 1.    _a0
+000266e0: 203d 2032 2e30 0a20 2020 2066 6f72 205f   = 2.0.    for _
+000266f0: 6920 696e 2072 616e 6765 286c 656e 285f  i in range(len(_
+00026700: 7065 616b 2929 3a0a 0a20 2020 2020 2020  peak)):..       
+00026710: 2069 6620 666c 6f61 7428 5f70 6561 6b5b   if float(_peak[
+00026720: 5f69 5d5b 2741 3027 5d29 203e 205f 6130  _i]['A0']) > _a0
+00026730: 3a0a 2020 2020 2020 2020 2020 2020 5f70  :.            _p
+00026740: 6561 6b5b 5f69 5d5b 2752 6570 6f72 7427  eak[_i]['Report'
+00026750: 5d5b 2741 3027 5d20 3d20 2725 3130 2e32  ]['A0'] = '%10.2
+00026760: 6620 3e20 2530 2e31 6620 2531 7327 2025  f > %0.1f %1s' %
+00026770: 2028 5f70 6561 6b5b 5f69 5d5b 2741 3027   (_peak[_i]['A0'
+00026780: 5d2c 205f 6130 2c20 6368 6563 6b5f 6d61  ], _a0, check_ma
+00026790: 726b 2829 290a 2020 2020 2020 2020 2020  rk()).          
+000267a0: 2020 5f70 6561 6b5b 5f69 5d5b 2753 636f    _peak[_i]['Sco
+000267b0: 7265 275d 202b 3d20 310a 2020 2020 2020  re'] += 1.      
+000267c0: 2020 2020 2020 5f70 6561 6b5b 5f69 5d5b        _peak[_i][
+000267d0: 2750 6173 7320 4c69 7374 275d 5b27 5065  'Pass List']['Pe
+000267e0: 616b 2041 6d70 2e20 436c 6172 6974 7927  ak Amp. Clarity'
+000267f0: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
+00026800: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00026810: 2020 205f 7065 616b 5b5f 695d 5b27 5265     _peak[_i]['Re
+00026820: 706f 7274 275d 5b27 4130 275d 203d 2027  port']['A0'] = '
+00026830: 2531 302e 3266 203e 2025 302e 3166 2025  %10.2f > %0.1f %
+00026840: 3173 2720 2520 285f 7065 616b 5b5f 695d  1s' % (_peak[_i]
+00026850: 5b27 4130 275d 2c20 5f61 302c 2027 e29c  ['A0'], _a0, '..
+00026860: 9827 290a 2020 2020 2020 2020 2020 2020  .').            
+00026870: 5f70 6561 6b5b 5f69 5d5b 2750 6173 7320  _peak[_i]['Pass 
+00026880: 4c69 7374 275d 5b27 5065 616b 2041 6d70  List']['Peak Amp
+00026890: 2e20 436c 6172 6974 7927 5d20 3d20 4661  . Clarity'] = Fa
+000268a0: 6c73 650a 0a20 2020 2072 6574 7572 6e20  lse..    return 
+000268b0: 5f70 6561 6b0a 0a23 4368 6563 6b20 7468  _peak..#Check th
+000268c0: 6520 7374 6162 696c 6974 7920 6f66 2074  e stability of t
+000268d0: 6865 2066 7265 7175 656e 6379 2070 6561  he frequency pea
+000268e0: 6b0a 6465 6620 5f5f 6368 6563 6b5f 6672  k.def __check_fr
+000268f0: 6571 5f73 7461 6269 6c69 7479 285f 7065  eq_stability(_pe
+00026900: 616b 2c20 5f70 6561 6b6d 2c20 5f70 6561  ak, _peakm, _pea
+00026910: 6b70 293a 0a20 2020 2022 2222 5465 7374  kp):.    """Test
+00026920: 2070 6561 6b73 2066 6f72 2073 6174 6973   peaks for satis
+00026930: 6679 696e 6720 7374 6162 696c 6974 7920  fying stability 
+00026940: 636f 6e64 6974 696f 6e73 200a 0a20 2020  conditions ..   
+00026950: 2054 6573 7420 6173 206f 7574 6c69 6e65   Test as outline
+00026960: 6420 6279 2053 4553 414d 4520 3230 3034  d by SESAME 2004
+00026970: 3a0a 2020 2020 2020 2020 2d20 7468 6520  :.        - the 
+00026980: 5f70 6561 6b20 7368 6f75 6c64 2061 7070  _peak should app
+00026990: 6561 7220 6174 2074 6865 2073 616d 6520  ear at the same 
+000269a0: 6672 6571 7565 6e63 7920 2877 6974 6869  frequency (withi
+000269b0: 6e20 6120 7065 7263 656e 7461 6765 20c2  n a percentage .
+000269c0: b120 3525 2920 6f6e 2074 6865 2048 2f56  . 5%) on the H/V
+000269d0: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
+000269e0: 7665 7320 636f 7272 6573 706f 6e64 696e  ves correspondin
+000269f0: 6720 746f 206d 6561 6e20 2b20 616e 6420  g to mean + and 
+00026a00: 2d20 6f6e 6520 7374 616e 6461 7264 2064  - one standard d
+00026a10: 6576 6961 7469 6f6e 2e0a 0a20 2020 2050  eviation...    P
+00026a20: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00026a30: 2d2d 2d2d 2d2d 2d2d 0a20 2020 205f 7065  --------.    _pe
+00026a40: 616b 203a 206c 6973 740a 2020 2020 2020  ak : list.      
+00026a50: 2020 4c69 7374 206f 6620 6469 6374 696f    List of dictio
+00026a60: 6e61 7269 6573 2063 6f6e 7461 696e 696e  naries containin
+00026a70: 6720 696e 7075 7420 696e 666f 726d 6174  g input informat
+00026a80: 696f 6e20 6162 6f75 7420 7065 616b 2c20  ion about peak, 
+00026a90: 7769 7468 6f75 7420 6672 6571 2073 7461  without freq sta
+00026aa0: 6269 6c69 7479 2074 6573 740a 2020 2020  bility test.    
+00026ab0: 5f70 6561 6b6d 203a 206c 6973 740a 2020  _peakm : list.  
+00026ac0: 2020 2020 2020 4c69 7374 206f 6620 6469        List of di
+00026ad0: 6374 696f 6e61 7269 6573 2063 6f6e 7461  ctionaries conta
+00026ae0: 696e 696e 6720 696e 7075 7420 696e 666f  ining input info
+00026af0: 726d 6174 696f 6e20 6162 6f75 7420 7065  rmation about pe
+00026b00: 616b 6d20 2870 6561 6b20 6d69 6e75 7320  akm (peak minus 
+00026b10: 6f6e 6520 5374 4465 7620 696e 2066 7265  one StDev in fre
+00026b20: 7129 0a20 2020 205f 7065 616b 7020 3a20  q).    _peakp : 
+00026b30: 6c69 7374 0a20 2020 2020 2020 204c 6973  list.        Lis
+00026b40: 7420 6f66 2064 6963 7469 6f6e 6172 6965  t of dictionarie
+00026b50: 7320 636f 6e74 6169 6e69 6e67 2069 6e70  s containing inp
+00026b60: 7574 2069 6e66 6f72 6d61 7469 6f6e 2061  ut information a
+00026b70: 626f 7574 2070 6561 6b20 2870 6561 6b20  bout peak (peak 
+00026b80: 706c 7573 206f 6e65 2053 7444 6576 2069  plus one StDev i
+00026b90: 6e20 6672 6571 2920 200a 0a20 2020 2052  n freq)  ..    R
+00026ba0: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
+00026bb0: 2d2d 0a20 2020 205f 7065 616b 203a 206c  --.    _peak : l
+00026bc0: 6973 740a 2020 2020 2020 2020 4c69 7374  ist.        List
+00026bd0: 206f 6620 6469 6374 696f 6e61 7269 6573   of dictionaries
+00026be0: 2063 6f6e 7461 696e 696e 6720 6f75 7470   containing outp
+00026bf0: 7574 2069 6e66 6f72 6d61 7469 6f6e 2061  ut information a
+00026c00: 626f 7574 2070 6561 6b20 7465 7374 2020  bout peak test  
+00026c10: 0a20 2020 2022 2222 0a20 2020 2067 6c6f  .    """.    glo
+00026c20: 6261 6c20 6d61 785f 7261 6e6b 0a0a 2020  bal max_rank..  
+00026c30: 2020 230a 2020 2020 2320 6368 6563 6b20    #.    # check 
+00026c40: cf83 6620 616e 6420 cf83 410a 2020 2020  ..f and ..A.    
+00026c50: 230a 2020 2020 6d61 785f 7261 6e6b 202b  #.    max_rank +
+00026c60: 3d20 310a 0a20 2020 2023 4669 7273 7420  = 1..    #First 
+00026c70: 6368 6563 6b20 6265 6c6f 770a 2020 2020  check below.    
+00026c80: 5f66 6f75 6e64 5f6d 203d 206c 6973 7428  _found_m = list(
+00026c90: 290a 2020 2020 666f 7220 5f69 2069 6e20  ).    for _i in 
+00026ca0: 7261 6e67 6528 6c65 6e28 5f70 6561 6b29  range(len(_peak)
+00026cb0: 293a 0a20 2020 2020 2020 205f 6478 203d  ):.        _dx =
+00026cc0: 2031 3030 3030 3030 2e0a 2020 2020 2020   1000000..      
+00026cd0: 2020 5f66 6f75 6e64 5f6d 2e61 7070 656e    _found_m.appen
+00026ce0: 6428 4661 6c73 6529 0a20 2020 2020 2020  d(False).       
+00026cf0: 205f 7065 616b 5b5f 695d 5b27 5265 706f   _peak[_i]['Repo
+00026d00: 7274 275d 5b27 502d 275d 203d 2027 e29c  rt']['P-'] = '..
+00026d10: 9827 0a20 2020 2020 2020 2066 6f72 205f  .'.        for _
+00026d20: 6a20 696e 2072 616e 6765 286c 656e 285f  j in range(len(_
+00026d30: 7065 616b 6d29 293a 0a20 2020 2020 2020  peakm)):.       
+00026d40: 2020 2020 2069 6620 6162 7328 5f70 6561       if abs(_pea
+00026d50: 6b6d 5b5f 6a5d 5b27 6630 275d 202d 205f  km[_j]['f0'] - _
+00026d60: 7065 616b 5b5f 695d 5b27 6630 275d 2920  peak[_i]['f0']) 
+00026d70: 3c20 5f64 783a 0a20 2020 2020 2020 2020  < _dx:.         
+00026d80: 2020 2020 2020 205f 696e 6465 7820 3d20         _index = 
+00026d90: 5f6a 0a20 2020 2020 2020 2020 2020 2020  _j.             
+00026da0: 2020 205f 6478 203d 2061 6273 285f 7065     _dx = abs(_pe
+00026db0: 616b 6d5b 5f6a 5d5b 2766 3027 5d20 2d20  akm[_j]['f0'] - 
+00026dc0: 5f70 6561 6b5b 5f69 5d5b 2766 3027 5d29  _peak[_i]['f0'])
+00026dd0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00026de0: 5f70 6561 6b5b 5f69 5d5b 2766 3027 5d20  _peak[_i]['f0'] 
+00026df0: 2a20 302e 3935 203c 3d20 5f70 6561 6b6d  * 0.95 <= _peakm
+00026e00: 5b5f 6a5d 5b27 6630 275d 203c 3d20 5f70  [_j]['f0'] <= _p
+00026e10: 6561 6b5b 5f69 5d5b 2766 3027 5d20 2a20  eak[_i]['f0'] * 
+00026e20: 312e 3035 3a0a 2020 2020 2020 2020 2020  1.05:.          
+00026e30: 2020 2020 2020 5f70 6561 6b5b 5f69 5d5b        _peak[_i][
+00026e40: 2752 6570 6f72 7427 5d5b 2750 2d27 5d20  'Report']['P-'] 
+00026e50: 3d20 2725 302e 3366 2077 6974 6869 6e20  = '%0.3f within 
+00026e60: c2b1 3525 7320 6f66 2025 302e 3366 2025  ..5%s of %0.3f %
+00026e70: 3173 2720 2520 285f 7065 616b 6d5b 5f6a  1s' % (_peakm[_j
+00026e80: 5d5b 2766 3027 5d2c 2027 2527 2c0a 2020  ]['f0'], '%',.  
+00026e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00026ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00026eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00026ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026ee0: 2020 2020 2020 2020 2020 2020 205f 7065               _pe
-00026ef0: 616b 5b5f 695d 5b27 6630 275d 2c20 6368  ak[_i]['f0'], ch
-00026f00: 6563 6b5f 6d61 726b 2829 290a 2020 2020  eck_mark()).    
-00026f10: 2020 2020 2020 2020 2020 2020 5f66 6f75              _fou
-00026f20: 6e64 5f6d 5b5f 695d 203d 2054 7275 650a  nd_m[_i] = True.
-00026f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026f40: 6272 6561 6b0a 2020 2020 2020 2020 6966  break.        if
-00026f50: 205f 7065 616b 5b5f 695d 5b27 5265 706f   _peak[_i]['Repo
-00026f60: 7274 275d 5b27 502d 275d 203d 3d20 27e2  rt']['P-'] == '.
-00026f70: 9c98 273a 0a20 2020 2020 2020 2020 2020  ..':.           
-00026f80: 205f 7065 616b 5b5f 695d 5b27 5265 706f   _peak[_i]['Repo
-00026f90: 7274 275d 5b27 502d 275d 203d 2027 2530  rt']['P-'] = '%0
-00026fa0: 2e33 6620 7769 7468 696e 20c2 b135 2573  .3f within ..5%s
-00026fb0: 206f 6620 2530 2e33 6620 2531 7327 2025   of %0.3f %1s' %
-00026fc0: 2028 5f70 6561 6b6d 5b5f 6a5d 5b27 6630   (_peakm[_j]['f0
-00026fd0: 275d 2c20 2725 272c 2023 2363 6861 6e67  '], '%', ##chang
-00026fe0: 6564 2069 2074 6f20 6a0a 2020 2020 2020  ed i to j.      
+00026ed0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+00026ee0: 7065 616b 5b5f 695d 5b27 6630 275d 2c20  peak[_i]['f0'], 
+00026ef0: 6368 6563 6b5f 6d61 726b 2829 290a 2020  check_mark()).  
+00026f00: 2020 2020 2020 2020 2020 2020 2020 5f66                _f
+00026f10: 6f75 6e64 5f6d 5b5f 695d 203d 2054 7275  ound_m[_i] = Tru
+00026f20: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00026f30: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
+00026f40: 6966 205f 7065 616b 5b5f 695d 5b27 5265  if _peak[_i]['Re
+00026f50: 706f 7274 275d 5b27 502d 275d 203d 3d20  port']['P-'] == 
+00026f60: 27e2 9c98 273a 0a20 2020 2020 2020 2020  '...':.         
+00026f70: 2020 205f 7065 616b 5b5f 695d 5b27 5265     _peak[_i]['Re
+00026f80: 706f 7274 275d 5b27 502d 275d 203d 2027  port']['P-'] = '
+00026f90: 2530 2e33 6620 7769 7468 696e 20c2 b135  %0.3f within ..5
+00026fa0: 2573 206f 6620 2530 2e33 6620 2531 7327  %s of %0.3f %1s'
+00026fb0: 2025 2028 5f70 6561 6b6d 5b5f 6a5d 5b27   % (_peakm[_j]['
+00026fc0: 6630 275d 2c20 2725 272c 2023 2363 6861  f0'], '%', ##cha
+00026fd0: 6e67 6564 2069 2074 6f20 6a0a 2020 2020  nged i to j.    
+00026fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00026ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00027000: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00027010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027030: 2020 2020 2020 205f 7065 616b 5b5f 695d         _peak[_i]
-00027040: 5b27 6630 275d 2c20 27e2 9c98 2729 0a0a  ['f0'], '...')..
-00027050: 2020 2020 2354 6865 6e20 4368 6563 6b20      #Then Check 
-00027060: 6162 6f76 650a 2020 2020 5f66 6f75 6e64  above.    _found
-00027070: 5f70 203d 206c 6973 7428 290a 2020 2020  _p = list().    
-00027080: 666f 7220 5f69 2069 6e20 7261 6e67 6528  for _i in range(
-00027090: 6c65 6e28 5f70 6561 6b29 293a 0a20 2020  len(_peak)):.   
-000270a0: 2020 2020 205f 6478 203d 2031 3030 3030       _dx = 10000
-000270b0: 3030 2e0a 2020 2020 2020 2020 5f66 6f75  00..        _fou
-000270c0: 6e64 5f70 2e61 7070 656e 6428 4661 6c73  nd_p.append(Fals
-000270d0: 6529 0a20 2020 2020 2020 205f 7065 616b  e).        _peak
-000270e0: 5b5f 695d 5b27 5265 706f 7274 275d 5b27  [_i]['Report']['
-000270f0: 502b 275d 203d 2027 e29c 9827 0a20 2020  P+'] = '...'.   
-00027100: 2020 2020 2066 6f72 205f 6a20 696e 2072       for _j in r
-00027110: 616e 6765 286c 656e 285f 7065 616b 7029  ange(len(_peakp)
-00027120: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00027130: 6620 6162 7328 5f70 6561 6b70 5b5f 6a5d  f abs(_peakp[_j]
-00027140: 5b27 6630 275d 202d 205f 7065 616b 5b5f  ['f0'] - _peak[_
-00027150: 695d 5b27 6630 275d 2920 3c20 5f64 783a  i]['f0']) < _dx:
-00027160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027170: 205f 696e 6465 7820 3d20 5f6a 0a20 2020   _index = _j.   
-00027180: 2020 2020 2020 2020 2020 2020 205f 6478               _dx
-00027190: 203d 2061 6273 285f 7065 616b 705b 5f6a   = abs(_peakp[_j
-000271a0: 5d5b 2766 3027 5d20 2d20 5f70 6561 6b5b  ]['f0'] - _peak[
-000271b0: 5f69 5d5b 2766 3027 5d29 0a20 2020 2020  _i]['f0']).     
-000271c0: 2020 2020 2020 2069 6620 5f70 6561 6b5b         if _peak[
-000271d0: 5f69 5d5b 2766 3027 5d20 2a20 302e 3935  _i]['f0'] * 0.95
-000271e0: 203c 3d20 5f70 6561 6b70 5b5f 6a5d 5b27   <= _peakp[_j]['
-000271f0: 6630 275d 203c 3d20 5f70 6561 6b5b 5f69  f0'] <= _peak[_i
-00027200: 5d5b 2766 3027 5d20 2a20 312e 3035 3a0a  ]['f0'] * 1.05:.
-00027210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027220: 6966 205f 666f 756e 645f 6d5b 5f69 5d3a  if _found_m[_i]:
-00027230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027240: 2020 2020 205f 7065 616b 5b5f 695d 5b27       _peak[_i]['
-00027250: 5265 706f 7274 275d 5b27 502b 275d 203d  Report']['P+'] =
-00027260: 2027 2530 2e33 6620 7769 7468 696e 20c2   '%0.3f within .
-00027270: b135 2573 206f 6620 2530 2e33 6620 2531  .5%s of %0.3f %1
-00027280: 7327 2025 2028 0a20 2020 2020 2020 2020  s' % (.         
-00027290: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-000272a0: 7065 616b 705b 5f6a 5d5b 2766 3027 5d2c  peakp[_j]['f0'],
-000272b0: 2027 2527 2c20 5f70 6561 6b5b 5f69 5d5b   '%', _peak[_i][
-000272c0: 2766 3027 5d2c 2063 6865 636b 5f6d 6172  'f0'], check_mar
-000272d0: 6b28 2929 0a20 2020 2020 2020 2020 2020  k()).           
-000272e0: 2020 2020 2020 2020 205f 7065 616b 5b5f           _peak[_
-000272f0: 695d 5b27 5363 6f72 6527 5d20 2b3d 2031  i]['Score'] += 1
-00027300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027310: 2020 2020 205f 7065 616b 5b5f 695d 5b27       _peak[_i]['
-00027320: 5061 7373 204c 6973 7427 5d5b 2746 7265  Pass List']['Fre
-00027330: 712e 2053 7461 6269 6c69 7479 275d 203d  q. Stability'] =
-00027340: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00027350: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00027360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027370: 5f70 6561 6b5b 5f69 5d5b 2752 6570 6f72  _peak[_i]['Repor
-00027380: 7427 5d5b 2750 2b27 5d20 3d20 2725 302e  t']['P+'] = '%0.
-00027390: 3366 2077 6974 6869 6e20 c2b1 3525 7320  3f within ..5%s 
-000273a0: 6f66 2025 302e 3366 2025 3173 2720 2520  of %0.3f %1s' % 
-000273b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000273c0: 2020 2020 2020 2020 2020 5f70 6561 6b70            _peakp
-000273d0: 5b5f 6a5d 5b27 6630 275d 2c20 2725 272c  [_j]['f0'], '%',
-000273e0: 205f 7065 616b 5b5f 695d 5b27 6630 275d   _peak[_i]['f0']
-000273f0: 2c20 27e2 9c98 2729 0a20 2020 2020 2020  , '...').       
-00027400: 2020 2020 2020 2020 2020 2020 205f 7065               _pe
-00027410: 616b 5b5f 695d 5b27 5061 7373 204c 6973  ak[_i]['Pass Lis
-00027420: 7427 5d5b 2746 7265 712e 2053 7461 6269  t']['Freq. Stabi
-00027430: 6c69 7479 275d 203d 2046 616c 7365 0a20  lity'] = False. 
-00027440: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00027450: 7265 616b 0a20 2020 2020 2020 2069 6620  reak.        if 
-00027460: 5f70 6561 6b5b 5f69 5d5b 2752 6570 6f72  _peak[_i]['Repor
-00027470: 7427 5d5b 2750 2b27 5d20 3d3d 2027 e29c  t']['P+'] == '..
-00027480: 9827 2061 6e64 206c 656e 285f 7065 616b  .' and len(_peak
-00027490: 7029 203e 2030 3a0a 2020 2020 2020 2020  p) > 0:.        
-000274a0: 2020 2020 5f70 6561 6b5b 5f69 5d5b 2752      _peak[_i]['R
-000274b0: 6570 6f72 7427 5d5b 2750 2b27 5d20 3d20  eport']['P+'] = 
-000274c0: 2725 302e 3366 2077 6974 6869 6e20 c2b1  '%0.3f within ..
-000274d0: 3525 7320 6f66 2025 302e 3366 2025 3173  5%s of %0.3f %1s
-000274e0: 2720 2520 280a 2020 2020 2020 2020 2020  ' % (.          
-000274f0: 2020 2020 2020 5f70 6561 6b70 5b5f 6a5d        _peakp[_j]
-00027500: 5b27 6630 275d 2c20 2725 272c 205f 7065  ['f0'], '%', _pe
-00027510: 616b 5b5f 695d 5b27 6630 275d 2c20 27e2  ak[_i]['f0'], '.
-00027520: 9c98 2729 2323 2363 6861 6e67 6564 2069  ..')###changed i
-00027530: 2074 6f20 6a0a 0a20 2020 2072 6574 7572   to j..    retur
-00027540: 6e20 5f70 6561 6b0a 0a23 4368 6563 6b20  n _peak..#Check 
-00027550: 7374 6162 696c 6974 790a 6465 6620 5f5f  stability.def __
-00027560: 6368 6563 6b5f 7374 6162 696c 6974 7928  check_stability(
-00027570: 5f73 7464 662c 205f 7065 616b 2c20 5f68  _stdf, _peak, _h
-00027580: 7673 725f 6c6f 675f 7374 642c 2072 616e  vsr_log_std, ran
-00027590: 6b29 3a0a 2020 2020 2222 2254 6573 7420  k):.    """Test 
-000275a0: 7065 616b 7320 666f 7220 7361 7469 7366  peaks for satisf
-000275b0: 7969 6e67 2073 7461 6269 6c69 7479 2063  ying stability c
-000275c0: 6f6e 6469 7469 6f6e 7320 6173 206f 7574  onditions as out
-000275d0: 6c69 6e65 6420 6279 2053 4553 414d 4520  lined by SESAME 
-000275e0: 3230 3034 0a20 2020 2054 6869 7320 696e  2004.    This in
-000275f0: 636c 7564 6573 3a0a 2020 2020 2020 202d  cludes:.       -
-00027600: 20cf 8366 206c 6f77 6572 2074 6861 6e20   ..f lower than 
-00027610: 6120 6672 6571 7565 6e63 7920 6465 7065  a frequency depe
-00027620: 6e64 656e 7420 7468 7265 7368 6f6c 6420  ndent threshold 
-00027630: ceb5 2866 290a 2020 2020 2020 202d 20cf  ..(f).       - .
-00027640: 8341 2028 6630 2920 6c6f 7765 7220 7468  .A (f0) lower th
-00027650: 616e 2061 2066 7265 7175 656e 6379 2064  an a frequency d
-00027660: 6570 656e 6465 6e74 2074 6872 6573 686f  ependent thresho
-00027670: 6c64 20ce b828 6629 2c0a 0a0a 2020 2020  ld ..(f),...    
-00027680: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-00027690: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 5f73  ---------.    _s
-000276a0: 7464 6620 3a20 6c69 7374 0a20 2020 2020  tdf : list.     
-000276b0: 2020 204c 6973 7420 7769 7468 2064 6963     List with dic
-000276c0: 7469 6f6e 6172 6965 7320 636f 6e74 6169  tionaries contai
-000276d0: 6e69 6e74 2066 7265 7175 656e 6379 2073  nint frequency s
-000276e0: 7461 6e64 6172 6420 6465 7669 6174 696f  tandard deviatio
-000276f0: 6e20 666f 7220 6561 6368 2070 6561 6b0a  n for each peak.
-00027700: 2020 2020 5f70 6561 6b20 3a20 6c69 7374      _peak : list
-00027710: 0a20 2020 2020 2020 204c 6973 7420 6f66  .        List of
-00027720: 2064 6963 7469 6f6e 6172 6965 7320 636f   dictionaries co
-00027730: 6e74 6169 6e69 6e67 2069 6e70 7574 2069  ntaining input i
-00027740: 6e66 6f72 6d61 7469 6f6e 2061 626f 7574  nformation about
-00027750: 2070 6561 6b2c 2077 6974 686f 7574 2066   peak, without f
-00027760: 7265 7120 7374 6162 696c 6974 7920 7465  req stability te
-00027770: 7374 0a20 2020 205f 6876 7372 5f6c 6f67  st.    _hvsr_log
-00027780: 5f73 7464 203a 206c 6973 740a 2020 2020  _std : list.    
-00027790: 2020 2020 4c69 7374 206f 6620 6469 6374      List of dict
-000277a0: 696f 6e61 7269 6573 2063 6f6e 7461 696e  ionaries contain
-000277b0: 696e 6720 6c6f 6720 7374 616e 6461 7264  ing log standard
-000277c0: 2064 6576 6961 7469 6f6e 2061 6c6f 6e67   deviation along
-000277d0: 2063 7572 7665 0a20 2020 2072 616e 6b20   curve.    rank 
-000277e0: 3a20 696e 740a 2020 2020 2020 2020 496e  : int.        In
-000277f0: 7465 6765 7220 7661 6c75 652c 2068 6967  teger value, hig
-00027800: 6865 7220 7661 6c75 6520 6973 2022 6869  her value is "hi
-00027810: 6768 6572 2d72 616e 6b65 6422 2070 6561  gher-ranked" pea
-00027820: 6b2c 2068 656c 7073 2064 6574 6572 6d69  k, helps determi
-00027830: 6e65 2077 6869 6368 2070 6561 6b20 6973  ne which peak is
-00027840: 2061 6374 7561 6c20 6876 7372 2070 6561   actual hvsr pea
-00027850: 6b20 200a 0a20 2020 2052 6574 7572 6e73  k  ..    Returns
-00027860: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
-00027870: 205f 7065 616b 203a 206c 6973 740a 2020   _peak : list.  
-00027880: 2020 2020 2020 4c69 7374 206f 6620 6469        List of di
-00027890: 6374 696f 6e61 7269 6573 2063 6f6e 7461  ctionaries conta
-000278a0: 696e 696e 6720 6f75 7470 7574 2069 6e66  ining output inf
-000278b0: 6f72 6d61 7469 6f6e 2061 626f 7574 2070  ormation about p
-000278c0: 6561 6b20 7465 7374 2020 0a20 2020 2022  eak test  .    "
-000278d0: 2222 0a0a 2020 2020 676c 6f62 616c 206d  ""..    global m
-000278e0: 6178 5f72 616e 6b0a 0a20 2020 2070 6561  ax_rank..    pea
-000278f0: 6b50 6173 734c 6973 7420 3d20 5b5d 0a20  kPassList = []. 
-00027900: 2020 2023 0a20 2020 2023 2063 6865 636b     #.    # check
-00027910: 20cf 8366 2061 6e64 20cf 8341 0a20 2020   ..f and ..A.   
-00027920: 2023 0a20 2020 2069 6620 7261 6e6b 3a0a   #.    if rank:.
-00027930: 2020 2020 2020 2020 6d61 785f 7261 6e6b          max_rank
-00027940: 202b 3d20 320a 2020 2020 666f 7220 5f69   += 2.    for _i
-00027950: 2069 6e20 7261 6e67 6528 6c65 6e28 5f70   in range(len(_p
-00027960: 6561 6b29 293a 0a20 2020 2020 2020 205f  eak)):.        _
-00027970: 7065 616b 5b5f 695d 5b27 5366 275d 203d  peak[_i]['Sf'] =
-00027980: 205f 7374 6466 5b5f 695d 0a20 2020 2020   _stdf[_i].     
-00027990: 2020 205f 7065 616b 5b5f 695d 5b27 5361     _peak[_i]['Sa
-000279a0: 275d 203d 205f 6876 7372 5f6c 6f67 5f73  '] = _hvsr_log_s
-000279b0: 7464 5b5f 695d 0a20 2020 2020 2020 205f  td[_i].        _
-000279c0: 7468 6973 5f70 6561 6b20 3d20 5f70 6561  this_peak = _pea
-000279d0: 6b5b 5f69 5d0a 2020 2020 2020 2020 6966  k[_i].        if
-000279e0: 205f 7468 6973 5f70 6561 6b5b 2766 3027   _this_peak['f0'
-000279f0: 5d20 3c20 302e 323a 0a20 2020 2020 2020  ] < 0.2:.       
-00027a00: 2020 2020 205f 6520 3d20 302e 3235 0a20       _e = 0.25. 
-00027a10: 2020 2020 2020 2020 2020 2069 6620 5f73             if _s
-00027a20: 7464 665b 5f69 5d20 3c20 5f65 202a 205f  tdf[_i] < _e * _
-00027a30: 7468 6973 5f70 6561 6b5b 2766 3027 5d3a  this_peak['f0']:
-00027a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027a50: 205f 7065 616b 5b5f 695d 5b27 5265 706f   _peak[_i]['Repo
-00027a60: 7274 275d 5b27 5366 275d 203d 2027 2531  rt']['Sf'] = '%1
-00027a70: 302e 3466 203c 2025 302e 3266 202a 2025  0.4f < %0.2f * %
-00027a80: 302e 3366 2025 3173 2720 2520 285f 7374  0.3f %1s' % (_st
-00027a90: 6466 5b5f 695d 2c20 5f65 2c20 5f74 6869  df[_i], _e, _thi
-00027aa0: 735f 7065 616b 5b27 6630 275d 2c0a 2020  s_peak['f0'],.  
+00027020: 2020 2020 2020 2020 205f 7065 616b 5b5f           _peak[_
+00027030: 695d 5b27 6630 275d 2c20 27e2 9c98 2729  i]['f0'], '...')
+00027040: 0a0a 2020 2020 2354 6865 6e20 4368 6563  ..    #Then Chec
+00027050: 6b20 6162 6f76 650a 2020 2020 5f66 6f75  k above.    _fou
+00027060: 6e64 5f70 203d 206c 6973 7428 290a 2020  nd_p = list().  
+00027070: 2020 666f 7220 5f69 2069 6e20 7261 6e67    for _i in rang
+00027080: 6528 6c65 6e28 5f70 6561 6b29 293a 0a20  e(len(_peak)):. 
+00027090: 2020 2020 2020 205f 6478 203d 2031 3030         _dx = 100
+000270a0: 3030 3030 2e0a 2020 2020 2020 2020 5f66  0000..        _f
+000270b0: 6f75 6e64 5f70 2e61 7070 656e 6428 4661  ound_p.append(Fa
+000270c0: 6c73 6529 0a20 2020 2020 2020 205f 7065  lse).        _pe
+000270d0: 616b 5b5f 695d 5b27 5265 706f 7274 275d  ak[_i]['Report']
+000270e0: 5b27 502b 275d 203d 2027 e29c 9827 0a20  ['P+'] = '...'. 
+000270f0: 2020 2020 2020 2066 6f72 205f 6a20 696e         for _j in
+00027100: 2072 616e 6765 286c 656e 285f 7065 616b   range(len(_peak
+00027110: 7029 293a 0a20 2020 2020 2020 2020 2020  p)):.           
+00027120: 2069 6620 6162 7328 5f70 6561 6b70 5b5f   if abs(_peakp[_
+00027130: 6a5d 5b27 6630 275d 202d 205f 7065 616b  j]['f0'] - _peak
+00027140: 5b5f 695d 5b27 6630 275d 2920 3c20 5f64  [_i]['f0']) < _d
+00027150: 783a 0a20 2020 2020 2020 2020 2020 2020  x:.             
+00027160: 2020 205f 696e 6465 7820 3d20 5f6a 0a20     _index = _j. 
+00027170: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+00027180: 6478 203d 2061 6273 285f 7065 616b 705b  dx = abs(_peakp[
+00027190: 5f6a 5d5b 2766 3027 5d20 2d20 5f70 6561  _j]['f0'] - _pea
+000271a0: 6b5b 5f69 5d5b 2766 3027 5d29 0a20 2020  k[_i]['f0']).   
+000271b0: 2020 2020 2020 2020 2069 6620 5f70 6561           if _pea
+000271c0: 6b5b 5f69 5d5b 2766 3027 5d20 2a20 302e  k[_i]['f0'] * 0.
+000271d0: 3935 203c 3d20 5f70 6561 6b70 5b5f 6a5d  95 <= _peakp[_j]
+000271e0: 5b27 6630 275d 203c 3d20 5f70 6561 6b5b  ['f0'] <= _peak[
+000271f0: 5f69 5d5b 2766 3027 5d20 2a20 312e 3035  _i]['f0'] * 1.05
+00027200: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00027210: 2020 6966 205f 666f 756e 645f 6d5b 5f69    if _found_m[_i
+00027220: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00027230: 2020 2020 2020 205f 7065 616b 5b5f 695d         _peak[_i]
+00027240: 5b27 5265 706f 7274 275d 5b27 502b 275d  ['Report']['P+']
+00027250: 203d 2027 2530 2e33 6620 7769 7468 696e   = '%0.3f within
+00027260: 20c2 b135 2573 206f 6620 2530 2e33 6620   ..5%s of %0.3f 
+00027270: 2531 7327 2025 2028 0a20 2020 2020 2020  %1s' % (.       
+00027280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027290: 205f 7065 616b 705b 5f6a 5d5b 2766 3027   _peakp[_j]['f0'
+000272a0: 5d2c 2027 2527 2c20 5f70 6561 6b5b 5f69  ], '%', _peak[_i
+000272b0: 5d5b 2766 3027 5d2c 2063 6865 636b 5f6d  ]['f0'], check_m
+000272c0: 6172 6b28 2929 0a20 2020 2020 2020 2020  ark()).         
+000272d0: 2020 2020 2020 2020 2020 205f 7065 616b             _peak
+000272e0: 5b5f 695d 5b27 5363 6f72 6527 5d20 2b3d  [_i]['Score'] +=
+000272f0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00027300: 2020 2020 2020 205f 7065 616b 5b5f 695d         _peak[_i]
+00027310: 5b27 5061 7373 204c 6973 7427 5d5b 2746  ['Pass List']['F
+00027320: 7265 712e 2053 7461 6269 6c69 7479 275d  req. Stability']
+00027330: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00027340: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00027350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027360: 2020 5f70 6561 6b5b 5f69 5d5b 2752 6570    _peak[_i]['Rep
+00027370: 6f72 7427 5d5b 2750 2b27 5d20 3d20 2725  ort']['P+'] = '%
+00027380: 302e 3366 2077 6974 6869 6e20 c2b1 3525  0.3f within ..5%
+00027390: 7320 6f66 2025 302e 3366 2025 3173 2720  s of %0.3f %1s' 
+000273a0: 2520 280a 2020 2020 2020 2020 2020 2020  % (.            
+000273b0: 2020 2020 2020 2020 2020 2020 5f70 6561              _pea
+000273c0: 6b70 5b5f 6a5d 5b27 6630 275d 2c20 2725  kp[_j]['f0'], '%
+000273d0: 272c 205f 7065 616b 5b5f 695d 5b27 6630  ', _peak[_i]['f0
+000273e0: 275d 2c20 27e2 9c98 2729 0a20 2020 2020  '], '...').     
+000273f0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+00027400: 7065 616b 5b5f 695d 5b27 5061 7373 204c  peak[_i]['Pass L
+00027410: 6973 7427 5d5b 2746 7265 712e 2053 7461  ist']['Freq. Sta
+00027420: 6269 6c69 7479 275d 203d 2046 616c 7365  bility'] = False
+00027430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027440: 2062 7265 616b 0a20 2020 2020 2020 2069   break.        i
+00027450: 6620 5f70 6561 6b5b 5f69 5d5b 2752 6570  f _peak[_i]['Rep
+00027460: 6f72 7427 5d5b 2750 2b27 5d20 3d3d 2027  ort']['P+'] == '
+00027470: e29c 9827 2061 6e64 206c 656e 285f 7065  ...' and len(_pe
+00027480: 616b 7029 203e 2030 3a0a 2020 2020 2020  akp) > 0:.      
+00027490: 2020 2020 2020 5f70 6561 6b5b 5f69 5d5b        _peak[_i][
+000274a0: 2752 6570 6f72 7427 5d5b 2750 2b27 5d20  'Report']['P+'] 
+000274b0: 3d20 2725 302e 3366 2077 6974 6869 6e20  = '%0.3f within 
+000274c0: c2b1 3525 7320 6f66 2025 302e 3366 2025  ..5%s of %0.3f %
+000274d0: 3173 2720 2520 280a 2020 2020 2020 2020  1s' % (.        
+000274e0: 2020 2020 2020 2020 5f70 6561 6b70 5b5f          _peakp[_
+000274f0: 6a5d 5b27 6630 275d 2c20 2725 272c 205f  j]['f0'], '%', _
+00027500: 7065 616b 5b5f 695d 5b27 6630 275d 2c20  peak[_i]['f0'], 
+00027510: 27e2 9c98 2729 2323 2363 6861 6e67 6564  '...')###changed
+00027520: 2069 2074 6f20 6a0a 0a20 2020 2072 6574   i to j..    ret
+00027530: 7572 6e20 5f70 6561 6b0a 0a23 4368 6563  urn _peak..#Chec
+00027540: 6b20 7374 6162 696c 6974 790a 6465 6620  k stability.def 
+00027550: 5f5f 6368 6563 6b5f 7374 6162 696c 6974  __check_stabilit
+00027560: 7928 5f73 7464 662c 205f 7065 616b 2c20  y(_stdf, _peak, 
+00027570: 5f68 7673 725f 6c6f 675f 7374 642c 2072  _hvsr_log_std, r
+00027580: 616e 6b29 3a0a 2020 2020 2222 2254 6573  ank):.    """Tes
+00027590: 7420 7065 616b 7320 666f 7220 7361 7469  t peaks for sati
+000275a0: 7366 7969 6e67 2073 7461 6269 6c69 7479  sfying stability
+000275b0: 2063 6f6e 6469 7469 6f6e 7320 6173 206f   conditions as o
+000275c0: 7574 6c69 6e65 6420 6279 2053 4553 414d  utlined by SESAM
+000275d0: 4520 3230 3034 0a20 2020 2054 6869 7320  E 2004.    This 
+000275e0: 696e 636c 7564 6573 3a0a 2020 2020 2020  includes:.      
+000275f0: 202d 20cf 8366 206c 6f77 6572 2074 6861   - ..f lower tha
+00027600: 6e20 6120 6672 6571 7565 6e63 7920 6465  n a frequency de
+00027610: 7065 6e64 656e 7420 7468 7265 7368 6f6c  pendent threshol
+00027620: 6420 ceb5 2866 290a 2020 2020 2020 202d  d ..(f).       -
+00027630: 20cf 8341 2028 6630 2920 6c6f 7765 7220   ..A (f0) lower 
+00027640: 7468 616e 2061 2066 7265 7175 656e 6379  than a frequency
+00027650: 2064 6570 656e 6465 6e74 2074 6872 6573   dependent thres
+00027660: 686f 6c64 20ce b828 6629 2c0a 0a0a 2020  hold ..(f),...  
+00027670: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00027680: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00027690: 5f73 7464 6620 3a20 6c69 7374 0a20 2020  _stdf : list.   
+000276a0: 2020 2020 204c 6973 7420 7769 7468 2064       List with d
+000276b0: 6963 7469 6f6e 6172 6965 7320 636f 6e74  ictionaries cont
+000276c0: 6169 6e69 6e74 2066 7265 7175 656e 6379  ainint frequency
+000276d0: 2073 7461 6e64 6172 6420 6465 7669 6174   standard deviat
+000276e0: 696f 6e20 666f 7220 6561 6368 2070 6561  ion for each pea
+000276f0: 6b0a 2020 2020 5f70 6561 6b20 3a20 6c69  k.    _peak : li
+00027700: 7374 0a20 2020 2020 2020 204c 6973 7420  st.        List 
+00027710: 6f66 2064 6963 7469 6f6e 6172 6965 7320  of dictionaries 
+00027720: 636f 6e74 6169 6e69 6e67 2069 6e70 7574  containing input
+00027730: 2069 6e66 6f72 6d61 7469 6f6e 2061 626f   information abo
+00027740: 7574 2070 6561 6b2c 2077 6974 686f 7574  ut peak, without
+00027750: 2066 7265 7120 7374 6162 696c 6974 7920   freq stability 
+00027760: 7465 7374 0a20 2020 205f 6876 7372 5f6c  test.    _hvsr_l
+00027770: 6f67 5f73 7464 203a 206c 6973 740a 2020  og_std : list.  
+00027780: 2020 2020 2020 4c69 7374 206f 6620 6469        List of di
+00027790: 6374 696f 6e61 7269 6573 2063 6f6e 7461  ctionaries conta
+000277a0: 696e 696e 6720 6c6f 6720 7374 616e 6461  ining log standa
+000277b0: 7264 2064 6576 6961 7469 6f6e 2061 6c6f  rd deviation alo
+000277c0: 6e67 2063 7572 7665 0a20 2020 2072 616e  ng curve.    ran
+000277d0: 6b20 3a20 696e 740a 2020 2020 2020 2020  k : int.        
+000277e0: 496e 7465 6765 7220 7661 6c75 652c 2068  Integer value, h
+000277f0: 6967 6865 7220 7661 6c75 6520 6973 2022  igher value is "
+00027800: 6869 6768 6572 2d72 616e 6b65 6422 2070  higher-ranked" p
+00027810: 6561 6b2c 2068 656c 7073 2064 6574 6572  eak, helps deter
+00027820: 6d69 6e65 2077 6869 6368 2070 6561 6b20  mine which peak 
+00027830: 6973 2061 6374 7561 6c20 6876 7372 2070  is actual hvsr p
+00027840: 6561 6b20 200a 0a20 2020 2052 6574 7572  eak  ..    Retur
+00027850: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
+00027860: 2020 205f 7065 616b 203a 206c 6973 740a     _peak : list.
+00027870: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
+00027880: 6469 6374 696f 6e61 7269 6573 2063 6f6e  dictionaries con
+00027890: 7461 696e 696e 6720 6f75 7470 7574 2069  taining output i
+000278a0: 6e66 6f72 6d61 7469 6f6e 2061 626f 7574  nformation about
+000278b0: 2070 6561 6b20 7465 7374 2020 0a20 2020   peak test  .   
+000278c0: 2022 2222 0a0a 2020 2020 676c 6f62 616c   """..    global
+000278d0: 206d 6178 5f72 616e 6b0a 0a20 2020 2070   max_rank..    p
+000278e0: 6561 6b50 6173 734c 6973 7420 3d20 5b5d  eakPassList = []
+000278f0: 0a20 2020 2023 0a20 2020 2023 2063 6865  .    #.    # che
+00027900: 636b 20cf 8366 2061 6e64 20cf 8341 0a20  ck ..f and ..A. 
+00027910: 2020 2023 0a20 2020 2069 6620 7261 6e6b     #.    if rank
+00027920: 3a0a 2020 2020 2020 2020 6d61 785f 7261  :.        max_ra
+00027930: 6e6b 202b 3d20 320a 2020 2020 666f 7220  nk += 2.    for 
+00027940: 5f69 2069 6e20 7261 6e67 6528 6c65 6e28  _i in range(len(
+00027950: 5f70 6561 6b29 293a 0a20 2020 2020 2020  _peak)):.       
+00027960: 205f 7065 616b 5b5f 695d 5b27 5366 275d   _peak[_i]['Sf']
+00027970: 203d 205f 7374 6466 5b5f 695d 0a20 2020   = _stdf[_i].   
+00027980: 2020 2020 205f 7065 616b 5b5f 695d 5b27       _peak[_i]['
+00027990: 5361 275d 203d 205f 6876 7372 5f6c 6f67  Sa'] = _hvsr_log
+000279a0: 5f73 7464 5b5f 695d 0a20 2020 2020 2020  _std[_i].       
+000279b0: 205f 7468 6973 5f70 6561 6b20 3d20 5f70   _this_peak = _p
+000279c0: 6561 6b5b 5f69 5d0a 2020 2020 2020 2020  eak[_i].        
+000279d0: 6966 205f 7468 6973 5f70 6561 6b5b 2766  if _this_peak['f
+000279e0: 3027 5d20 3c20 302e 323a 0a20 2020 2020  0'] < 0.2:.     
+000279f0: 2020 2020 2020 205f 6520 3d20 302e 3235         _e = 0.25
+00027a00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00027a10: 5f73 7464 665b 5f69 5d20 3c20 5f65 202a  _stdf[_i] < _e *
+00027a20: 205f 7468 6973 5f70 6561 6b5b 2766 3027   _this_peak['f0'
+00027a30: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00027a40: 2020 205f 7065 616b 5b5f 695d 5b27 5265     _peak[_i]['Re
+00027a50: 706f 7274 275d 5b27 5366 275d 203d 2027  port']['Sf'] = '
+00027a60: 2531 302e 3466 203c 2025 302e 3266 202a  %10.4f < %0.2f *
+00027a70: 2025 302e 3366 2025 3173 2720 2520 285f   %0.3f %1s' % (_
+00027a80: 7374 6466 5b5f 695d 2c20 5f65 2c20 5f74  stdf[_i], _e, _t
+00027a90: 6869 735f 7065 616b 5b27 6630 275d 2c0a  his_peak['f0'],.
+00027aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00027ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00027ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00027ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027af0: 2020 2020 2020 2020 2020 6368 6563 6b5f            check_
-00027b00: 6d61 726b 2829 290a 2020 2020 2020 2020  mark()).        
-00027b10: 2020 2020 2020 2020 5f74 6869 735f 7065          _this_pe
-00027b20: 616b 5b27 5363 6f72 6527 5d20 2b3d 2031  ak['Score'] += 1
-00027b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027b40: 205f 7468 6973 5f70 6561 6b5b 2750 6173   _this_peak['Pas
-00027b50: 7320 4c69 7374 275d 5b27 5065 616b 2053  s List']['Peak S
-00027b60: 7461 6269 6c69 7479 2028 6672 6571 2e20  tability (freq. 
-00027b70: 7374 6429 275d 203d 2054 7275 650a 0a20  std)'] = True.. 
-00027b80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00027b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027ba0: 205f 7065 616b 5b5f 695d 5b27 5265 706f   _peak[_i]['Repo
-00027bb0: 7274 275d 5b27 5366 275d 203d 2027 2531  rt']['Sf'] = '%1
-00027bc0: 302e 3466 203c 2025 302e 3266 202a 2025  0.4f < %0.2f * %
-00027bd0: 302e 3366 2020 2531 7327 2025 2028 5f73  0.3f  %1s' % (_s
-00027be0: 7464 665b 5f69 5d2c 205f 652c 205f 7468  tdf[_i], _e, _th
-00027bf0: 6973 5f70 6561 6b5b 2766 3027 5d2c 2027  is_peak['f0'], '
-00027c00: e29c 9827 290a 2020 2020 2020 2020 2020  ...').          
-00027c10: 2020 2020 2020 5f74 6869 735f 7065 616b        _this_peak
-00027c20: 5b27 5061 7373 204c 6973 7427 5d5b 2750  ['Pass List']['P
-00027c30: 6561 6b20 5374 6162 696c 6974 7920 2866  eak Stability (f
-00027c40: 7265 712e 2073 7464 2927 5d20 3d20 4661  req. std)'] = Fa
-00027c50: 6c73 650a 0a20 2020 2020 2020 2020 2020  lse..           
-00027c60: 205f 7420 3d20 302e 3438 0a20 2020 2020   _t = 0.48.     
-00027c70: 2020 2020 2020 2069 6620 5f68 7673 725f         if _hvsr_
-00027c80: 6c6f 675f 7374 645b 5f69 5d20 3c20 5f74  log_std[_i] < _t
-00027c90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00027ca0: 2020 5f70 6561 6b5b 5f69 5d5b 2752 6570    _peak[_i]['Rep
-00027cb0: 6f72 7427 5d5b 2753 6127 5d20 3d20 2725  ort']['Sa'] = '%
-00027cc0: 3130 2e34 6620 3c20 2530 2e32 6620 2531  10.4f < %0.2f %1
-00027cd0: 7327 2025 2028 5f68 7673 725f 6c6f 675f  s' % (_hvsr_log_
-00027ce0: 7374 645b 5f69 5d2c 205f 742c 0a20 2020  std[_i], _t,.   
+00027ae0: 2020 2020 2020 2020 2020 2020 6368 6563              chec
+00027af0: 6b5f 6d61 726b 2829 290a 2020 2020 2020  k_mark()).      
+00027b00: 2020 2020 2020 2020 2020 5f74 6869 735f            _this_
+00027b10: 7065 616b 5b27 5363 6f72 6527 5d20 2b3d  peak['Score'] +=
+00027b20: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00027b30: 2020 205f 7468 6973 5f70 6561 6b5b 2750     _this_peak['P
+00027b40: 6173 7320 4c69 7374 275d 5b27 5065 616b  ass List']['Peak
+00027b50: 2053 7461 6269 6c69 7479 2028 6672 6571   Stability (freq
+00027b60: 2e20 7374 6429 275d 203d 2054 7275 650a  . std)'] = True.
+00027b70: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00027b80: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00027b90: 2020 205f 7065 616b 5b5f 695d 5b27 5265     _peak[_i]['Re
+00027ba0: 706f 7274 275d 5b27 5366 275d 203d 2027  port']['Sf'] = '
+00027bb0: 2531 302e 3466 203c 2025 302e 3266 202a  %10.4f < %0.2f *
+00027bc0: 2025 302e 3366 2020 2531 7327 2025 2028   %0.3f  %1s' % (
+00027bd0: 5f73 7464 665b 5f69 5d2c 205f 652c 205f  _stdf[_i], _e, _
+00027be0: 7468 6973 5f70 6561 6b5b 2766 3027 5d2c  this_peak['f0'],
+00027bf0: 2027 e29c 9827 290a 2020 2020 2020 2020   '...').        
+00027c00: 2020 2020 2020 2020 5f74 6869 735f 7065          _this_pe
+00027c10: 616b 5b27 5061 7373 204c 6973 7427 5d5b  ak['Pass List'][
+00027c20: 2750 6561 6b20 5374 6162 696c 6974 7920  'Peak Stability 
+00027c30: 2866 7265 712e 2073 7464 2927 5d20 3d20  (freq. std)'] = 
+00027c40: 4661 6c73 650a 0a20 2020 2020 2020 2020  False..         
+00027c50: 2020 205f 7420 3d20 302e 3438 0a20 2020     _t = 0.48.   
+00027c60: 2020 2020 2020 2020 2069 6620 5f68 7673           if _hvs
+00027c70: 725f 6c6f 675f 7374 645b 5f69 5d20 3c20  r_log_std[_i] < 
+00027c80: 5f74 3a0a 2020 2020 2020 2020 2020 2020  _t:.            
+00027c90: 2020 2020 5f70 6561 6b5b 5f69 5d5b 2752      _peak[_i]['R
+00027ca0: 6570 6f72 7427 5d5b 2753 6127 5d20 3d20  eport']['Sa'] = 
+00027cb0: 2725 3130 2e34 6620 3c20 2530 2e32 6620  '%10.4f < %0.2f 
+00027cc0: 2531 7327 2025 2028 5f68 7673 725f 6c6f  %1s' % (_hvsr_lo
+00027cd0: 675f 7374 645b 5f69 5d2c 205f 742c 0a20  g_std[_i], _t,. 
+00027ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00027cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00027d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00027d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d30: 2063 6865 636b 5f6d 6172 6b28 2929 0a20   check_mark()). 
-00027d40: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-00027d50: 7468 6973 5f70 6561 6b5b 2753 636f 7265  this_peak['Score
-00027d60: 275d 202b 3d20 310a 2020 2020 2020 2020  '] += 1.        
-00027d70: 2020 2020 2020 2020 5f74 6869 735f 7065          _this_pe
-00027d80: 616b 5b27 5061 7373 204c 6973 7427 5d5b  ak['Pass List'][
-00027d90: 2750 6561 6b20 5374 6162 696c 6974 7920  'Peak Stability 
-00027da0: 2861 6d70 2e20 7374 6429 275d 203d 2054  (amp. std)'] = T
-00027db0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00027dc0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00027dd0: 2020 2020 2020 5f70 6561 6b5b 5f69 5d5b        _peak[_i][
-00027de0: 2752 6570 6f72 7427 5d5b 2753 6127 5d20  'Report']['Sa'] 
-00027df0: 3d20 2725 3130 2e34 6620 3c20 2530 2e32  = '%10.4f < %0.2
-00027e00: 6620 2025 3173 2720 2520 285f 6876 7372  f  %1s' % (_hvsr
-00027e10: 5f6c 6f67 5f73 7464 5b5f 695d 2c20 5f74  _log_std[_i], _t
-00027e20: 2c20 27e2 9c98 2729 0a20 2020 2020 2020  , '...').       
-00027e30: 2020 2020 2020 2020 205f 7468 6973 5f70           _this_p
-00027e40: 6561 6b5b 2750 6173 7320 4c69 7374 275d  eak['Pass List']
-00027e50: 5b27 5065 616b 2053 7461 6269 6c69 7479  ['Peak Stability
-00027e60: 2028 616d 702e 2073 7464 2927 5d20 3d20   (amp. std)'] = 
-00027e70: 4661 6c73 650a 0a20 2020 2020 2020 2065  False..        e
-00027e80: 6c69 6620 302e 3220 3c3d 205f 7468 6973  lif 0.2 <= _this
-00027e90: 5f70 6561 6b5b 2766 3027 5d20 3c20 302e  _peak['f0'] < 0.
-00027ea0: 353a 0a20 2020 2020 2020 2020 2020 205f  5:.            _
-00027eb0: 6520 3d20 302e 320a 2020 2020 2020 2020  e = 0.2.        
-00027ec0: 2020 2020 6966 205f 7374 6466 5b5f 695d      if _stdf[_i]
-00027ed0: 203c 205f 6520 2a20 5f74 6869 735f 7065   < _e * _this_pe
-00027ee0: 616b 5b27 6630 275d 3a0a 2020 2020 2020  ak['f0']:.      
-00027ef0: 2020 2020 2020 2020 2020 5f70 6561 6b5b            _peak[
-00027f00: 5f69 5d5b 2752 6570 6f72 7427 5d5b 2753  _i]['Report']['S
-00027f10: 6627 5d20 3d20 2725 3130 2e34 6620 3c20  f'] = '%10.4f < 
-00027f20: 2530 2e32 6620 2a20 2530 2e33 6620 2531  %0.2f * %0.3f %1
-00027f30: 7327 2025 2028 5f73 7464 665b 5f69 5d2c  s' % (_stdf[_i],
-00027f40: 205f 652c 205f 7468 6973 5f70 6561 6b5b   _e, _this_peak[
-00027f50: 2766 3027 5d2c 0a20 2020 2020 2020 2020  'f0'],.         
+00027d20: 2020 2063 6865 636b 5f6d 6172 6b28 2929     check_mark())
+00027d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027d40: 205f 7468 6973 5f70 6561 6b5b 2753 636f   _this_peak['Sco
+00027d50: 7265 275d 202b 3d20 310a 2020 2020 2020  re'] += 1.      
+00027d60: 2020 2020 2020 2020 2020 5f74 6869 735f            _this_
+00027d70: 7065 616b 5b27 5061 7373 204c 6973 7427  peak['Pass List'
+00027d80: 5d5b 2750 6561 6b20 5374 6162 696c 6974  ]['Peak Stabilit
+00027d90: 7920 2861 6d70 2e20 7374 6429 275d 203d  y (amp. std)'] =
+00027da0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+00027db0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00027dc0: 2020 2020 2020 2020 5f70 6561 6b5b 5f69          _peak[_i
+00027dd0: 5d5b 2752 6570 6f72 7427 5d5b 2753 6127  ]['Report']['Sa'
+00027de0: 5d20 3d20 2725 3130 2e34 6620 3c20 2530  ] = '%10.4f < %0
+00027df0: 2e32 6620 2025 3173 2720 2520 285f 6876  .2f  %1s' % (_hv
+00027e00: 7372 5f6c 6f67 5f73 7464 5b5f 695d 2c20  sr_log_std[_i], 
+00027e10: 5f74 2c20 27e2 9c98 2729 0a20 2020 2020  _t, '...').     
+00027e20: 2020 2020 2020 2020 2020 205f 7468 6973             _this
+00027e30: 5f70 6561 6b5b 2750 6173 7320 4c69 7374  _peak['Pass List
+00027e40: 275d 5b27 5065 616b 2053 7461 6269 6c69  ']['Peak Stabili
+00027e50: 7479 2028 616d 702e 2073 7464 2927 5d20  ty (amp. std)'] 
+00027e60: 3d20 4661 6c73 650a 0a20 2020 2020 2020  = False..       
+00027e70: 2065 6c69 6620 302e 3220 3c3d 205f 7468   elif 0.2 <= _th
+00027e80: 6973 5f70 6561 6b5b 2766 3027 5d20 3c20  is_peak['f0'] < 
+00027e90: 302e 353a 0a20 2020 2020 2020 2020 2020  0.5:.           
+00027ea0: 205f 6520 3d20 302e 320a 2020 2020 2020   _e = 0.2.      
+00027eb0: 2020 2020 2020 6966 205f 7374 6466 5b5f        if _stdf[_
+00027ec0: 695d 203c 205f 6520 2a20 5f74 6869 735f  i] < _e * _this_
+00027ed0: 7065 616b 5b27 6630 275d 3a0a 2020 2020  peak['f0']:.    
+00027ee0: 2020 2020 2020 2020 2020 2020 5f70 6561              _pea
+00027ef0: 6b5b 5f69 5d5b 2752 6570 6f72 7427 5d5b  k[_i]['Report'][
+00027f00: 2753 6627 5d20 3d20 2725 3130 2e34 6620  'Sf'] = '%10.4f 
+00027f10: 3c20 2530 2e32 6620 2a20 2530 2e33 6620  < %0.2f * %0.3f 
+00027f20: 2531 7327 2025 2028 5f73 7464 665b 5f69  %1s' % (_stdf[_i
+00027f30: 5d2c 205f 652c 205f 7468 6973 5f70 6561  ], _e, _this_pea
+00027f40: 6b5b 2766 3027 5d2c 0a20 2020 2020 2020  k['f0'],.       
+00027f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00027f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00027f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00027f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027fa0: 2020 2063 6865 636b 5f6d 6172 6b28 2929     check_mark())
-00027fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027fc0: 205f 7468 6973 5f70 6561 6b5b 2753 636f   _this_peak['Sco
-00027fd0: 7265 275d 202b 3d20 310a 2020 2020 2020  re'] += 1.      
-00027fe0: 2020 2020 2020 2020 2020 5f74 6869 735f            _this_
-00027ff0: 7065 616b 5b27 5061 7373 204c 6973 7427  peak['Pass List'
-00028000: 5d5b 2750 6561 6b20 5374 6162 696c 6974  ]['Peak Stabilit
-00028010: 7920 2866 7265 712e 2073 7464 2927 5d20  y (freq. std)'] 
-00028020: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00028030: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00028040: 2020 2020 2020 2020 205f 7065 616b 5b5f           _peak[_
-00028050: 695d 5b27 5265 706f 7274 275d 5b27 5366  i]['Report']['Sf
-00028060: 275d 203d 2027 2531 302e 3466 203c 2025  '] = '%10.4f < %
-00028070: 302e 3266 202a 2025 302e 3366 2020 2531  0.2f * %0.3f  %1
-00028080: 7327 2025 2028 5f73 7464 665b 5f69 5d2c  s' % (_stdf[_i],
-00028090: 205f 652c 205f 7468 6973 5f70 6561 6b5b   _e, _this_peak[
-000280a0: 2766 3027 5d2c 2027 e29c 9827 290a 2020  'f0'], '...').  
-000280b0: 2020 2020 2020 2020 2020 2020 2020 5f74                _t
-000280c0: 6869 735f 7065 616b 5b27 5061 7373 204c  his_peak['Pass L
-000280d0: 6973 7427 5d5b 2750 6561 6b20 5374 6162  ist']['Peak Stab
-000280e0: 696c 6974 7920 2866 7265 712e 2073 7464  ility (freq. std
-000280f0: 2927 5d20 3d20 4661 6c73 650a 0a20 2020  )'] = False..   
-00028100: 2020 2020 2020 2020 205f 7420 3d20 302e           _t = 0.
-00028110: 3430 0a20 2020 2020 2020 2020 2020 2069  40.            i
-00028120: 6620 5f68 7673 725f 6c6f 675f 7374 645b  f _hvsr_log_std[
-00028130: 5f69 5d20 3c20 5f74 3a0a 2020 2020 2020  _i] < _t:.      
-00028140: 2020 2020 2020 2020 2020 5f70 6561 6b5b            _peak[
-00028150: 5f69 5d5b 2752 6570 6f72 7427 5d5b 2753  _i]['Report']['S
-00028160: 6127 5d20 3d20 2725 3130 2e34 6620 3c20  a'] = '%10.4f < 
-00028170: 2530 2e32 6620 2531 7327 2025 2028 5f68  %0.2f %1s' % (_h
-00028180: 7673 725f 6c6f 675f 7374 645b 5f69 5d2c  vsr_log_std[_i],
-00028190: 205f 742c 0a20 2020 2020 2020 2020 2020   _t,.           
+00027f90: 2020 2020 2063 6865 636b 5f6d 6172 6b28       check_mark(
+00027fa0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00027fb0: 2020 205f 7468 6973 5f70 6561 6b5b 2753     _this_peak['S
+00027fc0: 636f 7265 275d 202b 3d20 310a 2020 2020  core'] += 1.    
+00027fd0: 2020 2020 2020 2020 2020 2020 5f74 6869              _thi
+00027fe0: 735f 7065 616b 5b27 5061 7373 204c 6973  s_peak['Pass Lis
+00027ff0: 7427 5d5b 2750 6561 6b20 5374 6162 696c  t']['Peak Stabil
+00028000: 6974 7920 2866 7265 712e 2073 7464 2927  ity (freq. std)'
+00028010: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
+00028020: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00028030: 2020 2020 2020 2020 2020 205f 7065 616b             _peak
+00028040: 5b5f 695d 5b27 5265 706f 7274 275d 5b27  [_i]['Report']['
+00028050: 5366 275d 203d 2027 2531 302e 3466 203c  Sf'] = '%10.4f <
+00028060: 2025 302e 3266 202a 2025 302e 3366 2020   %0.2f * %0.3f  
+00028070: 2531 7327 2025 2028 5f73 7464 665b 5f69  %1s' % (_stdf[_i
+00028080: 5d2c 205f 652c 205f 7468 6973 5f70 6561  ], _e, _this_pea
+00028090: 6b5b 2766 3027 5d2c 2027 e29c 9827 290a  k['f0'], '...').
+000280a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000280b0: 5f74 6869 735f 7065 616b 5b27 5061 7373  _this_peak['Pass
+000280c0: 204c 6973 7427 5d5b 2750 6561 6b20 5374   List']['Peak St
+000280d0: 6162 696c 6974 7920 2866 7265 712e 2073  ability (freq. s
+000280e0: 7464 2927 5d20 3d20 4661 6c73 650a 0a20  td)'] = False.. 
+000280f0: 2020 2020 2020 2020 2020 205f 7420 3d20             _t = 
+00028100: 302e 3430 0a20 2020 2020 2020 2020 2020  0.40.           
+00028110: 2069 6620 5f68 7673 725f 6c6f 675f 7374   if _hvsr_log_st
+00028120: 645b 5f69 5d20 3c20 5f74 3a0a 2020 2020  d[_i] < _t:.    
+00028130: 2020 2020 2020 2020 2020 2020 5f70 6561              _pea
+00028140: 6b5b 5f69 5d5b 2752 6570 6f72 7427 5d5b  k[_i]['Report'][
+00028150: 2753 6127 5d20 3d20 2725 3130 2e34 6620  'Sa'] = '%10.4f 
+00028160: 3c20 2530 2e32 6620 2531 7327 2025 2028  < %0.2f %1s' % (
+00028170: 5f68 7673 725f 6c6f 675f 7374 645b 5f69  _hvsr_log_std[_i
+00028180: 5d2c 205f 742c 0a20 2020 2020 2020 2020  ], _t,.         
+00028190: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000281a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000281b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000281c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000281d0: 2020 2020 2020 2020 2063 6865 636b 5f6d           check_m
-000281e0: 6172 6b28 2929 0a20 2020 2020 2020 2020  ark()).         
-000281f0: 2020 2020 2020 205f 7468 6973 5f70 6561         _this_pea
-00028200: 6b5b 2753 636f 7265 275d 202b 3d20 310a  k['Score'] += 1.
-00028210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028220: 5f74 6869 735f 7065 616b 5b27 5061 7373  _this_peak['Pass
-00028230: 204c 6973 7427 5d5b 2750 6561 6b20 5374   List']['Peak St
-00028240: 6162 696c 6974 7920 2861 6d70 2e20 7374  ability (amp. st
-00028250: 6429 275d 203d 2054 7275 650a 2020 2020  d)'] = True.    
-00028260: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00028270: 2020 2020 2020 2020 2020 2020 2020 5f70                _p
-00028280: 6561 6b5b 5f69 5d5b 2752 6570 6f72 7427  eak[_i]['Report'
-00028290: 5d5b 2753 6127 5d20 3d20 2725 3130 2e34  ]['Sa'] = '%10.4
-000282a0: 6620 3c20 2530 2e32 6620 2025 3173 2720  f < %0.2f  %1s' 
-000282b0: 2520 285f 6876 7372 5f6c 6f67 5f73 7464  % (_hvsr_log_std
-000282c0: 5b5f 695d 2c20 5f74 2c20 27e2 9c98 2729  [_i], _t, '...')
-000282d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000282e0: 205f 7468 6973 5f70 6561 6b5b 2750 6173   _this_peak['Pas
-000282f0: 7320 4c69 7374 275d 5b27 5065 616b 2053  s List']['Peak S
-00028300: 7461 6269 6c69 7479 2028 616d 702e 2073  tability (amp. s
-00028310: 7464 2927 5d20 3d20 4661 6c73 650a 0a20  td)'] = False.. 
-00028320: 2020 2020 2020 2065 6c69 6620 302e 3520         elif 0.5 
-00028330: 3c3d 205f 7468 6973 5f70 6561 6b5b 2766  <= _this_peak['f
-00028340: 3027 5d20 3c20 312e 303a 0a20 2020 2020  0'] < 1.0:.     
-00028350: 2020 2020 2020 205f 6520 3d20 302e 3135         _e = 0.15
-00028360: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00028370: 5f73 7464 665b 5f69 5d20 3c20 5f65 202a  _stdf[_i] < _e *
-00028380: 205f 7468 6973 5f70 6561 6b5b 2766 3027   _this_peak['f0'
-00028390: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-000283a0: 2020 205f 7065 616b 5b5f 695d 5b27 5265     _peak[_i]['Re
-000283b0: 706f 7274 275d 5b27 5366 275d 203d 2027  port']['Sf'] = '
-000283c0: 2531 302e 3466 203c 2025 302e 3266 202a  %10.4f < %0.2f *
-000283d0: 2025 302e 3366 2025 3173 2720 2520 285f   %0.3f %1s' % (_
-000283e0: 7374 6466 5b5f 695d 2c20 5f65 2c20 5f74  stdf[_i], _e, _t
-000283f0: 6869 735f 7065 616b 5b27 6630 275d 2c0a  his_peak['f0'],.
+000281c0: 2020 2020 2020 2020 2020 2063 6865 636b             check
+000281d0: 5f6d 6172 6b28 2929 0a20 2020 2020 2020  _mark()).       
+000281e0: 2020 2020 2020 2020 205f 7468 6973 5f70           _this_p
+000281f0: 6561 6b5b 2753 636f 7265 275d 202b 3d20  eak['Score'] += 
+00028200: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00028210: 2020 5f74 6869 735f 7065 616b 5b27 5061    _this_peak['Pa
+00028220: 7373 204c 6973 7427 5d5b 2750 6561 6b20  ss List']['Peak 
+00028230: 5374 6162 696c 6974 7920 2861 6d70 2e20  Stability (amp. 
+00028240: 7374 6429 275d 203d 2054 7275 650a 2020  std)'] = True.  
+00028250: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00028260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028270: 5f70 6561 6b5b 5f69 5d5b 2752 6570 6f72  _peak[_i]['Repor
+00028280: 7427 5d5b 2753 6127 5d20 3d20 2725 3130  t']['Sa'] = '%10
+00028290: 2e34 6620 3c20 2530 2e32 6620 2025 3173  .4f < %0.2f  %1s
+000282a0: 2720 2520 285f 6876 7372 5f6c 6f67 5f73  ' % (_hvsr_log_s
+000282b0: 7464 5b5f 695d 2c20 5f74 2c20 27e2 9c98  td[_i], _t, '...
+000282c0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+000282d0: 2020 205f 7468 6973 5f70 6561 6b5b 2750     _this_peak['P
+000282e0: 6173 7320 4c69 7374 275d 5b27 5065 616b  ass List']['Peak
+000282f0: 2053 7461 6269 6c69 7479 2028 616d 702e   Stability (amp.
+00028300: 2073 7464 2927 5d20 3d20 4661 6c73 650a   std)'] = False.
+00028310: 0a20 2020 2020 2020 2065 6c69 6620 302e  .        elif 0.
+00028320: 3520 3c3d 205f 7468 6973 5f70 6561 6b5b  5 <= _this_peak[
+00028330: 2766 3027 5d20 3c20 312e 303a 0a20 2020  'f0'] < 1.0:.   
+00028340: 2020 2020 2020 2020 205f 6520 3d20 302e           _e = 0.
+00028350: 3135 0a20 2020 2020 2020 2020 2020 2069  15.            i
+00028360: 6620 5f73 7464 665b 5f69 5d20 3c20 5f65  f _stdf[_i] < _e
+00028370: 202a 205f 7468 6973 5f70 6561 6b5b 2766   * _this_peak['f
+00028380: 3027 5d3a 0a20 2020 2020 2020 2020 2020  0']:.           
+00028390: 2020 2020 205f 7065 616b 5b5f 695d 5b27       _peak[_i]['
+000283a0: 5265 706f 7274 275d 5b27 5366 275d 203d  Report']['Sf'] =
+000283b0: 2027 2531 302e 3466 203c 2025 302e 3266   '%10.4f < %0.2f
+000283c0: 202a 2025 302e 3366 2025 3173 2720 2520   * %0.3f %1s' % 
+000283d0: 285f 7374 6466 5b5f 695d 2c20 5f65 2c20  (_stdf[_i], _e, 
+000283e0: 5f74 6869 735f 7065 616b 5b27 6630 275d  _this_peak['f0']
+000283f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00028400: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00028410: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00028420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028440: 2020 2020 2020 2020 2020 2020 6368 6563              chec
-00028450: 6b5f 6d61 726b 2829 290a 2020 2020 2020  k_mark()).      
-00028460: 2020 2020 2020 2020 2020 5f74 6869 735f            _this_
-00028470: 7065 616b 5b27 5363 6f72 6527 5d20 2b3d  peak['Score'] +=
-00028480: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-00028490: 2020 205f 7468 6973 5f70 6561 6b5b 2750     _this_peak['P
-000284a0: 6173 7320 4c69 7374 275d 5b27 5065 616b  ass List']['Peak
-000284b0: 2053 7461 6269 6c69 7479 2028 6672 6571   Stability (freq
-000284c0: 2e20 7374 6429 275d 203d 2054 7275 650a  . std)'] = True.
-000284d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000284e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000284f0: 2020 5f70 6561 6b5b 5f69 5d5b 2752 6570    _peak[_i]['Rep
-00028500: 6f72 7427 5d5b 2753 6627 5d20 3d20 2725  ort']['Sf'] = '%
-00028510: 3130 2e34 6620 3c20 2530 2e32 6620 2a20  10.4f < %0.2f * 
-00028520: 2530 2e33 6620 2025 3173 2720 2520 285f  %0.3f  %1s' % (_
-00028530: 7374 6466 5b5f 695d 2c20 5f65 2c20 5f74  stdf[_i], _e, _t
-00028540: 6869 735f 7065 616b 5b27 6630 275d 2c20  his_peak['f0'], 
-00028550: 27e2 9c98 2729 0a20 2020 2020 2020 2020  '...').         
-00028560: 2020 2020 2020 205f 7468 6973 5f70 6561         _this_pea
-00028570: 6b5b 2750 6173 7320 4c69 7374 275d 5b27  k['Pass List']['
-00028580: 5065 616b 2053 7461 6269 6c69 7479 2028  Peak Stability (
-00028590: 6672 6571 2e20 7374 6429 275d 203d 2046  freq. std)'] = F
-000285a0: 616c 7365 0a0a 2020 2020 2020 2020 2020  alse..          
-000285b0: 2020 5f74 203d 2030 2e33 0a20 2020 2020    _t = 0.3.     
-000285c0: 2020 2020 2020 2069 6620 5f68 7673 725f         if _hvsr_
-000285d0: 6c6f 675f 7374 645b 5f69 5d20 3c20 5f74  log_std[_i] < _t
-000285e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000285f0: 2020 5f70 6561 6b5b 5f69 5d5b 2752 6570    _peak[_i]['Rep
-00028600: 6f72 7427 5d5b 2753 6127 5d20 3d20 2725  ort']['Sa'] = '%
-00028610: 3130 2e34 6620 3c20 2530 2e32 6620 2531  10.4f < %0.2f %1
-00028620: 7327 2025 2028 5f68 7673 725f 6c6f 675f  s' % (_hvsr_log_
-00028630: 7374 645b 5f69 5d2c 205f 742c 2063 6865  std[_i], _t, che
-00028640: 636b 5f6d 6172 6b28 2929 0a20 2020 2020  ck_mark()).     
-00028650: 2020 2020 2020 2020 2020 205f 7468 6973             _this
-00028660: 5f70 6561 6b5b 2753 636f 7265 275d 202b  _peak['Score'] +
-00028670: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00028680: 2020 2020 5f74 6869 735f 7065 616b 5b27      _this_peak['
-00028690: 5061 7373 204c 6973 7427 5d5b 2750 6561  Pass List']['Pea
-000286a0: 6b20 5374 6162 696c 6974 7920 2861 6d70  k Stability (amp
-000286b0: 2e20 7374 6429 275d 203d 2054 7275 650a  . std)'] = True.
-000286c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000286d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000286e0: 2020 5f70 6561 6b5b 5f69 5d5b 2752 6570    _peak[_i]['Rep
-000286f0: 6f72 7427 5d5b 2753 6127 5d20 3d20 2725  ort']['Sa'] = '%
-00028700: 3130 2e34 6620 3c20 2530 2e32 6620 2025  10.4f < %0.2f  %
-00028710: 3173 2720 2520 285f 6876 7372 5f6c 6f67  1s' % (_hvsr_log
-00028720: 5f73 7464 5b5f 695d 2c20 5f74 2c20 27e2  _std[_i], _t, '.
-00028730: 9c98 2729 0a20 2020 2020 2020 2020 2020  ..').           
-00028740: 2020 2020 205f 7468 6973 5f70 6561 6b5b       _this_peak[
-00028750: 2750 6173 7320 4c69 7374 275d 5b27 5065  'Pass List']['Pe
-00028760: 616b 2053 7461 6269 6c69 7479 2028 616d  ak Stability (am
-00028770: 702e 2073 7464 2927 5d20 3d20 4661 6c73  p. std)'] = Fals
-00028780: 650a 0a20 2020 2020 2020 2065 6c69 6620  e..        elif 
-00028790: 312e 3020 3c3d 205f 7468 6973 5f70 6561  1.0 <= _this_pea
-000287a0: 6b5b 2766 3027 5d20 3c3d 2032 2e30 3a0a  k['f0'] <= 2.0:.
-000287b0: 2020 2020 2020 2020 2020 2020 5f65 203d              _e =
-000287c0: 2030 2e31 0a20 2020 2020 2020 2020 2020   0.1.           
-000287d0: 2069 6620 5f73 7464 665b 5f69 5d20 3c20   if _stdf[_i] < 
-000287e0: 5f65 202a 205f 7468 6973 5f70 6561 6b5b  _e * _this_peak[
-000287f0: 2766 3027 5d3a 0a20 2020 2020 2020 2020  'f0']:.         
-00028800: 2020 2020 2020 205f 7065 616b 5b5f 695d         _peak[_i]
-00028810: 5b27 5265 706f 7274 275d 5b27 5366 275d  ['Report']['Sf']
-00028820: 203d 2027 2531 302e 3466 203c 2025 302e   = '%10.4f < %0.
-00028830: 3266 202a 2025 302e 3366 2025 3173 2720  2f * %0.3f %1s' 
-00028840: 2520 285f 7374 6466 5b5f 695d 2c20 5f65  % (_stdf[_i], _e
-00028850: 2c20 5f74 6869 735f 7065 616b 5b27 6630  , _this_peak['f0
-00028860: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+00028430: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00028440: 6563 6b5f 6d61 726b 2829 290a 2020 2020  eck_mark()).    
+00028450: 2020 2020 2020 2020 2020 2020 5f74 6869              _thi
+00028460: 735f 7065 616b 5b27 5363 6f72 6527 5d20  s_peak['Score'] 
+00028470: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+00028480: 2020 2020 205f 7468 6973 5f70 6561 6b5b       _this_peak[
+00028490: 2750 6173 7320 4c69 7374 275d 5b27 5065  'Pass List']['Pe
+000284a0: 616b 2053 7461 6269 6c69 7479 2028 6672  ak Stability (fr
+000284b0: 6571 2e20 7374 6429 275d 203d 2054 7275  eq. std)'] = Tru
+000284c0: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+000284d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000284e0: 2020 2020 5f70 6561 6b5b 5f69 5d5b 2752      _peak[_i]['R
+000284f0: 6570 6f72 7427 5d5b 2753 6627 5d20 3d20  eport']['Sf'] = 
+00028500: 2725 3130 2e34 6620 3c20 2530 2e32 6620  '%10.4f < %0.2f 
+00028510: 2a20 2530 2e33 6620 2025 3173 2720 2520  * %0.3f  %1s' % 
+00028520: 285f 7374 6466 5b5f 695d 2c20 5f65 2c20  (_stdf[_i], _e, 
+00028530: 5f74 6869 735f 7065 616b 5b27 6630 275d  _this_peak['f0']
+00028540: 2c20 27e2 9c98 2729 0a20 2020 2020 2020  , '...').       
+00028550: 2020 2020 2020 2020 205f 7468 6973 5f70           _this_p
+00028560: 6561 6b5b 2750 6173 7320 4c69 7374 275d  eak['Pass List']
+00028570: 5b27 5065 616b 2053 7461 6269 6c69 7479  ['Peak Stability
+00028580: 2028 6672 6571 2e20 7374 6429 275d 203d   (freq. std)'] =
+00028590: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
+000285a0: 2020 2020 5f74 203d 2030 2e33 0a20 2020      _t = 0.3.   
+000285b0: 2020 2020 2020 2020 2069 6620 5f68 7673           if _hvs
+000285c0: 725f 6c6f 675f 7374 645b 5f69 5d20 3c20  r_log_std[_i] < 
+000285d0: 5f74 3a0a 2020 2020 2020 2020 2020 2020  _t:.            
+000285e0: 2020 2020 5f70 6561 6b5b 5f69 5d5b 2752      _peak[_i]['R
+000285f0: 6570 6f72 7427 5d5b 2753 6127 5d20 3d20  eport']['Sa'] = 
+00028600: 2725 3130 2e34 6620 3c20 2530 2e32 6620  '%10.4f < %0.2f 
+00028610: 2531 7327 2025 2028 5f68 7673 725f 6c6f  %1s' % (_hvsr_lo
+00028620: 675f 7374 645b 5f69 5d2c 205f 742c 2063  g_std[_i], _t, c
+00028630: 6865 636b 5f6d 6172 6b28 2929 0a20 2020  heck_mark()).   
+00028640: 2020 2020 2020 2020 2020 2020 205f 7468               _th
+00028650: 6973 5f70 6561 6b5b 2753 636f 7265 275d  is_peak['Score']
+00028660: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+00028670: 2020 2020 2020 5f74 6869 735f 7065 616b        _this_peak
+00028680: 5b27 5061 7373 204c 6973 7427 5d5b 2750  ['Pass List']['P
+00028690: 6561 6b20 5374 6162 696c 6974 7920 2861  eak Stability (a
+000286a0: 6d70 2e20 7374 6429 275d 203d 2054 7275  mp. std)'] = Tru
+000286b0: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+000286c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000286d0: 2020 2020 5f70 6561 6b5b 5f69 5d5b 2752      _peak[_i]['R
+000286e0: 6570 6f72 7427 5d5b 2753 6127 5d20 3d20  eport']['Sa'] = 
+000286f0: 2725 3130 2e34 6620 3c20 2530 2e32 6620  '%10.4f < %0.2f 
+00028700: 2025 3173 2720 2520 285f 6876 7372 5f6c   %1s' % (_hvsr_l
+00028710: 6f67 5f73 7464 5b5f 695d 2c20 5f74 2c20  og_std[_i], _t, 
+00028720: 27e2 9c98 2729 0a20 2020 2020 2020 2020  '...').         
+00028730: 2020 2020 2020 205f 7468 6973 5f70 6561         _this_pea
+00028740: 6b5b 2750 6173 7320 4c69 7374 275d 5b27  k['Pass List']['
+00028750: 5065 616b 2053 7461 6269 6c69 7479 2028  Peak Stability (
+00028760: 616d 702e 2073 7464 2927 5d20 3d20 4661  amp. std)'] = Fa
+00028770: 6c73 650a 0a20 2020 2020 2020 2065 6c69  lse..        eli
+00028780: 6620 312e 3020 3c3d 205f 7468 6973 5f70  f 1.0 <= _this_p
+00028790: 6561 6b5b 2766 3027 5d20 3c3d 2032 2e30  eak['f0'] <= 2.0
+000287a0: 3a0a 2020 2020 2020 2020 2020 2020 5f65  :.            _e
+000287b0: 203d 2030 2e31 0a20 2020 2020 2020 2020   = 0.1.         
+000287c0: 2020 2069 6620 5f73 7464 665b 5f69 5d20     if _stdf[_i] 
+000287d0: 3c20 5f65 202a 205f 7468 6973 5f70 6561  < _e * _this_pea
+000287e0: 6b5b 2766 3027 5d3a 0a20 2020 2020 2020  k['f0']:.       
+000287f0: 2020 2020 2020 2020 205f 7065 616b 5b5f           _peak[_
+00028800: 695d 5b27 5265 706f 7274 275d 5b27 5366  i]['Report']['Sf
+00028810: 275d 203d 2027 2531 302e 3466 203c 2025  '] = '%10.4f < %
+00028820: 302e 3266 202a 2025 302e 3366 2025 3173  0.2f * %0.3f %1s
+00028830: 2720 2520 285f 7374 6466 5b5f 695d 2c20  ' % (_stdf[_i], 
+00028840: 5f65 2c20 5f74 6869 735f 7065 616b 5b27  _e, _this_peak['
+00028850: 6630 275d 2c0a 2020 2020 2020 2020 2020  f0'],.          
+00028860: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00028870: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00028880: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00028890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000288a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000288b0: 6368 6563 6b5f 6d61 726b 2829 290a 2020  check_mark()).  
-000288c0: 2020 2020 2020 2020 2020 2020 2020 5f74                _t
-000288d0: 6869 735f 7065 616b 5b27 5363 6f72 6527  his_peak['Score'
-000288e0: 5d20 2b3d 2031 0a20 2020 2020 2020 2020  ] += 1.         
-000288f0: 2020 2020 2020 205f 7468 6973 5f70 6561         _this_pea
-00028900: 6b5b 2750 6173 7320 4c69 7374 275d 5b27  k['Pass List']['
-00028910: 5065 616b 2053 7461 6269 6c69 7479 2028  Peak Stability (
-00028920: 6672 6571 2e20 7374 6429 275d 203d 2054  freq. std)'] = T
-00028930: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00028940: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00028950: 2020 2020 2020 5f70 6561 6b5b 5f69 5d5b        _peak[_i][
-00028960: 2752 6570 6f72 7427 5d5b 2753 6627 5d20  'Report']['Sf'] 
-00028970: 3d20 2725 3130 2e34 6620 3c20 2530 2e32  = '%10.4f < %0.2
-00028980: 6620 2a20 2530 2e33 6620 2531 7320 2720  f * %0.3f %1s ' 
-00028990: 2520 285f 7374 6466 5b5f 695d 2c20 5f65  % (_stdf[_i], _e
-000289a0: 2c20 5f74 6869 735f 7065 616b 5b27 6630  , _this_peak['f0
-000289b0: 275d 2c20 27e2 9c98 2729 0a20 2020 2020  '], '...').     
-000289c0: 2020 2020 2020 2020 2020 205f 7468 6973             _this
-000289d0: 5f70 6561 6b5b 2750 6173 7320 4c69 7374  _peak['Pass List
-000289e0: 275d 5b27 5065 616b 2053 7461 6269 6c69  ']['Peak Stabili
-000289f0: 7479 2028 6672 6571 2e20 7374 6429 275d  ty (freq. std)']
-00028a00: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
-00028a10: 2020 2020 2020 5f74 203d 2030 2e32 350a        _t = 0.25.
-00028a20: 2020 2020 2020 2020 2020 2020 6966 205f              if _
-00028a30: 6876 7372 5f6c 6f67 5f73 7464 5b5f 695d  hvsr_log_std[_i]
-00028a40: 203c 205f 743a 0a20 2020 2020 2020 2020   < _t:.         
-00028a50: 2020 2020 2020 205f 7065 616b 5b5f 695d         _peak[_i]
-00028a60: 5b27 5265 706f 7274 275d 5b27 5361 275d  ['Report']['Sa']
-00028a70: 203d 2027 2531 302e 3466 203c 2025 302e   = '%10.4f < %0.
-00028a80: 3266 2025 3173 2720 2520 285f 6876 7372  2f %1s' % (_hvsr
-00028a90: 5f6c 6f67 5f73 7464 5b5f 695d 2c20 5f74  _log_std[_i], _t
-00028aa0: 2c20 6368 6563 6b5f 6d61 726b 2829 290a  , check_mark()).
-00028ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ac0: 5f74 6869 735f 7065 616b 5b27 5363 6f72  _this_peak['Scor
-00028ad0: 6527 5d20 2b3d 2031 0a20 2020 2020 2020  e'] += 1.       
-00028ae0: 2020 2020 2020 2020 205f 7468 6973 5f70           _this_p
-00028af0: 6561 6b5b 2750 6173 7320 4c69 7374 275d  eak['Pass List']
-00028b00: 5b27 5065 616b 2053 7461 6269 6c69 7479  ['Peak Stability
-00028b10: 2028 616d 702e 2073 7464 2927 5d20 3d20   (amp. std)'] = 
-00028b20: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00028b30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00028b40: 2020 2020 2020 205f 7065 616b 5b5f 695d         _peak[_i]
-00028b50: 5b27 5265 706f 7274 275d 5b27 5361 275d  ['Report']['Sa']
-00028b60: 203d 2027 2531 302e 3466 203c 2025 302e   = '%10.4f < %0.
-00028b70: 3266 2020 2531 7327 2025 2028 5f68 7673  2f  %1s' % (_hvs
-00028b80: 725f 6c6f 675f 7374 645b 5f69 5d2c 205f  r_log_std[_i], _
-00028b90: 742c 2027 e29c 9827 290a 2020 2020 2020  t, '...').      
-00028ba0: 2020 2020 2020 2020 2020 5f74 6869 735f            _this_
-00028bb0: 7065 616b 5b27 5061 7373 204c 6973 7427  peak['Pass List'
-00028bc0: 5d5b 2750 6561 6b20 5374 6162 696c 6974  ]['Peak Stabilit
-00028bd0: 7920 2861 6d70 2e20 7374 6429 275d 203d  y (amp. std)'] =
-00028be0: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
-00028bf0: 656c 6966 205f 7468 6973 5f70 6561 6b5b  elif _this_peak[
-00028c00: 2766 3027 5d20 3e20 302e 323a 0a20 2020  'f0'] > 0.2:.   
-00028c10: 2020 2020 2020 2020 205f 6520 3d20 302e           _e = 0.
-00028c20: 3035 0a20 2020 2020 2020 2020 2020 2069  05.            i
-00028c30: 6620 5f73 7464 665b 5f69 5d20 3c20 5f65  f _stdf[_i] < _e
-00028c40: 202a 205f 7468 6973 5f70 6561 6b5b 2766   * _this_peak['f
-00028c50: 3027 5d3a 0a20 2020 2020 2020 2020 2020  0']:.           
-00028c60: 2020 2020 205f 7065 616b 5b5f 695d 5b27       _peak[_i]['
-00028c70: 5265 706f 7274 275d 5b27 5366 275d 203d  Report']['Sf'] =
-00028c80: 2027 2531 302e 3466 203c 2025 302e 3266   '%10.4f < %0.2f
-00028c90: 202a 2025 302e 3366 2025 3173 2720 2520   * %0.3f %1s' % 
-00028ca0: 285f 7374 6466 5b5f 695d 2c20 5f65 2c20  (_stdf[_i], _e, 
-00028cb0: 5f74 6869 735f 7065 616b 5b27 6630 275d  _this_peak['f0']
-00028cc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000288a0: 2020 6368 6563 6b5f 6d61 726b 2829 290a    check_mark()).
+000288b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000288c0: 5f74 6869 735f 7065 616b 5b27 5363 6f72  _this_peak['Scor
+000288d0: 6527 5d20 2b3d 2031 0a20 2020 2020 2020  e'] += 1.       
+000288e0: 2020 2020 2020 2020 205f 7468 6973 5f70           _this_p
+000288f0: 6561 6b5b 2750 6173 7320 4c69 7374 275d  eak['Pass List']
+00028900: 5b27 5065 616b 2053 7461 6269 6c69 7479  ['Peak Stability
+00028910: 2028 6672 6571 2e20 7374 6429 275d 203d   (freq. std)'] =
+00028920: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+00028930: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00028940: 2020 2020 2020 2020 5f70 6561 6b5b 5f69          _peak[_i
+00028950: 5d5b 2752 6570 6f72 7427 5d5b 2753 6627  ]['Report']['Sf'
+00028960: 5d20 3d20 2725 3130 2e34 6620 3c20 2530  ] = '%10.4f < %0
+00028970: 2e32 6620 2a20 2530 2e33 6620 2531 7320  .2f * %0.3f %1s 
+00028980: 2720 2520 285f 7374 6466 5b5f 695d 2c20  ' % (_stdf[_i], 
+00028990: 5f65 2c20 5f74 6869 735f 7065 616b 5b27  _e, _this_peak['
+000289a0: 6630 275d 2c20 27e2 9c98 2729 0a20 2020  f0'], '...').   
+000289b0: 2020 2020 2020 2020 2020 2020 205f 7468               _th
+000289c0: 6973 5f70 6561 6b5b 2750 6173 7320 4c69  is_peak['Pass Li
+000289d0: 7374 275d 5b27 5065 616b 2053 7461 6269  st']['Peak Stabi
+000289e0: 6c69 7479 2028 6672 6571 2e20 7374 6429  lity (freq. std)
+000289f0: 275d 203d 2046 616c 7365 0a0a 2020 2020  '] = False..    
+00028a00: 2020 2020 2020 2020 5f74 203d 2030 2e32          _t = 0.2
+00028a10: 350a 2020 2020 2020 2020 2020 2020 6966  5.            if
+00028a20: 205f 6876 7372 5f6c 6f67 5f73 7464 5b5f   _hvsr_log_std[_
+00028a30: 695d 203c 205f 743a 0a20 2020 2020 2020  i] < _t:.       
+00028a40: 2020 2020 2020 2020 205f 7065 616b 5b5f           _peak[_
+00028a50: 695d 5b27 5265 706f 7274 275d 5b27 5361  i]['Report']['Sa
+00028a60: 275d 203d 2027 2531 302e 3466 203c 2025  '] = '%10.4f < %
+00028a70: 302e 3266 2025 3173 2720 2520 285f 6876  0.2f %1s' % (_hv
+00028a80: 7372 5f6c 6f67 5f73 7464 5b5f 695d 2c20  sr_log_std[_i], 
+00028a90: 5f74 2c20 6368 6563 6b5f 6d61 726b 2829  _t, check_mark()
+00028aa0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00028ab0: 2020 5f74 6869 735f 7065 616b 5b27 5363    _this_peak['Sc
+00028ac0: 6f72 6527 5d20 2b3d 2031 0a20 2020 2020  ore'] += 1.     
+00028ad0: 2020 2020 2020 2020 2020 205f 7468 6973             _this
+00028ae0: 5f70 6561 6b5b 2750 6173 7320 4c69 7374  _peak['Pass List
+00028af0: 275d 5b27 5065 616b 2053 7461 6269 6c69  ']['Peak Stabili
+00028b00: 7479 2028 616d 702e 2073 7464 2927 5d20  ty (amp. std)'] 
+00028b10: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00028b20: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00028b30: 2020 2020 2020 2020 205f 7065 616b 5b5f           _peak[_
+00028b40: 695d 5b27 5265 706f 7274 275d 5b27 5361  i]['Report']['Sa
+00028b50: 275d 203d 2027 2531 302e 3466 203c 2025  '] = '%10.4f < %
+00028b60: 302e 3266 2020 2531 7327 2025 2028 5f68  0.2f  %1s' % (_h
+00028b70: 7673 725f 6c6f 675f 7374 645b 5f69 5d2c  vsr_log_std[_i],
+00028b80: 205f 742c 2027 e29c 9827 290a 2020 2020   _t, '...').    
+00028b90: 2020 2020 2020 2020 2020 2020 5f74 6869              _thi
+00028ba0: 735f 7065 616b 5b27 5061 7373 204c 6973  s_peak['Pass Lis
+00028bb0: 7427 5d5b 2750 6561 6b20 5374 6162 696c  t']['Peak Stabil
+00028bc0: 6974 7920 2861 6d70 2e20 7374 6429 275d  ity (amp. std)']
+00028bd0: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
+00028be0: 2020 656c 6966 205f 7468 6973 5f70 6561    elif _this_pea
+00028bf0: 6b5b 2766 3027 5d20 3e20 302e 323a 0a20  k['f0'] > 0.2:. 
+00028c00: 2020 2020 2020 2020 2020 205f 6520 3d20             _e = 
+00028c10: 302e 3035 0a20 2020 2020 2020 2020 2020  0.05.           
+00028c20: 2069 6620 5f73 7464 665b 5f69 5d20 3c20   if _stdf[_i] < 
+00028c30: 5f65 202a 205f 7468 6973 5f70 6561 6b5b  _e * _this_peak[
+00028c40: 2766 3027 5d3a 0a20 2020 2020 2020 2020  'f0']:.         
+00028c50: 2020 2020 2020 205f 7065 616b 5b5f 695d         _peak[_i]
+00028c60: 5b27 5265 706f 7274 275d 5b27 5366 275d  ['Report']['Sf']
+00028c70: 203d 2027 2531 302e 3466 203c 2025 302e   = '%10.4f < %0.
+00028c80: 3266 202a 2025 302e 3366 2025 3173 2720  2f * %0.3f %1s' 
+00028c90: 2520 285f 7374 6466 5b5f 695d 2c20 5f65  % (_stdf[_i], _e
+00028ca0: 2c20 5f74 6869 735f 7065 616b 5b27 6630  , _this_peak['f0
+00028cb0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+00028cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00028cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00028ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00028cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028d00: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00028d10: 6563 6b5f 6d61 726b 2829 290a 2020 2020  eck_mark()).    
-00028d20: 2020 2020 2020 2020 2020 2020 5f74 6869              _thi
-00028d30: 735f 7065 616b 5b27 5363 6f72 6527 5d20  s_peak['Score'] 
-00028d40: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-00028d50: 2020 2020 205f 7468 6973 5f70 6561 6b5b       _this_peak[
-00028d60: 2750 6173 7320 4c69 7374 275d 5b27 5065  'Pass List']['Pe
-00028d70: 616b 2053 7461 6269 6c69 7479 2028 6672  ak Stability (fr
-00028d80: 6571 2e20 7374 6429 275d 203d 2054 7275  eq. std)'] = Tru
-00028d90: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
-00028da0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00028db0: 2020 2020 5f70 6561 6b5b 5f69 5d5b 2752      _peak[_i]['R
-00028dc0: 6570 6f72 7427 5d5b 2753 6627 5d20 3d20  eport']['Sf'] = 
-00028dd0: 2725 3130 2e34 6620 3c20 2530 2e32 6620  '%10.4f < %0.2f 
-00028de0: 2a20 2530 2e33 6620 2025 3173 2720 2520  * %0.3f  %1s' % 
-00028df0: 285f 7374 6466 5b5f 695d 2c20 5f65 2c20  (_stdf[_i], _e, 
-00028e00: 5f74 6869 735f 7065 616b 5b27 6630 275d  _this_peak['f0']
-00028e10: 2c20 27e2 9c98 2729 0a20 2020 2020 2020  , '...').       
-00028e20: 2020 2020 2020 2020 205f 7468 6973 5f70           _this_p
-00028e30: 6561 6b5b 2750 6173 7320 4c69 7374 275d  eak['Pass List']
-00028e40: 5b27 5065 616b 2053 7461 6269 6c69 7479  ['Peak Stability
-00028e50: 2028 6672 6571 2e20 7374 6429 275d 203d   (freq. std)'] =
-00028e60: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
-00028e70: 2020 2020 5f74 203d 2030 2e32 0a20 2020      _t = 0.2.   
-00028e80: 2020 2020 2020 2020 2069 6620 5f68 7673           if _hvs
-00028e90: 725f 6c6f 675f 7374 645b 5f69 5d20 3c20  r_log_std[_i] < 
-00028ea0: 5f74 3a0a 2020 2020 2020 2020 2020 2020  _t:.            
-00028eb0: 2020 2020 5f70 6561 6b5b 5f69 5d5b 2752      _peak[_i]['R
-00028ec0: 6570 6f72 7427 5d5b 2753 6127 5d20 3d20  eport']['Sa'] = 
-00028ed0: 2725 3130 2e34 6620 3c20 2530 2e32 6620  '%10.4f < %0.2f 
-00028ee0: 2531 7327 2025 2028 5f68 7673 725f 6c6f  %1s' % (_hvsr_lo
-00028ef0: 675f 7374 645b 5f69 5d2c 205f 742c 2063  g_std[_i], _t, c
-00028f00: 6865 636b 5f6d 6172 6b28 2929 0a20 2020  heck_mark()).   
-00028f10: 2020 2020 2020 2020 2020 2020 205f 7468               _th
-00028f20: 6973 5f70 6561 6b5b 2753 636f 7265 275d  is_peak['Score']
-00028f30: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00028f40: 2020 2020 2020 5f74 6869 735f 7065 616b        _this_peak
-00028f50: 5b27 5061 7373 204c 6973 7427 5d5b 2750  ['Pass List']['P
-00028f60: 6561 6b20 5374 6162 696c 6974 7920 2861  eak Stability (a
-00028f70: 6d70 2e20 7374 6429 275d 203d 2054 7275  mp. std)'] = Tru
-00028f80: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
-00028f90: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00028fa0: 2020 2020 5f70 6561 6b5b 5f69 5d5b 2752      _peak[_i]['R
-00028fb0: 6570 6f72 7427 5d5b 2753 6127 5d20 3d20  eport']['Sa'] = 
-00028fc0: 2725 3130 2e34 6620 3c20 2530 2e32 6620  '%10.4f < %0.2f 
-00028fd0: 2025 3173 2720 2520 285f 6876 7372 5f6c   %1s' % (_hvsr_l
-00028fe0: 6f67 5f73 7464 5b5f 695d 2c20 5f74 2c20  og_std[_i], _t, 
-00028ff0: 27e2 9c98 2729 0a20 2020 2020 2020 2020  '...').         
-00029000: 2020 2020 2020 205f 7468 6973 5f70 6561         _this_pea
-00029010: 6b5b 2750 6173 7320 4c69 7374 275d 5b27  k['Pass List']['
-00029020: 5065 616b 2053 7461 6269 6c69 7479 2028  Peak Stability (
-00029030: 6672 6571 2e20 7374 6429 275d 203d 2046  freq. std)'] = F
-00029040: 616c 7365 0a0a 2020 2020 7265 7475 726e  alse..    return
-00029050: 205f 7065 616b 0a0a 2347 6574 2066 7265   _peak..#Get fre
-00029060: 7175 656e 6379 2073 7461 6e64 6172 6420  quency standard 
-00029070: 6465 7669 6174 696f 6e0a 6465 6620 5f5f  deviation.def __
-00029080: 6765 745f 7374 6466 2878 5f76 616c 7565  get_stdf(x_value
-00029090: 732c 2069 6e64 6578 4c69 7374 2c20 6876  s, indexList, hv
-000290a0: 7372 5065 616b 7329 3a0a 2020 2020 2222  srPeaks):.    ""
-000290b0: 2250 7269 7661 7465 2066 756e 6374 696f  "Private functio
-000290c0: 6e20 746f 2067 6574 2066 7265 7175 656e  n to get frequen
-000290d0: 6379 2073 7461 6e64 6172 6420 6465 7669  cy standard devi
-000290e0: 6174 696f 6e2c 2066 726f 6d20 6d75 6c74  ation, from mult
-000290f0: 6970 6c65 2074 696d 652d 7374 6570 2048  iple time-step H
-00029100: 5653 5220 6375 7276 6573 2222 220a 2020  VSR curves""".  
-00029110: 2020 7374 6466 203d 206c 6973 7428 290a    stdf = list().
-00029120: 2020 2020 666f 7220 696e 6465 7820 696e      for index in
-00029130: 2069 6e64 6578 4c69 7374 3a0a 2020 2020   indexList:.    
-00029140: 2020 2020 706f 696e 7420 3d20 6c69 7374      point = list
-00029150: 2829 0a20 2020 2020 2020 2066 6f72 206a  ().        for j
-00029160: 2069 6e20 7261 6e67 6528 6c65 6e28 6876   in range(len(hv
-00029170: 7372 5065 616b 7329 293a 0a20 2020 2020  srPeaks)):.     
-00029180: 2020 2020 2020 2070 203d 204e 6f6e 650a         p = None.
-00029190: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000291a0: 6b20 696e 2072 616e 6765 286c 656e 2868  k in range(len(h
-000291b0: 7673 7250 6561 6b73 5b6a 5d29 293a 0a20  vsrPeaks[j])):. 
-000291c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000291d0: 6620 7020 6973 204e 6f6e 653a 0a20 2020  f p is None:.   
-000291e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000291f0: 2070 203d 2068 7673 7250 6561 6b73 5b6a   p = hvsrPeaks[j
-00029200: 5d5b 6b5d 0a20 2020 2020 2020 2020 2020  ][k].           
-00029210: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00029220: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00029230: 4669 6e64 2063 6c6f 7365 7374 2070 6561  Find closest pea
-00029240: 6b20 696e 2063 7572 7265 6e74 2074 696d  k in current tim
-00029250: 6520 746f 2028 6375 7272 656e 7429 206d  e to (current) m
-00029260: 6169 6e20 6876 7372 2070 6561 6b0a 2020  ain hvsr peak.  
-00029270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029280: 2020 6966 2061 6273 2869 6e64 6578 202d    if abs(index -
-00029290: 2068 7673 7250 6561 6b73 5b6a 5d5b 6b5d   hvsrPeaks[j][k]
-000292a0: 2920 3c20 6162 7328 696e 6465 7820 2d20  ) < abs(index - 
-000292b0: 7029 3a0a 2020 2020 2020 2020 2020 2020  p):.            
-000292c0: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
-000292d0: 6876 7372 5065 616b 735b 6a5d 5b6b 5d0a  hvsrPeaks[j][k].
-000292e0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-000292f0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00029300: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00029310: 696e 742e 6170 7065 6e64 2870 290a 2020  int.append(p).  
-00029320: 2020 2020 2020 706f 696e 742e 6170 7065        point.appe
-00029330: 6e64 2869 6e64 6578 290a 2020 2020 2020  nd(index).      
-00029340: 2020 7620 3d20 6c69 7374 2829 0a20 2020    v = list().   
-00029350: 2020 2020 2066 6f72 206c 2069 6e20 7261       for l in ra
-00029360: 6e67 6528 6c65 6e28 706f 696e 7429 293a  nge(len(point)):
-00029370: 0a20 2020 2020 2020 2020 2020 2076 2e61  .            v.a
-00029380: 7070 656e 6428 785f 7661 6c75 6573 5b70  ppend(x_values[p
-00029390: 6f69 6e74 5b6c 5d5d 290a 2020 2020 2020  oint[l]]).      
-000293a0: 2020 7374 6466 2e61 7070 656e 6428 6e70    stdf.append(np
-000293b0: 2e73 7464 2876 2929 0a20 2020 2072 6574  .std(v)).    ret
-000293c0: 7572 6e20 7374 6466 0a0a 2347 6574 206f  urn stdf..#Get o
-000293d0: 7220 7072 696e 7420 7265 706f 7274 0a64  r print report.d
-000293e0: 6566 2070 7269 6e74 5f72 6570 6f72 7428  ef print_report(
-000293f0: 6876 7372 5f64 6174 612c 2065 7870 6f72  hvsr_data, expor
-00029400: 743d 2727 2c20 666f 726d 6174 3d27 7072  t='', format='pr
-00029410: 696e 7427 2c20 696e 636c 7564 653d 2770  int', include='p
-00029420: 6561 6b27 2c20 7361 7665 5f66 6967 733d  eak', save_figs=
-00029430: 4e6f 6e65 293a 0a20 2020 2022 2222 5072  None):.    """Pr
-00029440: 696e 7420 6120 7265 706f 7274 206f 6620  int a report of 
-00029450: 7468 6520 4856 5352 2061 6e61 6c79 7369  the HVSR analysi
-00029460: 7320 286e 6f74 2063 7572 7265 6e74 6c79  s (not currently
-00029470: 2069 6d70 6c65 6d65 6e74 6564 290a 2020   implemented).  
-00029480: 2020 0a20 2020 204e 4f54 2059 4554 2049    .    NOT YET I
-00029490: 4d50 4c45 4d45 4e54 4544 210a 2020 2020  MPLEMENTED!.    
-000294a0: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-000294b0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-000294c0: 2020 2068 7673 725f 6461 7461 203a 2064     hvsr_data : d
-000294d0: 6963 740a 2020 2020 2020 2020 4469 6374  ict.        Dict
-000294e0: 696f 6e61 7279 2063 6f6e 7461 696e 696e  ionary containin
-000294f0: 6720 616c 6c20 7468 6520 696e 666f 726d  g all the inform
-00029500: 6174 696f 6e20 6162 6f75 7420 7468 6520  ation about the 
-00029510: 7072 6f63 6573 7365 6420 6876 7372 2064  processed hvsr d
-00029520: 6174 610a 2020 2020 666f 726d 6174 203a  ata.    format :
-00029530: 207b 2763 7376 272c 2027 7072 696e 7427   {'csv', 'print'
-00029540: 2c20 2764 6f63 7827 7d0a 2020 2020 2020  , 'docx'}.      
-00029550: 2020 466f 726d 6174 2069 6e20 7768 6963    Format in whic
-00029560: 6820 746f 2070 7269 6e74 206f 7220 6578  h to print or ex
-00029570: 706f 7274 2074 6865 2072 6570 6f72 742e  port the report.
-00029580: 0a20 2020 2065 7870 6f72 7420 3a20 7374  .    export : st
-00029590: 720a 2020 2020 2020 2020 4669 6c65 7061  r.        Filepa
-000295a0: 7468 2070 6174 6820 666f 7220 6578 706f  th path for expo
-000295b0: 7274 2e20 4966 206e 6f74 2073 7065 6369  rt. If not speci
-000295c0: 6669 6564 2c20 7265 706f 7274 206e 616d  fied, report nam
-000295d0: 6520 6973 2067 656e 6572 6174 6564 2061  e is generated a
-000295e0: 7574 6f6d 6174 6963 616c 6c79 2061 6e64  utomatically and
-000295f0: 2070 6c61 6365 6420 696e 2063 7572 7265   placed in curre
-00029600: 6e74 2064 6972 6563 746f 7279 0a20 2020  nt directory.   
-00029610: 2069 6e63 6c75 6465 203a 2073 7472 206f   include : str o
-00029620: 7220 6c69 7374 2c20 6465 6661 756c 743d  r list, default=
-00029630: 2770 6561 6b27 0a20 2020 2020 2020 2057  'peak'.        W
-00029640: 6861 7420 746f 2069 6e63 6c75 6465 2069  hat to include i
-00029650: 6e20 7468 6520 7265 706f 7274 2e20 4279  n the report. By
-00029660: 2064 6566 6175 6c74 2069 6e63 6c75 6465   default include
-00029670: 7320 616c 6c20 7468 6520 666f 6c6c 6f77  s all the follow
-00029680: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-00029690: 2d20 5369 7465 206e 616d 650a 2020 2020  - Site name.    
-000296a0: 2020 2020 2020 2020 2d20 4163 7175 6973          - Acquis
-000296b0: 6974 696f 6e20 4461 7465 0a20 2020 2020  ition Date.     
-000296c0: 2020 2020 2020 202d 204c 6f6e 6769 7475         - Longitu
-000296d0: 6465 0a20 2020 2020 2020 2020 2020 202d  de.            -
-000296e0: 204c 6174 6974 7564 650a 2020 2020 2020   Latitude.      
-000296f0: 2020 2020 2020 2d20 456c 6576 6174 696f        - Elevatio
-00029700: 6e0a 2020 2020 2020 2020 2020 2020 2d20  n.            - 
-00029710: 5072 696d 6172 7920 7065 616b 2066 7265  Primary peak fre
-00029720: 7175 656e 6379 0a20 2020 2020 2020 2020  quency.         
-00029730: 2020 202d 2057 6865 7468 6572 2070 6173     - Whether pas
-00029740: 7365 6420 7175 616c 6974 7920 7465 7374  sed quality test
-00029750: 7320 2878 3629 0a20 2020 2020 2020 2046  s (x6).        F
-00029760: 6f72 2064 6f63 7820 286e 6f74 2079 6574  or docx (not yet
-00029770: 2069 6d70 6c65 6d65 6e74 6564 292c 2074   implemented), t
-00029780: 6865 2066 6f6c 6c6f 7769 6e67 2061 7265  he following are
-00029790: 2061 6c73 6f20 696e 636c 7564 6564 3a0a   also included:.
-000297a0: 2020 2020 2020 2020 2020 2020 2d20 4669              - Fi
-000297b0: 6775 7265 2077 6974 6820 7370 6563 7472  gure with spectr
-000297c0: 6f67 7261 6d0a 2020 2020 2020 2020 2020  ogram.          
-000297d0: 2020 2d20 4669 6775 7265 2077 6974 6820    - Figure with 
-000297e0: 4856 5352 2063 7572 7665 0a20 2020 2020  HVSR curve.     
-000297f0: 2020 2020 2020 202d 2046 6967 7572 6520         - Figure 
-00029800: 7769 7468 2033 2063 6f6d 706f 6e65 6e74  with 3 component
-00029810: 730a 2020 2020 2222 220a 2020 2020 2370  s.    """.    #p
-00029820: 7269 6e74 2073 7461 7465 6d65 6e74 0a20  rint statement. 
-00029830: 2020 2069 6620 666f 726d 6174 3d3d 2770     if format=='p
-00029840: 7269 6e74 273a 0a20 2020 2020 2020 2070  rint':.        p
-00029850: 7269 6e74 2868 7673 725f 6461 7461 5b27  rint(hvsr_data['
-00029860: 696e 7075 745f 7061 7261 6d73 275d 5b27  input_params']['
-00029870: 7369 7465 275d 290a 2020 2020 2020 2020  site']).        
-00029880: 7072 696e 7428 6876 7372 5f64 6174 615b  print(hvsr_data[
-00029890: 2769 6e70 7574 5f70 6172 616d 7327 5d5b  'input_params'][
-000298a0: 2761 6371 5f64 6174 6527 5d29 0a20 2020  'acq_date']).   
-000298b0: 2020 2020 2070 7269 6e74 2868 7673 725f       print(hvsr_
-000298c0: 6461 7461 5b27 696e 7075 745f 7061 7261  data['input_para
-000298d0: 6d73 275d 5b27 6c6f 6e67 6974 7564 6527  ms']['longitude'
-000298e0: 5d2c 2068 7673 725f 6461 7461 5b27 696e  ], hvsr_data['in
-000298f0: 7075 745f 7061 7261 6d73 275d 5b27 6c61  put_params']['la
-00029900: 7469 7475 6465 275d 290a 2020 2020 2020  titude']).      
-00029910: 2020 7072 696e 7428 6876 7372 5f64 6174    print(hvsr_dat
-00029920: 615b 2769 6e70 7574 5f70 6172 616d 7327  a['input_params'
-00029930: 5d5b 2765 6c65 7661 7469 6f6e 275d 290a  ]['elevation']).
-00029940: 2020 2020 2020 2020 7072 696e 7428 726f          print(ro
-00029950: 756e 6428 6876 7372 5f64 6174 615b 2742  und(hvsr_data['B
-00029960: 6573 7420 5065 616b 275d 5b27 6630 275d  est Peak']['f0']
-00029970: 2c20 3329 290a 2020 2020 2020 2020 666f  , 3)).        fo
-00029980: 7220 7020 696e 2068 7673 725f 6461 7461  r p in hvsr_data
-00029990: 5b27 4265 7374 2050 6561 6b27 5d5b 2250  ['Best Peak']["P
-000299a0: 6173 7320 4c69 7374 225d 3a0a 2020 2020  ass List"]:.    
-000299b0: 2020 2020 2020 2020 7072 696e 7428 702c          print(p,
-000299c0: 2027 3a27 2c68 7673 725f 6461 7461 5b27   ':',hvsr_data['
-000299d0: 4265 7374 2050 6561 6b27 5d5b 2250 6173  Best Peak']["Pas
-000299e0: 7320 4c69 7374 225d 5b70 5d29 0a20 2020  s List"][p]).   
-000299f0: 2020 2020 2070 7269 6e74 2827 5065 616b       print('Peak
-00029a00: 2050 6173 7365 7320 4372 6974 6572 6961   Passes Criteria
-00029a10: 3a27 2c68 7673 725f 6461 7461 5b27 4265  :',hvsr_data['Be
-00029a20: 7374 2050 6561 6b27 5d5b 2250 6561 6b20  st Peak']["Peak 
-00029a30: 5061 7373 6573 225d 290a 0a20 2020 2020  Passes"])..     
-00029a40: 2020 2068 7670 6c6f 7428 6876 7372 5f64     hvplot(hvsr_d
-00029a50: 6174 612c 206b 696e 643d 2748 5653 5220  ata, kind='HVSR 
-00029a60: 7020 7470 2061 6e6e 2729 0a20 2020 2020  p tp ann').     
-00029a70: 2020 2068 7670 6c6f 7428 6876 7372 5f64     hvplot(hvsr_d
-00029a80: 6174 612c 206b 696e 643d 2748 5653 5220  ata, kind='HVSR 
-00029a90: 6327 290a 2020 2020 2020 2020 6876 706c  c').        hvpl
-00029aa0: 6f74 2868 7673 725f 6461 7461 2c20 6b69  ot(hvsr_data, ki
-00029ab0: 6e64 3d27 7370 6563 2729 0a20 2020 2065  nd='spec').    e
-00029ac0: 6c69 6620 666f 726d 6174 3d3d 2763 7376  lif format=='csv
-00029ad0: 273a 0a20 2020 2020 2020 2069 6d70 6f72  ':.        impor
-00029ae0: 7420 7061 6e64 6173 2061 7320 7064 0a20  t pandas as pd. 
-00029af0: 2020 2020 2020 2070 6443 6f6c 7320 3d20         pdCols = 
-00029b00: 5b27 5369 7465 204e 616d 6527 2c20 2741  ['Site Name', 'A
-00029b10: 6371 7573 6974 696f 6e20 4461 7465 272c  cqusition Date',
-00029b20: 2027 4c6f 6e67 6974 7564 6527 2c20 274c   'Longitude', 'L
-00029b30: 6174 6974 6964 6527 2c20 2745 6c65 7661  atitide', 'Eleva
-00029b40: 7469 6f6e 272c 2027 5065 616b 2046 7265  tion', 'Peak Fre
-00029b50: 7175 656e 6379 272c 200a 2020 2020 2020  quency', .      
-00029b60: 2020 2020 2020 2020 2020 2020 2757 696e              'Win
-00029b70: 646f 7720 4c65 6e67 7468 2046 7265 712e  dow Length Freq.
-00029b80: 272c 2753 6967 6e69 6669 6361 6e74 2043  ','Significant C
-00029b90: 7963 6c65 7327 2c27 4c6f 7720 4375 7276  ycles','Low Curv
-00029ba0: 6520 5374 4465 762e 206f 7665 7220 7469  e StDev. over ti
-00029bb0: 6d65 272c 0a20 2020 2020 2020 2020 2020  me',.           
-00029bc0: 2020 2020 2020 2027 5065 616b 2046 7265         'Peak Fre
-00029bd0: 712e 2043 6c61 7269 7479 2042 656c 6f77  q. Clarity Below
-00029be0: 272c 2750 6561 6b20 4672 6571 2e20 436c  ','Peak Freq. Cl
-00029bf0: 6172 6974 7920 4162 6f76 6527 2c27 5065  arity Above','Pe
-00029c00: 616b 2041 6d70 2e20 436c 6172 6974 7927  ak Amp. Clarity'
-00029c10: 2c27 4672 6571 2e20 5374 6162 696c 6974  ,'Freq. Stabilit
-00029c20: 7927 2c20 2750 6561 6b20 5374 6162 696c  y', 'Peak Stabil
-00029c30: 6974 7920 2866 7265 712e 2073 7464 2927  ity (freq. std)'
-00029c40: 2c27 5065 616b 2053 7461 6269 6c69 7479  ,'Peak Stability
-00029c50: 2028 616d 702e 2073 7464 2927 2c20 2750   (amp. std)', 'P
-00029c60: 6561 6b20 5061 7373 6573 275d 0a20 2020  eak Passes'].   
-00029c70: 2020 2020 2064 203d 2068 7673 725f 6461       d = hvsr_da
-00029c80: 7461 0a20 2020 2020 2020 2063 7269 7465  ta.        crite
-00029c90: 7269 614c 6973 7420 3d20 5b5d 0a20 2020  riaList = [].   
-00029ca0: 2020 2020 2066 6f72 2070 2069 6e20 6876       for p in hv
-00029cb0: 7372 5f64 6174 615b 2742 6573 7420 5065  sr_data['Best Pe
-00029cc0: 616b 275d 5b22 5061 7373 204c 6973 7422  ak']["Pass List"
-00029cd0: 5d3a 0a20 2020 2020 2020 2020 2020 2063  ]:.            c
-00029ce0: 7269 7465 7269 614c 6973 742e 6170 7065  riteriaList.appe
-00029cf0: 6e64 2868 7673 725f 6461 7461 5b27 4265  nd(hvsr_data['Be
-00029d00: 7374 2050 6561 6b27 5d5b 2250 6173 7320  st Peak']["Pass 
-00029d10: 4c69 7374 225d 5b70 5d29 0a20 2020 2020  List"][p]).     
-00029d20: 2020 2063 7269 7465 7269 614c 6973 742e     criteriaList.
-00029d30: 6170 7065 6e64 2868 7673 725f 6461 7461  append(hvsr_data
-00029d40: 5b27 4265 7374 2050 6561 6b27 5d5b 2250  ['Best Peak']["P
-00029d50: 6561 6b20 5061 7373 6573 225d 290a 2020  eak Passes"]).  
-00029d60: 2020 2020 2020 6466 4c69 7374 203d 205b        dfList = [
-00029d70: 5b64 5b27 696e 7075 745f 7061 7261 6d73  [d['input_params
-00029d80: 275d 5b27 7369 7465 275d 2c20 645b 2769  ']['site'], d['i
-00029d90: 6e70 7574 5f70 6172 616d 7327 5d5b 2761  nput_params']['a
-00029da0: 6371 5f64 6174 6527 5d2c 2064 5b27 696e  cq_date'], d['in
-00029db0: 7075 745f 7061 7261 6d73 275d 5b27 6c6f  put_params']['lo
-00029dc0: 6e67 6974 7564 6527 5d2c 2064 5b27 696e  ngitude'], d['in
-00029dd0: 7075 745f 7061 7261 6d73 275d 5b27 6c61  put_params']['la
-00029de0: 7469 7475 6465 275d 2c20 645b 2769 6e70  titude'], d['inp
-00029df0: 7574 5f70 6172 616d 7327 5d5b 2765 6c65  ut_params']['ele
-00029e00: 7661 7469 6f6e 275d 2c20 726f 756e 6428  vation'], round(
-00029e10: 645b 2742 6573 7420 5065 616b 275d 5b27  d['Best Peak']['
-00029e20: 6630 275d 2c20 3329 5d5d 0a20 2020 2020  f0'], 3)]].     
-00029e30: 2020 2064 664c 6973 745b 305d 2e65 7874     dfList[0].ext
-00029e40: 656e 6428 6372 6974 6572 6961 4c69 7374  end(criteriaList
-00029e50: 290a 2020 2020 2020 2020 6f75 7444 4620  ).        outDF 
-00029e60: 3d20 7064 2e44 6174 6146 7261 6d65 2864  = pd.DataFrame(d
-00029e70: 664c 6973 742c 2063 6f6c 756d 6e73 3d70  fList, columns=p
-00029e80: 6443 6f6c 7329 0a20 2020 2020 2020 2069  dCols).        i
-00029e90: 6620 6578 706f 7274 3d3d 2727 3a0a 2020  f export=='':.  
-00029ea0: 2020 2020 2020 2020 2020 696e 4669 6c65            inFile
-00029eb0: 203d 2070 6174 686c 6962 2e50 6174 6828   = pathlib.Path(
-00029ec0: 6876 7372 5f64 6174 615b 2769 6e70 7574  hvsr_data['input
-00029ed0: 5f70 6172 616d 7327 5d5b 2764 6174 6150  _params']['dataP
-00029ee0: 6174 6827 5d29 0a20 2020 2020 2020 2020  ath']).         
-00029ef0: 2020 2069 6620 696e 4669 6c65 2e69 735f     if inFile.is_
-00029f00: 6469 7228 293a 0a20 2020 2020 2020 2020  dir():.         
-00029f10: 2020 2020 2020 2069 6e46 696c 6520 3d20         inFile = 
-00029f20: 696e 4669 6c65 2e61 735f 706f 7369 7828  inFile.as_posix(
-00029f30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00029f40: 2020 6966 2069 6e46 696c 655b 2d31 5d3d    if inFile[-1]=
-00029f50: 3d27 2f27 3a0a 2020 2020 2020 2020 2020  ='/':.          
-00029f60: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
-00029f70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00029f80: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00029f90: 2020 2020 2020 2020 2069 6e46 696c 6520           inFile 
-00029fa0: 3d20 696e 4669 6c65 202b 2027 2f27 0a20  = inFile + '/'. 
-00029fb0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00029fc0: 6e61 6d65 203d 2068 7673 725f 6461 7461  name = hvsr_data
-00029fd0: 5b27 696e 7075 745f 7061 7261 6d73 275d  ['input_params']
-00029fe0: 5b27 7369 7465 275d 2b27 5f27 2b73 7472  ['site']+'_'+str
-00029ff0: 2868 7673 725f 6461 7461 5b27 696e 7075  (hvsr_data['inpu
-0002a000: 745f 7061 7261 6d73 275d 5b27 6163 715f  t_params']['acq_
-0002a010: 6461 7465 275d 292b 275f 272b 7374 7228  date'])+'_'+str(
-0002a020: 6876 7372 5f64 6174 615b 2769 6e70 7574  hvsr_data['input
-0002a030: 5f70 6172 616d 7327 5d5b 2773 7461 7274  _params']['start
-0002a040: 7469 6d65 275d 2e74 696d 6529 5b3a 355d  time'].time)[:5]
-0002a050: 2b27 2d27 2b73 7472 2868 7673 725f 6461  +'-'+str(hvsr_da
-0002a060: 7461 5b27 696e 7075 745f 7061 7261 6d73  ta['input_params
-0002a070: 275d 5b27 656e 6474 696d 6527 5d2e 7469  ']['endtime'].ti
-0002a080: 6d65 295b 3a35 5d0a 2020 2020 2020 2020  me)[:5].        
-0002a090: 2020 2020 2020 2020 696e 4669 6c65 203d          inFile =
-0002a0a0: 2069 6e46 696c 6520 2b20 666e 616d 6520   inFile + fname 
-0002a0b0: 2b27 2e63 7376 270a 2020 2020 2020 2020  +'.csv'.        
-0002a0c0: 2020 2020 656c 6966 2069 6e46 696c 652e      elif inFile.
-0002a0d0: 6973 5f66 696c 6528 293a 0a20 2020 2020  is_file():.     
-0002a0e0: 2020 2020 2020 2020 2020 2065 7870 6f72             expor
-0002a0f0: 7420 3d20 696e 4669 6c65 2e77 6974 685f  t = inFile.with_
-0002a100: 7375 6666 6978 2827 2e63 7376 2729 0a20  suffix('.csv'). 
-0002a110: 2020 2020 2020 206f 7574 4446 2e74 6f5f         outDF.to_
-0002a120: 6373 7628 6578 706f 7274 2c20 696e 6465  csv(export, inde
-0002a130: 785f 6c61 6265 6c3d 2749 4427 290a 2020  x_label='ID').  
-0002a140: 2020 2020 2020 7265 7475 726e 206f 7574        return out
-0002a150: 4446 0a20 2020 2069 6620 6578 706f 7274  DF.    if export
-0002a160: 3a0a 2020 2020 2020 2020 7061 7373 0a20  :.        pass. 
-0002a170: 2020 2020 2020 2023 636f 6465 2074 6f20         #code to 
-0002a180: 7772 6974 6520 746f 206f 7574 7075 7420  write to output 
-0002a190: 6669 6c65 0a20 2020 2072 6574 7572 6e    file.    return
+00028d00: 6368 6563 6b5f 6d61 726b 2829 290a 2020  check_mark()).  
+00028d10: 2020 2020 2020 2020 2020 2020 2020 5f74                _t
+00028d20: 6869 735f 7065 616b 5b27 5363 6f72 6527  his_peak['Score'
+00028d30: 5d20 2b3d 2031 0a20 2020 2020 2020 2020  ] += 1.         
+00028d40: 2020 2020 2020 205f 7468 6973 5f70 6561         _this_pea
+00028d50: 6b5b 2750 6173 7320 4c69 7374 275d 5b27  k['Pass List']['
+00028d60: 5065 616b 2053 7461 6269 6c69 7479 2028  Peak Stability (
+00028d70: 6672 6571 2e20 7374 6429 275d 203d 2054  freq. std)'] = T
+00028d80: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00028d90: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00028da0: 2020 2020 2020 5f70 6561 6b5b 5f69 5d5b        _peak[_i][
+00028db0: 2752 6570 6f72 7427 5d5b 2753 6627 5d20  'Report']['Sf'] 
+00028dc0: 3d20 2725 3130 2e34 6620 3c20 2530 2e32  = '%10.4f < %0.2
+00028dd0: 6620 2a20 2530 2e33 6620 2025 3173 2720  f * %0.3f  %1s' 
+00028de0: 2520 285f 7374 6466 5b5f 695d 2c20 5f65  % (_stdf[_i], _e
+00028df0: 2c20 5f74 6869 735f 7065 616b 5b27 6630  , _this_peak['f0
+00028e00: 275d 2c20 27e2 9c98 2729 0a20 2020 2020  '], '...').     
+00028e10: 2020 2020 2020 2020 2020 205f 7468 6973             _this
+00028e20: 5f70 6561 6b5b 2750 6173 7320 4c69 7374  _peak['Pass List
+00028e30: 275d 5b27 5065 616b 2053 7461 6269 6c69  ']['Peak Stabili
+00028e40: 7479 2028 6672 6571 2e20 7374 6429 275d  ty (freq. std)']
+00028e50: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
+00028e60: 2020 2020 2020 5f74 203d 2030 2e32 0a20        _t = 0.2. 
+00028e70: 2020 2020 2020 2020 2020 2069 6620 5f68             if _h
+00028e80: 7673 725f 6c6f 675f 7374 645b 5f69 5d20  vsr_log_std[_i] 
+00028e90: 3c20 5f74 3a0a 2020 2020 2020 2020 2020  < _t:.          
+00028ea0: 2020 2020 2020 5f70 6561 6b5b 5f69 5d5b        _peak[_i][
+00028eb0: 2752 6570 6f72 7427 5d5b 2753 6127 5d20  'Report']['Sa'] 
+00028ec0: 3d20 2725 3130 2e34 6620 3c20 2530 2e32  = '%10.4f < %0.2
+00028ed0: 6620 2531 7327 2025 2028 5f68 7673 725f  f %1s' % (_hvsr_
+00028ee0: 6c6f 675f 7374 645b 5f69 5d2c 205f 742c  log_std[_i], _t,
+00028ef0: 2063 6865 636b 5f6d 6172 6b28 2929 0a20   check_mark()). 
+00028f00: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+00028f10: 7468 6973 5f70 6561 6b5b 2753 636f 7265  this_peak['Score
+00028f20: 275d 202b 3d20 310a 2020 2020 2020 2020  '] += 1.        
+00028f30: 2020 2020 2020 2020 5f74 6869 735f 7065          _this_pe
+00028f40: 616b 5b27 5061 7373 204c 6973 7427 5d5b  ak['Pass List'][
+00028f50: 2750 6561 6b20 5374 6162 696c 6974 7920  'Peak Stability 
+00028f60: 2861 6d70 2e20 7374 6429 275d 203d 2054  (amp. std)'] = T
+00028f70: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00028f80: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00028f90: 2020 2020 2020 5f70 6561 6b5b 5f69 5d5b        _peak[_i][
+00028fa0: 2752 6570 6f72 7427 5d5b 2753 6127 5d20  'Report']['Sa'] 
+00028fb0: 3d20 2725 3130 2e34 6620 3c20 2530 2e32  = '%10.4f < %0.2
+00028fc0: 6620 2025 3173 2720 2520 285f 6876 7372  f  %1s' % (_hvsr
+00028fd0: 5f6c 6f67 5f73 7464 5b5f 695d 2c20 5f74  _log_std[_i], _t
+00028fe0: 2c20 27e2 9c98 2729 0a20 2020 2020 2020  , '...').       
+00028ff0: 2020 2020 2020 2020 205f 7468 6973 5f70           _this_p
+00029000: 6561 6b5b 2750 6173 7320 4c69 7374 275d  eak['Pass List']
+00029010: 5b27 5065 616b 2053 7461 6269 6c69 7479  ['Peak Stability
+00029020: 2028 6672 6571 2e20 7374 6429 275d 203d   (freq. std)'] =
+00029030: 2046 616c 7365 0a0a 2020 2020 7265 7475   False..    retu
+00029040: 726e 205f 7065 616b 0a0a 2347 6574 2066  rn _peak..#Get f
+00029050: 7265 7175 656e 6379 2073 7461 6e64 6172  requency standar
+00029060: 6420 6465 7669 6174 696f 6e0a 6465 6620  d deviation.def 
+00029070: 5f5f 6765 745f 7374 6466 2878 5f76 616c  __get_stdf(x_val
+00029080: 7565 732c 2069 6e64 6578 4c69 7374 2c20  ues, indexList, 
+00029090: 6876 7372 5065 616b 7329 3a0a 2020 2020  hvsrPeaks):.    
+000290a0: 2222 2250 7269 7661 7465 2066 756e 6374  """Private funct
+000290b0: 696f 6e20 746f 2067 6574 2066 7265 7175  ion to get frequ
+000290c0: 656e 6379 2073 7461 6e64 6172 6420 6465  ency standard de
+000290d0: 7669 6174 696f 6e2c 2066 726f 6d20 6d75  viation, from mu
+000290e0: 6c74 6970 6c65 2074 696d 652d 7374 6570  ltiple time-step
+000290f0: 2048 5653 5220 6375 7276 6573 2222 220a   HVSR curves""".
+00029100: 2020 2020 7374 6466 203d 206c 6973 7428      stdf = list(
+00029110: 290a 2020 2020 666f 7220 696e 6465 7820  ).    for index 
+00029120: 696e 2069 6e64 6578 4c69 7374 3a0a 2020  in indexList:.  
+00029130: 2020 2020 2020 706f 696e 7420 3d20 6c69        point = li
+00029140: 7374 2829 0a20 2020 2020 2020 2066 6f72  st().        for
+00029150: 206a 2069 6e20 7261 6e67 6528 6c65 6e28   j in range(len(
+00029160: 6876 7372 5065 616b 7329 293a 0a20 2020  hvsrPeaks)):.   
+00029170: 2020 2020 2020 2020 2070 203d 204e 6f6e           p = Non
+00029180: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
+00029190: 7220 6b20 696e 2072 616e 6765 286c 656e  r k in range(len
+000291a0: 2868 7673 7250 6561 6b73 5b6a 5d29 293a  (hvsrPeaks[j])):
+000291b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000291c0: 2069 6620 7020 6973 204e 6f6e 653a 0a20   if p is None:. 
+000291d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000291e0: 2020 2070 203d 2068 7673 7250 6561 6b73     p = hvsrPeaks
+000291f0: 5b6a 5d5b 6b5d 0a20 2020 2020 2020 2020  [j][k].         
+00029200: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00029210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029220: 2023 4669 6e64 2063 6c6f 7365 7374 2070   #Find closest p
+00029230: 6561 6b20 696e 2063 7572 7265 6e74 2074  eak in current t
+00029240: 696d 6520 746f 2028 6375 7272 656e 7429  ime to (current)
+00029250: 206d 6169 6e20 6876 7372 2070 6561 6b0a   main hvsr peak.
+00029260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029270: 2020 2020 6966 2061 6273 2869 6e64 6578      if abs(index
+00029280: 202d 2068 7673 7250 6561 6b73 5b6a 5d5b   - hvsrPeaks[j][
+00029290: 6b5d 2920 3c20 6162 7328 696e 6465 7820  k]) < abs(index 
+000292a0: 2d20 7029 3a0a 2020 2020 2020 2020 2020  - p):.          
+000292b0: 2020 2020 2020 2020 2020 2020 2020 7020                p 
+000292c0: 3d20 6876 7372 5065 616b 735b 6a5d 5b6b  = hvsrPeaks[j][k
+000292d0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+000292e0: 2070 2069 7320 6e6f 7420 4e6f 6e65 3a0a   p is not None:.
+000292f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029300: 706f 696e 742e 6170 7065 6e64 2870 290a  point.append(p).
+00029310: 2020 2020 2020 2020 706f 696e 742e 6170          point.ap
+00029320: 7065 6e64 2869 6e64 6578 290a 2020 2020  pend(index).    
+00029330: 2020 2020 7620 3d20 6c69 7374 2829 0a20      v = list(). 
+00029340: 2020 2020 2020 2066 6f72 206c 2069 6e20         for l in 
+00029350: 7261 6e67 6528 6c65 6e28 706f 696e 7429  range(len(point)
+00029360: 293a 0a20 2020 2020 2020 2020 2020 2076  ):.            v
+00029370: 2e61 7070 656e 6428 785f 7661 6c75 6573  .append(x_values
+00029380: 5b70 6f69 6e74 5b6c 5d5d 290a 2020 2020  [point[l]]).    
+00029390: 2020 2020 7374 6466 2e61 7070 656e 6428      stdf.append(
+000293a0: 6e70 2e73 7464 2876 2929 0a20 2020 2072  np.std(v)).    r
+000293b0: 6574 7572 6e20 7374 6466 0a0a 2347 6574  eturn stdf..#Get
+000293c0: 206f 7220 7072 696e 7420 7265 706f 7274   or print report
+000293d0: 0a64 6566 2070 7269 6e74 5f72 6570 6f72  .def print_repor
+000293e0: 7428 6876 7372 5f64 6174 612c 2065 7870  t(hvsr_data, exp
+000293f0: 6f72 743d 2727 2c20 666f 726d 6174 3d27  ort='', format='
+00029400: 7072 696e 7427 2c20 696e 636c 7564 653d  print', include=
+00029410: 2770 6561 6b27 2c20 7361 7665 5f66 6967  'peak', save_fig
+00029420: 733d 4e6f 6e65 293a 0a20 2020 2022 2222  s=None):.    """
+00029430: 5072 696e 7420 6120 7265 706f 7274 206f  Print a report o
+00029440: 6620 7468 6520 4856 5352 2061 6e61 6c79  f the HVSR analy
+00029450: 7369 7320 286e 6f74 2063 7572 7265 6e74  sis (not current
+00029460: 6c79 2069 6d70 6c65 6d65 6e74 6564 290a  ly implemented).
+00029470: 2020 2020 0a20 2020 204e 4f54 2059 4554      .    NOT YET
+00029480: 2049 4d50 4c45 4d45 4e54 4544 210a 2020   IMPLEMENTED!.  
+00029490: 2020 0a20 2020 2050 6172 616d 6574 6572    .    Parameter
+000294a0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+000294b0: 0a20 2020 2068 7673 725f 6461 7461 203a  .    hvsr_data :
+000294c0: 2064 6963 740a 2020 2020 2020 2020 4469   dict.        Di
+000294d0: 6374 696f 6e61 7279 2063 6f6e 7461 696e  ctionary contain
+000294e0: 696e 6720 616c 6c20 7468 6520 696e 666f  ing all the info
+000294f0: 726d 6174 696f 6e20 6162 6f75 7420 7468  rmation about th
+00029500: 6520 7072 6f63 6573 7365 6420 6876 7372  e processed hvsr
+00029510: 2064 6174 610a 2020 2020 666f 726d 6174   data.    format
+00029520: 203a 207b 2763 7376 272c 2027 7072 696e   : {'csv', 'prin
+00029530: 7427 2c20 2764 6f63 7827 7d0a 2020 2020  t', 'docx'}.    
+00029540: 2020 2020 466f 726d 6174 2069 6e20 7768      Format in wh
+00029550: 6963 6820 746f 2070 7269 6e74 206f 7220  ich to print or 
+00029560: 6578 706f 7274 2074 6865 2072 6570 6f72  export the repor
+00029570: 742e 0a20 2020 2065 7870 6f72 7420 3a20  t..    export : 
+00029580: 7374 720a 2020 2020 2020 2020 4669 6c65  str.        File
+00029590: 7061 7468 2070 6174 6820 666f 7220 6578  path path for ex
+000295a0: 706f 7274 2e20 4966 206e 6f74 2073 7065  port. If not spe
+000295b0: 6369 6669 6564 2c20 7265 706f 7274 206e  cified, report n
+000295c0: 616d 6520 6973 2067 656e 6572 6174 6564  ame is generated
+000295d0: 2061 7574 6f6d 6174 6963 616c 6c79 2061   automatically a
+000295e0: 6e64 2070 6c61 6365 6420 696e 2063 7572  nd placed in cur
+000295f0: 7265 6e74 2064 6972 6563 746f 7279 0a20  rent directory. 
+00029600: 2020 2069 6e63 6c75 6465 203a 2073 7472     include : str
+00029610: 206f 7220 6c69 7374 2c20 6465 6661 756c   or list, defaul
+00029620: 743d 2770 6561 6b27 0a20 2020 2020 2020  t='peak'.       
+00029630: 2057 6861 7420 746f 2069 6e63 6c75 6465   What to include
+00029640: 2069 6e20 7468 6520 7265 706f 7274 2e20   in the report. 
+00029650: 4279 2064 6566 6175 6c74 2069 6e63 6c75  By default inclu
+00029660: 6465 7320 616c 6c20 7468 6520 666f 6c6c  des all the foll
+00029670: 6f77 696e 670a 2020 2020 2020 2020 2020  owing.          
+00029680: 2020 2d20 5369 7465 206e 616d 650a 2020    - Site name.  
+00029690: 2020 2020 2020 2020 2020 2d20 4163 7175            - Acqu
+000296a0: 6973 6974 696f 6e20 4461 7465 0a20 2020  isition Date.   
+000296b0: 2020 2020 2020 2020 202d 204c 6f6e 6769           - Longi
+000296c0: 7475 6465 0a20 2020 2020 2020 2020 2020  tude.           
+000296d0: 202d 204c 6174 6974 7564 650a 2020 2020   - Latitude.    
+000296e0: 2020 2020 2020 2020 2d20 456c 6576 6174          - Elevat
+000296f0: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+00029700: 2d20 5072 696d 6172 7920 7065 616b 2066  - Primary peak f
+00029710: 7265 7175 656e 6379 0a20 2020 2020 2020  requency.       
+00029720: 2020 2020 202d 2057 6865 7468 6572 2070       - Whether p
+00029730: 6173 7365 6420 7175 616c 6974 7920 7465  assed quality te
+00029740: 7374 7320 2878 3629 0a20 2020 2020 2020  sts (x6).       
+00029750: 2046 6f72 2064 6f63 7820 286e 6f74 2079   For docx (not y
+00029760: 6574 2069 6d70 6c65 6d65 6e74 6564 292c  et implemented),
+00029770: 2074 6865 2066 6f6c 6c6f 7769 6e67 2061   the following a
+00029780: 7265 2061 6c73 6f20 696e 636c 7564 6564  re also included
+00029790: 3a0a 2020 2020 2020 2020 2020 2020 2d20  :.            - 
+000297a0: 4669 6775 7265 2077 6974 6820 7370 6563  Figure with spec
+000297b0: 7472 6f67 7261 6d0a 2020 2020 2020 2020  trogram.        
+000297c0: 2020 2020 2d20 4669 6775 7265 2077 6974      - Figure wit
+000297d0: 6820 4856 5352 2063 7572 7665 0a20 2020  h HVSR curve.   
+000297e0: 2020 2020 2020 2020 202d 2046 6967 7572           - Figur
+000297f0: 6520 7769 7468 2033 2063 6f6d 706f 6e65  e with 3 compone
+00029800: 6e74 730a 2020 2020 2222 220a 2020 2020  nts.    """.    
+00029810: 2370 7269 6e74 2073 7461 7465 6d65 6e74  #print statement
+00029820: 0a20 2020 2069 6620 666f 726d 6174 3d3d  .    if format==
+00029830: 2770 7269 6e74 273a 0a20 2020 2020 2020  'print':.       
+00029840: 2070 7269 6e74 2868 7673 725f 6461 7461   print(hvsr_data
+00029850: 5b27 696e 7075 745f 7061 7261 6d73 275d  ['input_params']
+00029860: 5b27 7369 7465 275d 290a 2020 2020 2020  ['site']).      
+00029870: 2020 7072 696e 7428 6876 7372 5f64 6174    print(hvsr_dat
+00029880: 615b 2769 6e70 7574 5f70 6172 616d 7327  a['input_params'
+00029890: 5d5b 2761 6371 5f64 6174 6527 5d29 0a20  ]['acq_date']). 
+000298a0: 2020 2020 2020 2070 7269 6e74 2868 7673         print(hvs
+000298b0: 725f 6461 7461 5b27 696e 7075 745f 7061  r_data['input_pa
+000298c0: 7261 6d73 275d 5b27 6c6f 6e67 6974 7564  rams']['longitud
+000298d0: 6527 5d2c 2068 7673 725f 6461 7461 5b27  e'], hvsr_data['
+000298e0: 696e 7075 745f 7061 7261 6d73 275d 5b27  input_params']['
+000298f0: 6c61 7469 7475 6465 275d 290a 2020 2020  latitude']).    
+00029900: 2020 2020 7072 696e 7428 6876 7372 5f64      print(hvsr_d
+00029910: 6174 615b 2769 6e70 7574 5f70 6172 616d  ata['input_param
+00029920: 7327 5d5b 2765 6c65 7661 7469 6f6e 275d  s']['elevation']
+00029930: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
+00029940: 726f 756e 6428 6876 7372 5f64 6174 615b  round(hvsr_data[
+00029950: 2742 6573 7420 5065 616b 275d 5b27 6630  'Best Peak']['f0
+00029960: 275d 2c20 3329 290a 2020 2020 2020 2020  '], 3)).        
+00029970: 666f 7220 7020 696e 2068 7673 725f 6461  for p in hvsr_da
+00029980: 7461 5b27 4265 7374 2050 6561 6b27 5d5b  ta['Best Peak'][
+00029990: 2250 6173 7320 4c69 7374 225d 3a0a 2020  "Pass List"]:.  
+000299a0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000299b0: 702c 2027 3a27 2c68 7673 725f 6461 7461  p, ':',hvsr_data
+000299c0: 5b27 4265 7374 2050 6561 6b27 5d5b 2250  ['Best Peak']["P
+000299d0: 6173 7320 4c69 7374 225d 5b70 5d29 0a20  ass List"][p]). 
+000299e0: 2020 2020 2020 2070 7269 6e74 2827 5065         print('Pe
+000299f0: 616b 2050 6173 7365 7320 4372 6974 6572  ak Passes Criter
+00029a00: 6961 3a27 2c68 7673 725f 6461 7461 5b27  ia:',hvsr_data['
+00029a10: 4265 7374 2050 6561 6b27 5d5b 2250 6561  Best Peak']["Pea
+00029a20: 6b20 5061 7373 6573 225d 290a 0a20 2020  k Passes"])..   
+00029a30: 2020 2020 2068 7670 6c6f 7428 6876 7372       hvplot(hvsr
+00029a40: 5f64 6174 612c 206b 696e 643d 2748 5653  _data, kind='HVS
+00029a50: 5220 7020 7470 2061 6e6e 2729 0a20 2020  R p tp ann').   
+00029a60: 2020 2020 2068 7670 6c6f 7428 6876 7372       hvplot(hvsr
+00029a70: 5f64 6174 612c 206b 696e 643d 2748 5653  _data, kind='HVS
+00029a80: 5220 6327 290a 2020 2020 2020 2020 6876  R c').        hv
+00029a90: 706c 6f74 2868 7673 725f 6461 7461 2c20  plot(hvsr_data, 
+00029aa0: 6b69 6e64 3d27 7370 6563 2729 0a20 2020  kind='spec').   
+00029ab0: 2065 6c69 6620 666f 726d 6174 3d3d 2763   elif format=='c
+00029ac0: 7376 273a 0a20 2020 2020 2020 2069 6d70  sv':.        imp
+00029ad0: 6f72 7420 7061 6e64 6173 2061 7320 7064  ort pandas as pd
+00029ae0: 0a20 2020 2020 2020 2070 6443 6f6c 7320  .        pdCols 
+00029af0: 3d20 5b27 5369 7465 204e 616d 6527 2c20  = ['Site Name', 
+00029b00: 2741 6371 7573 6974 696f 6e20 4461 7465  'Acqusition Date
+00029b10: 272c 2027 4c6f 6e67 6974 7564 6527 2c20  ', 'Longitude', 
+00029b20: 274c 6174 6974 6964 6527 2c20 2745 6c65  'Latitide', 'Ele
+00029b30: 7661 7469 6f6e 272c 2027 5065 616b 2046  vation', 'Peak F
+00029b40: 7265 7175 656e 6379 272c 200a 2020 2020  requency', .    
+00029b50: 2020 2020 2020 2020 2020 2020 2020 2757                'W
+00029b60: 696e 646f 7720 4c65 6e67 7468 2046 7265  indow Length Fre
+00029b70: 712e 272c 2753 6967 6e69 6669 6361 6e74  q.','Significant
+00029b80: 2043 7963 6c65 7327 2c27 4c6f 7720 4375   Cycles','Low Cu
+00029b90: 7276 6520 5374 4465 762e 206f 7665 7220  rve StDev. over 
+00029ba0: 7469 6d65 272c 0a20 2020 2020 2020 2020  time',.         
+00029bb0: 2020 2020 2020 2020 2027 5065 616b 2046           'Peak F
+00029bc0: 7265 712e 2043 6c61 7269 7479 2042 656c  req. Clarity Bel
+00029bd0: 6f77 272c 2750 6561 6b20 4672 6571 2e20  ow','Peak Freq. 
+00029be0: 436c 6172 6974 7920 4162 6f76 6527 2c27  Clarity Above','
+00029bf0: 5065 616b 2041 6d70 2e20 436c 6172 6974  Peak Amp. Clarit
+00029c00: 7927 2c27 4672 6571 2e20 5374 6162 696c  y','Freq. Stabil
+00029c10: 6974 7927 2c20 2750 6561 6b20 5374 6162  ity', 'Peak Stab
+00029c20: 696c 6974 7920 2866 7265 712e 2073 7464  ility (freq. std
+00029c30: 2927 2c27 5065 616b 2053 7461 6269 6c69  )','Peak Stabili
+00029c40: 7479 2028 616d 702e 2073 7464 2927 2c20  ty (amp. std)', 
+00029c50: 2750 6561 6b20 5061 7373 6573 275d 0a20  'Peak Passes']. 
+00029c60: 2020 2020 2020 2064 203d 2068 7673 725f         d = hvsr_
+00029c70: 6461 7461 0a20 2020 2020 2020 2063 7269  data.        cri
+00029c80: 7465 7269 614c 6973 7420 3d20 5b5d 0a20  teriaList = []. 
+00029c90: 2020 2020 2020 2066 6f72 2070 2069 6e20         for p in 
+00029ca0: 6876 7372 5f64 6174 615b 2742 6573 7420  hvsr_data['Best 
+00029cb0: 5065 616b 275d 5b22 5061 7373 204c 6973  Peak']["Pass Lis
+00029cc0: 7422 5d3a 0a20 2020 2020 2020 2020 2020  t"]:.           
+00029cd0: 2063 7269 7465 7269 614c 6973 742e 6170   criteriaList.ap
+00029ce0: 7065 6e64 2868 7673 725f 6461 7461 5b27  pend(hvsr_data['
+00029cf0: 4265 7374 2050 6561 6b27 5d5b 2250 6173  Best Peak']["Pas
+00029d00: 7320 4c69 7374 225d 5b70 5d29 0a20 2020  s List"][p]).   
+00029d10: 2020 2020 2063 7269 7465 7269 614c 6973       criteriaLis
+00029d20: 742e 6170 7065 6e64 2868 7673 725f 6461  t.append(hvsr_da
+00029d30: 7461 5b27 4265 7374 2050 6561 6b27 5d5b  ta['Best Peak'][
+00029d40: 2250 6561 6b20 5061 7373 6573 225d 290a  "Peak Passes"]).
+00029d50: 2020 2020 2020 2020 6466 4c69 7374 203d          dfList =
+00029d60: 205b 5b64 5b27 696e 7075 745f 7061 7261   [[d['input_para
+00029d70: 6d73 275d 5b27 7369 7465 275d 2c20 645b  ms']['site'], d[
+00029d80: 2769 6e70 7574 5f70 6172 616d 7327 5d5b  'input_params'][
+00029d90: 2761 6371 5f64 6174 6527 5d2c 2064 5b27  'acq_date'], d['
+00029da0: 696e 7075 745f 7061 7261 6d73 275d 5b27  input_params']['
+00029db0: 6c6f 6e67 6974 7564 6527 5d2c 2064 5b27  longitude'], d['
+00029dc0: 696e 7075 745f 7061 7261 6d73 275d 5b27  input_params']['
+00029dd0: 6c61 7469 7475 6465 275d 2c20 645b 2769  latitude'], d['i
+00029de0: 6e70 7574 5f70 6172 616d 7327 5d5b 2765  nput_params']['e
+00029df0: 6c65 7661 7469 6f6e 275d 2c20 726f 756e  levation'], roun
+00029e00: 6428 645b 2742 6573 7420 5065 616b 275d  d(d['Best Peak']
+00029e10: 5b27 6630 275d 2c20 3329 5d5d 0a20 2020  ['f0'], 3)]].   
+00029e20: 2020 2020 2064 664c 6973 745b 305d 2e65       dfList[0].e
+00029e30: 7874 656e 6428 6372 6974 6572 6961 4c69  xtend(criteriaLi
+00029e40: 7374 290a 2020 2020 2020 2020 6f75 7444  st).        outD
+00029e50: 4620 3d20 7064 2e44 6174 6146 7261 6d65  F = pd.DataFrame
+00029e60: 2864 664c 6973 742c 2063 6f6c 756d 6e73  (dfList, columns
+00029e70: 3d70 6443 6f6c 7329 0a20 2020 2020 2020  =pdCols).       
+00029e80: 2069 6620 6578 706f 7274 3d3d 2727 3a0a   if export=='':.
+00029e90: 2020 2020 2020 2020 2020 2020 696e 4669              inFi
+00029ea0: 6c65 203d 2070 6174 686c 6962 2e50 6174  le = pathlib.Pat
+00029eb0: 6828 6876 7372 5f64 6174 615b 2769 6e70  h(hvsr_data['inp
+00029ec0: 7574 5f70 6172 616d 7327 5d5b 2764 6174  ut_params']['dat
+00029ed0: 6150 6174 6827 5d29 0a20 2020 2020 2020  aPath']).       
+00029ee0: 2020 2020 2069 6620 696e 4669 6c65 2e69       if inFile.i
+00029ef0: 735f 6469 7228 293a 0a20 2020 2020 2020  s_dir():.       
+00029f00: 2020 2020 2020 2020 2069 6e46 696c 6520           inFile 
+00029f10: 3d20 696e 4669 6c65 2e61 735f 706f 7369  = inFile.as_posi
+00029f20: 7828 290a 2020 2020 2020 2020 2020 2020  x().            
+00029f30: 2020 2020 6966 2069 6e46 696c 655b 2d31      if inFile[-1
+00029f40: 5d3d 3d27 2f27 3a0a 2020 2020 2020 2020  ]=='/':.        
+00029f50: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00029f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029f70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00029f80: 2020 2020 2020 2020 2020 2069 6e46 696c             inFil
+00029f90: 6520 3d20 696e 4669 6c65 202b 2027 2f27  e = inFile + '/'
+00029fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029fb0: 2066 6e61 6d65 203d 2068 7673 725f 6461   fname = hvsr_da
+00029fc0: 7461 5b27 696e 7075 745f 7061 7261 6d73  ta['input_params
+00029fd0: 275d 5b27 7369 7465 275d 2b27 5f27 2b73  ']['site']+'_'+s
+00029fe0: 7472 2868 7673 725f 6461 7461 5b27 696e  tr(hvsr_data['in
+00029ff0: 7075 745f 7061 7261 6d73 275d 5b27 6163  put_params']['ac
+0002a000: 715f 6461 7465 275d 292b 275f 272b 7374  q_date'])+'_'+st
+0002a010: 7228 6876 7372 5f64 6174 615b 2769 6e70  r(hvsr_data['inp
+0002a020: 7574 5f70 6172 616d 7327 5d5b 2773 7461  ut_params']['sta
+0002a030: 7274 7469 6d65 275d 2e74 696d 6529 5b3a  rttime'].time)[:
+0002a040: 355d 2b27 2d27 2b73 7472 2868 7673 725f  5]+'-'+str(hvsr_
+0002a050: 6461 7461 5b27 696e 7075 745f 7061 7261  data['input_para
+0002a060: 6d73 275d 5b27 656e 6474 696d 6527 5d2e  ms']['endtime'].
+0002a070: 7469 6d65 295b 3a35 5d0a 2020 2020 2020  time)[:5].      
+0002a080: 2020 2020 2020 2020 2020 696e 4669 6c65            inFile
+0002a090: 203d 2069 6e46 696c 6520 2b20 666e 616d   = inFile + fnam
+0002a0a0: 6520 2b27 2e63 7376 270a 2020 2020 2020  e +'.csv'.      
+0002a0b0: 2020 2020 2020 656c 6966 2069 6e46 696c        elif inFil
+0002a0c0: 652e 6973 5f66 696c 6528 293a 0a20 2020  e.is_file():.   
+0002a0d0: 2020 2020 2020 2020 2020 2020 2065 7870               exp
+0002a0e0: 6f72 7420 3d20 696e 4669 6c65 2e77 6974  ort = inFile.wit
+0002a0f0: 685f 7375 6666 6978 2827 2e63 7376 2729  h_suffix('.csv')
+0002a100: 0a20 2020 2020 2020 206f 7574 4446 2e74  .        outDF.t
+0002a110: 6f5f 6373 7628 6578 706f 7274 2c20 696e  o_csv(export, in
+0002a120: 6465 785f 6c61 6265 6c3d 2749 4427 290a  dex_label='ID').
+0002a130: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+0002a140: 7574 4446 0a20 2020 2069 6620 6578 706f  utDF.    if expo
+0002a150: 7274 3a0a 2020 2020 2020 2020 7061 7373  rt:.        pass
+0002a160: 0a20 2020 2020 2020 2023 636f 6465 2074  .        #code t
+0002a170: 6f20 7772 6974 6520 746f 206f 7574 7075  o write to outpu
+0002a180: 7420 6669 6c65 0a20 2020 2072 6574 7572  t file.    retur
+0002a190: 6e                                       n
```

### Comparing `sprit-0.0.3/sprit/sprit_gui.py` & `sprit-0.0.9/sprit/sprit_gui.py`

 * *Files identical despite different names*

### Comparing `sprit-0.0.3/sprit.egg-info/PKG-INFO` & `sprit-0.0.9/sprit.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: sprit
-Version: 0.0.3
+Version: 0.0.9
 Summary: A package for processing and analyzing HVSR (Horizontal to Vertical Spectral Ratio) data
 Author: Riley Balikian
 Author-email: balikian@illinois.edu
 License: MIT License
         
         Copyright (c) 2023 RJbalikian
```

