# Comparing `tmp/opentf_tools_nightly-0.42.0.dev440-py3-none-any.whl.zip` & `tmp/opentf_tools_nightly-0.42.0.dev446-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,16 +1,16 @@
-Zip file size: 40087 bytes, number of entries: 14
--rw-r--r--  2.0 unx    27544 b- defN 23-Jul-07 12:12 opentf/tools/ctl.py
--rw-r--r--  2.0 unx     7773 b- defN 23-Jul-07 12:12 opentf/tools/ctlcommons.py
--rw-r--r--  2.0 unx    29452 b- defN 23-Jul-07 12:12 opentf/tools/ctlconfig.py
--rw-r--r--  2.0 unx     8878 b- defN 23-Jul-07 12:12 opentf/tools/ctlnetworking.py
--rw-r--r--  2.0 unx    11429 b- defN 23-Jul-07 12:12 opentf/tools/ctlqualitygate.py
--rw-r--r--  2.0 unx    29356 b- defN 23-Jul-07 12:12 opentf/tools/ctlworkflows.py
--rw-r--r--  2.0 unx     3188 b- defN 23-Jul-07 12:12 opentf/tools/done.py
--rw-r--r--  2.0 unx     9391 b- defN 23-Jul-07 12:12 opentf/tools/ready.py
--rw-rw-rw-  2.0 unx    11357 b- defN 23-Jul-07 12:12 opentf_tools_nightly-0.42.0.dev440.dist-info/LICENSE
--rw-r--r--  2.0 unx     1808 b- defN 23-Jul-07 12:12 opentf_tools_nightly-0.42.0.dev440.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jul-07 12:12 opentf_tools_nightly-0.42.0.dev440.dist-info/WHEEL
--rw-r--r--  2.0 unx      139 b- defN 23-Jul-07 12:12 opentf_tools_nightly-0.42.0.dev440.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        7 b- defN 23-Jul-07 12:12 opentf_tools_nightly-0.42.0.dev440.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1266 b- defN 23-Jul-07 12:12 opentf_tools_nightly-0.42.0.dev440.dist-info/RECORD
-14 files, 141680 bytes uncompressed, 37955 bytes compressed:  73.2%
+Zip file size: 40262 bytes, number of entries: 14
+-rw-r--r--  2.0 unx    27544 b- defN 23-Jul-12 13:27 opentf/tools/ctl.py
+-rw-r--r--  2.0 unx     7773 b- defN 23-Jul-12 13:27 opentf/tools/ctlcommons.py
+-rw-r--r--  2.0 unx    29452 b- defN 23-Jul-12 13:27 opentf/tools/ctlconfig.py
+-rw-r--r--  2.0 unx     8878 b- defN 23-Jul-12 13:27 opentf/tools/ctlnetworking.py
+-rw-r--r--  2.0 unx    12028 b- defN 23-Jul-12 13:27 opentf/tools/ctlqualitygate.py
+-rw-r--r--  2.0 unx    29356 b- defN 23-Jul-12 13:27 opentf/tools/ctlworkflows.py
+-rw-r--r--  2.0 unx     3188 b- defN 23-Jul-12 13:27 opentf/tools/done.py
+-rw-r--r--  2.0 unx     9391 b- defN 23-Jul-12 13:27 opentf/tools/ready.py
+-rw-rw-rw-  2.0 unx    11357 b- defN 23-Jul-12 13:27 opentf_tools_nightly-0.42.0.dev446.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1808 b- defN 23-Jul-12 13:27 opentf_tools_nightly-0.42.0.dev446.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jul-12 13:27 opentf_tools_nightly-0.42.0.dev446.dist-info/WHEEL
+-rw-r--r--  2.0 unx      139 b- defN 23-Jul-12 13:27 opentf_tools_nightly-0.42.0.dev446.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        7 b- defN 23-Jul-12 13:27 opentf_tools_nightly-0.42.0.dev446.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1266 b- defN 23-Jul-12 13:27 opentf_tools_nightly-0.42.0.dev446.dist-info/RECORD
+14 files, 142279 bytes uncompressed, 38130 bytes compressed:  73.2%
```

## zipnote {}

```diff
@@ -18,26 +18,26 @@
 
 Filename: opentf/tools/done.py
 Comment: 
 
 Filename: opentf/tools/ready.py
 Comment: 
 
-Filename: opentf_tools_nightly-0.42.0.dev440.dist-info/LICENSE
+Filename: opentf_tools_nightly-0.42.0.dev446.dist-info/LICENSE
 Comment: 
 
-Filename: opentf_tools_nightly-0.42.0.dev440.dist-info/METADATA
+Filename: opentf_tools_nightly-0.42.0.dev446.dist-info/METADATA
 Comment: 
 
-Filename: opentf_tools_nightly-0.42.0.dev440.dist-info/WHEEL
+Filename: opentf_tools_nightly-0.42.0.dev446.dist-info/WHEEL
 Comment: 
 
-Filename: opentf_tools_nightly-0.42.0.dev440.dist-info/entry_points.txt
+Filename: opentf_tools_nightly-0.42.0.dev446.dist-info/entry_points.txt
 Comment: 
 
-Filename: opentf_tools_nightly-0.42.0.dev440.dist-info/top_level.txt
+Filename: opentf_tools_nightly-0.42.0.dev446.dist-info/top_level.txt
 Comment: 
 
-Filename: opentf_tools_nightly-0.42.0.dev440.dist-info/RECORD
+Filename: opentf_tools_nightly-0.42.0.dev446.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## opentf/tools/ctlqualitygate.py

```diff
@@ -8,15 +8,15 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-from typing import Any, Dict, Iterable, List, Optional
+from typing import Any, Dict, Iterable, List, NoReturn, Optional
 
 import sys
 
 from opentf.tools.ctlcommons import (
     _ensure_options,
     _is_command,
     _get_arg,
@@ -97,62 +97,78 @@
     'TESTS_FAILED:rule.tests_failed',
     'TESTS_PASSED:rule.tests_passed',
     'SUCCESS_RATIO:rule.success_ratio',
     'THRESHOLD:rule.threshold',
     'SCOPE:rule.scope',
 )
 
+NOTEST = 'NOTEST'
+FAILURE = 'FAILURE'
+RUNNING = 'RUNNING'
+SUCCESS = 'SUCCESS'
+INVALIDSCOPE = 'INVALID_SCOPE'
+
+
 STATUS_TEMPLATES = {
-    'SUCCESS': 'Workflow {workflow_id} passed the quality gate `{mode}` applying the rule `{rule}`.',
-    'FAILURE': 'Workflow {workflow_id} failed the quality gate `{mode}` applying the rule `{rule}`.',
-    'NOTEST': 'Workflow {workflow_id} contains no tests matching the quality gate `{mode}` rule `{rule}`.',
+    SUCCESS: 'Workflow {workflow_id} passed the quality gate `{mode}` applying the rule `{rule}`.',
+    FAILURE: 'Workflow {workflow_id} failed the quality gate `{mode}` applying the rule `{rule}`.',
+    NOTEST: 'Workflow {workflow_id} contains no tests matching the quality gate `{mode}` rule `{rule}`.',
+    INVALIDSCOPE: 'The quality gate `{mode}` rule `{rule}` scope `{scope}` is invalid.',
 }
 
+########################################################################
+
+
+def _fatal(*msg) -> NoReturn:
+    _error(*msg)
+    sys.exit(2)
+
 
 def _describe_qualitygate(workflow_id: str, mode: str, status: Dict[str, Any]) -> None:
     """Get quality gate results for a workflow in a pretty form."""
     for rule, data in status.items():
-        if data['result'] not in ('SUCCESS', 'NOTEST', 'FAILURE'):
+        if data['result'] not in (SUCCESS, NOTEST, FAILURE, INVALIDSCOPE):
             _error(
-                f'Unexpected quality gate result when applying rule `{rule}`: {data["result"]} (was expecting SUCCESS, FAILURE or NOTEST).'
+                f'Unexpected quality gate result when applying rule `{rule}`: {data["result"]} (was expecting {", ".join(STATUS_TEMPLATES)}).'
             )
             continue
         print(f'\n--------RESULTS: {mode}, {rule}--------\n')
-        print(_make_qualitygate_status_message(data['result'], workflow_id, mode, rule))
-        if data['result'] in ('SUCCESS', 'FAILURE'):
+        print(
+            _make_qualitygate_status_message(
+                data['result'], workflow_id, mode, rule, data.get('scope')
+            )
+        )
+        if data['result'] in (SUCCESS, FAILURE):
             print('\n    --------STATISTICS--------\n')
             print(f'    Tests in scope: {data["tests_in_scope"]}')
             print(f'    Tests failed:   {data["tests_failed"]}')
             print(f'    Tests passed:   {data["tests_passed"]}')
             print(f'    Success ratio:  {data["success_ratio"]}')
             print(f'    Threshold:      {data["threshold"]}')
 
 
 def _make_qualitygate_status_message(
-    status: str, workflow_id: str, mode: str, rule: str
+    status: str, workflow_id: str, mode: str, rule: str, scope: Optional[str]
 ) -> str:
     return STATUS_TEMPLATES[status].format(
-        workflow_id=workflow_id, mode=mode, rule=rule
+        workflow_id=workflow_id, mode=mode, rule=rule, scope=scope
     )
 
 
-def _make_rule_row(
-    name: str, definition: Dict[str, Any], fields: List[str]
-) -> List[str]:
-    if definition['result'] not in ('SUCCESS', 'NOTEST', 'FAILURE'):
-        _error(
-            f'Unexpected quality gate result when applying rule `{name}`: {definition["result"]} (was expecting SUCCESS, FAILURE or NOTEST).'
+def _make_rule_row(name: str, data: Dict[str, Any], fields: List[str]) -> List[str]:
+    if data['result'] not in (SUCCESS, NOTEST, FAILURE, INVALIDSCOPE):
+        _fatal(
+            f'Unexpected quality gate result when applying rule `{name}`: {data["result"]} (was expecting {", ".join(STATUS_TEMPLATES)}).'
         )
-        sys.exit(2)
     row = []
     for field in fields:
         if field == 'rule':
             row.append(name)
-        elif field.startswith('rule.') and definition:
-            row.append(definition.get(field.split('.')[1], ''))
+        elif field.startswith('rule.') and data:
+            row.append(data.get(field.split('.')[1], ''))
         else:
             row.append('')
     return row
 
 
 def _generate_qualitygate_rows(
     status: Dict[str, Any], columns: Iterable[str]
@@ -160,65 +176,78 @@
     """Generate rows with quality gate results."""
     fields = [column.split(':')[1] for column in columns]
     return [
         _make_rule_row(name, definition, fields) for name, definition in status.items()
     ]
 
 
-def _get_qualitygate_status(workflow_id: str, mode: str) -> Dict[str, Any]:
-    _ensure_uuid(workflow_id)
-    result = _get_json(
-        _qualitygate(),
-        f'/workflows/{workflow_id}/qualitygate?mode={mode}',
-        statuses=(200, 404, 422),
-    )
-    return _process_qualitygate_result(result, workflow_id)
-
-
 def _process_qualitygate_result(
     result: Dict[str, Any], workflow_id: str
 ) -> Dict[str, Any]:
     if result.get('code') == 404:
-        _error(
+        _fatal(
             'Unknown workflow %s.  It is either too new, too old, or the provided '
             + 'workflow ID is incorrect.  You can use "opentf-ctl get workflows" to list '
             + 'the known workflow IDs.',
             workflow_id,
         )
-        sys.exit(2)
     if result.get('code') == 422:
-        _error(result.get('message'))
-        sys.exit(2)
+        _fatal(result.get('message'))
     if 'details' not in result or 'status' not in result.get('details', {}):
-        _error(
+        _fatal(
             'Unexpected response from qualitygate.  Was expecting a JSON object'
             + ' with a .details.status entry, got: %s.',
             str(result),
         )
-        sys.exit(2)
 
     return result['details']
 
 
+def _print_final_status(workflow_id, mode, status):
+    if status == FAILURE:
+        print(f'Workflow {workflow_id} failed the quality gate using mode {mode}.')
+        sys.exit(102)
+    if status == SUCCESS:
+        print(f'Workflow {workflow_id} passed the quality gate using mode {mode}.')
+    if status == NOTEST:
+        print(f'Workflow {workflow_id} contains no test matching quality gate scopes.')
+
+
+def _get_qualitygate_status(workflow_id: str, mode: str) -> Dict[str, Any]:
+    return _get_json(
+        _qualitygate(),
+        f'/workflows/{workflow_id}/qualitygate?mode={mode}',
+        statuses=(200, 404, 422),
+    )
+
+
 def _post_qualitygate_definition(workflow_id: str, using: str, mode: str):
-    _ensure_uuid(workflow_id)
     try:
         files = {'qualitygates': open(using, 'rb')}
-        result = _post(
+        return _post(
             _qualitygate(),
             f'/workflows/{workflow_id}/qualitygate?mode={mode}',
             statuses=(200,),
             files=files,
         )
-        return _process_qualitygate_result(result, workflow_id)
     except FileNotFoundError as err:
         _file_not_found(using, err)
     except Exception as err:
-        _error(f'Exception while handling quality gate definition file: {err}')
-        sys.exit(2)
+        _fatal(f'Exception while handling quality gate definition file: {err}')
+
+
+def _query_qualitygate(
+    workflow_id: str, using: Optional[str], mode: str
+) -> Dict[str, Any]:
+    _ensure_uuid(workflow_id)
+    if using:
+        result = _post_qualitygate_definition(workflow_id, using, mode)
+    else:
+        result = _get_qualitygate_status(workflow_id, mode)
+    return _process_qualitygate_result(result, workflow_id)
 
 
 def get_qualitygate(
     workflow_id: str, mode: str, describe: bool = False, using: Optional[str] = None
 ) -> None:
     """Get qualitygate status.
 
@@ -232,51 +261,43 @@
     Abort with an error code of 2 if the specified `workflow_id` is
     invalid or if an error occurred while contacting the orchestrator.
 
     Abort with an error code of 101 if the workflow is still running.
 
     Abort with an error code of 102 if the quality gate failed.
     """
-    if using:
-        details = _post_qualitygate_definition(workflow_id, using, mode)
-    else:
-        details = _get_qualitygate_status(workflow_id, mode)
+    response = _query_qualitygate(workflow_id, using, mode)
 
-    status = details['status']
-    if status not in ('NOTEST', 'FAILURE', 'RUNNING', 'SUCCESS'):
-        _error(
-            'Unexpected workflow status from qualitygate service: %s (was expecting NOTEST,'
-            + ' SUCCESS, FAILURE, or RUNNING).',
+    status = response['status']
+    if status not in (NOTEST, FAILURE, RUNNING, SUCCESS, INVALIDSCOPE):
+        _fatal(
+            f'Unexpected workflow status from qualitygate service: %s (was expecting RUNNING, {", ".join(STATUS_TEMPLATES)}).',
             status,
         )
-        sys.exit(2)
-    if status == 'RUNNING':
+    if status == RUNNING:
         print(
             f'Workflow {workflow_id} is still running.  Please retry after workflow completion.'
         )
         sys.exit(101)
 
-    if warnings := details.get('warnings'):
-        for msg in warnings:
-            _warning(msg)
+    for msg in response.get('warnings', []):
+        _warning(msg)
+
+    if (rules := response.get('rules')) is not None:
+        for rule_name, rule in rules.items():
+            if rule['result'] == INVALIDSCOPE:
+                _error(f'Error in rule `{rule_name}`. {rule["message"]}')
 
-    if (rules := details.get('rules')) is not None:
         if describe:
             _describe_qualitygate(workflow_id, mode, rules)
         else:
             columns = _retrieve_columns_to_display(WIDE_COLUMNS, DEFAULT_COLUMNS)
             _emit_csv(_generate_qualitygate_rows(rules, columns), columns)
 
-    if status == 'FAILURE':
-        print(f'Workflow {workflow_id} failed the quality gate using mode {mode}.')
-        sys.exit(102)
-    if status == 'SUCCESS':
-        print(f'Workflow {workflow_id} passed the quality gate using mode {mode}.')
-    if status == 'NOTEST':
-        print(f'Workflow {workflow_id} contains no test matching quality gate scopes.')
+    _print_final_status(workflow_id, mode, status)
 
 
 ########################################################################
 # Helpers
 
 
 def print_qualitygate_help(args: List[str]):
```

## Comparing `opentf_tools_nightly-0.42.0.dev440.dist-info/LICENSE` & `opentf_tools_nightly-0.42.0.dev446.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `opentf_tools_nightly-0.42.0.dev440.dist-info/METADATA` & `opentf_tools_nightly-0.42.0.dev446.dist-info/METADATA`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: opentf-tools-nightly
-Version: 0.42.0.dev440
+Version: 0.42.0.dev446
 Summary: OpenTestFactory Orchestrator Tools
 Home-page: https://opentestfactory.org/tools/
 Author: Martin Lafaix
 Author-email: mlafaix@henix.com
 Maintainer: Henix
 Maintainer-email: opentestfactory@henix.com
 License: Apache Software License (https://www.apache.org/licenses/LICENSE-2.0)
```

## Comparing `opentf_tools_nightly-0.42.0.dev440.dist-info/RECORD` & `opentf_tools_nightly-0.42.0.dev446.dist-info/RECORD`

 * *Files 22% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 opentf/tools/ctl.py,sha256=H930DQ1e0Iv3zwpL_ZiXXxiixVrF55A89N8MH9deftI,27544
 opentf/tools/ctlcommons.py,sha256=A1HKWqLQfQY1BFJA0ugXERK2klC23c8u0jn5lYz8uxE,7773
 opentf/tools/ctlconfig.py,sha256=dWY0RHgpa7GeC1GMMBniUctuCQKrnXyY-AcNm5xhrNQ,29452
 opentf/tools/ctlnetworking.py,sha256=NO_U5VZ49w5vEcbOzX7cjXFY8ygsOb6NaoEgj4U1oW0,8878
-opentf/tools/ctlqualitygate.py,sha256=AVZO9f3NlhCn1M8v8-mk2DvmkY9ouh5rlwXTzTuPRx4,11429
+opentf/tools/ctlqualitygate.py,sha256=C7HyqVo_wPUFEcbGKS_awlfBHIrs5uPGEOOBl5YSUUI,12028
 opentf/tools/ctlworkflows.py,sha256=KwSPOrkpkt5-x0GUbdSqpXZBOQPp5qL2vkOAeewWGdg,29356
 opentf/tools/done.py,sha256=1X5s9IjpphD0LZvcQ0h36mKHkbLjjYDzlqqwat6kKdE,3188
 opentf/tools/ready.py,sha256=WHPdnWCMOKLCxLlF0FTCCpW-8y0BF7rrGCl7H2AJ-DM,9391
-opentf_tools_nightly-0.42.0.dev440.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
-opentf_tools_nightly-0.42.0.dev440.dist-info/METADATA,sha256=8TxHGT_FFriJEPor5SDINx8VwAKH-8p0VaQ3ixDZoAQ,1808
-opentf_tools_nightly-0.42.0.dev440.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-opentf_tools_nightly-0.42.0.dev440.dist-info/entry_points.txt,sha256=u5qYtmUbgIMcq8360YobnI9CtDvrjptf4lDkmKojoa0,139
-opentf_tools_nightly-0.42.0.dev440.dist-info/top_level.txt,sha256=_gPuE6GTT6UNXy1DjtmQSfCcZb_qYA2vWmjg7a30AGk,7
-opentf_tools_nightly-0.42.0.dev440.dist-info/RECORD,,
+opentf_tools_nightly-0.42.0.dev446.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
+opentf_tools_nightly-0.42.0.dev446.dist-info/METADATA,sha256=jhyVk1-O6erQMXVrq0tK_sXAewrno6aWc_xukDohNXM,1808
+opentf_tools_nightly-0.42.0.dev446.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+opentf_tools_nightly-0.42.0.dev446.dist-info/entry_points.txt,sha256=u5qYtmUbgIMcq8360YobnI9CtDvrjptf4lDkmKojoa0,139
+opentf_tools_nightly-0.42.0.dev446.dist-info/top_level.txt,sha256=_gPuE6GTT6UNXy1DjtmQSfCcZb_qYA2vWmjg7a30AGk,7
+opentf_tools_nightly-0.42.0.dev446.dist-info/RECORD,,
```

