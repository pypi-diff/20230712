# Comparing `tmp/pyflyby-1.8.4.tar.gz` & `tmp/pyflyby-1.8.5.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "pyflyby-1.8.4.tar", last modified: Mon Apr 17 15:56:26 2023, max compression
+gzip compressed data, was "pyflyby-1.8.5.tar", last modified: Wed Jul 12 07:07:53 2023, max compression
```

## Comparing `pyflyby-1.8.4.tar` & `pyflyby-1.8.5.tar`

### file list

```diff
@@ -1,164 +1,164 @@
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.717385 pyflyby-1.8.4/
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     2965 2021-09-24 06:20:21.000000 pyflyby-1.8.4/.pyflyby
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     1188 2021-09-24 06:20:21.000000 pyflyby-1.8.4/LICENSE.txt
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      520 2022-05-19 08:06:52.000000 pyflyby-1.8.4/MANIFEST.in
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    14760 2023-04-17 15:56:26.716517 pyflyby-1.8.4/PKG-INFO
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    13790 2022-09-09 06:09:39.000000 pyflyby-1.8.4/README.rst
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.555001 pyflyby-1.8.4/bin/
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)     2441 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/autoipython
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)      207 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/autopython
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)     2966 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/collect-exports
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)     2206 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/collect-imports
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)      238 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/create-imports
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)     1035 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/find-import
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)     1130 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/list-bad-xrefs
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)      926 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/prune-broken-imports
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)     1079 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/py
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.597056 pyflyby-1.8.4/bin/pyflyby/
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     2712 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/pyflyby/__init__.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      296 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/pyflyby/__main__.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    82494 2022-09-30 05:55:12.000000 pyflyby-1.8.4/bin/pyflyby/_autoimp.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    20614 2023-02-27 05:52:44.000000 pyflyby-1.8.4/bin/pyflyby/_cmdline.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     4536 2022-09-09 06:09:39.000000 pyflyby-1.8.4/bin/pyflyby/_comms.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    46185 2022-10-12 05:57:20.000000 pyflyby-1.8.4/bin/pyflyby/_dbg.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    14280 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/pyflyby/_docxref.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    22927 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/pyflyby/_file.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     7455 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/pyflyby/_flags.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     6733 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/pyflyby/_format.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     7829 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/pyflyby/_idents.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    21860 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/pyflyby/_importclns.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    23556 2022-05-19 08:06:52.000000 pyflyby-1.8.4/bin/pyflyby/_importdb.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    23605 2023-02-27 05:52:44.000000 pyflyby-1.8.4/bin/pyflyby/_imports2s.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    17624 2023-02-27 05:52:44.000000 pyflyby-1.8.4/bin/pyflyby/_importstmt.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)   104335 2023-02-27 05:52:44.000000 pyflyby-1.8.4/bin/pyflyby/_interactive.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    30111 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/pyflyby/_livepatch.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     7915 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/pyflyby/_log.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    15691 2023-04-17 07:36:28.000000 pyflyby-1.8.4/bin/pyflyby/_modules.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    56300 2022-10-12 05:57:20.000000 pyflyby-1.8.4/bin/pyflyby/_parse.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    78092 2023-04-17 15:51:46.000000 pyflyby-1.8.4/bin/pyflyby/_py.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    15506 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/pyflyby/_util.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      266 2023-04-17 15:52:22.000000 pyflyby-1.8.4/bin/pyflyby/_version.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      591 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/pyflyby/autoimport.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      600 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/pyflyby/importdb.py
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)      938 2022-05-19 08:06:52.000000 pyflyby-1.8.4/bin/pyflyby-diff
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)      755 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/reformat-imports
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)      978 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/replace-star-imports
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)     7855 2022-09-09 06:09:39.000000 pyflyby-1.8.4/bin/tidy-imports
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)     1515 2021-09-24 06:20:21.000000 pyflyby-1.8.4/bin/transform-imports
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.605903 pyflyby-1.8.4/doc/
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     1188 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/LICENSE.txt
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      855 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/Makefile
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     5686 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/TODO.txt
--rw-rw-r--   0 ojha     (15539) ojha     (15539)        0 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/__init__.py
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.627192 pyflyby-1.8.4/doc/api/
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      275 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/api.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       78 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/autoimp.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       78 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/cmdline.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       72 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/comms.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       66 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/dbg.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       69 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/file.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      123 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/flags.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       75 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/format.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      109 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/idents.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       86 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/importclns.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       80 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/importdb.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       83 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/imports2s.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       86 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/importstmt.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       89 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/interactive.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       83 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/livepatch.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       65 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/log.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       77 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/modules.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       71 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/parse.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       62 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/py.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       68 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/api/util.rst
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.640474 pyflyby-1.8.4/doc/cli/
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      102 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/cli/autoipython.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      273 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/cli/cli.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       85 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/cli/collect_exports.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       85 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/cli/collect_imports.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       73 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/cli/find_import.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      100 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/cli/prune_broken_imports.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       46 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/cli/py.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       76 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/cli/pyflyby_diff.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       84 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/cli/reformat_imports.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      100 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/cli/replace_star_imports.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       76 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/cli/tidy_imports.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       91 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/cli/transform_imports.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     1057 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/conf.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      201 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/index.rst
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      760 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/make.bat
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      186 2021-09-24 06:20:21.000000 pyflyby-1.8.4/doc/testing.txt
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.524656 pyflyby-1.8.4/etc/
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.648295 pyflyby-1.8.4/etc/pyflyby/
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      270 2021-09-24 06:20:21.000000 pyflyby-1.8.4/etc/pyflyby/canonical.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      569 2021-09-24 06:20:21.000000 pyflyby-1.8.4/etc/pyflyby/common.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      369 2021-09-24 06:20:21.000000 pyflyby-1.8.4/etc/pyflyby/forget.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      352 2021-09-24 06:20:21.000000 pyflyby-1.8.4/etc/pyflyby/mandatory.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    10469 2023-04-17 07:36:28.000000 pyflyby-1.8.4/etc/pyflyby/numpy.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    17409 2022-05-19 08:06:52.000000 pyflyby-1.8.4/etc/pyflyby/std.py
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.526455 pyflyby-1.8.4/lib/
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.649700 pyflyby-1.8.4/lib/emacs/
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     4122 2021-09-24 06:20:21.000000 pyflyby-1.8.4/lib/emacs/pyflyby.el
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.527953 pyflyby-1.8.4/lib/python/
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.673311 pyflyby-1.8.4/lib/python/pyflyby/
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     2712 2021-09-24 06:20:21.000000 pyflyby-1.8.4/lib/python/pyflyby/__init__.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      296 2021-09-24 06:20:21.000000 pyflyby-1.8.4/lib/python/pyflyby/__main__.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    82494 2022-09-30 05:55:12.000000 pyflyby-1.8.4/lib/python/pyflyby/_autoimp.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    20614 2023-02-27 05:52:44.000000 pyflyby-1.8.4/lib/python/pyflyby/_cmdline.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     4536 2022-09-09 06:09:39.000000 pyflyby-1.8.4/lib/python/pyflyby/_comms.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    46185 2022-10-12 05:57:20.000000 pyflyby-1.8.4/lib/python/pyflyby/_dbg.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    14280 2021-09-24 06:20:21.000000 pyflyby-1.8.4/lib/python/pyflyby/_docxref.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    22927 2021-09-24 06:20:21.000000 pyflyby-1.8.4/lib/python/pyflyby/_file.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     7455 2021-09-24 06:20:21.000000 pyflyby-1.8.4/lib/python/pyflyby/_flags.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     6733 2021-09-24 06:20:21.000000 pyflyby-1.8.4/lib/python/pyflyby/_format.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     7829 2021-09-24 06:20:21.000000 pyflyby-1.8.4/lib/python/pyflyby/_idents.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    21860 2021-09-24 06:20:21.000000 pyflyby-1.8.4/lib/python/pyflyby/_importclns.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    23556 2022-05-19 08:06:52.000000 pyflyby-1.8.4/lib/python/pyflyby/_importdb.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    23605 2023-02-27 05:52:44.000000 pyflyby-1.8.4/lib/python/pyflyby/_imports2s.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    17624 2023-02-27 05:52:44.000000 pyflyby-1.8.4/lib/python/pyflyby/_importstmt.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)   104335 2023-02-27 05:52:44.000000 pyflyby-1.8.4/lib/python/pyflyby/_interactive.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    30111 2021-09-24 06:20:21.000000 pyflyby-1.8.4/lib/python/pyflyby/_livepatch.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     7915 2021-09-24 06:20:21.000000 pyflyby-1.8.4/lib/python/pyflyby/_log.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    15691 2023-04-17 07:36:28.000000 pyflyby-1.8.4/lib/python/pyflyby/_modules.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    56300 2022-10-12 05:57:20.000000 pyflyby-1.8.4/lib/python/pyflyby/_parse.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    78092 2023-04-17 15:51:46.000000 pyflyby-1.8.4/lib/python/pyflyby/_py.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    15506 2021-09-24 06:20:21.000000 pyflyby-1.8.4/lib/python/pyflyby/_util.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      266 2023-04-17 15:52:22.000000 pyflyby-1.8.4/lib/python/pyflyby/_version.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      591 2021-09-24 06:20:21.000000 pyflyby-1.8.4/lib/python/pyflyby/autoimport.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      600 2021-09-24 06:20:21.000000 pyflyby-1.8.4/lib/python/pyflyby/importdb.py
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.681711 pyflyby-1.8.4/lib/python/pyflyby.egg-info/
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    14760 2023-04-17 15:56:25.000000 pyflyby-1.8.4/lib/python/pyflyby.egg-info/PKG-INFO
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     3410 2023-04-17 15:56:26.000000 pyflyby-1.8.4/lib/python/pyflyby.egg-info/SOURCES.txt
--rw-rw-r--   0 ojha     (15539) ojha     (15539)        1 2023-04-17 15:56:25.000000 pyflyby-1.8.4/lib/python/pyflyby.egg-info/dependency_links.txt
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       69 2023-04-17 15:56:25.000000 pyflyby-1.8.4/lib/python/pyflyby.egg-info/entry_points.txt
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       42 2023-04-17 15:56:25.000000 pyflyby-1.8.4/lib/python/pyflyby.egg-info/requires.txt
--rw-rw-r--   0 ojha     (15539) ojha     (15539)        8 2023-04-17 15:56:26.000000 pyflyby-1.8.4/lib/python/pyflyby.egg-info/top_level.txt
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.529128 pyflyby-1.8.4/libexec/
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.684120 pyflyby-1.8.4/libexec/pyflyby/
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)      938 2022-05-19 08:06:52.000000 pyflyby-1.8.4/libexec/pyflyby/colordiff
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)     5643 2021-09-24 06:20:21.000000 pyflyby-1.8.4/libexec/pyflyby/diff-colorize
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       38 2023-04-17 15:56:26.717582 pyflyby-1.8.4/setup.cfg
--rwxrwxr-x   0 ojha     (15539) ojha     (15539)     7941 2022-09-09 06:09:39.000000 pyflyby-1.8.4/setup.py
-drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-04-17 15:56:26.715338 pyflyby-1.8.4/tests/
--rw-rw-r--   0 ojha     (15539) ojha     (15539)       66 2021-09-24 06:20:21.000000 pyflyby-1.8.4/tests/__init__.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     2142 2021-09-24 06:20:21.000000 pyflyby-1.8.4/tests/test_0testconfig.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    59984 2023-04-17 07:36:28.000000 pyflyby-1.8.4/tests/test_autoimp.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    20380 2022-05-19 08:06:52.000000 pyflyby-1.8.4/tests/test_cmdline.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     2520 2021-09-24 06:20:21.000000 pyflyby-1.8.4/tests/test_docxref.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    10550 2021-09-24 06:20:21.000000 pyflyby-1.8.4/tests/test_file.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     5026 2021-09-24 06:20:21.000000 pyflyby-1.8.4/tests/test_flags.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     4238 2021-09-24 06:20:21.000000 pyflyby-1.8.4/tests/test_format.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     2831 2021-09-24 06:20:21.000000 pyflyby-1.8.4/tests/test_idents.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     8006 2021-09-24 06:20:21.000000 pyflyby-1.8.4/tests/test_importclns.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     7256 2021-09-24 06:20:21.000000 pyflyby-1.8.4/tests/test_importdb.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    29623 2023-02-27 05:52:44.000000 pyflyby-1.8.4/tests/test_imports2s.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     7332 2021-09-24 06:20:21.000000 pyflyby-1.8.4/tests/test_importstmt.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)   156373 2023-02-27 05:52:44.000000 pyflyby-1.8.4/tests/test_interactive.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     1397 2022-05-19 08:06:52.000000 pyflyby-1.8.4/tests/test_jupyterlab_pyflyby.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    77476 2022-05-19 08:06:52.000000 pyflyby-1.8.4/tests/test_livepatch.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     2682 2022-05-19 08:06:52.000000 pyflyby-1.8.4/tests/test_modules.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    46716 2022-10-12 05:57:20.000000 pyflyby-1.8.4/tests/test_parse.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)    81076 2023-04-17 07:36:28.000000 pyflyby-1.8.4/tests/test_py.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)      857 2021-09-24 06:20:21.000000 pyflyby-1.8.4/tests/test_util.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     1851 2021-09-24 06:20:21.000000 pyflyby-1.8.4/tests/xrefs.py
--rw-rw-r--   0 ojha     (15539) ojha     (15539)     1890 2021-09-24 06:20:21.000000 pyflyby-1.8.4/tox.ini
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.864849 pyflyby-1.8.5/
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     2965 2021-09-24 06:20:21.000000 pyflyby-1.8.5/.pyflyby
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     1188 2021-09-24 06:20:21.000000 pyflyby-1.8.5/LICENSE.txt
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      520 2022-05-19 08:06:52.000000 pyflyby-1.8.5/MANIFEST.in
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    14752 2023-07-12 07:07:53.864310 pyflyby-1.8.5/PKG-INFO
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    13783 2023-06-06 10:10:16.000000 pyflyby-1.8.5/README.rst
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.732435 pyflyby-1.8.5/bin/
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)     2338 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/autoipython
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)      207 2021-09-24 06:20:21.000000 pyflyby-1.8.5/bin/autopython
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)     2863 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/collect-exports
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)     2141 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/collect-imports
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)      238 2021-09-24 06:20:21.000000 pyflyby-1.8.5/bin/create-imports
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)      932 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/find-import
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)     1027 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/list-bad-xrefs
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)      861 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/prune-broken-imports
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)     1014 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/py
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.750775 pyflyby-1.8.5/bin/pyflyby/
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     2606 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/__init__.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      190 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/__main__.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    80271 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_autoimp.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    20317 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_cmdline.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     4471 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_comms.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    45705 2023-07-12 07:00:39.000000 pyflyby-1.8.5/bin/pyflyby/_dbg.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    14173 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_docxref.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    22822 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_file.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     7059 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_flags.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     6627 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_format.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     7012 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_idents.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    21754 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_importclns.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    23639 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_importdb.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    23499 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_imports2s.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    17061 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_importstmt.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)   103173 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_interactive.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    29390 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_livepatch.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     6547 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_log.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    15593 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_modules.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    55121 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_parse.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    77724 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_py.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    14360 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/_util.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      160 2023-07-12 07:01:56.000000 pyflyby-1.8.5/bin/pyflyby/_version.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      485 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/autoimport.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      494 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/pyflyby/importdb.py
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)      938 2022-05-19 08:06:52.000000 pyflyby-1.8.5/bin/pyflyby-diff
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)      690 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/reformat-imports
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)      913 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/replace-star-imports
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)     6169 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/tidy-imports
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)     1450 2023-06-06 10:10:16.000000 pyflyby-1.8.5/bin/transform-imports
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.756713 pyflyby-1.8.5/doc/
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     1188 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/LICENSE.txt
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      855 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/Makefile
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     5622 2023-06-06 10:10:16.000000 pyflyby-1.8.5/doc/TODO.txt
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)        0 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/__init__.py
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.773211 pyflyby-1.8.5/doc/api/
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      275 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/api.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       78 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/autoimp.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       78 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/cmdline.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       72 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/comms.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       66 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/dbg.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       69 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/file.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      123 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/flags.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       75 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/format.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      109 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/idents.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       86 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/importclns.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       80 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/importdb.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       83 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/imports2s.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       86 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/importstmt.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       89 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/interactive.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       83 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/livepatch.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       65 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/log.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       77 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/modules.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       71 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/parse.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       62 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/py.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       68 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/api/util.rst
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.785481 pyflyby-1.8.5/doc/cli/
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      102 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/cli/autoipython.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      273 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/cli/cli.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       85 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/cli/collect_exports.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       85 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/cli/collect_imports.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       73 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/cli/find_import.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      100 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/cli/prune_broken_imports.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       46 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/cli/py.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       76 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/cli/pyflyby_diff.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       84 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/cli/reformat_imports.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      100 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/cli/replace_star_imports.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       76 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/cli/tidy_imports.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       91 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/cli/transform_imports.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     1057 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/conf.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      201 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/index.rst
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      760 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/make.bat
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      186 2021-09-24 06:20:21.000000 pyflyby-1.8.5/doc/testing.txt
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.713932 pyflyby-1.8.5/etc/
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.790656 pyflyby-1.8.5/etc/pyflyby/
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      270 2021-09-24 06:20:21.000000 pyflyby-1.8.5/etc/pyflyby/canonical.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      569 2021-09-24 06:20:21.000000 pyflyby-1.8.5/etc/pyflyby/common.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      369 2021-09-24 06:20:21.000000 pyflyby-1.8.5/etc/pyflyby/forget.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      352 2021-09-24 06:20:21.000000 pyflyby-1.8.5/etc/pyflyby/mandatory.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    10469 2023-04-17 07:36:28.000000 pyflyby-1.8.5/etc/pyflyby/numpy.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    17596 2023-06-06 10:10:16.000000 pyflyby-1.8.5/etc/pyflyby/std.py
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.715556 pyflyby-1.8.5/lib/
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.791157 pyflyby-1.8.5/lib/emacs/
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     4122 2021-09-24 06:20:21.000000 pyflyby-1.8.5/lib/emacs/pyflyby.el
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.716512 pyflyby-1.8.5/lib/python/
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.828390 pyflyby-1.8.5/lib/python/pyflyby/
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     2606 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/__init__.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      190 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/__main__.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    80271 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_autoimp.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    20317 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_cmdline.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     4471 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_comms.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    45705 2023-07-12 07:00:39.000000 pyflyby-1.8.5/lib/python/pyflyby/_dbg.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    14173 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_docxref.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    22822 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_file.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     7059 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_flags.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     6627 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_format.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     7012 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_idents.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    21754 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_importclns.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    23639 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_importdb.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    23499 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_imports2s.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    17061 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_importstmt.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)   103173 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_interactive.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    29390 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_livepatch.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     6547 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_log.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    15593 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_modules.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    55121 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_parse.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    77724 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_py.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    14360 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/_util.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      160 2023-07-12 07:01:56.000000 pyflyby-1.8.5/lib/python/pyflyby/_version.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      485 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/autoimport.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      494 2023-06-06 10:10:16.000000 pyflyby-1.8.5/lib/python/pyflyby/importdb.py
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.832840 pyflyby-1.8.5/lib/python/pyflyby.egg-info/
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    14752 2023-07-12 07:07:52.000000 pyflyby-1.8.5/lib/python/pyflyby.egg-info/PKG-INFO
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     3410 2023-07-12 07:07:53.000000 pyflyby-1.8.5/lib/python/pyflyby.egg-info/SOURCES.txt
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)        1 2023-07-12 07:07:52.000000 pyflyby-1.8.5/lib/python/pyflyby.egg-info/dependency_links.txt
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       69 2023-07-12 07:07:52.000000 pyflyby-1.8.5/lib/python/pyflyby.egg-info/entry_points.txt
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       42 2023-07-12 07:07:52.000000 pyflyby-1.8.5/lib/python/pyflyby.egg-info/requires.txt
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)        8 2023-07-12 07:07:52.000000 pyflyby-1.8.5/lib/python/pyflyby.egg-info/top_level.txt
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.717336 pyflyby-1.8.5/libexec/
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.833895 pyflyby-1.8.5/libexec/pyflyby/
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)      938 2022-05-19 08:06:52.000000 pyflyby-1.8.5/libexec/pyflyby/colordiff
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)     5578 2023-06-06 10:10:16.000000 pyflyby-1.8.5/libexec/pyflyby/diff-colorize
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)       38 2023-07-12 07:07:53.865081 pyflyby-1.8.5/setup.cfg
+-rwxrwxr-x   0 ojha     (15539) ojha     (15539)     7834 2023-06-06 10:10:16.000000 pyflyby-1.8.5/setup.py
+drwxrwsr-x   0 ojha     (15539) ojha     (15539)        0 2023-07-12 07:07:53.863380 pyflyby-1.8.5/tests/
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)        1 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/__init__.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     2036 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_0testconfig.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    57372 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_autoimp.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    18875 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_cmdline.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     2278 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_docxref.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    10444 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_file.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     4457 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_flags.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     4132 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_format.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     2631 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_idents.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     7900 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_importclns.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     7150 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_importdb.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    28832 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_imports2s.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     7226 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_importstmt.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)   150219 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_interactive.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     1397 2022-05-19 08:06:52.000000 pyflyby-1.8.5/tests/test_jupyterlab_pyflyby.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    71447 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_livepatch.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     2576 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_modules.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    42471 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_parse.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)    74115 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_py.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)      751 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/test_util.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     1745 2023-06-06 10:10:16.000000 pyflyby-1.8.5/tests/xrefs.py
+-rw-rw-r--   0 ojha     (15539) ojha     (15539)     1890 2021-09-24 06:20:21.000000 pyflyby-1.8.5/tox.ini
```

### Comparing `pyflyby-1.8.4/.pyflyby` & `pyflyby-1.8.5/.pyflyby`

 * *Files identical despite different names*

### Comparing `pyflyby-1.8.4/LICENSE.txt` & `pyflyby-1.8.5/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `pyflyby-1.8.4/MANIFEST.in` & `pyflyby-1.8.5/MANIFEST.in`

 * *Files identical despite different names*

### Comparing `pyflyby-1.8.4/PKG-INFO` & `pyflyby-1.8.5/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: pyflyby
-Version: 1.8.4
+Version: 1.8.5
 Summary: pyflyby - Python development productivity tools, in particular automatic import management
 Home-page: https://pypi.org/project/pyflyby/
 Author: Karl Chen
 Author-email: quarl@8166.clguba.z.quarl.org
 License: MIT
 Project-URL: Documentation, https://deshaw.github.io/pyflyby/
 Project-URL: Source, https://github.com/deshaw/pyflyby
@@ -12,28 +12,28 @@
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Topic :: Software Development
 Classifier: Topic :: Software Development :: Code Generators
 Classifier: Topic :: Software Development :: Interpreters
 Classifier: Intended Audience :: Developers
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Programming Language :: Python
-Requires-Python: >=2.5, !=3.0.*, !=3.1.*, !=3.2.*, !=3.2.*, !=3.3.*, !=3.4.*, !=3.5.*, !=3.6.*, <4
+Requires-Python: >3.0, !=3.0.*, !=3.1.*, !=3.2.*, !=3.2.*, !=3.3.*, !=3.4.*, !=3.5.*, !=3.6.*, <4
 License-File: LICENSE.txt
 
 #########
  Pyflyby
 #########
 
 .. image:: https://badge.fury.io/py/pyflyby.svg
    :target: https://pypi.org/project/pyflyby/
 
 .. image:: https://travis-ci.org/deshaw/pyflyby.png?branch=master
    :target: https://travis-ci.org/deshaw/pyflyby
 
-Pyflyby is a set of Python programming productivity tools for Python 2.7 and 3.7+.
+Pyflyby is a set of Python programming productivity tools for Python 3.7+.
 
 For command-line interaction:
   * ``py``: command-line multitool
 
 For IPython interaction:
   * ``autoimporter``: automatically imports symbols when needed.
 
@@ -253,15 +253,15 @@
 answer if either x or T is a proxy object.
 
 
 Compatibility
 -------------
 
 Tested with:
-  - Python 2.6, 2.7, 3.7, 3.8
+  - Python 3.7, 3.8, 3.9, 3.10
   - IPython 0.10, 0.11, 0.12, 0.13, 1.0, 1.2, 2.0, 2.1, 2.2, 2.3, 2.4, 3.0,
     3.1, 3.2, 4.0., 7.11 (latest)
   - IPython (text console), IPython Notebook, Spyder
 
 
 Details: import libraries
 =========================
```

### Comparing `pyflyby-1.8.4/README.rst` & `pyflyby-1.8.5/README.rst`

 * *Files 1% similar despite different names*

```diff
@@ -4,15 +4,15 @@
 
 .. image:: https://badge.fury.io/py/pyflyby.svg
    :target: https://pypi.org/project/pyflyby/
 
 .. image:: https://travis-ci.org/deshaw/pyflyby.png?branch=master
    :target: https://travis-ci.org/deshaw/pyflyby
 
-Pyflyby is a set of Python programming productivity tools for Python 2.7 and 3.7+.
+Pyflyby is a set of Python programming productivity tools for Python 3.7+.
 
 For command-line interaction:
   * ``py``: command-line multitool
 
 For IPython interaction:
   * ``autoimporter``: automatically imports symbols when needed.
 
@@ -232,15 +232,15 @@
 answer if either x or T is a proxy object.
 
 
 Compatibility
 -------------
 
 Tested with:
-  - Python 2.6, 2.7, 3.7, 3.8
+  - Python 3.7, 3.8, 3.9, 3.10
   - IPython 0.10, 0.11, 0.12, 0.13, 1.0, 1.2, 2.0, 2.1, 2.2, 2.3, 2.4, 3.0,
     3.1, 3.2, 4.0., 7.11 (latest)
   - IPython (text console), IPython Notebook, Spyder
 
 
 Details: import libraries
 =========================
```

### Comparing `pyflyby-1.8.4/bin/autoipython` & `pyflyby-1.8.5/bin/autoipython`

 * *Files 12% similar despite different names*

```diff
@@ -36,16 +36,14 @@
 
 """
 
 # pyflyby/autoipython
 # Copyright (C) 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import absolute_import, division, with_statement
-from __future__ import print_function
 
 import sys
 
 from   pyflyby._cmdline         import maindoc, print_version_and_exit
 from   pyflyby._interactive     import (install_in_ipython_config_file,
                                         start_ipython_with_autoimporter)
```

### Comparing `pyflyby-1.8.4/bin/collect-exports` & `pyflyby-1.8.5/bin/collect-exports`

 * *Files 12% similar despite different names*

```diff
@@ -10,16 +10,14 @@
 """
 
 # pyflyby/collect-exports
 # Copyright (C) 2011, 2012, 2013, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
 
-from __future__ import absolute_import, division, with_statement
-from __future__ import print_function
 
 import sys
 
 from   pyflyby._cmdline         import hfmt, parse_args
 from   pyflyby._importdb        import ImportDB
 from   pyflyby._log             import logger
 from   pyflyby._modules         import ModuleHandle
```

### Comparing `pyflyby-1.8.4/bin/collect-imports` & `pyflyby-1.8.5/bin/collect-imports`

 * *Files 3% similar despite different names*

```diff
@@ -7,15 +7,14 @@
 block of import statements.  Print the result to stdout.
 
 """
 # pyflyby/collect-imports
 # Copyright (C) 2011, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import absolute_import, division, with_statement
 
 import re
 import sys
 
 from   pyflyby._cmdline         import filename_args, hfmt, parse_args
 from   pyflyby._importclns      import ImportSet
 from   pyflyby._importdb        import ImportDB
```

### Comparing `pyflyby-1.8.4/bin/find-import` & `pyflyby-1.8.5/bin/find-import`

 * *Files 9% similar despite different names*

```diff
@@ -4,16 +4,14 @@
 
 Prints how to import given name(s).
 """
 # pyflyby/find-import
 # Copyright (C) 2011, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import absolute_import, division, with_statement
-from __future__ import print_function
 
 from   pyflyby._cmdline         import parse_args, syntax
 from   pyflyby._importdb        import ImportDB
 from   pyflyby._log             import logger
 
 
 def main():
```

### Comparing `pyflyby-1.8.4/bin/prune-broken-imports` & `pyflyby-1.8.5/bin/prune-broken-imports`

 * *Files 8% similar despite different names*

```diff
@@ -13,15 +13,14 @@
 Only top-level import statements are touched.
 
 """
 # pyflyby/prune-broken-imports
 # Copyright (C) 2012, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import absolute_import, division, with_statement
 
 from   pyflyby._cmdline         import parse_args, process_actions
 from   pyflyby._imports2s       import remove_broken_imports
 
 
 def main():
     options, args = parse_args(
```

### Comparing `pyflyby-1.8.4/bin/py` & `pyflyby-1.8.5/bin/py`

 * *Files 14% similar despite different names*

```diff
@@ -8,15 +8,14 @@
 """
 py -- see pyflyby._py.__doc__
 
 This file is only used when pyflyby is not installed by setup.py.
 When installed by setup.py, we use the pkg_resources entry_point mechanism.
 """
 
-from __future__ import absolute_import, division, with_statement
 
 # TODO: generate this script and others from a template.
 
 import os
 import sys
 
 # Use the lib dir, and remove the bin dir from $PATH.
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/__init__.py` & `pyflyby-1.8.5/bin/pyflyby/__init__.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/__init__.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   pyflyby._autoimp         import (auto_eval, auto_import,
                                         find_missing_imports)
 from   pyflyby._dbg             import (add_debug_functions_to_builtins,
                                         attach_debugger, debug_on_exception,
                                         debug_statement, debugger,
                                         enable_exception_handler_debugger,
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_autoimp.py` & `pyflyby-1.8.5/bin/pyflyby/_autoimp.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,29 +1,23 @@
 # pyflyby/_autoimp.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018, 2019 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import ast
 import contextlib
 import copy
 import six
-from   six                      import PY2, PY3, exec_, reraise
+from   six                      import exec_, reraise
 from   six.moves                import builtins
 import sys
 import types
 
-if PY3:
-    from collections.abc import Sequence
-else:
-    # This is deprecated in Python 3
-    from collections import Sequence
-
+from collections.abc import Sequence
 
 from   pyflyby._file            import FileText, Filename
 from   pyflyby._flags           import CompilerFlags
 from   pyflyby._idents          import (BadDottedIdentifierError,
                                         DottedIdentifier, brace_identifiers)
 from   pyflyby._importdb        import ImportDB
 from   pyflyby._importstmt      import Import
@@ -580,60 +574,54 @@
                 logger.warning("Don't know how to handle __all__ with list elements other than str")
                 return
             for e in node.value.elts:
                 self._visit_Load_defered_global(e.s)
 
     def visit_ClassDef(self, node):
         logger.debug("visit_ClassDef(%r)", node)
-        if PY3:
-            assert node._fields == ('name', 'bases', 'keywords', 'body', 'decorator_list')
-        else:
-            assert node._fields == ('name', 'bases', 'body', 'decorator_list')
+        assert node._fields == ('name', 'bases', 'keywords', 'body', 'decorator_list')
         self.visit(node.bases)
         self.visit(node.decorator_list)
         # The class's name is only visible to others (not to the body to the
         # class), but is accessible in the methods themselves. See https://github.com/deshaw/pyflyby/issues/147
-        if PY3:
-            self.visit(node.keywords)
+        self.visit(node.keywords)
 
         # we only care about the first defined class,
         # we don't detect issues with nested classes.
         if self._in_class_def == 0:
             self.scopestack._class_delayed[node.name] = None
         with self._NewScopeCtx(new_class_scope=True):
             if not self._in_class_def:
                 self._in_class_def += 1
                 self._visit_Store(node.name)
             self.visit(node.body)
             self._in_class_def -= 1
+        self._remove_from_missing_imports(node.name)
         self._visit_Store(node.name)
 
     def visit_AsyncFunctionDef(self, node):
         return self.visit_FunctionDef(node)
 
     def visit_FunctionDef(self, node):
         # Visit a function definition.
         #   - Visit args and decorator list normally.
         #   - Visit function body in a special mode where we defer checking
         #     loads until later, and don't load names from the parent ClassDef
         #     scope.
         #   - Store the name in the current scope (but not visibly to
         #     args/decorator_list).
-        if PY2:
-            assert node._fields == ('name', 'args', 'body', 'decorator_list'), node._fields
-        elif sys.version_info >= (3, 8):
+        if sys.version_info >= (3, 8):
             assert node._fields == ('name', 'args', 'body', 'decorator_list', 'returns', 'type_comment'), node._fields
         else:
             assert node._fields == ('name', 'args', 'body', 'decorator_list', 'returns'), node._fields
         with self._NewScopeCtx(include_class_scopes=True):
             self.visit(node.args)
             self.visit(node.decorator_list)
-            if PY3:
-                if node.returns:
-                    self.visit(node.returns)
+            if node.returns:
+                self.visit(node.returns)
             if sys.version_info >= (3, 8):
                 self._visit_typecomment(node.type_comment)
             old_in_FunctionDef = self._in_FunctionDef
             self._in_FunctionDef = True
             with self._NewScopeCtx(unhide_classdef=True):
                 if not self._in_class_def:
                     self._visit_Store(node.name)
@@ -679,17 +667,15 @@
             node = ast.parse(typecomment, mode='func_type')
         else:
             node = ast.parse(typecomment)
 
         self.visit(node)
 
     def visit_arguments(self, node):
-        if PY2:
-            assert node._fields == ('args', 'vararg', 'kwarg', 'defaults'), node._fields
-        elif sys.version_info >= (3, 8):
+        if sys.version_info >= (3, 8):
             assert node._fields == ('posonlyargs', 'args', 'vararg', 'kwonlyargs', 'kw_defaults', 'kwarg', 'defaults'), node._fields
         else:
             assert node._fields == ('args', 'vararg', 'kwonlyargs', 'kw_defaults', 'kwarg', 'defaults'), node._fields
         # Argument/parameter list.  Note that the defaults should be
         # considered "Load"s from the upper scope, and the argument names are
         # "Store"s in the function scope.
 
@@ -697,45 +683,38 @@
         #    def f(x=y, y=x): pass
         # Both x and y should be considered undefined (unless they were indeed
         # defined before the def).
         # We assume visit_arguments is always called from a _NewScopeCtx
         # context
         with self._UpScopeCtx():
             self.visit(node.defaults)
-            if PY3:
-                for i in node.kw_defaults:
-                    if i:
-                        self.visit(i)
+            for i in node.kw_defaults:
+                if i:
+                    self.visit(i)
         # Store arg names.
         self.visit(node.args)
-        if PY3:
-            self.visit(node.kwonlyargs)
+        self.visit(node.kwonlyargs)
         if sys.version_info >= (3, 8):
             self.visit(node.posonlyargs)
         # may be None.
-        if node.vararg and PY3:
+        if node.vararg:
             self.visit(node.vararg)
         else:
             self._visit_Store(node.vararg)
-        if node.kwarg and PY3:
+        if node.kwarg:
             self.visit(node.kwarg)
         else:
             self._visit_Store(node.kwarg)
 
     def visit_ExceptHandler(self, node):
         assert node._fields == ('type', 'name', 'body')
         if node.type:
             self.visit(node.type)
         if node.name:
-            # ExceptHandler.name is a string in Python 3 and a Name with Store in
-            # Python 2
-            if PY3:
-                self._visit_Store(node.name)
-            else:
-                self.visit(node.name)
+            self._visit_Store(node.name)
         self.visit(node.body)
 
     def visit_Dict(self, node):
         assert node._fields == ('keys', 'values')
         # In Python 3, keys can be None, indicating a ** expression
         for key in node.keys:
             if key:
@@ -767,47 +746,43 @@
         # visit the comprehension node(s) before the elt node.
         # (generic_visit() would visit the elt first, because that comes first
         # in ListComp._fields).
         # For Python2, we intentionally don't enter a new scope here, because
         # a list comprehensive _does_ leak variables out of its scope (unlike
         # generator expressions).
         # For Python3, we do need to enter a new scope here.
-        if PY3:
-            with self._NewScopeCtx(include_class_scopes=True):
-                self.visit(node.generators)
-                self.visit(node.elt)
-        else:
+        with self._NewScopeCtx(include_class_scopes=True):
             self.visit(node.generators)
             self.visit(node.elt)
 
     def visit_DictComp(self, node):
         # Visit a dict comprehension node.
         # This is similar to the generic visit, except:
         #  - We visit the comprehension node(s) before the elt node.
         #  - We create a new scope for the variables.
-        # We do enter a new scope (for both py2 and py3).  A dict comprehension
+        # We do enter a new scope.  A dict comprehension
         # does _not_ leak variables out of its scope (unlike py2 list
         # comprehensions).
         with self._NewScopeCtx(include_class_scopes=True):
             self.visit(node.generators)
             self.visit(node.key)
             self.visit(node.value)
 
     def visit_SetComp(self, node):
         # Visit a set comprehension node.
-        # We do enter a new scope (for both py2 and py3).  A set comprehension
+        # We do enter a new scope.  A set comprehension
         # does _not_ leak variables out of its scope (unlike py2 list
         # comprehensions).
         with self._NewScopeCtx(include_class_scopes=True):
             self.visit(node.generators)
             self.visit(node.elt)
 
     def visit_GeneratorExp(self, node):
         # Visit a generator expression node.
-        # We do enter a new scope (for both py2 and py3).  A generator
+        # We do enter a new scope.  A generator
         # expression does _not_ leak variables out of its scope (unlike py2
         # list comprehensions).
         with self._NewScopeCtx(include_class_scopes=True):
             self.visit(node.generators)
             self.visit(node.elt)
 
     def visit_ImportFrom(self, node):
@@ -828,15 +803,14 @@
         self.generic_visit(node)
 
     def visit_Name(self, node):
         logger.debug("visit_Name(%r)", node.id)
         self._visit_fullname(node.id, node.ctx)
 
     def visit_arg(self, node):
-        assert not PY2
         if sys.version_info >= (3, 8):
             assert node._fields == ('arg', 'annotation', 'type_comment'), node._fields
         else:
             assert node._fields == ('arg', 'annotation'), node._fields
         if node.annotation:
             self.visit(node.annotation)
         # Treat it like a Name node would from Python 2
@@ -890,33 +864,51 @@
         self._visit_Store(name, value)
 
     def _visit_Store(self, fullname, value=None):
         logger.debug("_visit_Store(%r)", fullname)
         if fullname is None:
             return
         scope = self.scopestack[-1]
-        if PY3 and isinstance(fullname, ast.arg):
+        if isinstance(fullname, ast.arg):
             fullname = fullname.arg
         if self.unused_imports is not None:
             if fullname != '*':
                 # If we're storing "foo.bar.baz = 123", then "foo" and
                 # "foo.bar" have now been used and the import should not be
                 # removed.
                 for ancestor in DottedIdentifier(fullname).prefixes[:-1]:
                     if symbol_needs_import(ancestor, self.scopestack):
-                        m = (self._lineno, DottedIdentifier(fullname))
+                        m = (self._lineno, DottedIdentifier(fullname, scope_info=self._get_scope_info()))
                         if m not in self.missing_imports:
                             self.missing_imports.append(m)
             # If we're redefining something, and it has not been used, then
             # record it as unused.
             oldvalue = scope.get(fullname)
             if isinstance(oldvalue, _UseChecker) and not oldvalue.used:
                 self.unused_imports.append((oldvalue.lineno, oldvalue.source))
         scope[fullname] = value
 
+    def _remove_from_missing_imports(self, fullname):
+        for missing_import in self.missing_imports:
+            # If it was defined inside a class method, then it wouldn't have been added to
+            # the missing imports anyways.
+            # See the following tests:
+            # - tests.test_autoimp.test_method_reference_current_class
+            # - tests.test_autoimp.test_find_missing_imports_class_name_1
+            # - tests.test_autoimp.test_scan_for_import_issues_class_defined_after_use
+            inside_class = missing_import[1].scope_info.get('_in_class_def')
+            if missing_import[1].startswith(fullname) and not inside_class:
+                self.missing_imports.remove(missing_import)
+
+    def _get_scope_info(self):
+        return {
+            "scopestack": self.scopestack,
+            "_in_class_def": self._in_class_def,
+        }
+
     def visit_Delete(self, node):
         scope = self.scopestack[-1]
         for target in node.targets:
             if isinstance(target, ast.Name):
                 # 'del foo'
                 if target.id not in scope:
                     # 'del x' without 'x' in current scope.  Should we warn?
@@ -996,16 +988,15 @@
         Check if the symbol needs import.  (As a side effect, if the object
         is a _UseChecker, this will mark it as used.
 
         TODO: It would be
         better to refactor symbol_needs_import so that it just returns the
         object it found, and we mark it as used here.)
         """
-
-        fullname = DottedIdentifier(fullname)
+        fullname = DottedIdentifier(fullname, scope_info=self._get_scope_info())
         if symbol_needs_import(fullname, scopestack) and not scopestack.has_star_import():
             if (lineno, fullname) not in self.missing_imports:
                 self.missing_imports.append((lineno, fullname))
 
     def _finish_deferred_load_checks(self):
         for fullname, scopestack, lineno in self._deferred_load_checks:
             self._check_load(fullname, scopestack, lineno)
@@ -1143,15 +1134,15 @@
     if not isinstance(co, types.CodeType):
         raise TypeError(
             "_find_loads_without_stores_in_code(): expected a CodeType; got a %s"
             % (type(co).__name__,))
     # Initialize local constants for fast access.
     from opcode import HAVE_ARGUMENT, EXTENDED_ARG, opmap
     LOAD_ATTR    = opmap['LOAD_ATTR']
-    LOAD_METHOD = opmap['LOAD_METHOD'] if PY3 else None
+    LOAD_METHOD = opmap['LOAD_METHOD']
     LOAD_GLOBAL  = opmap['LOAD_GLOBAL']
     LOAD_NAME    = opmap['LOAD_NAME']
     STORE_ATTR   = opmap['STORE_ATTR']
     STORE_GLOBAL = opmap['STORE_GLOBAL']
     STORE_NAME   = opmap['STORE_NAME']
     # Keep track of the partial name so far that started with a LOAD_GLOBAL.
     # If ``pending`` is not None, then it is a list representing the name
@@ -1242,28 +1233,20 @@
     earliest_backjump_label = _find_earliest_backjump_label(bytecode)
     # Loop through bytecode.
     while i < n:
         c = bytecode[i]
         op = _op(c)
         i += 1
         if op >= HAVE_ARGUMENT:
-            if PY2:
-                oparg = _op(bytecode[i]) + _op(bytecode[i+1])*256 + extended_arg
-                extended_arg = 0
-                i = i+2
-                if op == EXTENDED_ARG:
-                    extended_arg = oparg*65536
-                    continue
-            else:
-                oparg = bytecode[i] | extended_arg
-                extended_arg = 0
-                if op == EXTENDED_ARG:
-                    extended_arg = (oparg << 8)
-                    continue
-                i += 1
+            oparg = bytecode[i] | extended_arg
+            extended_arg = 0
+            if op == EXTENDED_ARG:
+                extended_arg = (oparg << 8)
+                continue
+            i += 1
 
         if pending is not None:
             if op == STORE_ATTR:
                 # {LOAD_GLOBAL|LOAD_NAME} {LOAD_ATTR}* {STORE_ATTR}
                 pending.append(co.co_names[oparg])
                 fullname = ".".join(pending)
                 pending = None
@@ -1351,17 +1334,14 @@
     # Recurse on inner function definitions, lambdas, generators, etc.
     for arg in co.co_consts:
         if isinstance(arg, types.CodeType):
             _find_loads_without_stores_in_code(arg, loads_without_stores)
 
 
 def _op(c):
-    # bytecode is bytes in Python 3, which when indexed gives integers
-    if PY2:
-        return ord(c)
     return c
 
 
 def _find_earliest_backjump_label(bytecode):
     """
     Find the earliest target of a backward jump.
 
@@ -1374,52 +1354,14 @@
       ...         foo2()
       ...     else:
       ...         foo3()
       ...     foo4()
       ...     while foo5():  # L7
       ...         foo6()
 
-    In python 2.6, the disassembled bytecode is::
-
-      >>> import dis
-      >>> dis.dis(f) # doctest: +SKIP
-        2           0 LOAD_GLOBAL              0 (foo1)
-                    3 CALL_FUNCTION            0
-                    6 JUMP_IF_FALSE           11 (to 20)
-                    9 POP_TOP
-      <BLANKLINE>
-        3          10 LOAD_GLOBAL              1 (foo2)
-                   13 CALL_FUNCTION            0
-                   16 POP_TOP
-                   17 JUMP_FORWARD             8 (to 28)
-              >>   20 POP_TOP
-      <BLANKLINE>
-        5          21 LOAD_GLOBAL              2 (foo3)
-                   24 CALL_FUNCTION            0
-                   27 POP_TOP
-      <BLANKLINE>
-        6     >>   28 LOAD_GLOBAL              3 (foo4)
-                   31 CALL_FUNCTION            0
-                   34 POP_TOP
-      <BLANKLINE>
-        7          35 SETUP_LOOP              22 (to 60)
-              >>   38 LOAD_GLOBAL              4 (foo5)
-                   41 CALL_FUNCTION            0
-                   44 JUMP_IF_FALSE           11 (to 58)
-                   47 POP_TOP
-      <BLANKLINE>
-        8          48 LOAD_GLOBAL              5 (foo6)
-                   51 CALL_FUNCTION            0
-                   54 POP_TOP
-                   55 JUMP_ABSOLUTE           38
-              >>   58 POP_TOP
-                   59 POP_BLOCK
-              >>   60 LOAD_CONST               0 (None)
-                   63 RETURN_VALUE
-
     The earliest target of a backward jump would be the 'while' loop at L7, at
     bytecode offset 38::
 
       >>> _find_earliest_backjump_label(f.__code__.co_code) # doctest: +SKIP
       38
 
     Note that in this example there are earlier targets of jumps at bytecode
@@ -1526,25 +1468,18 @@
       []
 
     but this example, ``x`` is undefined at global scope::
 
       >>> [str(m) for m in find_missing_imports("(lambda x: x*x)(7) + x", [{}])]
       ['x']
 
-    The (unintuitive) rules for generator expressions and list comprehensions
-    in Python 2 are handled correctly::
-
       >>> # Python 3
       >>> [str(m) for m in find_missing_imports("[x+y+z for x,y in [(1,2)]], y", [{}])] # doctest: +SKIP
       ['y', 'z']
 
-      >>> # Python 2
-      >>> [str(m) for m in find_missing_imports("[x+y+z for x,y in [(1,2)]], y", [{}])] # doctest: +SKIP
-      ['z']
-
       >>> [str(m) for m in find_missing_imports("(x+y+z for x,y in [(1,2)]), y", [{}])]
       ['y', 'z']
 
     Only fully-qualified names starting at top-level are included::
 
       >>> [str(m) for m in find_missing_imports("( ( a . b ) . x ) . y + ( c + d ) . x . y", [{}])]
       ['a.b.x.y', 'c', 'd']
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_cmdline.py` & `pyflyby-1.8.5/bin/pyflyby/_cmdline.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,18 +1,16 @@
 # pyflyby/_cmdline.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import optparse
 import os
 import signal
-import six
 from   six                      import reraise
 from   six.moves                import input
 import sys
 from   textwrap                 import dedent
 import traceback
 
 
@@ -352,32 +350,26 @@
         self._tmpfiles.append(f)
         return f, Filename(f.name)
 
 
     @cached_attribute
     def output_content_filename(self):
         f, fname = self._tempfile()
-        if six.PY3:
-            f.write(bytes(self.output_content.joined, "utf-8"))
-        else:
-            f.write(self.output_content.joined.encode('utf-8'))
+        f.write(bytes(self.output_content.joined, "utf-8"))
         f.flush()
         return fname
 
     @cached_attribute
     def input_content_filename(self):
         if isinstance(self.filename, Filename):
             return self.filename
         # If the input was stdin, and the user wants a diff, then we need to
         # write it to a temp file.
         f, fname = self._tempfile()
-        if six.PY3:
-            f.write(bytes(self.input_content, "utf-8"))
-        else:
-            f.write(self.input_content)
+        f.write(bytes(self.input_content, "utf-8"))
         f.flush()
         return fname
 
 
     def __del__(self):
         for f in self._tmpfiles:
             f.close()
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_comms.py` & `pyflyby-1.8.5/bin/pyflyby/_comms.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-from __future__ import absolute_import, division, print_function
 
 from   pyflyby._log             import logger
 from   pyflyby._imports2s       import SourceToSourceFileImportsTransformation
 from   pyflyby._importstmt      import Import
 import six
 
 # These are comm targets that the frontend (lab/notebook) is expected to
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_dbg.py` & `pyflyby-1.8.5/bin/pyflyby/_dbg.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,31 +1,27 @@
 # pyflyby/_dbg.py.
 # Copyright (C) 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   contextlib               import contextmanager
 import errno
 from   functools                import wraps
 import os
 import pwd
 import signal
 import sys
 import time
 from   types                    import CodeType, FrameType, TracebackType
 
 import six
 from   six.moves                import builtins
 
-if six.PY3:
-    from   collections.abc          import Callable
-else:
-    from   collections              import Callable
+from   collections.abc          import Callable
 
 from   pyflyby._file            import Filename
 
 
 """
 Used by wait_for_debugger_to_attach to record whether we're waiting to attach,
 and if so what.
@@ -288,18 +284,19 @@
             break
 
         if response.lower() not in ('y', 'yes'):
             print("Invalid response: {}".format(repr(response)))
             count_invalid += 1
         else:
             break
-    print("Exiting after {} invalid responses.".format(max_invalid_entries))
-    _waiting_for_debugger = None
-    # Sleep for a fraction of second for the print statements to get printed.
-    time.sleep(0.01)
+    else:
+        print("Exiting after {} invalid responses.".format(max_invalid_entries))
+        _waiting_for_debugger = None
+        # Sleep for a fraction of second for the print statements to get printed.
+        time.sleep(0.01)
 
 
 def _debug_exception(*exc_info, **kwargs):
     """
     Debug an exception -- print a stack trace and enter the debugger.
 
     Suitable to be assigned to sys.excepthook.
@@ -1176,27 +1173,20 @@
     # with the same name as a built-in module could exist in `pyflyby_dir`.
     # Adding `pyflyby_dir` to sys.path will make the package get imported from
     # `pyflyby_dir` instead of deferring this decision to the user Python
     # environment.
     #
     # As a concrete example, `typing` module is a package as well a built-in
     # module from Python version >= 3.5
-    if six.PY2:
-        statements = [(
-            "location = __import__('imp').find_module('pyflyby', ['{pyflyby_dir}'])"
-            .format(pyflyby_dir=pyflyby_lib_path)),
-            "pyflyby = __import__('pkgutil').ImpLoader('pyflyby', *location).load_module('pyflyby')"
-            ]
-    else:
-        statements = [
-            "loader = __import__('importlib').machinery.PathFinder.find_module("
-            "fullname='pyflyby', path=['{pyflyby_dir}'])".format(
-                pyflyby_dir=pyflyby_lib_path),
-            "pyflyby = loader.load_module('pyflyby')"
-        ]
+    statements = [
+        "loader = __import__('importlib').machinery.PathFinder.find_module("
+        "fullname='pyflyby', path=['{pyflyby_dir}'])".format(
+            pyflyby_dir=pyflyby_lib_path),
+        "pyflyby = loader.load_module('pyflyby')"
+    ]
     statements.append(
         ("pyflyby.debugger(tty=%r, on_continue=%s)"
          % (terminal.ttyname, on_continue))
         )
 
     gdb_pid = inject(pid, statements=";".join(statements), wait=False)
     # Fork a watchdog process to make sure we exit if the target process or
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_docxref.py` & `pyflyby-1.8.5/bin/pyflyby/_docxref.py`

 * *Files 1% similar despite different names*

```diff
@@ -20,16 +20,14 @@
 #   implied, including but not limited to the warranties of merchantability,
 #   fitness for a particular purpose and noninfringement. In no event shall
 #   the authors or copyright holders be liable for any claim, damages or other
 #   liability, whether in an action of contract, tort or otherwise, arising
 #   from, out of or in connection with the software or the use or other
 #   dealings in the software.
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
 
 import re
 import six
 from   six.moves                import builtins
 from   textwrap                 import dedent
 
 from   epydoc.apidoc            import (ClassDoc, ModuleDoc, PropertyDoc,
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_file.py` & `pyflyby-1.8.5/bin/pyflyby/_file.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,25 +1,25 @@
 # pyflyby/_file.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   functools                import total_ordering
 import io
 import os
 import re
 import six
 import sys
 
 from   six                      import string_types
 
 from   pyflyby._util            import cached_attribute, cmp, memoize
 
+
 class UnsafeFilenameError(ValueError):
     pass
 
 
 # TODO: statcache
 
 @total_ordering
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_flags.py` & `pyflyby-1.8.5/bin/pyflyby/_flags.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/_flags.py.
 # Copyright (C) 2011, 2012, 2013, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import __future__
 import ast
 import operator
 import six
 from   six.moves                import reduce
 import warnings
@@ -41,23 +40,14 @@
 
       >>> print(CompilerFlags(0x10000, 0x8000).__interactive_display__()) # doctest: +SKIP
       CompilerFlags(0x18000) # from __future__ import with_statement, print_function
 
       >>> print(CompilerFlags('with_statement', 'print_function').__interactive_display__()) # doctest: +SKIP
       CompilerFlags(0x18000) # from __future__ import with_statement, print_function
 
-    This can be used as an argument to the built-in compile() function. For
-    instance, in Python 2::
-
-      >>> compile("print('x', file=None)", "?", "exec", flags=0, dont_inherit=1) #doctest:+SKIP
-      Traceback (most recent call last):
-
-        ...
-      SyntaxError: invalid syntax
-
       >>> compile("print('x', file=None)", "?", "exec", flags=CompilerFlags("print_function"), dont_inherit=1) #doctest:+ELLIPSIS
       <code object ...>
 
     """
 
     def __new__(cls, *args):
         """
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_format.py` & `pyflyby-1.8.5/bin/pyflyby/_format.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/_format.py.
 # Copyright (C) 2011, 2012, 2013, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import six
 
 
 class FormatParams(object):
     max_line_length = 79
     wrap_paren = True
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_idents.py` & `pyflyby-1.8.5/bin/pyflyby/_idents.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,27 +1,24 @@
 # pyflyby/_idents.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   functools                import total_ordering
 from   keyword                  import kwlist
 import re
 import six
 
 from   pyflyby._util            import cached_attribute, cmp
 
 
 # Don't consider "print" a keyword, in order to be compatible with user code
 # that uses "from __future__ import print_function".
 _my_kwlist = list(kwlist)
-if six.PY2:
-    _my_kwlist.remove("print")
 _my_iskeyword = frozenset(_my_kwlist).__contains__
 
 
 # TODO: use DottedIdentifier.prefixes
 def dotted_prefixes(dotted_name, reverse=False):
     """
     Return the prefixes of a dotted name.
@@ -113,41 +110,19 @@
       valid identifier.
     :rtype:
       ``bool``
     """
     if not isinstance(s, six.string_types):
         raise TypeError("is_identifier(): expected a string; got a %s"
                         % (type(s).__name__,))
-    if six.PY3:
-        if prefix:
-            return is_identifier(s + '_', dotted=dotted, prefix=False)
-        if dotted:
-            return all(is_identifier(w, dotted=False) for w in s.split('.'))
-        return s.isidentifier() and not _my_iskeyword(s)
-
     if prefix:
-        if not s:
-            return True
-        if dotted:
-            return bool(
-                _dotted_name_prefix_re.match(s) and
-                not any(_my_iskeyword(w) for w in s.split(".")[:-1]))
-        else:
-            return bool(_name_re.match(s))
-    else:
-        if dotted:
-            # Use a regular expression that works for dotted names.  (As an
-            # alternate implementation, one could imagine calling
-            # all(is_identifier(w) for w in s.split(".")).  We don't do that
-            # because s could be a long text string.)
-            return bool(
-                _dotted_name_re.match(s) and
-                not any(_my_iskeyword(w) for w in s.split(".")))
-        else:
-            return bool(_name_re.match(s) and not _my_iskeyword(s))
+        return is_identifier(s + '_', dotted=dotted, prefix=False)
+    if dotted:
+        return all(is_identifier(w, dotted=False) for w in s.split('.'))
+    return s.isidentifier() and not _my_iskeyword(s)
 
 
 def brace_identifiers(text):
     """
     Parse a string and yield all tokens of the form "{some_token}".
 
       >>> list(brace_identifiers("{salutation}, {your_name}."))
@@ -162,28 +137,30 @@
 class BadDottedIdentifierError(ValueError):
     pass
 
 
 # TODO: Use in various places, esp where e.g. dotted_prefixes is used.
 @total_ordering
 class DottedIdentifier(object):
-    def __new__(cls, arg):
+    def __new__(cls, arg, scope_info=None):
         if isinstance(arg, cls):
             return arg
         if isinstance(arg, six.string_types):
-            return cls._from_name(arg)
+            return cls._from_name(arg, scope_info)
         if isinstance(arg, (tuple, list)):
-            return cls._from_name(".".join(arg))
+            return cls._from_name(".".join(arg), scope_info)
         raise TypeError("DottedIdentifier: unexpected %s"
                         % (type(arg).__name__,))
 
     @classmethod
-    def _from_name(cls, name):
+    def _from_name(cls, name, scope_info=None):
         self = object.__new__(cls)
         self.name = str(name)
+        # TODO: change magic methods to compare with scopestack included
+        self.scope_info = scope_info
         if not is_identifier(self.name, dotted=True):
             if len(self.name) > 20:
                 raise BadDottedIdentifierError("Invalid python symbol name")
             else:
                 raise BadDottedIdentifierError("Invalid python symbol name %r"
                                                % (name,))
         self.parts = tuple(self.name.split('.'))
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_importclns.py` & `pyflyby-1.8.5/bin/pyflyby/_importclns.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/_importclns.py.
 # Copyright (C) 2011, 2012, 2013, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   collections              import defaultdict
 from   functools                import total_ordering
 import six
 
 from   pyflyby._flags           import CompilerFlags
 from   pyflyby._idents          import dotted_prefixes, is_identifier
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_importdb.py` & `pyflyby-1.8.5/bin/pyflyby/_importdb.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,20 +1,19 @@
 # pyflyby/_importdb.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   collections              import defaultdict
 import os
 import re
 import six
 
-from   pyflyby._file            import Filename, expand_py_files_from_args
+from pyflyby._file import Filename, expand_py_files_from_args, UnsafeFilenameError
 from   pyflyby._idents          import dotted_prefixes
 from   pyflyby._importclns      import ImportMap, ImportSet
 from   pyflyby._importstmt      import Import, ImportStatement
 from   pyflyby._log             import logger
 from   pyflyby._parse           import PythonBlock
 from   pyflyby._util            import cached_attribute, memoize, stable_unique
 
@@ -157,16 +156,20 @@
         pathnames = [pathnames]
     result = []
     for pathname in pathnames:
         if not pathname.startswith(".../"):
             result.append(Filename(pathname))
             continue
         suffix = pathname[4:]
-        expanded = [
-            p / suffix for p in _ancestors_on_same_partition(target_dirname) ]
+        expanded = []
+        for p in _ancestors_on_same_partition(target_dirname):
+            try:
+                expanded.append(p / suffix)
+            except UnsafeFilenameError:
+                continue
         result.extend(expanded[::-1])
     return result
 
 
 class ImportDB(object):
     """
     A database of known, mandatory, canonical imports.
@@ -261,15 +264,18 @@
             try:
                 return cls._default_cache[cache_keys[-1]]
             except KeyError:
                 pass
             if target_dirname.isdir:
                 break
             target_dirname = target_dirname.dir
-        target_dirname = target_dirname.real
+        try:
+            target_dirname = target_dirname.real
+        except UnsafeFilenameError:
+            pass
         if target_dirname != cache_keys[-1][0]:
             cache_keys.append((1,
                                target_dirname,
                                os.getenv("PYFLYBY_PATH"),
                                os.getenv("PYFLYBY_KNOWN_IMPORTS_PATH"),
                                os.getenv("PYFLYBY_MANDATORY_IMPORTS_PATH")))
             try:
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_imports2s.py` & `pyflyby-1.8.5/bin/pyflyby/_imports2s.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/_imports2s.py.
 # Copyright (C) 2011-2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   pyflyby._autoimp         import scan_for_import_issues
 from   pyflyby._file            import FileText, Filename
 from   pyflyby._flags           import CompilerFlags
 from   pyflyby._importclns      import ImportSet, NoSuchImportError
 from   pyflyby._importdb        import ImportDB
 from   pyflyby._importstmt      import ImportFormatParams, ImportStatement
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_importstmt.py` & `pyflyby-1.8.5/bin/pyflyby/_importstmt.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/_importstmt.py.
 # Copyright (C) 2011, 2012, 2013, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import ast
 from   collections              import namedtuple
 from   functools                import total_ordering
 
 from   pyflyby._flags           import CompilerFlags
 from   pyflyby._format          import FormatParams, pyfill
@@ -306,25 +305,23 @@
     def __lt__(self, other):
         if self is other:
             return False
         if not isinstance(other, Import):
             return NotImplemented
         return self._data < other._data
 
-def _interpret_alias(arg):
-    if isinstance(arg, str):
-        return (arg, None)
-    if not isinstance(arg, tuple):
-        raise TypeError('`arg` must be a tuple, got {}'.format(type(arg)))
-    if not len(arg) == 2:
-        raise TypeError('`arg` must be of len 2, got {} elements'.format(len(arg)))
-    if not isinstance(arg[0], str):
-        raise TypeError('`arg[0]` must be a str, got {}'.format(type(arg[0])))
-    if not (arg[1] is None or isinstance(arg[1], str)):
-        raise TypeError('arg[1] is None, or arg[1] is str {} '.format(arg))
+def _validate_alias(arg):
+    """
+    Ensure each alias is a tuple (str, None|str), and return it.
+
+    """
+    assert isinstance(arg, tuple)
+    a0,a1 = arg
+    assert isinstance(a0, str)
+    assert isinstance(a1, (str, type(None)))
     return arg
 
 @total_ordering
 class ImportStatement(object):
     """
     Token-level representation of an import statement containing multiple
     imports from a single module.  Corresponds to an ``ast.ImportFrom`` or
@@ -342,19 +339,20 @@
         if isinstance(arg, (tuple, list)) and len(arg):
             if isinstance(arg[0], Import):
                 return cls._from_imports(arg)
         raise TypeError
 
     @classmethod
     def from_parts(cls, fromname, aliases):
+        assert isinstance(aliases, list)
+        assert len(aliases) > 0
+        
         self = object.__new__(cls)
         self.fromname = fromname
-        if not len(aliases):
-            raise ValueError
-        self.aliases = tuple(_interpret_alias(a) for a in aliases)
+        self.aliases = tuple(_validate_alias(a) for a in aliases)
         return self
 
     @classmethod
     def _from_statement(cls, statement):
         """
           >>> ImportStatement._from_statement("from foo  import bar, bar2, bar")
           ImportStatement('from foo import bar, bar2, bar')
@@ -387,28 +385,26 @@
         """
         Construct an `ImportStatement` from an `ast` node.
 
         :rtype:
           `ImportStatement`
         """
         if isinstance(node, ast.ImportFrom):
-            if isinstance(node.module, str):
-                module = node.module
-            elif node.module is None:
-                # In python2.7, ast.parse("from . import blah") yields
-                # node.module = None.  In python2.6, it's the empty string.
+            if node.module is None:
                 module = ''
             else:
-                raise TypeError("unexpected node.module=%s"
-                                % type(node.module).__name__)
+                assert isinstance(node.module, str)
+                module = node.module
             fromname = '.' * node.level + module
         elif isinstance(node, ast.Import):
             fromname = None
         else:
-            raise NonImportStatementError
+            raise NonImportStatementError(
+                    'Expected ImportStatement, got {node}'.format(node=node)
+                    )
         aliases = [ (alias.name, alias.asname) for alias in node.names ]
         return cls.from_parts(fromname, aliases)
 
     @classmethod
     def _from_imports(cls, imports):
         """
         Construct an `ImportStatement` from a sequence of ``Import`` s.  They
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_interactive.py` & `pyflyby-1.8.5/bin/pyflyby/_interactive.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,25 +1,23 @@
 # pyflyby/_interactive.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import ast
 from   contextlib               import contextmanager
 import errno
 import inspect
 import os
 import re
 import subprocess
 import sys
 
 import six
-from   six                      import PY2, text_type as unicode
 from   six.moves                import builtins
 
 from   pyflyby._autoimp         import (LoadSymbolError, ScopeStack, auto_eval,
                                         auto_import,
                                         clear_failed_imports_cache,
                                         load_symbol)
 from   pyflyby._comms           import (initialize_comms, remove_comms,
@@ -1068,16 +1066,14 @@
             pmodule = ModuleHandle(pname)
             # Add importable submodules.
             results.update([m.name.parts[-1] for m in pmodule.submodules])
         results = sorted([r for r in results if r.startswith(attrname)])
         results = ["%s.%s" % (pname, r) for r in results]
     else:
         raise AssertionError
-    if six.PY2:
-        results = [unicode(s) for s in results]
     logger.debug("complete_symbol(%r) => %r", fullname, results)
     return results
 
 
 def _list_members_for_completion(obj, ip):
     """
     Enumerate the existing member attributes of an object.
@@ -2312,33 +2308,14 @@
         """
         Enable some advice that's actually just fixing bugs in IPython.
         """
         # IPython 2.x on Python 2.x has a bug where 'run -n' doesn't work
         # because it uses Unicode for the module name.  This is a bug in
         # IPython itself ("run -n" is plain broken for ipython-2.x on
         # python-2.x); we patch it here.
-        if (PY2 and
-            hasattr(ip, "new_main_mod")):
-            try:
-                args = inspect.getargspec(ip.new_main_mod).args
-            except Exception:
-                # getargspec fails if we already advised.
-                # For now just skip under the assumption that we already
-                # advised (or the code changed in some way that doesn't
-                # require advising?)
-                # Minor todo: Ideally we would be relying on _advise to check
-                # that we haven't already advised.
-                args = None
-            if args == ["self","filename","modname"]:
-                @self._advise(ip.new_main_mod)
-                def new_main_mod_fix_str(filename, modname):
-                    if six.PY2:
-                        if type(modname) is unicode:
-                            modname = str(modname)
-                    return __original__(filename, modname)
         return True
 
     def _enable_ipython_bugfixes(self):
         """
         Enable some advice that's actually just fixing bugs in IPython.
         """
         ok = True
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_livepatch.py` & `pyflyby-1.8.5/bin/pyflyby/_livepatch.py`

 * *Files 2% similar despite different names*

```diff
@@ -125,26 +125,24 @@
           result._my_cache.update(keep_cache)
           return result
 
 XXX test
 
 """
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import ast
 import os
 import re
 import six
 import sys
 import time
 import types
 
-from   six                      import PY2
 from   six.moves                import reload_module
 
 import inspect
 from   pyflyby._log             import logger
 
 
 # Keep track of when the process was started.
@@ -276,42 +274,39 @@
             new=new,
             do_livepatch=do_livepatch,
             modname=modname,
             cache=cache,
             visit_stack=visit_stack)
         # Find out which optional kwargs the hook wants.
         kwargs = {}
-        if PY2:
-            argspec = inspect.getargspec(hook)
-        else:
-            argspec = inspect.getfullargspec(hook)
+        argspec = inspect.getfullargspec(hook)
         argnames = argspec.args
         if hasattr(hook, "__func__"):
             # Skip 'self' arg.
             argnames = argnames[1:]
         # Pick kwargs that are wanted and available.
         args = []
         kwargs = {}
         for n in argnames:
             try:
                 kwargs[n] = avail_kwargs[n]
-                if argspec.keywords if PY2 else argspec.varkw:
+                if argspec.varkw:
                     break
             except KeyError:
                 # For compatibility, allow first argument to be 'old' with any
                 # name, as long as there's no other arg 'old'.
                 # We intentionally allow this even if the user specified
                 # **kwargs.
                 if not args and not kwargs and 'old' not in argnames:
                     args.append(old)
                 else:
                     # Rely on default being set.  If a default isn't set, the
                     # user will get a TypeError.
                     pass
-        if argspec.keywords if PY2 else argspec.varkw:
+        if argspec.varkw:
             # Use all available kwargs.
             kwargs = avail_kwargs
         # Call hook.
         result = hook(*args, **kwargs)
     cache[cachekey] = result
     return result
 
@@ -522,34 +517,22 @@
         livepatch(
             oldobj.__dict__, newobj.__dict__,
             modname=modname, cache=cache, visit_stack=visit_stack)
         return oldobj
     else:
         return newobj
 
-
-if six.PY2:
-    _LIVEPATCH_DISPATCH_TABLE = {
-        object            : _livepatch__object,
-        dict              : _livepatch__dict,
-        type              : _livepatch__class,
-        types.ClassType   : _livepatch__class,
-        types.FunctionType: _livepatch__function,
-        types.MethodType  : _livepatch__method,
-        types.ModuleType  : _livepatch__module,
-    }
-elif six.PY3:
-    _LIVEPATCH_DISPATCH_TABLE = {
-        object            : _livepatch__object,
-        dict              : _livepatch__dict,
-        type              : _livepatch__class,
-        types.FunctionType: _livepatch__function,
-        types.MethodType  : _livepatch__method,
-        types.ModuleType  : _livepatch__module,
-    }
+_LIVEPATCH_DISPATCH_TABLE = {
+    object            : _livepatch__object,
+    dict              : _livepatch__dict,
+    type              : _livepatch__class,
+    types.FunctionType: _livepatch__function,
+    types.MethodType  : _livepatch__method,
+    types.ModuleType  : _livepatch__module,
+}
 
 
 def _get_definition_module(obj):
     """
     Get the name of the module that an object is defined in, or ``None`` if
     unknown.
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_log.py` & `pyflyby-1.8.5/bin/pyflyby/_log.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/_log.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   contextlib               import contextmanager
 import logging
 from   logging                  import Handler, Logger
 import os
 from   six.moves                import builtins
 import sys
@@ -154,62 +153,22 @@
     finally:
         if prev is MISSING:
             proxy.__dict__.pop('_do', None)
         else:
             proxy.__dict__ = prev
 
 
-@contextmanager
-def _NoRegisterLoggerHandlerInHandlerListCtx():
-    """
-    Work around a bug in the ``logging`` module for Python 2.x-3.2.
-
-    The Python stdlib ``logging`` module has a bug where you sometimes get the
-    following warning at exit::
-
-      Exception TypeError: "'NoneType' object is not callable" in <function
-      _removeHandlerRef at 0x10a1b3f50> ignored
-
-    This is caused by shutdown ordering affecting which globals in the logging
-    module are available to the _removeHandlerRef function.
-
-    Python 3.3 fixes this.
-
-    For earlier versions of Python, this context manager works around the
-    issue by avoiding registering a handler in the _handlerList.  This means
-    that we no longer call "flush()" from the atexit callback.  However, that
-    was a no-op anyway, and even if we needed it, we could call it ourselves
-    atexit.
-
-    :see:
-      http://bugs.python.org/issue9501
-    """
-    if not hasattr(logging, "_handlerList"):
-        yield
-        return
-    if sys.version_info >= (3, 3):
-        yield
-        return
-    try:
-        orig_handlerList = logging._handlerList[:]
-        yield
-    finally:
-        logging._handlerList[:] = orig_handlerList
-
-
-
 class PyflybyLogger(Logger):
 
     _LEVELS = dict( (k, getattr(logging, k))
                     for k in ['DEBUG', 'INFO', 'WARNING', 'ERROR'] )
 
     def __init__(self, name, level):
         Logger.__init__(self, name)
-        with _NoRegisterLoggerHandlerInHandlerListCtx():
-            handler = _PyflybyHandler()
+        handler = _PyflybyHandler()
         self.addHandler(handler)
         self.set_level(level)
 
     def set_level(self, level):
         """
         Set the pyflyby logger's level to ``level``.
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_modules.py` & `pyflyby-1.8.5/bin/pyflyby/_modules.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/_modules.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   functools                import total_ordering
 import os
 import re
 import six
 from   six                      import reraise
 import sys
@@ -354,15 +353,15 @@
             members = [n for n in members if from_this_module(n)]
         else:
             if not all(type(s) == str for s in members):
                 raise Exception(
                     "Module %r contains non-string entries in __all__"
                     % (str(self.name),))
         # Filter out artificially added "deep" members.
-        members = [n for n in members if "." not in n]
+        members = [(n, None) for n in members if "." not in n]
         if not members:
             return None
         return ImportSet(
             [ ImportStatement.from_parts(str(self.name), members) ])
 
     def __str__(self):
         return str(self.name)
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_parse.py` & `pyflyby-1.8.5/bin/pyflyby/_parse.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,38 +1,32 @@
 # pyflyby/_parse.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import ast
 from   collections              import namedtuple
 from   doctest                  import DocTestParser
 from   functools                import total_ordering
 from   itertools                import groupby
 import re
 import sys
 from   textwrap                 import dedent
 import types
 
 import six
-from   six                      import PY2, PY3, text_type as unicode
 from   six.moves                import range
 
 from   pyflyby._file            import FilePos, FileText, Filename
 from   pyflyby._flags           import CompilerFlags
 from   pyflyby._log             import logger
 from   pyflyby._util            import cached_attribute, cmp
 
-if PY3:
-    from ast import Bytes
-else:
-    Bytes = ast.Str
-
+from ast import Bytes
 
 if sys.version_info >= (3, 8):
     from ast import TypeIgnore, AsyncFunctionDef
 else:
 
     # TypeIgnore, AsyncFunctionDef does not exist on Python 3.7 and before. thus
     # we define a dummy TypeIgnore, AsyncFunctionDef just to simplify remaining
@@ -106,18 +100,15 @@
         return
     if not isinstance(node, ast.AST):
         raise TypeError
     if isinstance(node, ast.Dict):
         assert node._fields == ("keys", "values")
         yield list(zip(node.keys, node.values))
     elif isinstance(node, (ast.FunctionDef, AsyncFunctionDef)):
-        if six.PY2:
-            assert node._fields == ('name', 'args', 'body', 'decorator_list'), node._fields
-            yield node.decorator_list, node.args, node.body
-        elif sys.version_info >= (3, 8):
+        if sys.version_info >= (3, 8):
             assert node._fields == (
                 "name",
                 "args",
                 "body",
                 "decorator_list",
                 "returns",
                 "type_comment",
@@ -132,18 +123,15 @@
             yield res
         else:
             assert node._fields == ('name', 'args', 'body', 'decorator_list',
                                     'returns'), node._fields
             yield node.decorator_list, node.args, node.returns, node.body
         # node.name is a string, not an AST node
     elif isinstance(node, ast.arguments):
-        if six.PY2:
-            assert node._fields == ('args', 'vararg', 'kwarg', 'defaults'), node._fields
-            args = node.args
-        elif sys.version_info >= (3, 8):
+        if sys.version_info >= (3, 8):
             assert node._fields == ('posonlyargs', 'args', 'vararg', 'kwonlyargs',
                                     'kw_defaults', 'kwarg', 'defaults'), node._fields
             args = node.posonlyargs + node.args
         else:
             assert node._fields == ('args', 'vararg', 'kwonlyargs',
                                     'kw_defaults', 'kwarg', 'defaults'), node._fields
             args = node.args
@@ -158,18 +146,15 @@
     elif isinstance(node, ast.Call):
         # call arguments order are lost by ast, re-order them
         yield node.func
         args = sorted([(k.value.lineno, k.value.col_offset, k) for k in node.keywords]+
                       [(k.lineno,k.col_offset, k) for k in node.args])
         yield [a[2] for a in args]
     elif isinstance(node, ast.ClassDef):
-        if six.PY2:
-            assert node._fields == ('name', 'bases', 'body', 'decorator_list')
-        else:
-            assert node._fields == ('name', 'bases', 'keywords', 'body', 'decorator_list')
+        assert node._fields == ('name', 'bases', 'keywords', 'body', 'decorator_list')
         yield node.decorator_list, node.bases, node.body
         # node.name is a string, not an AST node
     elif sys.version_info >= (3, 7) and isinstance(node, ast.FormattedValue):
         assert node._fields == ('value', 'conversion', 'format_spec')
         yield node.value,
     else:
         # Default behavior.
@@ -206,17 +191,14 @@
         if re.search(r"# *type:", source):
             flags = flags | CompilerFlags('type_comments')
         yield flags
         return
     if not auto_flags:
         yield flags
         return
-    if PY3:
-        yield flags
-        return
     if mode == "eval":
         if re.search(r"\bprint\b", source):
             flags = flags | CompilerFlags("print_function")
         yield flags
         return
     yield flags
     if re.search(r"\bprint\b", source):
@@ -244,16 +226,14 @@
     :rtype:
       ``ast.Module``
     """
     text = FileText(text)
     filename = str(text.filename) if text.filename else "<unknown>"
     source = text.joined
     source = dedent(source)
-    if PY2 and isinstance(source, unicode):
-        source = source.encode('utf-8')
     if not source.endswith("\n"):
         # Ensure that the last line ends with a newline (``ast`` barfs
         # otherwise).
         source += "\n"
     exp = None
     for flags in _flags_to_try(source, flags, auto_flags, mode):
         cflags = ast.PyCF_ONLY_AST | int(flags)
@@ -279,20 +259,14 @@
     literal, return its value.  Otherwise return ``None``.
 
       >>> _test_parse_string_literal(r'"foo\n" r"\nbar"', None)
       'foo\n\\nbar'
 
     """
     text = FileText(text)
-    if PY2:
-        try:
-            text.joined.encode('ascii')
-        except UnicodeError:
-            text = FileText(u'# encoding: utf-8\n' + unicode(text), filename=text.filename)
-
     try:
         module_node = _parse_ast_nodes(text, flags, False, "eval")
     except SyntaxError:
         return None
     body = module_node.body
     if not isinstance(body, (ast.Str, Bytes)):
         return None
@@ -374,20 +348,16 @@
     """
     assert isinstance(ast_node, (ast.AST, str, TypeIgnore)), ast_node
 
     # joined strings and children do not carry a column offset on pre-3.8
     # this prevent reformatting.
     # set the column offset to the parent value before 3.8
     if (3, 7) < sys.version_info < (3, 8):
-        if (
-            isinstance(ast_node, (getattr(ast, "JoinedStr", None), ast.FormattedValue))
-            or isinstance(
-                parent_ast_node, (getattr(ast, "JoinedStr", None), ast.FormattedValue)
-            )
-        ) and ast_node.col_offset == -1:
+        instances = (getattr(ast, "JoinedStr", None), ast.FormattedValue)
+        if ((isinstance(ast_node, instances) or isinstance(parent_ast_node, instances)) and ast_node.col_offset == -1) or isinstance(ast_node, ast.keyword):
             ast_node.col_offset = parent_ast_node.col_offset
 
     # First, traverse child nodes.  If the first child node (recursively) is a
     # multiline string, then we need to transfer its information to this node.
     # Walk all nodes/fields of the AST.  We implement this as a custom
     # depth-first search instead of using ast.walk() or ast.NodeVisitor
     # so that we can easily keep track of the preceding node's lineno.
@@ -443,18 +413,14 @@
         # a single-line string.)
         # Easy.
         startpos = text.startpos + delta
 
         # Special case for 'with' statements.  Consider the code:
         #    with X: pass
         #    ^0   ^5
-        # In python2.6, col_offset is 0.
-        # In python2.7, col_offset is 5.
-        # This is because python2.7 allows for multiple clauses:
-        #    with X, Y: pass
         # Since 'Y's col_offset isn't the beginning of the line, the authors
         # of Python presumably changed 'X's col_offset to also not be the
         # beginning of the line.  If they had made the With ast node support
         # multiple clauses, they wouldn't have needed to do that, but then
         # that would introduce an API change in the AST.  So it's
         # understandable that they did that.
         # Since we use startpos for breaking lines, we need to set startpos to
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_py.py` & `pyflyby-1.8.5/bin/pyflyby/_py.py`

 * *Files 0% similar despite different names*

```diff
@@ -268,16 +268,15 @@
       /usr/local/lib/python2.7/site-packages/pandas/__init__.pyc
     Docstring:
       pandas - a powerful data analysis and manipulation library for Python
       ...
 
 """
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   functools                import total_ordering
 
 from   pyflyby._util            import cmp
 
 usage = """
 py --- command-line python multitool with automatic importing
@@ -395,19 +394,14 @@
     elif isinstance(arg, type):
         if arg.__new__ is not object.__new__:
             argspec = _get_argspec(arg.__new__)
             return ArgSpec(argspec.args[1:], *argspec[1:])
         else:
             argspec = _get_argspec(arg.__init__)
             return ArgSpec(argspec.args[1:], *argspec[1:])
-    # Old style class. Should only run in Python 2. types.ClassType doesn't
-    # exist in Python 3.
-    elif isinstance(arg, getattr(types, 'ClassType', type)):
-        argspec = _get_argspec(arg.__init__)
-        return ArgSpec(argspec.args[1:], *argspec[1:])
     elif _recurse and hasattr(arg, '__call__'):
         return _get_argspec(arg.__call__, _recurse=False)
     elif callable(arg):
         # Unknown, probably a built-in method.
         if sys.version_info[0] == 3:
             return ArgSpec((), "args", "kwargs", None, [], None, {})
         else:
```

### Comparing `pyflyby-1.8.4/bin/pyflyby/_util.py` & `pyflyby-1.8.5/bin/pyflyby/_util.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,28 +1,24 @@
 # pyflyby/_util.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   contextlib               import contextmanager
 import inspect
 import os
 import six
-from   six                      import PY3, reraise
+from   six                      import reraise
 import sys
 import types
 
 # Python 2/3 compatibility
 DictProxyType = type(object.__dict__)
 
-class Object(object):
-    pass
-
 
 def memoize(function):
     cache = {}
     def wrapped_fn(*args, **kwargs):
         cache_key = (args, tuple(sorted(kwargs.items())))
         try:
             return cache[cache_key]
@@ -252,20 +248,17 @@
                     globals[k] = v
 
     def __getattr__(self, k):
         return getattr(self.__original__, k)
 
 
     def __get__(self, inst, cls=None):
-        if PY3:
-            if inst is None:
-                return self
-            return types.MethodType(self, inst)
-        else:
-            return types.MethodType(self, inst, cls)
+        if inst is None:
+            return self
+        return types.MethodType(self, inst)
 
 
 
 class _WritableDictProxy(object):
     """
     Writable equivalent of cls.__dict__.
     """
@@ -339,50 +332,37 @@
 
     def __init__(self, joinpoint):
         spec = joinpoint
         while hasattr(joinpoint, "__joinpoint__"):
             joinpoint = joinpoint.__joinpoint__
         self._joinpoint = joinpoint
         if (isinstance(joinpoint, (types.FunctionType, six.class_types, type))
-            and not (PY3 and joinpoint.__name__ != joinpoint.__qualname__)):
+            and not (joinpoint.__name__ != joinpoint.__qualname__)):
             self._qname = "%s.%s" % (
                 joinpoint.__module__,
                 joinpoint.__name__)
             self._container = sys.modules[joinpoint.__module__].__dict__
             self._name      = joinpoint.__name__
             self._original  = spec
             assert spec == self._container[self._name], joinpoint
-        elif isinstance(joinpoint, types.MethodType) or (PY3 and isinstance(joinpoint,
+        elif isinstance(joinpoint, types.MethodType) or (isinstance(joinpoint,
             types.FunctionType) and joinpoint.__name__ !=
             joinpoint.__qualname__) or isinstance(joinpoint, property):
             if isinstance(joinpoint, property):
                 joinpoint = joinpoint.fget
                 self._wrapper = property
-            if PY3:
-                self._qname = '%s.%s' % (joinpoint.__module__,
-                                         joinpoint.__qualname__)
-                self._name      = joinpoint.__name__
-            else:
-                self._qname = "%s.%s.%s" % (
-                    joinpoint.__self__.__class__.__module__,
-                    joinpoint.__self__.__class__.__name__,
-                    joinpoint.__func__.__name__)
-                self._name      = joinpoint.__func__.__name__
+            self._qname = '%s.%s' % (joinpoint.__module__,
+                                     joinpoint.__qualname__)
+            self._name      = joinpoint.__name__
             if getattr(joinpoint, '__self__', None) is None:
-                # Unbound method in Python 2 only. In Python 3, there are no unbound methods
-                # (they are just functions).
-                if PY3:
-                    container_obj   = getattr(inspect.getmodule(joinpoint),
-                       joinpoint.__qualname__.split('.<locals>', 1)[0].rsplit('.', 1)[0])
-                else:
-                    container_obj   = joinpoint.im_class
+                container_obj   = getattr(inspect.getmodule(joinpoint),
+                   joinpoint.__qualname__.split('.<locals>', 1)[0].rsplit('.', 1)[0])
+
                 self._container = _WritableDictProxy(container_obj)
-                # __func__ gives the function for the Python 2 unbound method.
-                # In Python 3, spec is already a function.
-                self._original  = getattr(spec, '__func__', spec)
+                self._original  = spec
             else:
                 # Instance method.
                 container_obj   = joinpoint.__self__
                 self._container = container_obj.__dict__
                 self._original  = spec
             assert spec == getattr(container_obj, self._name), (container_obj, self._qname)
             assert self._original == self._container.get(self._name, self._original)
@@ -489,18 +469,14 @@
         advice.unadvise()
 
 # For Python 2/3 compatibility. cmp isn't included with six.
 def cmp(a, b):
     return (a > b) - (a < b)
 
 
-# Create a context manager with an arbitrary number of contexts. This is
-# the same as Py2 contextlib.nested, but that one is removed in Py3.
-if six.PY2:
-    from contextlib import nested
-else:
-    from contextlib import ExitStack
-    @contextmanager
-    def nested(*mgrs):
-        with ExitStack() as stack:
-            ctxes = [stack.enter_context(mgr) for mgr in mgrs]
-            yield ctxes
+# Create a context manager with an arbitrary number of contexts.
+from contextlib import ExitStack
+@contextmanager
+def nested(*mgrs):
+    with ExitStack() as stack:
+        ctxes = [stack.enter_context(mgr) for mgr in mgrs]
+        yield ctxes
```

### Comparing `pyflyby-1.8.4/bin/pyflyby-diff` & `pyflyby-1.8.5/bin/pyflyby-diff`

 * *Files identical despite different names*

### Comparing `pyflyby-1.8.4/bin/reformat-imports` & `pyflyby-1.8.5/bin/reformat-imports`

 * *Files 27% similar despite different names*

```diff
@@ -6,15 +6,14 @@
 Reformats the top-level 'import' blocks within the python module/script.
 
 """
 # pyflyby/reformat-imports
 # Copyright (C) 2011, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import absolute_import, division, with_statement
 
 from   pyflyby._cmdline         import parse_args, process_actions
 from   pyflyby._imports2s       import reformat_import_statements
 
 
 def main():
     options, args = parse_args(
```

### Comparing `pyflyby-1.8.4/bin/replace-star-imports` & `pyflyby-1.8.5/bin/replace-star-imports`

 * *Files 16% similar despite different names*

```diff
@@ -16,15 +16,14 @@
 Only top-level import statements are touched.
 
 """
 # pyflyby/replace-star-imports
 # Copyright (C) 2012, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import absolute_import, division, with_statement
 
 from   pyflyby._cmdline         import parse_args, process_actions
 from   pyflyby._imports2s       import replace_star_imports
 
 
 def main():
     options, args = parse_args(
```

### Comparing `pyflyby-1.8.4/bin/tidy-imports` & `pyflyby-1.8.5/bin/tidy-imports`

 * *Files 24% similar despite different names*

```diff
@@ -16,39 +16,29 @@
 
 """
 
 # pyflyby/tidy-imports
 # Copyright (C) 2011, 2012, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import print_function, absolute_import, division, with_statement
 
 from   distutils.spawn          import find_executable
 import subprocess
 import sys
 import os
 
 from   pyflyby._cmdline         import hfmt, parse_args, process_actions
 from   pyflyby._imports2s       import (canonicalize_imports,
                                         fix_unused_and_missing_imports,
                                         replace_star_imports,
                                         transform_imports)
 from   pyflyby._log             import logger
 
-if sys.version_info[0] == 3:
-    # can't install/import it on Python 2
-    try:
-        import toml
-        TOML_AVAIL = True
-    except ModuleNotFoundError:
-        TOML_AVAIL = False
-
-else:
-    TOML_AVAIL = False
-
+import toml
+TOML_AVAIL = True
 
 
 def _get_pyproj_toml_config():
     """
     Try to find current project pyproject.toml
     in cwd or parents directories.
     """
@@ -118,25 +108,14 @@
                         help=hfmt('''
                             (Default) Replace imports with canonical
                             equivalent imports, according to database.'''))
     parser.add_option('--no-canonicalize', dest='canonicalize',
                         default=True, action='store_false',
                         help=hfmt('''
                             Don't canonicalize imports.'''))
-    parser.add_option('--py23-fallback', dest='py23_fallback',
-                        default=False, action='store_true',
-                        help=hfmt('''
-                            Automatically fallback to python2/python3 if the
-                            source file has a syntax error.'''))
-    parser.add_option('--no-py23-fallback', dest='py23_fallback',
-                        action='store_false',
-                        help=hfmt('''
-                            (Default) Do not automatically fallback to
-                            python2/python3 if the source file has a syntax
-                            error.'''))
 
 
     def transform_callback(option, opt_str, value, group):
         k, v = value.split("=", 1)
         group.values.transformations[k] = v
     parser.add_option("--transform", action='callback',
                         type="string", callback=transform_callback,
@@ -176,31 +155,12 @@
             x = replace_star_imports(x, params=options.params)
         return fix_unused_and_missing_imports(
             x, params=options.params,
             add_missing=options.add_missing,
             remove_unused=options.remove_unused,
             add_mandatory=options.add_mandatory,
             )
-
-    if options.py23_fallback:
-        try:
-            process_actions(args, options.actions, modify,
-                            reraise_exceptions=SyntaxError)
-        except SyntaxError as e:
-            python = 'python2' if sys.version_info[0] == 3 else 'python3'
-            python_full = find_executable(python)
-            if not python_full:
-                logger.error("Fallback failed: could not find %s", python)
-                raise
-            logger.info("SyntaxError detected ({}), falling back to {}".format(
-                e, python))
-            args = [python_full] + sys.argv + ['--no-py23-fallback']
-            try:
-                raise SystemExit(subprocess.call(args))
-            except KeyboardInterrupt:
-                sys.exit(1)
-    else:
-        process_actions(args, options.actions, modify)
+    process_actions(args, options.actions, modify)
 
 
 if __name__ == '__main__':
     main()
```

### Comparing `pyflyby-1.8.4/doc/LICENSE.txt` & `pyflyby-1.8.5/doc/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `pyflyby-1.8.4/doc/Makefile` & `pyflyby-1.8.5/doc/Makefile`

 * *Files identical despite different names*

### Comparing `pyflyby-1.8.4/doc/TODO.txt` & `pyflyby-1.8.5/doc/TODO.txt`

 * *Files 2% similar despite different names*

```diff
@@ -72,16 +72,14 @@
   of executing code.
 
 - Unify collect-imports/collect-exports/collect-exports-from-stores into a
   single script with a mode argument.  Also parameters for whether to include
   things imported from submodules (default on) and whether to include things
   imported from other packages (default off).
 
-- Add ability to dynamically enable a file based on py3 or py2
-
 - Add tidy-imports, etc to py
 
 - Merge contents of all scripts into modules, and use setup.py entry_points.
   Keep stub scripts in bin directory only for non-installed usage.
 
 - Support pypy.  It seems to already work fine in casual tests, but tox and
   maybe setup.py need tweaking
```

### Comparing `pyflyby-1.8.4/doc/conf.py` & `pyflyby-1.8.5/doc/conf.py`

 * *Files identical despite different names*

### Comparing `pyflyby-1.8.4/doc/make.bat` & `pyflyby-1.8.5/doc/make.bat`

 * *Files identical despite different names*

### Comparing `pyflyby-1.8.4/etc/pyflyby/common.py` & `pyflyby-1.8.5/etc/pyflyby/common.py`

 * *Files identical despite different names*

### Comparing `pyflyby-1.8.4/etc/pyflyby/numpy.py` & `pyflyby-1.8.5/etc/pyflyby/numpy.py`

 * *Files identical despite different names*

### Comparing `pyflyby-1.8.4/etc/pyflyby/std.py` & `pyflyby-1.8.5/etc/pyflyby/std.py`

 * *Files 3% similar despite different names*

```diff
@@ -13,14 +13,16 @@
 import bisect
 import bootstrap
 import bz2
 import cProfile
 import cgi
 import collections
 from   collections              import defaultdict, deque, namedtuple
+import collections.abc
+from   collections.abc          import Collection, Iterable, Iterator, Sequence
 import commands
 import contextlib
 from   contextlib               import closing, contextmanager, nested
 import copy
 import csv
 import ctypes
 from   ctypes                   import CDLL
@@ -313,14 +315,16 @@
                                         MemberDescriptorType, MethodType,
                                         ModuleType, NoneType,
                                         NotImplementedType, ObjectType,
                                         SliceType, StringType, StringTypes,
                                         TracebackType, TupleType, TypeType,
                                         UnboundMethodType, UnicodeType,
                                         XRangeType)
+import typing
+from   typing                   import NamedTuple, Optional, Protocol
 import unittest
 import urllib
 import urllib2
 import warnings
 import weakref
 from   weakref                  import (CallableProxyType, ProxyType,
                                         ProxyTypes, ReferenceType,
```

### Comparing `pyflyby-1.8.4/lib/emacs/pyflyby.el` & `pyflyby-1.8.5/lib/emacs/pyflyby.el`

 * *Files identical despite different names*

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/__init__.py` & `pyflyby-1.8.5/lib/python/pyflyby/__init__.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/__init__.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   pyflyby._autoimp         import (auto_eval, auto_import,
                                         find_missing_imports)
 from   pyflyby._dbg             import (add_debug_functions_to_builtins,
                                         attach_debugger, debug_on_exception,
                                         debug_statement, debugger,
                                         enable_exception_handler_debugger,
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_autoimp.py` & `pyflyby-1.8.5/lib/python/pyflyby/_autoimp.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,29 +1,23 @@
 # pyflyby/_autoimp.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018, 2019 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import ast
 import contextlib
 import copy
 import six
-from   six                      import PY2, PY3, exec_, reraise
+from   six                      import exec_, reraise
 from   six.moves                import builtins
 import sys
 import types
 
-if PY3:
-    from collections.abc import Sequence
-else:
-    # This is deprecated in Python 3
-    from collections import Sequence
-
+from collections.abc import Sequence
 
 from   pyflyby._file            import FileText, Filename
 from   pyflyby._flags           import CompilerFlags
 from   pyflyby._idents          import (BadDottedIdentifierError,
                                         DottedIdentifier, brace_identifiers)
 from   pyflyby._importdb        import ImportDB
 from   pyflyby._importstmt      import Import
@@ -580,60 +574,54 @@
                 logger.warning("Don't know how to handle __all__ with list elements other than str")
                 return
             for e in node.value.elts:
                 self._visit_Load_defered_global(e.s)
 
     def visit_ClassDef(self, node):
         logger.debug("visit_ClassDef(%r)", node)
-        if PY3:
-            assert node._fields == ('name', 'bases', 'keywords', 'body', 'decorator_list')
-        else:
-            assert node._fields == ('name', 'bases', 'body', 'decorator_list')
+        assert node._fields == ('name', 'bases', 'keywords', 'body', 'decorator_list')
         self.visit(node.bases)
         self.visit(node.decorator_list)
         # The class's name is only visible to others (not to the body to the
         # class), but is accessible in the methods themselves. See https://github.com/deshaw/pyflyby/issues/147
-        if PY3:
-            self.visit(node.keywords)
+        self.visit(node.keywords)
 
         # we only care about the first defined class,
         # we don't detect issues with nested classes.
         if self._in_class_def == 0:
             self.scopestack._class_delayed[node.name] = None
         with self._NewScopeCtx(new_class_scope=True):
             if not self._in_class_def:
                 self._in_class_def += 1
                 self._visit_Store(node.name)
             self.visit(node.body)
             self._in_class_def -= 1
+        self._remove_from_missing_imports(node.name)
         self._visit_Store(node.name)
 
     def visit_AsyncFunctionDef(self, node):
         return self.visit_FunctionDef(node)
 
     def visit_FunctionDef(self, node):
         # Visit a function definition.
         #   - Visit args and decorator list normally.
         #   - Visit function body in a special mode where we defer checking
         #     loads until later, and don't load names from the parent ClassDef
         #     scope.
         #   - Store the name in the current scope (but not visibly to
         #     args/decorator_list).
-        if PY2:
-            assert node._fields == ('name', 'args', 'body', 'decorator_list'), node._fields
-        elif sys.version_info >= (3, 8):
+        if sys.version_info >= (3, 8):
             assert node._fields == ('name', 'args', 'body', 'decorator_list', 'returns', 'type_comment'), node._fields
         else:
             assert node._fields == ('name', 'args', 'body', 'decorator_list', 'returns'), node._fields
         with self._NewScopeCtx(include_class_scopes=True):
             self.visit(node.args)
             self.visit(node.decorator_list)
-            if PY3:
-                if node.returns:
-                    self.visit(node.returns)
+            if node.returns:
+                self.visit(node.returns)
             if sys.version_info >= (3, 8):
                 self._visit_typecomment(node.type_comment)
             old_in_FunctionDef = self._in_FunctionDef
             self._in_FunctionDef = True
             with self._NewScopeCtx(unhide_classdef=True):
                 if not self._in_class_def:
                     self._visit_Store(node.name)
@@ -679,17 +667,15 @@
             node = ast.parse(typecomment, mode='func_type')
         else:
             node = ast.parse(typecomment)
 
         self.visit(node)
 
     def visit_arguments(self, node):
-        if PY2:
-            assert node._fields == ('args', 'vararg', 'kwarg', 'defaults'), node._fields
-        elif sys.version_info >= (3, 8):
+        if sys.version_info >= (3, 8):
             assert node._fields == ('posonlyargs', 'args', 'vararg', 'kwonlyargs', 'kw_defaults', 'kwarg', 'defaults'), node._fields
         else:
             assert node._fields == ('args', 'vararg', 'kwonlyargs', 'kw_defaults', 'kwarg', 'defaults'), node._fields
         # Argument/parameter list.  Note that the defaults should be
         # considered "Load"s from the upper scope, and the argument names are
         # "Store"s in the function scope.
 
@@ -697,45 +683,38 @@
         #    def f(x=y, y=x): pass
         # Both x and y should be considered undefined (unless they were indeed
         # defined before the def).
         # We assume visit_arguments is always called from a _NewScopeCtx
         # context
         with self._UpScopeCtx():
             self.visit(node.defaults)
-            if PY3:
-                for i in node.kw_defaults:
-                    if i:
-                        self.visit(i)
+            for i in node.kw_defaults:
+                if i:
+                    self.visit(i)
         # Store arg names.
         self.visit(node.args)
-        if PY3:
-            self.visit(node.kwonlyargs)
+        self.visit(node.kwonlyargs)
         if sys.version_info >= (3, 8):
             self.visit(node.posonlyargs)
         # may be None.
-        if node.vararg and PY3:
+        if node.vararg:
             self.visit(node.vararg)
         else:
             self._visit_Store(node.vararg)
-        if node.kwarg and PY3:
+        if node.kwarg:
             self.visit(node.kwarg)
         else:
             self._visit_Store(node.kwarg)
 
     def visit_ExceptHandler(self, node):
         assert node._fields == ('type', 'name', 'body')
         if node.type:
             self.visit(node.type)
         if node.name:
-            # ExceptHandler.name is a string in Python 3 and a Name with Store in
-            # Python 2
-            if PY3:
-                self._visit_Store(node.name)
-            else:
-                self.visit(node.name)
+            self._visit_Store(node.name)
         self.visit(node.body)
 
     def visit_Dict(self, node):
         assert node._fields == ('keys', 'values')
         # In Python 3, keys can be None, indicating a ** expression
         for key in node.keys:
             if key:
@@ -767,47 +746,43 @@
         # visit the comprehension node(s) before the elt node.
         # (generic_visit() would visit the elt first, because that comes first
         # in ListComp._fields).
         # For Python2, we intentionally don't enter a new scope here, because
         # a list comprehensive _does_ leak variables out of its scope (unlike
         # generator expressions).
         # For Python3, we do need to enter a new scope here.
-        if PY3:
-            with self._NewScopeCtx(include_class_scopes=True):
-                self.visit(node.generators)
-                self.visit(node.elt)
-        else:
+        with self._NewScopeCtx(include_class_scopes=True):
             self.visit(node.generators)
             self.visit(node.elt)
 
     def visit_DictComp(self, node):
         # Visit a dict comprehension node.
         # This is similar to the generic visit, except:
         #  - We visit the comprehension node(s) before the elt node.
         #  - We create a new scope for the variables.
-        # We do enter a new scope (for both py2 and py3).  A dict comprehension
+        # We do enter a new scope.  A dict comprehension
         # does _not_ leak variables out of its scope (unlike py2 list
         # comprehensions).
         with self._NewScopeCtx(include_class_scopes=True):
             self.visit(node.generators)
             self.visit(node.key)
             self.visit(node.value)
 
     def visit_SetComp(self, node):
         # Visit a set comprehension node.
-        # We do enter a new scope (for both py2 and py3).  A set comprehension
+        # We do enter a new scope.  A set comprehension
         # does _not_ leak variables out of its scope (unlike py2 list
         # comprehensions).
         with self._NewScopeCtx(include_class_scopes=True):
             self.visit(node.generators)
             self.visit(node.elt)
 
     def visit_GeneratorExp(self, node):
         # Visit a generator expression node.
-        # We do enter a new scope (for both py2 and py3).  A generator
+        # We do enter a new scope.  A generator
         # expression does _not_ leak variables out of its scope (unlike py2
         # list comprehensions).
         with self._NewScopeCtx(include_class_scopes=True):
             self.visit(node.generators)
             self.visit(node.elt)
 
     def visit_ImportFrom(self, node):
@@ -828,15 +803,14 @@
         self.generic_visit(node)
 
     def visit_Name(self, node):
         logger.debug("visit_Name(%r)", node.id)
         self._visit_fullname(node.id, node.ctx)
 
     def visit_arg(self, node):
-        assert not PY2
         if sys.version_info >= (3, 8):
             assert node._fields == ('arg', 'annotation', 'type_comment'), node._fields
         else:
             assert node._fields == ('arg', 'annotation'), node._fields
         if node.annotation:
             self.visit(node.annotation)
         # Treat it like a Name node would from Python 2
@@ -890,33 +864,51 @@
         self._visit_Store(name, value)
 
     def _visit_Store(self, fullname, value=None):
         logger.debug("_visit_Store(%r)", fullname)
         if fullname is None:
             return
         scope = self.scopestack[-1]
-        if PY3 and isinstance(fullname, ast.arg):
+        if isinstance(fullname, ast.arg):
             fullname = fullname.arg
         if self.unused_imports is not None:
             if fullname != '*':
                 # If we're storing "foo.bar.baz = 123", then "foo" and
                 # "foo.bar" have now been used and the import should not be
                 # removed.
                 for ancestor in DottedIdentifier(fullname).prefixes[:-1]:
                     if symbol_needs_import(ancestor, self.scopestack):
-                        m = (self._lineno, DottedIdentifier(fullname))
+                        m = (self._lineno, DottedIdentifier(fullname, scope_info=self._get_scope_info()))
                         if m not in self.missing_imports:
                             self.missing_imports.append(m)
             # If we're redefining something, and it has not been used, then
             # record it as unused.
             oldvalue = scope.get(fullname)
             if isinstance(oldvalue, _UseChecker) and not oldvalue.used:
                 self.unused_imports.append((oldvalue.lineno, oldvalue.source))
         scope[fullname] = value
 
+    def _remove_from_missing_imports(self, fullname):
+        for missing_import in self.missing_imports:
+            # If it was defined inside a class method, then it wouldn't have been added to
+            # the missing imports anyways.
+            # See the following tests:
+            # - tests.test_autoimp.test_method_reference_current_class
+            # - tests.test_autoimp.test_find_missing_imports_class_name_1
+            # - tests.test_autoimp.test_scan_for_import_issues_class_defined_after_use
+            inside_class = missing_import[1].scope_info.get('_in_class_def')
+            if missing_import[1].startswith(fullname) and not inside_class:
+                self.missing_imports.remove(missing_import)
+
+    def _get_scope_info(self):
+        return {
+            "scopestack": self.scopestack,
+            "_in_class_def": self._in_class_def,
+        }
+
     def visit_Delete(self, node):
         scope = self.scopestack[-1]
         for target in node.targets:
             if isinstance(target, ast.Name):
                 # 'del foo'
                 if target.id not in scope:
                     # 'del x' without 'x' in current scope.  Should we warn?
@@ -996,16 +988,15 @@
         Check if the symbol needs import.  (As a side effect, if the object
         is a _UseChecker, this will mark it as used.
 
         TODO: It would be
         better to refactor symbol_needs_import so that it just returns the
         object it found, and we mark it as used here.)
         """
-
-        fullname = DottedIdentifier(fullname)
+        fullname = DottedIdentifier(fullname, scope_info=self._get_scope_info())
         if symbol_needs_import(fullname, scopestack) and not scopestack.has_star_import():
             if (lineno, fullname) not in self.missing_imports:
                 self.missing_imports.append((lineno, fullname))
 
     def _finish_deferred_load_checks(self):
         for fullname, scopestack, lineno in self._deferred_load_checks:
             self._check_load(fullname, scopestack, lineno)
@@ -1143,15 +1134,15 @@
     if not isinstance(co, types.CodeType):
         raise TypeError(
             "_find_loads_without_stores_in_code(): expected a CodeType; got a %s"
             % (type(co).__name__,))
     # Initialize local constants for fast access.
     from opcode import HAVE_ARGUMENT, EXTENDED_ARG, opmap
     LOAD_ATTR    = opmap['LOAD_ATTR']
-    LOAD_METHOD = opmap['LOAD_METHOD'] if PY3 else None
+    LOAD_METHOD = opmap['LOAD_METHOD']
     LOAD_GLOBAL  = opmap['LOAD_GLOBAL']
     LOAD_NAME    = opmap['LOAD_NAME']
     STORE_ATTR   = opmap['STORE_ATTR']
     STORE_GLOBAL = opmap['STORE_GLOBAL']
     STORE_NAME   = opmap['STORE_NAME']
     # Keep track of the partial name so far that started with a LOAD_GLOBAL.
     # If ``pending`` is not None, then it is a list representing the name
@@ -1242,28 +1233,20 @@
     earliest_backjump_label = _find_earliest_backjump_label(bytecode)
     # Loop through bytecode.
     while i < n:
         c = bytecode[i]
         op = _op(c)
         i += 1
         if op >= HAVE_ARGUMENT:
-            if PY2:
-                oparg = _op(bytecode[i]) + _op(bytecode[i+1])*256 + extended_arg
-                extended_arg = 0
-                i = i+2
-                if op == EXTENDED_ARG:
-                    extended_arg = oparg*65536
-                    continue
-            else:
-                oparg = bytecode[i] | extended_arg
-                extended_arg = 0
-                if op == EXTENDED_ARG:
-                    extended_arg = (oparg << 8)
-                    continue
-                i += 1
+            oparg = bytecode[i] | extended_arg
+            extended_arg = 0
+            if op == EXTENDED_ARG:
+                extended_arg = (oparg << 8)
+                continue
+            i += 1
 
         if pending is not None:
             if op == STORE_ATTR:
                 # {LOAD_GLOBAL|LOAD_NAME} {LOAD_ATTR}* {STORE_ATTR}
                 pending.append(co.co_names[oparg])
                 fullname = ".".join(pending)
                 pending = None
@@ -1351,17 +1334,14 @@
     # Recurse on inner function definitions, lambdas, generators, etc.
     for arg in co.co_consts:
         if isinstance(arg, types.CodeType):
             _find_loads_without_stores_in_code(arg, loads_without_stores)
 
 
 def _op(c):
-    # bytecode is bytes in Python 3, which when indexed gives integers
-    if PY2:
-        return ord(c)
     return c
 
 
 def _find_earliest_backjump_label(bytecode):
     """
     Find the earliest target of a backward jump.
 
@@ -1374,52 +1354,14 @@
       ...         foo2()
       ...     else:
       ...         foo3()
       ...     foo4()
       ...     while foo5():  # L7
       ...         foo6()
 
-    In python 2.6, the disassembled bytecode is::
-
-      >>> import dis
-      >>> dis.dis(f) # doctest: +SKIP
-        2           0 LOAD_GLOBAL              0 (foo1)
-                    3 CALL_FUNCTION            0
-                    6 JUMP_IF_FALSE           11 (to 20)
-                    9 POP_TOP
-      <BLANKLINE>
-        3          10 LOAD_GLOBAL              1 (foo2)
-                   13 CALL_FUNCTION            0
-                   16 POP_TOP
-                   17 JUMP_FORWARD             8 (to 28)
-              >>   20 POP_TOP
-      <BLANKLINE>
-        5          21 LOAD_GLOBAL              2 (foo3)
-                   24 CALL_FUNCTION            0
-                   27 POP_TOP
-      <BLANKLINE>
-        6     >>   28 LOAD_GLOBAL              3 (foo4)
-                   31 CALL_FUNCTION            0
-                   34 POP_TOP
-      <BLANKLINE>
-        7          35 SETUP_LOOP              22 (to 60)
-              >>   38 LOAD_GLOBAL              4 (foo5)
-                   41 CALL_FUNCTION            0
-                   44 JUMP_IF_FALSE           11 (to 58)
-                   47 POP_TOP
-      <BLANKLINE>
-        8          48 LOAD_GLOBAL              5 (foo6)
-                   51 CALL_FUNCTION            0
-                   54 POP_TOP
-                   55 JUMP_ABSOLUTE           38
-              >>   58 POP_TOP
-                   59 POP_BLOCK
-              >>   60 LOAD_CONST               0 (None)
-                   63 RETURN_VALUE
-
     The earliest target of a backward jump would be the 'while' loop at L7, at
     bytecode offset 38::
 
       >>> _find_earliest_backjump_label(f.__code__.co_code) # doctest: +SKIP
       38
 
     Note that in this example there are earlier targets of jumps at bytecode
@@ -1526,25 +1468,18 @@
       []
 
     but this example, ``x`` is undefined at global scope::
 
       >>> [str(m) for m in find_missing_imports("(lambda x: x*x)(7) + x", [{}])]
       ['x']
 
-    The (unintuitive) rules for generator expressions and list comprehensions
-    in Python 2 are handled correctly::
-
       >>> # Python 3
       >>> [str(m) for m in find_missing_imports("[x+y+z for x,y in [(1,2)]], y", [{}])] # doctest: +SKIP
       ['y', 'z']
 
-      >>> # Python 2
-      >>> [str(m) for m in find_missing_imports("[x+y+z for x,y in [(1,2)]], y", [{}])] # doctest: +SKIP
-      ['z']
-
       >>> [str(m) for m in find_missing_imports("(x+y+z for x,y in [(1,2)]), y", [{}])]
       ['y', 'z']
 
     Only fully-qualified names starting at top-level are included::
 
       >>> [str(m) for m in find_missing_imports("( ( a . b ) . x ) . y + ( c + d ) . x . y", [{}])]
       ['a.b.x.y', 'c', 'd']
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_cmdline.py` & `pyflyby-1.8.5/lib/python/pyflyby/_cmdline.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,18 +1,16 @@
 # pyflyby/_cmdline.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import optparse
 import os
 import signal
-import six
 from   six                      import reraise
 from   six.moves                import input
 import sys
 from   textwrap                 import dedent
 import traceback
 
 
@@ -352,32 +350,26 @@
         self._tmpfiles.append(f)
         return f, Filename(f.name)
 
 
     @cached_attribute
     def output_content_filename(self):
         f, fname = self._tempfile()
-        if six.PY3:
-            f.write(bytes(self.output_content.joined, "utf-8"))
-        else:
-            f.write(self.output_content.joined.encode('utf-8'))
+        f.write(bytes(self.output_content.joined, "utf-8"))
         f.flush()
         return fname
 
     @cached_attribute
     def input_content_filename(self):
         if isinstance(self.filename, Filename):
             return self.filename
         # If the input was stdin, and the user wants a diff, then we need to
         # write it to a temp file.
         f, fname = self._tempfile()
-        if six.PY3:
-            f.write(bytes(self.input_content, "utf-8"))
-        else:
-            f.write(self.input_content)
+        f.write(bytes(self.input_content, "utf-8"))
         f.flush()
         return fname
 
 
     def __del__(self):
         for f in self._tmpfiles:
             f.close()
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_comms.py` & `pyflyby-1.8.5/lib/python/pyflyby/_comms.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-from __future__ import absolute_import, division, print_function
 
 from   pyflyby._log             import logger
 from   pyflyby._imports2s       import SourceToSourceFileImportsTransformation
 from   pyflyby._importstmt      import Import
 import six
 
 # These are comm targets that the frontend (lab/notebook) is expected to
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_dbg.py` & `pyflyby-1.8.5/lib/python/pyflyby/_dbg.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,31 +1,27 @@
 # pyflyby/_dbg.py.
 # Copyright (C) 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   contextlib               import contextmanager
 import errno
 from   functools                import wraps
 import os
 import pwd
 import signal
 import sys
 import time
 from   types                    import CodeType, FrameType, TracebackType
 
 import six
 from   six.moves                import builtins
 
-if six.PY3:
-    from   collections.abc          import Callable
-else:
-    from   collections              import Callable
+from   collections.abc          import Callable
 
 from   pyflyby._file            import Filename
 
 
 """
 Used by wait_for_debugger_to_attach to record whether we're waiting to attach,
 and if so what.
@@ -288,18 +284,19 @@
             break
 
         if response.lower() not in ('y', 'yes'):
             print("Invalid response: {}".format(repr(response)))
             count_invalid += 1
         else:
             break
-    print("Exiting after {} invalid responses.".format(max_invalid_entries))
-    _waiting_for_debugger = None
-    # Sleep for a fraction of second for the print statements to get printed.
-    time.sleep(0.01)
+    else:
+        print("Exiting after {} invalid responses.".format(max_invalid_entries))
+        _waiting_for_debugger = None
+        # Sleep for a fraction of second for the print statements to get printed.
+        time.sleep(0.01)
 
 
 def _debug_exception(*exc_info, **kwargs):
     """
     Debug an exception -- print a stack trace and enter the debugger.
 
     Suitable to be assigned to sys.excepthook.
@@ -1176,27 +1173,20 @@
     # with the same name as a built-in module could exist in `pyflyby_dir`.
     # Adding `pyflyby_dir` to sys.path will make the package get imported from
     # `pyflyby_dir` instead of deferring this decision to the user Python
     # environment.
     #
     # As a concrete example, `typing` module is a package as well a built-in
     # module from Python version >= 3.5
-    if six.PY2:
-        statements = [(
-            "location = __import__('imp').find_module('pyflyby', ['{pyflyby_dir}'])"
-            .format(pyflyby_dir=pyflyby_lib_path)),
-            "pyflyby = __import__('pkgutil').ImpLoader('pyflyby', *location).load_module('pyflyby')"
-            ]
-    else:
-        statements = [
-            "loader = __import__('importlib').machinery.PathFinder.find_module("
-            "fullname='pyflyby', path=['{pyflyby_dir}'])".format(
-                pyflyby_dir=pyflyby_lib_path),
-            "pyflyby = loader.load_module('pyflyby')"
-        ]
+    statements = [
+        "loader = __import__('importlib').machinery.PathFinder.find_module("
+        "fullname='pyflyby', path=['{pyflyby_dir}'])".format(
+            pyflyby_dir=pyflyby_lib_path),
+        "pyflyby = loader.load_module('pyflyby')"
+    ]
     statements.append(
         ("pyflyby.debugger(tty=%r, on_continue=%s)"
          % (terminal.ttyname, on_continue))
         )
 
     gdb_pid = inject(pid, statements=";".join(statements), wait=False)
     # Fork a watchdog process to make sure we exit if the target process or
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_docxref.py` & `pyflyby-1.8.5/lib/python/pyflyby/_docxref.py`

 * *Files 1% similar despite different names*

```diff
@@ -20,16 +20,14 @@
 #   implied, including but not limited to the warranties of merchantability,
 #   fitness for a particular purpose and noninfringement. In no event shall
 #   the authors or copyright holders be liable for any claim, damages or other
 #   liability, whether in an action of contract, tort or otherwise, arising
 #   from, out of or in connection with the software or the use or other
 #   dealings in the software.
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
 
 import re
 import six
 from   six.moves                import builtins
 from   textwrap                 import dedent
 
 from   epydoc.apidoc            import (ClassDoc, ModuleDoc, PropertyDoc,
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_file.py` & `pyflyby-1.8.5/lib/python/pyflyby/_file.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,25 +1,25 @@
 # pyflyby/_file.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   functools                import total_ordering
 import io
 import os
 import re
 import six
 import sys
 
 from   six                      import string_types
 
 from   pyflyby._util            import cached_attribute, cmp, memoize
 
+
 class UnsafeFilenameError(ValueError):
     pass
 
 
 # TODO: statcache
 
 @total_ordering
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_flags.py` & `pyflyby-1.8.5/lib/python/pyflyby/_flags.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/_flags.py.
 # Copyright (C) 2011, 2012, 2013, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import __future__
 import ast
 import operator
 import six
 from   six.moves                import reduce
 import warnings
@@ -41,23 +40,14 @@
 
       >>> print(CompilerFlags(0x10000, 0x8000).__interactive_display__()) # doctest: +SKIP
       CompilerFlags(0x18000) # from __future__ import with_statement, print_function
 
       >>> print(CompilerFlags('with_statement', 'print_function').__interactive_display__()) # doctest: +SKIP
       CompilerFlags(0x18000) # from __future__ import with_statement, print_function
 
-    This can be used as an argument to the built-in compile() function. For
-    instance, in Python 2::
-
-      >>> compile("print('x', file=None)", "?", "exec", flags=0, dont_inherit=1) #doctest:+SKIP
-      Traceback (most recent call last):
-
-        ...
-      SyntaxError: invalid syntax
-
       >>> compile("print('x', file=None)", "?", "exec", flags=CompilerFlags("print_function"), dont_inherit=1) #doctest:+ELLIPSIS
       <code object ...>
 
     """
 
     def __new__(cls, *args):
         """
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_format.py` & `pyflyby-1.8.5/lib/python/pyflyby/_format.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/_format.py.
 # Copyright (C) 2011, 2012, 2013, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import six
 
 
 class FormatParams(object):
     max_line_length = 79
     wrap_paren = True
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_idents.py` & `pyflyby-1.8.5/lib/python/pyflyby/_idents.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,27 +1,24 @@
 # pyflyby/_idents.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   functools                import total_ordering
 from   keyword                  import kwlist
 import re
 import six
 
 from   pyflyby._util            import cached_attribute, cmp
 
 
 # Don't consider "print" a keyword, in order to be compatible with user code
 # that uses "from __future__ import print_function".
 _my_kwlist = list(kwlist)
-if six.PY2:
-    _my_kwlist.remove("print")
 _my_iskeyword = frozenset(_my_kwlist).__contains__
 
 
 # TODO: use DottedIdentifier.prefixes
 def dotted_prefixes(dotted_name, reverse=False):
     """
     Return the prefixes of a dotted name.
@@ -113,41 +110,19 @@
       valid identifier.
     :rtype:
       ``bool``
     """
     if not isinstance(s, six.string_types):
         raise TypeError("is_identifier(): expected a string; got a %s"
                         % (type(s).__name__,))
-    if six.PY3:
-        if prefix:
-            return is_identifier(s + '_', dotted=dotted, prefix=False)
-        if dotted:
-            return all(is_identifier(w, dotted=False) for w in s.split('.'))
-        return s.isidentifier() and not _my_iskeyword(s)
-
     if prefix:
-        if not s:
-            return True
-        if dotted:
-            return bool(
-                _dotted_name_prefix_re.match(s) and
-                not any(_my_iskeyword(w) for w in s.split(".")[:-1]))
-        else:
-            return bool(_name_re.match(s))
-    else:
-        if dotted:
-            # Use a regular expression that works for dotted names.  (As an
-            # alternate implementation, one could imagine calling
-            # all(is_identifier(w) for w in s.split(".")).  We don't do that
-            # because s could be a long text string.)
-            return bool(
-                _dotted_name_re.match(s) and
-                not any(_my_iskeyword(w) for w in s.split(".")))
-        else:
-            return bool(_name_re.match(s) and not _my_iskeyword(s))
+        return is_identifier(s + '_', dotted=dotted, prefix=False)
+    if dotted:
+        return all(is_identifier(w, dotted=False) for w in s.split('.'))
+    return s.isidentifier() and not _my_iskeyword(s)
 
 
 def brace_identifiers(text):
     """
     Parse a string and yield all tokens of the form "{some_token}".
 
       >>> list(brace_identifiers("{salutation}, {your_name}."))
@@ -162,28 +137,30 @@
 class BadDottedIdentifierError(ValueError):
     pass
 
 
 # TODO: Use in various places, esp where e.g. dotted_prefixes is used.
 @total_ordering
 class DottedIdentifier(object):
-    def __new__(cls, arg):
+    def __new__(cls, arg, scope_info=None):
         if isinstance(arg, cls):
             return arg
         if isinstance(arg, six.string_types):
-            return cls._from_name(arg)
+            return cls._from_name(arg, scope_info)
         if isinstance(arg, (tuple, list)):
-            return cls._from_name(".".join(arg))
+            return cls._from_name(".".join(arg), scope_info)
         raise TypeError("DottedIdentifier: unexpected %s"
                         % (type(arg).__name__,))
 
     @classmethod
-    def _from_name(cls, name):
+    def _from_name(cls, name, scope_info=None):
         self = object.__new__(cls)
         self.name = str(name)
+        # TODO: change magic methods to compare with scopestack included
+        self.scope_info = scope_info
         if not is_identifier(self.name, dotted=True):
             if len(self.name) > 20:
                 raise BadDottedIdentifierError("Invalid python symbol name")
             else:
                 raise BadDottedIdentifierError("Invalid python symbol name %r"
                                                % (name,))
         self.parts = tuple(self.name.split('.'))
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_importclns.py` & `pyflyby-1.8.5/lib/python/pyflyby/_importclns.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/_importclns.py.
 # Copyright (C) 2011, 2012, 2013, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   collections              import defaultdict
 from   functools                import total_ordering
 import six
 
 from   pyflyby._flags           import CompilerFlags
 from   pyflyby._idents          import dotted_prefixes, is_identifier
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_importdb.py` & `pyflyby-1.8.5/lib/python/pyflyby/_importdb.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,20 +1,19 @@
 # pyflyby/_importdb.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   collections              import defaultdict
 import os
 import re
 import six
 
-from   pyflyby._file            import Filename, expand_py_files_from_args
+from pyflyby._file import Filename, expand_py_files_from_args, UnsafeFilenameError
 from   pyflyby._idents          import dotted_prefixes
 from   pyflyby._importclns      import ImportMap, ImportSet
 from   pyflyby._importstmt      import Import, ImportStatement
 from   pyflyby._log             import logger
 from   pyflyby._parse           import PythonBlock
 from   pyflyby._util            import cached_attribute, memoize, stable_unique
 
@@ -157,16 +156,20 @@
         pathnames = [pathnames]
     result = []
     for pathname in pathnames:
         if not pathname.startswith(".../"):
             result.append(Filename(pathname))
             continue
         suffix = pathname[4:]
-        expanded = [
-            p / suffix for p in _ancestors_on_same_partition(target_dirname) ]
+        expanded = []
+        for p in _ancestors_on_same_partition(target_dirname):
+            try:
+                expanded.append(p / suffix)
+            except UnsafeFilenameError:
+                continue
         result.extend(expanded[::-1])
     return result
 
 
 class ImportDB(object):
     """
     A database of known, mandatory, canonical imports.
@@ -261,15 +264,18 @@
             try:
                 return cls._default_cache[cache_keys[-1]]
             except KeyError:
                 pass
             if target_dirname.isdir:
                 break
             target_dirname = target_dirname.dir
-        target_dirname = target_dirname.real
+        try:
+            target_dirname = target_dirname.real
+        except UnsafeFilenameError:
+            pass
         if target_dirname != cache_keys[-1][0]:
             cache_keys.append((1,
                                target_dirname,
                                os.getenv("PYFLYBY_PATH"),
                                os.getenv("PYFLYBY_KNOWN_IMPORTS_PATH"),
                                os.getenv("PYFLYBY_MANDATORY_IMPORTS_PATH")))
             try:
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_imports2s.py` & `pyflyby-1.8.5/lib/python/pyflyby/_imports2s.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/_imports2s.py.
 # Copyright (C) 2011-2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   pyflyby._autoimp         import scan_for_import_issues
 from   pyflyby._file            import FileText, Filename
 from   pyflyby._flags           import CompilerFlags
 from   pyflyby._importclns      import ImportSet, NoSuchImportError
 from   pyflyby._importdb        import ImportDB
 from   pyflyby._importstmt      import ImportFormatParams, ImportStatement
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_importstmt.py` & `pyflyby-1.8.5/lib/python/pyflyby/_importstmt.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/_importstmt.py.
 # Copyright (C) 2011, 2012, 2013, 2014 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import ast
 from   collections              import namedtuple
 from   functools                import total_ordering
 
 from   pyflyby._flags           import CompilerFlags
 from   pyflyby._format          import FormatParams, pyfill
@@ -306,25 +305,23 @@
     def __lt__(self, other):
         if self is other:
             return False
         if not isinstance(other, Import):
             return NotImplemented
         return self._data < other._data
 
-def _interpret_alias(arg):
-    if isinstance(arg, str):
-        return (arg, None)
-    if not isinstance(arg, tuple):
-        raise TypeError('`arg` must be a tuple, got {}'.format(type(arg)))
-    if not len(arg) == 2:
-        raise TypeError('`arg` must be of len 2, got {} elements'.format(len(arg)))
-    if not isinstance(arg[0], str):
-        raise TypeError('`arg[0]` must be a str, got {}'.format(type(arg[0])))
-    if not (arg[1] is None or isinstance(arg[1], str)):
-        raise TypeError('arg[1] is None, or arg[1] is str {} '.format(arg))
+def _validate_alias(arg):
+    """
+    Ensure each alias is a tuple (str, None|str), and return it.
+
+    """
+    assert isinstance(arg, tuple)
+    a0,a1 = arg
+    assert isinstance(a0, str)
+    assert isinstance(a1, (str, type(None)))
     return arg
 
 @total_ordering
 class ImportStatement(object):
     """
     Token-level representation of an import statement containing multiple
     imports from a single module.  Corresponds to an ``ast.ImportFrom`` or
@@ -342,19 +339,20 @@
         if isinstance(arg, (tuple, list)) and len(arg):
             if isinstance(arg[0], Import):
                 return cls._from_imports(arg)
         raise TypeError
 
     @classmethod
     def from_parts(cls, fromname, aliases):
+        assert isinstance(aliases, list)
+        assert len(aliases) > 0
+        
         self = object.__new__(cls)
         self.fromname = fromname
-        if not len(aliases):
-            raise ValueError
-        self.aliases = tuple(_interpret_alias(a) for a in aliases)
+        self.aliases = tuple(_validate_alias(a) for a in aliases)
         return self
 
     @classmethod
     def _from_statement(cls, statement):
         """
           >>> ImportStatement._from_statement("from foo  import bar, bar2, bar")
           ImportStatement('from foo import bar, bar2, bar')
@@ -387,28 +385,26 @@
         """
         Construct an `ImportStatement` from an `ast` node.
 
         :rtype:
           `ImportStatement`
         """
         if isinstance(node, ast.ImportFrom):
-            if isinstance(node.module, str):
-                module = node.module
-            elif node.module is None:
-                # In python2.7, ast.parse("from . import blah") yields
-                # node.module = None.  In python2.6, it's the empty string.
+            if node.module is None:
                 module = ''
             else:
-                raise TypeError("unexpected node.module=%s"
-                                % type(node.module).__name__)
+                assert isinstance(node.module, str)
+                module = node.module
             fromname = '.' * node.level + module
         elif isinstance(node, ast.Import):
             fromname = None
         else:
-            raise NonImportStatementError
+            raise NonImportStatementError(
+                    'Expected ImportStatement, got {node}'.format(node=node)
+                    )
         aliases = [ (alias.name, alias.asname) for alias in node.names ]
         return cls.from_parts(fromname, aliases)
 
     @classmethod
     def _from_imports(cls, imports):
         """
         Construct an `ImportStatement` from a sequence of ``Import`` s.  They
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_interactive.py` & `pyflyby-1.8.5/lib/python/pyflyby/_interactive.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,25 +1,23 @@
 # pyflyby/_interactive.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import ast
 from   contextlib               import contextmanager
 import errno
 import inspect
 import os
 import re
 import subprocess
 import sys
 
 import six
-from   six                      import PY2, text_type as unicode
 from   six.moves                import builtins
 
 from   pyflyby._autoimp         import (LoadSymbolError, ScopeStack, auto_eval,
                                         auto_import,
                                         clear_failed_imports_cache,
                                         load_symbol)
 from   pyflyby._comms           import (initialize_comms, remove_comms,
@@ -1068,16 +1066,14 @@
             pmodule = ModuleHandle(pname)
             # Add importable submodules.
             results.update([m.name.parts[-1] for m in pmodule.submodules])
         results = sorted([r for r in results if r.startswith(attrname)])
         results = ["%s.%s" % (pname, r) for r in results]
     else:
         raise AssertionError
-    if six.PY2:
-        results = [unicode(s) for s in results]
     logger.debug("complete_symbol(%r) => %r", fullname, results)
     return results
 
 
 def _list_members_for_completion(obj, ip):
     """
     Enumerate the existing member attributes of an object.
@@ -2312,33 +2308,14 @@
         """
         Enable some advice that's actually just fixing bugs in IPython.
         """
         # IPython 2.x on Python 2.x has a bug where 'run -n' doesn't work
         # because it uses Unicode for the module name.  This is a bug in
         # IPython itself ("run -n" is plain broken for ipython-2.x on
         # python-2.x); we patch it here.
-        if (PY2 and
-            hasattr(ip, "new_main_mod")):
-            try:
-                args = inspect.getargspec(ip.new_main_mod).args
-            except Exception:
-                # getargspec fails if we already advised.
-                # For now just skip under the assumption that we already
-                # advised (or the code changed in some way that doesn't
-                # require advising?)
-                # Minor todo: Ideally we would be relying on _advise to check
-                # that we haven't already advised.
-                args = None
-            if args == ["self","filename","modname"]:
-                @self._advise(ip.new_main_mod)
-                def new_main_mod_fix_str(filename, modname):
-                    if six.PY2:
-                        if type(modname) is unicode:
-                            modname = str(modname)
-                    return __original__(filename, modname)
         return True
 
     def _enable_ipython_bugfixes(self):
         """
         Enable some advice that's actually just fixing bugs in IPython.
         """
         ok = True
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_livepatch.py` & `pyflyby-1.8.5/lib/python/pyflyby/_livepatch.py`

 * *Files 2% similar despite different names*

```diff
@@ -125,26 +125,24 @@
           result._my_cache.update(keep_cache)
           return result
 
 XXX test
 
 """
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import ast
 import os
 import re
 import six
 import sys
 import time
 import types
 
-from   six                      import PY2
 from   six.moves                import reload_module
 
 import inspect
 from   pyflyby._log             import logger
 
 
 # Keep track of when the process was started.
@@ -276,42 +274,39 @@
             new=new,
             do_livepatch=do_livepatch,
             modname=modname,
             cache=cache,
             visit_stack=visit_stack)
         # Find out which optional kwargs the hook wants.
         kwargs = {}
-        if PY2:
-            argspec = inspect.getargspec(hook)
-        else:
-            argspec = inspect.getfullargspec(hook)
+        argspec = inspect.getfullargspec(hook)
         argnames = argspec.args
         if hasattr(hook, "__func__"):
             # Skip 'self' arg.
             argnames = argnames[1:]
         # Pick kwargs that are wanted and available.
         args = []
         kwargs = {}
         for n in argnames:
             try:
                 kwargs[n] = avail_kwargs[n]
-                if argspec.keywords if PY2 else argspec.varkw:
+                if argspec.varkw:
                     break
             except KeyError:
                 # For compatibility, allow first argument to be 'old' with any
                 # name, as long as there's no other arg 'old'.
                 # We intentionally allow this even if the user specified
                 # **kwargs.
                 if not args and not kwargs and 'old' not in argnames:
                     args.append(old)
                 else:
                     # Rely on default being set.  If a default isn't set, the
                     # user will get a TypeError.
                     pass
-        if argspec.keywords if PY2 else argspec.varkw:
+        if argspec.varkw:
             # Use all available kwargs.
             kwargs = avail_kwargs
         # Call hook.
         result = hook(*args, **kwargs)
     cache[cachekey] = result
     return result
 
@@ -522,34 +517,22 @@
         livepatch(
             oldobj.__dict__, newobj.__dict__,
             modname=modname, cache=cache, visit_stack=visit_stack)
         return oldobj
     else:
         return newobj
 
-
-if six.PY2:
-    _LIVEPATCH_DISPATCH_TABLE = {
-        object            : _livepatch__object,
-        dict              : _livepatch__dict,
-        type              : _livepatch__class,
-        types.ClassType   : _livepatch__class,
-        types.FunctionType: _livepatch__function,
-        types.MethodType  : _livepatch__method,
-        types.ModuleType  : _livepatch__module,
-    }
-elif six.PY3:
-    _LIVEPATCH_DISPATCH_TABLE = {
-        object            : _livepatch__object,
-        dict              : _livepatch__dict,
-        type              : _livepatch__class,
-        types.FunctionType: _livepatch__function,
-        types.MethodType  : _livepatch__method,
-        types.ModuleType  : _livepatch__module,
-    }
+_LIVEPATCH_DISPATCH_TABLE = {
+    object            : _livepatch__object,
+    dict              : _livepatch__dict,
+    type              : _livepatch__class,
+    types.FunctionType: _livepatch__function,
+    types.MethodType  : _livepatch__method,
+    types.ModuleType  : _livepatch__module,
+}
 
 
 def _get_definition_module(obj):
     """
     Get the name of the module that an object is defined in, or ``None`` if
     unknown.
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_log.py` & `pyflyby-1.8.5/lib/python/pyflyby/_log.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/_log.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   contextlib               import contextmanager
 import logging
 from   logging                  import Handler, Logger
 import os
 from   six.moves                import builtins
 import sys
@@ -154,62 +153,22 @@
     finally:
         if prev is MISSING:
             proxy.__dict__.pop('_do', None)
         else:
             proxy.__dict__ = prev
 
 
-@contextmanager
-def _NoRegisterLoggerHandlerInHandlerListCtx():
-    """
-    Work around a bug in the ``logging`` module for Python 2.x-3.2.
-
-    The Python stdlib ``logging`` module has a bug where you sometimes get the
-    following warning at exit::
-
-      Exception TypeError: "'NoneType' object is not callable" in <function
-      _removeHandlerRef at 0x10a1b3f50> ignored
-
-    This is caused by shutdown ordering affecting which globals in the logging
-    module are available to the _removeHandlerRef function.
-
-    Python 3.3 fixes this.
-
-    For earlier versions of Python, this context manager works around the
-    issue by avoiding registering a handler in the _handlerList.  This means
-    that we no longer call "flush()" from the atexit callback.  However, that
-    was a no-op anyway, and even if we needed it, we could call it ourselves
-    atexit.
-
-    :see:
-      http://bugs.python.org/issue9501
-    """
-    if not hasattr(logging, "_handlerList"):
-        yield
-        return
-    if sys.version_info >= (3, 3):
-        yield
-        return
-    try:
-        orig_handlerList = logging._handlerList[:]
-        yield
-    finally:
-        logging._handlerList[:] = orig_handlerList
-
-
-
 class PyflybyLogger(Logger):
 
     _LEVELS = dict( (k, getattr(logging, k))
                     for k in ['DEBUG', 'INFO', 'WARNING', 'ERROR'] )
 
     def __init__(self, name, level):
         Logger.__init__(self, name)
-        with _NoRegisterLoggerHandlerInHandlerListCtx():
-            handler = _PyflybyHandler()
+        handler = _PyflybyHandler()
         self.addHandler(handler)
         self.set_level(level)
 
     def set_level(self, level):
         """
         Set the pyflyby logger's level to ``level``.
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_modules.py` & `pyflyby-1.8.5/lib/python/pyflyby/_modules.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 # pyflyby/_modules.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   functools                import total_ordering
 import os
 import re
 import six
 from   six                      import reraise
 import sys
@@ -354,15 +353,15 @@
             members = [n for n in members if from_this_module(n)]
         else:
             if not all(type(s) == str for s in members):
                 raise Exception(
                     "Module %r contains non-string entries in __all__"
                     % (str(self.name),))
         # Filter out artificially added "deep" members.
-        members = [n for n in members if "." not in n]
+        members = [(n, None) for n in members if "." not in n]
         if not members:
             return None
         return ImportSet(
             [ ImportStatement.from_parts(str(self.name), members) ])
 
     def __str__(self):
         return str(self.name)
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_parse.py` & `pyflyby-1.8.5/lib/python/pyflyby/_parse.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,38 +1,32 @@
 # pyflyby/_parse.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import ast
 from   collections              import namedtuple
 from   doctest                  import DocTestParser
 from   functools                import total_ordering
 from   itertools                import groupby
 import re
 import sys
 from   textwrap                 import dedent
 import types
 
 import six
-from   six                      import PY2, PY3, text_type as unicode
 from   six.moves                import range
 
 from   pyflyby._file            import FilePos, FileText, Filename
 from   pyflyby._flags           import CompilerFlags
 from   pyflyby._log             import logger
 from   pyflyby._util            import cached_attribute, cmp
 
-if PY3:
-    from ast import Bytes
-else:
-    Bytes = ast.Str
-
+from ast import Bytes
 
 if sys.version_info >= (3, 8):
     from ast import TypeIgnore, AsyncFunctionDef
 else:
 
     # TypeIgnore, AsyncFunctionDef does not exist on Python 3.7 and before. thus
     # we define a dummy TypeIgnore, AsyncFunctionDef just to simplify remaining
@@ -106,18 +100,15 @@
         return
     if not isinstance(node, ast.AST):
         raise TypeError
     if isinstance(node, ast.Dict):
         assert node._fields == ("keys", "values")
         yield list(zip(node.keys, node.values))
     elif isinstance(node, (ast.FunctionDef, AsyncFunctionDef)):
-        if six.PY2:
-            assert node._fields == ('name', 'args', 'body', 'decorator_list'), node._fields
-            yield node.decorator_list, node.args, node.body
-        elif sys.version_info >= (3, 8):
+        if sys.version_info >= (3, 8):
             assert node._fields == (
                 "name",
                 "args",
                 "body",
                 "decorator_list",
                 "returns",
                 "type_comment",
@@ -132,18 +123,15 @@
             yield res
         else:
             assert node._fields == ('name', 'args', 'body', 'decorator_list',
                                     'returns'), node._fields
             yield node.decorator_list, node.args, node.returns, node.body
         # node.name is a string, not an AST node
     elif isinstance(node, ast.arguments):
-        if six.PY2:
-            assert node._fields == ('args', 'vararg', 'kwarg', 'defaults'), node._fields
-            args = node.args
-        elif sys.version_info >= (3, 8):
+        if sys.version_info >= (3, 8):
             assert node._fields == ('posonlyargs', 'args', 'vararg', 'kwonlyargs',
                                     'kw_defaults', 'kwarg', 'defaults'), node._fields
             args = node.posonlyargs + node.args
         else:
             assert node._fields == ('args', 'vararg', 'kwonlyargs',
                                     'kw_defaults', 'kwarg', 'defaults'), node._fields
             args = node.args
@@ -158,18 +146,15 @@
     elif isinstance(node, ast.Call):
         # call arguments order are lost by ast, re-order them
         yield node.func
         args = sorted([(k.value.lineno, k.value.col_offset, k) for k in node.keywords]+
                       [(k.lineno,k.col_offset, k) for k in node.args])
         yield [a[2] for a in args]
     elif isinstance(node, ast.ClassDef):
-        if six.PY2:
-            assert node._fields == ('name', 'bases', 'body', 'decorator_list')
-        else:
-            assert node._fields == ('name', 'bases', 'keywords', 'body', 'decorator_list')
+        assert node._fields == ('name', 'bases', 'keywords', 'body', 'decorator_list')
         yield node.decorator_list, node.bases, node.body
         # node.name is a string, not an AST node
     elif sys.version_info >= (3, 7) and isinstance(node, ast.FormattedValue):
         assert node._fields == ('value', 'conversion', 'format_spec')
         yield node.value,
     else:
         # Default behavior.
@@ -206,17 +191,14 @@
         if re.search(r"# *type:", source):
             flags = flags | CompilerFlags('type_comments')
         yield flags
         return
     if not auto_flags:
         yield flags
         return
-    if PY3:
-        yield flags
-        return
     if mode == "eval":
         if re.search(r"\bprint\b", source):
             flags = flags | CompilerFlags("print_function")
         yield flags
         return
     yield flags
     if re.search(r"\bprint\b", source):
@@ -244,16 +226,14 @@
     :rtype:
       ``ast.Module``
     """
     text = FileText(text)
     filename = str(text.filename) if text.filename else "<unknown>"
     source = text.joined
     source = dedent(source)
-    if PY2 and isinstance(source, unicode):
-        source = source.encode('utf-8')
     if not source.endswith("\n"):
         # Ensure that the last line ends with a newline (``ast`` barfs
         # otherwise).
         source += "\n"
     exp = None
     for flags in _flags_to_try(source, flags, auto_flags, mode):
         cflags = ast.PyCF_ONLY_AST | int(flags)
@@ -279,20 +259,14 @@
     literal, return its value.  Otherwise return ``None``.
 
       >>> _test_parse_string_literal(r'"foo\n" r"\nbar"', None)
       'foo\n\\nbar'
 
     """
     text = FileText(text)
-    if PY2:
-        try:
-            text.joined.encode('ascii')
-        except UnicodeError:
-            text = FileText(u'# encoding: utf-8\n' + unicode(text), filename=text.filename)
-
     try:
         module_node = _parse_ast_nodes(text, flags, False, "eval")
     except SyntaxError:
         return None
     body = module_node.body
     if not isinstance(body, (ast.Str, Bytes)):
         return None
@@ -374,20 +348,16 @@
     """
     assert isinstance(ast_node, (ast.AST, str, TypeIgnore)), ast_node
 
     # joined strings and children do not carry a column offset on pre-3.8
     # this prevent reformatting.
     # set the column offset to the parent value before 3.8
     if (3, 7) < sys.version_info < (3, 8):
-        if (
-            isinstance(ast_node, (getattr(ast, "JoinedStr", None), ast.FormattedValue))
-            or isinstance(
-                parent_ast_node, (getattr(ast, "JoinedStr", None), ast.FormattedValue)
-            )
-        ) and ast_node.col_offset == -1:
+        instances = (getattr(ast, "JoinedStr", None), ast.FormattedValue)
+        if ((isinstance(ast_node, instances) or isinstance(parent_ast_node, instances)) and ast_node.col_offset == -1) or isinstance(ast_node, ast.keyword):
             ast_node.col_offset = parent_ast_node.col_offset
 
     # First, traverse child nodes.  If the first child node (recursively) is a
     # multiline string, then we need to transfer its information to this node.
     # Walk all nodes/fields of the AST.  We implement this as a custom
     # depth-first search instead of using ast.walk() or ast.NodeVisitor
     # so that we can easily keep track of the preceding node's lineno.
@@ -443,18 +413,14 @@
         # a single-line string.)
         # Easy.
         startpos = text.startpos + delta
 
         # Special case for 'with' statements.  Consider the code:
         #    with X: pass
         #    ^0   ^5
-        # In python2.6, col_offset is 0.
-        # In python2.7, col_offset is 5.
-        # This is because python2.7 allows for multiple clauses:
-        #    with X, Y: pass
         # Since 'Y's col_offset isn't the beginning of the line, the authors
         # of Python presumably changed 'X's col_offset to also not be the
         # beginning of the line.  If they had made the With ast node support
         # multiple clauses, they wouldn't have needed to do that, but then
         # that would introduce an API change in the AST.  So it's
         # understandable that they did that.
         # Since we use startpos for breaking lines, we need to set startpos to
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_py.py` & `pyflyby-1.8.5/lib/python/pyflyby/_py.py`

 * *Files 0% similar despite different names*

```diff
@@ -268,16 +268,15 @@
       /usr/local/lib/python2.7/site-packages/pandas/__init__.pyc
     Docstring:
       pandas - a powerful data analysis and manipulation library for Python
       ...
 
 """
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   functools                import total_ordering
 
 from   pyflyby._util            import cmp
 
 usage = """
 py --- command-line python multitool with automatic importing
@@ -395,19 +394,14 @@
     elif isinstance(arg, type):
         if arg.__new__ is not object.__new__:
             argspec = _get_argspec(arg.__new__)
             return ArgSpec(argspec.args[1:], *argspec[1:])
         else:
             argspec = _get_argspec(arg.__init__)
             return ArgSpec(argspec.args[1:], *argspec[1:])
-    # Old style class. Should only run in Python 2. types.ClassType doesn't
-    # exist in Python 3.
-    elif isinstance(arg, getattr(types, 'ClassType', type)):
-        argspec = _get_argspec(arg.__init__)
-        return ArgSpec(argspec.args[1:], *argspec[1:])
     elif _recurse and hasattr(arg, '__call__'):
         return _get_argspec(arg.__call__, _recurse=False)
     elif callable(arg):
         # Unknown, probably a built-in method.
         if sys.version_info[0] == 3:
             return ArgSpec((), "args", "kwargs", None, [], None, {})
         else:
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby/_util.py` & `pyflyby-1.8.5/lib/python/pyflyby/_util.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,28 +1,24 @@
 # pyflyby/_util.py.
 # Copyright (C) 2011, 2012, 2013, 2014, 2015, 2018 Karl Chen.
 # License: MIT http://opensource.org/licenses/MIT
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   contextlib               import contextmanager
 import inspect
 import os
 import six
-from   six                      import PY3, reraise
+from   six                      import reraise
 import sys
 import types
 
 # Python 2/3 compatibility
 DictProxyType = type(object.__dict__)
 
-class Object(object):
-    pass
-
 
 def memoize(function):
     cache = {}
     def wrapped_fn(*args, **kwargs):
         cache_key = (args, tuple(sorted(kwargs.items())))
         try:
             return cache[cache_key]
@@ -252,20 +248,17 @@
                     globals[k] = v
 
     def __getattr__(self, k):
         return getattr(self.__original__, k)
 
 
     def __get__(self, inst, cls=None):
-        if PY3:
-            if inst is None:
-                return self
-            return types.MethodType(self, inst)
-        else:
-            return types.MethodType(self, inst, cls)
+        if inst is None:
+            return self
+        return types.MethodType(self, inst)
 
 
 
 class _WritableDictProxy(object):
     """
     Writable equivalent of cls.__dict__.
     """
@@ -339,50 +332,37 @@
 
     def __init__(self, joinpoint):
         spec = joinpoint
         while hasattr(joinpoint, "__joinpoint__"):
             joinpoint = joinpoint.__joinpoint__
         self._joinpoint = joinpoint
         if (isinstance(joinpoint, (types.FunctionType, six.class_types, type))
-            and not (PY3 and joinpoint.__name__ != joinpoint.__qualname__)):
+            and not (joinpoint.__name__ != joinpoint.__qualname__)):
             self._qname = "%s.%s" % (
                 joinpoint.__module__,
                 joinpoint.__name__)
             self._container = sys.modules[joinpoint.__module__].__dict__
             self._name      = joinpoint.__name__
             self._original  = spec
             assert spec == self._container[self._name], joinpoint
-        elif isinstance(joinpoint, types.MethodType) or (PY3 and isinstance(joinpoint,
+        elif isinstance(joinpoint, types.MethodType) or (isinstance(joinpoint,
             types.FunctionType) and joinpoint.__name__ !=
             joinpoint.__qualname__) or isinstance(joinpoint, property):
             if isinstance(joinpoint, property):
                 joinpoint = joinpoint.fget
                 self._wrapper = property
-            if PY3:
-                self._qname = '%s.%s' % (joinpoint.__module__,
-                                         joinpoint.__qualname__)
-                self._name      = joinpoint.__name__
-            else:
-                self._qname = "%s.%s.%s" % (
-                    joinpoint.__self__.__class__.__module__,
-                    joinpoint.__self__.__class__.__name__,
-                    joinpoint.__func__.__name__)
-                self._name      = joinpoint.__func__.__name__
+            self._qname = '%s.%s' % (joinpoint.__module__,
+                                     joinpoint.__qualname__)
+            self._name      = joinpoint.__name__
             if getattr(joinpoint, '__self__', None) is None:
-                # Unbound method in Python 2 only. In Python 3, there are no unbound methods
-                # (they are just functions).
-                if PY3:
-                    container_obj   = getattr(inspect.getmodule(joinpoint),
-                       joinpoint.__qualname__.split('.<locals>', 1)[0].rsplit('.', 1)[0])
-                else:
-                    container_obj   = joinpoint.im_class
+                container_obj   = getattr(inspect.getmodule(joinpoint),
+                   joinpoint.__qualname__.split('.<locals>', 1)[0].rsplit('.', 1)[0])
+
                 self._container = _WritableDictProxy(container_obj)
-                # __func__ gives the function for the Python 2 unbound method.
-                # In Python 3, spec is already a function.
-                self._original  = getattr(spec, '__func__', spec)
+                self._original  = spec
             else:
                 # Instance method.
                 container_obj   = joinpoint.__self__
                 self._container = container_obj.__dict__
                 self._original  = spec
             assert spec == getattr(container_obj, self._name), (container_obj, self._qname)
             assert self._original == self._container.get(self._name, self._original)
@@ -489,18 +469,14 @@
         advice.unadvise()
 
 # For Python 2/3 compatibility. cmp isn't included with six.
 def cmp(a, b):
     return (a > b) - (a < b)
 
 
-# Create a context manager with an arbitrary number of contexts. This is
-# the same as Py2 contextlib.nested, but that one is removed in Py3.
-if six.PY2:
-    from contextlib import nested
-else:
-    from contextlib import ExitStack
-    @contextmanager
-    def nested(*mgrs):
-        with ExitStack() as stack:
-            ctxes = [stack.enter_context(mgr) for mgr in mgrs]
-            yield ctxes
+# Create a context manager with an arbitrary number of contexts.
+from contextlib import ExitStack
+@contextmanager
+def nested(*mgrs):
+    with ExitStack() as stack:
+        ctxes = [stack.enter_context(mgr) for mgr in mgrs]
+        yield ctxes
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby.egg-info/PKG-INFO` & `pyflyby-1.8.5/lib/python/pyflyby.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: pyflyby
-Version: 1.8.4
+Version: 1.8.5
 Summary: pyflyby - Python development productivity tools, in particular automatic import management
 Home-page: https://pypi.org/project/pyflyby/
 Author: Karl Chen
 Author-email: quarl@8166.clguba.z.quarl.org
 License: MIT
 Project-URL: Documentation, https://deshaw.github.io/pyflyby/
 Project-URL: Source, https://github.com/deshaw/pyflyby
@@ -12,28 +12,28 @@
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Topic :: Software Development
 Classifier: Topic :: Software Development :: Code Generators
 Classifier: Topic :: Software Development :: Interpreters
 Classifier: Intended Audience :: Developers
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Programming Language :: Python
-Requires-Python: >=2.5, !=3.0.*, !=3.1.*, !=3.2.*, !=3.2.*, !=3.3.*, !=3.4.*, !=3.5.*, !=3.6.*, <4
+Requires-Python: >3.0, !=3.0.*, !=3.1.*, !=3.2.*, !=3.2.*, !=3.3.*, !=3.4.*, !=3.5.*, !=3.6.*, <4
 License-File: LICENSE.txt
 
 #########
  Pyflyby
 #########
 
 .. image:: https://badge.fury.io/py/pyflyby.svg
    :target: https://pypi.org/project/pyflyby/
 
 .. image:: https://travis-ci.org/deshaw/pyflyby.png?branch=master
    :target: https://travis-ci.org/deshaw/pyflyby
 
-Pyflyby is a set of Python programming productivity tools for Python 2.7 and 3.7+.
+Pyflyby is a set of Python programming productivity tools for Python 3.7+.
 
 For command-line interaction:
   * ``py``: command-line multitool
 
 For IPython interaction:
   * ``autoimporter``: automatically imports symbols when needed.
 
@@ -253,15 +253,15 @@
 answer if either x or T is a proxy object.
 
 
 Compatibility
 -------------
 
 Tested with:
-  - Python 2.6, 2.7, 3.7, 3.8
+  - Python 3.7, 3.8, 3.9, 3.10
   - IPython 0.10, 0.11, 0.12, 0.13, 1.0, 1.2, 2.0, 2.1, 2.2, 2.3, 2.4, 3.0,
     3.1, 3.2, 4.0., 7.11 (latest)
   - IPython (text console), IPython Notebook, Spyder
 
 
 Details: import libraries
 =========================
```

### Comparing `pyflyby-1.8.4/lib/python/pyflyby.egg-info/SOURCES.txt` & `pyflyby-1.8.5/lib/python/pyflyby.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `pyflyby-1.8.4/libexec/pyflyby/colordiff` & `pyflyby-1.8.5/libexec/pyflyby/colordiff`

 * *Files identical despite different names*

### Comparing `pyflyby-1.8.4/libexec/pyflyby/diff-colorize` & `pyflyby-1.8.5/libexec/pyflyby/diff-colorize`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,9 @@
 #!/usr/bin/env python
 
-from __future__ import absolute_import, division, with_statement
 
 import fileinput
 import os
 import re
 import sys
 
 # TERM could be e.g. xterm-256color or screen-256color.
```

### Comparing `pyflyby-1.8.4/setup.py` & `pyflyby-1.8.5/setup.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,16 +1,15 @@
 #!/usr/bin/env python
 
 # pyflyby/setup.py.
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import glob
 import os
 import re
 from   setuptools               import Command, setup
 from   setuptools.command.test  import test as TestCommand
 from   setuptools.command.sdist  import sdist as SdistCommand
@@ -219,15 +218,15 @@
         "Topic :: Software Development :: Code Generators",
         "Topic :: Software Development :: Interpreters",
         "Intended Audience :: Developers",
         "License :: OSI Approved :: MIT License",
         "Programming Language :: Python",
     ],
     install_requires=["six", "toml", "pathlib ; python_version<'3'"],
-    python_requires=">=2.5, !=3.0.*, !=3.1.*, !=3.2.*, !=3.2.*, !=3.3.*, !=3.4.*, !=3.5.*, !=3.6.*, <4",
+    python_requires=">3.0, !=3.0.*, !=3.1.*, !=3.2.*, !=3.2.*, !=3.3.*, !=3.4.*, !=3.5.*, !=3.6.*, <4",
     tests_require=['pexpect>=3.3', 'pytest', 'epydoc', 'rlipython', 'requests'],
     cmdclass = {
         'test'           : PyTest,
         'sdist'          : SdistAndCheck,
         'collect_imports': CollectImports,
         'tidy_imports'   : TidyImports,
     },
```

### Comparing `pyflyby-1.8.4/tests/test_0testconfig.py` & `pyflyby-1.8.5/tests/test_0testconfig.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,12 +1,11 @@
 
 # Some self tests to check that our test setup is pointing to wrong paths etc.
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import os
 import pytest
 import subprocess
 import sys
 
 import pyflyby
```

### Comparing `pyflyby-1.8.4/tests/test_autoimp.py` & `pyflyby-1.8.5/tests/test_autoimp.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,32 +1,30 @@
 # pyflyby/test_autoimp.py
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import ast
 import os
 import pytest
 from   shutil                   import rmtree
 import sys
 from   tempfile                 import mkdtemp
 from   textwrap                 import dedent
 
-from   six                      import PY2, PY3
-
 from   pyflyby                  import (Filename, ImportDB, auto_eval,
                                         auto_import, find_missing_imports)
 from   pyflyby._autoimp         import (LoadSymbolError, load_symbol,
                                         scan_for_import_issues)
 from   pyflyby._idents          import DottedIdentifier
 from   pyflyby._importstmt      import Import
 from   pyflyby._flags           import CompilerFlags
+from pyflyby._util import CwdCtx
 
 
 @pytest.fixture
 def tpp(request):
     """
     A temporary directory which is temporarily added to sys.path.
     """
@@ -143,18 +141,15 @@
     expected = []
     assert expected == result
 
 
 def test_find_missing_imports_list_comprehension_1():
     result   = find_missing_imports("[x+y+z for x,y in [(1,2)]], y", [{}])
     result   = _dilist2strlist(result)
-    if PY2:
-        expected = ['z']
-    else:
-        expected = ['y', 'z']
+    expected = ['y', 'z']
     assert expected == result
 
 
 def test_find_missing_imports_list_comprehension_nested_tuple_1():
     result   = find_missing_imports("[w+x+y+z for x,(y,z) in []]", [{}])
     result   = _dilist2strlist(result)
     expected = ['w']
@@ -274,17 +269,15 @@
             pass
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['args', 'kwargs', 'y']
     assert expected == result
     
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
+
 def test_find_missing_imports_kwarg_annotate():
     """
     pfb issue 162
     """
     code = dedent("""
         def func_pfb162(args:Dict, **kwargs:Any):
             pass
@@ -719,18 +712,15 @@
             x = []
             g1 = (1 for y1 in x)
             g2 = [1 for y2 in x]
             h = [y1, y2]
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
-    if PY2:
-        expected = ['y1']
-    else:
-        expected = ['y1', 'y2']
+    expected = ['y1', 'y2']
     assert expected == result
 
 
 def test_find_missing_imports_latedef_def_1():
     code = dedent("""
         def marble(x):
             return x + y + z
@@ -864,22 +854,17 @@
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['y']
     assert expected == result
 
 
 def test_find_missing_imports_complex_1():
-    if PY2:
-        code = dedent("""
-            x = 3+4j+5L+k+u'a'
-        """)
-    else:
-        code = dedent("""
-            x = 3+4j+5+k+u'a'
-        """)
+    code = dedent("""
+        x = 3+4j+5+k+u'a'
+    """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['k']
     assert expected == result
 
 
 def test_find_missing_imports_code_1():
@@ -954,181 +939,151 @@
             pass
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = []
     assert expected == result
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
+
 def test_find_missing_imports_keyword_only_args_1():
     code = dedent("""
         def func(*args, kwonly=b):
             a = kwonly
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['b']
     assert expected == result
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
+
 def test_find_missing_imports_keyword_only_args_2():
     code = dedent("""
         def func(*args, kwonly):
             a = kwonly
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = []
     assert expected == result
 
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
 def test_find_missing_imports_keyword_only_args_3():
     code = dedent("""
         def func(*args, kwonly, kwonly2=b):
             a = kwonly
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['b']
     assert expected == result
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
+
 def test_find_missing_imports_annotations_1():
     code = dedent("""
         def func(a: b) -> c:
             d = a
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['b', 'c']
     assert expected == result
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
+
 def test_find_missing_imports_annotations_2():
     code = dedent("""
     a: b = c
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['b', 'c']
     assert expected == result
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
+
 def test_find_missing_imports_star_assignments_1():
     code = dedent("""
     a, *b = c
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['c']
     assert expected == result
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
+
 def test_find_missing_imports_star_expression_1():
     code = dedent("""
     [a, *b]
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['a', 'b']
     assert expected == result
 
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
 def test_find_missing_imports_star_expression_2():
     code = dedent("""
     {a: 1, **b, **{c: 1}}
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['a', 'b', 'c']
     assert expected == result
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
+
 def test_find_missing_imports_star_expression_function_call_1():
     code = dedent("""
     f(a, *b, **c, d=e, **g)
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['a', 'b', 'c', 'e', 'f', 'g']
     assert expected == result
 
 def test_find_missing_imports_star_expression_function_call_2():
-    # Python 2-valid syntax
     code = dedent("""
     f(a, b=c, *d, **e)
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['a', 'c', 'd', 'e', 'f']
     assert expected == result
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
+
 def test_find_missing_imports_python_3_metaclass_1():
     code = dedent("""
     class Test(metaclass=TestMeta):
         pass
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['TestMeta']
     assert expected == result
 
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
 def test_find_missing_imports_f_string_1():
     code = dedent("""
     a = 1
     f'{a + 1} {b + 1}'
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['b']
     assert expected == result
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
+
 def test_find_missing_imports_f_string_2():
     code = dedent("""
     a = 1
     f'{a!s} {b!r}'
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['b']
     assert expected == result
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
+
 def test_find_missing_imports_f_string_3():
     # Recursive format spec
     code = dedent("""
     f'{a:{b}!s}'
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
@@ -1151,85 +1106,73 @@
     """)
     result = find_missing_imports(code, [{}])
     result = _dilist2strlist(result)
     expected = []
     assert expected == result
 
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
 def test_find_missing_imports_matmul_1():
     code = dedent("""
     a@b
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['a', 'b']
     assert expected == result
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
+
 def test_find_missing_imports_async_await_1():
     code = dedent("""
     async def f():
         async with a as b, c as d:
             async for i in e:
                 g = await h()
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['a', 'c', 'e', 'h']
     assert expected == result
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
+
 def test_find_missing_imports_async_comprehension_1():
     code = dedent("""
     async def f():
         [i async for i in range(2)]
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = []
     assert expected == result
 
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
 def test_find_missing_imports_yield_from_1():
     code = dedent("""
     def f():
         yield from g()
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['g']
     assert expected == result
 
 
-@pytest.mark.skipif(PY2, reason="Python 3-only syntax.")
 def test_find_missing_imports_not_async_def():
     code = dedent(
         """
     async def f():
         pass
     f()
     """
     )
     result = find_missing_imports(code, [{}])
     expected = []
     assert expected == result
 
 
 def test_find_missing_imports_nested_with_1():
-    # Handled differently in the ast in Python 2 and 3
     code = dedent("""
     with a as b, c as d:
         pass
     """)
     result   = find_missing_imports(code, [{}])
     result   = _dilist2strlist(result)
     expected = ['a', 'c']
@@ -1681,14 +1624,28 @@
     """)
     missing, unused = scan_for_import_issues(code)
     assert missing == [(5, DottedIdentifier('bb.xx.yy'))]
     # 'cc' should be marked as an unused-import, but 'aa' should be considered
     # used.  (This was buggy before 201907.)
     assert unused == [(2, Import('import cc'))]
 
+
+def test_scan_for_import_issues_class_defined_after_use():
+    code = dedent("""
+    def foo():
+        Bar.counter = 1
+
+    class Bar:
+        counter = 0
+    """)
+    missing, unused = scan_for_import_issues(code)
+    assert missing == []
+    assert unused == []
+
+
 def test_setattr_is_not_unused():
     code = dedent("""
         from a import b
         def f():
             b.xx.yy = 1
 
     """)
@@ -1842,59 +1799,33 @@
     auto_eval("if True: x.append(b64decode('aGVsbG8='))",
               locals=mylocals)
     assert mylocals['x'] == [b'hello']
     assert mylocals["b64decode"] is __import__("base64").b64decode
 
 
 def test_auto_eval_no_auto_flags_ps_flagps_1(capsys):
-    if PY2:
-        auto_eval("print 3.00", flags=None, auto_flags=False)
-        out, _ = capsys.readouterr()
-        assert out == "3.0\n"
-    else:
-        auto_eval("print(3.00)", flags=CompilerFlags.from_int(0), auto_flags=False)
-        out, _ = capsys.readouterr()
-        assert out == "3.0\n"
+    auto_eval("print(3.00)", flags=CompilerFlags.from_int(0), auto_flags=False)
+    out, _ = capsys.readouterr()
+    assert out == "3.0\n"
 
 def test_auto_eval_no_auto_flags_ps_flag_pf1():
     with pytest.raises(SyntaxError):
         auto_eval("print 3.00", flags="print_function", auto_flags=False)
 
 
-@pytest.mark.skipif(
-    PY3,
-    reason="print function is not invalid syntax in Python 3.")
-def test_auto_eval_no_auto_flags_pf_flagps_1():
-    with pytest.raises(SyntaxError):
-        auto_eval("print(3.00, file=sys.stdout)", flags=None, auto_flags=False)
-
-
 def test_auto_eval_no_auto_flags_pf_flag_pf1(capsys):
     auto_eval("print(3.00, file=sys.stdout)",
               flags="print_function", auto_flags=False)
     out, _ = capsys.readouterr()
     assert out == "[PYFLYBY] import sys\n3.0\n"
 
 
 def test_auto_eval_auto_flags_ps_flagps_1(capsys):
-    if PY2:
+    with pytest.raises(SyntaxError):
         auto_eval("print 3.00", flags=CompilerFlags.from_int(0), auto_flags=True)
-        out, _ = capsys.readouterr()
-        assert out == "3.0\n"
-    else:
-        with pytest.raises(SyntaxError):
-            auto_eval("print 3.00", flags=CompilerFlags.from_int(0), auto_flags=True)
-
-@pytest.mark.skipif(
-    PY3,
-    reason="print not as a function cannot be valid syntax in Python 3.")
-def test_auto_eval_auto_flags_ps_flag_pf1(capsys):
-    auto_eval("print 3.00", flags=CompilerFlags("print_function"), auto_flags=True)
-    out, _ = capsys.readouterr()
-    assert out == "3.0\n"
 
 
 def test_auto_eval_auto_flags_pf_flagps_1(capsys):
     auto_eval("print(3.00, file=sys.stdout)", flags=CompilerFlags.from_int(0), auto_flags=True)
     out, _ = capsys.readouterr()
     assert out == "[PYFLYBY] import sys\n3.0\n"
 
@@ -2022,26 +1953,19 @@
 
 def test_auto_import_unknown_but_in_db1(tpp, capsys):
     # Verify that if we try to access something that's in the known-imports
     # database, but it doesn't actually exist, we get a visible error for it.
     db = ImportDB('import photon70447198')
     auto_import("photon70447198.asdfasdf", [{}], db=db)
     out, _ = capsys.readouterr()
-    if PY2:
-        expected = dedent("""
-            [PYFLYBY] import photon70447198
-            [PYFLYBY] Error attempting to 'import photon70447198': ImportError: No module named photon70447198
-            Traceback (most recent call last):
-        """).lstrip()
-    else:
-        expected = dedent("""
-            [PYFLYBY] import photon70447198
-            [PYFLYBY] Error attempting to 'import photon70447198': ModuleNotFoundError: No module named 'photon70447198'
-            Traceback (most recent call last):
-        """).lstrip()
+    expected = dedent("""
+        [PYFLYBY] import photon70447198
+        [PYFLYBY] Error attempting to 'import photon70447198': ModuleNotFoundError: No module named 'photon70447198'
+        Traceback (most recent call last):
+    """).lstrip()
 
     assert out.startswith(expected)
 
 
 def test_auto_import_fake_importerror_1(tpp, capsys):
     writetext(tpp/"proton24412521.py", """
         raise ImportError("No module named proton24412521")
@@ -2058,26 +1982,19 @@
 
 def test_auto_import_indirect_importerror_1(tpp, capsys):
     writetext(tpp/"neutron46291483.py", """
         import baryon96446873
     """)
     auto_import("neutron46291483.asdfasdf", [{}])
     out, _ = capsys.readouterr()
-    if PY2:
-        expected = dedent("""
-            [PYFLYBY] import neutron46291483
-            [PYFLYBY] Error attempting to 'import neutron46291483': ImportError: No module named baryon96446873
-            Traceback (most recent call last):
-        """).lstrip()
-    else:
-        expected = dedent("""
-            [PYFLYBY] import neutron46291483
-            [PYFLYBY] Error attempting to 'import neutron46291483': ModuleNotFoundError: No module named 'baryon96446873'
-            Traceback (most recent call last):
-        """).lstrip()
+    expected = dedent("""
+        [PYFLYBY] import neutron46291483
+        [PYFLYBY] Error attempting to 'import neutron46291483': ModuleNotFoundError: No module named 'baryon96446873'
+        Traceback (most recent call last):
+    """).lstrip()
 
     assert out.startswith(expected)
 
 
 def test_auto_import_nameerror_1(tpp, capsys):
     writetext(tpp/"lepton69688541.py", """
         foo
@@ -2119,18 +2036,28 @@
 def test_post_import_hook_fullname():
     db = ImportDB('import numpy.compat')
     expected = Import('import numpy.compat')
     def test_hook(val):
         assert val == expected
     auto_import("numpy.compat", [{}], db=db, post_import_hook=test_hook)
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only namespace package.")
+
 def test_namespace_package(tpp, capsys):
     os.mkdir(str(tpp/'namespace_package'))
     auto_import("namespace_package", [{}])
     out, _ = capsys.readouterr()
     expected = dedent("""
         [PYFLYBY] import namespace_package
     """).lstrip()
     assert out.startswith(expected)
+
+
+def test_unsafe_filename_warning(tpp, capsys):
+    filepath = os.path.join(tpp._filename, 'foo#bar')
+    os.mkdir(filepath)
+    with CwdCtx(filepath):
+        auto_import("pyflyby", [{}])
+    out, _ = capsys.readouterr()
+    expected = dedent("""
+        [PYFLYBY] import pyflyby
+    """).lstrip()
+    assert out.startswith(expected)
```

### Comparing `pyflyby-1.8.4/tests/test_cmdline.py` & `pyflyby-1.8.5/tests/test_cmdline.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,25 +1,22 @@
 # pyflyby/test_cmdline.py
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   io                       import BytesIO
 import os
 import sys
 import pexpect
 import subprocess
 import tempfile
 from   textwrap                 import dedent
 
-from   six                      import PY2, PY3
-
 from   pyflyby._util            import EnvVarCtx
 
 import pytest
 
 PYFLYBY_HOME = os.path.dirname(os.path.dirname(os.path.realpath(__file__)))
 BIN_DIR = os.path.join(PYFLYBY_HOME, "bin")
 
@@ -275,28 +272,24 @@
 def test_py_eval_1():
     result = pipe([BIN_DIR+"/py", "-c", "b64decode('aGVsbG8=')"])
     expected = dedent("""
         [PYFLYBY] from base64 import b64decode
         [PYFLYBY] b64decode('aGVsbG8=')
         b'hello'
     """).strip()
-    if PY2:
-        expected = expected.replace("b'hello'", "'hello'")
     assert result == expected
 
 
 def test_py_exec_1():
     result = pipe([BIN_DIR+"/py", "-c", "if 1: print(b64decode('aGVsbG8='))"])
     expected = dedent("""
         [PYFLYBY] from base64 import b64decode
         [PYFLYBY] if 1: print(b64decode('aGVsbG8='))
         b'hello'
     """).strip()
-    if PY2:
-        expected = expected.replace("b'hello'", "hello")
     assert result == expected
 
 
 def test_py_name_1():
     result = pipe([BIN_DIR+"/py", "-c", "__name__"])
     expected = dedent("""
         [PYFLYBY] __name__
@@ -422,44 +415,14 @@
             output = f2.read()
     proc_output = child.logfile.getvalue()
     assert b"[y/N] zxcv" in proc_output
     assert b"Aborted" in proc_output
     assert output == input
 
 
-# Note, these tests will fail if the system does not have both python2 and
-# python3 in the PATH
-def test_tidy_imports_py2_fallback():
-    input = dedent('''
-        import x
-
-        def f(*args, x=1):
-            pass
-    ''')
-    with tempfile.NamedTemporaryFile(suffix=".py", mode='w+') as f:
-        f.write(input)
-        f.flush()
-        child = pexpect.spawn(python, [BIN_DIR+'/tidy-imports', "--py23-fallback", f.name], timeout=5.0)
-        child.logfile = BytesIO()
-        child.expect_exact(" [y/N]")
-        child.send("n\n")
-        child.expect(pexpect.EOF)
-        with open(f.name) as f2:
-            output = f2.read()
-    proc_output = child.logfile.getvalue()
-    assert b"removed unused 'import x'" in proc_output
-    assert output == input
-    if PY2:
-        assert b"SyntaxError detected" in proc_output, proc_output
-        assert b"falling back" in proc_output, proc_output
-    else:
-        assert b"SyntaxError detected" not in proc_output, proc_output
-        assert b"falling back" not in proc_output, proc_output
-
-
 @pytest.mark.skip(reason="seem to fail at importing six even if installed")
 def test_tidy_imports_py3_fallback():
     input = dedent('''
         import x
 
         print 1
     ''')
@@ -472,20 +435,17 @@
         child.send("n\n")
         child.expect(pexpect.EOF)
         with open(f.name) as f2:
             output = f2.read()
     proc_output = child.logfile.getvalue()
     assert b"removed unused 'import x'" in proc_output
     assert output == input
-    if PY3:
-        assert b"SyntaxError detected" in proc_output, proc_output
-        assert b"falling back" in proc_output, proc_output
-    else:
-        assert b"SyntaxError detected" not in proc_output, proc_output
-        assert b"falling back" not in proc_output, proc_output
+    assert b"SyntaxError detected" in proc_output, proc_output
+    assert b"falling back" in proc_output, proc_output
+
 
 def test_tidy_imports_symlinks_default():
     input = dedent('''
         import x
     ''')
     with tempfile.NamedTemporaryFile(suffix=".py", mode='w+') as f:
         f.write(input)
```

### Comparing `pyflyby-1.8.4/tests/test_docxref.py` & `pyflyby-1.8.5/tests/test_docxref.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,22 +1,16 @@
 # pyflyby/test_docxref.py
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
 
-from   .                        import xrefs
 
-import pytest
-from   six                      import PY3
+from   .                        import xrefs
 
-if PY3:
-    pytestmark = pytest.mark.skip("Epydoc does not support Python 3")
 
 def test_find_bad_doc_cross_references_1():
     from   pyflyby._docxref         import find_bad_doc_cross_references
     from   pyflyby._modules         import ModuleHandle
 
     result = find_bad_doc_cross_references([xrefs])
     expected = (
```

### Comparing `pyflyby-1.8.4/tests/test_file.py` & `pyflyby-1.8.5/tests/test_file.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,14 +1,13 @@
 # pyflyby/test_file.py
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import pytest
 
 from   pyflyby._file            import FilePos, FileText, Filename
 from   pyflyby._util            import CwdCtx
 
 def test_Filename_1():
```

### Comparing `pyflyby-1.8.4/tests/test_flags.py` & `pyflyby-1.8.5/tests/test_flags.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,18 +1,16 @@
 # pyflyby/test_flags.py
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import ast
 
-from   six                      import PY3
 
 import pytest
 import warnings
 
 from   pyflyby._flags           import CompilerFlags
 
 
@@ -114,25 +112,14 @@
     node = ast.parse("from __future__ import with_statement, print_function")
     result = CompilerFlags(node)
     with warnings.catch_warnings():
         warnings.simplefilter("ignore", DeprecationWarning)
         assert result == CompilerFlags(0x18000)
 
 
-@pytest.mark.skipif(
-    PY3,
-    reason="print function is not invalid syntax in Python 3.")
-def test_CompilerFlags_compile_1():
-    # Should raise SyntaxError:
-    with pytest.raises(SyntaxError):
-        compile("print('x', file=None)", "?", "exec", flags=0, dont_inherit=1)
-    # Shouldn't raise SyntaxError:
-    compile("print('x', file=None)", "?", "exec", flags=CompilerFlags("print_function"), dont_inherit=1)
-
-
 def test_CompilerFlags_bad_name_1():
     with pytest.raises(ValueError):
         CompilerFlags("print_statement")
 
 
 def test_CompilerFlags_bad_int_1():
     with warnings.catch_warnings():
```

### Comparing `pyflyby-1.8.4/tests/test_format.py` & `pyflyby-1.8.5/tests/test_format.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,14 +1,13 @@
 # pyflyby/test_format.py
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   textwrap                 import dedent
 
 from   pyflyby._format          import FormatParams, fill, pyfill
 
 
 def test_fill_1():
```

### Comparing `pyflyby-1.8.4/tests/test_idents.py` & `pyflyby-1.8.5/tests/test_idents.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,18 +1,15 @@
 # -*- coding: utf-8 -*-
 # pyflyby/test_idents.py
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
 
-import pytest
-import six
+
 
 from   pyflyby._idents          import (brace_identifiers, dotted_prefixes,
                                         is_identifier)
 
 
 def test_dotted_prefixes_1():
     assert dotted_prefixes("aa.bb.cc") == ['aa', 'aa.bb', 'aa.bb.cc']
@@ -85,17 +82,15 @@
 
 
 def test_brace_identifiers_1():
     result = list(brace_identifiers("{salutation}, {your_name}."))
     expected = ['salutation', 'your_name']
     assert result == expected
 
-@pytest.mark.skipif(
-    six.PY2,
-    reason="Python 3-only syntax.")
+
 def test_is_identifier_unicode():
     assert is_identifier('')
     assert not is_identifier('.')
     assert not is_identifier('.')
     assert not is_identifier('.', prefix=True)
     assert is_identifier('.', dotted=True, prefix=True)
     assert is_identifier('.', dotted=True)
```

### Comparing `pyflyby-1.8.4/tests/test_importclns.py` & `pyflyby-1.8.5/tests/test_importclns.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,14 +1,13 @@
 # pyflyby/test_importclns.py
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   pyflyby._importclns      import ImportMap, ImportSet
 from   pyflyby._importstmt      import Import, ImportStatement
 
 
 def test_ImportSet_1():
     importset = ImportSet('''
```

### Comparing `pyflyby-1.8.4/tests/test_importdb.py` & `pyflyby-1.8.5/tests/test_importdb.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,14 +1,13 @@
 # pyflyby/test_importdb.py
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import os
 from   shutil                   import rmtree
 from   tempfile                 import NamedTemporaryFile, mkdtemp
 from   textwrap                 import dedent
 
 from   pyflyby._importclns      import ImportMap, ImportSet
```

### Comparing `pyflyby-1.8.4/tests/test_imports2s.py` & `pyflyby-1.8.5/tests/test_imports2s.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,22 +1,19 @@
 # pyflyby/test_imports2s.py
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import pytest
 import sys
 from   textwrap                 import dedent
 import types
 
-from   six                      import PY2
-
 from   pyflyby._importdb        import ImportDB
 from   pyflyby._imports2s       import (canonicalize_imports,
                                         fix_unused_and_missing_imports,
                                         reformat_import_statements,
                                         remove_broken_imports,
                                         replace_star_imports,
                                         transform_imports)
@@ -894,17 +891,15 @@
     expected = PythonBlock(dedent('''
         import m.y.z
         from m.y import z as X, z as x
         print(m.y.z, m.xx)
     ''').lstrip(), filename="/foo/test_transform_imports_1.py")
     assert output == expected
 
-@pytest.mark.skipif(
-    PY2,
-    reason="Python 3-only syntax.")
+
 def test_canonicalize_imports_f_string_1():
     input = PythonBlock(dedent('''
         a = 1
         print(f"{a:2d}")
     ''').lstrip(), filename="/foo/test_canonicalize_imports_f_string_1.py")
     db = ImportDB("""
     """)
@@ -961,33 +956,14 @@
 
         with   closing(open("/etc/passwd")) as f:
             pass
     ''').lstrip())
     assert expected == output
 
 
-@pytest.mark.skipif(
-    sys.version_info < (2,7),
-    reason="Old Python doesn't support multiple context managers")
-def test_with_multi_1():
-    input = PythonBlock(dedent('''
-        with       aa as xx  , bb as yy, cc as zz:
-            pass
-    ''').lstrip())
-    db = ImportDB("from M import aa, bb, cc, dd, xx, yy, zz")
-    output = fix_unused_and_missing_imports(input, db=db)
-    expected = PythonBlock(dedent('''
-        from M import aa, bb, cc
-
-        with       aa as xx  , bb as yy, cc as zz:
-            pass
-    ''').lstrip())
-    assert expected == output
-
-
 def test_fix_unused_imports_repeated_1():
     input = PythonBlock(dedent('''
         import foo1, foo2, foo1, foo1
         import foo1, foo2, foo3
         foo1, foo2
     '''))
     db = ImportDB("")
```

### Comparing `pyflyby-1.8.4/tests/test_importstmt.py` & `pyflyby-1.8.5/tests/test_importstmt.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,14 +1,13 @@
 # pyflyby/test_importstmt.py
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 from   pyflyby._flags           import CompilerFlags
 from   pyflyby._importstmt      import Import, ImportSplit, ImportStatement
 
 
 def test_Import_from_parts_1():
     imp = Import.from_parts(".foo.bar", "bar")
```

### Comparing `pyflyby-1.8.4/tests/test_interactive.py` & `pyflyby-1.8.5/tests/test_interactive.py`

 * *Files 1% similar despite different names*

```diff
@@ -4,9771 +4,9386 @@
 00000030: 7665 2e70 790a 0a23 204c 6963 656e 7365  ve.py..# License
 00000040: 2066 6f72 2054 4849 5320 4649 4c45 204f   for THIS FILE O
 00000050: 4e4c 593a 2043 4330 2050 7562 6c69 6320  NLY: CC0 Public 
 00000060: 446f 6d61 696e 2044 6564 6963 6174 696f  Domain Dedicatio
 00000070: 6e0a 2320 6874 7470 3a2f 2f63 7265 6174  n.# http://creat
 00000080: 6976 6563 6f6d 6d6f 6e73 2e6f 7267 2f70  ivecommons.org/p
 00000090: 7562 6c69 6364 6f6d 6169 6e2f 7a65 726f  ublicdomain/zero
-000000a0: 2f31 2e30 2f0a 0a66 726f 6d20 5f5f 6675  /1.0/..from __fu
-000000b0: 7475 7265 5f5f 2069 6d70 6f72 7420 2861  ture__ import (a
-000000c0: 6273 6f6c 7574 655f 696d 706f 7274 2c20  bsolute_import, 
-000000d0: 6469 7669 7369 6f6e 2c20 7072 696e 745f  division, print_
-000000e0: 6675 6e63 7469 6f6e 2c0a 2020 2020 2020  function,.      
-000000f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000100: 2020 7769 7468 5f73 7461 7465 6d65 6e74    with_statement
-00000110: 290a 0a69 6d70 6f72 7420 4950 7974 686f  )..import IPytho
-00000120: 6e0a 696d 706f 7274 2061 7465 7869 740a  n.import atexit.
-00000130: 6672 6f6d 2020 2063 6f6e 7465 7874 6c69  from   contextli
-00000140: 6220 2020 2020 2020 2020 2020 2020 2020  b               
-00000150: 696d 706f 7274 2063 6f6e 7465 7874 6d61  import contextma
-00000160: 6e61 6765 720a 696d 706f 7274 2064 6966  nager.import dif
-00000170: 666c 6962 0a69 6d70 6f72 7420 666c 616b  flib.import flak
-00000180: 790a 696d 706f 7274 206a 736f 6e0a 696d  y.import json.im
-00000190: 706f 7274 206f 730a 696d 706f 7274 2070  port os.import p
-000001a0: 6578 7065 6374 0a69 6d70 6f72 7420 7079  expect.import py
-000001b0: 7465 7374 0a69 6d70 6f72 7420 7261 6e64  test.import rand
-000001c0: 6f6d 0a69 6d70 6f72 7420 7265 0a69 6d70  om.import re.imp
-000001d0: 6f72 7420 7265 6164 6c69 6e65 0a69 6d70  ort readline.imp
-000001e0: 6f72 7420 7265 7175 6573 7473 0a66 726f  ort requests.fro
-000001f0: 6d20 2020 7368 7574 696c 2020 2020 2020  m   shutil      
-00000200: 2020 2020 2020 2020 2020 2020 2069 6d70               imp
-00000210: 6f72 7420 726d 7472 6565 0a69 6d70 6f72  ort rmtree.impor
-00000220: 7420 7369 780a 6672 6f6d 2020 2073 6978  t six.from   six
-00000230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000240: 2020 2020 2020 696d 706f 7274 2042 7974        import Byt
-00000250: 6573 494f 2c20 5059 322c 2050 5933 0a66  esIO, PY2, PY3.f
-00000260: 726f 6d20 2020 7375 6270 726f 6365 7373  rom   subprocess
+000000a0: 2f31 2e30 2f0a 0a0a 696d 706f 7274 2049  /1.0/...import I
+000000b0: 5079 7468 6f6e 0a69 6d70 6f72 7420 6174  Python.import at
+000000c0: 6578 6974 0a66 726f 6d20 2020 636f 6e74  exit.from   cont
+000000d0: 6578 746c 6962 2020 2020 2020 2020 2020  extlib          
+000000e0: 2020 2020 2069 6d70 6f72 7420 636f 6e74       import cont
+000000f0: 6578 746d 616e 6167 6572 0a69 6d70 6f72  extmanager.impor
+00000100: 7420 6469 6666 6c69 620a 696d 706f 7274  t difflib.import
+00000110: 2066 6c61 6b79 0a69 6d70 6f72 7420 6a73   flaky.import js
+00000120: 6f6e 0a69 6d70 6f72 7420 6f73 0a69 6d70  on.import os.imp
+00000130: 6f72 7420 7065 7870 6563 740a 696d 706f  ort pexpect.impo
+00000140: 7274 2070 7974 6573 740a 696d 706f 7274  rt pytest.import
+00000150: 2072 616e 646f 6d0a 696d 706f 7274 2072   random.import r
+00000160: 650a 696d 706f 7274 2072 6561 646c 696e  e.import readlin
+00000170: 650a 696d 706f 7274 2072 6571 7565 7374  e.import request
+00000180: 730a 6672 6f6d 2020 2073 6875 7469 6c20  s.from   shutil 
+00000190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000001a0: 2020 696d 706f 7274 2072 6d74 7265 650a    import rmtree.
+000001b0: 696d 706f 7274 2073 6978 0a66 726f 6d20  import six.from 
+000001c0: 2020 7369 7820 2020 2020 2020 2020 2020    six           
+000001d0: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
+000001e0: 7420 4279 7465 7349 4f0a 6672 6f6d 2020  t BytesIO.from  
+000001f0: 2073 7562 7072 6f63 6573 7320 2020 2020   subprocess     
+00000200: 2020 2020 2020 2020 2020 696d 706f 7274            import
+00000210: 2063 6865 636b 5f63 616c 6c0a 696d 706f   check_call.impo
+00000220: 7274 2073 7973 0a66 726f 6d20 2020 7465  rt sys.from   te
+00000230: 6d70 6669 6c65 2020 2020 2020 2020 2020  mpfile          
+00000240: 2020 2020 2020 2069 6d70 6f72 7420 6d6b         import mk
+00000250: 6474 656d 702c 206d 6b73 7465 6d70 0a66  dtemp, mkstemp.f
+00000260: 726f 6d20 2020 7465 7874 7772 6170 2020  rom   textwrap  
 00000270: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00000280: 6d70 6f72 7420 6368 6563 6b5f 6361 6c6c  mport check_call
-00000290: 0a69 6d70 6f72 7420 7379 730a 6672 6f6d  .import sys.from
-000002a0: 2020 2074 656d 7066 696c 6520 2020 2020     tempfile     
-000002b0: 2020 2020 2020 2020 2020 2020 696d 706f              impo
-000002c0: 7274 206d 6b64 7465 6d70 2c20 6d6b 7374  rt mkdtemp, mkst
-000002d0: 656d 700a 6672 6f6d 2020 2074 6578 7477  emp.from   textw
-000002e0: 7261 7020 2020 2020 2020 2020 2020 2020  rap             
-000002f0: 2020 2020 696d 706f 7274 2064 6564 656e      import deden
-00000300: 740a 696d 706f 7274 2074 696d 650a 0a69  t.import time..i
-00000310: 6d70 6f72 7420 7079 666c 7962 790a 6672  mport pyflyby.fr
-00000320: 6f6d 2020 2070 7966 6c79 6279 2e5f 6669  om   pyflyby._fi
-00000330: 6c65 2020 2020 2020 2020 2020 2020 696d  le            im
-00000340: 706f 7274 2046 696c 656e 616d 650a 6672  port Filename.fr
-00000350: 6f6d 2020 2070 7966 6c79 6279 2e5f 7574  om   pyflyby._ut
-00000360: 696c 2020 2020 2020 2020 2020 2020 696d  il            im
-00000370: 706f 7274 2045 6e76 5661 7243 7478 2c20  port EnvVarCtx, 
-00000380: 6361 6368 6564 5f61 7474 7269 6275 7465  cached_attribute
-00000390: 2c20 6d65 6d6f 697a 650a 0a0a 2320 546f  , memoize...# To
-000003a0: 2064 6562 7567 2074 6573 745f 696e 7465   debug test_inte
-000003b0: 7261 6374 6976 652e 7079 2069 7473 656c  ractive.py itsel
-000003c0: 662c 2073 6574 2074 6865 2065 6e76 2076  f, set the env v
-000003d0: 6172 2044 4542 5547 5f54 4553 545f 5059  ar DEBUG_TEST_PY
-000003e0: 464c 5942 592e 0a44 4542 5547 203d 2062  FLYBY..DEBUG = b
-000003f0: 6f6f 6c28 6f73 2e67 6574 656e 7628 2244  ool(os.getenv("D
-00000400: 4542 5547 5f54 4553 545f 5059 464c 5942  EBUG_TEST_PYFLYB
-00000410: 5922 2929 0a0a 5f65 6e76 5f74 696d 656f  Y")).._env_timeo
-00000420: 7574 203d 206f 732e 6765 7465 6e76 2822  ut = os.getenv("
-00000430: 5059 464c 5942 5954 4553 545f 4445 4641  PYFLYBYTEST_DEFA
-00000440: 554c 545f 5449 4d45 4f55 5422 2c20 4e6f  ULT_TIMEOUT", No
-00000450: 6e65 290a 6966 205f 656e 765f 7469 6d65  ne).if _env_time
-00000460: 6f75 7420 6973 206e 6f74 204e 6f6e 653a  out is not None:
-00000470: 0a20 2020 2044 4546 4155 4c54 5f54 494d  .    DEFAULT_TIM
-00000480: 454f 5554 203d 2066 6c6f 6174 285f 656e  EOUT = float(_en
-00000490: 765f 7469 6d65 6f75 7429 0a20 2020 2044  v_timeout).    D
-000004a0: 4546 4155 4c54 5f54 494d 454f 5554 5f52  EFAULT_TIMEOUT_R
-000004b0: 4551 5545 5354 203d 2044 4546 4155 4c54  EQUEST = DEFAULT
-000004c0: 5f54 494d 454f 5554 0a65 6c73 653a 0a20  _TIMEOUT.else:. 
-000004d0: 2020 2044 4546 4155 4c54 5f54 494d 454f     DEFAULT_TIMEO
-000004e0: 5554 203d 202d 310a 2020 2020 4445 4641  UT = -1.    DEFA
-000004f0: 554c 545f 5449 4d45 4f55 545f 5245 5155  ULT_TIMEOUT_REQU
-00000500: 4553 5420 3d20 4e6f 6e65 0a0a 0a69 6620  EST = None...if 
-00000510: 6f73 2e67 6574 656e 7628 2250 5946 4c59  os.getenv("PYFLY
-00000520: 4259 5445 5354 5f4e 4f52 4554 5259 222c  BYTEST_NORETRY",
-00000530: 204e 6f6e 6529 3a0a 2020 2020 7265 7472   None):.    retr
-00000540: 7920 3d20 6c61 6d62 6461 2078 3a20 780a  y = lambda x: x.
-00000550: 656c 7365 3a0a 2020 2020 7265 7472 7920  else:.    retry 
-00000560: 3d20 666c 616b 792e 666c 616b 7928 6d61  = flaky.flaky(ma
-00000570: 785f 7275 6e73 3d35 2069 6620 4445 4641  x_runs=5 if DEFA
-00000580: 554c 545f 5449 4d45 4f55 5420 3c20 3020  ULT_TIMEOUT < 0 
-00000590: 656c 7365 2031 290a 0a0a 6465 6620 5f67  else 1)...def _g
-000005a0: 6574 5f46 6169 6c65 645f 636c 6173 7328  et_Failed_class(
-000005b0: 293a 0a20 2020 2069 6d70 6f72 7420 5f70  ):.    import _p
-000005c0: 7974 6573 740a 2020 2020 7472 793a 0a20  ytest.    try:. 
-000005d0: 2020 2020 2020 2072 6574 7572 6e20 5f70         return _p
-000005e0: 7974 6573 742e 6f75 7463 6f6d 6573 2e4f  ytest.outcomes.O
-000005f0: 7574 636f 6d65 4578 6365 7074 696f 6e0a  utcomeException.
-00000600: 2020 2020 6578 6365 7074 2041 7474 7269      except Attri
-00000610: 6275 7465 4572 726f 723a 0a20 2020 2020  buteError:.     
-00000620: 2020 2072 6574 7572 6e20 5f70 7974 6573     return _pytes
-00000630: 742e 7275 6e6e 6572 2e46 6169 6c65 640a  t.runner.Failed.
-00000640: 5f46 6169 6c65 6420 3d20 5f67 6574 5f46  _Failed = _get_F
-00000650: 6169 6c65 645f 636c 6173 7328 290a 0a64  ailed_class()..d
-00000660: 6566 2061 7373 6572 745f 6661 696c 2829  ef assert_fail()
-00000670: 3a0a 2020 2020 2222 220a 2020 2020 4173  :.    """.    As
-00000680: 7365 7274 2074 6861 7420 7079 7465 7374  sert that pytest
-00000690: 2e66 6169 6c28 2920 6973 2063 616c 6c65  .fail() is calle
-000006a0: 6420 696e 2074 6865 2063 6f6e 7465 7874  d in the context
-000006b0: 2e20 2055 7365 6420 746f 2073 656c 662d  .  Used to self-
-000006c0: 7465 7374 2e0a 2020 2020 2222 220a 2020  test..    """.  
-000006d0: 2020 7265 7475 726e 2070 7974 6573 742e    return pytest.
-000006e0: 7261 6973 6573 285f 4661 696c 6564 290a  raises(_Failed).
-000006f0: 0a40 7079 7465 7374 2e6d 6172 6b2e 7866  .@pytest.mark.xf
-00000700: 6169 6c0a 6465 6620 7465 7374 5f66 6169  ail.def test_fai
-00000710: 6c69 6e67 2829 3a0a 2020 2020 2222 220a  ling():.    """.
-00000720: 2020 2020 4d61 6b69 6e67 2073 7572 6520      Making sure 
-00000730: 7468 6174 2078 6661 696c 7320 6675 6e63  that xfails func
-00000740: 7469 6f6e 732e 0a20 2020 2022 2222 0a20  tions..    """. 
-00000750: 2020 2061 7373 6572 7420 4661 6c73 650a     assert False.
-00000760: 0a0a 6465 6620 7079 7465 7374 5f67 656e  ..def pytest_gen
-00000770: 6572 6174 655f 7465 7374 7328 6d65 7461  erate_tests(meta
-00000780: 6675 6e63 293a 0a20 2020 2023 2049 5079  func):.    # IPy
-00000790: 7468 6f6e 2034 2061 6e64 2065 6172 6c69  thon 4 and earli
-000007a0: 6572 206f 6e6c 7920 6861 6420 7265 6164  er only had read
-000007b0: 6c69 6e65 2066 726f 6e74 656e 642e 0a20  line frontend.. 
-000007c0: 2020 2023 2049 5079 7468 6f6e 2035 2e30     # IPython 5.0
-000007d0: 2074 6872 6f75 6768 2035 2e33 206f 6e6c   through 5.3 onl
-000007e0: 7920 616c 6c6f 7720 7072 6f6d 7074 5f74  y allow prompt_t
-000007f0: 6f6f 6c6b 6974 2e0a 2020 2020 2320 4950  oolkit..    # IP
-00000800: 7974 686f 6e20 352e 3420 7468 726f 7567  ython 5.4 throug
-00000810: 6820 362e 3520 6465 6661 756c 7473 2074  h 6.5 defaults t
-00000820: 6f20 7072 6f6d 7074 5f74 6f6f 6c6b 6974  o prompt_toolkit
-00000830: 2c20 6275 7420 616c 6c6f 7773 2063 686f  , but allows cho
-00000840: 6f73 696e 6720 7265 6164 6c69 6e65 2e0a  osing readline..
-00000850: 2020 2020 2320 4950 7974 686f 6e20 372b      # IPython 7+
-00000860: 2062 7265 616b 7320 726c 6970 7974 686f   breaks rlipytho
-00000870: 6e20 2868 7474 7073 3a2f 2f67 6974 6875  n (https://githu
-00000880: 622e 636f 6d2f 6970 7974 686f 6e2f 726c  b.com/ipython/rl
-00000890: 6970 7974 686f 6e2f 6973 7375 6573 2f32  ipython/issues/2
-000008a0: 3129 2e0a 2020 2020 6966 2027 6672 6f6e  1)..    if 'fron
-000008b0: 7465 6e64 2720 696e 206d 6574 6166 756e  tend' in metafun
-000008c0: 632e 6669 7874 7572 656e 616d 6573 3a0a  c.fixturenames:.
-000008d0: 2020 2020 2020 2020 6966 205f 4950 5954          if _IPYT
+00000280: 6d70 6f72 7420 6465 6465 6e74 0a69 6d70  mport dedent.imp
+00000290: 6f72 7420 7469 6d65 0a0a 696d 706f 7274  ort time..import
+000002a0: 2070 7966 6c79 6279 0a66 726f 6d20 2020   pyflyby.from   
+000002b0: 7079 666c 7962 792e 5f66 696c 6520 2020  pyflyby._file   
+000002c0: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
+000002d0: 4669 6c65 6e61 6d65 0a66 726f 6d20 2020  Filename.from   
+000002e0: 7079 666c 7962 792e 5f75 7469 6c20 2020  pyflyby._util   
+000002f0: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
+00000300: 456e 7656 6172 4374 782c 2063 6163 6865  EnvVarCtx, cache
+00000310: 645f 6174 7472 6962 7574 652c 206d 656d  d_attribute, mem
+00000320: 6f69 7a65 0a0a 0a23 2054 6f20 6465 6275  oize...# To debu
+00000330: 6720 7465 7374 5f69 6e74 6572 6163 7469  g test_interacti
+00000340: 7665 2e70 7920 6974 7365 6c66 2c20 7365  ve.py itself, se
+00000350: 7420 7468 6520 656e 7620 7661 7220 4445  t the env var DE
+00000360: 4255 475f 5445 5354 5f50 5946 4c59 4259  BUG_TEST_PYFLYBY
+00000370: 2e0a 4445 4255 4720 3d20 626f 6f6c 286f  ..DEBUG = bool(o
+00000380: 732e 6765 7465 6e76 2822 4445 4255 475f  s.getenv("DEBUG_
+00000390: 5445 5354 5f50 5946 4c59 4259 2229 290a  TEST_PYFLYBY")).
+000003a0: 0a5f 656e 765f 7469 6d65 6f75 7420 3d20  ._env_timeout = 
+000003b0: 6f73 2e67 6574 656e 7628 2250 5946 4c59  os.getenv("PYFLY
+000003c0: 4259 5445 5354 5f44 4546 4155 4c54 5f54  BYTEST_DEFAULT_T
+000003d0: 494d 454f 5554 222c 204e 6f6e 6529 0a69  IMEOUT", None).i
+000003e0: 6620 5f65 6e76 5f74 696d 656f 7574 2069  f _env_timeout i
+000003f0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00000400: 4445 4641 554c 545f 5449 4d45 4f55 5420  DEFAULT_TIMEOUT 
+00000410: 3d20 666c 6f61 7428 5f65 6e76 5f74 696d  = float(_env_tim
+00000420: 656f 7574 290a 2020 2020 4445 4641 554c  eout).    DEFAUL
+00000430: 545f 5449 4d45 4f55 545f 5245 5155 4553  T_TIMEOUT_REQUES
+00000440: 5420 3d20 4445 4641 554c 545f 5449 4d45  T = DEFAULT_TIME
+00000450: 4f55 540a 656c 7365 3a0a 2020 2020 4445  OUT.else:.    DE
+00000460: 4641 554c 545f 5449 4d45 4f55 5420 3d20  FAULT_TIMEOUT = 
+00000470: 2d31 0a20 2020 2044 4546 4155 4c54 5f54  -1.    DEFAULT_T
+00000480: 494d 454f 5554 5f52 4551 5545 5354 203d  IMEOUT_REQUEST =
+00000490: 204e 6f6e 650a 0a0a 6966 206f 732e 6765   None...if os.ge
+000004a0: 7465 6e76 2822 5059 464c 5942 5954 4553  tenv("PYFLYBYTES
+000004b0: 545f 4e4f 5245 5452 5922 2c20 4e6f 6e65  T_NORETRY", None
+000004c0: 293a 0a20 2020 2072 6574 7279 203d 206c  ):.    retry = l
+000004d0: 616d 6264 6120 783a 2078 0a65 6c73 653a  ambda x: x.else:
+000004e0: 0a20 2020 2072 6574 7279 203d 2066 6c61  .    retry = fla
+000004f0: 6b79 2e66 6c61 6b79 286d 6178 5f72 756e  ky.flaky(max_run
+00000500: 733d 3520 6966 2044 4546 4155 4c54 5f54  s=5 if DEFAULT_T
+00000510: 494d 454f 5554 203c 2030 2065 6c73 6520  IMEOUT < 0 else 
+00000520: 3129 0a0a 0a64 6566 205f 6765 745f 4661  1)...def _get_Fa
+00000530: 696c 6564 5f63 6c61 7373 2829 3a0a 2020  iled_class():.  
+00000540: 2020 696d 706f 7274 205f 7079 7465 7374    import _pytest
+00000550: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+00000560: 2020 7265 7475 726e 205f 7079 7465 7374    return _pytest
+00000570: 2e6f 7574 636f 6d65 732e 4f75 7463 6f6d  .outcomes.Outcom
+00000580: 6545 7863 6570 7469 6f6e 0a20 2020 2065  eException.    e
+00000590: 7863 6570 7420 4174 7472 6962 7574 6545  xcept AttributeE
+000005a0: 7272 6f72 3a0a 2020 2020 2020 2020 7265  rror:.        re
+000005b0: 7475 726e 205f 7079 7465 7374 2e72 756e  turn _pytest.run
+000005c0: 6e65 722e 4661 696c 6564 0a5f 4661 696c  ner.Failed._Fail
+000005d0: 6564 203d 205f 6765 745f 4661 696c 6564  ed = _get_Failed
+000005e0: 5f63 6c61 7373 2829 0a0a 6465 6620 6173  _class()..def as
+000005f0: 7365 7274 5f66 6169 6c28 293a 0a20 2020  sert_fail():.   
+00000600: 2022 2222 0a20 2020 2041 7373 6572 7420   """.    Assert 
+00000610: 7468 6174 2070 7974 6573 742e 6661 696c  that pytest.fail
+00000620: 2829 2069 7320 6361 6c6c 6564 2069 6e20  () is called in 
+00000630: 7468 6520 636f 6e74 6578 742e 2020 5573  the context.  Us
+00000640: 6564 2074 6f20 7365 6c66 2d74 6573 742e  ed to self-test.
+00000650: 0a20 2020 2022 2222 0a20 2020 2072 6574  .    """.    ret
+00000660: 7572 6e20 7079 7465 7374 2e72 6169 7365  urn pytest.raise
+00000670: 7328 5f46 6169 6c65 6429 0a0a 4070 7974  s(_Failed)..@pyt
+00000680: 6573 742e 6d61 726b 2e78 6661 696c 0a64  est.mark.xfail.d
+00000690: 6566 2074 6573 745f 6661 696c 696e 6728  ef test_failing(
+000006a0: 293a 0a20 2020 2022 2222 0a20 2020 204d  ):.    """.    M
+000006b0: 616b 696e 6720 7375 7265 2074 6861 7420  aking sure that 
+000006c0: 7866 6169 6c73 2066 756e 6374 696f 6e73  xfails functions
+000006d0: 2e0a 2020 2020 2222 220a 2020 2020 6173  ..    """.    as
+000006e0: 7365 7274 2046 616c 7365 0a0a 0a64 6566  sert False...def
+000006f0: 2070 7974 6573 745f 6765 6e65 7261 7465   pytest_generate
+00000700: 5f74 6573 7473 286d 6574 6166 756e 6329  _tests(metafunc)
+00000710: 3a0a 2020 2020 2320 4950 7974 686f 6e20  :.    # IPython 
+00000720: 3420 616e 6420 6561 726c 6965 7220 6f6e  4 and earlier on
+00000730: 6c79 2068 6164 2072 6561 646c 696e 6520  ly had readline 
+00000740: 6672 6f6e 7465 6e64 2e0a 2020 2020 2320  frontend..    # 
+00000750: 4950 7974 686f 6e20 352e 3020 7468 726f  IPython 5.0 thro
+00000760: 7567 6820 352e 3320 6f6e 6c79 2061 6c6c  ugh 5.3 only all
+00000770: 6f77 2070 726f 6d70 745f 746f 6f6c 6b69  ow prompt_toolki
+00000780: 742e 0a20 2020 2023 2049 5079 7468 6f6e  t..    # IPython
+00000790: 2035 2e34 2074 6872 6f75 6768 2036 2e35   5.4 through 6.5
+000007a0: 2064 6566 6175 6c74 7320 746f 2070 726f   defaults to pro
+000007b0: 6d70 745f 746f 6f6c 6b69 742c 2062 7574  mpt_toolkit, but
+000007c0: 2061 6c6c 6f77 7320 6368 6f6f 7369 6e67   allows choosing
+000007d0: 2072 6561 646c 696e 652e 0a20 2020 2023   readline..    #
+000007e0: 2049 5079 7468 6f6e 2037 2b20 6272 6561   IPython 7+ brea
+000007f0: 6b73 2072 6c69 7079 7468 6f6e 2028 6874  ks rlipython (ht
+00000800: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
+00000810: 2f69 7079 7468 6f6e 2f72 6c69 7079 7468  /ipython/rlipyth
+00000820: 6f6e 2f69 7373 7565 732f 3231 292e 0a20  on/issues/21).. 
+00000830: 2020 2069 6620 2766 726f 6e74 656e 6427     if 'frontend'
+00000840: 2069 6e20 6d65 7461 6675 6e63 2e66 6978   in metafunc.fix
+00000850: 7475 7265 6e61 6d65 733a 0a20 2020 2020  turenames:.     
+00000860: 2020 2069 6620 5f49 5059 5448 4f4e 5f56     if _IPYTHON_V
+00000870: 4552 5349 4f4e 203e 3d20 2837 2c30 293a  ERSION >= (7,0):
+00000880: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
+00000890: 6166 756e 632e 7061 7261 6d65 7472 697a  afunc.parametriz
+000008a0: 6528 2766 726f 6e74 656e 6427 2c20 5b20  e('frontend', [ 
+000008b0: 2020 2020 2020 2020 2020 2027 7072 6f6d             'prom
+000008c0: 7074 5f74 6f6f 6c6b 6974 275d 290a 2020  pt_toolkit']).  
+000008d0: 2020 2020 2020 656c 6966 205f 4950 5954        elif _IPYT
 000008e0: 484f 4e5f 5645 5253 494f 4e20 3e3d 2028  HON_VERSION >= (
-000008f0: 372c 3029 3a0a 2020 2020 2020 2020 2020  7,0):.          
-00000900: 2020 6d65 7461 6675 6e63 2e70 6172 616d    metafunc.param
-00000910: 6574 7269 7a65 2827 6672 6f6e 7465 6e64  etrize('frontend
-00000920: 272c 205b 2020 2020 2020 2020 2020 2020  ', [            
-00000930: 2770 726f 6d70 745f 746f 6f6c 6b69 7427  'prompt_toolkit'
-00000940: 5d29 0a20 2020 2020 2020 2065 6c69 6620  ]).        elif 
-00000950: 5f49 5059 5448 4f4e 5f56 4552 5349 4f4e  _IPYTHON_VERSION
-00000960: 203e 3d20 2835 2c34 293a 0a20 2020 2020   >= (5,4):.     
-00000970: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00000980: 2020 2020 2020 2020 2020 2020 696d 706f              impo
-00000990: 7274 2072 6c69 7079 7468 6f6e 0a20 2020  rt rlipython.   
-000009a0: 2020 2020 2020 2020 2020 2020 2072 6c69               rli
-000009b0: 7079 7468 6f6e 2023 2075 7365 640a 2020  python # used.  
-000009c0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-000009d0: 2049 6d70 6f72 7445 7272 6f72 3a0a 2020   ImportError:.  
-000009e0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000009f0: 6973 6520 496d 706f 7274 4572 726f 7228  ise ImportError(
-00000a00: 2274 6573 745f 696e 7465 7261 6374 6976  "test_interactiv
-00000a10: 6520 7265 7175 6972 6573 2072 6c69 7079  e requires rlipy
-00000a20: 7468 6f6e 2069 6e73 7461 6c6c 6564 2e20  thon installed. 
-00000a30: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00000a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000a50: 2020 2020 2022 506c 6561 7365 2074 7279       "Please try
-00000a60: 3a20 7069 7020 696e 7374 616c 6c20 726c  : pip install rl
-00000a70: 6970 7974 686f 6e22 290a 2020 2020 2020  ipython").      
+000008f0: 352c 3429 3a0a 2020 2020 2020 2020 2020  5,4):.          
+00000900: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00000910: 2020 2020 2020 2069 6d70 6f72 7420 726c         import rl
+00000920: 6970 7974 686f 6e0a 2020 2020 2020 2020  ipython.        
+00000930: 2020 2020 2020 2020 726c 6970 7974 686f          rlipytho
+00000940: 6e20 2320 7573 6564 0a20 2020 2020 2020  n # used.       
+00000950: 2020 2020 2065 7863 6570 7420 496d 706f       except Impo
+00000960: 7274 4572 726f 723a 0a20 2020 2020 2020  rtError:.       
+00000970: 2020 2020 2020 2020 2072 6169 7365 2049           raise I
+00000980: 6d70 6f72 7445 7272 6f72 2822 7465 7374  mportError("test
+00000990: 5f69 6e74 6572 6163 7469 7665 2072 6571  _interactive req
+000009a0: 7569 7265 7320 726c 6970 7974 686f 6e20  uires rlipython 
+000009b0: 696e 7374 616c 6c65 642e 2020 220a 2020  installed.  ".  
+000009c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000009d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000009e0: 2250 6c65 6173 6520 7472 793a 2070 6970  "Please try: pip
+000009f0: 2069 6e73 7461 6c6c 2072 6c69 7079 7468   install rlipyth
+00000a00: 6f6e 2229 0a20 2020 2020 2020 2020 2020  on").           
+00000a10: 206d 6574 6166 756e 632e 7061 7261 6d65   metafunc.parame
+00000a20: 7472 697a 6528 2766 726f 6e74 656e 6427  trize('frontend'
+00000a30: 2c20 5b27 7265 6164 6c69 6e65 272c 2027  , ['readline', '
+00000a40: 7072 6f6d 7074 5f74 6f6f 6c6b 6974 275d  prompt_toolkit']
+00000a50: 290a 2020 2020 2020 2020 656c 6966 205f  ).        elif _
+00000a60: 4950 5954 484f 4e5f 5645 5253 494f 4e20  IPYTHON_VERSION 
+00000a70: 3e3d 2028 352c 3029 3a0a 2020 2020 2020  >= (5,0):.      
 00000a80: 2020 2020 2020 6d65 7461 6675 6e63 2e70        metafunc.p
 00000a90: 6172 616d 6574 7269 7a65 2827 6672 6f6e  arametrize('fron
-00000aa0: 7465 6e64 272c 205b 2772 6561 646c 696e  tend', ['readlin
-00000ab0: 6527 2c20 2770 726f 6d70 745f 746f 6f6c  e', 'prompt_tool
+00000aa0: 7465 6e64 272c 205b 2020 2020 2020 2020  tend', [        
+00000ab0: 2020 2020 2770 726f 6d70 745f 746f 6f6c      'prompt_tool
 00000ac0: 6b69 7427 5d29 0a20 2020 2020 2020 2065  kit']).        e
-00000ad0: 6c69 6620 5f49 5059 5448 4f4e 5f56 4552  lif _IPYTHON_VER
-00000ae0: 5349 4f4e 203e 3d20 2835 2c30 293a 0a20  SION >= (5,0):. 
-00000af0: 2020 2020 2020 2020 2020 206d 6574 6166             metaf
-00000b00: 756e 632e 7061 7261 6d65 7472 697a 6528  unc.parametrize(
-00000b10: 2766 726f 6e74 656e 6427 2c20 5b20 2020  'frontend', [   
-00000b20: 2020 2020 2020 2020 2027 7072 6f6d 7074           'prompt
-00000b30: 5f74 6f6f 6c6b 6974 275d 290a 2020 2020  _toolkit']).    
-00000b40: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00000b50: 2020 2020 2020 6d65 7461 6675 6e63 2e70        metafunc.p
-00000b60: 6172 616d 6574 7269 7a65 2827 6672 6f6e  arametrize('fron
-00000b70: 7465 6e64 272c 205b 2772 6561 646c 696e  tend', ['readlin
-00000b80: 6527 5d29 0a0a 0a40 7079 7465 7374 2e66  e'])...@pytest.f
-00000b90: 6978 7475 7265 0a64 6566 2074 6d70 2872  ixture.def tmp(r
-00000ba0: 6571 7565 7374 293a 0a20 2020 2072 6574  equest):.    ret
-00000bb0: 7572 6e20 5f54 6d70 4669 7874 7572 6528  urn _TmpFixture(
-00000bc0: 7265 7175 6573 7429 0a0a 636c 6173 7320  request)..class 
-00000bd0: 5f54 6d70 4669 7874 7572 6528 6f62 6a65  _TmpFixture(obje
-00000be0: 6374 293a 0a20 2020 2064 6566 205f 5f69  ct):.    def __i
-00000bf0: 6e69 745f 5f28 7365 6c66 2c20 7265 7175  nit__(self, requ
-00000c00: 6573 7429 3a0a 2020 2020 2020 2020 7365  est):.        se
-00000c10: 6c66 2e5f 7265 7175 6573 7420 3d20 7265  lf._request = re
-00000c20: 7175 6573 740a 0a20 2020 2040 6361 6368  quest..    @cach
-00000c30: 6564 5f61 7474 7269 6275 7465 0a20 2020  ed_attribute.   
-00000c40: 2064 6566 2064 6972 2873 656c 6629 3a0a   def dir(self):.
-00000c50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00000c60: 2020 2020 5369 6e67 6c65 206d 656d 6f69      Single memoi
-00000c70: 7a65 6420 6e65 775f 7465 6d70 6469 7228  zed new_tempdir(
-00000c80: 290a 2020 2020 2020 2020 2222 220a 2020  ).        """.  
-00000c90: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00000ca0: 662e 6e65 775f 7465 6d70 6469 7228 290a  f.new_tempdir().
-00000cb0: 0a20 2020 2040 6361 6368 6564 5f61 7474  .    @cached_att
-00000cc0: 7269 6275 7465 0a20 2020 2064 6566 2066  ribute.    def f
-00000cd0: 696c 6528 7365 6c66 293a 0a20 2020 2020  ile(self):.     
-00000ce0: 2020 2022 2222 0a20 2020 2020 2020 2053     """.        S
-00000cf0: 696e 676c 6520 6d65 6d6f 697a 6564 206e  ingle memoized n
-00000d00: 6577 5f74 656d 7066 696c 6528 292e 0a20  ew_tempfile().. 
-00000d10: 2020 2020 2020 2054 6865 2066 696c 6520         The file 
-00000d20: 6973 204e 4f54 2075 6e64 6572 2060 6073  is NOT under ``s
-00000d30: 656c 662e 6469 7260 602e 0a20 2020 2020  elf.dir``..     
-00000d40: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00000d50: 6574 7572 6e20 7365 6c66 2e6e 6577 5f74  eturn self.new_t
-00000d60: 656d 7066 696c 6528 290a 0a20 2020 2040  empfile()..    @
-00000d70: 6361 6368 6564 5f61 7474 7269 6275 7465  cached_attribute
-00000d80: 0a20 2020 2064 6566 2069 7079 7468 6f6e  .    def ipython
-00000d90: 5f64 6972 2873 656c 6629 3a0a 2020 2020  _dir(self):.    
-00000da0: 2020 2020 6420 3d20 7365 6c66 2e6e 6577      d = self.new
-00000db0: 5f74 656d 7064 6972 2829 0a20 2020 2020  _tempdir().     
-00000dc0: 2020 205f 696e 6974 5f69 7079 7468 6f6e     _init_ipython
-00000dd0: 5f64 6972 2864 290a 2020 2020 2020 2020  _dir(d).        
-00000de0: 7265 7475 726e 2064 0a0a 2020 2020 6465  return d..    de
-00000df0: 6620 6e65 775f 7465 6d70 6469 7228 7365  f new_tempdir(se
-00000e00: 6c66 293a 0a20 2020 2020 2020 2064 203d  lf):.        d =
-00000e10: 206d 6b64 7465 6d70 2870 7265 6669 783d   mkdtemp(prefix=
-00000e20: 2270 7966 6c79 6279 5f74 6573 745f 222c  "pyflyby_test_",
-00000e30: 2073 7566 6669 783d 222e 746d 7022 290a   suffix=".tmp").
-00000e40: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
-00000e50: 7175 6573 742e 6164 6466 696e 616c 697a  quest.addfinaliz
-00000e60: 6572 286c 616d 6264 613a 2072 6d74 7265  er(lambda: rmtre
-00000e70: 6528 6429 290a 2020 2020 2020 2020 7265  e(d)).        re
-00000e80: 7475 726e 2046 696c 656e 616d 6528 6429  turn Filename(d)
-00000e90: 0a0a 2020 2020 6465 6620 6e65 775f 7465  ..    def new_te
-00000ea0: 6d70 6669 6c65 2873 656c 662c 2064 6972  mpfile(self, dir
-00000eb0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00000ec0: 6664 2c20 6620 3d20 6d6b 7374 656d 7028  fd, f = mkstemp(
-00000ed0: 7072 6566 6978 3d22 7079 666c 7962 795f  prefix="pyflyby_
-00000ee0: 7465 7374 5f22 2c20 7375 6666 6978 3d22  test_", suffix="
-00000ef0: 2e74 6d70 222c 2064 6972 3d64 6972 290a  .tmp", dir=dir).
-00000f00: 2020 2020 2020 2020 6f73 2e63 6c6f 7365          os.close
-00000f10: 2866 6429 0a20 2020 2020 2020 2073 656c  (fd).        sel
-00000f20: 662e 5f72 6571 7565 7374 2e61 6464 6669  f._request.addfi
-00000f30: 6e61 6c69 7a65 7228 6c61 6d62 6461 3a20  nalizer(lambda: 
-00000f40: 6f73 2e75 6e6c 696e 6b28 6629 290a 2020  os.unlink(f)).  
-00000f50: 2020 2020 2020 7265 7475 726e 2046 696c        return Fil
-00000f60: 656e 616d 6528 6629 0a0a 0a0a 6465 6620  ename(f)....def 
-00000f70: 7772 6974 6574 6578 7428 6669 6c65 6e61  writetext(filena
-00000f80: 6d65 2c20 7465 7874 2c20 6d6f 6465 3d27  me, text, mode='
-00000f90: 7727 293a 0a20 2020 2074 6578 7420 3d20  w'):.    text = 
-00000fa0: 6465 6465 6e74 2874 6578 7429 0a20 2020  dedent(text).   
-00000fb0: 2066 696c 656e 616d 6520 3d20 4669 6c65   filename = File
-00000fc0: 6e61 6d65 2866 696c 656e 616d 6529 0a20  name(filename). 
-00000fd0: 2020 2077 6974 6820 6f70 656e 2873 7472     with open(str
-00000fe0: 2866 696c 656e 616d 6529 2c20 6d6f 6465  (filename), mode
-00000ff0: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
-00001000: 662e 7772 6974 6528 7465 7874 290a 2020  f.write(text).  
-00001010: 2020 7265 7475 726e 2066 696c 656e 616d    return filenam
-00001020: 650a 0a0a 6465 6620 6173 7365 7274 5f6d  e...def assert_m
-00001030: 6174 6368 2872 6573 756c 742c 2065 7870  atch(result, exp
-00001040: 6563 7465 642c 2069 676e 6f72 655f 7072  ected, ignore_pr
-00001050: 6f6d 7074 5f6e 756d 6265 723d 4661 6c73  ompt_number=Fals
-00001060: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
-00001070: 4368 6563 6b20 7468 6174 2060 6072 6573  Check that ``res
-00001080: 756c 7460 6020 6d61 7463 6865 7320 6060  ult`` matches ``
-00001090: 6578 7065 6374 6564 6060 2e0a 2020 2020  expected``..    
-000010a0: 6060 6578 7065 6374 6564 6060 2069 7320  ``expected`` is 
-000010b0: 6120 7061 7474 6572 6e20 7768 6572 650a  a pattern where.
-000010c0: 2020 2020 2020 2a20 222e 2e2e 2220 2874        * "..." (t
-000010d0: 6872 6565 2064 6f74 7329 206d 6174 6368  hree dots) match
-000010e0: 6573 2061 6e79 2074 6578 7420 2862 7574  es any text (but
-000010f0: 206e 6f74 206e 6577 6c69 6e65 292c 2061   not newline), a
-00001100: 6e64 0a20 2020 2020 202a 2022 2e2e 2e2e  nd.      * "....
-00001110: 2220 2866 6f75 7220 646f 7473 2920 6d61  " (four dots) ma
-00001120: 7463 6865 7320 616e 7920 7465 7874 2028  tches any text (
-00001130: 696e 636c 7564 696e 6720 6e65 776c 696e  including newlin
-00001140: 6529 2e0a 2020 2020 2222 220a 2020 2020  e)..    """.    
-00001150: 5f5f 7472 6163 6562 6163 6b68 6964 655f  __tracebackhide_
-00001160: 5f20 3d20 5472 7565 0a20 2020 2065 7870  _ = True.    exp
-00001170: 6563 7465 6420 3d20 6465 6465 6e74 2865  ected = dedent(e
-00001180: 7870 6563 7465 642e 6465 636f 6465 2827  xpected.decode('
-00001190: 7574 662d 3827 2929 2e73 7472 6970 2829  utf-8')).strip()
-000011a0: 2e65 6e63 6f64 6528 2775 7466 2d38 2729  .encode('utf-8')
-000011b0: 0a20 2020 2070 6172 7473 203d 2065 7870  .    parts = exp
-000011c0: 6563 7465 642e 7370 6c69 7428 6222 2e2e  ected.split(b"..
-000011d0: 2e22 290a 2020 2020 7265 6765 7870 5f70  .").    regexp_p
-000011e0: 6172 7473 203d 205b 7265 2e65 7363 6170  arts = [re.escap
-000011f0: 6528 7061 7274 735b 305d 295d 0a20 2020  e(parts[0])].   
-00001200: 2066 6f72 2073 2069 6e20 7061 7274 735b   for s in parts[
-00001210: 313a 5d3a 0a20 2020 2020 2020 2069 6620  1:]:.        if 
-00001220: 7265 2e6d 6174 6368 2862 223a 2820 7c24  re.match(b":( |$
-00001230: 2922 2c20 732c 2072 652e 4d29 2061 6e64  )", s, re.M) and
-00001240: 2072 6567 6578 705f 7061 7274 735b 2d31   regexp_parts[-1
-00001250: 5d20 3d3d 2062 2220 2022 3a0a 2020 2020  ] == b"  ":.    
-00001260: 2020 2020 2020 2020 2320 5472 6561 7420          # Treat 
-00001270: 225c 6e20 202e 2e2e 3a20 2220 7370 6563  "\n  ...: " spec
-00001280: 6961 6c6c 793b 2064 6f6e 2774 206d 616b  ially; don't mak
-00001290: 6520 6974 2061 2067 6c6f 622e 0a20 2020  e it a glob..   
-000012a0: 2020 2020 2020 2020 2072 6567 6578 705f           regexp_
-000012b0: 7061 7274 732e 6170 7065 6e64 2862 222e  parts.append(b".
-000012c0: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
-000012d0: 2072 6567 6578 705f 7061 7274 732e 6170   regexp_parts.ap
-000012e0: 7065 6e64 2872 652e 6573 6361 7065 2873  pend(re.escape(s
-000012f0: 2929 0a20 2020 2020 2020 2065 6c69 6620  )).        elif 
-00001300: 732e 7374 6172 7473 7769 7468 2862 222e  s.startswith(b".
-00001310: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-00001320: 7265 6765 7870 5f70 6172 7473 2e61 7070  regexp_parts.app
-00001330: 656e 6428 6222 283f 3a2e 7c5c 6e29 2a22  end(b"(?:.|\n)*"
-00001340: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00001350: 6765 7870 5f70 6172 7473 2e61 7070 656e  gexp_parts.appen
-00001360: 6428 7265 2e65 7363 6170 6528 735b 313a  d(re.escape(s[1:
-00001370: 5d29 290a 2020 2020 2020 2020 656c 7365  ])).        else
-00001380: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00001390: 6765 7870 5f70 6172 7473 2e61 7070 656e  gexp_parts.appen
-000013a0: 6428 6222 2e2a 2229 0a20 2020 2020 2020  d(b".*").       
-000013b0: 2020 2020 2072 6567 6578 705f 7061 7274       regexp_part
-000013c0: 732e 6170 7065 6e64 2872 652e 6573 6361  s.append(re.esca
-000013d0: 7065 2873 2929 0a20 2020 2072 6567 6578  pe(s)).    regex
-000013e0: 7020 3d20 6222 222e 6a6f 696e 2872 6567  p = b"".join(reg
-000013f0: 6578 705f 7061 7274 7329 0a20 2020 2069  exp_parts).    i
-00001400: 6620 6967 6e6f 7265 5f70 726f 6d70 745f  f ignore_prompt_
-00001410: 6e75 6d62 6572 3a0a 2020 2020 2020 2020  number:.        
-00001420: 7265 6765 7870 203d 2072 652e 7375 6228  regexp = re.sub(
-00001430: 6272 2228 496e 5c5c 3f20 7c4f 7574 295c  br"(In\\? |Out)\
-00001440: 5c2a 5c5b 5b30 2d39 5d2b 5c5c 2a5c 5d5c  \*\[[0-9]+\\*\]\
-00001450: 5c3f 3a22 2c20 6272 225c 315c 5b5b 302d  \?:", br"\1\[[0-
-00001460: 395d 2b5c 5d3a 222c 2072 6567 6578 7029  9]+\]:", regexp)
-00001470: 0a20 2020 2069 6620 5f49 5059 5448 4f4e  .    if _IPYTHON
-00001480: 5f56 4552 5349 4f4e 203e 3d20 2834 2c29  _VERSION >= (4,)
-00001490: 3a0a 2020 2020 2020 2020 6967 6e6f 7265  :.        ignore
-000014a0: 203d 2064 6564 656e 7428 7222 2222 0a20   = dedent(r""". 
-000014b0: 2020 2020 2020 2020 2020 2028 5c5b 5a4d             (\[ZM
-000014c0: 5154 6572 6d69 6e61 6c49 5079 7468 6f6e  QTerminalIPython
-000014d0: 4170 705c 5d20 4c6f 6164 696e 6720 4950  App\] Loading IP
-000014e0: 7974 686f 6e20 6578 7465 6e73 696f 6e3a  ython extension:
-000014f0: 2073 746f 7265 6d61 6769 630a 2020 2020   storemagic.    
-00001500: 2020 2020 2020 2020 293f 0a20 2020 2020          )?.     
-00001510: 2020 2022 2222 292e 7374 7269 7028 292e     """).strip().
-00001520: 656e 636f 6465 2827 7574 662d 3827 290a  encode('utf-8').
-00001530: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00001540: 2072 652e 7375 6228 6967 6e6f 7265 2c20   re.sub(ignore, 
-00001550: 6222 222c 2072 6573 756c 7429 0a0a 2020  b"", result)..  
-00001560: 2020 2020 2020 2320 6967 6e6f 7265 2073        # ignore s
-00001570: 656c 6620 6578 6974 206f 6e20 7265 6164  elf exit on read
-00001580: 6c69 6e65 2e0a 2020 2020 2020 2020 7265  line..        re
-00001590: 7375 6c74 203d 2072 652e 7375 6228 6272  sult = re.sub(br
-000015a0: 2249 6e20 5c5b 5c64 2b5c 5d3a 2065 7869  "In \[\d+\]: exi
-000015b0: 745c 285c 2922 2c20 6222 222c 2072 6573  t\(\)", b"", res
-000015c0: 756c 7429 0a0a 2020 2020 2020 2020 6966  ult)..        if
-000015d0: 2073 7973 2e76 6572 7369 6f6e 5f69 6e66   sys.version_inf
-000015e0: 6f5b 305d 203d 3d20 323a 0a20 2020 2020  o[0] == 2:.     
-000015f0: 2020 2020 2020 2023 2069 676e 6f72 6520         # ignore 
-00001600: 2264 6f75 626c 6520 626c 616e 6b20 6c69  "double blank li
-00001610: 6e65 7322 2064 7565 2074 6f20 5c6e 5c72  nes" due to \n\r
-00001620: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00001630: 756c 7420 3d20 7265 7375 6c74 2e72 6570  ult = result.rep
-00001640: 6c61 6365 2822 5c6e 5c72 222c 2022 5c6e  lace("\n\r", "\n
-00001650: 2229 0a20 2020 2069 6620 5f49 5059 5448  ").    if _IPYTH
-00001660: 4f4e 5f56 4552 5349 4f4e 203c 2028 312c  ON_VERSION < (1,
-00001670: 2030 293a 0a20 2020 2020 2020 2023 2049   0):.        # I
-00001680: 5079 7468 6f6e 2030 2e31 3320 636f 6e73  Python 0.13 cons
-00001690: 6f6c 6520 7072 696e 7473 206b 6572 6e65  ole prints kerne
-000016a0: 6c20 696e 666f 3b20 6967 6e6f 7265 2069  l info; ignore i
-000016b0: 742e 0a20 2020 2020 2020 2023 2020 205b  t..        #   [
-000016c0: 4950 4b65 726e 656c 4170 705d 2054 6f20  IPKernelApp] To 
-000016d0: 636f 6e6e 6563 7420 616e 6f74 6865 7220  connect another 
-000016e0: 636c 6965 6e74 2074 6f20 7468 6973 206b  client to this k
-000016f0: 6572 6e65 6c2c 2075 7365 3a0a 2020 2020  ernel, use:.    
-00001700: 2020 2020 2320 2020 5b49 504b 6572 6e65      #   [IPKerne
-00001710: 6c41 7070 5d20 2d2d 6578 6973 7469 6e67  lApp] --existing
-00001720: 206b 6572 6e65 6c2d 3132 3334 352e 6a73   kernel-12345.js
-00001730: 6f6e 0a20 2020 2020 2020 2069 676e 6f72  on.        ignor
-00001740: 6520 3d20 6465 6465 6e74 2872 2222 220a  e = dedent(r""".
-00001750: 2020 2020 2020 2020 2020 2020 285c 5b49              (\[I
-00001760: 504b 6572 6e65 6c41 7070 5c5d 2054 6f20  PKernelApp\] To 
-00001770: 636f 6e6e 6563 7420 616e 6f74 6865 7220  connect another 
-00001780: 636c 6965 6e74 2074 6f20 7468 6973 206b  client to this k
-00001790: 6572 6e65 6c2c 2075 7365 3a0a 2020 2020  ernel, use:.    
-000017a0: 2020 2020 2020 2020 5c5b 4950 4b65 726e          \[IPKern
-000017b0: 656c 4170 705c 5d20 2d2d 6578 6973 7469  elApp\] --existi
-000017c0: 6e67 206b 6572 6e65 6c2d 5b30 2d39 5d2b  ng kernel-[0-9]+
-000017d0: 5c2e 6a73 6f6e 0a20 2020 2020 2020 2020  \.json.         
-000017e0: 2020 2029 3f0a 2020 2020 2020 2020 2222     )?.        ""
-000017f0: 2229 2e73 7472 6970 2829 2e65 6e63 6f64  ").strip().encod
-00001800: 6528 2775 7466 2d38 2729 0a20 2020 2020  e('utf-8').     
-00001810: 2020 2072 6573 756c 7420 3d20 7265 2e73     result = re.s
-00001820: 7562 2869 676e 6f72 652c 2062 2222 2c20  ub(ignore, b"", 
-00001830: 7265 7375 6c74 290a 2020 2020 6966 205f  result).    if _
-00001840: 4950 5954 484f 4e5f 5645 5253 494f 4e20  IPYTHON_VERSION 
-00001850: 3c20 2830 2c20 3131 293a 0a20 2020 2020  < (0, 11):.     
-00001860: 2020 2023 2049 5079 7468 6f6e 2030 2e31     # IPython 0.1
-00001870: 3020 7072 6f6d 7074 2063 6f75 6e74 7320  0 prompt counts 
-00001880: 6172 6520 6275 6767 792c 2065 2e67 2e20  are buggy, e.g. 
-00001890: 2574 696d 6520 696e 6372 656d 656e 7473  %time increments
-000018a0: 2062 7920 322e 0a20 2020 2020 2020 2023   by 2..        #
-000018b0: 2049 676e 6f72 6520 7072 6f6d 7074 206e   Ignore prompt n
-000018c0: 756d 6265 7273 2061 6e64 2065 7874 7261  umbers and extra
-000018d0: 206e 6577 6c69 6e65 7320 6265 666f 7265   newlines before
-000018e0: 2074 6865 206f 7574 7075 7420 7072 6f6d   the output prom
-000018f0: 7074 2e0a 2020 2020 2020 2020 7265 6765  pt..        rege
-00001900: 7870 203d 2072 652e 7375 6228 7265 2e63  xp = re.sub(re.c
-00001910: 6f6d 7069 6c65 2862 7222 5e49 6e5c 5c3f  ompile(br"^In\\?
-00001920: 205c 5c5c 5b5b 302d 395d 2b5c 5c5c 5d22   \\\[[0-9]+\\\]"
+00000ad0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00000ae0: 206d 6574 6166 756e 632e 7061 7261 6d65   metafunc.parame
+00000af0: 7472 697a 6528 2766 726f 6e74 656e 6427  trize('frontend'
+00000b00: 2c20 5b27 7265 6164 6c69 6e65 275d 290a  , ['readline']).
+00000b10: 0a0a 4070 7974 6573 742e 6669 7874 7572  ..@pytest.fixtur
+00000b20: 650a 6465 6620 746d 7028 7265 7175 6573  e.def tmp(reques
+00000b30: 7429 3a0a 2020 2020 7265 7475 726e 205f  t):.    return _
+00000b40: 546d 7046 6978 7475 7265 2872 6571 7565  TmpFixture(reque
+00000b50: 7374 290a 0a63 6c61 7373 205f 546d 7046  st)..class _TmpF
+00000b60: 6978 7475 7265 286f 626a 6563 7429 3a0a  ixture(object):.
+00000b70: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00000b80: 2873 656c 662c 2072 6571 7565 7374 293a  (self, request):
+00000b90: 0a20 2020 2020 2020 2073 656c 662e 5f72  .        self._r
+00000ba0: 6571 7565 7374 203d 2072 6571 7565 7374  equest = request
+00000bb0: 0a0a 2020 2020 4063 6163 6865 645f 6174  ..    @cached_at
+00000bc0: 7472 6962 7574 650a 2020 2020 6465 6620  tribute.    def 
+00000bd0: 6469 7228 7365 6c66 293a 0a20 2020 2020  dir(self):.     
+00000be0: 2020 2022 2222 0a20 2020 2020 2020 2053     """.        S
+00000bf0: 696e 676c 6520 6d65 6d6f 697a 6564 206e  ingle memoized n
+00000c00: 6577 5f74 656d 7064 6972 2829 0a20 2020  ew_tempdir().   
+00000c10: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00000c20: 2072 6574 7572 6e20 7365 6c66 2e6e 6577   return self.new
+00000c30: 5f74 656d 7064 6972 2829 0a0a 2020 2020  _tempdir()..    
+00000c40: 4063 6163 6865 645f 6174 7472 6962 7574  @cached_attribut
+00000c50: 650a 2020 2020 6465 6620 6669 6c65 2873  e.    def file(s
+00000c60: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00000c70: 220a 2020 2020 2020 2020 5369 6e67 6c65  ".        Single
+00000c80: 206d 656d 6f69 7a65 6420 6e65 775f 7465   memoized new_te
+00000c90: 6d70 6669 6c65 2829 2e0a 2020 2020 2020  mpfile()..      
+00000ca0: 2020 5468 6520 6669 6c65 2069 7320 4e4f    The file is NO
+00000cb0: 5420 756e 6465 7220 6060 7365 6c66 2e64  T under ``self.d
+00000cc0: 6972 6060 2e0a 2020 2020 2020 2020 2222  ir``..        ""
+00000cd0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00000ce0: 2073 656c 662e 6e65 775f 7465 6d70 6669   self.new_tempfi
+00000cf0: 6c65 2829 0a0a 2020 2020 4063 6163 6865  le()..    @cache
+00000d00: 645f 6174 7472 6962 7574 650a 2020 2020  d_attribute.    
+00000d10: 6465 6620 6970 7974 686f 6e5f 6469 7228  def ipython_dir(
+00000d20: 7365 6c66 293a 0a20 2020 2020 2020 2064  self):.        d
+00000d30: 203d 2073 656c 662e 6e65 775f 7465 6d70   = self.new_temp
+00000d40: 6469 7228 290a 2020 2020 2020 2020 5f69  dir().        _i
+00000d50: 6e69 745f 6970 7974 686f 6e5f 6469 7228  nit_ipython_dir(
+00000d60: 6429 0a20 2020 2020 2020 2072 6574 7572  d).        retur
+00000d70: 6e20 640a 0a20 2020 2064 6566 206e 6577  n d..    def new
+00000d80: 5f74 656d 7064 6972 2873 656c 6629 3a0a  _tempdir(self):.
+00000d90: 2020 2020 2020 2020 6420 3d20 6d6b 6474          d = mkdt
+00000da0: 656d 7028 7072 6566 6978 3d22 7079 666c  emp(prefix="pyfl
+00000db0: 7962 795f 7465 7374 5f22 2c20 7375 6666  yby_test_", suff
+00000dc0: 6978 3d22 2e74 6d70 2229 0a20 2020 2020  ix=".tmp").     
+00000dd0: 2020 2073 656c 662e 5f72 6571 7565 7374     self._request
+00000de0: 2e61 6464 6669 6e61 6c69 7a65 7228 6c61  .addfinalizer(la
+00000df0: 6d62 6461 3a20 726d 7472 6565 2864 2929  mbda: rmtree(d))
+00000e00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00000e10: 4669 6c65 6e61 6d65 2864 290a 0a20 2020  Filename(d)..   
+00000e20: 2064 6566 206e 6577 5f74 656d 7066 696c   def new_tempfil
+00000e30: 6528 7365 6c66 2c20 6469 723d 4e6f 6e65  e(self, dir=None
+00000e40: 293a 0a20 2020 2020 2020 2066 642c 2066  ):.        fd, f
+00000e50: 203d 206d 6b73 7465 6d70 2870 7265 6669   = mkstemp(prefi
+00000e60: 783d 2270 7966 6c79 6279 5f74 6573 745f  x="pyflyby_test_
+00000e70: 222c 2073 7566 6669 783d 222e 746d 7022  ", suffix=".tmp"
+00000e80: 2c20 6469 723d 6469 7229 0a20 2020 2020  , dir=dir).     
+00000e90: 2020 206f 732e 636c 6f73 6528 6664 290a     os.close(fd).
+00000ea0: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
+00000eb0: 7175 6573 742e 6164 6466 696e 616c 697a  quest.addfinaliz
+00000ec0: 6572 286c 616d 6264 613a 206f 732e 756e  er(lambda: os.un
+00000ed0: 6c69 6e6b 2866 2929 0a20 2020 2020 2020  link(f)).       
+00000ee0: 2072 6574 7572 6e20 4669 6c65 6e61 6d65   return Filename
+00000ef0: 2866 290a 0a0a 0a64 6566 2077 7269 7465  (f)....def write
+00000f00: 7465 7874 2866 696c 656e 616d 652c 2074  text(filename, t
+00000f10: 6578 742c 206d 6f64 653d 2777 2729 3a0a  ext, mode='w'):.
+00000f20: 2020 2020 7465 7874 203d 2064 6564 656e      text = deden
+00000f30: 7428 7465 7874 290a 2020 2020 6669 6c65  t(text).    file
+00000f40: 6e61 6d65 203d 2046 696c 656e 616d 6528  name = Filename(
+00000f50: 6669 6c65 6e61 6d65 290a 2020 2020 7769  filename).    wi
+00000f60: 7468 206f 7065 6e28 7374 7228 6669 6c65  th open(str(file
+00000f70: 6e61 6d65 292c 206d 6f64 6529 2061 7320  name), mode) as 
+00000f80: 663a 0a20 2020 2020 2020 2066 2e77 7269  f:.        f.wri
+00000f90: 7465 2874 6578 7429 0a20 2020 2072 6574  te(text).    ret
+00000fa0: 7572 6e20 6669 6c65 6e61 6d65 0a0a 0a64  urn filename...d
+00000fb0: 6566 2061 7373 6572 745f 6d61 7463 6828  ef assert_match(
+00000fc0: 7265 7375 6c74 2c20 6578 7065 6374 6564  result, expected
+00000fd0: 2c20 6967 6e6f 7265 5f70 726f 6d70 745f  , ignore_prompt_
+00000fe0: 6e75 6d62 6572 3d46 616c 7365 293a 0a20  number=False):. 
+00000ff0: 2020 2022 2222 0a20 2020 2043 6865 636b     """.    Check
+00001000: 2074 6861 7420 6060 7265 7375 6c74 6060   that ``result``
+00001010: 206d 6174 6368 6573 2060 6065 7870 6563   matches ``expec
+00001020: 7465 6460 602e 0a20 2020 2060 6065 7870  ted``..    ``exp
+00001030: 6563 7465 6460 6020 6973 2061 2070 6174  ected`` is a pat
+00001040: 7465 726e 2077 6865 7265 0a20 2020 2020  tern where.     
+00001050: 202a 2022 2e2e 2e22 2028 7468 7265 6520   * "..." (three 
+00001060: 646f 7473 2920 6d61 7463 6865 7320 616e  dots) matches an
+00001070: 7920 7465 7874 2028 6275 7420 6e6f 7420  y text (but not 
+00001080: 6e65 776c 696e 6529 2c20 616e 640a 2020  newline), and.  
+00001090: 2020 2020 2a20 222e 2e2e 2e22 2028 666f      * "...." (fo
+000010a0: 7572 2064 6f74 7329 206d 6174 6368 6573  ur dots) matches
+000010b0: 2061 6e79 2074 6578 7420 2869 6e63 6c75   any text (inclu
+000010c0: 6469 6e67 206e 6577 6c69 6e65 292e 0a20  ding newline).. 
+000010d0: 2020 2022 2222 0a20 2020 205f 5f74 7261     """.    __tra
+000010e0: 6365 6261 636b 6869 6465 5f5f 203d 2054  cebackhide__ = T
+000010f0: 7275 650a 2020 2020 6578 7065 6374 6564  rue.    expected
+00001100: 203d 2064 6564 656e 7428 6578 7065 6374   = dedent(expect
+00001110: 6564 2e64 6563 6f64 6528 2775 7466 2d38  ed.decode('utf-8
+00001120: 2729 292e 7374 7269 7028 292e 656e 636f  ')).strip().enco
+00001130: 6465 2827 7574 662d 3827 290a 2020 2020  de('utf-8').    
+00001140: 7061 7274 7320 3d20 6578 7065 6374 6564  parts = expected
+00001150: 2e73 706c 6974 2862 222e 2e2e 2229 0a20  .split(b"..."). 
+00001160: 2020 2072 6567 6578 705f 7061 7274 7320     regexp_parts 
+00001170: 3d20 5b72 652e 6573 6361 7065 2870 6172  = [re.escape(par
+00001180: 7473 5b30 5d29 5d0a 2020 2020 666f 7220  ts[0])].    for 
+00001190: 7320 696e 2070 6172 7473 5b31 3a5d 3a0a  s in parts[1:]:.
+000011a0: 2020 2020 2020 2020 6966 2072 652e 6d61          if re.ma
+000011b0: 7463 6828 6222 3a28 207c 2429 222c 2073  tch(b":( |$)", s
+000011c0: 2c20 7265 2e4d 2920 616e 6420 7265 6765  , re.M) and rege
+000011d0: 7870 5f70 6172 7473 5b2d 315d 203d 3d20  xp_parts[-1] == 
+000011e0: 6222 2020 223a 0a20 2020 2020 2020 2020  b"  ":.         
+000011f0: 2020 2023 2054 7265 6174 2022 5c6e 2020     # Treat "\n  
+00001200: 2e2e 2e3a 2022 2073 7065 6369 616c 6c79  ...: " specially
+00001210: 3b20 646f 6e27 7420 6d61 6b65 2069 7420  ; don't make it 
+00001220: 6120 676c 6f62 2e0a 2020 2020 2020 2020  a glob..        
+00001230: 2020 2020 7265 6765 7870 5f70 6172 7473      regexp_parts
+00001240: 2e61 7070 656e 6428 6222 2e2e 2e22 290a  .append(b"...").
+00001250: 2020 2020 2020 2020 2020 2020 7265 6765              rege
+00001260: 7870 5f70 6172 7473 2e61 7070 656e 6428  xp_parts.append(
+00001270: 7265 2e65 7363 6170 6528 7329 290a 2020  re.escape(s)).  
+00001280: 2020 2020 2020 656c 6966 2073 2e73 7461        elif s.sta
+00001290: 7274 7377 6974 6828 6222 2e22 293a 0a20  rtswith(b"."):. 
+000012a0: 2020 2020 2020 2020 2020 2072 6567 6578             regex
+000012b0: 705f 7061 7274 732e 6170 7065 6e64 2862  p_parts.append(b
+000012c0: 2228 3f3a 2e7c 5c6e 292a 2229 0a20 2020  "(?:.|\n)*").   
+000012d0: 2020 2020 2020 2020 2072 6567 6578 705f           regexp_
+000012e0: 7061 7274 732e 6170 7065 6e64 2872 652e  parts.append(re.
+000012f0: 6573 6361 7065 2873 5b31 3a5d 2929 0a20  escape(s[1:])). 
+00001300: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00001310: 2020 2020 2020 2020 2072 6567 6578 705f           regexp_
+00001320: 7061 7274 732e 6170 7065 6e64 2862 222e  parts.append(b".
+00001330: 2a22 290a 2020 2020 2020 2020 2020 2020  *").            
+00001340: 7265 6765 7870 5f70 6172 7473 2e61 7070  regexp_parts.app
+00001350: 656e 6428 7265 2e65 7363 6170 6528 7329  end(re.escape(s)
+00001360: 290a 2020 2020 7265 6765 7870 203d 2062  ).    regexp = b
+00001370: 2222 2e6a 6f69 6e28 7265 6765 7870 5f70  "".join(regexp_p
+00001380: 6172 7473 290a 2020 2020 6966 2069 676e  arts).    if ign
+00001390: 6f72 655f 7072 6f6d 7074 5f6e 756d 6265  ore_prompt_numbe
+000013a0: 723a 0a20 2020 2020 2020 2072 6567 6578  r:.        regex
+000013b0: 7020 3d20 7265 2e73 7562 2862 7222 2849  p = re.sub(br"(I
+000013c0: 6e5c 5c3f 207c 4f75 7429 5c5c 2a5c 5b5b  n\\? |Out)\\*\[[
+000013d0: 302d 395d 2b5c 5c2a 5c5d 5c5c 3f3a 222c  0-9]+\\*\]\\?:",
+000013e0: 2062 7222 5c31 5c5b 5b30 2d39 5d2b 5c5d   br"\1\[[0-9]+\]
+000013f0: 3a22 2c20 7265 6765 7870 290a 2020 2020  :", regexp).    
+00001400: 6966 205f 4950 5954 484f 4e5f 5645 5253  if _IPYTHON_VERS
+00001410: 494f 4e20 3e3d 2028 342c 293a 0a20 2020  ION >= (4,):.   
+00001420: 2020 2020 2069 676e 6f72 6520 3d20 6465       ignore = de
+00001430: 6465 6e74 2872 2222 220a 2020 2020 2020  dent(r""".      
+00001440: 2020 2020 2020 285c 5b5a 4d51 5465 726d        (\[ZMQTerm
+00001450: 696e 616c 4950 7974 686f 6e41 7070 5c5d  inalIPythonApp\]
+00001460: 204c 6f61 6469 6e67 2049 5079 7468 6f6e   Loading IPython
+00001470: 2065 7874 656e 7369 6f6e 3a20 7374 6f72   extension: stor
+00001480: 656d 6167 6963 0a20 2020 2020 2020 2020  emagic.         
+00001490: 2020 2029 3f0a 2020 2020 2020 2020 2222     )?.        ""
+000014a0: 2229 2e73 7472 6970 2829 2e65 6e63 6f64  ").strip().encod
+000014b0: 6528 2775 7466 2d38 2729 0a20 2020 2020  e('utf-8').     
+000014c0: 2020 2072 6573 756c 7420 3d20 7265 2e73     result = re.s
+000014d0: 7562 2869 676e 6f72 652c 2062 2222 2c20  ub(ignore, b"", 
+000014e0: 7265 7375 6c74 290a 0a20 2020 2020 2020  result)..       
+000014f0: 2023 2069 676e 6f72 6520 7365 6c66 2065   # ignore self e
+00001500: 7869 7420 6f6e 2072 6561 646c 696e 652e  xit on readline.
+00001510: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
+00001520: 3d20 7265 2e73 7562 2862 7222 496e 205c  = re.sub(br"In \
+00001530: 5b5c 642b 5c5d 3a20 6578 6974 5c28 5c29  [\d+\]: exit\(\)
+00001540: 222c 2062 2222 2c20 7265 7375 6c74 290a  ", b"", result).
+00001550: 0a20 2020 2020 2020 2069 6620 7379 732e  .        if sys.
+00001560: 7665 7273 696f 6e5f 696e 666f 5b30 5d20  version_info[0] 
+00001570: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
+00001580: 2020 2320 6967 6e6f 7265 2022 646f 7562    # ignore "doub
+00001590: 6c65 2062 6c61 6e6b 206c 696e 6573 2220  le blank lines" 
+000015a0: 6475 6520 746f 205c 6e5c 720a 2020 2020  due to \n\r.    
+000015b0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+000015c0: 2072 6573 756c 742e 7265 706c 6163 6528   result.replace(
+000015d0: 225c 6e5c 7222 2c20 225c 6e22 290a 2020  "\n\r", "\n").  
+000015e0: 2020 6966 205f 4950 5954 484f 4e5f 5645    if _IPYTHON_VE
+000015f0: 5253 494f 4e20 3c20 2831 2c20 3029 3a0a  RSION < (1, 0):.
+00001600: 2020 2020 2020 2020 2320 4950 7974 686f          # IPytho
+00001610: 6e20 302e 3133 2063 6f6e 736f 6c65 2070  n 0.13 console p
+00001620: 7269 6e74 7320 6b65 726e 656c 2069 6e66  rints kernel inf
+00001630: 6f3b 2069 676e 6f72 6520 6974 2e0a 2020  o; ignore it..  
+00001640: 2020 2020 2020 2320 2020 5b49 504b 6572        #   [IPKer
+00001650: 6e65 6c41 7070 5d20 546f 2063 6f6e 6e65  nelApp] To conne
+00001660: 6374 2061 6e6f 7468 6572 2063 6c69 656e  ct another clien
+00001670: 7420 746f 2074 6869 7320 6b65 726e 656c  t to this kernel
+00001680: 2c20 7573 653a 0a20 2020 2020 2020 2023  , use:.        #
+00001690: 2020 205b 4950 4b65 726e 656c 4170 705d     [IPKernelApp]
+000016a0: 202d 2d65 7869 7374 696e 6720 6b65 726e   --existing kern
+000016b0: 656c 2d31 3233 3435 2e6a 736f 6e0a 2020  el-12345.json.  
+000016c0: 2020 2020 2020 6967 6e6f 7265 203d 2064        ignore = d
+000016d0: 6564 656e 7428 7222 2222 0a20 2020 2020  edent(r""".     
+000016e0: 2020 2020 2020 2028 5c5b 4950 4b65 726e         (\[IPKern
+000016f0: 656c 4170 705c 5d20 546f 2063 6f6e 6e65  elApp\] To conne
+00001700: 6374 2061 6e6f 7468 6572 2063 6c69 656e  ct another clien
+00001710: 7420 746f 2074 6869 7320 6b65 726e 656c  t to this kernel
+00001720: 2c20 7573 653a 0a20 2020 2020 2020 2020  , use:.         
+00001730: 2020 205c 5b49 504b 6572 6e65 6c41 7070     \[IPKernelApp
+00001740: 5c5d 202d 2d65 7869 7374 696e 6720 6b65  \] --existing ke
+00001750: 726e 656c 2d5b 302d 395d 2b5c 2e6a 736f  rnel-[0-9]+\.jso
+00001760: 6e0a 2020 2020 2020 2020 2020 2020 293f  n.            )?
+00001770: 0a20 2020 2020 2020 2022 2222 292e 7374  .        """).st
+00001780: 7269 7028 292e 656e 636f 6465 2827 7574  rip().encode('ut
+00001790: 662d 3827 290a 2020 2020 2020 2020 7265  f-8').        re
+000017a0: 7375 6c74 203d 2072 652e 7375 6228 6967  sult = re.sub(ig
+000017b0: 6e6f 7265 2c20 6222 222c 2072 6573 756c  nore, b"", resul
+000017c0: 7429 0a20 2020 2069 6620 5f49 5059 5448  t).    if _IPYTH
+000017d0: 4f4e 5f56 4552 5349 4f4e 203c 2028 302c  ON_VERSION < (0,
+000017e0: 2031 3129 3a0a 2020 2020 2020 2020 2320   11):.        # 
+000017f0: 4950 7974 686f 6e20 302e 3130 2070 726f  IPython 0.10 pro
+00001800: 6d70 7420 636f 756e 7473 2061 7265 2062  mpt counts are b
+00001810: 7567 6779 2c20 652e 672e 2025 7469 6d65  uggy, e.g. %time
+00001820: 2069 6e63 7265 6d65 6e74 7320 6279 2032   increments by 2
+00001830: 2e0a 2020 2020 2020 2020 2320 4967 6e6f  ..        # Igno
+00001840: 7265 2070 726f 6d70 7420 6e75 6d62 6572  re prompt number
+00001850: 7320 616e 6420 6578 7472 6120 6e65 776c  s and extra newl
+00001860: 696e 6573 2062 6566 6f72 6520 7468 6520  ines before the 
+00001870: 6f75 7470 7574 2070 726f 6d70 742e 0a20  output prompt.. 
+00001880: 2020 2020 2020 2072 6567 6578 7020 3d20         regexp = 
+00001890: 7265 2e73 7562 2872 652e 636f 6d70 696c  re.sub(re.compil
+000018a0: 6528 6272 225e 496e 5c5c 3f20 5c5c 5c5b  e(br"^In\\? \\\[
+000018b0: 5b30 2d39 5d2b 5c5c 5c5d 222c 2072 652e  [0-9]+\\\]", re.
+000018c0: 4d29 2c0a 2020 2020 2020 2020 2020 2020  M),.            
+000018d0: 2020 2020 2020 2020 2020 2020 6272 2249              br"I
+000018e0: 6e20 5c5b 5b30 2d39 5d2b 5c5d 222c 2072  n \[[0-9]+\]", r
+000018f0: 6567 6578 7029 0a20 2020 2020 2020 2072  egexp).        r
+00001900: 6567 6578 7020 3d20 7265 2e73 7562 2872  egexp = re.sub(r
+00001910: 652e 636f 6d70 696c 6528 6272 225e 4f75  e.compile(br"^Ou
+00001920: 745c 5c5c 5b5b 302d 395d 2b5c 5c5c 5d22  t\\\[[0-9]+\\\]"
 00001930: 2c20 7265 2e4d 292c 0a20 2020 2020 2020  , re.M),.       
 00001940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001950: 2062 7222 496e 205c 5b5b 302d 395d 2b5c   br"In \[[0-9]+\
-00001960: 5d22 2c20 7265 6765 7870 290a 2020 2020  ]", regexp).    
-00001970: 2020 2020 7265 6765 7870 203d 2072 652e      regexp = re.
-00001980: 7375 6228 7265 2e63 6f6d 7069 6c65 2862  sub(re.compile(b
-00001990: 7222 5e4f 7574 5c5c 5c5b 5b30 2d39 5d2b  r"^Out\\\[[0-9]+
-000019a0: 5c5c 5c5d 222c 2072 652e 4d29 2c0a 2020  \\\]", re.M),.  
-000019b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000019c0: 2020 2020 2020 6272 225c 6e3f 4f75 745c        br"\n?Out\
-000019d0: 5b5b 302d 395d 2b5c 5d22 2c20 7265 6765  [[0-9]+\]", rege
-000019e0: 7870 290a 2020 2020 6966 205f 4950 5954  xp).    if _IPYT
-000019f0: 484f 4e5f 5645 5253 494f 4e20 3c20 2830  HON_VERSION < (0
-00001a00: 2c20 3132 293a 0a20 2020 2020 2020 2023  , 12):.        #
-00001a10: 2049 676e 6f72 6520 756c 7472 6174 6220   Ignore ultratb 
-00001a20: 7072 6f62 6c65 6d73 2028 6e6f 7420 7079  problems (not py
-00001a30: 666c 7962 792d 7265 6c61 7465 6429 2e0a  flyby-related)..
-00001a40: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
-00001a50: 636f 6e73 6964 6572 2075 7369 6e67 202d  consider using -
-00001a60: 2d54 6572 6d69 6e61 6c49 6e74 6572 6163  -TerminalInterac
-00001a70: 7469 7665 5368 656c 6c2e 786d 6f64 653d  tiveShell.xmode=
-00001a80: 706c 6169 6e20 282d 786d 6f64 6529 0a20  plain (-xmode). 
-00001a90: 2020 2020 2020 2069 676e 6f72 6520 3d20         ignore = 
-00001aa0: 6465 6465 6e74 2872 2222 220a 2020 2020  dedent(r""".    
-00001ab0: 2020 2020 2020 2020 2845 5252 4f52 3a20          (ERROR: 
-00001ac0: 416e 2075 6e65 7870 6563 7465 6420 6572  An unexpected er
-00001ad0: 726f 7220 6f63 6375 7272 6564 2077 6869  ror occurred whi
-00001ae0: 6c65 2074 6f6b 656e 697a 696e 6720 696e  le tokenizing in
-00001af0: 7075 740a 2020 2020 2020 2020 2020 2020  put.            
-00001b00: 5468 6520 666f 6c6c 6f77 696e 6720 7472  The following tr
-00001b10: 6163 6562 6163 6b20 6d61 7920 6265 2063  aceback may be c
-00001b20: 6f72 7275 7074 6564 206f 7220 696e 7661  orrupted or inva
-00001b30: 6c69 640a 2020 2020 2020 2020 2020 2020  lid.            
-00001b40: 5468 6520 6572 726f 7220 6d65 7373 6167  The error messag
-00001b50: 6520 6973 3a20 2e2a 0a20 2020 2020 2020  e is: .*.       
-00001b60: 2020 2020 2029 3f0a 2020 2020 2020 2020       )?.        
-00001b70: 2222 2229 2e73 7472 6970 2829 2e65 6e63  """).strip().enc
-00001b80: 6f64 6528 2775 7466 2d38 2729 0a20 2020  ode('utf-8').   
-00001b90: 2020 2020 2072 6573 756c 7420 3d20 7265       result = re
-00001ba0: 2e73 7562 2869 676e 6f72 652c 2062 2222  .sub(ignore, b""
-00001bb0: 2c20 7265 7375 6c74 290a 2020 2020 6966  , result).    if
-00001bc0: 205f 4950 5954 484f 4e5f 5645 5253 494f   _IPYTHON_VERSIO
-00001bd0: 4e20 3c20 2831 2c20 3029 3a0a 2020 2020  N < (1, 0):.    
-00001be0: 2020 2020 2320 4967 6e6f 7265 207a 6d71      # Ignore zmq
-00001bf0: 2076 6572 7369 6f6e 2077 6172 6e69 6e67   version warning
-00001c00: 7320 286e 6f74 2070 7966 6c79 6279 2d72  s (not pyflyby-r
-00001c10: 656c 6174 6564 292e 0a20 2020 2020 2020  elated)..       
-00001c20: 2023 2054 4f44 4f3a 2069 6e73 7461 6c6c   # TODO: install
-00001c30: 206f 6c64 6572 2076 6572 7369 6f6e 206f   older version o
-00001c40: 6620 7a6d 7120 666f 7220 6f6c 6465 7220  f zmq for older 
-00001c50: 4950 7974 686f 6e20 7665 7273 696f 6e73  IPython versions
-00001c60: 2e0a 2020 2020 2020 2020 6967 6e6f 7265  ..        ignore
-00001c70: 203d 2064 6564 656e 7428 7222 2222 0a20   = dedent(r""". 
-00001c80: 2020 2020 2020 2020 2020 2028 2f2e 2a2f             (/.*/
-00001c90: 4950 7974 686f 6e2f 7a6d 712f 5f5f 696e  IPython/zmq/__in
-00001ca0: 6974 5f5f 2e70 793a 5c64 2b3a 2052 756e  it__.py:\d+: Run
-00001cb0: 7469 6d65 5761 726e 696e 673a 206c 6962  timeWarning: lib
-00001cc0: 7a6d 7120 5c64 2b20 6465 7465 6374 6564  zmq \d+ detected
-00001cd0: 2e0a 2020 2020 2020 2020 2020 2020 5c73  ..            \s
-00001ce0: 2a49 7420 6973 2075 6e6c 696b 656c 7920  *It is unlikely 
-00001cf0: 7468 6174 2049 5079 7468 6f6e 2773 207a  that IPython's z
-00001d00: 6d71 2063 6f64 6520 7769 6c6c 2077 6f72  mq code will wor
-00001d10: 6b20 7072 6f70 6572 6c79 2e0a 2020 2020  k properly..    
-00001d20: 2020 2020 2020 2020 5c73 2a50 6c65 6173          \s*Pleas
-00001d30: 6520 696e 7374 616c 6c20 6c69 627a 6d71  e install libzmq
-00001d40: 2073 7461 626c 652e 2a3f 0a20 2020 2020   stable.*?.     
-00001d50: 2020 2020 2020 205c 732a 5275 6e74 696d         \s*Runtim
-00001d60: 6557 6172 6e69 6e67 5c29 0a20 2020 2020  eWarning\).     
-00001d70: 2020 2020 2020 2029 3f0a 2020 2020 2020         )?.      
-00001d80: 2020 2222 2229 2e73 7472 6970 2829 2e65    """).strip().e
-00001d90: 6e63 6f64 6528 2775 7466 2d38 2729 0a20  ncode('utf-8'). 
-00001da0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00001db0: 7265 2e73 7562 2869 676e 6f72 652c 2062  re.sub(ignore, b
-00001dc0: 2222 2c20 7265 7375 6c74 290a 2020 2020  "", result).    
-00001dd0: 2320 4967 6e6f 7265 2074 6865 2022 436f  # Ignore the "Co
-00001de0: 6d70 696c 6572 2074 696d 653a 2030 2e31  mpiler time: 0.1
-00001df0: 3233 2073 2220 7768 6963 6820 6d61 7920  23 s" which may 
-00001e00: 6f63 6361 7369 6f6e 616c 6c79 2061 7070  occasionally app
-00001e10: 6561 720a 2020 2020 2320 6465 7065 6e64  ear.    # depend
-00001e20: 696e 6720 6f6e 2072 756e 7469 6d65 2e0a  ing on runtime..
-00001e30: 2020 2020 7265 6765 7870 203d 2072 652e      regexp = re.
-00001e40: 7375 6228 7265 2e63 6f6d 7069 6c65 2862  sub(re.compile(b
-00001e50: 7222 5e28 315b 5c5c 5d2a 206c 6f6f 7073  r"^(1[\\]* loops
-00001e60: 5b5c 5c5d 2a2c 5b5c 5c5d 2a20 6265 7374  [\\]*,[\\]* best
-00001e70: 5b5c 5c5d 2a20 6f66 5b5c 5c5d 2a20 315b  [\\]* of[\\]* 1[
-00001e80: 5c5c 5d2a 3a5b 5c5c 5d2a 202e 2a5b 5c5c  \\]*:[\\]* .*[\\
-00001e90: 5d2a 2070 6572 5b5c 5c5d 2a20 6c6f 6f70  ]* per[\\]* loop
-00001ea0: 2928 247c 5b24 5d7c 5b5c 5c5d 2a5c 6e29  )($|[$]|[\\]*\n)
-00001eb0: 222c 2072 652e 4d29 2c0a 2020 2020 2020  ", re.M),.      
-00001ec0: 2020 2020 2020 2020 2020 2020 2020 6222                b"
-00001ed0: 5c5c 3128 3f3a 5c6e 436f 6d70 696c 6572  \\1(?:\nCompiler
-00001ee0: 2028 3f3a 7469 6d65 293f 3a20 5b30 2d39   (?:time)?: [0-9
-00001ef0: 2e5d 2b20 7329 3f5c 5c32 222c 2072 6567  .]+ s)?\\2", reg
-00001f00: 6578 7029 0a20 2020 2072 6567 6578 7020  exp).    regexp 
-00001f10: 3d20 7265 2e73 7562 2872 652e 636f 6d70  = re.sub(re.comp
-00001f20: 696c 6528 6272 225e 2857 616c 6c5b 5c5c  ile(br"^(Wall[\\
-00001f30: 5d2a 2074 696d 655b 5c5c 5d2a 3a2e 2a3f  ]* time[\\]*:.*?
-00001f40: 2928 247c 5b24 5d7c 5b5c 5c5d 2a5c 6e29  )($|[$]|[\\]*\n)
-00001f50: 222c 2072 652e 4d29 2c0a 2020 2020 2020  ", re.M),.      
-00001f60: 2020 2020 2020 2020 2020 2020 2020 6222                b"
-00001f70: 5c5c 3128 3f3a 5c6e 436f 6d70 696c 6572  \\1(?:\nCompiler
-00001f80: 2028 3f3a 7469 6d65 293f 3a20 5b30 2d39   (?:time)?: [0-9
-00001f90: 2e5d 2b20 7329 3f5c 5c32 222c 2072 6567  .]+ s)?\\2", reg
-00001fa0: 6578 7029 0a20 2020 2072 6567 6578 7020  exp).    regexp 
-00001fb0: 2b3d 2062 2224 220a 2020 2020 2320 4368  += b"$".    # Ch
-00001fc0: 6563 6b20 666f 7220 6d61 7463 682e 0a20  eck for match.. 
-00001fd0: 2020 2072 6567 6578 7020 3d20 7265 2e63     regexp = re.c
-00001fe0: 6f6d 7069 6c65 2872 6567 6578 7029 0a20  ompile(regexp). 
-00001ff0: 2020 2072 6573 756c 7420 3d20 6227 5c6e     result = b'\n
-00002000: 272e 6a6f 696e 286c 696e 652e 7273 7472  '.join(line.rstr
-00002010: 6970 2829 2066 6f72 206c 696e 6520 696e  ip() for line in
-00002020: 2072 6573 756c 742e 7370 6c69 746c 696e   result.splitlin
-00002030: 6573 2829 290a 2020 2020 7265 7375 6c74  es()).    result
-00002040: 203d 2072 6573 756c 742e 7374 7269 7028   = result.strip(
-00002050: 290a 2020 2020 6966 2044 4542 5547 3a0a  ).    if DEBUG:.
-00002060: 2020 2020 2020 2020 7072 696e 7428 2265          print("e
-00002070: 7870 6563 7465 643a 2025 7222 2025 2028  xpected: %r" % (
-00002080: 6578 7065 6374 6564 2c29 290a 2020 2020  expected,)).    
-00002090: 2020 2020 7072 696e 7428 2272 6573 756c      print("resul
-000020a0: 7420 203a 2025 7222 2025 2028 7265 7375  t  : %r" % (resu
-000020b0: 6c74 2c29 290a 2020 2020 6966 206e 6f74  lt,)).    if not
-000020c0: 2072 6567 6578 702e 6d61 7463 6828 7265   regexp.match(re
-000020d0: 7375 6c74 293a 0a20 2020 2020 2020 206d  sult):.        m
-000020e0: 7367 203d 205b 5d0a 2020 2020 2020 2020  sg = [].        
-000020f0: 6d73 672e 6170 7065 6e64 2822 4578 7065  msg.append("Expe
-00002100: 6374 6564 3a22 290a 2020 2020 2020 2020  cted:").        
-00002110: 6d73 672e 6578 7465 6e64 2822 2020 2020  msg.extend("    
-00002120: 2025 7322 256c 696e 6520 666f 7220 6c69   %s"%line for li
-00002130: 6e65 2069 6e20 6578 7065 6374 6564 2e73  ne in expected.s
-00002140: 706c 6974 6c69 6e65 7328 2929 0a20 2020  plitlines()).   
-00002150: 2020 2020 206d 7367 2e61 7070 656e 6428       msg.append(
-00002160: 2252 6573 756c 743a 2229 0a20 2020 2020  "Result:").     
-00002170: 2020 206d 7367 2e65 7874 656e 6428 2220     msg.extend(" 
-00002180: 2020 2020 2573 2225 6c69 6e65 2066 6f72      %s"%line for
-00002190: 206c 696e 6520 696e 2072 6573 756c 742e   line in result.
-000021a0: 7370 6c69 746c 696e 6573 2829 290a 2020  splitlines()).  
-000021b0: 2020 2020 2020 6d73 672e 6170 7065 6e64        msg.append
-000021c0: 2822 4469 6666 3a22 290a 2020 2020 2020  ("Diff:").      
-000021d0: 2020 6d73 672e 6578 7465 6e64 2822 2020    msg.extend("  
-000021e0: 2025 7322 256c 696e 6520 666f 7220 6c69   %s"%line for li
-000021f0: 6e65 2069 6e20 6469 6666 6c69 622e 6e64  ne in difflib.nd
-00002200: 6966 6628 0a20 2020 2020 2020 2020 2020  iff(.           
-00002210: 2065 7870 6563 7465 642e 6465 636f 6465   expected.decode
-00002220: 2827 7574 662d 3827 292e 7370 6c69 746c  ('utf-8').splitl
-00002230: 696e 6573 2829 2c20 7265 7375 6c74 2e64  ines(), result.d
-00002240: 6563 6f64 6528 2775 7466 2d38 2729 2e73  ecode('utf-8').s
-00002250: 706c 6974 6c69 6e65 7328 2929 290a 2020  plitlines())).  
-00002260: 2020 2020 2020 6966 2044 4542 5547 206f        if DEBUG o
-00002270: 7220 616e 7928 6920 696e 2062 275c 7831  r any(i in b'\x1
-00002280: 625c 7830 375c 625c 7427 2066 6f72 2069  b\x07\b\t' for i
-00002290: 2069 6e20 6578 7065 6374 6564 2b72 6573   in expected+res
-000022a0: 756c 7429 3a0a 2020 2020 2020 2020 2020  ult):.          
-000022b0: 2020 6d73 672e 6170 7065 6e64 2822 4469    msg.append("Di
-000022c0: 6666 2052 6570 723a 2229 0a20 2020 2020  ff Repr:").     
-000022d0: 2020 2020 2020 206d 7367 2e65 7874 656e         msg.exten
-000022e0: 6428 2220 2020 2572 2225 6c69 6e65 2066  d("   %r"%line f
-000022f0: 6f72 206c 696e 6520 696e 2064 6966 666c  or line in diffl
-00002300: 6962 2e6e 6469 6666 280a 2020 2020 2020  ib.ndiff(.      
-00002310: 2020 2020 2020 2020 2020 6578 7065 6374            expect
-00002320: 6564 2e64 6563 6f64 6528 2775 7466 2d38  ed.decode('utf-8
-00002330: 2729 2e73 706c 6974 6c69 6e65 7328 292c  ').splitlines(),
-00002340: 2072 6573 756c 742e 6465 636f 6465 2827   result.decode('
-00002350: 7574 662d 3827 292e 7370 6c69 746c 696e  utf-8').splitlin
-00002360: 6573 2829 2929 0a20 2020 2020 2020 206d  es())).        m
-00002370: 7367 203d 2022 5c6e 222e 6a6f 696e 286d  sg = "\n".join(m
-00002380: 7367 290a 2020 2020 2020 2020 7079 7465  sg).        pyte
-00002390: 7374 2e66 6169 6c28 6d73 6729 0a0a 0a64  st.fail(msg)...d
-000023a0: 6566 2070 6172 7365 5f74 656d 706c 6174  ef parse_templat
-000023b0: 6528 7465 6d70 6c61 7465 2c20 636c 6561  e(template, clea
-000023c0: 725f 7461 625f 636f 6d70 6c65 7469 6f6e  r_tab_completion
-000023d0: 733d 4661 6c73 6529 3a0a 2020 2020 7465  s=False):.    te
-000023e0: 6d70 6c61 7465 203d 2064 6564 656e 7428  mplate = dedent(
-000023f0: 7465 6d70 6c61 7465 292e 7374 7269 7028  template).strip(
-00002400: 292e 656e 636f 6465 2827 7574 662d 3827  ).encode('utf-8'
-00002410: 290a 2020 2020 7465 6d70 6c61 7465 203d  ).    template =
-00002420: 205f 6e6f 726d 616c 697a 655f 7079 7468   _normalize_pyth
-00002430: 6f6e 5f32 5f33 2874 656d 706c 6174 6529  on_2_3(template)
-00002440: 0a20 2020 2069 6e70 7574 203d 205b 5d0a  .    input = [].
-00002450: 2020 2020 6578 7065 6374 6564 203d 2062      expected = b
-00002460: 2222 0a20 2020 2070 6174 7465 726e 203d  "".    pattern =
-00002470: 2072 652e 636f 6d70 696c 6528 6272 225e   re.compile(br"^
-00002480: 283f 3a49 6e20 5c5b 5b30 2d39 5d2b 5c5d  (?:In \[[0-9]+\]
-00002490: 3a7c 2020 205b 2e5d 5b2e 5d5b 2e5d 2b3a  :|   [.][.][.]+:
-000024a0: 7c69 7064 623e 7c3e 3e3e 2928 3f3a 207c  |ipdb>|>>>)(?: |
-000024b0: 2429 222c 2072 652e 4d29 0a20 2020 2077  $)", re.M).    w
-000024c0: 6869 6c65 2074 656d 706c 6174 653a 0a20  hile template:. 
-000024d0: 2020 2020 2020 206d 203d 2070 6174 7465         m = patte
-000024e0: 726e 2e73 6561 7263 6828 7465 6d70 6c61  rn.search(templa
-000024f0: 7465 290a 2020 2020 2020 2020 6966 206e  te).        if n
-00002500: 6f74 206d 3a0a 2020 2020 2020 2020 2020  ot m:.          
-00002510: 2020 6578 7065 6374 6564 202b 3d20 7465    expected += te
-00002520: 6d70 6c61 7465 0a20 2020 2020 2020 2020  mplate.         
-00002530: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-00002540: 2065 7870 6c69 6e65 203d 206d 2e67 726f   expline = m.gro
-00002550: 7570 2830 290a 2020 2020 2020 2020 6578  up(0).        ex
-00002560: 7065 6374 6564 202b 3d20 7465 6d70 6c61  pected += templa
-00002570: 7465 5b3a 6d2e 656e 6428 295d 0a20 2020  te[:m.end()].   
-00002580: 2020 2020 2074 656d 706c 6174 6520 3d20       template = 
-00002590: 7465 6d70 6c61 7465 5b6d 2e65 6e64 2829  template[m.end()
-000025a0: 3a5d 0a20 2020 2020 2020 2077 6869 6c65  :].        while
-000025b0: 2074 656d 706c 6174 6520 616e 6420 6e6f   template and no
-000025c0: 7420 7465 6d70 6c61 7465 2e73 7461 7274  t template.start
-000025d0: 7377 6974 6828 6222 5c6e 2229 3a0a 2020  swith(b"\n"):.  
-000025e0: 2020 2020 2020 2020 2020 2320 5765 2772            # We'r
-000025f0: 6520 696e 2074 6865 2069 6e70 7574 2070  e in the input p
-00002600: 6172 7420 6f66 2061 2074 656d 706c 6174  art of a templat
-00002610: 652e 2020 4765 7420 696e 7075 7420 7570  e.  Get input up
-00002620: 2074 6f20 7461 6220 6f72 0a20 2020 2020   to tab or.     
-00002630: 2020 2020 2020 2023 2065 6e64 206f 6620         # end of 
-00002640: 6c69 6e65 2e0a 2020 2020 2020 2020 2020  line..          
-00002650: 2020 6d20 3d20 7265 2e6d 6174 6368 2872    m = re.match(r
-00002660: 652e 636f 6d70 696c 6528 6272 2228 2e2a  e.compile(br"(.*
-00002670: 3f29 285c 747c 2429 222c 2072 652e 4d29  ?)(\t|$)", re.M)
-00002680: 2c20 7465 6d70 6c61 7465 290a 2020 2020  , template).    
-00002690: 2020 2020 2020 2020 696e 7075 742e 6170          input.ap
-000026a0: 7065 6e64 286d 2e67 726f 7570 2831 2929  pend(m.group(1))
-000026b0: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
-000026c0: 6c69 6e65 202b 3d20 6d2e 6772 6f75 7028  line += m.group(
-000026d0: 3129 0a20 2020 2020 2020 2020 2020 2065  1).            e
-000026e0: 7870 6563 7465 6420 2b3d 206d 2e67 726f  xpected += m.gro
-000026f0: 7570 2831 290a 2020 2020 2020 2020 2020  up(1).          
-00002700: 2020 7461 6220 3d20 6d2e 6772 6f75 7028    tab = m.group(
-00002710: 3229 0a20 2020 2020 2020 2020 2020 2074  2).            t
-00002720: 656d 706c 6174 6520 3d20 7465 6d70 6c61  emplate = templa
-00002730: 7465 5b6d 2e65 6e64 2829 3a5d 0a20 2020  te[m.end():].   
-00002740: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00002750: 7461 623a 0a20 2020 2020 2020 2020 2020  tab:.           
-00002760: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-00002770: 2020 2020 2020 2023 2047 6f74 2061 2074         # Got a t
-00002780: 6162 2e20 2049 6e63 6c75 6465 2074 6865  ab.  Include the
-00002790: 2074 6162 2069 6e20 696e 7075 7420 746f   tab in input to
-000027a0: 2073 656e 642c 2062 7574 206e 6f74 2069   send, but not i
-000027b0: 6e0a 2020 2020 2020 2020 2020 2020 2320  n.            # 
-000027c0: 6578 7065 6374 6564 206f 7574 7075 742e  expected output.
-000027d0: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
-000027e0: 7574 2e61 7070 656e 6428 7461 6229 0a20  ut.append(tab). 
-000027f0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-00002800: 7468 6520 7465 6d70 6c61 7465 2065 6e64  the template end
-00002810: 7320 6120 6c69 6e65 2077 6974 6820 6120  s a line with a 
-00002820: 7461 622c 2074 6865 6e20 6173 7375 6d65  tab, then assume
-00002830: 2074 6861 740a 2020 2020 2020 2020 2020   that.          
-00002840: 2020 2320 4950 7974 686f 6e20 7769 6c6c    # IPython will
-00002850: 206f 7574 7075 7420 736f 6d65 206c 6f67   output some log
-00002860: 6769 6e67 2028 6173 2069 6e63 6c75 6465  ging (as include
-00002870: 6420 696e 2074 6865 0a20 2020 2020 2020  d in the.       
-00002880: 2020 2020 2023 2074 656d 706c 6174 6529       # template)
-00002890: 2061 6e64 2072 6570 6561 7420 7468 6520   and repeat the 
-000028a0: 6c69 6e65 2073 6f20 6661 7220 2861 7320  line so far (as 
-000028b0: 696e 636c 7564 6564 2069 6e20 7468 650a  included in the.
-000028c0: 2020 2020 2020 2020 2020 2020 2320 7465              # te
-000028d0: 6d70 6c61 7465 292c 2074 6865 6e20 706f  mplate), then po
-000028e0: 7373 6962 6c79 2074 6162 2063 6f6d 706c  ssibly tab compl
-000028f0: 6574 6520 736f 6d65 206d 6f72 652e 2020  ete some more.  
-00002900: 4974 206d 6967 6874 0a20 2020 2020 2020  It might.       
-00002910: 2020 2020 2023 2062 6520 7265 7065 6174       # be repeat
-00002920: 6564 206d 756c 7469 706c 6520 7469 6d65  ed multiple time
-00002930: 732c 2066 6f72 2061 2074 6f74 616c 206f  s, for a total o
-00002940: 6620 7570 2074 6f20 7468 7265 650a 2020  f up to three.  
-00002950: 2020 2020 2020 2020 2020 2320 6f63 6375            # occu
-00002960: 7272 656e 6365 7320 6f66 2074 6865 2073  rrences of the s
-00002970: 616d 6520 7072 6f6d 7074 2e20 2057 6520  ame prompt.  We 
-00002980: 6669 6e64 2077 6865 7265 2074 6f20 636f  find where to co
-00002990: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-000029a0: 2020 2023 2062 7920 6c6f 6f6b 696e 6720     # by looking 
-000029b0: 666f 7220 7468 6520 6c69 6e65 2072 6570  for the line rep
-000029c0: 6561 7465 6420 696e 2074 6865 2074 656d  eated in the tem
-000029d0: 706c 6174 652e 0a20 2020 2020 2020 2020  plate..         
-000029e0: 2020 2069 6620 7465 6d70 6c61 7465 2e73     if template.s
-000029f0: 7461 7274 7377 6974 6828 6222 5c6e 2229  tartswith(b"\n")
-00002a00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00002a10: 2020 6966 2063 6c65 6172 5f74 6162 5f63    if clear_tab_c
-00002a20: 6f6d 706c 6574 696f 6e73 3a0a 2020 2020  ompletions:.    
-00002a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002a40: 2320 496e 2070 726f 6d70 742d 746f 6f6c  # In prompt-tool
-00002a50: 6b69 7420 322e 302c 2074 6162 2063 6f6d  kit 2.0, tab com
-00002a60: 706c 6574 696f 6e20 6174 2074 6865 2065  pletion at the e
-00002a70: 6e64 206f 6620 7468 6520 6c69 6e65 2069  nd of the line i
-00002a80: 7320 636c 6561 7265 6420 696e 2074 6865  s cleared in the
-00002a90: 206f 7574 7075 740a 2020 2020 2020 2020   output.        
-00002aa0: 2020 2020 2020 2020 2020 2020 6e65 776c              newl
-00002ab0: 696e 6520 3d20 6578 7065 6374 6564 2e72  ine = expected.r
-00002ac0: 6669 6e64 2862 275c 6e27 290a 2020 2020  find(b'\n').    
-00002ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ae0: 6966 206e 6577 6c69 6e65 203d 3d20 2d31  if newline == -1
-00002af0: 3a20 6e65 776c 696e 6520 3d20 300a 2020  : newline = 0.  
-00002b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002b10: 2020 6578 7065 6374 6564 203d 2065 7870    expected = exp
-00002b20: 6563 7465 645b 3a6e 6577 6c69 6e65 5d0a  ected[:newline].
-00002b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002b40: 2072 6570 203d 2074 656d 706c 6174 652e   rep = template.
-00002b50: 7266 696e 6428 6578 706c 696e 6529 0a20  rfind(expline). 
-00002b60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00002b70: 6620 7265 7020 3c20 303a 0a20 2020 2020  f rep < 0:.     
-00002b80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00002b90: 6169 7365 2041 7373 6572 7469 6f6e 4572  aise AssertionEr
-00002ba0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00002bb0: 2020 2020 2020 2020 2020 2020 2022 6578               "ex
-00002bc0: 7065 6374 6564 206e 6578 7420 6c69 6e65  pected next line
-00002bd0: 206f 6620 7465 6d70 6c61 7465 2066 6f6c   of template fol
-00002be0: 6c6f 7769 6e67 2061 2022 0a20 2020 2020  lowing a ".     
-00002bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002c00: 2020 2022 7461 6220 636f 6d70 6c65 7469     "tab completi
-00002c10: 6f6e 2074 6f20 7374 6172 7420 7769 7468  on to start with
-00002c20: 2025 7222 2025 2028 6578 706c 696e 652c   %r" % (expline,
-00002c30: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00002c40: 2020 2072 6570 656e 6420 3d20 7265 7020     repend = rep 
-00002c50: 2b20 6c65 6e28 6578 706c 696e 6529 0a20  + len(expline). 
-00002c60: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00002c70: 7870 6563 7465 6420 2b3d 2074 656d 706c  xpected += templ
-00002c80: 6174 655b 3a72 6570 656e 645d 0a20 2020  ate[:repend].   
-00002c90: 2020 2020 2020 2020 2020 2020 2074 656d               tem
-00002ca0: 706c 6174 6520 3d20 7465 6d70 6c61 7465  plate = template
-00002cb0: 5b72 6570 656e 643a 5d0a 2020 2020 2020  [repend:].      
-00002cc0: 2020 2020 2020 2320 4173 7375 6d65 2074        # Assume t
-00002cd0: 6861 7420 616c 6c20 7375 6273 6571 7565  hat all subseque
-00002ce0: 6e74 2073 796d 626f 6c20 6368 6172 6163  nt symbol charac
-00002cf0: 7465 7273 2028 616c 7068 616e 756d 6572  ters (alphanumer
-00002d00: 6963 0a20 2020 2020 2020 2020 2020 2023  ic.            #
-00002d10: 2061 6e64 2075 6e64 6572 7363 6f72 6529   and underscore)
-00002d20: 2069 6e20 7468 6520 7465 6d70 6c61 7465   in the template
-00002d30: 2072 6570 7265 7365 6e74 2074 6162 2063   represent tab c
-00002d40: 6f6d 706c 6574 696f 6e0a 2020 2020 2020  ompletion.      
-00002d50: 2020 2020 2020 2320 6f75 7470 7574 2e0a        # output..
-00002d60: 2020 2020 2020 2020 2020 2020 6d20 3d20              m = 
-00002d70: 7265 2e6d 6174 6368 2862 7222 5b61 2d7a  re.match(br"[a-z
-00002d80: 412d 5a30 2d39 5f5d 2b22 2c20 7465 6d70  A-Z0-9_]+", temp
-00002d90: 6c61 7465 290a 2020 2020 2020 2020 2020  late).          
-00002da0: 2020 6966 206d 3a0a 2020 2020 2020 2020    if m:.        
-00002db0: 2020 2020 2020 2020 6578 706c 696e 6520          expline 
-00002dc0: 2b3d 206d 2e67 726f 7570 2830 290a 2020  += m.group(0).  
-00002dd0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00002de0: 7065 6374 6564 202b 3d20 6d2e 6772 6f75  pected += m.grou
-00002df0: 7028 3029 0a20 2020 2020 2020 2020 2020  p(0).           
-00002e00: 2020 2020 2074 656d 706c 6174 6520 3d20       template = 
-00002e10: 7465 6d70 6c61 7465 5b6d 2e65 6e64 2829  template[m.end()
-00002e20: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
-00002e30: 2020 2023 2041 6c6c 6f77 205c 7830 3620     # Allow \x06 
-00002e40: 696e 2074 6865 2074 656d 706c 6174 6520  in the template 
-00002e50: 746f 2062 6520 6120 7370 6563 6961 6c20  to be a special 
-00002e60: 6368 6172 6163 7465 7220 6d65 616e 696e  character meanin
-00002e70: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-00002e80: 2020 2320 2265 6e64 206f 6620 7461 6220    # "end of tab 
-00002e90: 636f 6d70 6c65 7469 6f6e 206f 7574 7075  completion outpu
-00002ea0: 7422 2e0a 2020 2020 2020 2020 2020 2020  t"..            
-00002eb0: 6966 2074 656d 706c 6174 652e 7374 6172  if template.star
-00002ec0: 7473 7769 7468 2862 225c 7830 3622 293a  tswith(b"\x06"):
-00002ed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002ee0: 2074 656d 706c 6174 6520 3d20 7465 6d70   template = temp
-00002ef0: 6c61 7465 5b31 3a5d 0a20 2020 2020 2020  late[1:].       
-00002f00: 2069 6e70 7574 2e61 7070 656e 6428 6222   input.append(b"
-00002f10: 5c6e 2229 0a20 2020 2069 6e70 7574 203d  \n").    input =
-00002f20: 2062 2222 2e6a 6f69 6e28 696e 7075 7429   b"".join(input)
-00002f30: 0a20 2020 2072 6574 7572 6e20 696e 7075  .    return inpu
-00002f40: 742c 2065 7870 6563 7465 640a 0a0a 4072  t, expected...@r
-00002f50: 6574 7279 0a40 7079 7465 7374 2e6d 6172  etry.@pytest.mar
-00002f60: 6b2e 7061 7261 6d65 7472 697a 6528 2763  k.parametrize('c
-00002f70: 6c65 6172 5f74 6162 5f63 6f6d 706c 6574  lear_tab_complet
-00002f80: 696f 6e73 272c 205b 4661 6c73 652c 2054  ions', [False, T
-00002f90: 7275 655d 290a 6465 6620 7465 7374 5f73  rue]).def test_s
-00002fa0: 656c 6674 6573 745f 7061 7273 655f 7465  elftest_parse_te
-00002fb0: 6d70 6c61 7465 5f31 2863 6c65 6172 5f74  mplate_1(clear_t
-00002fc0: 6162 5f63 6f6d 706c 6574 696f 6e73 293a  ab_completions):
-00002fd0: 0a20 2020 2074 656d 706c 6174 6520 3d20  .    template = 
-00002fe0: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-00002ff0: 315d 3a20 6865 6c6c 6f0a 2020 2020 2020  1]: hello.      
-00003000: 2020 7468 6572 650a 2020 2020 2020 2020    there.        
-00003010: 776f 726c 640a 2020 2020 2020 2020 496e  world.        In
-00003020: 205b 325d 3a20 666f 6f0a 2020 2020 2020   [2]: foo.      
-00003030: 2020 2020 202e 2e2e 3a20 6261 720a 2020       ...: bar.  
-00003040: 2020 2020 2020 2020 202e 2e2e 3a0a 2020           ...:.  
-00003050: 2020 2020 2020 6261 7a0a 2020 2020 2222        baz.    ""
-00003060: 220a 2020 2020 696e 7075 742c 2065 7870  ".    input, exp
-00003070: 6563 7465 6420 3d20 7061 7273 655f 7465  ected = parse_te
-00003080: 6d70 6c61 7465 2874 656d 706c 6174 652c  mplate(template,
-00003090: 2063 6c65 6172 5f74 6162 5f63 6f6d 706c   clear_tab_compl
-000030a0: 6574 696f 6e73 3d63 6c65 6172 5f74 6162  etions=clear_tab
-000030b0: 5f63 6f6d 706c 6574 696f 6e73 290a 2020  _completions).  
-000030c0: 2020 6173 7365 7274 2069 6e70 7574 203d    assert input =
-000030d0: 3d20 6222 6865 6c6c 6f5c 6e66 6f6f 5c6e  = b"hello\nfoo\n
-000030e0: 6261 725c 6e5c 6e22 0a20 2020 2061 7373  bar\n\n".    ass
-000030f0: 6572 7420 6578 7065 6374 6564 203d 3d20  ert expected == 
-00003100: 280a 2020 2020 2020 2020 6222 496e 205b  (.        b"In [
-00003110: 315d 3a20 6865 6c6c 6f5c 6e74 6865 7265  1]: hello\nthere
-00003120: 5c6e 776f 726c 645c 6e22 0a20 2020 2020  \nworld\n".     
-00003130: 2020 2062 2249 6e20 5b32 5d3a 2066 6f6f     b"In [2]: foo
-00003140: 5c6e 2020 202e 2e2e 3a20 6261 725c 6e20  \n   ...: bar\n 
-00003150: 2020 2e2e 2e3a 5c6e 6261 7a22 290a 0a0a    ...:\nbaz")...
-00003160: 4072 6574 7279 0a40 7079 7465 7374 2e6d  @retry.@pytest.m
-00003170: 6172 6b2e 7061 7261 6d65 7472 697a 6528  ark.parametrize(
-00003180: 2763 6c65 6172 5f74 6162 5f63 6f6d 706c  'clear_tab_compl
-00003190: 6574 696f 6e73 272c 205b 4661 6c73 652c  etions', [False,
-000031a0: 2054 7275 655d 290a 6465 6620 7465 7374   True]).def test
-000031b0: 5f73 656c 6674 6573 745f 7061 7273 655f  _selftest_parse_
-000031c0: 7465 6d70 6c61 7465 5f74 6162 5f70 756e  template_tab_pun
-000031d0: 6374 7561 7469 6f6e 5f31 2863 6c65 6172  ctuation_1(clear
-000031e0: 5f74 6162 5f63 6f6d 706c 6574 696f 6e73  _tab_completions
-000031f0: 293a 0a20 2020 2074 656d 706c 6174 6520  ):.    template 
-00003200: 3d20 2222 220a 2020 2020 2020 2020 496e  = """.        In
-00003210: 205b 315d 3a20 6865 6c6c 6f5c 745f 7468   [1]: hello\t_th
-00003220: 6572 6528 3329 0a20 2020 2020 2020 2067  ere(3).        g
-00003230: 6f6f 6462 7965 0a20 2020 2022 2222 0a20  oodbye.    """. 
-00003240: 2020 2069 6e70 7574 2c20 6578 7065 6374     input, expect
-00003250: 6564 203d 2070 6172 7365 5f74 656d 706c  ed = parse_templ
-00003260: 6174 6528 7465 6d70 6c61 7465 2c20 636c  ate(template, cl
-00003270: 6561 725f 7461 625f 636f 6d70 6c65 7469  ear_tab_completi
-00003280: 6f6e 733d 636c 6561 725f 7461 625f 636f  ons=clear_tab_co
-00003290: 6d70 6c65 7469 6f6e 7329 0a20 2020 2061  mpletions).    a
-000032a0: 7373 6572 7420 696e 7075 7420 3d3d 2062  ssert input == b
-000032b0: 2268 656c 6c6f 5c74 2833 295c 6e22 0a20  "hello\t(3)\n". 
-000032c0: 2020 2061 7373 6572 7420 6578 7065 6374     assert expect
-000032d0: 6564 203d 3d20 2862 2249 6e20 5b31 5d3a  ed == (b"In [1]:
-000032e0: 2068 656c 6c6f 5f74 6865 7265 2833 295c   hello_there(3)\
-000032f0: 6e67 6f6f 6462 7965 2229 0a0a 0a40 7265  ngoodbye")...@re
-00003300: 7472 790a 4070 7974 6573 742e 6d61 726b  try.@pytest.mark
-00003310: 2e70 6172 616d 6574 7269 7a65 2827 636c  .parametrize('cl
-00003320: 6561 725f 7461 625f 636f 6d70 6c65 7469  ear_tab_completi
-00003330: 6f6e 7327 2c20 5b46 616c 7365 2c20 5472  ons', [False, Tr
-00003340: 7565 5d29 0a64 6566 2074 6573 745f 7365  ue]).def test_se
-00003350: 6c66 7465 7374 5f70 6172 7365 5f74 656d  lftest_parse_tem
-00003360: 706c 6174 655f 7461 625f 6e65 776c 696e  plate_tab_newlin
-00003370: 655f 2863 6c65 6172 5f74 6162 5f63 6f6d  e_(clear_tab_com
-00003380: 706c 6574 696f 6e73 293a 0a20 2020 2074  pletions):.    t
-00003390: 656d 706c 6174 6520 3d20 2222 220a 2020  emplate = """.  
-000033a0: 2020 2020 2020 496e 205b 315d 3a20 6865        In [1]: he
-000033b0: 6c6c 6f5f 5c74 7468 6572 650a 2020 2020  llo_\tthere.    
-000033c0: 2020 2020 676f 6f64 6279 650a 2020 2020      goodbye.    
-000033d0: 2222 220a 2020 2020 696e 7075 742c 2065  """.    input, e
-000033e0: 7870 6563 7465 6420 3d20 7061 7273 655f  xpected = parse_
-000033f0: 7465 6d70 6c61 7465 2874 656d 706c 6174  template(templat
-00003400: 652c 2063 6c65 6172 5f74 6162 5f63 6f6d  e, clear_tab_com
-00003410: 706c 6574 696f 6e73 3d63 6c65 6172 5f74  pletions=clear_t
-00003420: 6162 5f63 6f6d 706c 6574 696f 6e73 290a  ab_completions).
-00003430: 2020 2020 6173 7365 7274 2069 6e70 7574      assert input
-00003440: 203d 3d20 6222 6865 6c6c 6f5f 5c74 5c6e   == b"hello_\t\n
-00003450: 220a 2020 2020 6173 7365 7274 2065 7870  ".    assert exp
-00003460: 6563 7465 6420 3d3d 2028 6222 496e 205b  ected == (b"In [
-00003470: 315d 3a20 6865 6c6c 6f5f 7468 6572 655c  1]: hello_there\
-00003480: 6e67 6f6f 6462 7965 2229 0a0a 0a40 7265  ngoodbye")...@re
-00003490: 7472 790a 4070 7974 6573 742e 6d61 726b  try.@pytest.mark
-000034a0: 2e70 6172 616d 6574 7269 7a65 2827 636c  .parametrize('cl
-000034b0: 6561 725f 7461 625f 636f 6d70 6c65 7469  ear_tab_completi
-000034c0: 6f6e 7327 2c20 5b46 616c 7365 2c20 5472  ons', [False, Tr
-000034d0: 7565 5d29 0a64 6566 2074 6573 745f 7365  ue]).def test_se
-000034e0: 6c66 7465 7374 5f70 6172 7365 5f74 656d  lftest_parse_tem
-000034f0: 706c 6174 655f 7461 625f 636f 6e74 696e  plate_tab_contin
-00003500: 7565 5f31 2863 6c65 6172 5f74 6162 5f63  ue_1(clear_tab_c
-00003510: 6f6d 706c 6574 696f 6e73 293a 0a20 2020  ompletions):.   
-00003520: 2074 656d 706c 6174 6520 3d20 2222 220a   template = """.
-00003530: 2020 2020 2020 2020 496e 205b 315d 3a20          In [1]: 
-00003540: 6865 6c6c 6f5c 745f 7468 655c 7830 3672  hello\t_the\x06r
-00003550: 6528 3329 0a20 2020 2020 2020 2067 6f6f  e(3).        goo
-00003560: 6462 7965 0a20 2020 2022 2222 0a20 2020  dbye.    """.   
-00003570: 2069 6e70 7574 2c20 6578 7065 6374 6564   input, expected
-00003580: 203d 2070 6172 7365 5f74 656d 706c 6174   = parse_templat
-00003590: 6528 7465 6d70 6c61 7465 290a 2020 2020  e(template).    
-000035a0: 6173 7365 7274 2069 6e70 7574 203d 3d20  assert input == 
-000035b0: 6222 6865 6c6c 6f5c 7472 6528 3329 5c6e  b"hello\tre(3)\n
-000035c0: 220a 2020 2020 6173 7365 7274 2065 7870  ".    assert exp
-000035d0: 6563 7465 6420 3d3d 2028 6222 496e 205b  ected == (b"In [
-000035e0: 315d 3a20 6865 6c6c 6f5f 7468 6572 6528  1]: hello_there(
-000035f0: 3329 5c6e 676f 6f64 6279 6522 290a 0a0a  3)\ngoodbye")...
-00003600: 4072 6574 7279 0a40 7079 7465 7374 2e6d  @retry.@pytest.m
-00003610: 6172 6b2e 7061 7261 6d65 7472 697a 6528  ark.parametrize(
-00003620: 2763 6c65 6172 5f74 6162 5f63 6f6d 706c  'clear_tab_compl
-00003630: 6574 696f 6e73 272c 205b 4661 6c73 652c  etions', [False,
-00003640: 2054 7275 655d 290a 6465 6620 7465 7374   True]).def test
-00003650: 5f73 656c 6674 6573 745f 7061 7273 655f  _selftest_parse_
-00003660: 7465 6d70 6c61 7465 5f74 6162 5f6c 6f67  template_tab_log
-00003670: 5f31 2863 6c65 6172 5f74 6162 5f63 6f6d  _1(clear_tab_com
-00003680: 706c 6574 696f 6e73 293a 0a20 2020 2074  pletions):.    t
-00003690: 656d 706c 6174 6520 3d20 2222 220a 2020  emplate = """.  
-000036a0: 2020 2020 2020 496e 205b 315d 3a20 6865        In [1]: he
-000036b0: 6c6c 6f5c 740a 2020 2020 2020 2020 626f  llo\t.        bo
-000036c0: 6e6a 6f75 720a 2020 2020 2020 2020 496e  njour.        In
-000036d0: 205b 315d 3a20 6865 6c6c 6f0a 2020 2020   [1]: hello.    
-000036e0: 2020 2020 6861 6c6c 6f0a 2020 2020 2020      hallo.      
-000036f0: 2020 496e 205b 315d 3a20 6865 6c6c 6f5f    In [1]: hello_
-00003700: 7468 6572 6528 3529 0a20 2020 2020 2020  there(5).       
-00003710: 2067 6f6f 6462 7965 0a20 2020 2022 2222   goodbye.    """
-00003720: 0a20 2020 2069 6e70 7574 2c20 6578 7065  .    input, expe
-00003730: 6374 6564 203d 2070 6172 7365 5f74 656d  cted = parse_tem
-00003740: 706c 6174 6528 7465 6d70 6c61 7465 2c20  plate(template, 
-00003750: 636c 6561 725f 7461 625f 636f 6d70 6c65  clear_tab_comple
-00003760: 7469 6f6e 733d 636c 6561 725f 7461 625f  tions=clear_tab_
-00003770: 636f 6d70 6c65 7469 6f6e 7329 0a20 2020  completions).   
-00003780: 2061 7373 6572 7420 696e 7075 7420 3d3d   assert input ==
-00003790: 2062 2268 656c 6c6f 5c74 2835 295c 6e22   b"hello\t(5)\n"
-000037a0: 0a20 2020 2069 6620 636c 6561 725f 7461  .    if clear_ta
-000037b0: 625f 636f 6d70 6c65 7469 6f6e 733a 0a20  b_completions:. 
-000037c0: 2020 2020 2020 2061 7373 6572 7420 6578         assert ex
-000037d0: 7065 6374 6564 203d 3d20 280a 2020 2020  pected == (.    
-000037e0: 2020 2020 2020 2020 6222 5c6e 220a 2020          b"\n".  
-000037f0: 2020 2020 2020 2020 2020 6222 626f 6e6a            b"bonj
-00003800: 6f75 725c 6e22 0a20 2020 2020 2020 2020  our\n".         
-00003810: 2020 2062 2249 6e20 5b31 5d3a 2068 656c     b"In [1]: hel
-00003820: 6c6f 5c6e 220a 2020 2020 2020 2020 2020  lo\n".          
-00003830: 2020 6222 6861 6c6c 6f5c 6e22 0a20 2020    b"hallo\n".   
-00003840: 2020 2020 2020 2020 2062 2249 6e20 5b31           b"In [1
-00003850: 5d3a 2068 656c 6c6f 5f74 6865 7265 2835  ]: hello_there(5
-00003860: 295c 6e22 0a20 2020 2020 2020 2020 2020  )\n".           
-00003870: 2062 2267 6f6f 6462 7965 2229 0a20 2020   b"goodbye").   
-00003880: 2065 6c73 653a 0a20 2020 2020 2020 2061   else:.        a
-00003890: 7373 6572 7420 6578 7065 6374 6564 203d  ssert expected =
-000038a0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-000038b0: 6222 496e 205b 315d 3a20 6865 6c6c 6f5c  b"In [1]: hello\
-000038c0: 6e22 0a20 2020 2020 2020 2020 2020 2062  n".            b
-000038d0: 2262 6f6e 6a6f 7572 5c6e 220a 2020 2020  "bonjour\n".    
-000038e0: 2020 2020 2020 2020 6222 496e 205b 315d          b"In [1]
-000038f0: 3a20 6865 6c6c 6f5c 6e22 0a20 2020 2020  : hello\n".     
-00003900: 2020 2020 2020 2062 2268 616c 6c6f 5c6e         b"hallo\n
-00003910: 220a 2020 2020 2020 2020 2020 2020 6222  ".            b"
-00003920: 496e 205b 315d 3a20 6865 6c6c 6f5f 7468  In [1]: hello_th
-00003930: 6572 6528 3529 5c6e 220a 2020 2020 2020  ere(5)\n".      
-00003940: 2020 2020 2020 6222 676f 6f64 6279 6522        b"goodbye"
-00003950: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
-00003960: 6573 745f 7365 6c66 7465 7374 5f61 7373  est_selftest_ass
-00003970: 6572 745f 6d61 7463 685f 3128 293a 0a20  ert_match_1():. 
-00003980: 2020 2065 7870 6563 7465 6420 3d20 6222     expected = b"
-00003990: 2222 0a20 2020 2020 2020 2068 656c 6c6f  "".        hello
-000039a0: 0a20 2020 2020 2020 2031 2e2e 2e32 0a20  .        1...2. 
-000039b0: 2020 2020 2020 2067 6f6f 6462 7965 0a20         goodbye. 
-000039c0: 2020 2020 2020 202e 2e2e 2e68 656c 6c6f         ....hello
-000039d0: 0a20 2020 2022 2222 0a20 2020 2072 6573  .    """.    res
-000039e0: 756c 7420 3d20 6465 6465 6e74 2822 2222  ult = dedent("""
-000039f0: 0a0a 2020 2020 2020 6865 6c6c 6f0a 2020  ..      hello.  
-00003a00: 2020 2020 3134 3731 3230 3437 3630 320a      14712047602.
-00003a10: 2020 2020 2020 676f 6f64 6279 650a 2020        goodbye.  
-00003a20: 2020 2020 4920 646f 6e27 7420 6b6e 6f77      I don't know
-00003a30: 2077 6879 2079 6f75 2073 6179 2067 6f6f   why you say goo
-00003a40: 6462 7965 0a20 2020 2020 2049 2073 6179  dbye.      I say
-00003a50: 2068 656c 6c6f 0a20 2020 2022 2222 292e   hello.    """).
-00003a60: 656e 636f 6465 2827 7574 662d 3827 290a  encode('utf-8').
-00003a70: 2020 2020 6173 7365 7274 5f6d 6174 6368      assert_match
-00003a80: 2872 6573 756c 742c 2065 7870 6563 7465  (result, expecte
-00003a90: 6429 0a0a 0a40 7265 7472 790a 6465 6620  d)...@retry.def 
-00003aa0: 7465 7374 5f73 656c 6674 6573 745f 6173  test_selftest_as
-00003ab0: 7365 7274 5f6d 6174 6368 5f32 2829 3a0a  sert_match_2():.
-00003ac0: 2020 2020 7265 7375 6c74 203d 2062 2222      result = b""
-00003ad0: 220a 2020 2020 2020 2020 6865 6c6c 6f0a  ".        hello.
-00003ae0: 2020 2020 2020 2020 312e 2e2e 320a 2020          1...2.  
-00003af0: 2020 2020 2020 7468 6572 650a 2020 2020        there.    
-00003b00: 2222 220a 2020 2020 6578 7065 6374 6564  """.    expected
-00003b10: 203d 2062 2222 220a 0a20 2020 2020 2068   = b"""..      h
-00003b20: 656c 6c6f 0a20 2020 2020 2031 3437 3132  ello.      14712
-00003b30: 3034 370a 2020 2020 2020 3630 320a 2020  047.      602.  
-00003b40: 2020 2020 7468 6572 650a 0a20 2020 2022      there..    "
-00003b50: 2222 0a20 2020 2077 6974 6820 6173 7365  "".    with asse
-00003b60: 7274 5f66 6169 6c28 293a 0a20 2020 2020  rt_fail():.     
-00003b70: 2020 2061 7373 6572 745f 6d61 7463 6828     assert_match(
-00003b80: 7265 7375 6c74 2c20 6578 7065 6374 6564  result, expected
-00003b90: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
-00003ba0: 6573 745f 6c61 7a79 5f69 6d70 6f72 745f  est_lazy_import_
-00003bb0: 6970 7974 686f 6e5f 3128 293a 0a20 2020  ipython_1():.   
-00003bc0: 2023 2056 6572 6966 7920 7468 6174 2022   # Verify that "
-00003bd0: 696d 706f 7274 2070 7966 6c79 6279 2220  import pyflyby" 
-00003be0: 646f 6573 6e27 7420 696d 706c 7920 2269  doesn't imply "i
-00003bf0: 6d70 6f72 7420 4950 7974 686f 6e22 2e0a  mport IPython"..
-00003c00: 2020 2020 7079 636d 6420 3d20 2769 6d70      pycmd = 'imp
-00003c10: 6f72 7420 7079 666c 7962 792c 2073 7973  ort pyflyby, sys
-00003c20: 3b20 7379 732e 6578 6974 2822 4950 7974  ; sys.exit("IPyt
-00003c30: 686f 6e22 2069 6e20 7379 732e 6d6f 6475  hon" in sys.modu
-00003c40: 6c65 7329 270a 2020 2020 6368 6563 6b5f  les)'.    check_
-00003c50: 6361 6c6c 285b 2270 7974 686f 6e22 2c20  call(["python", 
-00003c60: 222d 6322 2c20 7079 636d 645d 290a 0a0a  "-c", pycmd])...
-00003c70: 6465 6620 5f70 6172 7365 5f76 6572 7369  def _parse_versi
-00003c80: 6f6e 2876 6572 7369 6f6e 5f73 7472 696e  on(version_strin
-00003c90: 6729 3a0a 2020 2020 2222 220a 2020 2020  g):.    """.    
-00003ca0: 2020 3e3e 3e20 5f70 6172 7365 5f76 6572    >>> _parse_ver
-00003cb0: 7369 6f6e 2822 312e 322e 3322 290a 2020  sion("1.2.3").  
-00003cc0: 2020 2020 2831 2c20 322c 2033 290a 0a20      (1, 2, 3).. 
-00003cd0: 2020 2020 203e 3e3e 205f 7061 7273 655f       >>> _parse_
-00003ce0: 7665 7273 696f 6e28 2231 2e32 612e 3362  version("1.2a.3b
-00003cf0: 2229 0a20 2020 2020 2028 312c 2032 2c20  ").      (1, 2, 
-00003d00: 2761 272c 2033 2c20 2762 2729 0a20 2020  'a', 3, 'b').   
-00003d10: 2022 2222 0a20 2020 2072 6573 756c 7420   """.    result 
-00003d20: 3d20 5b5d 0a20 2020 2066 6f72 2070 6172  = [].    for par
-00003d30: 7420 696e 2076 6572 7369 6f6e 5f73 7472  t in version_str
-00003d40: 696e 672e 7370 6c69 7428 222e 2229 3a0a  ing.split("."):.
-00003d50: 2020 2020 2020 2020 6d20 3d20 7265 2e6d          m = re.m
-00003d60: 6174 6368 2822 5e28 5b30 2d39 5d2a 2928  atch("^([0-9]*)(
-00003d70: 2e2a 2924 222c 2070 6172 7429 0a20 2020  .*)$", part).   
-00003d80: 2020 2020 2069 6620 6d2e 6772 6f75 7028       if m.group(
-00003d90: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
-00003da0: 7265 7375 6c74 2e61 7070 656e 6428 696e  result.append(in
-00003db0: 7428 6d2e 6772 6f75 7028 3129 2929 0a20  t(m.group(1))). 
-00003dc0: 2020 2020 2020 2069 6620 6d2e 6772 6f75         if m.grou
-00003dd0: 7028 3229 3a0a 2020 2020 2020 2020 2020  p(2):.          
-00003de0: 2020 7265 7375 6c74 2e61 7070 656e 6428    result.append(
-00003df0: 6d2e 6772 6f75 7028 3229 290a 2020 2020  m.group(2)).    
-00003e00: 7265 7475 726e 2074 7570 6c65 2872 6573  return tuple(res
-00003e10: 756c 7429 0a0a 0a74 7279 3a0a 2020 2020  ult)...try:.    
-00003e20: 5f49 5059 5448 4f4e 5f56 4552 5349 4f4e  _IPYTHON_VERSION
-00003e30: 203d 2049 5079 7468 6f6e 2e76 6572 7369   = IPython.versi
-00003e40: 6f6e 5f69 6e66 6f0a 6578 6365 7074 2041  on_info.except A
-00003e50: 7474 7269 6275 7465 4572 726f 723a 0a20  ttributeError:. 
-00003e60: 2020 205f 4950 5954 484f 4e5f 5645 5253     _IPYTHON_VERS
-00003e70: 494f 4e20 3d20 5f70 6172 7365 5f76 6572  ION = _parse_ver
-00003e80: 7369 6f6e 2849 5079 7468 6f6e 2e5f 5f76  sion(IPython.__v
-00003e90: 6572 7369 6f6e 5f5f 290a 0a23 2050 726f  ersion__)..# Pro
-00003ea0: 6d70 7473 2074 6861 7420 7765 2065 7870  mpts that we exp
-00003eb0: 6563 7420 666f 722e 0a5f 4950 5954 484f  ect for.._IPYTHO
-00003ec0: 4e5f 5052 4f4d 5054 3120 3d20 6272 225c  N_PROMPT1 = br"\
-00003ed0: 6e5c 723f 496e 205c 5b28 5b30 2d39 5d2b  n\r?In \[([0-9]+
-00003ee0: 295c 5d3a 2022 0a5f 4950 5954 484f 4e5f  )\]: "._IPYTHON_
-00003ef0: 5052 4f4d 5054 3220 3d20 6272 225c 6e5c  PROMPT2 = br"\n\
-00003f00: 723f 2020 205b 2e5d 5b2e 5d5b 2e5d 2b3a  r?   [.][.][.]+:
-00003f10: 2022 0a5f 5059 5448 4f4e 5f50 524f 4d50   "._PYTHON_PROMP
-00003f20: 5420 3d20 6272 223e 3e3e 2022 0a5f 4950  T = br">>> "._IP
-00003f30: 4442 5f50 524f 4d50 5420 3d20 6272 225c  DB_PROMPT = br"\
-00003f40: 6e69 7064 623e 2022 0a5f 4950 5954 484f  nipdb> "._IPYTHO
-00003f50: 4e5f 5052 4f4d 5054 5320 3d20 5b5f 4950  N_PROMPTS = [_IP
-00003f60: 5954 484f 4e5f 5052 4f4d 5054 312c 0a20  YTHON_PROMPT1,. 
-00003f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f80: 2020 205f 4950 5954 484f 4e5f 5052 4f4d     _IPYTHON_PROM
-00003f90: 5054 322c 0a20 2020 2020 2020 2020 2020  PT2,.           
-00003fa0: 2020 2020 2020 2020 205f 5059 5448 4f4e           _PYTHON
-00003fb0: 5f50 524f 4d50 542c 0a20 2020 2020 2020  _PROMPT,.       
-00003fc0: 2020 2020 2020 2020 2020 2020 205f 4950               _IP
-00003fd0: 4442 5f50 524f 4d50 545d 0a23 2043 7572  DB_PROMPT].# Cur
-00003fe0: 7265 6e74 6c79 205f 696e 7465 7261 6374  rently _interact
-00003ff0: 5f69 7079 7468 6f6e 2829 2061 7373 756d  _ipython() assum
-00004000: 6573 2074 6865 2066 6972 7374 2069 7320  es the first is 
-00004010: 2249 6e20 5b6e 6e5d 3a22 0a61 7373 6572  "In [nn]:".asser
-00004020: 7420 6222 496e 2022 2069 6e20 5f49 5059  t b"In " in _IPY
-00004030: 5448 4f4e 5f50 524f 4d50 5453 5b30 5d0a  THON_PROMPTS[0].
-00004040: 0a0a 406d 656d 6f69 7a65 0a64 6566 205f  ..@memoize.def _
-00004050: 6578 7472 615f 7265 6164 6c69 6e65 5f70  extra_readline_p
-00004060: 7974 686f 6e70 6174 685f 6469 7273 2829  ythonpath_dirs()
-00004070: 3a0a 2020 2020 2222 220a 2020 2020 5265  :.    """.    Re
-00004080: 7475 726e 2061 2070 6174 6820 746f 2075  turn a path to u
-00004090: 7365 2061 7320 616e 2065 7874 7261 2050  se as an extra P
-000040a0: 5954 484f 4e50 4154 4820 636f 6d70 6f6e  YTHONPATH compon
-000040b0: 656e 7420 696e 206f 7264 6572 2074 6f20  ent in order to 
-000040c0: 6765 7420 474e 550a 2020 2020 7265 6164  get GNU.    read
-000040d0: 6c69 6e65 2074 6f20 776f 726b 2e0a 2020  line to work..  
-000040e0: 2020 2222 220a 2020 2020 6966 2073 7973    """.    if sys
-000040f0: 2e70 6c61 7466 6f72 6d20 213d 2022 6461  .platform != "da
-00004100: 7277 696e 223a 0a20 2020 2020 2020 2072  rwin":.        r
-00004110: 6574 7572 6e20 2829 0a20 2020 2023 204f  eturn ().    # O
-00004120: 6e20 4461 7277 696e 2c20 7765 206e 6565  n Darwin, we nee
-00004130: 6420 6120 6861 636b 2074 6f20 6d61 6b65  d a hack to make
-00004140: 2073 7572 6520 4950 7974 686f 6e20 6765   sure IPython ge
-00004150: 7473 2047 4e55 2072 6561 646c 696e 6520  ts GNU readline 
-00004160: 696e 7374 6561 640a 2020 2020 2320 6f66  instead.    # of
-00004170: 206c 6962 6564 6974 2e0a 2020 2020 6966   libedit..    if
-00004180: 2022 6c69 6265 6469 7422 206e 6f74 2069   "libedit" not i
-00004190: 6e20 7265 6164 6c69 6e65 2e5f 5f64 6f63  n readline.__doc
-000041a0: 5f5f 3a0a 2020 2020 2020 2020 7265 7475  __:.        retu
-000041b0: 726e 2028 290a 2020 2020 6469 7220 3d20  rn ().    dir = 
-000041c0: 6d6b 6474 656d 7028 7072 6566 6978 3d22  mkdtemp(prefix="
-000041d0: 7079 666c 7962 795f 222c 2073 7566 6669  pyflyby_", suffi
-000041e0: 783d 222e 746d 7022 290a 2020 2020 6174  x=".tmp").    at
-000041f0: 6578 6974 2e72 6567 6973 7465 7228 6c61  exit.register(la
-00004200: 6d62 6461 3a20 726d 7472 6565 2864 6972  mbda: rmtree(dir
-00004210: 2929 0a20 2020 2069 6d70 6f72 7420 7369  )).    import si
-00004220: 7465 0a20 2020 2073 6974 6570 6163 6b61  te.    sitepacka
-00004230: 6765 7320 3d20 6f73 2e70 6174 682e 6a6f  ges = os.path.jo
-00004240: 696e 286f 732e 7061 7468 2e64 6972 6e61  in(os.path.dirna
-00004250: 6d65 2873 6974 652e 5f5f 6669 6c65 5f5f  me(site.__file__
-00004260: 292c 2022 7369 7465 2d70 6163 6b61 6765  ), "site-package
-00004270: 7322 290a 2020 2020 7265 6164 6c69 6e65  s").    readline
-00004280: 5f66 6e20 3d20 6f73 2e70 6174 682e 6162  _fn = os.path.ab
-00004290: 7370 6174 6828 6f73 2e70 6174 682e 6a6f  spath(os.path.jo
-000042a0: 696e 2873 6974 6570 6163 6b61 6765 732c  in(sitepackages,
-000042b0: 2022 7265 6164 6c69 6e65 2e73 6f22 2929   "readline.so"))
-000042c0: 0a20 2020 2069 6620 6e6f 7420 6f73 2e70  .    if not os.p
-000042d0: 6174 682e 6973 6669 6c65 2872 6561 646c  ath.isfile(readl
-000042e0: 696e 655f 666e 293a 0a20 2020 2020 2020  ine_fn):.       
-000042f0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00004300: 7228 2243 6f75 6c64 6e27 7420 6669 6e64  r("Couldn't find
-00004310: 2072 6561 646c 696e 6522 290a 2020 2020   readline").    
-00004320: 6f73 2e73 796d 6c69 6e6b 2872 6561 646c  os.symlink(readl
-00004330: 696e 655f 666e 2c20 6f73 2e70 6174 682e  ine_fn, os.path.
-00004340: 6a6f 696e 2864 6972 2c20 2272 6561 646c  join(dir, "readl
-00004350: 696e 652e 736f 2229 290a 2020 2020 7265  ine.so")).    re
-00004360: 7475 726e 2028 6469 722c 290a 0a0a 6465  turn (dir,)...de
-00004370: 6620 5f62 7569 6c64 5f70 7974 686f 6e70  f _build_pythonp
-00004380: 6174 6828 5059 5448 4f4e 5041 5448 293a  ath(PYTHONPATH):
-00004390: 0a20 2020 2022 2222 0a20 2020 2042 7569  .    """.    Bui
-000043a0: 6c64 2050 5954 484f 4e50 4154 4820 7661  ld PYTHONPATH va
-000043b0: 6c75 6520 746f 2075 7365 2e0a 0a20 2020  lue to use...   
-000043c0: 203a 7274 7970 653a 0a20 2020 2020 2060   :rtype:.      `
-000043d0: 6073 7472 6060 0a20 2020 2022 2222 0a20  `str``.    """. 
-000043e0: 2020 2070 7970 6174 6820 3d20 5b6f 732e     pypath = [os.
-000043f0: 7061 7468 2e64 6972 6e61 6d65 286f 732e  path.dirname(os.
-00004400: 7061 7468 2e64 6972 6e61 6d65 2870 7966  path.dirname(pyf
-00004410: 6c79 6279 2e5f 5f66 696c 655f 5f29 295d  lyby.__file__))]
-00004420: 0a20 2020 2069 6620 7379 732e 7665 7273  .    if sys.vers
-00004430: 696f 6e5f 696e 666f 203c 2028 332c 2039  ion_info < (3, 9
-00004440: 293a 0a20 2020 2020 2020 2070 7970 6174  ):.        pypat
-00004450: 6820 2b3d 205f 6578 7472 615f 7265 6164  h += _extra_read
-00004460: 6c69 6e65 5f70 7974 686f 6e70 6174 685f  line_pythonpath_
-00004470: 6469 7273 2829 0a20 2020 2069 6620 6973  dirs().    if is
-00004480: 696e 7374 616e 6365 2850 5954 484f 4e50  instance(PYTHONP
-00004490: 4154 482c 2028 4669 6c65 6e61 6d65 2c20  ATH, (Filename, 
-000044a0: 7369 782e 7374 7269 6e67 5f74 7970 6573  six.string_types
-000044b0: 2929 3a0a 2020 2020 2020 2020 5059 5448  )):.        PYTH
-000044c0: 4f4e 5041 5448 203d 205b 5059 5448 4f4e  ONPATH = [PYTHON
-000044d0: 5041 5448 5d0a 2020 2020 5059 5448 4f4e  PATH].    PYTHON
-000044e0: 5041 5448 203d 205b 7374 7228 4669 6c65  PATH = [str(File
-000044f0: 6e61 6d65 2864 2929 2066 6f72 2064 2069  name(d)) for d i
-00004500: 6e20 5059 5448 4f4e 5041 5448 5d0a 2020  n PYTHONPATH].  
-00004510: 2020 7079 7061 7468 202b 3d20 5059 5448    pypath += PYTH
-00004520: 4f4e 5041 5448 0a20 2020 2070 7970 6174  ONPATH.    pypat
-00004530: 6820 2b3d 206f 732e 656e 7669 726f 6e5b  h += os.environ[
-00004540: 2250 5954 484f 4e50 4154 4822 5d2e 7370  "PYTHONPATH"].sp
-00004550: 6c69 7428 223a 2229 0a20 2020 2072 6574  lit(":").    ret
-00004560: 7572 6e20 223a 222e 6a6f 696e 2870 7970  urn ":".join(pyp
-00004570: 6174 6829 0a0a 0a64 6566 205f 696e 6974  ath)...def _init
-00004580: 5f69 7079 7468 6f6e 5f64 6972 2869 7079  _ipython_dir(ipy
-00004590: 7468 6f6e 5f64 6972 293a 0a20 2020 2069  thon_dir):.    i
-000045a0: 7079 7468 6f6e 5f64 6972 203d 2046 696c  python_dir = Fil
-000045b0: 656e 616d 6528 6970 7974 686f 6e5f 6469  ename(ipython_di
-000045c0: 7229 0a20 2020 2069 6620 5f49 5059 5448  r).    if _IPYTH
-000045d0: 4f4e 5f56 4552 5349 4f4e 203e 3d20 2830  ON_VERSION >= (0
-000045e0: 2c20 3131 293a 0a20 2020 2020 2020 206f  , 11):.        o
-000045f0: 732e 6d61 6b65 6469 7273 2873 7472 2869  s.makedirs(str(i
-00004600: 7079 7468 6f6e 5f64 6972 2f22 7072 6f66  python_dir/"prof
-00004610: 696c 655f 6465 6661 756c 7422 2929 0a20  ile_default")). 
-00004620: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
-00004630: 7273 2873 7472 2869 7079 7468 6f6e 5f64  rs(str(ipython_d
-00004640: 6972 2f22 7072 6f66 696c 655f 6465 6661  ir/"profile_defa
-00004650: 756c 742f 7374 6172 7475 7022 2929 0a20  ult/startup")). 
-00004660: 2020 2020 2020 2069 6620 5f49 5059 5448         if _IPYTH
-00004670: 4f4e 5f56 4552 5349 4f4e 203e 3d20 2837  ON_VERSION >= (7
-00004680: 2c29 3a0a 2020 2020 2020 2020 2020 2020  ,):.            
-00004690: 7772 6974 6574 6578 7428 6970 7974 686f  writetext(ipytho
-000046a0: 6e5f 6469 722f 2270 726f 6669 6c65 5f64  n_dir/"profile_d
-000046b0: 6566 6175 6c74 2f69 7079 7468 6f6e 5f63  efault/ipython_c
-000046c0: 6f6e 6669 672e 7079 222c 0a20 2020 2020  onfig.py",.     
-000046d0: 2020 2020 2020 2020 2020 2020 2064 6564               ded
-000046e0: 656e 7428 2222 220a 2020 2020 2020 2020  ent(""".        
-000046f0: 2020 2020 2020 2020 2020 6320 3d20 6765            c = ge
-00004700: 745f 636f 6e66 6967 2829 0a20 2020 2020  t_config().     
-00004710: 2020 2020 2020 2020 2020 2020 2023 2050               # P
-00004720: 726f 6d70 742d 746f 6f6c 6b69 7420 322e  rompt-toolkit 2.
-00004730: 3020 7374 696c 6c20 7072 696e 7473 2073  0 still prints s
-00004740: 6f6d 6520 6573 6361 7065 2063 6f64 6573  ome escape codes
-00004750: 2066 6f72 2074 6865 0a20 2020 2020 2020   for the.       
-00004760: 2020 2020 2020 2020 2020 2023 2063 6f6d             # com
-00004770: 706c 6574 696f 6e20 6469 7370 6c61 7920  pletion display 
-00004780: 6576 656e 2069 6620 7468 6572 6520 6973  even if there is
-00004790: 206f 6e6c 7920 6f6e 6520 636f 6d70 6c65   only one comple
-000047a0: 7469 6f6e 2e0a 2020 2020 2020 2020 2020  tion..          
-000047b0: 2020 2020 2020 2020 632e 5465 726d 696e          c.Termin
-000047c0: 616c 496e 7465 7261 6374 6976 6553 6865  alInteractiveShe
-000047d0: 6c6c 2e64 6973 706c 6179 5f63 6f6d 706c  ll.display_compl
-000047e0: 6574 696f 6e73 203d 2022 7265 6164 6c69  etions = "readli
-000047f0: 6e65 6c69 6b65 220a 2020 2020 2020 2020  nelike".        
-00004800: 2020 2020 2020 2020 2020 632e 5465 726d            c.Term
-00004810: 696e 616c 496e 7465 7261 6374 6976 6553  inalInteractiveS
-00004820: 6865 6c6c 2e63 6f6c 6f72 7320 3d20 274e  hell.colors = 'N
-00004830: 6f43 6f6c 6f72 270a 2020 2020 2020 2020  oColor'.        
-00004840: 2020 2020 2020 2020 2020 2320 4469 7361            # Disa
-00004850: 626c 6520 6272 6163 6b65 7420 6869 6768  ble bracket high
-00004860: 6c69 6768 7469 6e67 2c20 7768 6963 6820  lighting, which 
-00004870: 7072 696e 7473 2065 7363 6170 6520 636f  prints escape co
-00004880: 6465 7320 7468 6174 2063 6f6e 6675 7365  des that confuse
-00004890: 2074 6865 2064 6563 6f64 6572 2e0a 2020   the decoder..  
-000048a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048b0: 632e 5465 726d 696e 616c 496e 7465 7261  c.TerminalIntera
-000048c0: 6374 6976 6553 6865 6c6c 2e68 6967 686c  ctiveShell.highl
-000048d0: 6967 6874 5f6d 6174 6368 696e 675f 6272  ight_matching_br
-000048e0: 6163 6b65 7473 203d 2046 616c 7365 0a20  ackets = False. 
-000048f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004900: 2022 2222 2929 0a20 2020 2020 2020 2020   """)).         
-00004910: 2020 2077 7269 7465 7465 7874 2869 7079     writetext(ipy
-00004920: 7468 6f6e 5f64 6972 2f22 6a75 7079 7465  thon_dir/"jupyte
-00004930: 725f 636f 6e73 6f6c 655f 636f 6e66 6967  r_console_config
-00004940: 2e70 7922 2c0a 2020 2020 2020 2020 2020  .py",.          
-00004950: 2020 2020 2020 2020 6465 6465 6e74 2822          dedent("
-00004960: 2222 0a20 2020 2020 2020 2020 2020 2020  "".             
-00004970: 2020 2020 2063 203d 2067 6574 5f63 6f6e       c = get_con
-00004980: 6669 6728 290a 2020 2020 2020 2020 2020  fig().          
-00004990: 2020 2020 2020 2020 2320 4469 7361 626c          # Disabl
-000049a0: 6520 6272 6163 6b65 7420 6869 6768 6c69  e bracket highli
-000049b0: 6768 7469 6e67 2c20 7768 6963 6820 7072  ghting, which pr
-000049c0: 696e 7473 2065 7363 6170 6520 636f 6465  ints escape code
-000049d0: 7320 7468 6174 2063 6f6e 6675 7365 2074  s that confuse t
-000049e0: 6865 2064 6563 6f64 6572 2e0a 2020 2020  he decoder..    
-000049f0: 2020 2020 2020 2020 2020 2020 2020 632e                c.
-00004a00: 5a4d 5154 6572 6d69 6e61 6c49 6e74 6572  ZMQTerminalInter
-00004a10: 6163 7469 7665 5368 656c 6c2e 6469 7370  activeShell.disp
-00004a20: 6c61 795f 636f 6d70 6c65 7469 6f6e 7320  lay_completions 
-00004a30: 3d20 2272 6561 646c 696e 656c 696b 6522  = "readlinelike"
-00004a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004a50: 2020 2023 204e 6f74 2073 7570 706f 7274     # Not support
-00004a60: 6564 2069 6e20 4a75 7079 7465 7220 636f  ed in Jupyter co
-00004a70: 6e73 6f6c 650a 2020 2020 2020 2020 2020  nsole.          
-00004a80: 2020 2020 2020 2020 2320 632e 5a4d 5154          # c.ZMQT
-00004a90: 6572 6d69 6e61 6c49 6e74 6572 6163 7469  erminalInteracti
-00004aa0: 7665 5368 656c 6c2e 636f 6c6f 7273 203d  veShell.colors =
-00004ab0: 2027 4e6f 436f 6c6f 7227 0a20 2020 2020   'NoColor'.     
-00004ac0: 2020 2020 2020 2020 2020 2020 2023 2050               # P
-00004ad0: 726f 6d70 742d 746f 6f6c 6b69 7420 322e  rompt-toolkit 2.
-00004ae0: 3020 7374 696c 6c20 7072 696e 7473 2073  0 still prints s
-00004af0: 6f6d 6520 6573 6361 7065 2063 6f64 6573  ome escape codes
-00004b00: 2066 6f72 2074 6865 0a20 2020 2020 2020   for the.       
-00004b10: 2020 2020 2020 2020 2020 2023 2063 6f6d             # com
-00004b20: 706c 6574 696f 6e20 6469 7370 6c61 7920  pletion display 
-00004b30: 6576 656e 2069 6620 7468 6572 6520 6973  even if there is
-00004b40: 206f 6e6c 7920 6f6e 6520 636f 6d70 6c65   only one comple
-00004b50: 7469 6f6e 2e0a 2020 2020 2020 2020 2020  tion..          
-00004b60: 2020 2020 2020 2020 632e 5a4d 5154 6572          c.ZMQTer
-00004b70: 6d69 6e61 6c49 6e74 6572 6163 7469 7665  minalInteractive
-00004b80: 5368 656c 6c2e 6869 6768 6c69 6768 745f  Shell.highlight_
-00004b90: 6d61 7463 6869 6e67 5f62 7261 636b 6574  matching_bracket
-00004ba0: 7320 3d20 4661 6c73 650a 2020 2020 2020  s = False.      
-00004bb0: 2020 2020 2020 2020 2020 2020 2222 2229              """)
-00004bc0: 290a 2020 2020 2020 2020 656c 6966 205f  ).        elif _
-00004bd0: 4950 5954 484f 4e5f 5645 5253 494f 4e20  IPYTHON_VERSION 
-00004be0: 3e3d 2028 352c 293a 0a20 2020 2020 2020  >= (5,):.       
-00004bf0: 2020 2020 2077 7269 7465 7465 7874 2869       writetext(i
-00004c00: 7079 7468 6f6e 5f64 6972 2f22 7072 6f66  python_dir/"prof
-00004c10: 696c 655f 6465 6661 756c 742f 6970 7974  ile_default/ipyt
-00004c20: 686f 6e5f 636f 6e66 6967 2e70 7922 2c0a  hon_config.py",.
-00004c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c40: 2020 6465 6465 6e74 2822 2222 0a20 2020    dedent(""".   
-00004c50: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00004c60: 203d 2067 6574 5f63 6f6e 6669 6728 290a   = get_config().
-00004c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c80: 2020 632e 5465 726d 696e 616c 496e 7465    c.TerminalInte
-00004c90: 7261 6374 6976 6553 6865 6c6c 2e63 6f6c  ractiveShell.col
-00004ca0: 6f72 7320 3d20 274e 6f43 6f6c 6f72 270a  ors = 'NoColor'.
-00004cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004cc0: 2020 2320 5072 6f6d 7074 2d74 6f6f 6c6b    # Prompt-toolk
-00004cd0: 6974 2032 2e30 2073 7469 6c6c 2070 7269  it 2.0 still pri
-00004ce0: 6e74 7320 736f 6d65 2065 7363 6170 6520  nts some escape 
-00004cf0: 636f 6465 7320 666f 7220 7468 650a 2020  codes for the.  
-00004d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d10: 2320 636f 6d70 6c65 7469 6f6e 2064 6973  # completion dis
-00004d20: 706c 6179 2065 7665 6e20 6966 2074 6865  play even if the
-00004d30: 7265 2069 7320 6f6e 6c79 206f 6e65 2063  re is only one c
-00004d40: 6f6d 706c 6574 696f 6e2e 0a20 2020 2020  ompletion..     
-00004d50: 2020 2020 2020 2020 2020 2020 2063 2e54               c.T
-00004d60: 6572 6d69 6e61 6c49 6e74 6572 6163 7469  erminalInteracti
-00004d70: 7665 5368 656c 6c2e 6869 6768 6c69 6768  veShell.highligh
-00004d80: 745f 6d61 7463 6869 6e67 5f62 7261 636b  t_matching_brack
-00004d90: 6574 7320 3d20 4661 6c73 650a 2020 2020  ets = False.    
-00004da0: 2020 2020 2020 2020 2020 2020 2020 2222                ""
-00004db0: 2229 290a 2020 2020 2020 2020 656c 7365  ")).        else
-00004dc0: 3a0a 2020 2020 2020 2020 2020 2020 7772  :.            wr
-00004dd0: 6974 6574 6578 7428 6970 7974 686f 6e5f  itetext(ipython_
-00004de0: 6469 722f 2270 726f 6669 6c65 5f64 6566  dir/"profile_def
-00004df0: 6175 6c74 2f69 7079 7468 6f6e 5f63 6f6e  ault/ipython_con
-00004e00: 6669 672e 7079 222c 0a20 2020 2020 2020  fig.py",.       
-00004e10: 2020 2020 2020 2020 2020 2022 6320 3d20             "c = 
-00004e20: 6765 745f 636f 6e66 6967 2829 5c6e 2229  get_config()\n")
-00004e30: 0a20 2020 2065 6c69 6620 5f49 5059 5448  .    elif _IPYTH
-00004e40: 4f4e 5f56 4552 5349 4f4e 203e 3d20 2830  ON_VERSION >= (0
-00004e50: 2c20 3130 293a 0a20 2020 2020 2020 2077  , 10):.        w
-00004e60: 7269 7465 7465 7874 2869 7079 7468 6f6e  ritetext(ipython
-00004e70: 5f64 6972 2f22 6970 7974 686f 6e72 6322  _dir/"ipythonrc"
-00004e80: 2c20 2222 220a 2020 2020 2020 2020 2020  , """.          
-00004e90: 2020 7265 6164 6c69 6e65 5f70 6172 7365    readline_parse
-00004ea0: 5f61 6e64 5f62 696e 6420 7461 623a 2063  _and_bind tab: c
-00004eb0: 6f6d 706c 6574 650a 2020 2020 2020 2020  omplete.        
-00004ec0: 2020 2020 7265 6164 6c69 6e65 5f70 6172      readline_par
-00004ed0: 7365 5f61 6e64 5f62 696e 6420 7365 7420  se_and_bind set 
-00004ee0: 7368 6f77 2d61 6c6c 2d69 662d 616d 6269  show-all-if-ambi
-00004ef0: 6775 6f75 7320 6f6e 0a20 2020 2020 2020  guous on.       
-00004f00: 2022 2222 290a 2020 2020 2020 2020 7772   """).        wr
-00004f10: 6974 6574 6578 7428 6970 7974 686f 6e5f  itetext(ipython_
-00004f20: 6469 722f 2269 7079 5f75 7365 725f 636f  dir/"ipy_user_co
-00004f30: 6e66 2e70 7922 2c20 2222 290a 0a0a 6465  nf.py", "")...de
-00004f40: 6620 5f62 7569 6c64 5f69 7079 7468 6f6e  f _build_ipython
-00004f50: 5f63 6d64 2869 7079 7468 6f6e 5f64 6972  _cmd(ipython_dir
-00004f60: 2c20 7072 6f67 3d22 6970 7974 686f 6e22  , prog="ipython"
-00004f70: 2c20 6172 6773 3d5b 5d2c 2061 7574 6f63  , args=[], autoc
-00004f80: 616c 6c3d 4661 6c73 652c 2066 726f 6e74  all=False, front
-00004f90: 656e 643d 4e6f 6e65 293a 0a20 2020 2022  end=None):.    "
-00004fa0: 2222 0a20 2020 2050 7265 7061 7265 2074  "".    Prepare t
-00004fb0: 6865 2063 6f6d 6d61 6e64 2074 6f20 7275  he command to ru
-00004fc0: 6e20 4950 7974 686f 6e2e 0a20 2020 2022  n IPython..    "
-00004fd0: 2222 0a20 2020 2070 7974 686f 6e20 3d20  "".    python = 
-00004fe0: 7379 732e 6578 6563 7574 6162 6c65 0a20  sys.executable. 
-00004ff0: 2020 2069 7079 7468 6f6e 5f64 6972 203d     ipython_dir =
-00005000: 2046 696c 656e 616d 6528 6970 7974 686f   Filename(ipytho
-00005010: 6e5f 6469 7229 0a20 2020 2063 6d64 203d  n_dir).    cmd =
-00005020: 205b 7079 7468 6f6e 5d0a 2020 2020 6966   [python].    if
-00005030: 2070 726f 6720 3d3d 2022 6970 7974 686f   prog == "ipytho
-00005040: 6e22 2061 6e64 205f 4950 5954 484f 4e5f  n" and _IPYTHON_
-00005050: 5645 5253 494f 4e20 3e3d 2028 342c 2920  VERSION >= (4,) 
-00005060: 616e 6420 6172 6773 2061 6e64 2061 7267  and args and arg
-00005070: 735b 305d 2069 6e20 5b22 636f 6e73 6f6c  s[0] in ["consol
-00005080: 6522 2c20 226e 6f74 6562 6f6f 6b22 5d3a  e", "notebook"]:
-00005090: 0a20 2020 2020 2020 2070 726f 6720 3d20  .        prog = 
-000050a0: 226a 7570 7974 6572 220a 2020 2020 6966  "jupyter".    if
-000050b0: 2070 726f 6720 3d3d 2022 7079 223a 0a20   prog == "py":. 
-000050c0: 2020 2020 2020 2063 6d64 202b 3d20 5b73         cmd += [s
-000050d0: 7472 2850 5946 4c59 4259 5f42 494e 202f  tr(PYFLYBY_BIN /
-000050e0: 2070 726f 6729 5d0a 2020 2020 656c 7365   prog)].    else
-000050f0: 3a0a 2020 2020 2020 2020 2320 4765 7420  :.        # Get 
-00005100: 7468 6520 7072 6f67 7261 6d20 6672 6f6d  the program from
-00005110: 2074 6865 2070 7974 686f 6e20 7468 6174   the python that
-00005120: 2069 7320 7275 6e6e 696e 672e 0a20 2020   is running..   
-00005130: 2020 2020 2063 6d64 202b 3d20 5b6f 732e       cmd += [os.
-00005140: 7061 7468 2e6a 6f69 6e28 6f73 2e70 6174  path.join(os.pat
-00005150: 682e 6469 726e 616d 6528 7379 732e 6578  h.dirname(sys.ex
-00005160: 6563 7574 6162 6c65 292c 2070 726f 6729  ecutable), prog)
-00005170: 5d0a 2020 2020 6966 2069 7369 6e73 7461  ].    if isinsta
-00005180: 6e63 6528 6172 6773 2c20 7369 782e 7374  nce(args, six.st
-00005190: 7269 6e67 5f74 7970 6573 293a 0a20 2020  ring_types):.   
-000051a0: 2020 2020 2061 7267 7320 3d20 5b61 7267       args = [arg
-000051b0: 735d 0a20 2020 2069 6620 6172 6773 2061  s].    if args a
-000051c0: 6e64 206e 6f74 2061 7267 735b 305d 2e73  nd not args[0].s
-000051d0: 7461 7274 7377 6974 6828 222d 2229 3a0a  tartswith("-"):.
-000051e0: 2020 2020 2020 2020 6170 7020 3d20 6172          app = ar
-000051f0: 6773 5b30 5d0a 2020 2020 656c 7365 3a0a  gs[0].    else:.
-00005200: 2020 2020 2020 2020 6170 7020 3d20 2274          app = "t
-00005210: 6572 6d69 6e61 6c22 0a20 2020 2063 6d64  erminal".    cmd
-00005220: 202b 3d20 6c69 7374 2861 7267 7329 0a20   += list(args). 
-00005230: 2020 2069 6620 7072 6f67 203d 3d20 2270     if prog == "p
-00005240: 7974 686f 6e22 3a0a 2020 2020 2020 2020  ython":.        
-00005250: 7265 7475 726e 2063 6d64 0a20 2020 2023  return cmd.    #
-00005260: 2043 6f6e 7374 7275 6374 2049 5079 7468   Construct IPyth
-00005270: 6f6e 2061 7267 756d 656e 7473 2062 6173  on arguments bas
-00005280: 6564 206f 6e20 7665 7273 696f 6e2e 0a20  ed on version.. 
-00005290: 2020 2069 6620 5f49 5059 5448 4f4e 5f56     if _IPYTHON_V
-000052a0: 4552 5349 4f4e 203e 3d20 2830 2c20 3131  ERSION >= (0, 11
-000052b0: 293a 0a20 2020 2020 2020 206f 7074 203d  ):.        opt =
-000052c0: 206c 616d 6264 6120 6172 673a 2061 7267   lambda arg: arg
-000052d0: 0a20 2020 2065 6c69 6620 5f49 5059 5448  .    elif _IPYTH
-000052e0: 4f4e 5f56 4552 5349 4f4e 203e 3d20 2830  ON_VERSION >= (0
-000052f0: 2c20 3130 293a 0a20 2020 2020 2020 2064  , 10):.        d
-00005300: 6566 206f 7074 2861 7267 293a 0a20 2020  ef opt(arg):.   
-00005310: 2020 2020 2020 2020 2022 2222 0a20 2020           """.   
-00005320: 2020 2020 2020 2020 2020 203e 3e3e 206f             >>> o
-00005330: 7074 2827 2d2d 666f 6f2d 6261 723d 782d  pt('--foo-bar=x-
-00005340: 7927 290a 2020 2020 2020 2020 2020 2020  y').            
-00005350: 2020 272d 666f 6f5f 6261 723d 782d 7927    '-foo_bar=x-y'
-00005360: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
-00005370: 0a20 2020 2020 2020 2020 2020 206d 203d  .            m =
-00005380: 2072 652e 6d61 7463 6828 222d 2d28 5b5e   re.match("--([^
-00005390: 3d5d 2b3f 2928 3d2e 2a29 3f24 222c 2061  =]+?)(=.*)?$", a
-000053a0: 7267 290a 2020 2020 2020 2020 2020 2020  rg).            
-000053b0: 6f70 746e 616d 6520 3d20 6d2e 6772 6f75  optname = m.grou
-000053c0: 7028 3129 0a20 2020 2020 2020 2020 2020  p(1).           
-000053d0: 206f 7074 7661 6c20 203d 206d 2e67 726f   optval  = m.gro
-000053e0: 7570 2832 2920 6f72 2022 220a 2020 2020  up(2) or "".    
-000053f0: 2020 2020 2020 2020 6f70 746e 616d 6520          optname 
-00005400: 3d20 7265 2e73 7562 2822 5e6e 6f2d 222c  = re.sub("^no-",
-00005410: 2022 6e6f 222c 206f 7074 6e61 6d65 290a   "no", optname).
-00005420: 2020 2020 2020 2020 2020 2020 6f70 746e              optn
-00005430: 616d 6520 3d20 7265 2e73 7562 2822 2d22  ame = re.sub("-"
-00005440: 2c20 225f 222c 206f 7074 6e61 6d65 290a  , "_", optname).
-00005450: 2020 2020 2020 2020 2020 2020 6f70 746e              optn
-00005460: 616d 6520 3d20 7265 2e73 7562 2822 5e69  ame = re.sub("^i
-00005470: 7079 7468 6f6e 5f64 6972 2422 2c20 2269  python_dir$", "i
-00005480: 7079 7468 6f6e 6469 7222 2c20 6f70 746e  pythondir", optn
-00005490: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-000054a0: 2072 6574 7572 6e20 222d 2573 2573 2220   return "-%s%s" 
-000054b0: 2520 286f 7074 6e61 6d65 2c20 6f70 7476  % (optname, optv
-000054c0: 616c 290a 2020 2020 656c 7365 3a0a 2020  al).    else:.  
-000054d0: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
-000054e0: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
-000054f0: 2244 6f6e 2774 206b 6e6f 7720 686f 7720  "Don't know how 
-00005500: 746f 2074 6573 7420 4950 7974 686f 6e20  to test IPython 
-00005510: 7665 7273 696f 6e20 2573 220a 2020 2020  version %s".    
-00005520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005530: 2020 2020 2020 2020 2020 2020 2020 2520                % 
-00005540: 285f 4950 5954 484f 4e5f 5645 5253 494f  (_IPYTHON_VERSIO
-00005550: 4e2c 2929 0a20 2020 2063 6d64 203d 205b  N,)).    cmd = [
-00005560: 2765 6e76 272c 2027 4950 5954 484f 4e44  'env', 'IPYTHOND
-00005570: 4952 3d25 7327 2025 2028 6970 7974 686f  IR=%s' % (ipytho
-00005580: 6e5f 6469 722c 292c 2027 4a55 5059 5445  n_dir,), 'JUPYTE
-00005590: 525f 434f 4e46 4947 5f44 4952 3d25 7327  R_CONFIG_DIR=%s'
-000055a0: 2025 2028 6970 7974 686f 6e5f 6469 722c   % (ipython_dir,
-000055b0: 292c 2027 494e 5055 5452 433d 6e6f 6e65  ), 'INPUTRC=none
-000055c0: 272c 2027 5052 4f4d 5054 5f54 4f4f 4c4b  ', 'PROMPT_TOOLK
-000055d0: 4954 5f4e 4f5f 4350 523d 3127 5d20 2b20  IT_NO_CPR=1'] + 
-000055e0: 636d 640a 2020 2020 6966 2061 7070 203d  cmd.    if app =
-000055f0: 3d20 2274 6572 6d69 6e61 6c22 2061 6e64  = "terminal" and
-00005600: 2070 726f 6720 213d 2022 7079 223a 0a20   prog != "py":. 
-00005610: 2020 2020 2020 2063 6d64 202b 3d20 5b6f         cmd += [o
-00005620: 7074 2822 2d2d 6e6f 2d63 6f6e 6669 726d  pt("--no-confirm
-00005630: 2d65 7869 7422 295d 0a20 2020 2020 2020  -exit")].       
-00005640: 2063 6d64 202b 3d20 5b6f 7074 2822 2d2d   cmd += [opt("--
-00005650: 6e6f 2d62 616e 6e65 7222 295d 0a20 2020  no-banner")].   
-00005660: 2069 6620 6170 7020 3d3d 2022 636f 6e73   if app == "cons
-00005670: 6f6c 6522 2061 6e64 2070 726f 6720 213d  ole" and prog !=
-00005680: 2022 7079 223a 0a20 2020 2020 2020 2063   "py":.        c
-00005690: 6d64 202b 3d20 5b6f 7074 2822 2d2d 6e6f  md += [opt("--no
-000056a0: 2d63 6f6e 6669 726d 2d65 7869 7422 295d  -confirm-exit")]
-000056b0: 0a20 2020 2020 2020 2069 6620 5f49 5059  .        if _IPY
-000056c0: 5448 4f4e 5f56 4552 5349 4f4e 203c 2028  THON_VERSION < (
-000056d0: 342c 293a 0a20 2020 2020 2020 2020 2020  4,):.           
-000056e0: 2063 6d64 202b 3d20 5b6f 7074 2822 2d2d   cmd += [opt("--
-000056f0: 6e6f 2d62 616e 6e65 7222 295d 0a20 2020  no-banner")].   
-00005700: 2069 6620 6170 7020 213d 2022 6e6f 7465   if app != "note
-00005710: 626f 6f6b 2220 616e 6420 7072 6f67 2021  book" and prog !
-00005720: 3d20 2270 7922 3a0a 2020 2020 2020 2020  = "py":.        
-00005730: 636d 6420 2b3d 205b 6f70 7428 222d 2d63  cmd += [opt("--c
-00005740: 6f6c 6f72 733d 4e6f 436f 6c6f 7222 295d  olors=NoColor")]
-00005750: 0a20 2020 2069 6620 6672 6f6e 7465 6e64  .    if frontend
-00005760: 203d 3d20 2770 726f 6d70 745f 746f 6f6c   == 'prompt_tool
-00005770: 6b69 7427 2061 6e64 205f 4950 5954 484f  kit' and _IPYTHO
-00005780: 4e5f 5645 5253 494f 4e20 3c20 2837 2c29  N_VERSION < (7,)
-00005790: 206f 7220 7072 6f67 203d 3d20 2270 7922   or prog == "py"
-000057a0: 3a0a 2020 2020 2020 2020 2320 7072 6f6d  :.        # prom
-000057b0: 7074 5f74 6f6f 6c6b 6974 2028 4950 7974  pt_toolkit (IPyt
-000057c0: 686f 6e20 3529 2064 6f65 736e 2774 2073  hon 5) doesn't s
-000057d0: 7570 706f 7274 2074 7572 6e69 6e67 206f  upport turning o
-000057e0: 6666 2061 7574 6f69 6e64 656e 742e 2020  ff autoindent.  
-000057f0: 4974 0a20 2020 2020 2020 2023 2068 6173  It.        # has
-00005800: 2076 6172 696f 7573 2063 6f6d 6d61 6e64   various command
-00005810: 2d6c 696e 6520 6f70 7469 6f6e 7320 7768  -line options wh
-00005820: 6963 6820 746f 6767 6c65 2074 6865 2069  ich toggle the i
-00005830: 6e74 6572 6e61 6c0a 2020 2020 2020 2020  nternal.        
-00005840: 2320 7368 656c 6c2e 6175 746f 696e 6465  # shell.autoinde
-00005850: 6e74 2066 6c61 672c 2062 7574 2074 7572  nt flag, but tur
-00005860: 6e69 6e67 2074 6861 7420 696e 7465 726e  ning that intern
-00005870: 616c 2066 6c61 6720 6f66 6620 646f 6573  al flag off does
-00005880: 6e27 7420 646f 0a20 2020 2020 2020 2023  n't do.        #
-00005890: 2061 6e79 7468 696e 672e 2020 496e 7374   anything.  Inst
-000058a0: 6561 6420 7765 276c 6c20 6a75 7374 2068  ead we'll just h
-000058b0: 6176 6520 746f 2073 656e 6420 6120 5e55  ave to send a ^U
-000058c0: 2061 7420 7468 6520 6265 6769 6e6e 696e   at the beginnin
-000058d0: 6720 6f66 0a20 2020 2020 2020 2023 2065  g of.        # e
-000058e0: 6163 6820 6c69 6e65 2074 6f20 6465 6665  ach line to defe
-000058f0: 6174 2074 6865 2061 7574 6f69 6e64 656e  at the autoinden
-00005900: 742e 2054 6865 2066 6561 7475 7265 2077  t. The feature w
-00005910: 6173 2072 652d 656e 6162 6c65 6420 696e  as re-enabled in
-00005920: 0a20 2020 2020 2020 2023 2049 5079 7468  .        # IPyth
-00005930: 6f6e 2037 2c20 736f 2077 6520 646f 6e27  on 7, so we don'
-00005940: 7420 6e65 6564 2074 6f20 776f 7272 7920  t need to worry 
-00005950: 7468 6572 652e 0a20 2020 2020 2020 2070  there..        p
-00005960: 6173 730a 2020 2020 656c 6966 205f 4950  ass.    elif _IP
-00005970: 5954 484f 4e5f 5645 5253 494f 4e20 3e3d  YTHON_VERSION >=
-00005980: 2028 332c 293a 0a20 2020 2020 2020 2063   (3,):.        c
+00001950: 2062 7222 5c6e 3f4f 7574 5c5b 5b30 2d39   br"\n?Out\[[0-9
+00001960: 5d2b 5c5d 222c 2072 6567 6578 7029 0a20  ]+\]", regexp). 
+00001970: 2020 2069 6620 5f49 5059 5448 4f4e 5f56     if _IPYTHON_V
+00001980: 4552 5349 4f4e 203c 2028 302c 2031 3229  ERSION < (0, 12)
+00001990: 3a0a 2020 2020 2020 2020 2320 4967 6e6f  :.        # Igno
+000019a0: 7265 2075 6c74 7261 7462 2070 726f 626c  re ultratb probl
+000019b0: 656d 7320 286e 6f74 2070 7966 6c79 6279  ems (not pyflyby
+000019c0: 2d72 656c 6174 6564 292e 0a20 2020 2020  -related)..     
+000019d0: 2020 2023 2054 4f44 4f3a 2063 6f6e 7369     # TODO: consi
+000019e0: 6465 7220 7573 696e 6720 2d2d 5465 726d  der using --Term
+000019f0: 696e 616c 496e 7465 7261 6374 6976 6553  inalInteractiveS
+00001a00: 6865 6c6c 2e78 6d6f 6465 3d70 6c61 696e  hell.xmode=plain
+00001a10: 2028 2d78 6d6f 6465 290a 2020 2020 2020   (-xmode).      
+00001a20: 2020 6967 6e6f 7265 203d 2064 6564 656e    ignore = deden
+00001a30: 7428 7222 2222 0a20 2020 2020 2020 2020  t(r""".         
+00001a40: 2020 2028 4552 524f 523a 2041 6e20 756e     (ERROR: An un
+00001a50: 6578 7065 6374 6564 2065 7272 6f72 206f  expected error o
+00001a60: 6363 7572 7265 6420 7768 696c 6520 746f  ccurred while to
+00001a70: 6b65 6e69 7a69 6e67 2069 6e70 7574 0a20  kenizing input. 
+00001a80: 2020 2020 2020 2020 2020 2054 6865 2066             The f
+00001a90: 6f6c 6c6f 7769 6e67 2074 7261 6365 6261  ollowing traceba
+00001aa0: 636b 206d 6179 2062 6520 636f 7272 7570  ck may be corrup
+00001ab0: 7465 6420 6f72 2069 6e76 616c 6964 0a20  ted or invalid. 
+00001ac0: 2020 2020 2020 2020 2020 2054 6865 2065             The e
+00001ad0: 7272 6f72 206d 6573 7361 6765 2069 733a  rror message is:
+00001ae0: 202e 2a0a 2020 2020 2020 2020 2020 2020   .*.            
+00001af0: 293f 0a20 2020 2020 2020 2022 2222 292e  )?.        """).
+00001b00: 7374 7269 7028 292e 656e 636f 6465 2827  strip().encode('
+00001b10: 7574 662d 3827 290a 2020 2020 2020 2020  utf-8').        
+00001b20: 7265 7375 6c74 203d 2072 652e 7375 6228  result = re.sub(
+00001b30: 6967 6e6f 7265 2c20 6222 222c 2072 6573  ignore, b"", res
+00001b40: 756c 7429 0a20 2020 2069 6620 5f49 5059  ult).    if _IPY
+00001b50: 5448 4f4e 5f56 4552 5349 4f4e 203c 2028  THON_VERSION < (
+00001b60: 312c 2030 293a 0a20 2020 2020 2020 2023  1, 0):.        #
+00001b70: 2049 676e 6f72 6520 7a6d 7120 7665 7273   Ignore zmq vers
+00001b80: 696f 6e20 7761 726e 696e 6773 2028 6e6f  ion warnings (no
+00001b90: 7420 7079 666c 7962 792d 7265 6c61 7465  t pyflyby-relate
+00001ba0: 6429 2e0a 2020 2020 2020 2020 2320 544f  d)..        # TO
+00001bb0: 444f 3a20 696e 7374 616c 6c20 6f6c 6465  DO: install olde
+00001bc0: 7220 7665 7273 696f 6e20 6f66 207a 6d71  r version of zmq
+00001bd0: 2066 6f72 206f 6c64 6572 2049 5079 7468   for older IPyth
+00001be0: 6f6e 2076 6572 7369 6f6e 732e 0a20 2020  on versions..   
+00001bf0: 2020 2020 2069 676e 6f72 6520 3d20 6465       ignore = de
+00001c00: 6465 6e74 2872 2222 220a 2020 2020 2020  dent(r""".      
+00001c10: 2020 2020 2020 282f 2e2a 2f49 5079 7468        (/.*/IPyth
+00001c20: 6f6e 2f7a 6d71 2f5f 5f69 6e69 745f 5f2e  on/zmq/__init__.
+00001c30: 7079 3a5c 642b 3a20 5275 6e74 696d 6557  py:\d+: RuntimeW
+00001c40: 6172 6e69 6e67 3a20 6c69 627a 6d71 205c  arning: libzmq \
+00001c50: 642b 2064 6574 6563 7465 642e 0a20 2020  d+ detected..   
+00001c60: 2020 2020 2020 2020 205c 732a 4974 2069           \s*It i
+00001c70: 7320 756e 6c69 6b65 6c79 2074 6861 7420  s unlikely that 
+00001c80: 4950 7974 686f 6e27 7320 7a6d 7120 636f  IPython's zmq co
+00001c90: 6465 2077 696c 6c20 776f 726b 2070 726f  de will work pro
+00001ca0: 7065 726c 792e 0a20 2020 2020 2020 2020  perly..         
+00001cb0: 2020 205c 732a 506c 6561 7365 2069 6e73     \s*Please ins
+00001cc0: 7461 6c6c 206c 6962 7a6d 7120 7374 6162  tall libzmq stab
+00001cd0: 6c65 2e2a 3f0a 2020 2020 2020 2020 2020  le.*?.          
+00001ce0: 2020 5c73 2a52 756e 7469 6d65 5761 726e    \s*RuntimeWarn
+00001cf0: 696e 675c 290a 2020 2020 2020 2020 2020  ing\).          
+00001d00: 2020 293f 0a20 2020 2020 2020 2022 2222    )?.        """
+00001d10: 292e 7374 7269 7028 292e 656e 636f 6465  ).strip().encode
+00001d20: 2827 7574 662d 3827 290a 2020 2020 2020  ('utf-8').      
+00001d30: 2020 7265 7375 6c74 203d 2072 652e 7375    result = re.su
+00001d40: 6228 6967 6e6f 7265 2c20 6222 222c 2072  b(ignore, b"", r
+00001d50: 6573 756c 7429 0a20 2020 2023 2049 676e  esult).    # Ign
+00001d60: 6f72 6520 7468 6520 2243 6f6d 7069 6c65  ore the "Compile
+00001d70: 7220 7469 6d65 3a20 302e 3132 3320 7322  r time: 0.123 s"
+00001d80: 2077 6869 6368 206d 6179 206f 6363 6173   which may occas
+00001d90: 696f 6e61 6c6c 7920 6170 7065 6172 0a20  ionally appear. 
+00001da0: 2020 2023 2064 6570 656e 6469 6e67 206f     # depending o
+00001db0: 6e20 7275 6e74 696d 652e 0a20 2020 2072  n runtime..    r
+00001dc0: 6567 6578 7020 3d20 7265 2e73 7562 2872  egexp = re.sub(r
+00001dd0: 652e 636f 6d70 696c 6528 6272 225e 2831  e.compile(br"^(1
+00001de0: 5b5c 5c5d 2a20 6c6f 6f70 735b 5c5c 5d2a  [\\]* loops[\\]*
+00001df0: 2c5b 5c5c 5d2a 2062 6573 745b 5c5c 5d2a  ,[\\]* best[\\]*
+00001e00: 206f 665b 5c5c 5d2a 2031 5b5c 5c5d 2a3a   of[\\]* 1[\\]*:
+00001e10: 5b5c 5c5d 2a20 2e2a 5b5c 5c5d 2a20 7065  [\\]* .*[\\]* pe
+00001e20: 725b 5c5c 5d2a 206c 6f6f 7029 2824 7c5b  r[\\]* loop)($|[
+00001e30: 245d 7c5b 5c5c 5d2a 5c6e 2922 2c20 7265  $]|[\\]*\n)", re
+00001e40: 2e4d 292c 0a20 2020 2020 2020 2020 2020  .M),.           
+00001e50: 2020 2020 2020 2020 2062 225c 5c31 283f           b"\\1(?
+00001e60: 3a5c 6e43 6f6d 7069 6c65 7220 283f 3a74  :\nCompiler (?:t
+00001e70: 696d 6529 3f3a 205b 302d 392e 5d2b 2073  ime)?: [0-9.]+ s
+00001e80: 293f 5c5c 3222 2c20 7265 6765 7870 290a  )?\\2", regexp).
+00001e90: 2020 2020 7265 6765 7870 203d 2072 652e      regexp = re.
+00001ea0: 7375 6228 7265 2e63 6f6d 7069 6c65 2862  sub(re.compile(b
+00001eb0: 7222 5e28 5761 6c6c 5b5c 5c5d 2a20 7469  r"^(Wall[\\]* ti
+00001ec0: 6d65 5b5c 5c5d 2a3a 2e2a 3f29 2824 7c5b  me[\\]*:.*?)($|[
+00001ed0: 245d 7c5b 5c5c 5d2a 5c6e 2922 2c20 7265  $]|[\\]*\n)", re
+00001ee0: 2e4d 292c 0a20 2020 2020 2020 2020 2020  .M),.           
+00001ef0: 2020 2020 2020 2020 2062 225c 5c31 283f           b"\\1(?
+00001f00: 3a5c 6e43 6f6d 7069 6c65 7220 283f 3a74  :\nCompiler (?:t
+00001f10: 696d 6529 3f3a 205b 302d 392e 5d2b 2073  ime)?: [0-9.]+ s
+00001f20: 293f 5c5c 3222 2c20 7265 6765 7870 290a  )?\\2", regexp).
+00001f30: 2020 2020 7265 6765 7870 202b 3d20 6222      regexp += b"
+00001f40: 2422 0a20 2020 2023 2043 6865 636b 2066  $".    # Check f
+00001f50: 6f72 206d 6174 6368 2e0a 2020 2020 7265  or match..    re
+00001f60: 6765 7870 203d 2072 652e 636f 6d70 696c  gexp = re.compil
+00001f70: 6528 7265 6765 7870 290a 2020 2020 7265  e(regexp).    re
+00001f80: 7375 6c74 203d 2062 275c 6e27 2e6a 6f69  sult = b'\n'.joi
+00001f90: 6e28 6c69 6e65 2e72 7374 7269 7028 2920  n(line.rstrip() 
+00001fa0: 666f 7220 6c69 6e65 2069 6e20 7265 7375  for line in resu
+00001fb0: 6c74 2e73 706c 6974 6c69 6e65 7328 2929  lt.splitlines())
+00001fc0: 0a20 2020 2072 6573 756c 7420 3d20 7265  .    result = re
+00001fd0: 7375 6c74 2e73 7472 6970 2829 0a20 2020  sult.strip().   
+00001fe0: 2069 6620 4445 4255 473a 0a20 2020 2020   if DEBUG:.     
+00001ff0: 2020 2070 7269 6e74 2822 6578 7065 6374     print("expect
+00002000: 6564 3a20 2572 2220 2520 2865 7870 6563  ed: %r" % (expec
+00002010: 7465 642c 2929 0a20 2020 2020 2020 2070  ted,)).        p
+00002020: 7269 6e74 2822 7265 7375 6c74 2020 3a20  rint("result  : 
+00002030: 2572 2220 2520 2872 6573 756c 742c 2929  %r" % (result,))
+00002040: 0a20 2020 2069 6620 6e6f 7420 7265 6765  .    if not rege
+00002050: 7870 2e6d 6174 6368 2872 6573 756c 7429  xp.match(result)
+00002060: 3a0a 2020 2020 2020 2020 6d73 6720 3d20  :.        msg = 
+00002070: 5b5d 0a20 2020 2020 2020 206d 7367 2e61  [].        msg.a
+00002080: 7070 656e 6428 2245 7870 6563 7465 643a  ppend("Expected:
+00002090: 2229 0a20 2020 2020 2020 206d 7367 2e65  ").        msg.e
+000020a0: 7874 656e 6428 2220 2020 2020 2573 2225  xtend("     %s"%
+000020b0: 6c69 6e65 2066 6f72 206c 696e 6520 696e  line for line in
+000020c0: 2065 7870 6563 7465 642e 7370 6c69 746c   expected.splitl
+000020d0: 696e 6573 2829 290a 2020 2020 2020 2020  ines()).        
+000020e0: 6d73 672e 6170 7065 6e64 2822 5265 7375  msg.append("Resu
+000020f0: 6c74 3a22 290a 2020 2020 2020 2020 6d73  lt:").        ms
+00002100: 672e 6578 7465 6e64 2822 2020 2020 2025  g.extend("     %
+00002110: 7322 256c 696e 6520 666f 7220 6c69 6e65  s"%line for line
+00002120: 2069 6e20 7265 7375 6c74 2e73 706c 6974   in result.split
+00002130: 6c69 6e65 7328 2929 0a20 2020 2020 2020  lines()).       
+00002140: 206d 7367 2e61 7070 656e 6428 2244 6966   msg.append("Dif
+00002150: 663a 2229 0a20 2020 2020 2020 206d 7367  f:").        msg
+00002160: 2e65 7874 656e 6428 2220 2020 2573 2225  .extend("   %s"%
+00002170: 6c69 6e65 2066 6f72 206c 696e 6520 696e  line for line in
+00002180: 2064 6966 666c 6962 2e6e 6469 6666 280a   difflib.ndiff(.
+00002190: 2020 2020 2020 2020 2020 2020 6578 7065              expe
+000021a0: 6374 6564 2e64 6563 6f64 6528 2775 7466  cted.decode('utf
+000021b0: 2d38 2729 2e73 706c 6974 6c69 6e65 7328  -8').splitlines(
+000021c0: 292c 2072 6573 756c 742e 6465 636f 6465  ), result.decode
+000021d0: 2827 7574 662d 3827 292e 7370 6c69 746c  ('utf-8').splitl
+000021e0: 696e 6573 2829 2929 0a20 2020 2020 2020  ines())).       
+000021f0: 2069 6620 4445 4255 4720 6f72 2061 6e79   if DEBUG or any
+00002200: 2869 2069 6e20 6227 5c78 3162 5c78 3037  (i in b'\x1b\x07
+00002210: 5c62 5c74 2720 666f 7220 6920 696e 2065  \b\t' for i in e
+00002220: 7870 6563 7465 642b 7265 7375 6c74 293a  xpected+result):
+00002230: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
+00002240: 2e61 7070 656e 6428 2244 6966 6620 5265  .append("Diff Re
+00002250: 7072 3a22 290a 2020 2020 2020 2020 2020  pr:").          
+00002260: 2020 6d73 672e 6578 7465 6e64 2822 2020    msg.extend("  
+00002270: 2025 7222 256c 696e 6520 666f 7220 6c69   %r"%line for li
+00002280: 6e65 2069 6e20 6469 6666 6c69 622e 6e64  ne in difflib.nd
+00002290: 6966 6628 0a20 2020 2020 2020 2020 2020  iff(.           
+000022a0: 2020 2020 2065 7870 6563 7465 642e 6465       expected.de
+000022b0: 636f 6465 2827 7574 662d 3827 292e 7370  code('utf-8').sp
+000022c0: 6c69 746c 696e 6573 2829 2c20 7265 7375  litlines(), resu
+000022d0: 6c74 2e64 6563 6f64 6528 2775 7466 2d38  lt.decode('utf-8
+000022e0: 2729 2e73 706c 6974 6c69 6e65 7328 2929  ').splitlines())
+000022f0: 290a 2020 2020 2020 2020 6d73 6720 3d20  ).        msg = 
+00002300: 225c 6e22 2e6a 6f69 6e28 6d73 6729 0a20  "\n".join(msg). 
+00002310: 2020 2020 2020 2070 7974 6573 742e 6661         pytest.fa
+00002320: 696c 286d 7367 290a 0a0a 6465 6620 7061  il(msg)...def pa
+00002330: 7273 655f 7465 6d70 6c61 7465 2874 656d  rse_template(tem
+00002340: 706c 6174 652c 2063 6c65 6172 5f74 6162  plate, clear_tab
+00002350: 5f63 6f6d 706c 6574 696f 6e73 3d46 616c  _completions=Fal
+00002360: 7365 293a 0a20 2020 2074 656d 706c 6174  se):.    templat
+00002370: 6520 3d20 6465 6465 6e74 2874 656d 706c  e = dedent(templ
+00002380: 6174 6529 2e73 7472 6970 2829 2e65 6e63  ate).strip().enc
+00002390: 6f64 6528 2775 7466 2d38 2729 0a20 2020  ode('utf-8').   
+000023a0: 2069 6e70 7574 203d 205b 5d0a 2020 2020   input = [].    
+000023b0: 6578 7065 6374 6564 203d 2062 2222 0a20  expected = b"". 
+000023c0: 2020 2070 6174 7465 726e 203d 2072 652e     pattern = re.
+000023d0: 636f 6d70 696c 6528 6272 225e 283f 3a49  compile(br"^(?:I
+000023e0: 6e20 5c5b 5b30 2d39 5d2b 5c5d 3a7c 2020  n \[[0-9]+\]:|  
+000023f0: 205b 2e5d 5b2e 5d5b 2e5d 2b3a 7c69 7064   [.][.][.]+:|ipd
+00002400: 623e 7c3e 3e3e 2928 3f3a 207c 2429 222c  b>|>>>)(?: |$)",
+00002410: 2072 652e 4d29 0a20 2020 2077 6869 6c65   re.M).    while
+00002420: 2074 656d 706c 6174 653a 0a20 2020 2020   template:.     
+00002430: 2020 206d 203d 2070 6174 7465 726e 2e73     m = pattern.s
+00002440: 6561 7263 6828 7465 6d70 6c61 7465 290a  earch(template).
+00002450: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
+00002460: 3a0a 2020 2020 2020 2020 2020 2020 6578  :.            ex
+00002470: 7065 6374 6564 202b 3d20 7465 6d70 6c61  pected += templa
+00002480: 7465 0a20 2020 2020 2020 2020 2020 2062  te.            b
+00002490: 7265 616b 0a20 2020 2020 2020 2065 7870  reak.        exp
+000024a0: 6c69 6e65 203d 206d 2e67 726f 7570 2830  line = m.group(0
+000024b0: 290a 2020 2020 2020 2020 6578 7065 6374  ).        expect
+000024c0: 6564 202b 3d20 7465 6d70 6c61 7465 5b3a  ed += template[:
+000024d0: 6d2e 656e 6428 295d 0a20 2020 2020 2020  m.end()].       
+000024e0: 2074 656d 706c 6174 6520 3d20 7465 6d70   template = temp
+000024f0: 6c61 7465 5b6d 2e65 6e64 2829 3a5d 0a20  late[m.end():]. 
+00002500: 2020 2020 2020 2077 6869 6c65 2074 656d         while tem
+00002510: 706c 6174 6520 616e 6420 6e6f 7420 7465  plate and not te
+00002520: 6d70 6c61 7465 2e73 7461 7274 7377 6974  mplate.startswit
+00002530: 6828 6222 5c6e 2229 3a0a 2020 2020 2020  h(b"\n"):.      
+00002540: 2020 2020 2020 2320 5765 2772 6520 696e        # We're in
+00002550: 2074 6865 2069 6e70 7574 2070 6172 7420   the input part 
+00002560: 6f66 2061 2074 656d 706c 6174 652e 2020  of a template.  
+00002570: 4765 7420 696e 7075 7420 7570 2074 6f20  Get input up to 
+00002580: 7461 6220 6f72 0a20 2020 2020 2020 2020  tab or.         
+00002590: 2020 2023 2065 6e64 206f 6620 6c69 6e65     # end of line
+000025a0: 2e0a 2020 2020 2020 2020 2020 2020 6d20  ..            m 
+000025b0: 3d20 7265 2e6d 6174 6368 2872 652e 636f  = re.match(re.co
+000025c0: 6d70 696c 6528 6272 2228 2e2a 3f29 285c  mpile(br"(.*?)(\
+000025d0: 747c 2429 222c 2072 652e 4d29 2c20 7465  t|$)", re.M), te
+000025e0: 6d70 6c61 7465 290a 2020 2020 2020 2020  mplate).        
+000025f0: 2020 2020 696e 7075 742e 6170 7065 6e64      input.append
+00002600: 286d 2e67 726f 7570 2831 2929 0a20 2020  (m.group(1)).   
+00002610: 2020 2020 2020 2020 2065 7870 6c69 6e65           expline
+00002620: 202b 3d20 6d2e 6772 6f75 7028 3129 0a20   += m.group(1). 
+00002630: 2020 2020 2020 2020 2020 2065 7870 6563             expec
+00002640: 7465 6420 2b3d 206d 2e67 726f 7570 2831  ted += m.group(1
+00002650: 290a 2020 2020 2020 2020 2020 2020 7461  ).            ta
+00002660: 6220 3d20 6d2e 6772 6f75 7028 3229 0a20  b = m.group(2). 
+00002670: 2020 2020 2020 2020 2020 2074 656d 706c             templ
+00002680: 6174 6520 3d20 7465 6d70 6c61 7465 5b6d  ate = template[m
+00002690: 2e65 6e64 2829 3a5d 0a20 2020 2020 2020  .end():].       
+000026a0: 2020 2020 2069 6620 6e6f 7420 7461 623a       if not tab:
+000026b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000026c0: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+000026d0: 2020 2023 2047 6f74 2061 2074 6162 2e20     # Got a tab. 
+000026e0: 2049 6e63 6c75 6465 2074 6865 2074 6162   Include the tab
+000026f0: 2069 6e20 696e 7075 7420 746f 2073 656e   in input to sen
+00002700: 642c 2062 7574 206e 6f74 2069 6e0a 2020  d, but not in.  
+00002710: 2020 2020 2020 2020 2020 2320 6578 7065            # expe
+00002720: 6374 6564 206f 7574 7075 742e 0a20 2020  cted output..   
+00002730: 2020 2020 2020 2020 2069 6e70 7574 2e61           input.a
+00002740: 7070 656e 6428 7461 6229 0a20 2020 2020  ppend(tab).     
+00002750: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+00002760: 7465 6d70 6c61 7465 2065 6e64 7320 6120  template ends a 
+00002770: 6c69 6e65 2077 6974 6820 6120 7461 622c  line with a tab,
+00002780: 2074 6865 6e20 6173 7375 6d65 2074 6861   then assume tha
+00002790: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
+000027a0: 4950 7974 686f 6e20 7769 6c6c 206f 7574  IPython will out
+000027b0: 7075 7420 736f 6d65 206c 6f67 6769 6e67  put some logging
+000027c0: 2028 6173 2069 6e63 6c75 6465 6420 696e   (as included in
+000027d0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+000027e0: 2023 2074 656d 706c 6174 6529 2061 6e64   # template) and
+000027f0: 2072 6570 6561 7420 7468 6520 6c69 6e65   repeat the line
+00002800: 2073 6f20 6661 7220 2861 7320 696e 636c   so far (as incl
+00002810: 7564 6564 2069 6e20 7468 650a 2020 2020  uded in the.    
+00002820: 2020 2020 2020 2020 2320 7465 6d70 6c61          # templa
+00002830: 7465 292c 2074 6865 6e20 706f 7373 6962  te), then possib
+00002840: 6c79 2074 6162 2063 6f6d 706c 6574 6520  ly tab complete 
+00002850: 736f 6d65 206d 6f72 652e 2020 4974 206d  some more.  It m
+00002860: 6967 6874 0a20 2020 2020 2020 2020 2020  ight.           
+00002870: 2023 2062 6520 7265 7065 6174 6564 206d   # be repeated m
+00002880: 756c 7469 706c 6520 7469 6d65 732c 2066  ultiple times, f
+00002890: 6f72 2061 2074 6f74 616c 206f 6620 7570  or a total of up
+000028a0: 2074 6f20 7468 7265 650a 2020 2020 2020   to three.      
+000028b0: 2020 2020 2020 2320 6f63 6375 7272 656e        # occurren
+000028c0: 6365 7320 6f66 2074 6865 2073 616d 6520  ces of the same 
+000028d0: 7072 6f6d 7074 2e20 2057 6520 6669 6e64  prompt.  We find
+000028e0: 2077 6865 7265 2074 6f20 636f 6e74 696e   where to contin
+000028f0: 7565 0a20 2020 2020 2020 2020 2020 2023  ue.            #
+00002900: 2062 7920 6c6f 6f6b 696e 6720 666f 7220   by looking for 
+00002910: 7468 6520 6c69 6e65 2072 6570 6561 7465  the line repeate
+00002920: 6420 696e 2074 6865 2074 656d 706c 6174  d in the templat
+00002930: 652e 0a20 2020 2020 2020 2020 2020 2069  e..            i
+00002940: 6620 7465 6d70 6c61 7465 2e73 7461 7274  f template.start
+00002950: 7377 6974 6828 6222 5c6e 2229 3a0a 2020  swith(b"\n"):.  
+00002960: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00002970: 2063 6c65 6172 5f74 6162 5f63 6f6d 706c   clear_tab_compl
+00002980: 6574 696f 6e73 3a0a 2020 2020 2020 2020  etions:.        
+00002990: 2020 2020 2020 2020 2020 2020 2320 496e              # In
+000029a0: 2070 726f 6d70 742d 746f 6f6c 6b69 7420   prompt-toolkit 
+000029b0: 322e 302c 2074 6162 2063 6f6d 706c 6574  2.0, tab complet
+000029c0: 696f 6e20 6174 2074 6865 2065 6e64 206f  ion at the end o
+000029d0: 6620 7468 6520 6c69 6e65 2069 7320 636c  f the line is cl
+000029e0: 6561 7265 6420 696e 2074 6865 206f 7574  eared in the out
+000029f0: 7075 740a 2020 2020 2020 2020 2020 2020  put.            
+00002a00: 2020 2020 2020 2020 6e65 776c 696e 6520          newline 
+00002a10: 3d20 6578 7065 6374 6564 2e72 6669 6e64  = expected.rfind
+00002a20: 2862 275c 6e27 290a 2020 2020 2020 2020  (b'\n').        
+00002a30: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00002a40: 6577 6c69 6e65 203d 3d20 2d31 3a20 6e65  ewline == -1: ne
+00002a50: 776c 696e 6520 3d20 300a 2020 2020 2020  wline = 0.      
+00002a60: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00002a70: 7065 6374 6564 203d 2065 7870 6563 7465  pected = expecte
+00002a80: 645b 3a6e 6577 6c69 6e65 5d0a 0a20 2020  d[:newline]..   
+00002a90: 2020 2020 2020 2020 2020 2020 2072 6570               rep
+00002aa0: 203d 2074 656d 706c 6174 652e 7266 696e   = template.rfin
+00002ab0: 6428 6578 706c 696e 6529 0a20 2020 2020  d(expline).     
+00002ac0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+00002ad0: 7020 3c20 303a 0a20 2020 2020 2020 2020  p < 0:.         
+00002ae0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00002af0: 2041 7373 6572 7469 6f6e 4572 726f 7228   AssertionError(
+00002b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002b10: 2020 2020 2020 2020 2022 6578 7065 6374           "expect
+00002b20: 6564 206e 6578 7420 6c69 6e65 206f 6620  ed next line of 
+00002b30: 7465 6d70 6c61 7465 2066 6f6c 6c6f 7769  template followi
+00002b40: 6e67 2061 2022 0a20 2020 2020 2020 2020  ng a ".         
+00002b50: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00002b60: 7461 6220 636f 6d70 6c65 7469 6f6e 2074  tab completion t
+00002b70: 6f20 7374 6172 7420 7769 7468 2025 7222  o start with %r"
+00002b80: 2025 2028 6578 706c 696e 652c 2929 0a20   % (expline,)). 
+00002b90: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00002ba0: 6570 656e 6420 3d20 7265 7020 2b20 6c65  epend = rep + le
+00002bb0: 6e28 6578 706c 696e 6529 0a20 2020 2020  n(expline).     
+00002bc0: 2020 2020 2020 2020 2020 2065 7870 6563             expec
+00002bd0: 7465 6420 2b3d 2074 656d 706c 6174 655b  ted += template[
+00002be0: 3a72 6570 656e 645d 0a20 2020 2020 2020  :repend].       
+00002bf0: 2020 2020 2020 2020 2074 656d 706c 6174           templat
+00002c00: 6520 3d20 7465 6d70 6c61 7465 5b72 6570  e = template[rep
+00002c10: 656e 643a 5d0a 2020 2020 2020 2020 2020  end:].          
+00002c20: 2020 2320 4173 7375 6d65 2074 6861 7420    # Assume that 
+00002c30: 616c 6c20 7375 6273 6571 7565 6e74 2073  all subsequent s
+00002c40: 796d 626f 6c20 6368 6172 6163 7465 7273  ymbol characters
+00002c50: 2028 616c 7068 616e 756d 6572 6963 0a20   (alphanumeric. 
+00002c60: 2020 2020 2020 2020 2020 2023 2061 6e64             # and
+00002c70: 2075 6e64 6572 7363 6f72 6529 2069 6e20   underscore) in 
+00002c80: 7468 6520 7465 6d70 6c61 7465 2072 6570  the template rep
+00002c90: 7265 7365 6e74 2074 6162 2063 6f6d 706c  resent tab compl
+00002ca0: 6574 696f 6e0a 2020 2020 2020 2020 2020  etion.          
+00002cb0: 2020 2320 6f75 7470 7574 2e0a 2020 2020    # output..    
+00002cc0: 2020 2020 2020 2020 6d20 3d20 7265 2e6d          m = re.m
+00002cd0: 6174 6368 2862 7222 5b61 2d7a 412d 5a30  atch(br"[a-zA-Z0
+00002ce0: 2d39 5f5d 2b22 2c20 7465 6d70 6c61 7465  -9_]+", template
+00002cf0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00002d00: 206d 3a0a 2020 2020 2020 2020 2020 2020   m:.            
+00002d10: 2020 2020 6578 706c 696e 6520 2b3d 206d      expline += m
+00002d20: 2e67 726f 7570 2830 290a 2020 2020 2020  .group(0).      
+00002d30: 2020 2020 2020 2020 2020 6578 7065 6374            expect
+00002d40: 6564 202b 3d20 6d2e 6772 6f75 7028 3029  ed += m.group(0)
+00002d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002d60: 2074 656d 706c 6174 6520 3d20 7465 6d70   template = temp
+00002d70: 6c61 7465 5b6d 2e65 6e64 2829 3a5d 0a20  late[m.end():]. 
+00002d80: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00002d90: 2041 6c6c 6f77 205c 7830 3620 696e 2074   Allow \x06 in t
+00002da0: 6865 2074 656d 706c 6174 6520 746f 2062  he template to b
+00002db0: 6520 6120 7370 6563 6961 6c20 6368 6172  e a special char
+00002dc0: 6163 7465 7220 6d65 616e 696e 670a 2020  acter meaning.  
+00002dd0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00002de0: 2265 6e64 206f 6620 7461 6220 636f 6d70  "end of tab comp
+00002df0: 6c65 7469 6f6e 206f 7574 7075 7422 2e0a  letion output"..
+00002e00: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+00002e10: 656d 706c 6174 652e 7374 6172 7473 7769  emplate.startswi
+00002e20: 7468 2862 225c 7830 3622 293a 0a20 2020  th(b"\x06"):.   
+00002e30: 2020 2020 2020 2020 2020 2020 2074 656d               tem
+00002e40: 706c 6174 6520 3d20 7465 6d70 6c61 7465  plate = template
+00002e50: 5b31 3a5d 0a20 2020 2020 2020 2069 6e70  [1:].        inp
+00002e60: 7574 2e61 7070 656e 6428 6222 5c6e 2229  ut.append(b"\n")
+00002e70: 0a20 2020 2069 6e70 7574 203d 2062 2222  .    input = b""
+00002e80: 2e6a 6f69 6e28 696e 7075 7429 0a20 2020  .join(input).   
+00002e90: 2072 6574 7572 6e20 696e 7075 742c 2065   return input, e
+00002ea0: 7870 6563 7465 640a 0a0a 4072 6574 7279  xpected...@retry
+00002eb0: 0a40 7079 7465 7374 2e6d 6172 6b2e 7061  .@pytest.mark.pa
+00002ec0: 7261 6d65 7472 697a 6528 2763 6c65 6172  rametrize('clear
+00002ed0: 5f74 6162 5f63 6f6d 706c 6574 696f 6e73  _tab_completions
+00002ee0: 272c 205b 4661 6c73 652c 2054 7275 655d  ', [False, True]
+00002ef0: 290a 6465 6620 7465 7374 5f73 656c 6674  ).def test_selft
+00002f00: 6573 745f 7061 7273 655f 7465 6d70 6c61  est_parse_templa
+00002f10: 7465 5f31 2863 6c65 6172 5f74 6162 5f63  te_1(clear_tab_c
+00002f20: 6f6d 706c 6574 696f 6e73 293a 0a20 2020  ompletions):.   
+00002f30: 2074 656d 706c 6174 6520 3d20 2222 220a   template = """.
+00002f40: 2020 2020 2020 2020 496e 205b 315d 3a20          In [1]: 
+00002f50: 6865 6c6c 6f0a 2020 2020 2020 2020 7468  hello.        th
+00002f60: 6572 650a 2020 2020 2020 2020 776f 726c  ere.        worl
+00002f70: 640a 2020 2020 2020 2020 496e 205b 325d  d.        In [2]
+00002f80: 3a20 666f 6f0a 2020 2020 2020 2020 2020  : foo.          
+00002f90: 202e 2e2e 3a20 6261 720a 2020 2020 2020   ...: bar.      
+00002fa0: 2020 2020 202e 2e2e 3a0a 2020 2020 2020       ...:.      
+00002fb0: 2020 6261 7a0a 2020 2020 2222 220a 2020    baz.    """.  
+00002fc0: 2020 696e 7075 742c 2065 7870 6563 7465    input, expecte
+00002fd0: 6420 3d20 7061 7273 655f 7465 6d70 6c61  d = parse_templa
+00002fe0: 7465 2874 656d 706c 6174 652c 2063 6c65  te(template, cle
+00002ff0: 6172 5f74 6162 5f63 6f6d 706c 6574 696f  ar_tab_completio
+00003000: 6e73 3d63 6c65 6172 5f74 6162 5f63 6f6d  ns=clear_tab_com
+00003010: 706c 6574 696f 6e73 290a 2020 2020 6173  pletions).    as
+00003020: 7365 7274 2069 6e70 7574 203d 3d20 6222  sert input == b"
+00003030: 6865 6c6c 6f5c 6e66 6f6f 5c6e 6261 725c  hello\nfoo\nbar\
+00003040: 6e5c 6e22 0a20 2020 2061 7373 6572 7420  n\n".    assert 
+00003050: 6578 7065 6374 6564 203d 3d20 280a 2020  expected == (.  
+00003060: 2020 2020 2020 6222 496e 205b 315d 3a20        b"In [1]: 
+00003070: 6865 6c6c 6f5c 6e74 6865 7265 5c6e 776f  hello\nthere\nwo
+00003080: 726c 645c 6e22 0a20 2020 2020 2020 2062  rld\n".        b
+00003090: 2249 6e20 5b32 5d3a 2066 6f6f 5c6e 2020  "In [2]: foo\n  
+000030a0: 202e 2e2e 3a20 6261 725c 6e20 2020 2e2e   ...: bar\n   ..
+000030b0: 2e3a 5c6e 6261 7a22 290a 0a0a 4072 6574  .:\nbaz")...@ret
+000030c0: 7279 0a40 7079 7465 7374 2e6d 6172 6b2e  ry.@pytest.mark.
+000030d0: 7061 7261 6d65 7472 697a 6528 2763 6c65  parametrize('cle
+000030e0: 6172 5f74 6162 5f63 6f6d 706c 6574 696f  ar_tab_completio
+000030f0: 6e73 272c 205b 4661 6c73 652c 2054 7275  ns', [False, Tru
+00003100: 655d 290a 6465 6620 7465 7374 5f73 656c  e]).def test_sel
+00003110: 6674 6573 745f 7061 7273 655f 7465 6d70  ftest_parse_temp
+00003120: 6c61 7465 5f74 6162 5f70 756e 6374 7561  late_tab_punctua
+00003130: 7469 6f6e 5f31 2863 6c65 6172 5f74 6162  tion_1(clear_tab
+00003140: 5f63 6f6d 706c 6574 696f 6e73 293a 0a20  _completions):. 
+00003150: 2020 2074 656d 706c 6174 6520 3d20 2222     template = ""
+00003160: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
+00003170: 3a20 6865 6c6c 6f5c 745f 7468 6572 6528  : hello\t_there(
+00003180: 3329 0a20 2020 2020 2020 2067 6f6f 6462  3).        goodb
+00003190: 7965 0a20 2020 2022 2222 0a20 2020 2069  ye.    """.    i
+000031a0: 6e70 7574 2c20 6578 7065 6374 6564 203d  nput, expected =
+000031b0: 2070 6172 7365 5f74 656d 706c 6174 6528   parse_template(
+000031c0: 7465 6d70 6c61 7465 2c20 636c 6561 725f  template, clear_
+000031d0: 7461 625f 636f 6d70 6c65 7469 6f6e 733d  tab_completions=
+000031e0: 636c 6561 725f 7461 625f 636f 6d70 6c65  clear_tab_comple
+000031f0: 7469 6f6e 7329 0a20 2020 2061 7373 6572  tions).    asser
+00003200: 7420 696e 7075 7420 3d3d 2062 2268 656c  t input == b"hel
+00003210: 6c6f 5c74 2833 295c 6e22 0a20 2020 2061  lo\t(3)\n".    a
+00003220: 7373 6572 7420 6578 7065 6374 6564 203d  ssert expected =
+00003230: 3d20 2862 2249 6e20 5b31 5d3a 2068 656c  = (b"In [1]: hel
+00003240: 6c6f 5f74 6865 7265 2833 295c 6e67 6f6f  lo_there(3)\ngoo
+00003250: 6462 7965 2229 0a0a 0a40 7265 7472 790a  dbye")...@retry.
+00003260: 4070 7974 6573 742e 6d61 726b 2e70 6172  @pytest.mark.par
+00003270: 616d 6574 7269 7a65 2827 636c 6561 725f  ametrize('clear_
+00003280: 7461 625f 636f 6d70 6c65 7469 6f6e 7327  tab_completions'
+00003290: 2c20 5b46 616c 7365 2c20 5472 7565 5d29  , [False, True])
+000032a0: 0a64 6566 2074 6573 745f 7365 6c66 7465  .def test_selfte
+000032b0: 7374 5f70 6172 7365 5f74 656d 706c 6174  st_parse_templat
+000032c0: 655f 7461 625f 6e65 776c 696e 655f 2863  e_tab_newline_(c
+000032d0: 6c65 6172 5f74 6162 5f63 6f6d 706c 6574  lear_tab_complet
+000032e0: 696f 6e73 293a 0a20 2020 2074 656d 706c  ions):.    templ
+000032f0: 6174 6520 3d20 2222 220a 2020 2020 2020  ate = """.      
+00003300: 2020 496e 205b 315d 3a20 6865 6c6c 6f5f    In [1]: hello_
+00003310: 5c74 7468 6572 650a 2020 2020 2020 2020  \tthere.        
+00003320: 676f 6f64 6279 650a 2020 2020 2222 220a  goodbye.    """.
+00003330: 2020 2020 696e 7075 742c 2065 7870 6563      input, expec
+00003340: 7465 6420 3d20 7061 7273 655f 7465 6d70  ted = parse_temp
+00003350: 6c61 7465 2874 656d 706c 6174 652c 2063  late(template, c
+00003360: 6c65 6172 5f74 6162 5f63 6f6d 706c 6574  lear_tab_complet
+00003370: 696f 6e73 3d63 6c65 6172 5f74 6162 5f63  ions=clear_tab_c
+00003380: 6f6d 706c 6574 696f 6e73 290a 2020 2020  ompletions).    
+00003390: 6173 7365 7274 2069 6e70 7574 203d 3d20  assert input == 
+000033a0: 6222 6865 6c6c 6f5f 5c74 5c6e 220a 2020  b"hello_\t\n".  
+000033b0: 2020 6173 7365 7274 2065 7870 6563 7465    assert expecte
+000033c0: 6420 3d3d 2028 6222 496e 205b 315d 3a20  d == (b"In [1]: 
+000033d0: 6865 6c6c 6f5f 7468 6572 655c 6e67 6f6f  hello_there\ngoo
+000033e0: 6462 7965 2229 0a0a 0a40 7265 7472 790a  dbye")...@retry.
+000033f0: 4070 7974 6573 742e 6d61 726b 2e70 6172  @pytest.mark.par
+00003400: 616d 6574 7269 7a65 2827 636c 6561 725f  ametrize('clear_
+00003410: 7461 625f 636f 6d70 6c65 7469 6f6e 7327  tab_completions'
+00003420: 2c20 5b46 616c 7365 2c20 5472 7565 5d29  , [False, True])
+00003430: 0a64 6566 2074 6573 745f 7365 6c66 7465  .def test_selfte
+00003440: 7374 5f70 6172 7365 5f74 656d 706c 6174  st_parse_templat
+00003450: 655f 7461 625f 636f 6e74 696e 7565 5f31  e_tab_continue_1
+00003460: 2863 6c65 6172 5f74 6162 5f63 6f6d 706c  (clear_tab_compl
+00003470: 6574 696f 6e73 293a 0a20 2020 2074 656d  etions):.    tem
+00003480: 706c 6174 6520 3d20 2222 220a 2020 2020  plate = """.    
+00003490: 2020 2020 496e 205b 315d 3a20 6865 6c6c      In [1]: hell
+000034a0: 6f5c 745f 7468 655c 7830 3672 6528 3329  o\t_the\x06re(3)
+000034b0: 0a20 2020 2020 2020 2067 6f6f 6462 7965  .        goodbye
+000034c0: 0a20 2020 2022 2222 0a20 2020 2069 6e70  .    """.    inp
+000034d0: 7574 2c20 6578 7065 6374 6564 203d 2070  ut, expected = p
+000034e0: 6172 7365 5f74 656d 706c 6174 6528 7465  arse_template(te
+000034f0: 6d70 6c61 7465 290a 2020 2020 6173 7365  mplate).    asse
+00003500: 7274 2069 6e70 7574 203d 3d20 6222 6865  rt input == b"he
+00003510: 6c6c 6f5c 7472 6528 3329 5c6e 220a 2020  llo\tre(3)\n".  
+00003520: 2020 6173 7365 7274 2065 7870 6563 7465    assert expecte
+00003530: 6420 3d3d 2028 6222 496e 205b 315d 3a20  d == (b"In [1]: 
+00003540: 6865 6c6c 6f5f 7468 6572 6528 3329 5c6e  hello_there(3)\n
+00003550: 676f 6f64 6279 6522 290a 0a0a 4072 6574  goodbye")...@ret
+00003560: 7279 0a40 7079 7465 7374 2e6d 6172 6b2e  ry.@pytest.mark.
+00003570: 7061 7261 6d65 7472 697a 6528 2763 6c65  parametrize('cle
+00003580: 6172 5f74 6162 5f63 6f6d 706c 6574 696f  ar_tab_completio
+00003590: 6e73 272c 205b 4661 6c73 652c 2054 7275  ns', [False, Tru
+000035a0: 655d 290a 6465 6620 7465 7374 5f73 656c  e]).def test_sel
+000035b0: 6674 6573 745f 7061 7273 655f 7465 6d70  ftest_parse_temp
+000035c0: 6c61 7465 5f74 6162 5f6c 6f67 5f31 2863  late_tab_log_1(c
+000035d0: 6c65 6172 5f74 6162 5f63 6f6d 706c 6574  lear_tab_complet
+000035e0: 696f 6e73 293a 0a20 2020 2074 656d 706c  ions):.    templ
+000035f0: 6174 6520 3d20 2222 220a 2020 2020 2020  ate = """.      
+00003600: 2020 496e 205b 315d 3a20 6865 6c6c 6f5c    In [1]: hello\
+00003610: 740a 2020 2020 2020 2020 626f 6e6a 6f75  t.        bonjou
+00003620: 720a 2020 2020 2020 2020 496e 205b 315d  r.        In [1]
+00003630: 3a20 6865 6c6c 6f0a 2020 2020 2020 2020  : hello.        
+00003640: 6861 6c6c 6f0a 2020 2020 2020 2020 496e  hallo.        In
+00003650: 205b 315d 3a20 6865 6c6c 6f5f 7468 6572   [1]: hello_ther
+00003660: 6528 3529 0a20 2020 2020 2020 2067 6f6f  e(5).        goo
+00003670: 6462 7965 0a20 2020 2022 2222 0a20 2020  dbye.    """.   
+00003680: 2069 6e70 7574 2c20 6578 7065 6374 6564   input, expected
+00003690: 203d 2070 6172 7365 5f74 656d 706c 6174   = parse_templat
+000036a0: 6528 7465 6d70 6c61 7465 2c20 636c 6561  e(template, clea
+000036b0: 725f 7461 625f 636f 6d70 6c65 7469 6f6e  r_tab_completion
+000036c0: 733d 636c 6561 725f 7461 625f 636f 6d70  s=clear_tab_comp
+000036d0: 6c65 7469 6f6e 7329 0a20 2020 2061 7373  letions).    ass
+000036e0: 6572 7420 696e 7075 7420 3d3d 2062 2268  ert input == b"h
+000036f0: 656c 6c6f 5c74 2835 295c 6e22 0a20 2020  ello\t(5)\n".   
+00003700: 2069 6620 636c 6561 725f 7461 625f 636f   if clear_tab_co
+00003710: 6d70 6c65 7469 6f6e 733a 0a20 2020 2020  mpletions:.     
+00003720: 2020 2061 7373 6572 7420 6578 7065 6374     assert expect
+00003730: 6564 203d 3d20 280a 2020 2020 2020 2020  ed == (.        
+00003740: 2020 2020 6222 5c6e 220a 2020 2020 2020      b"\n".      
+00003750: 2020 2020 2020 6222 626f 6e6a 6f75 725c        b"bonjour\
+00003760: 6e22 0a20 2020 2020 2020 2020 2020 2062  n".            b
+00003770: 2249 6e20 5b31 5d3a 2068 656c 6c6f 5c6e  "In [1]: hello\n
+00003780: 220a 2020 2020 2020 2020 2020 2020 6222  ".            b"
+00003790: 6861 6c6c 6f5c 6e22 0a20 2020 2020 2020  hallo\n".       
+000037a0: 2020 2020 2062 2249 6e20 5b31 5d3a 2068       b"In [1]: h
+000037b0: 656c 6c6f 5f74 6865 7265 2835 295c 6e22  ello_there(5)\n"
+000037c0: 0a20 2020 2020 2020 2020 2020 2062 2267  .            b"g
+000037d0: 6f6f 6462 7965 2229 0a20 2020 2065 6c73  oodbye").    els
+000037e0: 653a 0a20 2020 2020 2020 2061 7373 6572  e:.        asser
+000037f0: 7420 6578 7065 6374 6564 203d 3d20 280a  t expected == (.
+00003800: 2020 2020 2020 2020 2020 2020 6222 496e              b"In
+00003810: 205b 315d 3a20 6865 6c6c 6f5c 6e22 0a20   [1]: hello\n". 
+00003820: 2020 2020 2020 2020 2020 2062 2262 6f6e             b"bon
+00003830: 6a6f 7572 5c6e 220a 2020 2020 2020 2020  jour\n".        
+00003840: 2020 2020 6222 496e 205b 315d 3a20 6865      b"In [1]: he
+00003850: 6c6c 6f5c 6e22 0a20 2020 2020 2020 2020  llo\n".         
+00003860: 2020 2062 2268 616c 6c6f 5c6e 220a 2020     b"hallo\n".  
+00003870: 2020 2020 2020 2020 2020 6222 496e 205b            b"In [
+00003880: 315d 3a20 6865 6c6c 6f5f 7468 6572 6528  1]: hello_there(
+00003890: 3529 5c6e 220a 2020 2020 2020 2020 2020  5)\n".          
+000038a0: 2020 6222 676f 6f64 6279 6522 290a 0a0a    b"goodbye")...
+000038b0: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
+000038c0: 7365 6c66 7465 7374 5f61 7373 6572 745f  selftest_assert_
+000038d0: 6d61 7463 685f 3128 293a 0a20 2020 2065  match_1():.    e
+000038e0: 7870 6563 7465 6420 3d20 6222 2222 0a20  xpected = b""". 
+000038f0: 2020 2020 2020 2068 656c 6c6f 0a20 2020         hello.   
+00003900: 2020 2020 2031 2e2e 2e32 0a20 2020 2020       1...2.     
+00003910: 2020 2067 6f6f 6462 7965 0a20 2020 2020     goodbye.     
+00003920: 2020 202e 2e2e 2e68 656c 6c6f 0a20 2020     ....hello.   
+00003930: 2022 2222 0a20 2020 2072 6573 756c 7420   """.    result 
+00003940: 3d20 6465 6465 6e74 2822 2222 0a0a 2020  = dedent("""..  
+00003950: 2020 2020 6865 6c6c 6f0a 2020 2020 2020      hello.      
+00003960: 3134 3731 3230 3437 3630 320a 2020 2020  14712047602.    
+00003970: 2020 676f 6f64 6279 650a 2020 2020 2020    goodbye.      
+00003980: 4920 646f 6e27 7420 6b6e 6f77 2077 6879  I don't know why
+00003990: 2079 6f75 2073 6179 2067 6f6f 6462 7965   you say goodbye
+000039a0: 0a20 2020 2020 2049 2073 6179 2068 656c  .      I say hel
+000039b0: 6c6f 0a20 2020 2022 2222 292e 656e 636f  lo.    """).enco
+000039c0: 6465 2827 7574 662d 3827 290a 2020 2020  de('utf-8').    
+000039d0: 6173 7365 7274 5f6d 6174 6368 2872 6573  assert_match(res
+000039e0: 756c 742c 2065 7870 6563 7465 6429 0a0a  ult, expected)..
+000039f0: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
+00003a00: 5f73 656c 6674 6573 745f 6173 7365 7274  _selftest_assert
+00003a10: 5f6d 6174 6368 5f32 2829 3a0a 2020 2020  _match_2():.    
+00003a20: 7265 7375 6c74 203d 2062 2222 220a 2020  result = b""".  
+00003a30: 2020 2020 2020 6865 6c6c 6f0a 2020 2020        hello.    
+00003a40: 2020 2020 312e 2e2e 320a 2020 2020 2020      1...2.      
+00003a50: 2020 7468 6572 650a 2020 2020 2222 220a    there.    """.
+00003a60: 2020 2020 6578 7065 6374 6564 203d 2062      expected = b
+00003a70: 2222 220a 0a20 2020 2020 2068 656c 6c6f  """..      hello
+00003a80: 0a20 2020 2020 2031 3437 3132 3034 370a  .      14712047.
+00003a90: 2020 2020 2020 3630 320a 2020 2020 2020        602.      
+00003aa0: 7468 6572 650a 0a20 2020 2022 2222 0a20  there..    """. 
+00003ab0: 2020 2077 6974 6820 6173 7365 7274 5f66     with assert_f
+00003ac0: 6169 6c28 293a 0a20 2020 2020 2020 2061  ail():.        a
+00003ad0: 7373 6572 745f 6d61 7463 6828 7265 7375  ssert_match(resu
+00003ae0: 6c74 2c20 6578 7065 6374 6564 290a 0a0a  lt, expected)...
+00003af0: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
+00003b00: 6c61 7a79 5f69 6d70 6f72 745f 6970 7974  lazy_import_ipyt
+00003b10: 686f 6e5f 3128 293a 0a20 2020 2023 2056  hon_1():.    # V
+00003b20: 6572 6966 7920 7468 6174 2022 696d 706f  erify that "impo
+00003b30: 7274 2070 7966 6c79 6279 2220 646f 6573  rt pyflyby" does
+00003b40: 6e27 7420 696d 706c 7920 2269 6d70 6f72  n't imply "impor
+00003b50: 7420 4950 7974 686f 6e22 2e0a 2020 2020  t IPython"..    
+00003b60: 7079 636d 6420 3d20 2769 6d70 6f72 7420  pycmd = 'import 
+00003b70: 7079 666c 7962 792c 2073 7973 3b20 7379  pyflyby, sys; sy
+00003b80: 732e 6578 6974 2822 4950 7974 686f 6e22  s.exit("IPython"
+00003b90: 2069 6e20 7379 732e 6d6f 6475 6c65 7329   in sys.modules)
+00003ba0: 270a 2020 2020 6368 6563 6b5f 6361 6c6c  '.    check_call
+00003bb0: 285b 2270 7974 686f 6e22 2c20 222d 6322  (["python", "-c"
+00003bc0: 2c20 7079 636d 645d 290a 0a0a 6465 6620  , pycmd])...def 
+00003bd0: 5f70 6172 7365 5f76 6572 7369 6f6e 2876  _parse_version(v
+00003be0: 6572 7369 6f6e 5f73 7472 696e 6729 3a0a  ersion_string):.
+00003bf0: 2020 2020 2222 220a 2020 2020 2020 3e3e      """.      >>
+00003c00: 3e20 5f70 6172 7365 5f76 6572 7369 6f6e  > _parse_version
+00003c10: 2822 312e 322e 3322 290a 2020 2020 2020  ("1.2.3").      
+00003c20: 2831 2c20 322c 2033 290a 0a20 2020 2020  (1, 2, 3)..     
+00003c30: 203e 3e3e 205f 7061 7273 655f 7665 7273   >>> _parse_vers
+00003c40: 696f 6e28 2231 2e32 612e 3362 2229 0a20  ion("1.2a.3b"). 
+00003c50: 2020 2020 2028 312c 2032 2c20 2761 272c       (1, 2, 'a',
+00003c60: 2033 2c20 2762 2729 0a20 2020 2022 2222   3, 'b').    """
+00003c70: 0a20 2020 2072 6573 756c 7420 3d20 5b5d  .    result = []
+00003c80: 0a20 2020 2066 6f72 2070 6172 7420 696e  .    for part in
+00003c90: 2076 6572 7369 6f6e 5f73 7472 696e 672e   version_string.
+00003ca0: 7370 6c69 7428 222e 2229 3a0a 2020 2020  split("."):.    
+00003cb0: 2020 2020 6d20 3d20 7265 2e6d 6174 6368      m = re.match
+00003cc0: 2822 5e28 5b30 2d39 5d2a 2928 2e2a 2924  ("^([0-9]*)(.*)$
+00003cd0: 222c 2070 6172 7429 0a20 2020 2020 2020  ", part).       
+00003ce0: 2069 6620 6d2e 6772 6f75 7028 3129 3a0a   if m.group(1):.
+00003cf0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00003d00: 6c74 2e61 7070 656e 6428 696e 7428 6d2e  lt.append(int(m.
+00003d10: 6772 6f75 7028 3129 2929 0a20 2020 2020  group(1))).     
+00003d20: 2020 2069 6620 6d2e 6772 6f75 7028 3229     if m.group(2)
+00003d30: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00003d40: 7375 6c74 2e61 7070 656e 6428 6d2e 6772  sult.append(m.gr
+00003d50: 6f75 7028 3229 290a 2020 2020 7265 7475  oup(2)).    retu
+00003d60: 726e 2074 7570 6c65 2872 6573 756c 7429  rn tuple(result)
+00003d70: 0a0a 0a74 7279 3a0a 2020 2020 5f49 5059  ...try:.    _IPY
+00003d80: 5448 4f4e 5f56 4552 5349 4f4e 203d 2049  THON_VERSION = I
+00003d90: 5079 7468 6f6e 2e76 6572 7369 6f6e 5f69  Python.version_i
+00003da0: 6e66 6f0a 6578 6365 7074 2041 7474 7269  nfo.except Attri
+00003db0: 6275 7465 4572 726f 723a 0a20 2020 205f  buteError:.    _
+00003dc0: 4950 5954 484f 4e5f 5645 5253 494f 4e20  IPYTHON_VERSION 
+00003dd0: 3d20 5f70 6172 7365 5f76 6572 7369 6f6e  = _parse_version
+00003de0: 2849 5079 7468 6f6e 2e5f 5f76 6572 7369  (IPython.__versi
+00003df0: 6f6e 5f5f 290a 0a23 2050 726f 6d70 7473  on__)..# Prompts
+00003e00: 2074 6861 7420 7765 2065 7870 6563 7420   that we expect 
+00003e10: 666f 722e 0a5f 4950 5954 484f 4e5f 5052  for.._IPYTHON_PR
+00003e20: 4f4d 5054 3120 3d20 6272 225c 6e5c 723f  OMPT1 = br"\n\r?
+00003e30: 496e 205c 5b28 5b30 2d39 5d2b 295c 5d3a  In \[([0-9]+)\]:
+00003e40: 2022 0a5f 4950 5954 484f 4e5f 5052 4f4d   "._IPYTHON_PROM
+00003e50: 5054 3220 3d20 6272 225c 6e5c 723f 2020  PT2 = br"\n\r?  
+00003e60: 205b 2e5d 5b2e 5d5b 2e5d 2b3a 2022 0a5f   [.][.][.]+: "._
+00003e70: 5059 5448 4f4e 5f50 524f 4d50 5420 3d20  PYTHON_PROMPT = 
+00003e80: 6272 223e 3e3e 2022 0a5f 4950 4442 5f50  br">>> "._IPDB_P
+00003e90: 524f 4d50 5420 3d20 6272 225c 6e69 7064  ROMPT = br"\nipd
+00003ea0: 623e 2022 0a5f 4950 5954 484f 4e5f 5052  b> "._IPYTHON_PR
+00003eb0: 4f4d 5054 5320 3d20 5b5f 4950 5954 484f  OMPTS = [_IPYTHO
+00003ec0: 4e5f 5052 4f4d 5054 312c 0a20 2020 2020  N_PROMPT1,.     
+00003ed0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+00003ee0: 4950 5954 484f 4e5f 5052 4f4d 5054 322c  IPYTHON_PROMPT2,
+00003ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003f00: 2020 2020 205f 5059 5448 4f4e 5f50 524f       _PYTHON_PRO
+00003f10: 4d50 542c 0a20 2020 2020 2020 2020 2020  MPT,.           
+00003f20: 2020 2020 2020 2020 205f 4950 4442 5f50           _IPDB_P
+00003f30: 524f 4d50 545d 0a23 2043 7572 7265 6e74  ROMPT].# Current
+00003f40: 6c79 205f 696e 7465 7261 6374 5f69 7079  ly _interact_ipy
+00003f50: 7468 6f6e 2829 2061 7373 756d 6573 2074  thon() assumes t
+00003f60: 6865 2066 6972 7374 2069 7320 2249 6e20  he first is "In 
+00003f70: 5b6e 6e5d 3a22 0a61 7373 6572 7420 6222  [nn]:".assert b"
+00003f80: 496e 2022 2069 6e20 5f49 5059 5448 4f4e  In " in _IPYTHON
+00003f90: 5f50 524f 4d50 5453 5b30 5d0a 0a0a 406d  _PROMPTS[0]...@m
+00003fa0: 656d 6f69 7a65 0a64 6566 205f 6578 7472  emoize.def _extr
+00003fb0: 615f 7265 6164 6c69 6e65 5f70 7974 686f  a_readline_pytho
+00003fc0: 6e70 6174 685f 6469 7273 2829 3a0a 2020  npath_dirs():.  
+00003fd0: 2020 2222 220a 2020 2020 5265 7475 726e    """.    Return
+00003fe0: 2061 2070 6174 6820 746f 2075 7365 2061   a path to use a
+00003ff0: 7320 616e 2065 7874 7261 2050 5954 484f  s an extra PYTHO
+00004000: 4e50 4154 4820 636f 6d70 6f6e 656e 7420  NPATH component 
+00004010: 696e 206f 7264 6572 2074 6f20 6765 7420  in order to get 
+00004020: 474e 550a 2020 2020 7265 6164 6c69 6e65  GNU.    readline
+00004030: 2074 6f20 776f 726b 2e0a 2020 2020 2222   to work..    ""
+00004040: 220a 2020 2020 6966 2073 7973 2e70 6c61  ".    if sys.pla
+00004050: 7466 6f72 6d20 213d 2022 6461 7277 696e  tform != "darwin
+00004060: 223a 0a20 2020 2020 2020 2072 6574 7572  ":.        retur
+00004070: 6e20 2829 0a20 2020 2023 204f 6e20 4461  n ().    # On Da
+00004080: 7277 696e 2c20 7765 206e 6565 6420 6120  rwin, we need a 
+00004090: 6861 636b 2074 6f20 6d61 6b65 2073 7572  hack to make sur
+000040a0: 6520 4950 7974 686f 6e20 6765 7473 2047  e IPython gets G
+000040b0: 4e55 2072 6561 646c 696e 6520 696e 7374  NU readline inst
+000040c0: 6561 640a 2020 2020 2320 6f66 206c 6962  ead.    # of lib
+000040d0: 6564 6974 2e0a 2020 2020 6966 2022 6c69  edit..    if "li
+000040e0: 6265 6469 7422 206e 6f74 2069 6e20 7265  bedit" not in re
+000040f0: 6164 6c69 6e65 2e5f 5f64 6f63 5f5f 3a0a  adline.__doc__:.
+00004100: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+00004110: 290a 2020 2020 6469 7220 3d20 6d6b 6474  ).    dir = mkdt
+00004120: 656d 7028 7072 6566 6978 3d22 7079 666c  emp(prefix="pyfl
+00004130: 7962 795f 222c 2073 7566 6669 783d 222e  yby_", suffix=".
+00004140: 746d 7022 290a 2020 2020 6174 6578 6974  tmp").    atexit
+00004150: 2e72 6567 6973 7465 7228 6c61 6d62 6461  .register(lambda
+00004160: 3a20 726d 7472 6565 2864 6972 2929 0a20  : rmtree(dir)). 
+00004170: 2020 2069 6d70 6f72 7420 7369 7465 0a20     import site. 
+00004180: 2020 2073 6974 6570 6163 6b61 6765 7320     sitepackages 
+00004190: 3d20 6f73 2e70 6174 682e 6a6f 696e 286f  = os.path.join(o
+000041a0: 732e 7061 7468 2e64 6972 6e61 6d65 2873  s.path.dirname(s
+000041b0: 6974 652e 5f5f 6669 6c65 5f5f 292c 2022  ite.__file__), "
+000041c0: 7369 7465 2d70 6163 6b61 6765 7322 290a  site-packages").
+000041d0: 2020 2020 7265 6164 6c69 6e65 5f66 6e20      readline_fn 
+000041e0: 3d20 6f73 2e70 6174 682e 6162 7370 6174  = os.path.abspat
+000041f0: 6828 6f73 2e70 6174 682e 6a6f 696e 2873  h(os.path.join(s
+00004200: 6974 6570 6163 6b61 6765 732c 2022 7265  itepackages, "re
+00004210: 6164 6c69 6e65 2e73 6f22 2929 0a20 2020  adline.so")).   
+00004220: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+00004230: 6973 6669 6c65 2872 6561 646c 696e 655f  isfile(readline_
+00004240: 666e 293a 0a20 2020 2020 2020 2072 6169  fn):.        rai
+00004250: 7365 2056 616c 7565 4572 726f 7228 2243  se ValueError("C
+00004260: 6f75 6c64 6e27 7420 6669 6e64 2072 6561  ouldn't find rea
+00004270: 646c 696e 6522 290a 2020 2020 6f73 2e73  dline").    os.s
+00004280: 796d 6c69 6e6b 2872 6561 646c 696e 655f  ymlink(readline_
+00004290: 666e 2c20 6f73 2e70 6174 682e 6a6f 696e  fn, os.path.join
+000042a0: 2864 6972 2c20 2272 6561 646c 696e 652e  (dir, "readline.
+000042b0: 736f 2229 290a 2020 2020 7265 7475 726e  so")).    return
+000042c0: 2028 6469 722c 290a 0a0a 6465 6620 5f62   (dir,)...def _b
+000042d0: 7569 6c64 5f70 7974 686f 6e70 6174 6828  uild_pythonpath(
+000042e0: 5059 5448 4f4e 5041 5448 293a 0a20 2020  PYTHONPATH):.   
+000042f0: 2022 2222 0a20 2020 2042 7569 6c64 2050   """.    Build P
+00004300: 5954 484f 4e50 4154 4820 7661 6c75 6520  YTHONPATH value 
+00004310: 746f 2075 7365 2e0a 0a20 2020 203a 7274  to use...    :rt
+00004320: 7970 653a 0a20 2020 2020 2060 6073 7472  ype:.      ``str
+00004330: 6060 0a20 2020 2022 2222 0a20 2020 2070  ``.    """.    p
+00004340: 7970 6174 6820 3d20 5b6f 732e 7061 7468  ypath = [os.path
+00004350: 2e64 6972 6e61 6d65 286f 732e 7061 7468  .dirname(os.path
+00004360: 2e64 6972 6e61 6d65 2870 7966 6c79 6279  .dirname(pyflyby
+00004370: 2e5f 5f66 696c 655f 5f29 295d 0a20 2020  .__file__))].   
+00004380: 2069 6620 7379 732e 7665 7273 696f 6e5f   if sys.version_
+00004390: 696e 666f 203c 2028 332c 2039 293a 0a20  info < (3, 9):. 
+000043a0: 2020 2020 2020 2070 7970 6174 6820 2b3d         pypath +=
+000043b0: 205f 6578 7472 615f 7265 6164 6c69 6e65   _extra_readline
+000043c0: 5f70 7974 686f 6e70 6174 685f 6469 7273  _pythonpath_dirs
+000043d0: 2829 0a20 2020 2069 6620 6973 696e 7374  ().    if isinst
+000043e0: 616e 6365 2850 5954 484f 4e50 4154 482c  ance(PYTHONPATH,
+000043f0: 2028 4669 6c65 6e61 6d65 2c20 7369 782e   (Filename, six.
+00004400: 7374 7269 6e67 5f74 7970 6573 2929 3a0a  string_types)):.
+00004410: 2020 2020 2020 2020 5059 5448 4f4e 5041          PYTHONPA
+00004420: 5448 203d 205b 5059 5448 4f4e 5041 5448  TH = [PYTHONPATH
+00004430: 5d0a 2020 2020 5059 5448 4f4e 5041 5448  ].    PYTHONPATH
+00004440: 203d 205b 7374 7228 4669 6c65 6e61 6d65   = [str(Filename
+00004450: 2864 2929 2066 6f72 2064 2069 6e20 5059  (d)) for d in PY
+00004460: 5448 4f4e 5041 5448 5d0a 2020 2020 7079  THONPATH].    py
+00004470: 7061 7468 202b 3d20 5059 5448 4f4e 5041  path += PYTHONPA
+00004480: 5448 0a20 2020 2070 7970 6174 6820 2b3d  TH.    pypath +=
+00004490: 206f 732e 656e 7669 726f 6e5b 2250 5954   os.environ["PYT
+000044a0: 484f 4e50 4154 4822 5d2e 7370 6c69 7428  HONPATH"].split(
+000044b0: 223a 2229 0a20 2020 2072 6574 7572 6e20  ":").    return 
+000044c0: 223a 222e 6a6f 696e 2870 7970 6174 6829  ":".join(pypath)
+000044d0: 0a0a 0a64 6566 205f 696e 6974 5f69 7079  ...def _init_ipy
+000044e0: 7468 6f6e 5f64 6972 2869 7079 7468 6f6e  thon_dir(ipython
+000044f0: 5f64 6972 293a 0a20 2020 2069 7079 7468  _dir):.    ipyth
+00004500: 6f6e 5f64 6972 203d 2046 696c 656e 616d  on_dir = Filenam
+00004510: 6528 6970 7974 686f 6e5f 6469 7229 0a20  e(ipython_dir). 
+00004520: 2020 2069 6620 5f49 5059 5448 4f4e 5f56     if _IPYTHON_V
+00004530: 4552 5349 4f4e 203e 3d20 2830 2c20 3131  ERSION >= (0, 11
+00004540: 293a 0a20 2020 2020 2020 206f 732e 6d61  ):.        os.ma
+00004550: 6b65 6469 7273 2873 7472 2869 7079 7468  kedirs(str(ipyth
+00004560: 6f6e 5f64 6972 2f22 7072 6f66 696c 655f  on_dir/"profile_
+00004570: 6465 6661 756c 7422 2929 0a20 2020 2020  default")).     
+00004580: 2020 206f 732e 6d61 6b65 6469 7273 2873     os.makedirs(s
+00004590: 7472 2869 7079 7468 6f6e 5f64 6972 2f22  tr(ipython_dir/"
+000045a0: 7072 6f66 696c 655f 6465 6661 756c 742f  profile_default/
+000045b0: 7374 6172 7475 7022 2929 0a20 2020 2020  startup")).     
+000045c0: 2020 2069 6620 5f49 5059 5448 4f4e 5f56     if _IPYTHON_V
+000045d0: 4552 5349 4f4e 203e 3d20 2837 2c29 3a0a  ERSION >= (7,):.
+000045e0: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+000045f0: 6574 6578 7428 6970 7974 686f 6e5f 6469  etext(ipython_di
+00004600: 722f 2270 726f 6669 6c65 5f64 6566 6175  r/"profile_defau
+00004610: 6c74 2f69 7079 7468 6f6e 5f63 6f6e 6669  lt/ipython_confi
+00004620: 672e 7079 222c 0a20 2020 2020 2020 2020  g.py",.         
+00004630: 2020 2020 2020 2020 2064 6564 656e 7428           dedent(
+00004640: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+00004650: 2020 2020 2020 6320 3d20 6765 745f 636f        c = get_co
+00004660: 6e66 6967 2829 0a20 2020 2020 2020 2020  nfig().         
+00004670: 2020 2020 2020 2020 2023 2050 726f 6d70           # Promp
+00004680: 742d 746f 6f6c 6b69 7420 322e 3020 7374  t-toolkit 2.0 st
+00004690: 696c 6c20 7072 696e 7473 2073 6f6d 6520  ill prints some 
+000046a0: 6573 6361 7065 2063 6f64 6573 2066 6f72  escape codes for
+000046b0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+000046c0: 2020 2020 2020 2023 2063 6f6d 706c 6574         # complet
+000046d0: 696f 6e20 6469 7370 6c61 7920 6576 656e  ion display even
+000046e0: 2069 6620 7468 6572 6520 6973 206f 6e6c   if there is onl
+000046f0: 7920 6f6e 6520 636f 6d70 6c65 7469 6f6e  y one completion
+00004700: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004710: 2020 2020 632e 5465 726d 696e 616c 496e      c.TerminalIn
+00004720: 7465 7261 6374 6976 6553 6865 6c6c 2e64  teractiveShell.d
+00004730: 6973 706c 6179 5f63 6f6d 706c 6574 696f  isplay_completio
+00004740: 6e73 203d 2022 7265 6164 6c69 6e65 6c69  ns = "readlineli
+00004750: 6b65 220a 2020 2020 2020 2020 2020 2020  ke".            
+00004760: 2020 2020 2020 632e 5465 726d 696e 616c        c.Terminal
+00004770: 496e 7465 7261 6374 6976 6553 6865 6c6c  InteractiveShell
+00004780: 2e63 6f6c 6f72 7320 3d20 274e 6f43 6f6c  .colors = 'NoCol
+00004790: 6f72 270a 2020 2020 2020 2020 2020 2020  or'.            
+000047a0: 2020 2020 2020 2320 4469 7361 626c 6520        # Disable 
+000047b0: 6272 6163 6b65 7420 6869 6768 6c69 6768  bracket highligh
+000047c0: 7469 6e67 2c20 7768 6963 6820 7072 696e  ting, which prin
+000047d0: 7473 2065 7363 6170 6520 636f 6465 7320  ts escape codes 
+000047e0: 7468 6174 2063 6f6e 6675 7365 2074 6865  that confuse the
+000047f0: 2064 6563 6f64 6572 2e0a 2020 2020 2020   decoder..      
+00004800: 2020 2020 2020 2020 2020 2020 632e 5465              c.Te
+00004810: 726d 696e 616c 496e 7465 7261 6374 6976  rminalInteractiv
+00004820: 6553 6865 6c6c 2e68 6967 686c 6967 6874  eShell.highlight
+00004830: 5f6d 6174 6368 696e 675f 6272 6163 6b65  _matching_bracke
+00004840: 7473 203d 2046 616c 7365 0a20 2020 2020  ts = False.     
+00004850: 2020 2020 2020 2020 2020 2020 2022 2222               """
+00004860: 2929 0a20 2020 2020 2020 2020 2020 2077  )).            w
+00004870: 7269 7465 7465 7874 2869 7079 7468 6f6e  ritetext(ipython
+00004880: 5f64 6972 2f22 6a75 7079 7465 725f 636f  _dir/"jupyter_co
+00004890: 6e73 6f6c 655f 636f 6e66 6967 2e70 7922  nsole_config.py"
+000048a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000048b0: 2020 2020 6465 6465 6e74 2822 2222 0a20      dedent(""". 
+000048c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048d0: 2063 203d 2067 6574 5f63 6f6e 6669 6728   c = get_config(
+000048e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000048f0: 2020 2020 2320 4469 7361 626c 6520 6272      # Disable br
+00004900: 6163 6b65 7420 6869 6768 6c69 6768 7469  acket highlighti
+00004910: 6e67 2c20 7768 6963 6820 7072 696e 7473  ng, which prints
+00004920: 2065 7363 6170 6520 636f 6465 7320 7468   escape codes th
+00004930: 6174 2063 6f6e 6675 7365 2074 6865 2064  at confuse the d
+00004940: 6563 6f64 6572 2e0a 2020 2020 2020 2020  ecoder..        
+00004950: 2020 2020 2020 2020 2020 632e 5a4d 5154            c.ZMQT
+00004960: 6572 6d69 6e61 6c49 6e74 6572 6163 7469  erminalInteracti
+00004970: 7665 5368 656c 6c2e 6469 7370 6c61 795f  veShell.display_
+00004980: 636f 6d70 6c65 7469 6f6e 7320 3d20 2272  completions = "r
+00004990: 6561 646c 696e 656c 696b 6522 0a20 2020  eadlinelike".   
+000049a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000049b0: 204e 6f74 2073 7570 706f 7274 6564 2069   Not supported i
+000049c0: 6e20 4a75 7079 7465 7220 636f 6e73 6f6c  n Jupyter consol
+000049d0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000049e0: 2020 2020 2320 632e 5a4d 5154 6572 6d69      # c.ZMQTermi
+000049f0: 6e61 6c49 6e74 6572 6163 7469 7665 5368  nalInteractiveSh
+00004a00: 656c 6c2e 636f 6c6f 7273 203d 2027 4e6f  ell.colors = 'No
+00004a10: 436f 6c6f 7227 0a20 2020 2020 2020 2020  Color'.         
+00004a20: 2020 2020 2020 2020 2023 2050 726f 6d70           # Promp
+00004a30: 742d 746f 6f6c 6b69 7420 322e 3020 7374  t-toolkit 2.0 st
+00004a40: 696c 6c20 7072 696e 7473 2073 6f6d 6520  ill prints some 
+00004a50: 6573 6361 7065 2063 6f64 6573 2066 6f72  escape codes for
+00004a60: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00004a70: 2020 2020 2020 2023 2063 6f6d 706c 6574         # complet
+00004a80: 696f 6e20 6469 7370 6c61 7920 6576 656e  ion display even
+00004a90: 2069 6620 7468 6572 6520 6973 206f 6e6c   if there is onl
+00004aa0: 7920 6f6e 6520 636f 6d70 6c65 7469 6f6e  y one completion
+00004ab0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004ac0: 2020 2020 632e 5a4d 5154 6572 6d69 6e61      c.ZMQTermina
+00004ad0: 6c49 6e74 6572 6163 7469 7665 5368 656c  lInteractiveShel
+00004ae0: 6c2e 6869 6768 6c69 6768 745f 6d61 7463  l.highlight_matc
+00004af0: 6869 6e67 5f62 7261 636b 6574 7320 3d20  hing_brackets = 
+00004b00: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00004b10: 2020 2020 2020 2020 2222 2229 290a 2020          """)).  
+00004b20: 2020 2020 2020 656c 6966 205f 4950 5954        elif _IPYT
+00004b30: 484f 4e5f 5645 5253 494f 4e20 3e3d 2028  HON_VERSION >= (
+00004b40: 352c 293a 0a20 2020 2020 2020 2020 2020  5,):.           
+00004b50: 2077 7269 7465 7465 7874 2869 7079 7468   writetext(ipyth
+00004b60: 6f6e 5f64 6972 2f22 7072 6f66 696c 655f  on_dir/"profile_
+00004b70: 6465 6661 756c 742f 6970 7974 686f 6e5f  default/ipython_
+00004b80: 636f 6e66 6967 2e70 7922 2c0a 2020 2020  config.py",.    
+00004b90: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00004ba0: 6465 6e74 2822 2222 0a20 2020 2020 2020  dent(""".       
+00004bb0: 2020 2020 2020 2020 2020 2063 203d 2067             c = g
+00004bc0: 6574 5f63 6f6e 6669 6728 290a 2020 2020  et_config().    
+00004bd0: 2020 2020 2020 2020 2020 2020 2020 632e                c.
+00004be0: 5465 726d 696e 616c 496e 7465 7261 6374  TerminalInteract
+00004bf0: 6976 6553 6865 6c6c 2e63 6f6c 6f72 7320  iveShell.colors 
+00004c00: 3d20 274e 6f43 6f6c 6f72 270a 2020 2020  = 'NoColor'.    
+00004c10: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00004c20: 5072 6f6d 7074 2d74 6f6f 6c6b 6974 2032  Prompt-toolkit 2
+00004c30: 2e30 2073 7469 6c6c 2070 7269 6e74 7320  .0 still prints 
+00004c40: 736f 6d65 2065 7363 6170 6520 636f 6465  some escape code
+00004c50: 7320 666f 7220 7468 650a 2020 2020 2020  s for the.      
+00004c60: 2020 2020 2020 2020 2020 2020 2320 636f              # co
+00004c70: 6d70 6c65 7469 6f6e 2064 6973 706c 6179  mpletion display
+00004c80: 2065 7665 6e20 6966 2074 6865 7265 2069   even if there i
+00004c90: 7320 6f6e 6c79 206f 6e65 2063 6f6d 706c  s only one compl
+00004ca0: 6574 696f 6e2e 0a20 2020 2020 2020 2020  etion..         
+00004cb0: 2020 2020 2020 2020 2063 2e54 6572 6d69           c.Termi
+00004cc0: 6e61 6c49 6e74 6572 6163 7469 7665 5368  nalInteractiveSh
+00004cd0: 656c 6c2e 6869 6768 6c69 6768 745f 6d61  ell.highlight_ma
+00004ce0: 7463 6869 6e67 5f62 7261 636b 6574 7320  tching_brackets 
+00004cf0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00004d00: 2020 2020 2020 2020 2020 2222 2229 290a            """)).
+00004d10: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00004d20: 2020 2020 2020 2020 2020 7772 6974 6574            writet
+00004d30: 6578 7428 6970 7974 686f 6e5f 6469 722f  ext(ipython_dir/
+00004d40: 2270 726f 6669 6c65 5f64 6566 6175 6c74  "profile_default
+00004d50: 2f69 7079 7468 6f6e 5f63 6f6e 6669 672e  /ipython_config.
+00004d60: 7079 222c 0a20 2020 2020 2020 2020 2020  py",.           
+00004d70: 2020 2020 2020 2022 6320 3d20 6765 745f         "c = get_
+00004d80: 636f 6e66 6967 2829 5c6e 2229 0a20 2020  config()\n").   
+00004d90: 2065 6c69 6620 5f49 5059 5448 4f4e 5f56   elif _IPYTHON_V
+00004da0: 4552 5349 4f4e 203e 3d20 2830 2c20 3130  ERSION >= (0, 10
+00004db0: 293a 0a20 2020 2020 2020 2077 7269 7465  ):.        write
+00004dc0: 7465 7874 2869 7079 7468 6f6e 5f64 6972  text(ipython_dir
+00004dd0: 2f22 6970 7974 686f 6e72 6322 2c20 2222  /"ipythonrc", ""
+00004de0: 220a 2020 2020 2020 2020 2020 2020 7265  ".            re
+00004df0: 6164 6c69 6e65 5f70 6172 7365 5f61 6e64  adline_parse_and
+00004e00: 5f62 696e 6420 7461 623a 2063 6f6d 706c  _bind tab: compl
+00004e10: 6574 650a 2020 2020 2020 2020 2020 2020  ete.            
+00004e20: 7265 6164 6c69 6e65 5f70 6172 7365 5f61  readline_parse_a
+00004e30: 6e64 5f62 696e 6420 7365 7420 7368 6f77  nd_bind set show
+00004e40: 2d61 6c6c 2d69 662d 616d 6269 6775 6f75  -all-if-ambiguou
+00004e50: 7320 6f6e 0a20 2020 2020 2020 2022 2222  s on.        """
+00004e60: 290a 2020 2020 2020 2020 7772 6974 6574  ).        writet
+00004e70: 6578 7428 6970 7974 686f 6e5f 6469 722f  ext(ipython_dir/
+00004e80: 2269 7079 5f75 7365 725f 636f 6e66 2e70  "ipy_user_conf.p
+00004e90: 7922 2c20 2222 290a 0a0a 6465 6620 5f62  y", "")...def _b
+00004ea0: 7569 6c64 5f69 7079 7468 6f6e 5f63 6d64  uild_ipython_cmd
+00004eb0: 2869 7079 7468 6f6e 5f64 6972 2c20 7072  (ipython_dir, pr
+00004ec0: 6f67 3d22 6970 7974 686f 6e22 2c20 6172  og="ipython", ar
+00004ed0: 6773 3d5b 5d2c 2061 7574 6f63 616c 6c3d  gs=[], autocall=
+00004ee0: 4661 6c73 652c 2066 726f 6e74 656e 643d  False, frontend=
+00004ef0: 4e6f 6e65 293a 0a20 2020 2022 2222 0a20  None):.    """. 
+00004f00: 2020 2050 7265 7061 7265 2074 6865 2063     Prepare the c
+00004f10: 6f6d 6d61 6e64 2074 6f20 7275 6e20 4950  ommand to run IP
+00004f20: 7974 686f 6e2e 0a20 2020 2022 2222 0a20  ython..    """. 
+00004f30: 2020 2070 7974 686f 6e20 3d20 7379 732e     python = sys.
+00004f40: 6578 6563 7574 6162 6c65 0a20 2020 2069  executable.    i
+00004f50: 7079 7468 6f6e 5f64 6972 203d 2046 696c  python_dir = Fil
+00004f60: 656e 616d 6528 6970 7974 686f 6e5f 6469  ename(ipython_di
+00004f70: 7229 0a20 2020 2063 6d64 203d 205b 7079  r).    cmd = [py
+00004f80: 7468 6f6e 5d0a 2020 2020 6966 2070 726f  thon].    if pro
+00004f90: 6720 3d3d 2022 6970 7974 686f 6e22 2061  g == "ipython" a
+00004fa0: 6e64 205f 4950 5954 484f 4e5f 5645 5253  nd _IPYTHON_VERS
+00004fb0: 494f 4e20 3e3d 2028 342c 2920 616e 6420  ION >= (4,) and 
+00004fc0: 6172 6773 2061 6e64 2061 7267 735b 305d  args and args[0]
+00004fd0: 2069 6e20 5b22 636f 6e73 6f6c 6522 2c20   in ["console", 
+00004fe0: 226e 6f74 6562 6f6f 6b22 5d3a 0a20 2020  "notebook"]:.   
+00004ff0: 2020 2020 2070 726f 6720 3d20 226a 7570       prog = "jup
+00005000: 7974 6572 220a 2020 2020 6966 2070 726f  yter".    if pro
+00005010: 6720 3d3d 2022 7079 223a 0a20 2020 2020  g == "py":.     
+00005020: 2020 2063 6d64 202b 3d20 5b73 7472 2850     cmd += [str(P
+00005030: 5946 4c59 4259 5f42 494e 202f 2070 726f  YFLYBY_BIN / pro
+00005040: 6729 5d0a 2020 2020 656c 7365 3a0a 2020  g)].    else:.  
+00005050: 2020 2020 2020 2320 4765 7420 7468 6520        # Get the 
+00005060: 7072 6f67 7261 6d20 6672 6f6d 2074 6865  program from the
+00005070: 2070 7974 686f 6e20 7468 6174 2069 7320   python that is 
+00005080: 7275 6e6e 696e 672e 0a20 2020 2020 2020  running..       
+00005090: 2063 6d64 202b 3d20 5b6f 732e 7061 7468   cmd += [os.path
+000050a0: 2e6a 6f69 6e28 6f73 2e70 6174 682e 6469  .join(os.path.di
+000050b0: 726e 616d 6528 7379 732e 6578 6563 7574  rname(sys.execut
+000050c0: 6162 6c65 292c 2070 726f 6729 5d0a 2020  able), prog)].  
+000050d0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000050e0: 6172 6773 2c20 7369 782e 7374 7269 6e67  args, six.string
+000050f0: 5f74 7970 6573 293a 0a20 2020 2020 2020  _types):.       
+00005100: 2061 7267 7320 3d20 5b61 7267 735d 0a20   args = [args]. 
+00005110: 2020 2069 6620 6172 6773 2061 6e64 206e     if args and n
+00005120: 6f74 2061 7267 735b 305d 2e73 7461 7274  ot args[0].start
+00005130: 7377 6974 6828 222d 2229 3a0a 2020 2020  swith("-"):.    
+00005140: 2020 2020 6170 7020 3d20 6172 6773 5b30      app = args[0
+00005150: 5d0a 2020 2020 656c 7365 3a0a 2020 2020  ].    else:.    
+00005160: 2020 2020 6170 7020 3d20 2274 6572 6d69      app = "termi
+00005170: 6e61 6c22 0a20 2020 2063 6d64 202b 3d20  nal".    cmd += 
+00005180: 6c69 7374 2861 7267 7329 0a20 2020 2069  list(args).    i
+00005190: 6620 7072 6f67 203d 3d20 2270 7974 686f  f prog == "pytho
+000051a0: 6e22 3a0a 2020 2020 2020 2020 7265 7475  n":.        retu
+000051b0: 726e 2063 6d64 0a20 2020 2023 2043 6f6e  rn cmd.    # Con
+000051c0: 7374 7275 6374 2049 5079 7468 6f6e 2061  struct IPython a
+000051d0: 7267 756d 656e 7473 2062 6173 6564 206f  rguments based o
+000051e0: 6e20 7665 7273 696f 6e2e 0a20 2020 2069  n version..    i
+000051f0: 6620 5f49 5059 5448 4f4e 5f56 4552 5349  f _IPYTHON_VERSI
+00005200: 4f4e 203e 3d20 2830 2c20 3131 293a 0a20  ON >= (0, 11):. 
+00005210: 2020 2020 2020 206f 7074 203d 206c 616d         opt = lam
+00005220: 6264 6120 6172 673a 2061 7267 0a20 2020  bda arg: arg.   
+00005230: 2065 6c69 6620 5f49 5059 5448 4f4e 5f56   elif _IPYTHON_V
+00005240: 4552 5349 4f4e 203e 3d20 2830 2c20 3130  ERSION >= (0, 10
+00005250: 293a 0a20 2020 2020 2020 2064 6566 206f  ):.        def o
+00005260: 7074 2861 7267 293a 0a20 2020 2020 2020  pt(arg):.       
+00005270: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00005280: 2020 2020 2020 203e 3e3e 206f 7074 2827         >>> opt('
+00005290: 2d2d 666f 6f2d 6261 723d 782d 7927 290a  --foo-bar=x-y').
+000052a0: 2020 2020 2020 2020 2020 2020 2020 272d                '-
+000052b0: 666f 6f5f 6261 723d 782d 7927 0a20 2020  foo_bar=x-y'.   
+000052c0: 2020 2020 2020 2020 2022 2222 0a20 2020           """.   
+000052d0: 2020 2020 2020 2020 206d 203d 2072 652e           m = re.
+000052e0: 6d61 7463 6828 222d 2d28 5b5e 3d5d 2b3f  match("--([^=]+?
+000052f0: 2928 3d2e 2a29 3f24 222c 2061 7267 290a  )(=.*)?$", arg).
+00005300: 2020 2020 2020 2020 2020 2020 6f70 746e              optn
+00005310: 616d 6520 3d20 6d2e 6772 6f75 7028 3129  ame = m.group(1)
+00005320: 0a20 2020 2020 2020 2020 2020 206f 7074  .            opt
+00005330: 7661 6c20 203d 206d 2e67 726f 7570 2832  val  = m.group(2
+00005340: 2920 6f72 2022 220a 2020 2020 2020 2020  ) or "".        
+00005350: 2020 2020 6f70 746e 616d 6520 3d20 7265      optname = re
+00005360: 2e73 7562 2822 5e6e 6f2d 222c 2022 6e6f  .sub("^no-", "no
+00005370: 222c 206f 7074 6e61 6d65 290a 2020 2020  ", optname).    
+00005380: 2020 2020 2020 2020 6f70 746e 616d 6520          optname 
+00005390: 3d20 7265 2e73 7562 2822 2d22 2c20 225f  = re.sub("-", "_
+000053a0: 222c 206f 7074 6e61 6d65 290a 2020 2020  ", optname).    
+000053b0: 2020 2020 2020 2020 6f70 746e 616d 6520          optname 
+000053c0: 3d20 7265 2e73 7562 2822 5e69 7079 7468  = re.sub("^ipyth
+000053d0: 6f6e 5f64 6972 2422 2c20 2269 7079 7468  on_dir$", "ipyth
+000053e0: 6f6e 6469 7222 2c20 6f70 746e 616d 6529  ondir", optname)
+000053f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00005400: 7572 6e20 222d 2573 2573 2220 2520 286f  urn "-%s%s" % (o
+00005410: 7074 6e61 6d65 2c20 6f70 7476 616c 290a  ptname, optval).
+00005420: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00005430: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+00005440: 6d65 6e74 6564 4572 726f 7228 2244 6f6e  mentedError("Don
+00005450: 2774 206b 6e6f 7720 686f 7720 746f 2074  't know how to t
+00005460: 6573 7420 4950 7974 686f 6e20 7665 7273  est IPython vers
+00005470: 696f 6e20 2573 220a 2020 2020 2020 2020  ion %s".        
+00005480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005490: 2020 2020 2020 2020 2020 2520 285f 4950            % (_IP
+000054a0: 5954 484f 4e5f 5645 5253 494f 4e2c 2929  YTHON_VERSION,))
+000054b0: 0a20 2020 2063 6d64 203d 205b 2765 6e76  .    cmd = ['env
+000054c0: 272c 2027 4950 5954 484f 4e44 4952 3d25  ', 'IPYTHONDIR=%
+000054d0: 7327 2025 2028 6970 7974 686f 6e5f 6469  s' % (ipython_di
+000054e0: 722c 292c 2027 4a55 5059 5445 525f 434f  r,), 'JUPYTER_CO
+000054f0: 4e46 4947 5f44 4952 3d25 7327 2025 2028  NFIG_DIR=%s' % (
+00005500: 6970 7974 686f 6e5f 6469 722c 292c 2027  ipython_dir,), '
+00005510: 494e 5055 5452 433d 6e6f 6e65 272c 2027  INPUTRC=none', '
+00005520: 5052 4f4d 5054 5f54 4f4f 4c4b 4954 5f4e  PROMPT_TOOLKIT_N
+00005530: 4f5f 4350 523d 3127 5d20 2b20 636d 640a  O_CPR=1'] + cmd.
+00005540: 2020 2020 6966 2061 7070 203d 3d20 2274      if app == "t
+00005550: 6572 6d69 6e61 6c22 2061 6e64 2070 726f  erminal" and pro
+00005560: 6720 213d 2022 7079 223a 0a20 2020 2020  g != "py":.     
+00005570: 2020 2063 6d64 202b 3d20 5b6f 7074 2822     cmd += [opt("
+00005580: 2d2d 6e6f 2d63 6f6e 6669 726d 2d65 7869  --no-confirm-exi
+00005590: 7422 295d 0a20 2020 2020 2020 2063 6d64  t")].        cmd
+000055a0: 202b 3d20 5b6f 7074 2822 2d2d 6e6f 2d62   += [opt("--no-b
+000055b0: 616e 6e65 7222 295d 0a20 2020 2069 6620  anner")].    if 
+000055c0: 6170 7020 3d3d 2022 636f 6e73 6f6c 6522  app == "console"
+000055d0: 2061 6e64 2070 726f 6720 213d 2022 7079   and prog != "py
+000055e0: 223a 0a20 2020 2020 2020 2063 6d64 202b  ":.        cmd +
+000055f0: 3d20 5b6f 7074 2822 2d2d 6e6f 2d63 6f6e  = [opt("--no-con
+00005600: 6669 726d 2d65 7869 7422 295d 0a20 2020  firm-exit")].   
+00005610: 2020 2020 2069 6620 5f49 5059 5448 4f4e       if _IPYTHON
+00005620: 5f56 4552 5349 4f4e 203c 2028 342c 293a  _VERSION < (4,):
+00005630: 0a20 2020 2020 2020 2020 2020 2063 6d64  .            cmd
+00005640: 202b 3d20 5b6f 7074 2822 2d2d 6e6f 2d62   += [opt("--no-b
+00005650: 616e 6e65 7222 295d 0a20 2020 2069 6620  anner")].    if 
+00005660: 6170 7020 213d 2022 6e6f 7465 626f 6f6b  app != "notebook
+00005670: 2220 616e 6420 7072 6f67 2021 3d20 2270  " and prog != "p
+00005680: 7922 3a0a 2020 2020 2020 2020 636d 6420  y":.        cmd 
+00005690: 2b3d 205b 6f70 7428 222d 2d63 6f6c 6f72  += [opt("--color
+000056a0: 733d 4e6f 436f 6c6f 7222 295d 0a20 2020  s=NoColor")].   
+000056b0: 2069 6620 6672 6f6e 7465 6e64 203d 3d20   if frontend == 
+000056c0: 2770 726f 6d70 745f 746f 6f6c 6b69 7427  'prompt_toolkit'
+000056d0: 2061 6e64 205f 4950 5954 484f 4e5f 5645   and _IPYTHON_VE
+000056e0: 5253 494f 4e20 3c20 2837 2c29 206f 7220  RSION < (7,) or 
+000056f0: 7072 6f67 203d 3d20 2270 7922 3a0a 2020  prog == "py":.  
+00005700: 2020 2020 2020 2320 7072 6f6d 7074 5f74        # prompt_t
+00005710: 6f6f 6c6b 6974 2028 4950 7974 686f 6e20  oolkit (IPython 
+00005720: 3529 2064 6f65 736e 2774 2073 7570 706f  5) doesn't suppo
+00005730: 7274 2074 7572 6e69 6e67 206f 6666 2061  rt turning off a
+00005740: 7574 6f69 6e64 656e 742e 2020 4974 0a20  utoindent.  It. 
+00005750: 2020 2020 2020 2023 2068 6173 2076 6172         # has var
+00005760: 696f 7573 2063 6f6d 6d61 6e64 2d6c 696e  ious command-lin
+00005770: 6520 6f70 7469 6f6e 7320 7768 6963 6820  e options which 
+00005780: 746f 6767 6c65 2074 6865 2069 6e74 6572  toggle the inter
+00005790: 6e61 6c0a 2020 2020 2020 2020 2320 7368  nal.        # sh
+000057a0: 656c 6c2e 6175 746f 696e 6465 6e74 2066  ell.autoindent f
+000057b0: 6c61 672c 2062 7574 2074 7572 6e69 6e67  lag, but turning
+000057c0: 2074 6861 7420 696e 7465 726e 616c 2066   that internal f
+000057d0: 6c61 6720 6f66 6620 646f 6573 6e27 7420  lag off doesn't 
+000057e0: 646f 0a20 2020 2020 2020 2023 2061 6e79  do.        # any
+000057f0: 7468 696e 672e 2020 496e 7374 6561 6420  thing.  Instead 
+00005800: 7765 276c 6c20 6a75 7374 2068 6176 6520  we'll just have 
+00005810: 746f 2073 656e 6420 6120 5e55 2061 7420  to send a ^U at 
+00005820: 7468 6520 6265 6769 6e6e 696e 6720 6f66  the beginning of
+00005830: 0a20 2020 2020 2020 2023 2065 6163 6820  .        # each 
+00005840: 6c69 6e65 2074 6f20 6465 6665 6174 2074  line to defeat t
+00005850: 6865 2061 7574 6f69 6e64 656e 742e 2054  he autoindent. T
+00005860: 6865 2066 6561 7475 7265 2077 6173 2072  he feature was r
+00005870: 652d 656e 6162 6c65 6420 696e 0a20 2020  e-enabled in.   
+00005880: 2020 2020 2023 2049 5079 7468 6f6e 2037       # IPython 7
+00005890: 2c20 736f 2077 6520 646f 6e27 7420 6e65  , so we don't ne
+000058a0: 6564 2074 6f20 776f 7272 7920 7468 6572  ed to worry ther
+000058b0: 652e 0a20 2020 2020 2020 2070 6173 730a  e..        pass.
+000058c0: 2020 2020 656c 6966 205f 4950 5954 484f      elif _IPYTHO
+000058d0: 4e5f 5645 5253 494f 4e20 3e3d 2028 332c  N_VERSION >= (3,
+000058e0: 293a 0a20 2020 2020 2020 2063 6d64 202b  ):.        cmd +
+000058f0: 3d20 5b22 2d2d 496e 7465 7261 6374 6976  = ["--Interactiv
+00005900: 6553 6865 6c6c 2e61 7574 6f69 6e64 656e  eShell.autoinden
+00005910: 743d 4661 6c73 6522 5d0a 2020 2020 656c  t=False"].    el
+00005920: 7365 3a0a 2020 2020 2020 2020 636d 6420  se:.        cmd 
+00005930: 2b3d 205b 6f70 7428 222d 2d6e 6f2d 6175  += [opt("--no-au
+00005940: 746f 696e 6465 6e74 2229 5d0a 2020 2020  toindent")].    
+00005950: 6966 2061 7574 6f63 616c 6c3a 0a20 2020  if autocall:.   
+00005960: 2020 2020 2069 6620 5f49 5059 5448 4f4e       if _IPYTHON
+00005970: 5f56 4552 5349 4f4e 203e 3d20 2833 2c30  _VERSION >= (3,0
+00005980: 293a 0a20 2020 2020 2020 2020 2020 2063  ):.            c
 00005990: 6d64 202b 3d20 5b22 2d2d 496e 7465 7261  md += ["--Intera
-000059a0: 6374 6976 6553 6865 6c6c 2e61 7574 6f69  ctiveShell.autoi
-000059b0: 6e64 656e 743d 4661 6c73 6522 5d0a 2020  ndent=False"].  
-000059c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000059d0: 636d 6420 2b3d 205b 6f70 7428 222d 2d6e  cmd += [opt("--n
-000059e0: 6f2d 6175 746f 696e 6465 6e74 2229 5d0a  o-autoindent")].
-000059f0: 2020 2020 6966 2061 7574 6f63 616c 6c3a      if autocall:
-00005a00: 0a20 2020 2020 2020 2069 6620 5f49 5059  .        if _IPY
-00005a10: 5448 4f4e 5f56 4552 5349 4f4e 203e 3d20  THON_VERSION >= 
-00005a20: 2833 2c30 293a 0a20 2020 2020 2020 2020  (3,0):.         
-00005a30: 2020 2063 6d64 202b 3d20 5b22 2d2d 496e     cmd += ["--In
-00005a40: 7465 7261 6374 6976 6553 6865 6c6c 2e61  teractiveShell.a
-00005a50: 7574 6f63 616c 6c3d 5472 7565 225d 0a20  utocall=True"]. 
-00005a60: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00005a70: 2020 2020 2020 2020 2063 6d64 202b 3d20           cmd += 
-00005a80: 5b6f 7074 2822 2d2d 6175 746f 6361 6c6c  [opt("--autocall
-00005a90: 3d31 2229 5d0a 2020 2020 6966 2066 726f  =1")].    if fro
-00005aa0: 6e74 656e 6420 3d3d 2027 7265 6164 6c69  ntend == 'readli
-00005ab0: 6e65 273a 0a20 2020 2020 2020 2069 6620  ne':.        if 
-00005ac0: 5f49 5059 5448 4f4e 5f56 4552 5349 4f4e  _IPYTHON_VERSION
-00005ad0: 203e 3d20 2835 2c34 293a 0a20 2020 2020   >= (5,4):.     
-00005ae0: 2020 2020 2020 2063 6d64 202b 3d20 5b22         cmd += ["
-00005af0: 2d2d 5465 726d 696e 616c 4950 7974 686f  --TerminalIPytho
-00005b00: 6e41 7070 2e69 6e74 6572 6163 7469 7665  nApp.interactive
-00005b10: 5f73 6865 6c6c 5f63 6c61 7373 3d72 6c69  _shell_class=rli
-00005b20: 7079 7468 6f6e 2e54 6572 6d69 6e61 6c49  python.TerminalI
-00005b30: 6e74 6572 6163 7469 7665 5368 656c 6c22  nteractiveShell"
-00005b40: 5d0a 2020 2020 2020 2020 656c 6966 205f  ].        elif _
-00005b50: 4950 5954 484f 4e5f 5645 5253 494f 4e20  IPYTHON_VERSION 
-00005b60: 3e3d 2028 352c 3029 3a0a 2020 2020 2020  >= (5,0):.      
-00005b70: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00005b80: 6545 7272 6f72 2822 4950 7974 686f 6e20  eError("IPython 
-00005b90: 352e 3020 7468 726f 7567 6820 352e 3320  5.0 through 5.3 
-00005ba0: 6f6e 6c79 2073 7570 706f 7274 2070 726f  only support pro
-00005bb0: 6d70 745f 746f 6f6c 6b69 7422 290a 2020  mpt_toolkit").  
-00005bc0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00005bd0: 2020 2020 2020 2020 2320 466f 7220 4950          # For IP
-00005be0: 7974 686f 6e20 3420 616e 6420 6561 726c  ython 4 and earl
-00005bf0: 6965 722c 2072 6561 646c 696e 6520 6973  ier, readline is
-00005c00: 2074 6865 2064 6566 6175 6c74 2061 6e64   the default and
-00005c10: 206f 6e6c 7920 6f70 7469 6f6e 2e0a 2020   only option..  
-00005c20: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
-00005c30: 2020 2065 6c69 6620 6672 6f6e 7465 6e64     elif frontend
-00005c40: 203d 3d20 2770 726f 6d70 745f 746f 6f6c   == 'prompt_tool
-00005c50: 6b69 7427 3a0a 2020 2020 2020 2020 6966  kit':.        if
-00005c60: 205f 4950 5954 484f 4e5f 5645 5253 494f   _IPYTHON_VERSIO
-00005c70: 4e20 3e3d 2028 352c 293a 0a20 2020 2020  N >= (5,):.     
-00005c80: 2020 2020 2020 2023 2046 6f72 2049 5079         # For IPy
-00005c90: 7468 6f6e 203e 3d20 352e 302c 2070 726f  thon >= 5.0, pro
-00005ca0: 6d70 745f 746f 6f6c 6b69 7420 6973 2074  mpt_toolkit is t
-00005cb0: 6865 2064 6566 6175 6c74 206f 7074 696f  he default optio
-00005cc0: 6e20 2861 6e64 0a20 2020 2020 2020 2020  n (and.         
-00005cd0: 2020 2023 2066 6f72 2035 2e30 2d35 2e33     # for 5.0-5.3
-00005ce0: 2c20 7468 6520 6f6e 6c79 206f 7074 696f  , the only optio
-00005cf0: 6e29 2e0a 2020 2020 2020 2020 2020 2020  n)..            
-00005d00: 7061 7373 0a20 2020 2020 2020 2065 6c73  pass.        els
-00005d10: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00005d20: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00005d30: 2249 5079 7468 6f6e 2034 2061 6e64 2065  "IPython 4 and e
-00005d40: 6172 6c69 6572 206f 6e6c 7920 7375 7070  arlier only supp
-00005d50: 6f72 7420 7265 6164 6c69 6e65 2229 0a20  ort readline"). 
-00005d60: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00005d70: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00005d80: 7228 2262 6164 2066 726f 6e74 656e 643d  r("bad frontend=
-00005d90: 2572 2220 2520 2866 726f 6e74 656e 642c  %r" % (frontend,
-00005da0: 2929 0a20 2020 2072 6574 7572 6e20 636d  )).    return cm
-00005db0: 640a 0a0a 5059 464c 5942 595f 484f 4d45  d...PYFLYBY_HOME
-00005dc0: 203d 2046 696c 656e 616d 6528 5f5f 6669   = Filename(__fi
-00005dd0: 6c65 5f5f 292e 7265 616c 2e64 6972 2e64  le__).real.dir.d
-00005de0: 6972 0a50 5946 4c59 4259 5f50 4154 4820  ir.PYFLYBY_PATH 
-00005df0: 3d20 5059 464c 5942 595f 484f 4d45 202f  = PYFLYBY_HOME /
-00005e00: 2022 6574 632f 7079 666c 7962 7922 0a50   "etc/pyflyby".P
-00005e10: 5946 4c59 4259 5f42 494e 203d 2050 5946  YFLYBY_BIN = PYF
-00005e20: 4c59 4259 5f48 4f4d 4520 2f20 2262 696e  LYBY_HOME / "bin
-00005e30: 220a 0a63 6c61 7373 2041 6e73 6946 696c  "..class AnsiFil
-00005e40: 7465 7244 6563 6f64 6572 286f 626a 6563  terDecoder(objec
-00005e50: 7429 3a0a 0a20 2020 2064 6566 205f 5f69  t):..    def __i
-00005e60: 6e69 745f 5f28 7365 6c66 293a 0a20 2020  nit__(self):.   
-00005e70: 2020 2020 2073 656c 662e 5f62 7566 6665       self._buffe
-00005e80: 7220 3d20 6222 220a 0a20 2020 2064 6566  r = b""..    def
-00005e90: 2064 6563 6f64 6528 7365 6c66 2c20 6172   decode(self, ar
-00005ea0: 672c 2066 696e 616c 3d46 616c 7365 293a  g, final=False):
-00005eb0: 0a20 2020 2020 2020 2061 7267 3020 3d20  .        arg0 = 
-00005ec0: 6172 6720 3d20 7365 6c66 2e5f 6275 6666  arg = self._buff
-00005ed0: 6572 202b 2061 7267 0a20 2020 2020 2020  er + arg.       
-00005ee0: 2073 656c 662e 5f62 7566 6665 7220 3d20   self._buffer = 
-00005ef0: 6222 220a 2020 2020 2020 2020 6172 6720  b"".        arg 
-00005f00: 3d20 7265 2e73 7562 2862 225c 722b 5c6e  = re.sub(b"\r+\n
-00005f10: 222c 2062 225c 6e22 2c20 6172 6729 0a20  ", b"\n", arg). 
-00005f20: 2020 2020 2020 2061 7267 203d 2061 7267         arg = arg
-00005f30: 2e72 6570 6c61 6365 2862 225c 7831 625b  .replace(b"\x1b[
-00005f40: 4a22 2c20 6222 2229 2020 2020 2020 2020  J", b"")        
-00005f50: 2020 2020 2023 2063 6c65 6172 2074 6f20       # clear to 
-00005f60: 656e 6420 6f66 2064 6973 706c 6179 0a20  end of display. 
-00005f70: 2020 2020 2020 2061 7267 203d 2072 652e         arg = re.
-00005f80: 7375 6228 6272 225c 7831 625c 5b5b 302d  sub(br"\x1b\[[0-
-00005f90: 395d 2b28 3f3a 3b5b 302d 395d 2b29 2a6d  9]+(?:;[0-9]+)*m
-00005fa0: 222c 2062 2222 2c20 6172 6729 2023 2063  ", b"", arg) # c
-00005fb0: 6f6c 6f72 0a20 2020 2020 2020 2061 7267  olor.        arg
-00005fc0: 203d 2061 7267 2e72 6570 6c61 6365 2862   = arg.replace(b
-00005fd0: 225c 7831 625b 366e 222c 2062 2222 2920  "\x1b[6n", b"") 
-00005fe0: 2020 2020 2020 2020 2020 2023 2071 7565             # que
-00005ff0: 7279 2063 7572 736f 7220 706f 7369 7469  ry cursor positi
-00006000: 6f6e 0a20 2020 2020 2020 2061 7267 203d  on.        arg =
-00006010: 2061 7267 2e72 6570 6c61 6365 2862 225c   arg.replace(b"\
-00006020: 7831 625b 3f31 6c22 2c20 6222 2229 2020  x1b[?1l", b"")  
-00006030: 2020 2020 2020 2020 2023 206e 6f72 6d61           # norma
-00006040: 6c20 6375 7273 6f72 206b 6579 730a 2020  l cursor keys.  
-00006050: 2020 2020 2020 6172 6720 3d20 6172 672e        arg = arg.
-00006060: 7265 706c 6163 6528 6222 5c78 3162 5b3f  replace(b"\x1b[?
-00006070: 376c 222c 2062 2222 2920 2020 2020 2020  7l", b"")       
-00006080: 2020 2020 2320 6e6f 2077 7261 7061 726f      # no wraparo
-00006090: 756e 6420 6d6f 6465 0a20 2020 2020 2020  und mode.       
-000060a0: 2061 7267 203d 2061 7267 2e72 6570 6c61   arg = arg.repla
-000060b0: 6365 2862 225c 7831 625b 3f31 326c 222c  ce(b"\x1b[?12l",
-000060c0: 2062 2222 2920 2020 2020 2020 2020 2023   b"")          #
-000060d0: 2073 746f 7020 626c 696e 6b69 6e67 2063   stop blinking c
-000060e0: 7572 736f 720a 2020 2020 2020 2020 6172  ursor.        ar
-000060f0: 6720 3d20 6172 672e 7265 706c 6163 6528  g = arg.replace(
-00006100: 6222 5c78 3162 5b3f 3235 6c22 2c20 6222  b"\x1b[?25l", b"
-00006110: 2229 2020 2020 2020 2020 2020 2320 6869  ")          # hi
-00006120: 6465 2063 7572 736f 720a 2020 2020 2020  de cursor.      
-00006130: 2020 6172 6720 3d20 6172 672e 7265 706c    arg = arg.repl
-00006140: 6163 6528 6222 5c78 3162 5b3f 3230 3034  ace(b"\x1b[?2004
-00006150: 6c22 2c20 6222 2229 2020 2020 2020 2020  l", b"")        
-00006160: 2320 6e6f 2062 7261 636b 6574 6564 2070  # no bracketed p
-00006170: 6173 7465 206d 6f64 650a 2020 2020 2020  aste mode.      
-00006180: 2020 6172 6720 3d20 6172 672e 7265 706c    arg = arg.repl
-00006190: 6163 6528 6222 5c78 3162 5b3f 3768 222c  ace(b"\x1b[?7h",
-000061a0: 2062 2222 2920 2020 2020 2020 2020 2020   b"")           
-000061b0: 2320 7772 6170 6172 6f75 6e64 206d 6f64  # wraparound mod
-000061c0: 650a 2020 2020 2020 2020 6172 6720 3d20  e.        arg = 
-000061d0: 6172 672e 7265 706c 6163 6528 6222 5c78  arg.replace(b"\x
-000061e0: 3162 5b3f 3235 6822 2c20 6222 2229 2020  1b[?25h", b"")  
-000061f0: 2020 2020 2020 2020 2320 7368 6f77 2063          # show c
-00006200: 7572 736f 720a 2020 2020 2020 2020 6172  ursor.        ar
-00006210: 6720 3d20 6172 672e 7265 706c 6163 6528  g = arg.replace(
-00006220: 6222 5c78 3162 5b32 333b 3074 222c 2062  b"\x1b[23;0t", b
-00006230: 2222 2920 2020 2020 2020 2020 2023 2072  "")          # r
-00006240: 6573 746f 7265 2077 696e 646f 7720 7469  estore window ti
-00006250: 746c 650a 2020 2020 2020 2020 6172 6720  tle.        arg 
-00006260: 3d20 6172 672e 7265 706c 6163 6528 6222  = arg.replace(b"
-00006270: 5c78 3162 5b3f 3230 3034 6822 2c20 6222  \x1b[?2004h", b"
-00006280: 2229 2020 2020 2020 2020 2320 6272 6163  ")        # brac
-00006290: 6b65 7465 6420 7061 7374 6520 6d6f 6465  keted paste mode
-000062a0: 0a20 2020 2020 2020 2061 7267 203d 2061  .        arg = a
-000062b0: 7267 2e72 6570 6c61 6365 2862 275c 7831  rg.replace(b'\x1
-000062c0: 625b 3f35 685c 7831 625b 3f35 6c27 2c20  b[?5h\x1b[?5l', 
-000062d0: 6227 2729 2020 2023 2076 6973 7561 6c20  b'')   # visual 
-000062e0: 6265 6c6c 0a20 2020 2020 2020 2061 7267  bell.        arg
-000062f0: 203d 2072 652e 7375 6228 6272 225c 7831   = re.sub(br"\x1
-00006300: 625c 5b28 5b30 2d39 5d2b 2944 5c78 3162  b\[([0-9]+)D\x1b
-00006310: 5c5b 5c31 4322 2c20 6222 222c 2061 7267  \[\1C", b"", arg
-00006320: 2920 2320 6c65 6674 382c 7269 6768 7438  ) # left8,right8
-00006330: 206e 6f2d 6f70 2028 7372 736c 793f 290a   no-op (srsly?).
-00006340: 2020 2020 2020 2020 6172 6720 3d20 6172          arg = ar
-00006350: 672e 7265 706c 6163 6528 6227 5c78 3162  g.replace(b'\x1b
-00006360: 5b3f 3130 3334 6827 2c20 6227 2729 2020  [?1034h', b'')  
-00006370: 2020 2020 2020 2320 6d65 7461 206b 6579        # meta key
-00006380: 0a20 2020 2020 2020 2061 7267 203d 2061  .        arg = a
-00006390: 7267 2e72 6570 6c61 6365 2862 275c 7831  rg.replace(b'\x1
-000063a0: 623e 272c 2062 2727 2920 2020 2020 2020  b>', b'')       
-000063b0: 2020 2020 2020 2023 206b 6579 7061 6420         # keypad 
-000063c0: 6e75 6d65 7269 6320 6d6f 6465 2028 3f3f  numeric mode (??
-000063d0: 3f29 0a20 2020 2020 2020 2061 7267 203d  ?).        arg =
-000063e0: 2061 7267 2e72 6570 6c61 6365 2862 273f   arg.replace(b'?
-000063f0: 5b33 336d 272c 2062 2727 2920 2020 2020  [33m', b'')     
-00006400: 2020 2020 2020 2020 2023 2028 3f3f 3f29           # (???)
-00006410: 0a20 2020 2020 2020 2061 7267 203d 2061  .        arg = a
-00006420: 7267 2e72 6570 6c61 6365 2862 273f 5b30  rg.replace(b'?[0
-00006430: 6d27 2c20 6227 2729 2020 2020 2020 2020  m', b'')        
-00006440: 2020 2020 2020 2320 283f 3f3f 290a 0a20        # (???).. 
-00006450: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00006460: 2320 6375 7273 6f72 206d 6f76 656d 656e  # cursor movemen
-00006470: 7420 6f6e 2050 544b 2033 2e30 2e36 2b20  t on PTK 3.0.6+ 
-00006480: 636f 6d70 7574 6520 7468 6520 6e75 6d62  compute the numb
-00006490: 6572 206f 6620 6261 636b 2061 6e64 2066  er of back and f
-000064a0: 6f72 7468 2061 6e64 0a20 2020 2020 2020  orth and.       
-000064b0: 2023 2069 6e73 6572 7420 7468 6174 206d   # insert that m
-000064c0: 616e 7920 7370 6163 6573 2e0a 2020 2020  any spaces..    
-000064d0: 2020 2020 7061 7420 3d20 6272 225c 7831      pat = br"\x1
-000064e0: 625c 5b28 5c64 2b29 445c 7831 625c 5b28  b\[(\d+)D\x1b\[(
-000064f0: 5c64 2b29 4322 0a20 2020 2020 2020 206d  \d+)C".        m
-00006500: 6174 6368 203d 2072 652e 7365 6172 6368  atch = re.search
-00006510: 2870 6174 2c20 6172 6729 0a0a 2020 2020  (pat, arg)..    
-00006520: 2020 2020 7768 696c 6520 6d61 7463 683a      while match:
-00006530: 0a20 2020 2020 2020 2020 2020 2062 6163  .            bac
-00006540: 6b77 6172 642c 2066 6f72 7761 7264 203d  kward, forward =
-00006550: 206d 6174 6368 2e67 726f 7570 7328 290a   match.groups().
-00006560: 2020 2020 2020 2020 2020 2020 6261 636b              back
-00006570: 7761 7264 2c20 666f 7277 6172 6420 3d20  ward, forward = 
-00006580: 696e 7428 6261 636b 7761 7264 292c 2069  int(backward), i
-00006590: 6e74 2866 6f72 7761 7264 290a 2020 2020  nt(forward).    
-000065a0: 2020 2020 2020 2020 6e5f 7370 6163 6573          n_spaces
-000065b0: 203d 2066 6f72 7761 7264 202d 2062 6163   = forward - bac
-000065c0: 6b77 6172 640a 2020 2020 2020 2020 2020  kward.          
-000065d0: 2020 7374 6172 742c 2073 746f 7020 3d20    start, stop = 
-000065e0: 6d61 7463 682e 7374 6172 7428 292c 206d  match.start(), m
-000065f0: 6174 6368 2e65 6e64 2829 0a20 2020 2020  atch.end().     
-00006600: 2020 2020 2020 2061 7267 203d 2061 7267         arg = arg
-00006610: 5b3a 7374 6172 745d 2b6e 5f73 7061 6365  [:start]+n_space
-00006620: 732a 6227 2027 2b61 7267 5b73 746f 703a  s*b' '+arg[stop:
-00006630: 5d0a 2020 2020 2020 2020 2020 2020 6d61  ].            ma
-00006640: 7463 6820 3d20 7265 2e73 6561 7263 6828  tch = re.search(
-00006650: 7061 742c 2061 7267 290a 0a0a 0a20 2020  pat, arg)....   
-00006660: 2020 2020 2061 7267 203d 2072 652e 7375       arg = re.su
-00006670: 6228 6272 225c 6e5c 7831 625c 5b5b 302d  b(br"\n\x1b\[[0-
-00006680: 395d 2a43 222c 2062 2222 2c20 6172 6729  9]*C", b"", arg)
-00006690: 2023 206d 6f76 6520 6375 7273 6f72 2072   # move cursor r
-000066a0: 6967 6874 2069 6d6d 6564 6961 7465 6c79  ight immediately
-000066b0: 2061 6674 6572 2061 206e 6577 6c69 6e65   after a newline
-000066c0: 0a20 2020 2020 2020 2023 2043 7572 736f  .        # Curso
-000066d0: 7220 6d6f 7665 6d65 6e74 2e20 5765 2061  r movement. We a
-000066e0: 7373 756d 6520 7468 6973 2069 7320 7573  ssume this is us
-000066f0: 6564 206f 6e6c 7920 666f 7220 706c 6163  ed only for plac
-00006700: 6573 2074 6861 7420 6861 7665 2027 2e2e  es that have '..
-00006710: 2e27 0a20 2020 2020 2020 2023 2069 6e20  .'.        # in 
-00006720: 7468 6520 7465 7374 732e 0a20 2020 2020  the tests..     
-00006730: 2020 2023 2061 7267 203d 2072 652e 7375     # arg = re.su
-00006740: 6228 6222 5c5c 5c78 3162 5c5c 5b5c 5c3f  b(b"\\\x1b\\[\\?
-00006750: 3130 3439 682e 2a5c 5c5c 7831 625c 5c5b  1049h.*\\\x1b\\[
-00006760: 5c5c 3f31 3034 396c 222c 2062 2222 2c20  \\?1049l", b"", 
-00006770: 6172 6729 0a0a 2020 2020 2020 2020 2320  arg)..        # 
-00006780: 4173 7375 6d65 2045 5343 5b35 4461 6263  Assume ESC[5Dabc
-00006790: 645c 6e20 6973 2072 6577 7269 7469 6e67  d\n is rewriting
-000067a0: 2070 7265 7669 6f75 7320 7465 7874 3b20   previous text; 
-000067b0: 6465 6c65 7465 2069 742e 204f 6e6c 7920  delete it. Only 
-000067c0: 646f 0a20 2020 2020 2020 2023 2073 6f20  do.        # so 
-000067d0: 6966 2074 6865 206c 696e 6520 646f 6573  if the line does
-000067e0: 204e 4f54 2068 6176 6520 275b 5059 464c   NOT have '[PYFL
-000067f0: 5942 595d 2720 6f72 2061 2043 5052 2072  YBY]' or a CPR r
-00006800: 6571 7565 7374 2077 6172 6e69 6e67 2e0a  equest warning..
-00006810: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
-00006820: 6669 6e64 2061 206c 6573 7320 6861 636b  find a less hack
-00006830: 7920 7761 7920 746f 2068 616e 646c 6520  y way to handle 
-00006840: 7468 6973 2077 6974 686f 7574 2068 6172  this without har
-00006850: 6463 6f64 696e 670a 2020 2020 2020 2020  dcoding.        
-00006860: 2320 275b 5059 464c 5942 595d 272e 0a20  # '[PYFLYBY]'.. 
-00006870: 2020 2020 2020 206c 6566 7420 3d20 6222         left = b"
-00006880: 220a 2020 2020 2020 2020 7269 6768 7420  ".        right 
-00006890: 3d20 6172 670a 2020 2020 2020 2020 7768  = arg.        wh
-000068a0: 696c 6520 7269 6768 743a 0a20 2020 2020  ile right:.     
-000068b0: 2020 2020 2020 206d 203d 2072 652e 7365         m = re.se
-000068c0: 6172 6368 2862 7222 5c78 3162 5c5b 5b30  arch(br"\x1b\[[0
-000068d0: 2d39 5d2b 442e 2a3f 5c6e 222c 2072 6967  -9]+D.*?\n", rig
-000068e0: 6874 290a 2020 2020 2020 2020 2020 2020  ht).            
-000068f0: 6966 206e 6f74 206d 3a0a 2020 2020 2020  if not m:.      
-00006900: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00006910: 2020 2020 2020 2020 2020 2020 6966 2062              if b
-00006920: 275b 5059 464c 5942 595d 2720 696e 206d  '[PYFLYBY]' in m
-00006930: 2e67 726f 7570 2829 206f 7220 6227 5741  .group() or b'WA
-00006940: 524e 494e 4727 2069 6e20 6d2e 6772 6f75  RNING' in m.grou
-00006950: 7028 293a 0a20 2020 2020 2020 2020 2020  p():.           
-00006960: 2020 2020 206c 6566 7420 2b3d 2072 6967       left += rig
-00006970: 6874 5b3a 6d2e 656e 6428 295d 0a20 2020  ht[:m.end()].   
-00006980: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00006990: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000069a0: 6566 7420 2b3d 2072 6967 6874 5b3a 6d2e  eft += right[:m.
-000069b0: 7374 6172 7428 295d 202b 2062 275c 6e27  start()] + b'\n'
-000069c0: 0a20 2020 2020 2020 2020 2020 2072 6967  .            rig
-000069d0: 6874 203d 2072 6967 6874 5b6d 2e65 6e64  ht = right[m.end
-000069e0: 2829 3a5d 0a20 2020 2020 2020 2061 7267  ():].        arg
-000069f0: 203d 206c 6566 7420 2b20 7269 6768 740a   = left + right.
-00006a00: 2020 2020 2020 2020 2320 4173 7375 6d65          # Assume
-00006a10: 2045 5343 5b33 415c 6e6c 696e 6531 5c6e   ESC[3A\nline1\n
-00006a20: 6c69 6e65 325c 6e6c 696e 6533 5c6e 2069  line2\nline3\n i
-00006a30: 7320 7265 7772 6974 696e 6720 7072 6576  s rewriting prev
-00006a40: 696f 7573 2074 6578 743b 0a20 2020 2020  ious text;.     
-00006a50: 2020 2023 2064 656c 6574 6520 6974 2e0a     # delete it..
-00006a60: 2020 2020 2020 2020 6c65 6674 203d 2062          left = b
-00006a70: 2222 0a20 2020 2020 2020 2072 6967 6874  "".        right
-00006a80: 203d 2061 7267 0a20 2020 2020 2020 2077   = arg.        w
-00006a90: 6869 6c65 2072 6967 6874 3a0a 2020 2020  hile right:.    
-00006aa0: 2020 2020 2020 2020 6d20 3d20 7265 2e73          m = re.s
-00006ab0: 6561 7263 6828 6272 225c 7831 625c 5b28  earch(br"\x1b\[(
-00006ac0: 5b30 2d39 5d2b 2941 5c6e 222c 2072 6967  [0-9]+)A\n", rig
-00006ad0: 6874 290a 2020 2020 2020 2020 2020 2020  ht).            
-00006ae0: 6966 206e 6f74 206d 3a0a 2020 2020 2020  if not m:.      
-00006af0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00006b00: 2020 2020 2020 2020 2020 2020 6e75 6d20              num 
-00006b10: 3d20 696e 7428 6d2e 6772 6f75 7028 3129  = int(m.group(1)
-00006b20: 290a 2020 2020 2020 2020 2020 2020 656e  ).            en
-00006b30: 6420 3d20 6d2e 656e 6428 290a 2020 2020  d = m.end().    
-00006b40: 2020 2020 2020 2020 7375 6666 6978 203d          suffix =
-00006b50: 2072 6967 6874 5b65 6e64 3a5d 0a20 2020   right[end:].   
-00006b60: 2020 2020 2020 2020 2023 2073 706c 6974           # split
-00006b70: 6c69 6e65 7320 696e 636c 7564 6573 205c  lines includes \
-00006b80: 7220 6173 2061 206c 696e 6520 6465 6c69  r as a line deli
-00006b90: 6d69 7465 722c 2077 6869 6368 2077 6520  miter, which we 
-00006ba0: 646f 206e 6f74 2077 616e 740a 2020 2020  do not want.    
-00006bb0: 2020 2020 2020 2020 7375 6666 6978 5f6c          suffix_l
-00006bc0: 696e 6573 203d 2073 7566 6669 782e 7370  ines = suffix.sp
-00006bd0: 6c69 7428 6227 5c6e 2729 0a20 2020 2020  lit(b'\n').     
-00006be0: 2020 2020 2020 206c 6566 7420 3d20 6c65         left = le
-00006bf0: 6674 202b 2072 6967 6874 5b3a 6d2e 7374  ft + right[:m.st
-00006c00: 6172 7428 295d 0a20 2020 2020 2020 2020  art()].         
-00006c10: 2020 2069 6620 6c65 6e28 7375 6666 6978     if len(suffix
-00006c20: 5f6c 696e 6573 2920 3c3d 206e 756d 3a0a  _lines) <= num:.
-00006c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c40: 7365 6c66 2e5f 6275 6666 6572 202b 3d20  self._buffer += 
-00006c50: 7269 6768 745b 6d2e 7374 6172 7428 293a  right[m.start():
-00006c60: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00006c70: 2020 7269 6768 7420 3d20 6222 220a 2020    right = b"".  
-00006c80: 2020 2020 2020 2020 2020 2020 2020 6272                br
-00006c90: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-00006ca0: 7269 6768 7420 3d20 6227 5c6e 272e 6a6f  right = b'\n'.jo
-00006cb0: 696e 2873 7566 6669 785f 6c69 6e65 735b  in(suffix_lines[
-00006cc0: 6e75 6d3a 5d29 0a20 2020 2020 2020 2020  num:]).         
-00006cd0: 2020 2069 6620 7375 6666 6978 2e65 6e64     if suffix.end
-00006ce0: 7377 6974 6828 6227 5c6e 2729 3a0a 2020  swith(b'\n'):.  
-00006cf0: 2020 2020 2020 2020 2020 2020 2020 7269                ri
-00006d00: 6768 7420 2b3d 2062 275c 6e27 0a20 2020  ght += b'\n'.   
-00006d10: 2020 2020 2061 7267 203d 206c 6566 7420       arg = left 
-00006d20: 2b20 7269 6768 740a 0a20 2020 2020 2020  + right..       
-00006d30: 2023 205c 7245 5343 5b35 4320 6d6f 7665   # \rESC[5C move
-00006d40: 7320 7468 6520 6375 7273 6f72 2074 6f20  s the cursor to 
-00006d50: 7468 6520 6265 6769 6e6e 696e 6720 6f66  the beginning of
-00006d60: 2074 6865 206c 696e 652c 2074 6865 6e20   the line, then 
-00006d70: 7269 6768 7420 350a 2020 2020 2020 2020  right 5.        
-00006d80: 2320 6368 6172 6163 7465 7273 2e20 4173  # characters. As
-00006d90: 7375 6d65 2061 6e79 7468 696e 6720 6166  sume anything af
-00006da0: 7465 7220 616e 7920 6f66 2074 6865 7365  ter any of these
-00006db0: 2069 7320 6e6f 7420 7072 696e 7465 640a   is not printed.
-00006dc0: 2020 2020 2020 2020 2320 2873 686f 756c          # (shoul
-00006dd0: 6420 6265 206f 6e6c 7920 7370 6163 6520  d be only space 
-00006de0: 616e 6420 696e 7669 7369 626c 6520 6368  and invisible ch
-00006df0: 6172 6163 7465 7273 292e 2045 7665 7279  aracters). Every
-00006e00: 7468 696e 6720 7265 706c 6163 6564 0a20  thing replaced. 
-00006e10: 2020 2020 2020 2023 2061 626f 7665 2069         # above i
-00006e20: 7320 7a65 726f 2077 6964 7468 2c20 736f  s zero width, so
-00006e30: 2077 6520 6361 6e20 7361 6665 6c79 2064   we can safely d
-00006e40: 6f20 7468 6973 206c 6173 742e 0a20 2020  o this last..   
-00006e50: 2020 2020 206c 696e 6573 203d 205b 5d0a       lines = [].
-00006e60: 2020 2020 2020 2020 666f 7220 6c69 6e65          for line
-00006e70: 2069 6e20 6172 672e 7370 6c69 7428 6227   in arg.split(b'
-00006e80: 5c6e 2729 3a0a 2020 2020 2020 2020 2020  \n'):.          
-00006e90: 2020 6e20 3d20 6c65 6e28 6c69 6e65 290a    n = len(line).
-00006ea0: 2020 2020 2020 2020 2020 2020 6d20 3d20              m = 
-00006eb0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00006ec0: 2066 6f72 206d 2069 6e20 7265 2e66 696e   for m in re.fin
-00006ed0: 6469 7465 7228 6272 275c 725c 7831 625c  diter(br'\r\x1b\
-00006ee0: 5b28 5b30 2d39 5d2b 2943 272c 206c 696e  [([0-9]+)C', lin
-00006ef0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00006f00: 2020 2020 6e20 3d20 696e 7428 6d2e 6772      n = int(m.gr
-00006f10: 6f75 7028 3129 290a 2020 2020 2020 2020  oup(1)).        
-00006f20: 2020 2020 6966 206e 203e 206c 656e 286c      if n > len(l
-00006f30: 696e 6529 3a0a 2020 2020 2020 2020 2020  ine):.          
-00006f40: 2020 2020 2020 7365 6c66 2e5f 6275 6666        self._buff
-00006f50: 6572 202b 3d20 6172 670a 2020 2020 2020  er += arg.      
-00006f60: 2020 2020 2020 2020 2020 6172 6720 3d20            arg = 
-00006f70: 6222 220a 2020 2020 2020 2020 2020 2020  b"".            
-00006f80: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-00006f90: 2020 2020 2020 656c 6966 206d 2061 6e64        elif m and
-00006fa0: 2062 275c 7831 6227 2069 6e20 6c69 6e65   b'\x1b' in line
-00006fb0: 5b6d 2e65 6e64 2829 3a5d 3a0a 2020 2020  [m.end():]:.    
-00006fc0: 2020 2020 2020 2020 2020 2020 2320 536f              # So
-00006fd0: 6d65 2065 7363 6170 6520 636f 6465 2077  me escape code w
-00006fe0: 6173 206f 6e6c 7920 7365 656e 2070 6172  as only seen par
-00006ff0: 7469 616c 6c79 2061 6e64 2068 656e 6365  tially and hence
-00007000: 2077 6173 6e27 740a 2020 2020 2020 2020   wasn't.        
-00007010: 2020 2020 2020 2020 2320 7265 706c 6163          # replac
-00007020: 6564 2061 626f 7665 2e20 4966 2077 6520  ed above. If we 
-00007030: 636c 6561 7265 6420 6974 206e 6f77 2c20  cleared it now, 
-00007040: 7468 6520 7265 6d61 696e 6465 7220 776f  the remainder wo
-00007050: 756c 6420 6265 0a20 2020 2020 2020 2020  uld be.         
-00007060: 2020 2020 2020 2023 2073 686f 776e 2061         # shown a
-00007070: 7320 706c 6169 6e20 7465 7874 2069 6e20  s plain text in 
-00007080: 7468 6520 6e65 7874 2061 7267 2e0a 2020  the next arg..  
-00007090: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000070a0: 6c66 2e5f 6275 6666 6572 202b 3d20 6172  lf._buffer += ar
-000070b0: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-000070c0: 2020 6172 6720 3d20 6222 220a 2020 2020    arg = b"".    
-000070d0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-000070e0: 6b0a 2020 2020 2020 2020 2020 2020 656c  k.            el
-000070f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00007100: 2020 2020 6c69 6e65 732e 6170 7065 6e64      lines.append
-00007110: 286c 696e 655b 3a6e 5d29 0a20 2020 2020  (line[:n]).     
-00007120: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00007130: 2020 2020 2061 7267 203d 2062 275c 6e27       arg = b'\n'
-00007140: 2e6a 6f69 6e28 6c69 6e65 7329 0a0a 2020  .join(lines)..  
-00007150: 2020 2020 2020 6966 2061 7267 2e65 6e64        if arg.end
-00007160: 7377 6974 6828 6227 2027 2a31 3029 3a0a  swith(b' '*10):.
-00007170: 2020 2020 2020 2020 2020 2020 2320 5072              # Pr
-00007180: 6f62 6162 6c79 2067 6f69 6e67 2074 6f20  obably going to 
-00007190: 6861 7665 2073 6f6d 6520 5c72 4553 435b  have some \rESC[
-000071a0: 3543 2074 7970 6520 636c 6561 7269 6e67  5C type clearing
-000071b0: 2e20 5468 6572 6520 6361 6e20 6265 0a20  . There can be. 
-000071c0: 2020 2020 2020 2020 2020 2023 2039 2073             # 9 s
-000071d0: 7061 6365 7320 6672 6f6d 2061 2064 6f75  paces from a dou
-000071e0: 626c 6520 696e 6465 6e74 6174 696f 6e20  ble indentation 
-000071f0: 6166 7465 7220 2e2e 2e3a 2028 6375 7272  after ...: (curr
-00007200: 656e 746c 7920 7468 650a 2020 2020 2020  ently the.      
-00007210: 2020 2020 2020 2320 6d6f 7374 2069 6e64        # most ind
-00007220: 656e 7461 7469 6f6e 2075 7365 6429 2c20  entation used), 
-00007230: 6275 7420 7468 6520 636c 6561 7269 6e67  but the clearing
-00007240: 2067 656e 6572 616c 6c79 2075 7365 7320   generally uses 
-00007250: 6875 6e64 7265 6473 0a20 2020 2020 2020  hundreds.       
-00007260: 2020 2020 2023 206f 6620 7370 6163 6573       # of spaces
-00007270: 2c20 736f 2074 6869 7320 7368 6f75 6c64  , so this should
-00007280: 2064 6973 7469 6e67 7569 7368 2074 6865   distinguish the
-00007290: 6d2e 0a20 2020 2020 2020 2020 2020 2073  m..            s
-000072a0: 656c 662e 5f62 7566 6665 7220 2b3d 2061  elf._buffer += a
-000072b0: 7267 0a20 2020 2020 2020 2020 2020 2061  rg.            a
-000072c0: 7267 203d 2062 2222 0a0a 0a20 2020 2020  rg = b""...     
-000072d0: 2020 2023 2055 6e63 6f6d 706c 6574 6564     # Uncompleted
-000072e0: 2065 7363 6170 6520 7365 7175 656e 6365   escape sequence
-000072f0: 2061 7420 7468 6520 656e 6420 6f66 2074   at the end of t
-00007300: 6865 2073 7472 696e 670a 2020 2020 2020  he string.      
-00007310: 2020 6966 2072 652e 7365 6172 6368 2862    if re.search(b
-00007320: 7222 5c78 3162 5b5e 612d 7a41 2d5a 5d2a  r"\x1b[^a-zA-Z]*
-00007330: 2422 2c20 6172 6729 3a0a 2020 2020 2020  $", arg):.      
-00007340: 2020 2020 2020 7365 6c66 2e5f 6275 6666        self._buff
-00007350: 6572 202b 3d20 6172 670a 2020 2020 2020  er += arg.      
-00007360: 2020 2020 2020 6172 6720 3d20 6222 220a        arg = b"".
-00007370: 0a20 2020 2020 2020 2069 6620 4445 4255  .        if DEBU
-00007380: 473a 0a20 2020 2020 2020 2020 2020 2069  G:.            i
-00007390: 6620 7365 6c66 2e5f 6275 6666 6572 3a0a  f self._buffer:.
-000073a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000073b0: 7072 696e 7428 2241 6e73 6946 696c 7465  print("AnsiFilte
-000073c0: 7244 6563 6f64 6572 3a20 2572 203d 3e20  rDecoder: %r => 
-000073d0: 2572 2c20 7065 6e64 696e 673a 2025 7222  %r, pending: %r"
-000073e0: 2025 2028 6172 6730 2c61 7267 2c73 656c   % (arg0,arg,sel
-000073f0: 662e 5f62 7566 6665 7229 290a 2020 2020  f._buffer)).    
-00007400: 2020 2020 2020 2020 656c 6966 2061 7267          elif arg
-00007410: 2021 3d20 6172 6730 3a0a 2020 2020 2020   != arg0:.      
-00007420: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00007430: 2241 6e73 6946 696c 7465 7244 6563 6f64  "AnsiFilterDecod
-00007440: 6572 3a20 2572 203d 3e20 2572 2220 2520  er: %r => %r" % 
-00007450: 2861 7267 302c 6172 6729 290a 2020 2020  (arg0,arg)).    
-00007460: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00007470: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00007480: 696e 7428 2241 6e73 6946 696c 7465 7244  int("AnsiFilterD
-00007490: 6563 6f64 6572 3a20 2572 205b 6e6f 2063  ecoder: %r [no c
-000074a0: 6861 6e67 655d 2220 2520 2861 7267 2c29  hange]" % (arg,)
-000074b0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000074c0: 2061 7267 0a0a 0a0a 636c 6173 7320 4d79   arg....class My
-000074d0: 5370 6177 6e28 7065 7870 6563 742e 7370  Spawn(pexpect.sp
-000074e0: 6177 6e29 3a0a 0a20 2020 2064 6566 205f  awn):..    def _
-000074f0: 5f69 6e69 745f 5f28 7365 6c66 2c20 2a61  _init__(self, *a
-00007500: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
-00007510: 2020 2020 2020 2020 7375 7065 7228 4d79          super(My
-00007520: 5370 6177 6e2c 2073 656c 6629 2e5f 5f69  Spawn, self).__i
-00007530: 6e69 745f 5f28 2a61 7267 732c 202a 2a6b  nit__(*args, **k
-00007540: 7761 7267 7329 0a20 2020 2020 2020 2023  wargs).        #
-00007550: 2046 696c 7465 7220 6f75 7420 7661 7269   Filter out vari
-00007560: 6f75 7320 616e 7369 206e 6f6e 7365 6e73  ous ansi nonsens
-00007570: 652e 2020 4f76 6572 7269 6465 2073 656c  e.  Override sel
-00007580: 662e 5f64 6563 6f64 6572 2e20 2054 6869  f._decoder.  Thi
-00007590: 7320 6973 0a20 2020 2020 2020 2023 2063  s is.        # c
-000075a0: 616c 6c65 6420 6279 2070 6578 7065 6374  alled by pexpect
-000075b0: 2e73 7061 776e 6261 7365 2e53 7061 776e  .spawnbase.Spawn
-000075c0: 4261 7365 2e72 6561 645f 6e6f 6e62 6c6f  Base.read_nonblo
-000075d0: 636b 696e 672e 2020 5468 6973 2069 730a  cking.  This is.
-000075e0: 2020 2020 2020 2020 2320 6e6f 726d 616c          # normal
-000075f0: 6c79 2069 6e69 7469 616c 697a 6564 2062  ly initialized b
-00007600: 7920 5370 6177 6e42 6173 652e 5f5f 696e  y SpawnBase.__in
-00007610: 6974 5f5f 2069 6e74 656e 6465 6420 666f  it__ intended fo
-00007620: 7220 756e 6963 6f64 650a 2020 2020 2020  r unicode.      
-00007630: 2020 2320 6465 636f 6469 6e67 2e20 2054    # decoding.  T
-00007640: 6869 7320 6973 2061 2062 6974 2068 6163  his is a bit hac
-00007650: 6b79 2062 6563 6175 7365 2069 7427 7320  ky because it's 
-00007660: 616e 2069 6e74 6572 6e61 6c20 7468 696e  an internal thin
-00007670: 6720 7468 6174 0a20 2020 2020 2020 2023  g that.        #
-00007680: 2063 6f75 6c64 2063 6861 6e67 652e 0a20   could change.. 
-00007690: 2020 2020 2020 2073 656c 662e 5f64 6563         self._dec
-000076a0: 6f64 6572 203d 2041 6e73 6946 696c 7465  oder = AnsiFilte
-000076b0: 7244 6563 6f64 6572 2829 0a20 2020 2020  rDecoder().     
-000076c0: 2020 2073 656c 662e 7374 725f 6c61 7374     self.str_last
-000076d0: 5f63 6861 7273 203d 2031 3030 300a 0a20  _chars = 1000.. 
-000076e0: 2020 2064 6566 2073 656e 6428 7365 6c66     def send(self
-000076f0: 2c20 6172 6729 3a0a 2020 2020 2020 2020  , arg):.        
-00007700: 6966 2044 4542 5547 3a0a 2020 2020 2020  if DEBUG:.      
-00007710: 2020 2020 2020 7072 696e 7428 224d 7953        print("MyS
-00007720: 7061 776e 2e73 656e 6428 2572 2922 2025  pawn.send(%r)" %
-00007730: 2028 6172 672c 2929 0a20 2020 2020 2020   (arg,)).       
-00007740: 2072 6574 7572 6e20 7375 7065 7228 4d79   return super(My
-00007750: 5370 6177 6e2c 2073 656c 6629 2e73 656e  Spawn, self).sen
-00007760: 6428 6172 6729 0a0a 0a20 2020 2064 6566  d(arg)...    def
-00007770: 2065 7870 6563 7428 7365 6c66 2c20 6172   expect(self, ar
-00007780: 672c 2074 696d 656f 7574 3d44 4546 4155  g, timeout=DEFAU
-00007790: 4c54 5f54 494d 454f 5554 293a 0a20 2020  LT_TIMEOUT):.   
-000077a0: 2020 2020 2069 6620 4445 4255 473a 0a20       if DEBUG:. 
-000077b0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000077c0: 2822 4d79 5370 6177 6e2e 6578 7065 6374  ("MySpawn.expect
-000077d0: 2825 7229 2220 2520 2861 7267 2c29 290a  (%r)" % (arg,)).
-000077e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000077f0: 7570 6572 284d 7953 7061 776e 2c20 7365  uper(MySpawn, se
-00007800: 6c66 292e 6578 7065 6374 2861 7267 2c20  lf).expect(arg, 
-00007810: 7469 6d65 6f75 743d 7469 6d65 6f75 7429  timeout=timeout)
-00007820: 0a0a 0a20 2020 2064 6566 2065 7870 6563  ...    def expec
-00007830: 745f 6578 6163 7428 7365 6c66 2c20 6172  t_exact(self, ar
-00007840: 672c 2074 696d 656f 7574 3d44 4546 4155  g, timeout=DEFAU
-00007850: 4c54 5f54 494d 454f 5554 293a 0a20 2020  LT_TIMEOUT):.   
-00007860: 2020 2020 2069 6620 4445 4255 473a 0a20       if DEBUG:. 
-00007870: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00007880: 2822 4d79 5370 6177 6e2e 6578 7065 6374  ("MySpawn.expect
-00007890: 5f65 7861 6374 2825 7229 2220 2520 2861  _exact(%r)" % (a
-000078a0: 7267 2c29 290a 2020 2020 2020 2020 7265  rg,)).        re
-000078b0: 7475 726e 2073 7570 6572 284d 7953 7061  turn super(MySpa
-000078c0: 776e 2c20 7365 6c66 292e 6578 7065 6374  wn, self).expect
-000078d0: 5f65 7861 6374 2861 7267 2c20 7469 6d65  _exact(arg, time
-000078e0: 6f75 743d 7469 6d65 6f75 7429 0a0a 0a0a  out=timeout)....
-000078f0: 636c 6173 7320 4578 7065 6374 4572 726f  class ExpectErro
-00007900: 7228 4578 6365 7074 696f 6e29 3a0a 2020  r(Exception):.  
-00007910: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00007920: 656c 662c 2065 2c20 6368 696c 6429 3a0a  elf, e, child):.
-00007930: 2020 2020 2020 2020 7365 6c66 2e65 203d          self.e =
-00007940: 2065 0a20 2020 2020 2020 2073 656c 662e   e.        self.
-00007950: 6368 696c 6420 3d20 6368 696c 640a 2020  child = child.  
-00007960: 2020 2020 2020 7365 6c66 2e61 7267 7320        self.args 
-00007970: 3d20 2865 2c20 6368 696c 6429 0a0a 2020  = (e, child)..  
-00007980: 2020 6465 6620 5f5f 7374 725f 5f28 7365    def __str__(se
-00007990: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-000079a0: 7572 6e20 2225 7320 696e 2025 7322 2025  urn "%s in %s" %
-000079b0: 2028 0a20 2020 2020 2020 2020 2020 2073   (.            s
-000079c0: 656c 662e 652e 5f5f 636c 6173 735f 5f2e  elf.e.__class__.
-000079d0: 5f5f 6e61 6d65 5f5f 2c20 2720 272e 6a6f  __name__, ' '.jo
-000079e0: 696e 2873 656c 662e 6368 696c 642e 6172  in(self.child.ar
-000079f0: 6773 2929 0a0a 0a40 636f 6e74 6578 746d  gs))...@contextm
-00007a00: 616e 6167 6572 0a64 6566 2049 5079 7468  anager.def IPyth
-00007a10: 6f6e 4374 7828 7072 6f67 3d22 6970 7974  onCtx(prog="ipyt
-00007a20: 686f 6e22 2c0a 2020 2020 2020 2020 2020  hon",.          
-00007a30: 2020 2020 2061 7267 733d 5b5d 2c0a 2020       args=[],.  
-00007a40: 2020 2020 2020 2020 2020 2020 2061 7574               aut
-00007a50: 6f63 616c 6c3d 4661 6c73 652c 0a20 2020  ocall=False,.   
-00007a60: 2020 2020 2020 2020 2020 2020 6672 6f6e              fron
-00007a70: 7465 6e64 3d4e 6f6e 652c 0a20 2020 2020  tend=None,.     
-00007a80: 2020 2020 2020 2020 2020 6970 7974 686f            ipytho
-00007a90: 6e5f 6469 723d 4e6f 6e65 2c0a 2020 2020  n_dir=None,.    
-00007aa0: 2020 2020 2020 2020 2020 2050 5954 484f             PYTHO
-00007ab0: 4e50 4154 483d 5b5d 2c0a 2020 2020 2020  NPATH=[],.      
-00007ac0: 2020 2020 2020 2020 2050 5946 4c59 4259           PYFLYBY
-00007ad0: 5f50 4154 483d 5059 464c 5942 595f 5041  _PATH=PYFLYBY_PA
-00007ae0: 5448 2c0a 2020 2020 2020 2020 2020 2020  TH,.            
-00007af0: 2020 2050 5946 4c59 4259 5f4c 4f47 5f4c     PYFLYBY_LOG_L
-00007b00: 4556 454c 3d22 2229 3a0a 2020 2020 2222  EVEL=""):.    ""
-00007b10: 220a 2020 2020 5370 6177 6e20 4950 7974  ".    Spawn IPyt
-00007b20: 686f 6e20 696e 2061 2070 7479 2073 7562  hon in a pty sub
-00007b30: 7072 6f63 6573 732e 2020 5365 6e64 2069  process.  Send i
-00007b40: 7420 696e 7075 7420 616e 6420 6578 7065  t input and expe
-00007b50: 6374 206f 7574 7075 742e 0a0a 2020 2020  ct output...    
-00007b60: 3a70 6172 616d 2066 726f 6e74 656e 643a  :param frontend:
-00007b70: 0a20 2020 2020 2057 6869 6368 2074 6572  .      Which ter
-00007b80: 6d69 6e61 6c20 6672 6f6e 7465 6e64 2074  minal frontend t
-00007b90: 6f20 7573 653a 2072 6561 646c 696e 6520  o use: readline 
-00007ba0: 2864 6566 6175 6c74 2066 6f72 2049 5079  (default for IPy
-00007bb0: 7468 6f6e 203c 3529 206f 720a 2020 2020  thon <5) or.    
-00007bc0: 2020 7072 6f6d 7074 5f74 6f6f 6c6b 6974    prompt_toolkit
-00007bd0: 2028 6465 6661 756c 7420 666f 7220 4950   (default for IP
-00007be0: 7974 686f 6e20 3e3d 3529 2e0a 2020 2020  ython >=5)..    
-00007bf0: 2020 4950 7974 686f 6e20 3420 616e 6420    IPython 4 and 
-00007c00: 6561 726c 6965 7220 6f6e 6c79 2073 7570  earlier only sup
-00007c10: 706f 7274 2072 6561 646c 696e 652e 0a20  port readline.. 
-00007c20: 2020 2020 2049 5079 7468 6f6e 2035 2e30       IPython 5.0
-00007c30: 2074 6872 6f75 6768 2035 2e33 206f 6e6c   through 5.3 onl
-00007c40: 7920 7375 7070 6f72 7420 7072 6f6d 7074  y support prompt
-00007c50: 5f74 6f6f 6c6b 6974 2e0a 2020 2020 2020  _toolkit..      
-00007c60: 4950 7974 686f 6e20 352e 3420 616e 6420  IPython 5.4 and 
-00007c70: 6c61 7465 7220 7375 7070 6f72 7420 626f  later support bo
-00007c80: 7468 2072 6561 646c 696e 6520 616e 6420  th readline and 
-00007c90: 7072 6f6d 7074 5f74 6f6f 6c6b 6974 2e0a  prompt_toolkit..
-00007ca0: 2020 2020 2222 220a 2020 2020 5f5f 7472      """.    __tr
-00007cb0: 6163 6562 6163 6b68 6964 655f 5f20 3d20  acebackhide__ = 
-00007cc0: 5472 7565 0a20 2020 2069 6620 6861 7361  True.    if hasa
-00007cd0: 7474 7228 5059 464c 5942 595f 5041 5448  ttr(PYFLYBY_PATH
-00007ce0: 2c20 2277 7269 7465 2229 3a0a 2020 2020  , "write"):.    
-00007cf0: 2020 2020 5059 464c 5942 595f 5041 5448      PYFLYBY_PATH
-00007d00: 203d 2050 5946 4c59 4259 5f50 4154 482e   = PYFLYBY_PATH.
-00007d10: 6e61 6d65 0a20 2020 2050 5946 4c59 4259  name.    PYFLYBY
-00007d20: 5f50 4154 4820 3d20 7374 7228 4669 6c65  _PATH = str(File
-00007d30: 6e61 6d65 2850 5946 4c59 4259 5f50 4154  name(PYFLYBY_PAT
-00007d40: 4829 290a 2020 2020 636c 6561 6e75 705f  H)).    cleanup_
-00007d50: 6469 7273 203d 205b 5d0a 2020 2020 2320  dirs = [].    # 
-00007d60: 4372 6561 7465 2061 2074 656d 706f 7261  Create a tempora
-00007d70: 7279 2064 6972 6563 746f 7279 2077 6869  ry directory whi
-00007d80: 6368 2077 6527 6c6c 2075 7365 2061 7320  ch we'll use as 
-00007d90: 6f75 7220 4950 5954 484f 4e44 4952 2e0a  our IPYTHONDIR..
-00007da0: 2020 2020 6966 206e 6f74 2069 7079 7468      if not ipyth
-00007db0: 6f6e 5f64 6972 3a0a 2020 2020 2020 2020  on_dir:.        
-00007dc0: 6970 7974 686f 6e5f 6469 7220 3d20 6d6b  ipython_dir = mk
-00007dd0: 6474 656d 7028 7072 6566 6978 3d22 7079  dtemp(prefix="py
-00007de0: 666c 7962 795f 7465 7374 5f69 7079 7468  flyby_test_ipyth
-00007df0: 6f6e 5f22 2c20 7375 6666 6978 3d22 2e74  on_", suffix=".t
-00007e00: 6d70 2229 0a20 2020 2020 2020 205f 696e  mp").        _in
-00007e10: 6974 5f69 7079 7468 6f6e 5f64 6972 2869  it_ipython_dir(i
-00007e20: 7079 7468 6f6e 5f64 6972 290a 2020 2020  python_dir).    
-00007e30: 2020 2020 636c 6561 6e75 705f 6469 7273      cleanup_dirs
-00007e40: 2e61 7070 656e 6428 6970 7974 686f 6e5f  .append(ipython_
-00007e50: 6469 7229 0a20 2020 2023 2043 7265 6174  dir).    # Creat
-00007e60: 6520 616e 2065 6d70 7479 2064 6972 6563  e an empty direc
-00007e70: 746f 7279 2066 6f72 204d 504c 434f 4e46  tory for MPLCONF
-00007e80: 4947 4449 5220 746f 2061 766f 6964 206d  IGDIR to avoid m
-00007e90: 6174 706c 6f74 6c69 6220 6c6f 6f6b 696e  atplotlib lookin
-00007ea0: 670a 2020 2020 2320 696e 2024 484f 4d45  g.    # in $HOME
-00007eb0: 2e0a 2020 2020 6d70 6c63 6f6e 6669 6764  ..    mplconfigd
-00007ec0: 6972 203d 206d 6b64 7465 6d70 2870 7265  ir = mkdtemp(pre
-00007ed0: 6669 783d 2270 7966 6c79 6279 5f74 6573  fix="pyflyby_tes
-00007ee0: 745f 6d61 7470 6c6f 746c 6962 5f22 2c20  t_matplotlib_", 
-00007ef0: 7375 6666 6978 3d22 2e74 6d70 2229 0a20  suffix=".tmp"). 
-00007f00: 2020 2063 6c65 616e 7570 5f64 6972 732e     cleanup_dirs.
-00007f10: 6170 7065 6e64 286d 706c 636f 6e66 6967  append(mplconfig
-00007f20: 6469 7229 0a20 2020 2023 2046 6967 7572  dir).    # Figur
-00007f30: 6520 6f75 7420 6672 6f6e 7465 6e64 2074  e out frontend t
-00007f40: 6f20 7573 652e 0a20 2020 2066 726f 6e74  o use..    front
-00007f50: 656e 6420 3d20 5f69 6e74 6572 7072 6574  end = _interpret
-00007f60: 5f66 726f 6e74 656e 645f 6172 6728 6672  _frontend_arg(fr
-00007f70: 6f6e 7465 6e64 290a 2020 2020 6368 696c  ontend).    chil
-00007f80: 6420 3d20 4e6f 6e65 0a20 2020 206f 7574  d = None.    out
-00007f90: 7075 7420 3d20 4279 7465 7349 4f28 290a  put = BytesIO().
-00007fa0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00007fb0: 2023 2050 7265 7061 7265 2065 6e76 6972   # Prepare envir
-00007fc0: 6f6e 6d65 6e74 2076 6172 6961 626c 6573  onment variables
-00007fd0: 2e0a 2020 2020 2020 2020 656e 7620 3d20  ..        env = 
-00007fe0: 7b7d 0a20 2020 2020 2020 2065 6e76 5b22  {}.        env["
-00007ff0: 5059 464c 5942 595f 5041 5448 225d 2020  PYFLYBY_PATH"]  
-00008000: 2020 2020 3d20 5059 464c 5942 595f 5041      = PYFLYBY_PA
-00008010: 5448 0a20 2020 2020 2020 2065 6e76 5b22  TH.        env["
-00008020: 5059 464c 5942 595f 4c4f 475f 4c45 5645  PYFLYBY_LOG_LEVE
-00008030: 4c22 5d20 3d20 5059 464c 5942 595f 4c4f  L"] = PYFLYBY_LO
-00008040: 475f 4c45 5645 4c0a 2020 2020 2020 2020  G_LEVEL.        
-00008050: 656e 765b 2250 5954 484f 4e50 4154 4822  env["PYTHONPATH"
-00008060: 5d20 2020 2020 2020 203d 205f 6275 696c  ]        = _buil
-00008070: 645f 7079 7468 6f6e 7061 7468 2850 5954  d_pythonpath(PYT
-00008080: 484f 4e50 4154 4829 0a20 2020 2020 2020  HONPATH).       
-00008090: 2065 6e76 5b22 5059 5448 4f4e 5354 4152   env["PYTHONSTAR
-000080a0: 5455 5022 5d20 2020 2020 3d20 2222 0a20  TUP"]     = "". 
-000080b0: 2020 2020 2020 2065 6e76 5b22 4d50 4c43         env["MPLC
-000080c0: 4f4e 4649 4744 4952 225d 2020 2020 2020  ONFIGDIR"]      
-000080d0: 3d20 6d70 6c63 6f6e 6669 6764 6972 0a20  = mplconfigdir. 
-000080e0: 2020 2020 2020 2065 6e76 5b22 5041 5448         env["PATH
-000080f0: 225d 2020 2020 2020 2020 2020 2020 2020  "]              
-00008100: 3d20 7374 7228 5059 464c 5942 595f 4249  = str(PYFLYBY_BI
-00008110: 4e2e 7265 616c 2920 2b20 6f73 2e70 6174  N.real) + os.pat
-00008120: 682e 7061 7468 7365 7020 2b20 6f73 2e65  h.pathsep + os.e
-00008130: 6e76 6972 6f6e 5b22 5041 5448 225d 0a20  nviron["PATH"]. 
-00008140: 2020 2020 2020 2065 6e76 5b22 5059 5448         env["PYTH
-00008150: 4f4e 4252 4541 4b50 4f49 4e54 225d 2020  ONBREAKPOINT"]  
-00008160: 3d20 2249 5079 7468 6f6e 2e74 6572 6d69  = "IPython.termi
-00008170: 6e61 6c2e 6465 6275 6767 6572 2e73 6574  nal.debugger.set
-00008180: 5f74 7261 6365 220a 2020 2020 2020 2020  _trace".        
-00008190: 636d 6420 3d20 5f62 7569 6c64 5f69 7079  cmd = _build_ipy
-000081a0: 7468 6f6e 5f63 6d64 2869 7079 7468 6f6e  thon_cmd(ipython
-000081b0: 5f64 6972 2c20 7072 6f67 2c20 6172 6773  _dir, prog, args
-000081c0: 2c20 6175 746f 6361 6c6c 3d61 7574 6f63  , autocall=autoc
-000081d0: 616c 6c2c 0a20 2020 2020 2020 2020 2020  all,.           
-000081e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000081f0: 2020 2020 2020 6672 6f6e 7465 6e64 3d66        frontend=f
-00008200: 726f 6e74 656e 6429 0a20 2020 2020 2020  rontend).       
-00008210: 2023 2053 7061 776e 2049 5079 7468 6f6e   # Spawn IPython
-00008220: 2e0a 2020 2020 2020 2020 7769 7468 2045  ..        with E
-00008230: 6e76 5661 7243 7478 282a 2a65 6e76 293a  nvVarCtx(**env):
-00008240: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00008250: 6e74 2822 2320 5370 6177 6e69 6e67 3a20  nt("# Spawning: 
-00008260: 2573 2220 2520 2822 2022 2e6a 6f69 6e28  %s" % (" ".join(
-00008270: 636d 6429 2929 0a20 2020 2020 2020 2020  cmd))).         
-00008280: 2020 2063 6869 6c64 203d 204d 7953 7061     child = MySpa
-00008290: 776e 280a 2020 2020 2020 2020 2020 2020  wn(.            
-000082a0: 2020 2020 636d 645b 305d 2c20 636d 645b      cmd[0], cmd[
-000082b0: 313a 5d2c 2065 6368 6f3d 5472 7565 2c20  1:], echo=True, 
-000082c0: 6469 6d65 6e73 696f 6e73 3d28 3130 302c  dimensions=(100,
-000082d0: 2039 3030 292c 2074 696d 656f 7574 3d31   900), timeout=1
-000082e0: 302e 300a 2020 2020 2020 2020 2020 2020  0.0.            
-000082f0: 290a 2020 2020 2020 2020 2320 5265 636f  ).        # Reco
-00008300: 7264 2066 726f 6e74 656e 6420 666f 7220  rd frontend for 
-00008310: 6f74 6865 7273 2e0a 2020 2020 2020 2020  others..        
-00008320: 6368 696c 642e 6970 7974 686f 6e5f 6672  child.ipython_fr
-00008330: 6f6e 7465 6e64 203d 2066 726f 6e74 656e  ontend = fronten
-00008340: 640a 2020 2020 2020 2020 2320 4c6f 6720  d.        # Log 
-00008350: 6f75 7470 7574 2074 6f20 6120 4279 7465  output to a Byte
-00008360: 7349 4f2e 2020 4e6f 7465 2074 6861 7420  sIO.  Note that 
-00008370: 7765 2075 7365 2022 6c6f 6766 696c 655f  we use "logfile_
-00008380: 7265 6164 222c 206e 6f74 0a20 2020 2020  read", not.     
-00008390: 2020 2023 2022 6c6f 6766 696c 6522 2e20     # "logfile". 
-000083a0: 2049 6620 7765 2075 7365 6420 6c6f 6766   If we used logf
-000083b0: 696c 652c 2074 6861 7420 776f 756c 6420  ile, that would 
-000083c0: 646f 7562 6c65 2d6c 6f67 2074 6865 2069  double-log the i
-000083d0: 6e70 7574 0a20 2020 2020 2020 2023 2063  nput.        # c
-000083e0: 6f6d 6d61 6e64 732c 2073 696e 6365 2077  ommands, since w
-000083f0: 6520 7573 6564 2065 6368 6f3d 5472 7565  e used echo=True
-00008400: 2e20 2028 5573 696e 6720 6c6f 6766 696c  .  (Using logfil
-00008410: 653d 4279 7465 7349 4f20 616e 640a 2020  e=BytesIO and.  
-00008420: 2020 2020 2020 2320 6563 686f 3d46 616c        # echo=Fal
-00008430: 7365 2077 6f72 6b73 2066 6f72 206d 6f73  se works for mos
-00008440: 7420 696e 7075 7473 2c20 6275 7420 646f  t inputs, but do
-00008450: 6573 6e27 7420 776f 726b 2066 6f72 2074  esn't work for t
-00008460: 6869 6e67 7320 6c69 6b65 0a20 2020 2020  hings like.     
-00008470: 2020 2023 2074 6162 2063 6f6d 706c 6574     # tab complet
-00008480: 696f 6e20 6f75 7470 7574 2e29 0a20 2020  ion output.).   
-00008490: 2020 2020 2063 6869 6c64 2e6c 6f67 6669       child.logfi
-000084a0: 6c65 5f72 6561 6420 3d20 6f75 7470 7574  le_read = output
-000084b0: 0a20 2020 2020 2020 2023 2044 6f6e 2774  .        # Don't
-000084c0: 2064 656c 6179 2030 2e30 3573 2062 6566   delay 0.05s bef
-000084d0: 6f72 6520 7365 6e64 696e 672e 0a20 2020  ore sending..   
-000084e0: 2020 2020 2063 6869 6c64 2e64 656c 6179       child.delay
-000084f0: 6265 666f 7265 7365 6e64 203d 2030 2e30  beforesend = 0.0
-00008500: 0a20 2020 2020 2020 2023 2059 6965 6c64  .        # Yield
-00008510: 2063 6f6e 7472 6f6c 2074 6f20 6361 6c6c   control to call
-00008520: 6572 2e0a 2020 2020 2020 2020 6368 696c  er..        chil
-00008530: 642e 6970 7974 686f 6e5f 6469 7220 3d20  d.ipython_dir = 
-00008540: 6970 7974 686f 6e5f 6469 720a 2020 2020  ipython_dir.    
-00008550: 2020 2020 7969 656c 6420 6368 696c 640a      yield child.
-00008560: 2020 2020 6578 6365 7074 2028 7065 7870      except (pexp
-00008570: 6563 742e 4578 6365 7074 696f 6e50 6578  ect.ExceptionPex
-00008580: 7065 6374 2920 6173 2065 3a0a 2020 2020  pect) as e:.    
-00008590: 2020 2020 7072 696e 7428 2245 7272 6f72      print("Error
-000085a0: 3a20 2573 2220 2520 2865 2e5f 5f63 6c61  : %s" % (e.__cla
-000085b0: 7373 5f5f 2e5f 5f6e 616d 655f 5f2c 2929  ss__.__name__,))
-000085c0: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-000085d0: 4f75 7470 7574 2073 6f20 6661 723a 2229  Output so far:")
-000085e0: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-000085f0: 3d20 5f63 6c65 616e 5f69 7079 7468 6f6e  = _clean_ipython
-00008600: 5f6f 7574 7075 7428 6f75 7470 7574 2e67  _output(output.g
-00008610: 6574 7661 6c75 6528 2929 0a20 2020 2020  etvalue()).     
-00008620: 2020 2070 7269 6e74 2827 272e 6a6f 696e     print(''.join
-00008630: 2822 2020 2020 2573 5c6e 2225 6c69 6e65  ("    %s\n"%line
-00008640: 2066 6f72 206c 696e 6520 696e 2072 6573   for line in res
-00008650: 756c 742e 7370 6c69 746c 696e 6573 2829  ult.splitlines()
-00008660: 2929 0a20 2020 2020 2020 2070 7269 6e74  )).        print
-00008670: 2822 4572 726f 7220 6465 7461 696c 733a  ("Error details:
-00008680: 2229 0a20 2020 2020 2020 2070 7269 6e74  ").        print
-00008690: 2827 272e 6a6f 696e 2822 2020 2020 2573  (''.join("    %s
-000086a0: 5c6e 2225 6c69 6e65 2066 6f72 206c 696e  \n"%line for lin
-000086b0: 6520 696e 2073 7472 2865 292e 7370 6c69  e in str(e).spli
-000086c0: 746c 696e 6573 2829 2929 0a20 2020 2020  tlines())).     
-000086d0: 2020 2023 2052 652d 7261 6973 6520 616e     # Re-raise an
-000086e0: 2065 7863 6570 7469 6f6e 2077 7261 7070   exception wrapp
-000086f0: 6564 2073 6f20 7468 6174 2077 6520 646f  ed so that we do
-00008700: 6e27 7420 7265 2d63 6174 6368 2069 7420  n't re-catch it 
-00008710: 666f 7220 7468 650a 2020 2020 2020 2020  for the.        
-00008720: 2320 7772 6f6e 6720 6368 696c 642e 0a20  # wrong child.. 
-00008730: 2020 2020 2020 2072 6169 7365 2045 7870         raise Exp
-00008740: 6563 7445 7272 6f72 2865 2c20 6368 696c  ectError(e, chil
-00008750: 6429 2023 2c20 4e6f 6e65 2c20 7379 732e  d) #, None, sys.
-00008760: 6578 635f 696e 666f 2829 5b32 5d0a 2020  exc_info()[2].  
-00008770: 2020 6669 6e61 6c6c 793a 0a20 2020 2020    finally:.     
-00008780: 2020 2023 2043 6c65 616e 2075 702e 0a20     # Clean up.. 
-00008790: 2020 2020 2020 2069 6620 6368 696c 6420         if child 
-000087a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000087b0: 2020 2020 2020 2020 2063 6869 6c64 2e63           child.c
-000087c0: 6c6f 7365 2866 6f72 6365 3d54 7275 6529  lose(force=True)
-000087d0: 0a20 2020 2020 2020 2066 6f72 2064 2069  .        for d i
-000087e0: 6e20 636c 6561 6e75 705f 6469 7273 3a0a  n cleanup_dirs:.
-000087f0: 2020 2020 2020 2020 2020 2020 726d 7472              rmtr
-00008800: 6565 2864 290a 0a0a 6465 6620 5f69 6e74  ee(d)...def _int
-00008810: 6572 6163 745f 6970 7974 686f 6e28 6368  eract_ipython(ch
-00008820: 696c 642c 2069 6e70 7574 2c20 6578 6974  ild, input, exit
-00008830: 7374 723d 6222 6578 6974 2829 5c6e 222c  str=b"exit()\n",
-00008840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008850: 2020 2020 2020 2073 656e 6465 6f66 3d46         sendeof=F
-00008860: 616c 7365 2c20 7761 6974 656f 663d 5472  alse, waiteof=Tr
-00008870: 7565 293a 0a20 2020 2069 735f 7072 6f6d  ue):.    is_prom
-00008880: 7074 5f74 6f6f 6c6b 6974 203d 2063 6869  pt_toolkit = chi
-00008890: 6c64 2e69 7079 7468 6f6e 5f66 726f 6e74  ld.ipython_front
-000088a0: 656e 6420 3d3d 2022 7072 6f6d 7074 5f74  end == "prompt_t
-000088b0: 6f6f 6c6b 6974 220a 2020 2020 2320 4361  oolkit".    # Ca
-000088c0: 6e6f 6e69 6361 6c69 7a65 2069 6e70 7574  nonicalize input
-000088d0: 206c 696e 6573 2e0a 2020 2020 696e 7075   lines..    inpu
-000088e0: 7420 3d20 6465 6465 6e74 2869 6e70 7574  t = dedent(input
-000088f0: 2e64 6563 6f64 6528 2775 7466 2d38 2729  .decode('utf-8')
-00008900: 292e 656e 636f 6465 2827 7574 662d 3827  ).encode('utf-8'
-00008910: 290a 2020 2020 696e 7075 7420 3d20 7265  ).    input = re
-00008920: 2e73 7562 2862 7222 5e5c 6e2b 222c 2062  .sub(br"^\n+", b
-00008930: 2222 2c20 696e 7075 7429 0a20 2020 2069  "", input).    i
-00008940: 6e70 7574 203d 2072 652e 7375 6228 6272  nput = re.sub(br
-00008950: 225c 6e2b 2422 2c20 6222 222c 2069 6e70  "\n+$", b"", inp
-00008960: 7574 290a 2020 2020 696e 7075 7420 2b3d  ut).    input +=
-00008970: 2062 225c 6e22 0a20 2020 2069 6e70 7574   b"\n".    input
-00008980: 202b 3d20 6578 6974 7374 720a 2020 2020   += exitstr.    
-00008990: 6c69 6e65 7320 3d20 696e 7075 742e 7370  lines = input.sp
-000089a0: 6c69 746c 696e 6573 2846 616c 7365 290a  litlines(False).
-000089b0: 2020 2020 7072 6576 5f70 726f 6d70 745f      prev_prompt_
-000089c0: 696e 5f69 6478 203d 204e 6f6e 650a 2020  in_idx = None.  
-000089d0: 2020 2320 4c6f 6f70 206f 7665 7220 6c69    # Loop over li
-000089e0: 6e65 732e 0a20 2020 2066 6f72 206c 696e  nes..    for lin
-000089f0: 6520 696e 206c 696e 6573 3a0a 2020 2020  e in lines:.    
-00008a00: 2020 2020 2320 5761 6974 2066 6f72 2074      # Wait for t
-00008a10: 6865 2022 496e 205b 4e5d 3a22 2070 726f  he "In [N]:" pro
-00008a20: 6d70 742e 0a20 2020 2020 2020 2077 6869  mpt..        whi
-00008a30: 6c65 2054 7275 653a 0a20 2020 2020 2020  le True:.       
-00008a40: 2020 2020 2065 7870 6563 745f 7265 7375       expect_resu
-00008a50: 6c74 203d 2063 6869 6c64 2e65 7870 6563  lt = child.expec
-00008a60: 7428 5f49 5059 5448 4f4e 5f50 524f 4d50  t(_IPYTHON_PROMP
-00008a70: 5453 2c20 7469 6d65 6f75 743d 4445 4641  TS, timeout=DEFA
-00008a80: 554c 545f 5449 4d45 4f55 5429 0a20 2020  ULT_TIMEOUT).   
-00008a90: 2020 2020 2020 2020 2069 6620 6578 7065           if expe
-00008aa0: 6374 5f72 6573 756c 7420 3d3d 2030 3a0a  ct_result == 0:.
-00008ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ac0: 2320 5765 2067 6f74 2022 496e 205b 4e5d  # We got "In [N]
-00008ad0: 3a22 2e0a 2020 2020 2020 2020 2020 2020  :"..            
-00008ae0: 2020 2020 2320 4368 6563 6b20 6966 2077      # Check if w
-00008af0: 6520 676f 7420 7468 6520 7361 6d65 2070  e got the same p
-00008b00: 726f 6d70 7420 6173 2062 6566 6f72 652e  rompt as before.
-00008b10: 2020 4966 2073 6f20 7468 656e 206b 6565    If so then kee
-00008b20: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
-00008b30: 2020 2320 6c6f 6f6b 696e 6720 666f 7220    # looking for 
-00008b40: 7468 6520 6e65 7874 2070 726f 6d70 742e  the next prompt.
-00008b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008b60: 2069 6e5f 6964 7820 3d20 6368 696c 642e   in_idx = child.
-00008b70: 6d61 7463 682e 6772 6f75 7028 3129 0a20  match.group(1). 
-00008b80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00008b90: 6620 696e 5f69 6478 203d 3d20 7072 6576  f in_idx == prev
-00008ba0: 5f70 726f 6d70 745f 696e 5f69 6478 3a0a  _prompt_in_idx:.
-00008bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008bc0: 2020 2020 2320 5468 6973 2069 7320 7374      # This is st
-00008bd0: 696c 6c20 7468 6520 7361 6d65 2049 6e5b  ill the same In[
-00008be0: 4e5d 2074 6861 7420 7765 2070 7265 7669  N] that we previ
-00008bf0: 6f75 736c 7920 7361 772e 0a20 2020 2020  ously saw..     
-00008c00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00008c10: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-00008c20: 2020 2020 2020 2020 7072 6576 5f70 726f          prev_pro
-00008c30: 6d70 745f 696e 5f69 6478 203d 2069 6e5f  mpt_in_idx = in_
-00008c40: 6964 780a 2020 2020 2020 2020 2020 2020  idx.            
-00008c50: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-00008c60: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00008c70: 2020 2020 2020 2020 2020 2020 2320 5765              # We
-00008c80: 2067 6f74 2022 3e3e 3e22 2c20 222e 2e2e   got ">>>", "...
-00008c90: 3a22 2c20 2269 7064 623e 222c 2065 7463  :", "ipdb>", etc
-00008ca0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008cb0: 2020 6966 2069 735f 7072 6f6d 7074 5f74    if is_prompt_t
-00008cc0: 6f6f 6c6b 6974 3a0a 2020 2020 2020 2020  oolkit:.        
-00008cd0: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-00008ce0: 6f6d 7074 5f74 6f6f 6c6b 6974 206d 6967  ompt_toolkit mig
-00008cf0: 6874 2072 6577 7269 7465 2022 6970 6462  ht rewrite "ipdb
-00008d00: 3e22 2065 7463 206d 756c 7469 706c 6520  >" etc multiple 
-00008d10: 7469 6d65 732e 0a20 2020 2020 2020 2020  times..         
-00008d20: 2020 2020 2020 2020 2020 2023 204d 616b             # Mak
-00008d30: 6520 7375 7265 2077 6520 6561 7420 7570  e sure we eat up
-00008d40: 2061 6c6c 2074 6865 206f 7574 7075 7420   all the output 
-00008d50: 736f 2074 6861 7420 7468 6520 6e65 7874  so that the next
-00008d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008d70: 2020 2020 2023 2065 7870 6563 7428 2269       # expect("i
-00008d80: 7064 623e 2229 2064 6f65 736e 2774 2067  pdb>") doesn't g
-00008d90: 6574 2074 6865 2072 6577 7269 7474 656e  et the rewritten
-00008da0: 2022 6970 6462 3e22 2066 726f 6d0a 2020   "ipdb>" from.  
-00008db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008dc0: 2020 2320 7468 6520 7072 6576 696f 7573    # the previous
-00008dd0: 206c 696e 652e 2020 466f 7220 2249 6e20   line.  For "In 
-00008de0: 5b4e 5d22 2c20 7765 2063 616e 2072 656c  [N]", we can rel
-00008df0: 7920 6f6e 2074 6865 0a20 2020 2020 2020  y on the.       
-00008e00: 2020 2020 2020 2020 2020 2020 2023 2063               # c
-00008e10: 6f75 6e74 6572 2074 6f20 646f 2074 6861  ounter to do tha
-00008e20: 742e 2020 466f 7220 7072 6f6d 7074 7320  t.  For prompts 
-00008e30: 7769 7468 6f75 7420 6120 636f 756e 7465  without a counte
-00008e40: 722c 2077 650a 2020 2020 2020 2020 2020  r, we.          
-00008e50: 2020 2020 2020 2020 2020 2320 6a75 7374            # just
-00008e60: 2074 7279 206f 7572 2062 6573 7420 746f   try our best to
-00008e70: 2065 6174 2075 7020 7065 6e64 696e 6720   eat up pending 
-00008e80: 6f75 7470 7574 2e20 2054 6f64 6f3a 0a20  output.  Todo:. 
-00008e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ea0: 2020 2023 2069 7320 7468 6572 6520 6120     # is there a 
-00008eb0: 6265 7474 6572 2077 6179 3f0a 2020 2020  better way?.    
-00008ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ed0: 5f77 6169 745f 666f 725f 6f75 7470 7574  _wait_for_output
-00008ee0: 2863 6869 6c64 2c20 7469 6d65 6f75 743d  (child, timeout=
-00008ef0: 302e 3035 290a 2020 2020 2020 2020 2020  0.05).          
-00008f00: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-00008f10: 2020 2020 6966 206c 696e 652e 7374 6172      if line.star
-00008f20: 7473 7769 7468 2862 2220 2229 2061 6e64  tswith(b" ") and
-00008f30: 2069 735f 7072 6f6d 7074 5f74 6f6f 6c6b   is_prompt_toolk
-00008f40: 6974 2061 6e64 205f 4950 5954 484f 4e5f  it and _IPYTHON_
-00008f50: 5645 5253 494f 4e20 3c20 2837 2c29 3a0a  VERSION < (7,):.
-00008f60: 2020 2020 2020 2020 2020 2020 2320 436c              # Cl
-00008f70: 6561 7220 7468 6520 6c69 6e65 2076 6961  ear the line via
-00008f80: 205e 552e 2054 6869 7320 6973 206e 6565   ^U. This is nee
-00008f90: 6465 6420 7769 7468 2070 726f 6d70 745f  ded with prompt_
-00008fa0: 746f 6f6c 6b69 740a 2020 2020 2020 2020  toolkit.        
-00008fb0: 2020 2020 2320 2849 5079 7468 6f6e 2035      # (IPython 5
-00008fc0: 2061 6e64 2036 2920 6265 6361 7573 6520   and 6) because 
-00008fd0: 6974 2069 7320 6e6f 206c 6f6e 6765 7220  it is no longer 
-00008fe0: 706f 7373 6962 6c65 2074 6f20 7475 726e  possible to turn
-00008ff0: 206f 6666 0a20 2020 2020 2020 2020 2020   off.           
-00009000: 2023 2061 7574 6f69 6e64 656e 742e 2028   # autoindent. (
-00009010: 4950 7974 686f 6e20 6e6f 7720 7265 6c69  IPython now reli
-00009020: 6573 206f 6e20 6272 6163 6b65 7465 6420  es on bracketed 
-00009030: 7061 7374 6520 6d6f 6465 3b20 7468 6579  paste mode; they
-00009040: 0a20 2020 2020 2020 2020 2020 2023 2061  .            # a
-00009050: 7373 756d 6564 2074 6861 7420 7761 7320  ssumed that was 
-00009060: 7468 6520 6f6e 6c79 2072 6561 736f 6e20  the only reason 
-00009070: 746f 2074 7572 6e20 6f66 6620 6175 746f  to turn off auto
-00009080: 696e 6465 6e74 2e20 416e 6f74 6865 720a  indent. Another.
-00009090: 2020 2020 2020 2020 2020 2020 2320 6964              # id
-000090a0: 6561 2069 7320 746f 2075 7365 2062 7261  ea is to use bra
-000090b0: 636b 6574 2070 6173 7465 206d 6f64 652c  cket paste mode,
-000090c0: 2069 2e65 2e20 4553 435b 3230 307e 626c   i.e. ESC[200~bl
-000090d0: 6168 4553 435b 3230 317e 2e0a 2020 2020  ahESC[201~..    
-000090e0: 2020 2020 2020 2020 2320 4275 7420 7468          # But th
-000090f0: 6174 2063 6175 7365 7320 4950 7974 686f  at causes IPytho
-00009100: 6e20 746f 206e 6f74 2070 7269 6e74 2061  n to not print a
-00009110: 2022 2e2e 2e3a 2220 7072 6f6d 7074 2074   "...:" prompt t
-00009120: 6861 7420 6974 0a20 2020 2020 2020 2020  hat it.         
-00009130: 2020 2023 2077 6f75 6c64 2062 6520 6e69     # would be ni
-00009140: 6365 2074 6f20 7365 652e 2054 6869 7320  ce to see. This 
-00009150: 7761 7320 6669 7865 6420 696e 2049 5079  was fixed in IPy
-00009160: 7468 6f6e 2037 2e30 2920 5765 2061 6c73  thon 7.0) We als
-00009170: 6f0a 2020 2020 2020 2020 2020 2020 2320  o.            # 
-00009180: 736c 6565 7020 6166 7465 7277 6172 6473  sleep afterwards
-00009190: 2074 6f20 6d61 6b65 2073 7572 6520 7468   to make sure th
-000091a0: 6174 2049 5079 7468 6f6e 2064 6f65 736e  at IPython doesn
-000091b0: 2774 206f 7074 696d 697a 6520 7468 650a  't optimize the.
-000091c0: 2020 2020 2020 2020 2020 2020 2320 6f75              # ou
-000091d0: 7470 7574 2e0a 2020 2020 2020 2020 2020  tput..          
-000091e0: 2020 2320 466f 7220 6578 616d 706c 652c    # For example,
-000091f0: 2077 6974 686f 7574 2074 6865 2073 6c65   without the sle
-00009200: 6570 2c20 6966 2049 5079 7468 6f6e 2064  ep, if IPython d
-00009210: 6566 6175 6c74 6564 2034 2073 7061 6365  efaulted 4 space
-00009220: 7320 616e 640a 2020 2020 2020 2020 2020  s and.          
-00009230: 2020 2320 7765 2077 616e 7465 6420 3120    # we wanted 1 
-00009240: 7370 6163 652c 2077 6520 776f 756c 6420  space, we would 
-00009250: 7365 6e64 2022 5e55 2062 6c61 6822 3b20  send "^U blah"; 
-00009260: 6166 7465 7220 4950 7974 686f 6e20 7072  after IPython pr
-00009270: 696e 7465 640a 2020 2020 2020 2020 2020  inted.          
-00009280: 2020 2320 6f75 7420 7468 6520 3420 7370    # out the 4 sp
-00009290: 6163 6573 2069 7420 776f 756c 6420 6261  aces it would ba
-000092a0: 636b 7370 6163 6520 3320 6f66 2074 6865  ckspace 3 of the
-000092b0: 6d20 616e 6420 756c 7469 6d61 7465 6c79  m and ultimately
-000092c0: 2064 6f0a 2020 2020 2020 2020 2020 2020   do.            
-000092d0: 2320 2220 2020 2045 5343 5b33 4420 2020  # "    ESC[3D   
-000092e0: 4553 435b 3344 626c 6168 222e 2020 5468  ESC[3Dblah".  Th
-000092f0: 6174 2773 2068 6172 6420 666f 7220 7573  at's hard for us
-00009300: 2074 6f20 6d61 7463 682e 2020 4974 2773   to match.  It's
-00009310: 0a20 2020 2020 2020 2020 2020 2023 2062  .            # b
-00009320: 6574 7465 7220 6966 2069 7420 7365 6e64  etter if it send
-00009330: 7320 6f75 7420 2220 2020 2020 4553 435b  s out "     ESC[
-00009340: 3444 2020 2020 4553 435b 3444 2062 6c61  4D    ESC[4D bla
-00009350: 6822 2e0a 2020 2020 2020 2020 2020 2020  h"..            
-00009360: 6368 696c 642e 7365 6e64 2862 225c 7831  child.send(b"\x1
-00009370: 3522 2920 2320 5e55 0a20 2020 2020 2020  5") # ^U.       
-00009380: 2020 2020 2074 696d 652e 736c 6565 7028       time.sleep(
-00009390: 302e 3032 290a 2020 2020 2020 2020 7768  0.02).        wh
-000093a0: 696c 6520 6c69 6e65 3a0a 2020 2020 2020  ile line:.      
-000093b0: 2020 2020 2020 6c65 6674 2c20 7461 622c        left, tab,
-000093c0: 2072 6967 6874 203d 206c 696e 652e 7061   right = line.pa
-000093d0: 7274 6974 696f 6e28 6222 5c74 2229 0a20  rtition(b"\t"). 
-000093e0: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
-000093f0: 4445 4255 473a 0a20 2020 2020 2020 2020  DEBUG:.         
-00009400: 2020 2023 2020 2020 2070 7269 6e74 2822     #     print("
-00009410: 5f69 6e74 6572 6163 745f 6970 7974 686f  _interact_ipytho
-00009420: 6e28 293a 206c 696e 653d 2572 2c20 6c65  n(): line=%r, le
-00009430: 6674 3d25 722c 2074 6162 3d25 722c 2072  ft=%r, tab=%r, r
-00009440: 6967 6874 3d25 7222 2025 2028 6c69 6e65  ight=%r" % (line
-00009450: 2c20 6c65 6674 2c20 7461 622c 2072 6967  , left, tab, rig
-00009460: 6874 2929 0a20 2020 2020 2020 2020 2020  ht)).           
-00009470: 2023 2053 656e 6420 7468 6520 696e 7075   # Send the inpu
-00009480: 7420 2875 7020 746f 2074 6162 206f 7220  t (up to tab or 
-00009490: 6e65 776c 696e 6529 2e0a 2020 2020 2020  newline)..      
-000094a0: 2020 2020 2020 6368 696c 642e 7365 6e64        child.send
-000094b0: 286c 6566 7429 0a20 2020 2020 2020 2020  (left).         
-000094c0: 2020 2023 2043 6865 636b 2074 6861 7420     # Check that 
-000094d0: 7468 6520 636c 6965 6e74 2049 5079 7468  the client IPyth
-000094e0: 6f6e 2067 6574 7320 7468 6520 696e 7075  on gets the inpu
-000094f0: 742e 0a20 2020 2020 2020 2020 2020 2063  t..            c
-00009500: 6869 6c64 2e65 7870 6563 745f 6578 6163  hild.expect_exac
-00009510: 7428 6c65 6674 2c20 7469 6d65 6f75 743d  t(left, timeout=
-00009520: 4445 4641 554c 545f 5449 4d45 4f55 5429  DEFAULT_TIMEOUT)
-00009530: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00009540: 7461 623a 0a20 2020 2020 2020 2020 2020  tab:.           
-00009550: 2020 2020 2023 2053 656e 6420 7468 6520       # Send the 
-00009560: 7461 622e 0a20 2020 2020 2020 2020 2020  tab..           
-00009570: 2020 2020 2063 6869 6c64 2e73 656e 6428       child.send(
-00009580: 7461 6229 0a20 2020 2020 2020 2020 2020  tab).           
-00009590: 2020 2020 2023 2057 6169 7420 666f 7220       # Wait for 
-000095a0: 7265 7370 6f6e 7365 2074 6f20 7461 622e  response to tab.
-000095b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000095c0: 2023 2069 6620 5f49 5059 5448 4f4e 5f56   # if _IPYTHON_V
-000095d0: 4552 5349 4f4e 203e 3d20 2835 2c29 3a0a  ERSION >= (5,):.
+000059a0: 6374 6976 6553 6865 6c6c 2e61 7574 6f63  ctiveShell.autoc
+000059b0: 616c 6c3d 5472 7565 225d 0a20 2020 2020  all=True"].     
+000059c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000059d0: 2020 2020 2063 6d64 202b 3d20 5b6f 7074       cmd += [opt
+000059e0: 2822 2d2d 6175 746f 6361 6c6c 3d31 2229  ("--autocall=1")
+000059f0: 5d0a 2020 2020 6966 2066 726f 6e74 656e  ].    if fronten
+00005a00: 6420 3d3d 2027 7265 6164 6c69 6e65 273a  d == 'readline':
+00005a10: 0a20 2020 2020 2020 2069 6620 5f49 5059  .        if _IPY
+00005a20: 5448 4f4e 5f56 4552 5349 4f4e 203e 3d20  THON_VERSION >= 
+00005a30: 2835 2c34 293a 0a20 2020 2020 2020 2020  (5,4):.         
+00005a40: 2020 2063 6d64 202b 3d20 5b22 2d2d 5465     cmd += ["--Te
+00005a50: 726d 696e 616c 4950 7974 686f 6e41 7070  rminalIPythonApp
+00005a60: 2e69 6e74 6572 6163 7469 7665 5f73 6865  .interactive_she
+00005a70: 6c6c 5f63 6c61 7373 3d72 6c69 7079 7468  ll_class=rlipyth
+00005a80: 6f6e 2e54 6572 6d69 6e61 6c49 6e74 6572  on.TerminalInter
+00005a90: 6163 7469 7665 5368 656c 6c22 5d0a 2020  activeShell"].  
+00005aa0: 2020 2020 2020 656c 6966 205f 4950 5954        elif _IPYT
+00005ab0: 484f 4e5f 5645 5253 494f 4e20 3e3d 2028  HON_VERSION >= (
+00005ac0: 352c 3029 3a0a 2020 2020 2020 2020 2020  5,0):.          
+00005ad0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00005ae0: 6f72 2822 4950 7974 686f 6e20 352e 3020  or("IPython 5.0 
+00005af0: 7468 726f 7567 6820 352e 3320 6f6e 6c79  through 5.3 only
+00005b00: 2073 7570 706f 7274 2070 726f 6d70 745f   support prompt_
+00005b10: 746f 6f6c 6b69 7422 290a 2020 2020 2020  toolkit").      
+00005b20: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00005b30: 2020 2020 2320 466f 7220 4950 7974 686f      # For IPytho
+00005b40: 6e20 3420 616e 6420 6561 726c 6965 722c  n 4 and earlier,
+00005b50: 2072 6561 646c 696e 6520 6973 2074 6865   readline is the
+00005b60: 2064 6566 6175 6c74 2061 6e64 206f 6e6c   default and onl
+00005b70: 7920 6f70 7469 6f6e 2e0a 2020 2020 2020  y option..      
+00005b80: 2020 2020 2020 7061 7373 0a20 2020 2065        pass.    e
+00005b90: 6c69 6620 6672 6f6e 7465 6e64 203d 3d20  lif frontend == 
+00005ba0: 2770 726f 6d70 745f 746f 6f6c 6b69 7427  'prompt_toolkit'
+00005bb0: 3a0a 2020 2020 2020 2020 6966 205f 4950  :.        if _IP
+00005bc0: 5954 484f 4e5f 5645 5253 494f 4e20 3e3d  YTHON_VERSION >=
+00005bd0: 2028 352c 293a 0a20 2020 2020 2020 2020   (5,):.         
+00005be0: 2020 2023 2046 6f72 2049 5079 7468 6f6e     # For IPython
+00005bf0: 203e 3d20 352e 302c 2070 726f 6d70 745f   >= 5.0, prompt_
+00005c00: 746f 6f6c 6b69 7420 6973 2074 6865 2064  toolkit is the d
+00005c10: 6566 6175 6c74 206f 7074 696f 6e20 2861  efault option (a
+00005c20: 6e64 0a20 2020 2020 2020 2020 2020 2023  nd.            #
+00005c30: 2066 6f72 2035 2e30 2d35 2e33 2c20 7468   for 5.0-5.3, th
+00005c40: 6520 6f6e 6c79 206f 7074 696f 6e29 2e0a  e only option)..
+00005c50: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00005c60: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00005c70: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00005c80: 2056 616c 7565 4572 726f 7228 2249 5079   ValueError("IPy
+00005c90: 7468 6f6e 2034 2061 6e64 2065 6172 6c69  thon 4 and earli
+00005ca0: 6572 206f 6e6c 7920 7375 7070 6f72 7420  er only support 
+00005cb0: 7265 6164 6c69 6e65 2229 0a20 2020 2065  readline").    e
+00005cc0: 6c73 653a 0a20 2020 2020 2020 2072 6169  lse:.        rai
+00005cd0: 7365 2056 616c 7565 4572 726f 7228 2262  se ValueError("b
+00005ce0: 6164 2066 726f 6e74 656e 643d 2572 2220  ad frontend=%r" 
+00005cf0: 2520 2866 726f 6e74 656e 642c 2929 0a20  % (frontend,)). 
+00005d00: 2020 2072 6574 7572 6e20 636d 640a 0a0a     return cmd...
+00005d10: 5059 464c 5942 595f 484f 4d45 203d 2046  PYFLYBY_HOME = F
+00005d20: 696c 656e 616d 6528 5f5f 6669 6c65 5f5f  ilename(__file__
+00005d30: 292e 7265 616c 2e64 6972 2e64 6972 0a50  ).real.dir.dir.P
+00005d40: 5946 4c59 4259 5f50 4154 4820 3d20 5059  YFLYBY_PATH = PY
+00005d50: 464c 5942 595f 484f 4d45 202f 2022 6574  FLYBY_HOME / "et
+00005d60: 632f 7079 666c 7962 7922 0a50 5946 4c59  c/pyflyby".PYFLY
+00005d70: 4259 5f42 494e 203d 2050 5946 4c59 4259  BY_BIN = PYFLYBY
+00005d80: 5f48 4f4d 4520 2f20 2262 696e 220a 0a63  _HOME / "bin"..c
+00005d90: 6c61 7373 2041 6e73 6946 696c 7465 7244  lass AnsiFilterD
+00005da0: 6563 6f64 6572 286f 626a 6563 7429 3a0a  ecoder(object):.
+00005db0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00005dc0: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+00005dd0: 2073 656c 662e 5f62 7566 6665 7220 3d20   self._buffer = 
+00005de0: 6222 220a 0a20 2020 2064 6566 2064 6563  b""..    def dec
+00005df0: 6f64 6528 7365 6c66 2c20 6172 672c 2066  ode(self, arg, f
+00005e00: 696e 616c 3d46 616c 7365 293a 0a20 2020  inal=False):.   
+00005e10: 2020 2020 2061 7267 3020 3d20 6172 6720       arg0 = arg 
+00005e20: 3d20 7365 6c66 2e5f 6275 6666 6572 202b  = self._buffer +
+00005e30: 2061 7267 0a20 2020 2020 2020 2073 656c   arg.        sel
+00005e40: 662e 5f62 7566 6665 7220 3d20 6222 220a  f._buffer = b"".
+00005e50: 2020 2020 2020 2020 6172 6720 3d20 7265          arg = re
+00005e60: 2e73 7562 2862 225c 722b 5c6e 222c 2062  .sub(b"\r+\n", b
+00005e70: 225c 6e22 2c20 6172 6729 0a20 2020 2020  "\n", arg).     
+00005e80: 2020 2061 7267 203d 2061 7267 2e72 6570     arg = arg.rep
+00005e90: 6c61 6365 2862 225c 7831 625b 4a22 2c20  lace(b"\x1b[J", 
+00005ea0: 6222 2229 2020 2020 2020 2020 2020 2020  b"")            
+00005eb0: 2023 2063 6c65 6172 2074 6f20 656e 6420   # clear to end 
+00005ec0: 6f66 2064 6973 706c 6179 0a20 2020 2020  of display.     
+00005ed0: 2020 2061 7267 203d 2072 652e 7375 6228     arg = re.sub(
+00005ee0: 6272 225c 7831 625c 5b5b 302d 395d 2b28  br"\x1b\[[0-9]+(
+00005ef0: 3f3a 3b5b 302d 395d 2b29 2a6d 222c 2062  ?:;[0-9]+)*m", b
+00005f00: 2222 2c20 6172 6729 2023 2063 6f6c 6f72  "", arg) # color
+00005f10: 0a20 2020 2020 2020 2061 7267 203d 2061  .        arg = a
+00005f20: 7267 2e72 6570 6c61 6365 2862 225c 7831  rg.replace(b"\x1
+00005f30: 625b 366e 222c 2062 2222 2920 2020 2020  b[6n", b"")     
+00005f40: 2020 2020 2020 2023 2071 7565 7279 2063         # query c
+00005f50: 7572 736f 7220 706f 7369 7469 6f6e 0a20  ursor position. 
+00005f60: 2020 2020 2020 2061 7267 203d 2061 7267         arg = arg
+00005f70: 2e72 6570 6c61 6365 2862 225c 7831 625b  .replace(b"\x1b[
+00005f80: 3f31 6c22 2c20 6222 2229 2020 2020 2020  ?1l", b"")      
+00005f90: 2020 2020 2023 206e 6f72 6d61 6c20 6375       # normal cu
+00005fa0: 7273 6f72 206b 6579 730a 2020 2020 2020  rsor keys.      
+00005fb0: 2020 6172 6720 3d20 6172 672e 7265 706c    arg = arg.repl
+00005fc0: 6163 6528 6222 5c78 3162 5b3f 376c 222c  ace(b"\x1b[?7l",
+00005fd0: 2062 2222 2920 2020 2020 2020 2020 2020   b"")           
+00005fe0: 2320 6e6f 2077 7261 7061 726f 756e 6420  # no wraparound 
+00005ff0: 6d6f 6465 0a20 2020 2020 2020 2061 7267  mode.        arg
+00006000: 203d 2061 7267 2e72 6570 6c61 6365 2862   = arg.replace(b
+00006010: 225c 7831 625b 3f31 326c 222c 2062 2222  "\x1b[?12l", b""
+00006020: 2920 2020 2020 2020 2020 2023 2073 746f  )          # sto
+00006030: 7020 626c 696e 6b69 6e67 2063 7572 736f  p blinking curso
+00006040: 720a 2020 2020 2020 2020 6172 6720 3d20  r.        arg = 
+00006050: 6172 672e 7265 706c 6163 6528 6222 5c78  arg.replace(b"\x
+00006060: 3162 5b3f 3235 6c22 2c20 6222 2229 2020  1b[?25l", b"")  
+00006070: 2020 2020 2020 2020 2320 6869 6465 2063          # hide c
+00006080: 7572 736f 720a 2020 2020 2020 2020 6172  ursor.        ar
+00006090: 6720 3d20 6172 672e 7265 706c 6163 6528  g = arg.replace(
+000060a0: 6222 5c78 3162 5b3f 3230 3034 6c22 2c20  b"\x1b[?2004l", 
+000060b0: 6222 2229 2020 2020 2020 2020 2320 6e6f  b"")        # no
+000060c0: 2062 7261 636b 6574 6564 2070 6173 7465   bracketed paste
+000060d0: 206d 6f64 650a 2020 2020 2020 2020 6172   mode.        ar
+000060e0: 6720 3d20 6172 672e 7265 706c 6163 6528  g = arg.replace(
+000060f0: 6222 5c78 3162 5b3f 3768 222c 2062 2222  b"\x1b[?7h", b""
+00006100: 2920 2020 2020 2020 2020 2020 2320 7772  )           # wr
+00006110: 6170 6172 6f75 6e64 206d 6f64 650a 2020  aparound mode.  
+00006120: 2020 2020 2020 6172 6720 3d20 6172 672e        arg = arg.
+00006130: 7265 706c 6163 6528 6222 5c78 3162 5b3f  replace(b"\x1b[?
+00006140: 3235 6822 2c20 6222 2229 2020 2020 2020  25h", b"")      
+00006150: 2020 2020 2320 7368 6f77 2063 7572 736f      # show curso
+00006160: 720a 2020 2020 2020 2020 6172 6720 3d20  r.        arg = 
+00006170: 6172 672e 7265 706c 6163 6528 6222 5c78  arg.replace(b"\x
+00006180: 3162 5b32 333b 3074 222c 2062 2222 2920  1b[23;0t", b"") 
+00006190: 2020 2020 2020 2020 2023 2072 6573 746f           # resto
+000061a0: 7265 2077 696e 646f 7720 7469 746c 650a  re window title.
+000061b0: 2020 2020 2020 2020 6172 6720 3d20 6172          arg = ar
+000061c0: 672e 7265 706c 6163 6528 6222 5c78 3162  g.replace(b"\x1b
+000061d0: 5b3f 3230 3034 6822 2c20 6222 2229 2020  [?2004h", b"")  
+000061e0: 2020 2020 2020 2320 6272 6163 6b65 7465        # brackete
+000061f0: 6420 7061 7374 6520 6d6f 6465 0a20 2020  d paste mode.   
+00006200: 2020 2020 2061 7267 203d 2061 7267 2e72       arg = arg.r
+00006210: 6570 6c61 6365 2862 275c 7831 625b 3f35  eplace(b'\x1b[?5
+00006220: 685c 7831 625b 3f35 6c27 2c20 6227 2729  h\x1b[?5l', b'')
+00006230: 2020 2023 2076 6973 7561 6c20 6265 6c6c     # visual bell
+00006240: 0a20 2020 2020 2020 2061 7267 203d 2072  .        arg = r
+00006250: 652e 7375 6228 6272 225c 7831 625c 5b28  e.sub(br"\x1b\[(
+00006260: 5b30 2d39 5d2b 2944 5c78 3162 5c5b 5c31  [0-9]+)D\x1b\[\1
+00006270: 4322 2c20 6222 222c 2061 7267 2920 2320  C", b"", arg) # 
+00006280: 6c65 6674 382c 7269 6768 7438 206e 6f2d  left8,right8 no-
+00006290: 6f70 2028 7372 736c 793f 290a 2020 2020  op (srsly?).    
+000062a0: 2020 2020 6172 6720 3d20 6172 672e 7265      arg = arg.re
+000062b0: 706c 6163 6528 6227 5c78 3162 5b3f 3130  place(b'\x1b[?10
+000062c0: 3334 6827 2c20 6227 2729 2020 2020 2020  34h', b'')      
+000062d0: 2020 2320 6d65 7461 206b 6579 0a20 2020    # meta key.   
+000062e0: 2020 2020 2061 7267 203d 2061 7267 2e72       arg = arg.r
+000062f0: 6570 6c61 6365 2862 275c 7831 623e 272c  eplace(b'\x1b>',
+00006300: 2062 2727 2920 2020 2020 2020 2020 2020   b'')           
+00006310: 2020 2023 206b 6579 7061 6420 6e75 6d65     # keypad nume
+00006320: 7269 6320 6d6f 6465 2028 3f3f 3f29 0a20  ric mode (???). 
+00006330: 2020 2020 2020 2061 7267 203d 2061 7267         arg = arg
+00006340: 2e72 6570 6c61 6365 2862 273f 5b33 336d  .replace(b'?[33m
+00006350: 272c 2062 2727 2920 2020 2020 2020 2020  ', b'')         
+00006360: 2020 2020 2023 2028 3f3f 3f29 0a20 2020       # (???).   
+00006370: 2020 2020 2061 7267 203d 2061 7267 2e72       arg = arg.r
+00006380: 6570 6c61 6365 2862 273f 5b30 6d27 2c20  eplace(b'?[0m', 
+00006390: 6227 2729 2020 2020 2020 2020 2020 2020  b'')            
+000063a0: 2020 2320 283f 3f3f 290a 0a20 2020 2020    # (???)..     
+000063b0: 2020 200a 2020 2020 2020 2020 2320 6375     .        # cu
+000063c0: 7273 6f72 206d 6f76 656d 656e 7420 6f6e  rsor movement on
+000063d0: 2050 544b 2033 2e30 2e36 2b20 636f 6d70   PTK 3.0.6+ comp
+000063e0: 7574 6520 7468 6520 6e75 6d62 6572 206f  ute the number o
+000063f0: 6620 6261 636b 2061 6e64 2066 6f72 7468  f back and forth
+00006400: 2061 6e64 0a20 2020 2020 2020 2023 2069   and.        # i
+00006410: 6e73 6572 7420 7468 6174 206d 616e 7920  nsert that many 
+00006420: 7370 6163 6573 2e0a 2020 2020 2020 2020  spaces..        
+00006430: 7061 7420 3d20 6272 225c 7831 625c 5b28  pat = br"\x1b\[(
+00006440: 5c64 2b29 445c 7831 625c 5b28 5c64 2b29  \d+)D\x1b\[(\d+)
+00006450: 4322 0a20 2020 2020 2020 206d 6174 6368  C".        match
+00006460: 203d 2072 652e 7365 6172 6368 2870 6174   = re.search(pat
+00006470: 2c20 6172 6729 0a0a 2020 2020 2020 2020  , arg)..        
+00006480: 7768 696c 6520 6d61 7463 683a 0a20 2020  while match:.   
+00006490: 2020 2020 2020 2020 2062 6163 6b77 6172           backwar
+000064a0: 642c 2066 6f72 7761 7264 203d 206d 6174  d, forward = mat
+000064b0: 6368 2e67 726f 7570 7328 290a 2020 2020  ch.groups().    
+000064c0: 2020 2020 2020 2020 6261 636b 7761 7264          backward
+000064d0: 2c20 666f 7277 6172 6420 3d20 696e 7428  , forward = int(
+000064e0: 6261 636b 7761 7264 292c 2069 6e74 2866  backward), int(f
+000064f0: 6f72 7761 7264 290a 2020 2020 2020 2020  orward).        
+00006500: 2020 2020 6e5f 7370 6163 6573 203d 2066      n_spaces = f
+00006510: 6f72 7761 7264 202d 2062 6163 6b77 6172  orward - backwar
+00006520: 640a 2020 2020 2020 2020 2020 2020 7374  d.            st
+00006530: 6172 742c 2073 746f 7020 3d20 6d61 7463  art, stop = matc
+00006540: 682e 7374 6172 7428 292c 206d 6174 6368  h.start(), match
+00006550: 2e65 6e64 2829 0a20 2020 2020 2020 2020  .end().         
+00006560: 2020 2061 7267 203d 2061 7267 5b3a 7374     arg = arg[:st
+00006570: 6172 745d 2b6e 5f73 7061 6365 732a 6227  art]+n_spaces*b'
+00006580: 2027 2b61 7267 5b73 746f 703a 5d0a 2020   '+arg[stop:].  
+00006590: 2020 2020 2020 2020 2020 6d61 7463 6820            match 
+000065a0: 3d20 7265 2e73 6561 7263 6828 7061 742c  = re.search(pat,
+000065b0: 2061 7267 290a 0a0a 0a20 2020 2020 2020   arg)....       
+000065c0: 2061 7267 203d 2072 652e 7375 6228 6272   arg = re.sub(br
+000065d0: 225c 6e5c 7831 625c 5b5b 302d 395d 2a43  "\n\x1b\[[0-9]*C
+000065e0: 222c 2062 2222 2c20 6172 6729 2023 206d  ", b"", arg) # m
+000065f0: 6f76 6520 6375 7273 6f72 2072 6967 6874  ove cursor right
+00006600: 2069 6d6d 6564 6961 7465 6c79 2061 6674   immediately aft
+00006610: 6572 2061 206e 6577 6c69 6e65 0a20 2020  er a newline.   
+00006620: 2020 2020 2023 2043 7572 736f 7220 6d6f       # Cursor mo
+00006630: 7665 6d65 6e74 2e20 5765 2061 7373 756d  vement. We assum
+00006640: 6520 7468 6973 2069 7320 7573 6564 206f  e this is used o
+00006650: 6e6c 7920 666f 7220 706c 6163 6573 2074  nly for places t
+00006660: 6861 7420 6861 7665 2027 2e2e 2e27 0a20  hat have '...'. 
+00006670: 2020 2020 2020 2023 2069 6e20 7468 6520         # in the 
+00006680: 7465 7374 732e 0a20 2020 2020 2020 2023  tests..        #
+00006690: 2061 7267 203d 2072 652e 7375 6228 6222   arg = re.sub(b"
+000066a0: 5c5c 5c78 3162 5c5c 5b5c 5c3f 3130 3439  \\\x1b\\[\\?1049
+000066b0: 682e 2a5c 5c5c 7831 625c 5c5b 5c5c 3f31  h.*\\\x1b\\[\\?1
+000066c0: 3034 396c 222c 2062 2222 2c20 6172 6729  049l", b"", arg)
+000066d0: 0a0a 2020 2020 2020 2020 2320 4173 7375  ..        # Assu
+000066e0: 6d65 2045 5343 5b35 4461 6263 645c 6e20  me ESC[5Dabcd\n 
+000066f0: 6973 2072 6577 7269 7469 6e67 2070 7265  is rewriting pre
+00006700: 7669 6f75 7320 7465 7874 3b20 6465 6c65  vious text; dele
+00006710: 7465 2069 742e 204f 6e6c 7920 646f 0a20  te it. Only do. 
+00006720: 2020 2020 2020 2023 2073 6f20 6966 2074         # so if t
+00006730: 6865 206c 696e 6520 646f 6573 204e 4f54  he line does NOT
+00006740: 2068 6176 6520 275b 5059 464c 5942 595d   have '[PYFLYBY]
+00006750: 2720 6f72 2061 2043 5052 2072 6571 7565  ' or a CPR reque
+00006760: 7374 2077 6172 6e69 6e67 2e0a 2020 2020  st warning..    
+00006770: 2020 2020 2320 544f 444f 3a20 6669 6e64      # TODO: find
+00006780: 2061 206c 6573 7320 6861 636b 7920 7761   a less hacky wa
+00006790: 7920 746f 2068 616e 646c 6520 7468 6973  y to handle this
+000067a0: 2077 6974 686f 7574 2068 6172 6463 6f64   without hardcod
+000067b0: 696e 670a 2020 2020 2020 2020 2320 275b  ing.        # '[
+000067c0: 5059 464c 5942 595d 272e 0a20 2020 2020  PYFLYBY]'..     
+000067d0: 2020 206c 6566 7420 3d20 6222 220a 2020     left = b"".  
+000067e0: 2020 2020 2020 7269 6768 7420 3d20 6172        right = ar
+000067f0: 670a 2020 2020 2020 2020 7768 696c 6520  g.        while 
+00006800: 7269 6768 743a 0a20 2020 2020 2020 2020  right:.         
+00006810: 2020 206d 203d 2072 652e 7365 6172 6368     m = re.search
+00006820: 2862 7222 5c78 3162 5c5b 5b30 2d39 5d2b  (br"\x1b\[[0-9]+
+00006830: 442e 2a3f 5c6e 222c 2072 6967 6874 290a  D.*?\n", right).
+00006840: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00006850: 6f74 206d 3a0a 2020 2020 2020 2020 2020  ot m:.          
+00006860: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+00006870: 2020 2020 2020 2020 6966 2062 275b 5059          if b'[PY
+00006880: 464c 5942 595d 2720 696e 206d 2e67 726f  FLYBY]' in m.gro
+00006890: 7570 2829 206f 7220 6227 5741 524e 494e  up() or b'WARNIN
+000068a0: 4727 2069 6e20 6d2e 6772 6f75 7028 293a  G' in m.group():
+000068b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000068c0: 206c 6566 7420 2b3d 2072 6967 6874 5b3a   left += right[:
+000068d0: 6d2e 656e 6428 295d 0a20 2020 2020 2020  m.end()].       
+000068e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000068f0: 2020 2020 2020 2020 2020 206c 6566 7420             left 
+00006900: 2b3d 2072 6967 6874 5b3a 6d2e 7374 6172  += right[:m.star
+00006910: 7428 295d 202b 2062 275c 6e27 0a20 2020  t()] + b'\n'.   
+00006920: 2020 2020 2020 2020 2072 6967 6874 203d           right =
+00006930: 2072 6967 6874 5b6d 2e65 6e64 2829 3a5d   right[m.end():]
+00006940: 0a20 2020 2020 2020 2061 7267 203d 206c  .        arg = l
+00006950: 6566 7420 2b20 7269 6768 740a 2020 2020  eft + right.    
+00006960: 2020 2020 2320 4173 7375 6d65 2045 5343      # Assume ESC
+00006970: 5b33 415c 6e6c 696e 6531 5c6e 6c69 6e65  [3A\nline1\nline
+00006980: 325c 6e6c 696e 6533 5c6e 2069 7320 7265  2\nline3\n is re
+00006990: 7772 6974 696e 6720 7072 6576 696f 7573  writing previous
+000069a0: 2074 6578 743b 0a20 2020 2020 2020 2023   text;.        #
+000069b0: 2064 656c 6574 6520 6974 2e0a 2020 2020   delete it..    
+000069c0: 2020 2020 6c65 6674 203d 2062 2222 0a20      left = b"". 
+000069d0: 2020 2020 2020 2072 6967 6874 203d 2061         right = a
+000069e0: 7267 0a20 2020 2020 2020 2077 6869 6c65  rg.        while
+000069f0: 2072 6967 6874 3a0a 2020 2020 2020 2020   right:.        
+00006a00: 2020 2020 6d20 3d20 7265 2e73 6561 7263      m = re.searc
+00006a10: 6828 6272 225c 7831 625c 5b28 5b30 2d39  h(br"\x1b\[([0-9
+00006a20: 5d2b 2941 5c6e 222c 2072 6967 6874 290a  ]+)A\n", right).
+00006a30: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00006a40: 6f74 206d 3a0a 2020 2020 2020 2020 2020  ot m:.          
+00006a50: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+00006a60: 2020 2020 2020 2020 6e75 6d20 3d20 696e          num = in
+00006a70: 7428 6d2e 6772 6f75 7028 3129 290a 2020  t(m.group(1)).  
+00006a80: 2020 2020 2020 2020 2020 656e 6420 3d20            end = 
+00006a90: 6d2e 656e 6428 290a 2020 2020 2020 2020  m.end().        
+00006aa0: 2020 2020 7375 6666 6978 203d 2072 6967      suffix = rig
+00006ab0: 6874 5b65 6e64 3a5d 0a20 2020 2020 2020  ht[end:].       
+00006ac0: 2020 2020 2023 2073 706c 6974 6c69 6e65       # splitline
+00006ad0: 7320 696e 636c 7564 6573 205c 7220 6173  s includes \r as
+00006ae0: 2061 206c 696e 6520 6465 6c69 6d69 7465   a line delimite
+00006af0: 722c 2077 6869 6368 2077 6520 646f 206e  r, which we do n
+00006b00: 6f74 2077 616e 740a 2020 2020 2020 2020  ot want.        
+00006b10: 2020 2020 7375 6666 6978 5f6c 696e 6573      suffix_lines
+00006b20: 203d 2073 7566 6669 782e 7370 6c69 7428   = suffix.split(
+00006b30: 6227 5c6e 2729 0a20 2020 2020 2020 2020  b'\n').         
+00006b40: 2020 206c 6566 7420 3d20 6c65 6674 202b     left = left +
+00006b50: 2072 6967 6874 5b3a 6d2e 7374 6172 7428   right[:m.start(
+00006b60: 295d 0a20 2020 2020 2020 2020 2020 2069  )].            i
+00006b70: 6620 6c65 6e28 7375 6666 6978 5f6c 696e  f len(suffix_lin
+00006b80: 6573 2920 3c3d 206e 756d 3a0a 2020 2020  es) <= num:.    
+00006b90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006ba0: 2e5f 6275 6666 6572 202b 3d20 7269 6768  ._buffer += righ
+00006bb0: 745b 6d2e 7374 6172 7428 293a 5d0a 2020  t[m.start():].  
+00006bc0: 2020 2020 2020 2020 2020 2020 2020 7269                ri
+00006bd0: 6768 7420 3d20 6222 220a 2020 2020 2020  ght = b"".      
+00006be0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+00006bf0: 2020 2020 2020 2020 2020 2020 7269 6768              righ
+00006c00: 7420 3d20 6227 5c6e 272e 6a6f 696e 2873  t = b'\n'.join(s
+00006c10: 7566 6669 785f 6c69 6e65 735b 6e75 6d3a  uffix_lines[num:
+00006c20: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
+00006c30: 6620 7375 6666 6978 2e65 6e64 7377 6974  f suffix.endswit
+00006c40: 6828 6227 5c6e 2729 3a0a 2020 2020 2020  h(b'\n'):.      
+00006c50: 2020 2020 2020 2020 2020 7269 6768 7420            right 
+00006c60: 2b3d 2062 275c 6e27 0a20 2020 2020 2020  += b'\n'.       
+00006c70: 2061 7267 203d 206c 6566 7420 2b20 7269   arg = left + ri
+00006c80: 6768 740a 0a20 2020 2020 2020 2023 205c  ght..        # \
+00006c90: 7245 5343 5b35 4320 6d6f 7665 7320 7468  rESC[5C moves th
+00006ca0: 6520 6375 7273 6f72 2074 6f20 7468 6520  e cursor to the 
+00006cb0: 6265 6769 6e6e 696e 6720 6f66 2074 6865  beginning of the
+00006cc0: 206c 696e 652c 2074 6865 6e20 7269 6768   line, then righ
+00006cd0: 7420 350a 2020 2020 2020 2020 2320 6368  t 5.        # ch
+00006ce0: 6172 6163 7465 7273 2e20 4173 7375 6d65  aracters. Assume
+00006cf0: 2061 6e79 7468 696e 6720 6166 7465 7220   anything after 
+00006d00: 616e 7920 6f66 2074 6865 7365 2069 7320  any of these is 
+00006d10: 6e6f 7420 7072 696e 7465 640a 2020 2020  not printed.    
+00006d20: 2020 2020 2320 2873 686f 756c 6420 6265      # (should be
+00006d30: 206f 6e6c 7920 7370 6163 6520 616e 6420   only space and 
+00006d40: 696e 7669 7369 626c 6520 6368 6172 6163  invisible charac
+00006d50: 7465 7273 292e 2045 7665 7279 7468 696e  ters). Everythin
+00006d60: 6720 7265 706c 6163 6564 0a20 2020 2020  g replaced.     
+00006d70: 2020 2023 2061 626f 7665 2069 7320 7a65     # above is ze
+00006d80: 726f 2077 6964 7468 2c20 736f 2077 6520  ro width, so we 
+00006d90: 6361 6e20 7361 6665 6c79 2064 6f20 7468  can safely do th
+00006da0: 6973 206c 6173 742e 0a20 2020 2020 2020  is last..       
+00006db0: 206c 696e 6573 203d 205b 5d0a 2020 2020   lines = [].    
+00006dc0: 2020 2020 666f 7220 6c69 6e65 2069 6e20      for line in 
+00006dd0: 6172 672e 7370 6c69 7428 6227 5c6e 2729  arg.split(b'\n')
+00006de0: 3a0a 2020 2020 2020 2020 2020 2020 6e20  :.            n 
+00006df0: 3d20 6c65 6e28 6c69 6e65 290a 2020 2020  = len(line).    
+00006e00: 2020 2020 2020 2020 6d20 3d20 4e6f 6e65          m = None
+00006e10: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00006e20: 206d 2069 6e20 7265 2e66 696e 6469 7465   m in re.findite
+00006e30: 7228 6272 275c 725c 7831 625c 5b28 5b30  r(br'\r\x1b\[([0
+00006e40: 2d39 5d2b 2943 272c 206c 696e 6529 3a0a  -9]+)C', line):.
+00006e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e60: 6e20 3d20 696e 7428 6d2e 6772 6f75 7028  n = int(m.group(
+00006e70: 3129 290a 2020 2020 2020 2020 2020 2020  1)).            
+00006e80: 6966 206e 203e 206c 656e 286c 696e 6529  if n > len(line)
+00006e90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006ea0: 2020 7365 6c66 2e5f 6275 6666 6572 202b    self._buffer +
+00006eb0: 3d20 6172 670a 2020 2020 2020 2020 2020  = arg.          
+00006ec0: 2020 2020 2020 6172 6720 3d20 6222 220a        arg = b"".
+00006ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ee0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+00006ef0: 2020 656c 6966 206d 2061 6e64 2062 275c    elif m and b'\
+00006f00: 7831 6227 2069 6e20 6c69 6e65 5b6d 2e65  x1b' in line[m.e
+00006f10: 6e64 2829 3a5d 3a0a 2020 2020 2020 2020  nd():]:.        
+00006f20: 2020 2020 2020 2020 2320 536f 6d65 2065          # Some e
+00006f30: 7363 6170 6520 636f 6465 2077 6173 206f  scape code was o
+00006f40: 6e6c 7920 7365 656e 2070 6172 7469 616c  nly seen partial
+00006f50: 6c79 2061 6e64 2068 656e 6365 2077 6173  ly and hence was
+00006f60: 6e27 740a 2020 2020 2020 2020 2020 2020  n't.            
+00006f70: 2020 2020 2320 7265 706c 6163 6564 2061      # replaced a
+00006f80: 626f 7665 2e20 4966 2077 6520 636c 6561  bove. If we clea
+00006f90: 7265 6420 6974 206e 6f77 2c20 7468 6520  red it now, the 
+00006fa0: 7265 6d61 696e 6465 7220 776f 756c 6420  remainder would 
+00006fb0: 6265 0a20 2020 2020 2020 2020 2020 2020  be.             
+00006fc0: 2020 2023 2073 686f 776e 2061 7320 706c     # shown as pl
+00006fd0: 6169 6e20 7465 7874 2069 6e20 7468 6520  ain text in the 
+00006fe0: 6e65 7874 2061 7267 2e0a 2020 2020 2020  next arg..      
+00006ff0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00007000: 6275 6666 6572 202b 3d20 6172 670a 2020  buffer += arg.  
+00007010: 2020 2020 2020 2020 2020 2020 2020 6172                ar
+00007020: 6720 3d20 6222 220a 2020 2020 2020 2020  g = b"".        
+00007030: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+00007040: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00007050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007060: 6c69 6e65 732e 6170 7065 6e64 286c 696e  lines.append(lin
+00007070: 655b 3a6e 5d29 0a20 2020 2020 2020 2065  e[:n]).        e
+00007080: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00007090: 2061 7267 203d 2062 275c 6e27 2e6a 6f69   arg = b'\n'.joi
+000070a0: 6e28 6c69 6e65 7329 0a0a 2020 2020 2020  n(lines)..      
+000070b0: 2020 6966 2061 7267 2e65 6e64 7377 6974    if arg.endswit
+000070c0: 6828 6227 2027 2a31 3029 3a0a 2020 2020  h(b' '*10):.    
+000070d0: 2020 2020 2020 2020 2320 5072 6f62 6162          # Probab
+000070e0: 6c79 2067 6f69 6e67 2074 6f20 6861 7665  ly going to have
+000070f0: 2073 6f6d 6520 5c72 4553 435b 3543 2074   some \rESC[5C t
+00007100: 7970 6520 636c 6561 7269 6e67 2e20 5468  ype clearing. Th
+00007110: 6572 6520 6361 6e20 6265 0a20 2020 2020  ere can be.     
+00007120: 2020 2020 2020 2023 2039 2073 7061 6365         # 9 space
+00007130: 7320 6672 6f6d 2061 2064 6f75 626c 6520  s from a double 
+00007140: 696e 6465 6e74 6174 696f 6e20 6166 7465  indentation afte
+00007150: 7220 2e2e 2e3a 2028 6375 7272 656e 746c  r ...: (currentl
+00007160: 7920 7468 650a 2020 2020 2020 2020 2020  y the.          
+00007170: 2020 2320 6d6f 7374 2069 6e64 656e 7461    # most indenta
+00007180: 7469 6f6e 2075 7365 6429 2c20 6275 7420  tion used), but 
+00007190: 7468 6520 636c 6561 7269 6e67 2067 656e  the clearing gen
+000071a0: 6572 616c 6c79 2075 7365 7320 6875 6e64  erally uses hund
+000071b0: 7265 6473 0a20 2020 2020 2020 2020 2020  reds.           
+000071c0: 2023 206f 6620 7370 6163 6573 2c20 736f   # of spaces, so
+000071d0: 2074 6869 7320 7368 6f75 6c64 2064 6973   this should dis
+000071e0: 7469 6e67 7569 7368 2074 6865 6d2e 0a20  tinguish them.. 
+000071f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007200: 5f62 7566 6665 7220 2b3d 2061 7267 0a20  _buffer += arg. 
+00007210: 2020 2020 2020 2020 2020 2061 7267 203d             arg =
+00007220: 2062 2222 0a0a 0a20 2020 2020 2020 2023   b""...        #
+00007230: 2055 6e63 6f6d 706c 6574 6564 2065 7363   Uncompleted esc
+00007240: 6170 6520 7365 7175 656e 6365 2061 7420  ape sequence at 
+00007250: 7468 6520 656e 6420 6f66 2074 6865 2073  the end of the s
+00007260: 7472 696e 670a 2020 2020 2020 2020 6966  tring.        if
+00007270: 2072 652e 7365 6172 6368 2862 7222 5c78   re.search(br"\x
+00007280: 3162 5b5e 612d 7a41 2d5a 5d2a 2422 2c20  1b[^a-zA-Z]*$", 
+00007290: 6172 6729 3a0a 2020 2020 2020 2020 2020  arg):.          
+000072a0: 2020 7365 6c66 2e5f 6275 6666 6572 202b    self._buffer +
+000072b0: 3d20 6172 670a 2020 2020 2020 2020 2020  = arg.          
+000072c0: 2020 6172 6720 3d20 6222 220a 0a20 2020    arg = b""..   
+000072d0: 2020 2020 2069 6620 4445 4255 473a 0a20       if DEBUG:. 
+000072e0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+000072f0: 6c66 2e5f 6275 6666 6572 3a0a 2020 2020  lf._buffer:.    
+00007300: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00007310: 7428 2241 6e73 6946 696c 7465 7244 6563  t("AnsiFilterDec
+00007320: 6f64 6572 3a20 2572 203d 3e20 2572 2c20  oder: %r => %r, 
+00007330: 7065 6e64 696e 673a 2025 7222 2025 2028  pending: %r" % (
+00007340: 6172 6730 2c61 7267 2c73 656c 662e 5f62  arg0,arg,self._b
+00007350: 7566 6665 7229 290a 2020 2020 2020 2020  uffer)).        
+00007360: 2020 2020 656c 6966 2061 7267 2021 3d20      elif arg != 
+00007370: 6172 6730 3a0a 2020 2020 2020 2020 2020  arg0:.          
+00007380: 2020 2020 2020 7072 696e 7428 2241 6e73        print("Ans
+00007390: 6946 696c 7465 7244 6563 6f64 6572 3a20  iFilterDecoder: 
+000073a0: 2572 203d 3e20 2572 2220 2520 2861 7267  %r => %r" % (arg
+000073b0: 302c 6172 6729 290a 2020 2020 2020 2020  0,arg)).        
+000073c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000073d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000073e0: 2241 6e73 6946 696c 7465 7244 6563 6f64  "AnsiFilterDecod
+000073f0: 6572 3a20 2572 205b 6e6f 2063 6861 6e67  er: %r [no chang
+00007400: 655d 2220 2520 2861 7267 2c29 290a 2020  e]" % (arg,)).  
+00007410: 2020 2020 2020 7265 7475 726e 2061 7267        return arg
+00007420: 0a0a 0a0a 636c 6173 7320 4d79 5370 6177  ....class MySpaw
+00007430: 6e28 7065 7870 6563 742e 7370 6177 6e29  n(pexpect.spawn)
+00007440: 3a0a 0a20 2020 2064 6566 205f 5f69 6e69  :..    def __ini
+00007450: 745f 5f28 7365 6c66 2c20 2a61 7267 732c  t__(self, *args,
+00007460: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+00007470: 2020 2020 7375 7065 7228 4d79 5370 6177      super(MySpaw
+00007480: 6e2c 2073 656c 6629 2e5f 5f69 6e69 745f  n, self).__init_
+00007490: 5f28 2a61 7267 732c 202a 2a6b 7761 7267  _(*args, **kwarg
+000074a0: 7329 0a20 2020 2020 2020 2023 2046 696c  s).        # Fil
+000074b0: 7465 7220 6f75 7420 7661 7269 6f75 7320  ter out various 
+000074c0: 616e 7369 206e 6f6e 7365 6e73 652e 2020  ansi nonsense.  
+000074d0: 4f76 6572 7269 6465 2073 656c 662e 5f64  Override self._d
+000074e0: 6563 6f64 6572 2e20 2054 6869 7320 6973  ecoder.  This is
+000074f0: 0a20 2020 2020 2020 2023 2063 616c 6c65  .        # calle
+00007500: 6420 6279 2070 6578 7065 6374 2e73 7061  d by pexpect.spa
+00007510: 776e 6261 7365 2e53 7061 776e 4261 7365  wnbase.SpawnBase
+00007520: 2e72 6561 645f 6e6f 6e62 6c6f 636b 696e  .read_nonblockin
+00007530: 672e 2020 5468 6973 2069 730a 2020 2020  g.  This is.    
+00007540: 2020 2020 2320 6e6f 726d 616c 6c79 2069      # normally i
+00007550: 6e69 7469 616c 697a 6564 2062 7920 5370  nitialized by Sp
+00007560: 6177 6e42 6173 652e 5f5f 696e 6974 5f5f  awnBase.__init__
+00007570: 2069 6e74 656e 6465 6420 666f 7220 756e   intended for un
+00007580: 6963 6f64 650a 2020 2020 2020 2020 2320  icode.        # 
+00007590: 6465 636f 6469 6e67 2e20 2054 6869 7320  decoding.  This 
+000075a0: 6973 2061 2062 6974 2068 6163 6b79 2062  is a bit hacky b
+000075b0: 6563 6175 7365 2069 7427 7320 616e 2069  ecause it's an i
+000075c0: 6e74 6572 6e61 6c20 7468 696e 6720 7468  nternal thing th
+000075d0: 6174 0a20 2020 2020 2020 2023 2063 6f75  at.        # cou
+000075e0: 6c64 2063 6861 6e67 652e 0a20 2020 2020  ld change..     
+000075f0: 2020 2073 656c 662e 5f64 6563 6f64 6572     self._decoder
+00007600: 203d 2041 6e73 6946 696c 7465 7244 6563   = AnsiFilterDec
+00007610: 6f64 6572 2829 0a20 2020 2020 2020 2073  oder().        s
+00007620: 656c 662e 7374 725f 6c61 7374 5f63 6861  elf.str_last_cha
+00007630: 7273 203d 2031 3030 300a 0a20 2020 2064  rs = 1000..    d
+00007640: 6566 2073 656e 6428 7365 6c66 2c20 6172  ef send(self, ar
+00007650: 6729 3a0a 2020 2020 2020 2020 6966 2044  g):.        if D
+00007660: 4542 5547 3a0a 2020 2020 2020 2020 2020  EBUG:.          
+00007670: 2020 7072 696e 7428 224d 7953 7061 776e    print("MySpawn
+00007680: 2e73 656e 6428 2572 2922 2025 2028 6172  .send(%r)" % (ar
+00007690: 672c 2929 0a20 2020 2020 2020 2072 6574  g,)).        ret
+000076a0: 7572 6e20 7375 7065 7228 4d79 5370 6177  urn super(MySpaw
+000076b0: 6e2c 2073 656c 6629 2e73 656e 6428 6172  n, self).send(ar
+000076c0: 6729 0a0a 0a20 2020 2064 6566 2065 7870  g)...    def exp
+000076d0: 6563 7428 7365 6c66 2c20 6172 672c 2074  ect(self, arg, t
+000076e0: 696d 656f 7574 3d44 4546 4155 4c54 5f54  imeout=DEFAULT_T
+000076f0: 494d 454f 5554 293a 0a20 2020 2020 2020  IMEOUT):.       
+00007700: 2069 6620 4445 4255 473a 0a20 2020 2020   if DEBUG:.     
+00007710: 2020 2020 2020 2070 7269 6e74 2822 4d79         print("My
+00007720: 5370 6177 6e2e 6578 7065 6374 2825 7229  Spawn.expect(%r)
+00007730: 2220 2520 2861 7267 2c29 290a 2020 2020  " % (arg,)).    
+00007740: 2020 2020 7265 7475 726e 2073 7570 6572      return super
+00007750: 284d 7953 7061 776e 2c20 7365 6c66 292e  (MySpawn, self).
+00007760: 6578 7065 6374 2861 7267 2c20 7469 6d65  expect(arg, time
+00007770: 6f75 743d 7469 6d65 6f75 7429 0a0a 0a20  out=timeout)... 
+00007780: 2020 2064 6566 2065 7870 6563 745f 6578     def expect_ex
+00007790: 6163 7428 7365 6c66 2c20 6172 672c 2074  act(self, arg, t
+000077a0: 696d 656f 7574 3d44 4546 4155 4c54 5f54  imeout=DEFAULT_T
+000077b0: 494d 454f 5554 293a 0a20 2020 2020 2020  IMEOUT):.       
+000077c0: 2069 6620 4445 4255 473a 0a20 2020 2020   if DEBUG:.     
+000077d0: 2020 2020 2020 2070 7269 6e74 2822 4d79         print("My
+000077e0: 5370 6177 6e2e 6578 7065 6374 5f65 7861  Spawn.expect_exa
+000077f0: 6374 2825 7229 2220 2520 2861 7267 2c29  ct(%r)" % (arg,)
+00007800: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00007810: 2073 7570 6572 284d 7953 7061 776e 2c20   super(MySpawn, 
+00007820: 7365 6c66 292e 6578 7065 6374 5f65 7861  self).expect_exa
+00007830: 6374 2861 7267 2c20 7469 6d65 6f75 743d  ct(arg, timeout=
+00007840: 7469 6d65 6f75 7429 0a0a 0a0a 636c 6173  timeout)....clas
+00007850: 7320 4578 7065 6374 4572 726f 7228 4578  s ExpectError(Ex
+00007860: 6365 7074 696f 6e29 3a0a 2020 2020 6465  ception):.    de
+00007870: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00007880: 2065 2c20 6368 696c 6429 3a0a 2020 2020   e, child):.    
+00007890: 2020 2020 7365 6c66 2e65 203d 2065 0a20      self.e = e. 
+000078a0: 2020 2020 2020 2073 656c 662e 6368 696c         self.chil
+000078b0: 6420 3d20 6368 696c 640a 2020 2020 2020  d = child.      
+000078c0: 2020 7365 6c66 2e61 7267 7320 3d20 2865    self.args = (e
+000078d0: 2c20 6368 696c 6429 0a0a 2020 2020 6465  , child)..    de
+000078e0: 6620 5f5f 7374 725f 5f28 7365 6c66 293a  f __str__(self):
+000078f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00007900: 2225 7320 696e 2025 7322 2025 2028 0a20  "%s in %s" % (. 
+00007910: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007920: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
+00007930: 6d65 5f5f 2c20 2720 272e 6a6f 696e 2873  me__, ' '.join(s
+00007940: 656c 662e 6368 696c 642e 6172 6773 2929  elf.child.args))
+00007950: 0a0a 0a40 636f 6e74 6578 746d 616e 6167  ...@contextmanag
+00007960: 6572 0a64 6566 2049 5079 7468 6f6e 4374  er.def IPythonCt
+00007970: 7828 7072 6f67 3d22 6970 7974 686f 6e22  x(prog="ipython"
+00007980: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00007990: 2061 7267 733d 5b5d 2c0a 2020 2020 2020   args=[],.      
+000079a0: 2020 2020 2020 2020 2061 7574 6f63 616c           autocal
+000079b0: 6c3d 4661 6c73 652c 0a20 2020 2020 2020  l=False,.       
+000079c0: 2020 2020 2020 2020 6672 6f6e 7465 6e64          frontend
+000079d0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
+000079e0: 2020 2020 2020 6970 7974 686f 6e5f 6469        ipython_di
+000079f0: 723d 4e6f 6e65 2c0a 2020 2020 2020 2020  r=None,.        
+00007a00: 2020 2020 2020 2050 5954 484f 4e50 4154         PYTHONPAT
+00007a10: 483d 5b5d 2c0a 2020 2020 2020 2020 2020  H=[],.          
+00007a20: 2020 2020 2050 5946 4c59 4259 5f50 4154       PYFLYBY_PAT
+00007a30: 483d 5059 464c 5942 595f 5041 5448 2c0a  H=PYFLYBY_PATH,.
+00007a40: 2020 2020 2020 2020 2020 2020 2020 2050                 P
+00007a50: 5946 4c59 4259 5f4c 4f47 5f4c 4556 454c  YFLYBY_LOG_LEVEL
+00007a60: 3d22 2229 3a0a 2020 2020 2222 220a 2020  =""):.    """.  
+00007a70: 2020 5370 6177 6e20 4950 7974 686f 6e20    Spawn IPython 
+00007a80: 696e 2061 2070 7479 2073 7562 7072 6f63  in a pty subproc
+00007a90: 6573 732e 2020 5365 6e64 2069 7420 696e  ess.  Send it in
+00007aa0: 7075 7420 616e 6420 6578 7065 6374 206f  put and expect o
+00007ab0: 7574 7075 742e 0a0a 2020 2020 3a70 6172  utput...    :par
+00007ac0: 616d 2066 726f 6e74 656e 643a 0a20 2020  am frontend:.   
+00007ad0: 2020 2057 6869 6368 2074 6572 6d69 6e61     Which termina
+00007ae0: 6c20 6672 6f6e 7465 6e64 2074 6f20 7573  l frontend to us
+00007af0: 653a 2072 6561 646c 696e 6520 2864 6566  e: readline (def
+00007b00: 6175 6c74 2066 6f72 2049 5079 7468 6f6e  ault for IPython
+00007b10: 203c 3529 206f 720a 2020 2020 2020 7072   <5) or.      pr
+00007b20: 6f6d 7074 5f74 6f6f 6c6b 6974 2028 6465  ompt_toolkit (de
+00007b30: 6661 756c 7420 666f 7220 4950 7974 686f  fault for IPytho
+00007b40: 6e20 3e3d 3529 2e0a 2020 2020 2020 4950  n >=5)..      IP
+00007b50: 7974 686f 6e20 3420 616e 6420 6561 726c  ython 4 and earl
+00007b60: 6965 7220 6f6e 6c79 2073 7570 706f 7274  ier only support
+00007b70: 2072 6561 646c 696e 652e 0a20 2020 2020   readline..     
+00007b80: 2049 5079 7468 6f6e 2035 2e30 2074 6872   IPython 5.0 thr
+00007b90: 6f75 6768 2035 2e33 206f 6e6c 7920 7375  ough 5.3 only su
+00007ba0: 7070 6f72 7420 7072 6f6d 7074 5f74 6f6f  pport prompt_too
+00007bb0: 6c6b 6974 2e0a 2020 2020 2020 4950 7974  lkit..      IPyt
+00007bc0: 686f 6e20 352e 3420 616e 6420 6c61 7465  hon 5.4 and late
+00007bd0: 7220 7375 7070 6f72 7420 626f 7468 2072  r support both r
+00007be0: 6561 646c 696e 6520 616e 6420 7072 6f6d  eadline and prom
+00007bf0: 7074 5f74 6f6f 6c6b 6974 2e0a 2020 2020  pt_toolkit..    
+00007c00: 2222 220a 2020 2020 5f5f 7472 6163 6562  """.    __traceb
+00007c10: 6163 6b68 6964 655f 5f20 3d20 5472 7565  ackhide__ = True
+00007c20: 0a20 2020 2069 6620 6861 7361 7474 7228  .    if hasattr(
+00007c30: 5059 464c 5942 595f 5041 5448 2c20 2277  PYFLYBY_PATH, "w
+00007c40: 7269 7465 2229 3a0a 2020 2020 2020 2020  rite"):.        
+00007c50: 5059 464c 5942 595f 5041 5448 203d 2050  PYFLYBY_PATH = P
+00007c60: 5946 4c59 4259 5f50 4154 482e 6e61 6d65  YFLYBY_PATH.name
+00007c70: 0a20 2020 2050 5946 4c59 4259 5f50 4154  .    PYFLYBY_PAT
+00007c80: 4820 3d20 7374 7228 4669 6c65 6e61 6d65  H = str(Filename
+00007c90: 2850 5946 4c59 4259 5f50 4154 4829 290a  (PYFLYBY_PATH)).
+00007ca0: 2020 2020 636c 6561 6e75 705f 6469 7273      cleanup_dirs
+00007cb0: 203d 205b 5d0a 2020 2020 2320 4372 6561   = [].    # Crea
+00007cc0: 7465 2061 2074 656d 706f 7261 7279 2064  te a temporary d
+00007cd0: 6972 6563 746f 7279 2077 6869 6368 2077  irectory which w
+00007ce0: 6527 6c6c 2075 7365 2061 7320 6f75 7220  e'll use as our 
+00007cf0: 4950 5954 484f 4e44 4952 2e0a 2020 2020  IPYTHONDIR..    
+00007d00: 6966 206e 6f74 2069 7079 7468 6f6e 5f64  if not ipython_d
+00007d10: 6972 3a0a 2020 2020 2020 2020 6970 7974  ir:.        ipyt
+00007d20: 686f 6e5f 6469 7220 3d20 6d6b 6474 656d  hon_dir = mkdtem
+00007d30: 7028 7072 6566 6978 3d22 7079 666c 7962  p(prefix="pyflyb
+00007d40: 795f 7465 7374 5f69 7079 7468 6f6e 5f22  y_test_ipython_"
+00007d50: 2c20 7375 6666 6978 3d22 2e74 6d70 2229  , suffix=".tmp")
+00007d60: 0a20 2020 2020 2020 205f 696e 6974 5f69  .        _init_i
+00007d70: 7079 7468 6f6e 5f64 6972 2869 7079 7468  python_dir(ipyth
+00007d80: 6f6e 5f64 6972 290a 2020 2020 2020 2020  on_dir).        
+00007d90: 636c 6561 6e75 705f 6469 7273 2e61 7070  cleanup_dirs.app
+00007da0: 656e 6428 6970 7974 686f 6e5f 6469 7229  end(ipython_dir)
+00007db0: 0a20 2020 2023 2043 7265 6174 6520 616e  .    # Create an
+00007dc0: 2065 6d70 7479 2064 6972 6563 746f 7279   empty directory
+00007dd0: 2066 6f72 204d 504c 434f 4e46 4947 4449   for MPLCONFIGDI
+00007de0: 5220 746f 2061 766f 6964 206d 6174 706c  R to avoid matpl
+00007df0: 6f74 6c69 6220 6c6f 6f6b 696e 670a 2020  otlib looking.  
+00007e00: 2020 2320 696e 2024 484f 4d45 2e0a 2020    # in $HOME..  
+00007e10: 2020 6d70 6c63 6f6e 6669 6764 6972 203d    mplconfigdir =
+00007e20: 206d 6b64 7465 6d70 2870 7265 6669 783d   mkdtemp(prefix=
+00007e30: 2270 7966 6c79 6279 5f74 6573 745f 6d61  "pyflyby_test_ma
+00007e40: 7470 6c6f 746c 6962 5f22 2c20 7375 6666  tplotlib_", suff
+00007e50: 6978 3d22 2e74 6d70 2229 0a20 2020 2063  ix=".tmp").    c
+00007e60: 6c65 616e 7570 5f64 6972 732e 6170 7065  leanup_dirs.appe
+00007e70: 6e64 286d 706c 636f 6e66 6967 6469 7229  nd(mplconfigdir)
+00007e80: 0a20 2020 2023 2046 6967 7572 6520 6f75  .    # Figure ou
+00007e90: 7420 6672 6f6e 7465 6e64 2074 6f20 7573  t frontend to us
+00007ea0: 652e 0a20 2020 2066 726f 6e74 656e 6420  e..    frontend 
+00007eb0: 3d20 5f69 6e74 6572 7072 6574 5f66 726f  = _interpret_fro
+00007ec0: 6e74 656e 645f 6172 6728 6672 6f6e 7465  ntend_arg(fronte
+00007ed0: 6e64 290a 2020 2020 6368 696c 6420 3d20  nd).    child = 
+00007ee0: 4e6f 6e65 0a20 2020 206f 7574 7075 7420  None.    output 
+00007ef0: 3d20 4279 7465 7349 4f28 290a 2020 2020  = BytesIO().    
+00007f00: 7472 793a 0a20 2020 2020 2020 2023 2050  try:.        # P
+00007f10: 7265 7061 7265 2065 6e76 6972 6f6e 6d65  repare environme
+00007f20: 6e74 2076 6172 6961 626c 6573 2e0a 2020  nt variables..  
+00007f30: 2020 2020 2020 656e 7620 3d20 7b7d 0a20        env = {}. 
+00007f40: 2020 2020 2020 2065 6e76 5b22 5059 464c         env["PYFL
+00007f50: 5942 595f 5041 5448 225d 2020 2020 2020  YBY_PATH"]      
+00007f60: 3d20 5059 464c 5942 595f 5041 5448 0a20  = PYFLYBY_PATH. 
+00007f70: 2020 2020 2020 2065 6e76 5b22 5059 464c         env["PYFL
+00007f80: 5942 595f 4c4f 475f 4c45 5645 4c22 5d20  YBY_LOG_LEVEL"] 
+00007f90: 3d20 5059 464c 5942 595f 4c4f 475f 4c45  = PYFLYBY_LOG_LE
+00007fa0: 5645 4c0a 2020 2020 2020 2020 656e 765b  VEL.        env[
+00007fb0: 2250 5954 484f 4e50 4154 4822 5d20 2020  "PYTHONPATH"]   
+00007fc0: 2020 2020 203d 205f 6275 696c 645f 7079       = _build_py
+00007fd0: 7468 6f6e 7061 7468 2850 5954 484f 4e50  thonpath(PYTHONP
+00007fe0: 4154 4829 0a20 2020 2020 2020 2065 6e76  ATH).        env
+00007ff0: 5b22 5059 5448 4f4e 5354 4152 5455 5022  ["PYTHONSTARTUP"
+00008000: 5d20 2020 2020 3d20 2222 0a20 2020 2020  ]     = "".     
+00008010: 2020 2065 6e76 5b22 4d50 4c43 4f4e 4649     env["MPLCONFI
+00008020: 4744 4952 225d 2020 2020 2020 3d20 6d70  GDIR"]      = mp
+00008030: 6c63 6f6e 6669 6764 6972 0a20 2020 2020  lconfigdir.     
+00008040: 2020 2065 6e76 5b22 5041 5448 225d 2020     env["PATH"]  
+00008050: 2020 2020 2020 2020 2020 2020 3d20 7374              = st
+00008060: 7228 5059 464c 5942 595f 4249 4e2e 7265  r(PYFLYBY_BIN.re
+00008070: 616c 2920 2b20 6f73 2e70 6174 682e 7061  al) + os.path.pa
+00008080: 7468 7365 7020 2b20 6f73 2e65 6e76 6972  thsep + os.envir
+00008090: 6f6e 5b22 5041 5448 225d 0a20 2020 2020  on["PATH"].     
+000080a0: 2020 2065 6e76 5b22 5059 5448 4f4e 4252     env["PYTHONBR
+000080b0: 4541 4b50 4f49 4e54 225d 2020 3d20 2249  EAKPOINT"]  = "I
+000080c0: 5079 7468 6f6e 2e74 6572 6d69 6e61 6c2e  Python.terminal.
+000080d0: 6465 6275 6767 6572 2e73 6574 5f74 7261  debugger.set_tra
+000080e0: 6365 220a 2020 2020 2020 2020 636d 6420  ce".        cmd 
+000080f0: 3d20 5f62 7569 6c64 5f69 7079 7468 6f6e  = _build_ipython
+00008100: 5f63 6d64 2869 7079 7468 6f6e 5f64 6972  _cmd(ipython_dir
+00008110: 2c20 7072 6f67 2c20 6172 6773 2c20 6175  , prog, args, au
+00008120: 746f 6361 6c6c 3d61 7574 6f63 616c 6c2c  tocall=autocall,
+00008130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008150: 2020 6672 6f6e 7465 6e64 3d66 726f 6e74    frontend=front
+00008160: 656e 6429 0a20 2020 2020 2020 2023 2053  end).        # S
+00008170: 7061 776e 2049 5079 7468 6f6e 2e0a 2020  pawn IPython..  
+00008180: 2020 2020 2020 7769 7468 2045 6e76 5661        with EnvVa
+00008190: 7243 7478 282a 2a65 6e76 293a 0a20 2020  rCtx(**env):.   
+000081a0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+000081b0: 2320 5370 6177 6e69 6e67 3a20 2573 2220  # Spawning: %s" 
+000081c0: 2520 2822 2022 2e6a 6f69 6e28 636d 6429  % (" ".join(cmd)
+000081d0: 2929 0a20 2020 2020 2020 2020 2020 2063  )).            c
+000081e0: 6869 6c64 203d 204d 7953 7061 776e 280a  hild = MySpawn(.
+000081f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008200: 636d 645b 305d 2c20 636d 645b 313a 5d2c  cmd[0], cmd[1:],
+00008210: 2065 6368 6f3d 5472 7565 2c20 6469 6d65   echo=True, dime
+00008220: 6e73 696f 6e73 3d28 3130 302c 2039 3030  nsions=(100, 900
+00008230: 292c 2074 696d 656f 7574 3d31 302e 300a  ), timeout=10.0.
+00008240: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00008250: 2020 2020 2020 2320 5265 636f 7264 2066        # Record f
+00008260: 726f 6e74 656e 6420 666f 7220 6f74 6865  rontend for othe
+00008270: 7273 2e0a 2020 2020 2020 2020 6368 696c  rs..        chil
+00008280: 642e 6970 7974 686f 6e5f 6672 6f6e 7465  d.ipython_fronte
+00008290: 6e64 203d 2066 726f 6e74 656e 640a 2020  nd = frontend.  
+000082a0: 2020 2020 2020 2320 4c6f 6720 6f75 7470        # Log outp
+000082b0: 7574 2074 6f20 6120 4279 7465 7349 4f2e  ut to a BytesIO.
+000082c0: 2020 4e6f 7465 2074 6861 7420 7765 2075    Note that we u
+000082d0: 7365 2022 6c6f 6766 696c 655f 7265 6164  se "logfile_read
+000082e0: 222c 206e 6f74 0a20 2020 2020 2020 2023  ", not.        #
+000082f0: 2022 6c6f 6766 696c 6522 2e20 2049 6620   "logfile".  If 
+00008300: 7765 2075 7365 6420 6c6f 6766 696c 652c  we used logfile,
+00008310: 2074 6861 7420 776f 756c 6420 646f 7562   that would doub
+00008320: 6c65 2d6c 6f67 2074 6865 2069 6e70 7574  le-log the input
+00008330: 0a20 2020 2020 2020 2023 2063 6f6d 6d61  .        # comma
+00008340: 6e64 732c 2073 696e 6365 2077 6520 7573  nds, since we us
+00008350: 6564 2065 6368 6f3d 5472 7565 2e20 2028  ed echo=True.  (
+00008360: 5573 696e 6720 6c6f 6766 696c 653d 4279  Using logfile=By
+00008370: 7465 7349 4f20 616e 640a 2020 2020 2020  tesIO and.      
+00008380: 2020 2320 6563 686f 3d46 616c 7365 2077    # echo=False w
+00008390: 6f72 6b73 2066 6f72 206d 6f73 7420 696e  orks for most in
+000083a0: 7075 7473 2c20 6275 7420 646f 6573 6e27  puts, but doesn'
+000083b0: 7420 776f 726b 2066 6f72 2074 6869 6e67  t work for thing
+000083c0: 7320 6c69 6b65 0a20 2020 2020 2020 2023  s like.        #
+000083d0: 2074 6162 2063 6f6d 706c 6574 696f 6e20   tab completion 
+000083e0: 6f75 7470 7574 2e29 0a20 2020 2020 2020  output.).       
+000083f0: 2063 6869 6c64 2e6c 6f67 6669 6c65 5f72   child.logfile_r
+00008400: 6561 6420 3d20 6f75 7470 7574 0a20 2020  ead = output.   
+00008410: 2020 2020 2023 2044 6f6e 2774 2064 656c       # Don't del
+00008420: 6179 2030 2e30 3573 2062 6566 6f72 6520  ay 0.05s before 
+00008430: 7365 6e64 696e 672e 0a20 2020 2020 2020  sending..       
+00008440: 2063 6869 6c64 2e64 656c 6179 6265 666f   child.delaybefo
+00008450: 7265 7365 6e64 203d 2030 2e30 0a20 2020  resend = 0.0.   
+00008460: 2020 2020 2023 2059 6965 6c64 2063 6f6e       # Yield con
+00008470: 7472 6f6c 2074 6f20 6361 6c6c 6572 2e0a  trol to caller..
+00008480: 2020 2020 2020 2020 6368 696c 642e 6970          child.ip
+00008490: 7974 686f 6e5f 6469 7220 3d20 6970 7974  ython_dir = ipyt
+000084a0: 686f 6e5f 6469 720a 2020 2020 2020 2020  hon_dir.        
+000084b0: 7969 656c 6420 6368 696c 640a 2020 2020  yield child.    
+000084c0: 6578 6365 7074 2028 7065 7870 6563 742e  except (pexpect.
+000084d0: 4578 6365 7074 696f 6e50 6578 7065 6374  ExceptionPexpect
+000084e0: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
+000084f0: 7072 696e 7428 2245 7272 6f72 3a20 2573  print("Error: %s
+00008500: 2220 2520 2865 2e5f 5f63 6c61 7373 5f5f  " % (e.__class__
+00008510: 2e5f 5f6e 616d 655f 5f2c 2929 0a20 2020  .__name__,)).   
+00008520: 2020 2020 2070 7269 6e74 2822 4f75 7470       print("Outp
+00008530: 7574 2073 6f20 6661 723a 2229 0a20 2020  ut so far:").   
+00008540: 2020 2020 2072 6573 756c 7420 3d20 5f63       result = _c
+00008550: 6c65 616e 5f69 7079 7468 6f6e 5f6f 7574  lean_ipython_out
+00008560: 7075 7428 6f75 7470 7574 2e67 6574 7661  put(output.getva
+00008570: 6c75 6528 2929 0a20 2020 2020 2020 2070  lue()).        p
+00008580: 7269 6e74 2827 272e 6a6f 696e 2822 2020  rint(''.join("  
+00008590: 2020 2573 5c6e 2225 6c69 6e65 2066 6f72    %s\n"%line for
+000085a0: 206c 696e 6520 696e 2072 6573 756c 742e   line in result.
+000085b0: 7370 6c69 746c 696e 6573 2829 2929 0a20  splitlines())). 
+000085c0: 2020 2020 2020 2070 7269 6e74 2822 4572         print("Er
+000085d0: 726f 7220 6465 7461 696c 733a 2229 0a20  ror details:"). 
+000085e0: 2020 2020 2020 2070 7269 6e74 2827 272e         print(''.
+000085f0: 6a6f 696e 2822 2020 2020 2573 5c6e 2225  join("    %s\n"%
+00008600: 6c69 6e65 2066 6f72 206c 696e 6520 696e  line for line in
+00008610: 2073 7472 2865 292e 7370 6c69 746c 696e   str(e).splitlin
+00008620: 6573 2829 2929 0a20 2020 2020 2020 2023  es())).        #
+00008630: 2052 652d 7261 6973 6520 616e 2065 7863   Re-raise an exc
+00008640: 6570 7469 6f6e 2077 7261 7070 6564 2073  eption wrapped s
+00008650: 6f20 7468 6174 2077 6520 646f 6e27 7420  o that we don't 
+00008660: 7265 2d63 6174 6368 2069 7420 666f 7220  re-catch it for 
+00008670: 7468 650a 2020 2020 2020 2020 2320 7772  the.        # wr
+00008680: 6f6e 6720 6368 696c 642e 0a20 2020 2020  ong child..     
+00008690: 2020 2072 6169 7365 2045 7870 6563 7445     raise ExpectE
+000086a0: 7272 6f72 2865 2c20 6368 696c 6429 2023  rror(e, child) #
+000086b0: 2c20 4e6f 6e65 2c20 7379 732e 6578 635f  , None, sys.exc_
+000086c0: 696e 666f 2829 5b32 5d0a 2020 2020 6669  info()[2].    fi
+000086d0: 6e61 6c6c 793a 0a20 2020 2020 2020 2023  nally:.        #
+000086e0: 2043 6c65 616e 2075 702e 0a20 2020 2020   Clean up..     
+000086f0: 2020 2069 6620 6368 696c 6420 6973 206e     if child is n
+00008700: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00008710: 2020 2020 2063 6869 6c64 2e63 6c6f 7365       child.close
+00008720: 2866 6f72 6365 3d54 7275 6529 0a20 2020  (force=True).   
+00008730: 2020 2020 2066 6f72 2064 2069 6e20 636c       for d in cl
+00008740: 6561 6e75 705f 6469 7273 3a0a 2020 2020  eanup_dirs:.    
+00008750: 2020 2020 2020 2020 726d 7472 6565 2864          rmtree(d
+00008760: 290a 0a0a 6465 6620 5f69 6e74 6572 6163  )...def _interac
+00008770: 745f 6970 7974 686f 6e28 6368 696c 642c  t_ipython(child,
+00008780: 2069 6e70 7574 2c20 6578 6974 7374 723d   input, exitstr=
+00008790: 6222 6578 6974 2829 5c6e 222c 0a20 2020  b"exit()\n",.   
+000087a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000087b0: 2020 2073 656e 6465 6f66 3d46 616c 7365     sendeof=False
+000087c0: 2c20 7761 6974 656f 663d 5472 7565 293a  , waiteof=True):
+000087d0: 0a20 2020 2069 735f 7072 6f6d 7074 5f74  .    is_prompt_t
+000087e0: 6f6f 6c6b 6974 203d 2063 6869 6c64 2e69  oolkit = child.i
+000087f0: 7079 7468 6f6e 5f66 726f 6e74 656e 6420  python_frontend 
+00008800: 3d3d 2022 7072 6f6d 7074 5f74 6f6f 6c6b  == "prompt_toolk
+00008810: 6974 220a 2020 2020 2320 4361 6e6f 6e69  it".    # Canoni
+00008820: 6361 6c69 7a65 2069 6e70 7574 206c 696e  calize input lin
+00008830: 6573 2e0a 2020 2020 696e 7075 7420 3d20  es..    input = 
+00008840: 6465 6465 6e74 2869 6e70 7574 2e64 6563  dedent(input.dec
+00008850: 6f64 6528 2775 7466 2d38 2729 292e 656e  ode('utf-8')).en
+00008860: 636f 6465 2827 7574 662d 3827 290a 2020  code('utf-8').  
+00008870: 2020 696e 7075 7420 3d20 7265 2e73 7562    input = re.sub
+00008880: 2862 7222 5e5c 6e2b 222c 2062 2222 2c20  (br"^\n+", b"", 
+00008890: 696e 7075 7429 0a20 2020 2069 6e70 7574  input).    input
+000088a0: 203d 2072 652e 7375 6228 6272 225c 6e2b   = re.sub(br"\n+
+000088b0: 2422 2c20 6222 222c 2069 6e70 7574 290a  $", b"", input).
+000088c0: 2020 2020 696e 7075 7420 2b3d 2062 225c      input += b"\
+000088d0: 6e22 0a20 2020 2069 6e70 7574 202b 3d20  n".    input += 
+000088e0: 6578 6974 7374 720a 2020 2020 6c69 6e65  exitstr.    line
+000088f0: 7320 3d20 696e 7075 742e 7370 6c69 746c  s = input.splitl
+00008900: 696e 6573 2846 616c 7365 290a 2020 2020  ines(False).    
+00008910: 7072 6576 5f70 726f 6d70 745f 696e 5f69  prev_prompt_in_i
+00008920: 6478 203d 204e 6f6e 650a 2020 2020 2320  dx = None.    # 
+00008930: 4c6f 6f70 206f 7665 7220 6c69 6e65 732e  Loop over lines.
+00008940: 0a20 2020 2066 6f72 206c 696e 6520 696e  .    for line in
+00008950: 206c 696e 6573 3a0a 2020 2020 2020 2020   lines:.        
+00008960: 2320 5761 6974 2066 6f72 2074 6865 2022  # Wait for the "
+00008970: 496e 205b 4e5d 3a22 2070 726f 6d70 742e  In [N]:" prompt.
+00008980: 0a20 2020 2020 2020 2077 6869 6c65 2054  .        while T
+00008990: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
+000089a0: 2065 7870 6563 745f 7265 7375 6c74 203d   expect_result =
+000089b0: 2063 6869 6c64 2e65 7870 6563 7428 5f49   child.expect(_I
+000089c0: 5059 5448 4f4e 5f50 524f 4d50 5453 2c20  PYTHON_PROMPTS, 
+000089d0: 7469 6d65 6f75 743d 4445 4641 554c 545f  timeout=DEFAULT_
+000089e0: 5449 4d45 4f55 5429 0a20 2020 2020 2020  TIMEOUT).       
+000089f0: 2020 2020 2069 6620 6578 7065 6374 5f72       if expect_r
+00008a00: 6573 756c 7420 3d3d 2030 3a0a 2020 2020  esult == 0:.    
+00008a10: 2020 2020 2020 2020 2020 2020 2320 5765              # We
+00008a20: 2067 6f74 2022 496e 205b 4e5d 3a22 2e0a   got "In [N]:"..
+00008a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008a40: 2320 4368 6563 6b20 6966 2077 6520 676f  # Check if we go
+00008a50: 7420 7468 6520 7361 6d65 2070 726f 6d70  t the same promp
+00008a60: 7420 6173 2062 6566 6f72 652e 2020 4966  t as before.  If
+00008a70: 2073 6f20 7468 656e 206b 6565 700a 2020   so then keep.  
+00008a80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00008a90: 6c6f 6f6b 696e 6720 666f 7220 7468 6520  looking for the 
+00008aa0: 6e65 7874 2070 726f 6d70 742e 0a20 2020  next prompt..   
+00008ab0: 2020 2020 2020 2020 2020 2020 2069 6e5f               in_
+00008ac0: 6964 7820 3d20 6368 696c 642e 6d61 7463  idx = child.matc
+00008ad0: 682e 6772 6f75 7028 3129 0a20 2020 2020  h.group(1).     
+00008ae0: 2020 2020 2020 2020 2020 2069 6620 696e             if in
+00008af0: 5f69 6478 203d 3d20 7072 6576 5f70 726f  _idx == prev_pro
+00008b00: 6d70 745f 696e 5f69 6478 3a0a 2020 2020  mpt_in_idx:.    
+00008b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008b20: 2320 5468 6973 2069 7320 7374 696c 6c20  # This is still 
+00008b30: 7468 6520 7361 6d65 2049 6e5b 4e5d 2074  the same In[N] t
+00008b40: 6861 7420 7765 2070 7265 7669 6f75 736c  hat we previousl
+00008b50: 7920 7361 772e 0a20 2020 2020 2020 2020  y saw..         
+00008b60: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00008b70: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+00008b80: 2020 2020 7072 6576 5f70 726f 6d70 745f      prev_prompt_
+00008b90: 696e 5f69 6478 203d 2069 6e5f 6964 780a  in_idx = in_idx.
+00008ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008bb0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+00008bc0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00008bd0: 2020 2020 2020 2020 2320 5765 2067 6f74          # We got
+00008be0: 2022 3e3e 3e22 2c20 222e 2e2e 3a22 2c20   ">>>", "...:", 
+00008bf0: 2269 7064 623e 222c 2065 7463 2e0a 2020  "ipdb>", etc..  
+00008c00: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00008c10: 2069 735f 7072 6f6d 7074 5f74 6f6f 6c6b   is_prompt_toolk
+00008c20: 6974 3a0a 2020 2020 2020 2020 2020 2020  it:.            
+00008c30: 2020 2020 2020 2020 2320 7072 6f6d 7074          # prompt
+00008c40: 5f74 6f6f 6c6b 6974 206d 6967 6874 2072  _toolkit might r
+00008c50: 6577 7269 7465 2022 6970 6462 3e22 2065  ewrite "ipdb>" e
+00008c60: 7463 206d 756c 7469 706c 6520 7469 6d65  tc multiple time
+00008c70: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
+00008c80: 2020 2020 2020 2023 204d 616b 6520 7375         # Make su
+00008c90: 7265 2077 6520 6561 7420 7570 2061 6c6c  re we eat up all
+00008ca0: 2074 6865 206f 7574 7075 7420 736f 2074   the output so t
+00008cb0: 6861 7420 7468 6520 6e65 7874 0a20 2020  hat the next.   
+00008cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008cd0: 2023 2065 7870 6563 7428 2269 7064 623e   # expect("ipdb>
+00008ce0: 2229 2064 6f65 736e 2774 2067 6574 2074  ") doesn't get t
+00008cf0: 6865 2072 6577 7269 7474 656e 2022 6970  he rewritten "ip
+00008d00: 6462 3e22 2066 726f 6d0a 2020 2020 2020  db>" from.      
+00008d10: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00008d20: 7468 6520 7072 6576 696f 7573 206c 696e  the previous lin
+00008d30: 652e 2020 466f 7220 2249 6e20 5b4e 5d22  e.  For "In [N]"
+00008d40: 2c20 7765 2063 616e 2072 656c 7920 6f6e  , we can rely on
+00008d50: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00008d60: 2020 2020 2020 2020 2023 2063 6f75 6e74           # count
+00008d70: 6572 2074 6f20 646f 2074 6861 742e 2020  er to do that.  
+00008d80: 466f 7220 7072 6f6d 7074 7320 7769 7468  For prompts with
+00008d90: 6f75 7420 6120 636f 756e 7465 722c 2077  out a counter, w
+00008da0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00008db0: 2020 2020 2020 2320 6a75 7374 2074 7279        # just try
+00008dc0: 206f 7572 2062 6573 7420 746f 2065 6174   our best to eat
+00008dd0: 2075 7020 7065 6e64 696e 6720 6f75 7470   up pending outp
+00008de0: 7574 2e20 2054 6f64 6f3a 0a20 2020 2020  ut.  Todo:.     
+00008df0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00008e00: 2069 7320 7468 6572 6520 6120 6265 7474   is there a bett
+00008e10: 6572 2077 6179 3f0a 2020 2020 2020 2020  er way?.        
+00008e20: 2020 2020 2020 2020 2020 2020 5f77 6169              _wai
+00008e30: 745f 666f 725f 6f75 7470 7574 2863 6869  t_for_output(chi
+00008e40: 6c64 2c20 7469 6d65 6f75 743d 302e 3035  ld, timeout=0.05
+00008e50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00008e60: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
+00008e70: 6966 206c 696e 652e 7374 6172 7473 7769  if line.startswi
+00008e80: 7468 2862 2220 2229 2061 6e64 2069 735f  th(b" ") and is_
+00008e90: 7072 6f6d 7074 5f74 6f6f 6c6b 6974 2061  prompt_toolkit a
+00008ea0: 6e64 205f 4950 5954 484f 4e5f 5645 5253  nd _IPYTHON_VERS
+00008eb0: 494f 4e20 3c20 2837 2c29 3a0a 2020 2020  ION < (7,):.    
+00008ec0: 2020 2020 2020 2020 2320 436c 6561 7220          # Clear 
+00008ed0: 7468 6520 6c69 6e65 2076 6961 205e 552e  the line via ^U.
+00008ee0: 2054 6869 7320 6973 206e 6565 6465 6420   This is needed 
+00008ef0: 7769 7468 2070 726f 6d70 745f 746f 6f6c  with prompt_tool
+00008f00: 6b69 740a 2020 2020 2020 2020 2020 2020  kit.            
+00008f10: 2320 2849 5079 7468 6f6e 2035 2061 6e64  # (IPython 5 and
+00008f20: 2036 2920 6265 6361 7573 6520 6974 2069   6) because it i
+00008f30: 7320 6e6f 206c 6f6e 6765 7220 706f 7373  s no longer poss
+00008f40: 6962 6c65 2074 6f20 7475 726e 206f 6666  ible to turn off
+00008f50: 0a20 2020 2020 2020 2020 2020 2023 2061  .            # a
+00008f60: 7574 6f69 6e64 656e 742e 2028 4950 7974  utoindent. (IPyt
+00008f70: 686f 6e20 6e6f 7720 7265 6c69 6573 206f  hon now relies o
+00008f80: 6e20 6272 6163 6b65 7465 6420 7061 7374  n bracketed past
+00008f90: 6520 6d6f 6465 3b20 7468 6579 0a20 2020  e mode; they.   
+00008fa0: 2020 2020 2020 2020 2023 2061 7373 756d           # assum
+00008fb0: 6564 2074 6861 7420 7761 7320 7468 6520  ed that was the 
+00008fc0: 6f6e 6c79 2072 6561 736f 6e20 746f 2074  only reason to t
+00008fd0: 7572 6e20 6f66 6620 6175 746f 696e 6465  urn off autoinde
+00008fe0: 6e74 2e20 416e 6f74 6865 720a 2020 2020  nt. Another.    
+00008ff0: 2020 2020 2020 2020 2320 6964 6561 2069          # idea i
+00009000: 7320 746f 2075 7365 2062 7261 636b 6574  s to use bracket
+00009010: 2070 6173 7465 206d 6f64 652c 2069 2e65   paste mode, i.e
+00009020: 2e20 4553 435b 3230 307e 626c 6168 4553  . ESC[200~blahES
+00009030: 435b 3230 317e 2e0a 2020 2020 2020 2020  C[201~..        
+00009040: 2020 2020 2320 4275 7420 7468 6174 2063      # But that c
+00009050: 6175 7365 7320 4950 7974 686f 6e20 746f  auses IPython to
+00009060: 206e 6f74 2070 7269 6e74 2061 2022 2e2e   not print a "..
+00009070: 2e3a 2220 7072 6f6d 7074 2074 6861 7420  .:" prompt that 
+00009080: 6974 0a20 2020 2020 2020 2020 2020 2023  it.            #
+00009090: 2077 6f75 6c64 2062 6520 6e69 6365 2074   would be nice t
+000090a0: 6f20 7365 652e 2054 6869 7320 7761 7320  o see. This was 
+000090b0: 6669 7865 6420 696e 2049 5079 7468 6f6e  fixed in IPython
+000090c0: 2037 2e30 2920 5765 2061 6c73 6f0a 2020   7.0) We also.  
+000090d0: 2020 2020 2020 2020 2020 2320 736c 6565            # slee
+000090e0: 7020 6166 7465 7277 6172 6473 2074 6f20  p afterwards to 
+000090f0: 6d61 6b65 2073 7572 6520 7468 6174 2049  make sure that I
+00009100: 5079 7468 6f6e 2064 6f65 736e 2774 206f  Python doesn't o
+00009110: 7074 696d 697a 6520 7468 650a 2020 2020  ptimize the.    
+00009120: 2020 2020 2020 2020 2320 6f75 7470 7574          # output
+00009130: 2e0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00009140: 466f 7220 6578 616d 706c 652c 2077 6974  For example, wit
+00009150: 686f 7574 2074 6865 2073 6c65 6570 2c20  hout the sleep, 
+00009160: 6966 2049 5079 7468 6f6e 2064 6566 6175  if IPython defau
+00009170: 6c74 6564 2034 2073 7061 6365 7320 616e  lted 4 spaces an
+00009180: 640a 2020 2020 2020 2020 2020 2020 2320  d.            # 
+00009190: 7765 2077 616e 7465 6420 3120 7370 6163  we wanted 1 spac
+000091a0: 652c 2077 6520 776f 756c 6420 7365 6e64  e, we would send
+000091b0: 2022 5e55 2062 6c61 6822 3b20 6166 7465   "^U blah"; afte
+000091c0: 7220 4950 7974 686f 6e20 7072 696e 7465  r IPython printe
+000091d0: 640a 2020 2020 2020 2020 2020 2020 2320  d.            # 
+000091e0: 6f75 7420 7468 6520 3420 7370 6163 6573  out the 4 spaces
+000091f0: 2069 7420 776f 756c 6420 6261 636b 7370   it would backsp
+00009200: 6163 6520 3320 6f66 2074 6865 6d20 616e  ace 3 of them an
+00009210: 6420 756c 7469 6d61 7465 6c79 2064 6f0a  d ultimately do.
+00009220: 2020 2020 2020 2020 2020 2020 2320 2220              # " 
+00009230: 2020 2045 5343 5b33 4420 2020 4553 435b     ESC[3D   ESC[
+00009240: 3344 626c 6168 222e 2020 5468 6174 2773  3Dblah".  That's
+00009250: 2068 6172 6420 666f 7220 7573 2074 6f20   hard for us to 
+00009260: 6d61 7463 682e 2020 4974 2773 0a20 2020  match.  It's.   
+00009270: 2020 2020 2020 2020 2023 2062 6574 7465           # bette
+00009280: 7220 6966 2069 7420 7365 6e64 7320 6f75  r if it sends ou
+00009290: 7420 2220 2020 2020 4553 435b 3444 2020  t "     ESC[4D  
+000092a0: 2020 4553 435b 3444 2062 6c61 6822 2e0a    ESC[4D blah"..
+000092b0: 2020 2020 2020 2020 2020 2020 6368 696c              chil
+000092c0: 642e 7365 6e64 2862 225c 7831 3522 2920  d.send(b"\x15") 
+000092d0: 2320 5e55 0a20 2020 2020 2020 2020 2020  # ^U.           
+000092e0: 2074 696d 652e 736c 6565 7028 302e 3032   time.sleep(0.02
+000092f0: 290a 2020 2020 2020 2020 7768 696c 6520  ).        while 
+00009300: 6c69 6e65 3a0a 2020 2020 2020 2020 2020  line:.          
+00009310: 2020 6c65 6674 2c20 7461 622c 2072 6967    left, tab, rig
+00009320: 6874 203d 206c 696e 652e 7061 7274 6974  ht = line.partit
+00009330: 696f 6e28 6222 5c74 2229 0a20 2020 2020  ion(b"\t").     
+00009340: 2020 2020 2020 2023 2069 6620 4445 4255         # if DEBU
+00009350: 473a 0a20 2020 2020 2020 2020 2020 2023  G:.            #
+00009360: 2020 2020 2070 7269 6e74 2822 5f69 6e74       print("_int
+00009370: 6572 6163 745f 6970 7974 686f 6e28 293a  eract_ipython():
+00009380: 206c 696e 653d 2572 2c20 6c65 6674 3d25   line=%r, left=%
+00009390: 722c 2074 6162 3d25 722c 2072 6967 6874  r, tab=%r, right
+000093a0: 3d25 7222 2025 2028 6c69 6e65 2c20 6c65  =%r" % (line, le
+000093b0: 6674 2c20 7461 622c 2072 6967 6874 2929  ft, tab, right))
+000093c0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+000093d0: 656e 6420 7468 6520 696e 7075 7420 2875  end the input (u
+000093e0: 7020 746f 2074 6162 206f 7220 6e65 776c  p to tab or newl
+000093f0: 696e 6529 2e0a 2020 2020 2020 2020 2020  ine)..          
+00009400: 2020 6368 696c 642e 7365 6e64 286c 6566    child.send(lef
+00009410: 7429 0a20 2020 2020 2020 2020 2020 2023  t).            #
+00009420: 2043 6865 636b 2074 6861 7420 7468 6520   Check that the 
+00009430: 636c 6965 6e74 2049 5079 7468 6f6e 2067  client IPython g
+00009440: 6574 7320 7468 6520 696e 7075 742e 0a20  ets the input.. 
+00009450: 2020 2020 2020 2020 2020 2063 6869 6c64             child
+00009460: 2e65 7870 6563 745f 6578 6163 7428 6c65  .expect_exact(le
+00009470: 6674 2c20 7469 6d65 6f75 743d 4445 4641  ft, timeout=DEFA
+00009480: 554c 545f 5449 4d45 4f55 5429 0a20 2020  ULT_TIMEOUT).   
+00009490: 2020 2020 2020 2020 2069 6620 7461 623a           if tab:
+000094a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000094b0: 2023 2053 656e 6420 7468 6520 7461 622e   # Send the tab.
+000094c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000094d0: 2063 6869 6c64 2e73 656e 6428 7461 6229   child.send(tab)
+000094e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000094f0: 2023 2057 6169 7420 666f 7220 7265 7370   # Wait for resp
+00009500: 6f6e 7365 2074 6f20 7461 622e 0a20 2020  onse to tab..   
+00009510: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00009520: 6620 5f49 5059 5448 4f4e 5f56 4552 5349  f _IPYTHON_VERSI
+00009530: 4f4e 203e 3d20 2835 2c29 3a0a 2020 2020  ON >= (5,):.    
+00009540: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00009550: 735f 7072 6f6d 7074 5f74 6f6f 6c6b 6974  s_prompt_toolkit
+00009560: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00009570: 2020 2020 2020 2320 5768 656e 2075 7369        # When usi
+00009580: 6e67 2070 726f 6d70 745f 746f 6f6c 6b69  ng prompt_toolki
+00009590: 7420 2864 6566 6175 6c74 2066 6f72 2049  t (default for I
+000095a0: 5079 7468 6f6e 2035 2b29 2c20 7765 0a20  Python 5+), we. 
+000095b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095c0: 2020 2023 206e 6565 6420 746f 2077 6169     # need to wai
+000095d0: 7420 666f 7220 6f75 7470 7574 2e0a 2020  t for output..  
 000095e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095f0: 6966 2069 735f 7072 6f6d 7074 5f74 6f6f  if is_prompt_too
-00009600: 6c6b 6974 3a0a 2020 2020 2020 2020 2020  lkit:.          
-00009610: 2020 2020 2020 2020 2020 2320 5768 656e            # When
-00009620: 2075 7369 6e67 2070 726f 6d70 745f 746f   using prompt_to
-00009630: 6f6c 6b69 7420 2864 6566 6175 6c74 2066  olkit (default f
-00009640: 6f72 2049 5079 7468 6f6e 2035 2b29 2c20  or IPython 5+), 
-00009650: 7765 0a20 2020 2020 2020 2020 2020 2020  we.             
-00009660: 2020 2020 2020 2023 206e 6565 6420 746f         # need to
-00009670: 2077 6169 7420 666f 7220 6f75 7470 7574   wait for output
-00009680: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009690: 2020 2020 2020 5f77 6169 745f 666f 725f        _wait_for_
-000096a0: 6f75 7470 7574 2863 6869 6c64 2c20 7469  output(child, ti
-000096b0: 6d65 6f75 743d 312e 3029 0a20 2020 2020  meout=1.0).     
-000096c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000096d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000096e0: 2020 2020 2023 2057 6865 6e20 7573 696e       # When usin
-000096f0: 6720 7265 6164 6c69 6e65 2028 6f6e 6c79  g readline (only
-00009700: 206f 7074 696f 6e20 666f 7220 4950 7974   option for IPyt
-00009710: 686f 6e20 3420 616e 640a 2020 2020 2020  hon 4 and.      
-00009720: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00009730: 6561 726c 6965 7229 2c20 7765 2063 616e  earlier), we can
-00009740: 2075 7365 2074 6865 206e 6f6e 6365 2074   use the nonce t
-00009750: 7269 636b 2e0a 2020 2020 2020 2020 2020  rick..          
-00009760: 2020 2020 2020 2020 2020 5f77 6169 745f            _wait_
-00009770: 6e6f 6e63 6528 6368 696c 6429 0a20 2020  nonce(child).   
-00009780: 2020 2020 2020 2020 206c 696e 6520 3d20           line = 
-00009790: 7269 6768 740a 2020 2020 2020 2020 6368  right.        ch
-000097a0: 696c 642e 7365 6e64 2862 225c 6e22 290a  ild.send(b"\n").
-000097b0: 2020 2020 2320 5765 2772 6520 6669 6e69      # We're fini
-000097c0: 7368 6564 2073 656e 6469 6e67 2069 6e70  shed sending inp
-000097d0: 7574 2063 6f6d 6d61 6e64 732e 2020 5761  ut commands.  Wa
-000097e0: 6974 2066 6f72 2070 726f 6365 7373 2074  it for process t
-000097f0: 6f20 636f 6d70 6c65 7465 2e0a 2020 2020  o complete..    
-00009800: 6966 2073 656e 6465 6f66 3a0a 2020 2020  if sendeof:.    
-00009810: 2020 2020 6368 696c 642e 7365 6e64 656f      child.sendeo
-00009820: 6628 290a 2020 2020 6966 2077 6169 7465  f().    if waite
-00009830: 6f66 3a0a 2020 2020 2020 2020 6368 696c  of:.        chil
-00009840: 642e 6578 7065 6374 2870 6578 7065 6374  d.expect(pexpect
-00009850: 2e45 4f46 2c20 7469 6d65 6f75 743d 4445  .EOF, timeout=DE
-00009860: 4641 554c 545f 5449 4d45 4f55 5429 0a20  FAULT_TIMEOUT). 
-00009870: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00009880: 2063 6869 6c64 2e65 7870 6563 7428 5f49   child.expect(_I
-00009890: 5059 5448 4f4e 5f50 524f 4d50 5453 2c20  PYTHON_PROMPTS, 
-000098a0: 7469 6d65 6f75 743d 4445 4641 554c 545f  timeout=DEFAULT_
-000098b0: 5449 4d45 4f55 5429 0a20 2020 2023 2047  TIMEOUT).    # G
-000098c0: 6574 206f 7574 7075 742e 0a20 2020 206f  et output..    o
-000098d0: 7574 7075 7420 3d20 6368 696c 642e 6c6f  utput = child.lo
-000098e0: 6766 696c 655f 7265 6164 0a20 2020 2072  gfile_read.    r
-000098f0: 6573 756c 7420 3d20 6f75 7470 7574 2e67  esult = output.g
-00009900: 6574 7661 6c75 6528 290a 2020 2020 7265  etvalue().    re
-00009910: 7375 6c74 203d 205f 636c 6561 6e5f 6970  sult = _clean_ip
-00009920: 7974 686f 6e5f 6f75 7470 7574 2872 6573  ython_output(res
-00009930: 756c 7429 0a20 2020 2072 6574 7572 6e20  ult).    return 
-00009940: 7265 7375 6c74 0a0a 0a64 6566 205f 696e  result...def _in
-00009950: 7465 7270 7265 745f 6672 6f6e 7465 6e64  terpret_frontend
-00009960: 5f61 7267 2866 726f 6e74 656e 6429 3a0a  _arg(frontend):.
-00009970: 2020 2020 6966 2066 726f 6e74 656e 6420      if frontend 
-00009980: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00009990: 2069 6620 5f49 5059 5448 4f4e 5f56 4552   if _IPYTHON_VER
-000099a0: 5349 4f4e 203e 3d20 2835 2c30 293a 0a20  SION >= (5,0):. 
-000099b0: 2020 2020 2020 2020 2020 2066 726f 6e74             front
-000099c0: 656e 6420 3d20 2270 726f 6d70 745f 746f  end = "prompt_to
-000099d0: 6f6c 6b69 7422 0a20 2020 2020 2020 2065  olkit".        e
-000099e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000099f0: 2023 2049 5079 7468 6f6e 2034 2061 6e64   # IPython 4 and
-00009a00: 2065 6172 6c69 6572 206f 6e6c 7920 7375   earlier only su
-00009a10: 7070 6f72 7420 7265 6164 6c69 6e65 2e0a  pport readline..
-00009a20: 2020 2020 2020 2020 2020 2020 6672 6f6e              fron
-00009a30: 7465 6e64 203d 2022 7265 6164 6c69 6e65  tend = "readline
-00009a40: 220a 2020 2020 6966 2066 726f 6e74 656e  ".    if fronten
-00009a50: 6420 6e6f 7420 696e 205b 2272 6561 646c  d not in ["readl
-00009a60: 696e 6522 2c20 2270 726f 6d70 745f 746f  ine", "prompt_to
-00009a70: 6f6c 6b69 7422 5d3a 0a20 2020 2020 2020  olkit"]:.       
-00009a80: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00009a90: 7228 2262 6164 2066 726f 6e74 656e 643d  r("bad frontend=
-00009aa0: 2572 2220 2520 2866 726f 6e74 656e 642c  %r" % (frontend,
-00009ab0: 2929 0a20 2020 2072 6574 7572 6e20 6672  )).    return fr
-00009ac0: 6f6e 7465 6e64 0a0a 0a64 6566 2069 7079  ontend...def ipy
-00009ad0: 7468 6f6e 2874 656d 706c 6174 652c 202a  thon(template, *
-00009ae0: 2a6b 7761 7267 7329 3a0a 2020 2020 2222  *kwargs):.    ""
-00009af0: 220a 2020 2020 5275 6e20 4950 7974 686f  ".    Run IPytho
-00009b00: 6e20 696e 2061 2070 7479 2073 7562 7072  n in a pty subpr
-00009b10: 6f63 6573 732e 2020 5365 6e64 2069 7420  ocess.  Send it 
-00009b20: 696e 7075 7420 616e 6420 6578 7065 6374  input and expect
-00009b30: 206f 7574 7075 7420 6261 7365 6420 6f6e   output based on
-00009b40: 0a20 2020 2074 6865 2074 656d 706c 6174  .    the templat
-00009b50: 652e 2020 4173 7365 7274 2074 6861 7420  e.  Assert that 
-00009b60: 7468 6520 7265 7375 6c74 206d 6174 6368  the result match
-00009b70: 6573 2e0a 2020 2020 2222 220a 2020 2020  es..    """.    
-00009b80: 5f5f 7472 6163 6562 6163 6b68 6964 655f  __tracebackhide_
-00009b90: 5f20 3d20 5472 7565 0a20 2020 2069 6620  _ = True.    if 
-00009ba0: 7379 732e 7665 7273 696f 6e5f 696e 666f  sys.version_info
-00009bb0: 5b3a 325d 203e 3d20 2833 2c20 3829 3a0a  [:2] >= (3, 8):.
-00009bc0: 2020 2020 2020 2020 2320 6d6f 7265 2072          # more r
-00009bd0: 6563 656e 7420 4950 7974 686f 6e20 6861  ecent IPython ha
-00009be0: 7665 2061 2064 6966 6665 7265 6e74 2066  ve a different f
-00009bf0: 6f72 6d61 7474 696e 672e 0a20 2020 2020  ormatting..     
-00009c00: 2020 2074 656d 706c 6174 6520 3d20 7465     template = te
-00009c10: 6d70 6c61 7465 2e72 6570 6c61 6365 2822  mplate.replace("
-00009c20: 2e2e 2e20 696e 202e 2e2e 222c 2022 2e2e  ... in ...", "..
-00009c30: 2e20 6c69 6e65 202e 2e2e 2229 0a20 2020  . line ...").   
-00009c40: 2074 656d 706c 6174 6520 3d20 6465 6465   template = dede
-00009c50: 6e74 2874 656d 706c 6174 6529 2e73 7472  nt(template).str
-00009c60: 6970 2829 0a20 2020 2069 6e70 7574 2c20  ip().    input, 
-00009c70: 6578 7065 6374 6564 203d 2070 6172 7365  expected = parse
-00009c80: 5f74 656d 706c 6174 6528 7465 6d70 6c61  _template(templa
-00009c90: 7465 2c20 636c 6561 725f 7461 625f 636f  te, clear_tab_co
-00009ca0: 6d70 6c65 7469 6f6e 733d 5f49 5059 5448  mpletions=_IPYTH
-00009cb0: 4f4e 5f56 4552 5349 4f4e 3e3d 2837 2c29  ON_VERSION>=(7,)
-00009cc0: 290a 2020 2020 6172 6773 203d 206b 7761  ).    args = kwa
-00009cd0: 7267 732e 706f 7028 2261 7267 7322 2c20  rgs.pop("args", 
-00009ce0: 2829 290a 2020 2020 6966 2069 7369 6e73  ()).    if isins
-00009cf0: 7461 6e63 6528 6172 6773 2c20 7369 782e  tance(args, six.
-00009d00: 7374 7269 6e67 5f74 7970 6573 293a 0a20  string_types):. 
-00009d10: 2020 2020 2020 2061 7267 7320 3d20 5b61         args = [a
-00009d20: 7267 735d 0a20 2020 2061 7267 7320 3d20  rgs].    args = 
-00009d30: 6c69 7374 2861 7267 7329 0a20 2020 2069  list(args).    i
-00009d40: 6620 6172 6773 2061 6e64 206e 6f74 2061  f args and not a
-00009d50: 7267 735b 305d 2e73 7461 7274 7377 6974  rgs[0].startswit
-00009d60: 6828 222d 2229 3a0a 2020 2020 2020 2020  h("-"):.        
-00009d70: 6170 7020 3d20 6172 6773 5b30 5d0a 2020  app = args[0].  
-00009d80: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00009d90: 6170 7020 3d20 2274 6572 6d69 6e61 6c22  app = "terminal"
-00009da0: 0a20 2020 206b 6572 6e65 6c20 3d20 6b77  .    kernel = kw
-00009db0: 6172 6773 2e70 6f70 2822 6b65 726e 656c  args.pop("kernel
-00009dc0: 222c 204e 6f6e 6529 0a20 2020 2069 6620  ", None).    if 
-00009dd0: 6170 7020 3d3d 2022 636f 6e73 6f6c 6522  app == "console"
-00009de0: 3a0a 2020 2020 2020 2020 6966 206b 6572  :.        if ker
-00009df0: 6e65 6c20 6973 206e 6f74 204e 6f6e 653a  nel is not None:
-00009e00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00009e10: 5f49 5059 5448 4f4e 5f56 4552 5349 4f4e  _IPYTHON_VERSION
-00009e20: 203e 3d20 2833 2c32 293a 0a20 2020 2020   >= (3,2):.     
-00009e30: 2020 2020 2020 2020 2020 2023 2049 5079             # IPy
-00009e40: 7468 6f6e 2063 6f6e 736f 6c65 2033 2e32  thon console 3.2
-00009e50: 2b20 6b69 6c6c 7320 7468 6520 6b65 726e  + kills the kern
-00009e60: 656c 2075 706f 6e20 6578 6974 2c20 756e  el upon exit, un
-00009e70: 6c65 7373 2079 6f75 0a20 2020 2020 2020  less you.       
-00009e80: 2020 2020 2020 2020 2023 2065 7870 6c69           # expli
-00009e90: 6369 746c 7920 6173 6b20 746f 206b 6565  citly ask to kee
-00009ea0: 7020 6974 206f 7065 6e2e 2020 4966 2077  p it open.  If w
-00009eb0: 6527 7265 2063 6f6e 6e65 6374 696e 6720  e're connecting 
-00009ec0: 746f 2061 6e0a 2020 2020 2020 2020 2020  to an.          
-00009ed0: 2020 2020 2020 2320 6578 6973 7469 6e67        # existing
-00009ee0: 206b 6572 6e65 6c2c 2064 6566 6175 6c74   kernel, default
-00009ef0: 2074 6f20 6b65 6570 696e 6720 6974 2061   to keeping it a
-00009f00: 6c69 7665 2075 706f 6e20 6578 6974 2e0a  live upon exit..
-00009f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f20: 6b77 6172 6773 2e73 6574 6465 6661 756c  kwargs.setdefaul
-00009f30: 7428 2265 7869 7473 7472 222c 2062 2265  t("exitstr", b"e
-00009f40: 7869 7428 6b65 6570 5f6b 6572 6e65 6c3d  xit(keep_kernel=
-00009f50: 5472 7565 295c 6e22 290a 2020 2020 2020  True)\n").      
-00009f60: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
-00009f70: 2e73 6574 6465 6661 756c 7428 2273 656e  .setdefault("sen
-00009f80: 6465 6f66 222c 2046 616c 7365 290a 2020  deof", False).  
-00009f90: 2020 2020 2020 2020 2020 656c 6966 205f            elif _
-00009fa0: 4950 5954 484f 4e5f 5645 5253 494f 4e20  IPYTHON_VERSION 
-00009fb0: 3e3d 2028 332c 293a 0a20 2020 2020 2020  >= (3,):.       
-00009fc0: 2020 2020 2020 2020 2023 2049 5079 7468           # IPyth
-00009fd0: 6f6e 2063 6f6e 736f 6c65 2033 2e30 2c20  on console 3.0, 
-00009fe0: 332e 3120 616c 7761 7973 206b 696c 6c20  3.1 always kill 
-00009ff0: 7468 6520 6b65 726e 656c 2075 706f 6e20  the kernel upon 
-0000a000: 6578 6974 2e0a 2020 2020 2020 2020 2020  exit..          
-0000a010: 2020 2020 2020 2320 5468 6572 6527 7320        # There's 
-0000a020: 6120 7075 7270 6f72 7465 6420 6f70 7469  a purported opti
-0000a030: 6f6e 2065 7869 7428 6b65 6570 5f6b 6572  on exit(keep_ker
-0000a040: 6e65 6c3d 5472 7565 2920 6275 7420 6974  nel=True) but it
-0000a050: 2773 206e 6f74 0a20 2020 2020 2020 2020  's not.         
-0000a060: 2020 2020 2020 2023 2069 6d70 6c65 6d65         # impleme
-0000a070: 6e74 6564 2069 6e20 7468 6573 6520 7665  nted in these ve
-0000a080: 7273 696f 6e73 2e0a 2020 2020 2020 2020  rsions..        
-0000a090: 2020 2020 2020 2020 2320 6874 7470 733a          # https:
-0000a0a0: 2f2f 6769 7468 7562 2e63 6f6d 2f69 7079  //github.com/ipy
-0000a0b0: 7468 6f6e 2f69 7079 7468 6f6e 2f69 7373  thon/ipython/iss
-0000a0c0: 7565 732f 3834 3832 0a20 2020 2020 2020  ues/8482.       
-0000a0d0: 2020 2020 2020 2020 2023 2068 7474 7073           # https
-0000a0e0: 3a2f 2f67 6974 6875 622e 636f 6d2f 6970  ://github.com/ip
-0000a0f0: 7974 686f 6e2f 6970 7974 686f 6e2f 7075  ython/ipython/pu
-0000a100: 6c6c 2f38 3438 330a 2020 2020 2020 2020  ll/8483.        
-0000a110: 2020 2020 2020 2020 2320 496e 7374 6561          # Instea
-0000a120: 6420 6f66 2063 6c65 616e 6c79 2074 656c  d of cleanly tel
-0000a130: 6c69 6e67 2074 6865 2063 6c69 656e 7420  ling the client 
-0000a140: 746f 2065 7869 742c 2077 6527 6c6c 206a  to exit, we'll j
-0000a150: 7573 7420 6b69 6c6c 0a20 2020 2020 2020  ust kill.       
-0000a160: 2020 2020 2020 2020 2023 2069 7420 7769           # it wi
-0000a170: 7468 2053 4947 4b49 4c4c 2028 696e 2074  th SIGKILL (in t
-0000a180: 6865 2027 6669 6e61 6c6c 7927 2063 6c61  he 'finally' cla
-0000a190: 7573 6520 6f66 2049 5079 7468 6f6e 4374  use of IPythonCt
-0000a1a0: 7829 2e0a 2020 2020 2020 2020 2020 2020  x)..            
-0000a1b0: 2020 2020 6b77 6172 6773 2e73 6574 6465      kwargs.setde
-0000a1c0: 6661 756c 7428 2265 7869 7473 7472 222c  fault("exitstr",
-0000a1d0: 2062 2222 290a 2020 2020 2020 2020 2020   b"").          
-0000a1e0: 2020 2020 2020 6b77 6172 6773 2e73 6574        kwargs.set
-0000a1f0: 6465 6661 756c 7428 2273 656e 6465 6f66  default("sendeof
-0000a200: 222c 2046 616c 7365 290a 2020 2020 2020  ", False).      
-0000a210: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
-0000a220: 2e73 6574 6465 6661 756c 7428 2277 6169  .setdefault("wai
-0000a230: 7465 6f66 222c 2046 616c 7365 290a 2020  teof", False).  
-0000a240: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a260: 6b77 6172 6773 2e73 6574 6465 6661 756c  kwargs.setdefaul
-0000a270: 7428 2273 656e 6465 6f66 222c 2054 7275  t("sendeof", Tru
-0000a280: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0000a290: 2020 206b 7761 7267 732e 7365 7464 6566     kwargs.setdef
-0000a2a0: 6175 6c74 2822 6578 6974 7374 7222 2c20  ault("exitstr", 
-0000a2b0: 6222 2220 6966 206b 7761 7267 735b 2773  b"" if kwargs['s
-0000a2c0: 656e 6465 6f66 275d 2065 6c73 6520 6222  endeof'] else b"
-0000a2d0: 6578 6974 2829 2229 0a20 2020 2020 2020  exit()").       
-0000a2e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000a2f0: 2020 2069 6620 5f49 5059 5448 4f4e 5f56     if _IPYTHON_V
-0000a300: 4552 5349 4f4e 203e 3d20 2835 2c29 3a0a  ERSION >= (5,):.
-0000a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a320: 6b77 6172 6773 2e73 6574 6465 6661 756c  kwargs.setdefaul
-0000a330: 7428 2273 656e 6465 6f66 222c 2046 616c  t("sendeof", Fal
-0000a340: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-0000a350: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000a360: 2020 2020 2020 6b77 6172 6773 2e73 6574        kwargs.set
-0000a370: 6465 6661 756c 7428 2273 656e 6465 6f66  default("sendeof
-0000a380: 222c 2054 7275 6529 0a20 2020 2020 2020  ", True).       
-0000a390: 2020 2020 206b 7761 7267 732e 7365 7464       kwargs.setd
-0000a3a0: 6566 6175 6c74 2822 6578 6974 7374 7222  efault("exitstr"
-0000a3b0: 2c20 6222 2220 6966 206b 7761 7267 735b  , b"" if kwargs[
-0000a3c0: 2773 656e 6465 6f66 275d 2065 6c73 6520  'sendeof'] else 
-0000a3d0: 6222 6578 6974 2829 2229 0a20 2020 2020  b"exit()").     
-0000a3e0: 2020 206b 7761 7267 732e 7365 7464 6566     kwargs.setdef
-0000a3f0: 6175 6c74 2822 6967 6e6f 7265 5f70 726f  ault("ignore_pro
-0000a400: 6d70 745f 6e75 6d62 6572 222c 2054 7275  mpt_number", Tru
-0000a410: 6529 0a20 2020 2065 7869 7473 7472 2020  e).    exitstr  
-0000a420: 2020 2020 2020 2020 2020 2020 3d20 6b77              = kw
-0000a430: 6172 6773 2e70 6f70 2822 6578 6974 7374  args.pop("exitst
-0000a440: 7222 2020 2020 2020 2020 2020 2020 202c  r"             ,
-0000a450: 2062 2265 7869 7428 295c 6e22 290a 2020   b"exit()\n").  
-0000a460: 2020 7365 6e64 656f 6620 2020 2020 2020    sendeof       
-0000a470: 2020 2020 2020 203d 206b 7761 7267 732e         = kwargs.
-0000a480: 706f 7028 2273 656e 6465 6f66 2220 2020  pop("sendeof"   
-0000a490: 2020 2020 2020 2020 2020 2c20 4661 6c73            , Fals
-0000a4a0: 6529 0a20 2020 2077 6169 7465 6f66 2020  e).    waiteof  
-0000a4b0: 2020 2020 2020 2020 2020 2020 3d20 6b77              = kw
-0000a4c0: 6172 6773 2e70 6f70 2822 7761 6974 656f  args.pop("waiteo
-0000a4d0: 6622 2020 2020 2020 2020 2020 2020 202c  f"             ,
-0000a4e0: 2054 7275 6529 0a20 2020 2069 676e 6f72   True).    ignor
-0000a4f0: 655f 7072 6f6d 7074 5f6e 756d 6265 7220  e_prompt_number 
-0000a500: 3d20 6b77 6172 6773 2e70 6f70 2822 6967  = kwargs.pop("ig
-0000a510: 6e6f 7265 5f70 726f 6d70 745f 6e75 6d62  nore_prompt_numb
-0000a520: 6572 222c 2046 616c 7365 290a 2020 2020  er", False).    
-0000a530: 6966 206b 6572 6e65 6c20 6973 206e 6f74  if kernel is not
-0000a540: 204e 6f6e 653a 0a20 2020 2020 2020 2061   None:.        a
-0000a550: 7267 7320 2b3d 205b 692e 6465 636f 6465  rgs += [i.decode
-0000a560: 2827 7574 662d 3827 2920 666f 7220 6920  ('utf-8') for i 
-0000a570: 696e 206b 6572 6e65 6c2e 6b65 726e 656c  in kernel.kernel
-0000a580: 5f69 6e66 6f5d 0a20 2020 2020 2020 206b  _info].        k
-0000a590: 7761 7267 732e 7365 7464 6566 6175 6c74  wargs.setdefault
-0000a5a0: 2822 6970 7974 686f 6e5f 6469 7222 2c20  ("ipython_dir", 
-0000a5b0: 6b65 726e 656c 2e69 7079 7468 6f6e 5f64  kernel.ipython_d
-0000a5c0: 6972 290a 2020 2020 7072 696e 7428 2249  ir).    print("I
-0000a5d0: 6e70 7574 3a22 290a 2020 2020 7072 696e  nput:").    prin
-0000a5e0: 7428 2222 2e6a 6f69 6e28 2220 2020 2025  t("".join("    %
-0000a5f0: 735c 6e22 256c 696e 6520 666f 7220 6c69  s\n"%line for li
-0000a600: 6e65 2069 6e20 696e 7075 742e 7370 6c69  ne in input.spli
-0000a610: 746c 696e 6573 2829 2929 0a20 2020 2077  tlines())).    w
-0000a620: 6974 6820 4950 7974 686f 6e43 7478 2861  ith IPythonCtx(a
-0000a630: 7267 733d 6172 6773 2c20 2a2a 6b77 6172  rgs=args, **kwar
-0000a640: 6773 2920 6173 2063 6869 6c64 3a0a 2020  gs) as child:.  
-0000a650: 2020 2020 2020 7265 7375 6c74 203d 205f        result = _
-0000a660: 696e 7465 7261 6374 5f69 7079 7468 6f6e  interact_ipython
-0000a670: 2863 6869 6c64 2c20 696e 7075 742c 2065  (child, input, e
-0000a680: 7869 7473 7472 3d65 7869 7473 7472 2c0a  xitstr=exitstr,.
-0000a690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6b0: 2020 2073 656e 6465 6f66 3d73 656e 6465     sendeof=sende
-0000a6c0: 6f66 2c20 7761 6974 656f 663d 7761 6974  of, waiteof=wait
-0000a6d0: 656f 6629 0a20 2020 2070 7269 6e74 2822  eof).    print("
-0000a6e0: 4f75 7470 7574 3a22 290a 2020 2020 7072  Output:").    pr
-0000a6f0: 696e 7428 2222 2e6a 6f69 6e28 2220 2020  int("".join("   
-0000a700: 2025 735c 6e22 256c 696e 6520 666f 7220   %s\n"%line for 
-0000a710: 6c69 6e65 2069 6e20 7265 7375 6c74 2e73  line in result.s
-0000a720: 706c 6974 6c69 6e65 7328 2929 290a 2020  plitlines())).  
-0000a730: 2020 6173 7365 7274 5f6d 6174 6368 2872    assert_match(r
-0000a740: 6573 756c 742c 2065 7870 6563 7465 642c  esult, expected,
-0000a750: 2069 676e 6f72 655f 7072 6f6d 7074 5f6e   ignore_prompt_n
-0000a760: 756d 6265 723d 6967 6e6f 7265 5f70 726f  umber=ignore_pro
-0000a770: 6d70 745f 6e75 6d62 6572 290a 0a0a 4063  mpt_number)...@c
-0000a780: 6f6e 7465 7874 6d61 6e61 6765 720a 6465  ontextmanager.de
-0000a790: 6620 4950 7974 686f 6e4b 6572 6e65 6c43  f IPythonKernelC
-0000a7a0: 7478 282a 2a6b 7761 7267 7329 3a0a 2020  tx(**kwargs):.  
-0000a7b0: 2020 2222 220a 2020 2020 4c61 756e 6368    """.    Launch
-0000a7c0: 2049 5079 7468 6f6e 206b 6572 6e65 6c2e   IPython kernel.
-0000a7d0: 0a20 2020 2022 2222 0a20 2020 205f 5f74  .    """.    __t
-0000a7e0: 7261 6365 6261 636b 6869 6465 5f5f 203d  racebackhide__ =
-0000a7f0: 2054 7275 650a 2020 2020 7769 7468 2049   True.    with I
-0000a800: 5079 7468 6f6e 4374 7828 6172 6773 3d27  PythonCtx(args='
-0000a810: 6b65 726e 656c 272c 202a 2a6b 7761 7267  kernel', **kwarg
-0000a820: 7329 2061 7320 6368 696c 643a 0a20 2020  s) as child:.   
-0000a830: 2020 2020 2023 2047 6574 2074 6865 206b       # Get the k
-0000a840: 6572 6e65 6c20 696e 666f 3a20 2d2d 6578  ernel info: --ex
-0000a850: 6973 7469 6e67 206b 6572 6e65 6c2d 3132  isting kernel-12
-0000a860: 3334 2e6a 736f 6e0a 2020 2020 2020 2020  34.json.        
-0000a870: 6368 696c 642e 6578 7065 6374 280a 2020  child.expect(.  
-0000a880: 2020 2020 2020 2020 2020 7222 546f 2063            r"To c
-0000a890: 6f6e 6e65 6374 2061 6e6f 7468 6572 2063  onnect another c
-0000a8a0: 6c69 656e 7420 746f 2074 6869 7320 6b65  lient to this ke
-0000a8b0: 726e 656c 2c20 7573 653a 5c73 2a22 0a20  rnel, use:\s*". 
-0000a8c0: 2020 2020 2020 2020 2020 2072 2228 3f3a             r"(?:
-0000a8d0: 5c5b 4950 4b65 726e 656c 4170 705c 5d29  \[IPKernelApp\])
-0000a8e0: 3f5c 732a 282d 2d65 7869 7374 696e 6720  ?\s*(--existing 
-0000a8f0: 2e2a 3f6a 736f 6e29 222c 0a20 2020 2020  .*?json)",.     
-0000a900: 2020 2020 2020 2074 696d 656f 7574 3d44         timeout=D
-0000a910: 4546 4155 4c54 5f54 494d 454f 5554 2c0a  EFAULT_TIMEOUT,.
-0000a920: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000a930: 2020 6b65 726e 656c 5f69 6e66 6f20 3d20    kernel_info = 
-0000a940: 6368 696c 642e 6d61 7463 682e 6772 6f75  child.match.grou
-0000a950: 7028 3129 2e73 706c 6974 2829 0a20 2020  p(1).split().   
-0000a960: 2020 2020 2023 2059 6965 6c64 2063 6f6e       # Yield con
-0000a970: 7472 6f6c 2074 6f20 6361 6c6c 6572 2e0a  trol to caller..
-0000a980: 2020 2020 2020 2020 6368 696c 642e 6b65          child.ke
-0000a990: 726e 656c 5f69 6e66 6f20 3d20 6b65 726e  rnel_info = kern
-0000a9a0: 656c 5f69 6e66 6f0a 2020 2020 2020 2020  el_info.        
-0000a9b0: 7969 656c 6420 6368 696c 640a 0a0a 6465  yield child...de
-0000a9c0: 6620 7261 6e64 5f63 6861 7273 286c 656e  f rand_chars(len
-0000a9d0: 6774 683d 382c 206c 6574 7465 7273 3d27  gth=8, letters='
-0000a9e0: 6162 6364 6566 6768 696a 6b6c 6d6e 6f70  abcdefghijklmnop
-0000a9f0: 7172 7374 7576 7778 797a 2729 3a0a 2020  qrstuvwxyz'):.  
-0000aa00: 2020 7265 7475 726e 2027 272e 6a6f 696e    return ''.join
-0000aa10: 285b 7261 6e64 6f6d 2e63 686f 6963 6528  ([random.choice(
-0000aa20: 6c65 7474 6572 7329 2066 6f72 205f 2069  letters) for _ i
-0000aa30: 6e20 7261 6e67 6528 6c65 6e67 7468 295d  n range(length)]
-0000aa40: 290a 0a0a 0a40 636f 6e74 6578 746d 616e  )....@contextman
-0000aa50: 6167 6572 0a64 6566 2049 5079 7468 6f6e  ager.def IPython
-0000aa60: 4e6f 7465 626f 6f6b 4374 7828 2a2a 6b77  NotebookCtx(**kw
-0000aa70: 6172 6773 293a 0a20 2020 2022 2222 0a20  args):.    """. 
-0000aa80: 2020 204c 6175 6e63 6820 4950 7974 686f     Launch IPytho
-0000aa90: 6e20 4e6f 7465 626f 6f6b 2e0a 2020 2020  n Notebook..    
-0000aaa0: 2222 220a 2020 2020 5f5f 7472 6163 6562  """.    __traceb
-0000aab0: 6163 6b68 6964 655f 5f20 3d20 5472 7565  ackhide__ = True
-0000aac0: 0a20 2020 2061 7267 7320 3d20 6b77 6172  .    args = kwar
-0000aad0: 6773 2e70 6f70 2822 6172 6773 222c 205b  gs.pop("args", [
-0000aae0: 5d29 0a20 2020 2061 7267 7320 3d20 6172  ]).    args = ar
-0000aaf0: 6773 202b 205b 276e 6f74 6562 6f6f 6b27  gs + ['notebook'
-0000ab00: 2c20 272d 2d6e 6f2d 6272 6f77 7365 7227  , '--no-browser'
-0000ab10: 2c20 272d 2d69 703d 3132 372e 302e 302e  , '--ip=127.0.0.
-0000ab20: 3127 5d0a 2020 2020 6966 205f 4950 5954  1'].    if _IPYT
-0000ab30: 484f 4e5f 5645 5253 494f 4e20 3c20 2835  HON_VERSION < (5
-0000ab40: 2c29 3a0a 2020 2020 2020 2020 7061 7373  ,):.        pass
-0000ab50: 7764 5f70 6c61 696e 7465 7874 203d 2072  wd_plaintext = r
-0000ab60: 616e 645f 6368 6172 7328 290a 2020 2020  and_chars().    
-0000ab70: 2020 2020 7061 7373 7764 5f68 6173 6865      passwd_hashe
-0000ab80: 6420 3d20 4950 7974 686f 6e2e 6c69 622e  d = IPython.lib.
-0000ab90: 7061 7373 7764 2870 6173 7377 645f 706c  passwd(passwd_pl
-0000aba0: 6169 6e74 6578 7429 0a20 2020 2020 2020  aintext).       
-0000abb0: 2061 7267 7320 2b3d 205b 272d 2d4e 6f74   args += ['--Not
-0000abc0: 6562 6f6f 6b41 7070 2e70 6173 7377 6f72  ebookApp.passwor
-0000abd0: 643d 2573 2720 2520 7061 7373 7764 5f68  d=%s' % passwd_h
-0000abe0: 6173 6865 645d 0a20 2020 206e 6f74 6562  ashed].    noteb
-0000abf0: 6f6f 6b5f 6469 7220 3d20 6b77 6172 6773  ook_dir = kwargs
-0000ac00: 2e70 6f70 2822 6e6f 7465 626f 6f6b 5f64  .pop("notebook_d
-0000ac10: 6972 222c 204e 6f6e 6529 0a20 2020 2063  ir", None).    c
-0000ac20: 6c65 616e 7570 7320 3d20 5b5d 0a20 2020  leanups = [].   
-0000ac30: 2069 6620 6e6f 7420 6e6f 7465 626f 6f6b   if not notebook
-0000ac40: 5f64 6972 3a0a 2020 2020 2020 2020 6e6f  _dir:.        no
-0000ac50: 7465 626f 6f6b 5f64 6972 203d 206d 6b64  tebook_dir = mkd
-0000ac60: 7465 6d70 2870 7265 6669 783d 2270 7966  temp(prefix="pyf
-0000ac70: 6c79 6279 5f74 6573 745f 6e6f 7465 626f  lyby_test_notebo
-0000ac80: 6f6b 735f 222c 2073 7566 6669 783d 222e  oks_", suffix=".
-0000ac90: 746d 7022 290a 2020 2020 2020 2020 636c  tmp").        cl
-0000aca0: 6561 6e75 7073 2e61 7070 656e 6428 6c61  eanups.append(la
-0000acb0: 6d62 6461 3a20 726d 7472 6565 286e 6f74  mbda: rmtree(not
-0000acc0: 6562 6f6f 6b5f 6469 7229 290a 2020 2020  ebook_dir)).    
-0000acd0: 6966 2028 6b77 6172 6773 2e67 6574 2822  if (kwargs.get("
-0000ace0: 7072 6f67 222c 2022 6970 7974 686f 6e22  prog", "ipython"
-0000acf0: 2920 3d3d 2022 6970 7974 686f 6e22 2061  ) == "ipython" a
-0000ad00: 6e64 0a20 2020 2020 2020 2028 312c 2030  nd.        (1, 0
-0000ad10: 2920 3c3d 205f 4950 5954 484f 4e5f 5645  ) <= _IPYTHON_VE
-0000ad20: 5253 494f 4e20 3c20 2831 2c20 3229 2061  RSION < (1, 2) a
-0000ad30: 6e64 0a20 2020 2020 2020 2073 7973 2e76  nd.        sys.v
-0000ad40: 6572 7369 6f6e 5f69 6e66 6f20 3c20 2832  ersion_info < (2
-0000ad50: 2c20 3729 293a 0a20 2020 2020 2020 2023  , 7)):.        #
-0000ad60: 2057 6f72 6b20 6172 6f75 6e64 2061 2062   Work around a b
-0000ad70: 7567 2069 6e20 4950 7974 686f 6e20 312e  ug in IPython 1.
-0000ad80: 3020 2b20 5079 7468 6f6e 2032 2e36 2e0a  0 + Python 2.6..
-0000ad90: 2020 2020 2020 2020 2320 5468 6520 6275          # The bu
-0000ada0: 6720 6973 2074 6861 7420 696e 2049 5079  g is that in IPy
-0000adb0: 7468 6f6e 2031 2e30 2c20 4c65 7665 6c46  thon 1.0, LevelF
-0000adc0: 6f72 6d61 7474 6572 2075 7365 7320 7375  ormatter uses su
-0000add0: 7065 7228 292c 2077 6869 6368 0a20 2020  per(), which.   
-0000ade0: 2020 2020 2023 2061 7373 756d 6573 2074       # assumes t
-0000adf0: 6861 7420 6c6f 6767 696e 672e 466f 726d  hat logging.Form
-0000ae00: 6174 7465 7220 6973 2061 2073 7562 636c  atter is a subcl
-0000ae10: 6173 7320 6f66 206f 626a 6563 742e 2020  ass of object.  
-0000ae20: 486f 7765 7665 722c 0a20 2020 2020 2020  However,.       
-0000ae30: 2023 2074 6869 7320 6973 206f 6e6c 7920   # this is only 
-0000ae40: 7472 7565 2069 6e20 5079 7468 6f6e 2032  true in Python 2
-0000ae50: 2e37 2b2c 206e 6f74 2069 6e20 5079 7468  .7+, not in Pyth
-0000ae60: 6f6e 2032 2e36 2e0a 2020 2020 2020 2020  on 2.6..        
-0000ae70: 2320 7079 666c 7962 792e 656e 6162 6c65  # pyflyby.enable
-0000ae80: 5f61 7574 6f5f 696d 706f 7274 6572 2829  _auto_importer()
-0000ae90: 2066 6978 6573 2074 6861 7420 6973 7375   fixes that issu
-0000aea0: 6520 746f 6f2c 2073 6f20 2770 790a 2020  e too, so 'py.  
-0000aeb0: 2020 2020 2020 2320 6e6f 7465 626f 6f6b        # notebook
-0000aec0: 2720 6973 206e 6f74 2061 6666 6563 7465  ' is not affecte
-0000aed0: 642c 206f 6e6c 7920 2769 7079 7468 6f6e  d, only 'ipython
-0000aee0: 206e 6f74 6562 6f6f 6b27 2e0a 2020 2020   notebook'..    
-0000aef0: 2020 2020 6173 7365 7274 2022 5059 5448      assert "PYTH
-0000af00: 4f4e 5041 5448 2220 6e6f 7420 696e 206b  ONPATH" not in k
-0000af10: 7761 7267 730a 2020 2020 2020 2020 6578  wargs.        ex
-0000af20: 7472 615f 7079 7468 6f6e 7061 7468 203d  tra_pythonpath =
-0000af30: 206d 6b64 7465 6d70 2870 7265 6669 783d   mkdtemp(prefix=
-0000af40: 2270 7966 6c79 6279 5f74 6573 745f 222c  "pyflyby_test_",
-0000af50: 2073 7566 6669 783d 222e 746d 7022 290a   suffix=".tmp").
-0000af60: 2020 2020 2020 2020 636c 6561 6e75 7073          cleanups
-0000af70: 2e61 7070 656e 6428 6c61 6d62 6461 3a20  .append(lambda: 
-0000af80: 726d 7472 6565 2865 7874 7261 5f70 7974  rmtree(extra_pyt
-0000af90: 686f 6e70 6174 6829 290a 2020 2020 2020  honpath)).      
-0000afa0: 2020 6b77 6172 6773 5b22 5059 5448 4f4e    kwargs["PYTHON
-0000afb0: 5041 5448 225d 203d 2065 7874 7261 5f70  PATH"] = extra_p
-0000afc0: 7974 686f 6e70 6174 680a 2020 2020 2020  ythonpath.      
-0000afd0: 2020 7772 6974 6574 6578 7428 4669 6c65    writetext(File
-0000afe0: 6e61 6d65 2865 7874 7261 5f70 7974 686f  name(extra_pytho
-0000aff0: 6e70 6174 6829 2f22 7369 7465 6375 7374  npath)/"sitecust
-0000b000: 6f6d 697a 652e 7079 222c 2022 2222 0a20  omize.py", """. 
-0000b010: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
-0000b020: 6c6f 6767 696e 6720 696d 706f 7274 2046  logging import F
-0000b030: 6f72 6d61 7474 6572 0a20 2020 2020 2020  ormatter.       
-0000b040: 2020 2020 2066 726f 6d20 4950 7974 686f       from IPytho
-0000b050: 6e2e 636f 6e66 6967 2e61 7070 6c69 6361  n.config.applica
-0000b060: 7469 6f6e 2069 6d70 6f72 7420 4c65 7665  tion import Leve
-0000b070: 6c46 6f72 6d61 7474 6572 0a20 2020 2020  lFormatter.     
-0000b080: 2020 2020 2020 2064 6566 205f 666f 726d         def _form
-0000b090: 6174 5f70 6174 6368 6564 2873 656c 662c  at_patched(self,
-0000b0a0: 2072 6563 6f72 6429 3a0a 2020 2020 2020   record):.      
-0000b0b0: 2020 2020 2020 2020 2020 6966 2072 6563            if rec
-0000b0c0: 6f72 642e 6c65 7665 6c6e 6f20 3e3d 2073  ord.levelno >= s
-0000b0d0: 656c 662e 6869 6768 6c65 7665 6c5f 6c69  elf.highlevel_li
-0000b0e0: 6d69 743a 0a20 2020 2020 2020 2020 2020  mit:.           
-0000b0f0: 2020 2020 2020 2020 2072 6563 6f72 642e           record.
-0000b100: 6869 6768 6c65 7665 6c20 3d20 7365 6c66  highlevel = self
-0000b110: 2e68 6967 686c 6576 656c 5f66 6f72 6d61  .highlevel_forma
-0000b120: 7420 2520 7265 636f 7264 2e5f 5f64 6963  t % record.__dic
-0000b130: 745f 5f0a 2020 2020 2020 2020 2020 2020  t__.            
-0000b140: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000b150: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000b160: 636f 7264 2e68 6967 686c 6576 656c 203d  cord.highlevel =
-0000b170: 2022 220a 2020 2020 2020 2020 2020 2020   "".            
-0000b180: 2020 2020 7265 7475 726e 2046 6f72 6d61      return Forma
-0000b190: 7474 6572 2e66 6f72 6d61 7428 7365 6c66  tter.format(self
-0000b1a0: 2c20 7265 636f 7264 290a 2020 2020 2020  , record).      
-0000b1b0: 2020 2020 2020 4c65 7665 6c46 6f72 6d61        LevelForma
-0000b1c0: 7474 6572 2e66 6f72 6d61 7420 3d20 5f66  tter.format = _f
-0000b1d0: 6f72 6d61 745f 7061 7463 6865 640a 2020  ormat_patched.  
-0000b1e0: 2020 2020 2020 2222 2229 0a20 2020 2074        """).    t
-0000b1f0: 7279 3a0a 2020 2020 2020 2020 6172 6773  ry:.        args
-0000b200: 202b 3d20 5b27 2d2d 6e6f 7465 626f 6f6b   += ['--notebook
-0000b210: 2d64 6972 3d25 7327 2025 206e 6f74 6562  -dir=%s' % noteb
-0000b220: 6f6f 6b5f 6469 725d 0a20 2020 2020 2020  ook_dir].       
-0000b230: 2077 6974 6820 4950 7974 686f 6e43 7478   with IPythonCtx
-0000b240: 2861 7267 733d 6172 6773 2c20 2a2a 6b77  (args=args, **kw
-0000b250: 6172 6773 2920 6173 2063 6869 6c64 3a0a  args) as child:.
-0000b260: 2020 2020 2020 2020 2020 2020 6966 205f              if _
-0000b270: 4950 5954 484f 4e5f 5645 5253 494f 4e20  IPYTHON_VERSION 
-0000b280: 3e3d 2028 352c 293a 0a20 2020 2020 2020  >= (5,):.       
-0000b290: 2020 2020 2020 2020 2023 2047 6574 2074           # Get t
-0000b2a0: 6865 2062 6173 6520 5552 4c20 6672 6f6d  he base URL from
-0000b2b0: 2074 6865 206e 6f74 6562 6f6f 6b20 6170   the notebook ap
-0000b2c0: 702e 0a20 2020 2020 2020 2020 2020 2020  p..             
-0000b2d0: 2020 2063 6869 6c64 2e65 7870 6563 7428     child.expect(
-0000b2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b2f0: 2020 2020 2072 225c 732a 2868 7474 703a       r"\s*(http:
-0000b300: 2f2f 5b30 2d39 2e3a 5d2b 292f 5b3f 5d74  //[0-9.:]+)/[?]t
-0000b310: 6f6b 656e 3d28 5b30 2d39 612d 665d 2b29  oken=([0-9a-f]+)
-0000b320: 5c6e 222c 0a20 2020 2020 2020 2020 2020  \n",.           
-0000b330: 2020 2020 2020 2020 2074 696d 656f 7574           timeout
-0000b340: 3d44 4546 4155 4c54 5f54 494d 454f 5554  =DEFAULT_TIMEOUT
-0000b350: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000b360: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000b370: 2020 2020 6261 7365 7572 6c20 3d20 6368      baseurl = ch
-0000b380: 696c 642e 6d61 7463 682e 6772 6f75 7028  ild.match.group(
-0000b390: 3129 2e64 6563 6f64 6528 2275 7466 2d38  1).decode("utf-8
-0000b3a0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000b3b0: 2020 2074 6f6b 656e 203d 2063 6869 6c64     token = child
-0000b3c0: 2e6d 6174 6368 2e67 726f 7570 2832 290a  .match.group(2).
-0000b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3e0: 7061 7261 6d73 203d 2064 6963 7428 746f  params = dict(to
-0000b3f0: 6b65 6e3d 746f 6b65 6e29 0a20 2020 2020  ken=token).     
-0000b400: 2020 2020 2020 2020 2020 2072 6573 706f             respo
-0000b410: 6e73 6520 3d20 7265 7175 6573 7473 2e70  nse = requests.p
-0000b420: 6f73 7428 0a20 2020 2020 2020 2020 2020  ost(.           
-0000b430: 2020 2020 2020 2020 2062 6173 6575 726c           baseurl
-0000b440: 202b 2022 2f61 7069 2f63 6f6e 7465 6e74   + "/api/content
-0000b450: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
-0000b460: 2020 2020 2020 2020 7061 7261 6d73 3d70          params=p
-0000b470: 6172 616d 732c 0a20 2020 2020 2020 2020  arams,.         
-0000b480: 2020 2020 2020 2020 2020 2074 696d 656f             timeo
-0000b490: 7574 3d44 4546 4155 4c54 5f54 494d 454f  ut=DEFAULT_TIMEO
-0000b4a0: 5554 5f52 4551 5545 5354 2c0a 2020 2020  UT_REQUEST,.    
-0000b4b0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000b4c0: 2020 2020 2020 2020 2020 2020 2020 6173                as
-0000b4d0: 7365 7274 2072 6573 706f 6e73 652e 7374  sert response.st
-0000b4e0: 6174 7573 5f63 6f64 6520 3d3d 2032 3031  atus_code == 201
-0000b4f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b500: 2023 2047 6574 2074 6865 206e 6f74 6562   # Get the noteb
-0000b510: 6f6f 6b20 7061 7468 2026 206e 616d 6520  ook path & name 
-0000b520: 666f 7220 7468 6520 6e65 7720 6e6f 7465  for the new note
-0000b530: 626f 6f6b 2e0a 2020 2020 2020 2020 2020  book..          
-0000b540: 2020 2020 2020 7465 7874 203d 2072 6573        text = res
-0000b550: 706f 6e73 652e 7465 7874 0a20 2020 2020  ponse.text.     
-0000b560: 2020 2020 2020 2020 2020 2072 6573 706f             respo
-0000b570: 6e73 655f 6461 7461 203d 206a 736f 6e2e  nse_data = json.
-0000b580: 6c6f 6164 7328 7465 7874 290a 2020 2020  loads(text).    
-0000b590: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0000b5a0: 203d 2072 6573 706f 6e73 655f 6461 7461   = response_data
-0000b5b0: 5b27 7061 7468 275d 0a20 2020 2020 2020  ['path'].       
-0000b5c0: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
-0000b5d0: 7265 7370 6f6e 7365 5f64 6174 615b 276e  response_data['n
-0000b5e0: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
-0000b5f0: 2020 2020 2020 2320 4372 6561 7465 2061        # Create a
-0000b600: 2073 6573 7369 6f6e 2026 206b 6572 6e65   session & kerne
-0000b610: 6c20 666f 7220 7468 6520 6e65 7720 6e6f  l for the new no
-0000b620: 7465 626f 6f6b 2e0a 2020 2020 2020 2020  tebook..        
-0000b630: 2020 2020 2020 2020 7265 7175 6573 745f          request_
-0000b640: 6461 7461 203d 206a 736f 6e2e 6475 6d70  data = json.dump
-0000b650: 7328 6469 6374 286e 6f74 6562 6f6f 6b3d  s(dict(notebook=
-0000b660: 6469 6374 2870 6174 683d 7061 7468 2c20  dict(path=path, 
-0000b670: 6e61 6d65 3d6e 616d 6529 2929 0a20 2020  name=name))).   
-0000b680: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0000b690: 706f 6e73 6520 3d20 7265 7175 6573 7473  ponse = requests
-0000b6a0: 2e70 6f73 7428 0a20 2020 2020 2020 2020  .post(.         
-0000b6b0: 2020 2020 2020 2020 2020 2062 6173 6575             baseu
-0000b6c0: 726c 202b 2022 2f61 7069 2f73 6573 7369  rl + "/api/sessi
-0000b6d0: 6f6e 7322 2c0a 2020 2020 2020 2020 2020  ons",.          
-0000b6e0: 2020 2020 2020 2020 2020 6461 7461 3d72            data=r
-0000b6f0: 6571 7565 7374 5f64 6174 612c 0a20 2020  equest_data,.   
-0000b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b710: 2070 6172 616d 733d 7061 7261 6d73 2c0a   params=params,.
-0000b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b730: 2020 2020 7469 6d65 6f75 743d 4445 4641      timeout=DEFA
-0000b740: 554c 545f 5449 4d45 4f55 545f 5245 5155  ULT_TIMEOUT_REQU
-0000b750: 4553 542c 0a20 2020 2020 2020 2020 2020  EST,.           
-0000b760: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000b770: 2020 2020 2020 2061 7373 6572 7420 7265         assert re
-0000b780: 7370 6f6e 7365 2e73 7461 7475 735f 636f  sponse.status_co
-0000b790: 6465 203d 3d20 3230 310a 2020 2020 2020  de == 201.      
-0000b7a0: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
-0000b7b0: 7468 6520 6b65 726e 656c 5f69 6420 666f  the kernel_id fo
-0000b7c0: 7220 7468 6520 6e65 7720 6b65 726e 656c  r the new kernel
-0000b7d0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b7e0: 2020 7465 7874 203d 2072 6573 706f 6e73    text = respons
-0000b7f0: 652e 7465 7874 0a20 2020 2020 2020 2020  e.text.         
-0000b800: 2020 2020 2020 2072 6573 706f 6e73 655f         response_
-0000b810: 6461 7461 203d 206a 736f 6e2e 6c6f 6164  data = json.load
-0000b820: 7328 7465 7874 290a 2020 2020 2020 2020  s(text).        
-0000b830: 2020 2020 2020 2020 6b65 726e 656c 5f69          kernel_i
-0000b840: 6420 3d20 7265 7370 6f6e 7365 5f64 6174  d = response_dat
-0000b850: 615b 276b 6572 6e65 6c27 5d5b 2769 6427  a['kernel']['id'
-0000b860: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
-0000b870: 6966 205f 4950 5954 484f 4e5f 5645 5253  if _IPYTHON_VERS
-0000b880: 494f 4e20 3e3d 2028 322c 293a 0a20 2020  ION >= (2,):.   
-0000b890: 2020 2020 2020 2020 2020 2020 2023 2047               # G
-0000b8a0: 6574 2074 6865 2062 6173 6520 5552 4c20  et the base URL 
-0000b8b0: 6672 6f6d 2074 6865 206e 6f74 6562 6f6f  from the noteboo
-0000b8c0: 6b20 6170 702e 0a20 2020 2020 2020 2020  k app..         
-0000b8d0: 2020 2020 2020 2063 6869 6c64 2e65 7870         child.exp
-0000b8e0: 6563 7428 0a20 2020 2020 2020 2020 2020  ect(.           
-0000b8f0: 2020 2020 2020 2020 2072 2254 6865 2028           r"The (
-0000b900: 3f3a 4950 7974 686f 6e7c 4a75 7079 7465  ?:IPython|Jupyte
-0000b910: 7229 204e 6f74 6562 6f6f 6b20 6973 2072  r) Notebook is r
-0000b920: 756e 6e69 6e67 2061 743a 2028 6874 7470  unning at: (http
-0000b930: 3a2f 2f5b 412d 5a61 2d7a 302d 393a 2e5d  ://[A-Za-z0-9:.]
-0000b940: 2b29 5b2f 5c72 5c6e 5d22 2c0a 2020 2020  +)[/\r\n]",.    
-0000b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b960: 7469 6d65 6f75 743d 4445 4641 554c 545f  timeout=DEFAULT_
-0000b970: 5449 4d45 4f55 542c 0a20 2020 2020 2020  TIMEOUT,.       
-0000b980: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000b990: 2020 2020 2020 2020 2020 2062 6173 6575             baseu
-0000b9a0: 726c 203d 2063 6869 6c64 2e6d 6174 6368  rl = child.match
-0000b9b0: 2e67 726f 7570 2831 292e 6465 636f 6465  .group(1).decode
-0000b9c0: 2822 7574 662d 3822 290a 2020 2020 2020  ("utf-8").      
-0000b9d0: 2020 2020 2020 2020 2020 2320 4c6f 6769            # Logi
-0000b9e0: 6e2e 0a20 2020 2020 2020 2020 2020 2020  n..             
-0000b9f0: 2020 2072 6573 706f 6e73 6520 3d20 7265     response = re
-0000ba00: 7175 6573 7473 2e70 6f73 7428 0a20 2020  quests.post(.   
+000095f0: 2020 5f77 6169 745f 666f 725f 6f75 7470    _wait_for_outp
+00009600: 7574 2863 6869 6c64 2c20 7469 6d65 6f75  ut(child, timeou
+00009610: 743d 312e 3029 0a20 2020 2020 2020 2020  t=1.0).         
+00009620: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00009630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009640: 2023 2057 6865 6e20 7573 696e 6720 7265   # When using re
+00009650: 6164 6c69 6e65 2028 6f6e 6c79 206f 7074  adline (only opt
+00009660: 696f 6e20 666f 7220 4950 7974 686f 6e20  ion for IPython 
+00009670: 3420 616e 640a 2020 2020 2020 2020 2020  4 and.          
+00009680: 2020 2020 2020 2020 2020 2320 6561 726c            # earl
+00009690: 6965 7229 2c20 7765 2063 616e 2075 7365  ier), we can use
+000096a0: 2074 6865 206e 6f6e 6365 2074 7269 636b   the nonce trick
+000096b0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000096c0: 2020 2020 2020 5f77 6169 745f 6e6f 6e63        _wait_nonc
+000096d0: 6528 6368 696c 6429 0a20 2020 2020 2020  e(child).       
+000096e0: 2020 2020 206c 696e 6520 3d20 7269 6768       line = righ
+000096f0: 740a 2020 2020 2020 2020 6368 696c 642e  t.        child.
+00009700: 7365 6e64 2862 225c 6e22 290a 2020 2020  send(b"\n").    
+00009710: 2320 5765 2772 6520 6669 6e69 7368 6564  # We're finished
+00009720: 2073 656e 6469 6e67 2069 6e70 7574 2063   sending input c
+00009730: 6f6d 6d61 6e64 732e 2020 5761 6974 2066  ommands.  Wait f
+00009740: 6f72 2070 726f 6365 7373 2074 6f20 636f  or process to co
+00009750: 6d70 6c65 7465 2e0a 2020 2020 6966 2073  mplete..    if s
+00009760: 656e 6465 6f66 3a0a 2020 2020 2020 2020  endeof:.        
+00009770: 6368 696c 642e 7365 6e64 656f 6628 290a  child.sendeof().
+00009780: 2020 2020 6966 2077 6169 7465 6f66 3a0a      if waiteof:.
+00009790: 2020 2020 2020 2020 6368 696c 642e 6578          child.ex
+000097a0: 7065 6374 2870 6578 7065 6374 2e45 4f46  pect(pexpect.EOF
+000097b0: 2c20 7469 6d65 6f75 743d 4445 4641 554c  , timeout=DEFAUL
+000097c0: 545f 5449 4d45 4f55 5429 0a20 2020 2065  T_TIMEOUT).    e
+000097d0: 6c73 653a 0a20 2020 2020 2020 2063 6869  lse:.        chi
+000097e0: 6c64 2e65 7870 6563 7428 5f49 5059 5448  ld.expect(_IPYTH
+000097f0: 4f4e 5f50 524f 4d50 5453 2c20 7469 6d65  ON_PROMPTS, time
+00009800: 6f75 743d 4445 4641 554c 545f 5449 4d45  out=DEFAULT_TIME
+00009810: 4f55 5429 0a20 2020 2023 2047 6574 206f  OUT).    # Get o
+00009820: 7574 7075 742e 0a20 2020 206f 7574 7075  utput..    outpu
+00009830: 7420 3d20 6368 696c 642e 6c6f 6766 696c  t = child.logfil
+00009840: 655f 7265 6164 0a20 2020 2072 6573 756c  e_read.    resul
+00009850: 7420 3d20 6f75 7470 7574 2e67 6574 7661  t = output.getva
+00009860: 6c75 6528 290a 2020 2020 7265 7375 6c74  lue().    result
+00009870: 203d 205f 636c 6561 6e5f 6970 7974 686f   = _clean_ipytho
+00009880: 6e5f 6f75 7470 7574 2872 6573 756c 7429  n_output(result)
+00009890: 0a20 2020 2072 6574 7572 6e20 7265 7375  .    return resu
+000098a0: 6c74 0a0a 0a64 6566 205f 696e 7465 7270  lt...def _interp
+000098b0: 7265 745f 6672 6f6e 7465 6e64 5f61 7267  ret_frontend_arg
+000098c0: 2866 726f 6e74 656e 6429 3a0a 2020 2020  (frontend):.    
+000098d0: 6966 2066 726f 6e74 656e 6420 6973 204e  if frontend is N
+000098e0: 6f6e 653a 0a20 2020 2020 2020 2069 6620  one:.        if 
+000098f0: 5f49 5059 5448 4f4e 5f56 4552 5349 4f4e  _IPYTHON_VERSION
+00009900: 203e 3d20 2835 2c30 293a 0a20 2020 2020   >= (5,0):.     
+00009910: 2020 2020 2020 2066 726f 6e74 656e 6420         frontend 
+00009920: 3d20 2270 726f 6d70 745f 746f 6f6c 6b69  = "prompt_toolki
+00009930: 7422 0a20 2020 2020 2020 2065 6c73 653a  t".        else:
+00009940: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
+00009950: 5079 7468 6f6e 2034 2061 6e64 2065 6172  Python 4 and ear
+00009960: 6c69 6572 206f 6e6c 7920 7375 7070 6f72  lier only suppor
+00009970: 7420 7265 6164 6c69 6e65 2e0a 2020 2020  t readline..    
+00009980: 2020 2020 2020 2020 6672 6f6e 7465 6e64          frontend
+00009990: 203d 2022 7265 6164 6c69 6e65 220a 2020   = "readline".  
+000099a0: 2020 6966 2066 726f 6e74 656e 6420 6e6f    if frontend no
+000099b0: 7420 696e 205b 2272 6561 646c 696e 6522  t in ["readline"
+000099c0: 2c20 2270 726f 6d70 745f 746f 6f6c 6b69  , "prompt_toolki
+000099d0: 7422 5d3a 0a20 2020 2020 2020 2072 6169  t"]:.        rai
+000099e0: 7365 2056 616c 7565 4572 726f 7228 2262  se ValueError("b
+000099f0: 6164 2066 726f 6e74 656e 643d 2572 2220  ad frontend=%r" 
+00009a00: 2520 2866 726f 6e74 656e 642c 2929 0a20  % (frontend,)). 
+00009a10: 2020 2072 6574 7572 6e20 6672 6f6e 7465     return fronte
+00009a20: 6e64 0a0a 0a64 6566 2069 7079 7468 6f6e  nd...def ipython
+00009a30: 2874 656d 706c 6174 652c 202a 2a6b 7761  (template, **kwa
+00009a40: 7267 7329 3a0a 2020 2020 2222 220a 2020  rgs):.    """.  
+00009a50: 2020 5275 6e20 4950 7974 686f 6e20 696e    Run IPython in
+00009a60: 2061 2070 7479 2073 7562 7072 6f63 6573   a pty subproces
+00009a70: 732e 2020 5365 6e64 2069 7420 696e 7075  s.  Send it inpu
+00009a80: 7420 616e 6420 6578 7065 6374 206f 7574  t and expect out
+00009a90: 7075 7420 6261 7365 6420 6f6e 0a20 2020  put based on.   
+00009aa0: 2074 6865 2074 656d 706c 6174 652e 2020   the template.  
+00009ab0: 4173 7365 7274 2074 6861 7420 7468 6520  Assert that the 
+00009ac0: 7265 7375 6c74 206d 6174 6368 6573 2e0a  result matches..
+00009ad0: 2020 2020 2222 220a 2020 2020 5f5f 7472      """.    __tr
+00009ae0: 6163 6562 6163 6b68 6964 655f 5f20 3d20  acebackhide__ = 
+00009af0: 5472 7565 0a20 2020 2069 6620 7379 732e  True.    if sys.
+00009b00: 7665 7273 696f 6e5f 696e 666f 5b3a 325d  version_info[:2]
+00009b10: 203e 3d20 2833 2c20 3829 3a0a 2020 2020   >= (3, 8):.    
+00009b20: 2020 2020 2320 6d6f 7265 2072 6563 656e      # more recen
+00009b30: 7420 4950 7974 686f 6e20 6861 7665 2061  t IPython have a
+00009b40: 2064 6966 6665 7265 6e74 2066 6f72 6d61   different forma
+00009b50: 7474 696e 672e 0a20 2020 2020 2020 2074  tting..        t
+00009b60: 656d 706c 6174 6520 3d20 7465 6d70 6c61  emplate = templa
+00009b70: 7465 2e72 6570 6c61 6365 2822 2e2e 2e20  te.replace("... 
+00009b80: 696e 202e 2e2e 222c 2022 2e2e 2e20 6c69  in ...", "... li
+00009b90: 6e65 202e 2e2e 2229 0a20 2020 2074 656d  ne ...").    tem
+00009ba0: 706c 6174 6520 3d20 6465 6465 6e74 2874  plate = dedent(t
+00009bb0: 656d 706c 6174 6529 2e73 7472 6970 2829  emplate).strip()
+00009bc0: 0a20 2020 2069 6e70 7574 2c20 6578 7065  .    input, expe
+00009bd0: 6374 6564 203d 2070 6172 7365 5f74 656d  cted = parse_tem
+00009be0: 706c 6174 6528 7465 6d70 6c61 7465 2c20  plate(template, 
+00009bf0: 636c 6561 725f 7461 625f 636f 6d70 6c65  clear_tab_comple
+00009c00: 7469 6f6e 733d 5f49 5059 5448 4f4e 5f56  tions=_IPYTHON_V
+00009c10: 4552 5349 4f4e 3e3d 2837 2c29 290a 2020  ERSION>=(7,)).  
+00009c20: 2020 6172 6773 203d 206b 7761 7267 732e    args = kwargs.
+00009c30: 706f 7028 2261 7267 7322 2c20 2829 290a  pop("args", ()).
+00009c40: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00009c50: 6528 6172 6773 2c20 7369 782e 7374 7269  e(args, six.stri
+00009c60: 6e67 5f74 7970 6573 293a 0a20 2020 2020  ng_types):.     
+00009c70: 2020 2061 7267 7320 3d20 5b61 7267 735d     args = [args]
+00009c80: 0a20 2020 2061 7267 7320 3d20 6c69 7374  .    args = list
+00009c90: 2861 7267 7329 0a20 2020 2069 6620 6172  (args).    if ar
+00009ca0: 6773 2061 6e64 206e 6f74 2061 7267 735b  gs and not args[
+00009cb0: 305d 2e73 7461 7274 7377 6974 6828 222d  0].startswith("-
+00009cc0: 2229 3a0a 2020 2020 2020 2020 6170 7020  "):.        app 
+00009cd0: 3d20 6172 6773 5b30 5d0a 2020 2020 656c  = args[0].    el
+00009ce0: 7365 3a0a 2020 2020 2020 2020 6170 7020  se:.        app 
+00009cf0: 3d20 2274 6572 6d69 6e61 6c22 0a20 2020  = "terminal".   
+00009d00: 206b 6572 6e65 6c20 3d20 6b77 6172 6773   kernel = kwargs
+00009d10: 2e70 6f70 2822 6b65 726e 656c 222c 204e  .pop("kernel", N
+00009d20: 6f6e 6529 0a20 2020 2069 6620 6170 7020  one).    if app 
+00009d30: 3d3d 2022 636f 6e73 6f6c 6522 3a0a 2020  == "console":.  
+00009d40: 2020 2020 2020 6966 206b 6572 6e65 6c20        if kernel 
+00009d50: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00009d60: 2020 2020 2020 2020 2069 6620 5f49 5059           if _IPY
+00009d70: 5448 4f4e 5f56 4552 5349 4f4e 203e 3d20  THON_VERSION >= 
+00009d80: 2833 2c32 293a 0a20 2020 2020 2020 2020  (3,2):.         
+00009d90: 2020 2020 2020 2023 2049 5079 7468 6f6e         # IPython
+00009da0: 2063 6f6e 736f 6c65 2033 2e32 2b20 6b69   console 3.2+ ki
+00009db0: 6c6c 7320 7468 6520 6b65 726e 656c 2075  lls the kernel u
+00009dc0: 706f 6e20 6578 6974 2c20 756e 6c65 7373  pon exit, unless
+00009dd0: 2079 6f75 0a20 2020 2020 2020 2020 2020   you.           
+00009de0: 2020 2020 2023 2065 7870 6c69 6369 746c       # explicitl
+00009df0: 7920 6173 6b20 746f 206b 6565 7020 6974  y ask to keep it
+00009e00: 206f 7065 6e2e 2020 4966 2077 6527 7265   open.  If we're
+00009e10: 2063 6f6e 6e65 6374 696e 6720 746f 2061   connecting to a
+00009e20: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00009e30: 2020 2320 6578 6973 7469 6e67 206b 6572    # existing ker
+00009e40: 6e65 6c2c 2064 6566 6175 6c74 2074 6f20  nel, default to 
+00009e50: 6b65 6570 696e 6720 6974 2061 6c69 7665  keeping it alive
+00009e60: 2075 706f 6e20 6578 6974 2e0a 2020 2020   upon exit..    
+00009e70: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+00009e80: 6773 2e73 6574 6465 6661 756c 7428 2265  gs.setdefault("e
+00009e90: 7869 7473 7472 222c 2062 2265 7869 7428  xitstr", b"exit(
+00009ea0: 6b65 6570 5f6b 6572 6e65 6c3d 5472 7565  keep_kernel=True
+00009eb0: 295c 6e22 290a 2020 2020 2020 2020 2020  )\n").          
+00009ec0: 2020 2020 2020 6b77 6172 6773 2e73 6574        kwargs.set
+00009ed0: 6465 6661 756c 7428 2273 656e 6465 6f66  default("sendeof
+00009ee0: 222c 2046 616c 7365 290a 2020 2020 2020  ", False).      
+00009ef0: 2020 2020 2020 656c 6966 205f 4950 5954        elif _IPYT
+00009f00: 484f 4e5f 5645 5253 494f 4e20 3e3d 2028  HON_VERSION >= (
+00009f10: 332c 293a 0a20 2020 2020 2020 2020 2020  3,):.           
+00009f20: 2020 2020 2023 2049 5079 7468 6f6e 2063       # IPython c
+00009f30: 6f6e 736f 6c65 2033 2e30 2c20 332e 3120  onsole 3.0, 3.1 
+00009f40: 616c 7761 7973 206b 696c 6c20 7468 6520  always kill the 
+00009f50: 6b65 726e 656c 2075 706f 6e20 6578 6974  kernel upon exit
+00009f60: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009f70: 2020 2320 5468 6572 6527 7320 6120 7075    # There's a pu
+00009f80: 7270 6f72 7465 6420 6f70 7469 6f6e 2065  rported option e
+00009f90: 7869 7428 6b65 6570 5f6b 6572 6e65 6c3d  xit(keep_kernel=
+00009fa0: 5472 7565 2920 6275 7420 6974 2773 206e  True) but it's n
+00009fb0: 6f74 0a20 2020 2020 2020 2020 2020 2020  ot.             
+00009fc0: 2020 2023 2069 6d70 6c65 6d65 6e74 6564     # implemented
+00009fd0: 2069 6e20 7468 6573 6520 7665 7273 696f   in these versio
+00009fe0: 6e73 2e0a 2020 2020 2020 2020 2020 2020  ns..            
+00009ff0: 2020 2020 2320 6874 7470 733a 2f2f 6769      # https://gi
+0000a000: 7468 7562 2e63 6f6d 2f69 7079 7468 6f6e  thub.com/ipython
+0000a010: 2f69 7079 7468 6f6e 2f69 7373 7565 732f  /ipython/issues/
+0000a020: 3834 3832 0a20 2020 2020 2020 2020 2020  8482.           
+0000a030: 2020 2020 2023 2068 7474 7073 3a2f 2f67       # https://g
+0000a040: 6974 6875 622e 636f 6d2f 6970 7974 686f  ithub.com/ipytho
+0000a050: 6e2f 6970 7974 686f 6e2f 7075 6c6c 2f38  n/ipython/pull/8
+0000a060: 3438 330a 2020 2020 2020 2020 2020 2020  483.            
+0000a070: 2020 2020 2320 496e 7374 6561 6420 6f66      # Instead of
+0000a080: 2063 6c65 616e 6c79 2074 656c 6c69 6e67   cleanly telling
+0000a090: 2074 6865 2063 6c69 656e 7420 746f 2065   the client to e
+0000a0a0: 7869 742c 2077 6527 6c6c 206a 7573 7420  xit, we'll just 
+0000a0b0: 6b69 6c6c 0a20 2020 2020 2020 2020 2020  kill.           
+0000a0c0: 2020 2020 2023 2069 7420 7769 7468 2053       # it with S
+0000a0d0: 4947 4b49 4c4c 2028 696e 2074 6865 2027  IGKILL (in the '
+0000a0e0: 6669 6e61 6c6c 7927 2063 6c61 7573 6520  finally' clause 
+0000a0f0: 6f66 2049 5079 7468 6f6e 4374 7829 2e0a  of IPythonCtx)..
+0000a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a110: 6b77 6172 6773 2e73 6574 6465 6661 756c  kwargs.setdefaul
+0000a120: 7428 2265 7869 7473 7472 222c 2062 2222  t("exitstr", b""
+0000a130: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000a140: 2020 6b77 6172 6773 2e73 6574 6465 6661    kwargs.setdefa
+0000a150: 756c 7428 2273 656e 6465 6f66 222c 2046  ult("sendeof", F
+0000a160: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
+0000a170: 2020 2020 2020 6b77 6172 6773 2e73 6574        kwargs.set
+0000a180: 6465 6661 756c 7428 2277 6169 7465 6f66  default("waiteof
+0000a190: 222c 2046 616c 7365 290a 2020 2020 2020  ", False).      
+0000a1a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000a1b0: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+0000a1c0: 6773 2e73 6574 6465 6661 756c 7428 2273  gs.setdefault("s
+0000a1d0: 656e 6465 6f66 222c 2054 7275 6529 0a20  endeof", True). 
+0000a1e0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0000a1f0: 7761 7267 732e 7365 7464 6566 6175 6c74  wargs.setdefault
+0000a200: 2822 6578 6974 7374 7222 2c20 6222 2220  ("exitstr", b"" 
+0000a210: 6966 206b 7761 7267 735b 2773 656e 6465  if kwargs['sende
+0000a220: 6f66 275d 2065 6c73 6520 6222 6578 6974  of'] else b"exit
+0000a230: 2829 2229 0a20 2020 2020 2020 2065 6c73  ()").        els
+0000a240: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+0000a250: 6620 5f49 5059 5448 4f4e 5f56 4552 5349  f _IPYTHON_VERSI
+0000a260: 4f4e 203e 3d20 2835 2c29 3a0a 2020 2020  ON >= (5,):.    
+0000a270: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+0000a280: 6773 2e73 6574 6465 6661 756c 7428 2273  gs.setdefault("s
+0000a290: 656e 6465 6f66 222c 2046 616c 7365 290a  endeof", False).
+0000a2a0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000a2b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a2c0: 2020 6b77 6172 6773 2e73 6574 6465 6661    kwargs.setdefa
+0000a2d0: 756c 7428 2273 656e 6465 6f66 222c 2054  ult("sendeof", T
+0000a2e0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0000a2f0: 206b 7761 7267 732e 7365 7464 6566 6175   kwargs.setdefau
+0000a300: 6c74 2822 6578 6974 7374 7222 2c20 6222  lt("exitstr", b"
+0000a310: 2220 6966 206b 7761 7267 735b 2773 656e  " if kwargs['sen
+0000a320: 6465 6f66 275d 2065 6c73 6520 6222 6578  deof'] else b"ex
+0000a330: 6974 2829 2229 0a20 2020 2020 2020 206b  it()").        k
+0000a340: 7761 7267 732e 7365 7464 6566 6175 6c74  wargs.setdefault
+0000a350: 2822 6967 6e6f 7265 5f70 726f 6d70 745f  ("ignore_prompt_
+0000a360: 6e75 6d62 6572 222c 2054 7275 6529 0a20  number", True). 
+0000a370: 2020 2065 7869 7473 7472 2020 2020 2020     exitstr      
+0000a380: 2020 2020 2020 2020 3d20 6b77 6172 6773          = kwargs
+0000a390: 2e70 6f70 2822 6578 6974 7374 7222 2020  .pop("exitstr"  
+0000a3a0: 2020 2020 2020 2020 2020 202c 2062 2265             , b"e
+0000a3b0: 7869 7428 295c 6e22 290a 2020 2020 7365  xit()\n").    se
+0000a3c0: 6e64 656f 6620 2020 2020 2020 2020 2020  ndeof           
+0000a3d0: 2020 203d 206b 7761 7267 732e 706f 7028     = kwargs.pop(
+0000a3e0: 2273 656e 6465 6f66 2220 2020 2020 2020  "sendeof"       
+0000a3f0: 2020 2020 2020 2c20 4661 6c73 6529 0a20        , False). 
+0000a400: 2020 2077 6169 7465 6f66 2020 2020 2020     waiteof      
+0000a410: 2020 2020 2020 2020 3d20 6b77 6172 6773          = kwargs
+0000a420: 2e70 6f70 2822 7761 6974 656f 6622 2020  .pop("waiteof"  
+0000a430: 2020 2020 2020 2020 2020 202c 2054 7275             , Tru
+0000a440: 6529 0a20 2020 2069 676e 6f72 655f 7072  e).    ignore_pr
+0000a450: 6f6d 7074 5f6e 756d 6265 7220 3d20 6b77  ompt_number = kw
+0000a460: 6172 6773 2e70 6f70 2822 6967 6e6f 7265  args.pop("ignore
+0000a470: 5f70 726f 6d70 745f 6e75 6d62 6572 222c  _prompt_number",
+0000a480: 2046 616c 7365 290a 2020 2020 6966 206b   False).    if k
+0000a490: 6572 6e65 6c20 6973 206e 6f74 204e 6f6e  ernel is not Non
+0000a4a0: 653a 0a20 2020 2020 2020 2061 7267 7320  e:.        args 
+0000a4b0: 2b3d 205b 692e 6465 636f 6465 2827 7574  += [i.decode('ut
+0000a4c0: 662d 3827 2920 666f 7220 6920 696e 206b  f-8') for i in k
+0000a4d0: 6572 6e65 6c2e 6b65 726e 656c 5f69 6e66  ernel.kernel_inf
+0000a4e0: 6f5d 0a20 2020 2020 2020 206b 7761 7267  o].        kwarg
+0000a4f0: 732e 7365 7464 6566 6175 6c74 2822 6970  s.setdefault("ip
+0000a500: 7974 686f 6e5f 6469 7222 2c20 6b65 726e  ython_dir", kern
+0000a510: 656c 2e69 7079 7468 6f6e 5f64 6972 290a  el.ipython_dir).
+0000a520: 2020 2020 7072 696e 7428 2249 6e70 7574      print("Input
+0000a530: 3a22 290a 2020 2020 7072 696e 7428 2222  :").    print(""
+0000a540: 2e6a 6f69 6e28 2220 2020 2025 735c 6e22  .join("    %s\n"
+0000a550: 256c 696e 6520 666f 7220 6c69 6e65 2069  %line for line i
+0000a560: 6e20 696e 7075 742e 7370 6c69 746c 696e  n input.splitlin
+0000a570: 6573 2829 2929 0a20 2020 2077 6974 6820  es())).    with 
+0000a580: 4950 7974 686f 6e43 7478 2861 7267 733d  IPythonCtx(args=
+0000a590: 6172 6773 2c20 2a2a 6b77 6172 6773 2920  args, **kwargs) 
+0000a5a0: 6173 2063 6869 6c64 3a0a 2020 2020 2020  as child:.      
+0000a5b0: 2020 7265 7375 6c74 203d 205f 696e 7465    result = _inte
+0000a5c0: 7261 6374 5f69 7079 7468 6f6e 2863 6869  ract_ipython(chi
+0000a5d0: 6c64 2c20 696e 7075 742c 2065 7869 7473  ld, input, exits
+0000a5e0: 7472 3d65 7869 7473 7472 2c0a 2020 2020  tr=exitstr,.    
+0000a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a600: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000a610: 656e 6465 6f66 3d73 656e 6465 6f66 2c20  endeof=sendeof, 
+0000a620: 7761 6974 656f 663d 7761 6974 656f 6629  waiteof=waiteof)
+0000a630: 0a20 2020 2070 7269 6e74 2822 4f75 7470  .    print("Outp
+0000a640: 7574 3a22 290a 2020 2020 7072 696e 7428  ut:").    print(
+0000a650: 2222 2e6a 6f69 6e28 2220 2020 2025 735c  "".join("    %s\
+0000a660: 6e22 256c 696e 6520 666f 7220 6c69 6e65  n"%line for line
+0000a670: 2069 6e20 7265 7375 6c74 2e73 706c 6974   in result.split
+0000a680: 6c69 6e65 7328 2929 290a 2020 2020 6173  lines())).    as
+0000a690: 7365 7274 5f6d 6174 6368 2872 6573 756c  sert_match(resul
+0000a6a0: 742c 2065 7870 6563 7465 642c 2069 676e  t, expected, ign
+0000a6b0: 6f72 655f 7072 6f6d 7074 5f6e 756d 6265  ore_prompt_numbe
+0000a6c0: 723d 6967 6e6f 7265 5f70 726f 6d70 745f  r=ignore_prompt_
+0000a6d0: 6e75 6d62 6572 290a 0a0a 4063 6f6e 7465  number)...@conte
+0000a6e0: 7874 6d61 6e61 6765 720a 6465 6620 4950  xtmanager.def IP
+0000a6f0: 7974 686f 6e4b 6572 6e65 6c43 7478 282a  ythonKernelCtx(*
+0000a700: 2a6b 7761 7267 7329 3a0a 2020 2020 2222  *kwargs):.    ""
+0000a710: 220a 2020 2020 4c61 756e 6368 2049 5079  ".    Launch IPy
+0000a720: 7468 6f6e 206b 6572 6e65 6c2e 0a20 2020  thon kernel..   
+0000a730: 2022 2222 0a20 2020 205f 5f74 7261 6365   """.    __trace
+0000a740: 6261 636b 6869 6465 5f5f 203d 2054 7275  backhide__ = Tru
+0000a750: 650a 2020 2020 7769 7468 2049 5079 7468  e.    with IPyth
+0000a760: 6f6e 4374 7828 6172 6773 3d27 6b65 726e  onCtx(args='kern
+0000a770: 656c 272c 202a 2a6b 7761 7267 7329 2061  el', **kwargs) a
+0000a780: 7320 6368 696c 643a 0a20 2020 2020 2020  s child:.       
+0000a790: 2023 2047 6574 2074 6865 206b 6572 6e65   # Get the kerne
+0000a7a0: 6c20 696e 666f 3a20 2d2d 6578 6973 7469  l info: --existi
+0000a7b0: 6e67 206b 6572 6e65 6c2d 3132 3334 2e6a  ng kernel-1234.j
+0000a7c0: 736f 6e0a 2020 2020 2020 2020 6368 696c  son.        chil
+0000a7d0: 642e 6578 7065 6374 280a 2020 2020 2020  d.expect(.      
+0000a7e0: 2020 2020 2020 7222 546f 2063 6f6e 6e65        r"To conne
+0000a7f0: 6374 2061 6e6f 7468 6572 2063 6c69 656e  ct another clien
+0000a800: 7420 746f 2074 6869 7320 6b65 726e 656c  t to this kernel
+0000a810: 2c20 7573 653a 5c73 2a22 0a20 2020 2020  , use:\s*".     
+0000a820: 2020 2020 2020 2072 2228 3f3a 5c5b 4950         r"(?:\[IP
+0000a830: 4b65 726e 656c 4170 705c 5d29 3f5c 732a  KernelApp\])?\s*
+0000a840: 282d 2d65 7869 7374 696e 6720 2e2a 3f6a  (--existing .*?j
+0000a850: 736f 6e29 222c 0a20 2020 2020 2020 2020  son)",.         
+0000a860: 2020 2074 696d 656f 7574 3d44 4546 4155     timeout=DEFAU
+0000a870: 4c54 5f54 494d 454f 5554 2c0a 2020 2020  LT_TIMEOUT,.    
+0000a880: 2020 2020 290a 2020 2020 2020 2020 6b65      ).        ke
+0000a890: 726e 656c 5f69 6e66 6f20 3d20 6368 696c  rnel_info = chil
+0000a8a0: 642e 6d61 7463 682e 6772 6f75 7028 3129  d.match.group(1)
+0000a8b0: 2e73 706c 6974 2829 0a20 2020 2020 2020  .split().       
+0000a8c0: 2023 2059 6965 6c64 2063 6f6e 7472 6f6c   # Yield control
+0000a8d0: 2074 6f20 6361 6c6c 6572 2e0a 2020 2020   to caller..    
+0000a8e0: 2020 2020 6368 696c 642e 6b65 726e 656c      child.kernel
+0000a8f0: 5f69 6e66 6f20 3d20 6b65 726e 656c 5f69  _info = kernel_i
+0000a900: 6e66 6f0a 2020 2020 2020 2020 7969 656c  nfo.        yiel
+0000a910: 6420 6368 696c 640a 0a0a 6465 6620 7261  d child...def ra
+0000a920: 6e64 5f63 6861 7273 286c 656e 6774 683d  nd_chars(length=
+0000a930: 382c 206c 6574 7465 7273 3d27 6162 6364  8, letters='abcd
+0000a940: 6566 6768 696a 6b6c 6d6e 6f70 7172 7374  efghijklmnopqrst
+0000a950: 7576 7778 797a 2729 3a0a 2020 2020 7265  uvwxyz'):.    re
+0000a960: 7475 726e 2027 272e 6a6f 696e 285b 7261  turn ''.join([ra
+0000a970: 6e64 6f6d 2e63 686f 6963 6528 6c65 7474  ndom.choice(lett
+0000a980: 6572 7329 2066 6f72 205f 2069 6e20 7261  ers) for _ in ra
+0000a990: 6e67 6528 6c65 6e67 7468 295d 290a 0a0a  nge(length)])...
+0000a9a0: 0a40 636f 6e74 6578 746d 616e 6167 6572  .@contextmanager
+0000a9b0: 0a64 6566 2049 5079 7468 6f6e 4e6f 7465  .def IPythonNote
+0000a9c0: 626f 6f6b 4374 7828 2a2a 6b77 6172 6773  bookCtx(**kwargs
+0000a9d0: 293a 0a20 2020 2022 2222 0a20 2020 204c  ):.    """.    L
+0000a9e0: 6175 6e63 6820 4950 7974 686f 6e20 4e6f  aunch IPython No
+0000a9f0: 7465 626f 6f6b 2e0a 2020 2020 2222 220a  tebook..    """.
+0000aa00: 2020 2020 5f5f 7472 6163 6562 6163 6b68      __tracebackh
+0000aa10: 6964 655f 5f20 3d20 5472 7565 0a20 2020  ide__ = True.   
+0000aa20: 2061 7267 7320 3d20 6b77 6172 6773 2e70   args = kwargs.p
+0000aa30: 6f70 2822 6172 6773 222c 205b 5d29 0a20  op("args", []). 
+0000aa40: 2020 2061 7267 7320 3d20 6172 6773 202b     args = args +
+0000aa50: 205b 276e 6f74 6562 6f6f 6b27 2c20 272d   ['notebook', '-
+0000aa60: 2d6e 6f2d 6272 6f77 7365 7227 2c20 272d  -no-browser', '-
+0000aa70: 2d69 703d 3132 372e 302e 302e 3127 5d0a  -ip=127.0.0.1'].
+0000aa80: 2020 2020 6966 205f 4950 5954 484f 4e5f      if _IPYTHON_
+0000aa90: 5645 5253 494f 4e20 3c20 2835 2c29 3a0a  VERSION < (5,):.
+0000aaa0: 2020 2020 2020 2020 7061 7373 7764 5f70          passwd_p
+0000aab0: 6c61 696e 7465 7874 203d 2072 616e 645f  laintext = rand_
+0000aac0: 6368 6172 7328 290a 2020 2020 2020 2020  chars().        
+0000aad0: 7061 7373 7764 5f68 6173 6865 6420 3d20  passwd_hashed = 
+0000aae0: 4950 7974 686f 6e2e 6c69 622e 7061 7373  IPython.lib.pass
+0000aaf0: 7764 2870 6173 7377 645f 706c 6169 6e74  wd(passwd_plaint
+0000ab00: 6578 7429 0a20 2020 2020 2020 2061 7267  ext).        arg
+0000ab10: 7320 2b3d 205b 272d 2d4e 6f74 6562 6f6f  s += ['--Noteboo
+0000ab20: 6b41 7070 2e70 6173 7377 6f72 643d 2573  kApp.password=%s
+0000ab30: 2720 2520 7061 7373 7764 5f68 6173 6865  ' % passwd_hashe
+0000ab40: 645d 0a20 2020 206e 6f74 6562 6f6f 6b5f  d].    notebook_
+0000ab50: 6469 7220 3d20 6b77 6172 6773 2e70 6f70  dir = kwargs.pop
+0000ab60: 2822 6e6f 7465 626f 6f6b 5f64 6972 222c  ("notebook_dir",
+0000ab70: 204e 6f6e 6529 0a20 2020 2063 6c65 616e   None).    clean
+0000ab80: 7570 7320 3d20 5b5d 0a20 2020 2069 6620  ups = [].    if 
+0000ab90: 6e6f 7420 6e6f 7465 626f 6f6b 5f64 6972  not notebook_dir
+0000aba0: 3a0a 2020 2020 2020 2020 6e6f 7465 626f  :.        notebo
+0000abb0: 6f6b 5f64 6972 203d 206d 6b64 7465 6d70  ok_dir = mkdtemp
+0000abc0: 2870 7265 6669 783d 2270 7966 6c79 6279  (prefix="pyflyby
+0000abd0: 5f74 6573 745f 6e6f 7465 626f 6f6b 735f  _test_notebooks_
+0000abe0: 222c 2073 7566 6669 783d 222e 746d 7022  ", suffix=".tmp"
+0000abf0: 290a 2020 2020 2020 2020 636c 6561 6e75  ).        cleanu
+0000ac00: 7073 2e61 7070 656e 6428 6c61 6d62 6461  ps.append(lambda
+0000ac10: 3a20 726d 7472 6565 286e 6f74 6562 6f6f  : rmtree(noteboo
+0000ac20: 6b5f 6469 7229 290a 2020 2020 7472 793a  k_dir)).    try:
+0000ac30: 0a20 2020 2020 2020 2061 7267 7320 2b3d  .        args +=
+0000ac40: 205b 272d 2d6e 6f74 6562 6f6f 6b2d 6469   ['--notebook-di
+0000ac50: 723d 2573 2720 2520 6e6f 7465 626f 6f6b  r=%s' % notebook
+0000ac60: 5f64 6972 5d0a 2020 2020 2020 2020 7769  _dir].        wi
+0000ac70: 7468 2049 5079 7468 6f6e 4374 7828 6172  th IPythonCtx(ar
+0000ac80: 6773 3d61 7267 732c 202a 2a6b 7761 7267  gs=args, **kwarg
+0000ac90: 7329 2061 7320 6368 696c 643a 0a20 2020  s) as child:.   
+0000aca0: 2020 2020 2020 2020 2069 6620 5f49 5059           if _IPY
+0000acb0: 5448 4f4e 5f56 4552 5349 4f4e 203e 3d20  THON_VERSION >= 
+0000acc0: 2835 2c29 3a0a 2020 2020 2020 2020 2020  (5,):.          
+0000acd0: 2020 2020 2020 2320 4765 7420 7468 6520        # Get the 
+0000ace0: 6261 7365 2055 524c 2066 726f 6d20 7468  base URL from th
+0000acf0: 6520 6e6f 7465 626f 6f6b 2061 7070 2e0a  e notebook app..
+0000ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad10: 6368 696c 642e 6578 7065 6374 280a 2020  child.expect(.  
+0000ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad30: 2020 7222 5c73 2a28 6874 7470 3a2f 2f5b    r"\s*(http://[
+0000ad40: 302d 392e 3a5d 2b29 2f5b 3f5d 746f 6b65  0-9.:]+)/[?]toke
+0000ad50: 6e3d 285b 302d 3961 2d66 5d2b 295c 6e22  n=([0-9a-f]+)\n"
+0000ad60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ad70: 2020 2020 2020 7469 6d65 6f75 743d 4445        timeout=DE
+0000ad80: 4641 554c 545f 5449 4d45 4f55 542c 0a20  FAULT_TIMEOUT,. 
+0000ad90: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000ada0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000adb0: 2062 6173 6575 726c 203d 2063 6869 6c64   baseurl = child
+0000adc0: 2e6d 6174 6368 2e67 726f 7570 2831 292e  .match.group(1).
+0000add0: 6465 636f 6465 2822 7574 662d 3822 290a  decode("utf-8").
+0000ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000adf0: 746f 6b65 6e20 3d20 6368 696c 642e 6d61  token = child.ma
+0000ae00: 7463 682e 6772 6f75 7028 3229 0a20 2020  tch.group(2).   
+0000ae10: 2020 2020 2020 2020 2020 2020 2070 6172               par
+0000ae20: 616d 7320 3d20 6469 6374 2874 6f6b 656e  ams = dict(token
+0000ae30: 3d74 6f6b 656e 290a 2020 2020 2020 2020  =token).        
+0000ae40: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
+0000ae50: 203d 2072 6571 7565 7374 732e 706f 7374   = requests.post
+0000ae60: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000ae70: 2020 2020 2020 6261 7365 7572 6c20 2b20        baseurl + 
+0000ae80: 222f 6170 692f 636f 6e74 656e 7473 222c  "/api/contents",
+0000ae90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000aea0: 2020 2020 2070 6172 616d 733d 7061 7261       params=para
+0000aeb0: 6d73 2c0a 2020 2020 2020 2020 2020 2020  ms,.            
+0000aec0: 2020 2020 2020 2020 7469 6d65 6f75 743d          timeout=
+0000aed0: 4445 4641 554c 545f 5449 4d45 4f55 545f  DEFAULT_TIMEOUT_
+0000aee0: 5245 5155 4553 542c 0a20 2020 2020 2020  REQUEST,.       
+0000aef0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000af00: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+0000af10: 7420 7265 7370 6f6e 7365 2e73 7461 7475  t response.statu
+0000af20: 735f 636f 6465 203d 3d20 3230 310a 2020  s_code == 201.  
+0000af30: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000af40: 4765 7420 7468 6520 6e6f 7465 626f 6f6b  Get the notebook
+0000af50: 2070 6174 6820 2620 6e61 6d65 2066 6f72   path & name for
+0000af60: 2074 6865 206e 6577 206e 6f74 6562 6f6f   the new noteboo
+0000af70: 6b2e 0a20 2020 2020 2020 2020 2020 2020  k..             
+0000af80: 2020 2074 6578 7420 3d20 7265 7370 6f6e     text = respon
+0000af90: 7365 2e74 6578 740a 2020 2020 2020 2020  se.text.        
+0000afa0: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
+0000afb0: 5f64 6174 6120 3d20 6a73 6f6e 2e6c 6f61  _data = json.loa
+0000afc0: 6473 2874 6578 7429 0a20 2020 2020 2020  ds(text).       
+0000afd0: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
+0000afe0: 7265 7370 6f6e 7365 5f64 6174 615b 2770  response_data['p
+0000aff0: 6174 6827 5d0a 2020 2020 2020 2020 2020  ath'].          
+0000b000: 2020 2020 2020 6e61 6d65 203d 2072 6573        name = res
+0000b010: 706f 6e73 655f 6461 7461 5b27 6e61 6d65  ponse_data['name
+0000b020: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+0000b030: 2020 2023 2043 7265 6174 6520 6120 7365     # Create a se
+0000b040: 7373 696f 6e20 2620 6b65 726e 656c 2066  ssion & kernel f
+0000b050: 6f72 2074 6865 206e 6577 206e 6f74 6562  or the new noteb
+0000b060: 6f6f 6b2e 0a20 2020 2020 2020 2020 2020  ook..           
+0000b070: 2020 2020 2072 6571 7565 7374 5f64 6174       request_dat
+0000b080: 6120 3d20 6a73 6f6e 2e64 756d 7073 2864  a = json.dumps(d
+0000b090: 6963 7428 6e6f 7465 626f 6f6b 3d64 6963  ict(notebook=dic
+0000b0a0: 7428 7061 7468 3d70 6174 682c 206e 616d  t(path=path, nam
+0000b0b0: 653d 6e61 6d65 2929 290a 2020 2020 2020  e=name))).      
+0000b0c0: 2020 2020 2020 2020 2020 7265 7370 6f6e            respon
+0000b0d0: 7365 203d 2072 6571 7565 7374 732e 706f  se = requests.po
+0000b0e0: 7374 280a 2020 2020 2020 2020 2020 2020  st(.            
+0000b0f0: 2020 2020 2020 2020 6261 7365 7572 6c20          baseurl 
+0000b100: 2b20 222f 6170 692f 7365 7373 696f 6e73  + "/api/sessions
+0000b110: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000b120: 2020 2020 2020 2064 6174 613d 7265 7175         data=requ
+0000b130: 6573 745f 6461 7461 2c0a 2020 2020 2020  est_data,.      
+0000b140: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0000b150: 7261 6d73 3d70 6172 616d 732c 0a20 2020  rams=params,.   
+0000b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b170: 2074 696d 656f 7574 3d44 4546 4155 4c54   timeout=DEFAULT
+0000b180: 5f54 494d 454f 5554 5f52 4551 5545 5354  _TIMEOUT_REQUEST
+0000b190: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000b1a0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000b1b0: 2020 2020 6173 7365 7274 2072 6573 706f      assert respo
+0000b1c0: 6e73 652e 7374 6174 7573 5f63 6f64 6520  nse.status_code 
+0000b1d0: 3d3d 2032 3031 0a20 2020 2020 2020 2020  == 201.         
+0000b1e0: 2020 2020 2020 2023 2047 6574 2074 6865         # Get the
+0000b1f0: 206b 6572 6e65 6c5f 6964 2066 6f72 2074   kernel_id for t
+0000b200: 6865 206e 6577 206b 6572 6e65 6c2e 0a20  he new kernel.. 
+0000b210: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000b220: 6578 7420 3d20 7265 7370 6f6e 7365 2e74  ext = response.t
+0000b230: 6578 740a 2020 2020 2020 2020 2020 2020  ext.            
+0000b240: 2020 2020 7265 7370 6f6e 7365 5f64 6174      response_dat
+0000b250: 6120 3d20 6a73 6f6e 2e6c 6f61 6473 2874  a = json.loads(t
+0000b260: 6578 7429 0a20 2020 2020 2020 2020 2020  ext).           
+0000b270: 2020 2020 206b 6572 6e65 6c5f 6964 203d       kernel_id =
+0000b280: 2072 6573 706f 6e73 655f 6461 7461 5b27   response_data['
+0000b290: 6b65 726e 656c 275d 5b27 6964 275d 0a20  kernel']['id']. 
+0000b2a0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0000b2b0: 5f49 5059 5448 4f4e 5f56 4552 5349 4f4e  _IPYTHON_VERSION
+0000b2c0: 203e 3d20 2832 2c29 3a0a 2020 2020 2020   >= (2,):.      
+0000b2d0: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
+0000b2e0: 7468 6520 6261 7365 2055 524c 2066 726f  the base URL fro
+0000b2f0: 6d20 7468 6520 6e6f 7465 626f 6f6b 2061  m the notebook a
+0000b300: 7070 2e0a 2020 2020 2020 2020 2020 2020  pp..            
+0000b310: 2020 2020 6368 696c 642e 6578 7065 6374      child.expect
+0000b320: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000b330: 2020 2020 2020 7222 5468 6520 283f 3a49        r"The (?:I
+0000b340: 5079 7468 6f6e 7c4a 7570 7974 6572 2920  Python|Jupyter) 
+0000b350: 4e6f 7465 626f 6f6b 2069 7320 7275 6e6e  Notebook is runn
+0000b360: 696e 6720 6174 3a20 2868 7474 703a 2f2f  ing at: (http://
+0000b370: 5b41 2d5a 612d 7a30 2d39 3a2e 5d2b 295b  [A-Za-z0-9:.]+)[
+0000b380: 2f5c 725c 6e5d 222c 0a20 2020 2020 2020  /\r\n]",.       
+0000b390: 2020 2020 2020 2020 2020 2020 2074 696d               tim
+0000b3a0: 656f 7574 3d44 4546 4155 4c54 5f54 494d  eout=DEFAULT_TIM
+0000b3b0: 454f 5554 2c0a 2020 2020 2020 2020 2020  EOUT,.          
+0000b3c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000b3d0: 2020 2020 2020 2020 6261 7365 7572 6c20          baseurl 
+0000b3e0: 3d20 6368 696c 642e 6d61 7463 682e 6772  = child.match.gr
+0000b3f0: 6f75 7028 3129 2e64 6563 6f64 6528 2275  oup(1).decode("u
+0000b400: 7466 2d38 2229 0a20 2020 2020 2020 2020  tf-8").         
+0000b410: 2020 2020 2020 2023 204c 6f67 696e 2e0a         # Login..
+0000b420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b430: 7265 7370 6f6e 7365 203d 2072 6571 7565  response = reque
+0000b440: 7374 732e 706f 7374 280a 2020 2020 2020  sts.post(.      
+0000b450: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+0000b460: 7365 7572 6c20 2b20 222f 6c6f 6769 6e22  seurl + "/login"
+0000b470: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000b480: 2020 2020 2020 6461 7461 3d64 6963 7428        data=dict(
+0000b490: 7061 7373 776f 7264 3d70 6173 7377 645f  password=passwd_
+0000b4a0: 706c 6169 6e74 6578 7429 2c0a 2020 2020  plaintext),.    
+0000b4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4c0: 616c 6c6f 775f 7265 6469 7265 6374 733d  allow_redirects=
+0000b4d0: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
+0000b4e0: 2020 2020 2020 2020 2020 2074 696d 656f             timeo
+0000b4f0: 7574 3d44 4546 4155 4c54 5f54 494d 454f  ut=DEFAULT_TIMEO
+0000b500: 5554 5f52 4551 5545 5354 2c0a 2020 2020  UT_REQUEST,.    
+0000b510: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000b520: 2020 2020 2020 2020 2020 2020 2020 6173                as
+0000b530: 7365 7274 2072 6573 706f 6e73 652e 7374  sert response.st
+0000b540: 6174 7573 5f63 6f64 6520 3d3d 2033 3032  atus_code == 302
+0000b550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b560: 2063 6f6f 6b69 6573 203d 2072 6573 706f   cookies = respo
+0000b570: 6e73 652e 636f 6f6b 6965 730a 2020 2020  nse.cookies.    
+0000b580: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
+0000b590: 6561 7465 2061 206e 6577 206e 6f74 6562  eate a new noteb
+0000b5a0: 6f6f 6b2e 0a20 2020 2020 2020 2020 2020  ook..           
+0000b5b0: 2020 2020 2023 2047 6574 206e 6f74 6562       # Get noteb
+0000b5c0: 6f6f 6b73 2e0a 2020 2020 2020 2020 2020  ooks..          
+0000b5d0: 2020 2020 2020 7265 7370 6f6e 7365 203d        response =
+0000b5e0: 2072 6571 7565 7374 732e 706f 7374 280a   requests.post(.
+0000b5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b600: 2020 2020 6261 7365 7572 6c20 2b20 222f      baseurl + "/
+0000b610: 6170 692f 6e6f 7465 626f 6f6b 7322 2c0a  api/notebooks",.
+0000b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b630: 2020 2020 636f 6f6b 6965 733d 636f 6f6b      cookies=cook
+0000b640: 6965 732c 0a20 2020 2020 2020 2020 2020  ies,.           
+0000b650: 2020 2020 2020 2020 2074 696d 656f 7574           timeout
+0000b660: 3d44 4546 4155 4c54 5f54 494d 454f 5554  =DEFAULT_TIMEOUT
+0000b670: 5f52 4551 5545 5354 2c0a 2020 2020 2020  _REQUEST,.      
+0000b680: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000b690: 2020 2020 2020 2020 2020 2020 6578 7065              expe
+0000b6a0: 6374 6564 203d 2032 3030 2069 6620 5f49  cted = 200 if _I
+0000b6b0: 5059 5448 4f4e 5f56 4552 5349 4f4e 203e  PYTHON_VERSION >
+0000b6c0: 3d20 2833 2c29 2065 6c73 6520 3230 310a  = (3,) else 201.
+0000b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6e0: 6173 7365 7274 2072 6573 706f 6e73 652e  assert response.
+0000b6f0: 7374 6174 7573 5f63 6f64 6520 3d3d 2065  status_code == e
+0000b700: 7870 6563 7465 640a 2020 2020 2020 2020  xpected.        
+0000b710: 2020 2020 2020 2020 2320 4765 7420 7468          # Get th
+0000b720: 6520 6e6f 7465 626f 6f6b 2070 6174 6820  e notebook path 
+0000b730: 2620 6e61 6d65 2066 6f72 2074 6865 206e  & name for the n
+0000b740: 6577 206e 6f74 6562 6f6f 6b2e 0a20 2020  ew notebook..   
+0000b750: 2020 2020 2020 2020 2020 2020 2074 6578               tex
+0000b760: 7420 3d20 7265 7370 6f6e 7365 2e74 6578  t = response.tex
+0000b770: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0000b780: 2020 7265 7370 6f6e 7365 5f64 6174 6120    response_data 
+0000b790: 3d20 6a73 6f6e 2e6c 6f61 6473 2874 6578  = json.loads(tex
+0000b7a0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+0000b7b0: 2020 2070 6174 6820 3d20 7265 7370 6f6e     path = respon
+0000b7c0: 7365 5f64 6174 615b 2770 6174 6827 5d0a  se_data['path'].
+0000b7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b7e0: 6e61 6d65 203d 2072 6573 706f 6e73 655f  name = response_
+0000b7f0: 6461 7461 5b27 6e61 6d65 275d 0a20 2020  data['name'].   
+0000b800: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+0000b810: 7265 6174 6520 6120 7365 7373 696f 6e20  reate a session 
+0000b820: 2620 6b65 726e 656c 2066 6f72 2074 6865  & kernel for the
+0000b830: 206e 6577 206e 6f74 6562 6f6f 6b2e 0a20   new notebook.. 
+0000b840: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000b850: 6571 7565 7374 5f64 6174 6120 3d20 6a73  equest_data = js
+0000b860: 6f6e 2e64 756d 7073 2864 6963 7428 6e6f  on.dumps(dict(no
+0000b870: 7465 626f 6f6b 3d64 6963 7428 7061 7468  tebook=dict(path
+0000b880: 3d70 6174 682c 206e 616d 653d 6e61 6d65  =path, name=name
+0000b890: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
+0000b8a0: 2020 2020 7265 7370 6f6e 7365 203d 2072      response = r
+0000b8b0: 6571 7565 7374 732e 706f 7374 280a 2020  equests.post(.  
+0000b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8d0: 2020 6261 7365 7572 6c20 2b20 222f 6170    baseurl + "/ap
+0000b8e0: 692f 7365 7373 696f 6e73 222c 0a20 2020  i/sessions",.   
+0000b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b900: 2064 6174 613d 7265 7175 6573 745f 6461   data=request_da
+0000b910: 7461 2c0a 2020 2020 2020 2020 2020 2020  ta,.            
+0000b920: 2020 2020 2020 2020 636f 6f6b 6965 733d          cookies=
+0000b930: 636f 6f6b 6965 732c 0a20 2020 2020 2020  cookies,.       
+0000b940: 2020 2020 2020 2020 2020 2020 2074 696d               tim
+0000b950: 656f 7574 3d44 4546 4155 4c54 5f54 494d  eout=DEFAULT_TIM
+0000b960: 454f 5554 5f52 4551 5545 5354 2c0a 2020  EOUT_REQUEST,.  
+0000b970: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000b980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b990: 6173 7365 7274 2072 6573 706f 6e73 652e  assert response.
+0000b9a0: 7374 6174 7573 5f63 6f64 6520 3d3d 2032  status_code == 2
+0000b9b0: 3031 0a20 2020 2020 2020 2020 2020 2020  01.             
+0000b9c0: 2020 2023 2047 6574 2074 6865 206b 6572     # Get the ker
+0000b9d0: 6e65 6c5f 6964 2066 6f72 2074 6865 206e  nel_id for the n
+0000b9e0: 6577 206b 6572 6e65 6c2e 0a20 2020 2020  ew kernel..     
+0000b9f0: 2020 2020 2020 2020 2020 2074 6578 7420             text 
+0000ba00: 3d20 7265 7370 6f6e 7365 2e74 6578 740a  = response.text.
 0000ba10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba20: 2062 6173 6575 726c 202b 2022 2f6c 6f67   baseurl + "/log
-0000ba30: 696e 222c 0a20 2020 2020 2020 2020 2020  in",.           
-0000ba40: 2020 2020 2020 2020 2064 6174 613d 6469           data=di
-0000ba50: 6374 2870 6173 7377 6f72 643d 7061 7373  ct(password=pass
-0000ba60: 7764 5f70 6c61 696e 7465 7874 292c 0a20  wd_plaintext),. 
-0000ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba80: 2020 2061 6c6c 6f77 5f72 6564 6972 6563     allow_redirec
-0000ba90: 7473 3d46 616c 7365 2c0a 2020 2020 2020  ts=False,.      
-0000baa0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-0000bab0: 6d65 6f75 743d 4445 4641 554c 545f 5449  meout=DEFAULT_TI
-0000bac0: 4d45 4f55 545f 5245 5155 4553 542c 0a20  MEOUT_REQUEST,. 
-0000bad0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000bae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000baf0: 2061 7373 6572 7420 7265 7370 6f6e 7365   assert response
-0000bb00: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
-0000bb10: 3330 320a 2020 2020 2020 2020 2020 2020  302.            
-0000bb20: 2020 2020 636f 6f6b 6965 7320 3d20 7265      cookies = re
-0000bb30: 7370 6f6e 7365 2e63 6f6f 6b69 6573 0a20  sponse.cookies. 
-0000bb40: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000bb50: 2043 7265 6174 6520 6120 6e65 7720 6e6f   Create a new no
-0000bb60: 7465 626f 6f6b 2e0a 2020 2020 2020 2020  tebook..        
-0000bb70: 2020 2020 2020 2020 2320 4765 7420 6e6f          # Get no
-0000bb80: 7465 626f 6f6b 732e 0a20 2020 2020 2020  tebooks..       
-0000bb90: 2020 2020 2020 2020 2072 6573 706f 6e73           respons
-0000bba0: 6520 3d20 7265 7175 6573 7473 2e70 6f73  e = requests.pos
-0000bbb0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-0000bbc0: 2020 2020 2020 2062 6173 6575 726c 202b         baseurl +
-0000bbd0: 2022 2f61 7069 2f6e 6f74 6562 6f6f 6b73   "/api/notebooks
-0000bbe0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000bbf0: 2020 2020 2020 2063 6f6f 6b69 6573 3d63         cookies=c
-0000bc00: 6f6f 6b69 6573 2c0a 2020 2020 2020 2020  ookies,.        
-0000bc10: 2020 2020 2020 2020 2020 2020 7469 6d65              time
-0000bc20: 6f75 743d 4445 4641 554c 545f 5449 4d45  out=DEFAULT_TIME
-0000bc30: 4f55 545f 5245 5155 4553 542c 0a20 2020  OUT_REQUEST,.   
-0000bc40: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0000bc50: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000bc60: 7870 6563 7465 6420 3d20 3230 3020 6966  xpected = 200 if
-0000bc70: 205f 4950 5954 484f 4e5f 5645 5253 494f   _IPYTHON_VERSIO
-0000bc80: 4e20 3e3d 2028 332c 2920 656c 7365 2032  N >= (3,) else 2
-0000bc90: 3031 0a20 2020 2020 2020 2020 2020 2020  01.             
-0000bca0: 2020 2061 7373 6572 7420 7265 7370 6f6e     assert respon
-0000bcb0: 7365 2e73 7461 7475 735f 636f 6465 203d  se.status_code =
-0000bcc0: 3d20 6578 7065 6374 6564 0a20 2020 2020  = expected.     
-0000bcd0: 2020 2020 2020 2020 2020 2023 2047 6574             # Get
-0000bce0: 2074 6865 206e 6f74 6562 6f6f 6b20 7061   the notebook pa
-0000bcf0: 7468 2026 206e 616d 6520 666f 7220 7468  th & name for th
-0000bd00: 6520 6e65 7720 6e6f 7465 626f 6f6b 2e0a  e new notebook..
-0000bd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd20: 7465 7874 203d 2072 6573 706f 6e73 652e  text = response.
-0000bd30: 7465 7874 0a20 2020 2020 2020 2020 2020  text.           
-0000bd40: 2020 2020 2072 6573 706f 6e73 655f 6461       response_da
-0000bd50: 7461 203d 206a 736f 6e2e 6c6f 6164 7328  ta = json.loads(
-0000bd60: 7465 7874 290a 2020 2020 2020 2020 2020  text).          
-0000bd70: 2020 2020 2020 7061 7468 203d 2072 6573        path = res
-0000bd80: 706f 6e73 655f 6461 7461 5b27 7061 7468  ponse_data['path
-0000bd90: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-0000bda0: 2020 206e 616d 6520 3d20 7265 7370 6f6e     name = respon
-0000bdb0: 7365 5f64 6174 615b 276e 616d 6527 5d0a  se_data['name'].
-0000bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bdd0: 2320 4372 6561 7465 2061 2073 6573 7369  # Create a sessi
-0000bde0: 6f6e 2026 206b 6572 6e65 6c20 666f 7220  on & kernel for 
-0000bdf0: 7468 6520 6e65 7720 6e6f 7465 626f 6f6b  the new notebook
-0000be00: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000be10: 2020 7265 7175 6573 745f 6461 7461 203d    request_data =
-0000be20: 206a 736f 6e2e 6475 6d70 7328 6469 6374   json.dumps(dict
-0000be30: 286e 6f74 6562 6f6f 6b3d 6469 6374 2870  (notebook=dict(p
-0000be40: 6174 683d 7061 7468 2c20 6e61 6d65 3d6e  ath=path, name=n
-0000be50: 616d 6529 2929 0a20 2020 2020 2020 2020  ame))).         
-0000be60: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
-0000be70: 3d20 7265 7175 6573 7473 2e70 6f73 7428  = requests.post(
-0000be80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000be90: 2020 2020 2062 6173 6575 726c 202b 2022       baseurl + "
-0000bea0: 2f61 7069 2f73 6573 7369 6f6e 7322 2c0a  /api/sessions",.
-0000beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bec0: 2020 2020 6461 7461 3d72 6571 7565 7374      data=request
-0000bed0: 5f64 6174 612c 0a20 2020 2020 2020 2020  _data,.         
-0000bee0: 2020 2020 2020 2020 2020 2063 6f6f 6b69             cooki
-0000bef0: 6573 3d63 6f6f 6b69 6573 2c0a 2020 2020  es=cookies,.    
-0000bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf10: 7469 6d65 6f75 743d 4445 4641 554c 545f  timeout=DEFAULT_
-0000bf20: 5449 4d45 4f55 545f 5245 5155 4553 542c  TIMEOUT_REQUEST,
-0000bf30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bf40: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0000bf50: 2020 2061 7373 6572 7420 7265 7370 6f6e     assert respon
-0000bf60: 7365 2e73 7461 7475 735f 636f 6465 203d  se.status_code =
-0000bf70: 3d20 3230 310a 2020 2020 2020 2020 2020  = 201.          
-0000bf80: 2020 2020 2020 2320 4765 7420 7468 6520        # Get the 
-0000bf90: 6b65 726e 656c 5f69 6420 666f 7220 7468  kernel_id for th
-0000bfa0: 6520 6e65 7720 6b65 726e 656c 2e0a 2020  e new kernel..  
-0000bfb0: 2020 2020 2020 2020 2020 2020 2020 7465                te
-0000bfc0: 7874 203d 2072 6573 706f 6e73 652e 7465  xt = response.te
-0000bfd0: 7874 0a20 2020 2020 2020 2020 2020 2020  xt.             
-0000bfe0: 2020 2072 6573 706f 6e73 655f 6461 7461     response_data
-0000bff0: 203d 206a 736f 6e2e 6c6f 6164 7328 7465   = json.loads(te
-0000c000: 7874 290a 2020 2020 2020 2020 2020 2020  xt).            
-0000c010: 2020 2020 6b65 726e 656c 5f69 6420 3d20      kernel_id = 
-0000c020: 7265 7370 6f6e 7365 5f64 6174 615b 276b  response_data['k
-0000c030: 6572 6e65 6c27 5d5b 2769 6427 5d0a 2020  ernel']['id'].  
-0000c040: 2020 2020 2020 2020 2020 656c 6966 205f            elif _
-0000c050: 4950 5954 484f 4e5f 5645 5253 494f 4e20  IPYTHON_VERSION 
-0000c060: 3e3d 2028 302c 2031 3229 3a0a 2020 2020  >= (0, 12):.    
-0000c070: 2020 2020 2020 2020 2020 2020 2320 4765              # Ge
-0000c080: 7420 7468 6520 6261 7365 2055 524c 2066  t the base URL f
-0000c090: 726f 6d20 7468 6520 6e6f 7465 626f 6f6b  rom the notebook
-0000c0a0: 2061 7070 2e0a 2020 2020 2020 2020 2020   app..          
-0000c0b0: 2020 2020 2020 6368 696c 642e 6578 7065        child.expe
-0000c0c0: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
-0000c0d0: 2020 2020 2020 2020 7222 5468 6520 283f          r"The (?
-0000c0e0: 3a49 5079 7468 6f6e 7c4a 7570 7974 6572  :IPython|Jupyter
-0000c0f0: 2920 4e6f 7465 626f 6f6b 2069 7320 7275  ) Notebook is ru
-0000c100: 6e6e 696e 6720 6174 3a20 2868 7474 703a  nning at: (http:
-0000c110: 2f2f 5b41 2d5a 612d 7a30 2d39 3a2e 5d2b  //[A-Za-z0-9:.]+
-0000c120: 295b 2f5c 725c 6e5d 222c 0a20 2020 2020  )[/\r\n]",.     
-0000c130: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000c140: 696d 656f 7574 3d44 4546 4155 4c54 5f54  imeout=DEFAULT_T
-0000c150: 494d 454f 5554 2c0a 2020 2020 2020 2020  IMEOUT,.        
-0000c160: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000c170: 2020 2020 2020 2020 2020 6261 7365 7572            baseur
-0000c180: 6c20 3d20 6368 696c 642e 6d61 7463 682e  l = child.match.
-0000c190: 6772 6f75 7028 3129 2e64 6563 6f64 6528  group(1).decode(
-0000c1a0: 2275 7466 2d38 2229 0a20 2020 2020 2020  "utf-8").       
-0000c1b0: 2020 2020 2020 2020 2023 204c 6f67 696e           # Login
-0000c1c0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c1d0: 2020 7265 7370 6f6e 7365 203d 2072 6571    response = req
-0000c1e0: 7565 7374 732e 706f 7374 280a 2020 2020  uests.post(.    
-0000c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c200: 6261 7365 7572 6c20 2b20 222f 6c6f 6769  baseurl + "/logi
-0000c210: 6e22 2c0a 2020 2020 2020 2020 2020 2020  n",.            
-0000c220: 2020 2020 2020 2020 6461 7461 3d64 6963          data=dic
-0000c230: 7428 7061 7373 776f 7264 3d70 6173 7377  t(password=passw
-0000c240: 645f 706c 6169 6e74 6578 7429 2c0a 2020  d_plaintext),.  
-0000c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c260: 2020 616c 6c6f 775f 7265 6469 7265 6374    allow_redirect
-0000c270: 733d 4661 6c73 652c 0a20 2020 2020 2020  s=False,.       
-0000c280: 2020 2020 2020 2020 2020 2020 2074 696d               tim
-0000c290: 656f 7574 3d44 4546 4155 4c54 5f54 494d  eout=DEFAULT_TIM
-0000c2a0: 454f 5554 2c0a 2020 2020 2020 2020 2020  EOUT,.          
-0000c2b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000c2c0: 2020 2020 2020 2020 6173 7365 7274 2072          assert r
-0000c2d0: 6573 706f 6e73 652e 7374 6174 7573 5f63  esponse.status_c
-0000c2e0: 6f64 6520 3d3d 2033 3032 0a20 2020 2020  ode == 302.     
-0000c2f0: 2020 2020 2020 2020 2020 2063 6f6f 6b69             cooki
-0000c300: 6573 203d 2072 6573 706f 6e73 652e 636f  es = response.co
-0000c310: 6f6b 6965 730a 2020 2020 2020 2020 2020  okies.          
-0000c320: 2020 2020 2020 2320 4372 6561 7465 2061        # Create a
-0000c330: 206e 6577 206e 6f74 6562 6f6f 6b2e 0a20   new notebook.. 
-0000c340: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000c350: 6573 706f 6e73 6520 3d20 7265 7175 6573  esponse = reques
-0000c360: 7473 2e67 6574 2862 6173 6575 726c 202b  ts.get(baseurl +
-0000c370: 2022 2f6e 6577 2229 0a20 2020 2020 2020   "/new").       
-0000c380: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-0000c390: 7265 7370 6f6e 7365 2e73 7461 7475 735f  response.status_
-0000c3a0: 636f 6465 203d 3d20 3230 300a 2020 2020  code == 200.    
-0000c3b0: 2020 2020 2020 2020 2020 2020 2320 4765              # Ge
-0000c3c0: 7420 7468 6520 6e6f 7465 626f 6f6b 5f69  t the notebook_i
-0000c3d0: 6420 666f 7220 7468 6520 6e65 7720 6e6f  d for the new no
-0000c3e0: 7465 626f 6f6b 2e0a 2020 2020 2020 2020  tebook..        
-0000c3f0: 2020 2020 2020 2020 7465 7874 203d 2072          text = r
-0000c400: 6573 706f 6e73 652e 7465 7874 0a20 2020  esponse.text.   
-0000c410: 2020 2020 2020 2020 2020 2020 206d 203d               m =
-0000c420: 2072 652e 7365 6172 6368 2872 2264 6174   re.search(r"dat
-0000c430: 612d 6e6f 7465 626f 6f6b 2d69 645c 732a  a-notebook-id\s*
-0000c440: 3d5c 732a 285b 302d 3961 2d66 2d5d 2b29  =\s*([0-9a-f-]+)
-0000c450: 222c 2074 6578 7429 0a20 2020 2020 2020  ", text).       
-0000c460: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-0000c470: 6d20 6973 206e 6f74 204e 6f6e 650a 2020  m is not None.  
-0000c480: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-0000c490: 7465 626f 6f6b 5f69 6420 3d20 6d2e 6772  tebook_id = m.gr
-0000c4a0: 6f75 7028 3129 0a20 2020 2020 2020 2020  oup(1).         
-0000c4b0: 2020 2020 2020 2023 2053 7461 7274 2061         # Start a
-0000c4c0: 206b 6572 6e65 6c20 666f 7220 7468 6520   kernel for the 
-0000c4d0: 6e6f 7465 626f 6f6b 2e0a 2020 2020 2020  notebook..      
-0000c4e0: 2020 2020 2020 2020 2020 7265 7370 6f6e            respon
-0000c4f0: 7365 203d 2072 6571 7565 7374 732e 706f  se = requests.po
-0000c500: 7374 280a 2020 2020 2020 2020 2020 2020  st(.            
-0000c510: 2020 2020 2020 2020 6261 7365 7572 6c20          baseurl 
-0000c520: 2b20 222f 6b65 726e 656c 733f 6e6f 7465  + "/kernels?note
-0000c530: 626f 6f6b 3d22 202b 206e 6f74 6562 6f6f  book=" + noteboo
-0000c540: 6b5f 6964 2c0a 2020 2020 2020 2020 2020  k_id,.          
-0000c550: 2020 2020 2020 2020 2020 7469 6d65 6f75            timeou
-0000c560: 743d 4445 4641 554c 545f 5449 4d45 4f55  t=DEFAULT_TIMEOU
-0000c570: 545f 5245 5155 4553 542c 0a20 2020 2020  T_REQUEST,.     
-0000c580: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000c590: 2020 2020 2020 2020 2020 2020 2061 7373               ass
-0000c5a0: 6572 7420 7265 7370 6f6e 7365 2e73 7461  ert response.sta
-0000c5b0: 7475 735f 636f 6465 203d 3d20 3230 300a  tus_code == 200.
-0000c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5d0: 2320 4765 7420 7468 6520 6b65 726e 656c  # Get the kernel
-0000c5e0: 5f69 6420 666f 7220 7468 6520 6e65 7720  _id for the new 
-0000c5f0: 6b65 726e 656c 2e0a 2020 2020 2020 2020  kernel..        
-0000c600: 2020 2020 2020 2020 7465 7874 203d 2072          text = r
-0000c610: 6573 706f 6e73 652e 7465 7874 0a20 2020  esponse.text.   
-0000c620: 2020 2020 2020 2020 2020 2020 206b 6572               ker
-0000c630: 6e65 6c5f 6964 203d 206a 736f 6e2e 6c6f  nel_id = json.lo
-0000c640: 6164 7328 7465 7874 295b 276b 6572 6e65  ads(text)['kerne
-0000c650: 6c5f 6964 275d 0a20 2020 2020 2020 2020  l_id'].         
-0000c660: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000c670: 2020 2020 2020 2020 2072 6169 7365 204e           raise N
-0000c680: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
-0000c690: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0000c6a0: 2020 2020 2020 2020 224e 6f74 2069 6d70          "Not imp
-0000c6b0: 6c65 6d65 6e74 6564 2066 6f72 2049 5079  lemented for IPy
-0000c6c0: 7468 6f6e 2025 7322 2025 2028 4950 7974  thon %s" % (IPyt
-0000c6d0: 686f 6e2e 5f5f 7665 7273 696f 6e5f 5f29  hon.__version__)
-0000c6e0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-0000c6f0: 436f 6e73 7472 7563 7420 7468 6520 6b65  Construct the ke
-0000c700: 726e 656c 2069 6e66 6f20 6c69 6e65 3a20  rnel info line: 
-0000c710: 2d2d 6578 6973 7469 6e67 206b 6572 6e65  --existing kerne
-0000c720: 6c2d 3132 332d 6162 6364 2d2e 2e2e 3435  l-123-abcd-...45
-0000c730: 362e 6a73 6f6e 0a20 2020 2020 2020 2020  6.json.         
-0000c740: 2020 206b 6572 6e65 6c5f 696e 666f 203d     kernel_info =
-0000c750: 205b 6227 2d2d 6578 6973 7469 6e67 272c   [b'--existing',
-0000c760: 2062 226b 6572 6e65 6c2d 2573 2e6a 736f   b"kernel-%s.jso
-0000c770: 6e22 2025 206b 6572 6e65 6c5f 6964 2e65  n" % kernel_id.e
-0000c780: 6e63 6f64 6528 2775 7466 2d38 2729 5d0a  ncode('utf-8')].
-0000c790: 2020 2020 2020 2020 2020 2020 2320 5969              # Yi
-0000c7a0: 656c 6420 636f 6e74 726f 6c20 746f 2063  eld control to c
-0000c7b0: 616c 6c65 722e 0a20 2020 2020 2020 2020  aller..         
-0000c7c0: 2020 2063 6869 6c64 2e6b 6572 6e65 6c5f     child.kernel_
-0000c7d0: 696e 666f 203d 206b 6572 6e65 6c5f 696e  info = kernel_in
-0000c7e0: 666f 0a20 2020 2020 2020 2020 2020 2079  fo.            y
-0000c7f0: 6965 6c64 2063 6869 6c64 0a20 2020 2066  ield child.    f
-0000c800: 696e 616c 6c79 3a0a 2020 2020 2020 2020  inally:.        
-0000c810: 666f 7220 636c 6561 6e75 7020 696e 2063  for cleanup in c
-0000c820: 6c65 616e 7570 733a 0a20 2020 2020 2020  leanups:.       
-0000c830: 2020 2020 2063 6c65 616e 7570 2829 0a0a       cleanup()..
-0000c840: 0a64 6566 205f 7761 6974 5f66 6f72 5f6f  .def _wait_for_o
-0000c850: 7574 7075 7428 6368 696c 642c 2074 696d  utput(child, tim
-0000c860: 656f 7574 293a 0a20 2020 2022 2222 0a20  eout):.    """. 
-0000c870: 2020 2057 6169 7420 7570 2074 6f20 6060     Wait up to ``
-0000c880: 7469 6d65 6f75 7460 6020 7365 636f 6e64  timeout`` second
-0000c890: 7320 666f 7220 6f75 7470 7574 2e0a 2020  s for output..  
-0000c8a0: 2020 2222 220a 2020 2020 2320 496e 2049    """.    # In I
-0000c8b0: 5079 7468 6f6e 2035 2c20 7765 2063 616e  Python 5, we can
-0000c8c0: 6e6f 7420 7365 6e64 2061 6e79 206f 7574  not send any out
-0000c8d0: 7075 7420 6265 666f 7265 2049 5079 7468  put before IPyth
-0000c8e0: 6f6e 2072 6573 706f 6e64 7320 746f 2074  on responds to t
-0000c8f0: 6865 0a20 2020 2023 2074 6162 2c20 656c  he.    # tab, el
-0000c900: 7365 2069 7420 776f 6e27 7420 7265 7370  se it won't resp
-0000c910: 6f6e 6420 746f 2074 6865 2074 6162 2e20  ond to the tab. 
-0000c920: 2054 6865 2070 7572 706f 7365 206f 6620   The purpose of 
-0000c930: 7468 6973 2066 756e 6374 696f 6e20 6973  this function is
-0000c940: 0a20 2020 2023 2074 6f20 7761 6974 2066  .    # to wait f
-0000c950: 6f72 2049 5079 7468 6f6e 2074 6f20 7265  or IPython to re
-0000c960: 7370 6f6e 6420 746f 2061 2074 6162 2e0a  spond to a tab..
-0000c970: 2020 2020 6966 2044 4542 5547 3a0a 2020      if DEBUG:.  
-0000c980: 2020 2020 2020 7072 696e 7428 225f 7761        print("_wa
-0000c990: 6974 5f66 6f72 5f6f 7574 7075 7428 2922  it_for_output()"
-0000c9a0: 290a 2020 2020 676f 745f 6461 7461 5f61  ).    got_data_a
-0000c9b0: 6c72 6561 6479 203d 2046 616c 7365 0a20  lready = False. 
-0000c9c0: 2020 2023 2052 6561 6420 6060 424c 4f43     # Read ``BLOC
-0000c9d0: 4b53 495a 4560 6020 6279 7465 7320 6174  KSIZE`` bytes at
-0000c9e0: 2061 2074 696d 652e 2020 4e6f 7465 2074   a time.  Note t
-0000c9f0: 6861 7420 6375 7272 656e 746c 7920 6f75  hat currently ou
-0000ca00: 7220 616e 7369 2066 696c 7465 720a 2020  r ansi filter.  
-0000ca10: 2020 2320 776f 6e27 7420 776f 726b 2061    # won't work a
-0000ca20: 6372 6f73 7320 626c 6f63 6b20 626f 756e  cross block boun
-0000ca30: 6461 7269 6573 2c20 736f 2063 7572 7265  daries, so curre
-0000ca40: 6e74 6c79 2074 6869 7320 626c 6f63 6b73  ntly this blocks
-0000ca50: 697a 6520 6e65 6564 7320 746f 0a20 2020  ize needs to.   
-0000ca60: 2023 2062 6520 6c61 7267 6520 656e 6f75   # be large enou
-0000ca70: 6768 2074 6861 7420 7765 2064 6f6e 2774  gh that we don't
-0000ca80: 2073 7061 6e20 616e 2041 4e53 4920 7365   span an ANSI se
-0000ca90: 7175 656e 6365 2061 6372 6f73 7320 7477  quence across tw
-0000caa0: 6f20 626c 6f63 6b73 2e0a 2020 2020 424c  o blocks..    BL
-0000cab0: 4f43 4b53 495a 4520 3d20 3136 2a34 3039  OCKSIZE = 16*409
-0000cac0: 360a 2020 2020 6465 6164 6c69 6e65 203d  6.    deadline =
-0000cad0: 2074 696d 652e 7469 6d65 2829 202b 2074   time.time() + t
-0000cae0: 696d 656f 7574 0a20 2020 2077 6869 6c65  imeout.    while
-0000caf0: 2054 7275 653a 0a20 2020 2020 2020 2069   True:.        i
-0000cb00: 6620 6368 696c 642e 666c 6167 5f65 6f66  f child.flag_eof
-0000cb10: 3a0a 2020 2020 2020 2020 2020 2020 6272  :.            br
-0000cb20: 6561 6b0a 2020 2020 2020 2020 6966 2067  eak.        if g
-0000cb30: 6f74 5f64 6174 615f 616c 7265 6164 793a  ot_data_already:
-0000cb40: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-0000cb50: 6620 7765 2070 7265 7669 6f75 736c 7920  f we previously 
-0000cb60: 676f 7420 616e 7920 6461 7461 2028 6166  got any data (af
-0000cb70: 7465 7220 616e 7369 2066 696c 7465 7269  ter ansi filteri
-0000cb80: 6e67 292c 2074 6865 6e20 6b65 6570 0a20  ng), then keep. 
-0000cb90: 2020 2020 2020 2020 2020 2023 2067 6f69             # goi
-0000cba0: 6e67 2077 6869 6c65 2074 6865 7265 2773  ng while there's
-0000cbb0: 2070 656e 6469 6e67 2064 6174 612e 0a20   pending data.. 
-0000cbc0: 2020 2020 2020 2020 2020 2072 656d 6169             remai
-0000cbd0: 6e69 6e67 5f74 696d 656f 7574 203d 2074  ning_timeout = t
-0000cbe0: 696d 656f 7574 0a20 2020 2020 2020 2065  imeout.        e
-0000cbf0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000cc00: 2023 2057 6169 7420 756e 7469 6c20 7469   # Wait until ti
-0000cc10: 6d65 6f75 742e 2020 5468 6973 2063 6f6e  meout.  This con
-0000cc20: 6469 7469 6f6e 2061 7070 6c69 6573 2069  dition applies i
-0000cc30: 6620 6974 2773 2074 6865 2066 6972 7374  f it's the first
-0000cc40: 0a20 2020 2020 2020 2020 2020 2023 206c  .            # l
-0000cc50: 6f6f 702c 206f 7220 6966 2077 6527 7665  oop, or if we've
-0000cc60: 2067 6f74 7465 6e20 736f 6d65 206e 6f6e   gotten some non
-0000cc70: 2d65 6d70 7479 2064 6174 6120 6166 7465  -empty data afte
-0000cc80: 7220 616e 7369 0a20 2020 2020 2020 2020  r ansi.         
-0000cc90: 2020 2023 2066 696c 7465 7269 6e67 2e0a     # filtering..
-0000cca0: 2020 2020 2020 2020 2020 2020 7265 6d61              rema
-0000ccb0: 696e 696e 675f 7469 6d65 6f75 7420 3d20  ining_timeout = 
-0000ccc0: 6465 6164 6c69 6e65 202d 2074 696d 652e  deadline - time.
-0000ccd0: 7469 6d65 2829 0a20 2020 2020 2020 2074  time().        t
-0000cce0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0000ccf0: 6461 7461 203d 2063 6869 6c64 2e72 6561  data = child.rea
-0000cd00: 645f 6e6f 6e62 6c6f 636b 696e 6728 424c  d_nonblocking(BL
-0000cd10: 4f43 4b53 495a 452c 2074 696d 656f 7574  OCKSIZE, timeout
-0000cd20: 3d72 656d 6169 6e69 6e67 5f74 696d 656f  =remaining_timeo
-0000cd30: 7574 290a 2020 2020 2020 2020 6578 6365  ut).        exce
-0000cd40: 7074 2070 6578 7065 6374 2e54 494d 454f  pt pexpect.TIMEO
-0000cd50: 5554 3a0a 2020 2020 2020 2020 2020 2020  UT:.            
-0000cd60: 6966 2044 4542 5547 3a0a 2020 2020 2020  if DEBUG:.      
-0000cd70: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000cd80: 225f 7761 6974 5f66 6f72 5f6f 7574 7075  "_wait_for_outpu
-0000cd90: 7428 293a 2074 696d 656f 7574 2061 6674  t(): timeout aft
-0000cda0: 6572 2025 7320 7365 636f 6e64 7322 2025  er %s seconds" %
-0000cdb0: 2072 656d 6169 6e69 6e67 5f74 696d 656f   remaining_timeo
-0000cdc0: 7574 290a 2020 2020 2020 2020 2020 2020  ut).            
-0000cdd0: 6272 6561 6b0a 2020 2020 2020 2020 6966  break.        if
-0000cde0: 2044 4542 5547 3a0a 2020 2020 2020 2020   DEBUG:.        
-0000cdf0: 2020 2020 7072 696e 7428 225f 7761 6974      print("_wait
-0000ce00: 5f66 6f72 5f6f 7574 7075 7428 293a 2067  _for_output(): g
-0000ce10: 6f74 2025 7222 2025 2028 6461 7461 2c29  ot %r" % (data,)
-0000ce20: 290a 2020 2020 2020 2020 2320 4b65 6570  ).        # Keep
-0000ce30: 2074 6865 2064 6174 6120 696e 2063 6173   the data in cas
-0000ce40: 6520 7765 206e 6565 6420 746f 2065 7870  e we need to exp
-0000ce50: 6563 7420 6f6e 2069 7420 6c61 7465 722e  ect on it later.
-0000ce60: 0a20 2020 2020 2020 2063 6869 6c64 2e5f  .        child._
-0000ce70: 6275 6666 6572 2e77 7269 7465 2864 6174  buffer.write(dat
-0000ce80: 6129 0a20 2020 2020 2020 2023 2057 6520  a).        # We 
-0000ce90: 676f 7420 736f 6d65 2072 6177 2064 6174  got some raw dat
-0000cea0: 612e 2020 4368 6563 6b20 6966 2069 7427  a.  Check if it'
-0000ceb0: 7320 6e6f 6e2d 656d 7074 7920 6166 7465  s non-empty afte
-0000cec0: 7220 616e 7369 2066 696c 7465 7269 6e67  r ansi filtering
-0000ced0: 2e0a 2020 2020 2020 2020 6966 2064 6174  ..        if dat
-0000cee0: 613a 0a20 2020 2020 2020 2020 2020 2067  a:.            g
-0000cef0: 6f74 5f64 6174 615f 616c 7265 6164 7920  ot_data_already 
-0000cf00: 3d20 5472 7565 0a0a 0a64 6566 205f 7761  = True...def _wa
-0000cf10: 6974 5f6e 6f6e 6365 2863 6869 6c64 293a  it_nonce(child):
-0000cf20: 0a20 2020 2022 2222 0a20 2020 2053 656e  .    """.    Sen
-0000cf30: 6420 6120 6e6f 6e63 6520 746f 2074 6865  d a nonce to the
-0000cf40: 2063 6869 6c64 2c20 7468 656e 2077 6169   child, then wai
-0000cf50: 7420 666f 7220 7468 6520 6e6f 6e63 652c  t for the nonce,
-0000cf60: 2074 6865 6e20 6261 636b 7370 6163 6520   then backspace 
-0000cf70: 6974 2e0a 2020 2020 2222 220a 2020 2020  it..    """.    
-0000cf80: 2320 5468 6973 2066 756e 6374 696f 6e20  # This function 
-0000cf90: 7065 7266 6f72 6d73 2061 2063 6c65 7665  performs a cleve
-0000cfa0: 7220 7472 6963 6b2e 2020 5768 656e 2077  r trick.  When w
-0000cfb0: 6520 7573 6520 7461 6220 636f 6d70 6c65  e use tab comple
-0000cfc0: 7469 6f6e 2c20 7765 0a20 2020 2023 206e  tion, we.    # n
-0000cfd0: 6565 6420 746f 2068 616e 646c 6520 6120  eed to handle a 
-0000cfe0: 6665 7720 7661 7269 616e 7473 206f 6620  few variants of 
-0000cff0: 6f75 7470 7574 2e20 2053 7570 706f 7365  output.  Suppose
-0000d000: 2074 6865 2075 7365 7220 656e 7465 7273   the user enters
-0000d010: 0a20 2020 2023 2022 666f 6f2e 625c 7422  .    # "foo.b\t"
-0000d020: 2e20 2057 6520 636f 756c 6420 7365 653a  .  We could see:
-0000d030: 0a20 2020 2023 2020 2031 2e20 4e6f 206f  .    #   1. No o
-0000d040: 7574 7075 742e 2020 5468 6572 6520 7761  utput.  There wa
-0000d050: 7320 6e6f 7468 696e 6720 746f 2063 6f6d  s nothing to com
-0000d060: 706c 6574 652c 2073 6f20 7468 6572 650a  plete, so there.
-0000d070: 2020 2020 2320 2020 2020 2077 696c 6c20      #      will 
-0000d080: 6265 206e 6f20 6f75 7470 7574 2e0a 2020  be no output..  
-0000d090: 2020 2320 2020 2020 2020 2020 496e 205b    #         In [
-0000d0a0: 315d 3a20 666f 6f2e 620a 2020 2020 2320  1]: foo.b.    # 
-0000d0b0: 2020 322e 2052 6567 756c 6172 2063 6f6d    2. Regular com
-0000d0c0: 706c 6574 696f 6e0a 2020 2020 2320 2020  pletion.    #   
-0000d0d0: 2020 2020 2020 496e 205b 315d 3a20 666f        In [1]: fo
-0000d0e0: 6f2e 6261 720a 2020 2020 2320 2020 332e  o.bar.    #   3.
-0000d0f0: 204d 756c 7469 706c 6520 706f 7373 6962   Multiple possib
-0000d100: 696c 6974 6965 7320 2870 6572 6861 7073  ilities (perhaps
-0000d110: 2070 6172 7469 616c 2063 6f6d 706c 6574   partial complet
-0000d120: 696f 6e29 0a20 2020 2023 2020 2020 2020  ion).    #      
-0000d130: 2020 2049 6e20 5b31 5d3a 2066 6f6f 2e62     In [1]: foo.b
-0000d140: 0a20 2020 2023 2020 2020 2020 2020 2066  .    #         f
-0000d150: 6f6f 2e62 6172 3120 2066 6f6f 2e62 6172  oo.bar1  foo.bar
-0000d160: 320a 2020 2020 2320 2020 2020 2020 2020  2.    #         
-0000d170: 496e 205b 315d 3a20 666f 6f2e 6261 720a  In [1]: foo.bar.
-0000d180: 2020 2020 2320 2020 342e 2041 7574 6f69      #   4. Autoi
-0000d190: 6d70 6f72 740a 2020 2020 2320 2020 2020  mport.    #     
-0000d1a0: 2020 2020 496e 205b 315d 3a20 666f 6f2e      In [1]: foo.
-0000d1b0: 620a 2020 2020 2320 2020 2020 2020 2020  b.    #         
-0000d1c0: 5b50 5946 4c59 4259 5d20 696d 706f 7274  [PYFLYBY] import
-0000d1d0: 2066 6f6f 0a20 2020 2023 2020 2020 2020   foo.    #      
-0000d1e0: 2020 2049 6e20 5b31 5d3a 2066 6f6f 2e62     In [1]: foo.b
-0000d1f0: 6172 0a20 2020 2023 2020 2035 2e20 4175  ar.    #   5. Au
-0000d200: 746f 696d 706f 7274 202b 206d 756c 7469  toimport + multi
-0000d210: 706c 6520 706f 7373 6962 696c 6974 6965  ple possibilitie
-0000d220: 730a 2020 2020 2320 2020 2020 2020 2020  s.    #         
-0000d230: 496e 205b 315d 3a20 666f 6f2e 620a 2020  In [1]: foo.b.  
-0000d240: 2020 2320 2020 2020 2020 2020 5b50 5946    #         [PYF
-0000d250: 4c59 4259 5d20 696d 706f 7274 2066 6f6f  LYBY] import foo
-0000d260: 0a20 2020 2023 2020 2020 2020 2020 2049  .    #         I
-0000d270: 6e20 5b31 5d3a 2066 6f6f 2e62 0a20 2020  n [1]: foo.b.   
-0000d280: 2023 2020 2020 2020 2020 2066 6f6f 2e62   #         foo.b
-0000d290: 6172 3120 2066 6f6f 2e62 6172 320a 2020  ar1  foo.bar2.  
-0000d2a0: 2020 2320 2020 2020 2020 2020 496e 205b    #         In [
-0000d2b0: 315d 3a20 666f 6f2e 6261 720a 2020 2020  1]: foo.bar.    
-0000d2c0: 2320 5765 206e 6565 6420 746f 2068 616e  # We need to han
-0000d2d0: 646c 6520 616c 6c20 6f66 2074 6865 7365  dle all of these
-0000d2e0: 2070 6f73 7369 6269 6c69 7469 6573 2e0a   possibilities..
-0000d2f0: 2020 2020 2320 546f 2064 6f20 7468 6174      # To do that
-0000d300: 2c20 7765 2073 656e 6420 6120 6e6f 6e63  , we send a nonc
-0000d310: 6520 7468 6174 2049 5079 7468 6f6e 2077  e that IPython w
-0000d320: 696c 6c20 6563 686f 2062 6163 6b2c 202a  ill echo back, *
-0000d330: 6166 7465 722a 2074 6865 0a20 2020 2023  after* the.    #
-0000d340: 2072 6573 706f 6e73 6520 746f 2074 6865   response to the
-0000d350: 2074 6162 2e20 2054 6869 7320 7761 7920   tab.  This way 
-0000d360: 7765 2063 616e 2077 6169 7420 666f 7220  we can wait for 
-0000d370: 7468 6520 6e6f 6e63 6520 616e 640a 2020  the nonce and.  
-0000d380: 2020 2320 6b6e 6f77 2065 7861 6374 6c79    # know exactly
-0000d390: 2077 6865 6e20 4950 7974 686f 6e20 6973   when IPython is
-0000d3a0: 2064 6f6e 6520 7265 7370 6f6e 6469 6e67   done responding
-0000d3b0: 2074 6f20 7468 6520 7461 622e 0a20 2020   to the tab..   
-0000d3c0: 2023 2053 6f6d 6520 7072 6576 696f 7573   # Some previous
-0000d3d0: 2061 7474 656d 7074 733a 0a20 2020 2023   attempts:.    #
-0000d3e0: 2020 202a 204c 6f6f 6b20 666f 7220 7265     * Look for re
-0000d3f0: 7065 6174 6564 2022 496e 205b 315d 2220  peated "In [1]" 
-0000d400: 746f 2069 6e64 6963 6174 6520 7468 6174  to indicate that
-0000d410: 2069 7427 7320 6e6f 7420 6120 7265 616c   it's not a real
-0000d420: 2070 726f 6d70 742e 0a20 2020 2023 2020   prompt..    #  
-0000d430: 2020 2054 6861 7420 646f 6573 6e27 7420     That doesn't 
-0000d440: 776f 726b 2077 656c 6c20 666f 7220 636f  work well for co
-0000d450: 6e74 696e 7561 7469 6f6e 2070 726f 6d70  ntinuation promp
-0000d460: 7473 2028 222e 2e2e 3a22 292e 0a20 2020  ts ("...:")..   
-0000d470: 2023 2020 202a 204c 6f6f 6b20 666f 7220   #   * Look for 
-0000d480: 225c 6e22 2061 6674 6572 2074 6162 2061  "\n" after tab a
-0000d490: 6e64 2069 6620 736f 206c 6f6f 6b20 666f  nd if so look fo
-0000d4a0: 7220 616e 6f74 6865 7220 7265 7065 6174  r another repeat
-0000d4b0: 6564 2070 726f 6d70 742e 0a20 2020 2023  ed prompt..    #
-0000d4c0: 2020 2020 2054 6861 7420 646f 6573 6e27       That doesn'
-0000d4d0: 7420 776f 726b 2077 656c 6c20 666f 7220  t work well for 
-0000d4e0: 6361 7365 2035 2028 6469 6666 6963 756c  case 5 (difficul
-0000d4f0: 7420 746f 2064 6574 6563 7420 7472 6970  t to detect trip
-0000d500: 6c65 0a20 2020 2023 2020 2020 2070 726f  le.    #     pro
-0000d510: 6d70 7473 2c20 6573 7065 6369 616c 6c79  mpts, especially
-0000d520: 2069 6620 6974 2773 2074 7269 706c 6520   if it's triple 
-0000d530: 636f 6e74 696e 7561 7469 6f6e 2070 726f  continuation pro
-0000d540: 6d70 7473 292c 2061 6e64 0a20 2020 2023  mpts), and.    #
-0000d550: 2020 2020 2072 6571 7569 7265 6420 616e       required an
-0000d560: 2061 6e6e 6f79 696e 6720 7469 6d65 6f75   annoying timeou
-0000d570: 7420 746f 2068 616e 646c 6520 7468 6520  t to handle the 
-0000d580: 6e6f 2d6f 7574 7075 7420 6361 7365 2e0a  no-output case..
-0000d590: 2020 2020 6c6f 6766 696c 655f 7265 6164      logfile_read
-0000d5a0: 203d 2063 6869 6c64 2e6c 6f67 6669 6c65   = child.logfile
-0000d5b0: 5f72 6561 640a 2020 2020 7472 793a 0a20  _read.    try:. 
-0000d5c0: 2020 2020 2020 2023 2054 656d 706f 7261         # Tempora
-0000d5d0: 7269 6c79 2074 7572 6e20 6f66 6620 6c6f  rily turn off lo
-0000d5e0: 6767 696e 6720 6f66 2074 6865 206f 7574  gging of the out
-0000d5f0: 7075 742e 2020 5468 6520 6361 6c6c 6572  put.  The caller
-0000d600: 2064 6f65 736e 2774 206e 6565 640a 2020   doesn't need.  
-0000d610: 2020 2020 2020 2320 746f 2073 6565 2074        # to see t
-0000d620: 6865 206e 6f6e 6365 206f 7220 7468 6520  he nonce or the 
-0000d630: 6261 636b 7370 6163 6573 2e0a 2020 2020  backspaces..    
-0000d640: 2020 2020 6368 696c 642e 6c6f 6766 696c      child.logfil
-0000d650: 655f 7265 6164 203d 204e 6f6e 650a 2020  e_read = None.  
-0000d660: 2020 2020 2020 2320 5365 6e64 2074 6865        # Send the
-0000d670: 206e 6f6e 6365 2e0a 2020 2020 2020 2020   nonce..        
-0000d680: 6e6f 6e63 6520 3d20 223c 5349 4725 7320  nonce = "<SIG%s 
-0000d690: 2f3e 2220 2520 2869 6e74 2872 616e 646f  />" % (int(rando
-0000d6a0: 6d2e 7261 6e64 6f6d 2829 2a31 6539 2929  m.random()*1e9))
-0000d6b0: 0a20 2020 2020 2020 2063 6869 6c64 2e73  .        child.s
-0000d6c0: 656e 6428 6e6f 6e63 6529 0a20 2020 2020  end(nonce).     
-0000d6d0: 2020 2023 2057 6169 7420 666f 7220 7468     # Wait for th
-0000d6e0: 6520 6e6f 6e63 652e 0a20 2020 2020 2020  e nonce..       
-0000d6f0: 2063 6869 6c64 2e65 7870 6563 745f 6578   child.expect_ex
-0000d700: 6163 7428 6e6f 6e63 652c 2074 696d 656f  act(nonce, timeo
-0000d710: 7574 3d44 4546 4155 4c54 5f54 494d 454f  ut=DEFAULT_TIMEO
-0000d720: 5554 290a 2020 2020 2020 2020 6461 7461  UT).        data
-0000d730: 5f61 6674 6572 5f74 6162 203d 2063 6869  _after_tab = chi
-0000d740: 6c64 2e62 6566 6f72 650a 2020 2020 2020  ld.before.      
-0000d750: 2020 2320 4c6f 6720 7768 6174 2063 616d    # Log what cam
-0000d760: 6520 6265 666f 7265 2074 6865 206e 6f6e  e before the non
-0000d770: 6365 2028 6275 7420 6e6f 7420 7468 6520  ce (but not the 
-0000d780: 6e6f 6e63 6520 6974 7365 6c66 292e 0a20  nonce itself).. 
-0000d790: 2020 2020 2020 206c 6f67 6669 6c65 5f72         logfile_r
-0000d7a0: 6561 642e 7772 6974 6528 6461 7461 5f61  ead.write(data_a
-0000d7b0: 6674 6572 5f74 6162 290a 2020 2020 2020  fter_tab).      
-0000d7c0: 2020 2320 4465 6c65 7465 2074 6865 206e    # Delete the n
-0000d7d0: 6f6e 6365 2077 6520 7479 7065 642e 0a20  once we typed.. 
-0000d7e0: 2020 2020 2020 2063 6869 6c64 2e73 656e         child.sen
-0000d7f0: 6428 225c 6222 202a 206c 656e 286e 6f6e  d("\b" * len(non
-0000d800: 6365 2929 0a20 2020 2020 2020 2063 6869  ce)).        chi
-0000d810: 6c64 2e65 7870 6563 7428 0a20 2020 2020  ld.expect(.     
-0000d820: 2020 2020 2020 205b 7222 5c78 3162 5c5b         [r"\x1b\[
-0000d830: 2564 4422 2025 206c 656e 286e 6f6e 6365  %dD" % len(nonce
-0000d840: 292c 2072 225c 7830 385c 7831 625c 5b4b  ), r"\x08\x1b\[K
-0000d850: 2220 2a20 6c65 6e28 6e6f 6e63 6529 2c20  " * len(nonce), 
-0000d860: 2320 4950 7974 686f 6e20 3c20 2035 0a20  # IPython <  5. 
-0000d870: 2020 2020 2020 2020 2020 2020 7222 5c78              r"\x
-0000d880: 3038 205c 7830 3822 2a6c 656e 286e 6f6e  08 \x08"*len(non
-0000d890: 6365 2920 2320 4769 7448 7562 2043 4920  ce) # GitHub CI 
-0000d8a0: 7365 656d 2074 6f20 6f76 6572 7772 6974  seem to overwrit
-0000d8b0: 6520 7769 7468 2073 7061 6365 7320 6f6e  e with spaces on
-0000d8c0: 2074 6f70 206f 6620 6d6f 7669 6e67 2063   top of moving c
-0000d8d0: 7572 736f 7220 3f0a 2020 2020 2020 2020  ursor ?.        
-0000d8e0: 2020 2020 5d2c 0a20 2020 2020 2020 2020      ],.         
-0000d8f0: 2020 2074 696d 656f 7574 3d44 4546 4155     timeout=DEFAU
-0000d900: 4c54 5f54 494d 454f 5554 2c0a 2020 2020  LT_TIMEOUT,.    
-0000d910: 2020 2020 2920 2023 2049 5079 7468 6f6e      )  # IPython
-0000d920: 203e 3d20 3520 2b20 726c 6970 7974 686f   >= 5 + rlipytho
-0000d930: 6e0a 0a20 2020 2066 696e 616c 6c79 3a0a  n..    finally:.
-0000d940: 2020 2020 2020 2020 6368 696c 642e 6c6f          child.lo
-0000d950: 6766 696c 655f 7265 6164 203d 206c 6f67  gfile_read = log
-0000d960: 6669 6c65 5f72 6561 640a 0a0a 6465 6620  file_read...def 
-0000d970: 5f63 6c65 616e 5f62 6163 6b73 7061 6365  _clean_backspace
-0000d980: 2861 7267 293a 0a20 2020 2023 2048 616e  (arg):.    # Han
-0000d990: 646c 6520 666f 6f31 3233 5c62 5c62 5c62  dle foo123\b\b\b
-0000d9a0: 6261 7220 3d3e 2066 6f6f 6261 720a 2020  bar => foobar.  
-0000d9b0: 2020 6c65 6674 203d 2062 2222 0a20 2020    left = b"".   
-0000d9c0: 2072 6967 6874 203d 2061 7267 0a20 2020   right = arg.   
-0000d9d0: 2077 6869 6c65 2072 6967 6874 3a0a 2020   while right:.  
-0000d9e0: 2020 2020 2020 6d20 3d20 7265 2e73 6561        m = re.sea
-0000d9f0: 7263 6828 6222 5c78 3038 2b22 2c20 7269  rch(b"\x08+", ri
-0000da00: 6768 7429 0a20 2020 2020 2020 2069 6620  ght).        if 
-0000da10: 6e6f 7420 6d3a 0a20 2020 2020 2020 2020  not m:.         
-0000da20: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-0000da30: 206c 6566 7420 3d20 6c65 6674 202b 2072   left = left + r
-0000da40: 6967 6874 5b3a 6d2e 7374 6172 7428 295d  ight[:m.start()]
-0000da50: 0a20 2020 2020 2020 2063 6f75 6e74 203d  .        count =
-0000da60: 206d 2e65 6e64 2829 202d 206d 2e73 7461   m.end() - m.sta
-0000da70: 7274 2829 0a20 2020 2020 2020 206c 6566  rt().        lef
-0000da80: 7420 3d20 6c65 6674 5b3a 2d63 6f75 6e74  t = left[:-count
-0000da90: 5d0a 2020 2020 2020 2020 7269 6768 7420  ].        right 
-0000daa0: 3d20 7269 6768 745b 6d2e 656e 6428 293a  = right[m.end():
-0000dab0: 5d0a 2020 2020 6172 6720 3d20 6c65 6674  ].    arg = left
-0000dac0: 202b 2072 6967 6874 0a20 2020 2023 2048   + right.    # H
-0000dad0: 616e 646c 6520 666f 6f31 3233 5c78 3162  andle foo123\x1b
-0000dae0: 5b33 4462 6172 203d 3e20 666f 6f62 6172  [3Dbar => foobar
-0000daf0: 0a20 2020 206c 6566 7420 3d20 6222 220a  .    left = b"".
-0000db00: 2020 2020 7269 6768 7420 3d20 6172 670a      right = arg.
-0000db10: 2020 2020 7768 696c 6520 7269 6768 743a      while right:
-0000db20: 0a20 2020 2020 2020 206d 203d 2072 652e  .        m = re.
-0000db30: 7365 6172 6368 2862 7222 5c78 3162 5c5b  search(br"\x1b\[
-0000db40: 285b 302d 395d 2b29 4422 2c20 7269 6768  ([0-9]+)D", righ
-0000db50: 7429 0a20 2020 2020 2020 2069 6620 6e6f  t).        if no
-0000db60: 7420 6d3a 0a20 2020 2020 2020 2020 2020  t m:.           
-0000db70: 2062 7265 616b 0a20 2020 2020 2020 206c   break.        l
-0000db80: 6566 7420 3d20 6c65 6674 202b 2072 6967  eft = left + rig
-0000db90: 6874 5b3a 6d2e 7374 6172 7428 295d 0a20  ht[:m.start()]. 
-0000dba0: 2020 2020 2020 2063 6f75 6e74 203d 2069         count = i
-0000dbb0: 6e74 286d 2e67 726f 7570 2831 2929 0a20  nt(m.group(1)). 
-0000dbc0: 2020 2020 2020 2072 6967 6874 203d 2072         right = r
-0000dbd0: 6967 6874 5b6d 2e65 6e64 2829 3a5d 0a20  ight[m.end():]. 
-0000dbe0: 2020 2020 2020 2069 6620 5f49 5059 5448         if _IPYTH
-0000dbf0: 4f4e 5f56 4552 5349 4f4e 203c 2028 372c  ON_VERSION < (7,
-0000dc00: 2920 616e 6420 7269 6768 742e 7374 6172  ) and right.star
-0000dc10: 7473 7769 7468 2862 225b 5059 464c 5942  tswith(b"[PYFLYB
-0000dc20: 595d 2229 3a0a 2020 2020 2020 2020 2020  Y]"):.          
-0000dc30: 2020 2320 466f 7220 7075 7270 6f73 6573    # For purposes
-0000dc40: 206f 6620 636f 6d70 6172 696e 6720 4950   of comparing IP
-0000dc50: 7974 686f 6e20 6f75 7470 7574 2069 6e20  ython output in 
-0000dc60: 7072 6f6d 7074 5f74 6f6f 6c6b 6974 206d  prompt_toolkit m
-0000dc70: 6f64 652c 0a20 2020 2020 2020 2020 2020  ode,.           
-0000dc80: 2023 2069 6e63 6c75 6465 2074 6865 2070   # include the p
-0000dc90: 7265 2d62 6163 6b73 7061 6365 2073 7475  re-backspace stu
-0000dca0: 6666 2061 7320 6120 7365 7061 7261 7465  ff as a separate
-0000dcb0: 206c 696e 652e 2020 544f 444f 3a20 646f   line.  TODO: do
-0000dcc0: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
-0000dcd0: 6869 7320 696e 2061 206d 6f72 6520 6c65  his in a more le
-0000dce0: 7373 2068 6163 6b79 2077 6179 2e0a 2020  ss hacky way..  
-0000dcf0: 2020 2020 2020 2020 2020 6c65 6674 203d            left =
-0000dd00: 206c 6566 7420 2b20 6222 5c6e 220a 2020   left + b"\n".  
-0000dd10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000dd20: 2020 2020 2020 2020 6c65 6674 203d 206c          left = l
-0000dd30: 6566 745b 3a2d 636f 756e 745d 0a20 2020  eft[:-count].   
-0000dd40: 2061 7267 203d 206c 6566 7420 2b20 7269   arg = left + ri
-0000dd50: 6768 740a 2020 2020 7265 7475 726e 2061  ght.    return a
-0000dd60: 7267 0a0a 0a0a 6465 6620 5f63 6c65 616e  rg....def _clean
-0000dd70: 5f69 7079 7468 6f6e 5f6f 7574 7075 7428  _ipython_output(
-0000dd80: 7265 7375 6c74 293a 0a20 2020 2022 2222  result):.    """
-0000dd90: 436c 6561 6e20 7570 2049 5079 7468 6f6e  Clean up IPython
-0000dda0: 206f 7574 7075 742e 2222 220a 2020 2020   output.""".    
-0000ddb0: 7265 7375 6c74 3020 3d20 7265 7375 6c74  result0 = result
-0000ddc0: 0a20 2020 2023 2043 616e 6f6e 6963 616c  .    # Canonical
-0000ddd0: 697a 6520 6e65 776c 696e 6573 2e0a 2020  ize newlines..  
-0000dde0: 2020 7265 7375 6c74 203d 2072 652e 7375    result = re.su
-0000ddf0: 6228 6222 5c72 2b5c 6e22 2c20 6222 5c6e  b(b"\r+\n", b"\n
-0000de00: 222c 2072 6573 756c 7429 0a20 2020 2023  ", result).    #
-0000de10: 2043 6c65 616e 2074 6869 6e67 7320 6c69   Clean things li
-0000de20: 6b65 2022 2020 2020 4553 435b 3444 222e  ke "    ESC[4D".
-0000de30: 0a20 2020 2072 6573 756c 7420 3d20 5f63  .    result = _c
-0000de40: 6c65 616e 5f62 6163 6b73 7061 6365 2872  lean_backspace(r
-0000de50: 6573 756c 7429 0a20 2020 2023 204d 616b  esult).    # Mak
-0000de60: 6520 7472 6163 6562 6163 6b20 6f75 7470  e traceback outp
-0000de70: 7574 2073 7461 626c 6520 6163 726f 7373  ut stable across
-0000de80: 2049 5079 7468 6f6e 2076 6572 7369 6f6e   IPython version
-0000de90: 7320 616e 6420 7275 6e73 2e0a 2020 2020  s and runs..    
-0000dea0: 7265 7375 6c74 203d 2072 652e 7375 6228  result = re.sub(
-0000deb0: 7265 2e63 6f6d 7069 6c65 2862 7222 285e  re.compile(br"(^
-0000dec0: 2f2e 2a3f 2f29 3f3c 2869 7079 7468 6f6e  /.*?/)?<(ipython
-0000ded0: 2d69 6e70 7574 2d5b 302d 395d 2b2d 5b30  -input-[0-9]+-[0
-0000dee0: 2d39 612d 665d 2b7c 6970 7974 686f 6e20  -9a-f]+|ipython 
-0000def0: 636f 6e73 6f6c 6529 3e22 2c20 7265 2e4d  console)>", re.M
-0000df00: 292c 2062 223c 6970 7974 686f 6e2d 696e  ), b"<ipython-in
-0000df10: 7075 743e 222c 2072 6573 756c 7429 0a20  put>", result). 
-0000df20: 2020 2072 6573 756c 7420 3d20 7265 2e73     result = re.s
-0000df30: 7562 2872 652e 636f 6d70 696c 6528 6272  ub(re.compile(br
-0000df40: 225e 2d2d 2d2d 3e20 2e2a 3f5c 6e22 2c20  "^----> .*?\n", 
-0000df50: 7265 2e4d 292c 2062 2222 2c20 7265 7375  re.M), b"", resu
-0000df60: 6c74 290a 2020 2020 2320 5265 6d6f 7665  lt).    # Remove
-0000df70: 2063 7275 6674 2072 6573 756c 7469 6e67   cruft resulting
-0000df80: 2066 726f 6d20 666c 616b 696e 6573 7320   from flakiness 
-0000df90: 696e 2027 6970 7974 686f 6e20 636f 6e73  in 'ipython cons
-0000dfa0: 6f6c 6527 0a20 2020 2069 6620 5f49 5059  ole'.    if _IPY
-0000dfb0: 5448 4f4e 5f56 4552 5349 4f4e 203c 2028  THON_VERSION < (
-0000dfc0: 322c 293a 0a20 2020 2020 2020 2072 6573  2,):.        res
-0000dfd0: 756c 7420 3d20 7265 2e73 7562 2872 652e  ult = re.sub(re.
-0000dfe0: 636f 6d70 696c 6528 6272 2245 7863 6570  compile(br"Excep
-0000dff0: 7469 6f6e 2069 6e20 7468 7265 6164 2054  tion in thread T
-0000e000: 6872 6561 642d 5b30 2d39 5d2b 205b 285d  hread-[0-9]+ [(]
-0000e010: 6d6f 7374 206c 696b 656c 7920 7261 6973  most likely rais
-0000e020: 6564 2064 7572 696e 6720 696e 7465 7270  ed during interp
-0000e030: 7265 7465 7220 7368 7574 646f 776e 5b29  reter shutdown[)
-0000e040: 5d3a 2e2a 222c 2072 652e 5329 2c20 6222  ]:.*", re.S), b"
-0000e050: 222c 2072 6573 756c 7429 0a20 2020 2023  ", result).    #
-0000e060: 2052 656d 6f76 6520 7472 6169 6c69 6e67   Remove trailing
-0000e070: 2070 6f73 742d 6578 6974 206d 6573 7361   post-exit messa
-0000e080: 6765 2e0a 2020 2020 6966 205f 4950 5954  ge..    if _IPYT
-0000e090: 484f 4e5f 5645 5253 494f 4e20 3e3d 2028  HON_VERSION >= (
-0000e0a0: 332c 293a 0a20 2020 2020 2020 2072 6573  3,):.        res
-0000e0b0: 756c 7420 3d20 7265 2e73 7562 2862 2228  ult = re.sub(b"(
-0000e0c0: 3f3a 5368 7574 7469 6e67 2064 6f77 6e20  ?:Shutting down 
-0000e0d0: 6b65 726e 656c 7c6b 6565 7069 6e67 206b  kernel|keeping k
-0000e0e0: 6572 6e65 6c20 616c 6976 6529 5c6e 3f24  ernel alive)\n?$
-0000e0f0: 222c 2062 2222 2c20 7265 7375 6c74 290a  ", b"", result).
-0000e100: 2020 2020 2320 576f 726b 2061 726f 756e      # Work aroun
-0000e110: 640a 2020 2020 2320 6874 7470 733a 2f2f  d.    # https://
-0000e120: 6769 7468 7562 2e63 6f6d 2f70 726f 6d70  github.com/promp
-0000e130: 742d 746f 6f6c 6b69 742f 7079 7468 6f6e  t-toolkit/python
-0000e140: 2d70 726f 6d70 742d 746f 6f6c 6b69 742f  -prompt-toolkit/
-0000e150: 6973 7375 6573 2f38 3836 0a20 2020 2072  issues/886.    r
-0000e160: 6573 756c 7420 3d20 7265 2e73 7562 2862  esult = re.sub(b
-0000e170: 7222 4578 6365 7074 696f 6e20 696e 2064  r"Exception in d
-0000e180: 6566 6175 6c74 2065 7863 6570 7469 6f6e  efault exception
-0000e190: 2068 616e 646c 6572 2e2a 3f44 7572 696e   handler.*?Durin
-0000e1a0: 6720 6861 6e64 6c69 6e67 206f 6620 7468  g handling of th
-0000e1b0: 6520 6162 6f76 6520 6578 6365 7074 696f  e above exceptio
-0000e1c0: 6e2c 2061 6e6f 7468 6572 2065 7863 6570  n, another excep
-0000e1d0: 7469 6f6e 206f 6363 7572 7265 643a 2e2a  tion occurred:.*
-0000e1e0: 3f61 7373 6572 7420 6170 705c 2e5f 6973  ?assert app\._is
-0000e1f0: 5f72 756e 6e69 6e67 5c6e 4173 7365 7274  _running\nAssert
-0000e200: 696f 6e45 7272 6f72 5c6e 222c 2062 2222  ionError\n", b""
-0000e210: 2c20 7265 7375 6c74 2c20 666c 6167 733d  , result, flags=
-0000e220: 7265 2e44 4f54 414c 4c29 0a20 2020 2023  re.DOTALL).    #
-0000e230: 2043 5052 2073 7475 6666 2066 726f 6d20   CPR stuff from 
-0000e240: 7072 6f6d 7074 2d74 6f6f 6c6b 6974 2032  prompt-toolkit 2
-0000e250: 2e30 0a20 2020 2072 6573 756c 7420 3d20  .0.    result = 
-0000e260: 7265 7375 6c74 2e72 6570 6c61 6365 2862  result.replace(b
-0000e270: 2257 4152 4e49 4e47 3a20 796f 7572 2074  "WARNING: your t
-0000e280: 6572 6d69 6e61 6c20 646f 6573 6e27 7420  erminal doesn't 
-0000e290: 7375 7070 6f72 7420 6375 7273 6f72 2070  support cursor p
-0000e2a0: 6f73 6974 696f 6e20 7265 7175 6573 7473  osition requests
-0000e2b0: 2028 4350 5229 2e5c 6e22 2c20 6222 2229   (CPR).\n", b"")
-0000e2c0: 0a20 2020 2023 2052 656d 6f76 6520 7472  .    # Remove tr
-0000e2d0: 6169 6c69 6e67 2022 496e 205b 4e5d 3a22  ailing "In [N]:"
-0000e2e0: 2c20 6966 2061 6e79 2e0a 2020 2020 7265  , if any..    re
-0000e2f0: 7375 6c74 203d 2072 652e 7375 6228 6272  sult = re.sub(br
-0000e300: 2225 735c 6e3f 2422 255f 4950 5954 484f  "%s\n?$"%_IPYTHO
-0000e310: 4e5f 5052 4f4d 5054 312c 2062 2222 2c20  N_PROMPT1, b"", 
-0000e320: 7265 7375 6c74 290a 2020 2020 2320 5265  result).    # Re
-0000e330: 6d6f 7665 2074 7261 696c 696e 6720 2249  move trailing "I
-0000e340: 6e20 5b4e 5d3a 2065 7869 7428 2922 2e0a  n [N]: exit()"..
-0000e350: 2020 2020 7265 7375 6c74 203d 2072 652e      result = re.
-0000e360: 7375 6228 6272 2225 7365 7869 745b 285d  sub(br"%sexit[(]
-0000e370: 283f 3a6b 6565 705f 6b65 726e 656c 3d54  (?:keep_kernel=T
-0000e380: 7275 6529 3f5b 295d 5c6e 3f24 2225 5f49  rue)?[)]\n?$"%_I
-0000e390: 5059 5448 4f4e 5f50 524f 4d50 5431 2c20  PYTHON_PROMPT1, 
-0000e3a0: 6222 222c 2072 6573 756c 7429 0a20 2020  b"", result).   
-0000e3b0: 2023 2043 6f6d 7072 6573 7320 6e65 776c   # Compress newl
-0000e3c0: 696e 6573 2e0a 2020 2020 7265 7375 6c74  ines..    result
-0000e3d0: 203d 2072 652e 7375 6228 6272 225c 6e5c   = re.sub(br"\n\
-0000e3e0: 6e2b 222c 2062 225c 6e22 2c20 7265 7375  n+", b"\n", resu
-0000e3f0: 6c74 290a 2020 2020 2320 5265 6d6f 7665  lt).    # Remove
-0000e400: 2078 7465 726d 2074 6974 6c65 2073 6574   xterm title set
-0000e410: 7469 6e67 2e0a 2020 2020 7265 7375 6c74  ting..    result
-0000e420: 203d 2072 652e 7375 6228 6222 5c78 3162   = re.sub(b"\x1b
-0000e430: 5d30 3b5b 5e5c 7831 625c 7830 375d 2a5c  ]0;[^\x1b\x07]*\
-0000e440: 7830 3722 2c20 6222 222c 2072 6573 756c  x07", b"", resul
-0000e450: 7429 0a20 2020 2023 2052 656d 6f76 6520  t).    # Remove 
-0000e460: 4245 4c73 2028 646f 6e65 2061 6674 6572  BELs (done after
-0000e470: 2074 6865 2061 626f 7665 2063 6f64 6573   the above codes
-0000e480: 2c20 7768 6963 6820 7573 6520 5c78 3037  , which use \x07
-0000e490: 2061 7320 6120 6465 6c69 6d69 7465 7229   as a delimiter)
-0000e4a0: 0a20 2020 2072 6573 756c 7420 3d20 7265  .    result = re
-0000e4b0: 7375 6c74 2e72 6570 6c61 6365 2862 225c  sult.replace(b"\
-0000e4c0: 7830 3722 2c20 6222 2229 0a20 2020 2023  x07", b"").    #
-0000e4d0: 2052 656d 6f76 6520 636f 6465 2074 6f20   Remove code to 
-0000e4e0: 636c 6561 7220 746f 2065 6e64 206f 6620  clear to end of 
-0000e4f0: 6c69 6e65 2e20 5468 6973 2069 7320 646f  line. This is do
-0000e500: 6e65 2068 6572 6520 696e 7374 6561 6420  ne here instead 
-0000e510: 6f66 2069 6e0a 2020 2020 2320 6465 636f  of in.    # deco
-0000e520: 6465 2829 2062 6563 6175 7365 205f 7761  de() because _wa
-0000e530: 6974 5f6e 6f6e 6365 206c 6f6f 6b73 2066  it_nonce looks f
-0000e540: 6f72 2074 6869 7320 636f 6465 2e0a 2020  or this code..  
-0000e550: 2020 7265 7375 6c74 203d 2072 6573 756c    result = resul
-0000e560: 742e 7265 706c 6163 6528 6222 5c78 3162  t.replace(b"\x1b
-0000e570: 5b4b 222c 2062 2222 290a 2020 2020 7265  [K", b"").    re
-0000e580: 7375 6c74 203d 2072 6573 756c 742e 6c73  sult = result.ls
-0000e590: 7472 6970 2829 0a20 2020 2069 6620 5f49  trip().    if _I
-0000e5a0: 5059 5448 4f4e 5f56 4552 5349 4f4e 203e  PYTHON_VERSION >
-0000e5b0: 3d20 2835 2c29 3a20 2023 2061 6e64 205f  = (5,):  # and _
-0000e5c0: 4950 5954 484f 4e5f 5645 5253 494f 4e20  IPYTHON_VERSION 
-0000e5d0: 3c3d 2028 382c 293a 0a20 2020 2020 2020  <= (8,):.       
-0000e5e0: 2023 2049 6e20 4950 7974 686f 6e20 3520   # In IPython 5 
-0000e5f0: 6b65 726e 656c 2f63 6f6e 736f 6c65 2f65  kernel/console/e
-0000e600: 7463 2c20 6974 2073 6565 6d73 2074 6f20  tc, it seems to 
-0000e610: 6265 2069 6d70 6f73 7369 626c 6520 746f  be impossible to
-0000e620: 2074 7572 6e0a 2020 2020 2020 2020 2320   turn.        # 
-0000e630: 6f66 6620 7468 6520 6261 6e6e 6572 2e20  off the banner. 
-0000e640: 2046 6f72 206e 6f77 206a 7573 7420 6465   For now just de
-0000e650: 6c65 7465 2074 6865 206f 7574 7075 7420  lete the output 
-0000e660: 7570 2074 6f20 7468 6520 6669 7273 740a  up to the first.
-0000e670: 2020 2020 2020 2020 2320 7072 6f6d 7074          # prompt
-0000e680: 2e0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
-0000e690: 203d 2072 652e 7375 6228 6272 222e 2a3f   = re.sub(br".*?
-0000e6a0: 2849 6e20 5c5b 315c 5d3a 2922 2c20 6272  (In \[1\]:)", br
-0000e6b0: 225c 3122 2c20 7265 7375 6c74 2c20 666c  "\1", result, fl
-0000e6c0: 6167 733d 7265 2e53 290a 2020 2020 6966  ags=re.S).    if
-0000e6d0: 2044 4542 5547 3a0a 2020 2020 2020 2020   DEBUG:.        
-0000e6e0: 7072 696e 7428 225f 636c 6561 6e5f 6970  print("_clean_ip
-0000e6f0: 7974 686f 6e5f 6f75 7470 7574 2829 3a20  ython_output(): 
-0000e700: 2572 203d 3e20 2572 2220 2520 2872 6573  %r => %r" % (res
-0000e710: 756c 7430 2c20 7265 7375 6c74 2c29 290a  ult0, result,)).
-0000e720: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-0000e730: 740a 0a64 6566 205f 6e6f 726d 616c 697a  t..def _normaliz
-0000e740: 655f 7079 7468 6f6e 5f32 5f33 2874 656d  e_python_2_3(tem
-0000e750: 706c 6174 6529 3a0a 2020 2020 2222 220a  plate):.    """.
-0000e760: 2020 2020 4368 616e 6765 2073 6f6d 6520      Change some 
-0000e770: 5079 7468 6f6e 2033 206f 7574 7075 7473  Python 3 outputs
-0000e780: 2074 6f20 6265 2063 6f6d 7061 7469 626c   to be compatibl
-0000e790: 6520 7769 7468 2050 7974 686f 6e20 320a  e with Python 2.
-0000e7a0: 2020 2020 2222 220a 2020 2020 7465 6d70      """.    temp
-0000e7b0: 6c61 7465 3020 3d20 7465 6d70 6c61 7465  late0 = template
-0000e7c0: 0a20 2020 2069 6620 5059 333a 0a20 2020  .    if PY3:.   
-0000e7d0: 2020 2020 2023 2057 6520 6861 7665 2074       # We have t
-0000e7e0: 6f20 6c65 6176 6520 4e61 6d65 4572 726f  o leave NameErro
-0000e7f0: 723a 2067 6c6f 6261 6c20 6e61 6d65 202e  r: global name .
-0000e800: 2e2e 2061 7320 696e 2050 7974 686f 6e20  .. as in Python 
-0000e810: 322c 2062 6563 6175 7365 0a20 2020 2020  2, because.     
-0000e820: 2020 2023 2069 6e20 5079 7468 6f6e 2033     # in Python 3
-0000e830: 2c20 2267 6c6f 6261 6c22 2069 7320 6e65  , "global" is ne
-0000e840: 7665 7220 7072 696e 7465 642c 2062 7574  ver printed, but
-0000e850: 2069 7420 6973 206f 6e6c 7920 7072 696e   it is only prin
-0000e860: 7465 6420 666f 720a 2020 2020 2020 2020  ted for.        
-0000e870: 2320 736f 6d65 206d 6573 7361 6765 7320  # some messages 
-0000e880: 696e 2050 7974 686f 6e20 322e 0a20 2020  in Python 2..   
-0000e890: 2020 2020 2074 656d 706c 6174 6520 3d20       template = 
-0000e8a0: 7465 6d70 6c61 7465 2e72 6570 6c61 6365  template.replace
-0000e8b0: 2862 224e 616d 6545 7272 6f72 3a20 676c  (b"NameError: gl
-0000e8c0: 6f62 616c 206e 616d 6522 2c20 6222 4e61  obal name", b"Na
-0000e8d0: 6d65 4572 726f 723a 206e 616d 6522 290a  meError: name").
-0000e8e0: 2020 2020 2020 2020 2320 5468 6520 7465          # The te
-0000e8f0: 6d70 6c61 7465 7320 6172 6520 7772 6974  mplates are writ
-0000e900: 7465 6e20 7769 7468 206f 7574 7075 7473  ten with outputs
-0000e910: 2066 726f 6d20 5079 7468 6f6e 2033 0a20   from Python 3. 
-0000e920: 2020 2020 2020 2072 6574 7572 6e20 7465         return te
-0000e930: 6d70 6c61 7465 0a0a 2020 2020 7465 6d70  mplate..    temp
-0000e940: 6c61 7465 203d 2074 656d 706c 6174 652e  late = template.
-0000e950: 7265 706c 6163 6528 2720 3c6d 6f64 756c  replace(' <modul
-0000e960: 653e 272c 2027 203c 6d6f 6475 6c65 3e28  e>', ' <module>(
-0000e970: 2927 290a 2020 2020 666f 7220 6d6f 6475  )').    for modu
-0000e980: 6c65 2069 6e20 5b27 6f73 272c 2027 6261  le in ['os', 'ba
-0000e990: 7365 3634 272c 2027 7072 6f66 696c 6527  se64', 'profile'
-0000e9a0: 5d3a 0a20 2020 2020 2020 2074 656d 706c  ]:.        templ
-0000e9b0: 6174 6520 3d20 7465 6d70 6c61 7465 2e72  ate = template.r
-0000e9c0: 6570 6c61 6365 2822 6d6f 6475 6c65 2027  eplace("module '
-0000e9d0: 7b6d 6f64 756c 657d 2720 6861 7320 6e6f  {module}' has no
-0000e9e0: 2061 7474 7269 6275 7465 222e 666f 726d   attribute".form
-0000e9f0: 6174 286d 6f64 756c 653d 6d6f 6475 6c65  at(module=module
-0000ea00: 292c 2022 276d 6f64 756c 6527 206f 626a  ), "'module' obj
-0000ea10: 6563 7420 6861 7320 6e6f 2061 7474 7269  ect has no attri
-0000ea20: 6275 7465 2229 0a20 2020 2074 656d 706c  bute").    templ
-0000ea30: 6174 6520 3d20 7465 6d70 6c61 7465 2e72  ate = template.r
-0000ea40: 6570 6c61 6365 2827 7374 7572 6272 6964  eplace('sturbrid
-0000ea50: 6765 3930 3838 3333 3320 6861 7320 6e6f  ge9088333 has no
-0000ea60: 2061 7474 7269 6275 7465 272c 2022 276d   attribute', "'m
-0000ea70: 6f64 756c 6527 206f 626a 6563 7420 6861  odule' object ha
-0000ea80: 7320 6e6f 2061 7474 7269 6275 7465 2229  s no attribute")
-0000ea90: 0a20 2020 2074 656d 706c 6174 6520 3d20  .    template = 
-0000eaa0: 7265 2e73 7562 2872 2228 5b20 5c28 5c6e  re.sub(r"([ \(\n
-0000eab0: 5d29 6227 282e 2a3f 2927 222c 2072 225c  ])b'(.*?)'", r"\
-0000eac0: 3127 5c32 2722 2c20 7465 6d70 6c61 7465  1'\2'", template
-0000ead0: 290a 2020 2020 7465 6d70 6c61 7465 203d  ).    template =
-0000eae0: 2074 656d 706c 6174 652e 7265 706c 6163   template.replac
-0000eaf0: 6528 225a 6572 6f44 6976 6973 696f 6e45  e("ZeroDivisionE
-0000eb00: 7272 6f72 3a20 6469 7669 7369 6f6e 2062  rror: division b
-0000eb10: 7920 7a65 726f 222c 2022 5a65 726f 4469  y zero", "ZeroDi
-0000eb20: 7669 7369 6f6e 4572 726f 723a 2069 6e74  visionError: int
-0000eb30: 6567 6572 2064 6976 6973 696f 6e20 6f72  eger division or
-0000eb40: 206d 6f64 756c 6f20 6279 207a 6572 6f22   modulo by zero"
-0000eb50: 290a 2020 2020 7465 6d70 6c61 7465 203d  ).    template =
-0000eb60: 2072 652e 7375 6228 7222 5c2e 5c2e 5c2e   re.sub(r"\.\.\.
-0000eb70: 2070 6572 206c 6f6f 7020 5c28 6d65 616e   per loop \(mean
-0000eb80: 20c2 b120 7374 642e 2064 6576 5c2e 206f   .. std. dev\. o
-0000eb90: 6620 282e 2a29 2072 756e 2c20 282e 2a29  f (.*) run, (.*)
-0000eba0: 206c 6f6f 7073 2065 6163 685c 2922 2c0a   loops each\)",.
-0000ebb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ebc0: 2020 2020 2020 7222 5c32 206c 6f6f 7073        r"\2 loops
-0000ebd0: 2c20 6265 7374 206f 6620 5c31 3a20 2e2e  , best of \1: ..
-0000ebe0: 2e20 7065 7220 6c6f 6f70 2220 2c20 7465  . per loop" , te
-0000ebf0: 6d70 6c61 7465 290a 2020 2020 7465 6d70  mplate).    temp
-0000ec00: 6c61 7465 203d 2072 652e 7375 6228 7222  late = re.sub(r"
-0000ec10: 4d6f 6475 6c65 4e6f 7446 6f75 6e64 4572  ModuleNotFoundEr
-0000ec20: 726f 723a 204e 6f20 6d6f 6475 6c65 206e  ror: No module n
-0000ec30: 616d 6564 2027 282e 2a3f 2927 222c 0a20  amed '(.*?)'",. 
-0000ec40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec50: 2020 2020 2072 2249 6d70 6f72 7445 7272       r"ImportErr
-0000ec60: 6f72 3a20 4e6f 206d 6f64 756c 6520 6e61  or: No module na
-0000ec70: 6d65 6420 5c31 222c 2074 656d 706c 6174  med \1", templat
-0000ec80: 6529 0a20 2020 2074 656d 706c 6174 6520  e).    template 
-0000ec90: 3d20 7265 2e73 7562 2872 225c 2a5c 2a5c  = re.sub(r"\*\*\
-0000eca0: 2a20 4e61 6d65 4572 726f 723a 206e 616d  * NameError: nam
-0000ecb0: 6520 2728 2e2a 2927 2069 7320 6e6f 7420  e '(.*)' is not 
-0000ecc0: 6465 6669 6e65 6422 2c0a 2020 2020 2020  defined",.      
-0000ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ece0: 7222 2222 2a2a 2a20 4e61 6d65 4572 726f  r"""*** NameErro
-0000ecf0: 723a 204e 616d 6545 7272 6f72 2822 6e61  r: NameError("na
-0000ed00: 6d65 2027 5c31 2720 6973 206e 6f74 2064  me '\1' is not d
-0000ed10: 6566 696e 6564 222c 2922 2222 2c20 7465  efined",)""", te
-0000ed20: 6d70 6c61 7465 290a 0a20 2020 2069 6620  mplate)..    if 
-0000ed30: 4445 4255 473a 0a20 2020 2020 2020 2070  DEBUG:.        p
-0000ed40: 7269 6e74 2822 5f6e 6f72 6d61 6c69 7a65  rint("_normalize
-0000ed50: 5f70 7974 686f 6e5f 325f 3328 2920 2572  _python_2_3() %r
-0000ed60: 203d 3e20 2572 2220 2520 2874 656d 706c   => %r" % (templ
-0000ed70: 6174 6530 2c20 7465 6d70 6c61 7465 2929  ate0, template))
-0000ed80: 0a20 2020 2072 6574 7572 6e20 7465 6d70  .    return temp
-0000ed90: 6c61 7465 0a0a 0a40 7265 7472 790a 6465  late...@retry.de
-0000eda0: 6620 7465 7374 5f69 7079 7468 6f6e 5f31  f test_ipython_1
-0000edb0: 2866 726f 6e74 656e 6429 3a0a 2020 2020  (frontend):.    
-0000edc0: 2320 5465 7374 2074 6861 7420 7765 2063  # Test that we c
-0000edd0: 616e 2072 756e 2069 7079 7468 6f6e 2061  an run ipython a
-0000ede0: 6e64 2067 6574 2072 6573 756c 7473 2062  nd get results b
-0000edf0: 6163 6b2e 0a20 2020 2069 7079 7468 6f6e  ack..    ipython
-0000ee00: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
-0000ee10: 5b31 5d3a 2070 7269 6e74 2836 2a37 290a  [1]: print(6*7).
-0000ee20: 2020 2020 2020 2020 3432 0a20 2020 2020          42.     
-0000ee30: 2020 2049 6e20 5b32 5d3a 2036 2a39 0a20     In [2]: 6*9. 
-0000ee40: 2020 2020 2020 204f 7574 5b32 5d3a 2035         Out[2]: 5
-0000ee50: 340a 2020 2020 2222 222c 2066 726f 6e74  4.    """, front
-0000ee60: 656e 643d 6672 6f6e 7465 6e64 290a 0a0a  end=frontend)...
-0000ee70: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
-0000ee80: 6970 7974 686f 6e5f 6173 7365 7274 5f66  ipython_assert_f
-0000ee90: 6169 6c5f 3128 6672 6f6e 7465 6e64 293a  ail_1(frontend):
-0000eea0: 0a20 2020 2077 6974 6820 6173 7365 7274  .    with assert
-0000eeb0: 5f66 6169 6c28 293a 0a20 2020 2020 2020  _fail():.       
-0000eec0: 2069 7079 7468 6f6e 2822 2222 0a20 2020   ipython(""".   
-0000eed0: 2020 2020 2020 2020 2049 6e20 5b31 5d3a           In [1]:
-0000eee0: 2070 7269 6e74 2836 2a37 290a 2020 2020   print(6*7).    
-0000eef0: 2020 2020 2020 2020 3432 0a20 2020 2020          42.     
-0000ef00: 2020 2020 2020 2049 6e20 5b32 5d3a 2036         In [2]: 6
-0000ef10: 2a39 0a20 2020 2020 2020 2020 2020 204f  *9.            O
-0000ef20: 7574 5b32 5d3a 2035 330a 2020 2020 2020  ut[2]: 53.      
-0000ef30: 2020 2222 222c 2066 726f 6e74 656e 643d    """, frontend=
-0000ef40: 6672 6f6e 7465 6e64 290a 0a0a 4072 6574  frontend)...@ret
-0000ef50: 7279 0a64 6566 2074 6573 745f 6970 7974  ry.def test_ipyt
-0000ef60: 686f 6e5f 696e 6465 6e74 6564 5f62 6c6f  hon_indented_blo
-0000ef70: 636b 5f34 7370 6163 6573 5f31 2866 726f  ck_4spaces_1(fro
-0000ef80: 6e74 656e 6429 3a0a 2020 2020 2320 5465  ntend):.    # Te
-0000ef90: 7374 2074 6861 7420 696e 6465 6e74 6564  st that indented
-0000efa0: 2062 6c6f 636b 7320 776f 726b 2076 7320   blocks work vs 
-0000efb0: 4950 7974 686f 6e27 7320 6175 746f 696e  IPython's autoin
-0000efc0: 6465 6e74 2e0a 2020 2020 2320 3420 7370  dent..    # 4 sp
-0000efd0: 6163 6573 2069 7320 7468 6520 4950 7974  aces is the IPyt
-0000efe0: 686f 6e20 6465 6661 756c 7420 6175 746f  hon default auto
-0000eff0: 696e 6465 6e74 2e0a 2020 2020 6970 7974  indent..    ipyt
-0000f000: 686f 6e28 2222 220a 2020 2020 2020 2020  hon(""".        
-0000f010: 496e 205b 315d 3a20 6966 2031 3a0a 2020  In [1]: if 1:.  
-0000f020: 2020 2020 2020 2020 202e 2e2e 3a20 2020           ...:   
-0000f030: 2020 7072 696e 7428 362a 3729 0a20 2020    print(6*7).   
-0000f040: 2020 2020 2020 2020 2e2e 2e3a 2020 2020          ...:    
-0000f050: 2070 7269 6e74 2836 2a39 290a 2020 2020   print(6*9).    
-0000f060: 2020 2020 2020 202e 2e2e 3a0a 2020 2020         ...:.    
-0000f070: 2020 2020 3432 0a20 2020 2020 2020 2035      42.        5
-0000f080: 340a 2020 2020 2020 2020 496e 205b 325d  4.        In [2]
-0000f090: 3a20 362a 380a 2020 2020 2020 2020 4f75  : 6*8.        Ou
-0000f0a0: 745b 325d 3a20 3438 0a20 2020 2022 2222  t[2]: 48.    """
-0000f0b0: 2c20 6672 6f6e 7465 6e64 3d66 726f 6e74  , frontend=front
-0000f0c0: 656e 6429 0a0a 0a0a 4072 6574 7279 0a64  end)....@retry.d
-0000f0d0: 6566 2074 6573 745f 6970 7974 686f 6e5f  ef test_ipython_
-0000f0e0: 696e 6465 6e74 6564 5f62 6c6f 636b 5f35  indented_block_5
-0000f0f0: 7370 6163 6573 5f31 2866 726f 6e74 656e  spaces_1(fronten
-0000f100: 6429 3a0a 2020 2020 2320 5465 7374 2074  d):.    # Test t
-0000f110: 6861 7420 696e 6465 6e74 6564 2062 6c6f  hat indented blo
-0000f120: 636b 7320 776f 726b 2076 7320 4950 7974  cks work vs IPyt
-0000f130: 686f 6e27 7320 6175 746f 696e 6465 6e74  hon's autoindent
-0000f140: 2e0a 2020 2020 6970 7974 686f 6e28 2222  ..    ipython(""
-0000f150: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
-0000f160: 3a20 6966 2031 3a0a 2020 2020 2020 2020  : if 1:.        
-0000f170: 2020 202e 2e2e 3a20 2020 2020 2020 2020     ...:         
-0000f180: 7072 696e 7428 362a 3729 0a20 2020 2020  print(6*7).     
-0000f190: 2020 2020 2020 2e2e 2e3a 2020 2020 2020        ...:      
-0000f1a0: 2020 2070 7269 6e74 2836 2a39 290a 2020     print(6*9).  
-0000f1b0: 2020 2020 2020 2020 202e 2e2e 3a0a 2020           ...:.  
-0000f1c0: 2020 2020 2020 3432 0a20 2020 2020 2020        42.       
-0000f1d0: 2035 340a 2020 2020 2020 2020 496e 205b   54.        In [
-0000f1e0: 325d 3a20 362a 380a 2020 2020 2020 2020  2]: 6*8.        
-0000f1f0: 4f75 745b 325d 3a20 3438 0a20 2020 2020  Out[2]: 48.     
-0000f200: 2020 2022 2222 2c20 6672 6f6e 7465 6e64     """, frontend
-0000f210: 3d66 726f 6e74 656e 6429 0a0a 0a40 7265  =frontend)...@re
-0000f220: 7472 790a 6465 6620 7465 7374 5f69 7079  try.def test_ipy
-0000f230: 7468 6f6e 5f69 6e64 656e 7465 645f 626c  thon_indented_bl
-0000f240: 6f63 6b5f 3673 7061 6365 735f 3128 6672  ock_6spaces_1(fr
-0000f250: 6f6e 7465 6e64 293a 0a20 2020 2023 2054  ontend):.    # T
-0000f260: 6573 7420 7468 6174 2069 6e64 656e 7465  est that indente
-0000f270: 6420 626c 6f63 6b73 2077 6f72 6b20 7673  d blocks work vs
-0000f280: 2049 5079 7468 6f6e 2773 2061 7574 6f69   IPython's autoi
-0000f290: 6e64 656e 742e 0a20 2020 2069 7079 7468  ndent..    ipyth
-0000f2a0: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
-0000f2b0: 6e20 5b31 5d3a 2069 6620 313a 0a20 2020  n [1]: if 1:.   
-0000f2c0: 2020 2020 2020 2020 2e2e 2e3a 2020 2020          ...:    
-0000f2d0: 2020 2070 7269 6e74 2836 2a37 290a 2020     print(6*7).  
-0000f2e0: 2020 2020 2020 2020 202e 2e2e 3a20 2020           ...:   
-0000f2f0: 2020 2020 7072 696e 7428 362a 3929 0a20      print(6*9). 
-0000f300: 2020 2020 2020 2020 2020 2e2e 2e3a 0a20            ...:. 
-0000f310: 2020 2020 2020 2034 320a 2020 2020 2020         42.      
-0000f320: 2020 3534 0a20 2020 2020 2020 2049 6e20    54.        In 
-0000f330: 5b32 5d3a 2036 2a38 0a20 2020 2020 2020  [2]: 6*8.       
-0000f340: 204f 7574 5b32 5d3a 2034 380a 2020 2020   Out[2]: 48.    
-0000f350: 2222 222c 2066 726f 6e74 656e 643d 6672  """, frontend=fr
-0000f360: 6f6e 7465 6e64 290a 0a0a 4072 6574 7279  ontend)...@retry
-0000f370: 0a64 6566 2074 6573 745f 6970 7974 686f  .def test_ipytho
-0000f380: 6e5f 696e 6465 6e74 6564 5f62 6c6f 636b  n_indented_block
-0000f390: 5f33 7370 6163 6573 5f31 2866 726f 6e74  _3spaces_1(front
-0000f3a0: 656e 6429 3a0a 2020 2020 2320 5465 7374  end):.    # Test
-0000f3b0: 2074 6861 7420 696e 6465 6e74 6564 2062   that indented b
-0000f3c0: 6c6f 636b 7320 776f 726b 2076 7320 4950  locks work vs IP
-0000f3d0: 7974 686f 6e27 7320 6175 746f 696e 6465  ython's autoinde
-0000f3e0: 6e74 2e0a 2020 2020 2320 5573 696e 6720  nt..    # Using 
-0000f3f0: 5e55 2070 6c75 7320 3320 7370 6163 6573  ^U plus 3 spaces
-0000f400: 2063 6175 7365 7320 4950 7974 686f 6e20   causes IPython 
-0000f410: 746f 206f 7574 7075 7420 2220 2020 205c  to output "    \
-0000f420: 7830 3822 2e0a 2020 2020 6970 7974 686f  x08"..    ipytho
-0000f430: 6e28 2222 220a 2020 2020 2020 2020 496e  n(""".        In
-0000f440: 205b 315d 3a20 6966 2031 3a0a 2020 2020   [1]: if 1:.    
-0000f450: 2020 2020 2020 202e 2e2e 3a20 2020 2070         ...:    p
-0000f460: 7269 6e74 2836 2a37 290a 2020 2020 2020  rint(6*7).      
-0000f470: 2020 2020 202e 2e2e 3a20 2020 2070 7269       ...:    pri
-0000f480: 6e74 2836 2a39 290a 2020 2020 2020 2020  nt(6*9).        
-0000f490: 2020 202e 2e2e 3a0a 2020 2020 2020 2020     ...:.        
-0000f4a0: 3432 0a20 2020 2020 2020 2035 340a 2020  42.        54.  
-0000f4b0: 2020 2020 2020 496e 205b 325d 3a20 362a        In [2]: 6*
-0000f4c0: 380a 2020 2020 2020 2020 4f75 745b 325d  8.        Out[2]
-0000f4d0: 3a20 3438 0a20 2020 2022 2222 2c20 6672  : 48.    """, fr
-0000f4e0: 6f6e 7465 6e64 3d66 726f 6e74 656e 6429  ontend=frontend)
-0000f4f0: 0a0a 0a40 7265 7472 790a 6465 6620 7465  ...@retry.def te
-0000f500: 7374 5f69 7079 7468 6f6e 5f69 6e64 656e  st_ipython_inden
-0000f510: 7465 645f 626c 6f63 6b5f 3273 7061 6365  ted_block_2space
-0000f520: 735f 3128 6672 6f6e 7465 6e64 293a 0a20  s_1(frontend):. 
-0000f530: 2020 2023 2054 6573 7420 7468 6174 2069     # Test that i
-0000f540: 6e64 656e 7465 6420 626c 6f63 6b73 2077  ndented blocks w
-0000f550: 6f72 6b20 7673 2049 5079 7468 6f6e 2773  ork vs IPython's
-0000f560: 2061 7574 6f69 6e64 656e 742e 0a20 2020   autoindent..   
-0000f570: 2023 2055 7369 6e67 205e 5520 706c 7573   # Using ^U plus
-0000f580: 2032 2073 7061 6365 7320 6361 7573 6573   2 spaces causes
-0000f590: 2049 5079 7468 6f6e 2035 2074 6f20 6f75   IPython 5 to ou
-0000f5a0: 7470 7574 2022 2020 2020 5c78 3162 5b32  tput "    \x1b[2
-0000f5b0: 4420 205c 7831 625b 3244 222e 0a20 2020  D  \x1b[2D"..   
-0000f5c0: 2069 7079 7468 6f6e 2822 2222 0a20 2020   ipython(""".   
-0000f5d0: 2020 2020 2049 6e20 5b31 5d3a 2069 6620       In [1]: if 
-0000f5e0: 313a 0a20 2020 2020 2020 2020 2020 2e2e  1:.           ..
-0000f5f0: 2e3a 2020 2070 7269 6e74 2836 2a37 290a  .:   print(6*7).
-0000f600: 2020 2020 2020 2020 2020 202e 2e2e 3a20             ...: 
-0000f610: 2020 7072 696e 7428 362a 3929 0a20 2020    print(6*9).   
-0000f620: 2020 2020 2020 2020 2e2e 2e3a 0a20 2020          ...:.   
-0000f630: 2020 2020 2034 320a 2020 2020 2020 2020       42.        
-0000f640: 3534 0a20 2020 2020 2020 2049 6e20 5b32  54.        In [2
-0000f650: 5d3a 2036 2a38 0a20 2020 2020 2020 204f  ]: 6*8.        O
-0000f660: 7574 5b32 5d3a 2034 380a 2020 2020 2222  ut[2]: 48.    ""
-0000f670: 222c 2066 726f 6e74 656e 643d 6672 6f6e  ", frontend=fron
-0000f680: 7465 6e64 290a 0a0a 4072 6574 7279 0a64  tend)...@retry.d
-0000f690: 6566 2074 6573 745f 6970 7974 686f 6e5f  ef test_ipython_
-0000f6a0: 7461 625f 3128 6672 6f6e 7465 6e64 293a  tab_1(frontend):
-0000f6b0: 0a20 2020 2023 2054 6573 7420 7468 6174  .    # Test that
-0000f6c0: 206f 7572 2074 6573 7420 6861 726e 6573   our test harnes
-0000f6d0: 7320 776f 726b 7320 666f 7220 7461 6273  s works for tabs
-0000f6e0: 2e0a 2020 2020 6970 7974 686f 6e28 2222  ..    ipython(""
-0000f6f0: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
-0000f700: 3a20 696d 706f 7274 206f 730a 2020 2020  : import os.    
-0000f710: 2020 2020 496e 205b 325d 3a20 6f73 2e4f      In [2]: os.O
-0000f720: 5f41 5050 5c74 454e 442e 5f5f 636c 6173  _APP\tEND.__clas
-0000f730: 735f 5f0a 2020 2020 2020 2020 4f75 745b  s__.        Out[
-0000f740: 325d 3a20 696e 740a 2020 2020 2222 222c  2]: int.    """,
-0000f750: 2066 726f 6e74 656e 643d 6672 6f6e 7465   frontend=fronte
-0000f760: 6e64 290a 0a40 7265 7472 790a 6465 6620  nd)..@retry.def 
-0000f770: 7465 7374 5f69 7079 7468 6f6e 5f74 6162  test_ipython_tab
-0000f780: 5f66 6169 6c5f 3128 6672 6f6e 7465 6e64  _fail_1(frontend
-0000f790: 293a 0a20 2020 2023 2054 6573 7420 7468  ):.    # Test th
-0000f7a0: 6174 206f 7572 2074 6573 7420 6861 726e  at our test harn
-0000f7b0: 6573 7320 776f 726b 7320 666f 7220 7461  ess works for ta
-0000f7c0: 6220 7768 656e 2069 7420 7368 6f75 6c64  b when it should
-0000f7d0: 206d 6174 6368 206e 6f74 6869 6e67 2e0a   match nothing..
-0000f7e0: 2020 2020 6970 7974 686f 6e28 0a20 2020      ipython(.   
-0000f7f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000f800: 2049 6e20 5b31 5d3a 2069 6d70 6f72 7420   In [1]: import 
-0000f810: 6f73 0a20 2020 2020 2020 2049 6e20 5b32  os.        In [2
-0000f820: 5d3a 206f 732e 666f 6f32 3738 3137 3739  ]: os.foo2781779
-0000f830: 365c 7428 290a 2020 2020 2020 2020 2d2d  6\t().        --
-0000f840: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0000f850: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0000f860: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0000f870: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0000f880: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-0000f890: 2020 4174 7472 6962 7574 6545 7272 6f72    AttributeError
-0000f8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f8b0: 2020 2020 2020 2020 2020 2020 5472 6163              Trac
-0000f8c0: 6562 6163 6b20 286d 6f73 7420 7265 6365  eback (most rece
-0000f8d0: 6e74 2063 616c 6c20 6c61 7374 290a 2020  nt call last).  
-0000f8e0: 2020 2020 2020 2e2e 2e20 696e 202e 2e2e        ... in ...
-0000f8f0: 0a20 2020 2020 2020 2041 7474 7269 6275  .        Attribu
-0000f900: 7465 4572 726f 723a 206d 6f64 756c 6520  teError: module 
-0000f910: 276f 7327 2068 6173 206e 6f20 6174 7472  'os' has no attr
-0000f920: 6962 7574 6520 2766 6f6f 3237 3831 3737  ibute 'foo278177
-0000f930: 3936 270a 2020 2020 2222 222c 0a20 2020  96'.    """,.   
-0000f940: 2020 2020 2066 726f 6e74 656e 643d 6672       frontend=fr
-0000f950: 6f6e 7465 6e64 2c0a 2020 2020 290a 0a0a  ontend,.    )...
-0000f960: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
-0000f970: 6970 7974 686f 6e5f 7461 625f 6d75 6c74  ipython_tab_mult
-0000f980: 695f 3128 6672 6f6e 7465 6e64 293a 0a20  i_1(frontend):. 
-0000f990: 2020 2023 2054 6573 7420 7468 6174 206f     # Test that o
-0000f9a0: 7572 2074 6573 7420 6861 726e 6573 7320  ur test harness 
-0000f9b0: 776f 726b 7320 666f 7220 7461 6220 7768  works for tab wh
-0000f9c0: 656e 2074 6865 7265 2061 7265 206d 756c  en there are mul
-0000f9d0: 7469 706c 6520 6d61 7463 6865 730a 2020  tiple matches.  
-0000f9e0: 2020 2320 666f 7220 7461 6220 636f 6d70    # for tab comp
-0000f9f0: 6c65 7469 6f6e 2e0a 2020 2020 6966 2066  letion..    if f
-0000fa00: 726f 6e74 656e 6420 3d3d 2022 7072 6f6d  rontend == "prom
-0000fa10: 7074 5f74 6f6f 6c6b 6974 223a 2070 7974  pt_toolkit": pyt
-0000fa20: 6573 742e 736b 6970 2829 0a20 2020 2023  est.skip().    #
-0000fa30: 2043 7572 7265 6e74 6c79 206f 7572 2074   Currently our t
-0000fa40: 6573 7420 6861 726e 6573 7320 6973 206f  est harness is o
-0000fa50: 6e6c 7920 6162 6c65 2074 6f20 7465 7374  nly able to test
-0000fa60: 2074 6869 7320 7573 696e 6720 726c 6970   this using rlip
-0000fa70: 7974 686f 6e2e 0a20 2020 2069 7079 7468  ython..    ipyth
-0000fa80: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
-0000fa90: 6e20 5b31 5d3a 2064 6566 2066 6f6f 2829  n [1]: def foo()
-0000faa0: 3a20 7061 7373 0a20 2020 2020 2020 2049  : pass.        I
-0000fab0: 6e20 5b32 5d3a 2066 6f6f 2e78 797a 3120  n [2]: foo.xyz1 
-0000fac0: 3d20 3131 310a 2020 2020 2020 2020 496e  = 111.        In
-0000fad0: 205b 335d 3a20 666f 6f2e 7879 7a32 203d   [3]: foo.xyz2 =
-0000fae0: 2032 3232 0a20 2020 2020 2020 2049 6e20   222.        In 
-0000faf0: 5b34 5d3a 2066 6f6f 2e78 795c 740a 2020  [4]: foo.xy\t.  
-0000fb00: 2020 2020 2020 666f 6f2e 7879 7a31 2020        foo.xyz1  
-0000fb10: 666f 6f2e 7879 7a32 0a20 2020 2020 2020  foo.xyz2.       
-0000fb20: 2049 6e20 5b34 5d3a 2066 6f6f 2e78 797a   In [4]: foo.xyz
-0000fb30: 5c78 3036 320a 2020 2020 2020 2020 4f75  \x062.        Ou
-0000fb40: 745b 345d 3a20 3232 320a 2020 2020 2222  t[4]: 222.    ""
-0000fb50: 222c 2066 726f 6e74 656e 643d 6672 6f6e  ", frontend=fron
-0000fb60: 7465 6e64 290a 0a0a 4072 6574 7279 0a64  tend)...@retry.d
-0000fb70: 6566 2074 6573 745f 7079 666c 7962 795f  ef test_pyflyby_
-0000fb80: 6669 6c65 5f31 2829 3a0a 2020 2020 2320  file_1():.    # 
-0000fb90: 5665 7269 6679 2074 6861 7420 6f75 7220  Verify that our 
-0000fba0: 7465 7374 2073 6574 7570 2069 7320 6765  test setup is ge
-0000fbb0: 7474 696e 6720 7468 6520 7269 6768 7420  tting the right 
-0000fbc0: 7079 666c 7962 792e 0a20 2020 2066 203d  pyflyby..    f =
-0000fbd0: 206f 732e 7061 7468 2e72 6561 6c70 6174   os.path.realpat
-0000fbe0: 6828 7079 666c 7962 792e 5f5f 6669 6c65  h(pyflyby.__file
-0000fbf0: 5f5f 2e72 6570 6c61 6365 2822 2e70 7963  __.replace(".pyc
-0000fc00: 222c 2022 2e70 7922 2929 0a20 2020 2069  ", ".py")).    i
-0000fc10: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
-0000fc20: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
-0000fc30: 7420 6f73 2c20 7079 666c 7962 790a 2020  t os, pyflyby.  
-0000fc40: 2020 2020 2020 496e 205b 325d 3a20 7072        In [2]: pr
-0000fc50: 696e 7428 6f73 2e70 6174 682e 7265 616c  int(os.path.real
-0000fc60: 7061 7468 2870 7966 6c79 6279 2e5f 5f66  path(pyflyby.__f
-0000fc70: 696c 655f 5f2e 7265 706c 6163 6528 222e  ile__.replace(".
-0000fc80: 7079 6322 2c20 222e 7079 2229 2929 0a20  pyc", ".py"))). 
-0000fc90: 2020 2020 2020 207b 667d 0a20 2020 2022         {f}.    "
-0000fca0: 2222 2e66 6f72 6d61 7428 663d 6629 290a  "".format(f=f)).
-0000fcb0: 0a0a 4072 6574 7279 0a64 6566 2074 6573  ..@retry.def tes
-0000fcc0: 745f 7079 666c 7962 795f 7665 7273 696f  t_pyflyby_versio
-0000fcd0: 6e5f 3128 293a 0a20 2020 2023 2056 6572  n_1():.    # Ver
-0000fce0: 6966 7920 7468 6174 206f 7572 2074 6573  ify that our tes
-0000fcf0: 7420 7365 7475 7020 6973 2067 6574 7469  t setup is getti
-0000fd00: 6e67 2074 6865 2072 6967 6874 2070 7966  ng the right pyf
-0000fd10: 6c79 6279 2e0a 2020 2020 6970 7974 686f  lyby..    ipytho
-0000fd20: 6e28 2222 220a 2020 2020 2020 2020 496e  n(""".        In
-0000fd30: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
-0000fd40: 6c79 6279 0a20 2020 2020 2020 2049 6e20  lyby.        In 
-0000fd50: 5b32 5d3a 2070 7269 6e74 2870 7966 6c79  [2]: print(pyfly
-0000fd60: 6279 2e5f 5f76 6572 7369 6f6e 5f5f 290a  by.__version__).
-0000fd70: 2020 2020 2020 2020 7b70 7966 6c79 6279          {pyflyby
-0000fd80: 2e5f 5f76 6572 7369 6f6e 5f5f 7d0a 2020  .__version__}.  
-0000fd90: 2020 2222 222e 666f 726d 6174 2870 7966    """.format(pyf
-0000fda0: 6c79 6279 3d70 7966 6c79 6279 2929 0a0a  lyby=pyflyby))..
-0000fdb0: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
-0000fdc0: 5f69 7079 7468 6f6e 5f66 696c 655f 3128  _ipython_file_1(
-0000fdd0: 293a 0a20 2020 2023 2056 6572 6966 7920  ):.    # Verify 
-0000fde0: 7468 6174 206f 7572 2074 6573 7420 7365  that our test se
-0000fdf0: 7475 7020 6973 2067 6574 7469 6e67 2074  tup is getting t
-0000fe00: 6865 2072 6967 6874 2049 5079 7468 6f6e  he right IPython
-0000fe10: 2e0a 2020 2020 6620 3d20 6f73 2e70 6174  ..    f = os.pat
-0000fe20: 682e 7265 616c 7061 7468 2849 5079 7468  h.realpath(IPyth
-0000fe30: 6f6e 2e5f 5f66 696c 655f 5f29 0a20 2020  on.__file__).   
-0000fe40: 2069 7079 7468 6f6e 2822 2222 0a20 2020   ipython(""".   
-0000fe50: 2020 2020 2049 6e20 5b31 5d3a 2069 6d70       In [1]: imp
-0000fe60: 6f72 7420 4950 7974 686f 6e2c 206f 730a  ort IPython, os.
-0000fe70: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
-0000fe80: 7072 696e 7428 6f73 2e70 6174 682e 7265  print(os.path.re
-0000fe90: 616c 7061 7468 2849 5079 7468 6f6e 2e5f  alpath(IPython._
-0000fea0: 5f66 696c 655f 5f29 290a 2020 2020 2020  _file__)).      
-0000feb0: 2020 7b66 7d0a 2020 2020 2222 222e 666f    {f}.    """.fo
-0000fec0: 726d 6174 2866 3d66 2929 0a0a 0a40 7265  rmat(f=f))...@re
-0000fed0: 7472 790a 6465 6620 7465 7374 5f69 7079  try.def test_ipy
-0000fee0: 7468 6f6e 5f76 6572 7369 6f6e 5f31 2829  thon_version_1()
-0000fef0: 3a0a 2020 2020 2320 5665 7269 6679 2074  :.    # Verify t
-0000ff00: 6861 7420 6f75 7220 7465 7374 2073 6574  hat our test set
-0000ff10: 7570 2069 7320 6765 7474 696e 6720 7468  up is getting th
-0000ff20: 6520 7269 6768 7420 4950 7974 686f 6e2e  e right IPython.
-0000ff30: 0a20 2020 2069 7079 7468 6f6e 2822 2222  .    ipython("""
-0000ff40: 0a20 2020 2020 2020 2049 6e20 5b31 5d3a  .        In [1]:
-0000ff50: 2069 6d70 6f72 7420 4950 7974 686f 6e0a   import IPython.
-0000ff60: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
-0000ff70: 7072 696e 7428 4950 7974 686f 6e2e 5f5f  print(IPython.__
-0000ff80: 7665 7273 696f 6e5f 5f29 0a20 2020 2020  version__).     
-0000ff90: 2020 207b 4950 7974 686f 6e2e 5f5f 7665     {IPython.__ve
-0000ffa0: 7273 696f 6e5f 5f7d 0a20 2020 2022 2222  rsion__}.    """
-0000ffb0: 2e66 6f72 6d61 7428 4950 7974 686f 6e3d  .format(IPython=
-0000ffc0: 4950 7974 686f 6e29 290a 0a0a 4072 6574  IPython))...@ret
-0000ffd0: 7279 0a64 6566 2074 6573 745f 6175 746f  ry.def test_auto
-0000ffe0: 696d 706f 7274 5f31 2829 3a0a 2020 2020  import_1():.    
-0000fff0: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
-00010000: 2020 2020 496e 205b 315d 3a20 696d 706f      In [1]: impo
-00010010: 7274 2070 7966 6c79 6279 3b20 7079 666c  rt pyflyby; pyfl
-00010020: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
-00010030: 696d 706f 7274 6572 2829 0a20 2020 2020  importer().     
-00010040: 2020 2049 6e20 5b32 5d3a 2062 2740 272b     In [2]: b'@'+
-00010050: 6236 3464 6563 6f64 6528 2753 4756 7362  b64decode('SGVsb
-00010060: 4738 3d27 292b 6227 4027 0a20 2020 2020  G8=')+b'@'.     
-00010070: 2020 205b 5059 464c 5942 595d 2066 726f     [PYFLYBY] fro
-00010080: 6d20 6261 7365 3634 2069 6d70 6f72 7420  m base64 import 
-00010090: 6236 3464 6563 6f64 650a 2020 2020 2020  b64decode.      
-000100a0: 2020 4f75 745b 325d 3a20 6227 4048 656c    Out[2]: b'@Hel
-000100b0: 6c6f 4027 0a20 2020 2022 2222 290a 0a0a  lo@'.    """)...
-000100c0: 2320 4070 7974 6573 742e 6d61 726b 2e73  # @pytest.mark.s
-000100d0: 6b69 7069 6628 5f49 5059 5448 4f4e 5f56  kipif(_IPYTHON_V
-000100e0: 4552 5349 4f4e 203e 2028 382c 2030 292c  ERSION > (8, 0),
-000100f0: 2072 6561 736f 6e3d 2253 7472 616e 6765   reason="Strange
-00010100: 206f 7574 7075 7420 6d69 7373 7061 7273   output misspars
-00010110: 696e 6722 290a 4072 6574 7279 0a64 6566  ing").@retry.def
-00010120: 2074 6573 745f 6e6f 5f61 7574 6f69 6d70   test_no_autoimp
-00010130: 6f72 745f 3128 293a 0a20 2020 2023 2054  ort_1():.    # T
-00010140: 6573 7420 7468 6174 2077 6974 686f 7574  est that without
-00010150: 2070 7966 6c79 6279 2069 6e73 7461 6c6c   pyflyby install
-00010160: 6564 2c20 7765 2064 6f20 6765 7420 4e61  ed, we do get Na
-00010170: 6d65 4572 726f 722e 2020 5468 6973 2069  meError.  This i
-00010180: 730a 2020 2020 2320 7265 616c 6c79 2061  s.    # really a
-00010190: 2074 6573 7420 7468 6174 206f 7572 2074   test that our t
-000101a0: 6573 7469 6e67 2069 6e66 7261 7374 7275  esting infrastru
-000101b0: 6374 7572 6520 6973 204f 4b20 616e 6420  cture is OK and 
-000101c0: 6e6f 7420 6163 6369 6465 6e74 616c 6c79  not accidentally
-000101d0: 0a20 2020 2023 2070 6963 6b69 6e67 2075  .    # picking u
-000101e0: 7020 7079 666c 7962 7920 636f 6e66 6967  p pyflyby config
-000101f0: 7572 6174 696f 6e20 696e 7374 616c 6c65  uration installe
-00010200: 6420 696e 2061 2073 7973 7465 6d20 6f72  d in a system or
-00010210: 2075 7365 7220 636f 6e66 6967 2e0a 2020   user config..  
-00010220: 2020 6970 7974 686f 6e28 0a20 2020 2020    ipython(.     
-00010230: 2020 2022 2222 0a20 2020 2020 2020 2049     """.        I
-00010240: 6e20 5b31 5d3a 2062 2740 272b 6236 3464  n [1]: b'@'+b64d
-00010250: 6563 6f64 6528 2753 4756 7362 4738 3d27  ecode('SGVsbG8='
-00010260: 292b 6227 4027 0a20 2020 2020 2020 202d  )+b'@'.        -
-00010270: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00010280: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00010290: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000102a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000102b0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-000102c0: 2020 204e 616d 6545 7272 6f72 2020 2020     NameError    
-000102d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000102e0: 2020 2020 2020 2020 2020 2020 2054 7261               Tra
-000102f0: 6365 6261 636b 2028 6d6f 7374 2072 6563  ceback (most rec
-00010300: 656e 7420 6361 6c6c 206c 6173 7429 0a20  ent call last). 
-00010310: 2020 2020 2020 202e 2e2e 2069 6e20 2e2e         ... in ..
-00010320: 2e0a 2020 2020 2020 2020 4e61 6d65 4572  ..        NameEr
-00010330: 726f 723a 206e 616d 6520 2762 3634 6465  ror: name 'b64de
-00010340: 636f 6465 2720 6973 206e 6f74 2064 6566  code' is not def
-00010350: 696e 6564 0a20 2020 2022 2222 0a20 2020  ined.    """.   
-00010360: 2029 0a0a 0a73 6b69 7069 665f 6970 7974   )...skipif_ipyt
-00010370: 686f 6e5f 746f 6f5f 6f6c 645f 666f 725f  hon_too_old_for_
-00010380: 6c6f 6164 5f65 7874 203d 2070 7974 6573  load_ext = pytes
-00010390: 742e 6d61 726b 2e73 6b69 7069 6628 0a20  t.mark.skipif(. 
-000103a0: 2020 205f 4950 5954 484f 4e5f 5645 5253     _IPYTHON_VERS
-000103b0: 494f 4e20 3c20 2830 2c20 3131 292c 0a20  ION < (0, 11),. 
-000103c0: 2020 2072 6561 736f 6e3d 2249 5079 7468     reason="IPyth
-000103d0: 6f6e 2076 6572 7369 6f6e 2025 7320 646f  on version %s do
-000103e0: 6573 206e 6f74 2073 7570 706f 7274 2025  es not support %
-000103f0: 6c6f 6164 5f65 7874 2c20 736f 206e 6f74  load_ext, so not
-00010400: 6869 6e67 2074 6f20 7465 7374 2229 0a0a  hing to test")..
-00010410: 4073 6b69 7069 665f 6970 7974 686f 6e5f  @skipif_ipython_
-00010420: 746f 6f5f 6f6c 645f 666f 725f 6c6f 6164  too_old_for_load
-00010430: 5f65 7874 0a64 6566 2074 6573 745f 6c6f  _ext.def test_lo
-00010440: 6164 5f65 7874 5f31 2829 3a0a 2020 2020  ad_ext_1():.    
-00010450: 2320 5465 7374 2074 6861 7420 256c 6f61  # Test that %loa
-00010460: 645f 6578 7420 776f 726b 732e 0a20 2020  d_ext works..   
-00010470: 2069 7079 7468 6f6e 2822 2222 0a20 2020   ipython(""".   
-00010480: 2020 2020 2049 6e20 5b31 5d3a 2044 6563       In [1]: Dec
-00010490: 696d 616c 2835 3534 3739 3431 3529 0a20  imal(55479415). 
-000104a0: 2020 2020 2020 202e 2e2e 2e0a 2020 2020         .....    
-000104b0: 2020 2020 4e61 6d65 4572 726f 723a 206e      NameError: n
-000104c0: 616d 6520 2744 6563 696d 616c 2720 6973  ame 'Decimal' is
-000104d0: 206e 6f74 2064 6566 696e 6564 0a20 2020   not defined.   
-000104e0: 2020 2020 2049 6e20 5b32 5d3a 2025 6c6f       In [2]: %lo
-000104f0: 6164 5f65 7874 2070 7966 6c79 6279 0a20  ad_ext pyflyby. 
-00010500: 2020 2020 2020 2049 6e20 5b33 5d3a 2044         In [3]: D
-00010510: 6563 696d 616c 2834 3336 3630 3738 3329  ecimal(43660783)
-00010520: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
-00010530: 595d 2066 726f 6d20 6465 6369 6d61 6c20  Y] from decimal 
-00010540: 696d 706f 7274 2044 6563 696d 616c 0a20  import Decimal. 
-00010550: 2020 2020 2020 204f 7574 5b33 5d3a 2044         Out[3]: D
-00010560: 6563 696d 616c 2827 3433 3636 3037 3833  ecimal('43660783
-00010570: 2729 0a20 2020 2022 2222 290a 0a0a 4073  ').    """)...@s
-00010580: 6b69 7069 665f 6970 7974 686f 6e5f 746f  kipif_ipython_to
-00010590: 6f5f 6f6c 645f 666f 725f 6c6f 6164 5f65  o_old_for_load_e
-000105a0: 7874 0a40 7265 7472 790a 6465 6620 7465  xt.@retry.def te
-000105b0: 7374 5f75 6e6c 6f61 645f 6578 745f 3128  st_unload_ext_1(
-000105c0: 293a 0a20 2020 2023 2054 6573 7420 7468  ):.    # Test th
-000105d0: 6174 2025 756e 6c6f 6164 5f65 7874 2077  at %unload_ext w
-000105e0: 6f72 6b73 2e0a 2020 2020 2320 4175 746f  orks..    # Auto
-000105f0: 696d 706f 7274 696e 6720 7368 6f75 6c64  importing should
-00010600: 2073 746f 7020 776f 726b 696e 672c 2062   stop working, b
-00010610: 7574 2070 7265 7669 6f75 736c 7920 696d  ut previously im
-00010620: 706f 7274 6564 2074 6869 0a20 2020 2069  ported thi.    i
-00010630: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
-00010640: 2020 2049 6e20 5b31 5d3a 2062 3634 656e     In [1]: b64en
-00010650: 636f 6465 2862 2774 6f72 746f 6973 6527  code(b'tortoise'
-00010660: 290a 2020 2020 2020 2020 2e2e 2e2e 0a20  ).        ..... 
-00010670: 2020 2020 2020 204e 616d 6545 7272 6f72         NameError
-00010680: 3a20 6e61 6d65 2027 6236 3465 6e63 6f64  : name 'b64encod
-00010690: 6527 2069 7320 6e6f 7420 6465 6669 6e65  e' is not define
-000106a0: 640a 2020 2020 2020 2020 496e 205b 325d  d.        In [2]
-000106b0: 3a20 256c 6f61 645f 6578 7420 7079 666c  : %load_ext pyfl
-000106c0: 7962 790a 2020 2020 2020 2020 496e 205b  yby.        In [
-000106d0: 335d 3a20 6236 3465 6e63 6f64 6528 6227  3]: b64encode(b'
-000106e0: 746f 7274 6f69 7365 2729 0a20 2020 2020  tortoise').     
-000106f0: 2020 205b 5059 464c 5942 595d 2066 726f     [PYFLYBY] fro
-00010700: 6d20 6261 7365 3634 2069 6d70 6f72 7420  m base64 import 
-00010710: 6236 3465 6e63 6f64 650a 2020 2020 2020  b64encode.      
-00010720: 2020 4f75 745b 335d 3a20 6227 6447 3979    Out[3]: b'dG9y
-00010730: 6447 3970 6332 553d 270a 2020 2020 2020  dG9pc2U='.      
-00010740: 2020 496e 205b 345d 3a20 2575 6e6c 6f61    In [4]: %unloa
-00010750: 645f 6578 7420 7079 666c 7962 790a 2020  d_ext pyflyby.  
-00010760: 2020 2020 2020 496e 205b 355d 3a20 6236        In [5]: b6
-00010770: 3464 6563 6f64 6528 6227 6147 4679 5a51  4decode(b'aGFyZQ
-00010780: 3d3d 2729 0a20 2020 2020 2020 202e 2e2e  ==').        ...
-00010790: 2e0a 2020 2020 2020 2020 4e61 6d65 4572  ..        NameEr
-000107a0: 726f 723a 206e 616d 6520 2762 3634 6465  ror: name 'b64de
-000107b0: 636f 6465 2720 6973 206e 6f74 2064 6566  code' is not def
-000107c0: 696e 6564 0a20 2020 2020 2020 2049 6e20  ined.        In 
-000107d0: 5b36 5d3a 2062 3634 656e 636f 6465 2862  [6]: b64encode(b
-000107e0: 2774 7572 746c 6527 290a 2020 2020 2020  'turtle').      
-000107f0: 2020 4f75 745b 365d 3a20 6227 6448 5679    Out[6]: b'dHVy
-00010800: 6447 786c 270a 2020 2020 2222 2229 0a0a  dGxl'.    """)..
-00010810: 0a0a 4073 6b69 7069 665f 6970 7974 686f  ..@skipif_ipytho
-00010820: 6e5f 746f 6f5f 6f6c 645f 666f 725f 6c6f  n_too_old_for_lo
-00010830: 6164 5f65 7874 0a40 7265 7472 790a 6465  ad_ext.@retry.de
-00010840: 6620 7465 7374 5f72 656c 6f61 645f 6578  f test_reload_ex
-00010850: 745f 3128 293a 0a20 2020 2023 2054 6573  t_1():.    # Tes
-00010860: 7420 7468 6174 2061 7574 6f69 6d70 6f72  t that autoimpor
-00010870: 7469 6e67 2073 7469 6c6c 2077 6f72 6b73  ting still works
-00010880: 2061 6674 6572 2025 7265 6c6f 6164 5f65   after %reload_e
-00010890: 7874 2e0a 2020 2020 6970 7974 686f 6e28  xt..    ipython(
-000108a0: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-000108b0: 315d 3a20 6236 3465 6e63 6f64 6528 6227  1]: b64encode(b'
-000108c0: 6561 7374 2729 0a20 2020 2020 2020 202e  east').        .
-000108d0: 2e2e 2e0a 2020 2020 2020 2020 4e61 6d65  ....        Name
-000108e0: 4572 726f 723a 206e 616d 6520 2762 3634  Error: name 'b64
-000108f0: 656e 636f 6465 2720 6973 206e 6f74 2064  encode' is not d
-00010900: 6566 696e 6564 0a20 2020 2020 2020 2049  efined.        I
-00010910: 6e20 5b32 5d3a 2025 6c6f 6164 5f65 7874  n [2]: %load_ext
-00010920: 2070 7966 6c79 6279 0a20 2020 2020 2020   pyflyby.       
-00010930: 2049 6e20 5b33 5d3a 2062 3634 656e 636f   In [3]: b64enco
-00010940: 6465 2862 2765 6173 7427 290a 2020 2020  de(b'east').    
-00010950: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
-00010960: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
-00010970: 2062 3634 656e 636f 6465 0a20 2020 2020   b64encode.     
-00010980: 2020 204f 7574 5b33 5d3a 2062 275a 5746     Out[3]: b'ZWF
-00010990: 7a64 413d 3d27 0a20 2020 2020 2020 2049  zdA=='.        I
-000109a0: 6e20 5b34 5d3a 2025 7265 6c6f 6164 5f65  n [4]: %reload_e
-000109b0: 7874 2070 7966 6c79 6279 0a20 2020 2020  xt pyflyby.     
-000109c0: 2020 2049 6e20 5b35 5d3a 2062 3634 6465     In [5]: b64de
-000109d0: 636f 6465 2862 2764 3256 7a64 413d 3d27  code(b'd2VzdA=='
-000109e0: 290a 2020 2020 2020 2020 5b50 5946 4c59  ).        [PYFLY
-000109f0: 4259 5d20 6672 6f6d 2062 6173 6536 3420  BY] from base64 
-00010a00: 696d 706f 7274 2062 3634 6465 636f 6465  import b64decode
-00010a10: 0a20 2020 2020 2020 204f 7574 5b35 5d3a  .        Out[5]:
-00010a20: 2062 2777 6573 7427 0a20 2020 2022 2222   b'west'.    """
-00010a30: 290a 0a0a 4073 6b69 7069 665f 6970 7974  )...@skipif_ipyt
-00010a40: 686f 6e5f 746f 6f5f 6f6c 645f 666f 725f  hon_too_old_for_
-00010a50: 6c6f 6164 5f65 7874 0a40 7265 7472 790a  load_ext.@retry.
-00010a60: 6465 6620 7465 7374 5f72 656c 6f61 645f  def test_reload_
-00010a70: 6578 745f 7265 6c6f 6164 5f69 6d70 6f72  ext_reload_impor
-00010a80: 7464 625f 3128 746d 7029 3a0a 2020 2020  tdb_1(tmp):.    
-00010a90: 2320 5465 7374 2074 6861 7420 2572 656c  # Test that %rel
-00010aa0: 6f61 645f 6578 7420 6361 7573 6573 2074  oad_ext causes t
-00010ab0: 6865 2069 6d70 6f72 7464 6220 746f 2062  he importdb to b
-00010ac0: 6520 7265 6672 6573 6865 642e 0a20 2020  e refreshed..   
-00010ad0: 2077 7269 7465 7465 7874 2874 6d70 2e66   writetext(tmp.f
-00010ae0: 696c 652c 2022 6672 6f6d 2069 7465 7274  ile, "from itert
-00010af0: 6f6f 6c73 2069 6d70 6f72 7420 7265 7065  ools import repe
-00010b00: 6174 5c6e 2229 0a20 2020 2069 7079 7468  at\n").    ipyth
-00010b10: 6f6e 280a 2020 2020 2020 2020 2222 220a  on(.        """.
-00010b20: 2020 2020 2020 2020 496e 205b 315d 3a20          In [1]: 
-00010b30: 256c 6f61 645f 6578 7420 7079 666c 7962  %load_ext pyflyb
-00010b40: 790a 2020 2020 2020 2020 496e 205b 325d  y.        In [2]
-00010b50: 3a20 6c69 7374 2872 6570 6561 7428 332c  : list(repeat(3,
-00010b60: 3429 290a 2020 2020 2020 2020 5b50 5946  4)).        [PYF
-00010b70: 4c59 4259 5d20 6672 6f6d 2069 7465 7274  LYBY] from itert
-00010b80: 6f6f 6c73 2069 6d70 6f72 7420 7265 7065  ools import repe
-00010b90: 6174 0a20 2020 2020 2020 204f 7574 5b32  at.        Out[2
-00010ba0: 5d3a 205b 332c 2033 2c20 332c 2033 5d0a  ]: [3, 3, 3, 3].
-00010bb0: 2020 2020 2020 2020 496e 205b 335d 3a20          In [3]: 
-00010bc0: 6c69 7374 2863 6f6d 6269 6e61 7469 6f6e  list(combination
-00010bd0: 7328 2761 6263 272c 3229 290a 2020 2020  s('abc',2)).    
-00010be0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
-00010bf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00010c00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00010c10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00010c20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
-00010c30: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
-00010c40: 7220 2020 2020 2020 2020 2020 2020 2020  r               
-00010c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c60: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
-00010c70: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
-00010c80: 7374 290a 2020 2020 2020 2020 2e2e 2e20  st).        ... 
-00010c90: 696e 202e 2e2e 0a20 2020 2020 2020 204e  in ....        N
-00010ca0: 616d 6545 7272 6f72 3a20 6e61 6d65 2027  ameError: name '
-00010cb0: 636f 6d62 696e 6174 696f 6e73 2720 6973  combinations' is
-00010cc0: 206e 6f74 2064 6566 696e 6564 0a20 2020   not defined.   
-00010cd0: 2020 2020 2049 6e20 5b34 5d3a 2077 6974       In [4]: wit
-00010ce0: 6820 6f70 656e 2827 7b74 6d70 2e66 696c  h open('{tmp.fil
-00010cf0: 657d 272c 2027 6127 2920 6173 2066 3a0a  e}', 'a') as f:.
-00010d00: 2020 2020 2020 2020 2020 202e 2e2e 3a20             ...: 
-00010d10: 2020 662e 7772 6974 6528 2766 726f 6d20    f.write('from 
-00010d20: 6974 6572 746f 6f6c 7320 696d 706f 7274  itertools import
-00010d30: 2063 6f6d 6269 6e61 7469 6f6e 735c 5c6e   combinations\\n
-00010d40: 2729 0a20 2020 2020 2020 2020 2020 2e2e  ').           ..
-00010d50: 2e3a 0a20 2020 2020 2020 2049 6e20 5b35  .:.        In [5
-00010d60: 5d3a 206c 6973 7428 636f 6d62 696e 6174  ]: list(combinat
-00010d70: 696f 6e73 2827 6162 6327 2c32 2929 0a20  ions('abc',2)). 
-00010d80: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00010d90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00010da0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00010db0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00010dc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00010dd0: 2d2d 0a20 2020 2020 2020 204e 616d 6545  --.        NameE
-00010de0: 7272 6f72 2020 2020 2020 2020 2020 2020  rror            
-00010df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e00: 2020 2020 2054 7261 6365 6261 636b 2028       Traceback (
-00010e10: 6d6f 7374 2072 6563 656e 7420 6361 6c6c  most recent call
-00010e20: 206c 6173 7429 0a20 2020 2020 2020 202e   last).        .
-00010e30: 2e2e 2069 6e20 2e2e 2e0a 2020 2020 2020  .. in ....      
-00010e40: 2020 4e61 6d65 4572 726f 723a 206e 616d    NameError: nam
-00010e50: 6520 2763 6f6d 6269 6e61 7469 6f6e 7327  e 'combinations'
-00010e60: 2069 7320 6e6f 7420 6465 6669 6e65 640a   is not defined.
-00010e70: 2020 2020 2020 2020 496e 205b 365d 3a20          In [6]: 
-00010e80: 2572 656c 6f61 645f 6578 7420 7079 666c  %reload_ext pyfl
-00010e90: 7962 790a 2020 2020 2020 2020 496e 205b  yby.        In [
-00010ea0: 375d 3a20 6c69 7374 2863 6f6d 6269 6e61  7]: list(combina
-00010eb0: 7469 6f6e 7328 2761 6263 272c 3229 290a  tions('abc',2)).
-00010ec0: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
-00010ed0: 5d20 6672 6f6d 2069 7465 7274 6f6f 6c73  ] from itertools
-00010ee0: 2069 6d70 6f72 7420 636f 6d62 696e 6174   import combinat
-00010ef0: 696f 6e73 0a20 2020 2020 2020 204f 7574  ions.        Out
-00010f00: 5b37 5d3a 205b 2827 6127 2c20 2762 2729  [7]: [('a', 'b')
-00010f10: 2c20 2827 6127 2c20 2763 2729 2c20 2827  , ('a', 'c'), ('
-00010f20: 6227 2c20 2763 2729 5d0a 2020 2020 2222  b', 'c')].    ""
-00010f30: 222e 666f 726d 6174 280a 2020 2020 2020  ".format(.      
-00010f40: 2020 2020 2020 746d 703d 746d 700a 2020        tmp=tmp.  
-00010f50: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-00010f60: 2050 5946 4c59 4259 5f50 4154 483d 746d   PYFLYBY_PATH=tm
-00010f70: 702e 6669 6c65 2c0a 2020 2020 290a 0a0a  p.file,.    )...
-00010f80: 4073 6b69 7069 665f 6970 7974 686f 6e5f  @skipif_ipython_
-00010f90: 746f 6f5f 6f6c 645f 666f 725f 6c6f 6164  too_old_for_load
-00010fa0: 5f65 7874 0a40 7265 7472 790a 6465 6620  _ext.@retry.def 
-00010fb0: 7465 7374 5f72 656c 6f61 645f 6578 745f  test_reload_ext_
-00010fc0: 7265 7472 795f 6661 696c 6564 5f69 6d70  retry_failed_imp
-00010fd0: 6f72 7473 5f31 2874 6d70 293a 0a20 2020  orts_1(tmp):.   
-00010fe0: 2023 2056 6572 6966 7920 7468 6174 2025   # Verify that %
-00010ff0: 7872 656c 6f61 645f 6578 7420 6361 7573  xreload_ext caus
-00011000: 6573 2075 7320 746f 2072 6574 7279 2069  es us to retry i
-00011010: 6d70 6f72 7473 2074 6861 7420 7765 2070  mports that we p
-00011020: 7265 7669 6f75 736c 790a 2020 2020 2320  reviously.    # 
-00011030: 6465 6369 6465 6420 6e6f 7420 746f 2072  decided not to r
-00011040: 6574 7279 2e0a 2020 2020 7772 6974 6574  etry..    writet
-00011050: 6578 7428 0a20 2020 2020 2020 2074 6d70  ext(.        tmp
-00011060: 2e64 6972 202f 2022 6869 7070 6f38 3434  .dir / "hippo844
-00011070: 3032 3030 392e 7079 222c 0a20 2020 2020  02009.py",.     
-00011080: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00011090: 6d70 6f72 7420 7379 730a 2020 2020 2020  mport sys.      
-000110a0: 2020 6461 7461 203d 2073 7973 2e5f 5f64    data = sys.__d
-000110b0: 6963 745f 5f2e 7365 7464 6566 6175 6c74  ict__.setdefault
-000110c0: 2827 6869 7070 6f38 3434 3032 3030 395f  ('hippo84402009_
-000110d0: 6174 7465 6d70 7473 272c 2030 290a 2020  attempts', 0).  
-000110e0: 2020 2020 2020 7379 732e 6869 7070 6f38        sys.hippo8
-000110f0: 3434 3032 3030 395f 6174 7465 6d70 7473  4402009_attempts
-00011100: 202b 3d20 310a 2020 2020 2020 2020 7072   += 1.        pr
-00011110: 696e 7428 2768 656c 6c6f 2066 726f 6d20  int('hello from 
-00011120: 6869 7070 6f38 3434 3032 3030 393a 2061  hippo84402009: a
-00011130: 7474 656d 7074 2025 6427 0a20 2020 2020  ttempt %d'.     
-00011140: 2020 2020 2020 2020 2025 2073 7973 2e68           % sys.h
-00011150: 6970 706f 3834 3430 3230 3039 5f61 7474  ippo84402009_att
-00011160: 656d 7074 7329 0a20 2020 2020 2020 2031  empts).        1
-00011170: 2f30 0a20 2020 2022 2222 2c0a 2020 2020  /0.    """,.    
-00011180: 290a 2020 2020 7772 6974 6574 6578 7428  ).    writetext(
-00011190: 746d 702e 6669 6c65 2c20 2266 726f 6d20  tmp.file, "from 
-000111a0: 6869 7070 6f38 3434 3032 3030 3920 696d  hippo84402009 im
-000111b0: 706f 7274 2072 6869 6e6f 3133 3630 3931  port rhino136091
-000111c0: 3335 2229 0a20 2020 2069 7079 7468 6f6e  35").    ipython
-000111d0: 280a 2020 2020 2020 2020 2222 220a 2020  (.        """.  
-000111e0: 2020 2020 2020 496e 205b 315d 3a20 256c        In [1]: %l
-000111f0: 6f61 645f 6578 7420 7079 666c 7962 790a  oad_ext pyflyby.
-00011200: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
-00011210: 7268 696e 6f31 3336 3039 3133 350a 2020  rhino13609135.  
-00011220: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
-00011230: 6672 6f6d 2068 6970 706f 3834 3430 3230  from hippo844020
-00011240: 3039 2069 6d70 6f72 7420 7268 696e 6f31  09 import rhino1
-00011250: 3336 3039 3133 350a 2020 2020 2020 2020  3609135.        
-00011260: 6865 6c6c 6f20 6672 6f6d 2068 6970 706f  hello from hippo
-00011270: 3834 3430 3230 3039 3a20 6174 7465 6d70  84402009: attemp
-00011280: 7420 310a 2020 2020 2020 2020 5b50 5946  t 1.        [PYF
-00011290: 4c59 4259 5d20 4572 726f 7220 6174 7465  LYBY] Error atte
-000112a0: 6d70 7469 6e67 2074 6f20 2766 726f 6d20  mpting to 'from 
-000112b0: 6869 7070 6f38 3434 3032 3030 3920 696d  hippo84402009 im
-000112c0: 706f 7274 2072 6869 6e6f 3133 3630 3931  port rhino136091
-000112d0: 3335 273a 205a 6572 6f44 6976 6973 696f  35': ZeroDivisio
-000112e0: 6e45 7272 6f72 3a20 6469 7669 7369 6f6e  nError: division
-000112f0: 2062 7920 7a65 726f 0a20 2020 2020 2020   by zero.       
-00011300: 202e 2e2e 2e0a 2020 2020 2020 2020 2d2d   .....        --
-00011310: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00011320: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00011330: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00011340: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00011350: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00011360: 2020 4e61 6d65 4572 726f 7220 2020 2020    NameError     
-00011370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011380: 2020 2020 2020 2020 2020 2020 5472 6163              Trac
-00011390: 6562 6163 6b20 286d 6f73 7420 7265 6365  eback (most rece
-000113a0: 6e74 2063 616c 6c20 6c61 7374 290a 2020  nt call last).  
-000113b0: 2020 2020 2020 2e2e 2e20 696e 202e 2e2e        ... in ...
-000113c0: 0a20 2020 2020 2020 204e 616d 6545 7272  .        NameErr
-000113d0: 6f72 3a20 6e61 6d65 2027 7268 696e 6f31  or: name 'rhino1
-000113e0: 3336 3039 3133 3527 2069 7320 6e6f 7420  3609135' is not 
-000113f0: 6465 6669 6e65 640a 2020 2020 2020 2020  defined.        
-00011400: 496e 205b 335d 3a20 7268 696e 6f31 3336  In [3]: rhino136
-00011410: 3039 3133 350a 2020 2020 2020 2020 2d2d  09135.        --
+0000ba20: 7265 7370 6f6e 7365 5f64 6174 6120 3d20  response_data = 
+0000ba30: 6a73 6f6e 2e6c 6f61 6473 2874 6578 7429  json.loads(text)
+0000ba40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ba50: 206b 6572 6e65 6c5f 6964 203d 2072 6573   kernel_id = res
+0000ba60: 706f 6e73 655f 6461 7461 5b27 6b65 726e  ponse_data['kern
+0000ba70: 656c 275d 5b27 6964 275d 0a20 2020 2020  el']['id'].     
+0000ba80: 2020 2020 2020 2065 6c69 6620 5f49 5059         elif _IPY
+0000ba90: 5448 4f4e 5f56 4552 5349 4f4e 203e 3d20  THON_VERSION >= 
+0000baa0: 2830 2c20 3132 293a 0a20 2020 2020 2020  (0, 12):.       
+0000bab0: 2020 2020 2020 2020 2023 2047 6574 2074           # Get t
+0000bac0: 6865 2062 6173 6520 5552 4c20 6672 6f6d  he base URL from
+0000bad0: 2074 6865 206e 6f74 6562 6f6f 6b20 6170   the notebook ap
+0000bae0: 702e 0a20 2020 2020 2020 2020 2020 2020  p..             
+0000baf0: 2020 2063 6869 6c64 2e65 7870 6563 7428     child.expect(
+0000bb00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bb10: 2020 2020 2072 2254 6865 2028 3f3a 4950       r"The (?:IP
+0000bb20: 7974 686f 6e7c 4a75 7079 7465 7229 204e  ython|Jupyter) N
+0000bb30: 6f74 6562 6f6f 6b20 6973 2072 756e 6e69  otebook is runni
+0000bb40: 6e67 2061 743a 2028 6874 7470 3a2f 2f5b  ng at: (http://[
+0000bb50: 412d 5a61 2d7a 302d 393a 2e5d 2b29 5b2f  A-Za-z0-9:.]+)[/
+0000bb60: 5c72 5c6e 5d22 2c0a 2020 2020 2020 2020  \r\n]",.        
+0000bb70: 2020 2020 2020 2020 2020 2020 7469 6d65              time
+0000bb80: 6f75 743d 4445 4641 554c 545f 5449 4d45  out=DEFAULT_TIME
+0000bb90: 4f55 542c 0a20 2020 2020 2020 2020 2020  OUT,.           
+0000bba0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000bbb0: 2020 2020 2020 2062 6173 6575 726c 203d         baseurl =
+0000bbc0: 2063 6869 6c64 2e6d 6174 6368 2e67 726f   child.match.gro
+0000bbd0: 7570 2831 292e 6465 636f 6465 2822 7574  up(1).decode("ut
+0000bbe0: 662d 3822 290a 2020 2020 2020 2020 2020  f-8").          
+0000bbf0: 2020 2020 2020 2320 4c6f 6769 6e2e 0a20        # Login.. 
+0000bc00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000bc10: 6573 706f 6e73 6520 3d20 7265 7175 6573  esponse = reques
+0000bc20: 7473 2e70 6f73 7428 0a20 2020 2020 2020  ts.post(.       
+0000bc30: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+0000bc40: 6575 726c 202b 2022 2f6c 6f67 696e 222c  eurl + "/login",
+0000bc50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bc60: 2020 2020 2064 6174 613d 6469 6374 2870       data=dict(p
+0000bc70: 6173 7377 6f72 643d 7061 7373 7764 5f70  assword=passwd_p
+0000bc80: 6c61 696e 7465 7874 292c 0a20 2020 2020  laintext),.     
+0000bc90: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000bca0: 6c6c 6f77 5f72 6564 6972 6563 7473 3d46  llow_redirects=F
+0000bcb0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+0000bcc0: 2020 2020 2020 2020 2020 7469 6d65 6f75            timeou
+0000bcd0: 743d 4445 4641 554c 545f 5449 4d45 4f55  t=DEFAULT_TIMEOU
+0000bce0: 542c 0a20 2020 2020 2020 2020 2020 2020  T,.             
+0000bcf0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000bd00: 2020 2020 2061 7373 6572 7420 7265 7370       assert resp
+0000bd10: 6f6e 7365 2e73 7461 7475 735f 636f 6465  onse.status_code
+0000bd20: 203d 3d20 3330 320a 2020 2020 2020 2020   == 302.        
+0000bd30: 2020 2020 2020 2020 636f 6f6b 6965 7320          cookies 
+0000bd40: 3d20 7265 7370 6f6e 7365 2e63 6f6f 6b69  = response.cooki
+0000bd50: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+0000bd60: 2020 2023 2043 7265 6174 6520 6120 6e65     # Create a ne
+0000bd70: 7720 6e6f 7465 626f 6f6b 2e0a 2020 2020  w notebook..    
+0000bd80: 2020 2020 2020 2020 2020 2020 7265 7370              resp
+0000bd90: 6f6e 7365 203d 2072 6571 7565 7374 732e  onse = requests.
+0000bda0: 6765 7428 6261 7365 7572 6c20 2b20 222f  get(baseurl + "/
+0000bdb0: 6e65 7722 290a 2020 2020 2020 2020 2020  new").          
+0000bdc0: 2020 2020 2020 6173 7365 7274 2072 6573        assert res
+0000bdd0: 706f 6e73 652e 7374 6174 7573 5f63 6f64  ponse.status_cod
+0000bde0: 6520 3d3d 2032 3030 0a20 2020 2020 2020  e == 200.       
+0000bdf0: 2020 2020 2020 2020 2023 2047 6574 2074           # Get t
+0000be00: 6865 206e 6f74 6562 6f6f 6b5f 6964 2066  he notebook_id f
+0000be10: 6f72 2074 6865 206e 6577 206e 6f74 6562  or the new noteb
+0000be20: 6f6f 6b2e 0a20 2020 2020 2020 2020 2020  ook..           
+0000be30: 2020 2020 2074 6578 7420 3d20 7265 7370       text = resp
+0000be40: 6f6e 7365 2e74 6578 740a 2020 2020 2020  onse.text.      
+0000be50: 2020 2020 2020 2020 2020 6d20 3d20 7265            m = re
+0000be60: 2e73 6561 7263 6828 7222 6461 7461 2d6e  .search(r"data-n
+0000be70: 6f74 6562 6f6f 6b2d 6964 5c73 2a3d 5c73  otebook-id\s*=\s
+0000be80: 2a28 5b30 2d39 612d 662d 5d2b 2922 2c20  *([0-9a-f-]+)", 
+0000be90: 7465 7874 290a 2020 2020 2020 2020 2020  text).          
+0000bea0: 2020 2020 2020 6173 7365 7274 206d 2069        assert m i
+0000beb0: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
+0000bec0: 2020 2020 2020 2020 2020 206e 6f74 6562             noteb
+0000bed0: 6f6f 6b5f 6964 203d 206d 2e67 726f 7570  ook_id = m.group
+0000bee0: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
+0000bef0: 2020 2020 2320 5374 6172 7420 6120 6b65      # Start a ke
+0000bf00: 726e 656c 2066 6f72 2074 6865 206e 6f74  rnel for the not
+0000bf10: 6562 6f6f 6b2e 0a20 2020 2020 2020 2020  ebook..         
+0000bf20: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
+0000bf30: 3d20 7265 7175 6573 7473 2e70 6f73 7428  = requests.post(
+0000bf40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bf50: 2020 2020 2062 6173 6575 726c 202b 2022       baseurl + "
+0000bf60: 2f6b 6572 6e65 6c73 3f6e 6f74 6562 6f6f  /kernels?noteboo
+0000bf70: 6b3d 2220 2b20 6e6f 7465 626f 6f6b 5f69  k=" + notebook_i
+0000bf80: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+0000bf90: 2020 2020 2020 2074 696d 656f 7574 3d44         timeout=D
+0000bfa0: 4546 4155 4c54 5f54 494d 454f 5554 5f52  EFAULT_TIMEOUT_R
+0000bfb0: 4551 5545 5354 2c0a 2020 2020 2020 2020  EQUEST,.        
+0000bfc0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000bfd0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0000bfe0: 2072 6573 706f 6e73 652e 7374 6174 7573   response.status
+0000bff0: 5f63 6f64 6520 3d3d 2032 3030 0a20 2020  _code == 200.   
+0000c000: 2020 2020 2020 2020 2020 2020 2023 2047               # G
+0000c010: 6574 2074 6865 206b 6572 6e65 6c5f 6964  et the kernel_id
+0000c020: 2066 6f72 2074 6865 206e 6577 206b 6572   for the new ker
+0000c030: 6e65 6c2e 0a20 2020 2020 2020 2020 2020  nel..           
+0000c040: 2020 2020 2074 6578 7420 3d20 7265 7370       text = resp
+0000c050: 6f6e 7365 2e74 6578 740a 2020 2020 2020  onse.text.      
+0000c060: 2020 2020 2020 2020 2020 6b65 726e 656c            kernel
+0000c070: 5f69 6420 3d20 6a73 6f6e 2e6c 6f61 6473  _id = json.loads
+0000c080: 2874 6578 7429 5b27 6b65 726e 656c 5f69  (text)['kernel_i
+0000c090: 6427 5d0a 2020 2020 2020 2020 2020 2020  d'].            
+0000c0a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000c0b0: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
+0000c0c0: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
+0000c0d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c0e0: 2020 2020 2022 4e6f 7420 696d 706c 656d       "Not implem
+0000c0f0: 656e 7465 6420 666f 7220 4950 7974 686f  ented for IPytho
+0000c100: 6e20 2573 2220 2520 2849 5079 7468 6f6e  n %s" % (IPython
+0000c110: 2e5f 5f76 6572 7369 6f6e 5f5f 2929 0a20  .__version__)). 
+0000c120: 2020 2020 2020 2020 2020 2023 2043 6f6e             # Con
+0000c130: 7374 7275 6374 2074 6865 206b 6572 6e65  struct the kerne
+0000c140: 6c20 696e 666f 206c 696e 653a 202d 2d65  l info line: --e
+0000c150: 7869 7374 696e 6720 6b65 726e 656c 2d31  xisting kernel-1
+0000c160: 3233 2d61 6263 642d 2e2e 2e34 3536 2e6a  23-abcd-...456.j
+0000c170: 736f 6e0a 2020 2020 2020 2020 2020 2020  son.            
+0000c180: 6b65 726e 656c 5f69 6e66 6f20 3d20 5b62  kernel_info = [b
+0000c190: 272d 2d65 7869 7374 696e 6727 2c20 6222  '--existing', b"
+0000c1a0: 6b65 726e 656c 2d25 732e 6a73 6f6e 2220  kernel-%s.json" 
+0000c1b0: 2520 6b65 726e 656c 5f69 642e 656e 636f  % kernel_id.enco
+0000c1c0: 6465 2827 7574 662d 3827 295d 0a20 2020  de('utf-8')].   
+0000c1d0: 2020 2020 2020 2020 2023 2059 6965 6c64           # Yield
+0000c1e0: 2063 6f6e 7472 6f6c 2074 6f20 6361 6c6c   control to call
+0000c1f0: 6572 2e0a 2020 2020 2020 2020 2020 2020  er..            
+0000c200: 6368 696c 642e 6b65 726e 656c 5f69 6e66  child.kernel_inf
+0000c210: 6f20 3d20 6b65 726e 656c 5f69 6e66 6f0a  o = kernel_info.
+0000c220: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
+0000c230: 6420 6368 696c 640a 2020 2020 6669 6e61  d child.    fina
+0000c240: 6c6c 793a 0a20 2020 2020 2020 2066 6f72  lly:.        for
+0000c250: 2063 6c65 616e 7570 2069 6e20 636c 6561   cleanup in clea
+0000c260: 6e75 7073 3a0a 2020 2020 2020 2020 2020  nups:.          
+0000c270: 2020 636c 6561 6e75 7028 290a 0a0a 6465    cleanup()...de
+0000c280: 6620 5f77 6169 745f 666f 725f 6f75 7470  f _wait_for_outp
+0000c290: 7574 2863 6869 6c64 2c20 7469 6d65 6f75  ut(child, timeou
+0000c2a0: 7429 3a0a 2020 2020 2222 220a 2020 2020  t):.    """.    
+0000c2b0: 5761 6974 2075 7020 746f 2060 6074 696d  Wait up to ``tim
+0000c2c0: 656f 7574 6060 2073 6563 6f6e 6473 2066  eout`` seconds f
+0000c2d0: 6f72 206f 7574 7075 742e 0a20 2020 2022  or output..    "
+0000c2e0: 2222 0a20 2020 2023 2049 6e20 4950 7974  "".    # In IPyt
+0000c2f0: 686f 6e20 352c 2077 6520 6361 6e6e 6f74  hon 5, we cannot
+0000c300: 2073 656e 6420 616e 7920 6f75 7470 7574   send any output
+0000c310: 2062 6566 6f72 6520 4950 7974 686f 6e20   before IPython 
+0000c320: 7265 7370 6f6e 6473 2074 6f20 7468 650a  responds to the.
+0000c330: 2020 2020 2320 7461 622c 2065 6c73 6520      # tab, else 
+0000c340: 6974 2077 6f6e 2774 2072 6573 706f 6e64  it won't respond
+0000c350: 2074 6f20 7468 6520 7461 622e 2020 5468   to the tab.  Th
+0000c360: 6520 7075 7270 6f73 6520 6f66 2074 6869  e purpose of thi
+0000c370: 7320 6675 6e63 7469 6f6e 2069 730a 2020  s function is.  
+0000c380: 2020 2320 746f 2077 6169 7420 666f 7220    # to wait for 
+0000c390: 4950 7974 686f 6e20 746f 2072 6573 706f  IPython to respo
+0000c3a0: 6e64 2074 6f20 6120 7461 622e 0a20 2020  nd to a tab..   
+0000c3b0: 2069 6620 4445 4255 473a 0a20 2020 2020   if DEBUG:.     
+0000c3c0: 2020 2070 7269 6e74 2822 5f77 6169 745f     print("_wait_
+0000c3d0: 666f 725f 6f75 7470 7574 2829 2229 0a20  for_output()"). 
+0000c3e0: 2020 2067 6f74 5f64 6174 615f 616c 7265     got_data_alre
+0000c3f0: 6164 7920 3d20 4661 6c73 650a 2020 2020  ady = False.    
+0000c400: 2320 5265 6164 2060 6042 4c4f 434b 5349  # Read ``BLOCKSI
+0000c410: 5a45 6060 2062 7974 6573 2061 7420 6120  ZE`` bytes at a 
+0000c420: 7469 6d65 2e20 204e 6f74 6520 7468 6174  time.  Note that
+0000c430: 2063 7572 7265 6e74 6c79 206f 7572 2061   currently our a
+0000c440: 6e73 6920 6669 6c74 6572 0a20 2020 2023  nsi filter.    #
+0000c450: 2077 6f6e 2774 2077 6f72 6b20 6163 726f   won't work acro
+0000c460: 7373 2062 6c6f 636b 2062 6f75 6e64 6172  ss block boundar
+0000c470: 6965 732c 2073 6f20 6375 7272 656e 746c  ies, so currentl
+0000c480: 7920 7468 6973 2062 6c6f 636b 7369 7a65  y this blocksize
+0000c490: 206e 6565 6473 2074 6f0a 2020 2020 2320   needs to.    # 
+0000c4a0: 6265 206c 6172 6765 2065 6e6f 7567 6820  be large enough 
+0000c4b0: 7468 6174 2077 6520 646f 6e27 7420 7370  that we don't sp
+0000c4c0: 616e 2061 6e20 414e 5349 2073 6571 7565  an an ANSI seque
+0000c4d0: 6e63 6520 6163 726f 7373 2074 776f 2062  nce across two b
+0000c4e0: 6c6f 636b 732e 0a20 2020 2042 4c4f 434b  locks..    BLOCK
+0000c4f0: 5349 5a45 203d 2031 362a 3430 3936 0a20  SIZE = 16*4096. 
+0000c500: 2020 2064 6561 646c 696e 6520 3d20 7469     deadline = ti
+0000c510: 6d65 2e74 696d 6528 2920 2b20 7469 6d65  me.time() + time
+0000c520: 6f75 740a 2020 2020 7768 696c 6520 5472  out.    while Tr
+0000c530: 7565 3a0a 2020 2020 2020 2020 6966 2063  ue:.        if c
+0000c540: 6869 6c64 2e66 6c61 675f 656f 663a 0a20  hild.flag_eof:. 
+0000c550: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0000c560: 0a20 2020 2020 2020 2069 6620 676f 745f  .        if got_
+0000c570: 6461 7461 5f61 6c72 6561 6479 3a0a 2020  data_already:.  
+0000c580: 2020 2020 2020 2020 2020 2320 4966 2077            # If w
+0000c590: 6520 7072 6576 696f 7573 6c79 2067 6f74  e previously got
+0000c5a0: 2061 6e79 2064 6174 6120 2861 6674 6572   any data (after
+0000c5b0: 2061 6e73 6920 6669 6c74 6572 696e 6729   ansi filtering)
+0000c5c0: 2c20 7468 656e 206b 6565 700a 2020 2020  , then keep.    
+0000c5d0: 2020 2020 2020 2020 2320 676f 696e 6720          # going 
+0000c5e0: 7768 696c 6520 7468 6572 6527 7320 7065  while there's pe
+0000c5f0: 6e64 696e 6720 6461 7461 2e0a 2020 2020  nding data..    
+0000c600: 2020 2020 2020 2020 7265 6d61 696e 696e          remainin
+0000c610: 675f 7469 6d65 6f75 7420 3d20 7469 6d65  g_timeout = time
+0000c620: 6f75 740a 2020 2020 2020 2020 656c 7365  out.        else
+0000c630: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0000c640: 5761 6974 2075 6e74 696c 2074 696d 656f  Wait until timeo
+0000c650: 7574 2e20 2054 6869 7320 636f 6e64 6974  ut.  This condit
+0000c660: 696f 6e20 6170 706c 6965 7320 6966 2069  ion applies if i
+0000c670: 7427 7320 7468 6520 6669 7273 740a 2020  t's the first.  
+0000c680: 2020 2020 2020 2020 2020 2320 6c6f 6f70            # loop
+0000c690: 2c20 6f72 2069 6620 7765 2776 6520 676f  , or if we've go
+0000c6a0: 7474 656e 2073 6f6d 6520 6e6f 6e2d 656d  tten some non-em
+0000c6b0: 7074 7920 6461 7461 2061 6674 6572 2061  pty data after a
+0000c6c0: 6e73 690a 2020 2020 2020 2020 2020 2020  nsi.            
+0000c6d0: 2320 6669 6c74 6572 696e 672e 0a20 2020  # filtering..   
+0000c6e0: 2020 2020 2020 2020 2072 656d 6169 6e69           remaini
+0000c6f0: 6e67 5f74 696d 656f 7574 203d 2064 6561  ng_timeout = dea
+0000c700: 646c 696e 6520 2d20 7469 6d65 2e74 696d  dline - time.tim
+0000c710: 6528 290a 2020 2020 2020 2020 7472 793a  e().        try:
+0000c720: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+0000c730: 6120 3d20 6368 696c 642e 7265 6164 5f6e  a = child.read_n
+0000c740: 6f6e 626c 6f63 6b69 6e67 2842 4c4f 434b  onblocking(BLOCK
+0000c750: 5349 5a45 2c20 7469 6d65 6f75 743d 7265  SIZE, timeout=re
+0000c760: 6d61 696e 696e 675f 7469 6d65 6f75 7429  maining_timeout)
+0000c770: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0000c780: 7065 7870 6563 742e 5449 4d45 4f55 543a  pexpect.TIMEOUT:
+0000c790: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000c7a0: 4445 4255 473a 0a20 2020 2020 2020 2020  DEBUG:.         
+0000c7b0: 2020 2020 2020 2070 7269 6e74 2822 5f77         print("_w
+0000c7c0: 6169 745f 666f 725f 6f75 7470 7574 2829  ait_for_output()
+0000c7d0: 3a20 7469 6d65 6f75 7420 6166 7465 7220  : timeout after 
+0000c7e0: 2573 2073 6563 6f6e 6473 2220 2520 7265  %s seconds" % re
+0000c7f0: 6d61 696e 696e 675f 7469 6d65 6f75 7429  maining_timeout)
+0000c800: 0a20 2020 2020 2020 2020 2020 2062 7265  .            bre
+0000c810: 616b 0a20 2020 2020 2020 2069 6620 4445  ak.        if DE
+0000c820: 4255 473a 0a20 2020 2020 2020 2020 2020  BUG:.           
+0000c830: 2070 7269 6e74 2822 5f77 6169 745f 666f   print("_wait_fo
+0000c840: 725f 6f75 7470 7574 2829 3a20 676f 7420  r_output(): got 
+0000c850: 2572 2220 2520 2864 6174 612c 2929 0a20  %r" % (data,)). 
+0000c860: 2020 2020 2020 2023 204b 6565 7020 7468         # Keep th
+0000c870: 6520 6461 7461 2069 6e20 6361 7365 2077  e data in case w
+0000c880: 6520 6e65 6564 2074 6f20 6578 7065 6374  e need to expect
+0000c890: 206f 6e20 6974 206c 6174 6572 2e0a 2020   on it later..  
+0000c8a0: 2020 2020 2020 6368 696c 642e 5f62 7566        child._buf
+0000c8b0: 6665 722e 7772 6974 6528 6461 7461 290a  fer.write(data).
+0000c8c0: 2020 2020 2020 2020 2320 5765 2067 6f74          # We got
+0000c8d0: 2073 6f6d 6520 7261 7720 6461 7461 2e20   some raw data. 
+0000c8e0: 2043 6865 636b 2069 6620 6974 2773 206e   Check if it's n
+0000c8f0: 6f6e 2d65 6d70 7479 2061 6674 6572 2061  on-empty after a
+0000c900: 6e73 6920 6669 6c74 6572 696e 672e 0a20  nsi filtering.. 
+0000c910: 2020 2020 2020 2069 6620 6461 7461 3a0a         if data:.
+0000c920: 2020 2020 2020 2020 2020 2020 676f 745f              got_
+0000c930: 6461 7461 5f61 6c72 6561 6479 203d 2054  data_already = T
+0000c940: 7275 650a 0a0a 6465 6620 5f77 6169 745f  rue...def _wait_
+0000c950: 6e6f 6e63 6528 6368 696c 6429 3a0a 2020  nonce(child):.  
+0000c960: 2020 2222 220a 2020 2020 5365 6e64 2061    """.    Send a
+0000c970: 206e 6f6e 6365 2074 6f20 7468 6520 6368   nonce to the ch
+0000c980: 696c 642c 2074 6865 6e20 7761 6974 2066  ild, then wait f
+0000c990: 6f72 2074 6865 206e 6f6e 6365 2c20 7468  or the nonce, th
+0000c9a0: 656e 2062 6163 6b73 7061 6365 2069 742e  en backspace it.
+0000c9b0: 0a20 2020 2022 2222 0a20 2020 2023 2054  .    """.    # T
+0000c9c0: 6869 7320 6675 6e63 7469 6f6e 2070 6572  his function per
+0000c9d0: 666f 726d 7320 6120 636c 6576 6572 2074  forms a clever t
+0000c9e0: 7269 636b 2e20 2057 6865 6e20 7765 2075  rick.  When we u
+0000c9f0: 7365 2074 6162 2063 6f6d 706c 6574 696f  se tab completio
+0000ca00: 6e2c 2077 650a 2020 2020 2320 6e65 6564  n, we.    # need
+0000ca10: 2074 6f20 6861 6e64 6c65 2061 2066 6577   to handle a few
+0000ca20: 2076 6172 6961 6e74 7320 6f66 206f 7574   variants of out
+0000ca30: 7075 742e 2020 5375 7070 6f73 6520 7468  put.  Suppose th
+0000ca40: 6520 7573 6572 2065 6e74 6572 730a 2020  e user enters.  
+0000ca50: 2020 2320 2266 6f6f 2e62 5c74 222e 2020    # "foo.b\t".  
+0000ca60: 5765 2063 6f75 6c64 2073 6565 3a0a 2020  We could see:.  
+0000ca70: 2020 2320 2020 312e 204e 6f20 6f75 7470    #   1. No outp
+0000ca80: 7574 2e20 2054 6865 7265 2077 6173 206e  ut.  There was n
+0000ca90: 6f74 6869 6e67 2074 6f20 636f 6d70 6c65  othing to comple
+0000caa0: 7465 2c20 736f 2074 6865 7265 0a20 2020  te, so there.   
+0000cab0: 2023 2020 2020 2020 7769 6c6c 2062 6520   #      will be 
+0000cac0: 6e6f 206f 7574 7075 742e 0a20 2020 2023  no output..    #
+0000cad0: 2020 2020 2020 2020 2049 6e20 5b31 5d3a           In [1]:
+0000cae0: 2066 6f6f 2e62 0a20 2020 2023 2020 2032   foo.b.    #   2
+0000caf0: 2e20 5265 6775 6c61 7220 636f 6d70 6c65  . Regular comple
+0000cb00: 7469 6f6e 0a20 2020 2023 2020 2020 2020  tion.    #      
+0000cb10: 2020 2049 6e20 5b31 5d3a 2066 6f6f 2e62     In [1]: foo.b
+0000cb20: 6172 0a20 2020 2023 2020 2033 2e20 4d75  ar.    #   3. Mu
+0000cb30: 6c74 6970 6c65 2070 6f73 7369 6269 6c69  ltiple possibili
+0000cb40: 7469 6573 2028 7065 7268 6170 7320 7061  ties (perhaps pa
+0000cb50: 7274 6961 6c20 636f 6d70 6c65 7469 6f6e  rtial completion
+0000cb60: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
+0000cb70: 496e 205b 315d 3a20 666f 6f2e 620a 2020  In [1]: foo.b.  
+0000cb80: 2020 2320 2020 2020 2020 2020 666f 6f2e    #         foo.
+0000cb90: 6261 7231 2020 666f 6f2e 6261 7232 0a20  bar1  foo.bar2. 
+0000cba0: 2020 2023 2020 2020 2020 2020 2049 6e20     #         In 
+0000cbb0: 5b31 5d3a 2066 6f6f 2e62 6172 0a20 2020  [1]: foo.bar.   
+0000cbc0: 2023 2020 2034 2e20 4175 746f 696d 706f   #   4. Autoimpo
+0000cbd0: 7274 0a20 2020 2023 2020 2020 2020 2020  rt.    #        
+0000cbe0: 2049 6e20 5b31 5d3a 2066 6f6f 2e62 0a20   In [1]: foo.b. 
+0000cbf0: 2020 2023 2020 2020 2020 2020 205b 5059     #         [PY
+0000cc00: 464c 5942 595d 2069 6d70 6f72 7420 666f  FLYBY] import fo
+0000cc10: 6f0a 2020 2020 2320 2020 2020 2020 2020  o.    #         
+0000cc20: 496e 205b 315d 3a20 666f 6f2e 6261 720a  In [1]: foo.bar.
+0000cc30: 2020 2020 2320 2020 352e 2041 7574 6f69      #   5. Autoi
+0000cc40: 6d70 6f72 7420 2b20 6d75 6c74 6970 6c65  mport + multiple
+0000cc50: 2070 6f73 7369 6269 6c69 7469 6573 0a20   possibilities. 
+0000cc60: 2020 2023 2020 2020 2020 2020 2049 6e20     #         In 
+0000cc70: 5b31 5d3a 2066 6f6f 2e62 0a20 2020 2023  [1]: foo.b.    #
+0000cc80: 2020 2020 2020 2020 205b 5059 464c 5942           [PYFLYB
+0000cc90: 595d 2069 6d70 6f72 7420 666f 6f0a 2020  Y] import foo.  
+0000cca0: 2020 2320 2020 2020 2020 2020 496e 205b    #         In [
+0000ccb0: 315d 3a20 666f 6f2e 620a 2020 2020 2320  1]: foo.b.    # 
+0000ccc0: 2020 2020 2020 2020 666f 6f2e 6261 7231          foo.bar1
+0000ccd0: 2020 666f 6f2e 6261 7232 0a20 2020 2023    foo.bar2.    #
+0000cce0: 2020 2020 2020 2020 2049 6e20 5b31 5d3a           In [1]:
+0000ccf0: 2066 6f6f 2e62 6172 0a20 2020 2023 2057   foo.bar.    # W
+0000cd00: 6520 6e65 6564 2074 6f20 6861 6e64 6c65  e need to handle
+0000cd10: 2061 6c6c 206f 6620 7468 6573 6520 706f   all of these po
+0000cd20: 7373 6962 696c 6974 6965 732e 0a20 2020  ssibilities..   
+0000cd30: 2023 2054 6f20 646f 2074 6861 742c 2077   # To do that, w
+0000cd40: 6520 7365 6e64 2061 206e 6f6e 6365 2074  e send a nonce t
+0000cd50: 6861 7420 4950 7974 686f 6e20 7769 6c6c  hat IPython will
+0000cd60: 2065 6368 6f20 6261 636b 2c20 2a61 6674   echo back, *aft
+0000cd70: 6572 2a20 7468 650a 2020 2020 2320 7265  er* the.    # re
+0000cd80: 7370 6f6e 7365 2074 6f20 7468 6520 7461  sponse to the ta
+0000cd90: 622e 2020 5468 6973 2077 6179 2077 6520  b.  This way we 
+0000cda0: 6361 6e20 7761 6974 2066 6f72 2074 6865  can wait for the
+0000cdb0: 206e 6f6e 6365 2061 6e64 0a20 2020 2023   nonce and.    #
+0000cdc0: 206b 6e6f 7720 6578 6163 746c 7920 7768   know exactly wh
+0000cdd0: 656e 2049 5079 7468 6f6e 2069 7320 646f  en IPython is do
+0000cde0: 6e65 2072 6573 706f 6e64 696e 6720 746f  ne responding to
+0000cdf0: 2074 6865 2074 6162 2e0a 2020 2020 2320   the tab..    # 
+0000ce00: 536f 6d65 2070 7265 7669 6f75 7320 6174  Some previous at
+0000ce10: 7465 6d70 7473 3a0a 2020 2020 2320 2020  tempts:.    #   
+0000ce20: 2a20 4c6f 6f6b 2066 6f72 2072 6570 6561  * Look for repea
+0000ce30: 7465 6420 2249 6e20 5b31 5d22 2074 6f20  ted "In [1]" to 
+0000ce40: 696e 6469 6361 7465 2074 6861 7420 6974  indicate that it
+0000ce50: 2773 206e 6f74 2061 2072 6561 6c20 7072  's not a real pr
+0000ce60: 6f6d 7074 2e0a 2020 2020 2320 2020 2020  ompt..    #     
+0000ce70: 5468 6174 2064 6f65 736e 2774 2077 6f72  That doesn't wor
+0000ce80: 6b20 7765 6c6c 2066 6f72 2063 6f6e 7469  k well for conti
+0000ce90: 6e75 6174 696f 6e20 7072 6f6d 7074 7320  nuation prompts 
+0000cea0: 2822 2e2e 2e3a 2229 2e0a 2020 2020 2320  ("...:")..    # 
+0000ceb0: 2020 2a20 4c6f 6f6b 2066 6f72 2022 5c6e    * Look for "\n
+0000cec0: 2220 6166 7465 7220 7461 6220 616e 6420  " after tab and 
+0000ced0: 6966 2073 6f20 6c6f 6f6b 2066 6f72 2061  if so look for a
+0000cee0: 6e6f 7468 6572 2072 6570 6561 7465 6420  nother repeated 
+0000cef0: 7072 6f6d 7074 2e0a 2020 2020 2320 2020  prompt..    #   
+0000cf00: 2020 5468 6174 2064 6f65 736e 2774 2077    That doesn't w
+0000cf10: 6f72 6b20 7765 6c6c 2066 6f72 2063 6173  ork well for cas
+0000cf20: 6520 3520 2864 6966 6669 6375 6c74 2074  e 5 (difficult t
+0000cf30: 6f20 6465 7465 6374 2074 7269 706c 650a  o detect triple.
+0000cf40: 2020 2020 2320 2020 2020 7072 6f6d 7074      #     prompt
+0000cf50: 732c 2065 7370 6563 6961 6c6c 7920 6966  s, especially if
+0000cf60: 2069 7427 7320 7472 6970 6c65 2063 6f6e   it's triple con
+0000cf70: 7469 6e75 6174 696f 6e20 7072 6f6d 7074  tinuation prompt
+0000cf80: 7329 2c20 616e 640a 2020 2020 2320 2020  s), and.    #   
+0000cf90: 2020 7265 7175 6972 6564 2061 6e20 616e    required an an
+0000cfa0: 6e6f 7969 6e67 2074 696d 656f 7574 2074  noying timeout t
+0000cfb0: 6f20 6861 6e64 6c65 2074 6865 206e 6f2d  o handle the no-
+0000cfc0: 6f75 7470 7574 2063 6173 652e 0a20 2020  output case..   
+0000cfd0: 206c 6f67 6669 6c65 5f72 6561 6420 3d20   logfile_read = 
+0000cfe0: 6368 696c 642e 6c6f 6766 696c 655f 7265  child.logfile_re
+0000cff0: 6164 0a20 2020 2074 7279 3a0a 2020 2020  ad.    try:.    
+0000d000: 2020 2020 2320 5465 6d70 6f72 6172 696c      # Temporaril
+0000d010: 7920 7475 726e 206f 6666 206c 6f67 6769  y turn off loggi
+0000d020: 6e67 206f 6620 7468 6520 6f75 7470 7574  ng of the output
+0000d030: 2e20 2054 6865 2063 616c 6c65 7220 646f  .  The caller do
+0000d040: 6573 6e27 7420 6e65 6564 0a20 2020 2020  esn't need.     
+0000d050: 2020 2023 2074 6f20 7365 6520 7468 6520     # to see the 
+0000d060: 6e6f 6e63 6520 6f72 2074 6865 2062 6163  nonce or the bac
+0000d070: 6b73 7061 6365 732e 0a20 2020 2020 2020  kspaces..       
+0000d080: 2063 6869 6c64 2e6c 6f67 6669 6c65 5f72   child.logfile_r
+0000d090: 6561 6420 3d20 4e6f 6e65 0a20 2020 2020  ead = None.     
+0000d0a0: 2020 2023 2053 656e 6420 7468 6520 6e6f     # Send the no
+0000d0b0: 6e63 652e 0a20 2020 2020 2020 206e 6f6e  nce..        non
+0000d0c0: 6365 203d 2022 3c53 4947 2573 202f 3e22  ce = "<SIG%s />"
+0000d0d0: 2025 2028 696e 7428 7261 6e64 6f6d 2e72   % (int(random.r
+0000d0e0: 616e 646f 6d28 292a 3165 3929 290a 2020  andom()*1e9)).  
+0000d0f0: 2020 2020 2020 6368 696c 642e 7365 6e64        child.send
+0000d100: 286e 6f6e 6365 290a 2020 2020 2020 2020  (nonce).        
+0000d110: 2320 5761 6974 2066 6f72 2074 6865 206e  # Wait for the n
+0000d120: 6f6e 6365 2e0a 2020 2020 2020 2020 6368  once..        ch
+0000d130: 696c 642e 6578 7065 6374 5f65 7861 6374  ild.expect_exact
+0000d140: 286e 6f6e 6365 2c20 7469 6d65 6f75 743d  (nonce, timeout=
+0000d150: 4445 4641 554c 545f 5449 4d45 4f55 5429  DEFAULT_TIMEOUT)
+0000d160: 0a20 2020 2020 2020 2064 6174 615f 6166  .        data_af
+0000d170: 7465 725f 7461 6220 3d20 6368 696c 642e  ter_tab = child.
+0000d180: 6265 666f 7265 0a20 2020 2020 2020 2023  before.        #
+0000d190: 204c 6f67 2077 6861 7420 6361 6d65 2062   Log what came b
+0000d1a0: 6566 6f72 6520 7468 6520 6e6f 6e63 6520  efore the nonce 
+0000d1b0: 2862 7574 206e 6f74 2074 6865 206e 6f6e  (but not the non
+0000d1c0: 6365 2069 7473 656c 6629 2e0a 2020 2020  ce itself)..    
+0000d1d0: 2020 2020 6c6f 6766 696c 655f 7265 6164      logfile_read
+0000d1e0: 2e77 7269 7465 2864 6174 615f 6166 7465  .write(data_afte
+0000d1f0: 725f 7461 6229 0a20 2020 2020 2020 2023  r_tab).        #
+0000d200: 2044 656c 6574 6520 7468 6520 6e6f 6e63   Delete the nonc
+0000d210: 6520 7765 2074 7970 6564 2e0a 2020 2020  e we typed..    
+0000d220: 2020 2020 6368 696c 642e 7365 6e64 2822      child.send("
+0000d230: 5c62 2220 2a20 6c65 6e28 6e6f 6e63 6529  \b" * len(nonce)
+0000d240: 290a 2020 2020 2020 2020 6368 696c 642e  ).        child.
+0000d250: 6578 7065 6374 280a 2020 2020 2020 2020  expect(.        
+0000d260: 2020 2020 5b72 225c 7831 625c 5b25 6444      [r"\x1b\[%dD
+0000d270: 2220 2520 6c65 6e28 6e6f 6e63 6529 2c20  " % len(nonce), 
+0000d280: 7222 5c78 3038 5c78 3162 5c5b 4b22 202a  r"\x08\x1b\[K" *
+0000d290: 206c 656e 286e 6f6e 6365 292c 2023 2049   len(nonce), # I
+0000d2a0: 5079 7468 6f6e 203c 2020 350a 2020 2020  Python <  5.    
+0000d2b0: 2020 2020 2020 2020 2072 225c 7830 3820           r"\x08 
+0000d2c0: 5c78 3038 222a 6c65 6e28 6e6f 6e63 6529  \x08"*len(nonce)
+0000d2d0: 2023 2047 6974 4875 6220 4349 2073 6565   # GitHub CI see
+0000d2e0: 6d20 746f 206f 7665 7277 7269 7465 2077  m to overwrite w
+0000d2f0: 6974 6820 7370 6163 6573 206f 6e20 746f  ith spaces on to
+0000d300: 7020 6f66 206d 6f76 696e 6720 6375 7273  p of moving curs
+0000d310: 6f72 203f 0a20 2020 2020 2020 2020 2020  or ?.           
+0000d320: 205d 2c0a 2020 2020 2020 2020 2020 2020   ],.            
+0000d330: 7469 6d65 6f75 743d 4445 4641 554c 545f  timeout=DEFAULT_
+0000d340: 5449 4d45 4f55 542c 0a20 2020 2020 2020  TIMEOUT,.       
+0000d350: 2029 2020 2320 4950 7974 686f 6e20 3e3d   )  # IPython >=
+0000d360: 2035 202b 2072 6c69 7079 7468 6f6e 0a0a   5 + rlipython..
+0000d370: 2020 2020 6669 6e61 6c6c 793a 0a20 2020      finally:.   
+0000d380: 2020 2020 2063 6869 6c64 2e6c 6f67 6669       child.logfi
+0000d390: 6c65 5f72 6561 6420 3d20 6c6f 6766 696c  le_read = logfil
+0000d3a0: 655f 7265 6164 0a0a 0a64 6566 205f 636c  e_read...def _cl
+0000d3b0: 6561 6e5f 6261 636b 7370 6163 6528 6172  ean_backspace(ar
+0000d3c0: 6729 3a0a 2020 2020 2320 4861 6e64 6c65  g):.    # Handle
+0000d3d0: 2066 6f6f 3132 335c 625c 625c 6262 6172   foo123\b\b\bbar
+0000d3e0: 203d 3e20 666f 6f62 6172 0a20 2020 206c   => foobar.    l
+0000d3f0: 6566 7420 3d20 6222 220a 2020 2020 7269  eft = b"".    ri
+0000d400: 6768 7420 3d20 6172 670a 2020 2020 7768  ght = arg.    wh
+0000d410: 696c 6520 7269 6768 743a 0a20 2020 2020  ile right:.     
+0000d420: 2020 206d 203d 2072 652e 7365 6172 6368     m = re.search
+0000d430: 2862 225c 7830 382b 222c 2072 6967 6874  (b"\x08+", right
+0000d440: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+0000d450: 206d 3a0a 2020 2020 2020 2020 2020 2020   m:.            
+0000d460: 6272 6561 6b0a 2020 2020 2020 2020 6c65  break.        le
+0000d470: 6674 203d 206c 6566 7420 2b20 7269 6768  ft = left + righ
+0000d480: 745b 3a6d 2e73 7461 7274 2829 5d0a 2020  t[:m.start()].  
+0000d490: 2020 2020 2020 636f 756e 7420 3d20 6d2e        count = m.
+0000d4a0: 656e 6428 2920 2d20 6d2e 7374 6172 7428  end() - m.start(
+0000d4b0: 290a 2020 2020 2020 2020 6c65 6674 203d  ).        left =
+0000d4c0: 206c 6566 745b 3a2d 636f 756e 745d 0a20   left[:-count]. 
+0000d4d0: 2020 2020 2020 2072 6967 6874 203d 2072         right = r
+0000d4e0: 6967 6874 5b6d 2e65 6e64 2829 3a5d 0a20  ight[m.end():]. 
+0000d4f0: 2020 2061 7267 203d 206c 6566 7420 2b20     arg = left + 
+0000d500: 7269 6768 740a 2020 2020 2320 4861 6e64  right.    # Hand
+0000d510: 6c65 2066 6f6f 3132 335c 7831 625b 3344  le foo123\x1b[3D
+0000d520: 6261 7220 3d3e 2066 6f6f 6261 720a 2020  bar => foobar.  
+0000d530: 2020 6c65 6674 203d 2062 2222 0a20 2020    left = b"".   
+0000d540: 2072 6967 6874 203d 2061 7267 0a20 2020   right = arg.   
+0000d550: 2077 6869 6c65 2072 6967 6874 3a0a 2020   while right:.  
+0000d560: 2020 2020 2020 6d20 3d20 7265 2e73 6561        m = re.sea
+0000d570: 7263 6828 6272 225c 7831 625c 5b28 5b30  rch(br"\x1b\[([0
+0000d580: 2d39 5d2b 2944 222c 2072 6967 6874 290a  -9]+)D", right).
+0000d590: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
+0000d5a0: 3a0a 2020 2020 2020 2020 2020 2020 6272  :.            br
+0000d5b0: 6561 6b0a 2020 2020 2020 2020 6c65 6674  eak.        left
+0000d5c0: 203d 206c 6566 7420 2b20 7269 6768 745b   = left + right[
+0000d5d0: 3a6d 2e73 7461 7274 2829 5d0a 2020 2020  :m.start()].    
+0000d5e0: 2020 2020 636f 756e 7420 3d20 696e 7428      count = int(
+0000d5f0: 6d2e 6772 6f75 7028 3129 290a 2020 2020  m.group(1)).    
+0000d600: 2020 2020 7269 6768 7420 3d20 7269 6768      right = righ
+0000d610: 745b 6d2e 656e 6428 293a 5d0a 2020 2020  t[m.end():].    
+0000d620: 2020 2020 6966 205f 4950 5954 484f 4e5f      if _IPYTHON_
+0000d630: 5645 5253 494f 4e20 3c20 2837 2c29 2061  VERSION < (7,) a
+0000d640: 6e64 2072 6967 6874 2e73 7461 7274 7377  nd right.startsw
+0000d650: 6974 6828 6222 5b50 5946 4c59 4259 5d22  ith(b"[PYFLYBY]"
+0000d660: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
+0000d670: 2046 6f72 2070 7572 706f 7365 7320 6f66   For purposes of
+0000d680: 2063 6f6d 7061 7269 6e67 2049 5079 7468   comparing IPyth
+0000d690: 6f6e 206f 7574 7075 7420 696e 2070 726f  on output in pro
+0000d6a0: 6d70 745f 746f 6f6c 6b69 7420 6d6f 6465  mpt_toolkit mode
+0000d6b0: 2c0a 2020 2020 2020 2020 2020 2020 2320  ,.            # 
+0000d6c0: 696e 636c 7564 6520 7468 6520 7072 652d  include the pre-
+0000d6d0: 6261 636b 7370 6163 6520 7374 7566 6620  backspace stuff 
+0000d6e0: 6173 2061 2073 6570 6172 6174 6520 6c69  as a separate li
+0000d6f0: 6e65 2e20 2054 4f44 4f3a 2064 6f0a 2020  ne.  TODO: do.  
+0000d700: 2020 2020 2020 2020 2020 2320 7468 6973            # this
+0000d710: 2069 6e20 6120 6d6f 7265 206c 6573 7320   in a more less 
+0000d720: 6861 636b 7920 7761 792e 0a20 2020 2020  hacky way..     
+0000d730: 2020 2020 2020 206c 6566 7420 3d20 6c65         left = le
+0000d740: 6674 202b 2062 225c 6e22 0a20 2020 2020  ft + b"\n".     
+0000d750: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000d760: 2020 2020 206c 6566 7420 3d20 6c65 6674       left = left
+0000d770: 5b3a 2d63 6f75 6e74 5d0a 2020 2020 6172  [:-count].    ar
+0000d780: 6720 3d20 6c65 6674 202b 2072 6967 6874  g = left + right
+0000d790: 0a20 2020 2072 6574 7572 6e20 6172 670a  .    return arg.
+0000d7a0: 0a0a 0a64 6566 205f 636c 6561 6e5f 6970  ...def _clean_ip
+0000d7b0: 7974 686f 6e5f 6f75 7470 7574 2872 6573  ython_output(res
+0000d7c0: 756c 7429 3a0a 2020 2020 2222 2243 6c65  ult):.    """Cle
+0000d7d0: 616e 2075 7020 4950 7974 686f 6e20 6f75  an up IPython ou
+0000d7e0: 7470 7574 2e22 2222 0a20 2020 2072 6573  tput.""".    res
+0000d7f0: 756c 7430 203d 2072 6573 756c 740a 2020  ult0 = result.  
+0000d800: 2020 2320 4361 6e6f 6e69 6361 6c69 7a65    # Canonicalize
+0000d810: 206e 6577 6c69 6e65 732e 0a20 2020 2072   newlines..    r
+0000d820: 6573 756c 7420 3d20 7265 2e73 7562 2862  esult = re.sub(b
+0000d830: 225c 722b 5c6e 222c 2062 225c 6e22 2c20  "\r+\n", b"\n", 
+0000d840: 7265 7375 6c74 290a 2020 2020 2320 436c  result).    # Cl
+0000d850: 6561 6e20 7468 696e 6773 206c 696b 6520  ean things like 
+0000d860: 2220 2020 2045 5343 5b34 4422 2e0a 2020  "    ESC[4D"..  
+0000d870: 2020 7265 7375 6c74 203d 205f 636c 6561    result = _clea
+0000d880: 6e5f 6261 636b 7370 6163 6528 7265 7375  n_backspace(resu
+0000d890: 6c74 290a 2020 2020 2320 4d61 6b65 2074  lt).    # Make t
+0000d8a0: 7261 6365 6261 636b 206f 7574 7075 7420  raceback output 
+0000d8b0: 7374 6162 6c65 2061 6372 6f73 7320 4950  stable across IP
+0000d8c0: 7974 686f 6e20 7665 7273 696f 6e73 2061  ython versions a
+0000d8d0: 6e64 2072 756e 732e 0a20 2020 2072 6573  nd runs..    res
+0000d8e0: 756c 7420 3d20 7265 2e73 7562 2872 652e  ult = re.sub(re.
+0000d8f0: 636f 6d70 696c 6528 6272 2228 5e2f 2e2a  compile(br"(^/.*
+0000d900: 3f2f 293f 3c28 6970 7974 686f 6e2d 696e  ?/)?<(ipython-in
+0000d910: 7075 742d 5b30 2d39 5d2b 2d5b 302d 3961  put-[0-9]+-[0-9a
+0000d920: 2d66 5d2b 7c69 7079 7468 6f6e 2063 6f6e  -f]+|ipython con
+0000d930: 736f 6c65 293e 222c 2072 652e 4d29 2c20  sole)>", re.M), 
+0000d940: 6222 3c69 7079 7468 6f6e 2d69 6e70 7574  b"<ipython-input
+0000d950: 3e22 2c20 7265 7375 6c74 290a 2020 2020  >", result).    
+0000d960: 7265 7375 6c74 203d 2072 652e 7375 6228  result = re.sub(
+0000d970: 7265 2e63 6f6d 7069 6c65 2862 7222 5e2d  re.compile(br"^-
+0000d980: 2d2d 2d3e 202e 2a3f 5c6e 222c 2072 652e  ---> .*?\n", re.
+0000d990: 4d29 2c20 6222 222c 2072 6573 756c 7429  M), b"", result)
+0000d9a0: 0a20 2020 2023 2052 656d 6f76 6520 6372  .    # Remove cr
+0000d9b0: 7566 7420 7265 7375 6c74 696e 6720 6672  uft resulting fr
+0000d9c0: 6f6d 2066 6c61 6b69 6e65 7373 2069 6e20  om flakiness in 
+0000d9d0: 2769 7079 7468 6f6e 2063 6f6e 736f 6c65  'ipython console
+0000d9e0: 270a 2020 2020 6966 205f 4950 5954 484f  '.    if _IPYTHO
+0000d9f0: 4e5f 5645 5253 494f 4e20 3c20 2832 2c29  N_VERSION < (2,)
+0000da00: 3a0a 2020 2020 2020 2020 7265 7375 6c74  :.        result
+0000da10: 203d 2072 652e 7375 6228 7265 2e63 6f6d   = re.sub(re.com
+0000da20: 7069 6c65 2862 7222 4578 6365 7074 696f  pile(br"Exceptio
+0000da30: 6e20 696e 2074 6872 6561 6420 5468 7265  n in thread Thre
+0000da40: 6164 2d5b 302d 395d 2b20 5b28 5d6d 6f73  ad-[0-9]+ [(]mos
+0000da50: 7420 6c69 6b65 6c79 2072 6169 7365 6420  t likely raised 
+0000da60: 6475 7269 6e67 2069 6e74 6572 7072 6574  during interpret
+0000da70: 6572 2073 6875 7464 6f77 6e5b 295d 3a2e  er shutdown[)]:.
+0000da80: 2a22 2c20 7265 2e53 292c 2062 2222 2c20  *", re.S), b"", 
+0000da90: 7265 7375 6c74 290a 2020 2020 2320 5265  result).    # Re
+0000daa0: 6d6f 7665 2074 7261 696c 696e 6720 706f  move trailing po
+0000dab0: 7374 2d65 7869 7420 6d65 7373 6167 652e  st-exit message.
+0000dac0: 0a20 2020 2069 6620 5f49 5059 5448 4f4e  .    if _IPYTHON
+0000dad0: 5f56 4552 5349 4f4e 203e 3d20 2833 2c29  _VERSION >= (3,)
+0000dae0: 3a0a 2020 2020 2020 2020 7265 7375 6c74  :.        result
+0000daf0: 203d 2072 652e 7375 6228 6222 283f 3a53   = re.sub(b"(?:S
+0000db00: 6875 7474 696e 6720 646f 776e 206b 6572  hutting down ker
+0000db10: 6e65 6c7c 6b65 6570 696e 6720 6b65 726e  nel|keeping kern
+0000db20: 656c 2061 6c69 7665 295c 6e3f 2422 2c20  el alive)\n?$", 
+0000db30: 6222 222c 2072 6573 756c 7429 0a20 2020  b"", result).   
+0000db40: 2023 2057 6f72 6b20 6172 6f75 6e64 0a20   # Work around. 
+0000db50: 2020 2023 2068 7474 7073 3a2f 2f67 6974     # https://git
+0000db60: 6875 622e 636f 6d2f 7072 6f6d 7074 2d74  hub.com/prompt-t
+0000db70: 6f6f 6c6b 6974 2f70 7974 686f 6e2d 7072  oolkit/python-pr
+0000db80: 6f6d 7074 2d74 6f6f 6c6b 6974 2f69 7373  ompt-toolkit/iss
+0000db90: 7565 732f 3838 360a 2020 2020 7265 7375  ues/886.    resu
+0000dba0: 6c74 203d 2072 652e 7375 6228 6272 2245  lt = re.sub(br"E
+0000dbb0: 7863 6570 7469 6f6e 2069 6e20 6465 6661  xception in defa
+0000dbc0: 756c 7420 6578 6365 7074 696f 6e20 6861  ult exception ha
+0000dbd0: 6e64 6c65 722e 2a3f 4475 7269 6e67 2068  ndler.*?During h
+0000dbe0: 616e 646c 696e 6720 6f66 2074 6865 2061  andling of the a
+0000dbf0: 626f 7665 2065 7863 6570 7469 6f6e 2c20  bove exception, 
+0000dc00: 616e 6f74 6865 7220 6578 6365 7074 696f  another exceptio
+0000dc10: 6e20 6f63 6375 7272 6564 3a2e 2a3f 6173  n occurred:.*?as
+0000dc20: 7365 7274 2061 7070 5c2e 5f69 735f 7275  sert app\._is_ru
+0000dc30: 6e6e 696e 675c 6e41 7373 6572 7469 6f6e  nning\nAssertion
+0000dc40: 4572 726f 725c 6e22 2c20 6222 222c 2072  Error\n", b"", r
+0000dc50: 6573 756c 742c 2066 6c61 6773 3d72 652e  esult, flags=re.
+0000dc60: 444f 5441 4c4c 290a 2020 2020 2320 4350  DOTALL).    # CP
+0000dc70: 5220 7374 7566 6620 6672 6f6d 2070 726f  R stuff from pro
+0000dc80: 6d70 742d 746f 6f6c 6b69 7420 322e 300a  mpt-toolkit 2.0.
+0000dc90: 2020 2020 7265 7375 6c74 203d 2072 6573      result = res
+0000dca0: 756c 742e 7265 706c 6163 6528 6222 5741  ult.replace(b"WA
+0000dcb0: 524e 494e 473a 2079 6f75 7220 7465 726d  RNING: your term
+0000dcc0: 696e 616c 2064 6f65 736e 2774 2073 7570  inal doesn't sup
+0000dcd0: 706f 7274 2063 7572 736f 7220 706f 7369  port cursor posi
+0000dce0: 7469 6f6e 2072 6571 7565 7374 7320 2843  tion requests (C
+0000dcf0: 5052 292e 5c6e 222c 2062 2222 290a 2020  PR).\n", b"").  
+0000dd00: 2020 2320 5265 6d6f 7665 2074 7261 696c    # Remove trail
+0000dd10: 696e 6720 2249 6e20 5b4e 5d3a 222c 2069  ing "In [N]:", i
+0000dd20: 6620 616e 792e 0a20 2020 2072 6573 756c  f any..    resul
+0000dd30: 7420 3d20 7265 2e73 7562 2862 7222 2573  t = re.sub(br"%s
+0000dd40: 5c6e 3f24 2225 5f49 5059 5448 4f4e 5f50  \n?$"%_IPYTHON_P
+0000dd50: 524f 4d50 5431 2c20 6222 222c 2072 6573  ROMPT1, b"", res
+0000dd60: 756c 7429 0a20 2020 2023 2052 656d 6f76  ult).    # Remov
+0000dd70: 6520 7472 6169 6c69 6e67 2022 496e 205b  e trailing "In [
+0000dd80: 4e5d 3a20 6578 6974 2829 222e 0a20 2020  N]: exit()"..   
+0000dd90: 2072 6573 756c 7420 3d20 7265 2e73 7562   result = re.sub
+0000dda0: 2862 7222 2573 6578 6974 5b28 5d28 3f3a  (br"%sexit[(](?:
+0000ddb0: 6b65 6570 5f6b 6572 6e65 6c3d 5472 7565  keep_kernel=True
+0000ddc0: 293f 5b29 5d5c 6e3f 2422 255f 4950 5954  )?[)]\n?$"%_IPYT
+0000ddd0: 484f 4e5f 5052 4f4d 5054 312c 2062 2222  HON_PROMPT1, b""
+0000dde0: 2c20 7265 7375 6c74 290a 2020 2020 2320  , result).    # 
+0000ddf0: 436f 6d70 7265 7373 206e 6577 6c69 6e65  Compress newline
+0000de00: 732e 0a20 2020 2072 6573 756c 7420 3d20  s..    result = 
+0000de10: 7265 2e73 7562 2862 7222 5c6e 5c6e 2b22  re.sub(br"\n\n+"
+0000de20: 2c20 6222 5c6e 222c 2072 6573 756c 7429  , b"\n", result)
+0000de30: 0a20 2020 2023 2052 656d 6f76 6520 7874  .    # Remove xt
+0000de40: 6572 6d20 7469 746c 6520 7365 7474 696e  erm title settin
+0000de50: 672e 0a20 2020 2072 6573 756c 7420 3d20  g..    result = 
+0000de60: 7265 2e73 7562 2862 225c 7831 625d 303b  re.sub(b"\x1b]0;
+0000de70: 5b5e 5c78 3162 5c78 3037 5d2a 5c78 3037  [^\x1b\x07]*\x07
+0000de80: 222c 2062 2222 2c20 7265 7375 6c74 290a  ", b"", result).
+0000de90: 2020 2020 2320 5265 6d6f 7665 2042 454c      # Remove BEL
+0000dea0: 7320 2864 6f6e 6520 6166 7465 7220 7468  s (done after th
+0000deb0: 6520 6162 6f76 6520 636f 6465 732c 2077  e above codes, w
+0000dec0: 6869 6368 2075 7365 205c 7830 3720 6173  hich use \x07 as
+0000ded0: 2061 2064 656c 696d 6974 6572 290a 2020   a delimiter).  
+0000dee0: 2020 7265 7375 6c74 203d 2072 6573 756c    result = resul
+0000def0: 742e 7265 706c 6163 6528 6222 5c78 3037  t.replace(b"\x07
+0000df00: 222c 2062 2222 290a 2020 2020 2320 5265  ", b"").    # Re
+0000df10: 6d6f 7665 2063 6f64 6520 746f 2063 6c65  move code to cle
+0000df20: 6172 2074 6f20 656e 6420 6f66 206c 696e  ar to end of lin
+0000df30: 652e 2054 6869 7320 6973 2064 6f6e 6520  e. This is done 
+0000df40: 6865 7265 2069 6e73 7465 6164 206f 6620  here instead of 
+0000df50: 696e 0a20 2020 2023 2064 6563 6f64 6528  in.    # decode(
+0000df60: 2920 6265 6361 7573 6520 5f77 6169 745f  ) because _wait_
+0000df70: 6e6f 6e63 6520 6c6f 6f6b 7320 666f 7220  nonce looks for 
+0000df80: 7468 6973 2063 6f64 652e 0a20 2020 2072  this code..    r
+0000df90: 6573 756c 7420 3d20 7265 7375 6c74 2e72  esult = result.r
+0000dfa0: 6570 6c61 6365 2862 225c 7831 625b 4b22  eplace(b"\x1b[K"
+0000dfb0: 2c20 6222 2229 0a20 2020 2072 6573 756c  , b"").    resul
+0000dfc0: 7420 3d20 7265 7375 6c74 2e6c 7374 7269  t = result.lstri
+0000dfd0: 7028 290a 2020 2020 6966 205f 4950 5954  p().    if _IPYT
+0000dfe0: 484f 4e5f 5645 5253 494f 4e20 3e3d 2028  HON_VERSION >= (
+0000dff0: 352c 293a 2020 2320 616e 6420 5f49 5059  5,):  # and _IPY
+0000e000: 5448 4f4e 5f56 4552 5349 4f4e 203c 3d20  THON_VERSION <= 
+0000e010: 2838 2c29 3a0a 2020 2020 2020 2020 2320  (8,):.        # 
+0000e020: 496e 2049 5079 7468 6f6e 2035 206b 6572  In IPython 5 ker
+0000e030: 6e65 6c2f 636f 6e73 6f6c 652f 6574 632c  nel/console/etc,
+0000e040: 2069 7420 7365 656d 7320 746f 2062 6520   it seems to be 
+0000e050: 696d 706f 7373 6962 6c65 2074 6f20 7475  impossible to tu
+0000e060: 726e 0a20 2020 2020 2020 2023 206f 6666  rn.        # off
+0000e070: 2074 6865 2062 616e 6e65 722e 2020 466f   the banner.  Fo
+0000e080: 7220 6e6f 7720 6a75 7374 2064 656c 6574  r now just delet
+0000e090: 6520 7468 6520 6f75 7470 7574 2075 7020  e the output up 
+0000e0a0: 746f 2074 6865 2066 6972 7374 0a20 2020  to the first.   
+0000e0b0: 2020 2020 2023 2070 726f 6d70 742e 0a20       # prompt.. 
+0000e0c0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+0000e0d0: 7265 2e73 7562 2862 7222 2e2a 3f28 496e  re.sub(br".*?(In
+0000e0e0: 205c 5b31 5c5d 3a29 222c 2062 7222 5c31   \[1\]:)", br"\1
+0000e0f0: 222c 2072 6573 756c 742c 2066 6c61 6773  ", result, flags
+0000e100: 3d72 652e 5329 0a20 2020 2069 6620 4445  =re.S).    if DE
+0000e110: 4255 473a 0a20 2020 2020 2020 2070 7269  BUG:.        pri
+0000e120: 6e74 2822 5f63 6c65 616e 5f69 7079 7468  nt("_clean_ipyth
+0000e130: 6f6e 5f6f 7574 7075 7428 293a 2025 7220  on_output(): %r 
+0000e140: 3d3e 2025 7222 2025 2028 7265 7375 6c74  => %r" % (result
+0000e150: 302c 2072 6573 756c 742c 2929 0a20 2020  0, result,)).   
+0000e160: 2072 6574 7572 6e20 7265 7375 6c74 0a0a   return result..
+0000e170: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
+0000e180: 5f69 7079 7468 6f6e 5f31 2866 726f 6e74  _ipython_1(front
+0000e190: 656e 6429 3a0a 2020 2020 2320 5465 7374  end):.    # Test
+0000e1a0: 2074 6861 7420 7765 2063 616e 2072 756e   that we can run
+0000e1b0: 2069 7079 7468 6f6e 2061 6e64 2067 6574   ipython and get
+0000e1c0: 2072 6573 756c 7473 2062 6163 6b2e 0a20   results back.. 
+0000e1d0: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
+0000e1e0: 2020 2020 2020 2049 6e20 5b31 5d3a 2070         In [1]: p
+0000e1f0: 7269 6e74 2836 2a37 290a 2020 2020 2020  rint(6*7).      
+0000e200: 2020 3432 0a20 2020 2020 2020 2049 6e20    42.        In 
+0000e210: 5b32 5d3a 2036 2a39 0a20 2020 2020 2020  [2]: 6*9.       
+0000e220: 204f 7574 5b32 5d3a 2035 340a 2020 2020   Out[2]: 54.    
+0000e230: 2222 222c 2066 726f 6e74 656e 643d 6672  """, frontend=fr
+0000e240: 6f6e 7465 6e64 290a 0a0a 4072 6574 7279  ontend)...@retry
+0000e250: 0a64 6566 2074 6573 745f 6970 7974 686f  .def test_ipytho
+0000e260: 6e5f 6173 7365 7274 5f66 6169 6c5f 3128  n_assert_fail_1(
+0000e270: 6672 6f6e 7465 6e64 293a 0a20 2020 2077  frontend):.    w
+0000e280: 6974 6820 6173 7365 7274 5f66 6169 6c28  ith assert_fail(
+0000e290: 293a 0a20 2020 2020 2020 2069 7079 7468  ):.        ipyth
+0000e2a0: 6f6e 2822 2222 0a20 2020 2020 2020 2020  on(""".         
+0000e2b0: 2020 2049 6e20 5b31 5d3a 2070 7269 6e74     In [1]: print
+0000e2c0: 2836 2a37 290a 2020 2020 2020 2020 2020  (6*7).          
+0000e2d0: 2020 3432 0a20 2020 2020 2020 2020 2020    42.           
+0000e2e0: 2049 6e20 5b32 5d3a 2036 2a39 0a20 2020   In [2]: 6*9.   
+0000e2f0: 2020 2020 2020 2020 204f 7574 5b32 5d3a           Out[2]:
+0000e300: 2035 330a 2020 2020 2020 2020 2222 222c   53.        """,
+0000e310: 2066 726f 6e74 656e 643d 6672 6f6e 7465   frontend=fronte
+0000e320: 6e64 290a 0a0a 4072 6574 7279 0a64 6566  nd)...@retry.def
+0000e330: 2074 6573 745f 6970 7974 686f 6e5f 696e   test_ipython_in
+0000e340: 6465 6e74 6564 5f62 6c6f 636b 5f34 7370  dented_block_4sp
+0000e350: 6163 6573 5f31 2866 726f 6e74 656e 6429  aces_1(frontend)
+0000e360: 3a0a 2020 2020 2320 5465 7374 2074 6861  :.    # Test tha
+0000e370: 7420 696e 6465 6e74 6564 2062 6c6f 636b  t indented block
+0000e380: 7320 776f 726b 2076 7320 4950 7974 686f  s work vs IPytho
+0000e390: 6e27 7320 6175 746f 696e 6465 6e74 2e0a  n's autoindent..
+0000e3a0: 2020 2020 2320 3420 7370 6163 6573 2069      # 4 spaces i
+0000e3b0: 7320 7468 6520 4950 7974 686f 6e20 6465  s the IPython de
+0000e3c0: 6661 756c 7420 6175 746f 696e 6465 6e74  fault autoindent
+0000e3d0: 2e0a 2020 2020 6970 7974 686f 6e28 2222  ..    ipython(""
+0000e3e0: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
+0000e3f0: 3a20 6966 2031 3a0a 2020 2020 2020 2020  : if 1:.        
+0000e400: 2020 202e 2e2e 3a20 2020 2020 7072 696e     ...:     prin
+0000e410: 7428 362a 3729 0a20 2020 2020 2020 2020  t(6*7).         
+0000e420: 2020 2e2e 2e3a 2020 2020 2070 7269 6e74    ...:     print
+0000e430: 2836 2a39 290a 2020 2020 2020 2020 2020  (6*9).          
+0000e440: 202e 2e2e 3a0a 2020 2020 2020 2020 3432   ...:.        42
+0000e450: 0a20 2020 2020 2020 2035 340a 2020 2020  .        54.    
+0000e460: 2020 2020 496e 205b 325d 3a20 362a 380a      In [2]: 6*8.
+0000e470: 2020 2020 2020 2020 4f75 745b 325d 3a20          Out[2]: 
+0000e480: 3438 0a20 2020 2022 2222 2c20 6672 6f6e  48.    """, fron
+0000e490: 7465 6e64 3d66 726f 6e74 656e 6429 0a0a  tend=frontend)..
+0000e4a0: 0a0a 4072 6574 7279 0a64 6566 2074 6573  ..@retry.def tes
+0000e4b0: 745f 6970 7974 686f 6e5f 696e 6465 6e74  t_ipython_indent
+0000e4c0: 6564 5f62 6c6f 636b 5f35 7370 6163 6573  ed_block_5spaces
+0000e4d0: 5f31 2866 726f 6e74 656e 6429 3a0a 2020  _1(frontend):.  
+0000e4e0: 2020 2320 5465 7374 2074 6861 7420 696e    # Test that in
+0000e4f0: 6465 6e74 6564 2062 6c6f 636b 7320 776f  dented blocks wo
+0000e500: 726b 2076 7320 4950 7974 686f 6e27 7320  rk vs IPython's 
+0000e510: 6175 746f 696e 6465 6e74 2e0a 2020 2020  autoindent..    
+0000e520: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
+0000e530: 2020 2020 496e 205b 315d 3a20 6966 2031      In [1]: if 1
+0000e540: 3a0a 2020 2020 2020 2020 2020 202e 2e2e  :.           ...
+0000e550: 3a20 2020 2020 2020 2020 7072 696e 7428  :         print(
+0000e560: 362a 3729 0a20 2020 2020 2020 2020 2020  6*7).           
+0000e570: 2e2e 2e3a 2020 2020 2020 2020 2070 7269  ...:         pri
+0000e580: 6e74 2836 2a39 290a 2020 2020 2020 2020  nt(6*9).        
+0000e590: 2020 202e 2e2e 3a0a 2020 2020 2020 2020     ...:.        
+0000e5a0: 3432 0a20 2020 2020 2020 2035 340a 2020  42.        54.  
+0000e5b0: 2020 2020 2020 496e 205b 325d 3a20 362a        In [2]: 6*
+0000e5c0: 380a 2020 2020 2020 2020 4f75 745b 325d  8.        Out[2]
+0000e5d0: 3a20 3438 0a20 2020 2020 2020 2022 2222  : 48.        """
+0000e5e0: 2c20 6672 6f6e 7465 6e64 3d66 726f 6e74  , frontend=front
+0000e5f0: 656e 6429 0a0a 0a40 7265 7472 790a 6465  end)...@retry.de
+0000e600: 6620 7465 7374 5f69 7079 7468 6f6e 5f69  f test_ipython_i
+0000e610: 6e64 656e 7465 645f 626c 6f63 6b5f 3673  ndented_block_6s
+0000e620: 7061 6365 735f 3128 6672 6f6e 7465 6e64  paces_1(frontend
+0000e630: 293a 0a20 2020 2023 2054 6573 7420 7468  ):.    # Test th
+0000e640: 6174 2069 6e64 656e 7465 6420 626c 6f63  at indented bloc
+0000e650: 6b73 2077 6f72 6b20 7673 2049 5079 7468  ks work vs IPyth
+0000e660: 6f6e 2773 2061 7574 6f69 6e64 656e 742e  on's autoindent.
+0000e670: 0a20 2020 2069 7079 7468 6f6e 2822 2222  .    ipython("""
+0000e680: 0a20 2020 2020 2020 2049 6e20 5b31 5d3a  .        In [1]:
+0000e690: 2069 6620 313a 0a20 2020 2020 2020 2020   if 1:.         
+0000e6a0: 2020 2e2e 2e3a 2020 2020 2020 2070 7269    ...:       pri
+0000e6b0: 6e74 2836 2a37 290a 2020 2020 2020 2020  nt(6*7).        
+0000e6c0: 2020 202e 2e2e 3a20 2020 2020 2020 7072     ...:       pr
+0000e6d0: 696e 7428 362a 3929 0a20 2020 2020 2020  int(6*9).       
+0000e6e0: 2020 2020 2e2e 2e3a 0a20 2020 2020 2020      ...:.       
+0000e6f0: 2034 320a 2020 2020 2020 2020 3534 0a20   42.        54. 
+0000e700: 2020 2020 2020 2049 6e20 5b32 5d3a 2036         In [2]: 6
+0000e710: 2a38 0a20 2020 2020 2020 204f 7574 5b32  *8.        Out[2
+0000e720: 5d3a 2034 380a 2020 2020 2222 222c 2066  ]: 48.    """, f
+0000e730: 726f 6e74 656e 643d 6672 6f6e 7465 6e64  rontend=frontend
+0000e740: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
+0000e750: 6573 745f 6970 7974 686f 6e5f 696e 6465  est_ipython_inde
+0000e760: 6e74 6564 5f62 6c6f 636b 5f33 7370 6163  nted_block_3spac
+0000e770: 6573 5f31 2866 726f 6e74 656e 6429 3a0a  es_1(frontend):.
+0000e780: 2020 2020 2320 5465 7374 2074 6861 7420      # Test that 
+0000e790: 696e 6465 6e74 6564 2062 6c6f 636b 7320  indented blocks 
+0000e7a0: 776f 726b 2076 7320 4950 7974 686f 6e27  work vs IPython'
+0000e7b0: 7320 6175 746f 696e 6465 6e74 2e0a 2020  s autoindent..  
+0000e7c0: 2020 2320 5573 696e 6720 5e55 2070 6c75    # Using ^U plu
+0000e7d0: 7320 3320 7370 6163 6573 2063 6175 7365  s 3 spaces cause
+0000e7e0: 7320 4950 7974 686f 6e20 746f 206f 7574  s IPython to out
+0000e7f0: 7075 7420 2220 2020 205c 7830 3822 2e0a  put "    \x08"..
+0000e800: 2020 2020 6970 7974 686f 6e28 2222 220a      ipython(""".
+0000e810: 2020 2020 2020 2020 496e 205b 315d 3a20          In [1]: 
+0000e820: 6966 2031 3a0a 2020 2020 2020 2020 2020  if 1:.          
+0000e830: 202e 2e2e 3a20 2020 2070 7269 6e74 2836   ...:    print(6
+0000e840: 2a37 290a 2020 2020 2020 2020 2020 202e  *7).           .
+0000e850: 2e2e 3a20 2020 2070 7269 6e74 2836 2a39  ..:    print(6*9
+0000e860: 290a 2020 2020 2020 2020 2020 202e 2e2e  ).           ...
+0000e870: 3a0a 2020 2020 2020 2020 3432 0a20 2020  :.        42.   
+0000e880: 2020 2020 2035 340a 2020 2020 2020 2020       54.        
+0000e890: 496e 205b 325d 3a20 362a 380a 2020 2020  In [2]: 6*8.    
+0000e8a0: 2020 2020 4f75 745b 325d 3a20 3438 0a20      Out[2]: 48. 
+0000e8b0: 2020 2022 2222 2c20 6672 6f6e 7465 6e64     """, frontend
+0000e8c0: 3d66 726f 6e74 656e 6429 0a0a 0a40 7265  =frontend)...@re
+0000e8d0: 7472 790a 6465 6620 7465 7374 5f69 7079  try.def test_ipy
+0000e8e0: 7468 6f6e 5f69 6e64 656e 7465 645f 626c  thon_indented_bl
+0000e8f0: 6f63 6b5f 3273 7061 6365 735f 3128 6672  ock_2spaces_1(fr
+0000e900: 6f6e 7465 6e64 293a 0a20 2020 2023 2054  ontend):.    # T
+0000e910: 6573 7420 7468 6174 2069 6e64 656e 7465  est that indente
+0000e920: 6420 626c 6f63 6b73 2077 6f72 6b20 7673  d blocks work vs
+0000e930: 2049 5079 7468 6f6e 2773 2061 7574 6f69   IPython's autoi
+0000e940: 6e64 656e 742e 0a20 2020 2023 2055 7369  ndent..    # Usi
+0000e950: 6e67 205e 5520 706c 7573 2032 2073 7061  ng ^U plus 2 spa
+0000e960: 6365 7320 6361 7573 6573 2049 5079 7468  ces causes IPyth
+0000e970: 6f6e 2035 2074 6f20 6f75 7470 7574 2022  on 5 to output "
+0000e980: 2020 2020 5c78 3162 5b32 4420 205c 7831      \x1b[2D  \x1
+0000e990: 625b 3244 222e 0a20 2020 2069 7079 7468  b[2D"..    ipyth
+0000e9a0: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
+0000e9b0: 6e20 5b31 5d3a 2069 6620 313a 0a20 2020  n [1]: if 1:.   
+0000e9c0: 2020 2020 2020 2020 2e2e 2e3a 2020 2070          ...:   p
+0000e9d0: 7269 6e74 2836 2a37 290a 2020 2020 2020  rint(6*7).      
+0000e9e0: 2020 2020 202e 2e2e 3a20 2020 7072 696e       ...:   prin
+0000e9f0: 7428 362a 3929 0a20 2020 2020 2020 2020  t(6*9).         
+0000ea00: 2020 2e2e 2e3a 0a20 2020 2020 2020 2034    ...:.        4
+0000ea10: 320a 2020 2020 2020 2020 3534 0a20 2020  2.        54.   
+0000ea20: 2020 2020 2049 6e20 5b32 5d3a 2036 2a38       In [2]: 6*8
+0000ea30: 0a20 2020 2020 2020 204f 7574 5b32 5d3a  .        Out[2]:
+0000ea40: 2034 380a 2020 2020 2222 222c 2066 726f   48.    """, fro
+0000ea50: 6e74 656e 643d 6672 6f6e 7465 6e64 290a  ntend=frontend).
+0000ea60: 0a0a 4072 6574 7279 0a64 6566 2074 6573  ..@retry.def tes
+0000ea70: 745f 6970 7974 686f 6e5f 7461 625f 3128  t_ipython_tab_1(
+0000ea80: 6672 6f6e 7465 6e64 293a 0a20 2020 2023  frontend):.    #
+0000ea90: 2054 6573 7420 7468 6174 206f 7572 2074   Test that our t
+0000eaa0: 6573 7420 6861 726e 6573 7320 776f 726b  est harness work
+0000eab0: 7320 666f 7220 7461 6273 2e0a 2020 2020  s for tabs..    
+0000eac0: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
+0000ead0: 2020 2020 496e 205b 315d 3a20 696d 706f      In [1]: impo
+0000eae0: 7274 206f 730a 2020 2020 2020 2020 496e  rt os.        In
+0000eaf0: 205b 325d 3a20 6f73 2e4f 5f41 5050 5c74   [2]: os.O_APP\t
+0000eb00: 454e 442e 5f5f 636c 6173 735f 5f0a 2020  END.__class__.  
+0000eb10: 2020 2020 2020 4f75 745b 325d 3a20 696e        Out[2]: in
+0000eb20: 740a 2020 2020 2222 222c 2066 726f 6e74  t.    """, front
+0000eb30: 656e 643d 6672 6f6e 7465 6e64 290a 0a40  end=frontend)..@
+0000eb40: 7265 7472 790a 6465 6620 7465 7374 5f69  retry.def test_i
+0000eb50: 7079 7468 6f6e 5f74 6162 5f66 6169 6c5f  python_tab_fail_
+0000eb60: 3128 6672 6f6e 7465 6e64 293a 0a20 2020  1(frontend):.   
+0000eb70: 2023 2054 6573 7420 7468 6174 206f 7572   # Test that our
+0000eb80: 2074 6573 7420 6861 726e 6573 7320 776f   test harness wo
+0000eb90: 726b 7320 666f 7220 7461 6220 7768 656e  rks for tab when
+0000eba0: 2069 7420 7368 6f75 6c64 206d 6174 6368   it should match
+0000ebb0: 206e 6f74 6869 6e67 2e0a 2020 2020 6970   nothing..    ip
+0000ebc0: 7974 686f 6e28 0a20 2020 2020 2020 2022  ython(.        "
+0000ebd0: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
+0000ebe0: 5d3a 2069 6d70 6f72 7420 6f73 0a20 2020  ]: import os.   
+0000ebf0: 2020 2020 2049 6e20 5b32 5d3a 206f 732e       In [2]: os.
+0000ec00: 666f 6f32 3738 3137 3739 365c 7428 290a  foo27817796\t().
+0000ec10: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0000ec20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000ec30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000ec40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000ec50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000ec60: 2d2d 2d0a 2020 2020 2020 2020 4174 7472  ---.        Attr
+0000ec70: 6962 7574 6545 7272 6f72 2020 2020 2020  ibuteError      
+0000ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec90: 2020 2020 2020 5472 6163 6562 6163 6b20        Traceback 
+0000eca0: 286d 6f73 7420 7265 6365 6e74 2063 616c  (most recent cal
+0000ecb0: 6c20 6c61 7374 290a 2020 2020 2020 2020  l last).        
+0000ecc0: 2e2e 2e20 696e 202e 2e2e 0a20 2020 2020  ... in ....     
+0000ecd0: 2020 2041 7474 7269 6275 7465 4572 726f     AttributeErro
+0000ece0: 723a 206d 6f64 756c 6520 276f 7327 2068  r: module 'os' h
+0000ecf0: 6173 206e 6f20 6174 7472 6962 7574 6520  as no attribute 
+0000ed00: 2766 6f6f 3237 3831 3737 3936 270a 2020  'foo27817796'.  
+0000ed10: 2020 2222 222c 0a20 2020 2020 2020 2066    """,.        f
+0000ed20: 726f 6e74 656e 643d 6672 6f6e 7465 6e64  rontend=frontend
+0000ed30: 2c0a 2020 2020 290a 0a0a 4072 6574 7279  ,.    )...@retry
+0000ed40: 0a64 6566 2074 6573 745f 6970 7974 686f  .def test_ipytho
+0000ed50: 6e5f 7461 625f 6d75 6c74 695f 3128 6672  n_tab_multi_1(fr
+0000ed60: 6f6e 7465 6e64 293a 0a20 2020 2023 2054  ontend):.    # T
+0000ed70: 6573 7420 7468 6174 206f 7572 2074 6573  est that our tes
+0000ed80: 7420 6861 726e 6573 7320 776f 726b 7320  t harness works 
+0000ed90: 666f 7220 7461 6220 7768 656e 2074 6865  for tab when the
+0000eda0: 7265 2061 7265 206d 756c 7469 706c 6520  re are multiple 
+0000edb0: 6d61 7463 6865 730a 2020 2020 2320 666f  matches.    # fo
+0000edc0: 7220 7461 6220 636f 6d70 6c65 7469 6f6e  r tab completion
+0000edd0: 2e0a 2020 2020 6966 2066 726f 6e74 656e  ..    if fronten
+0000ede0: 6420 3d3d 2022 7072 6f6d 7074 5f74 6f6f  d == "prompt_too
+0000edf0: 6c6b 6974 223a 2070 7974 6573 742e 736b  lkit": pytest.sk
+0000ee00: 6970 2829 0a20 2020 2023 2043 7572 7265  ip().    # Curre
+0000ee10: 6e74 6c79 206f 7572 2074 6573 7420 6861  ntly our test ha
+0000ee20: 726e 6573 7320 6973 206f 6e6c 7920 6162  rness is only ab
+0000ee30: 6c65 2074 6f20 7465 7374 2074 6869 7320  le to test this 
+0000ee40: 7573 696e 6720 726c 6970 7974 686f 6e2e  using rlipython.
+0000ee50: 0a20 2020 2069 7079 7468 6f6e 2822 2222  .    ipython("""
+0000ee60: 0a20 2020 2020 2020 2049 6e20 5b31 5d3a  .        In [1]:
+0000ee70: 2064 6566 2066 6f6f 2829 3a20 7061 7373   def foo(): pass
+0000ee80: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
+0000ee90: 2066 6f6f 2e78 797a 3120 3d20 3131 310a   foo.xyz1 = 111.
+0000eea0: 2020 2020 2020 2020 496e 205b 335d 3a20          In [3]: 
+0000eeb0: 666f 6f2e 7879 7a32 203d 2032 3232 0a20  foo.xyz2 = 222. 
+0000eec0: 2020 2020 2020 2049 6e20 5b34 5d3a 2066         In [4]: f
+0000eed0: 6f6f 2e78 795c 740a 2020 2020 2020 2020  oo.xy\t.        
+0000eee0: 666f 6f2e 7879 7a31 2020 666f 6f2e 7879  foo.xyz1  foo.xy
+0000eef0: 7a32 0a20 2020 2020 2020 2049 6e20 5b34  z2.        In [4
+0000ef00: 5d3a 2066 6f6f 2e78 797a 5c78 3036 320a  ]: foo.xyz\x062.
+0000ef10: 2020 2020 2020 2020 4f75 745b 345d 3a20          Out[4]: 
+0000ef20: 3232 320a 2020 2020 2222 222c 2066 726f  222.    """, fro
+0000ef30: 6e74 656e 643d 6672 6f6e 7465 6e64 290a  ntend=frontend).
+0000ef40: 0a0a 4072 6574 7279 0a64 6566 2074 6573  ..@retry.def tes
+0000ef50: 745f 7079 666c 7962 795f 6669 6c65 5f31  t_pyflyby_file_1
+0000ef60: 2829 3a0a 2020 2020 2320 5665 7269 6679  ():.    # Verify
+0000ef70: 2074 6861 7420 6f75 7220 7465 7374 2073   that our test s
+0000ef80: 6574 7570 2069 7320 6765 7474 696e 6720  etup is getting 
+0000ef90: 7468 6520 7269 6768 7420 7079 666c 7962  the right pyflyb
+0000efa0: 792e 0a20 2020 2066 203d 206f 732e 7061  y..    f = os.pa
+0000efb0: 7468 2e72 6561 6c70 6174 6828 7079 666c  th.realpath(pyfl
+0000efc0: 7962 792e 5f5f 6669 6c65 5f5f 2e72 6570  yby.__file__.rep
+0000efd0: 6c61 6365 2822 2e70 7963 222c 2022 2e70  lace(".pyc", ".p
+0000efe0: 7922 2929 0a20 2020 2069 7079 7468 6f6e  y")).    ipython
+0000eff0: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
+0000f000: 5b31 5d3a 2069 6d70 6f72 7420 6f73 2c20  [1]: import os, 
+0000f010: 7079 666c 7962 790a 2020 2020 2020 2020  pyflyby.        
+0000f020: 496e 205b 325d 3a20 7072 696e 7428 6f73  In [2]: print(os
+0000f030: 2e70 6174 682e 7265 616c 7061 7468 2870  .path.realpath(p
+0000f040: 7966 6c79 6279 2e5f 5f66 696c 655f 5f2e  yflyby.__file__.
+0000f050: 7265 706c 6163 6528 222e 7079 6322 2c20  replace(".pyc", 
+0000f060: 222e 7079 2229 2929 0a20 2020 2020 2020  ".py"))).       
+0000f070: 207b 667d 0a20 2020 2022 2222 2e66 6f72   {f}.    """.for
+0000f080: 6d61 7428 663d 6629 290a 0a0a 4072 6574  mat(f=f))...@ret
+0000f090: 7279 0a64 6566 2074 6573 745f 7079 666c  ry.def test_pyfl
+0000f0a0: 7962 795f 7665 7273 696f 6e5f 3128 293a  yby_version_1():
+0000f0b0: 0a20 2020 2023 2056 6572 6966 7920 7468  .    # Verify th
+0000f0c0: 6174 206f 7572 2074 6573 7420 7365 7475  at our test setu
+0000f0d0: 7020 6973 2067 6574 7469 6e67 2074 6865  p is getting the
+0000f0e0: 2072 6967 6874 2070 7966 6c79 6279 2e0a   right pyflyby..
+0000f0f0: 2020 2020 6970 7974 686f 6e28 2222 220a      ipython(""".
+0000f100: 2020 2020 2020 2020 496e 205b 315d 3a20          In [1]: 
+0000f110: 696d 706f 7274 2070 7966 6c79 6279 0a20  import pyflyby. 
+0000f120: 2020 2020 2020 2049 6e20 5b32 5d3a 2070         In [2]: p
+0000f130: 7269 6e74 2870 7966 6c79 6279 2e5f 5f76  rint(pyflyby.__v
+0000f140: 6572 7369 6f6e 5f5f 290a 2020 2020 2020  ersion__).      
+0000f150: 2020 7b70 7966 6c79 6279 2e5f 5f76 6572    {pyflyby.__ver
+0000f160: 7369 6f6e 5f5f 7d0a 2020 2020 2222 222e  sion__}.    """.
+0000f170: 666f 726d 6174 2870 7966 6c79 6279 3d70  format(pyflyby=p
+0000f180: 7966 6c79 6279 2929 0a0a 0a40 7265 7472  yflyby))...@retr
+0000f190: 790a 6465 6620 7465 7374 5f69 7079 7468  y.def test_ipyth
+0000f1a0: 6f6e 5f66 696c 655f 3128 293a 0a20 2020  on_file_1():.   
+0000f1b0: 2023 2056 6572 6966 7920 7468 6174 206f   # Verify that o
+0000f1c0: 7572 2074 6573 7420 7365 7475 7020 6973  ur test setup is
+0000f1d0: 2067 6574 7469 6e67 2074 6865 2072 6967   getting the rig
+0000f1e0: 6874 2049 5079 7468 6f6e 2e0a 2020 2020  ht IPython..    
+0000f1f0: 6620 3d20 6f73 2e70 6174 682e 7265 616c  f = os.path.real
+0000f200: 7061 7468 2849 5079 7468 6f6e 2e5f 5f66  path(IPython.__f
+0000f210: 696c 655f 5f29 0a20 2020 2069 7079 7468  ile__).    ipyth
+0000f220: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
+0000f230: 6e20 5b31 5d3a 2069 6d70 6f72 7420 4950  n [1]: import IP
+0000f240: 7974 686f 6e2c 206f 730a 2020 2020 2020  ython, os.      
+0000f250: 2020 496e 205b 325d 3a20 7072 696e 7428    In [2]: print(
+0000f260: 6f73 2e70 6174 682e 7265 616c 7061 7468  os.path.realpath
+0000f270: 2849 5079 7468 6f6e 2e5f 5f66 696c 655f  (IPython.__file_
+0000f280: 5f29 290a 2020 2020 2020 2020 7b66 7d0a  _)).        {f}.
+0000f290: 2020 2020 2222 222e 666f 726d 6174 2866      """.format(f
+0000f2a0: 3d66 2929 0a0a 0a40 7265 7472 790a 6465  =f))...@retry.de
+0000f2b0: 6620 7465 7374 5f69 7079 7468 6f6e 5f76  f test_ipython_v
+0000f2c0: 6572 7369 6f6e 5f31 2829 3a0a 2020 2020  ersion_1():.    
+0000f2d0: 2320 5665 7269 6679 2074 6861 7420 6f75  # Verify that ou
+0000f2e0: 7220 7465 7374 2073 6574 7570 2069 7320  r test setup is 
+0000f2f0: 6765 7474 696e 6720 7468 6520 7269 6768  getting the righ
+0000f300: 7420 4950 7974 686f 6e2e 0a20 2020 2069  t IPython..    i
+0000f310: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
+0000f320: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
+0000f330: 7420 4950 7974 686f 6e0a 2020 2020 2020  t IPython.      
+0000f340: 2020 496e 205b 325d 3a20 7072 696e 7428    In [2]: print(
+0000f350: 4950 7974 686f 6e2e 5f5f 7665 7273 696f  IPython.__versio
+0000f360: 6e5f 5f29 0a20 2020 2020 2020 207b 4950  n__).        {IP
+0000f370: 7974 686f 6e2e 5f5f 7665 7273 696f 6e5f  ython.__version_
+0000f380: 5f7d 0a20 2020 2022 2222 2e66 6f72 6d61  _}.    """.forma
+0000f390: 7428 4950 7974 686f 6e3d 4950 7974 686f  t(IPython=IPytho
+0000f3a0: 6e29 290a 0a0a 4072 6574 7279 0a64 6566  n))...@retry.def
+0000f3b0: 2074 6573 745f 6175 746f 696d 706f 7274   test_autoimport
+0000f3c0: 5f31 2829 3a0a 2020 2020 6970 7974 686f  _1():.    ipytho
+0000f3d0: 6e28 2222 220a 2020 2020 2020 2020 496e  n(""".        In
+0000f3e0: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
+0000f3f0: 6c79 6279 3b20 7079 666c 7962 792e 656e  lyby; pyflyby.en
+0000f400: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
+0000f410: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
+0000f420: 5b32 5d3a 2062 2740 272b 6236 3464 6563  [2]: b'@'+b64dec
+0000f430: 6f64 6528 2753 4756 7362 4738 3d27 292b  ode('SGVsbG8=')+
+0000f440: 6227 4027 0a20 2020 2020 2020 205b 5059  b'@'.        [PY
+0000f450: 464c 5942 595d 2066 726f 6d20 6261 7365  FLYBY] from base
+0000f460: 3634 2069 6d70 6f72 7420 6236 3464 6563  64 import b64dec
+0000f470: 6f64 650a 2020 2020 2020 2020 4f75 745b  ode.        Out[
+0000f480: 325d 3a20 6227 4048 656c 6c6f 4027 0a20  2]: b'@Hello@'. 
+0000f490: 2020 2022 2222 290a 0a0a 2320 4070 7974     """)...# @pyt
+0000f4a0: 6573 742e 6d61 726b 2e73 6b69 7069 6628  est.mark.skipif(
+0000f4b0: 5f49 5059 5448 4f4e 5f56 4552 5349 4f4e  _IPYTHON_VERSION
+0000f4c0: 203e 2028 382c 2030 292c 2072 6561 736f   > (8, 0), reaso
+0000f4d0: 6e3d 2253 7472 616e 6765 206f 7574 7075  n="Strange outpu
+0000f4e0: 7420 6d69 7373 7061 7273 696e 6722 290a  t missparsing").
+0000f4f0: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
+0000f500: 6e6f 5f61 7574 6f69 6d70 6f72 745f 3128  no_autoimport_1(
+0000f510: 293a 0a20 2020 2023 2054 6573 7420 7468  ):.    # Test th
+0000f520: 6174 2077 6974 686f 7574 2070 7966 6c79  at without pyfly
+0000f530: 6279 2069 6e73 7461 6c6c 6564 2c20 7765  by installed, we
+0000f540: 2064 6f20 6765 7420 4e61 6d65 4572 726f   do get NameErro
+0000f550: 722e 2020 5468 6973 2069 730a 2020 2020  r.  This is.    
+0000f560: 2320 7265 616c 6c79 2061 2074 6573 7420  # really a test 
+0000f570: 7468 6174 206f 7572 2074 6573 7469 6e67  that our testing
+0000f580: 2069 6e66 7261 7374 7275 6374 7572 6520   infrastructure 
+0000f590: 6973 204f 4b20 616e 6420 6e6f 7420 6163  is OK and not ac
+0000f5a0: 6369 6465 6e74 616c 6c79 0a20 2020 2023  cidentally.    #
+0000f5b0: 2070 6963 6b69 6e67 2075 7020 7079 666c   picking up pyfl
+0000f5c0: 7962 7920 636f 6e66 6967 7572 6174 696f  yby configuratio
+0000f5d0: 6e20 696e 7374 616c 6c65 6420 696e 2061  n installed in a
+0000f5e0: 2073 7973 7465 6d20 6f72 2075 7365 7220   system or user 
+0000f5f0: 636f 6e66 6967 2e0a 2020 2020 6970 7974  config..    ipyt
+0000f600: 686f 6e28 0a20 2020 2020 2020 2022 2222  hon(.        """
+0000f610: 0a20 2020 2020 2020 2049 6e20 5b31 5d3a  .        In [1]:
+0000f620: 2062 2740 272b 6236 3464 6563 6f64 6528   b'@'+b64decode(
+0000f630: 2753 4756 7362 4738 3d27 292b 6227 4027  'SGVsbG8=')+b'@'
+0000f640: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0000f650: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000f660: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000f670: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000f680: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000f690: 2d2d 2d2d 0a20 2020 2020 2020 204e 616d  ----.        Nam
+0000f6a0: 6545 7272 6f72 2020 2020 2020 2020 2020  eError          
+0000f6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6c0: 2020 2020 2020 2054 7261 6365 6261 636b         Traceback
+0000f6d0: 2028 6d6f 7374 2072 6563 656e 7420 6361   (most recent ca
+0000f6e0: 6c6c 206c 6173 7429 0a20 2020 2020 2020  ll last).       
+0000f6f0: 202e 2e2e 2069 6e20 2e2e 2e0a 2020 2020   ... in ....    
+0000f700: 2020 2020 4e61 6d65 4572 726f 723a 206e      NameError: n
+0000f710: 616d 6520 2762 3634 6465 636f 6465 2720  ame 'b64decode' 
+0000f720: 6973 206e 6f74 2064 6566 696e 6564 0a20  is not defined. 
+0000f730: 2020 2022 2222 0a20 2020 2029 0a0a 0a73     """.    )...s
+0000f740: 6b69 7069 665f 6970 7974 686f 6e5f 746f  kipif_ipython_to
+0000f750: 6f5f 6f6c 645f 666f 725f 6c6f 6164 5f65  o_old_for_load_e
+0000f760: 7874 203d 2070 7974 6573 742e 6d61 726b  xt = pytest.mark
+0000f770: 2e73 6b69 7069 6628 0a20 2020 205f 4950  .skipif(.    _IP
+0000f780: 5954 484f 4e5f 5645 5253 494f 4e20 3c20  YTHON_VERSION < 
+0000f790: 2830 2c20 3131 292c 0a20 2020 2072 6561  (0, 11),.    rea
+0000f7a0: 736f 6e3d 2249 5079 7468 6f6e 2076 6572  son="IPython ver
+0000f7b0: 7369 6f6e 2025 7320 646f 6573 206e 6f74  sion %s does not
+0000f7c0: 2073 7570 706f 7274 2025 6c6f 6164 5f65   support %load_e
+0000f7d0: 7874 2c20 736f 206e 6f74 6869 6e67 2074  xt, so nothing t
+0000f7e0: 6f20 7465 7374 2229 0a0a 4073 6b69 7069  o test")..@skipi
+0000f7f0: 665f 6970 7974 686f 6e5f 746f 6f5f 6f6c  f_ipython_too_ol
+0000f800: 645f 666f 725f 6c6f 6164 5f65 7874 0a64  d_for_load_ext.d
+0000f810: 6566 2074 6573 745f 6c6f 6164 5f65 7874  ef test_load_ext
+0000f820: 5f31 2829 3a0a 2020 2020 2320 5465 7374  _1():.    # Test
+0000f830: 2074 6861 7420 256c 6f61 645f 6578 7420   that %load_ext 
+0000f840: 776f 726b 732e 0a20 2020 2069 7079 7468  works..    ipyth
+0000f850: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
+0000f860: 6e20 5b31 5d3a 2044 6563 696d 616c 2835  n [1]: Decimal(5
+0000f870: 3534 3739 3431 3529 0a20 2020 2020 2020  5479415).       
+0000f880: 202e 2e2e 2e0a 2020 2020 2020 2020 4e61   .....        Na
+0000f890: 6d65 4572 726f 723a 206e 616d 6520 2744  meError: name 'D
+0000f8a0: 6563 696d 616c 2720 6973 206e 6f74 2064  ecimal' is not d
+0000f8b0: 6566 696e 6564 0a20 2020 2020 2020 2049  efined.        I
+0000f8c0: 6e20 5b32 5d3a 2025 6c6f 6164 5f65 7874  n [2]: %load_ext
+0000f8d0: 2070 7966 6c79 6279 0a20 2020 2020 2020   pyflyby.       
+0000f8e0: 2049 6e20 5b33 5d3a 2044 6563 696d 616c   In [3]: Decimal
+0000f8f0: 2834 3336 3630 3738 3329 0a20 2020 2020  (43660783).     
+0000f900: 2020 205b 5059 464c 5942 595d 2066 726f     [PYFLYBY] fro
+0000f910: 6d20 6465 6369 6d61 6c20 696d 706f 7274  m decimal import
+0000f920: 2044 6563 696d 616c 0a20 2020 2020 2020   Decimal.       
+0000f930: 204f 7574 5b33 5d3a 2044 6563 696d 616c   Out[3]: Decimal
+0000f940: 2827 3433 3636 3037 3833 2729 0a20 2020  ('43660783').   
+0000f950: 2022 2222 290a 0a0a 4073 6b69 7069 665f   """)...@skipif_
+0000f960: 6970 7974 686f 6e5f 746f 6f5f 6f6c 645f  ipython_too_old_
+0000f970: 666f 725f 6c6f 6164 5f65 7874 0a40 7265  for_load_ext.@re
+0000f980: 7472 790a 6465 6620 7465 7374 5f75 6e6c  try.def test_unl
+0000f990: 6f61 645f 6578 745f 3128 293a 0a20 2020  oad_ext_1():.   
+0000f9a0: 2023 2054 6573 7420 7468 6174 2025 756e   # Test that %un
+0000f9b0: 6c6f 6164 5f65 7874 2077 6f72 6b73 2e0a  load_ext works..
+0000f9c0: 2020 2020 2320 4175 746f 696d 706f 7274      # Autoimport
+0000f9d0: 696e 6720 7368 6f75 6c64 2073 746f 7020  ing should stop 
+0000f9e0: 776f 726b 696e 672c 2062 7574 2070 7265  working, but pre
+0000f9f0: 7669 6f75 736c 7920 696d 706f 7274 6564  viously imported
+0000fa00: 2074 6869 0a20 2020 2069 7079 7468 6f6e   thi.    ipython
+0000fa10: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
+0000fa20: 5b31 5d3a 2062 3634 656e 636f 6465 2862  [1]: b64encode(b
+0000fa30: 2774 6f72 746f 6973 6527 290a 2020 2020  'tortoise').    
+0000fa40: 2020 2020 2e2e 2e2e 0a20 2020 2020 2020      .....       
+0000fa50: 204e 616d 6545 7272 6f72 3a20 6e61 6d65   NameError: name
+0000fa60: 2027 6236 3465 6e63 6f64 6527 2069 7320   'b64encode' is 
+0000fa70: 6e6f 7420 6465 6669 6e65 640a 2020 2020  not defined.    
+0000fa80: 2020 2020 496e 205b 325d 3a20 256c 6f61      In [2]: %loa
+0000fa90: 645f 6578 7420 7079 666c 7962 790a 2020  d_ext pyflyby.  
+0000faa0: 2020 2020 2020 496e 205b 335d 3a20 6236        In [3]: b6
+0000fab0: 3465 6e63 6f64 6528 6227 746f 7274 6f69  4encode(b'tortoi
+0000fac0: 7365 2729 0a20 2020 2020 2020 205b 5059  se').        [PY
+0000fad0: 464c 5942 595d 2066 726f 6d20 6261 7365  FLYBY] from base
+0000fae0: 3634 2069 6d70 6f72 7420 6236 3465 6e63  64 import b64enc
+0000faf0: 6f64 650a 2020 2020 2020 2020 4f75 745b  ode.        Out[
+0000fb00: 335d 3a20 6227 6447 3979 6447 3970 6332  3]: b'dG9ydG9pc2
+0000fb10: 553d 270a 2020 2020 2020 2020 496e 205b  U='.        In [
+0000fb20: 345d 3a20 2575 6e6c 6f61 645f 6578 7420  4]: %unload_ext 
+0000fb30: 7079 666c 7962 790a 2020 2020 2020 2020  pyflyby.        
+0000fb40: 496e 205b 355d 3a20 6236 3464 6563 6f64  In [5]: b64decod
+0000fb50: 6528 6227 6147 4679 5a51 3d3d 2729 0a20  e(b'aGFyZQ=='). 
+0000fb60: 2020 2020 2020 202e 2e2e 2e0a 2020 2020         .....    
+0000fb70: 2020 2020 4e61 6d65 4572 726f 723a 206e      NameError: n
+0000fb80: 616d 6520 2762 3634 6465 636f 6465 2720  ame 'b64decode' 
+0000fb90: 6973 206e 6f74 2064 6566 696e 6564 0a20  is not defined. 
+0000fba0: 2020 2020 2020 2049 6e20 5b36 5d3a 2062         In [6]: b
+0000fbb0: 3634 656e 636f 6465 2862 2774 7572 746c  64encode(b'turtl
+0000fbc0: 6527 290a 2020 2020 2020 2020 4f75 745b  e').        Out[
+0000fbd0: 365d 3a20 6227 6448 5679 6447 786c 270a  6]: b'dHVydGxl'.
+0000fbe0: 2020 2020 2222 2229 0a0a 0a0a 4073 6b69      """)....@ski
+0000fbf0: 7069 665f 6970 7974 686f 6e5f 746f 6f5f  pif_ipython_too_
+0000fc00: 6f6c 645f 666f 725f 6c6f 6164 5f65 7874  old_for_load_ext
+0000fc10: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
+0000fc20: 5f72 656c 6f61 645f 6578 745f 3128 293a  _reload_ext_1():
+0000fc30: 0a20 2020 2023 2054 6573 7420 7468 6174  .    # Test that
+0000fc40: 2061 7574 6f69 6d70 6f72 7469 6e67 2073   autoimporting s
+0000fc50: 7469 6c6c 2077 6f72 6b73 2061 6674 6572  till works after
+0000fc60: 2025 7265 6c6f 6164 5f65 7874 2e0a 2020   %reload_ext..  
+0000fc70: 2020 6970 7974 686f 6e28 2222 220a 2020    ipython(""".  
+0000fc80: 2020 2020 2020 496e 205b 315d 3a20 6236        In [1]: b6
+0000fc90: 3465 6e63 6f64 6528 6227 6561 7374 2729  4encode(b'east')
+0000fca0: 0a20 2020 2020 2020 202e 2e2e 2e0a 2020  .        .....  
+0000fcb0: 2020 2020 2020 4e61 6d65 4572 726f 723a        NameError:
+0000fcc0: 206e 616d 6520 2762 3634 656e 636f 6465   name 'b64encode
+0000fcd0: 2720 6973 206e 6f74 2064 6566 696e 6564  ' is not defined
+0000fce0: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
+0000fcf0: 2025 6c6f 6164 5f65 7874 2070 7966 6c79   %load_ext pyfly
+0000fd00: 6279 0a20 2020 2020 2020 2049 6e20 5b33  by.        In [3
+0000fd10: 5d3a 2062 3634 656e 636f 6465 2862 2765  ]: b64encode(b'e
+0000fd20: 6173 7427 290a 2020 2020 2020 2020 5b50  ast').        [P
+0000fd30: 5946 4c59 4259 5d20 6672 6f6d 2062 6173  YFLYBY] from bas
+0000fd40: 6536 3420 696d 706f 7274 2062 3634 656e  e64 import b64en
+0000fd50: 636f 6465 0a20 2020 2020 2020 204f 7574  code.        Out
+0000fd60: 5b33 5d3a 2062 275a 5746 7a64 413d 3d27  [3]: b'ZWFzdA=='
+0000fd70: 0a20 2020 2020 2020 2049 6e20 5b34 5d3a  .        In [4]:
+0000fd80: 2025 7265 6c6f 6164 5f65 7874 2070 7966   %reload_ext pyf
+0000fd90: 6c79 6279 0a20 2020 2020 2020 2049 6e20  lyby.        In 
+0000fda0: 5b35 5d3a 2062 3634 6465 636f 6465 2862  [5]: b64decode(b
+0000fdb0: 2764 3256 7a64 413d 3d27 290a 2020 2020  'd2VzdA==').    
+0000fdc0: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
+0000fdd0: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
+0000fde0: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
+0000fdf0: 2020 204f 7574 5b35 5d3a 2062 2777 6573     Out[5]: b'wes
+0000fe00: 7427 0a20 2020 2022 2222 290a 0a0a 4073  t'.    """)...@s
+0000fe10: 6b69 7069 665f 6970 7974 686f 6e5f 746f  kipif_ipython_to
+0000fe20: 6f5f 6f6c 645f 666f 725f 6c6f 6164 5f65  o_old_for_load_e
+0000fe30: 7874 0a40 7265 7472 790a 6465 6620 7465  xt.@retry.def te
+0000fe40: 7374 5f72 656c 6f61 645f 6578 745f 7265  st_reload_ext_re
+0000fe50: 6c6f 6164 5f69 6d70 6f72 7464 625f 3128  load_importdb_1(
+0000fe60: 746d 7029 3a0a 2020 2020 2320 5465 7374  tmp):.    # Test
+0000fe70: 2074 6861 7420 2572 656c 6f61 645f 6578   that %reload_ex
+0000fe80: 7420 6361 7573 6573 2074 6865 2069 6d70  t causes the imp
+0000fe90: 6f72 7464 6220 746f 2062 6520 7265 6672  ortdb to be refr
+0000fea0: 6573 6865 642e 0a20 2020 2077 7269 7465  eshed..    write
+0000feb0: 7465 7874 2874 6d70 2e66 696c 652c 2022  text(tmp.file, "
+0000fec0: 6672 6f6d 2069 7465 7274 6f6f 6c73 2069  from itertools i
+0000fed0: 6d70 6f72 7420 7265 7065 6174 5c6e 2229  mport repeat\n")
+0000fee0: 0a20 2020 2069 7079 7468 6f6e 280a 2020  .    ipython(.  
+0000fef0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000ff00: 2020 496e 205b 315d 3a20 256c 6f61 645f    In [1]: %load_
+0000ff10: 6578 7420 7079 666c 7962 790a 2020 2020  ext pyflyby.    
+0000ff20: 2020 2020 496e 205b 325d 3a20 6c69 7374      In [2]: list
+0000ff30: 2872 6570 6561 7428 332c 3429 290a 2020  (repeat(3,4)).  
+0000ff40: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
+0000ff50: 6672 6f6d 2069 7465 7274 6f6f 6c73 2069  from itertools i
+0000ff60: 6d70 6f72 7420 7265 7065 6174 0a20 2020  mport repeat.   
+0000ff70: 2020 2020 204f 7574 5b32 5d3a 205b 332c       Out[2]: [3,
+0000ff80: 2033 2c20 332c 2033 5d0a 2020 2020 2020   3, 3, 3].      
+0000ff90: 2020 496e 205b 335d 3a20 6c69 7374 2863    In [3]: list(c
+0000ffa0: 6f6d 6269 6e61 7469 6f6e 7328 2761 6263  ombinations('abc
+0000ffb0: 272c 3229 290a 2020 2020 2020 2020 2d2d  ',2)).        --
+0000ffc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000ffd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000ffe0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000fff0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00010000: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00010010: 2020 4e61 6d65 4572 726f 7220 2020 2020    NameError     
+00010020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010030: 2020 2020 2020 2020 2020 2020 5472 6163              Trac
+00010040: 6562 6163 6b20 286d 6f73 7420 7265 6365  eback (most rece
+00010050: 6e74 2063 616c 6c20 6c61 7374 290a 2020  nt call last).  
+00010060: 2020 2020 2020 2e2e 2e20 696e 202e 2e2e        ... in ...
+00010070: 0a20 2020 2020 2020 204e 616d 6545 7272  .        NameErr
+00010080: 6f72 3a20 6e61 6d65 2027 636f 6d62 696e  or: name 'combin
+00010090: 6174 696f 6e73 2720 6973 206e 6f74 2064  ations' is not d
+000100a0: 6566 696e 6564 0a20 2020 2020 2020 2049  efined.        I
+000100b0: 6e20 5b34 5d3a 2077 6974 6820 6f70 656e  n [4]: with open
+000100c0: 2827 7b74 6d70 2e66 696c 657d 272c 2027  ('{tmp.file}', '
+000100d0: 6127 2920 6173 2066 3a0a 2020 2020 2020  a') as f:.      
+000100e0: 2020 2020 202e 2e2e 3a20 2020 662e 7772       ...:   f.wr
+000100f0: 6974 6528 2766 726f 6d20 6974 6572 746f  ite('from iterto
+00010100: 6f6c 7320 696d 706f 7274 2063 6f6d 6269  ols import combi
+00010110: 6e61 7469 6f6e 735c 5c6e 2729 0a20 2020  nations\\n').   
+00010120: 2020 2020 2020 2020 2e2e 2e3a 0a20 2020          ...:.   
+00010130: 2020 2020 2049 6e20 5b35 5d3a 206c 6973       In [5]: lis
+00010140: 7428 636f 6d62 696e 6174 696f 6e73 2827  t(combinations('
+00010150: 6162 6327 2c32 2929 0a20 2020 2020 2020  abc',2)).       
+00010160: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
+00010170: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00010180: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00010190: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000101a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
+000101b0: 2020 2020 204e 616d 6545 7272 6f72 2020       NameError  
+000101c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101d0: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+000101e0: 7261 6365 6261 636b 2028 6d6f 7374 2072  raceback (most r
+000101f0: 6563 656e 7420 6361 6c6c 206c 6173 7429  ecent call last)
+00010200: 0a20 2020 2020 2020 202e 2e2e 2069 6e20  .        ... in 
+00010210: 2e2e 2e0a 2020 2020 2020 2020 4e61 6d65  ....        Name
+00010220: 4572 726f 723a 206e 616d 6520 2763 6f6d  Error: name 'com
+00010230: 6269 6e61 7469 6f6e 7327 2069 7320 6e6f  binations' is no
+00010240: 7420 6465 6669 6e65 640a 2020 2020 2020  t defined.      
+00010250: 2020 496e 205b 365d 3a20 2572 656c 6f61    In [6]: %reloa
+00010260: 645f 6578 7420 7079 666c 7962 790a 2020  d_ext pyflyby.  
+00010270: 2020 2020 2020 496e 205b 375d 3a20 6c69        In [7]: li
+00010280: 7374 2863 6f6d 6269 6e61 7469 6f6e 7328  st(combinations(
+00010290: 2761 6263 272c 3229 290a 2020 2020 2020  'abc',2)).      
+000102a0: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
+000102b0: 2069 7465 7274 6f6f 6c73 2069 6d70 6f72   itertools impor
+000102c0: 7420 636f 6d62 696e 6174 696f 6e73 0a20  t combinations. 
+000102d0: 2020 2020 2020 204f 7574 5b37 5d3a 205b         Out[7]: [
+000102e0: 2827 6127 2c20 2762 2729 2c20 2827 6127  ('a', 'b'), ('a'
+000102f0: 2c20 2763 2729 2c20 2827 6227 2c20 2763  , 'c'), ('b', 'c
+00010300: 2729 5d0a 2020 2020 2222 222e 666f 726d  ')].    """.form
+00010310: 6174 280a 2020 2020 2020 2020 2020 2020  at(.            
+00010320: 746d 703d 746d 700a 2020 2020 2020 2020  tmp=tmp.        
+00010330: 292c 0a20 2020 2020 2020 2050 5946 4c59  ),.        PYFLY
+00010340: 4259 5f50 4154 483d 746d 702e 6669 6c65  BY_PATH=tmp.file
+00010350: 2c0a 2020 2020 290a 0a0a 4073 6b69 7069  ,.    )...@skipi
+00010360: 665f 6970 7974 686f 6e5f 746f 6f5f 6f6c  f_ipython_too_ol
+00010370: 645f 666f 725f 6c6f 6164 5f65 7874 0a40  d_for_load_ext.@
+00010380: 7265 7472 790a 6465 6620 7465 7374 5f72  retry.def test_r
+00010390: 656c 6f61 645f 6578 745f 7265 7472 795f  eload_ext_retry_
+000103a0: 6661 696c 6564 5f69 6d70 6f72 7473 5f31  failed_imports_1
+000103b0: 2874 6d70 293a 0a20 2020 2023 2056 6572  (tmp):.    # Ver
+000103c0: 6966 7920 7468 6174 2025 7872 656c 6f61  ify that %xreloa
+000103d0: 645f 6578 7420 6361 7573 6573 2075 7320  d_ext causes us 
+000103e0: 746f 2072 6574 7279 2069 6d70 6f72 7473  to retry imports
+000103f0: 2074 6861 7420 7765 2070 7265 7669 6f75   that we previou
+00010400: 736c 790a 2020 2020 2320 6465 6369 6465  sly.    # decide
+00010410: 6420 6e6f 7420 746f 2072 6574 7279 2e0a  d not to retry..
+00010420: 2020 2020 7772 6974 6574 6578 7428 0a20      writetext(. 
+00010430: 2020 2020 2020 2074 6d70 2e64 6972 202f         tmp.dir /
+00010440: 2022 6869 7070 6f38 3434 3032 3030 392e   "hippo84402009.
+00010450: 7079 222c 0a20 2020 2020 2020 2022 2222  py",.        """
+00010460: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+00010470: 7379 730a 2020 2020 2020 2020 6461 7461  sys.        data
+00010480: 203d 2073 7973 2e5f 5f64 6963 745f 5f2e   = sys.__dict__.
+00010490: 7365 7464 6566 6175 6c74 2827 6869 7070  setdefault('hipp
+000104a0: 6f38 3434 3032 3030 395f 6174 7465 6d70  o84402009_attemp
+000104b0: 7473 272c 2030 290a 2020 2020 2020 2020  ts', 0).        
+000104c0: 7379 732e 6869 7070 6f38 3434 3032 3030  sys.hippo8440200
+000104d0: 395f 6174 7465 6d70 7473 202b 3d20 310a  9_attempts += 1.
+000104e0: 2020 2020 2020 2020 7072 696e 7428 2768          print('h
+000104f0: 656c 6c6f 2066 726f 6d20 6869 7070 6f38  ello from hippo8
+00010500: 3434 3032 3030 393a 2061 7474 656d 7074  4402009: attempt
+00010510: 2025 6427 0a20 2020 2020 2020 2020 2020   %d'.           
+00010520: 2020 2025 2073 7973 2e68 6970 706f 3834     % sys.hippo84
+00010530: 3430 3230 3039 5f61 7474 656d 7074 7329  402009_attempts)
+00010540: 0a20 2020 2020 2020 2031 2f30 0a20 2020  .        1/0.   
+00010550: 2022 2222 2c0a 2020 2020 290a 2020 2020   """,.    ).    
+00010560: 7772 6974 6574 6578 7428 746d 702e 6669  writetext(tmp.fi
+00010570: 6c65 2c20 2266 726f 6d20 6869 7070 6f38  le, "from hippo8
+00010580: 3434 3032 3030 3920 696d 706f 7274 2072  4402009 import r
+00010590: 6869 6e6f 3133 3630 3931 3335 2229 0a20  hino13609135"). 
+000105a0: 2020 2069 7079 7468 6f6e 280a 2020 2020     ipython(.    
+000105b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000105c0: 496e 205b 315d 3a20 256c 6f61 645f 6578  In [1]: %load_ex
+000105d0: 7420 7079 666c 7962 790a 2020 2020 2020  t pyflyby.      
+000105e0: 2020 496e 205b 325d 3a20 7268 696e 6f31    In [2]: rhino1
+000105f0: 3336 3039 3133 350a 2020 2020 2020 2020  3609135.        
+00010600: 5b50 5946 4c59 4259 5d20 6672 6f6d 2068  [PYFLYBY] from h
+00010610: 6970 706f 3834 3430 3230 3039 2069 6d70  ippo84402009 imp
+00010620: 6f72 7420 7268 696e 6f31 3336 3039 3133  ort rhino1360913
+00010630: 350a 2020 2020 2020 2020 6865 6c6c 6f20  5.        hello 
+00010640: 6672 6f6d 2068 6970 706f 3834 3430 3230  from hippo844020
+00010650: 3039 3a20 6174 7465 6d70 7420 310a 2020  09: attempt 1.  
+00010660: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
+00010670: 4572 726f 7220 6174 7465 6d70 7469 6e67  Error attempting
+00010680: 2074 6f20 2766 726f 6d20 6869 7070 6f38   to 'from hippo8
+00010690: 3434 3032 3030 3920 696d 706f 7274 2072  4402009 import r
+000106a0: 6869 6e6f 3133 3630 3931 3335 273a 205a  hino13609135': Z
+000106b0: 6572 6f44 6976 6973 696f 6e45 7272 6f72  eroDivisionError
+000106c0: 3a20 6469 7669 7369 6f6e 2062 7920 7a65  : division by ze
+000106d0: 726f 0a20 2020 2020 2020 202e 2e2e 2e0a  ro.        .....
+000106e0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000106f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00010700: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00010710: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00010720: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00010730: 2d2d 2d0a 2020 2020 2020 2020 4e61 6d65  ---.        Name
+00010740: 4572 726f 7220 2020 2020 2020 2020 2020  Error           
+00010750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010760: 2020 2020 2020 5472 6163 6562 6163 6b20        Traceback 
+00010770: 286d 6f73 7420 7265 6365 6e74 2063 616c  (most recent cal
+00010780: 6c20 6c61 7374 290a 2020 2020 2020 2020  l last).        
+00010790: 2e2e 2e20 696e 202e 2e2e 0a20 2020 2020  ... in ....     
+000107a0: 2020 204e 616d 6545 7272 6f72 3a20 6e61     NameError: na
+000107b0: 6d65 2027 7268 696e 6f31 3336 3039 3133  me 'rhino1360913
+000107c0: 3527 2069 7320 6e6f 7420 6465 6669 6e65  5' is not define
+000107d0: 640a 2020 2020 2020 2020 496e 205b 335d  d.        In [3]
+000107e0: 3a20 7268 696e 6f31 3336 3039 3133 350a  : rhino13609135.
+000107f0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00010800: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00010810: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00010820: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00010830: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00010840: 2d2d 2d0a 2020 2020 2020 2020 4e61 6d65  ---.        Name
+00010850: 4572 726f 7220 2020 2020 2020 2020 2020  Error           
+00010860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010870: 2020 2020 2020 5472 6163 6562 6163 6b20        Traceback 
+00010880: 286d 6f73 7420 7265 6365 6e74 2063 616c  (most recent cal
+00010890: 6c20 6c61 7374 290a 2020 2020 2020 2020  l last).        
+000108a0: 2e2e 2e20 696e 202e 2e2e 0a20 2020 2020  ... in ....     
+000108b0: 2020 204e 616d 6545 7272 6f72 3a20 6e61     NameError: na
+000108c0: 6d65 2027 7268 696e 6f31 3336 3039 3133  me 'rhino1360913
+000108d0: 3527 2069 7320 6e6f 7420 6465 6669 6e65  5' is not define
+000108e0: 640a 2020 2020 2020 2020 496e 205b 345d  d.        In [4]
+000108f0: 3a20 2572 656c 6f61 645f 6578 7420 7079  : %reload_ext py
+00010900: 666c 7962 790a 2020 2020 2020 2020 496e  flyby.        In
+00010910: 205b 355d 3a20 7268 696e 6f31 3336 3039   [5]: rhino13609
+00010920: 3133 350a 2020 2020 2020 2020 5b50 5946  135.        [PYF
+00010930: 4c59 4259 5d20 6672 6f6d 2068 6970 706f  LYBY] from hippo
+00010940: 3834 3430 3230 3039 2069 6d70 6f72 7420  84402009 import 
+00010950: 7268 696e 6f31 3336 3039 3133 350a 2020  rhino13609135.  
+00010960: 2020 2020 2020 6865 6c6c 6f20 6672 6f6d        hello from
+00010970: 2068 6970 706f 3834 3430 3230 3039 3a20   hippo84402009: 
+00010980: 6174 7465 6d70 7420 320a 2020 2020 2020  attempt 2.      
+00010990: 2020 5b50 5946 4c59 4259 5d20 4572 726f    [PYFLYBY] Erro
+000109a0: 7220 6174 7465 6d70 7469 6e67 2074 6f20  r attempting to 
+000109b0: 2766 726f 6d20 6869 7070 6f38 3434 3032  'from hippo84402
+000109c0: 3030 3920 696d 706f 7274 2072 6869 6e6f  009 import rhino
+000109d0: 3133 3630 3931 3335 273a 205a 6572 6f44  13609135': ZeroD
+000109e0: 6976 6973 696f 6e45 7272 6f72 3a20 6469  ivisionError: di
+000109f0: 7669 7369 6f6e 2062 7920 7a65 726f 0a20  vision by zero. 
+00010a00: 2020 2020 2020 202e 2e2e 2e0a 2020 2020         .....    
+00010a10: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
+00010a20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00010a30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00010a40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00010a50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
+00010a60: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
+00010a70: 7220 2020 2020 2020 2020 2020 2020 2020  r               
+00010a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a90: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
+00010aa0: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
+00010ab0: 7374 290a 2020 2020 2020 2020 2e2e 2e20  st).        ... 
+00010ac0: 696e 202e 2e2e 0a20 2020 2020 2020 204e  in ....        N
+00010ad0: 616d 6545 7272 6f72 3a20 6e61 6d65 2027  ameError: name '
+00010ae0: 7268 696e 6f31 3336 3039 3133 3527 2069  rhino13609135' i
+00010af0: 7320 6e6f 7420 6465 6669 6e65 640a 2020  s not defined.  
+00010b00: 2020 2222 222c 0a20 2020 2020 2020 2050    """,.        P
+00010b10: 5954 484f 4e50 4154 483d 746d 702e 6469  YTHONPATH=tmp.di
+00010b20: 722c 0a20 2020 2020 2020 2050 5946 4c59  r,.        PYFLY
+00010b30: 4259 5f50 4154 483d 746d 702e 6669 6c65  BY_PATH=tmp.file
+00010b40: 2c0a 2020 2020 290a 0a0a 4072 6574 7279  ,.    )...@retry
+00010b50: 0a64 6566 2074 6573 745f 6175 746f 696d  .def test_autoim
+00010b60: 706f 7274 5f73 796d 626f 6c5f 3128 293a  port_symbol_1():
+00010b70: 0a20 2020 2069 7079 7468 6f6e 2822 2222  .    ipython("""
+00010b80: 0a20 2020 2020 2020 2049 6e20 5b31 5d3a  .        In [1]:
+00010b90: 2069 6d70 6f72 7420 7079 666c 7962 793b   import pyflyby;
+00010ba0: 2070 7966 6c79 6279 2e65 6e61 626c 655f   pyflyby.enable_
+00010bb0: 6175 746f 5f69 6d70 6f72 7465 7228 290a  auto_importer().
+00010bc0: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
+00010bd0: 6236 3464 6563 6f64 650a 2020 2020 2020  b64decode.      
+00010be0: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
+00010bf0: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
+00010c00: 3634 6465 636f 6465 0a20 2020 2020 2020  64decode.       
+00010c10: 204f 7574 5b32 5d3a 203c 6675 6e63 7469   Out[2]: <functi
+00010c20: 6f6e 202e 2e2e 6236 3464 6563 6f64 652e  on ...b64decode.
+00010c30: 2e2e 3e0a 2020 2020 2222 2229 0a0a 0a40  ..>.    """)...@
+00010c40: 7265 7472 790a 6465 6620 7465 7374 5f61  retry.def test_a
+00010c50: 7574 6f69 6d70 6f72 745f 7374 6174 656d  utoimport_statem
+00010c60: 656e 745f 3128 293a 0a20 2020 2069 7079  ent_1():.    ipy
+00010c70: 7468 6f6e 2822 2222 0a20 2020 2020 2020  thon(""".       
+00010c80: 2049 6e20 5b31 5d3a 2069 6d70 6f72 7420   In [1]: import 
+00010c90: 7079 666c 7962 793b 2070 7966 6c79 6279  pyflyby; pyflyby
+00010ca0: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
+00010cb0: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
+00010cc0: 496e 205b 325d 3a20 6966 2031 3a20 7072  In [2]: if 1: pr
+00010cd0: 696e 7428 6236 3464 6563 6f64 6528 6227  int(b64decode(b'
+00010ce0: 5347 5673 6247 383d 2729 2e64 6563 6f64  SGVsbG8=').decod
+00010cf0: 6528 2775 7466 2d38 2729 290a 2020 2020  e('utf-8')).    
+00010d00: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
+00010d10: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
+00010d20: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
+00010d30: 2020 2048 656c 6c6f 0a20 2020 2022 2222     Hello.    """
+00010d40: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
+00010d50: 6573 745f 6175 746f 696d 706f 7274 5f6d  est_autoimport_m
+00010d60: 756c 7469 706c 655f 696d 706f 7274 735f  ultiple_imports_
+00010d70: 3128 293a 0a20 2020 2069 7079 7468 6f6e  1():.    ipython
+00010d80: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
+00010d90: 5b31 5d3a 2069 6d70 6f72 7420 7079 666c  [1]: import pyfl
+00010da0: 7962 793b 2070 7966 6c79 6279 2e65 6e61  yby; pyflyby.ena
+00010db0: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
+00010dc0: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
+00010dd0: 325d 3a20 7072 696e 7428 2862 3634 656e  2]: print((b64en
+00010de0: 636f 6465 2862 226b 6f61 6c61 2229 2c20  code(b"koala"), 
+00010df0: 6236 3464 6563 6f64 6528 6222 6132 4675  b64decode(b"a2Fu
+00010e00: 5a32 4679 6232 383d 2229 2929 0a20 2020  Z2Fyb28="))).   
+00010e10: 2020 2020 205b 5059 464c 5942 595d 2066       [PYFLYBY] f
+00010e20: 726f 6d20 6261 7365 3634 2069 6d70 6f72  rom base64 impor
+00010e30: 7420 6236 3464 6563 6f64 650a 2020 2020  t b64decode.    
+00010e40: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
+00010e50: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
+00010e60: 2062 3634 656e 636f 6465 0a20 2020 2020   b64encode.     
+00010e70: 2020 2028 6227 6132 3968 6247 453d 272c     (b'a29hbGE=',
+00010e80: 2062 276b 616e 6761 726f 6f27 290a 2020   b'kangaroo').  
+00010e90: 2020 2222 2229 0a0a 0a40 7265 7472 790a    """)...@retry.
+00010ea0: 6465 6620 7465 7374 5f61 7574 6f69 6d70  def test_autoimp
+00010eb0: 6f72 745f 6d75 6c74 696c 696e 655f 7374  ort_multiline_st
+00010ec0: 6174 656d 656e 745f 3128 293a 0a20 2020  atement_1():.   
+00010ed0: 2069 7079 7468 6f6e 2822 2222 0a20 2020   ipython(""".   
+00010ee0: 2020 2020 2049 6e20 5b31 5d3a 2069 6d70       In [1]: imp
+00010ef0: 6f72 7420 7079 666c 7962 793b 2070 7966  ort pyflyby; pyf
+00010f00: 6c79 6279 2e65 6e61 626c 655f 6175 746f  lyby.enable_auto
+00010f10: 5f69 6d70 6f72 7465 7228 290a 2020 2020  _importer().    
+00010f20: 2020 2020 496e 205b 325d 3a20 6966 2031      In [2]: if 1
+00010f30: 3a0a 2020 2020 2020 2020 2020 202e 2e2e  :.           ...
+00010f40: 3a20 2020 2020 7072 696e 7428 6236 3464  :     print(b64d
+00010f50: 6563 6f64 6528 6227 6448 5679 6447 786c  ecode(b'dHVydGxl
+00010f60: 2729 2e64 6563 6f64 6528 2775 7466 2d38  ').decode('utf-8
+00010f70: 2729 290a 2020 2020 2020 2020 2020 202e  ')).           .
+00010f80: 2e2e 3a0a 2020 2020 2020 2020 5b50 5946  ..:.        [PYF
+00010f90: 4c59 4259 5d20 6672 6f6d 2062 6173 6536  LYBY] from base6
+00010fa0: 3420 696d 706f 7274 2062 3634 6465 636f  4 import b64deco
+00010fb0: 6465 0a20 2020 2020 2020 2074 7572 746c  de.        turtl
+00010fc0: 650a 2020 2020 2020 2020 496e 205b 335d  e.        In [3]
+00010fd0: 3a20 6966 2031 3a20 7072 696e 7428 6236  : if 1: print(b6
+00010fe0: 3464 6563 6f64 6528 6227 6247 4674 5951  4decode(b'bGFtYQ
+00010ff0: 3d3d 2729 2e64 6563 6f64 6528 2775 7466  ==').decode('utf
+00011000: 2d38 2729 290a 2020 2020 2020 2020 6c61  -8')).        la
+00011010: 6d61 0a20 2020 2022 2222 290a 0a0a 4072  ma.    """)...@r
+00011020: 6574 7279 0a64 6566 2074 6573 745f 6175  etry.def test_au
+00011030: 746f 696d 706f 7274 5f6d 756c 7469 6c69  toimport_multili
+00011040: 6e65 5f63 6f6e 7469 6e75 6564 5f73 7461  ne_continued_sta
+00011050: 7465 6d65 6e74 5f31 2866 726f 6e74 656e  tement_1(fronten
+00011060: 6429 3a0a 2020 2020 6966 2066 726f 6e74  d):.    if front
+00011070: 656e 6420 3d3d 2022 7072 6f6d 7074 5f74  end == "prompt_t
+00011080: 6f6f 6c6b 6974 223a 2070 7974 6573 742e  oolkit": pytest.
+00011090: 736b 6970 2829 0a20 2020 2069 7079 7468  skip().    ipyth
+000110a0: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
+000110b0: 6e20 5b31 5d3a 2069 6d70 6f72 7420 7079  n [1]: import py
+000110c0: 666c 7962 793b 2070 7966 6c79 6279 2e65  flyby; pyflyby.e
+000110d0: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+000110e0: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
+000110f0: 205b 325d 3a20 6966 2031 3a0a 2020 2020   [2]: if 1:.    
+00011100: 2020 2020 2020 202e 2e2e 3a20 2020 2020         ...:     
+00011110: 2873 7973 2e0a 2020 2020 2020 2020 2020  (sys..          
+00011120: 202e 2e2e 3a20 2020 2020 2020 2020 7374   ...:         st
+00011130: 646f 7574 0a20 2020 2020 2020 2020 2020  dout.           
+00011140: 2e2e 2e3a 2020 2020 2020 2020 2020 2020  ...:            
+00011150: 202e 7772 6974 6528 0a20 2020 2020 2020   .write(.       
+00011160: 2020 2020 2e2e 2e3a 2020 2020 2020 2020      ...:        
+00011170: 2020 2020 2020 2020 2062 3634 6465 636f           b64deco
+00011180: 6465 280a 2020 2020 2020 2020 2020 202e  de(.           .
+00011190: 2e2e 3a20 2020 2020 2020 2020 2020 2020  ..:             
+000111a0: 2020 2020 2020 2020 2762 576c 6a63 6d39          'bWljcm9
+000111b0: 7761 4739 755a 513d 3d27 2929 290a 2020  waG9uZQ=='))).  
+000111c0: 2020 2020 2020 2020 202e 2e2e 3a0a 2020           ...:.  
+000111d0: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
+000111e0: 6672 6f6d 2062 6173 6536 3420 696d 706f  from base64 impo
+000111f0: 7274 2062 3634 6465 636f 6465 0a20 2020  rt b64decode.   
+00011200: 2020 2020 205b 5059 464c 5942 595d 2069       [PYFLYBY] i
+00011210: 6d70 6f72 7420 7379 730a 2020 2020 2020  mport sys.      
+00011220: 2020 6d69 6372 6f70 686f 6e65 0a20 2020    microphone.   
+00011230: 2020 2020 2049 6e20 5b33 5d3a 2069 6620       In [3]: if 
+00011240: 313a 2073 7973 2e73 7464 6f75 742e 7772  1: sys.stdout.wr
+00011250: 6974 6528 6236 3464 6563 6f64 6528 2762  ite(b64decode('b
+00011260: 4739 315a 484e 775a 5746 725a 5849 3d27  G91ZHNwZWFrZXI='
+00011270: 2929 0a20 2020 2020 2020 206c 6f75 6473  )).        louds
+00011280: 7065 616b 6572 0a20 2020 2022 2222 2c20  peaker.    """, 
+00011290: 6672 6f6e 7465 6e64 3d66 726f 6e74 656e  frontend=fronten
+000112a0: 6429 0a0a 0a40 7265 7472 790a 6465 6620  d)...@retry.def 
+000112b0: 7465 7374 5f61 7574 6f69 6d70 6f72 745f  test_autoimport_
+000112c0: 6d75 6c74 696c 696e 655f 636f 6e74 696e  multiline_contin
+000112d0: 7565 645f 7374 6174 656d 656e 745f 6661  ued_statement_fa
+000112e0: 6b65 5f31 2866 726f 6e74 656e 6429 3a0a  ke_1(frontend):.
+000112f0: 2020 2020 6966 2066 726f 6e74 656e 6420      if frontend 
+00011300: 3d3d 2022 7072 6f6d 7074 5f74 6f6f 6c6b  == "prompt_toolk
+00011310: 6974 223a 2070 7974 6573 742e 736b 6970  it": pytest.skip
+00011320: 2829 0a20 2020 2069 7079 7468 6f6e 2822  ().    ipython("
+00011330: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
+00011340: 5d3a 2069 6d70 6f72 7420 7079 666c 7962  ]: import pyflyb
+00011350: 793b 2070 7966 6c79 6279 2e65 6e61 626c  y; pyflyby.enabl
+00011360: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
+00011370: 290a 2020 2020 2020 2020 496e 205b 325d  ).        In [2]
+00011380: 3a20 6966 2031 3a0a 2020 2020 2020 2020  : if 1:.        
+00011390: 2020 202e 2e2e 3a20 2020 2020 7072 696e     ...:     prin
+000113a0: 7428 756e 6b6e 6f77 6e5f 7379 6d62 6f6c  t(unknown_symbol
+000113b0: 5f33 3733 3230 3839 392e 0a20 2020 2020  _37320899..     
+000113c0: 2020 2020 2020 2e2e 2e3a 2020 2020 2020        ...:      
+000113d0: 2020 2062 3634 656e 636f 6465 0a20 2020     b64encode.   
+000113e0: 2020 2020 2020 2020 2e2e 2e3a 2020 2020          ...:    
+000113f0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00011400: 2020 2e2e 2e3a 0a20 2020 2020 2020 202d    ...:.        -
+00011410: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00011420: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00011430: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00011440: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00011450: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00011460: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00011470: 2020 4e61 6d65 4572 726f 7220 2020 2020    NameError     
-00011480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011490: 2020 2020 2020 2020 2020 2020 5472 6163              Trac
-000114a0: 6562 6163 6b20 286d 6f73 7420 7265 6365  eback (most rece
-000114b0: 6e74 2063 616c 6c20 6c61 7374 290a 2020  nt call last).  
-000114c0: 2020 2020 2020 2e2e 2e20 696e 202e 2e2e        ... in ...
-000114d0: 0a20 2020 2020 2020 204e 616d 6545 7272  .        NameErr
-000114e0: 6f72 3a20 6e61 6d65 2027 7268 696e 6f31  or: name 'rhino1
-000114f0: 3336 3039 3133 3527 2069 7320 6e6f 7420  3609135' is not 
-00011500: 6465 6669 6e65 640a 2020 2020 2020 2020  defined.        
-00011510: 496e 205b 345d 3a20 2572 656c 6f61 645f  In [4]: %reload_
-00011520: 6578 7420 7079 666c 7962 790a 2020 2020  ext pyflyby.    
-00011530: 2020 2020 496e 205b 355d 3a20 7268 696e      In [5]: rhin
-00011540: 6f31 3336 3039 3133 350a 2020 2020 2020  o13609135.      
-00011550: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
-00011560: 2068 6970 706f 3834 3430 3230 3039 2069   hippo84402009 i
-00011570: 6d70 6f72 7420 7268 696e 6f31 3336 3039  mport rhino13609
-00011580: 3133 350a 2020 2020 2020 2020 6865 6c6c  135.        hell
-00011590: 6f20 6672 6f6d 2068 6970 706f 3834 3430  o from hippo8440
-000115a0: 3230 3039 3a20 6174 7465 6d70 7420 320a  2009: attempt 2.
-000115b0: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
-000115c0: 5d20 4572 726f 7220 6174 7465 6d70 7469  ] Error attempti
-000115d0: 6e67 2074 6f20 2766 726f 6d20 6869 7070  ng to 'from hipp
-000115e0: 6f38 3434 3032 3030 3920 696d 706f 7274  o84402009 import
-000115f0: 2072 6869 6e6f 3133 3630 3931 3335 273a   rhino13609135':
-00011600: 205a 6572 6f44 6976 6973 696f 6e45 7272   ZeroDivisionErr
-00011610: 6f72 3a20 6469 7669 7369 6f6e 2062 7920  or: division by 
-00011620: 7a65 726f 0a20 2020 2020 2020 202e 2e2e  zero.        ...
-00011630: 2e0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-00011640: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00011650: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00011660: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00011670: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00011680: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4e61  -----.        Na
-00011690: 6d65 4572 726f 7220 2020 2020 2020 2020  meError         
-000116a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000116b0: 2020 2020 2020 2020 5472 6163 6562 6163          Tracebac
-000116c0: 6b20 286d 6f73 7420 7265 6365 6e74 2063  k (most recent c
-000116d0: 616c 6c20 6c61 7374 290a 2020 2020 2020  all last).      
-000116e0: 2020 2e2e 2e20 696e 202e 2e2e 0a20 2020    ... in ....   
-000116f0: 2020 2020 204e 616d 6545 7272 6f72 3a20       NameError: 
-00011700: 6e61 6d65 2027 7268 696e 6f31 3336 3039  name 'rhino13609
-00011710: 3133 3527 2069 7320 6e6f 7420 6465 6669  135' is not defi
-00011720: 6e65 640a 2020 2020 2222 222c 0a20 2020  ned.    """,.   
-00011730: 2020 2020 2050 5954 484f 4e50 4154 483d       PYTHONPATH=
-00011740: 746d 702e 6469 722c 0a20 2020 2020 2020  tmp.dir,.       
-00011750: 2050 5946 4c59 4259 5f50 4154 483d 746d   PYFLYBY_PATH=tm
-00011760: 702e 6669 6c65 2c0a 2020 2020 290a 0a0a  p.file,.    )...
-00011770: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
-00011780: 6175 746f 696d 706f 7274 5f73 796d 626f  autoimport_symbo
-00011790: 6c5f 3128 293a 0a20 2020 2069 7079 7468  l_1():.    ipyth
-000117a0: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
-000117b0: 6e20 5b31 5d3a 2069 6d70 6f72 7420 7079  n [1]: import py
-000117c0: 666c 7962 793b 2070 7966 6c79 6279 2e65  flyby; pyflyby.e
-000117d0: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
-000117e0: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
-000117f0: 205b 325d 3a20 6236 3464 6563 6f64 650a   [2]: b64decode.
-00011800: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
-00011810: 5d20 6672 6f6d 2062 6173 6536 3420 696d  ] from base64 im
-00011820: 706f 7274 2062 3634 6465 636f 6465 0a20  port b64decode. 
-00011830: 2020 2020 2020 204f 7574 5b32 5d3a 203c         Out[2]: <
-00011840: 6675 6e63 7469 6f6e 202e 2e2e 6236 3464  function ...b64d
-00011850: 6563 6f64 652e 2e2e 3e0a 2020 2020 2222  ecode...>.    ""
-00011860: 2229 0a0a 0a40 7265 7472 790a 6465 6620  ")...@retry.def 
-00011870: 7465 7374 5f61 7574 6f69 6d70 6f72 745f  test_autoimport_
-00011880: 7374 6174 656d 656e 745f 3128 293a 0a20  statement_1():. 
-00011890: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
-000118a0: 2020 2020 2020 2049 6e20 5b31 5d3a 2069         In [1]: i
-000118b0: 6d70 6f72 7420 7079 666c 7962 793b 2070  mport pyflyby; p
-000118c0: 7966 6c79 6279 2e65 6e61 626c 655f 6175  yflyby.enable_au
-000118d0: 746f 5f69 6d70 6f72 7465 7228 290a 2020  to_importer().  
-000118e0: 2020 2020 2020 496e 205b 325d 3a20 6966        In [2]: if
-000118f0: 2031 3a20 7072 696e 7428 6236 3464 6563   1: print(b64dec
-00011900: 6f64 6528 6227 5347 5673 6247 383d 2729  ode(b'SGVsbG8=')
-00011910: 2e64 6563 6f64 6528 2775 7466 2d38 2729  .decode('utf-8')
-00011920: 290a 2020 2020 2020 2020 5b50 5946 4c59  ).        [PYFLY
-00011930: 4259 5d20 6672 6f6d 2062 6173 6536 3420  BY] from base64 
-00011940: 696d 706f 7274 2062 3634 6465 636f 6465  import b64decode
-00011950: 0a20 2020 2020 2020 2048 656c 6c6f 0a20  .        Hello. 
-00011960: 2020 2022 2222 290a 0a0a 4072 6574 7279     """)...@retry
-00011970: 0a64 6566 2074 6573 745f 6175 746f 696d  .def test_autoim
-00011980: 706f 7274 5f6d 756c 7469 706c 655f 696d  port_multiple_im
-00011990: 706f 7274 735f 3128 293a 0a20 2020 2069  ports_1():.    i
-000119a0: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
-000119b0: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
-000119c0: 7420 7079 666c 7962 793b 2070 7966 6c79  t pyflyby; pyfly
-000119d0: 6279 2e65 6e61 626c 655f 6175 746f 5f69  by.enable_auto_i
-000119e0: 6d70 6f72 7465 7228 290a 2020 2020 2020  mporter().      
-000119f0: 2020 496e 205b 325d 3a20 7072 696e 7428    In [2]: print(
-00011a00: 2862 3634 656e 636f 6465 2862 226b 6f61  (b64encode(b"koa
-00011a10: 6c61 2229 2c20 6236 3464 6563 6f64 6528  la"), b64decode(
-00011a20: 6222 6132 4675 5a32 4679 6232 383d 2229  b"a2FuZ2Fyb28=")
-00011a30: 2929 0a20 2020 2020 2020 205b 5059 464c  )).        [PYFL
-00011a40: 5942 595d 2066 726f 6d20 6261 7365 3634  YBY] from base64
-00011a50: 2069 6d70 6f72 7420 6236 3464 6563 6f64   import b64decod
-00011a60: 650a 2020 2020 2020 2020 5b50 5946 4c59  e.        [PYFLY
-00011a70: 4259 5d20 6672 6f6d 2062 6173 6536 3420  BY] from base64 
-00011a80: 696d 706f 7274 2062 3634 656e 636f 6465  import b64encode
-00011a90: 0a20 2020 2020 2020 2028 6227 6132 3968  .        (b'a29h
-00011aa0: 6247 453d 272c 2062 276b 616e 6761 726f  bGE=', b'kangaro
-00011ab0: 6f27 290a 2020 2020 2222 2229 0a0a 0a40  o').    """)...@
-00011ac0: 7265 7472 790a 6465 6620 7465 7374 5f61  retry.def test_a
-00011ad0: 7574 6f69 6d70 6f72 745f 6d75 6c74 696c  utoimport_multil
-00011ae0: 696e 655f 7374 6174 656d 656e 745f 3128  ine_statement_1(
-00011af0: 293a 0a20 2020 2069 7079 7468 6f6e 2822  ):.    ipython("
-00011b00: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
-00011b10: 5d3a 2069 6d70 6f72 7420 7079 666c 7962  ]: import pyflyb
-00011b20: 793b 2070 7966 6c79 6279 2e65 6e61 626c  y; pyflyby.enabl
-00011b30: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
-00011b40: 290a 2020 2020 2020 2020 496e 205b 325d  ).        In [2]
-00011b50: 3a20 6966 2031 3a0a 2020 2020 2020 2020  : if 1:.        
-00011b60: 2020 202e 2e2e 3a20 2020 2020 7072 696e     ...:     prin
-00011b70: 7428 6236 3464 6563 6f64 6528 6227 6448  t(b64decode(b'dH
-00011b80: 5679 6447 786c 2729 2e64 6563 6f64 6528  VydGxl').decode(
-00011b90: 2775 7466 2d38 2729 290a 2020 2020 2020  'utf-8')).      
-00011ba0: 2020 2020 202e 2e2e 3a0a 2020 2020 2020       ...:.      
-00011bb0: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
-00011bc0: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
-00011bd0: 3634 6465 636f 6465 0a20 2020 2020 2020  64decode.       
-00011be0: 2074 7572 746c 650a 2020 2020 2020 2020   turtle.        
-00011bf0: 496e 205b 335d 3a20 6966 2031 3a20 7072  In [3]: if 1: pr
-00011c00: 696e 7428 6236 3464 6563 6f64 6528 6227  int(b64decode(b'
-00011c10: 6247 4674 5951 3d3d 2729 2e64 6563 6f64  bGFtYQ==').decod
-00011c20: 6528 2775 7466 2d38 2729 290a 2020 2020  e('utf-8')).    
-00011c30: 2020 2020 6c61 6d61 0a20 2020 2022 2222      lama.    """
-00011c40: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
-00011c50: 6573 745f 6175 746f 696d 706f 7274 5f6d  est_autoimport_m
-00011c60: 756c 7469 6c69 6e65 5f63 6f6e 7469 6e75  ultiline_continu
-00011c70: 6564 5f73 7461 7465 6d65 6e74 5f31 2866  ed_statement_1(f
-00011c80: 726f 6e74 656e 6429 3a0a 2020 2020 6966  rontend):.    if
-00011c90: 2066 726f 6e74 656e 6420 3d3d 2022 7072   frontend == "pr
-00011ca0: 6f6d 7074 5f74 6f6f 6c6b 6974 223a 2070  ompt_toolkit": p
-00011cb0: 7974 6573 742e 736b 6970 2829 0a20 2020  ytest.skip().   
-00011cc0: 2069 7079 7468 6f6e 2822 2222 0a20 2020   ipython(""".   
-00011cd0: 2020 2020 2049 6e20 5b31 5d3a 2069 6d70       In [1]: imp
-00011ce0: 6f72 7420 7079 666c 7962 793b 2070 7966  ort pyflyby; pyf
-00011cf0: 6c79 6279 2e65 6e61 626c 655f 6175 746f  lyby.enable_auto
-00011d00: 5f69 6d70 6f72 7465 7228 290a 2020 2020  _importer().    
-00011d10: 2020 2020 496e 205b 325d 3a20 6966 2031      In [2]: if 1
-00011d20: 3a0a 2020 2020 2020 2020 2020 202e 2e2e  :.           ...
-00011d30: 3a20 2020 2020 2873 7973 2e0a 2020 2020  :     (sys..    
-00011d40: 2020 2020 2020 202e 2e2e 3a20 2020 2020         ...:     
-00011d50: 2020 2020 7374 646f 7574 0a20 2020 2020      stdout.     
-00011d60: 2020 2020 2020 2e2e 2e3a 2020 2020 2020        ...:      
-00011d70: 2020 2020 2020 202e 7772 6974 6528 0a20         .write(. 
-00011d80: 2020 2020 2020 2020 2020 2e2e 2e3a 2020            ...:  
-00011d90: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00011da0: 3634 6465 636f 6465 280a 2020 2020 2020  64decode(.      
-00011db0: 2020 2020 202e 2e2e 3a20 2020 2020 2020       ...:       
-00011dc0: 2020 2020 2020 2020 2020 2020 2020 2762                'b
-00011dd0: 576c 6a63 6d39 7761 4739 755a 513d 3d27  Wljcm9waG9uZQ=='
-00011de0: 2929 290a 2020 2020 2020 2020 2020 202e  ))).           .
-00011df0: 2e2e 3a0a 2020 2020 2020 2020 5b50 5946  ..:.        [PYF
-00011e00: 4c59 4259 5d20 6672 6f6d 2062 6173 6536  LYBY] from base6
-00011e10: 3420 696d 706f 7274 2062 3634 6465 636f  4 import b64deco
-00011e20: 6465 0a20 2020 2020 2020 205b 5059 464c  de.        [PYFL
-00011e30: 5942 595d 2069 6d70 6f72 7420 7379 730a  YBY] import sys.
-00011e40: 2020 2020 2020 2020 6d69 6372 6f70 686f          micropho
-00011e50: 6e65 0a20 2020 2020 2020 2049 6e20 5b33  ne.        In [3
-00011e60: 5d3a 2069 6620 313a 2073 7973 2e73 7464  ]: if 1: sys.std
-00011e70: 6f75 742e 7772 6974 6528 6236 3464 6563  out.write(b64dec
-00011e80: 6f64 6528 2762 4739 315a 484e 775a 5746  ode('bG91ZHNwZWF
-00011e90: 725a 5849 3d27 2929 0a20 2020 2020 2020  rZXI=')).       
-00011ea0: 206c 6f75 6473 7065 616b 6572 0a20 2020   loudspeaker.   
-00011eb0: 2022 2222 2c20 6672 6f6e 7465 6e64 3d66   """, frontend=f
-00011ec0: 726f 6e74 656e 6429 0a0a 0a40 7265 7472  rontend)...@retr
-00011ed0: 790a 6465 6620 7465 7374 5f61 7574 6f69  y.def test_autoi
-00011ee0: 6d70 6f72 745f 6d75 6c74 696c 696e 655f  mport_multiline_
-00011ef0: 636f 6e74 696e 7565 645f 7374 6174 656d  continued_statem
-00011f00: 656e 745f 6661 6b65 5f31 2866 726f 6e74  ent_fake_1(front
-00011f10: 656e 6429 3a0a 2020 2020 6966 2066 726f  end):.    if fro
-00011f20: 6e74 656e 6420 3d3d 2022 7072 6f6d 7074  ntend == "prompt
-00011f30: 5f74 6f6f 6c6b 6974 223a 2070 7974 6573  _toolkit": pytes
-00011f40: 742e 736b 6970 2829 0a20 2020 2069 7079  t.skip().    ipy
-00011f50: 7468 6f6e 2822 2222 0a20 2020 2020 2020  thon(""".       
-00011f60: 2049 6e20 5b31 5d3a 2069 6d70 6f72 7420   In [1]: import 
-00011f70: 7079 666c 7962 793b 2070 7966 6c79 6279  pyflyby; pyflyby
-00011f80: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
-00011f90: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
-00011fa0: 496e 205b 325d 3a20 6966 2031 3a0a 2020  In [2]: if 1:.  
-00011fb0: 2020 2020 2020 2020 202e 2e2e 3a20 2020           ...:   
-00011fc0: 2020 7072 696e 7428 756e 6b6e 6f77 6e5f    print(unknown_
-00011fd0: 7379 6d62 6f6c 5f33 3733 3230 3839 392e  symbol_37320899.
-00011fe0: 0a20 2020 2020 2020 2020 2020 2e2e 2e3a  .           ...:
-00011ff0: 2020 2020 2020 2020 2062 3634 656e 636f           b64enco
-00012000: 6465 0a20 2020 2020 2020 2020 2020 2e2e  de.           ..
-00012010: 2e3a 2020 2020 2020 2020 2029 0a20 2020  .:         ).   
-00012020: 2020 2020 2020 2020 2e2e 2e3a 0a20 2020          ...:.   
-00012030: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d       -----------
-00012040: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00012050: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00012060: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00012070: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00012080: 0a20 2020 2020 2020 204e 616d 6545 7272  .        NameErr
-00012090: 6f72 2020 2020 2020 2020 2020 2020 2020  or              
-000120a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000120b0: 2020 2054 7261 6365 6261 636b 2028 6d6f     Traceback (mo
-000120c0: 7374 2072 6563 656e 7420 6361 6c6c 206c  st recent call l
-000120d0: 6173 7429 0a20 2020 2020 2020 202e 2e2e  ast).        ...
-000120e0: 2e0a 2020 2020 2020 2020 4e61 6d65 4572  ..        NameEr
-000120f0: 726f 723a 206e 616d 6520 2775 6e6b 6e6f  ror: name 'unkno
-00012100: 776e 5f73 796d 626f 6c5f 3337 3332 3038  wn_symbol_373208
-00012110: 3939 2720 6973 206e 6f74 2064 6566 696e  99' is not defin
-00012120: 6564 0a20 2020 2020 2020 2049 6e20 5b33  ed.        In [3
-00012130: 5d3a 2069 6620 313a 0a20 2020 2020 2020  ]: if 1:.       
-00012140: 2020 2020 2e2e 2e3a 2020 2020 2070 7269      ...:     pri
-00012150: 6e74 2862 3634 656e 636f 6465 2862 2779  nt(b64encode(b'y
-00012160: 2729 2e64 6563 6f64 6528 2775 7466 2d38  ').decode('utf-8
-00012170: 2729 290a 2020 2020 2020 2020 2020 202e  ')).           .
-00012180: 2e2e 3a0a 2020 2020 2020 2020 5b50 5946  ..:.        [PYF
-00012190: 4c59 4259 5d20 6672 6f6d 2062 6173 6536  LYBY] from base6
-000121a0: 3420 696d 706f 7274 2062 3634 656e 636f  4 import b64enco
-000121b0: 6465 0a20 2020 2020 2020 2065 513d 3d0a  de.        eQ==.
-000121c0: 2020 2020 2020 2020 496e 205b 345d 3a20          In [4]: 
-000121d0: 6966 2031 3a20 7072 696e 7428 6236 3464  if 1: print(b64d
-000121e0: 6563 6f64 6528 2759 6d46 7a5a 574a 6862  ecode('YmFzZWJhb
-000121f0: 4777 3d27 292e 6465 636f 6465 2827 7574  Gw=').decode('ut
-00012200: 662d 3827 2929 0a20 2020 2020 2020 205b  f-8')).        [
-00012210: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
-00012220: 7365 3634 2069 6d70 6f72 7420 6236 3464  se64 import b64d
-00012230: 6563 6f64 650a 2020 2020 2020 2020 6261  ecode.        ba
-00012240: 7365 6261 6c6c 0a20 2020 2022 2222 2c20  seball.    """, 
-00012250: 6672 6f6e 7465 6e64 3d66 726f 6e74 656e  frontend=fronten
-00012260: 6429 0a0a 0a40 7265 7472 790a 6465 6620  d)...@retry.def 
-00012270: 7465 7374 5f61 7574 6f69 6d70 6f72 745f  test_autoimport_
-00012280: 7079 666c 7962 795f 7061 7468 5f31 2874  pyflyby_path_1(t
-00012290: 6d70 293a 0a20 2020 2077 7269 7465 7465  mp):.    writete
-000122a0: 7874 2874 6d70 2e66 696c 652c 2022 6672  xt(tmp.file, "fr
-000122b0: 6f6d 2069 7465 7274 6f6f 6c73 2069 6d70  om itertools imp
-000122c0: 6f72 7420 7072 6f64 7563 745c 6e22 290a  ort product\n").
-000122d0: 2020 2020 6970 7974 686f 6e28 0a20 2020      ipython(.   
-000122e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000122f0: 2049 6e20 5b31 5d3a 2069 6d70 6f72 7420   In [1]: import 
-00012300: 7079 666c 7962 793b 2070 7966 6c79 6279  pyflyby; pyflyby
-00012310: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
-00012320: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
-00012330: 496e 205b 325d 3a20 6c69 7374 2870 726f  In [2]: list(pro
-00012340: 6475 6374 2827 6162 272c 2763 6427 2929  duct('ab','cd'))
-00012350: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
-00012360: 595d 2066 726f 6d20 6974 6572 746f 6f6c  Y] from itertool
-00012370: 7320 696d 706f 7274 2070 726f 6475 6374  s import product
-00012380: 0a20 2020 2020 2020 204f 7574 5b32 5d3a  .        Out[2]:
-00012390: 205b 2827 6127 2c20 2763 2729 2c20 2827   [('a', 'c'), ('
-000123a0: 6127 2c20 2764 2729 2c20 2827 6227 2c20  a', 'd'), ('b', 
-000123b0: 2763 2729 2c20 2827 6227 2c20 2764 2729  'c'), ('b', 'd')
-000123c0: 5d0a 2020 2020 2020 2020 496e 205b 335d  ].        In [3]
-000123d0: 3a20 6772 6f75 7062 790a 2020 2020 2020  : groupby.      
-000123e0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d    --------------
-000123f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00012400: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00012410: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00012420: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
-00012430: 2020 2020 2020 4e61 6d65 4572 726f 7220        NameError 
-00012440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012460: 5472 6163 6562 6163 6b20 286d 6f73 7420  Traceback (most 
-00012470: 7265 6365 6e74 2063 616c 6c20 6c61 7374  recent call last
-00012480: 290a 2020 2020 2020 2020 2e2e 2e20 696e  ).        ... in
-00012490: 202e 2e2e 0a20 2020 2020 2020 204e 616d   ....        Nam
-000124a0: 6545 7272 6f72 3a20 6e61 6d65 2027 6772  eError: name 'gr
-000124b0: 6f75 7062 7927 2069 7320 6e6f 7420 6465  oupby' is not de
-000124c0: 6669 6e65 640a 2020 2020 2222 222c 0a20  fined.    """,. 
-000124d0: 2020 2020 2020 2050 5946 4c59 4259 5f50         PYFLYBY_P
-000124e0: 4154 483d 746d 702e 6669 6c65 2c0a 2020  ATH=tmp.file,.  
-000124f0: 2020 290a 0a0a 4072 6574 7279 0a64 6566    )...@retry.def
-00012500: 2074 6573 745f 6175 746f 696d 706f 7274   test_autoimport
-00012510: 5f61 7574 6f63 616c 6c5f 6172 675f 3128  _autocall_arg_1(
-00012520: 293a 0a20 2020 2023 2056 6572 6966 7920  ):.    # Verify 
-00012530: 7468 6174 2077 6520 6361 6e20 6175 746f  that we can auto
-00012540: 696d 706f 7274 2074 6865 2061 7267 756d  import the argum
-00012550: 656e 7420 6f66 2061 6e20 6175 746f 6361  ent of an autoca
-00012560: 6c6c 2e0a 2020 2020 6966 2050 5932 3a0a  ll..    if PY2:.
-00012570: 2020 2020 2020 2020 6970 7974 686f 6e28          ipython(
-00012580: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-00012590: 496e 205b 315d 3a20 696d 706f 7274 2070  In [1]: import p
-000125a0: 7966 6c79 6279 3b20 7079 666c 7962 792e  yflyby; pyflyby.
-000125b0: 656e 6162 6c65 5f61 7574 6f5f 696d 706f  enable_auto_impo
-000125c0: 7274 6572 2829 0a20 2020 2020 2020 2020  rter().         
-000125d0: 2020 2049 6e20 5b32 5d3a 2073 7472 2e75     In [2]: str.u
-000125e0: 7070 6572 2062 3634 6465 636f 6465 2827  pper b64decode('
-000125f0: 6132 5635 596d 3968 636d 513d 2729 0a20  a2V5Ym9hcmQ='). 
-00012600: 2020 2020 2020 2020 2020 202d 2d2d 2d2d             -----
-00012610: 2d3e 2073 7472 2e75 7070 6572 2862 3634  -> str.upper(b64
-00012620: 6465 636f 6465 2827 6132 5635 596d 3968  decode('a2V5Ym9h
-00012630: 636d 513d 2729 290a 2020 2020 2020 2020  cmQ=')).        
-00012640: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
-00012650: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
-00012660: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
-00012670: 2020 2020 2020 204f 7574 5b32 5d3a 2027         Out[2]: '
-00012680: 4b45 5942 4f41 5244 270a 2020 2020 2020  KEYBOARD'.      
-00012690: 2020 2222 222c 2061 7574 6f63 616c 6c3d    """, autocall=
-000126a0: 5472 7565 290a 2020 2020 656c 6966 2049  True).    elif I
-000126b0: 5079 7468 6f6e 2e76 6572 7369 6f6e 5f69  Python.version_i
-000126c0: 6e66 6f20 3c20 2837 2c20 3137 293a 0a20  nfo < (7, 17):. 
-000126d0: 2020 2020 2020 2023 2054 6865 2061 7574         # The aut
-000126e0: 6f63 616c 6c20 6172 726f 7773 2061 7265  ocall arrows are
-000126f0: 2070 7269 6e74 6564 2074 7769 6365 2069   printed twice i
-00012700: 6e20 6e65 7765 7220 7665 7273 696f 6e73  n newer versions
-00012710: 206f 6620 4950 7974 686f 6e0a 2020 2020   of IPython.    
-00012720: 2020 2020 2320 2868 7474 7073 3a2f 2f67      # (https://g
-00012730: 6974 6875 622e 636f 6d2f 6970 7974 686f  ithub.com/ipytho
-00012740: 6e2f 6970 7974 686f 6e2f 6973 7375 6573  n/ipython/issues
-00012750: 2f31 3137 3134 292e 0a20 2020 2020 2020  /11714)..       
-00012760: 2069 7079 7468 6f6e 2822 2222 0a20 2020   ipython(""".   
-00012770: 2020 2020 2020 2020 2049 6e20 5b31 5d3a           In [1]:
-00012780: 2069 6d70 6f72 7420 7079 666c 7962 793b   import pyflyby;
-00012790: 2070 7966 6c79 6279 2e65 6e61 626c 655f   pyflyby.enable_
-000127a0: 6175 746f 5f69 6d70 6f72 7465 7228 290a  auto_importer().
-000127b0: 2020 2020 2020 2020 2020 2020 496e 205b              In [
-000127c0: 325d 3a20 6279 7465 732e 7570 7065 7220  2]: bytes.upper 
-000127d0: 6236 3464 6563 6f64 6528 2761 3256 3559  b64decode('a2V5Y
-000127e0: 6d39 6863 6d51 3d27 290a 2020 2020 2020  m9hcmQ=').      
-000127f0: 2020 2020 2020 2d2d 2d2d 2d2d 3e20 6279        ------> by
-00012800: 7465 732e 7570 7065 7228 6236 3464 6563  tes.upper(b64dec
-00012810: 6f64 6528 2761 3256 3559 6d39 6863 6d51  ode('a2V5Ym9hcmQ
-00012820: 3d27 2929 0a20 2020 2020 2020 2020 2020  =')).           
-00012830: 202d 2d2d 2d2d 2d3e 2062 7974 6573 2e75   ------> bytes.u
-00012840: 7070 6572 2862 3634 6465 636f 6465 2827  pper(b64decode('
-00012850: 6132 5635 596d 3968 636d 513d 2729 290a  a2V5Ym9hcmQ=')).
-00012860: 2020 2020 2020 2020 2020 2020 5b50 5946              [PYF
-00012870: 4c59 4259 5d20 6672 6f6d 2062 6173 6536  LYBY] from base6
-00012880: 3420 696d 706f 7274 2062 3634 6465 636f  4 import b64deco
-00012890: 6465 0a20 2020 2020 2020 2020 2020 204f  de.            O
-000128a0: 7574 5b32 5d3a 2062 274b 4559 424f 4152  ut[2]: b'KEYBOAR
-000128b0: 4427 0a20 2020 2020 2020 2022 2222 2c20  D'.        """, 
-000128c0: 6175 746f 6361 6c6c 3d54 7275 6529 0a20  autocall=True). 
-000128d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000128e0: 2069 7079 7468 6f6e 2822 2222 0a20 2020   ipython(""".   
-000128f0: 2020 2020 2020 2020 2049 6e20 5b31 5d3a           In [1]:
-00012900: 2069 6d70 6f72 7420 7079 666c 7962 793b   import pyflyby;
-00012910: 2070 7966 6c79 6279 2e65 6e61 626c 655f   pyflyby.enable_
-00012920: 6175 746f 5f69 6d70 6f72 7465 7228 290a  auto_importer().
-00012930: 2020 2020 2020 2020 2020 2020 496e 205b              In [
-00012940: 325d 3a20 6279 7465 732e 7570 7065 7220  2]: bytes.upper 
-00012950: 6236 3464 6563 6f64 6528 2761 3256 3559  b64decode('a2V5Y
-00012960: 6d39 6863 6d51 3d27 290a 2020 2020 2020  m9hcmQ=').      
-00012970: 2020 2020 2020 2d2d 2d2d 2d2d 3e20 6279        ------> by
-00012980: 7465 732e 7570 7065 7228 6236 3464 6563  tes.upper(b64dec
-00012990: 6f64 6528 2761 3256 3559 6d39 6863 6d51  ode('a2V5Ym9hcmQ
-000129a0: 3d27 2929 0a20 2020 2020 2020 2020 2020  =')).           
-000129b0: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
-000129c0: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
-000129d0: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
-000129e0: 2020 2020 4f75 745b 325d 3a20 6227 4b45      Out[2]: b'KE
-000129f0: 5942 4f41 5244 270a 2020 2020 2020 2020  YBOARD'.        
-00012a00: 2222 222c 2061 7574 6f63 616c 6c3d 5472  """, autocall=Tr
-00012a10: 7565 290a 0a40 7265 7472 790a 6465 6620  ue)..@retry.def 
-00012a20: 7465 7374 5f61 7574 6f69 6d70 6f72 745f  test_autoimport_
-00012a30: 6175 746f 6361 6c6c 5f66 756e 6374 696f  autocall_functio
-00012a40: 6e5f 3128 293a 0a20 2020 2023 2056 6572  n_1():.    # Ver
-00012a50: 6966 7920 7468 6174 2077 6520 6361 6e20  ify that we can 
-00012a60: 6175 746f 696d 706f 7274 2074 6865 2066  autoimport the f
-00012a70: 756e 6374 696f 6e20 746f 2061 7574 6f63  unction to autoc
-00012a80: 616c 6c2e 0a20 2020 2069 6620 5059 323a  all..    if PY2:
-00012a90: 0a20 2020 2020 2020 2069 7079 7468 6f6e  .        ipython
-00012aa0: 2822 2222 0a20 2020 2020 2020 2020 2020  (""".           
-00012ab0: 2049 6e20 5b31 5d3a 2069 6d70 6f72 7420   In [1]: import 
-00012ac0: 7079 666c 7962 793b 2070 7966 6c79 6279  pyflyby; pyflyby
-00012ad0: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
-00012ae0: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
-00012af0: 2020 2020 496e 205b 325d 3a20 6236 3464      In [2]: b64d
-00012b00: 6563 6f64 6520 2762 5739 3163 3255 3d27  ecode 'bW91c2U='
-00012b10: 0a20 2020 2020 2020 2020 2020 205b 5059  .            [PY
-00012b20: 464c 5942 595d 2066 726f 6d20 6261 7365  FLYBY] from base
-00012b30: 3634 2069 6d70 6f72 7420 6236 3464 6563  64 import b64dec
-00012b40: 6f64 650a 2020 2020 2020 2020 2020 2020  ode.            
-00012b50: 2d2d 2d2d 2d2d 3e20 6236 3464 6563 6f64  ------> b64decod
-00012b60: 6528 2762 5739 3163 3255 3d27 290a 2020  e('bW91c2U=').  
-00012b70: 2020 2020 2020 2020 2020 4f75 745b 325d            Out[2]
-00012b80: 3a20 276d 6f75 7365 270a 2020 2020 2020  : 'mouse'.      
-00012b90: 2020 2222 222c 2061 7574 6f63 616c 6c3d    """, autocall=
-00012ba0: 5472 7565 290a 2020 2020 656c 6966 2049  True).    elif I
-00012bb0: 5079 7468 6f6e 2e76 6572 7369 6f6e 5f69  Python.version_i
-00012bc0: 6e66 6f20 3c20 2837 2c20 3137 293a 0a20  nfo < (7, 17):. 
-00012bd0: 2020 2020 2020 2023 2054 6865 2061 7574         # The aut
-00012be0: 6f63 616c 6c20 6172 726f 7773 2061 7265  ocall arrows are
-00012bf0: 2070 7269 6e74 6564 2074 7769 6365 2069   printed twice i
-00012c00: 6e20 6e65 7765 7220 7665 7273 696f 6e73  n newer versions
-00012c10: 206f 6620 4950 7974 686f 6e0a 2020 2020   of IPython.    
-00012c20: 2020 2020 2320 2868 7474 7073 3a2f 2f67      # (https://g
-00012c30: 6974 6875 622e 636f 6d2f 6970 7974 686f  ithub.com/ipytho
-00012c40: 6e2f 6970 7974 686f 6e2f 6973 7375 6573  n/ipython/issues
-00012c50: 2f31 3137 3134 292e 0a20 2020 2020 2020  /11714)..       
-00012c60: 2069 7079 7468 6f6e 2822 2222 0a20 2020   ipython(""".   
-00012c70: 2020 2020 2020 2020 2049 6e20 5b31 5d3a           In [1]:
-00012c80: 2069 6d70 6f72 7420 7079 666c 7962 793b   import pyflyby;
-00012c90: 2070 7966 6c79 6279 2e65 6e61 626c 655f   pyflyby.enable_
-00012ca0: 6175 746f 5f69 6d70 6f72 7465 7228 290a  auto_importer().
-00012cb0: 2020 2020 2020 2020 2020 2020 496e 205b              In [
-00012cc0: 325d 3a20 6236 3464 6563 6f64 6520 2762  2]: b64decode 'b
-00012cd0: 5739 3163 3255 3d27 0a20 2020 2020 2020  W91c2U='.       
-00012ce0: 2020 2020 205b 5059 464c 5942 595d 2066       [PYFLYBY] f
-00012cf0: 726f 6d20 6261 7365 3634 2069 6d70 6f72  rom base64 impor
-00012d00: 7420 6236 3464 6563 6f64 650a 2020 2020  t b64decode.    
-00012d10: 2020 2020 2020 2020 2d2d 2d2d 2d2d 3e20          ------> 
-00012d20: 6236 3464 6563 6f64 6528 2762 5739 3163  b64decode('bW91c
-00012d30: 3255 3d27 290a 2020 2020 2020 2020 2020  2U=').          
-00012d40: 2020 2d2d 2d2d 2d2d 3e20 6236 3464 6563    ------> b64dec
-00012d50: 6f64 6528 2762 5739 3163 3255 3d27 290a  ode('bW91c2U=').
-00012d60: 2020 2020 2020 2020 2020 2020 4f75 745b              Out[
-00012d70: 325d 3a20 6227 6d6f 7573 6527 0a20 2020  2]: b'mouse'.   
-00012d80: 2020 2020 2022 2222 2c20 6175 746f 6361       """, autoca
-00012d90: 6c6c 3d54 7275 6529 0a20 2020 2065 6c73  ll=True).    els
-00012da0: 653a 0a20 2020 2020 2020 2069 7079 7468  e:.        ipyth
-00012db0: 6f6e 2822 2222 0a20 2020 2020 2020 2020  on(""".         
-00012dc0: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
-00012dd0: 7420 7079 666c 7962 793b 2070 7966 6c79  t pyflyby; pyfly
-00012de0: 6279 2e65 6e61 626c 655f 6175 746f 5f69  by.enable_auto_i
-00012df0: 6d70 6f72 7465 7228 290a 2020 2020 2020  mporter().      
-00012e00: 2020 2020 2020 496e 205b 325d 3a20 6236        In [2]: b6
-00012e10: 3464 6563 6f64 6520 2762 5739 3163 3255  4decode 'bW91c2U
-00012e20: 3d27 0a20 2020 2020 2020 2020 2020 205b  ='.            [
-00012e30: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
-00012e40: 7365 3634 2069 6d70 6f72 7420 6236 3464  se64 import b64d
-00012e50: 6563 6f64 650a 2020 2020 2020 2020 2020  ecode.          
-00012e60: 2020 2d2d 2d2d 2d2d 3e20 6236 3464 6563    ------> b64dec
-00012e70: 6f64 6528 2762 5739 3163 3255 3d27 290a  ode('bW91c2U=').
-00012e80: 2020 2020 2020 2020 2020 2020 4f75 745b              Out[
-00012e90: 325d 3a20 6227 6d6f 7573 6527 0a20 2020  2]: b'mouse'.   
-00012ea0: 2020 2020 2022 2222 2c20 6175 746f 6361       """, autoca
-00012eb0: 6c6c 3d54 7275 6529 0a0a 4072 6574 7279  ll=True)..@retry
-00012ec0: 0a64 6566 2074 6573 745f 6175 746f 696d  .def test_autoim
-00012ed0: 706f 7274 5f6d 756c 7469 706c 655f 6361  port_multiple_ca
-00012ee0: 6e64 6964 6174 6573 5f61 7374 5f74 7261  ndidates_ast_tra
-00012ef0: 6e73 666f 726d 6572 5f31 2874 6d70 293a  nsformer_1(tmp):
-00012f00: 0a20 2020 2023 2056 6572 6966 7920 7468  .    # Verify th
-00012f10: 6174 2077 6520 7072 696e 7420 6f75 7420  at we print out 
-00012f20: 616c 6c20 6361 6e64 6964 6174 6520 6175  all candidate au
-00012f30: 746f 696d 706f 7274 732c 2077 6865 6e20  toimports, when 
-00012f40: 7468 6572 6520 6172 650a 2020 2020 2320  there are.    # 
-00012f50: 6d75 6c74 6970 6c65 2e0a 2020 2020 7772  multiple..    wr
-00012f60: 6974 6574 6578 7428 0a20 2020 2020 2020  itetext(.       
-00012f70: 2074 6d70 2e66 696c 652c 0a20 2020 2020   tmp.file,.     
-00012f80: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00012f90: 6d70 6f72 7420 666f 6f32 3335 3936 3236  mport foo2359626
-00012fa0: 3720 6173 2062 6172 0a20 2020 2020 2020  7 as bar.       
-00012fb0: 2069 6d70 6f72 7420 666f 6f35 3038 3533   import foo50853
-00012fc0: 3432 3920 6173 2062 6172 0a20 2020 2020  429 as bar.     
-00012fd0: 2020 2069 6d70 6f72 7420 666f 6f34 3739     import foo479
-00012fe0: 3739 3838 3220 6173 2062 6172 0a20 2020  79882 as bar.   
-00012ff0: 2022 2222 2c0a 2020 2020 290a 2020 2020   """,.    ).    
-00013000: 6970 7974 686f 6e28 0a20 2020 2020 2020  ipython(.       
-00013010: 2022 2222 0a20 2020 2020 2020 2049 6e20   """.        In 
-00013020: 5b31 5d3a 2069 6d70 6f72 7420 7079 666c  [1]: import pyfl
-00013030: 7962 793b 2070 7966 6c79 6279 2e65 6e61  yby; pyflyby.ena
-00013040: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
-00013050: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
-00013060: 325d 3a20 6261 7228 3432 290a 2020 2020  2]: bar(42).    
-00013070: 2020 2020 5b50 5946 4c59 4259 5d20 4d75      [PYFLYBY] Mu
-00013080: 6c74 6970 6c65 2063 616e 6469 6461 7465  ltiple candidate
-00013090: 2069 6d70 6f72 7473 2066 6f72 2062 6172   imports for bar
-000130a0: 2e20 2050 6c65 6173 6520 7069 636b 206f  .  Please pick o
-000130b0: 6e65 3a0a 2020 2020 2020 2020 5b50 5946  ne:.        [PYF
-000130c0: 4c59 4259 5d20 2020 696d 706f 7274 2066  LYBY]   import f
-000130d0: 6f6f 3233 3539 3632 3637 2061 7320 6261  oo23596267 as ba
-000130e0: 720a 2020 2020 2020 2020 5b50 5946 4c59  r.        [PYFLY
-000130f0: 4259 5d20 2020 696d 706f 7274 2066 6f6f  BY]   import foo
-00013100: 3437 3937 3938 3832 2061 7320 6261 720a  47979882 as bar.
-00013110: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
-00013120: 5d20 2020 696d 706f 7274 2066 6f6f 3530  ]   import foo50
-00013130: 3835 3334 3239 2061 7320 6261 720a 2020  853429 as bar.  
-00013140: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00013150: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013160: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013170: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013180: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013190: 2d0a 2020 2020 2020 2020 4e61 6d65 4572  -.        NameEr
-000131a0: 726f 7220 2020 2020 2020 2020 2020 2020  ror             
-000131b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131c0: 2020 2020 5472 6163 6562 6163 6b20 286d      Traceback (m
-000131d0: 6f73 7420 7265 6365 6e74 2063 616c 6c20  ost recent call 
-000131e0: 6c61 7374 290a 2020 2020 2020 2020 2e2e  last).        ..
-000131f0: 2e20 696e 202e 2e2e 0a20 2020 2020 2020  . in ....       
-00013200: 204e 616d 6545 7272 6f72 3a20 6e61 6d65   NameError: name
-00013210: 2027 6261 7227 2069 7320 6e6f 7420 6465   'bar' is not de
-00013220: 6669 6e65 640a 2020 2020 2222 222c 0a20  fined.    """,. 
-00013230: 2020 2020 2020 2050 5946 4c59 4259 5f50         PYFLYBY_P
-00013240: 4154 483d 746d 702e 6669 6c65 2c0a 2020  ATH=tmp.file,.  
-00013250: 2020 290a 0a0a 4072 6574 7279 0a64 6566    )...@retry.def
-00013260: 2074 6573 745f 6175 746f 696d 706f 7274   test_autoimport
-00013270: 5f6d 756c 7469 706c 655f 6361 6e64 6964  _multiple_candid
-00013280: 6174 6573 5f72 6570 6561 7465 645f 3128  ates_repeated_1(
-00013290: 746d 7029 3a0a 2020 2020 2320 5665 7269  tmp):.    # Veri
-000132a0: 6679 2074 6861 7420 7765 2070 7269 6e74  fy that we print
-000132b0: 206f 7574 2074 6865 2063 616e 6469 6461   out the candida
-000132c0: 7465 206c 6973 7420 666f 7220 616e 6f74  te list for anot
-000132d0: 6865 7220 6365 6c6c 2e0a 2020 2020 7772  her cell..    wr
-000132e0: 6974 6574 6578 7428 0a20 2020 2020 2020  itetext(.       
-000132f0: 2074 6d70 2e66 696c 652c 0a20 2020 2020   tmp.file,.     
-00013300: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00013310: 6d70 6f72 7420 666f 6f37 3036 3033 3234  mport foo7060324
-00013320: 3720 6173 2062 6172 0a20 2020 2020 2020  7 as bar.       
-00013330: 2069 6d70 6f72 7420 666f 6f33 3137 3033   import foo31703
-00013340: 3732 3220 6173 2062 6172 0a20 2020 2022  722 as bar.    "
-00013350: 2222 2c0a 2020 2020 290a 2020 2020 6970  "",.    ).    ip
-00013360: 7974 686f 6e28 0a20 2020 2020 2020 2022  ython(.        "
-00013370: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
-00013380: 5d3a 2069 6d70 6f72 7420 7079 666c 7962  ]: import pyflyb
-00013390: 793b 2070 7966 6c79 6279 2e65 6e61 626c  y; pyflyby.enabl
-000133a0: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
-000133b0: 290a 2020 2020 2020 2020 496e 205b 325d  ).        In [2]
-000133c0: 3a20 6261 7228 3432 290a 2020 2020 2020  : bar(42).      
-000133d0: 2020 5b50 5946 4c59 4259 5d20 4d75 6c74    [PYFLYBY] Mult
-000133e0: 6970 6c65 2063 616e 6469 6461 7465 2069  iple candidate i
-000133f0: 6d70 6f72 7473 2066 6f72 2062 6172 2e20  mports for bar. 
-00013400: 2050 6c65 6173 6520 7069 636b 206f 6e65   Please pick one
-00013410: 3a0a 2020 2020 2020 2020 5b50 5946 4c59  :.        [PYFLY
-00013420: 4259 5d20 2020 696d 706f 7274 2066 6f6f  BY]   import foo
-00013430: 3331 3730 3337 3232 2061 7320 6261 720a  31703722 as bar.
-00013440: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
-00013450: 5d20 2020 696d 706f 7274 2066 6f6f 3730  ]   import foo70
-00013460: 3630 3332 3437 2061 7320 6261 720a 2020  603247 as bar.  
-00013470: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00013480: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013490: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000134a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000134b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000134c0: 2d0a 2020 2020 2020 2020 4e61 6d65 4572  -.        NameEr
-000134d0: 726f 7220 2020 2020 2020 2020 2020 2020  ror             
-000134e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134f0: 2020 2020 5472 6163 6562 6163 6b20 286d      Traceback (m
-00013500: 6f73 7420 7265 6365 6e74 2063 616c 6c20  ost recent call 
-00013510: 6c61 7374 290a 2020 2020 2020 2020 2e2e  last).        ..
-00013520: 2e20 696e 202e 2e2e 0a20 2020 2020 2020  . in ....       
-00013530: 204e 616d 6545 7272 6f72 3a20 6e61 6d65   NameError: name
-00013540: 2027 6261 7227 2069 7320 6e6f 7420 6465   'bar' is not de
-00013550: 6669 6e65 640a 2020 2020 2020 2020 496e  fined.        In
-00013560: 205b 335d 3a20 6261 7228 3432 290a 2020   [3]: bar(42).  
-00013570: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
-00013580: 4d75 6c74 6970 6c65 2063 616e 6469 6461  Multiple candida
-00013590: 7465 2069 6d70 6f72 7473 2066 6f72 2062  te imports for b
-000135a0: 6172 2e20 2050 6c65 6173 6520 7069 636b  ar.  Please pick
-000135b0: 206f 6e65 3a0a 2020 2020 2020 2020 5b50   one:.        [P
-000135c0: 5946 4c59 4259 5d20 2020 696d 706f 7274  YFLYBY]   import
-000135d0: 2066 6f6f 3331 3730 3337 3232 2061 7320   foo31703722 as 
-000135e0: 6261 720a 2020 2020 2020 2020 5b50 5946  bar.        [PYF
-000135f0: 4c59 4259 5d20 2020 696d 706f 7274 2066  LYBY]   import f
-00013600: 6f6f 3730 3630 3332 3437 2061 7320 6261  oo70603247 as ba
-00013610: 720a 2020 2020 2020 2020 2d2d 2d2d 2d2d  r.        ------
-00013620: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013640: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013650: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013660: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4e61  -----.        Na
-00013670: 6d65 4572 726f 7220 2020 2020 2020 2020  meError         
-00013680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013690: 2020 2020 2020 2020 5472 6163 6562 6163          Tracebac
-000136a0: 6b20 286d 6f73 7420 7265 6365 6e74 2063  k (most recent c
-000136b0: 616c 6c20 6c61 7374 290a 2020 2020 2020  all last).      
-000136c0: 2020 2e2e 2e20 696e 202e 2e2e 0a20 2020    ... in ....   
-000136d0: 2020 2020 204e 616d 6545 7272 6f72 3a20       NameError: 
-000136e0: 6e61 6d65 2027 6261 7227 2069 7320 6e6f  name 'bar' is no
-000136f0: 7420 6465 6669 6e65 640a 2020 2020 2222  t defined.    ""
-00013700: 222c 0a20 2020 2020 2020 2050 5946 4c59  ",.        PYFLY
-00013710: 4259 5f50 4154 483d 746d 702e 6669 6c65  BY_PATH=tmp.file
-00013720: 2c0a 2020 2020 290a 0a0a 4072 6574 7279  ,.    )...@retry
-00013730: 0a64 6566 2074 6573 745f 6175 746f 696d  .def test_autoim
-00013740: 706f 7274 5f6d 756c 7469 706c 655f 6361  port_multiple_ca
-00013750: 6e64 6964 6174 6573 5f6d 756c 7469 706c  ndidates_multipl
-00013760: 655f 696e 5f65 7870 7265 7373 696f 6e5f  e_in_expression_
-00013770: 3128 746d 7029 3a0a 2020 2020 2320 5665  1(tmp):.    # Ve
-00013780: 7269 6679 2074 6861 7420 6966 2061 6e20  rify that if an 
-00013790: 6578 7072 6573 7369 6f6e 2063 6f6e 7461  expression conta
-000137a0: 696e 7320 6d75 6c74 6970 6c65 2061 6d62  ins multiple amb
-000137b0: 6967 756f 7573 2069 6d70 6f72 7473 2c20  iguous imports, 
-000137c0: 7765 0a20 2020 2023 2072 6570 6f72 7420  we.    # report 
-000137d0: 6561 6368 206f 6e65 2e0a 2020 2020 7772  each one..    wr
-000137e0: 6974 6574 6578 7428 0a20 2020 2020 2020  itetext(.       
-000137f0: 2074 6d70 2e66 696c 652c 0a20 2020 2020   tmp.file,.     
-00013800: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00013810: 6d70 6f72 7420 666f 6f38 3539 3537 3831  mport foo8595781
-00013820: 3020 6173 2066 6f6f 0a20 2020 2020 2020  0 as foo.       
-00013830: 2069 6d70 6f72 7420 666f 6f33 3534 3833   import foo35483
-00013840: 3931 3820 6173 2066 6f6f 0a20 2020 2020  918 as foo.     
-00013850: 2020 2069 6d70 6f72 7420 6261 7232 3532     import bar252
-00013860: 3930 3030 3220 6173 2062 6172 0a20 2020  90002 as bar.   
-00013870: 2020 2020 2069 6d70 6f72 7420 6261 7233       import bar3
-00013880: 3631 3636 3330 3820 6173 2062 6172 0a20  6166308 as bar. 
-00013890: 2020 2022 2222 2c0a 2020 2020 290a 2020     """,.    ).  
-000138a0: 2020 6970 7974 686f 6e28 0a20 2020 2020    ipython(.     
-000138b0: 2020 2022 2222 0a20 2020 2020 2020 2049     """.        I
-000138c0: 6e20 5b31 5d3a 2069 6d70 6f72 7420 7079  n [1]: import py
-000138d0: 666c 7962 793b 2070 7966 6c79 6279 2e65  flyby; pyflyby.e
-000138e0: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
-000138f0: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
-00013900: 205b 325d 3a20 666f 6f2b 6261 720a 2020   [2]: foo+bar.  
-00013910: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
-00013920: 4d75 6c74 6970 6c65 2063 616e 6469 6461  Multiple candida
-00013930: 7465 2069 6d70 6f72 7473 2066 6f72 2062  te imports for b
-00013940: 6172 2e20 2050 6c65 6173 6520 7069 636b  ar.  Please pick
-00013950: 206f 6e65 3a0a 2020 2020 2020 2020 5b50   one:.        [P
-00013960: 5946 4c59 4259 5d20 2020 696d 706f 7274  YFLYBY]   import
-00013970: 2062 6172 3235 3239 3030 3032 2061 7320   bar25290002 as 
-00013980: 6261 720a 2020 2020 2020 2020 5b50 5946  bar.        [PYF
-00013990: 4c59 4259 5d20 2020 696d 706f 7274 2062  LYBY]   import b
-000139a0: 6172 3336 3136 3633 3038 2061 7320 6261  ar36166308 as ba
-000139b0: 720a 2020 2020 2020 2020 5b50 5946 4c59  r.        [PYFLY
-000139c0: 4259 5d20 4d75 6c74 6970 6c65 2063 616e  BY] Multiple can
-000139d0: 6469 6461 7465 2069 6d70 6f72 7473 2066  didate imports f
-000139e0: 6f72 2066 6f6f 2e20 2050 6c65 6173 6520  or foo.  Please 
-000139f0: 7069 636b 206f 6e65 3a0a 2020 2020 2020  pick one:.      
-00013a00: 2020 5b50 5946 4c59 4259 5d20 2020 696d    [PYFLYBY]   im
-00013a10: 706f 7274 2066 6f6f 3335 3438 3339 3138  port foo35483918
-00013a20: 2061 7320 666f 6f0a 2020 2020 2020 2020   as foo.        
-00013a30: 5b50 5946 4c59 4259 5d20 2020 696d 706f  [PYFLYBY]   impo
-00013a40: 7274 2066 6f6f 3835 3935 3738 3130 2061  rt foo85957810 a
-00013a50: 7320 666f 6f0a 2020 2020 2020 2020 2d2d  s foo.        --
-00013a60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013a70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013a80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013a90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013aa0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00013ab0: 2020 4e61 6d65 4572 726f 7220 2020 2020    NameError     
-00013ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ad0: 2020 2020 2020 2020 2020 2020 5472 6163              Trac
-00013ae0: 6562 6163 6b20 286d 6f73 7420 7265 6365  eback (most rece
-00013af0: 6e74 2063 616c 6c20 6c61 7374 290a 2020  nt call last).  
-00013b00: 2020 2020 2020 2e2e 2e20 696e 202e 2e2e        ... in ...
-00013b10: 0a20 2020 2020 2020 204e 616d 6545 7272  .        NameErr
-00013b20: 6f72 3a20 6e61 6d65 2027 666f 6f27 2069  or: name 'foo' i
-00013b30: 7320 6e6f 7420 6465 6669 6e65 640a 2020  s not defined.  
-00013b40: 2020 2222 222c 0a20 2020 2020 2020 2050    """,.        P
-00013b50: 5946 4c59 4259 5f50 4154 483d 746d 702e  YFLYBY_PATH=tmp.
-00013b60: 6669 6c65 2c0a 2020 2020 290a 0a0a 4072  file,.    )...@r
-00013b70: 6574 7279 0a64 6566 2074 6573 745f 6175  etry.def test_au
-00013b80: 746f 696d 706f 7274 5f6d 756c 7469 706c  toimport_multipl
-00013b90: 655f 6361 6e64 6964 6174 6573 5f72 6570  e_candidates_rep
-00013ba0: 6561 7465 645f 696e 5f65 7870 7265 7373  eated_in_express
-00013bb0: 696f 6e5f 3128 746d 7029 3a0a 2020 2020  ion_1(tmp):.    
-00013bc0: 2320 5665 7269 6679 2074 6861 7420 6966  # Verify that if
-00013bd0: 2061 6e20 6578 7072 6573 7369 6f6e 2063   an expression c
-00013be0: 6f6e 7461 696e 7320 616e 2061 6d62 6967  ontains an ambig
-00013bf0: 756f 7573 2069 6d70 6f72 7420 7477 6963  uous import twic
-00013c00: 652c 2077 6520 6f6e 6c79 0a20 2020 2023  e, we only.    #
-00013c10: 2072 6570 6f72 7420 6974 206f 6e63 652e   report it once.
-00013c20: 0a20 2020 2077 7269 7465 7465 7874 280a  .    writetext(.
-00013c30: 2020 2020 2020 2020 746d 702e 6669 6c65          tmp.file
-00013c40: 2c0a 2020 2020 2020 2020 2222 220a 2020  ,.        """.  
-00013c50: 2020 2020 2020 696d 706f 7274 2066 6f6f        import foo
-00013c60: 3833 3935 3834 3932 2061 7320 6261 720a  83958492 as bar.
-00013c70: 2020 2020 2020 2020 696d 706f 7274 2066          import f
-00013c80: 6f6f 3239 3433 3236 3638 2061 7320 6261  oo29432668 as ba
-00013c90: 720a 2020 2020 2222 222c 0a20 2020 2029  r.    """,.    )
-00013ca0: 0a20 2020 2069 7079 7468 6f6e 280a 2020  .    ipython(.  
-00013cb0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00013cc0: 2020 496e 205b 315d 3a20 696d 706f 7274    In [1]: import
-00013cd0: 2070 7966 6c79 6279 3b20 7079 666c 7962   pyflyby; pyflyb
-00013ce0: 792e 656e 6162 6c65 5f61 7574 6f5f 696d  y.enable_auto_im
-00013cf0: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
-00013d00: 2049 6e20 5b32 5d3a 2062 6172 2b62 6172   In [2]: bar+bar
-00013d10: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
-00013d20: 595d 204d 756c 7469 706c 6520 6361 6e64  Y] Multiple cand
-00013d30: 6964 6174 6520 696d 706f 7274 7320 666f  idate imports fo
-00013d40: 7220 6261 722e 2020 506c 6561 7365 2070  r bar.  Please p
-00013d50: 6963 6b20 6f6e 653a 0a20 2020 2020 2020  ick one:.       
-00013d60: 205b 5059 464c 5942 595d 2020 2069 6d70   [PYFLYBY]   imp
-00013d70: 6f72 7420 666f 6f32 3934 3332 3636 3820  ort foo29432668 
-00013d80: 6173 2062 6172 0a20 2020 2020 2020 205b  as bar.        [
-00013d90: 5059 464c 5942 595d 2020 2069 6d70 6f72  PYFLYBY]   impor
-00013da0: 7420 666f 6f38 3339 3538 3439 3220 6173  t foo83958492 as
-00013db0: 2062 6172 0a20 2020 2020 2020 202d 2d2d   bar.        ---
-00013dc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013dd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013de0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013df0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013e00: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00013e10: 204e 616d 6545 7272 6f72 2020 2020 2020   NameError      
-00013e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e30: 2020 2020 2020 2020 2020 2054 7261 6365             Trace
-00013e40: 6261 636b 2028 6d6f 7374 2072 6563 656e  back (most recen
-00013e50: 7420 6361 6c6c 206c 6173 7429 0a20 2020  t call last).   
-00013e60: 2020 2020 202e 2e2e 2069 6e20 2e2e 2e0a       ... in ....
-00013e70: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
-00013e80: 723a 206e 616d 6520 2762 6172 2720 6973  r: name 'bar' is
-00013e90: 206e 6f74 2064 6566 696e 6564 0a20 2020   not defined.   
-00013ea0: 2022 2222 2c0a 2020 2020 2020 2020 5059   """,.        PY
-00013eb0: 464c 5942 595f 5041 5448 3d74 6d70 2e66  FLYBY_PATH=tmp.f
-00013ec0: 696c 652c 0a20 2020 2029 0a0a 0a40 7265  ile,.    )...@re
-00013ed0: 7472 790a 6465 6620 7465 7374 5f61 7574  try.def test_aut
-00013ee0: 6f69 6d70 6f72 745f 6d75 6c74 6970 6c65  oimport_multiple
-00013ef0: 5f63 616e 6469 6461 7465 735f 6f66 696e  _candidates_ofin
-00013f00: 645f 3128 746d 7029 3a0a 2020 2020 2320  d_1(tmp):.    # 
-00013f10: 5665 7269 6679 2074 6861 7420 7468 6520  Verify that the 
-00013f20: 6d75 6c74 692d 6361 6e64 6964 6174 6520  multi-candidate 
-00013f30: 6d65 6e75 2077 6f72 6b73 2065 7665 6e20  menu works even 
-00013f40: 7769 7468 206f 6669 6e64 2e0a 2020 2020  with ofind..    
-00013f50: 7772 6974 6574 6578 7428 746d 702e 6669  writetext(tmp.fi
-00013f60: 6c65 2c20 2222 220a 2020 2020 2020 2020  le, """.        
-00013f70: 696d 706f 7274 2066 6f6f 3435 3431 3535  import foo454155
-00013f80: 3533 2061 7320 6261 720a 2020 2020 2020  53 as bar.      
-00013f90: 2020 696d 706f 7274 2066 6f6f 3337 3437    import foo3747
-00013fa0: 3238 3039 2061 7320 6261 720a 2020 2020  2809 as bar.    
-00013fb0: 2222 2229 0a20 2020 2069 7079 7468 6f6e  """).    ipython
-00013fc0: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
-00013fd0: 5b31 5d3a 2069 6d70 6f72 7420 7079 666c  [1]: import pyfl
-00013fe0: 7962 793b 2070 7966 6c79 6279 2e65 6e61  yby; pyflyby.ena
-00013ff0: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
-00014000: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
-00014010: 325d 3a20 6261 723f 0a20 2020 2020 2020  2]: bar?.       
-00014020: 205b 5059 464c 5942 595d 204d 756c 7469   [PYFLYBY] Multi
-00014030: 706c 6520 6361 6e64 6964 6174 6520 696d  ple candidate im
-00014040: 706f 7274 7320 666f 7220 6261 722e 2020  ports for bar.  
-00014050: 506c 6561 7365 2070 6963 6b20 6f6e 653a  Please pick one:
-00014060: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
-00014070: 595d 2020 2069 6d70 6f72 7420 666f 6f33  Y]   import foo3
-00014080: 3734 3732 3830 3920 6173 2062 6172 0a20  7472809 as bar. 
-00014090: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
-000140a0: 2020 2069 6d70 6f72 7420 666f 6f34 3534     import foo454
-000140b0: 3135 3535 3320 6173 2062 6172 0a20 2020  15553 as bar.   
-000140c0: 2020 2020 204f 626a 6563 7420 6062 6172       Object `bar
-000140d0: 6020 6e6f 7420 666f 756e 642e 0a20 2020  ` not found..   
-000140e0: 2022 2222 2c20 5059 464c 5942 595f 5041   """, PYFLYBY_PA
-000140f0: 5448 3d74 6d70 2e66 696c 6529 0a0a 0a40  TH=tmp.file)...@
-00014100: 7265 7472 790a 6465 6620 7465 7374 5f61  retry.def test_a
-00014110: 7574 6f69 6d70 6f72 745f 6d75 6c74 6970  utoimport_multip
-00014120: 6c65 5f63 616e 6469 6461 7465 735f 6d75  le_candidates_mu
-00014130: 6c74 695f 6a6f 696e 706f 696e 745f 3128  lti_joinpoint_1(
-00014140: 746d 7029 3a0a 2020 2020 2320 5665 7269  tmp):.    # Veri
-00014150: 6679 2074 6861 7420 7468 6520 6175 746f  fy that the auto
-00014160: 696d 706f 7274 206d 656e 7520 6973 206f  import menu is o
-00014170: 6e6c 7920 7072 696e 7465 6420 6f6e 6365  nly printed once
-00014180: 2c20 6576 656e 2077 6865 6e20 6d75 6c74  , even when mult
-00014190: 6970 6c65 0a20 2020 2023 206a 6f69 6e70  iple.    # joinp
-000141a0: 6f69 6e74 7320 6170 706c 7920 2861 7574  oints apply (aut
-000141b0: 6f63 616c 6c3d 3e6f 6669 6e64 2061 6e64  ocall=>ofind and
-000141c0: 2061 7374 5f69 6d70 6f72 7465 7229 2e0a   ast_importer)..
-000141d0: 2020 2020 7772 6974 6574 6578 7428 0a20      writetext(. 
-000141e0: 2020 2020 2020 2074 6d70 2e66 696c 652c         tmp.file,
-000141f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00014200: 2020 2020 2069 6d70 6f72 7420 666f 6f38       import foo8
-00014210: 3532 3233 3635 3820 6173 2062 6172 0a20  5223658 as bar. 
-00014220: 2020 2020 2020 2069 6d70 6f72 7420 666f         import fo
-00014230: 6f31 3037 3335 3236 3520 6173 2062 6172  o10735265 as bar
-00014240: 0a20 2020 2022 2222 2c0a 2020 2020 290a  .    """,.    ).
-00014250: 2020 2020 6970 7974 686f 6e28 0a20 2020      ipython(.   
-00014260: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00014270: 2049 6e20 5b31 5d3a 2069 6d70 6f72 7420   In [1]: import 
-00014280: 7079 666c 7962 793b 2070 7966 6c79 6279  pyflyby; pyflyby
-00014290: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
-000142a0: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
-000142b0: 496e 205b 325d 3a20 6261 720a 2020 2020  In [2]: bar.    
-000142c0: 2020 2020 5b50 5946 4c59 4259 5d20 4d75      [PYFLYBY] Mu
-000142d0: 6c74 6970 6c65 2063 616e 6469 6461 7465  ltiple candidate
-000142e0: 2069 6d70 6f72 7473 2066 6f72 2062 6172   imports for bar
-000142f0: 2e20 2050 6c65 6173 6520 7069 636b 206f  .  Please pick o
-00014300: 6e65 3a0a 2020 2020 2020 2020 5b50 5946  ne:.        [PYF
-00014310: 4c59 4259 5d20 2020 696d 706f 7274 2066  LYBY]   import f
-00014320: 6f6f 3130 3733 3532 3635 2061 7320 6261  oo10735265 as ba
-00014330: 720a 2020 2020 2020 2020 5b50 5946 4c59  r.        [PYFLY
-00014340: 4259 5d20 2020 696d 706f 7274 2066 6f6f  BY]   import foo
-00014350: 3835 3232 3336 3538 2061 7320 6261 720a  85223658 as bar.
-00014360: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00014370: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00014380: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00014390: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000143a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000143b0: 2d2d 2d0a 2020 2020 2020 2020 4e61 6d65  ---.        Name
-000143c0: 4572 726f 7220 2020 2020 2020 2020 2020  Error           
-000143d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143e0: 2020 2020 2020 5472 6163 6562 6163 6b20        Traceback 
-000143f0: 286d 6f73 7420 7265 6365 6e74 2063 616c  (most recent cal
-00014400: 6c20 6c61 7374 290a 2020 2020 2020 2020  l last).        
-00014410: 2e2e 2e20 696e 202e 2e2e 0a20 2020 2020  ... in ....     
-00014420: 2020 204e 616d 6545 7272 6f72 3a20 6e61     NameError: na
-00014430: 6d65 2027 6261 7227 2069 7320 6e6f 7420  me 'bar' is not 
-00014440: 6465 6669 6e65 640a 2020 2020 2222 222c  defined.    """,
-00014450: 0a20 2020 2020 2020 2050 5946 4c59 4259  .        PYFLYBY
-00014460: 5f50 4154 483d 746d 702e 6669 6c65 2c0a  _PATH=tmp.file,.
-00014470: 2020 2020 2020 2020 6175 746f 6361 6c6c          autocall
-00014480: 3d54 7275 652c 0a20 2020 2029 0a0a 0a40  =True,.    )...@
-00014490: 7265 7472 790a 6465 6620 7465 7374 5f61  retry.def test_a
-000144a0: 7574 6f69 6d70 6f72 745f 6d75 6c74 6970  utoimport_multip
-000144b0: 6c65 5f63 616e 6469 6461 7465 735f 6d75  le_candidates_mu
-000144c0: 6c74 695f 6a6f 696e 706f 696e 745f 7265  lti_joinpoint_re
-000144d0: 7065 6174 6564 5f31 2874 6d70 293a 0a20  peated_1(tmp):. 
-000144e0: 2020 2023 2057 6520 7368 6f75 6c64 2072     # We should r
-000144f0: 6570 6f72 7420 7468 6520 6d75 6c74 6970  eport the multip
-00014500: 6c65 2063 616e 6469 6461 7465 2069 7373  le candidate iss
-00014510: 7565 2061 6761 696e 2069 6620 6173 6b65  ue again if aske
-00014520: 6420 6167 6169 6e2e 0a20 2020 2077 7269  d again..    wri
-00014530: 7465 7465 7874 280a 2020 2020 2020 2020  tetext(.        
-00014540: 746d 702e 6669 6c65 2c0a 2020 2020 2020  tmp.file,.      
-00014550: 2020 2222 220a 2020 2020 2020 2020 696d    """.        im
-00014560: 706f 7274 2066 6f6f 3835 3232 3336 3538  port foo85223658
-00014570: 2061 7320 6261 720a 2020 2020 2020 2020   as bar.        
-00014580: 696d 706f 7274 2066 6f6f 3130 3733 3532  import foo107352
-00014590: 3635 2061 7320 6261 720a 2020 2020 2222  65 as bar.    ""
-000145a0: 222c 0a20 2020 2029 0a20 2020 2069 7079  ",.    ).    ipy
-000145b0: 7468 6f6e 280a 2020 2020 2020 2020 2222  thon(.        ""
-000145c0: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
-000145d0: 3a20 696d 706f 7274 2070 7966 6c79 6279  : import pyflyby
-000145e0: 3b20 7079 666c 7962 792e 656e 6162 6c65  ; pyflyby.enable
-000145f0: 5f61 7574 6f5f 696d 706f 7274 6572 2829  _auto_importer()
+00011450: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+00011460: 2020 204e 616d 6545 7272 6f72 2020 2020     NameError    
+00011470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011480: 2020 2020 2020 2020 2020 2020 2054 7261               Tra
+00011490: 6365 6261 636b 2028 6d6f 7374 2072 6563  ceback (most rec
+000114a0: 656e 7420 6361 6c6c 206c 6173 7429 0a20  ent call last). 
+000114b0: 2020 2020 2020 202e 2e2e 2e0a 2020 2020         .....    
+000114c0: 2020 2020 4e61 6d65 4572 726f 723a 206e      NameError: n
+000114d0: 616d 6520 2775 6e6b 6e6f 776e 5f73 796d  ame 'unknown_sym
+000114e0: 626f 6c5f 3337 3332 3038 3939 2720 6973  bol_37320899' is
+000114f0: 206e 6f74 2064 6566 696e 6564 0a20 2020   not defined.   
+00011500: 2020 2020 2049 6e20 5b33 5d3a 2069 6620       In [3]: if 
+00011510: 313a 0a20 2020 2020 2020 2020 2020 2e2e  1:.           ..
+00011520: 2e3a 2020 2020 2070 7269 6e74 2862 3634  .:     print(b64
+00011530: 656e 636f 6465 2862 2779 2729 2e64 6563  encode(b'y').dec
+00011540: 6f64 6528 2775 7466 2d38 2729 290a 2020  ode('utf-8')).  
+00011550: 2020 2020 2020 2020 202e 2e2e 3a0a 2020           ...:.  
+00011560: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
+00011570: 6672 6f6d 2062 6173 6536 3420 696d 706f  from base64 impo
+00011580: 7274 2062 3634 656e 636f 6465 0a20 2020  rt b64encode.   
+00011590: 2020 2020 2065 513d 3d0a 2020 2020 2020       eQ==.      
+000115a0: 2020 496e 205b 345d 3a20 6966 2031 3a20    In [4]: if 1: 
+000115b0: 7072 696e 7428 6236 3464 6563 6f64 6528  print(b64decode(
+000115c0: 2759 6d46 7a5a 574a 6862 4777 3d27 292e  'YmFzZWJhbGw=').
+000115d0: 6465 636f 6465 2827 7574 662d 3827 2929  decode('utf-8'))
+000115e0: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
+000115f0: 595d 2066 726f 6d20 6261 7365 3634 2069  Y] from base64 i
+00011600: 6d70 6f72 7420 6236 3464 6563 6f64 650a  mport b64decode.
+00011610: 2020 2020 2020 2020 6261 7365 6261 6c6c          baseball
+00011620: 0a20 2020 2022 2222 2c20 6672 6f6e 7465  .    """, fronte
+00011630: 6e64 3d66 726f 6e74 656e 6429 0a0a 0a40  nd=frontend)...@
+00011640: 7265 7472 790a 6465 6620 7465 7374 5f61  retry.def test_a
+00011650: 7574 6f69 6d70 6f72 745f 7079 666c 7962  utoimport_pyflyb
+00011660: 795f 7061 7468 5f31 2874 6d70 293a 0a20  y_path_1(tmp):. 
+00011670: 2020 2077 7269 7465 7465 7874 2874 6d70     writetext(tmp
+00011680: 2e66 696c 652c 2022 6672 6f6d 2069 7465  .file, "from ite
+00011690: 7274 6f6f 6c73 2069 6d70 6f72 7420 7072  rtools import pr
+000116a0: 6f64 7563 745c 6e22 290a 2020 2020 6970  oduct\n").    ip
+000116b0: 7974 686f 6e28 0a20 2020 2020 2020 2022  ython(.        "
+000116c0: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
+000116d0: 5d3a 2069 6d70 6f72 7420 7079 666c 7962  ]: import pyflyb
+000116e0: 793b 2070 7966 6c79 6279 2e65 6e61 626c  y; pyflyby.enabl
+000116f0: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
+00011700: 290a 2020 2020 2020 2020 496e 205b 325d  ).        In [2]
+00011710: 3a20 6c69 7374 2870 726f 6475 6374 2827  : list(product('
+00011720: 6162 272c 2763 6427 2929 0a20 2020 2020  ab','cd')).     
+00011730: 2020 205b 5059 464c 5942 595d 2066 726f     [PYFLYBY] fro
+00011740: 6d20 6974 6572 746f 6f6c 7320 696d 706f  m itertools impo
+00011750: 7274 2070 726f 6475 6374 0a20 2020 2020  rt product.     
+00011760: 2020 204f 7574 5b32 5d3a 205b 2827 6127     Out[2]: [('a'
+00011770: 2c20 2763 2729 2c20 2827 6127 2c20 2764  , 'c'), ('a', 'd
+00011780: 2729 2c20 2827 6227 2c20 2763 2729 2c20  '), ('b', 'c'), 
+00011790: 2827 6227 2c20 2764 2729 5d0a 2020 2020  ('b', 'd')].    
+000117a0: 2020 2020 496e 205b 335d 3a20 6772 6f75      In [3]: grou
+000117b0: 7062 790a 2020 2020 2020 2020 2d2d 2d2d  pby.        ----
+000117c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000117d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000117e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000117f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00011800: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00011810: 4e61 6d65 4572 726f 7220 2020 2020 2020  NameError       
+00011820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011830: 2020 2020 2020 2020 2020 5472 6163 6562            Traceb
+00011840: 6163 6b20 286d 6f73 7420 7265 6365 6e74  ack (most recent
+00011850: 2063 616c 6c20 6c61 7374 290a 2020 2020   call last).    
+00011860: 2020 2020 2e2e 2e20 696e 202e 2e2e 0a20      ... in .... 
+00011870: 2020 2020 2020 204e 616d 6545 7272 6f72         NameError
+00011880: 3a20 6e61 6d65 2027 6772 6f75 7062 7927  : name 'groupby'
+00011890: 2069 7320 6e6f 7420 6465 6669 6e65 640a   is not defined.
+000118a0: 2020 2020 2222 222c 0a20 2020 2020 2020      """,.       
+000118b0: 2050 5946 4c59 4259 5f50 4154 483d 746d   PYFLYBY_PATH=tm
+000118c0: 702e 6669 6c65 2c0a 2020 2020 290a 0a0a  p.file,.    )...
+000118d0: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
+000118e0: 6175 746f 696d 706f 7274 5f61 7574 6f63  autoimport_autoc
+000118f0: 616c 6c5f 6172 675f 3128 293a 0a20 2020  all_arg_1():.   
+00011900: 2023 2056 6572 6966 7920 7468 6174 2077   # Verify that w
+00011910: 6520 6361 6e20 6175 746f 696d 706f 7274  e can autoimport
+00011920: 2074 6865 2061 7267 756d 656e 7420 6f66   the argument of
+00011930: 2061 6e20 6175 746f 6361 6c6c 2e0a 2020   an autocall..  
+00011940: 2020 6966 2049 5079 7468 6f6e 2e76 6572    if IPython.ver
+00011950: 7369 6f6e 5f69 6e66 6f20 3c20 2837 2c20  sion_info < (7, 
+00011960: 3137 293a 0a20 2020 2020 2020 2023 2054  17):.        # T
+00011970: 6865 2061 7574 6f63 616c 6c20 6172 726f  he autocall arro
+00011980: 7773 2061 7265 2070 7269 6e74 6564 2074  ws are printed t
+00011990: 7769 6365 2069 6e20 6e65 7765 7220 7665  wice in newer ve
+000119a0: 7273 696f 6e73 206f 6620 4950 7974 686f  rsions of IPytho
+000119b0: 6e0a 2020 2020 2020 2020 2320 2868 7474  n.        # (htt
+000119c0: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+000119d0: 6970 7974 686f 6e2f 6970 7974 686f 6e2f  ipython/ipython/
+000119e0: 6973 7375 6573 2f31 3137 3134 292e 0a20  issues/11714).. 
+000119f0: 2020 2020 2020 2069 7079 7468 6f6e 2822         ipython("
+00011a00: 2222 0a20 2020 2020 2020 2020 2020 2049  "".            I
+00011a10: 6e20 5b31 5d3a 2069 6d70 6f72 7420 7079  n [1]: import py
+00011a20: 666c 7962 793b 2070 7966 6c79 6279 2e65  flyby; pyflyby.e
+00011a30: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+00011a40: 7465 7228 290a 2020 2020 2020 2020 2020  ter().          
+00011a50: 2020 496e 205b 325d 3a20 6279 7465 732e    In [2]: bytes.
+00011a60: 7570 7065 7220 6236 3464 6563 6f64 6528  upper b64decode(
+00011a70: 2761 3256 3559 6d39 6863 6d51 3d27 290a  'a2V5Ym9hcmQ=').
+00011a80: 2020 2020 2020 2020 2020 2020 2d2d 2d2d              ----
+00011a90: 2d2d 3e20 6279 7465 732e 7570 7065 7228  --> bytes.upper(
+00011aa0: 6236 3464 6563 6f64 6528 2761 3256 3559  b64decode('a2V5Y
+00011ab0: 6d39 6863 6d51 3d27 2929 0a20 2020 2020  m9hcmQ=')).     
+00011ac0: 2020 2020 2020 202d 2d2d 2d2d 2d3e 2062         ------> b
+00011ad0: 7974 6573 2e75 7070 6572 2862 3634 6465  ytes.upper(b64de
+00011ae0: 636f 6465 2827 6132 5635 596d 3968 636d  code('a2V5Ym9hcm
+00011af0: 513d 2729 290a 2020 2020 2020 2020 2020  Q=')).          
+00011b00: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
+00011b10: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
+00011b20: 3634 6465 636f 6465 0a20 2020 2020 2020  64decode.       
+00011b30: 2020 2020 204f 7574 5b32 5d3a 2062 274b       Out[2]: b'K
+00011b40: 4559 424f 4152 4427 0a20 2020 2020 2020  EYBOARD'.       
+00011b50: 2022 2222 2c20 6175 746f 6361 6c6c 3d54   """, autocall=T
+00011b60: 7275 6529 0a20 2020 2065 6c73 653a 0a20  rue).    else:. 
+00011b70: 2020 2020 2020 2069 7079 7468 6f6e 2822         ipython("
+00011b80: 2222 0a20 2020 2020 2020 2020 2020 2049  "".            I
+00011b90: 6e20 5b31 5d3a 2069 6d70 6f72 7420 7079  n [1]: import py
+00011ba0: 666c 7962 793b 2070 7966 6c79 6279 2e65  flyby; pyflyby.e
+00011bb0: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+00011bc0: 7465 7228 290a 2020 2020 2020 2020 2020  ter().          
+00011bd0: 2020 496e 205b 325d 3a20 6279 7465 732e    In [2]: bytes.
+00011be0: 7570 7065 7220 6236 3464 6563 6f64 6528  upper b64decode(
+00011bf0: 2761 3256 3559 6d39 6863 6d51 3d27 290a  'a2V5Ym9hcmQ=').
+00011c00: 2020 2020 2020 2020 2020 2020 2d2d 2d2d              ----
+00011c10: 2d2d 3e20 6279 7465 732e 7570 7065 7228  --> bytes.upper(
+00011c20: 6236 3464 6563 6f64 6528 2761 3256 3559  b64decode('a2V5Y
+00011c30: 6d39 6863 6d51 3d27 2929 0a20 2020 2020  m9hcmQ=')).     
+00011c40: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+00011c50: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
+00011c60: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
+00011c70: 2020 2020 2020 2020 2020 4f75 745b 325d            Out[2]
+00011c80: 3a20 6227 4b45 5942 4f41 5244 270a 2020  : b'KEYBOARD'.  
+00011c90: 2020 2020 2020 2222 222c 2061 7574 6f63        """, autoc
+00011ca0: 616c 6c3d 5472 7565 290a 0a40 7265 7472  all=True)..@retr
+00011cb0: 790a 6465 6620 7465 7374 5f61 7574 6f69  y.def test_autoi
+00011cc0: 6d70 6f72 745f 6175 746f 6361 6c6c 5f66  mport_autocall_f
+00011cd0: 756e 6374 696f 6e5f 3128 293a 0a20 2020  unction_1():.   
+00011ce0: 2023 2056 6572 6966 7920 7468 6174 2077   # Verify that w
+00011cf0: 6520 6361 6e20 6175 746f 696d 706f 7274  e can autoimport
+00011d00: 2074 6865 2066 756e 6374 696f 6e20 746f   the function to
+00011d10: 2061 7574 6f63 616c 6c2e 0a20 2020 2069   autocall..    i
+00011d20: 6620 4950 7974 686f 6e2e 7665 7273 696f  f IPython.versio
+00011d30: 6e5f 696e 666f 203c 2028 372c 2031 3729  n_info < (7, 17)
+00011d40: 3a0a 2020 2020 2020 2020 2320 5468 6520  :.        # The 
+00011d50: 6175 746f 6361 6c6c 2061 7272 6f77 7320  autocall arrows 
+00011d60: 6172 6520 7072 696e 7465 6420 7477 6963  are printed twic
+00011d70: 6520 696e 206e 6577 6572 2076 6572 7369  e in newer versi
+00011d80: 6f6e 7320 6f66 2049 5079 7468 6f6e 0a20  ons of IPython. 
+00011d90: 2020 2020 2020 2023 2028 6874 7470 733a         # (https:
+00011da0: 2f2f 6769 7468 7562 2e63 6f6d 2f69 7079  //github.com/ipy
+00011db0: 7468 6f6e 2f69 7079 7468 6f6e 2f69 7373  thon/ipython/iss
+00011dc0: 7565 732f 3131 3731 3429 2e0a 2020 2020  ues/11714)..    
+00011dd0: 2020 2020 6970 7974 686f 6e28 2222 220a      ipython(""".
+00011de0: 2020 2020 2020 2020 2020 2020 496e 205b              In [
+00011df0: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
+00011e00: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
+00011e10: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
+00011e20: 2829 0a20 2020 2020 2020 2020 2020 2049  ().            I
+00011e30: 6e20 5b32 5d3a 2062 3634 6465 636f 6465  n [2]: b64decode
+00011e40: 2027 6257 3931 6332 553d 270a 2020 2020   'bW91c2U='.    
+00011e50: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
+00011e60: 5d20 6672 6f6d 2062 6173 6536 3420 696d  ] from base64 im
+00011e70: 706f 7274 2062 3634 6465 636f 6465 0a20  port b64decode. 
+00011e80: 2020 2020 2020 2020 2020 202d 2d2d 2d2d             -----
+00011e90: 2d3e 2062 3634 6465 636f 6465 2827 6257  -> b64decode('bW
+00011ea0: 3931 6332 553d 2729 0a20 2020 2020 2020  91c2U=').       
+00011eb0: 2020 2020 202d 2d2d 2d2d 2d3e 2062 3634       ------> b64
+00011ec0: 6465 636f 6465 2827 6257 3931 6332 553d  decode('bW91c2U=
+00011ed0: 2729 0a20 2020 2020 2020 2020 2020 204f  ').            O
+00011ee0: 7574 5b32 5d3a 2062 276d 6f75 7365 270a  ut[2]: b'mouse'.
+00011ef0: 2020 2020 2020 2020 2222 222c 2061 7574          """, aut
+00011f00: 6f63 616c 6c3d 5472 7565 290a 2020 2020  ocall=True).    
+00011f10: 656c 7365 3a0a 2020 2020 2020 2020 6970  else:.        ip
+00011f20: 7974 686f 6e28 2222 220a 2020 2020 2020  ython(""".      
+00011f30: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
+00011f40: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
+00011f50: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
+00011f60: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
+00011f70: 2020 2020 2020 2020 2049 6e20 5b32 5d3a           In [2]:
+00011f80: 2062 3634 6465 636f 6465 2027 6257 3931   b64decode 'bW91
+00011f90: 6332 553d 270a 2020 2020 2020 2020 2020  c2U='.          
+00011fa0: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
+00011fb0: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
+00011fc0: 3634 6465 636f 6465 0a20 2020 2020 2020  64decode.       
+00011fd0: 2020 2020 202d 2d2d 2d2d 2d3e 2062 3634       ------> b64
+00011fe0: 6465 636f 6465 2827 6257 3931 6332 553d  decode('bW91c2U=
+00011ff0: 2729 0a20 2020 2020 2020 2020 2020 204f  ').            O
+00012000: 7574 5b32 5d3a 2062 276d 6f75 7365 270a  ut[2]: b'mouse'.
+00012010: 2020 2020 2020 2020 2222 222c 2061 7574          """, aut
+00012020: 6f63 616c 6c3d 5472 7565 290a 0a40 7265  ocall=True)..@re
+00012030: 7472 790a 6465 6620 7465 7374 5f61 7574  try.def test_aut
+00012040: 6f69 6d70 6f72 745f 6d75 6c74 6970 6c65  oimport_multiple
+00012050: 5f63 616e 6469 6461 7465 735f 6173 745f  _candidates_ast_
+00012060: 7472 616e 7366 6f72 6d65 725f 3128 746d  transformer_1(tm
+00012070: 7029 3a0a 2020 2020 2320 5665 7269 6679  p):.    # Verify
+00012080: 2074 6861 7420 7765 2070 7269 6e74 206f   that we print o
+00012090: 7574 2061 6c6c 2063 616e 6469 6461 7465  ut all candidate
+000120a0: 2061 7574 6f69 6d70 6f72 7473 2c20 7768   autoimports, wh
+000120b0: 656e 2074 6865 7265 2061 7265 0a20 2020  en there are.   
+000120c0: 2023 206d 756c 7469 706c 652e 0a20 2020   # multiple..   
+000120d0: 2077 7269 7465 7465 7874 280a 2020 2020   writetext(.    
+000120e0: 2020 2020 746d 702e 6669 6c65 2c0a 2020      tmp.file,.  
+000120f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00012100: 2020 696d 706f 7274 2066 6f6f 3233 3539    import foo2359
+00012110: 3632 3637 2061 7320 6261 720a 2020 2020  6267 as bar.    
+00012120: 2020 2020 696d 706f 7274 2066 6f6f 3530      import foo50
+00012130: 3835 3334 3239 2061 7320 6261 720a 2020  853429 as bar.  
+00012140: 2020 2020 2020 696d 706f 7274 2066 6f6f        import foo
+00012150: 3437 3937 3938 3832 2061 7320 6261 720a  47979882 as bar.
+00012160: 2020 2020 2222 222c 0a20 2020 2029 0a20      """,.    ). 
+00012170: 2020 2069 7079 7468 6f6e 280a 2020 2020     ipython(.    
+00012180: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00012190: 496e 205b 315d 3a20 696d 706f 7274 2070  In [1]: import p
+000121a0: 7966 6c79 6279 3b20 7079 666c 7962 792e  yflyby; pyflyby.
+000121b0: 656e 6162 6c65 5f61 7574 6f5f 696d 706f  enable_auto_impo
+000121c0: 7274 6572 2829 0a20 2020 2020 2020 2049  rter().        I
+000121d0: 6e20 5b32 5d3a 2062 6172 2834 3229 0a20  n [2]: bar(42). 
+000121e0: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+000121f0: 204d 756c 7469 706c 6520 6361 6e64 6964   Multiple candid
+00012200: 6174 6520 696d 706f 7274 7320 666f 7220  ate imports for 
+00012210: 6261 722e 2020 506c 6561 7365 2070 6963  bar.  Please pic
+00012220: 6b20 6f6e 653a 0a20 2020 2020 2020 205b  k one:.        [
+00012230: 5059 464c 5942 595d 2020 2069 6d70 6f72  PYFLYBY]   impor
+00012240: 7420 666f 6f32 3335 3936 3236 3720 6173  t foo23596267 as
+00012250: 2062 6172 0a20 2020 2020 2020 205b 5059   bar.        [PY
+00012260: 464c 5942 595d 2020 2069 6d70 6f72 7420  FLYBY]   import 
+00012270: 666f 6f34 3739 3739 3838 3220 6173 2062  foo47979882 as b
+00012280: 6172 0a20 2020 2020 2020 205b 5059 464c  ar.        [PYFL
+00012290: 5942 595d 2020 2069 6d70 6f72 7420 666f  YBY]   import fo
+000122a0: 6f35 3038 3533 3432 3920 6173 2062 6172  o50853429 as bar
+000122b0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000122c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000122d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000122e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000122f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00012300: 2d2d 2d2d 0a20 2020 2020 2020 204e 616d  ----.        Nam
+00012310: 6545 7272 6f72 2020 2020 2020 2020 2020  eError          
+00012320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012330: 2020 2020 2020 2054 7261 6365 6261 636b         Traceback
+00012340: 2028 6d6f 7374 2072 6563 656e 7420 6361   (most recent ca
+00012350: 6c6c 206c 6173 7429 0a20 2020 2020 2020  ll last).       
+00012360: 202e 2e2e 2069 6e20 2e2e 2e0a 2020 2020   ... in ....    
+00012370: 2020 2020 4e61 6d65 4572 726f 723a 206e      NameError: n
+00012380: 616d 6520 2762 6172 2720 6973 206e 6f74  ame 'bar' is not
+00012390: 2064 6566 696e 6564 0a20 2020 2022 2222   defined.    """
+000123a0: 2c0a 2020 2020 2020 2020 5059 464c 5942  ,.        PYFLYB
+000123b0: 595f 5041 5448 3d74 6d70 2e66 696c 652c  Y_PATH=tmp.file,
+000123c0: 0a20 2020 2029 0a0a 0a40 7265 7472 790a  .    )...@retry.
+000123d0: 6465 6620 7465 7374 5f61 7574 6f69 6d70  def test_autoimp
+000123e0: 6f72 745f 6d75 6c74 6970 6c65 5f63 616e  ort_multiple_can
+000123f0: 6469 6461 7465 735f 7265 7065 6174 6564  didates_repeated
+00012400: 5f31 2874 6d70 293a 0a20 2020 2023 2056  _1(tmp):.    # V
+00012410: 6572 6966 7920 7468 6174 2077 6520 7072  erify that we pr
+00012420: 696e 7420 6f75 7420 7468 6520 6361 6e64  int out the cand
+00012430: 6964 6174 6520 6c69 7374 2066 6f72 2061  idate list for a
+00012440: 6e6f 7468 6572 2063 656c 6c2e 0a20 2020  nother cell..   
+00012450: 2077 7269 7465 7465 7874 280a 2020 2020   writetext(.    
+00012460: 2020 2020 746d 702e 6669 6c65 2c0a 2020      tmp.file,.  
+00012470: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00012480: 2020 696d 706f 7274 2066 6f6f 3730 3630    import foo7060
+00012490: 3332 3437 2061 7320 6261 720a 2020 2020  3247 as bar.    
+000124a0: 2020 2020 696d 706f 7274 2066 6f6f 3331      import foo31
+000124b0: 3730 3337 3232 2061 7320 6261 720a 2020  703722 as bar.  
+000124c0: 2020 2222 222c 0a20 2020 2029 0a20 2020    """,.    ).   
+000124d0: 2069 7079 7468 6f6e 280a 2020 2020 2020   ipython(.      
+000124e0: 2020 2222 220a 2020 2020 2020 2020 496e    """.        In
+000124f0: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
+00012500: 6c79 6279 3b20 7079 666c 7962 792e 656e  lyby; pyflyby.en
+00012510: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
+00012520: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
+00012530: 5b32 5d3a 2062 6172 2834 3229 0a20 2020  [2]: bar(42).   
+00012540: 2020 2020 205b 5059 464c 5942 595d 204d       [PYFLYBY] M
+00012550: 756c 7469 706c 6520 6361 6e64 6964 6174  ultiple candidat
+00012560: 6520 696d 706f 7274 7320 666f 7220 6261  e imports for ba
+00012570: 722e 2020 506c 6561 7365 2070 6963 6b20  r.  Please pick 
+00012580: 6f6e 653a 0a20 2020 2020 2020 205b 5059  one:.        [PY
+00012590: 464c 5942 595d 2020 2069 6d70 6f72 7420  FLYBY]   import 
+000125a0: 666f 6f33 3137 3033 3732 3220 6173 2062  foo31703722 as b
+000125b0: 6172 0a20 2020 2020 2020 205b 5059 464c  ar.        [PYFL
+000125c0: 5942 595d 2020 2069 6d70 6f72 7420 666f  YBY]   import fo
+000125d0: 6f37 3036 3033 3234 3720 6173 2062 6172  o70603247 as bar
+000125e0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000125f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00012600: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00012610: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00012620: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00012630: 2d2d 2d2d 0a20 2020 2020 2020 204e 616d  ----.        Nam
+00012640: 6545 7272 6f72 2020 2020 2020 2020 2020  eError          
+00012650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012660: 2020 2020 2020 2054 7261 6365 6261 636b         Traceback
+00012670: 2028 6d6f 7374 2072 6563 656e 7420 6361   (most recent ca
+00012680: 6c6c 206c 6173 7429 0a20 2020 2020 2020  ll last).       
+00012690: 202e 2e2e 2069 6e20 2e2e 2e0a 2020 2020   ... in ....    
+000126a0: 2020 2020 4e61 6d65 4572 726f 723a 206e      NameError: n
+000126b0: 616d 6520 2762 6172 2720 6973 206e 6f74  ame 'bar' is not
+000126c0: 2064 6566 696e 6564 0a20 2020 2020 2020   defined.       
+000126d0: 2049 6e20 5b33 5d3a 2062 6172 2834 3229   In [3]: bar(42)
+000126e0: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
+000126f0: 595d 204d 756c 7469 706c 6520 6361 6e64  Y] Multiple cand
+00012700: 6964 6174 6520 696d 706f 7274 7320 666f  idate imports fo
+00012710: 7220 6261 722e 2020 506c 6561 7365 2070  r bar.  Please p
+00012720: 6963 6b20 6f6e 653a 0a20 2020 2020 2020  ick one:.       
+00012730: 205b 5059 464c 5942 595d 2020 2069 6d70   [PYFLYBY]   imp
+00012740: 6f72 7420 666f 6f33 3137 3033 3732 3220  ort foo31703722 
+00012750: 6173 2062 6172 0a20 2020 2020 2020 205b  as bar.        [
+00012760: 5059 464c 5942 595d 2020 2069 6d70 6f72  PYFLYBY]   impor
+00012770: 7420 666f 6f37 3036 3033 3234 3720 6173  t foo70603247 as
+00012780: 2062 6172 0a20 2020 2020 2020 202d 2d2d   bar.        ---
+00012790: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000127a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000127b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000127c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000127d0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+000127e0: 204e 616d 6545 7272 6f72 2020 2020 2020   NameError      
+000127f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012800: 2020 2020 2020 2020 2020 2054 7261 6365             Trace
+00012810: 6261 636b 2028 6d6f 7374 2072 6563 656e  back (most recen
+00012820: 7420 6361 6c6c 206c 6173 7429 0a20 2020  t call last).   
+00012830: 2020 2020 202e 2e2e 2069 6e20 2e2e 2e0a       ... in ....
+00012840: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
+00012850: 723a 206e 616d 6520 2762 6172 2720 6973  r: name 'bar' is
+00012860: 206e 6f74 2064 6566 696e 6564 0a20 2020   not defined.   
+00012870: 2022 2222 2c0a 2020 2020 2020 2020 5059   """,.        PY
+00012880: 464c 5942 595f 5041 5448 3d74 6d70 2e66  FLYBY_PATH=tmp.f
+00012890: 696c 652c 0a20 2020 2029 0a0a 0a40 7265  ile,.    )...@re
+000128a0: 7472 790a 6465 6620 7465 7374 5f61 7574  try.def test_aut
+000128b0: 6f69 6d70 6f72 745f 6d75 6c74 6970 6c65  oimport_multiple
+000128c0: 5f63 616e 6469 6461 7465 735f 6d75 6c74  _candidates_mult
+000128d0: 6970 6c65 5f69 6e5f 6578 7072 6573 7369  iple_in_expressi
+000128e0: 6f6e 5f31 2874 6d70 293a 0a20 2020 2023  on_1(tmp):.    #
+000128f0: 2056 6572 6966 7920 7468 6174 2069 6620   Verify that if 
+00012900: 616e 2065 7870 7265 7373 696f 6e20 636f  an expression co
+00012910: 6e74 6169 6e73 206d 756c 7469 706c 6520  ntains multiple 
+00012920: 616d 6269 6775 6f75 7320 696d 706f 7274  ambiguous import
+00012930: 732c 2077 650a 2020 2020 2320 7265 706f  s, we.    # repo
+00012940: 7274 2065 6163 6820 6f6e 652e 0a20 2020  rt each one..   
+00012950: 2077 7269 7465 7465 7874 280a 2020 2020   writetext(.    
+00012960: 2020 2020 746d 702e 6669 6c65 2c0a 2020      tmp.file,.  
+00012970: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00012980: 2020 696d 706f 7274 2066 6f6f 3835 3935    import foo8595
+00012990: 3738 3130 2061 7320 666f 6f0a 2020 2020  7810 as foo.    
+000129a0: 2020 2020 696d 706f 7274 2066 6f6f 3335      import foo35
+000129b0: 3438 3339 3138 2061 7320 666f 6f0a 2020  483918 as foo.  
+000129c0: 2020 2020 2020 696d 706f 7274 2062 6172        import bar
+000129d0: 3235 3239 3030 3032 2061 7320 6261 720a  25290002 as bar.
+000129e0: 2020 2020 2020 2020 696d 706f 7274 2062          import b
+000129f0: 6172 3336 3136 3633 3038 2061 7320 6261  ar36166308 as ba
+00012a00: 720a 2020 2020 2222 222c 0a20 2020 2029  r.    """,.    )
+00012a10: 0a20 2020 2069 7079 7468 6f6e 280a 2020  .    ipython(.  
+00012a20: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00012a30: 2020 496e 205b 315d 3a20 696d 706f 7274    In [1]: import
+00012a40: 2070 7966 6c79 6279 3b20 7079 666c 7962   pyflyby; pyflyb
+00012a50: 792e 656e 6162 6c65 5f61 7574 6f5f 696d  y.enable_auto_im
+00012a60: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
+00012a70: 2049 6e20 5b32 5d3a 2066 6f6f 2b62 6172   In [2]: foo+bar
+00012a80: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
+00012a90: 595d 204d 756c 7469 706c 6520 6361 6e64  Y] Multiple cand
+00012aa0: 6964 6174 6520 696d 706f 7274 7320 666f  idate imports fo
+00012ab0: 7220 6261 722e 2020 506c 6561 7365 2070  r bar.  Please p
+00012ac0: 6963 6b20 6f6e 653a 0a20 2020 2020 2020  ick one:.       
+00012ad0: 205b 5059 464c 5942 595d 2020 2069 6d70   [PYFLYBY]   imp
+00012ae0: 6f72 7420 6261 7232 3532 3930 3030 3220  ort bar25290002 
+00012af0: 6173 2062 6172 0a20 2020 2020 2020 205b  as bar.        [
+00012b00: 5059 464c 5942 595d 2020 2069 6d70 6f72  PYFLYBY]   impor
+00012b10: 7420 6261 7233 3631 3636 3330 3820 6173  t bar36166308 as
+00012b20: 2062 6172 0a20 2020 2020 2020 205b 5059   bar.        [PY
+00012b30: 464c 5942 595d 204d 756c 7469 706c 6520  FLYBY] Multiple 
+00012b40: 6361 6e64 6964 6174 6520 696d 706f 7274  candidate import
+00012b50: 7320 666f 7220 666f 6f2e 2020 506c 6561  s for foo.  Plea
+00012b60: 7365 2070 6963 6b20 6f6e 653a 0a20 2020  se pick one:.   
+00012b70: 2020 2020 205b 5059 464c 5942 595d 2020       [PYFLYBY]  
+00012b80: 2069 6d70 6f72 7420 666f 6f33 3534 3833   import foo35483
+00012b90: 3931 3820 6173 2066 6f6f 0a20 2020 2020  918 as foo.     
+00012ba0: 2020 205b 5059 464c 5942 595d 2020 2069     [PYFLYBY]   i
+00012bb0: 6d70 6f72 7420 666f 6f38 3539 3537 3831  mport foo8595781
+00012bc0: 3020 6173 2066 6f6f 0a20 2020 2020 2020  0 as foo.       
+00012bd0: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
+00012be0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00012bf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00012c00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00012c10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
+00012c20: 2020 2020 204e 616d 6545 7272 6f72 2020       NameError  
+00012c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c40: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+00012c50: 7261 6365 6261 636b 2028 6d6f 7374 2072  raceback (most r
+00012c60: 6563 656e 7420 6361 6c6c 206c 6173 7429  ecent call last)
+00012c70: 0a20 2020 2020 2020 202e 2e2e 2069 6e20  .        ... in 
+00012c80: 2e2e 2e0a 2020 2020 2020 2020 4e61 6d65  ....        Name
+00012c90: 4572 726f 723a 206e 616d 6520 2766 6f6f  Error: name 'foo
+00012ca0: 2720 6973 206e 6f74 2064 6566 696e 6564  ' is not defined
+00012cb0: 0a20 2020 2022 2222 2c0a 2020 2020 2020  .    """,.      
+00012cc0: 2020 5059 464c 5942 595f 5041 5448 3d74    PYFLYBY_PATH=t
+00012cd0: 6d70 2e66 696c 652c 0a20 2020 2029 0a0a  mp.file,.    )..
+00012ce0: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
+00012cf0: 5f61 7574 6f69 6d70 6f72 745f 6d75 6c74  _autoimport_mult
+00012d00: 6970 6c65 5f63 616e 6469 6461 7465 735f  iple_candidates_
+00012d10: 7265 7065 6174 6564 5f69 6e5f 6578 7072  repeated_in_expr
+00012d20: 6573 7369 6f6e 5f31 2874 6d70 293a 0a20  ession_1(tmp):. 
+00012d30: 2020 2023 2056 6572 6966 7920 7468 6174     # Verify that
+00012d40: 2069 6620 616e 2065 7870 7265 7373 696f   if an expressio
+00012d50: 6e20 636f 6e74 6169 6e73 2061 6e20 616d  n contains an am
+00012d60: 6269 6775 6f75 7320 696d 706f 7274 2074  biguous import t
+00012d70: 7769 6365 2c20 7765 206f 6e6c 790a 2020  wice, we only.  
+00012d80: 2020 2320 7265 706f 7274 2069 7420 6f6e    # report it on
+00012d90: 6365 2e0a 2020 2020 7772 6974 6574 6578  ce..    writetex
+00012da0: 7428 0a20 2020 2020 2020 2074 6d70 2e66  t(.        tmp.f
+00012db0: 696c 652c 0a20 2020 2020 2020 2022 2222  ile,.        """
+00012dc0: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+00012dd0: 666f 6f38 3339 3538 3439 3220 6173 2062  foo83958492 as b
+00012de0: 6172 0a20 2020 2020 2020 2069 6d70 6f72  ar.        impor
+00012df0: 7420 666f 6f32 3934 3332 3636 3820 6173  t foo29432668 as
+00012e00: 2062 6172 0a20 2020 2022 2222 2c0a 2020   bar.    """,.  
+00012e10: 2020 290a 2020 2020 6970 7974 686f 6e28    ).    ipython(
+00012e20: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00012e30: 2020 2020 2049 6e20 5b31 5d3a 2069 6d70       In [1]: imp
+00012e40: 6f72 7420 7079 666c 7962 793b 2070 7966  ort pyflyby; pyf
+00012e50: 6c79 6279 2e65 6e61 626c 655f 6175 746f  lyby.enable_auto
+00012e60: 5f69 6d70 6f72 7465 7228 290a 2020 2020  _importer().    
+00012e70: 2020 2020 496e 205b 325d 3a20 6261 722b      In [2]: bar+
+00012e80: 6261 720a 2020 2020 2020 2020 5b50 5946  bar.        [PYF
+00012e90: 4c59 4259 5d20 4d75 6c74 6970 6c65 2063  LYBY] Multiple c
+00012ea0: 616e 6469 6461 7465 2069 6d70 6f72 7473  andidate imports
+00012eb0: 2066 6f72 2062 6172 2e20 2050 6c65 6173   for bar.  Pleas
+00012ec0: 6520 7069 636b 206f 6e65 3a0a 2020 2020  e pick one:.    
+00012ed0: 2020 2020 5b50 5946 4c59 4259 5d20 2020      [PYFLYBY]   
+00012ee0: 696d 706f 7274 2066 6f6f 3239 3433 3236  import foo294326
+00012ef0: 3638 2061 7320 6261 720a 2020 2020 2020  68 as bar.      
+00012f00: 2020 5b50 5946 4c59 4259 5d20 2020 696d    [PYFLYBY]   im
+00012f10: 706f 7274 2066 6f6f 3833 3935 3834 3932  port foo83958492
+00012f20: 2061 7320 6261 720a 2020 2020 2020 2020   as bar.        
+00012f30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00012f40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00012f50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00012f60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00012f70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+00012f80: 2020 2020 4e61 6d65 4572 726f 7220 2020      NameError   
+00012f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fa0: 2020 2020 2020 2020 2020 2020 2020 5472                Tr
+00012fb0: 6163 6562 6163 6b20 286d 6f73 7420 7265  aceback (most re
+00012fc0: 6365 6e74 2063 616c 6c20 6c61 7374 290a  cent call last).
+00012fd0: 2020 2020 2020 2020 2e2e 2e20 696e 202e          ... in .
+00012fe0: 2e2e 0a20 2020 2020 2020 204e 616d 6545  ...        NameE
+00012ff0: 7272 6f72 3a20 6e61 6d65 2027 6261 7227  rror: name 'bar'
+00013000: 2069 7320 6e6f 7420 6465 6669 6e65 640a   is not defined.
+00013010: 2020 2020 2222 222c 0a20 2020 2020 2020      """,.       
+00013020: 2050 5946 4c59 4259 5f50 4154 483d 746d   PYFLYBY_PATH=tm
+00013030: 702e 6669 6c65 2c0a 2020 2020 290a 0a0a  p.file,.    )...
+00013040: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
+00013050: 6175 746f 696d 706f 7274 5f6d 756c 7469  autoimport_multi
+00013060: 706c 655f 6361 6e64 6964 6174 6573 5f6f  ple_candidates_o
+00013070: 6669 6e64 5f31 2874 6d70 293a 0a20 2020  find_1(tmp):.   
+00013080: 2023 2056 6572 6966 7920 7468 6174 2074   # Verify that t
+00013090: 6865 206d 756c 7469 2d63 616e 6469 6461  he multi-candida
+000130a0: 7465 206d 656e 7520 776f 726b 7320 6576  te menu works ev
+000130b0: 656e 2077 6974 6820 6f66 696e 642e 0a20  en with ofind.. 
+000130c0: 2020 2077 7269 7465 7465 7874 2874 6d70     writetext(tmp
+000130d0: 2e66 696c 652c 2022 2222 0a20 2020 2020  .file, """.     
+000130e0: 2020 2069 6d70 6f72 7420 666f 6f34 3534     import foo454
+000130f0: 3135 3535 3320 6173 2062 6172 0a20 2020  15553 as bar.   
+00013100: 2020 2020 2069 6d70 6f72 7420 666f 6f33       import foo3
+00013110: 3734 3732 3830 3920 6173 2062 6172 0a20  7472809 as bar. 
+00013120: 2020 2022 2222 290a 2020 2020 6970 7974     """).    ipyt
+00013130: 686f 6e28 2222 220a 2020 2020 2020 2020  hon(""".        
+00013140: 496e 205b 315d 3a20 696d 706f 7274 2070  In [1]: import p
+00013150: 7966 6c79 6279 3b20 7079 666c 7962 792e  yflyby; pyflyby.
+00013160: 656e 6162 6c65 5f61 7574 6f5f 696d 706f  enable_auto_impo
+00013170: 7274 6572 2829 0a20 2020 2020 2020 2049  rter().        I
+00013180: 6e20 5b32 5d3a 2062 6172 3f0a 2020 2020  n [2]: bar?.    
+00013190: 2020 2020 5b50 5946 4c59 4259 5d20 4d75      [PYFLYBY] Mu
+000131a0: 6c74 6970 6c65 2063 616e 6469 6461 7465  ltiple candidate
+000131b0: 2069 6d70 6f72 7473 2066 6f72 2062 6172   imports for bar
+000131c0: 2e20 2050 6c65 6173 6520 7069 636b 206f  .  Please pick o
+000131d0: 6e65 3a0a 2020 2020 2020 2020 5b50 5946  ne:.        [PYF
+000131e0: 4c59 4259 5d20 2020 696d 706f 7274 2066  LYBY]   import f
+000131f0: 6f6f 3337 3437 3238 3039 2061 7320 6261  oo37472809 as ba
+00013200: 720a 2020 2020 2020 2020 5b50 5946 4c59  r.        [PYFLY
+00013210: 4259 5d20 2020 696d 706f 7274 2066 6f6f  BY]   import foo
+00013220: 3435 3431 3535 3533 2061 7320 6261 720a  45415553 as bar.
+00013230: 2020 2020 2020 2020 4f62 6a65 6374 2060          Object `
+00013240: 6261 7260 206e 6f74 2066 6f75 6e64 2e0a  bar` not found..
+00013250: 2020 2020 2222 222c 2050 5946 4c59 4259      """, PYFLYBY
+00013260: 5f50 4154 483d 746d 702e 6669 6c65 290a  _PATH=tmp.file).
+00013270: 0a0a 4072 6574 7279 0a64 6566 2074 6573  ..@retry.def tes
+00013280: 745f 6175 746f 696d 706f 7274 5f6d 756c  t_autoimport_mul
+00013290: 7469 706c 655f 6361 6e64 6964 6174 6573  tiple_candidates
+000132a0: 5f6d 756c 7469 5f6a 6f69 6e70 6f69 6e74  _multi_joinpoint
+000132b0: 5f31 2874 6d70 293a 0a20 2020 2023 2056  _1(tmp):.    # V
+000132c0: 6572 6966 7920 7468 6174 2074 6865 2061  erify that the a
+000132d0: 7574 6f69 6d70 6f72 7420 6d65 6e75 2069  utoimport menu i
+000132e0: 7320 6f6e 6c79 2070 7269 6e74 6564 206f  s only printed o
+000132f0: 6e63 652c 2065 7665 6e20 7768 656e 206d  nce, even when m
+00013300: 756c 7469 706c 650a 2020 2020 2320 6a6f  ultiple.    # jo
+00013310: 696e 706f 696e 7473 2061 7070 6c79 2028  inpoints apply (
+00013320: 6175 746f 6361 6c6c 3d3e 6f66 696e 6420  autocall=>ofind 
+00013330: 616e 6420 6173 745f 696d 706f 7274 6572  and ast_importer
+00013340: 292e 0a20 2020 2077 7269 7465 7465 7874  )..    writetext
+00013350: 280a 2020 2020 2020 2020 746d 702e 6669  (.        tmp.fi
+00013360: 6c65 2c0a 2020 2020 2020 2020 2222 220a  le,.        """.
+00013370: 2020 2020 2020 2020 696d 706f 7274 2066          import f
+00013380: 6f6f 3835 3232 3336 3538 2061 7320 6261  oo85223658 as ba
+00013390: 720a 2020 2020 2020 2020 696d 706f 7274  r.        import
+000133a0: 2066 6f6f 3130 3733 3532 3635 2061 7320   foo10735265 as 
+000133b0: 6261 720a 2020 2020 2222 222c 0a20 2020  bar.    """,.   
+000133c0: 2029 0a20 2020 2069 7079 7468 6f6e 280a   ).    ipython(.
+000133d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000133e0: 2020 2020 496e 205b 315d 3a20 696d 706f      In [1]: impo
+000133f0: 7274 2070 7966 6c79 6279 3b20 7079 666c  rt pyflyby; pyfl
+00013400: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
+00013410: 696d 706f 7274 6572 2829 0a20 2020 2020  importer().     
+00013420: 2020 2049 6e20 5b32 5d3a 2062 6172 0a20     In [2]: bar. 
+00013430: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+00013440: 204d 756c 7469 706c 6520 6361 6e64 6964   Multiple candid
+00013450: 6174 6520 696d 706f 7274 7320 666f 7220  ate imports for 
+00013460: 6261 722e 2020 506c 6561 7365 2070 6963  bar.  Please pic
+00013470: 6b20 6f6e 653a 0a20 2020 2020 2020 205b  k one:.        [
+00013480: 5059 464c 5942 595d 2020 2069 6d70 6f72  PYFLYBY]   impor
+00013490: 7420 666f 6f31 3037 3335 3236 3520 6173  t foo10735265 as
+000134a0: 2062 6172 0a20 2020 2020 2020 205b 5059   bar.        [PY
+000134b0: 464c 5942 595d 2020 2069 6d70 6f72 7420  FLYBY]   import 
+000134c0: 666f 6f38 3532 3233 3635 3820 6173 2062  foo85223658 as b
+000134d0: 6172 0a20 2020 2020 2020 202d 2d2d 2d2d  ar.        -----
+000134e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000134f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00013500: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00013510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00013520: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 204e  ------.        N
+00013530: 616d 6545 7272 6f72 2020 2020 2020 2020  ameError        
+00013540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013550: 2020 2020 2020 2020 2054 7261 6365 6261           Traceba
+00013560: 636b 2028 6d6f 7374 2072 6563 656e 7420  ck (most recent 
+00013570: 6361 6c6c 206c 6173 7429 0a20 2020 2020  call last).     
+00013580: 2020 202e 2e2e 2069 6e20 2e2e 2e0a 2020     ... in ....  
+00013590: 2020 2020 2020 4e61 6d65 4572 726f 723a        NameError:
+000135a0: 206e 616d 6520 2762 6172 2720 6973 206e   name 'bar' is n
+000135b0: 6f74 2064 6566 696e 6564 0a20 2020 2022  ot defined.    "
+000135c0: 2222 2c0a 2020 2020 2020 2020 5059 464c  "",.        PYFL
+000135d0: 5942 595f 5041 5448 3d74 6d70 2e66 696c  YBY_PATH=tmp.fil
+000135e0: 652c 0a20 2020 2020 2020 2061 7574 6f63  e,.        autoc
+000135f0: 616c 6c3d 5472 7565 2c0a 2020 2020 290a  all=True,.    ).
+00013600: 0a0a 4072 6574 7279 0a64 6566 2074 6573  ..@retry.def tes
+00013610: 745f 6175 746f 696d 706f 7274 5f6d 756c  t_autoimport_mul
+00013620: 7469 706c 655f 6361 6e64 6964 6174 6573  tiple_candidates
+00013630: 5f6d 756c 7469 5f6a 6f69 6e70 6f69 6e74  _multi_joinpoint
+00013640: 5f72 6570 6561 7465 645f 3128 746d 7029  _repeated_1(tmp)
+00013650: 3a0a 2020 2020 2320 5765 2073 686f 756c  :.    # We shoul
+00013660: 6420 7265 706f 7274 2074 6865 206d 756c  d report the mul
+00013670: 7469 706c 6520 6361 6e64 6964 6174 6520  tiple candidate 
+00013680: 6973 7375 6520 6167 6169 6e20 6966 2061  issue again if a
+00013690: 736b 6564 2061 6761 696e 2e0a 2020 2020  sked again..    
+000136a0: 7772 6974 6574 6578 7428 0a20 2020 2020  writetext(.     
+000136b0: 2020 2074 6d70 2e66 696c 652c 0a20 2020     tmp.file,.   
+000136c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000136d0: 2069 6d70 6f72 7420 666f 6f38 3532 3233   import foo85223
+000136e0: 3635 3820 6173 2062 6172 0a20 2020 2020  658 as bar.     
+000136f0: 2020 2069 6d70 6f72 7420 666f 6f31 3037     import foo107
+00013700: 3335 3236 3520 6173 2062 6172 0a20 2020  35265 as bar.   
+00013710: 2022 2222 2c0a 2020 2020 290a 2020 2020   """,.    ).    
+00013720: 6970 7974 686f 6e28 0a20 2020 2020 2020  ipython(.       
+00013730: 2022 2222 0a20 2020 2020 2020 2049 6e20   """.        In 
+00013740: 5b31 5d3a 2069 6d70 6f72 7420 7079 666c  [1]: import pyfl
+00013750: 7962 793b 2070 7966 6c79 6279 2e65 6e61  yby; pyflyby.ena
+00013760: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
+00013770: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
+00013780: 325d 3a20 6261 720a 2020 2020 2020 2020  2]: bar.        
+00013790: 5b50 5946 4c59 4259 5d20 4d75 6c74 6970  [PYFLYBY] Multip
+000137a0: 6c65 2063 616e 6469 6461 7465 2069 6d70  le candidate imp
+000137b0: 6f72 7473 2066 6f72 2062 6172 2e20 2050  orts for bar.  P
+000137c0: 6c65 6173 6520 7069 636b 206f 6e65 3a0a  lease pick one:.
+000137d0: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
+000137e0: 5d20 2020 696d 706f 7274 2066 6f6f 3130  ]   import foo10
+000137f0: 3733 3532 3635 2061 7320 6261 720a 2020  735265 as bar.  
+00013800: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
+00013810: 2020 696d 706f 7274 2066 6f6f 3835 3232    import foo8522
+00013820: 3336 3538 2061 7320 6261 720a 2020 2020  3658 as bar.    
+00013830: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
+00013840: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00013850: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00013860: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00013870: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
+00013880: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
+00013890: 7220 2020 2020 2020 2020 2020 2020 2020  r               
+000138a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000138b0: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
+000138c0: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
+000138d0: 7374 290a 2020 2020 2020 2020 2e2e 2e20  st).        ... 
+000138e0: 696e 202e 2e2e 0a20 2020 2020 2020 204e  in ....        N
+000138f0: 616d 6545 7272 6f72 3a20 6e61 6d65 2027  ameError: name '
+00013900: 6261 7227 2069 7320 6e6f 7420 6465 6669  bar' is not defi
+00013910: 6e65 640a 2020 2020 2020 2020 496e 205b  ned.        In [
+00013920: 335d 3a20 6261 720a 2020 2020 2020 2020  3]: bar.        
+00013930: 5b50 5946 4c59 4259 5d20 4d75 6c74 6970  [PYFLYBY] Multip
+00013940: 6c65 2063 616e 6469 6461 7465 2069 6d70  le candidate imp
+00013950: 6f72 7473 2066 6f72 2062 6172 2e20 2050  orts for bar.  P
+00013960: 6c65 6173 6520 7069 636b 206f 6e65 3a0a  lease pick one:.
+00013970: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
+00013980: 5d20 2020 696d 706f 7274 2066 6f6f 3130  ]   import foo10
+00013990: 3733 3532 3635 2061 7320 6261 720a 2020  735265 as bar.  
+000139a0: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
+000139b0: 2020 696d 706f 7274 2066 6f6f 3835 3232    import foo8522
+000139c0: 3336 3538 2061 7320 6261 720a 2020 2020  3658 as bar.    
+000139d0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
+000139e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000139f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00013a00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00013a10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
+00013a20: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
+00013a30: 7220 2020 2020 2020 2020 2020 2020 2020  r               
+00013a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a50: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
+00013a60: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
+00013a70: 7374 290a 2020 2020 2020 2020 2e2e 2e20  st).        ... 
+00013a80: 696e 202e 2e2e 0a20 2020 2020 2020 204e  in ....        N
+00013a90: 616d 6545 7272 6f72 3a20 6e61 6d65 2027  ameError: name '
+00013aa0: 6261 7227 2069 7320 6e6f 7420 6465 6669  bar' is not defi
+00013ab0: 6e65 640a 2020 2020 2222 222c 0a20 2020  ned.    """,.   
+00013ac0: 2020 2020 2050 5946 4c59 4259 5f50 4154       PYFLYBY_PAT
+00013ad0: 483d 746d 702e 6669 6c65 2c0a 2020 2020  H=tmp.file,.    
+00013ae0: 2020 2020 6175 746f 6361 6c6c 3d54 7275      autocall=Tru
+00013af0: 652c 0a20 2020 2029 0a0a 0a40 7265 7472  e,.    )...@retr
+00013b00: 790a 6465 6620 7465 7374 5f63 6f6d 706c  y.def test_compl
+00013b10: 6574 655f 7379 6d62 6f6c 5f62 6173 6963  ete_symbol_basic
+00013b20: 5f31 2829 3a0a 2020 2020 2320 5665 7269  _1():.    # Veri
+00013b30: 6679 2074 6861 7420 7461 6220 636f 6d70  fy that tab comp
+00013b40: 6c65 7469 6f6e 2077 6f72 6b73 2e0a 2020  letion works..  
+00013b50: 2020 6970 7974 686f 6e28 2222 220a 2020    ipython(""".  
+00013b60: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
+00013b70: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
+00013b80: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
+00013b90: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
+00013ba0: 2020 2020 2049 6e20 5b32 5d3a 2062 3634       In [2]: b64
+00013bb0: 6465 636f 5c74 6465 2827 6548 6c36 656e  deco\tde('eHl6en
+00013bc0: 6b3d 2729 0a20 2020 2020 2020 205b 5059  k=').        [PY
+00013bd0: 464c 5942 595d 2066 726f 6d20 6261 7365  FLYBY] from base
+00013be0: 3634 2069 6d70 6f72 7420 6236 3464 6563  64 import b64dec
+00013bf0: 6f64 650a 2020 2020 2020 2020 4f75 745b  ode.        Out[
+00013c00: 325d 3a20 6227 7879 7a7a 7927 0a20 2020  2]: b'xyzzy'.   
+00013c10: 2022 2222 290a 0a0a 4072 6574 7279 0a64   """)...@retry.d
+00013c20: 6566 2074 6573 745f 636f 6d70 6c65 7465  ef test_complete
+00013c30: 5f73 796d 626f 6c5f 6d75 6c74 6970 6c65  _symbol_multiple
+00013c40: 5f31 2866 726f 6e74 656e 6429 3a0a 2020  _1(frontend):.  
+00013c50: 2020 6966 2066 726f 6e74 656e 6420 3d3d    if frontend ==
+00013c60: 2022 7072 6f6d 7074 5f74 6f6f 6c6b 6974   "prompt_toolkit
+00013c70: 223a 2070 7974 6573 742e 736b 6970 2829  ": pytest.skip()
+00013c80: 0a20 2020 2069 7079 7468 6f6e 2822 2222  .    ipython("""
+00013c90: 0a20 2020 2020 2020 2049 6e20 5b31 5d3a  .        In [1]:
+00013ca0: 2069 6d70 6f72 7420 7079 666c 7962 793b   import pyflyby;
+00013cb0: 2070 7966 6c79 6279 2e65 6e61 626c 655f   pyflyby.enable_
+00013cc0: 6175 746f 5f69 6d70 6f72 7465 7228 290a  auto_importer().
+00013cd0: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
+00013ce0: 7072 696e 7428 6236 345c 740a 2020 2020  print(b64\t.    
+00013cf0: 2020 2020 6236 3464 6563 6f64 6520 2062      b64decode  b
+00013d00: 3634 656e 636f 6465 0a20 2020 2020 2020  64encode.       
+00013d10: 2049 6e20 5b32 5d3a 2070 7269 6e74 2862   In [2]: print(b
+00013d20: 3634 5c78 3036 6465 636f 6465 290a 2020  64\x06decode).  
+00013d30: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
+00013d40: 6672 6f6d 2062 6173 6536 3420 696d 706f  from base64 impo
+00013d50: 7274 2062 3634 6465 636f 6465 0a20 2020  rt b64decode.   
+00013d60: 2020 2020 203c 6675 6e63 7469 6f6e 2062       <function b
+00013d70: 3634 6465 636f 6465 2e2e 2e3e 0a20 2020  64decode...>.   
+00013d80: 2022 2222 2c20 6672 6f6e 7465 6e64 3d66   """, frontend=f
+00013d90: 726f 6e74 656e 6429 0a0a 0a40 7265 7472  rontend)...@retr
+00013da0: 790a 6465 6620 7465 7374 5f63 6f6d 706c  y.def test_compl
+00013db0: 6574 655f 7379 6d62 6f6c 5f70 6172 7469  ete_symbol_parti
+00013dc0: 616c 5f6d 756c 7469 706c 655f 3128 6672  al_multiple_1(fr
+00013dd0: 6f6e 7465 6e64 293a 0a20 2020 2069 6620  ontend):.    if 
+00013de0: 6672 6f6e 7465 6e64 203d 3d20 2270 726f  frontend == "pro
+00013df0: 6d70 745f 746f 6f6c 6b69 7422 3a20 7079  mpt_toolkit": py
+00013e00: 7465 7374 2e73 6b69 7028 290a 2020 2020  test.skip().    
+00013e10: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
+00013e20: 2020 2020 496e 205b 315d 3a20 696d 706f      In [1]: impo
+00013e30: 7274 2070 7966 6c79 6279 3b20 7079 666c  rt pyflyby; pyfl
+00013e40: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
+00013e50: 696d 706f 7274 6572 2829 0a20 2020 2020  importer().     
+00013e60: 2020 2049 6e20 5b32 5d3a 2070 7269 6e74     In [2]: print
+00013e70: 2862 365c 740a 2020 2020 2020 2020 6236  (b6\t.        b6
+00013e80: 3464 6563 6f64 6520 2062 3634 656e 636f  4decode  b64enco
+00013e90: 6465 0a20 2020 2020 2020 2049 6e20 5b32  de.        In [2
+00013ea0: 5d3a 2070 7269 6e74 2862 3634 5c78 3036  ]: print(b64\x06
+00013eb0: 645c 7465 636f 6465 290a 2020 2020 2020  d\tecode).      
+00013ec0: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
+00013ed0: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
+00013ee0: 3634 6465 636f 6465 0a20 2020 2020 2020  64decode.       
+00013ef0: 203c 6675 6e63 7469 6f6e 2062 3634 6465   <function b64de
+00013f00: 636f 6465 2e2e 2e3e 0a20 2020 2022 2222  code...>.    """
+00013f10: 2c20 6672 6f6e 7465 6e64 3d66 726f 6e74  , frontend=front
+00013f20: 656e 6429 0a0a 0a40 7265 7472 790a 6465  end)...@retry.de
+00013f30: 6620 7465 7374 5f63 6f6d 706c 6574 655f  f test_complete_
+00013f40: 7379 6d62 6f6c 5f69 6d70 6f72 745f 6368  symbol_import_ch
+00013f50: 6563 6b5f 3128 293a 0a20 2020 2023 2043  eck_1():.    # C
+00013f60: 6865 636b 2069 6d70 6f72 7469 6e67 2069  heck importing i
+00013f70: 6e74 6f20 7468 6520 6e61 6d65 7370 6163  nto the namespac
+00013f80: 652e 2020 4966 2077 6520 7573 6520 6236  e.  If we use b6
+00013f90: 3464 6563 6f64 6520 6672 6f6d 2062 6173  4decode from bas
+00013fa0: 6536 342c 0a20 2020 2023 2074 6865 6e20  e64,.    # then 
+00013fb0: 6236 3464 6563 6f64 6520 7368 6f75 6c64  b64decode should
+00013fc0: 2062 6520 696d 706f 7274 6564 2069 6e74   be imported int
+00013fd0: 6f20 7468 6520 6e61 6d65 7370 6163 652c  o the namespace,
+00013fe0: 2062 7574 2062 6173 6536 3420 7368 6f75   but base64 shou
+00013ff0: 6c64 0a20 2020 2023 206e 6f74 2e0a 2020  ld.    # not..  
+00014000: 2020 6970 7974 686f 6e28 2222 220a 2020    ipython(""".  
+00014010: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
+00014020: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
+00014030: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
+00014040: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
+00014050: 2020 2020 2049 6e20 5b32 5d3a 2027 6261       In [2]: 'ba
+00014060: 7365 3634 2720 696e 2067 6c6f 6261 6c73  se64' in globals
+00014070: 2829 0a20 2020 2020 2020 204f 7574 5b32  ().        Out[2
+00014080: 5d3a 2046 616c 7365 0a20 2020 2020 2020  ]: False.       
+00014090: 2049 6e20 5b33 5d3a 2027 6236 3464 6563   In [3]: 'b64dec
+000140a0: 6f64 6527 2069 6e20 676c 6f62 616c 7328  ode' in globals(
+000140b0: 290a 2020 2020 2020 2020 4f75 745b 335d  ).        Out[3]
+000140c0: 3a20 4661 6c73 650a 2020 2020 2020 2020  : False.        
+000140d0: 496e 205b 345d 3a20 6236 3464 6563 6f5c  In [4]: b64deco\
+000140e0: 7464 6528 2755 6e56 6961 574e 7662 673d  tde('UnViaWNvbg=
+000140f0: 3d27 290a 2020 2020 2020 2020 5b50 5946  =').        [PYF
+00014100: 4c59 4259 5d20 6672 6f6d 2062 6173 6536  LYBY] from base6
+00014110: 3420 696d 706f 7274 2062 3634 6465 636f  4 import b64deco
+00014120: 6465 0a20 2020 2020 2020 204f 7574 5b34  de.        Out[4
+00014130: 5d3a 2062 2752 7562 6963 6f6e 270a 2020  ]: b'Rubicon'.  
+00014140: 2020 2020 2020 496e 205b 355d 3a20 2762        In [5]: 'b
+00014150: 6173 6536 3427 2069 6e20 676c 6f62 616c  ase64' in global
+00014160: 7328 290a 2020 2020 2020 2020 4f75 745b  s().        Out[
+00014170: 355d 3a20 4661 6c73 650a 2020 2020 2020  5]: False.      
+00014180: 2020 496e 205b 365d 3a20 2762 3634 6465    In [6]: 'b64de
+00014190: 636f 6465 2720 696e 2067 6c6f 6261 6c73  code' in globals
+000141a0: 2829 0a20 2020 2020 2020 204f 7574 5b36  ().        Out[6
+000141b0: 5d3a 2054 7275 650a 2020 2020 2222 2229  ]: True.    """)
+000141c0: 0a0a 0a40 7265 7472 790a 6465 6620 7465  ...@retry.def te
+000141d0: 7374 5f63 6f6d 706c 6574 655f 7379 6d62  st_complete_symb
+000141e0: 6f6c 5f69 6e73 7461 6e63 655f 6964 656e  ol_instance_iden
+000141f0: 7469 7479 5f31 2829 3a0a 2020 2020 2320  tity_1():.    # 
+00014200: 5665 7269 6679 2074 6861 7420 6175 746f  Verify that auto
+00014210: 6d61 7469 6320 7379 6d62 6f6c 7320 6769  matic symbols gi
+00014220: 7665 2074 6865 2073 616d 6520 696e 7374  ve the same inst
+00014230: 616e 6365 2028 692e 652e 2c20 6e6f 2070  ance (i.e., no p
+00014240: 726f 7879 0a20 2020 2023 206f 626a 6563  roxy.    # objec
+00014250: 7473 2069 6e76 6f6c 7665 6429 2e0a 2020  ts involved)..  
+00014260: 2020 6970 7974 686f 6e28 2222 220a 2020    ipython(""".  
+00014270: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
+00014280: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
+00014290: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
+000142a0: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
+000142b0: 2020 2020 2049 6e20 5b32 5d3a 2066 203d       In [2]: f =
+000142c0: 2062 3634 6465 636f 5c74 6465 0a20 2020   b64deco\tde.   
+000142d0: 2020 2020 205b 5059 464c 5942 595d 2066       [PYFLYBY] f
+000142e0: 726f 6d20 6261 7365 3634 2069 6d70 6f72  rom base64 impor
+000142f0: 7420 6236 3464 6563 6f64 650a 2020 2020  t b64decode.    
+00014300: 2020 2020 496e 205b 335d 3a20 6620 6973      In [3]: f is
+00014310: 205f 5f69 6d70 6f72 745f 5f28 2762 6173   __import__('bas
+00014320: 6536 3427 292e 6236 3464 6563 6f64 650a  e64').b64decode.
+00014330: 2020 2020 2020 2020 4f75 745b 335d 3a20          Out[3]: 
+00014340: 5472 7565 0a20 2020 2022 2222 290a 0a0a  True.    """)...
+00014350: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
+00014360: 636f 6d70 6c65 7465 5f73 796d 626f 6c5f  complete_symbol_
+00014370: 6d65 6d62 6572 5f31 2866 726f 6e74 656e  member_1(fronten
+00014380: 6429 3a0a 2020 2020 2320 5665 7269 6679  d):.    # Verify
+00014390: 2074 6861 7420 7461 6220 636f 6d70 6c65   that tab comple
+000143a0: 7469 6f6e 2069 6e20 6d65 6d62 6572 7320  tion in members 
+000143b0: 776f 726b 732e 0a20 2020 2023 2057 6520  works..    # We 
+000143c0: 6578 7065 6374 2022 6261 7365 3634 2e62  expect "base64.b
+000143d0: 3634 6422 2074 6f20 6265 2072 6570 7269  64d" to be repri
+000143e0: 6e74 6564 2061 6761 696e 2061 6674 6572  nted again after
+000143f0: 2074 6865 205b 5059 464c 5942 595d 206c   the [PYFLYBY] l
+00014400: 6f67 0a20 2020 2023 206c 696e 652e 2020  og.    # line.  
+00014410: 2854 6869 7320 6469 6666 6572 7320 6672  (This differs fr
+00014420: 6f6d 2074 6865 2022 6236 3464 6563 6f5c  om the "b64deco\
+00014430: 7422 2063 6173 653a 2069 6e20 7468 6174  t" case: in that
+00014440: 2063 6173 652c 206e 6f74 6869 6e67 0a20   case, nothing. 
+00014450: 2020 2023 206e 6565 6473 2074 6f20 6265     # needs to be
+00014460: 2069 6d70 6f72 7465 6420 746f 2073 6174   imported to sat
+00014470: 6973 6679 2074 6865 2074 6162 2063 6f6d  isfy the tab com
+00014480: 706c 6574 696f 6e2c 2061 6e64 2074 6865  pletion, and the
+00014490: 7265 666f 7265 206e 6f20 6c6f 670a 2020  refore no log.  
+000144a0: 2020 2320 6c69 6e65 2077 6173 2070 7269    # line was pri
+000144b0: 6e74 6564 2e20 204f 544f 482c 2066 6f72  nted.  OTOH, for
+000144c0: 2061 6e20 696e 7075 7420 6f66 2022 6261   an input of "ba
+000144d0: 7365 3634 2e62 3634 6465 636f 5c74 222c  se64.b64deco\t",
+000144e0: 2077 6520 6e65 6564 2074 6f0a 2020 2020   we need to.    
+000144f0: 2320 6669 7273 7420 646f 2061 6e20 6175  # first do an au
+00014500: 746f 6d61 7469 6320 2269 6d70 6f72 7420  tomatic "import 
+00014510: 6261 7365 3634 222c 2077 6869 6368 2063  base64", which c
+00014520: 6175 7365 7320 6c6f 6720 6f75 7470 7574  auses log output
+00014530: 2064 7572 696e 670a 2020 2020 2320 7468   during.    # th
+00014540: 6520 7072 6f6d 7074 2c20 7768 6963 6820  e prompt, which 
+00014550: 6d65 616e 7320 7265 7072 696e 7469 6e67  means reprinting
+00014560: 2074 6865 2069 6e70 7574 2073 6f20 6661   the input so fa
+00014570: 722e 290a 2020 2020 6970 7974 686f 6e28  r.).    ipython(
+00014580: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
+00014590: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
+000145a0: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
+000145b0: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
+000145c0: 2829 0a20 2020 2020 2020 2049 6e20 5b32  ().        In [2
+000145d0: 5d3a 2062 6173 6536 342e 6236 3464 5c74  ]: base64.b64d\t
+000145e0: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
+000145f0: 595d 2069 6d70 6f72 7420 6261 7365 3634  Y] import base64
 00014600: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
-00014610: 2062 6172 0a20 2020 2020 2020 205b 5059   bar.        [PY
-00014620: 464c 5942 595d 204d 756c 7469 706c 6520  FLYBY] Multiple 
-00014630: 6361 6e64 6964 6174 6520 696d 706f 7274  candidate import
-00014640: 7320 666f 7220 6261 722e 2020 506c 6561  s for bar.  Plea
-00014650: 7365 2070 6963 6b20 6f6e 653a 0a20 2020  se pick one:.   
-00014660: 2020 2020 205b 5059 464c 5942 595d 2020       [PYFLYBY]  
-00014670: 2069 6d70 6f72 7420 666f 6f31 3037 3335   import foo10735
-00014680: 3236 3520 6173 2062 6172 0a20 2020 2020  265 as bar.     
-00014690: 2020 205b 5059 464c 5942 595d 2020 2069     [PYFLYBY]   i
-000146a0: 6d70 6f72 7420 666f 6f38 3532 3233 3635  mport foo8522365
-000146b0: 3820 6173 2062 6172 0a20 2020 2020 2020  8 as bar.       
-000146c0: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
-000146d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000146e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000146f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00014700: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
-00014710: 2020 2020 204e 616d 6545 7272 6f72 2020       NameError  
-00014720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014730: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-00014740: 7261 6365 6261 636b 2028 6d6f 7374 2072  raceback (most r
-00014750: 6563 656e 7420 6361 6c6c 206c 6173 7429  ecent call last)
-00014760: 0a20 2020 2020 2020 202e 2e2e 2069 6e20  .        ... in 
-00014770: 2e2e 2e0a 2020 2020 2020 2020 4e61 6d65  ....        Name
-00014780: 4572 726f 723a 206e 616d 6520 2762 6172  Error: name 'bar
-00014790: 2720 6973 206e 6f74 2064 6566 696e 6564  ' is not defined
-000147a0: 0a20 2020 2020 2020 2049 6e20 5b33 5d3a  .        In [3]:
-000147b0: 2062 6172 0a20 2020 2020 2020 205b 5059   bar.        [PY
-000147c0: 464c 5942 595d 204d 756c 7469 706c 6520  FLYBY] Multiple 
-000147d0: 6361 6e64 6964 6174 6520 696d 706f 7274  candidate import
-000147e0: 7320 666f 7220 6261 722e 2020 506c 6561  s for bar.  Plea
-000147f0: 7365 2070 6963 6b20 6f6e 653a 0a20 2020  se pick one:.   
-00014800: 2020 2020 205b 5059 464c 5942 595d 2020       [PYFLYBY]  
-00014810: 2069 6d70 6f72 7420 666f 6f31 3037 3335   import foo10735
-00014820: 3236 3520 6173 2062 6172 0a20 2020 2020  265 as bar.     
-00014830: 2020 205b 5059 464c 5942 595d 2020 2069     [PYFLYBY]   i
-00014840: 6d70 6f72 7420 666f 6f38 3532 3233 3635  mport foo8522365
-00014850: 3820 6173 2062 6172 0a20 2020 2020 2020  8 as bar.       
-00014860: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
-00014870: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00014880: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00014890: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000148a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
-000148b0: 2020 2020 204e 616d 6545 7272 6f72 2020       NameError  
-000148c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148d0: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-000148e0: 7261 6365 6261 636b 2028 6d6f 7374 2072  raceback (most r
-000148f0: 6563 656e 7420 6361 6c6c 206c 6173 7429  ecent call last)
-00014900: 0a20 2020 2020 2020 202e 2e2e 2069 6e20  .        ... in 
-00014910: 2e2e 2e0a 2020 2020 2020 2020 4e61 6d65  ....        Name
-00014920: 4572 726f 723a 206e 616d 6520 2762 6172  Error: name 'bar
-00014930: 2720 6973 206e 6f74 2064 6566 696e 6564  ' is not defined
-00014940: 0a20 2020 2022 2222 2c0a 2020 2020 2020  .    """,.      
-00014950: 2020 5059 464c 5942 595f 5041 5448 3d74    PYFLYBY_PATH=t
-00014960: 6d70 2e66 696c 652c 0a20 2020 2020 2020  mp.file,.       
-00014970: 2061 7574 6f63 616c 6c3d 5472 7565 2c0a   autocall=True,.
-00014980: 2020 2020 290a 0a0a 4072 6574 7279 0a64      )...@retry.d
-00014990: 6566 2074 6573 745f 636f 6d70 6c65 7465  ef test_complete
-000149a0: 5f73 796d 626f 6c5f 6261 7369 635f 3128  _symbol_basic_1(
-000149b0: 293a 0a20 2020 2023 2056 6572 6966 7920  ):.    # Verify 
-000149c0: 7468 6174 2074 6162 2063 6f6d 706c 6574  that tab complet
-000149d0: 696f 6e20 776f 726b 732e 0a20 2020 2069  ion works..    i
-000149e0: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
-000149f0: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
-00014a00: 7420 7079 666c 7962 793b 2070 7966 6c79  t pyflyby; pyfly
-00014a10: 6279 2e65 6e61 626c 655f 6175 746f 5f69  by.enable_auto_i
-00014a20: 6d70 6f72 7465 7228 290a 2020 2020 2020  mporter().      
-00014a30: 2020 496e 205b 325d 3a20 6236 3464 6563    In [2]: b64dec
-00014a40: 6f5c 7464 6528 2765 486c 3665 6e6b 3d27  o\tde('eHl6enk='
-00014a50: 290a 2020 2020 2020 2020 5b50 5946 4c59  ).        [PYFLY
-00014a60: 4259 5d20 6672 6f6d 2062 6173 6536 3420  BY] from base64 
-00014a70: 696d 706f 7274 2062 3634 6465 636f 6465  import b64decode
-00014a80: 0a20 2020 2020 2020 204f 7574 5b32 5d3a  .        Out[2]:
-00014a90: 2062 2778 797a 7a79 270a 2020 2020 2222   b'xyzzy'.    ""
-00014aa0: 2229 0a0a 0a40 7265 7472 790a 6465 6620  ")...@retry.def 
-00014ab0: 7465 7374 5f63 6f6d 706c 6574 655f 7379  test_complete_sy
-00014ac0: 6d62 6f6c 5f6d 756c 7469 706c 655f 3128  mbol_multiple_1(
-00014ad0: 6672 6f6e 7465 6e64 293a 0a20 2020 2069  frontend):.    i
-00014ae0: 6620 6672 6f6e 7465 6e64 203d 3d20 2270  f frontend == "p
-00014af0: 726f 6d70 745f 746f 6f6c 6b69 7422 3a20  rompt_toolkit": 
-00014b00: 7079 7465 7374 2e73 6b69 7028 290a 2020  pytest.skip().  
-00014b10: 2020 6970 7974 686f 6e28 2222 220a 2020    ipython(""".  
-00014b20: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
-00014b30: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
-00014b40: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
-00014b50: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
-00014b60: 2020 2020 2049 6e20 5b32 5d3a 2070 7269       In [2]: pri
-00014b70: 6e74 2862 3634 5c74 0a20 2020 2020 2020  nt(b64\t.       
-00014b80: 2062 3634 6465 636f 6465 2020 6236 3465   b64decode  b64e
-00014b90: 6e63 6f64 650a 2020 2020 2020 2020 496e  ncode.        In
-00014ba0: 205b 325d 3a20 7072 696e 7428 6236 345c   [2]: print(b64\
-00014bb0: 7830 3664 6563 6f64 6529 0a20 2020 2020  x06decode).     
-00014bc0: 2020 205b 5059 464c 5942 595d 2066 726f     [PYFLYBY] fro
-00014bd0: 6d20 6261 7365 3634 2069 6d70 6f72 7420  m base64 import 
-00014be0: 6236 3464 6563 6f64 650a 2020 2020 2020  b64decode.      
-00014bf0: 2020 3c66 756e 6374 696f 6e20 6236 3464    <function b64d
-00014c00: 6563 6f64 652e 2e2e 3e0a 2020 2020 2222  ecode...>.    ""
-00014c10: 222c 2066 726f 6e74 656e 643d 6672 6f6e  ", frontend=fron
-00014c20: 7465 6e64 290a 0a0a 4072 6574 7279 0a64  tend)...@retry.d
-00014c30: 6566 2074 6573 745f 636f 6d70 6c65 7465  ef test_complete
-00014c40: 5f73 796d 626f 6c5f 7061 7274 6961 6c5f  _symbol_partial_
-00014c50: 6d75 6c74 6970 6c65 5f31 2866 726f 6e74  multiple_1(front
-00014c60: 656e 6429 3a0a 2020 2020 6966 2066 726f  end):.    if fro
-00014c70: 6e74 656e 6420 3d3d 2022 7072 6f6d 7074  ntend == "prompt
-00014c80: 5f74 6f6f 6c6b 6974 223a 2070 7974 6573  _toolkit": pytes
-00014c90: 742e 736b 6970 2829 0a20 2020 2069 7079  t.skip().    ipy
-00014ca0: 7468 6f6e 2822 2222 0a20 2020 2020 2020  thon(""".       
-00014cb0: 2049 6e20 5b31 5d3a 2069 6d70 6f72 7420   In [1]: import 
-00014cc0: 7079 666c 7962 793b 2070 7966 6c79 6279  pyflyby; pyflyby
-00014cd0: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
-00014ce0: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
-00014cf0: 496e 205b 325d 3a20 7072 696e 7428 6236  In [2]: print(b6
-00014d00: 5c74 0a20 2020 2020 2020 2062 3634 6465  \t.        b64de
-00014d10: 636f 6465 2020 6236 3465 6e63 6f64 650a  code  b64encode.
-00014d20: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
-00014d30: 7072 696e 7428 6236 345c 7830 3664 5c74  print(b64\x06d\t
-00014d40: 6563 6f64 6529 0a20 2020 2020 2020 205b  ecode).        [
-00014d50: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
-00014d60: 7365 3634 2069 6d70 6f72 7420 6236 3464  se64 import b64d
-00014d70: 6563 6f64 650a 2020 2020 2020 2020 3c66  ecode.        <f
-00014d80: 756e 6374 696f 6e20 6236 3464 6563 6f64  unction b64decod
-00014d90: 652e 2e2e 3e0a 2020 2020 2222 222c 2066  e...>.    """, f
-00014da0: 726f 6e74 656e 643d 6672 6f6e 7465 6e64  rontend=frontend
-00014db0: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
-00014dc0: 6573 745f 636f 6d70 6c65 7465 5f73 796d  est_complete_sym
-00014dd0: 626f 6c5f 696d 706f 7274 5f63 6865 636b  bol_import_check
-00014de0: 5f31 2829 3a0a 2020 2020 2320 4368 6563  _1():.    # Chec
-00014df0: 6b20 696d 706f 7274 696e 6720 696e 746f  k importing into
-00014e00: 2074 6865 206e 616d 6573 7061 6365 2e20   the namespace. 
-00014e10: 2049 6620 7765 2075 7365 2062 3634 6465   If we use b64de
-00014e20: 636f 6465 2066 726f 6d20 6261 7365 3634  code from base64
-00014e30: 2c0a 2020 2020 2320 7468 656e 2062 3634  ,.    # then b64
-00014e40: 6465 636f 6465 2073 686f 756c 6420 6265  decode should be
-00014e50: 2069 6d70 6f72 7465 6420 696e 746f 2074   imported into t
-00014e60: 6865 206e 616d 6573 7061 6365 2c20 6275  he namespace, bu
-00014e70: 7420 6261 7365 3634 2073 686f 756c 640a  t base64 should.
-00014e80: 2020 2020 2320 6e6f 742e 0a20 2020 2069      # not..    i
-00014e90: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
-00014ea0: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
-00014eb0: 7420 7079 666c 7962 793b 2070 7966 6c79  t pyflyby; pyfly
-00014ec0: 6279 2e65 6e61 626c 655f 6175 746f 5f69  by.enable_auto_i
-00014ed0: 6d70 6f72 7465 7228 290a 2020 2020 2020  mporter().      
-00014ee0: 2020 496e 205b 325d 3a20 2762 6173 6536    In [2]: 'base6
-00014ef0: 3427 2069 6e20 676c 6f62 616c 7328 290a  4' in globals().
-00014f00: 2020 2020 2020 2020 4f75 745b 325d 3a20          Out[2]: 
-00014f10: 4661 6c73 650a 2020 2020 2020 2020 496e  False.        In
-00014f20: 205b 335d 3a20 2762 3634 6465 636f 6465   [3]: 'b64decode
-00014f30: 2720 696e 2067 6c6f 6261 6c73 2829 0a20  ' in globals(). 
-00014f40: 2020 2020 2020 204f 7574 5b33 5d3a 2046         Out[3]: F
-00014f50: 616c 7365 0a20 2020 2020 2020 2049 6e20  alse.        In 
-00014f60: 5b34 5d3a 2062 3634 6465 636f 5c74 6465  [4]: b64deco\tde
-00014f70: 2827 556e 5669 6157 4e76 6267 3d3d 2729  ('UnViaWNvbg==')
-00014f80: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
-00014f90: 595d 2066 726f 6d20 6261 7365 3634 2069  Y] from base64 i
-00014fa0: 6d70 6f72 7420 6236 3464 6563 6f64 650a  mport b64decode.
-00014fb0: 2020 2020 2020 2020 4f75 745b 345d 3a20          Out[4]: 
-00014fc0: 6227 5275 6269 636f 6e27 0a20 2020 2020  b'Rubicon'.     
-00014fd0: 2020 2049 6e20 5b35 5d3a 2027 6261 7365     In [5]: 'base
-00014fe0: 3634 2720 696e 2067 6c6f 6261 6c73 2829  64' in globals()
-00014ff0: 0a20 2020 2020 2020 204f 7574 5b35 5d3a  .        Out[5]:
-00015000: 2046 616c 7365 0a20 2020 2020 2020 2049   False.        I
-00015010: 6e20 5b36 5d3a 2027 6236 3464 6563 6f64  n [6]: 'b64decod
-00015020: 6527 2069 6e20 676c 6f62 616c 7328 290a  e' in globals().
-00015030: 2020 2020 2020 2020 4f75 745b 365d 3a20          Out[6]: 
-00015040: 5472 7565 0a20 2020 2022 2222 290a 0a0a  True.    """)...
-00015050: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
-00015060: 636f 6d70 6c65 7465 5f73 796d 626f 6c5f  complete_symbol_
-00015070: 696e 7374 616e 6365 5f69 6465 6e74 6974  instance_identit
-00015080: 795f 3128 293a 0a20 2020 2023 2056 6572  y_1():.    # Ver
-00015090: 6966 7920 7468 6174 2061 7574 6f6d 6174  ify that automat
-000150a0: 6963 2073 796d 626f 6c73 2067 6976 6520  ic symbols give 
-000150b0: 7468 6520 7361 6d65 2069 6e73 7461 6e63  the same instanc
-000150c0: 6520 2869 2e65 2e2c 206e 6f20 7072 6f78  e (i.e., no prox
-000150d0: 790a 2020 2020 2320 6f62 6a65 6374 7320  y.    # objects 
-000150e0: 696e 766f 6c76 6564 292e 0a20 2020 2069  involved)..    i
-000150f0: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
-00015100: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
-00015110: 7420 7079 666c 7962 793b 2070 7966 6c79  t pyflyby; pyfly
-00015120: 6279 2e65 6e61 626c 655f 6175 746f 5f69  by.enable_auto_i
-00015130: 6d70 6f72 7465 7228 290a 2020 2020 2020  mporter().      
-00015140: 2020 496e 205b 325d 3a20 6620 3d20 6236    In [2]: f = b6
-00015150: 3464 6563 6f5c 7464 650a 2020 2020 2020  4deco\tde.      
-00015160: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
-00015170: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
-00015180: 3634 6465 636f 6465 0a20 2020 2020 2020  64decode.       
-00015190: 2049 6e20 5b33 5d3a 2066 2069 7320 5f5f   In [3]: f is __
-000151a0: 696d 706f 7274 5f5f 2827 6261 7365 3634  import__('base64
-000151b0: 2729 2e62 3634 6465 636f 6465 0a20 2020  ').b64decode.   
-000151c0: 2020 2020 204f 7574 5b33 5d3a 2054 7275       Out[3]: Tru
-000151d0: 650a 2020 2020 2222 2229 0a0a 0a40 7265  e.    """)...@re
-000151e0: 7472 790a 6465 6620 7465 7374 5f63 6f6d  try.def test_com
-000151f0: 706c 6574 655f 7379 6d62 6f6c 5f6d 656d  plete_symbol_mem
-00015200: 6265 725f 3128 6672 6f6e 7465 6e64 293a  ber_1(frontend):
-00015210: 0a20 2020 2023 2056 6572 6966 7920 7468  .    # Verify th
-00015220: 6174 2074 6162 2063 6f6d 706c 6574 696f  at tab completio
-00015230: 6e20 696e 206d 656d 6265 7273 2077 6f72  n in members wor
-00015240: 6b73 2e0a 2020 2020 2320 5765 2065 7870  ks..    # We exp
-00015250: 6563 7420 2262 6173 6536 342e 6236 3464  ect "base64.b64d
-00015260: 2220 746f 2062 6520 7265 7072 696e 7465  " to be reprinte
-00015270: 6420 6167 6169 6e20 6166 7465 7220 7468  d again after th
-00015280: 6520 5b50 5946 4c59 4259 5d20 6c6f 670a  e [PYFLYBY] log.
-00015290: 2020 2020 2320 6c69 6e65 2e20 2028 5468      # line.  (Th
-000152a0: 6973 2064 6966 6665 7273 2066 726f 6d20  is differs from 
-000152b0: 7468 6520 2262 3634 6465 636f 5c74 2220  the "b64deco\t" 
-000152c0: 6361 7365 3a20 696e 2074 6861 7420 6361  case: in that ca
-000152d0: 7365 2c20 6e6f 7468 696e 670a 2020 2020  se, nothing.    
-000152e0: 2320 6e65 6564 7320 746f 2062 6520 696d  # needs to be im
-000152f0: 706f 7274 6564 2074 6f20 7361 7469 7366  ported to satisf
-00015300: 7920 7468 6520 7461 6220 636f 6d70 6c65  y the tab comple
-00015310: 7469 6f6e 2c20 616e 6420 7468 6572 6566  tion, and theref
-00015320: 6f72 6520 6e6f 206c 6f67 0a20 2020 2023  ore no log.    #
-00015330: 206c 696e 6520 7761 7320 7072 696e 7465   line was printe
-00015340: 642e 2020 4f54 4f48 2c20 666f 7220 616e  d.  OTOH, for an
-00015350: 2069 6e70 7574 206f 6620 2262 6173 6536   input of "base6
-00015360: 342e 6236 3464 6563 6f5c 7422 2c20 7765  4.b64deco\t", we
-00015370: 206e 6565 6420 746f 0a20 2020 2023 2066   need to.    # f
-00015380: 6972 7374 2064 6f20 616e 2061 7574 6f6d  irst do an autom
-00015390: 6174 6963 2022 696d 706f 7274 2062 6173  atic "import bas
-000153a0: 6536 3422 2c20 7768 6963 6820 6361 7573  e64", which caus
-000153b0: 6573 206c 6f67 206f 7574 7075 7420 6475  es log output du
-000153c0: 7269 6e67 0a20 2020 2023 2074 6865 2070  ring.    # the p
-000153d0: 726f 6d70 742c 2077 6869 6368 206d 6561  rompt, which mea
-000153e0: 6e73 2072 6570 7269 6e74 696e 6720 7468  ns reprinting th
-000153f0: 6520 696e 7075 7420 736f 2066 6172 2e29  e input so far.)
-00015400: 0a20 2020 2069 7079 7468 6f6e 2822 2222  .    ipython("""
-00015410: 0a20 2020 2020 2020 2049 6e20 5b31 5d3a  .        In [1]:
-00015420: 2069 6d70 6f72 7420 7079 666c 7962 793b   import pyflyby;
-00015430: 2070 7966 6c79 6279 2e65 6e61 626c 655f   pyflyby.enable_
-00015440: 6175 746f 5f69 6d70 6f72 7465 7228 290a  auto_importer().
-00015450: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
-00015460: 6261 7365 3634 2e62 3634 645c 740a 2020  base64.b64d\t.  
-00015470: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
-00015480: 696d 706f 7274 2062 6173 6536 340a 2020  import base64.  
-00015490: 2020 2020 2020 496e 205b 325d 3a20 6261        In [2]: ba
-000154a0: 7365 3634 2e62 3634 6465 636f 6465 2827  se64.b64decode('
-000154b0: 6257 3975 6448 6b3d 2729 0a20 2020 2020  bW9udHk=').     
-000154c0: 2020 204f 7574 5b32 5d3a 2062 276d 6f6e     Out[2]: b'mon
-000154d0: 7479 270a 2020 2020 2222 222c 2066 726f  ty'.    """, fro
-000154e0: 6e74 656e 643d 6672 6f6e 7465 6e64 290a  ntend=frontend).
-000154f0: 0a0a 4072 6574 7279 0a64 6566 2074 6573  ..@retry.def tes
-00015500: 745f 636f 6d70 6c65 7465 5f73 796d 626f  t_complete_symbo
-00015510: 6c5f 6d65 6d62 6572 5f6d 756c 7469 706c  l_member_multipl
-00015520: 655f 3128 6672 6f6e 7465 6e64 293a 0a20  e_1(frontend):. 
-00015530: 2020 2069 6620 6672 6f6e 7465 6e64 203d     if frontend =
-00015540: 3d20 2270 726f 6d70 745f 746f 6f6c 6b69  = "prompt_toolki
-00015550: 7422 3a0a 2020 2020 2020 2020 7079 7465  t":.        pyte
-00015560: 7374 2e73 6b69 7028 290a 2020 2020 6970  st.skip().    ip
-00015570: 7974 686f 6e28 0a20 2020 2020 2020 2022  ython(.        "
-00015580: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
-00015590: 5d3a 2069 6d70 6f72 7420 7079 666c 7962  ]: import pyflyb
-000155a0: 793b 2070 7966 6c79 6279 2e65 6e61 626c  y; pyflyby.enabl
-000155b0: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
-000155c0: 290a 2020 2020 2020 2020 496e 205b 325d  ).        In [2]
-000155d0: 3a20 7072 696e 7428 6261 7365 3634 2e62  : print(base64.b
-000155e0: 3634 5c74 0a20 2020 2020 2020 205b 5059  64\t.        [PY
-000155f0: 464c 5942 595d 2069 6d70 6f72 7420 6261  FLYBY] import ba
-00015600: 7365 3634 0a20 2020 2020 2020 2049 6e20  se64.        In 
-00015610: 5b32 5d3a 2070 7269 6e74 2862 6173 6536  [2]: print(base6
-00015620: 342e 6236 340a 2020 2020 2020 2020 6261  4.b64.        ba
-00015630: 7365 3634 2e62 3634 6465 636f 6465 2020  se64.b64decode  
-00015640: 6261 7365 3634 2e62 3634 656e 636f 6465  base64.b64encode
-00015650: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
-00015660: 2070 7269 6e74 2862 6173 6536 342e 6236   print(base64.b6
-00015670: 3429 0a20 2020 2020 2020 202d 2d2d 2d2d  4).        -----
-00015680: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00015690: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000156a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000156b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000156c0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2041  ------.        A
-000156d0: 7474 7269 6275 7465 4572 726f 7220 2020  ttributeError   
-000156e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156f0: 2020 2020 2020 2020 2054 7261 6365 6261           Traceba
-00015700: 636b 2028 6d6f 7374 2072 6563 656e 7420  ck (most recent 
-00015710: 6361 6c6c 206c 6173 7429 0a20 2020 2020  call last).     
-00015720: 2020 202e 2e2e 2069 6e20 2e2e 2e0a 2020     ... in ....  
-00015730: 2020 2020 2020 4174 7472 6962 7574 6545        AttributeE
-00015740: 7272 6f72 3a20 6d6f 6475 6c65 2027 6261  rror: module 'ba
-00015750: 7365 3634 2720 6861 7320 6e6f 2061 7474  se64' has no att
-00015760: 7269 6275 7465 2027 6236 3427 0a20 2020  ribute 'b64'.   
-00015770: 2022 2222 2c0a 2020 2020 2020 2020 6672   """,.        fr
-00015780: 6f6e 7465 6e64 3d66 726f 6e74 656e 642c  ontend=frontend,
-00015790: 0a20 2020 2029 0a0a 0a40 7265 7472 790a  .    )...@retry.
-000157a0: 6465 6620 7465 7374 5f63 6f6d 706c 6574  def test_complet
-000157b0: 655f 7379 6d62 6f6c 5f6d 656d 6265 725f  e_symbol_member_
-000157c0: 7061 7274 6961 6c5f 6d75 6c74 6970 6c65  partial_multiple
-000157d0: 5f31 2866 726f 6e74 656e 6429 3a0a 2020  _1(frontend):.  
-000157e0: 2020 6966 2066 726f 6e74 656e 6420 3d3d    if frontend ==
-000157f0: 2022 7072 6f6d 7074 5f74 6f6f 6c6b 6974   "prompt_toolkit
-00015800: 223a 0a20 2020 2020 2020 2070 7974 6573  ":.        pytes
-00015810: 742e 736b 6970 2829 0a20 2020 2069 7079  t.skip().    ipy
-00015820: 7468 6f6e 280a 2020 2020 2020 2020 2222  thon(.        ""
-00015830: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
-00015840: 3a20 696d 706f 7274 2070 7966 6c79 6279  : import pyflyby
-00015850: 3b20 7079 666c 7962 792e 656e 6162 6c65  ; pyflyby.enable
-00015860: 5f61 7574 6f5f 696d 706f 7274 6572 2829  _auto_importer()
-00015870: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
-00015880: 2070 7269 6e74 2862 6173 6536 342e 6236   print(base64.b6
-00015890: 5c74 0a20 2020 2020 2020 205b 5059 464c  \t.        [PYFL
-000158a0: 5942 595d 2069 6d70 6f72 7420 6261 7365  YBY] import base
-000158b0: 3634 0a20 2020 2020 2020 2049 6e20 5b32  64.        In [2
-000158c0: 5d3a 2070 7269 6e74 2862 6173 6536 342e  ]: print(base64.
-000158d0: 6236 0a20 2020 2020 2020 2062 6173 6536  b6.        base6
-000158e0: 342e 6236 3464 6563 6f64 6520 2062 6173  4.b64decode  bas
-000158f0: 6536 342e 6236 3465 6e63 6f64 650a 2020  e64.b64encode.  
-00015900: 2020 2020 2020 496e 205b 325d 3a20 7072        In [2]: pr
-00015910: 696e 7428 6261 7365 3634 2e62 3634 290a  int(base64.b64).
-00015920: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00015930: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00015940: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00015950: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00015960: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00015970: 2d2d 2d0a 2020 2020 2020 2020 4174 7472  ---.        Attr
-00015980: 6962 7574 6545 7272 6f72 2020 2020 2020  ibuteError      
-00015990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000159a0: 2020 2020 2020 5472 6163 6562 6163 6b20        Traceback 
-000159b0: 286d 6f73 7420 7265 6365 6e74 2063 616c  (most recent cal
-000159c0: 6c20 6c61 7374 290a 2020 2020 2020 2020  l last).        
-000159d0: 2e2e 2e20 696e 202e 2e2e 0a20 2020 2020  ... in ....     
-000159e0: 2020 2041 7474 7269 6275 7465 4572 726f     AttributeErro
-000159f0: 723a 206d 6f64 756c 6520 2762 6173 6536  r: module 'base6
-00015a00: 3427 2068 6173 206e 6f20 6174 7472 6962  4' has no attrib
-00015a10: 7574 6520 2762 3634 270a 2020 2020 2222  ute 'b64'.    ""
-00015a20: 222c 0a20 2020 2020 2020 2066 726f 6e74  ",.        front
-00015a30: 656e 643d 6672 6f6e 7465 6e64 2c0a 2020  end=frontend,.  
-00015a40: 2020 290a 0a0a 4072 6574 7279 0a64 6566    )...@retry.def
-00015a50: 2074 6573 745f 636f 6d70 6c65 7465 5f73   test_complete_s
-00015a60: 796d 626f 6c5f 696d 706f 7274 5f6d 6f64  ymbol_import_mod
-00015a70: 756c 655f 6173 5f31 2866 726f 6e74 656e  ule_as_1(fronten
-00015a80: 642c 2074 6d70 293a 0a20 2020 2077 7269  d, tmp):.    wri
-00015a90: 7465 7465 7874 2874 6d70 2e66 696c 652c  tetext(tmp.file,
-00015aa0: 2022 696d 706f 7274 2062 6173 6536 3420   "import base64 
-00015ab0: 6173 2062 3634 5c6e 2229 0a20 2020 2069  as b64\n").    i
-00015ac0: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
-00015ad0: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
-00015ae0: 7420 7079 666c 7962 793b 2070 7966 6c79  t pyflyby; pyfly
-00015af0: 6279 2e65 6e61 626c 655f 6175 746f 5f69  by.enable_auto_i
-00015b00: 6d70 6f72 7465 7228 290a 2020 2020 2020  mporter().      
-00015b10: 2020 496e 205b 325d 3a20 6236 342e 6236    In [2]: b64.b6
-00015b20: 3464 5c74 0a20 2020 2020 2020 205b 5059  4d\t.        [PY
-00015b30: 464c 5942 595d 2069 6d70 6f72 7420 6261  FLYBY] import ba
-00015b40: 7365 3634 2061 7320 6236 340a 2020 2020  se64 as b64.    
-00015b50: 2020 2020 496e 205b 325d 3a20 6236 342e      In [2]: b64.
-00015b60: 6236 3464 6563 6f64 6528 2763 6d39 7a5a  b64decode('cm9zZ
-00015b70: 574a 315a 413d 3d27 290a 2020 2020 2020  WJ1ZA==').      
-00015b80: 2020 4f75 745b 325d 3a20 6227 726f 7365    Out[2]: b'rose
-00015b90: 6275 6427 0a20 2020 2022 2222 2c20 5059  bud'.    """, PY
-00015ba0: 464c 5942 595f 5041 5448 3d74 6d70 2e66  FLYBY_PATH=tmp.f
-00015bb0: 696c 652c 2066 726f 6e74 656e 643d 6672  ile, frontend=fr
-00015bc0: 6f6e 7465 6e64 290a 0a0a 4072 6574 7279  ontend)...@retry
-00015bd0: 0a64 6566 2074 6573 745f 636f 6d70 6c65  .def test_comple
-00015be0: 7465 5f73 796d 626f 6c5f 7374 6174 656d  te_symbol_statem
-00015bf0: 656e 745f 3128 293a 0a20 2020 2023 2056  ent_1():.    # V
-00015c00: 6572 6966 7920 7468 6174 2074 6162 2063  erify that tab c
-00015c10: 6f6d 706c 6574 696f 6e20 696e 2073 7461  ompletion in sta
-00015c20: 7465 6d65 6e74 7320 776f 726b 732e 2020  tements works.  
-00015c30: 5468 6973 2072 6571 7569 7265 7320 6120  This requires a 
-00015c40: 6d6f 7265 0a20 2020 2023 2073 6f70 6869  more.    # sophi
-00015c50: 7374 6963 6174 6564 2063 6f64 6520 7061  sticated code pa
-00015c60: 7468 2074 6861 6e20 7465 7374 5f63 6f6d  th than test_com
-00015c70: 706c 6574 655f 7379 6d62 6f6c 5f62 6173  plete_symbol_bas
-00015c80: 6963 5f31 2e0a 2020 2020 6970 7974 686f  ic_1..    ipytho
-00015c90: 6e28 2222 220a 2020 2020 2020 2020 496e  n(""".        In
-00015ca0: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
-00015cb0: 6c79 6279 3b20 7079 666c 7962 792e 656e  lyby; pyflyby.en
-00015cc0: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
-00015cd0: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
-00015ce0: 5b32 5d3a 2078 203d 2062 3634 6465 636f  [2]: x = b64deco
-00015cf0: 5c74 6465 2827 5348 5675 6447 5679 2729  \tde('SHVudGVy')
-00015d00: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
-00015d10: 595d 2066 726f 6d20 6261 7365 3634 2069  Y] from base64 i
-00015d20: 6d70 6f72 7420 6236 3464 6563 6f64 650a  mport b64decode.
-00015d30: 2020 2020 2020 2020 496e 205b 335d 3a20          In [3]: 
-00015d40: 780a 2020 2020 2020 2020 4f75 745b 335d  x.        Out[3]
-00015d50: 3a20 6227 4875 6e74 6572 270a 2020 2020  : b'Hunter'.    
-00015d60: 2222 2229 0a0a 0a40 7265 7472 790a 6465  """)...@retry.de
-00015d70: 6620 7465 7374 5f63 6f6d 706c 6574 655f  f test_complete_
-00015d80: 7379 6d62 6f6c 5f6d 756c 7469 6c69 6e65  symbol_multiline
-00015d90: 5f73 7461 7465 6d65 6e74 5f31 2829 3a0a  _statement_1():.
-00015da0: 2020 2020 6970 7974 686f 6e28 2222 220a      ipython(""".
-00015db0: 2020 2020 2020 2020 496e 205b 315d 3a20          In [1]: 
-00015dc0: 696d 706f 7274 2070 7966 6c79 6279 3b20  import pyflyby; 
-00015dd0: 7079 666c 7962 792e 656e 6162 6c65 5f61  pyflyby.enable_a
-00015de0: 7574 6f5f 696d 706f 7274 6572 2829 0a20  uto_importer(). 
-00015df0: 2020 2020 2020 2049 6e20 5b32 5d3a 2069         In [2]: i
-00015e00: 6620 313a 0a20 2020 2020 2020 2020 2020  f 1:.           
-00015e10: 2e2e 2e3a 2020 2020 2070 7269 6e74 2862  ...:     print(b
-00015e20: 3634 6465 636f 5c74 6465 2827 656d 5669  64deco\tde('emVi
-00015e30: 636d 453d 2729 2e64 6563 6f64 6528 2775  cmE=').decode('u
-00015e40: 7466 2d38 2729 290a 2020 2020 2020 2020  tf-8')).        
-00015e50: 2020 202e 2e2e 3a20 2020 2020 7072 696e     ...:     prin
-00015e60: 7428 3432 290a 2020 2020 2020 2020 2020  t(42).          
-00015e70: 202e 2e2e 3a0a 2020 2020 2020 2020 5b50   ...:.        [P
-00015e80: 5946 4c59 4259 5d20 6672 6f6d 2062 6173  YFLYBY] from bas
-00015e90: 6536 3420 696d 706f 7274 2062 3634 6465  e64 import b64de
-00015ea0: 636f 6465 0a20 2020 2020 2020 207a 6562  code.        zeb
-00015eb0: 7261 0a20 2020 2020 2020 2034 320a 2020  ra.        42.  
-00015ec0: 2020 2020 2020 496e 205b 335d 3a20 6966        In [3]: if
-00015ed0: 2031 3a20 7072 696e 7428 6236 3464 6563   1: print(b64dec
-00015ee0: 6f64 6528 2764 476c 6e5a 5849 3d27 292e  ode('dGlnZXI=').
-00015ef0: 6465 636f 6465 2827 7574 662d 3827 2929  decode('utf-8'))
-00015f00: 0a20 2020 2020 2020 2074 6967 6572 0a20  .        tiger. 
-00015f10: 2020 2022 2222 290a 0a0a 4072 6574 7279     """)...@retry
-00015f20: 0a64 6566 2074 6573 745f 636f 6d70 6c65  .def test_comple
-00015f30: 7465 5f73 796d 626f 6c5f 6d75 6c74 696c  te_symbol_multil
-00015f40: 696e 655f 7374 6174 656d 656e 745f 6d65  ine_statement_me
-00015f50: 6d62 6572 5f31 2866 726f 6e74 656e 6429  mber_1(frontend)
-00015f60: 3a0a 2020 2020 6966 2066 726f 6e74 656e  :.    if fronten
-00015f70: 6420 3d3d 2022 7072 6f6d 7074 5f74 6f6f  d == "prompt_too
-00015f80: 6c6b 6974 223a 2070 7974 6573 742e 736b  lkit": pytest.sk
-00015f90: 6970 2829 0a20 2020 2069 7079 7468 6f6e  ip().    ipython
-00015fa0: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
-00015fb0: 5b31 5d3a 2069 6d70 6f72 7420 7079 666c  [1]: import pyfl
-00015fc0: 7962 793b 2070 7966 6c79 6279 2e65 6e61  yby; pyflyby.ena
-00015fd0: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
-00015fe0: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
-00015ff0: 325d 3a20 6966 2031 3a0a 2020 2020 2020  2]: if 1:.      
-00016000: 2020 2020 202e 2e2e 3a20 2020 2020 7072       ...:     pr
-00016010: 696e 7428 6261 7365 3634 2e62 3634 645c  int(base64.b64d\
-00016020: 740a 2020 2020 2020 2020 5b50 5946 4c59  t.        [PYFLY
-00016030: 4259 5d20 696d 706f 7274 2062 6173 6536  BY] import base6
-00016040: 340a 2020 2020 2020 2020 2020 202e 2e2e  4.           ...
-00016050: 3a20 2020 2020 7072 696e 7428 6261 7365  :     print(base
-00016060: 3634 2e62 3634 6465 636f 6465 2827 5a32  64.b64decode('Z2
-00016070: 6c79 5957 5a6d 5a51 3d3d 2729 290a 2020  lyYWZmZQ==')).  
-00016080: 2020 2020 2020 2020 202e 2e2e 3a20 2020           ...:   
-00016090: 2020 7072 696e 7428 3432 290a 2020 2020    print(42).    
-000160a0: 2020 2020 2020 202e 2e2e 3a0a 2020 2020         ...:.    
-000160b0: 2020 2020 6769 7261 6666 650a 2020 2020      giraffe.    
-000160c0: 2020 2020 3432 0a20 2020 2020 2020 2049      42.        I
-000160d0: 6e20 5b33 5d3a 2070 7269 6e74 2862 3634  n [3]: print(b64
-000160e0: 645c 7465 636f 6465 2827 6247 6c76 6267  d\tecode('bGlvbg
-000160f0: 3d3d 2729 290a 2020 2020 2020 2020 5b50  ==')).        [P
-00016100: 5946 4c59 4259 5d20 6672 6f6d 2062 6173  YFLYBY] from bas
-00016110: 6536 3420 696d 706f 7274 2062 3634 6465  e64 import b64de
-00016120: 636f 6465 0a20 2020 2020 2020 206c 696f  code.        lio
-00016130: 6e0a 2020 2020 2222 222c 2066 726f 6e74  n.    """, front
-00016140: 656e 643d 6672 6f6e 7465 6e64 290a 0a0a  end=frontend)...
-00016150: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
-00016160: 636f 6d70 6c65 7465 5f73 796d 626f 6c5f  complete_symbol_
-00016170: 6175 746f 6361 6c6c 5f61 7267 5f31 2829  autocall_arg_1()
-00016180: 3a0a 2020 2020 2320 5665 7269 6679 2074  :.    # Verify t
-00016190: 6861 7420 7461 6220 636f 6d70 6c65 7469  hat tab completi
-000161a0: 6f6e 2077 6f72 6b73 2077 6974 6820 6175  on works with au
-000161b0: 746f 6361 6c6c 2e0a 2020 2020 6966 2050  tocall..    if P
-000161c0: 5932 3a0a 2020 2020 2020 2020 6970 7974  Y2:.        ipyt
-000161d0: 686f 6e28 2222 220a 2020 2020 2020 2020  hon(""".        
-000161e0: 2020 2020 496e 205b 315d 3a20 696d 706f      In [1]: impo
-000161f0: 7274 2070 7966 6c79 6279 3b20 7079 666c  rt pyflyby; pyfl
-00016200: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
-00016210: 696d 706f 7274 6572 2829 0a20 2020 2020  importer().     
-00016220: 2020 2020 2020 2049 6e20 5b32 5d3a 2073         In [2]: s
-00016230: 7472 2e75 7070 6572 2062 3634 6465 636f  tr.upper b64deco
-00016240: 5c74 6465 2827 5132 686c 6432 4a68 5932  \tde('Q2hld2JhY2
-00016250: 4e68 2729 0a20 2020 2020 2020 2020 2020  Nh').           
-00016260: 202d 2d2d 2d2d 2d3e 2073 7472 2e75 7070   ------> str.upp
-00016270: 6572 2862 3634 6465 636f 6465 2827 5132  er(b64decode('Q2
-00016280: 686c 6432 4a68 5932 4e68 2729 290a 2020  hld2JhY2Nh')).  
-00016290: 2020 2020 2020 2020 2020 5b50 5946 4c59            [PYFLY
-000162a0: 4259 5d20 6672 6f6d 2062 6173 6536 3420  BY] from base64 
-000162b0: 696d 706f 7274 2062 3634 6465 636f 6465  import b64decode
-000162c0: 0a20 2020 2020 2020 2020 2020 204f 7574  .            Out
-000162d0: 5b32 5d3a 2027 4348 4557 4241 4343 4127  [2]: 'CHEWBACCA'
-000162e0: 0a20 2020 2020 2020 2022 2222 2c20 6175  .        """, au
-000162f0: 746f 6361 6c6c 3d54 7275 6529 0a20 2020  tocall=True).   
-00016300: 2065 6c69 6620 4950 7974 686f 6e2e 7665   elif IPython.ve
-00016310: 7273 696f 6e5f 696e 666f 203c 2028 372c  rsion_info < (7,
-00016320: 3137 293a 0a20 2020 2020 2020 2023 2054  17):.        # T
-00016330: 6865 2061 7574 6f63 616c 6c20 6172 726f  he autocall arro
-00016340: 7773 2061 7265 2070 7269 6e74 6564 2074  ws are printed t
-00016350: 7769 6365 2069 6e20 6e65 7765 7220 7665  wice in newer ve
-00016360: 7273 696f 6e73 206f 6620 4950 7974 686f  rsions of IPytho
-00016370: 6e0a 2020 2020 2020 2020 2320 2868 7474  n.        # (htt
-00016380: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
-00016390: 6970 7974 686f 6e2f 6970 7974 686f 6e2f  ipython/ipython/
-000163a0: 6973 7375 6573 2f31 3137 3134 292e 0a20  issues/11714).. 
-000163b0: 2020 2020 2020 2069 7079 7468 6f6e 2822         ipython("
-000163c0: 2222 0a20 2020 2020 2020 2020 2020 2049  "".            I
-000163d0: 6e20 5b31 5d3a 2069 6d70 6f72 7420 7079  n [1]: import py
-000163e0: 666c 7962 793b 2070 7966 6c79 6279 2e65  flyby; pyflyby.e
-000163f0: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
-00016400: 7465 7228 290a 2020 2020 2020 2020 2020  ter().          
-00016410: 2020 496e 205b 325d 3a20 6279 7465 732e    In [2]: bytes.
-00016420: 7570 7065 7220 6236 3464 6563 6f5c 7464  upper b64deco\td
-00016430: 6528 2751 3268 6c64 324a 6859 324e 6827  e('Q2hld2JhY2Nh'
-00016440: 290a 2020 2020 2020 2020 2020 2020 2d2d  ).            --
-00016450: 2d2d 2d2d 3e20 6279 7465 732e 7570 7065  ----> bytes.uppe
-00016460: 7228 6236 3464 6563 6f64 6528 2751 3268  r(b64decode('Q2h
-00016470: 6c64 324a 6859 324e 6827 2929 0a20 2020  ld2JhY2Nh')).   
-00016480: 2020 2020 2020 2020 202d 2d2d 2d2d 2d3e           ------>
-00016490: 2062 7974 6573 2e75 7070 6572 2862 3634   bytes.upper(b64
-000164a0: 6465 636f 6465 2827 5132 686c 6432 4a68  decode('Q2hld2Jh
-000164b0: 5932 4e68 2729 290a 2020 2020 2020 2020  Y2Nh')).        
-000164c0: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
-000164d0: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
-000164e0: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
-000164f0: 2020 2020 2020 204f 7574 5b32 5d3a 2062         Out[2]: b
-00016500: 2743 4845 5742 4143 4341 270a 2020 2020  'CHEWBACCA'.    
-00016510: 2020 2020 2222 222c 2061 7574 6f63 616c      """, autocal
-00016520: 6c3d 5472 7565 290a 2020 2020 656c 7365  l=True).    else
-00016530: 3a0a 2020 2020 2020 2020 2320 4950 7974  :.        # IPyt
-00016540: 686f 6e20 372e 3137 2b20 7368 6f75 646c  hon 7.17+ shoudl
-00016550: 2068 6176 6520 6669 7865 6420 646f 7562   have fixed doub
-00016560: 6c65 2061 7574 6f63 616c 6c0a 2020 2020  le autocall.    
-00016570: 2020 2020 6970 7974 686f 6e28 2222 220a      ipython(""".
-00016580: 2020 2020 2020 2020 2020 2020 496e 205b              In [
-00016590: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
-000165a0: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
-000165b0: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-000165c0: 2829 0a20 2020 2020 2020 2020 2020 2049  ().            I
-000165d0: 6e20 5b32 5d3a 2062 7974 6573 2e75 7070  n [2]: bytes.upp
-000165e0: 6572 2062 3634 6465 636f 5c74 6465 2827  er b64deco\tde('
-000165f0: 5132 686c 6432 4a68 5932 4e68 2729 0a20  Q2hld2JhY2Nh'). 
-00016600: 2020 2020 2020 2020 2020 202d 2d2d 2d2d             -----
-00016610: 2d3e 2062 7974 6573 2e75 7070 6572 2862  -> bytes.upper(b
-00016620: 3634 6465 636f 6465 2827 5132 686c 6432  64decode('Q2hld2
-00016630: 4a68 5932 4e68 2729 290a 2020 2020 2020  JhY2Nh')).      
-00016640: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
-00016650: 6672 6f6d 2062 6173 6536 3420 696d 706f  from base64 impo
-00016660: 7274 2062 3634 6465 636f 6465 0a20 2020  rt b64decode.   
-00016670: 2020 2020 2020 2020 204f 7574 5b32 5d3a           Out[2]:
-00016680: 2062 2743 4845 5742 4143 4341 270a 2020   b'CHEWBACCA'.  
-00016690: 2020 2020 2020 2222 222c 2061 7574 6f63        """, autoc
-000166a0: 616c 6c3d 5472 7565 290a 0a0a 4072 6574  all=True)...@ret
-000166b0: 7279 0a64 6566 2074 6573 745f 636f 6d70  ry.def test_comp
-000166c0: 6c65 7465 5f73 796d 626f 6c5f 616e 795f  lete_symbol_any_
-000166d0: 6d6f 6475 6c65 5f31 2866 726f 6e74 656e  module_1(fronten
-000166e0: 642c 2074 6d70 293a 0a20 2020 2023 2056  d, tmp):.    # V
-000166f0: 6572 6966 7920 7468 6174 2063 6f6d 706c  erify that compl
-00016700: 6574 696f 6e20 616e 6420 6175 746f 696d  etion and autoim
-00016710: 706f 7274 2077 6f72 6b73 2066 6f72 2061  port works for a
-00016720: 6e20 6172 6269 7472 6172 7920 6d6f 6475  n arbitrary modu
-00016730: 6c65 2069 6e0a 2020 2020 2320 2450 5954  le in.    # $PYT
-00016740: 484f 4e50 4154 482e 0a20 2020 2077 7269  HONPATH..    wri
-00016750: 7465 7465 7874 2874 6d70 2e64 6972 2f22  tetext(tmp.dir/"
-00016760: 6d31 3839 3038 3639 375f 666f 6f2e 7079  m18908697_foo.py
-00016770: 222c 2022 2222 0a20 2020 2020 2020 6465  ", """.       de
-00016780: 6620 665f 3638 3432 3132 3034 2829 3a20  f f_68421204(): 
-00016790: 7265 7475 726e 2027 676f 6f64 270a 2020  return 'good'.  
-000167a0: 2020 2222 2229 0a20 2020 2069 7079 7468    """).    ipyth
-000167b0: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
-000167c0: 6e20 5b31 5d3a 2069 6d70 6f72 7420 7079  n [1]: import py
-000167d0: 666c 7962 793b 2070 7966 6c79 6279 2e65  flyby; pyflyby.e
-000167e0: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
-000167f0: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
-00016800: 205b 325d 3a20 6d31 3839 3038 3639 375f   [2]: m18908697_
-00016810: 5c74 666f 6f2e 665f 3638 3432 3132 3034  \tfoo.f_68421204
-00016820: 2829 0a20 2020 2020 2020 205b 5059 464c  ().        [PYFL
-00016830: 5942 595d 2069 6d70 6f72 7420 6d31 3839  YBY] import m189
-00016840: 3038 3639 375f 666f 6f0a 2020 2020 2020  08697_foo.      
-00016850: 2020 4f75 745b 325d 3a20 2767 6f6f 6427    Out[2]: 'good'
-00016860: 0a20 2020 2022 2222 2c20 5059 5448 4f4e  .    """, PYTHON
-00016870: 5041 5448 3d74 6d70 2e64 6972 2c20 6672  PATH=tmp.dir, fr
-00016880: 6f6e 7465 6e64 3d66 726f 6e74 656e 6429  ontend=frontend)
-00016890: 0a0a 0a40 7265 7472 790a 6465 6620 7465  ...@retry.def te
-000168a0: 7374 5f63 6f6d 706c 6574 655f 7379 6d62  st_complete_symb
-000168b0: 6f6c 5f61 6e79 5f6d 6f64 756c 655f 6d65  ol_any_module_me
-000168c0: 6d62 6572 5f31 2866 726f 6e74 656e 642c  mber_1(frontend,
-000168d0: 2074 6d70 293a 0a20 2020 2023 2056 6572   tmp):.    # Ver
-000168e0: 6966 7920 7468 6174 2063 6f6d 706c 6574  ify that complet
-000168f0: 696f 6e20 6f6e 206d 656d 6265 7273 2077  ion on members w
-00016900: 6f72 6b73 2066 6f72 2061 6e20 6172 6269  orks for an arbi
-00016910: 7472 6172 7920 6d6f 6475 6c65 2069 6e0a  trary module in.
-00016920: 2020 2020 2320 2450 5954 484f 4e50 4154      # $PYTHONPAT
-00016930: 482e 0a20 2020 2077 7269 7465 7465 7874  H..    writetext
-00016940: 2874 6d70 2e64 6972 2f22 6d35 3131 3435  (tmp.dir/"m51145
-00016950: 3130 385f 666f 6f2e 7079 222c 2022 2222  108_foo.py", """
-00016960: 0a20 2020 2020 2020 2064 6566 2066 5f37  .        def f_7
-00016970: 3633 3133 3535 385f 3539 3537 3731 3931  6313558_59577191
-00016980: 2829 3a20 7265 7475 726e 2027 6f6b 270a  (): return 'ok'.
-00016990: 2020 2020 2222 2229 0a20 2020 2069 7079      """).    ipy
-000169a0: 7468 6f6e 2822 2222 0a20 2020 2020 2020  thon(""".       
-000169b0: 2049 6e20 5b31 5d3a 2069 6d70 6f72 7420   In [1]: import 
-000169c0: 7079 666c 7962 793b 2070 7966 6c79 6279  pyflyby; pyflyby
-000169d0: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
-000169e0: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
-000169f0: 496e 205b 325d 3a20 6d35 3131 3435 3130  In [2]: m5114510
-00016a00: 385f 5c74 666f 6f2e 665f 3736 3331 3335  8_\tfoo.f_763135
-00016a10: 3538 5f5c 740a 2020 2020 2020 2020 5b50  58_\t.        [P
-00016a20: 5946 4c59 4259 5d20 696d 706f 7274 206d  YFLYBY] import m
-00016a30: 3531 3134 3531 3038 5f66 6f6f 0a20 2020  51145108_foo.   
-00016a40: 2020 2020 2049 6e20 5b32 5d3a 206d 3531       In [2]: m51
-00016a50: 3134 3531 3038 5f66 6f6f 2e66 5f37 3633  145108_foo.f_763
-00016a60: 3133 3535 385f 3539 3537 3731 3931 2829  13558_59577191()
-00016a70: 0a20 2020 2020 2020 204f 7574 5b32 5d3a  .        Out[2]:
-00016a80: 2027 6f6b 270a 2020 2020 2222 222c 2050   'ok'.    """, P
-00016a90: 5954 484f 4e50 4154 483d 746d 702e 6469  YTHONPATH=tmp.di
-00016aa0: 722c 2066 726f 6e74 656e 643d 6672 6f6e  r, frontend=fron
-00016ab0: 7465 6e64 290a 0a0a 4072 6574 7279 0a64  tend)...@retry.d
-00016ac0: 6566 2074 6573 745f 636f 6d70 6c65 7465  ef test_complete
-00016ad0: 5f73 796d 626f 6c5f 6261 645f 3128 6672  _symbol_bad_1(fr
-00016ae0: 6f6e 7465 6e64 2c20 746d 7029 3a0a 2020  ontend, tmp):.  
-00016af0: 2020 2320 5665 7269 6679 2074 6861 7420    # Verify that 
-00016b00: 6966 2077 6520 6861 7665 2061 2062 6164  if we have a bad
-00016b10: 2069 7465 6d20 696e 206b 6e6f 776e 2069   item in known i
-00016b20: 6d70 6f72 7473 2c20 7765 2063 6f6d 706c  mports, we compl
-00016b30: 6574 6520 6974 2073 7469 6c6c 2e0a 2020  ete it still..  
-00016b40: 2020 7772 6974 6574 6578 7428 746d 702e    writetext(tmp.
-00016b50: 6669 6c65 2c20 2269 6d70 6f72 7420 666f  file, "import fo
-00016b60: 6f5f 3331 3232 3130 3532 5f62 6172 5c6e  o_31221052_bar\n
-00016b70: 2229 0a20 2020 2069 7079 7468 6f6e 280a  ").    ipython(.
-00016b80: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00016b90: 2020 2020 496e 205b 315d 3a20 696d 706f      In [1]: impo
-00016ba0: 7274 2070 7966 6c79 6279 3b20 7079 666c  rt pyflyby; pyfl
-00016bb0: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
-00016bc0: 696d 706f 7274 6572 2829 0a20 2020 2020  importer().     
-00016bd0: 2020 2049 6e20 5b32 5d3a 2066 6f6f 5f33     In [2]: foo_3
-00016be0: 3132 3231 3035 325f 5c74 6261 720a 2020  1221052_\tbar.  
-00016bf0: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
-00016c00: 696d 706f 7274 2066 6f6f 5f33 3132 3231  import foo_31221
-00016c10: 3035 325f 6261 720a 2020 2020 2020 2020  052_bar.        
-00016c20: 5b50 5946 4c59 4259 5d20 4572 726f 7220  [PYFLYBY] Error 
-00016c30: 6174 7465 6d70 7469 6e67 2074 6f20 2769  attempting to 'i
-00016c40: 6d70 6f72 7420 666f 6f5f 3331 3232 3130  mport foo_312210
-00016c50: 3532 5f62 6172 273a 204d 6f64 756c 654e  52_bar': ModuleN
-00016c60: 6f74 466f 756e 6445 7272 6f72 3a20 4e6f  otFoundError: No
-00016c70: 206d 6f64 756c 6520 6e61 6d65 6420 2766   module named 'f
-00016c80: 6f6f 5f33 3132 3231 3035 325f 6261 7227  oo_31221052_bar'
-00016c90: 0a20 2020 2020 2020 202e 2e2e 2e0a 2020  .        .....  
-00016ca0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00016cb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00016cc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00016cd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00016ce0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00016cf0: 2d0a 2020 2020 2020 2020 4e61 6d65 4572  -.        NameEr
-00016d00: 726f 7220 2020 2020 2020 2020 2020 2020  ror             
-00016d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d20: 2020 2020 5472 6163 6562 6163 6b20 286d      Traceback (m
-00016d30: 6f73 7420 7265 6365 6e74 2063 616c 6c20  ost recent call 
-00016d40: 6c61 7374 290a 2020 2020 2020 2020 2e2e  last).        ..
-00016d50: 2e20 696e 202e 2e2e 0a20 2020 2020 2020  . in ....       
-00016d60: 204e 616d 6545 7272 6f72 3a20 6e61 6d65   NameError: name
-00016d70: 2027 666f 6f5f 3331 3232 3130 3532 5f62   'foo_31221052_b
-00016d80: 6172 2720 6973 206e 6f74 2064 6566 696e  ar' is not defin
-00016d90: 6564 0a20 2020 2022 2222 2c0a 2020 2020  ed.    """,.    
-00016da0: 2020 2020 5059 464c 5942 595f 5041 5448      PYFLYBY_PATH
-00016db0: 3d74 6d70 2e66 696c 652c 0a20 2020 2020  =tmp.file,.     
-00016dc0: 2020 2066 726f 6e74 656e 643d 6672 6f6e     frontend=fron
-00016dd0: 7465 6e64 2c0a 2020 2020 290a 0a0a 4072  tend,.    )...@r
-00016de0: 6574 7279 0a64 6566 2074 6573 745f 636f  etry.def test_co
-00016df0: 6d70 6c65 7465 5f73 796d 626f 6c5f 6261  mplete_symbol_ba
-00016e00: 645f 6173 5f31 2866 726f 6e74 656e 642c  d_as_1(frontend,
-00016e10: 2074 6d70 293a 0a20 2020 2077 7269 7465   tmp):.    write
-00016e20: 7465 7874 2874 6d70 2e66 696c 652c 2022  text(tmp.file, "
-00016e30: 696d 706f 7274 2066 6f6f 5f38 3634 3837  import foo_86487
-00016e40: 3137 3220 6173 2062 6172 5f39 3830 3733  172 as bar_98073
-00016e50: 3036 395f 7175 7578 5c6e 2229 0a20 2020  069_quux\n").   
-00016e60: 2069 7079 7468 6f6e 280a 2020 2020 2020   ipython(.      
-00016e70: 2020 2222 220a 2020 2020 2020 2020 496e    """.        In
-00016e80: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
-00016e90: 6c79 6279 3b20 7079 666c 7962 792e 656e  lyby; pyflyby.en
-00016ea0: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
-00016eb0: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
-00016ec0: 5b32 5d3a 2062 6172 5f39 3830 3733 3036  [2]: bar_9807306
-00016ed0: 395f 5c74 7175 7578 2e61 7364 660a 2020  9_\tquux.asdf.  
-00016ee0: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
-00016ef0: 696d 706f 7274 2066 6f6f 5f38 3634 3837  import foo_86487
-00016f00: 3137 3220 6173 2062 6172 5f39 3830 3733  172 as bar_98073
-00016f10: 3036 395f 7175 7578 0a20 2020 2020 2020  069_quux.       
-00016f20: 205b 5059 464c 5942 595d 2045 7272 6f72   [PYFLYBY] Error
-00016f30: 2061 7474 656d 7074 696e 6720 746f 2027   attempting to '
-00016f40: 696d 706f 7274 2066 6f6f 5f38 3634 3837  import foo_86487
-00016f50: 3137 3220 6173 2062 6172 5f39 3830 3733  172 as bar_98073
-00016f60: 3036 395f 7175 7578 273a 204d 6f64 756c  069_quux': Modul
-00016f70: 654e 6f74 466f 756e 6445 7272 6f72 3a20  eNotFoundError: 
-00016f80: 4e6f 206d 6f64 756c 6520 6e61 6d65 6420  No module named 
-00016f90: 2766 6f6f 5f38 3634 3837 3137 3227 0a20  'foo_86487172'. 
-00016fa0: 2020 2020 2020 202e 2e2e 2e0a 2020 2020         .....    
-00016fb0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
-00016fc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00016fd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00016fe0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00016ff0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
-00017000: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
-00017010: 7220 2020 2020 2020 2020 2020 2020 2020  r               
-00017020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017030: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
-00017040: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
-00017050: 7374 290a 2020 2020 2020 2020 2e2e 2e20  st).        ... 
-00017060: 696e 202e 2e2e 0a20 2020 2020 2020 204e  in ....        N
-00017070: 616d 6545 7272 6f72 3a20 6e61 6d65 2027  ameError: name '
-00017080: 6261 725f 3938 3037 3330 3639 5f71 7575  bar_98073069_quu
-00017090: 7827 2069 7320 6e6f 7420 6465 6669 6e65  x' is not define
-000170a0: 640a 2020 2020 2222 222c 0a20 2020 2020  d.    """,.     
-000170b0: 2020 2050 5946 4c59 4259 5f50 4154 483d     PYFLYBY_PATH=
-000170c0: 746d 702e 6669 6c65 2c0a 2020 2020 2020  tmp.file,.      
-000170d0: 2020 6672 6f6e 7465 6e64 3d66 726f 6e74    frontend=front
-000170e0: 656e 642c 0a20 2020 2029 0a0a 0a40 7265  end,.    )...@re
-000170f0: 7472 790a 6465 6620 7465 7374 5f63 6f6d  try.def test_com
-00017100: 706c 6574 655f 7379 6d62 6f6c 5f6e 6f6e  plete_symbol_non
-00017110: 6d6f 6475 6c65 5f31 2866 726f 6e74 656e  module_1(fronten
-00017120: 642c 2074 6d70 293a 0a20 2020 2023 2056  d, tmp):.    # V
-00017130: 6572 6966 7920 7468 6174 2063 6f6d 706c  erify that compl
-00017140: 6574 696f 6e20 776f 726b 7320 6576 656e  etion works even
-00017150: 2069 6620 6120 6d6f 6475 6c65 2072 6570   if a module rep
-00017160: 6c61 6365 6420 6974 7365 6c66 2069 6e0a  laced itself in.
-00017170: 2020 2020 2320 7379 732e 6d6f 6475 6c65      # sys.module
-00017180: 7320 7769 7468 2061 2070 7365 7564 6f2d  s with a pseudo-
-00017190: 6d6f 6475 6c65 2028 7065 7268 6170 7320  module (perhaps 
-000171a0: 696e 206f 7264 6572 2074 6f20 6765 7420  in order to get 
-000171b0: 6d6f 6475 6c65 0a20 2020 2023 2070 726f  module.    # pro
-000171c0: 7065 7274 6965 7329 2e20 2045 2e67 2e20  perties).  E.g. 
-000171d0: 7073 7574 696c 2c20 6874 7470 733a 2f2f  psutil, https://
-000171e0: 6769 7468 7562 2e63 6f6d 2f6a 6f73 6961  github.com/josia
-000171f0: 6863 6172 6c73 6f6e 2f6d 7072 6f70 2e0a  hcarlson/mprop..
-00017200: 2020 2020 2320 4173 206f 6620 3230 3135      # As of 2015
-00017210: 2d31 302d 3032 2028 3834 3338 6335 3463  -10-02 (8438c54c
-00017220: 292c 2040 7072 6f70 6572 7469 6573 206e  ), @properties n
-00017230: 6f77 2067 6574 2065 7661 6c75 6174 6564  ow get evaluated
-00017240: 2074 7769 6365 2c20 6865 6e63 650a 2020   twice, hence.  
-00017250: 2020 2320 7468 6520 7265 7065 6174 6564    # the repeated
-00017260: 2070 7269 6e74 206f 7574 7075 742e 0a20   print output.. 
-00017270: 2020 2023 2054 4f44 4f3a 2046 6978 2074     # TODO: Fix t
-00017280: 6861 742e 2020 5765 2063 616e 2774 2061  hat.  We can't a
-00017290: 766f 6964 2070 7966 6c79 6279 2065 7661  void pyflyby eva
-000172a0: 6c75 6174 696e 6720 7468 6520 7072 6f70  luating the prop
-000172b0: 6572 7479 2e20 2042 7574 2069 730a 2020  erty.  But is.  
-000172c0: 2020 2320 7468 6572 6520 736f 6d65 2077    # there some w
-000172d0: 6179 2074 6f20 696e 7465 7263 6570 7420  ay to intercept 
-000172e0: 6970 7974 686f 6e27 7320 7375 6273 6571  ipython's subseq
-000172f0: 7565 6e74 2065 7661 6c75 6174 696f 6e20  uent evaluation 
-00017300: 616e 6420 7265 7573 650a 2020 2020 2320  and reuse.    # 
-00017310: 7468 6520 7361 6d65 2072 6573 756c 743f  the same result?
-00017320: 0a20 2020 2077 7269 7465 7465 7874 2874  .    writetext(t
-00017330: 6d70 2e64 6972 2f22 6772 6176 6573 656e  mp.dir/"gravesen
-00017340: 6436 3030 3633 3339 332e 7079 222c 2022  d60063393.py", "
-00017350: 2222 0a20 2020 2020 2020 2069 6d70 6f72  "".        impor
-00017360: 7420 7379 730a 2020 2020 2020 2020 7269  t sys.        ri
-00017370: 7665 7220 3d20 2754 6861 6d65 7327 0a20  ver = 'Thames'. 
-00017380: 2020 2020 2020 2063 6c61 7373 204d 286f         class M(o
-00017390: 626a 6563 7429 3a0a 2020 2020 2020 2020  bject):.        
-000173a0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-000173b0: 2020 2020 2020 2020 2020 6465 6620 7269            def ri
-000173c0: 7665 7228 7365 6c66 293a 0a20 2020 2020  ver(self):.     
-000173d0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000173e0: 2822 696e 2074 6865 2072 6976 6572 2229  ("in the river")
-000173f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017400: 2072 6574 7572 6e20 274d 6564 7761 7927   return 'Medway'
-00017410: 0a20 2020 2020 2020 2020 2020 2040 7072  .            @pr
-00017420: 6f70 6572 7479 0a20 2020 2020 2020 2020  operty.         
-00017430: 2020 2064 6566 2069 736c 616e 6428 7365     def island(se
-00017440: 6c66 293a 0a20 2020 2020 2020 2020 2020  lf):.           
-00017450: 2020 2020 2070 7269 6e74 2822 6f6e 2074       print("on t
-00017460: 6865 2069 736c 616e 6422 290a 2020 2020  he island").    
-00017470: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00017480: 726e 2027 4361 6e76 6579 270a 2020 2020  rn 'Canvey'.    
-00017490: 2020 2020 2020 2020 5f5f 6e61 6d65 5f5f          __name__
-000174a0: 203d 205f 5f6e 616d 655f 5f0a 2020 2020   = __name__.    
-000174b0: 2020 2020 7379 732e 6d6f 6475 6c65 735b      sys.modules[
-000174c0: 5f5f 6e61 6d65 5f5f 5d20 3d20 4d28 290a  __name__] = M().
-000174d0: 2020 2020 2222 2229 0a20 2020 2069 6620      """).    if 
-000174e0: 5059 323a 0a20 2020 2020 2020 2069 7079  PY2:.        ipy
-000174f0: 7468 6f6e 2822 2222 0a20 2020 2020 2020  thon(""".       
-00017500: 2020 2020 2049 6e20 5b31 5d3a 2069 6d70       In [1]: imp
-00017510: 6f72 7420 7079 666c 7962 793b 2070 7966  ort pyflyby; pyf
-00017520: 6c79 6279 2e65 6e61 626c 655f 6175 746f  lyby.enable_auto
-00017530: 5f69 6d70 6f72 7465 7228 290a 2020 2020  _importer().    
-00017540: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
-00017550: 7072 696e 7428 6772 6176 6573 656e 6436  print(gravesend6
-00017560: 3030 3633 5c74 3339 332e 725c 740a 2020  0063\t393.r\t.  
-00017570: 2020 2020 2020 2020 2020 5b50 5946 4c59            [PYFLY
-00017580: 4259 5d20 696d 706f 7274 2067 7261 7665  BY] import grave
-00017590: 7365 6e64 3630 3036 3333 3933 0a20 2020  send60063393.   
-000175a0: 2020 2020 2020 2020 2049 6e20 5b32 5d3a           In [2]:
-000175b0: 2070 7269 6e74 2867 7261 7665 7365 6e64   print(gravesend
-000175c0: 3630 3036 3333 3933 2e72 6976 6572 290a  60063393.river).
-000175d0: 2020 2020 2020 2020 2020 2020 696e 2074              in t
-000175e0: 6865 2072 6976 6572 0a20 2020 2020 2020  he river.       
-000175f0: 2020 2020 2069 6e20 7468 6520 7269 7665       in the rive
-00017600: 720a 2020 2020 2020 2020 2020 2020 4d65  r.            Me
-00017610: 6477 6179 0a20 2020 2020 2020 2020 2020  dway.           
-00017620: 2049 6e20 5b33 5d3a 2070 7269 6e74 2867   In [3]: print(g
-00017630: 7261 7665 7365 6e64 3630 3036 3333 5c74  ravesend600633\t
-00017640: 3933 2e69 735c 746c 616e 6429 0a20 2020  93.is\tland).   
-00017650: 2020 2020 2020 2020 206f 6e20 7468 6520           on the 
-00017660: 6973 6c61 6e64 0a20 2020 2020 2020 2020  island.         
-00017670: 2020 206f 6e20 7468 6520 6973 6c61 6e64     on the island
-00017680: 0a20 2020 2020 2020 2020 2020 2043 616e  .            Can
-00017690: 7665 790a 2020 2020 2020 2020 2222 222c  vey.        """,
-000176a0: 2050 5954 484f 4e50 4154 483d 746d 702e   PYTHONPATH=tmp.
-000176b0: 6469 722c 2066 726f 6e74 656e 643d 6672  dir, frontend=fr
-000176c0: 6f6e 7465 6e64 290a 2020 2020 656c 7365  ontend).    else
-000176d0: 3a0a 2020 2020 2020 2020 6966 2049 5079  :.        if IPy
-000176e0: 7468 6f6e 2e76 6572 7369 6f6e 5f69 6e66  thon.version_inf
-000176f0: 6f20 3e3d 2028 382c 3629 3a0a 2020 2020  o >= (8,6):.    
-00017700: 2020 2020 2020 2020 6578 7472 615f 636f          extra_co
-00017710: 6d70 203d 2027 5c6e 2020 2020 2020 2020  mp = '\n        
-00017720: 2020 2020 696e 2074 6865 2072 6976 6572      in the river
-00017730: 270a 2020 2020 2020 2020 656c 7365 3a0a  '.        else:.
-00017740: 2020 2020 2020 2020 2020 2020 6578 7472              extr
-00017750: 615f 636f 6d70 203d 2027 270a 0a20 2020  a_comp = ''..   
-00017760: 2020 2020 2023 2077 6520 7573 6520 222e       # we use ".
-00017770: 2e2e 2074 6865 2069 736c 616e 6422 2061  .. the island" a
-00017780: 7320 7468 6572 6520 6d69 6768 7420 6265  s there might be
-00017790: 2070 726f 6d70 7420 696e 7365 7274 6564   prompt inserted
-000177a0: 2062 7920 7072 6576 696f 7573 2074 6162   by previous tab
-000177b0: 2063 6f6d 706c 6574 696e 6f0a 2020 2020   completino.    
-000177c0: 2020 2020 6970 7974 686f 6e28 0a20 2020      ipython(.   
-000177d0: 2020 2020 2020 2020 2022 2222 0a20 2020           """.   
-000177e0: 2020 2020 2020 2020 2049 6e20 5b31 5d3a           In [1]:
-000177f0: 2069 6d70 6f72 7420 7079 666c 7962 793b   import pyflyby;
-00017800: 2070 7966 6c79 6279 2e65 6e61 626c 655f   pyflyby.enable_
-00017810: 6175 746f 5f69 6d70 6f72 7465 7228 290a  auto_importer().
-00017820: 2020 2020 2020 2020 2020 2020 496e 205b              In [
-00017830: 325d 3a20 7072 696e 7428 6772 6176 6573  2]: print(graves
-00017840: 656e 6436 3030 3633 5c74 3339 332e 725c  end60063\t393.r\
-00017850: 740a 2020 2020 2020 2020 2020 2020 5b50  t.            [P
-00017860: 5946 4c59 4259 5d20 696d 706f 7274 2067  YFLYBY] import g
-00017870: 7261 7665 7365 6e64 3630 3036 3333 3933  ravesend60063393
-00017880: 7b7d 0a20 2020 2020 2020 2020 2020 2049  {}.            I
-00017890: 6e20 5b32 5d3a 2070 7269 6e74 2867 7261  n [2]: print(gra
-000178a0: 7665 7365 6e64 3630 3036 3333 3933 2e72  vesend60063393.r
-000178b0: 6976 6572 290a 2020 2020 2020 2020 2020  iver).          
-000178c0: 2020 696e 2074 6865 2072 6976 6572 0a20    in the river. 
-000178d0: 2020 2020 2020 2020 2020 2069 6e20 7468             in th
-000178e0: 6520 7269 7665 720a 2020 2020 2020 2020  e river.        
-000178f0: 2020 2020 4d65 6477 6179 0a20 2020 2020      Medway.     
-00017900: 2020 2020 2020 202e 2e2e 2074 6865 2069         ... the i
-00017910: 736c 616e 640a 2020 2020 2020 2020 2020  sland.          
-00017920: 2020 496e 205b 335d 3a20 7072 696e 7428    In [3]: print(
-00017930: 6772 6176 6573 656e 6436 3030 3633 335c  gravesend600633\
-00017940: 7439 332e 6973 5c74 6c61 6e64 290a 2020  t93.is\tland).  
-00017950: 2020 2020 2020 2020 2020 6f6e 2074 6865            on the
-00017960: 2069 736c 616e 640a 2020 2020 2020 2020   island.        
-00017970: 2020 2020 6f6e 2074 6865 2069 736c 616e      on the islan
-00017980: 640a 2020 2020 2020 2020 2020 2020 4361  d.            Ca
-00017990: 6e76 6579 0a20 2020 2020 2020 2022 2222  nvey.        """
-000179a0: 2e66 6f72 6d61 7428 6578 7472 615f 636f  .format(extra_co
-000179b0: 6d70 292c 0a20 2020 2020 2020 2020 2020  mp),.           
-000179c0: 2050 5954 484f 4e50 4154 483d 746d 702e   PYTHONPATH=tmp.
-000179d0: 6469 722c 0a20 2020 2020 2020 2020 2020  dir,.           
-000179e0: 2066 726f 6e74 656e 643d 6672 6f6e 7465   frontend=fronte
-000179f0: 6e64 2c0a 2020 2020 2020 2020 290a 0a0a  nd,.        )...
-00017a00: 2320 544f 444f 3a20 6669 6775 7265 206f  # TODO: figure o
-00017a10: 7574 2049 5079 7468 6f6e 3520 6571 7569  ut IPython5 equi
-00017a20: 7661 6c65 6e74 2066 6f72 2072 6561 646c  valent for readl
-00017a30: 696e 655f 7265 6d6f 7665 5f64 656c 696d  ine_remove_delim
-00017a40: 730a 4070 7974 6573 742e 6d61 726b 2e73  s.@pytest.mark.s
-00017a50: 6b69 7069 6628 0a20 2020 205f 4950 5954  kipif(.    _IPYT
-00017a60: 484f 4e5f 5645 5253 494f 4e20 3c20 2830  HON_VERSION < (0
-00017a70: 2c20 3132 292c 0a20 2020 2072 6561 736f  , 12),.    reaso
-00017a80: 6e3d 2274 6573 7420 6e6f 7420 696d 706c  n="test not impl
-00017a90: 656d 656e 7465 6420 666f 7220 7468 6973  emented for this
-00017aa0: 2076 6572 7369 6f6e 2229 0a64 6566 2074   version").def t
-00017ab0: 6573 745f 636f 6d70 6c65 7465 5f73 796d  est_complete_sym
-00017ac0: 626f 6c5f 6765 7469 7465 6d5f 3128 6672  bol_getitem_1(fr
-00017ad0: 6f6e 7465 6e64 293a 0a20 2020 2069 6620  ontend):.    if 
-00017ae0: 6672 6f6e 7465 6e64 203d 3d20 2270 726f  frontend == "pro
-00017af0: 6d70 745f 746f 6f6c 6b69 7422 3a20 7079  mpt_toolkit": py
-00017b00: 7465 7374 2e73 6b69 7028 290a 2020 2020  test.skip().    
-00017b10: 6966 205f 4950 5954 484f 4e5f 5645 5253  if _IPYTHON_VERS
-00017b20: 494f 4e20 3e3d 2028 352c 293a 2070 7974  ION >= (5,): pyt
-00017b30: 6573 742e 736b 6970 2829 0a20 2020 2069  est.skip().    i
-00017b40: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
-00017b50: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
-00017b60: 7420 7079 666c 7962 793b 2070 7966 6c79  t pyflyby; pyfly
-00017b70: 6279 2e65 6e61 626c 655f 6175 746f 5f69  by.enable_auto_i
-00017b80: 6d70 6f72 7465 7228 290a 2020 2020 2020  mporter().      
-00017b90: 2020 496e 205b 325d 3a20 6170 706c 6573    In [2]: apples
-00017ba0: 203d 205b 274d 6349 6e74 6f73 6827 2c20   = ['McIntosh', 
-00017bb0: 2750 696e 6b4c 6164 7927 5d0a 2020 2020  'PinkLady'].    
-00017bc0: 2020 2020 496e 205b 335d 3a20 6170 706c      In [3]: appl
-00017bd0: 6573 5b31 5d2e 6c5c 740a 2020 2020 2020  es[1].l\t.      
-00017be0: 2020 6170 706c 6573 5b31 5d2e 6c6a 7573    apples[1].ljus
-00017bf0: 7420 2020 6170 706c 6573 5b31 5d2e 6c6f  t   apples[1].lo
-00017c00: 7765 7220 2020 6170 706c 6573 5b31 5d2e  wer   apples[1].
-00017c10: 6c73 7472 6970 0a20 2020 2020 2020 2049  lstrip.        I
-00017c20: 6e20 5b33 5d3a 2061 7070 6c65 735b 315d  n [3]: apples[1]
-00017c30: 2e6c 5c78 3036 6f77 5c74 6572 2829 0a20  .l\x06ow\ter(). 
-00017c40: 2020 2020 2020 204f 7574 5b33 5d3a 2027         Out[3]: '
-00017c50: 7069 6e6b 6c61 6479 270a 2020 2020 2222  pinklady'.    ""
-00017c60: 222c 2061 7267 733d 5b27 2d2d 496e 7465  ", args=['--Inte
-00017c70: 7261 6374 6976 6553 6865 6c6c 2e72 6561  ractiveShell.rea
-00017c80: 646c 696e 655f 7265 6d6f 7665 5f64 656c  dline_remove_del
-00017c90: 696d 733d 2d2f 7e5b 5d27 5d2c 0a20 2020  ims=-/~[]'],.   
-00017ca0: 2020 2020 2020 2020 2066 726f 6e74 656e           fronten
-00017cb0: 643d 6672 6f6e 7465 6e64 290a 0a0a 4070  d=frontend)...@p
-00017cc0: 7974 6573 742e 6d61 726b 2e73 6b69 7069  ytest.mark.skipi
-00017cd0: 6628 0a20 2020 205f 4950 5954 484f 4e5f  f(.    _IPYTHON_
-00017ce0: 5645 5253 494f 4e20 3c20 2830 2c20 3132  VERSION < (0, 12
-00017cf0: 292c 0a20 2020 2072 6561 736f 6e3d 2274  ),.    reason="t
-00017d00: 6573 7420 6e6f 7420 696d 706c 656d 656e  est not implemen
-00017d10: 7465 6420 666f 7220 6f6c 6420 636f 6e66  ted for old conf
-00017d20: 6967 2229 0a40 7265 7472 790a 6465 6620  ig").@retry.def 
-00017d30: 7465 7374 5f63 6f6d 706c 6574 655f 7379  test_complete_sy
-00017d40: 6d62 6f6c 5f67 7265 6564 795f 6576 616c  mbol_greedy_eval
-00017d50: 5f31 2829 3a0a 2020 2020 6970 7974 686f  _1():.    ipytho
-00017d60: 6e28 2222 220a 2020 2020 2020 2020 496e  n(""".        In
-00017d70: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
-00017d80: 6c79 6279 3b20 7079 666c 7962 792e 656e  lyby; pyflyby.en
-00017d90: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
-00017da0: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
-00017db0: 5b32 5d3a 2025 636f 6e66 6967 2049 5043  [2]: %config IPC
-00017dc0: 6f6d 706c 6574 6572 2e67 7265 6564 793d  ompleter.greedy=
-00017dd0: 5472 7565 0a20 2020 2020 2020 2049 6e20  True.        In 
-00017de0: 5b33 5d3a 2061 7070 6c65 203d 2027 4675  [3]: apple = 'Fu
-00017df0: 6a69 270a 2020 2020 2020 2020 496e 205b  ji'.        In [
-00017e00: 345d 3a20 6170 706c 652e 6c6f 7765 7228  4]: apple.lower(
-00017e10: 295b 305d 2e73 7472 695c 7470 2829 0a20  )[0].stri\tp(). 
-00017e20: 2020 2020 2020 204f 7574 5b34 5d3a 2027         Out[4]: '
-00017e30: 6627 0a20 2020 2022 2222 290a 0a0a 4070  f'.    """)...@p
-00017e40: 7974 6573 742e 6d61 726b 2e73 6b69 7069  ytest.mark.skipi
-00017e50: 6628 0a20 2020 205f 4950 5954 484f 4e5f  f(.    _IPYTHON_
-00017e60: 5645 5253 494f 4e20 3c20 2830 2c20 3132  VERSION < (0, 12
-00017e70: 292c 0a20 2020 2072 6561 736f 6e3d 2274  ),.    reason="t
-00017e80: 6573 7420 6e6f 7420 696d 706c 656d 656e  est not implemen
-00017e90: 7465 6420 666f 7220 6f6c 6420 636f 6e66  ted for old conf
-00017ea0: 6967 2229 0a64 6566 2074 6573 745f 636f  ig").def test_co
-00017eb0: 6d70 6c65 7465 5f73 796d 626f 6c5f 6772  mplete_symbol_gr
-00017ec0: 6565 6479 5f65 7661 6c5f 6175 746f 696d  eedy_eval_autoim
-00017ed0: 706f 7274 5f31 2866 726f 6e74 656e 6429  port_1(frontend)
-00017ee0: 3a0a 2020 2020 6966 2066 726f 6e74 656e  :.    if fronten
-00017ef0: 6420 3d3d 2022 7072 6f6d 7074 5f74 6f6f  d == "prompt_too
-00017f00: 6c6b 6974 223a 2070 7974 6573 742e 736b  lkit": pytest.sk
-00017f10: 6970 2829 0a20 2020 2069 6620 5f49 5059  ip().    if _IPY
-00017f20: 5448 4f4e 5f56 4552 5349 4f4e 203e 3d20  THON_VERSION >= 
-00017f30: 2835 2c29 3a20 7079 7465 7374 2e73 6b69  (5,): pytest.ski
-00017f40: 7028 290a 2020 2020 6970 7974 686f 6e28  p().    ipython(
-00017f50: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-00017f60: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
-00017f70: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
-00017f80: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-00017f90: 2829 0a20 2020 2020 2020 2049 6e20 5b32  ().        In [2
-00017fa0: 5d3a 2025 636f 6e66 6967 2049 5043 6f6d  ]: %config IPCom
-00017fb0: 706c 6574 6572 2e67 7265 6564 793d 5472  pleter.greedy=Tr
-00017fc0: 7565 0a20 2020 2020 2020 2049 6e20 5b33  ue.        In [3
-00017fd0: 5d3a 206f 732e 7365 702e 7374 7269 7028  ]: os.sep.strip(
-00017fe0: 292e 6c73 745c 740a 2020 2020 2020 2020  ).lst\t.        
-00017ff0: 5b50 5946 4c59 4259 5d20 696d 706f 7274  [PYFLYBY] import
-00018000: 206f 730a 2020 2020 2020 2020 496e 205b   os.        In [
-00018010: 335d 3a20 6f73 2e73 6570 2e73 7472 6970  3]: os.sep.strip
-00018020: 2829 2e6c 7374 5c74 7269 7028 290a 2020  ().lst\trip().  
-00018030: 2020 2020 2020 4f75 745b 335d 3a20 272f        Out[3]: '/
-00018040: 270a 2020 2020 2222 222c 2066 726f 6e74  '.    """, front
-00018050: 656e 643d 6672 6f6e 7465 6e64 290a 0a0a  end=frontend)...
-00018060: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
-00018070: 636f 6d70 6c65 7465 5f73 796d 626f 6c5f  complete_symbol_
-00018080: 6572 726f 725f 696e 5f67 6574 6174 7472  error_in_getattr
-00018090: 5f31 2866 726f 6e74 656e 6429 3a0a 2020  _1(frontend):.  
-000180a0: 2020 2320 5665 7269 6679 2074 6861 7420    # Verify that 
-000180b0: 6966 2074 6865 7265 2773 2061 6e20 6578  if there's an ex
-000180c0: 6365 7074 696f 6e20 696e 7369 6465 2073  ception inside s
-000180d0: 6f6d 6520 6375 7374 6f6d 206f 626a 6563  ome custom objec
-000180e0: 7427 7320 6765 7461 7474 722c 0a20 2020  t's getattr,.   
-000180f0: 2023 2077 6520 646f 6e27 7420 6765 7420   # we don't get 
-00018100: 636f 6e66 7573 6564 2e0a 2020 2020 6970  confused..    ip
-00018110: 7974 686f 6e28 2222 220a 2020 2020 2020  ython(""".      
-00018120: 2020 496e 205b 315d 3a20 696d 706f 7274    In [1]: import
-00018130: 2070 7966 6c79 6279 3b20 7079 666c 7962   pyflyby; pyflyb
-00018140: 792e 656e 6162 6c65 5f61 7574 6f5f 696d  y.enable_auto_im
-00018150: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
-00018160: 2049 6e20 5b32 5d3a 2063 6c61 7373 204e   In [2]: class N
-00018170: 6175 6768 7479 3a0a 2020 2020 2020 2020  aughty:.        
-00018180: 2020 202e 2e2e 3a20 2020 2020 6465 6620     ...:     def 
-00018190: 5f5f 6765 7461 7474 725f 5f28 7365 6c66  __getattr__(self
-000181a0: 2c20 6b29 3a0a 2020 2020 2020 2020 2020  , k):.          
-000181b0: 202e 2e2e 3a20 2020 2020 2020 2020 312f   ...:         1/
-000181c0: 300a 2020 2020 2020 2020 2020 202e 2e2e  0.           ...
-000181d0: 3a0a 2020 2020 2020 2020 496e 205b 335d  :.        In [3]
-000181e0: 3a20 6e20 3d20 4e61 7567 6874 7928 290a  : n = Naughty().
-000181f0: 2020 2020 2020 2020 496e 205b 345d 3a20          In [4]: 
-00018200: 6e2e 666f 6f2e 625c 745c 7830 360a 2020  n.foo.b\t\x06.  
-00018210: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00018220: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00018230: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00018240: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00018250: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00018260: 2d0a 2020 2020 2020 2020 5a65 726f 4469  -.        ZeroDi
-00018270: 7669 7369 6f6e 4572 726f 7220 2020 2020  visionError     
-00018280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018290: 2020 2020 5472 6163 6562 6163 6b20 286d      Traceback (m
-000182a0: 6f73 7420 7265 6365 6e74 2063 616c 6c20  ost recent call 
-000182b0: 6c61 7374 290a 2020 2020 2020 2020 2e2e  last).        ..
-000182c0: 2e2e 0a20 2020 2020 2020 205a 6572 6f44  ...        ZeroD
-000182d0: 6976 6973 696f 6e45 7272 6f72 3a20 6469  ivisionError: di
-000182e0: 7669 7369 6f6e 2062 7920 7a65 726f 0a20  vision by zero. 
-000182f0: 2020 2020 2020 2049 6e20 5b35 5d3a 2073         In [5]: s
-00018300: 7973 2e73 6574 7472 615c 740a 2020 2020  ys.settra\t.    
-00018310: 2020 2020 5b50 5946 4c59 4259 5d20 696d      [PYFLYBY] im
-00018320: 706f 7274 2073 7973 0a20 2020 2020 2020  port sys.       
-00018330: 2049 6e20 5b35 5d3a 2073 7973 2e73 6574   In [5]: sys.set
-00018340: 7472 6163 650a 2020 2020 2020 2020 4f75  trace.        Ou
-00018350: 745b 355d 3a20 3c2e 2e2e 7365 7474 7261  t[5]: <...settra
-00018360: 6365 3e0a 2020 2020 2222 222c 2066 726f  ce>.    """, fro
-00018370: 6e74 656e 643d 6672 6f6e 7465 6e64 290a  ntend=frontend).
-00018380: 0a0a 4070 7974 6573 742e 6d61 726b 2e73  ..@pytest.mark.s
-00018390: 6b69 7069 6628 0a20 2020 205f 4950 5954  kipif(.    _IPYT
-000183a0: 484f 4e5f 5645 5253 494f 4e20 3c20 2830  HON_VERSION < (0
-000183b0: 2c20 3132 292c 0a20 2020 2072 6561 736f  , 12),.    reaso
-000183c0: 6e3d 2249 5079 7468 6f6e 2076 6572 7369  n="IPython versi
-000183d0: 6f6e 2025 7320 6974 7365 6c66 2069 7320  on %s itself is 
-000183e0: 7472 6967 6765 7273 2073 7570 6572 666c  triggers superfl
-000183f0: 756f 7573 2070 726f 7065 7274 7920 6163  uous property ac
-00018400: 6365 7373 2229 0a64 6566 2074 6573 745f  cess").def test_
-00018410: 7072 6f70 6572 7479 5f6e 6f5f 7375 7065  property_no_supe
-00018420: 7266 6c75 6f75 735f 6163 6365 7373 5f31  rfluous_access_1
-00018430: 2874 6d70 293a 0a20 2020 2023 2056 6572  (tmp):.    # Ver
-00018440: 6966 7920 7468 6174 2077 6520 646f 6e27  ify that we don'
-00018450: 7420 7472 6967 6765 7220 7072 6f70 6572  t trigger proper
-00018460: 7469 6573 206d 6f72 6520 7468 616e 206f  ties more than o
-00018470: 6e63 652e 0a20 2020 2077 7269 7465 7465  nce..    writete
-00018480: 7874 2874 6d70 2e64 6972 2f22 7261 7468  xt(tmp.dir/"rath
-00018490: 6275 6e33 3833 3536 3230 322e 7079 222c  bun38356202.py",
-000184a0: 2022 2222 0a20 2020 2020 2020 2063 6c61   """.        cla
-000184b0: 7373 2041 286f 626a 6563 7429 3a0a 2020  ss A(object):.  
-000184c0: 2020 2020 2020 2020 2020 4070 726f 7065            @prope
-000184d0: 7274 790a 2020 2020 2020 2020 2020 2020  rty.            
-000184e0: 6465 6620 656c 6c73 776f 7274 6828 7365  def ellsworth(se
-000184f0: 6c66 293a 0a20 2020 2020 2020 2020 2020  lf):.           
-00018500: 2020 2020 2070 7269 6e74 2822 6564 6765       print("edge
-00018510: 6772 6f76 6522 290a 2020 2020 2020 2020  grove").        
-00018520: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-00018530: 6461 726c 696e 6774 6f6e 220a 2020 2020  darlington".    
-00018540: 2222 2229 0a20 2020 2069 7079 7468 6f6e  """).    ipython
-00018550: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
-00018560: 5b31 5d3a 2069 6d70 6f72 7420 7079 666c  [1]: import pyfl
-00018570: 7962 793b 2070 7966 6c79 6279 2e65 6e61  yby; pyflyby.ena
-00018580: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
-00018590: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
-000185a0: 325d 3a20 6120 3d20 7261 7468 6275 6e33  2]: a = rathbun3
-000185b0: 3833 3536 3230 322e 4128 290a 2020 2020  8356202.A().    
-000185c0: 2020 2020 5b50 5946 4c59 4259 5d20 696d      [PYFLYBY] im
-000185d0: 706f 7274 2072 6174 6862 756e 3338 3335  port rathbun3835
-000185e0: 3632 3032 0a20 2020 2020 2020 2049 6e20  6202.        In 
-000185f0: 5b33 5d3a 2061 2e65 6c6c 7377 6f72 7468  [3]: a.ellsworth
-00018600: 0a20 2020 2020 2020 2065 6467 6567 726f  .        edgegro
-00018610: 7665 0a20 2020 2020 2020 204f 7574 5b33  ve.        Out[3
-00018620: 5d3a 2027 6461 726c 696e 6774 6f6e 270a  ]: 'darlington'.
-00018630: 2020 2020 2222 222c 2050 5954 484f 4e50      """, PYTHONP
-00018640: 4154 483d 746d 702e 6469 7229 0a0a 0a40  ATH=tmp.dir)...@
-00018650: 7265 7472 790a 6465 6620 7465 7374 5f64  retry.def test_d
-00018660: 6973 6162 6c65 5f72 6565 6e61 626c 655f  isable_reenable_
-00018670: 6175 746f 696d 706f 7274 5f31 2829 3a0a  autoimport_1():.
-00018680: 2020 2020 6970 7974 686f 6e28 0a20 2020      ipython(.   
-00018690: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000186a0: 2049 6e20 5b31 5d3a 2069 6d70 6f72 7420   In [1]: import 
-000186b0: 7079 666c 7962 790a 2020 2020 2020 2020  pyflyby.        
-000186c0: 496e 205b 325d 3a20 7079 666c 7962 792e  In [2]: pyflyby.
-000186d0: 656e 6162 6c65 5f61 7574 6f5f 696d 706f  enable_auto_impo
-000186e0: 7274 6572 2829 0a20 2020 2020 2020 2049  rter().        I
-000186f0: 6e20 5b33 5d3a 2062 3634 656e 636f 6465  n [3]: b64encode
-00018700: 2862 2762 6c75 6527 290a 2020 2020 2020  (b'blue').      
-00018710: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
-00018720: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
-00018730: 3634 656e 636f 6465 0a20 2020 2020 2020  64encode.       
-00018740: 204f 7574 5b33 5d3a 2062 2759 6d78 315a   Out[3]: b'Ymx1Z
-00018750: 513d 3d27 0a20 2020 2020 2020 2049 6e20  Q=='.        In 
-00018760: 5b34 5d3a 2070 7966 6c79 6279 2e64 6973  [4]: pyflyby.dis
-00018770: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
-00018780: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
-00018790: 5b35 5d3a 2062 3634 6465 636f 6465 2827  [5]: b64decode('
-000187a0: 636d 566b 2729 2020 2020 2020 2020 2320  cmVk')        # 
-000187b0: 6578 7065 6374 204e 616d 6545 7272 6f72  expect NameError
-000187c0: 2073 696e 6365 206e 6f20 6175 746f 2069   since no auto i
-000187d0: 6d70 6f72 7465 720a 2020 2020 2020 2020  mporter.        
-000187e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000187f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00018800: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00018810: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00018820: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
-00018830: 2020 2020 4e61 6d65 4572 726f 7220 2020      NameError   
-00018840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018850: 2020 2020 2020 2020 2020 2020 2020 5472                Tr
-00018860: 6163 6562 6163 6b20 286d 6f73 7420 7265  aceback (most re
-00018870: 6365 6e74 2063 616c 6c20 6c61 7374 290a  cent call last).
-00018880: 2020 2020 2020 2020 2e2e 2e20 696e 202e          ... in .
-00018890: 2e2e 0a20 2020 2020 2020 204e 616d 6545  ...        NameE
-000188a0: 7272 6f72 3a20 6e61 6d65 2027 6236 3464  rror: name 'b64d
-000188b0: 6563 6f64 6527 2069 7320 6e6f 7420 6465  ecode' is not de
-000188c0: 6669 6e65 640a 2020 2020 2020 2020 496e  fined.        In
-000188d0: 205b 365d 3a20 6236 3465 6e63 6f64 6528   [6]: b64encode(
-000188e0: 6227 6772 6565 6e27 2920 2020 2020 2020  b'green')       
-000188f0: 2320 7368 6f75 6c64 2073 7469 6c6c 2077  # should still w
-00018900: 6f72 6b20 6265 6361 7573 6520 616c 7265  ork because alre
-00018910: 6164 7920 696d 706f 7274 6564 0a20 2020  ady imported.   
-00018920: 2020 2020 204f 7574 5b36 5d3a 2062 275a       Out[6]: b'Z
-00018930: 334a 6c5a 5734 3d27 0a20 2020 2020 2020  3JlZW4='.       
-00018940: 2049 6e20 5b37 5d3a 2070 7966 6c79 6279   In [7]: pyflyby
-00018950: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
-00018960: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
-00018970: 496e 205b 385d 3a20 6236 3464 6563 6f64  In [8]: b64decod
-00018980: 6528 2765 5756 7362 4739 3327 2920 2020  e('eWVsbG93')   
-00018990: 2023 2073 686f 756c 6420 776f 726b 206e   # should work n
-000189a0: 6f77 0a20 2020 2020 2020 205b 5059 464c  ow.        [PYFL
-000189b0: 5942 595d 2066 726f 6d20 6261 7365 3634  YBY] from base64
-000189c0: 2069 6d70 6f72 7420 6236 3464 6563 6f64   import b64decod
-000189d0: 650a 2020 2020 2020 2020 4f75 745b 385d  e.        Out[8]
-000189e0: 3a20 6227 7965 6c6c 6f77 270a 2020 2020  : b'yellow'.    
-000189f0: 2222 220a 2020 2020 290a 0a0a 4072 6574  """.    )...@ret
-00018a00: 7279 0a64 6566 2074 6573 745f 6469 7361  ry.def test_disa
-00018a10: 626c 655f 7265 656e 6162 6c65 5f63 6f6d  ble_reenable_com
-00018a20: 706c 6574 696f 6e5f 3128 293a 0a20 2020  pletion_1():.   
-00018a30: 2069 7079 7468 6f6e 280a 2020 2020 2020   ipython(.      
-00018a40: 2020 2222 220a 2020 2020 2020 2020 496e    """.        In
-00018a50: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
-00018a60: 6c79 6279 0a20 2020 2020 2020 2049 6e20  lyby.        In 
-00018a70: 5b32 5d3a 2070 7966 6c79 6279 2e65 6e61  [2]: pyflyby.ena
-00018a80: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
-00018a90: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
-00018aa0: 335d 3a20 6236 3465 6e63 6f5c 7464 6528  3]: b64enco\tde(
-00018ab0: 6227 666c 6f77 6572 2729 0a20 2020 2020  b'flower').     
-00018ac0: 2020 205b 5059 464c 5942 595d 2066 726f     [PYFLYBY] fro
-00018ad0: 6d20 6261 7365 3634 2069 6d70 6f72 7420  m base64 import 
-00018ae0: 6236 3465 6e63 6f64 650a 2020 2020 2020  b64encode.      
-00018af0: 2020 4f75 745b 335d 3a20 6227 5a6d 7876    Out[3]: b'Zmxv
-00018b00: 6432 5679 270a 2020 2020 2020 2020 496e  d2Vy'.        In
-00018b10: 205b 345d 3a20 7079 666c 7962 792e 6469   [4]: pyflyby.di
-00018b20: 7361 626c 655f 6175 746f 5f69 6d70 6f72  sable_auto_impor
-00018b30: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
-00018b40: 205b 355d 3a20 6236 3464 6563 6f5c 7428   [5]: b64deco\t(
-00018b50: 2759 3278 7664 5751 3d27 2920 2320 6578  'Y2xvdWQ=') # ex
-00018b60: 7065 6374 204e 616d 6545 7272 6f72 2073  pect NameError s
-00018b70: 696e 6365 206e 6f20 6175 746f 2069 6d70  ince no auto imp
-00018b80: 6f72 7465 720a 2020 2020 2020 2020 2d2d  orter.        --
-00018b90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00018ba0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00018bb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00018bc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00018bd0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00018be0: 2020 4e61 6d65 4572 726f 7220 2020 2020    NameError     
-00018bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c00: 2020 2020 2020 2020 2020 2020 5472 6163              Trac
-00018c10: 6562 6163 6b20 286d 6f73 7420 7265 6365  eback (most rece
-00018c20: 6e74 2063 616c 6c20 6c61 7374 290a 2020  nt call last).  
-00018c30: 2020 2020 2020 2e2e 2e20 696e 202e 2e2e        ... in ...
-00018c40: 0a20 2020 2020 2020 204e 616d 6545 7272  .        NameErr
-00018c50: 6f72 3a20 6e61 6d65 2027 6236 3464 6563  or: name 'b64dec
-00018c60: 6f27 2069 7320 6e6f 7420 6465 6669 6e65  o' is not define
-00018c70: 640a 2020 2020 2020 2020 496e 205b 365d  d.        In [6]
-00018c80: 3a20 6236 3465 6e63 6f5c 7464 6528 6227  : b64enco\tde(b'
-00018c90: 7472 6565 2729 2023 2073 686f 756c 6420  tree') # should 
-00018ca0: 7374 696c 6c20 776f 726b 2062 6563 6175  still work becau
-00018cb0: 7365 2061 6c72 6561 6479 2069 6d70 6f72  se already impor
-00018cc0: 7465 640a 2020 2020 2020 2020 4f75 745b  ted.        Out[
-00018cd0: 365d 3a20 6227 6448 4a6c 5a51 3d3d 270a  6]: b'dHJlZQ=='.
-00018ce0: 2020 2020 2020 2020 496e 205b 375d 3a20          In [7]: 
-00018cf0: 7079 666c 7962 792e 656e 6162 6c65 5f61  pyflyby.enable_a
-00018d00: 7574 6f5f 696d 706f 7274 6572 2829 0a20  uto_importer(). 
-00018d10: 2020 2020 2020 2049 6e20 5b38 5d3a 2062         In [8]: b
-00018d20: 3634 6465 636f 5c74 6465 2827 5932 7876  64deco\tde('Y2xv
-00018d30: 6457 513d 2729 2023 2073 686f 756c 6420  dWQ=') # should 
-00018d40: 776f 726b 206e 6f77 0a20 2020 2020 2020  work now.       
-00018d50: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
-00018d60: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
-00018d70: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
-00018d80: 4f75 745b 385d 3a20 6227 636c 6f75 6427  Out[8]: b'cloud'
-00018d90: 0a20 2020 2022 2222 0a20 2020 2029 0a0a  .    """.    )..
-00018da0: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
-00018db0: 5f70 696e 666f 5f31 2874 6d70 293a 0a20  _pinfo_1(tmp):. 
-00018dc0: 2020 2023 2054 6573 7420 7468 6174 2070     # Test that p
-00018dd0: 696e 666f 2028 6f66 696e 6420 686f 6f6b  info (ofind hook
-00018de0: 2920 776f 726b 732e 0a20 2020 2077 7269  ) works..    wri
-00018df0: 7465 7465 7874 2874 6d70 2e64 6972 2f22  tetext(tmp.dir/"
-00018e00: 6d31 3734 3236 3831 342e 7079 222c 2022  m17426814.py", "
-00018e10: 2222 0a20 2020 2020 2020 2064 6566 2066  "".        def f
-00018e20: 3334 3232 3931 3836 2829 3a0a 2020 2020  34229186():.    
-00018e30: 2020 2020 2020 2020 2768 656c 6c6f 2066          'hello f
-00018e40: 726f 6d20 2720 2027 3334 3232 2720 2027  rom '  '3422'  '
-00018e50: 3931 3836 270a 2020 2020 2222 2229 0a20  9186'.    """). 
-00018e60: 2020 2077 7269 7465 7465 7874 2874 6d70     writetext(tmp
-00018e70: 2e66 696c 652c 2022 6672 6f6d 206d 3137  .file, "from m17
-00018e80: 3432 3638 3134 2069 6d70 6f72 7420 6633  426814 import f3
-00018e90: 3432 3239 3138 365c 6e22 290a 2020 2020  4229186\n").    
-00018ea0: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
-00018eb0: 2020 2020 496e 205b 315d 3a20 696d 706f      In [1]: impo
-00018ec0: 7274 2070 7966 6c79 6279 3b20 7079 666c  rt pyflyby; pyfl
-00018ed0: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
-00018ee0: 696d 706f 7274 6572 2829 0a20 2020 2020  importer().     
-00018ef0: 2020 2049 6e20 5b32 5d3a 2066 3334 3232     In [2]: f3422
-00018f00: 3931 3836 3f0a 2020 2020 2020 2020 5b50  9186?.        [P
-00018f10: 5946 4c59 4259 5d20 6672 6f6d 206d 3137  YFLYBY] from m17
-00018f20: 3432 3638 3134 2069 6d70 6f72 7420 6633  426814 import f3
-00018f30: 3432 3239 3138 360a 2020 2020 2020 2020  4229186.        
-00018f40: 2e2e 2e2e 0a20 2020 2020 2020 2044 6f63  .....        Doc
-00018f50: 7374 7269 6e67 3a2e 2e2e 2e68 656c 6c6f  string:....hello
-00018f60: 2066 726f 6d20 3334 3232 3931 3836 2e2e   from 34229186..
-00018f70: 2e2e 0a20 2020 2022 2222 2c20 5059 5448  ...    """, PYTH
-00018f80: 4f4e 5041 5448 3d74 6d70 2e64 6972 2c20  ONPATH=tmp.dir, 
-00018f90: 5059 464c 5942 595f 5041 5448 3d74 6d70  PYFLYBY_PATH=tmp
-00018fa0: 2e66 696c 6529 0a0a 0a40 7265 7472 790a  .file)...@retry.
-00018fb0: 6465 6620 7465 7374 5f65 7272 6f72 5f64  def test_error_d
-00018fc0: 7572 696e 675f 6175 746f 5f69 6d70 6f72  uring_auto_impor
-00018fd0: 745f 7379 6d62 6f6c 5f31 2874 6d70 293a  t_symbol_1(tmp):
-00018fe0: 0a20 2020 2077 7269 7465 7465 7874 2874  .    writetext(t
-00018ff0: 6d70 2e66 696c 652c 2022 332b 2229 0a20  mp.file, "3+"). 
-00019000: 2020 2069 7079 7468 6f6e 280a 2020 2020     ipython(.    
-00019010: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00019020: 496e 205b 315d 3a20 696d 706f 7274 2070  In [1]: import p
-00019030: 7966 6c79 6279 0a20 2020 2020 2020 2049  yflyby.        I
-00019040: 6e20 5b32 5d3a 2070 7966 6c79 6279 2e65  n [2]: pyflyby.e
-00019050: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
-00019060: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
-00019070: 205b 335d 3a20 362a 370a 2020 2020 2020   [3]: 6*7.      
-00019080: 2020 4f75 745b 335d 3a20 3432 0a20 2020    Out[3]: 42.   
-00019090: 2020 2020 2049 6e20 5b34 5d3a 2075 6e6b       In [4]: unk
-000190a0: 6e6f 776e 5f73 796d 626f 6c5f 3638 3437  nown_symbol_6847
-000190b0: 3030 3432 0a20 2020 2020 2020 205b 5059  0042.        [PY
-000190c0: 464c 5942 595d 2053 796e 7461 7845 7272  FLYBY] SyntaxErr
-000190d0: 6f72 3a20 5768 696c 6520 7061 7273 696e  or: While parsin
-000190e0: 6720 2e2e 2e3a 2069 6e76 616c 6964 2073  g ...: invalid s
-000190f0: 796e 7461 7820 282e 2e2e 2c20 6c69 6e65  yntax (..., line
-00019100: 2031 290a 2020 2020 2020 2020 5b50 5946   1).        [PYF
-00019110: 4c59 4259 5d20 5365 7420 7468 6520 656e  LYBY] Set the en
-00019120: 7620 7661 7220 5059 464c 5942 595f 4c4f  v var PYFLYBY_LO
-00019130: 475f 4c45 5645 4c3d 4445 4255 4720 746f  G_LEVEL=DEBUG to
-00019140: 2064 6562 7567 2e0a 2020 2020 2020 2020   debug..        
-00019150: 5b50 5946 4c59 4259 5d20 4469 7361 626c  [PYFLYBY] Disabl
-00019160: 696e 6720 7079 666c 7962 7920 6175 746f  ing pyflyby auto
-00019170: 2069 6d70 6f72 7465 722e 0a20 2020 2020   importer..     
-00019180: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     -------------
-00019190: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000191a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000191b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000191c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
-000191d0: 2020 2020 2020 204e 616d 6545 7272 6f72         NameError
-000191e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019200: 2054 7261 6365 6261 636b 2028 6d6f 7374   Traceback (most
-00019210: 2072 6563 656e 7420 6361 6c6c 206c 6173   recent call las
-00019220: 7429 0a20 2020 2020 2020 202e 2e2e 2069  t).        ... i
-00019230: 6e20 2e2e 2e0a 2020 2020 2020 2020 4e61  n ....        Na
-00019240: 6d65 4572 726f 723a 206e 616d 6520 2775  meError: name 'u
-00019250: 6e6b 6e6f 776e 5f73 796d 626f 6c5f 3638  nknown_symbol_68
-00019260: 3437 3030 3432 2720 6973 206e 6f74 2064  470042' is not d
-00019270: 6566 696e 6564 0a20 2020 2020 2020 2049  efined.        I
-00019280: 6e20 5b35 5d3a 2075 6e6b 6e6f 776e 5f73  n [5]: unknown_s
-00019290: 796d 626f 6c5f 3736 3636 3333 3837 0a20  ymbol_76663387. 
-000192a0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-000192b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000192c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000192d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000192e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000192f0: 2d2d 0a20 2020 2020 2020 204e 616d 6545  --.        NameE
-00019300: 7272 6f72 2020 2020 2020 2020 2020 2020  rror            
-00019310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019320: 2020 2020 2054 7261 6365 6261 636b 2028       Traceback (
-00019330: 6d6f 7374 2072 6563 656e 7420 6361 6c6c  most recent call
-00019340: 206c 6173 7429 0a20 2020 2020 2020 202e   last).        .
-00019350: 2e2e 2069 6e20 2e2e 2e0a 2020 2020 2020  .. in ....      
-00019360: 2020 4e61 6d65 4572 726f 723a 206e 616d    NameError: nam
-00019370: 6520 2775 6e6b 6e6f 776e 5f73 796d 626f  e 'unknown_symbo
-00019380: 6c5f 3736 3636 3333 3837 2720 6973 206e  l_76663387' is n
-00019390: 6f74 2064 6566 696e 6564 0a20 2020 2022  ot defined.    "
-000193a0: 2222 2c0a 2020 2020 2020 2020 5059 464c  "",.        PYFL
-000193b0: 5942 595f 5041 5448 3d74 6d70 2e66 696c  YBY_PATH=tmp.fil
-000193c0: 652c 0a20 2020 2029 0a0a 0a40 7265 7472  e,.    )...@retr
-000193d0: 790a 6465 6620 7465 7374 5f65 7272 6f72  y.def test_error
-000193e0: 5f64 7572 696e 675f 6175 746f 5f69 6d70  _during_auto_imp
-000193f0: 6f72 745f 6578 7072 6573 7369 6f6e 5f31  ort_expression_1
-00019400: 2874 6d70 293a 0a20 2020 2077 7269 7465  (tmp):.    write
-00019410: 7465 7874 2874 6d70 2e66 696c 652c 2022  text(tmp.file, "
-00019420: 332b 2229 0a20 2020 2069 7079 7468 6f6e  3+").    ipython
-00019430: 280a 2020 2020 2020 2020 2222 220a 2020  (.        """.  
-00019440: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
-00019450: 706f 7274 2070 7966 6c79 6279 0a20 2020  port pyflyby.   
-00019460: 2020 2020 2049 6e20 5b32 5d3a 2070 7966       In [2]: pyf
-00019470: 6c79 6279 2e65 6e61 626c 655f 6175 746f  lyby.enable_auto
-00019480: 5f69 6d70 6f72 7465 7228 290a 2020 2020  _importer().    
-00019490: 2020 2020 496e 205b 335d 3a20 362a 370a      In [3]: 6*7.
-000194a0: 2020 2020 2020 2020 4f75 745b 335d 3a20          Out[3]: 
-000194b0: 3432 0a20 2020 2020 2020 2049 6e20 5b34  42.        In [4
-000194c0: 5d3a 2034 322b 756e 6b6e 6f77 6e5f 7379  ]: 42+unknown_sy
-000194d0: 6d62 6f6c 5f37 3231 3631 3837 300a 2020  mbol_72161870.  
-000194e0: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
-000194f0: 5379 6e74 6178 4572 726f 723a 2057 6869  SyntaxError: Whi
-00019500: 6c65 2070 6172 7369 6e67 202e 2e2e 3a20  le parsing ...: 
-00019510: 696e 7661 6c69 6420 7379 6e74 6178 2028  invalid syntax (
-00019520: 2e2e 2e2c 206c 696e 6520 3129 0a20 2020  ..., line 1).   
-00019530: 2020 2020 205b 5059 464c 5942 595d 2053       [PYFLYBY] S
-00019540: 6574 2074 6865 2065 6e76 2076 6172 2050  et the env var P
-00019550: 5946 4c59 4259 5f4c 4f47 5f4c 4556 454c  YFLYBY_LOG_LEVEL
-00019560: 3d44 4542 5547 2074 6f20 6465 6275 672e  =DEBUG to debug.
-00019570: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
-00019580: 595d 2044 6973 6162 6c69 6e67 2070 7966  Y] Disabling pyf
-00019590: 6c79 6279 2061 7574 6f20 696d 706f 7274  lyby auto import
-000195a0: 6572 2e0a 2020 2020 2020 2020 2d2d 2d2d  er..        ----
-000195b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000195c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000195d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000195e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000195f0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00019600: 4e61 6d65 4572 726f 7220 2020 2020 2020  NameError       
-00019610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019620: 2020 2020 2020 2020 2020 5472 6163 6562            Traceb
-00019630: 6163 6b20 286d 6f73 7420 7265 6365 6e74  ack (most recent
-00019640: 2063 616c 6c20 6c61 7374 290a 2020 2020   call last).    
-00019650: 2020 2020 2e2e 2e20 696e 202e 2e2e 0a20      ... in .... 
-00019660: 2020 2020 2020 204e 616d 6545 7272 6f72         NameError
-00019670: 3a20 6e61 6d65 2027 756e 6b6e 6f77 6e5f  : name 'unknown_
-00019680: 7379 6d62 6f6c 5f37 3231 3631 3837 3027  symbol_72161870'
-00019690: 2069 7320 6e6f 7420 6465 6669 6e65 640a   is not defined.
-000196a0: 2020 2020 2020 2020 496e 205b 355d 3a20          In [5]: 
-000196b0: 3432 2b75 6e6b 6e6f 776e 5f73 796d 626f  42+unknown_symbo
-000196c0: 6c5f 3438 3531 3733 3937 0a20 2020 2020  l_48517397.     
-000196d0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     -------------
-000196e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000196f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00019700: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00019710: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
-00019720: 2020 2020 2020 204e 616d 6545 7272 6f72         NameError
-00019730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019750: 2054 7261 6365 6261 636b 2028 6d6f 7374   Traceback (most
-00019760: 2072 6563 656e 7420 6361 6c6c 206c 6173   recent call las
-00019770: 7429 0a20 2020 2020 2020 202e 2e2e 2069  t).        ... i
-00019780: 6e20 2e2e 2e0a 2020 2020 2020 2020 4e61  n ....        Na
-00019790: 6d65 4572 726f 723a 206e 616d 6520 2775  meError: name 'u
-000197a0: 6e6b 6e6f 776e 5f73 796d 626f 6c5f 3438  nknown_symbol_48
-000197b0: 3531 3733 3937 2720 6973 206e 6f74 2064  517397' is not d
-000197c0: 6566 696e 6564 0a20 2020 2022 2222 2c0a  efined.    """,.
-000197d0: 2020 2020 2020 2020 5059 464c 5942 595f          PYFLYBY_
-000197e0: 5041 5448 3d74 6d70 2e66 696c 652c 0a20  PATH=tmp.file,. 
-000197f0: 2020 2029 0a0a 0a40 7265 7472 790a 6465     )...@retry.de
-00019800: 6620 7465 7374 5f65 7272 6f72 5f64 7572  f test_error_dur
-00019810: 696e 675f 636f 6d70 6c65 7469 6f6e 5f31  ing_completion_1
-00019820: 2866 726f 6e74 656e 642c 2074 6d70 293a  (frontend, tmp):
-00019830: 0a20 2020 2069 6620 6672 6f6e 7465 6e64  .    if frontend
-00019840: 203d 3d20 2270 726f 6d70 745f 746f 6f6c   == "prompt_tool
-00019850: 6b69 7422 3a20 7079 7465 7374 2e73 6b69  kit": pytest.ski
-00019860: 7028 290a 2020 2020 7772 6974 6574 6578  p().    writetex
-00019870: 7428 746d 702e 6669 6c65 2c20 2233 2b22  t(tmp.file, "3+"
-00019880: 290a 2020 2020 6970 7974 686f 6e28 0a20  ).    ipython(. 
-00019890: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000198a0: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
-000198b0: 7420 7079 666c 7962 790a 2020 2020 2020  t pyflyby.      
-000198c0: 2020 496e 205b 325d 3a20 7079 666c 7962    In [2]: pyflyb
-000198d0: 792e 656e 6162 6c65 5f61 7574 6f5f 696d  y.enable_auto_im
-000198e0: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
-000198f0: 2049 6e20 5b33 5d3a 2031 3030 0a20 2020   In [3]: 100.   
-00019900: 2020 2020 204f 7574 5b33 5d3a 2031 3030       Out[3]: 100
-00019910: 0a20 2020 2020 2020 2049 6e20 5b34 5d3a  .        In [4]:
-00019920: 2075 6e6b 6e6f 776e 5f73 796d 626f 6c5f   unknown_symbol_
-00019930: 3134 3935 3433 3034 5f5c 740a 2020 2020  14954304_\t.    
-00019940: 2020 2020 5b50 5946 4c59 4259 5d20 5379      [PYFLYBY] Sy
-00019950: 6e74 6178 4572 726f 723a 2057 6869 6c65  ntaxError: While
-00019960: 2070 6172 7369 6e67 202e 2e2e 3a20 696e   parsing ...: in
-00019970: 7661 6c69 6420 7379 6e74 6178 2028 2e2e  valid syntax (..
-00019980: 2e2c 206c 696e 6520 3129 0a20 2020 2020  ., line 1).     
-00019990: 2020 205b 5059 464c 5942 595d 2053 6574     [PYFLYBY] Set
-000199a0: 2074 6865 2065 6e76 2076 6172 2050 5946   the env var PYF
-000199b0: 4c59 4259 5f4c 4f47 5f4c 4556 454c 3d44  LYBY_LOG_LEVEL=D
-000199c0: 4542 5547 2074 6f20 6465 6275 672e 0a20  EBUG to debug.. 
-000199d0: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
-000199e0: 2044 6973 6162 6c69 6e67 2070 7966 6c79   Disabling pyfly
-000199f0: 6279 2061 7574 6f20 696d 706f 7274 6572  by auto importer
-00019a00: 2e0a 2020 2020 2020 2020 496e 205b 345d  ..        In [4]
-00019a10: 3a20 756e 6b6e 6f77 6e5f 7379 6d62 6f6c  : unknown_symbol
-00019a20: 5f31 3439 3534 3330 345f 5c78 3036 666f  _14954304_\x06fo
-00019a30: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-00019a40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00019a50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00019a60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00019a70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00019a80: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4e61  -----.        Na
-00019a90: 6d65 4572 726f 7220 2020 2020 2020 2020  meError         
-00019aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ab0: 2020 2020 2020 2020 5472 6163 6562 6163          Tracebac
-00019ac0: 6b20 286d 6f73 7420 7265 6365 6e74 2063  k (most recent c
-00019ad0: 616c 6c20 6c61 7374 290a 2020 2020 2020  all last).      
-00019ae0: 2020 2e2e 2e20 696e 202e 2e2e 0a20 2020    ... in ....   
-00019af0: 2020 2020 204e 616d 6545 7272 6f72 3a20       NameError: 
-00019b00: 6e61 6d65 2027 756e 6b6e 6f77 6e5f 7379  name 'unknown_sy
-00019b10: 6d62 6f6c 5f31 3439 3534 3330 345f 666f  mbol_14954304_fo
-00019b20: 6f27 2069 7320 6e6f 7420 6465 6669 6e65  o' is not define
-00019b30: 640a 2020 2020 2020 2020 496e 205b 355d  d.        In [5]
-00019b40: 3a20 3230 300a 2020 2020 2020 2020 4f75  : 200.        Ou
-00019b50: 745b 355d 3a20 3230 300a 2020 2020 2020  t[5]: 200.      
-00019b60: 2020 496e 205b 365d 3a20 756e 6b6e 6f77    In [6]: unknow
-00019b70: 6e5f 7379 6d62 6f6c 5f36 3936 3937 3036  n_symbol_6969706
-00019b80: 365f 5c74 5c78 3036 666f 6f0a 2020 2020  6_\t\x06foo.    
-00019b90: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
-00019ba0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00019bb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00019bc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00019bd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
-00019be0: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
-00019bf0: 7220 2020 2020 2020 2020 2020 2020 2020  r               
-00019c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c10: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
-00019c20: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
-00019c30: 7374 290a 2020 2020 2020 2020 2e2e 2e20  st).        ... 
-00019c40: 696e 202e 2e2e 0a20 2020 2020 2020 204e  in ....        N
-00019c50: 616d 6545 7272 6f72 3a20 6e61 6d65 2027  ameError: name '
-00019c60: 756e 6b6e 6f77 6e5f 7379 6d62 6f6c 5f36  unknown_symbol_6
-00019c70: 3936 3937 3036 365f 666f 6f27 2069 7320  9697066_foo' is 
-00019c80: 6e6f 7420 6465 6669 6e65 640a 2020 2020  not defined.    
-00019c90: 2020 2020 496e 205b 375d 3a20 3330 300a      In [7]: 300.
-00019ca0: 2020 2020 2020 2020 4f75 745b 375d 3a20          Out[7]: 
-00019cb0: 3330 300a 2020 2020 2222 222c 0a20 2020  300.    """,.   
-00019cc0: 2020 2020 2050 5946 4c59 4259 5f50 4154       PYFLYBY_PAT
-00019cd0: 483d 746d 702e 6669 6c65 2c0a 2020 2020  H=tmp.file,.    
-00019ce0: 2020 2020 6672 6f6e 7465 6e64 3d66 726f      frontend=fro
-00019cf0: 6e74 656e 642c 0a20 2020 2029 0a0a 0a40  ntend,.    )...@
-00019d00: 7265 7472 790a 6465 6620 7465 7374 5f73  retry.def test_s
-00019d10: 796e 7461 785f 6572 726f 725f 696e 5f75  yntax_error_in_u
-00019d20: 7365 725f 636f 6465 5f31 2829 3a0a 2020  ser_code_1():.  
-00019d30: 2020 2320 5665 7269 6679 2074 6861 7420    # Verify that 
-00019d40: 7765 2064 6f6e 2774 2069 6e61 6476 6572  we don't inadver
-00019d50: 7465 6e74 6c79 2064 6973 6162 6c65 2074  tently disable t
-00019d60: 6865 2061 7574 6f69 6d70 6f72 7465 7220  he autoimporter 
-00019d70: 6475 6520 746f 0a20 2020 2023 2061 2073  due to.    # a s
-00019d80: 796e 7461 7820 6572 726f 7220 696e 2074  yntax error in t
-00019d90: 6865 2069 6e74 6572 6163 7469 7665 2063  he interactive c
-00019da0: 6f6d 6d61 6e64 2e0a 2020 2020 6970 7974  ommand..    ipyt
-00019db0: 686f 6e28 2222 220a 2020 2020 2020 2020  hon(""".        
-00019dc0: 496e 205b 315d 3a20 696d 706f 7274 2070  In [1]: import p
-00019dd0: 7966 6c79 6279 3b20 7079 666c 7962 792e  yflyby; pyflyby.
-00019de0: 656e 6162 6c65 5f61 7574 6f5f 696d 706f  enable_auto_impo
-00019df0: 7274 6572 2829 0a20 2020 2020 2020 2049  rter().        I
-00019e00: 6e20 5b32 5d3a 2031 2f0a 2020 2020 2020  n [2]: 1/.      
-00019e10: 2020 2e2e 2e2e 0a20 2020 2020 2020 2053    .....        S
-00019e20: 796e 7461 7845 7272 6f72 3a20 696e 7661  yntaxError: inva
-00019e30: 6c69 6420 7379 6e74 6178 0a20 2020 2020  lid syntax.     
-00019e40: 2020 2049 6e20 5b33 5d3a 2062 3634 6465     In [3]: b64de
-00019e50: 636f 6465 2822 6257 6c6b 626d 6c6e 6148  code("bWlkbmlnaH
-00019e60: 513d 2229 0a20 2020 2020 2020 205b 5059  Q=").        [PY
-00019e70: 464c 5942 595d 2066 726f 6d20 6261 7365  FLYBY] from base
-00019e80: 3634 2069 6d70 6f72 7420 6236 3464 6563  64 import b64dec
-00019e90: 6f64 650a 2020 2020 2020 2020 4f75 745b  ode.        Out[
-00019ea0: 335d 3a20 6227 6d69 646e 6967 6874 270a  3]: b'midnight'.
-00019eb0: 2020 2020 2222 2229 0a0a 0a40 7265 7472      """)...@retr
-00019ec0: 790a 6465 6620 7465 7374 5f72 756e 5f31  y.def test_run_1
-00019ed0: 2874 6d70 293a 0a20 2020 2023 2054 6573  (tmp):.    # Tes
-00019ee0: 7420 7468 6174 2025 7275 6e20 776f 726b  t that %run work
-00019ef0: 7320 616e 6420 6175 746f 696d 706f 7274  s and autoimport
-00019f00: 732e 0a20 2020 2077 7269 7465 7465 7874  s..    writetext
-00019f10: 2874 6d70 2e66 696c 652c 2022 2222 0a20  (tmp.file, """. 
-00019f20: 2020 2020 2020 2070 7269 6e74 2827 6865         print('he
-00019f30: 6c6c 6f27 290a 2020 2020 2020 2020 7072  llo').        pr
-00019f40: 696e 7428 6236 3464 6563 6f64 6528 2752  int(b64decode('R
-00019f50: 5856 6a62 476c 6b27 292e 6465 636f 6465  XVjbGlk').decode
-00019f60: 2827 7574 662d 3827 2929 0a20 2020 2022  ('utf-8')).    "
-00019f70: 2222 290a 2020 2020 6970 7974 686f 6e28  "").    ipython(
-00019f80: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-00019f90: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
-00019fa0: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
-00019fb0: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-00019fc0: 2829 0a20 2020 2020 2020 2049 6e20 5b32  ().        In [2
-00019fd0: 5d3a 2072 756e 207b 746d 702e 6669 6c65  ]: run {tmp.file
-00019fe0: 7d0a 2020 2020 2020 2020 5b50 5946 4c59  }.        [PYFLY
-00019ff0: 4259 5d20 6672 6f6d 2062 6173 6536 3420  BY] from base64 
-0001a000: 696d 706f 7274 2062 3634 6465 636f 6465  import b64decode
-0001a010: 0a20 2020 2020 2020 2068 656c 6c6f 0a20  .        hello. 
-0001a020: 2020 2020 2020 2045 7563 6c69 640a 2020         Euclid.  
-0001a030: 2020 2222 222e 666f 726d 6174 2874 6d70    """.format(tmp
-0001a040: 3d74 6d70 2929 0a0a 0a40 7265 7472 790a  =tmp))...@retry.
-0001a050: 6465 6620 7465 7374 5f72 756e 5f72 6570  def test_run_rep
-0001a060: 6561 745f 3128 746d 7029 3a0a 2020 2020  eat_1(tmp):.    
-0001a070: 2320 5465 7374 2074 6861 7420 7265 7065  # Test that repe
-0001a080: 6174 6564 2025 7275 6e20 776f 726b 732c  ated %run works,
-0001a090: 2061 6e64 2063 6f6e 7469 6e75 6573 2061   and continues a
-0001a0a0: 7574 6f69 6d70 6f72 7469 6e67 2c20 7369  utoimporting, si
-0001a0b0: 6e63 6520 7765 0a20 2020 2023 2073 7461  nce we.    # sta
-0001a0c0: 7274 2066 726f 6d20 6120 6672 6573 6820  rt from a fresh 
-0001a0d0: 6e61 6d65 7370 6163 6520 6561 6368 2074  namespace each t
-0001a0e0: 696d 6520 2873 696e 6365 206e 6f20 222d  ime (since no "-
-0001a0f0: 6922 206f 7074 696f 6e20 746f 2025 7275  i" option to %ru
-0001a100: 6e29 2e0a 2020 2020 7772 6974 6574 6578  n)..    writetex
-0001a110: 7428 746d 702e 6669 6c65 2c20 2222 220a  t(tmp.file, """.
-0001a120: 2020 2020 2020 2020 7072 696e 7428 6236          print(b6
-0001a130: 3464 6563 6f64 6528 2751 3246 7564 4739  4decode('Q2FudG9
-0001a140: 7927 292e 6465 636f 6465 2827 7574 662d  y').decode('utf-
-0001a150: 3827 2929 0a20 2020 2022 2222 290a 2020  8')).    """).  
-0001a160: 2020 6970 7974 686f 6e28 2222 220a 2020    ipython(""".  
-0001a170: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
-0001a180: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
-0001a190: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
-0001a1a0: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
-0001a1b0: 2020 2020 2049 6e20 5b32 5d3a 2072 756e       In [2]: run
-0001a1c0: 207b 746d 702e 6669 6c65 7d0a 2020 2020   {tmp.file}.    
-0001a1d0: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
-0001a1e0: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
-0001a1f0: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
-0001a200: 2020 2043 616e 746f 720a 2020 2020 2020     Cantor.      
-0001a210: 2020 496e 205b 335d 3a20 7275 6e20 7b74    In [3]: run {t
-0001a220: 6d70 2e66 696c 657d 0a20 2020 2020 2020  mp.file}.       
-0001a230: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
-0001a240: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
-0001a250: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
-0001a260: 4361 6e74 6f72 0a20 2020 2022 2222 2e66  Cantor.    """.f
-0001a270: 6f72 6d61 7428 746d 703d 746d 7029 290a  ormat(tmp=tmp)).
-0001a280: 0a0a 4072 6574 7279 0a64 6566 2074 6573  ..@retry.def tes
-0001a290: 745f 7275 6e5f 7365 7061 7261 7465 5f73  t_run_separate_s
-0001a2a0: 6372 6970 745f 6e61 6d65 7370 6163 655f  cript_namespace_
-0001a2b0: 3128 746d 7029 3a0a 2020 2020 2320 416e  1(tmp):.    # An
-0001a2c0: 6f74 6865 7220 6578 706c 6963 6974 2074  other explicit t
-0001a2d0: 6573 7420 7468 6174 2077 6520 7374 6172  est that we star
-0001a2e0: 7420 2572 756e 2066 726f 6d20 6120 6672  t %run from a fr
-0001a2f0: 6573 6820 6e61 6d65 7370 6163 650a 2020  esh namespace.  
-0001a300: 2020 7772 6974 6574 6578 7428 746d 702e    writetext(tmp.
-0001a310: 6669 6c65 2c20 2222 220a 2020 2020 2020  file, """.      
-0001a320: 2020 7072 696e 7428 6236 3464 6563 6f64    print(b64decod
-0001a330: 6528 2755 6d6c 6c62 5746 7562 673d 3d27  e('UmllbWFubg=='
-0001a340: 292e 6465 636f 6465 2827 7574 662d 3827  ).decode('utf-8'
-0001a350: 2929 0a20 2020 2022 2222 290a 2020 2020  )).    """).    
-0001a360: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
-0001a370: 2020 2020 496e 205b 315d 3a20 696d 706f      In [1]: impo
-0001a380: 7274 2070 7966 6c79 6279 3b20 7079 666c  rt pyflyby; pyfl
-0001a390: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
-0001a3a0: 696d 706f 7274 6572 2829 0a20 2020 2020  importer().     
-0001a3b0: 2020 2049 6e20 5b32 5d3a 2062 3634 6465     In [2]: b64de
-0001a3c0: 636f 6465 2827 526d 6c69 6232 3568 5932  code('Rmlib25hY2
-0001a3d0: 4e70 2729 0a20 2020 2020 2020 205b 5059  Np').        [PY
-0001a3e0: 464c 5942 595d 2066 726f 6d20 6261 7365  FLYBY] from base
-0001a3f0: 3634 2069 6d70 6f72 7420 6236 3464 6563  64 import b64dec
-0001a400: 6f64 650a 2020 2020 2020 2020 4f75 745b  ode.        Out[
-0001a410: 325d 3a20 6227 4669 626f 6e61 6363 6927  2]: b'Fibonacci'
-0001a420: 0a20 2020 2020 2020 2049 6e20 5b33 5d3a  .        In [3]:
-0001a430: 2072 756e 207b 746d 702e 6669 6c65 7d0a   run {tmp.file}.
-0001a440: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
-0001a450: 5d20 6672 6f6d 2062 6173 6536 3420 696d  ] from base64 im
-0001a460: 706f 7274 2062 3634 6465 636f 6465 0a20  port b64decode. 
-0001a470: 2020 2020 2020 2052 6965 6d61 6e6e 0a20         Riemann. 
-0001a480: 2020 2022 2222 2e66 6f72 6d61 7428 746d     """.format(tm
-0001a490: 703d 746d 7029 290a 0a0a 4072 6574 7279  p=tmp))...@retry
-0001a4a0: 0a64 6566 2074 6573 745f 7275 6e5f 7365  .def test_run_se
-0001a4b0: 7061 7261 7465 5f73 6372 6970 745f 6e61  parate_script_na
-0001a4c0: 6d65 7370 6163 655f 3228 746d 7029 3a0a  mespace_2(tmp):.
-0001a4d0: 2020 2020 2320 416e 6f74 6865 7220 6578      # Another ex
-0001a4e0: 706c 6963 6974 2074 6573 7420 7468 6174  plicit test that
-0001a4f0: 2077 6520 7374 6172 7420 2572 756e 2066   we start %run f
-0001a500: 726f 6d20 6120 6672 6573 6820 6e61 6d65  rom a fresh name
-0001a510: 7370 6163 652c 206e 6f74 0a20 2020 2023  space, not.    #
-0001a520: 2069 6e68 6572 6974 696e 6720 6576 656e   inheriting even
-0001a530: 2065 7870 6c69 6369 746c 7920 6465 6669   explicitly defi
-0001a540: 6e65 6420 6675 6e63 7469 6f6e 732e 0a20  ned functions.. 
-0001a550: 2020 2077 7269 7465 7465 7874 2874 6d70     writetext(tmp
-0001a560: 2e66 696c 652c 2022 2222 0a20 2020 2020  .file, """.     
-0001a570: 2020 2070 7269 6e74 2862 3634 6465 636f     print(b64deco
-0001a580: 6465 2827 5347 6c73 596d 5679 6441 3d3d  de('SGlsYmVydA==
-0001a590: 2729 2e64 6563 6f64 6528 2775 7466 2d38  ').decode('utf-8
-0001a5a0: 2729 290a 2020 2020 2222 2229 0a20 2020  ')).    """).   
-0001a5b0: 2069 7079 7468 6f6e 2822 2222 0a20 2020   ipython(""".   
-0001a5c0: 2020 2020 2049 6e20 5b31 5d3a 2069 6d70       In [1]: imp
-0001a5d0: 6f72 7420 7079 666c 7962 793b 2070 7966  ort pyflyby; pyf
-0001a5e0: 6c79 6279 2e65 6e61 626c 655f 6175 746f  lyby.enable_auto
-0001a5f0: 5f69 6d70 6f72 7465 7228 290a 2020 2020  _importer().    
-0001a600: 2020 2020 496e 205b 325d 3a20 6465 6620      In [2]: def 
-0001a610: 6236 3464 6563 6f64 6528 7829 3a0a 2020  b64decode(x):.  
-0001a620: 2020 2020 2020 2020 202e 2e2e 3a20 2020           ...:   
-0001a630: 2020 7265 7475 726e 2022 626f 6f67 6572    return "booger
-0001a640: 220a 2020 2020 2020 2020 2020 202e 2e2e  ".           ...
-0001a650: 3a0a 2020 2020 2020 2020 496e 205b 335d  :.        In [3]
-0001a660: 3a20 6236 3464 6563 6f64 6528 2778 2729  : b64decode('x')
-0001a670: 0a20 2020 2020 2020 204f 7574 5b33 5d3a  .        Out[3]:
-0001a680: 2027 626f 6f67 6572 270a 2020 2020 2020   'booger'.      
-0001a690: 2020 496e 205b 345d 3a20 7275 6e20 7b74    In [4]: run {t
-0001a6a0: 6d70 2e66 696c 657d 0a20 2020 2020 2020  mp.file}.       
-0001a6b0: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
-0001a6c0: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
-0001a6d0: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
-0001a6e0: 4869 6c62 6572 740a 2020 2020 2222 222e  Hilbert.    """.
-0001a6f0: 666f 726d 6174 2874 6d70 3d74 6d70 2929  format(tmp=tmp))
-0001a700: 0a0a 0a40 7265 7472 790a 6465 6620 7465  ...@retry.def te
-0001a710: 7374 5f72 756e 5f6d 6f64 6966 795f 696e  st_run_modify_in
-0001a720: 7465 7261 6374 6976 655f 6e61 6d65 7370  teractive_namesp
-0001a730: 6163 655f 3128 746d 7029 3a0a 2020 2020  ace_1(tmp):.    
-0001a740: 2320 5665 7269 6679 2074 6861 7420 2572  # Verify that %r
-0001a750: 756e 2064 6f65 7320 6166 6665 6374 2074  un does affect t
-0001a760: 6865 2069 6e74 6572 6163 7469 7665 206e  he interactive n
-0001a770: 616d 6573 7061 6365 2e0a 2020 2020 7772  amespace..    wr
-0001a780: 6974 6574 6578 7428 746d 702e 6669 6c65  itetext(tmp.file
-0001a790: 2c20 2222 220a 2020 2020 2020 2020 7820  , """.        x 
-0001a7a0: 3d20 6236 3464 6563 6f64 6528 2752 6d56  = b64decode('RmV
-0001a7b0: 7962 5746 3027 290a 2020 2020 2222 2229  ybWF0').    """)
-0001a7c0: 0a20 2020 2069 7079 7468 6f6e 2822 2222  .    ipython("""
-0001a7d0: 0a20 2020 2020 2020 2049 6e20 5b31 5d3a  .        In [1]:
-0001a7e0: 2069 6d70 6f72 7420 7079 666c 7962 793b   import pyflyby;
-0001a7f0: 2070 7966 6c79 6279 2e65 6e61 626c 655f   pyflyby.enable_
-0001a800: 6175 746f 5f69 6d70 6f72 7465 7228 290a  auto_importer().
-0001a810: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
-0001a820: 7275 6e20 7b74 6d70 2e66 696c 657d 0a20  run {tmp.file}. 
-0001a830: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
-0001a840: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
-0001a850: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
-0001a860: 2020 2020 2020 496e 205b 335d 3a20 780a        In [3]: x.
-0001a870: 2020 2020 2020 2020 4f75 745b 335d 3a20          Out[3]: 
-0001a880: 6227 4665 726d 6174 270a 2020 2020 2020  b'Fermat'.      
-0001a890: 2020 496e 205b 345d 3a20 6236 3464 6563    In [4]: b64dec
-0001a8a0: 6f64 6528 2754 4746 7762 4746 6a5a 513d  ode('TGFwbGFjZQ=
-0001a8b0: 3d27 290a 2020 2020 2020 2020 4f75 745b  =').        Out[
-0001a8c0: 345d 3a20 6227 4c61 706c 6163 6527 0a20  4]: b'Laplace'. 
-0001a8d0: 2020 2022 2222 2e66 6f72 6d61 7428 746d     """.format(tm
-0001a8e0: 703d 746d 7029 290a 0a0a 4072 6574 7279  p=tmp))...@retry
-0001a8f0: 0a64 6566 2074 6573 745f 7275 6e5f 695f  .def test_run_i_
-0001a900: 6175 746f 5f69 6d70 6f72 745f 3128 746d  auto_import_1(tm
-0001a910: 7029 3a0a 2020 2020 2320 5665 7269 6679  p):.    # Verify
-0001a920: 2074 6861 7420 2725 7275 6e20 2d69 2720   that '%run -i' 
-0001a930: 776f 726b 7320 616e 6420 6175 746f 696d  works and autoim
-0001a940: 706f 7274 732e 0a20 2020 2077 7269 7465  ports..    write
-0001a950: 7465 7874 2874 6d70 2e66 696c 652c 2022  text(tmp.file, "
-0001a960: 2222 0a20 2020 2020 2020 2070 7269 6e74  "".        print
-0001a970: 2862 3634 6465 636f 6465 2827 5247 567a  (b64decode('RGVz
-0001a980: 5932 4679 6447 567a 2729 2e64 6563 6f64  Y2FydGVz').decod
-0001a990: 6528 2775 7466 2d38 2729 290a 2020 2020  e('utf-8')).    
-0001a9a0: 2222 2229 0a20 2020 2069 7079 7468 6f6e  """).    ipython
-0001a9b0: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
-0001a9c0: 5b31 5d3a 2069 6d70 6f72 7420 7079 666c  [1]: import pyfl
-0001a9d0: 7962 793b 2070 7966 6c79 6279 2e65 6e61  yby; pyflyby.ena
-0001a9e0: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
-0001a9f0: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
-0001aa00: 325d 3a20 7275 6e20 2d69 207b 746d 702e  2]: run -i {tmp.
-0001aa10: 6669 6c65 7d0a 2020 2020 2020 2020 5b50  file}.        [P
-0001aa20: 5946 4c59 4259 5d20 6672 6f6d 2062 6173  YFLYBY] from bas
-0001aa30: 6536 3420 696d 706f 7274 2062 3634 6465  e64 import b64de
-0001aa40: 636f 6465 0a20 2020 2020 2020 2044 6573  code.        Des
-0001aa50: 6361 7274 6573 0a20 2020 2020 2020 2049  cartes.        I
-0001aa60: 6e20 5b33 5d3a 2062 3634 6465 636f 6465  n [3]: b64decode
-0001aa70: 2827 5232 4631 6333 4d3d 2729 0a20 2020  ('R2F1c3M=').   
-0001aa80: 2020 2020 204f 7574 5b33 5d3a 2062 2747       Out[3]: b'G
-0001aa90: 6175 7373 270a 2020 2020 2222 222e 666f  auss'.    """.fo
-0001aaa0: 726d 6174 2874 6d70 3d74 6d70 2929 0a0a  rmat(tmp=tmp))..
-0001aab0: 4070 7974 6573 742e 6d61 726b 2e78 6661  @pytest.mark.xfa
-0001aac0: 696c 0a64 6566 2074 6573 745f 7275 6e5f  il.def test_run_
-0001aad0: 645f 646f 6e74 6572 6173 6528 746d 7029  d_donterase(tmp)
-0001aae0: 3a0a 2020 2020 2222 220a 2020 2020 6163  :.    """.    ac
-0001aaf0: 6365 7373 696e 6720 665f 6c6f 6361 6c73  cessing f_locals
-0001ab00: 206d 6179 2072 6573 6574 206e 616d 6573   may reset names
-0001ab10: 7061 6365 2c0a 2020 2020 6865 7265 2077  pace,.    here w
-0001ab20: 6520 6368 6563 6b20 7468 6174 206d 7976  e check that myv
-0001ab30: 6172 2063 6861 6e67 6573 2061 6674 6572  ar changes after
-0001ab40: 2061 7373 6967 6e6d 656e 7420 696e 2074   assignment in t
-0001ab50: 6865 2064 6562 7567 6765 722e 0a20 2020  he debugger..   
-0001ab60: 2022 2222 0a20 2020 2069 7079 7468 6f6e   """.    ipython
-0001ab70: 280a 2020 2020 2020 2020 2222 220a 2020  (.        """.  
-0001ab80: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
-0001ab90: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
-0001aba0: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
-0001abb0: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
-0001abc0: 2020 2020 2049 6e20 5b32 5d3a 2064 6566       In [2]: def
-0001abd0: 2073 696d 706c 655f 6628 293a 0a20 2020   simple_f():.   
-0001abe0: 2020 2020 2020 2020 2e2e 2e3a 2020 2020          ...:    
-0001abf0: 206d 7976 6172 203d 2031 0a20 2020 2020   myvar = 1.     
-0001ac00: 2020 2020 2020 2e2e 2e3a 2020 2020 2070        ...:     p
-0001ac10: 7269 6e74 286d 7976 6172 290a 2020 2020  rint(myvar).    
-0001ac20: 2020 2020 2020 202e 2e2e 3a20 2020 2020         ...:     
-0001ac30: 312f 300a 2020 2020 2020 2020 2020 202e  1/0.           .
-0001ac40: 2e2e 3a20 2020 2020 7072 696e 7428 6d79  ..:     print(my
-0001ac50: 7661 7229 0a20 2020 2020 2020 2020 2020  var).           
-0001ac60: 2e2e 2e3a 2073 696d 706c 655f 6628 290a  ...: simple_f().
-0001ac70: 2020 2020 2020 2020 2020 202e 2e2e 3a0a             ...:.
-0001ac80: 2020 2020 2020 2020 310a 2020 2020 2020          1.      
-0001ac90: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d    --------------
-0001aca0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001acb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001acc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001acd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
-0001ace0: 2020 2020 2020 5a65 726f 4469 7669 7369        ZeroDivisi
-0001acf0: 6f6e 4572 726f 7220 2020 2020 2020 2020  onError         
-0001ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad10: 5472 6163 6562 6163 6b20 286d 6f73 7420  Traceback (most 
-0001ad20: 7265 6365 6e74 2063 616c 6c20 6c61 7374  recent call last
-0001ad30: 290a 2020 2020 2020 2020 2e2e 2e20 696e  ).        ... in
-0001ad40: 202e 2e2e 0a20 2020 2020 2020 2020 2020   ....           
-0001ad50: 2020 2034 2020 2020 2031 2f30 0a20 2020     4     1/0.   
-0001ad60: 2020 2020 2020 2020 2020 2035 2020 2020             5    
-0001ad70: 2070 7269 6e74 286d 7976 6172 290a 2020   print(myvar).  
-0001ad80: 2020 2020 2020 2e2e 2e20 696e 2073 696d        ... in sim
-0001ad90: 706c 655f 6628 290a 2020 2020 2020 2020  ple_f().        
-0001ada0: 2020 2020 2020 3220 6d79 7661 7220 3d20        2 myvar = 
-0001adb0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-0001adc0: 3320 7072 696e 7428 6d79 7661 7229 0a20  3 print(myvar). 
-0001add0: 2020 2020 2020 2020 2020 2020 2035 2070               5 p
-0001ade0: 7269 6e74 286d 7976 6172 290a 2020 2020  rint(myvar).    
-0001adf0: 2020 2020 5a65 726f 4469 7669 7369 6f6e      ZeroDivision
-0001ae00: 4572 726f 723a 2064 6976 6973 696f 6e20  Error: division 
-0001ae10: 6279 207a 6572 6f0a 2020 2020 2020 2020  by zero.        
-0001ae20: 496e 205b 335d 3a20 2564 6562 7567 0a20  In [3]: %debug. 
-0001ae30: 2020 2020 2020 203e 203c 6970 7974 686f         > <ipytho
-0001ae40: 6e2d 696e 7075 743e 2834 2973 696d 706c  n-input>(4)simpl
-0001ae50: 655f 6628 290a 2020 2020 2020 2020 2020  e_f().          
-0001ae60: 2020 2020 3220 2020 2020 6d79 7661 7220      2     myvar 
-0001ae70: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-0001ae80: 2020 3320 2020 2020 7072 696e 7428 6d79    3     print(my
-0001ae90: 7661 7229 0a20 2020 2020 2020 2020 2020  var).           
-0001aea0: 2020 2035 2020 2020 2070 7269 6e74 286d     5     print(m
-0001aeb0: 7976 6172 290a 2020 2020 2020 2020 2020  yvar).          
-0001aec0: 2020 2020 3620 7369 6d70 6c65 5f66 2829      6 simple_f()
-0001aed0: 0a20 2020 2020 2020 2069 7064 623e 206d  .        ipdb> m
-0001aee0: 7976 6172 0a20 2020 2020 2020 2031 0a20  yvar.        1. 
-0001aef0: 2020 2020 2020 2069 7064 623e 206d 7976         ipdb> myv
-0001af00: 6172 203d 2032 0a20 2020 2020 2020 2069  ar = 2.        i
-0001af10: 7064 623e 206d 7976 6172 0a20 2020 2020  pdb> myvar.     
-0001af20: 2020 2032 0a20 2020 2020 2020 2069 7064     2.        ipd
-0001af30: 623e 2063 0a22 2222 0a20 2020 2029 0a0a  b> c.""".    )..
-0001af40: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
-0001af50: 5f72 756e 5f69 5f61 6c72 6561 6479 5f69  _run_i_already_i
-0001af60: 6d70 6f72 7465 645f 3128 746d 7029 3a0a  mported_1(tmp):.
-0001af70: 2020 2020 2320 5665 7269 6679 2074 6861      # Verify tha
-0001af80: 7420 2725 7275 6e20 2d69 2720 696e 6865  t '%run -i' inhe
-0001af90: 7269 7473 2074 6865 2069 6e74 6572 6163  rits the interac
-0001afa0: 7469 7665 206e 616d 6573 7061 6365 2e0a  tive namespace..
-0001afb0: 2020 2020 7772 6974 6574 6578 7428 746d      writetext(tm
-0001afc0: 702e 6669 6c65 2c20 2222 220a 2020 2020  p.file, """.    
-0001afd0: 2020 2020 7072 696e 7428 6236 3464 6563      print(b64dec
-0001afe0: 6f64 6528 6b29 2e64 6563 6f64 6528 2775  ode(k).decode('u
-0001aff0: 7466 2d38 2729 290a 2020 2020 2222 2229  tf-8')).    """)
-0001b000: 0a20 2020 2069 7079 7468 6f6e 2822 2222  .    ipython("""
-0001b010: 0a20 2020 2020 2020 2049 6e20 5b31 5d3a  .        In [1]:
-0001b020: 2069 6d70 6f72 7420 7079 666c 7962 793b   import pyflyby;
-0001b030: 2070 7966 6c79 6279 2e65 6e61 626c 655f   pyflyby.enable_
-0001b040: 6175 746f 5f69 6d70 6f72 7465 7228 290a  auto_importer().
-0001b050: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
-0001b060: 6236 3464 6563 6f64 6528 2752 334a 7664  b64decode('R3Jvd
-0001b070: 4768 6c62 6d52 705a 574e 7227 290a 2020  GhlbmRpZWNr').  
-0001b080: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
-0001b090: 6672 6f6d 2062 6173 6536 3420 696d 706f  from base64 impo
-0001b0a0: 7274 2062 3634 6465 636f 6465 0a20 2020  rt b64decode.   
-0001b0b0: 2020 2020 204f 7574 5b32 5d3a 2062 2747       Out[2]: b'G
-0001b0c0: 726f 7468 656e 6469 6563 6b27 0a20 2020  rothendieck'.   
-0001b0d0: 2020 2020 2049 6e20 5b33 5d3a 206b 203d       In [3]: k =
-0001b0e0: 2027 5158 4a6a 6147 6c74 5a57 526c 6377   'QXJjaGltZWRlcw
-0001b0f0: 3d3d 270a 2020 2020 2020 2020 496e 205b  =='.        In [
-0001b100: 345d 3a20 7275 6e20 2d69 207b 746d 702e  4]: run -i {tmp.
-0001b110: 6669 6c65 7d0a 2020 2020 2020 2020 4172  file}.        Ar
-0001b120: 6368 696d 6564 6573 0a20 2020 2022 2222  chimedes.    """
-0001b130: 2e66 6f72 6d61 7428 746d 703d 746d 7029  .format(tmp=tmp)
-0001b140: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
-0001b150: 6573 745f 7275 6e5f 695f 7265 7065 6174  est_run_i_repeat
-0001b160: 6564 5f31 2874 6d70 293a 0a20 2020 2023  ed_1(tmp):.    #
-0001b170: 2056 6572 6966 7920 7468 6174 2027 2572   Verify that '%r
-0001b180: 756e 202d 6927 2061 6666 6563 7473 2074  un -i' affects t
-0001b190: 6865 206e 6578 7420 6e61 6d65 7370 6163  he next namespac
-0001b1a0: 6520 6f66 2074 6865 206e 6578 7420 2725  e of the next '%
-0001b1b0: 7275 6e20 2d69 272e 0a20 2020 2077 7269  run -i'..    wri
-0001b1c0: 7465 7465 7874 2874 6d70 2e66 696c 652c  tetext(tmp.file,
-0001b1d0: 2022 2222 0a20 2020 2020 2020 2070 7269   """.        pri
-0001b1e0: 6e74 2862 3634 6465 636f 6465 2827 5332  nt(b64decode('S2
-0001b1f0: 3973 6257 396e 6233 4a76 6467 3d3d 2729  9sbW9nb3Jvdg==')
-0001b200: 2e64 6563 6f64 6528 2775 7466 2d38 2729  .decode('utf-8')
-0001b210: 290a 2020 2020 2222 2229 0a20 2020 2069  ).    """).    i
-0001b220: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
-0001b230: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
-0001b240: 7420 7079 666c 7962 793b 2070 7966 6c79  t pyflyby; pyfly
-0001b250: 6279 2e65 6e61 626c 655f 6175 746f 5f69  by.enable_auto_i
-0001b260: 6d70 6f72 7465 7228 290a 2020 2020 2020  mporter().      
-0001b270: 2020 496e 205b 325d 3a20 7275 6e20 2d69    In [2]: run -i
-0001b280: 207b 746d 702e 6669 6c65 7d0a 2020 2020   {tmp.file}.    
-0001b290: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
-0001b2a0: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
-0001b2b0: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
-0001b2c0: 2020 204b 6f6c 6d6f 676f 726f 760a 2020     Kolmogorov.  
-0001b2d0: 2020 2020 2020 496e 205b 335d 3a20 7275        In [3]: ru
-0001b2e0: 6e20 2d69 207b 746d 702e 6669 6c65 7d0a  n -i {tmp.file}.
-0001b2f0: 2020 2020 2020 2020 4b6f 6c6d 6f67 6f72          Kolmogor
-0001b300: 6f76 0a20 2020 2022 2222 2e66 6f72 6d61  ov.    """.forma
-0001b310: 7428 746d 703d 746d 7029 290a 0a0a 4072  t(tmp=tmp))...@r
-0001b320: 6574 7279 0a64 6566 2074 6573 745f 7275  etry.def test_ru
-0001b330: 6e5f 695f 6c6f 6361 6c6c 795f 6465 6669  n_i_locally_defi
-0001b340: 6e65 645f 3128 746d 7029 3a0a 2020 2020  ned_1(tmp):.    
-0001b350: 2320 5665 7269 6679 2074 6861 7420 2725  # Verify that '%
-0001b360: 7275 6e20 2d69 2720 6361 6e20 696e 6865  run -i' can inhe
-0001b370: 7269 7420 696e 7465 7261 6374 6976 656c  rit interactivel
-0001b380: 7920 6465 6669 6e65 6420 7379 6d62 6f6c  y defined symbol
-0001b390: 732e 0a20 2020 2077 7269 7465 7465 7874  s..    writetext
-0001b3a0: 2874 6d70 2e66 696c 652c 2022 2222 0a20  (tmp.file, """. 
-0001b3b0: 2020 2020 2020 2070 7269 6e74 2862 3634         print(b64
-0001b3c0: 6465 636f 6465 2827 7a7a 7a27 2929 0a20  decode('zzz')). 
-0001b3d0: 2020 2022 2222 290a 2020 2020 6970 7974     """).    ipyt
-0001b3e0: 686f 6e28 2222 220a 2020 2020 2020 2020  hon(""".        
-0001b3f0: 496e 205b 315d 3a20 696d 706f 7274 2070  In [1]: import p
-0001b400: 7966 6c79 6279 3b20 7079 666c 7962 792e  yflyby; pyflyby.
-0001b410: 656e 6162 6c65 5f61 7574 6f5f 696d 706f  enable_auto_impo
-0001b420: 7274 6572 2829 0a20 2020 2020 2020 2049  rter().        I
-0001b430: 6e20 5b32 5d3a 2064 6566 2062 3634 6465  n [2]: def b64de
-0001b440: 636f 6465 2878 293a 0a20 2020 2020 2020  code(x):.       
-0001b450: 2020 2020 2e2e 2e3a 2020 2020 2072 6574      ...:     ret
-0001b460: 7572 6e20 2242 6572 6e6f 756c 6c69 220a  urn "Bernoulli".
-0001b470: 2020 2020 2020 2020 2020 202e 2e2e 3a0a             ...:.
-0001b480: 2020 2020 2020 2020 496e 205b 335d 3a20          In [3]: 
-0001b490: 7275 6e20 2d69 207b 746d 702e 6669 6c65  run -i {tmp.file
-0001b4a0: 7d0a 2020 2020 2020 2020 4265 726e 6f75  }.        Bernou
-0001b4b0: 6c6c 690a 2020 2020 2222 222e 666f 726d  lli.    """.form
-0001b4c0: 6174 2874 6d70 3d74 6d70 2929 0a0a 0a40  at(tmp=tmp))...@
-0001b4d0: 7265 7472 790a 6465 6620 7465 7374 5f72  retry.def test_r
-0001b4e0: 756e 5f73 796e 7461 785f 6572 726f 725f  un_syntax_error_
-0001b4f0: 3128 746d 7029 3a0a 2020 2020 2320 5665  1(tmp):.    # Ve
-0001b500: 7269 6679 2074 6861 7420 6120 7379 6e74  rify that a synt
-0001b510: 6178 2065 7272 6f72 2069 6e20 6120 7573  ax error in a us
-0001b520: 6572 2d72 756e 2073 6372 6970 7420 646f  er-run script do
-0001b530: 6573 6e27 7420 6166 6665 6374 0a20 2020  esn't affect.   
-0001b540: 2023 2061 7574 6f69 6d70 6f72 7465 7220   # autoimporter 
-0001b550: 6675 6e63 7469 6f6e 616c 6974 792e 0a20  functionality.. 
-0001b560: 2020 2077 7269 7465 7465 7874 2874 6d70     writetext(tmp
-0001b570: 2e66 696c 652c 2022 2222 0a20 2020 2020  .file, """.     
-0001b580: 2020 2070 7269 6e74 2827 6865 6c6c 6f27     print('hello'
-0001b590: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-0001b5a0: 6236 3464 6563 6f64 6528 2755 486c 3061  b64decode('UHl0a
-0001b5b0: 4746 6e62 334a 6863 773d 3d27 292e 6465  GFnb3Jhcw==').de
-0001b5c0: 636f 6465 2827 7574 662d 3827 2929 0a20  code('utf-8')). 
-0001b5d0: 2020 2020 2020 2031 202f 0a20 2020 2022         1 /.    "
-0001b5e0: 2222 290a 2020 2020 6970 7974 686f 6e28  "").    ipython(
-0001b5f0: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-0001b600: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
-0001b610: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
-0001b620: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-0001b630: 2829 0a20 2020 2020 2020 2049 6e20 5b32  ().        In [2
-0001b640: 5d3a 2072 756e 207b 746d 702e 6669 6c65  ]: run {tmp.file
-0001b650: 7d0a 2020 2020 2020 2020 2e2e 2e2e 0a20  }.        ..... 
-0001b660: 2020 2020 2020 2053 796e 7461 7845 7272         SyntaxErr
-0001b670: 6f72 3a20 696e 7661 6c69 6420 7379 6e74  or: invalid synt
-0001b680: 6178 2e2e 2e2e 0a20 2020 2020 2020 2049  ax.....        I
-0001b690: 6e20 5b33 5d3a 2062 3634 6465 636f 6465  n [3]: b64decode
-0001b6a0: 2827 5132 3975 6432 4635 2729 0a20 2020  ('Q29ud2F5').   
-0001b6b0: 2020 2020 205b 5059 464c 5942 595d 2066       [PYFLYBY] f
-0001b6c0: 726f 6d20 6261 7365 3634 2069 6d70 6f72  rom base64 impor
-0001b6d0: 7420 6236 3464 6563 6f64 650a 2020 2020  t b64decode.    
-0001b6e0: 2020 2020 4f75 745b 335d 3a20 6227 436f      Out[3]: b'Co
-0001b6f0: 6e77 6179 270a 2020 2020 2222 222e 666f  nway'.    """.fo
-0001b700: 726d 6174 2874 6d70 3d74 6d70 2929 0a0a  rmat(tmp=tmp))..
-0001b710: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
-0001b720: 5f72 756e 5f6e 616d 655f 6d61 696e 5f31  _run_name_main_1
-0001b730: 2874 6d70 293a 0a20 2020 2023 2056 6572  (tmp):.    # Ver
-0001b740: 6966 7920 7468 6174 205f 5f6e 616d 655f  ify that __name_
-0001b750: 5f20 3d3d 2022 5f5f 6d61 696e 5f5f 2220  _ == "__main__" 
-0001b760: 696e 2061 2025 7275 6e20 7363 7269 7074  in a %run script
-0001b770: 2e0a 2020 2020 7772 6974 6574 6578 7428  ..    writetext(
-0001b780: 746d 702e 6669 6c65 2c20 2222 220a 2020  tmp.file, """.  
-0001b790: 2020 2020 2020 7072 696e 7428 6236 3465        print(b64e
-0001b7a0: 6e63 6f64 6528 5f5f 6e61 6d65 5f5f 2e65  ncode(__name__.e
-0001b7b0: 6e63 6f64 6528 2775 7466 2d38 2729 292e  ncode('utf-8')).
-0001b7c0: 6465 636f 6465 2827 7574 662d 3827 2929  decode('utf-8'))
-0001b7d0: 0a20 2020 2022 2222 290a 2020 2020 6970  .    """).    ip
-0001b7e0: 7974 686f 6e28 2222 220a 2020 2020 2020  ython(""".      
-0001b7f0: 2020 496e 205b 315d 3a20 696d 706f 7274    In [1]: import
-0001b800: 2070 7966 6c79 6279 3b20 7079 666c 7962   pyflyby; pyflyb
-0001b810: 792e 656e 6162 6c65 5f61 7574 6f5f 696d  y.enable_auto_im
-0001b820: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
-0001b830: 2049 6e20 5b32 5d3a 2072 756e 207b 746d   In [2]: run {tm
-0001b840: 702e 6669 6c65 7d0a 2020 2020 2020 2020  p.file}.        
-0001b850: 5b50 5946 4c59 4259 5d20 6672 6f6d 2062  [PYFLYBY] from b
-0001b860: 6173 6536 3420 696d 706f 7274 2062 3634  ase64 import b64
-0001b870: 656e 636f 6465 0a20 2020 2020 2020 2058  encode.        X
-0001b880: 3139 7459 576c 7558 3138 3d0a 2020 2020  19tYWluX18=.    
-0001b890: 2222 222e 666f 726d 6174 2874 6d70 3d74  """.format(tmp=t
-0001b8a0: 6d70 2929 0a0a 0a40 7265 7472 790a 6465  mp))...@retry.de
-0001b8b0: 6620 7465 7374 5f72 756e 5f6e 616d 655f  f test_run_name_
-0001b8c0: 6e6f 745f 6d61 696e 5f31 2874 6d70 293a  not_main_1(tmp):
-0001b8d0: 0a20 2020 2023 2056 6572 6966 7920 7468  .    # Verify th
-0001b8e0: 6174 205f 5f6e 616d 655f 5f20 3d3d 2062  at __name__ == b
-0001b8f0: 6173 656e 616d 6528 6669 6c65 6e61 6d65  asename(filename
-0001b900: 2920 7573 696e 6720 2725 7275 6e20 2d6e  ) using '%run -n
-0001b910: 272e 0a20 2020 2066 203d 2077 7269 7465  '..    f = write
-0001b920: 7465 7874 2874 6d70 2e64 6972 2f22 6638  text(tmp.dir/"f8
-0001b930: 3135 3634 3338 322e 7079 222c 2022 2222  1564382.py", """
-0001b940: 0a20 2020 2020 2020 2070 7269 6e74 2862  .        print(b
-0001b950: 3634 656e 636f 6465 285f 5f6e 616d 655f  64encode(__name_
-0001b960: 5f2e 656e 636f 6465 2827 7574 662d 3827  _.encode('utf-8'
-0001b970: 2929 2e64 6563 6f64 6528 2775 7466 2d38  )).decode('utf-8
-0001b980: 2729 290a 2020 2020 2222 2229 0a20 2020  ')).    """).   
-0001b990: 2069 7079 7468 6f6e 2822 2222 0a20 2020   ipython(""".   
-0001b9a0: 2020 2020 2049 6e20 5b31 5d3a 2069 6d70       In [1]: imp
-0001b9b0: 6f72 7420 7079 666c 7962 793b 2070 7966  ort pyflyby; pyf
-0001b9c0: 6c79 6279 2e65 6e61 626c 655f 6175 746f  lyby.enable_auto
-0001b9d0: 5f69 6d70 6f72 7465 7228 290a 2020 2020  _importer().    
-0001b9e0: 2020 2020 496e 205b 325d 3a20 7275 6e20      In [2]: run 
-0001b9f0: 2d6e 207b 667d 0a20 2020 2020 2020 205b  -n {f}.        [
-0001ba00: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
-0001ba10: 7365 3634 2069 6d70 6f72 7420 6236 3465  se64 import b64e
-0001ba20: 6e63 6f64 650a 2020 2020 2020 2020 5a6a  ncode.        Zj
-0001ba30: 6778 4e54 5930 4d7a 6779 0a20 2020 2022  gxNTY0Mzgy.    "
-0001ba40: 2222 2e66 6f72 6d61 7428 663d 6629 290a  "".format(f=f)).
-0001ba50: 0a0a 4072 6574 7279 0a64 6566 2074 6573  ..@retry.def tes
-0001ba60: 745f 7469 6d65 6974 5f31 2829 3a0a 2020  t_timeit_1():.  
-0001ba70: 2020 2320 5665 7269 6679 2074 6861 7420    # Verify that 
-0001ba80: 2574 696d 6569 7420 776f 726b 732e 0a20  %timeit works.. 
-0001ba90: 2020 2069 7079 7468 6f6e 2875 2222 220a     ipython(u""".
-0001baa0: 2020 2020 2020 2020 496e 205b 315d 3a20          In [1]: 
-0001bab0: 696d 706f 7274 2070 7966 6c79 6279 3b20  import pyflyby; 
-0001bac0: 7079 666c 7962 792e 656e 6162 6c65 5f61  pyflyby.enable_a
-0001bad0: 7574 6f5f 696d 706f 7274 6572 2829 0a20  uto_importer(). 
-0001bae0: 2020 2020 2020 2049 6e20 5b32 5d3a 2025         In [2]: %
-0001baf0: 7469 6d65 6974 202d 6e20 3220 2d72 2031  timeit -n 2 -r 1
-0001bb00: 2062 3634 6465 636f 6465 2827 5457 6c6a   b64decode('TWlj
-0001bb10: 6147 5673 5957 356e 5a57 7876 2729 0a20  aGVsYW5nZWxv'). 
-0001bb20: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
-0001bb30: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
-0001bb40: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
-0001bb50: 2020 2020 2020 2e2e 2e20 7065 7220 6c6f        ... per lo
-0001bb60: 6f70 2028 6d65 616e 20c2 b120 7374 642e  op (mean .. std.
-0001bb70: 2064 6576 2e20 6f66 2031 2072 756e 2c20   dev. of 1 run, 
-0001bb80: 3220 6c6f 6f70 7320 6561 6368 290a 2020  2 loops each).  
-0001bb90: 2020 2020 2020 496e 205b 335d 3a20 2574        In [3]: %t
-0001bba0: 696d 6569 7420 2d6e 2032 202d 7220 3120  imeit -n 2 -r 1 
-0001bbb0: 6236 3464 6563 6f64 6528 2752 4746 3261  b64decode('RGF2a
-0001bbc0: 5751 3d27 290a 2020 2020 2020 2020 2e2e  WQ=').        ..
-0001bbd0: 2e20 7065 7220 6c6f 6f70 2028 6d65 616e  . per loop (mean
-0001bbe0: 20c2 b120 7374 642e 2064 6576 2e20 6f66   .. std. dev. of
-0001bbf0: 2031 2072 756e 2c20 3220 6c6f 6f70 7320   1 run, 2 loops 
-0001bc00: 6561 6368 290a 2020 2020 2222 2229 0a0a  each).    """)..
-0001bc10: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
-0001bc20: 5f74 696d 6569 745f 636f 6d70 6c65 7465  _timeit_complete
-0001bc30: 5f31 2866 726f 6e74 656e 6429 3a0a 2020  _1(frontend):.  
-0001bc40: 2020 2320 5665 7269 6679 2074 6861 7420    # Verify that 
-0001bc50: 7461 6220 636f 6d70 6c65 7469 6f6e 2077  tab completion w
-0001bc60: 6f72 6b73 2077 6974 6820 2574 696d 6569  orks with %timei
-0001bc70: 742e 0a20 2020 2069 7079 7468 6f6e 2875  t..    ipython(u
-0001bc80: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-0001bc90: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
-0001bca0: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
-0001bcb0: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-0001bcc0: 2829 0a20 2020 2020 2020 2049 6e20 5b32  ().        In [2
-0001bcd0: 5d3a 2025 7469 6d65 6974 202d 6e20 3220  ]: %timeit -n 2 
-0001bce0: 2d72 2031 2062 3634 6465 5c74 636f 6465  -r 1 b64de\tcode
-0001bcf0: 2827 6347 6c73 6247 3933 2729 0a20 2020  ('cGlsbG93').   
-0001bd00: 2020 2020 205b 5059 464c 5942 595d 2066       [PYFLYBY] f
-0001bd10: 726f 6d20 6261 7365 3634 2069 6d70 6f72  rom base64 impor
-0001bd20: 7420 6236 3464 6563 6f64 650a 2020 2020  t b64decode.    
-0001bd30: 2020 2020 2e2e 2e20 7065 7220 6c6f 6f70      ... per loop
-0001bd40: 2028 6d65 616e 20c2 b120 7374 642e 2064   (mean .. std. d
-0001bd50: 6576 2e20 6f66 2031 2072 756e 2c20 3220  ev. of 1 run, 2 
-0001bd60: 6c6f 6f70 7320 6561 6368 290a 2020 2020  loops each).    
-0001bd70: 2222 222c 2066 726f 6e74 656e 643d 6672  """, frontend=fr
-0001bd80: 6f6e 7465 6e64 290a 0a0a 4072 6574 7279  ontend)...@retry
-0001bd90: 0a64 6566 2074 6573 745f 7469 6d65 6974  .def test_timeit
-0001bda0: 5f63 6f6d 706c 6574 655f 6d65 6e75 5f31  _complete_menu_1
-0001bdb0: 2866 726f 6e74 656e 6429 3a0a 2020 2020  (frontend):.    
-0001bdc0: 2320 5665 7269 6679 2074 6861 7420 6d65  # Verify that me
-0001bdd0: 6e75 2074 6162 2063 6f6d 706c 6574 696f  nu tab completio
-0001bde0: 6e20 776f 726b 7320 7769 7468 2025 7469  n works with %ti
-0001bdf0: 6d65 6974 2e0a 2020 2020 6966 2066 726f  meit..    if fro
-0001be00: 6e74 656e 6420 3d3d 2022 7072 6f6d 7074  ntend == "prompt
-0001be10: 5f74 6f6f 6c6b 6974 223a 2070 7974 6573  _toolkit": pytes
-0001be20: 742e 736b 6970 2829 0a20 2020 2069 7079  t.skip().    ipy
-0001be30: 7468 6f6e 2822 2222 0a20 2020 2020 2020  thon(""".       
-0001be40: 2049 6e20 5b31 5d3a 2069 6d70 6f72 7420   In [1]: import 
-0001be50: 7079 666c 7962 793b 2070 7966 6c79 6279  pyflyby; pyflyby
-0001be60: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
-0001be70: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
-0001be80: 496e 205b 325d 3a20 7469 6d65 6974 202d  In [2]: timeit -
-0001be90: 6e20 3220 2d72 2031 2062 3634 5c74 0a20  n 2 -r 1 b64\t. 
-0001bea0: 2020 2020 2020 2062 3634 6465 636f 6465         b64decode
-0001beb0: 2020 6236 3465 6e63 6f64 650a 2020 2020    b64encode.    
-0001bec0: 2020 2020 496e 205b 325d 3a20 7469 6d65      In [2]: time
-0001bed0: 6974 202d 6e20 3220 2d72 2031 2062 3634  it -n 2 -r 1 b64
-0001bee0: 5c78 3036 645c 7465 636f 6465 2827 596d  \x06d\tecode('Ym
-0001bef0: 7868 626d 746c 6441 3d3d 2729 0a20 2020  xhbmtldA==').   
-0001bf00: 2020 2020 205b 5059 464c 5942 595d 2066       [PYFLYBY] f
-0001bf10: 726f 6d20 6261 7365 3634 2069 6d70 6f72  rom base64 impor
-0001bf20: 7420 6236 3464 6563 6f64 650a 2020 2020  t b64decode.    
-0001bf30: 2020 2020 3220 6c6f 6f70 732c 2062 6573      2 loops, bes
-0001bf40: 7420 6f66 2031 3a20 2e2e 2e20 7065 7220  t of 1: ... per 
-0001bf50: 6c6f 6f70 0a20 2020 2022 2222 2c20 6672  loop.    """, fr
-0001bf60: 6f6e 7465 6e64 3d66 726f 6e74 656e 6429  ontend=frontend)
-0001bf70: 0a0a 0a40 7265 7472 790a 6465 6620 7465  ...@retry.def te
-0001bf80: 7374 5f74 696d 6569 745f 636f 6d70 6c65  st_timeit_comple
-0001bf90: 7465 5f61 7574 6f69 6d70 6f72 745f 6d65  te_autoimport_me
-0001bfa0: 6d62 6572 5f31 2866 726f 6e74 656e 6429  mber_1(frontend)
-0001bfb0: 3a0a 2020 2020 6966 2066 726f 6e74 656e  :.    if fronten
-0001bfc0: 6420 3d3d 2022 7072 6f6d 7074 5f74 6f6f  d == "prompt_too
-0001bfd0: 6c6b 6974 223a 2070 7974 6573 742e 736b  lkit": pytest.sk
-0001bfe0: 6970 2829 0a20 2020 2069 7079 7468 6f6e  ip().    ipython
-0001bff0: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
-0001c000: 5b31 5d3a 2069 6d70 6f72 7420 7079 666c  [1]: import pyfl
-0001c010: 7962 793b 2070 7966 6c79 6279 2e65 6e61  yby; pyflyby.ena
-0001c020: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
-0001c030: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
-0001c040: 325d 3a20 7469 6d65 6974 202d 6e20 3220  2]: timeit -n 2 
-0001c050: 2d72 2031 2062 6173 6536 342e 6236 5c74  -r 1 base64.b6\t
-0001c060: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
-0001c070: 595d 2069 6d70 6f72 7420 6261 7365 3634  Y] import base64
-0001c080: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
-0001c090: 2074 696d 6569 7420 2d6e 2032 202d 7220   timeit -n 2 -r 
-0001c0a0: 3120 6261 7365 3634 2e62 360a 2020 2020  1 base64.b6.    
-0001c0b0: 2020 2020 6261 7365 3634 2e62 3634 6465      base64.b64de
-0001c0c0: 636f 6465 2020 6261 7365 3634 2e62 3634  code  base64.b64
-0001c0d0: 656e 636f 6465 0a20 2020 2020 2020 2049  encode.        I
-0001c0e0: 6e20 5b32 5d3a 2074 696d 6569 7420 2d6e  n [2]: timeit -n
-0001c0f0: 2032 202d 7220 3120 6261 7365 3634 2e62   2 -r 1 base64.b
-0001c100: 3634 5c78 3036 6465 635c 746f 6465 2827  64\x06dec\tode('
-0001c110: 6257 4630 6448 4a6c 6333 4d3d 2729 0a20  bWF0dHJlc3M='). 
-0001c120: 2020 2020 2020 2032 206c 6f6f 7073 2c20         2 loops, 
-0001c130: 6265 7374 206f 6620 313a 202e 2e2e 2070  best of 1: ... p
-0001c140: 6572 206c 6f6f 700a 2020 2020 2222 222c  er loop.    """,
-0001c150: 2066 726f 6e74 656e 643d 6672 6f6e 7465   frontend=fronte
-0001c160: 6e64 290a 0a0a 4072 6574 7279 0a64 6566  nd)...@retry.def
-0001c170: 2074 6573 745f 6e6f 6e69 6e74 6572 6163   test_noninterac
-0001c180: 7469 7665 5f74 696d 6569 745f 756e 6166  tive_timeit_unaf
-0001c190: 6665 6374 6564 5f31 2829 3a0a 2020 2020  fected_1():.    
-0001c1a0: 2320 5665 7269 6679 2074 6861 7420 7468  # Verify that th
-0001c1b0: 6520 7265 6775 6c61 7220 7469 6d65 6974  e regular timeit
-0001c1c0: 206d 6f64 756c 6520 6973 2075 6e61 6666   module is unaff
-0001c1d0: 6563 7465 642c 2069 2e65 2e20 7468 6174  ected, i.e. that
-0001c1e0: 2077 6520 6f6e 6c79 0a20 2020 2023 2068   we only.    # h
-0001c1f0: 6f6f 6b65 6420 7468 6520 4950 7974 686f  ooked the IPytho
-0001c200: 6e20 7772 6170 7065 722e 0a20 2020 2069  n wrapper..    i
-0001c210: 7079 7468 6f6e 280a 2020 2020 2020 2020  python(.        
-0001c220: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-0001c230: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
-0001c240: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
-0001c250: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-0001c260: 2829 0a20 2020 2020 2020 2049 6e20 5b32  ().        In [2
-0001c270: 5d3a 2074 696d 6569 742e 7469 6d65 6974  ]: timeit.timeit
-0001c280: 2822 6261 7365 3634 2e62 3634 6465 636f  ("base64.b64deco
-0001c290: 6465 222c 206e 756d 6265 723d 3129 0a20  de", number=1). 
-0001c2a0: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
-0001c2b0: 2069 6d70 6f72 7420 7469 6d65 6974 0a20   import timeit. 
-0001c2c0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0001c2d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001c2e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001c2f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001c300: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001c310: 2d2d 0a20 2020 2020 2020 204e 616d 6545  --.        NameE
-0001c320: 7272 6f72 2020 2020 2020 2020 2020 2020  rror            
-0001c330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c340: 2020 2020 2054 7261 6365 6261 636b 2028       Traceback (
-0001c350: 6d6f 7374 2072 6563 656e 7420 6361 6c6c  most recent call
-0001c360: 206c 6173 7429 0a20 2020 2020 2020 202e   last).        .
-0001c370: 2e2e 2069 6e20 2e2e 2e0a 2020 2020 2020  .. in ....      
-0001c380: 2020 2e2e 2e2e 0a20 2020 2020 2020 204e    .....        N
-0001c390: 616d 6545 7272 6f72 3a20 676c 6f62 616c  ameError: global
-0001c3a0: 206e 616d 6520 2762 6173 6536 3427 2069   name 'base64' i
-0001c3b0: 7320 6e6f 7420 6465 6669 6e65 640a 2020  s not defined.  
-0001c3c0: 2020 2222 220a 2020 2020 290a 0a0a 4072    """.    )...@r
-0001c3d0: 6574 7279 0a64 6566 2074 6573 745f 7469  etry.def test_ti
-0001c3e0: 6d65 5f31 2866 726f 6e74 656e 6429 3a0a  me_1(frontend):.
-0001c3f0: 2020 2020 2320 5665 7269 6679 2074 6861      # Verify tha
-0001c400: 7420 2574 696d 6520 6175 746f 696d 706f  t %time autoimpo
-0001c410: 7274 2077 6f72 6b73 2e0a 2020 2020 6970  rt works..    ip
-0001c420: 7974 686f 6e28 2222 220a 2020 2020 2020  ython(""".      
-0001c430: 2020 496e 205b 315d 3a20 696d 706f 7274    In [1]: import
-0001c440: 2070 7966 6c79 6279 3b20 7079 666c 7962   pyflyby; pyflyb
-0001c450: 792e 656e 6162 6c65 5f61 7574 6f5f 696d  y.enable_auto_im
-0001c460: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
-0001c470: 2049 6e20 5b32 5d3a 2025 7469 6d65 2062   In [2]: %time b
-0001c480: 3634 6465 636f 6465 2822 6447 5673 5a58  64decode("dGVsZX
-0001c490: 426f 6232 356c 2229 0a20 2020 2020 2020  Bob25l").       
-0001c4a0: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
-0001c4b0: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
-0001c4c0: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
-0001c4d0: 4350 5520 7469 6d65 733a 202e 2e2e 0a20  CPU times: .... 
-0001c4e0: 2020 2020 2020 2057 616c 6c20 7469 6d65         Wall time
-0001c4f0: 3a20 2e2e 2e0a 2020 2020 2020 2020 4f75  : ....        Ou
-0001c500: 745b 325d 3a20 6227 7465 6c65 7068 6f6e  t[2]: b'telephon
-0001c510: 6527 0a20 2020 2022 2222 2c20 6672 6f6e  e'.    """, fron
-0001c520: 7465 6e64 3d66 726f 6e74 656e 6429 0a0a  tend=frontend)..
-0001c530: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
-0001c540: 5f74 696d 655f 7265 7065 6174 5f31 2866  _time_repeat_1(f
-0001c550: 726f 6e74 656e 6429 3a0a 2020 2020 2320  rontend):.    # 
-0001c560: 5665 7269 6679 2074 6861 7420 2574 696d  Verify that %tim
-0001c570: 6520 6175 746f 696d 706f 7274 2077 6f72  e autoimport wor
-0001c580: 6b73 2e0a 2020 2020 6970 7974 686f 6e28  ks..    ipython(
-0001c590: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-0001c5a0: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
-0001c5b0: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
-0001c5c0: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-0001c5d0: 2829 0a20 2020 2020 2020 2049 6e20 5b32  ().        In [2
-0001c5e0: 5d3a 2025 7469 6d65 2062 3634 6465 636f  ]: %time b64deco
-0001c5f0: 6465 2822 6447 5673 5a57 6479 5958 426f  de("dGVsZWdyYXBo
-0001c600: 2229 0a20 2020 2020 2020 205b 5059 464c  ").        [PYFL
-0001c610: 5942 595d 2066 726f 6d20 6261 7365 3634  YBY] from base64
-0001c620: 2069 6d70 6f72 7420 6236 3464 6563 6f64   import b64decod
-0001c630: 650a 2020 2020 2020 2020 4350 5520 7469  e.        CPU ti
-0001c640: 6d65 733a 202e 2e2e 0a20 2020 2020 2020  mes: ....       
-0001c650: 2057 616c 6c20 7469 6d65 3a20 2e2e 2e0a   Wall time: ....
-0001c660: 2020 2020 2020 2020 4f75 745b 325d 3a20          Out[2]: 
-0001c670: 6227 7465 6c65 6772 6170 6827 0a20 2020  b'telegraph'.   
-0001c680: 2020 2020 2049 6e20 5b33 5d3a 2025 7469       In [3]: %ti
-0001c690: 6d65 2062 3634 6465 636f 6465 2822 5a57  me b64decode("ZW
-0001c6a0: 3168 6157 773d 2229 0a20 2020 2020 2020  1haWw=").       
-0001c6b0: 2043 5055 2074 696d 6573 3a20 2e2e 2e0a   CPU times: ....
-0001c6c0: 2020 2020 2020 2020 5761 6c6c 2074 696d          Wall tim
-0001c6d0: 653a 202e 2e2e 0a20 2020 2020 2020 204f  e: ....        O
-0001c6e0: 7574 5b33 5d3a 2062 2765 6d61 696c 270a  ut[3]: b'email'.
-0001c6f0: 2020 2020 2222 222c 2066 726f 6e74 656e      """, fronten
-0001c700: 643d 6672 6f6e 7465 6e64 290a 0a0a 4072  d=frontend)...@r
-0001c710: 6574 7279 0a64 6566 2074 6573 745f 7469  etry.def test_ti
-0001c720: 6d65 5f63 6f6d 706c 6574 655f 3128 6672  me_complete_1(fr
-0001c730: 6f6e 7465 6e64 293a 0a20 2020 2023 2056  ontend):.    # V
-0001c740: 6572 6966 7920 7468 6174 2074 6162 2063  erify that tab c
-0001c750: 6f6d 706c 6574 696f 6e20 776f 726b 7320  ompletion works 
-0001c760: 7769 7468 2025 7469 6d65 2e0a 2020 2020  with %time..    
-0001c770: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
-0001c780: 2020 2020 496e 205b 315d 3a20 696d 706f      In [1]: impo
-0001c790: 7274 2070 7966 6c79 6279 3b20 7079 666c  rt pyflyby; pyfl
-0001c7a0: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
-0001c7b0: 696d 706f 7274 6572 2829 0a20 2020 2020  importer().     
-0001c7c0: 2020 2049 6e20 5b32 5d3a 2025 7469 6d65     In [2]: %time
-0001c7d0: 2062 3634 6465 5c74 636f 6465 2827 6332   b64de\tcode('c2
-0001c7e0: 6870 636e 513d 2729 0a20 2020 2020 2020  hpcnQ=').       
-0001c7f0: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
-0001c800: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
-0001c810: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
-0001c820: 4350 5520 7469 6d65 733a 202e 2e2e 0a20  CPU times: .... 
-0001c830: 2020 2020 2020 2057 616c 6c20 7469 6d65         Wall time
-0001c840: 3a20 2e2e 2e0a 2020 2020 2020 2020 4f75  : ....        Ou
-0001c850: 745b 325d 3a20 6227 7368 6972 7427 0a20  t[2]: b'shirt'. 
-0001c860: 2020 2022 2222 2c20 6672 6f6e 7465 6e64     """, frontend
-0001c870: 3d66 726f 6e74 656e 6429 0a0a 0a40 7265  =frontend)...@re
-0001c880: 7472 790a 6465 6620 7465 7374 5f74 696d  try.def test_tim
-0001c890: 655f 636f 6d70 6c65 7465 5f6d 656e 755f  e_complete_menu_
-0001c8a0: 3128 6672 6f6e 7465 6e64 293a 0a20 2020  1(frontend):.   
-0001c8b0: 2023 2056 6572 6966 7920 7468 6174 206d   # Verify that m
-0001c8c0: 656e 7520 7461 6220 636f 6d70 6c65 7469  enu tab completi
-0001c8d0: 6f6e 2077 6f72 6b73 2077 6974 6820 2574  on works with %t
-0001c8e0: 696d 652e 0a20 2020 2069 6620 6672 6f6e  ime..    if fron
-0001c8f0: 7465 6e64 203d 3d20 2270 726f 6d70 745f  tend == "prompt_
-0001c900: 746f 6f6c 6b69 7422 3a20 7079 7465 7374  toolkit": pytest
-0001c910: 2e73 6b69 7028 290a 2020 2020 6970 7974  .skip().    ipyt
-0001c920: 686f 6e28 2222 220a 2020 2020 2020 2020  hon(""".        
-0001c930: 496e 205b 315d 3a20 696d 706f 7274 2070  In [1]: import p
-0001c940: 7966 6c79 6279 3b20 7079 666c 7962 792e  yflyby; pyflyby.
-0001c950: 656e 6162 6c65 5f61 7574 6f5f 696d 706f  enable_auto_impo
-0001c960: 7274 6572 2829 0a20 2020 2020 2020 2049  rter().        I
-0001c970: 6e20 5b32 5d3a 2074 696d 6520 6236 345c  n [2]: time b64\
-0001c980: 740a 2020 2020 2020 2020 6236 3464 6563  t.        b64dec
-0001c990: 6f64 6520 2062 3634 656e 636f 6465 0a20  ode  b64encode. 
-0001c9a0: 2020 2020 2020 2049 6e20 5b32 5d3a 2074         In [2]: t
-0001c9b0: 696d 6520 6236 345c 7830 3664 5c74 6563  ime b64\x06d\tec
-0001c9c0: 6f64 6528 2763 4746 7564 484d 3d27 290a  ode('cGFudHM=').
-0001c9d0: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
-0001c9e0: 5d20 6672 6f6d 2062 6173 6536 3420 696d  ] from base64 im
-0001c9f0: 706f 7274 2062 3634 6465 636f 6465 0a20  port b64decode. 
-0001ca00: 2020 2020 2020 2043 5055 2074 696d 6573         CPU times
-0001ca10: 3a20 2e2e 2e0a 2020 2020 2020 2020 5761  : ....        Wa
-0001ca20: 6c6c 2074 696d 653a 202e 2e2e 0a20 2020  ll time: ....   
-0001ca30: 2020 2020 204f 7574 5b32 5d3a 2062 2770       Out[2]: b'p
-0001ca40: 616e 7473 270a 2020 2020 2222 222c 2066  ants'.    """, f
-0001ca50: 726f 6e74 656e 643d 6672 6f6e 7465 6e64  rontend=frontend
-0001ca60: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
-0001ca70: 6573 745f 7469 6d65 5f63 6f6d 706c 6574  est_time_complet
-0001ca80: 655f 6175 746f 696d 706f 7274 5f6d 656d  e_autoimport_mem
-0001ca90: 6265 725f 3128 6672 6f6e 7465 6e64 293a  ber_1(frontend):
-0001caa0: 0a20 2020 2069 6620 6672 6f6e 7465 6e64  .    if frontend
-0001cab0: 203d 3d20 2270 726f 6d70 745f 746f 6f6c   == "prompt_tool
-0001cac0: 6b69 7422 3a20 7079 7465 7374 2e73 6b69  kit": pytest.ski
-0001cad0: 7028 290a 2020 2020 6970 7974 686f 6e28  p().    ipython(
-0001cae0: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-0001caf0: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
-0001cb00: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
-0001cb10: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-0001cb20: 2829 0a20 2020 2020 2020 2049 6e20 5b32  ().        In [2
-0001cb30: 5d3a 2074 696d 6520 6261 7365 3634 2e62  ]: time base64.b
-0001cb40: 365c 740a 2020 2020 2020 2020 5b50 5946  6\t.        [PYF
-0001cb50: 4c59 4259 5d20 696d 706f 7274 2062 6173  LYBY] import bas
-0001cb60: 6536 340a 2020 2020 2020 2020 496e 205b  e64.        In [
-0001cb70: 325d 3a20 7469 6d65 2062 6173 6536 342e  2]: time base64.
-0001cb80: 6236 0a20 2020 2020 2020 2062 6173 6536  b6.        base6
-0001cb90: 342e 6236 3464 6563 6f64 6520 2062 6173  4.b64decode  bas
-0001cba0: 6536 342e 6236 3465 6e63 6f64 650a 2020  e64.b64encode.  
-0001cbb0: 2020 2020 2020 496e 205b 325d 3a20 7469        In [2]: ti
-0001cbc0: 6d65 2062 6173 6536 342e 6236 345c 7830  me base64.b64\x0
-0001cbd0: 3664 6563 5c74 6f64 6528 2761 6d46 6a61  6dec\tode('amFja
-0001cbe0: 3256 3027 290a 2020 2020 2020 2020 4350  2V0').        CP
-0001cbf0: 5520 7469 6d65 733a 202e 2e2e 0a20 2020  U times: ....   
-0001cc00: 2020 2020 2057 616c 6c20 7469 6d65 3a20       Wall time: 
-0001cc10: 2e2e 2e0a 2020 2020 2020 2020 4f75 745b  ....        Out[
-0001cc20: 325d 3a20 6227 6a61 636b 6574 270a 2020  2]: b'jacket'.  
-0001cc30: 2020 2222 222c 2066 726f 6e74 656e 643d    """, frontend=
-0001cc40: 6672 6f6e 7465 6e64 290a 0a0a 4072 6574  frontend)...@ret
-0001cc50: 7279 0a64 6566 2074 6573 745f 7072 756e  ry.def test_prun
-0001cc60: 5f31 2829 3a0a 2020 2020 2320 5665 7269  _1():.    # Veri
-0001cc70: 6679 2074 6861 7420 2570 7275 6e20 776f  fy that %prun wo
-0001cc80: 726b 732c 2061 7574 6f69 6d70 6f72 7473  rks, autoimports
-0001cc90: 2074 6865 2066 6972 7374 2074 696d 652c   the first time,
-0001cca0: 2062 7574 206e 6f74 2074 6865 2073 6563   but not the sec
-0001ccb0: 6f6e 640a 2020 2020 2320 7469 6d65 2e0a  ond.    # time..
-0001ccc0: 2020 2020 6970 7974 686f 6e28 2222 220a      ipython(""".
-0001ccd0: 2020 2020 2020 2020 496e 205b 315d 3a20          In [1]: 
-0001cce0: 696d 706f 7274 2070 7966 6c79 6279 3b20  import pyflyby; 
-0001ccf0: 7079 666c 7962 792e 656e 6162 6c65 5f61  pyflyby.enable_a
-0001cd00: 7574 6f5f 696d 706f 7274 6572 2829 0a20  uto_importer(). 
-0001cd10: 2020 2020 2020 2049 6e20 5b32 5d3a 2025         In [2]: %
-0001cd20: 7072 756e 2062 3634 6465 636f 6465 2822  prun b64decode("
-0001cd30: 5257 6c75 6333 526c 6157 343d 2229 0a20  RWluc3RlaW4="). 
-0001cd40: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
-0001cd50: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
-0001cd60: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
-0001cd70: 2020 2020 2020 2e2e 2e2e 2066 756e 6374        .... funct
-0001cd80: 696f 6e20 6361 6c6c 7320 696e 202e 2e2e  ion calls in ...
-0001cd90: 2073 6563 6f6e 6473 0a20 2020 2020 2020   seconds.       
-0001cda0: 202e 2e2e 2e0a 2020 2020 2020 2020 496e   .....        In
-0001cdb0: 205b 335d 3a20 6236 3464 6563 6f64 6528   [3]: b64decode(
-0001cdc0: 2253 4746 3361 326c 755a 773d 3d22 290a  "SGF3a2luZw==").
-0001cdd0: 2020 2020 2020 2020 4f75 745b 335d 3a20          Out[3]: 
-0001cde0: 6227 4861 776b 696e 6727 0a20 2020 2020  b'Hawking'.     
-0001cdf0: 2020 2049 6e20 5b34 5d3a 2025 7072 756e     In [4]: %prun
-0001ce00: 2062 3634 6465 636f 6465 2822 5447 3979   b64decode("TG9y
-0001ce10: 5a57 3530 6567 3d3d 2229 0a20 2020 2020  ZW50eg==").     
-0001ce20: 2020 202e 2e2e 2e20 6675 6e63 7469 6f6e     .... function
-0001ce30: 2063 616c 6c73 2069 6e20 2e2e 2e20 7365   calls in ... se
-0001ce40: 636f 6e64 730a 2020 2020 2020 2020 2e2e  conds.        ..
-0001ce50: 2e2e 0a20 2020 2022 2222 290a 0a0a 4072  ...    """)...@r
-0001ce60: 6574 7279 0a64 6566 2074 6573 745f 6e6f  etry.def test_no
-0001ce70: 6e69 6e74 6572 6163 7469 7665 5f70 726f  ninteractive_pro
-0001ce80: 6669 6c65 5f75 6e61 6666 6563 7465 645f  file_unaffected_
-0001ce90: 3128 293a 0a20 2020 2023 2056 6572 6966  1():.    # Verif
-0001cea0: 7920 7468 6174 2074 6865 2070 726f 6669  y that the profi
-0001ceb0: 6c65 206d 6f64 756c 6520 6974 7365 6c66  le module itself
-0001cec0: 2069 7320 6e6f 7420 6166 6665 6374 6564   is not affected
-0001ced0: 2028 692e 652e 2076 6572 6966 7920 7468   (i.e. verify th
-0001cee0: 6174 0a20 2020 2023 2077 6520 6f6e 6c79  at.    # we only
-0001cef0: 2068 6f6f 6b20 7468 6520 4950 7974 686f   hook the IPytho
-0001cf00: 6e20 7573 6167 6520 6f66 2069 7429 2e0a  n usage of it)..
-0001cf10: 2020 2020 6970 7974 686f 6e28 0a20 2020      ipython(.   
-0001cf20: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001cf30: 2049 6e20 5b31 5d3a 2069 6d70 6f72 7420   In [1]: import 
-0001cf40: 7079 666c 7962 793b 2070 7966 6c79 6279  pyflyby; pyflyby
-0001cf50: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
-0001cf60: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
-0001cf70: 496e 205b 325d 3a20 7072 6f66 696c 652e  In [2]: profile.
-0001cf80: 5072 6f66 696c 6528 292e 7275 6e28 2262  Profile().run("b
-0001cf90: 6173 6536 342e 6236 3464 6563 6f64 6522  ase64.b64decode"
-0001cfa0: 290a 2020 2020 2020 2020 5b50 5946 4c59  ).        [PYFLY
-0001cfb0: 4259 5d20 696d 706f 7274 2070 726f 6669  BY] import profi
-0001cfc0: 6c65 0a20 2020 2020 2020 202d 2d2d 2d2d  le.        -----
-0001cfd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001cfe0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001cff0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001d000: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001d010: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 204e  ------.        N
-0001d020: 616d 6545 7272 6f72 2020 2020 2020 2020  ameError        
-0001d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d040: 2020 2020 2020 2020 2054 7261 6365 6261           Traceba
-0001d050: 636b 2028 6d6f 7374 2072 6563 656e 7420  ck (most recent 
-0001d060: 6361 6c6c 206c 6173 7429 0a20 2020 2020  call last).     
-0001d070: 2020 202e 2e2e 2069 6e20 2e2e 2e0a 2020     ... in ....  
-0001d080: 2020 2020 2020 2e2e 2e2e 0a20 2020 2020        .....     
-0001d090: 2020 204e 616d 6545 7272 6f72 3a20 6e61     NameError: na
-0001d0a0: 6d65 2027 6261 7365 3634 2720 6973 206e  me 'base64' is n
-0001d0b0: 6f74 2064 6566 696e 6564 0a20 2020 2022  ot defined.    "
-0001d0c0: 2222 0a20 2020 2029 0a0a 0a40 7265 7472  "".    )...@retr
-0001d0d0: 790a 6465 6620 7465 7374 5f65 7272 6f72  y.def test_error
-0001d0e0: 5f64 7572 696e 675f 656e 6162 6c65 5f31  _during_enable_1
-0001d0f0: 2829 3a0a 2020 2020 2320 5665 7269 6679  ():.    # Verify
-0001d100: 2074 6861 7420 6966 2061 6e20 6572 726f   that if an erro
-0001d110: 7220 6f63 6375 7273 2064 7572 696e 6720  r occurs during 
-0001d120: 656e 6162 6c69 6e67 2c20 7468 6174 2077  enabling, that w
-0001d130: 6520 6469 7361 626c 6520 7468 650a 2020  e disable the.  
-0001d140: 2020 2320 6175 746f 696d 706f 7274 6572    # autoimporter
-0001d150: 2e20 2056 6572 6966 7920 7468 6174 2077  .  Verify that w
-0001d160: 6520 646f 6e27 7420 6174 7465 6d70 7420  e don't attempt 
-0001d170: 746f 2072 652d 656e 6162 6c65 2061 6761  to re-enable aga
-0001d180: 696e 2e0a 2020 2020 6970 7974 686f 6e28  in..    ipython(
-0001d190: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001d1a0: 2020 2020 2049 6e20 5b31 5d3a 2069 6d70       In [1]: imp
-0001d1b0: 6f72 7420 7079 666c 7962 790a 2020 2020  ort pyflyby.    
-0001d1c0: 2020 2020 496e 205b 325d 3a20 7079 666c      In [2]: pyfl
-0001d1d0: 7962 792e 5f69 6e74 6572 6163 7469 7665  yby._interactive
-0001d1e0: 2e41 7574 6f49 6d70 6f72 7465 722e 5f65  .AutoImporter._e
-0001d1f0: 6e61 626c 655f 696e 7465 726e 616c 203d  nable_internal =
-0001d200: 204e 6f6e 650a 2020 2020 2020 2020 496e   None.        In
-0001d210: 205b 335d 3a20 7079 666c 7962 792e 656e   [3]: pyflyby.en
-0001d220: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
-0001d230: 6572 2829 0a20 2020 2020 2020 205b 5059  er().        [PY
-0001d240: 464c 5942 595d 2054 7970 6545 7272 6f72  FLYBY] TypeError
-0001d250: 3a20 274e 6f6e 6554 7970 6527 206f 626a  : 'NoneType' obj
-0001d260: 6563 7420 6973 206e 6f74 2063 616c 6c61  ect is not calla
-0001d270: 626c 650a 2020 2020 2020 2020 5b50 5946  ble.        [PYF
-0001d280: 4c59 4259 5d20 5365 7420 7468 6520 656e  LYBY] Set the en
-0001d290: 7620 7661 7220 5059 464c 5942 595f 4c4f  v var PYFLYBY_LO
-0001d2a0: 475f 4c45 5645 4c3d 4445 4255 4720 746f  G_LEVEL=DEBUG to
-0001d2b0: 2064 6562 7567 2e0a 2020 2020 2020 2020   debug..        
-0001d2c0: 5b50 5946 4c59 4259 5d20 4469 7361 626c  [PYFLYBY] Disabl
-0001d2d0: 696e 6720 7079 666c 7962 7920 6175 746f  ing pyflyby auto
-0001d2e0: 2069 6d70 6f72 7465 722e 0a20 2020 2020   importer..     
-0001d2f0: 2020 2049 6e20 5b34 5d3a 2070 7269 6e74     In [4]: print
-0001d300: 2827 6865 6c6c 6f27 290a 2020 2020 2020  ('hello').      
-0001d310: 2020 6865 6c6c 6f0a 2020 2020 2020 2020    hello.        
-0001d320: 496e 205b 355d 3a20 7379 730a 2020 2020  In [5]: sys.    
-0001d330: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
-0001d340: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001d350: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001d360: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001d370: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
-0001d380: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
-0001d390: 7220 2020 2020 2020 2020 2020 2020 2020  r               
-0001d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3b0: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
-0001d3c0: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
-0001d3d0: 7374 290a 2020 2020 2020 2020 2e2e 2e20  st).        ... 
-0001d3e0: 696e 202e 2e2e 0a20 2020 2020 2020 204e  in ....        N
-0001d3f0: 616d 6545 7272 6f72 3a20 6e61 6d65 2027  ameError: name '
-0001d400: 7379 7327 2069 7320 6e6f 7420 6465 6669  sys' is not defi
-0001d410: 6e65 640a 2020 2020 2020 2020 496e 205b  ned.        In [
-0001d420: 365d 3a20 7079 666c 7962 792e 656e 6162  6]: pyflyby.enab
-0001d430: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-0001d440: 2829 0a20 2020 2020 2020 205b 5059 464c  ().        [PYFL
-0001d450: 5942 595d 204e 6f74 2072 6561 7474 656d  YBY] Not reattem
-0001d460: 7074 696e 6720 746f 2065 6e61 626c 6520  pting to enable 
-0001d470: 6175 746f 2069 6d70 6f72 7465 7220 6166  auto importer af
-0001d480: 7465 7220 6561 726c 6965 7220 6572 726f  ter earlier erro
-0001d490: 720a 2020 2020 2222 220a 2020 2020 290a  r.    """.    ).
-0001d4a0: 0a0a 736b 6970 6966 5f69 7079 7468 6f6e  ..skipif_ipython
-0001d4b0: 5f74 6f6f 5f6f 6c64 5f66 6f72 5f6b 6572  _too_old_for_ker
-0001d4c0: 6e65 6c20 3d20 7079 7465 7374 2e6d 6172  nel = pytest.mar
-0001d4d0: 6b2e 736b 6970 6966 280a 2020 2020 5f49  k.skipif(.    _I
-0001d4e0: 5059 5448 4f4e 5f56 4552 5349 4f4e 203c  PYTHON_VERSION <
-0001d4f0: 2028 302c 2031 3229 2c0a 2020 2020 7265   (0, 12),.    re
-0001d500: 6173 6f6e 3d22 4950 7974 686f 6e20 7665  ason="IPython ve
-0001d510: 7273 696f 6e20 2573 2064 6f65 7320 6e6f  rsion %s does no
-0001d520: 7420 7375 7070 6f72 7420 6b65 726e 656c  t support kernel
-0001d530: 2c20 736f 206e 6f74 6869 6e67 2074 6f20  , so nothing to 
-0001d540: 7465 7374 2229 0a0a 2320 5765 2063 6f75  test")..# We cou
-0001d550: 6c64 2077 7269 7465 2074 6f20 6a75 7079  ld write to jupy
-0001d560: 7465 725f 636f 6e73 6f6c 655f 636f 6e66  ter_console_conf
-0001d570: 6967 2e70 7920 616e 6420 7365 7420 4a55  ig.py and set JU
-0001d580: 5059 5445 525f 434f 4e46 4947 5f44 4952  PYTER_CONFIG_DIR
-0001d590: 2c20 6275 740a 2320 6974 206f 6e6c 7920  , but.# it only 
-0001d5a0: 7375 7070 6f72 7473 2068 6967 686c 6967  supports highlig
-0001d5b0: 6874 5f6d 6174 6368 696e 675f 6272 6163  ht_matching_brac
-0001d5c0: 6b65 7473 2c20 6e6f 740a 2320 6469 7370  kets, not.# disp
-0001d5d0: 6c61 795f 636f 6d70 6c65 7469 6f6e 733d  lay_completions=
-0001d5e0: 2772 6561 646c 696e 656c 696b 6527 2c20  'readlinelike', 
-0001d5f0: 736f 2061 6e79 2074 6573 7420 7468 6174  so any test that
-0001d600: 2075 7365 7320 7461 6220 636f 6d70 6c65   uses tab comple
-0001d610: 7469 6f6e 0a23 2077 6f6e 2774 2077 6f72  tion.# won't wor
-0001d620: 6b2e 0a0a 0a40 736b 6970 6966 5f69 7079  k....@skipif_ipy
-0001d630: 7468 6f6e 5f74 6f6f 5f6f 6c64 5f66 6f72  thon_too_old_for
-0001d640: 5f6b 6572 6e65 6c0a 2320 4072 6574 7279  _kernel.# @retry
-0001d650: 2845 7870 6563 7445 7272 6f72 290a 4070  (ExpectError).@p
-0001d660: 7974 6573 742e 6d61 726b 2e78 6661 696c  ytest.mark.xfail
-0001d670: 280a 2020 2020 7379 732e 7665 7273 696f  (.    sys.versio
-0001d680: 6e5f 696e 666f 5b30 5d20 3d3d 2033 2c0a  n_info[0] == 3,.
-0001d690: 2020 2020 7265 6173 6f6e 3d22 4e65 6564      reason="Need
-0001d6a0: 206e 6577 6572 2076 6572 7369 6f6e 206f   newer version o
-0001d6b0: 6620 6a75 7079 7465 725f 636f 6e73 6f6c  f jupyter_consol
-0001d6c0: 6520 3e20 362e 342e 3120 6d61 7962 6520  e > 6.4.1 maybe 
-0001d6d0: 3f20 436f 726f 7574 696e 6520 6e6f 7420  ? Coroutine not 
-0001d6e0: 6177 6169 7465 6422 2c0a 2020 2020 7374  awaited",.    st
-0001d6f0: 7269 6374 3d46 616c 7365 2c0a 290a 4070  rict=False,.).@p
-0001d700: 7974 6573 742e 6d61 726b 2e70 6172 616d  ytest.mark.param
-0001d710: 6574 7269 7a65 2827 7365 6e64 656f 6627  etrize('sendeof'
-0001d720: 2c20 5b46 616c 7365 2c20 5472 7565 5d29  , [False, True])
-0001d730: 0a64 6566 2074 6573 745f 6970 7974 686f  .def test_ipytho
-0001d740: 6e5f 636f 6e73 6f6c 655f 3128 7365 6e64  n_console_1(send
-0001d750: 656f 6629 3a0a 2020 2020 2320 5665 7269  eof):.    # Veri
-0001d760: 6679 2074 6861 7420 6175 746f 696d 706f  fy that autoimpo
-0001d770: 7274 2061 6e64 2074 6162 2063 6f6d 706c  rt and tab compl
-0001d780: 6574 696f 6e20 776f 726b 2069 6e20 4950  etion work in IP
-0001d790: 7974 686f 6e20 636f 6e73 6f6c 652e 0a20  ython console.. 
-0001d7a0: 2020 2023 2057 6520 7265 7472 7920 6120     # We retry a 
-0001d7b0: 6665 7720 7469 6d65 7320 756e 7469 6c20  few times until 
-0001d7c0: 7375 6363 6573 7320 2876 6961 2074 6865  success (via the
-0001d7d0: 2040 7265 7472 7920 6465 636f 7261 746f   @retry decorato
-0001d7e0: 7229 2062 6563 6175 7365 0a20 2020 2023  r) because.    #
-0001d7f0: 2066 6f72 2073 6f6d 6520 7665 7273 696f   for some versio
-0001d800: 6e73 206f 6620 6970 7974 686f 6e2c 2069  ns of ipython, i
-0001d810: 6e20 736f 6d65 2063 6f6e 6669 6775 7261  n some configura
-0001d820: 7469 6f6e 732c 2027 6970 7974 686f 6e20  tions, 'ipython 
-0001d830: 636f 6e73 6f6c 6527 0a20 2020 2023 206f  console'.    # o
-0001d840: 6363 6173 696f 6e61 6c6c 7920 6861 6e67  ccasionally hang
-0001d850: 7320 6f6e 2073 7461 7274 7570 3b20 6e6f  s on startup; no
-0001d860: 7420 7375 7265 2077 6879 2c20 6275 7420  t sure why, but 
-0001d870: 6974 2073 6565 6d73 2075 6e72 656c 6174  it seems unrelat
-0001d880: 6564 2074 6f0a 2020 2020 2320 7079 666c  ed to.    # pyfl
-0001d890: 7962 792c 2073 696e 6365 2069 7420 6861  yby, since it ha
-0001d8a0: 7070 656e 7320 6265 666f 7265 2061 6e79  ppens before any
-0001d8b0: 2070 7966 6c79 6279 2063 6f6d 6d61 6e64   pyflyby command
-0001d8c0: 732e 0a20 2020 2023 2054 6865 2072 6561  s..    # The rea
-0001d8d0: 736f 6e20 666f 7220 7468 6520 2749 6e20  son for the 'In 
-0001d8e0: 5b31 5d3a 2078 203d 2039 3139 3736 3031  [1]: x = 9197601
-0001d8f0: 3227 2069 7320 746f 206d 616b 6520 7468  2' is to make th
-0001d900: 6973 2074 6573 7420 6d6f 7265 0a20 2020  is test more.   
-0001d910: 2023 2072 6f62 7573 7420 696e 206f 6c64   # robust in old
-0001d920: 6572 2076 6572 7369 6f6e 7320 6f66 2049  er versions of I
-0001d930: 5079 7468 6f6e 2e20 2049 6e20 736f 6d65  Python.  In some
-0001d940: 2076 6572 7369 6f6e 7320 2830 2e78 292c   versions (0.x),
-0001d950: 2049 5079 7468 6f6e 0a20 2020 2023 2063   IPython.    # c
-0001d960: 6f6e 736f 6c65 206f 6363 6173 696f 6e61  onsole occasiona
-0001d970: 6c6c 7920 646f 6573 6e27 7420 7072 696e  lly doesn't prin
-0001d980: 7420 7468 6520 6669 7273 7420 6f75 7470  t the first outp
-0001d990: 7574 2028 692e 652e 204f 7574 5b31 5d29  ut (i.e. Out[1])
-0001d9a0: 2e20 2057 650a 2020 2020 2320 776f 726b  .  We.    # work
-0001d9b0: 2061 726f 756e 6420 7468 6973 2062 7920   around this by 
-0001d9c0: 6669 7273 7420 7275 6e6e 696e 6720 736f  first running so
-0001d9d0: 6d65 7468 696e 6720 7768 6572 6520 7765  mething where we
-0001d9e0: 2064 6f6e 2774 2065 7870 6563 7420 616e   don't expect an
-0001d9f0: 0a20 2020 2023 204f 7574 5b31 5d2e 0a20  .    # Out[1].. 
-0001da00: 2020 2069 6620 7365 6e64 656f 6620 616e     if sendeof an
-0001da10: 6420 5f49 5059 5448 4f4e 5f56 4552 5349  d _IPYTHON_VERSI
-0001da20: 4f4e 203e 3d20 2835 2c29 3a20 7079 7465  ON >= (5,): pyte
-0001da30: 7374 2e73 6b69 7028 290a 2020 2020 6970  st.skip().    ip
-0001da40: 7974 686f 6e28 2222 220a 2020 2020 2020  ython(""".      
-0001da50: 2020 496e 205b 315d 3a20 7820 3d20 3931    In [1]: x = 91
-0001da60: 3937 3630 3132 0a20 2020 2020 2020 2049  976012.        I
-0001da70: 6e20 5b32 5d3a 2027 6163 6f72 6e27 0a20  n [2]: 'acorn'. 
-0001da80: 2020 2020 2020 204f 7574 5b32 5d3a 2027         Out[2]: '
-0001da90: 6163 6f72 6e27 0a20 2020 2020 2020 2049  acorn'.        I
-0001daa0: 6e20 5b33 5d3a 2069 6d70 6f72 7420 7079  n [3]: import py
-0001dab0: 666c 7962 793b 2070 7966 6c79 6279 2e65  flyby; pyflyby.e
-0001dac0: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
-0001dad0: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
-0001dae0: 205b 345d 3a20 6236 3464 6563 6f5c 7464   [4]: b64deco\td
-0001daf0: 6528 2763 4756 6862 6e56 3027 290a 2020  e('cGVhbnV0').  
-0001db00: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
-0001db10: 6672 6f6d 2062 6173 6536 3420 696d 706f  from base64 impo
-0001db20: 7274 2062 3634 6465 636f 6465 0a20 2020  rt b64decode.   
-0001db30: 2020 2020 204f 7574 5b34 5d3a 2062 2770       Out[4]: b'p
-0001db40: 6561 6e75 7427 0a20 2020 2022 2222 2c20  eanut'.    """, 
-0001db50: 6172 6773 3d27 636f 6e73 6f6c 6527 2c20  args='console', 
-0001db60: 7365 6e64 656f 663d 7365 6e64 656f 6629  sendeof=sendeof)
-0001db70: 0a0a 0a40 736b 6970 6966 5f69 7079 7468  ...@skipif_ipyth
-0001db80: 6f6e 5f74 6f6f 5f6f 6c64 5f66 6f72 5f6b  on_too_old_for_k
-0001db90: 6572 6e65 6c0a 4070 7974 6573 742e 6d61  ernel.@pytest.ma
-0001dba0: 726b 2e78 6661 696c 280a 2020 2020 7379  rk.xfail(.    sy
-0001dbb0: 732e 7665 7273 696f 6e5f 696e 666f 5b30  s.version_info[0
-0001dbc0: 5d20 3d3d 2033 2c0a 2020 2020 7265 6173  ] == 3,.    reas
-0001dbd0: 6f6e 3d22 4e65 6564 206e 6577 6572 2076  on="Need newer v
-0001dbe0: 6572 7369 6f6e 206f 6620 6a75 7079 7465  ersion of jupyte
-0001dbf0: 725f 636f 6e73 6f6c 6520 3e20 362e 342e  r_console > 6.4.
-0001dc00: 3120 6d61 7962 6520 3f20 436f 726f 7574  1 maybe ? Corout
-0001dc10: 696e 6520 6e6f 7420 6177 6169 7465 6422  ine not awaited"
-0001dc20: 2c0a 2020 2020 7374 7269 6374 3d46 616c  ,.    strict=Fal
-0001dc30: 7365 2c0a 290a 4072 6574 7279 0a64 6566  se,.).@retry.def
-0001dc40: 2074 6573 745f 6970 7974 686f 6e5f 6b65   test_ipython_ke
-0001dc50: 726e 656c 5f63 6f6e 736f 6c65 5f65 7869  rnel_console_exi
-0001dc60: 7374 696e 675f 3128 293a 0a20 2020 2023  sting_1():.    #
-0001dc70: 2056 6572 6966 7920 7468 6174 2061 7574   Verify that aut
-0001dc80: 6f69 6d70 6f72 7420 616e 6420 7461 6220  oimport and tab 
-0001dc90: 636f 6d70 6c65 7469 6f6e 2077 6f72 6b20  completion work 
-0001dca0: 696e 2049 5079 7468 6f6e 2063 6f6e 736f  in IPython conso
-0001dcb0: 6c65 2c20 7768 656e 0a20 2020 2023 2073  le, when.    # s
-0001dcc0: 7461 7274 6564 2069 6e64 6570 656e 6465  tarted independe
-0001dcd0: 6e74 6c79 2e0a 2020 2020 2320 5374 6172  ntly..    # Star
-0001dce0: 7420 2249 5079 7468 6f6e 206b 6572 6e65  t "IPython kerne
-0001dcf0: 6c22 2e0a 2020 2020 7769 7468 2049 5079  l"..    with IPy
-0001dd00: 7468 6f6e 4b65 726e 656c 4374 7828 2920  thonKernelCtx() 
-0001dd10: 6173 206b 6572 6e65 6c3a 0a20 2020 2020  as kernel:.     
-0001dd20: 2020 2023 2053 7461 7274 2061 2073 6570     # Start a sep
-0001dd30: 6172 6174 6520 2269 7079 7468 6f6e 2063  arate "ipython c
-0001dd40: 6f6e 736f 6c65 202d 2d65 7869 7374 696e  onsole --existin
-0001dd50: 6720 6b65 726e 656c 2d31 3233 342e 6a73  g kernel-1234.js
-0001dd60: 6f6e 222e 0a20 2020 2020 2020 2069 7079  on"..        ipy
-0001dd70: 7468 6f6e 2822 2222 0a20 2020 2020 2020  thon(""".       
-0001dd80: 2020 2020 2049 6e20 5b31 5d3a 2069 6d70       In [1]: imp
-0001dd90: 6f72 7420 7079 666c 7962 793b 2070 7966  ort pyflyby; pyf
-0001dda0: 6c79 6279 2e65 6e61 626c 655f 6175 746f  lyby.enable_auto
-0001ddb0: 5f69 6d70 6f72 7465 7228 290a 2020 2020  _importer().    
-0001ddc0: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
-0001ddd0: 6236 3464 6563 6f5c 7464 6528 2762 4756  b64deco\tde('bGV
-0001dde0: 6e64 5731 6c27 290a 2020 2020 2020 2020  ndW1l').        
-0001ddf0: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
-0001de00: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
-0001de10: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
-0001de20: 2020 2020 2020 204f 7574 5b32 5d3a 2062         Out[2]: b
-0001de30: 276c 6567 756d 6527 0a20 2020 2020 2020  'legume'.       
-0001de40: 2022 2222 2c20 6172 6773 3d5b 2763 6f6e   """, args=['con
-0001de50: 736f 6c65 275d 2c20 6b65 726e 656c 3d6b  sole'], kernel=k
-0001de60: 6572 6e65 6c29 0a0a 0a40 736b 6970 6966  ernel)...@skipif
-0001de70: 5f69 7079 7468 6f6e 5f74 6f6f 5f6f 6c64  _ipython_too_old
-0001de80: 5f66 6f72 5f6b 6572 6e65 6c0a 4070 7974  _for_kernel.@pyt
-0001de90: 6573 742e 6d61 726b 2e78 6661 696c 280a  est.mark.xfail(.
-0001dea0: 2020 2020 7379 732e 7665 7273 696f 6e5f      sys.version_
-0001deb0: 696e 666f 5b30 5d20 3d3d 2033 2c0a 2020  info[0] == 3,.  
-0001dec0: 2020 7265 6173 6f6e 3d22 4e65 6564 206e    reason="Need n
-0001ded0: 6577 6572 2076 6572 7369 6f6e 206f 6620  ewer version of 
-0001dee0: 6a75 7079 7465 725f 636f 6e73 6f6c 6520  jupyter_console 
-0001def0: 3e20 362e 342e 3120 6d61 7962 6520 3f20  > 6.4.1 maybe ? 
-0001df00: 436f 726f 7574 696e 6520 6e6f 7420 6177  Coroutine not aw
-0001df10: 6169 7465 6422 2c0a 2020 2020 7374 7269  aited",.    stri
-0001df20: 6374 3d46 616c 7365 2c0a 290a 4072 6574  ct=False,.).@ret
-0001df30: 7279 0a64 6566 2074 6573 745f 6970 7974  ry.def test_ipyt
-0001df40: 686f 6e5f 6b65 726e 656c 5f63 6f6e 736f  hon_kernel_conso
-0001df50: 6c65 5f6d 756c 7469 706c 655f 6578 6973  le_multiple_exis
-0001df60: 7469 6e67 5f31 2829 3a0a 2020 2020 2320  ting_1():.    # 
-0001df70: 5665 7269 6679 2074 6861 7420 6175 746f  Verify that auto
-0001df80: 696d 706f 7274 2061 6e64 2074 6162 2063  import and tab c
-0001df90: 6f6d 706c 6574 696f 6e20 776f 726b 2069  ompletion work i
-0001dfa0: 6e20 4950 7974 686f 6e20 636f 6e73 6f6c  n IPython consol
-0001dfb0: 652c 2077 6865 6e0a 2020 2020 2320 7468  e, when.    # th
-0001dfc0: 6520 6175 746f 2069 6d70 6f72 7465 7220  e auto importer 
-0001dfd0: 6973 2065 6e61 626c 6564 2066 726f 6d20  is enabled from 
-0001dfe0: 6120 6469 6666 6572 656e 7420 636f 6e73  a different cons
-0001dff0: 6f6c 652e 0a20 2020 2023 2053 7461 7274  ole..    # Start
-0001e000: 2022 4950 7974 686f 6e20 6b65 726e 656c   "IPython kernel
-0001e010: 222e 0a20 2020 2077 6974 6820 4950 7974  "..    with IPyt
-0001e020: 686f 6e4b 6572 6e65 6c43 7478 2829 2061  honKernelCtx() a
-0001e030: 7320 6b65 726e 656c 3a0a 2020 2020 2020  s kernel:.      
-0001e040: 2020 2320 5374 6172 7420 6120 7365 7061    # Start a sepa
-0001e050: 7261 7465 2022 6970 7974 686f 6e20 636f  rate "ipython co
-0001e060: 6e73 6f6c 6520 2d2d 6578 6973 7469 6e67  nsole --existing
-0001e070: 206b 6572 6e65 6c2d 3132 3334 2e6a 736f   kernel-1234.jso
-0001e080: 6e22 2e0a 2020 2020 2020 2020 2320 5665  n"..        # Ve
-0001e090: 7269 6679 2074 6861 7420 7468 6520 6175  rify that the au
-0001e0a0: 746f 2069 6d70 6f72 7465 7220 6973 6e27  to importer isn'
-0001e0b0: 7420 656e 6162 6c65 6420 7965 742e 0a20  t enabled yet.. 
-0001e0c0: 2020 2020 2020 2069 7079 7468 6f6e 280a         ipython(.
-0001e0d0: 2020 2020 2020 2020 2020 2020 2222 220a              """.
-0001e0e0: 2020 2020 2020 2020 2020 2020 496e 205b              In [
-0001e0f0: 315d 3a20 6236 3464 6563 6f64 6528 2778  1]: b64decode('x
-0001e100: 2729 0a20 2020 2020 2020 2020 2020 202d  ').            -
-0001e110: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001e120: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001e130: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001e140: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001e150: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-0001e160: 2020 2020 2020 204e 616d 6545 7272 6f72         NameError
-0001e170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e190: 2054 7261 6365 6261 636b 2028 6d6f 7374   Traceback (most
-0001e1a0: 2072 6563 656e 7420 6361 6c6c 206c 6173   recent call las
-0001e1b0: 7429 0a20 2020 2020 2020 2020 2020 202e  t).            .
-0001e1c0: 2e2e 2069 6e20 2e2e 2e0a 2020 2020 2020  .. in ....      
-0001e1d0: 2020 2020 2020 4e61 6d65 4572 726f 723a        NameError:
-0001e1e0: 206e 616d 6520 2762 3634 6465 636f 6465   name 'b64decode
-0001e1f0: 2720 6973 206e 6f74 2064 6566 696e 6564  ' is not defined
-0001e200: 0a20 2020 2020 2020 2022 2222 2c0a 2020  .        """,.  
-0001e210: 2020 2020 2020 2020 2020 6172 6773 3d5b            args=[
-0001e220: 2263 6f6e 736f 6c65 225d 2c0a 2020 2020  "console"],.    
-0001e230: 2020 2020 2020 2020 6b65 726e 656c 3d6b          kernel=k
-0001e240: 6572 6e65 6c2c 0a20 2020 2020 2020 2029  ernel,.        )
-0001e250: 0a20 2020 2020 2020 2023 2045 6e61 626c  .        # Enabl
-0001e260: 6520 7468 6520 6175 746f 2069 6d70 6f72  e the auto impor
-0001e270: 7465 722e 0a20 2020 2020 2020 2069 7079  ter..        ipy
-0001e280: 7468 6f6e 2822 2222 0a20 2020 2020 2020  thon(""".       
-0001e290: 2020 2020 2049 6e20 5b32 5d3a 2069 6d70       In [2]: imp
-0001e2a0: 6f72 7420 7079 666c 7962 793b 2070 7966  ort pyflyby; pyf
-0001e2b0: 6c79 6279 2e65 6e61 626c 655f 6175 746f  lyby.enable_auto
-0001e2c0: 5f69 6d70 6f72 7465 7228 290a 2020 2020  _importer().    
-0001e2d0: 2020 2020 2222 222c 2061 7267 733d 5b27      """, args=['
-0001e2e0: 636f 6e73 6f6c 6527 5d2c 206b 6572 6e65  console'], kerne
-0001e2f0: 6c3d 6b65 726e 656c 290a 2020 2020 2020  l=kernel).      
-0001e300: 2020 2320 5665 7269 6679 2074 6861 7420    # Verify that 
-0001e310: 7468 6520 6175 746f 2069 6d70 6f72 7465  the auto importe
-0001e320: 7220 616e 6420 7461 6220 636f 6d70 6c65  r and tab comple
-0001e330: 7469 6f6e 2077 6f72 6b2e 0a20 2020 2020  tion work..     
-0001e340: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
-0001e350: 2020 2020 2020 2020 2020 2049 6e20 5b33             In [3
-0001e360: 5d3a 2062 3634 6465 636f 5c74 6465 2827  ]: b64deco\tde('
-0001e370: 5957 7874 6232 356b 2729 0a20 2020 2020  YWxtb25k').     
-0001e380: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
-0001e390: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
-0001e3a0: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
-0001e3b0: 2020 2020 2020 2020 2020 4f75 745b 335d            Out[3]
-0001e3c0: 3a20 6227 616c 6d6f 6e64 270a 2020 2020  : b'almond'.    
-0001e3d0: 2020 2020 2222 222c 2061 7267 733d 5b27      """, args=['
-0001e3e0: 636f 6e73 6f6c 6527 5d2c 206b 6572 6e65  console'], kerne
-0001e3f0: 6c3d 6b65 726e 656c 290a 0a0a 4070 7974  l=kernel)...@pyt
-0001e400: 6573 742e 6d61 726b 2e73 6b69 7028 7265  est.mark.skip(re
-0001e410: 6173 6f6e 3d22 6861 6e67 7322 290a 4073  ason="hangs").@s
-0001e420: 6b69 7069 665f 6970 7974 686f 6e5f 746f  kipif_ipython_to
-0001e430: 6f5f 6f6c 645f 666f 725f 6b65 726e 656c  o_old_for_kernel
-0001e440: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
-0001e450: 5f69 7079 7468 6f6e 5f6e 6f74 6562 6f6f  _ipython_noteboo
-0001e460: 6b5f 6261 7369 635f 3128 293a 0a20 2020  k_basic_1():.   
-0001e470: 2077 6974 6820 4950 7974 686f 6e4e 6f74   with IPythonNot
-0001e480: 6562 6f6f 6b43 7478 2829 2061 7320 6b65  ebookCtx() as ke
-0001e490: 726e 656c 3a0a 2020 2020 2020 2020 6970  rnel:.        ip
-0001e4a0: 7974 686f 6e28 0a20 2020 2020 2020 2020  ython(.         
-0001e4b0: 2020 2023 2056 6572 6966 7920 7468 6174     # Verify that
-0001e4c0: 2074 6865 2061 7574 6f20 696d 706f 7274   the auto import
-0001e4d0: 6572 2069 736e 2774 2065 6e61 626c 6564  er isn't enabled
-0001e4e0: 2079 6574 2e0a 2020 2020 2020 2020 2020   yet..          
-0001e4f0: 2020 2222 220a 2020 2020 2020 2020 2020    """.          
-0001e500: 2020 496e 205b 315d 3a20 332b 340a 2020    In [1]: 3+4.  
-0001e510: 2020 2020 2020 2020 2020 4f75 745b 315d            Out[1]
-0001e520: 3a20 370a 2020 2020 2020 2020 2020 2020  : 7.            
-0001e530: 496e 205b 325d 3a20 3333 2b34 340a 2020  In [2]: 33+44.  
-0001e540: 2020 2020 2020 2020 2020 4f75 745b 325d            Out[2]
-0001e550: 3a20 3737 0a20 2020 2020 2020 2020 2020  : 77.           
-0001e560: 2022 2222 2c20 6172 6773 3d5b 2763 6f6e   """, args=['con
-0001e570: 736f 6c65 275d 2c20 6b65 726e 656c 3d6b  sole'], kernel=k
-0001e580: 6572 6e65 6c29 0a0a 4073 6b69 7069 665f  ernel)..@skipif_
-0001e590: 6970 7974 686f 6e5f 746f 6f5f 6f6c 645f  ipython_too_old_
-0001e5a0: 666f 725f 6b65 726e 656c 0a40 7079 7465  for_kernel.@pyte
-0001e5b0: 7374 2e6d 6172 6b2e 7866 6169 6c28 0a20  st.mark.xfail(. 
-0001e5c0: 2020 2073 7973 2e76 6572 7369 6f6e 5f69     sys.version_i
-0001e5d0: 6e66 6f5b 305d 203d 3d20 332c 0a20 2020  nfo[0] == 3,.   
-0001e5e0: 2072 6561 736f 6e3d 224e 6565 6420 6e65   reason="Need ne
-0001e5f0: 7765 7220 7665 7273 696f 6e20 6f66 206a  wer version of j
-0001e600: 7570 7974 6572 5f63 6f6e 736f 6c65 203e  upyter_console >
-0001e610: 2036 2e34 2e31 206d 6179 6265 203f 2043   6.4.1 maybe ? C
-0001e620: 6f72 6f75 7469 6e65 206e 6f74 2061 7761  oroutine not awa
-0001e630: 6974 6564 222c 0a20 2020 2073 7472 6963  ited",.    stric
-0001e640: 743d 4661 6c73 652c 0a29 0a40 7265 7472  t=False,.).@retr
-0001e650: 790a 6465 6620 7465 7374 5f69 7079 7468  y.def test_ipyth
-0001e660: 6f6e 5f6e 6f74 6562 6f6f 6b5f 3128 293a  on_notebook_1():
-0001e670: 0a20 2020 2077 6974 6820 4950 7974 686f  .    with IPytho
-0001e680: 6e4e 6f74 6562 6f6f 6b43 7478 2829 2061  nNotebookCtx() a
-0001e690: 7320 6b65 726e 656c 3a0a 2020 2020 2020  s kernel:.      
-0001e6a0: 2020 2320 312e 2056 6572 6966 7920 7468    # 1. Verify th
-0001e6b0: 6174 2074 6865 2061 7574 6f20 696d 706f  at the auto impo
-0001e6c0: 7274 6572 2069 736e 2774 2065 6e61 626c  rter isn't enabl
-0001e6d0: 6564 2079 6574 2e0a 2020 2020 2020 2020  ed yet..        
-0001e6e0: 2320 322e 2045 6e61 626c 6520 7468 6520  # 2. Enable the 
-0001e6f0: 6175 746f 2069 6d70 6f72 7465 722e 0a20  auto importer.. 
-0001e700: 2020 2020 2020 2023 2033 2e20 5665 7269         # 3. Veri
-0001e710: 6679 2074 6861 7420 7468 6520 6175 746f  fy that the auto
-0001e720: 2069 6d70 6f72 7465 7220 616e 6420 7461   importer and ta
-0001e730: 6220 636f 6d70 6c65 7469 6f6e 2077 6f72  b completion wor
-0001e740: 6b2e 0a20 2020 2020 2020 2069 7079 7468  k..        ipyth
-0001e750: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-0001e760: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-0001e770: 496e 205b 315d 3a20 6236 3464 6563 6f64  In [1]: b64decod
-0001e780: 6528 2778 2729 0a20 2020 2020 2020 2020  e('x').         
-0001e790: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     -------------
-0001e7a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001e7b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001e7c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001e7d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
-0001e7e0: 2020 2020 2020 2020 2020 204e 616d 6545             NameE
-0001e7f0: 7272 6f72 2020 2020 2020 2020 2020 2020  rror            
-0001e800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e810: 2020 2020 2054 7261 6365 6261 636b 2028       Traceback (
-0001e820: 6d6f 7374 2072 6563 656e 7420 6361 6c6c  most recent call
-0001e830: 206c 6173 7429 0a20 2020 2020 2020 2020   last).         
-0001e840: 2020 202e 2e2e 2069 6e20 2e2e 2e0a 2020     ... in ....  
-0001e850: 2020 2020 2020 2020 2020 4e61 6d65 4572            NameEr
-0001e860: 726f 723a 206e 616d 6520 2762 3634 6465  ror: name 'b64de
-0001e870: 636f 6465 2720 6973 206e 6f74 2064 6566  code' is not def
-0001e880: 696e 6564 0a20 2020 2020 2020 2020 2020  ined.           
-0001e890: 2049 6e20 5b32 5d3a 2069 6d70 6f72 7420   In [2]: import 
-0001e8a0: 7079 666c 7962 793b 2070 7966 6c79 6279  pyflyby; pyflyby
-0001e8b0: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
-0001e8c0: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
-0001e8d0: 2020 2020 496e 205b 335d 3a20 6236 3464      In [3]: b64d
-0001e8e0: 6563 6f5c 7464 6528 2761 4746 365a 5778  eco\tde('aGF6ZWx
-0001e8f0: 7564 5851 3d27 290a 2020 2020 2020 2020  udXQ=').        
-0001e900: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
-0001e910: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
-0001e920: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
-0001e930: 2020 2020 2020 204f 7574 5b33 5d3a 2062         Out[3]: b
-0001e940: 2768 617a 656c 6e75 7427 0a20 2020 2020  'hazelnut'.     
-0001e950: 2020 2020 2020 2022 2222 2c0a 2020 2020         """,.    
-0001e960: 2020 2020 2020 2020 6172 6773 3d5b 2263          args=["c
-0001e970: 6f6e 736f 6c65 225d 2c0a 2020 2020 2020  onsole"],.      
-0001e980: 2020 2020 2020 6b65 726e 656c 3d6b 6572        kernel=ker
-0001e990: 6e65 6c2c 0a20 2020 2020 2020 2029 0a0a  nel,.        )..
-0001e9a0: 0a40 736b 6970 6966 5f69 7079 7468 6f6e  .@skipif_ipython
-0001e9b0: 5f74 6f6f 5f6f 6c64 5f66 6f72 5f6b 6572  _too_old_for_ker
-0001e9c0: 6e65 6c0a 4070 7974 6573 742e 6d61 726b  nel.@pytest.mark
-0001e9d0: 2e78 6661 696c 280a 2020 2020 7379 732e  .xfail(.    sys.
-0001e9e0: 7665 7273 696f 6e5f 696e 666f 5b30 5d20  version_info[0] 
-0001e9f0: 3d3d 2033 2c0a 2020 2020 7265 6173 6f6e  == 3,.    reason
-0001ea00: 3d22 4e65 6564 206e 6577 6572 2076 6572  ="Need newer ver
-0001ea10: 7369 6f6e 206f 6620 6a75 7079 7465 725f  sion of jupyter_
-0001ea20: 636f 6e73 6f6c 6520 3e20 362e 342e 3120  console > 6.4.1 
-0001ea30: 6d61 7962 6520 3f20 436f 726f 7574 696e  maybe ? Coroutin
-0001ea40: 6520 6e6f 7420 6177 6169 7465 6422 2c0a  e not awaited",.
-0001ea50: 2020 2020 7374 7269 6374 3d46 616c 7365      strict=False
-0001ea60: 2c0a 290a 4072 6574 7279 0a64 6566 2074  ,.).@retry.def t
-0001ea70: 6573 745f 6970 7974 686f 6e5f 6e6f 7465  est_ipython_note
-0001ea80: 626f 6f6b 5f72 6563 6f6e 6e65 6374 5f31  book_reconnect_1
-0001ea90: 2829 3a0a 2020 2020 2320 5665 7269 6679  ():.    # Verify
-0001eaa0: 2074 6861 7420 7765 2063 616e 2072 6563   that we can rec
-0001eab0: 6f6e 6e65 6374 2074 6f20 7468 6520 7361  onnect to the sa
-0001eac0: 6d65 206b 6572 6e65 6c2c 2061 6e64 2070  me kernel, and p
-0001ead0: 7966 6c79 6279 2069 7320 7374 696c 6c0a  yflyby is still.
-0001eae0: 2020 2020 2320 656e 6162 6c65 642e 0a20      # enabled.. 
-0001eaf0: 2020 2077 6974 6820 4950 7974 686f 6e4e     with IPythonN
-0001eb00: 6f74 6562 6f6f 6b43 7478 2829 2061 7320  otebookCtx() as 
-0001eb10: 6b65 726e 656c 3a0a 2020 2020 2020 2020  kernel:.        
-0001eb20: 2320 5665 7269 6679 2074 6861 7420 7468  # Verify that th
-0001eb30: 6520 6175 746f 2069 6d70 6f72 7465 7220  e auto importer 
-0001eb40: 6973 6e27 7420 656e 6162 6c65 6420 7965  isn't enabled ye
-0001eb50: 742e 0a20 2020 2020 2020 2069 7079 7468  t..        ipyth
-0001eb60: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-0001eb70: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-0001eb80: 496e 205b 315d 3a20 6236 3464 6563 6f64  In [1]: b64decod
-0001eb90: 6528 2778 2729 0a20 2020 2020 2020 2020  e('x').         
-0001eba0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     -------------
-0001ebb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001ebc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001ebd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001ebe0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
-0001ebf0: 2020 2020 2020 2020 2020 204e 616d 6545             NameE
-0001ec00: 7272 6f72 2020 2020 2020 2020 2020 2020  rror            
-0001ec10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ec20: 2020 2020 2054 7261 6365 6261 636b 2028       Traceback (
-0001ec30: 6d6f 7374 2072 6563 656e 7420 6361 6c6c  most recent call
-0001ec40: 206c 6173 7429 0a20 2020 2020 2020 2020   last).         
-0001ec50: 2020 202e 2e2e 2069 6e20 2e2e 2e0a 2020     ... in ....  
-0001ec60: 2020 2020 2020 2020 2020 4e61 6d65 4572            NameEr
-0001ec70: 726f 723a 206e 616d 6520 2762 3634 6465  ror: name 'b64de
-0001ec80: 636f 6465 2720 6973 206e 6f74 2064 6566  code' is not def
-0001ec90: 696e 6564 0a20 2020 2020 2020 2022 2222  ined.        """
-0001eca0: 2c0a 2020 2020 2020 2020 2020 2020 6172  ,.            ar
-0001ecb0: 6773 3d5b 2263 6f6e 736f 6c65 225d 2c0a  gs=["console"],.
-0001ecc0: 2020 2020 2020 2020 2020 2020 6b65 726e              kern
-0001ecd0: 656c 3d6b 6572 6e65 6c2c 0a20 2020 2020  el=kernel,.     
-0001ece0: 2020 2029 0a20 2020 2020 2020 2023 2045     ).        # E
-0001ecf0: 6e61 626c 6520 7468 6520 6175 746f 2069  nable the auto i
-0001ed00: 6d70 6f72 7465 722e 0a20 2020 2020 2020  mporter..       
-0001ed10: 2069 7079 7468 6f6e 280a 2020 2020 2020   ipython(.      
-0001ed20: 2020 2222 220a 2020 2020 2020 2020 2020    """.          
-0001ed30: 2020 496e 205b 325d 3a20 696d 706f 7274    In [2]: import
-0001ed40: 2070 7966 6c79 6279 3b20 7079 666c 7962   pyflyby; pyflyb
-0001ed50: 792e 656e 6162 6c65 5f61 7574 6f5f 696d  y.enable_auto_im
-0001ed60: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
-0001ed70: 2022 2222 2c20 6172 6773 3d5b 2763 6f6e   """, args=['con
-0001ed80: 736f 6c65 275d 2c20 6b65 726e 656c 3d6b  sole'], kernel=k
-0001ed90: 6572 6e65 6c29 0a20 2020 2020 2020 2023  ernel).        #
-0001eda0: 2056 6572 6966 7920 7468 6174 2074 6865   Verify that the
-0001edb0: 2061 7574 6f20 696d 706f 7274 6572 2061   auto importer a
-0001edc0: 6e64 2074 6162 2063 6f6d 706c 6574 696f  nd tab completio
-0001edd0: 6e20 776f 726b 2e0a 2020 2020 2020 2020  n work..        
-0001ede0: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
-0001edf0: 2020 2020 2020 2020 496e 205b 335d 3a20          In [3]: 
-0001ee00: 6236 3464 6563 6f5c 7464 6528 2761 4746  b64deco\tde('aGF
-0001ee10: 365a 5778 7564 5851 3d27 290a 2020 2020  6ZWxudXQ=').    
-0001ee20: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
-0001ee30: 5d20 6672 6f6d 2062 6173 6536 3420 696d  ] from base64 im
-0001ee40: 706f 7274 2062 3634 6465 636f 6465 0a20  port b64decode. 
-0001ee50: 2020 2020 2020 2020 2020 204f 7574 5b33             Out[3
-0001ee60: 5d3a 2062 2768 617a 656c 6e75 7427 0a20  ]: b'hazelnut'. 
-0001ee70: 2020 2020 2020 2022 2222 2c20 6172 6773         """, args
-0001ee80: 3d5b 2763 6f6e 736f 6c65 275d 2c20 6b65  =['console'], ke
-0001ee90: 726e 656c 3d6b 6572 6e65 6c29 0a0a 0a40  rnel=kernel)...@
-0001eea0: 7265 7472 790a 6465 6620 7465 7374 5f70  retry.def test_p
-0001eeb0: 795f 696e 7465 7261 6374 6976 655f 3128  y_interactive_1(
-0001eec0: 293a 0a20 2020 2023 2056 6572 6966 7920  ):.    # Verify 
-0001eed0: 7468 6174 2027 7079 2720 656e 6162 6c65  that 'py' enable
-0001eee0: 7320 7079 666c 7962 7920 6175 746f 696d  s pyflyby autoim
-0001eef0: 706f 7274 6572 2061 7420 7374 6172 742e  porter at start.
-0001ef00: 0a20 2020 2069 7079 7468 6f6e 2822 2222  .    ipython("""
-0001ef10: 0a20 2020 2020 2020 2049 6e20 5b31 5d3a  .        In [1]:
-0001ef20: 2062 3634 6465 636f 5c74 6465 2827 6347   b64deco\tde('cG
-0001ef30: 6c7a 6447 466a 6147 6c76 2729 0a20 2020  lzdGFjaGlv').   
-0001ef40: 2020 2020 205b 5059 464c 5942 595d 2066       [PYFLYBY] f
-0001ef50: 726f 6d20 6261 7365 3634 2069 6d70 6f72  rom base64 impor
-0001ef60: 7420 6236 3464 6563 6f64 650a 2020 2020  t b64decode.    
-0001ef70: 2020 2020 4f75 745b 315d 3a20 6227 7069      Out[1]: b'pi
-0001ef80: 7374 6163 6869 6f27 0a20 2020 2022 2222  stachio'.    """
-0001ef90: 2c20 7072 6f67 3d22 7079 2229 0a0a 0a40  , prog="py")...@
-0001efa0: 7265 7472 790a 6465 6620 7465 7374 5f70  retry.def test_p
-0001efb0: 795f 695f 696e 7465 7261 6374 6976 655f  y_i_interactive_
-0001efc0: 3128 746d 7029 3a0a 2020 2020 2320 5465  1(tmp):.    # Te
-0001efd0: 7374 2074 6861 7420 2770 7920 2d69 2720  st that 'py -i' 
-0001efe0: 696e 6974 6961 6c69 7a65 7320 4950 7974  initializes IPyt
-0001eff0: 686f 6e20 6265 666f 7265 2072 756e 6e69  hon before runni
-0001f000: 6e67 2074 6865 2063 6f6d 6d61 6e64 6c69  ng the commandli
-0001f010: 6e65 0a20 2020 2023 2063 6f64 652e 0a20  ne.    # code.. 
-0001f020: 2020 2023 2028 5468 6520 636f 6e76 6572     # (The conver
-0001f030: 7365 2069 7320 7465 7374 6564 2062 7920  se is tested by 
-0001f040: 7465 7374 5f70 792e 7079 3a74 6573 745f  test_py.py:test_
-0001f050: 6e6f 5f69 7079 7468 6f6e 5f66 6f72 5f65  no_ipython_for_e
-0001f060: 7661 6c5f 312e 290a 2020 2020 7772 6974  val_1.).    writ
-0001f070: 6574 6578 7428 746d 702e 6469 7220 2f20  etext(tmp.dir / 
-0001f080: 226d 3332 3632 3231 3637 2e70 7922 2c20  "m32622167.py", 
-0001f090: 2222 220a 2020 2020 2020 2020 696d 706f  """.        impo
-0001f0a0: 7274 2070 7966 6c79 6279 0a20 2020 2020  rt pyflyby.     
-0001f0b0: 2020 2069 7079 7468 6f6e 5f61 7070 203d     ipython_app =
-0001f0c0: 2070 7966 6c79 6279 2e5f 696e 7465 7261   pyflyby._intera
-0001f0d0: 6374 6976 652e 5f67 6574 5f69 7079 7468  ctive._get_ipyth
-0001f0e0: 6f6e 5f61 7070 2829 0a20 2020 2022 2222  on_app().    """
-0001f0f0: 290a 2020 2020 6970 7974 686f 6e28 2222  ).    ipython(""
-0001f100: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
-0001f110: 3a20 626f 6f6c 286d 3332 3632 3231 3637  : bool(m32622167
-0001f120: 2e69 7079 7468 6f6e 5f61 7070 290a 2020  .ipython_app).  
-0001f130: 2020 2020 2020 4f75 745b 315d 3a20 5472        Out[1]: Tr
-0001f140: 7565 0a20 2020 2022 2222 2c20 7072 6f67  ue.    """, prog
-0001f150: 3d22 7079 222c 2061 7267 733d 5b27 2d69  ="py", args=['-i
-0001f160: 272c 2027 696d 706f 7274 206d 3332 3632  ', 'import m3262
-0001f170: 3231 3637 275d 2c20 5059 5448 4f4e 5041  2167'], PYTHONPA
-0001f180: 5448 3d74 6d70 2e64 6972 290a 0a0a 4073  TH=tmp.dir)...@s
-0001f190: 6b69 7069 665f 6970 7974 686f 6e5f 746f  kipif_ipython_to
-0001f1a0: 6f5f 6f6c 645f 666f 725f 6b65 726e 656c  o_old_for_kernel
-0001f1b0: 0a40 7079 7465 7374 2e6d 6172 6b2e 7866  .@pytest.mark.xf
-0001f1c0: 6169 6c28 0a20 2020 2073 7973 2e76 6572  ail(.    sys.ver
-0001f1d0: 7369 6f6e 5f69 6e66 6f5b 305d 203d 3d20  sion_info[0] == 
-0001f1e0: 332c 0a20 2020 2072 6561 736f 6e3d 224e  3,.    reason="N
-0001f1f0: 6565 6420 6e65 7765 7220 7665 7273 696f  eed newer versio
-0001f200: 6e20 6f66 206a 7570 7974 6572 5f63 6f6e  n of jupyter_con
-0001f210: 736f 6c65 203e 2036 2e34 2e31 206d 6179  sole > 6.4.1 may
-0001f220: 6265 203f 2043 6f72 6f75 7469 6e65 206e  be ? Coroutine n
-0001f230: 6f74 2061 7761 6974 6564 222c 0a20 2020  ot awaited",.   
-0001f240: 2073 7472 6963 743d 4661 6c73 652c 0a29   strict=False,.)
-0001f250: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
-0001f260: 5f70 795f 636f 6e73 6f6c 655f 3128 293a  _py_console_1():
-0001f270: 0a20 2020 2023 2056 6572 6966 7920 7468  .    # Verify th
-0001f280: 6174 2027 7079 2063 6f6e 736f 6c65 2720  at 'py console' 
-0001f290: 776f 726b 732e 0a20 2020 2069 7079 7468  works..    ipyth
-0001f2a0: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
-0001f2b0: 6e20 5b31 5d3a 2062 3634 6465 636f 5c74  n [1]: b64deco\t
-0001f2c0: 6465 2827 6432 4673 626e 5630 2729 0a20  de('d2FsbnV0'). 
-0001f2d0: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
-0001f2e0: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
-0001f2f0: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
-0001f300: 2020 2020 2020 4f75 745b 315d 3a20 6227        Out[1]: b'
-0001f310: 7761 6c6e 7574 270a 2020 2020 2222 222c  walnut'.    """,
-0001f320: 2070 726f 673d 2270 7922 2c20 6172 6773   prog="py", args
-0001f330: 3d5b 2763 6f6e 736f 6c65 275d 290a 0a0a  =['console'])...
-0001f340: 4073 6b69 7069 665f 6970 7974 686f 6e5f  @skipif_ipython_
-0001f350: 746f 6f5f 6f6c 645f 666f 725f 6b65 726e  too_old_for_kern
-0001f360: 656c 0a40 7079 7465 7374 2e6d 6172 6b2e  el.@pytest.mark.
-0001f370: 7866 6169 6c28 0a20 2020 2073 7973 2e76  xfail(.    sys.v
-0001f380: 6572 7369 6f6e 5f69 6e66 6f5b 305d 203d  ersion_info[0] =
-0001f390: 3d20 332c 0a20 2020 2072 6561 736f 6e3d  = 3,.    reason=
-0001f3a0: 224e 6565 6420 6e65 7765 7220 7665 7273  "Need newer vers
-0001f3b0: 696f 6e20 6f66 206a 7570 7974 6572 5f63  ion of jupyter_c
-0001f3c0: 6f6e 736f 6c65 203e 2036 2e34 2e31 206d  onsole > 6.4.1 m
-0001f3d0: 6179 6265 203f 2043 6f72 6f75 7469 6e65  aybe ? Coroutine
-0001f3e0: 206e 6f74 2061 7761 6974 6564 222c 0a20   not awaited",. 
-0001f3f0: 2020 2073 7472 6963 743d 4661 6c73 652c     strict=False,
-0001f400: 0a29 0a40 7265 7472 790a 6465 6620 7465  .).@retry.def te
-0001f410: 7374 5f70 795f 6b65 726e 656c 5f31 2829  st_py_kernel_1()
-0001f420: 3a0a 2020 2020 2320 5665 7269 6679 2074  :.    # Verify t
-0001f430: 6861 7420 2770 7920 6b65 726e 656c 2720  hat 'py kernel' 
-0001f440: 776f 726b 732e 0a20 2020 2077 6974 6820  works..    with 
-0001f450: 4950 7974 686f 6e4b 6572 6e65 6c43 7478  IPythonKernelCtx
-0001f460: 2870 726f 673d 2270 7922 2920 6173 206b  (prog="py") as k
-0001f470: 6572 6e65 6c3a 0a20 2020 2020 2020 2023  ernel:.        #
-0001f480: 2052 756e 2069 7079 7468 6f6e 2063 6f6e   Run ipython con
-0001f490: 736f 6c65 2e20 204e 6f74 6520 7468 6174  sole.  Note that
-0001f4a0: 2077 6520 646f 6e27 7420 6e65 6564 2074   we don't need t
-0001f4b0: 6f20 7573 6520 7072 6f67 3d27 7079 2720  o use prog='py' 
-0001f4c0: 6865 7265 2c0a 2020 2020 2020 2020 2320  here,.        # 
-0001f4d0: 6173 2074 6865 2061 7574 6f69 6d70 6f72  as the autoimpor
-0001f4e0: 7420 2620 636f 6d70 6c65 7469 6f6e 2069  t & completion i
-0001f4f0: 7320 6120 7072 6f70 6572 7479 206f 6620  s a property of 
-0001f500: 7468 6520 6b65 726e 656c 2e0a 2020 2020  the kernel..    
-0001f510: 2020 2020 6970 7974 686f 6e28 2222 220a      ipython(""".
-0001f520: 2020 2020 2020 2020 2020 2020 496e 205b              In [
-0001f530: 315d 3a20 6236 3464 6563 6f5c 7464 6528  1]: b64deco\tde(
-0001f540: 2762 5746 6a59 5752 6862 576c 6827 290a  'bWFjYWRhbWlh').
-0001f550: 2020 2020 2020 2020 2020 2020 5b50 5946              [PYF
-0001f560: 4c59 4259 5d20 6672 6f6d 2062 6173 6536  LYBY] from base6
-0001f570: 3420 696d 706f 7274 2062 3634 6465 636f  4 import b64deco
-0001f580: 6465 0a20 2020 2020 2020 2020 2020 204f  de.            O
-0001f590: 7574 5b31 5d3a 2062 276d 6163 6164 616d  ut[1]: b'macadam
-0001f5a0: 6961 270a 2020 2020 2020 2020 2222 222c  ia'.        """,
-0001f5b0: 2061 7267 733d 5b27 636f 6e73 6f6c 6527   args=['console'
-0001f5c0: 5d2c 206b 6572 6e65 6c3d 6b65 726e 656c  ], kernel=kernel
-0001f5d0: 290a 0a0a 4073 6b69 7069 665f 6970 7974  )...@skipif_ipyt
-0001f5e0: 686f 6e5f 746f 6f5f 6f6c 645f 666f 725f  hon_too_old_for_
-0001f5f0: 6b65 726e 656c 0a40 7079 7465 7374 2e6d  kernel.@pytest.m
-0001f600: 6172 6b2e 7866 6169 6c28 0a20 2020 2073  ark.xfail(.    s
-0001f610: 7973 2e76 6572 7369 6f6e 5f69 6e66 6f5b  ys.version_info[
-0001f620: 305d 203d 3d20 332c 0a20 2020 2072 6561  0] == 3,.    rea
-0001f630: 736f 6e3d 224e 6565 6420 6e65 7765 7220  son="Need newer 
-0001f640: 7665 7273 696f 6e20 6f66 206a 7570 7974  version of jupyt
-0001f650: 6572 5f63 6f6e 736f 6c65 203e 2036 2e34  er_console > 6.4
-0001f660: 2e31 206d 6179 6265 203f 2043 6f72 6f75  .1 maybe ? Corou
-0001f670: 7469 6e65 206e 6f74 2061 7761 6974 6564  tine not awaited
-0001f680: 222c 0a20 2020 2073 7472 6963 743d 4661  ",.    strict=Fa
-0001f690: 6c73 652c 0a29 0a40 7265 7472 790a 6465  lse,.).@retry.de
-0001f6a0: 6620 7465 7374 5f70 795f 636f 6e73 6f6c  f test_py_consol
-0001f6b0: 655f 6578 6973 7469 6e67 5f31 2829 3a0a  e_existing_1():.
-0001f6c0: 2020 2020 2320 5665 7269 6679 2074 6861      # Verify tha
-0001f6d0: 7420 2770 7920 636f 6e73 6f6c 6527 2077  t 'py console' w
-0001f6e0: 6f72 6b73 2061 7320 7573 7561 6c20 286e  orks as usual (n
-0001f6f0: 6f20 6578 7472 6120 6675 6e63 7469 6f6e  o extra function
-0001f700: 616c 6974 790a 2020 2020 2320 6578 7065  ality.    # expe
-0001f710: 6374 6564 206f 7665 7220 7265 6775 6c61  cted over regula
-0001f720: 7220 6970 7974 686f 6e20 636f 6e73 6f6c  r ipython consol
-0001f730: 652c 2062 7574 206a 7573 7420 6368 6563  e, but just chec
-0001f740: 6b20 7468 6174 2069 7420 7374 696c 6c0a  k that it still.
-0001f750: 2020 2020 2320 776f 726b 7320 6e6f 726d      # works norm
-0001f760: 616c 6c79 292e 0a20 2020 2077 6974 6820  ally)..    with 
-0001f770: 4950 7974 686f 6e4b 6572 6e65 6c43 7478  IPythonKernelCtx
-0001f780: 2829 2061 7320 6b65 726e 656c 3a0a 2020  () as kernel:.  
-0001f790: 2020 2020 2020 6970 7974 686f 6e28 0a20        ipython(. 
-0001f7a0: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
-0001f7b0: 2020 2020 2020 2020 2020 2049 6e20 5b31             In [1
-0001f7c0: 5d3a 2062 3634 6465 636f 6465 2827 7827  ]: b64decode('x'
-0001f7d0: 290a 2020 2020 2020 2020 2020 2020 2d2d  ).            --
-0001f7e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001f7f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001f800: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001f810: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001f820: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-0001f830: 2020 2020 2020 4e61 6d65 4572 726f 7220        NameError 
-0001f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f860: 5472 6163 6562 6163 6b20 286d 6f73 7420  Traceback (most 
-0001f870: 7265 6365 6e74 2063 616c 6c20 6c61 7374  recent call last
-0001f880: 290a 2020 2020 2020 2020 2020 2020 2e2e  ).            ..
-0001f890: 2e20 696e 202e 2e2e 0a20 2020 2020 2020  . in ....       
-0001f8a0: 2020 2020 204e 616d 6545 7272 6f72 3a20       NameError: 
-0001f8b0: 6e61 6d65 2027 6236 3464 6563 6f64 6527  name 'b64decode'
-0001f8c0: 2069 7320 6e6f 7420 6465 6669 6e65 640a   is not defined.
-0001f8d0: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
-0001f8e0: 2020 2020 2020 2020 2070 726f 673d 2270           prog="p
-0001f8f0: 7922 2c0a 2020 2020 2020 2020 2020 2020  y",.            
-0001f900: 6172 6773 3d5b 2263 6f6e 736f 6c65 225d  args=["console"]
-0001f910: 2c0a 2020 2020 2020 2020 2020 2020 6b65  ,.            ke
-0001f920: 726e 656c 3d6b 6572 6e65 6c2c 0a20 2020  rnel=kernel,.   
-0001f930: 2020 2020 2029 0a0a 0a40 736b 6970 6966       )...@skipif
-0001f940: 5f69 7079 7468 6f6e 5f74 6f6f 5f6f 6c64  _ipython_too_old
-0001f950: 5f66 6f72 5f6b 6572 6e65 6c0a 4070 7974  _for_kernel.@pyt
-0001f960: 6573 742e 6d61 726b 2e78 6661 696c 280a  est.mark.xfail(.
-0001f970: 2020 2020 7379 732e 7665 7273 696f 6e5f      sys.version_
-0001f980: 696e 666f 5b30 5d20 3d3d 2033 2c0a 2020  info[0] == 3,.  
-0001f990: 2020 7265 6173 6f6e 3d22 4e65 6564 206e    reason="Need n
-0001f9a0: 6577 6572 2076 6572 7369 6f6e 206f 6620  ewer version of 
-0001f9b0: 6a75 7079 7465 725f 636f 6e73 6f6c 6520  jupyter_console 
-0001f9c0: 3e20 362e 342e 3120 6d61 7962 6520 3f20  > 6.4.1 maybe ? 
-0001f9d0: 436f 726f 7574 696e 6520 6e6f 7420 6177  Coroutine not aw
-0001f9e0: 6169 7465 6422 2c0a 2020 2020 7374 7269  aited",.    stri
-0001f9f0: 6374 3d46 616c 7365 2c0a 290a 4072 6574  ct=False,.).@ret
-0001fa00: 7279 0a64 6566 2074 6573 745f 7079 5f6e  ry.def test_py_n
-0001fa10: 6f74 6562 6f6f 6b5f 3128 293a 0a20 2020  otebook_1():.   
-0001fa20: 2077 6974 6820 4950 7974 686f 6e4e 6f74   with IPythonNot
-0001fa30: 6562 6f6f 6b43 7478 2870 726f 673d 2270  ebookCtx(prog="p
-0001fa40: 7922 2920 6173 206b 6572 6e65 6c3a 0a20  y") as kernel:. 
-0001fa50: 2020 2020 2020 2023 2056 6572 6966 7920         # Verify 
-0001fa60: 7468 6174 2074 6865 2061 7574 6f20 696d  that the auto im
-0001fa70: 706f 7274 6572 2061 6e64 2074 6162 2063  porter and tab c
-0001fa80: 6f6d 706c 6574 696f 6e20 776f 726b 2e0a  ompletion work..
-0001fa90: 2020 2020 2020 2020 6970 7974 686f 6e28          ipython(
-0001faa0: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-0001fab0: 496e 205b 315d 3a20 6236 3464 6563 6f5c  In [1]: b64deco\
-0001fac0: 7464 6528 2759 3246 7a61 4756 3327 290a  tde('Y2FzaGV3').
-0001fad0: 2020 2020 2020 2020 2020 2020 5b50 5946              [PYF
-0001fae0: 4c59 4259 5d20 6672 6f6d 2062 6173 6536  LYBY] from base6
-0001faf0: 3420 696d 706f 7274 2062 3634 6465 636f  4 import b64deco
-0001fb00: 6465 0a20 2020 2020 2020 2020 2020 204f  de.            O
-0001fb10: 7574 5b31 5d3a 2062 2763 6173 6865 7727  ut[1]: b'cashew'
-0001fb20: 0a20 2020 2020 2020 2022 2222 2c20 6172  .        """, ar
-0001fb30: 6773 3d5b 2763 6f6e 736f 6c65 275d 2c20  gs=['console'], 
-0001fb40: 6b65 726e 656c 3d6b 6572 6e65 6c29 0a0a  kernel=kernel)..
-0001fb50: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
-0001fb60: 5f70 795f 6469 7361 626c 655f 3128 293a  _py_disable_1():
-0001fb70: 0a20 2020 2023 2056 6572 6966 7920 7468  .    # Verify th
-0001fb80: 6174 2077 6865 6e20 7573 696e 6720 2770  at when using 'p
-0001fb90: 7927 2c20 7765 2063 616e 2064 6973 6162  y', we can disab
-0001fba0: 6c65 2074 6865 2061 7574 6f69 6d70 6f72  le the autoimpor
-0001fbb0: 7465 722c 2061 6e64 0a20 2020 2023 2061  ter, and.    # a
-0001fbc0: 6c73 6f20 7265 2d65 6e61 626c 6520 6974  lso re-enable it
-0001fbd0: 2e0a 2020 2020 6970 7974 686f 6e28 0a20  ..    ipython(. 
-0001fbe0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001fbf0: 2020 2049 6e20 5b31 5d3a 2062 3634 6465     In [1]: b64de
-0001fc00: 636f 5c74 6465 2827 6147 6c6a 6132 3979  co\tde('aGlja29y
-0001fc10: 6551 3d3d 2729 0a20 2020 2020 2020 205b  eQ==').        [
-0001fc20: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
-0001fc30: 7365 3634 2069 6d70 6f72 7420 6236 3464  se64 import b64d
-0001fc40: 6563 6f64 650a 2020 2020 2020 2020 4f75  ecode.        Ou
-0001fc50: 745b 315d 3a20 6227 6869 636b 6f72 7927  t[1]: b'hickory'
-0001fc60: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
-0001fc70: 2070 7966 6c79 6279 2e64 6973 6162 6c65   pyflyby.disable
-0001fc80: 5f61 7574 6f5f 696d 706f 7274 6572 2829  _auto_importer()
-0001fc90: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
-0001fca0: 595d 2069 6d70 6f72 7420 7079 666c 7962  Y] import pyflyb
-0001fcb0: 790a 2020 2020 2020 2020 496e 205b 335d  y.        In [3]
-0001fcc0: 3a20 6236 3465 6e63 6f64 6528 6227 7827  : b64encode(b'x'
-0001fcd0: 290a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ).        ------
-0001fce0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001fcf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001fd00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001fd10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001fd20: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4e61  -----.        Na
-0001fd30: 6d65 4572 726f 7220 2020 2020 2020 2020  meError         
-0001fd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fd50: 2020 2020 2020 2020 5472 6163 6562 6163          Tracebac
-0001fd60: 6b20 286d 6f73 7420 7265 6365 6e74 2063  k (most recent c
-0001fd70: 616c 6c20 6c61 7374 290a 2020 2020 2020  all last).      
-0001fd80: 2020 2e2e 2e20 696e 202e 2e2e 0a20 2020    ... in ....   
-0001fd90: 2020 2020 204e 616d 6545 7272 6f72 3a20       NameError: 
-0001fda0: 6e61 6d65 2027 6236 3465 6e63 6f64 6527  name 'b64encode'
-0001fdb0: 2069 7320 6e6f 7420 6465 6669 6e65 640a   is not defined.
-0001fdc0: 2020 2020 2020 2020 496e 205b 345d 3a20          In [4]: 
-0001fdd0: 6236 3464 6563 6f64 6528 2762 5739 6a61  b64decode('bW9ja
-0001fde0: 3256 7962 6e56 3027 290a 2020 2020 2020  2VybnV0').      
-0001fdf0: 2020 4f75 745b 345d 3a20 6227 6d6f 636b    Out[4]: b'mock
-0001fe00: 6572 6e75 7427 0a20 2020 2020 2020 2049  ernut'.        I
-0001fe10: 6e20 5b35 5d3a 2070 7966 6c79 6279 2e65  n [5]: pyflyby.e
-0001fe20: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
-0001fe30: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
-0001fe40: 205b 365d 3a20 6236 3465 6e63 6f64 6528   [6]: b64encode(
-0001fe50: 6227 7065 6361 6e27 290a 2020 2020 2020  b'pecan').      
-0001fe60: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
-0001fe70: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
-0001fe80: 3634 656e 636f 6465 0a20 2020 2020 2020  64encode.       
-0001fe90: 204f 7574 5b36 5d3a 2062 2763 4756 6a59   Out[6]: b'cGVjY
-0001fea0: 5734 3d27 0a20 2020 2022 2222 2c0a 2020  W4='.    """,.  
-0001feb0: 2020 2020 2020 7072 6f67 3d22 7079 222c        prog="py",
-0001fec0: 0a20 2020 2029 0a0a 0a64 6566 205f 696e  .    )...def _in
-0001fed0: 7374 616c 6c5f 6c6f 6164 5f65 7874 5f70  stall_load_ext_p
-0001fee0: 7966 6c79 6279 5f69 6e5f 636f 6e66 6967  yflyby_in_config
-0001fef0: 2869 7079 7468 6f6e 5f64 6972 293a 0a20  (ipython_dir):. 
-0001ff00: 2020 2077 6974 6820 6f70 656e 2873 7472     with open(str
-0001ff10: 2869 7079 7468 6f6e 5f64 6972 2f22 7072  (ipython_dir/"pr
-0001ff20: 6f66 696c 655f 6465 6661 756c 742f 6970  ofile_default/ip
-0001ff30: 7974 686f 6e5f 636f 6e66 6967 2e70 7922  ython_config.py"
-0001ff40: 292c 2027 6127 2920 6173 2066 3a0a 2020  ), 'a') as f:.  
-0001ff50: 2020 2020 2020 7072 696e 7428 2763 2e49        print('c.I
-0001ff60: 6e74 6572 6163 7469 7665 5368 656c 6c41  nteractiveShellA
-0001ff70: 7070 2e65 7874 656e 7369 6f6e 732e 6170  pp.extensions.ap
-0001ff80: 7065 6e64 2822 7079 666c 7962 7922 2927  pend("pyflyby")'
-0001ff90: 2c20 6669 6c65 3d66 290a 0a0a 4072 6574  , file=f)...@ret
-0001ffa0: 7279 0a64 6566 2074 6573 745f 696e 7374  ry.def test_inst
-0001ffb0: 616c 6c65 645f 696e 5f63 6f6e 6669 675f  alled_in_config_
-0001ffc0: 6970 7974 686f 6e5f 636d 646c 696e 655f  ipython_cmdline_
-0001ffd0: 3128 746d 7029 3a0a 2020 2020 2320 5665  1(tmp):.    # Ve
-0001ffe0: 7269 6679 2074 6861 7420 6175 746f 696d  rify that autoim
-0001fff0: 706f 7274 2077 6f72 6b73 2069 6e20 2769  port works in 'i
-00020000: 7079 7468 6f6e 2720 7768 656e 2070 7966  python' when pyf
-00020010: 6c79 6279 2069 7320 696e 7374 616c 6c65  lyby is installe
-00020020: 6420 696e 0a20 2020 2023 2069 7079 7468  d in.    # ipyth
-00020030: 6f6e 5f63 6f6e 6669 672e 0a20 2020 205f  on_config..    _
-00020040: 696e 7374 616c 6c5f 6c6f 6164 5f65 7874  install_load_ext
-00020050: 5f70 7966 6c79 6279 5f69 6e5f 636f 6e66  _pyflyby_in_conf
-00020060: 6967 2874 6d70 2e69 7079 7468 6f6e 5f64  ig(tmp.ipython_d
-00020070: 6972 290a 2020 2020 6970 7974 686f 6e28  ir).    ipython(
-00020080: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-00020090: 315d 3a20 6236 3464 6563 6f5c 7464 6528  1]: b64deco\tde(
-000200a0: 2762 5746 7762 4755 3d27 290a 2020 2020  'bWFwbGU=').    
-000200b0: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
-000200c0: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
-000200d0: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
-000200e0: 2020 204f 7574 5b31 5d3a 2062 276d 6170     Out[1]: b'map
-000200f0: 6c65 270a 2020 2020 2222 222c 2069 7079  le'.    """, ipy
-00020100: 7468 6f6e 5f64 6972 3d74 6d70 2e69 7079  thon_dir=tmp.ipy
-00020110: 7468 6f6e 5f64 6972 290a 2020 2020 2320  thon_dir).    # 
-00020120: 446f 7562 6c65 2d63 6865 636b 2074 6861  Double-check tha
-00020130: 7420 7765 206f 6e6c 7920 6d6f 6469 6669  t we only modifi
-00020140: 6564 2074 6d70 2e69 7079 7468 6f6e 5f64  ed tmp.ipython_d
-00020150: 6972 2e0a 2020 2020 6970 7974 686f 6e28  ir..    ipython(
-00020160: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00020170: 2020 2020 2049 6e20 5b31 5d3a 2062 3634       In [1]: b64
-00020180: 6465 636f 6465 2827 7827 290a 2020 2020  decode('x').    
-00020190: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
-000201a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000201b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000201c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000201d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
-000201e0: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
-000201f0: 7220 2020 2020 2020 2020 2020 2020 2020  r               
-00020200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020210: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
-00020220: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
-00020230: 7374 290a 2020 2020 2020 2020 2e2e 2e20  st).        ... 
-00020240: 696e 202e 2e2e 0a20 2020 2020 2020 204e  in ....        N
-00020250: 616d 6545 7272 6f72 3a20 6e61 6d65 2027  ameError: name '
-00020260: 6236 3464 6563 6f64 6527 2069 7320 6e6f  b64decode' is no
-00020270: 7420 6465 6669 6e65 640a 2020 2020 2222  t defined.    ""
-00020280: 220a 2020 2020 290a 0a0a 4072 6574 7279  ".    )...@retry
-00020290: 0a64 6566 2074 6573 745f 696e 7374 616c  .def test_instal
-000202a0: 6c65 645f 696e 5f63 6f6e 6669 675f 7265  led_in_config_re
-000202b0: 6475 6e64 616e 745f 3128 746d 7029 3a0a  dundant_1(tmp):.
-000202c0: 2020 2020 2320 5665 7269 6679 2074 6861      # Verify tha
-000202d0: 7420 7265 6475 6e64 616e 7420 696e 7374  t redundant inst
-000202e0: 616c 6c61 7469 6f6e 7320 6172 6520 6669  allations are fi
-000202f0: 6e65 2e0a 2020 2020 5f69 6e73 7461 6c6c  ne..    _install
-00020300: 5f6c 6f61 645f 6578 745f 7079 666c 7962  _load_ext_pyflyb
-00020310: 795f 696e 5f63 6f6e 6669 6728 746d 702e  y_in_config(tmp.
-00020320: 6970 7974 686f 6e5f 6469 7229 0a20 2020  ipython_dir).   
-00020330: 205f 696e 7374 616c 6c5f 6c6f 6164 5f65   _install_load_e
-00020340: 7874 5f70 7966 6c79 6279 5f69 6e5f 636f  xt_pyflyby_in_co
-00020350: 6e66 6967 2874 6d70 2e69 7079 7468 6f6e  nfig(tmp.ipython
-00020360: 5f64 6972 290a 2020 2020 6970 7974 686f  _dir).    ipytho
-00020370: 6e28 2222 220a 2020 2020 2020 2020 496e  n(""".        In
+00014610: 2062 6173 6536 342e 6236 3464 6563 6f64   base64.b64decod
+00014620: 6528 2762 5739 7564 486b 3d27 290a 2020  e('bW9udHk=').  
+00014630: 2020 2020 2020 4f75 745b 325d 3a20 6227        Out[2]: b'
+00014640: 6d6f 6e74 7927 0a20 2020 2022 2222 2c20  monty'.    """, 
+00014650: 6672 6f6e 7465 6e64 3d66 726f 6e74 656e  frontend=fronten
+00014660: 6429 0a0a 0a40 7265 7472 790a 6465 6620  d)...@retry.def 
+00014670: 7465 7374 5f63 6f6d 706c 6574 655f 7379  test_complete_sy
+00014680: 6d62 6f6c 5f6d 656d 6265 725f 6d75 6c74  mbol_member_mult
+00014690: 6970 6c65 5f31 2866 726f 6e74 656e 6429  iple_1(frontend)
+000146a0: 3a0a 2020 2020 6966 2066 726f 6e74 656e  :.    if fronten
+000146b0: 6420 3d3d 2022 7072 6f6d 7074 5f74 6f6f  d == "prompt_too
+000146c0: 6c6b 6974 223a 0a20 2020 2020 2020 2070  lkit":.        p
+000146d0: 7974 6573 742e 736b 6970 2829 0a20 2020  ytest.skip().   
+000146e0: 2069 7079 7468 6f6e 280a 2020 2020 2020   ipython(.      
+000146f0: 2020 2222 220a 2020 2020 2020 2020 496e    """.        In
+00014700: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
+00014710: 6c79 6279 3b20 7079 666c 7962 792e 656e  lyby; pyflyby.en
+00014720: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
+00014730: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
+00014740: 5b32 5d3a 2070 7269 6e74 2862 6173 6536  [2]: print(base6
+00014750: 342e 6236 345c 740a 2020 2020 2020 2020  4.b64\t.        
+00014760: 5b50 5946 4c59 4259 5d20 696d 706f 7274  [PYFLYBY] import
+00014770: 2062 6173 6536 340a 2020 2020 2020 2020   base64.        
+00014780: 496e 205b 325d 3a20 7072 696e 7428 6261  In [2]: print(ba
+00014790: 7365 3634 2e62 3634 0a20 2020 2020 2020  se64.b64.       
+000147a0: 2062 6173 6536 342e 6236 3464 6563 6f64   base64.b64decod
+000147b0: 6520 2062 6173 6536 342e 6236 3465 6e63  e  base64.b64enc
+000147c0: 6f64 650a 2020 2020 2020 2020 496e 205b  ode.        In [
+000147d0: 325d 3a20 7072 696e 7428 6261 7365 3634  2]: print(base64
+000147e0: 2e62 3634 290a 2020 2020 2020 2020 2d2d  .b64).        --
+000147f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00014800: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00014810: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00014820: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00014830: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00014840: 2020 4174 7472 6962 7574 6545 7272 6f72    AttributeError
+00014850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014860: 2020 2020 2020 2020 2020 2020 5472 6163              Trac
+00014870: 6562 6163 6b20 286d 6f73 7420 7265 6365  eback (most rece
+00014880: 6e74 2063 616c 6c20 6c61 7374 290a 2020  nt call last).  
+00014890: 2020 2020 2020 2e2e 2e20 696e 202e 2e2e        ... in ...
+000148a0: 0a20 2020 2020 2020 2041 7474 7269 6275  .        Attribu
+000148b0: 7465 4572 726f 723a 206d 6f64 756c 6520  teError: module 
+000148c0: 2762 6173 6536 3427 2068 6173 206e 6f20  'base64' has no 
+000148d0: 6174 7472 6962 7574 6520 2762 3634 270a  attribute 'b64'.
+000148e0: 2020 2020 2222 222c 0a20 2020 2020 2020      """,.       
+000148f0: 2066 726f 6e74 656e 643d 6672 6f6e 7465   frontend=fronte
+00014900: 6e64 2c0a 2020 2020 290a 0a0a 4072 6574  nd,.    )...@ret
+00014910: 7279 0a64 6566 2074 6573 745f 636f 6d70  ry.def test_comp
+00014920: 6c65 7465 5f73 796d 626f 6c5f 6d65 6d62  lete_symbol_memb
+00014930: 6572 5f70 6172 7469 616c 5f6d 756c 7469  er_partial_multi
+00014940: 706c 655f 3128 6672 6f6e 7465 6e64 293a  ple_1(frontend):
+00014950: 0a20 2020 2069 6620 6672 6f6e 7465 6e64  .    if frontend
+00014960: 203d 3d20 2270 726f 6d70 745f 746f 6f6c   == "prompt_tool
+00014970: 6b69 7422 3a0a 2020 2020 2020 2020 7079  kit":.        py
+00014980: 7465 7374 2e73 6b69 7028 290a 2020 2020  test.skip().    
+00014990: 6970 7974 686f 6e28 0a20 2020 2020 2020  ipython(.       
+000149a0: 2022 2222 0a20 2020 2020 2020 2049 6e20   """.        In 
+000149b0: 5b31 5d3a 2069 6d70 6f72 7420 7079 666c  [1]: import pyfl
+000149c0: 7962 793b 2070 7966 6c79 6279 2e65 6e61  yby; pyflyby.ena
+000149d0: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
+000149e0: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
+000149f0: 325d 3a20 7072 696e 7428 6261 7365 3634  2]: print(base64
+00014a00: 2e62 365c 740a 2020 2020 2020 2020 5b50  .b6\t.        [P
+00014a10: 5946 4c59 4259 5d20 696d 706f 7274 2062  YFLYBY] import b
+00014a20: 6173 6536 340a 2020 2020 2020 2020 496e  ase64.        In
+00014a30: 205b 325d 3a20 7072 696e 7428 6261 7365   [2]: print(base
+00014a40: 3634 2e62 360a 2020 2020 2020 2020 6261  64.b6.        ba
+00014a50: 7365 3634 2e62 3634 6465 636f 6465 2020  se64.b64decode  
+00014a60: 6261 7365 3634 2e62 3634 656e 636f 6465  base64.b64encode
+00014a70: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
+00014a80: 2070 7269 6e74 2862 6173 6536 342e 6236   print(base64.b6
+00014a90: 3429 0a20 2020 2020 2020 202d 2d2d 2d2d  4).        -----
+00014aa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00014ab0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00014ac0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00014ad0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00014ae0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2041  ------.        A
+00014af0: 7474 7269 6275 7465 4572 726f 7220 2020  ttributeError   
+00014b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b10: 2020 2020 2020 2020 2054 7261 6365 6261           Traceba
+00014b20: 636b 2028 6d6f 7374 2072 6563 656e 7420  ck (most recent 
+00014b30: 6361 6c6c 206c 6173 7429 0a20 2020 2020  call last).     
+00014b40: 2020 202e 2e2e 2069 6e20 2e2e 2e0a 2020     ... in ....  
+00014b50: 2020 2020 2020 4174 7472 6962 7574 6545        AttributeE
+00014b60: 7272 6f72 3a20 6d6f 6475 6c65 2027 6261  rror: module 'ba
+00014b70: 7365 3634 2720 6861 7320 6e6f 2061 7474  se64' has no att
+00014b80: 7269 6275 7465 2027 6236 3427 0a20 2020  ribute 'b64'.   
+00014b90: 2022 2222 2c0a 2020 2020 2020 2020 6672   """,.        fr
+00014ba0: 6f6e 7465 6e64 3d66 726f 6e74 656e 642c  ontend=frontend,
+00014bb0: 0a20 2020 2029 0a0a 0a40 7265 7472 790a  .    )...@retry.
+00014bc0: 6465 6620 7465 7374 5f63 6f6d 706c 6574  def test_complet
+00014bd0: 655f 7379 6d62 6f6c 5f69 6d70 6f72 745f  e_symbol_import_
+00014be0: 6d6f 6475 6c65 5f61 735f 3128 6672 6f6e  module_as_1(fron
+00014bf0: 7465 6e64 2c20 746d 7029 3a0a 2020 2020  tend, tmp):.    
+00014c00: 7772 6974 6574 6578 7428 746d 702e 6669  writetext(tmp.fi
+00014c10: 6c65 2c20 2269 6d70 6f72 7420 6261 7365  le, "import base
+00014c20: 3634 2061 7320 6236 345c 6e22 290a 2020  64 as b64\n").  
+00014c30: 2020 6970 7974 686f 6e28 2222 220a 2020    ipython(""".  
+00014c40: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
+00014c50: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
+00014c60: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
+00014c70: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
+00014c80: 2020 2020 2049 6e20 5b32 5d3a 2062 3634       In [2]: b64
+00014c90: 2e62 3634 645c 740a 2020 2020 2020 2020  .b64d\t.        
+00014ca0: 5b50 5946 4c59 4259 5d20 696d 706f 7274  [PYFLYBY] import
+00014cb0: 2062 6173 6536 3420 6173 2062 3634 0a20   base64 as b64. 
+00014cc0: 2020 2020 2020 2049 6e20 5b32 5d3a 2062         In [2]: b
+00014cd0: 3634 2e62 3634 6465 636f 6465 2827 636d  64.b64decode('cm
+00014ce0: 397a 5a57 4a31 5a41 3d3d 2729 0a20 2020  9zZWJ1ZA==').   
+00014cf0: 2020 2020 204f 7574 5b32 5d3a 2062 2772       Out[2]: b'r
+00014d00: 6f73 6562 7564 270a 2020 2020 2222 222c  osebud'.    """,
+00014d10: 2050 5946 4c59 4259 5f50 4154 483d 746d   PYFLYBY_PATH=tm
+00014d20: 702e 6669 6c65 2c20 6672 6f6e 7465 6e64  p.file, frontend
+00014d30: 3d66 726f 6e74 656e 6429 0a0a 0a40 7265  =frontend)...@re
+00014d40: 7472 790a 6465 6620 7465 7374 5f63 6f6d  try.def test_com
+00014d50: 706c 6574 655f 7379 6d62 6f6c 5f73 7461  plete_symbol_sta
+00014d60: 7465 6d65 6e74 5f31 2829 3a0a 2020 2020  tement_1():.    
+00014d70: 2320 5665 7269 6679 2074 6861 7420 7461  # Verify that ta
+00014d80: 6220 636f 6d70 6c65 7469 6f6e 2069 6e20  b completion in 
+00014d90: 7374 6174 656d 656e 7473 2077 6f72 6b73  statements works
+00014da0: 2e20 2054 6869 7320 7265 7175 6972 6573  .  This requires
+00014db0: 2061 206d 6f72 650a 2020 2020 2320 736f   a more.    # so
+00014dc0: 7068 6973 7469 6361 7465 6420 636f 6465  phisticated code
+00014dd0: 2070 6174 6820 7468 616e 2074 6573 745f   path than test_
+00014de0: 636f 6d70 6c65 7465 5f73 796d 626f 6c5f  complete_symbol_
+00014df0: 6261 7369 635f 312e 0a20 2020 2069 7079  basic_1..    ipy
+00014e00: 7468 6f6e 2822 2222 0a20 2020 2020 2020  thon(""".       
+00014e10: 2049 6e20 5b31 5d3a 2069 6d70 6f72 7420   In [1]: import 
+00014e20: 7079 666c 7962 793b 2070 7966 6c79 6279  pyflyby; pyflyby
+00014e30: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
+00014e40: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
+00014e50: 496e 205b 325d 3a20 7820 3d20 6236 3464  In [2]: x = b64d
+00014e60: 6563 6f5c 7464 6528 2753 4856 7564 4756  eco\tde('SHVudGV
+00014e70: 7927 290a 2020 2020 2020 2020 5b50 5946  y').        [PYF
+00014e80: 4c59 4259 5d20 6672 6f6d 2062 6173 6536  LYBY] from base6
+00014e90: 3420 696d 706f 7274 2062 3634 6465 636f  4 import b64deco
+00014ea0: 6465 0a20 2020 2020 2020 2049 6e20 5b33  de.        In [3
+00014eb0: 5d3a 2078 0a20 2020 2020 2020 204f 7574  ]: x.        Out
+00014ec0: 5b33 5d3a 2062 2748 756e 7465 7227 0a20  [3]: b'Hunter'. 
+00014ed0: 2020 2022 2222 290a 0a0a 4072 6574 7279     """)...@retry
+00014ee0: 0a64 6566 2074 6573 745f 636f 6d70 6c65  .def test_comple
+00014ef0: 7465 5f73 796d 626f 6c5f 6d75 6c74 696c  te_symbol_multil
+00014f00: 696e 655f 7374 6174 656d 656e 745f 3128  ine_statement_1(
+00014f10: 293a 0a20 2020 2069 7079 7468 6f6e 2822  ):.    ipython("
+00014f20: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
+00014f30: 5d3a 2069 6d70 6f72 7420 7079 666c 7962  ]: import pyflyb
+00014f40: 793b 2070 7966 6c79 6279 2e65 6e61 626c  y; pyflyby.enabl
+00014f50: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
+00014f60: 290a 2020 2020 2020 2020 496e 205b 325d  ).        In [2]
+00014f70: 3a20 6966 2031 3a0a 2020 2020 2020 2020  : if 1:.        
+00014f80: 2020 202e 2e2e 3a20 2020 2020 7072 696e     ...:     prin
+00014f90: 7428 6236 3464 6563 6f5c 7464 6528 2765  t(b64deco\tde('e
+00014fa0: 6d56 6963 6d45 3d27 292e 6465 636f 6465  mVicmE=').decode
+00014fb0: 2827 7574 662d 3827 2929 0a20 2020 2020  ('utf-8')).     
+00014fc0: 2020 2020 2020 2e2e 2e3a 2020 2020 2070        ...:     p
+00014fd0: 7269 6e74 2834 3229 0a20 2020 2020 2020  rint(42).       
+00014fe0: 2020 2020 2e2e 2e3a 0a20 2020 2020 2020      ...:.       
+00014ff0: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
+00015000: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
+00015010: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
+00015020: 7a65 6272 610a 2020 2020 2020 2020 3432  zebra.        42
+00015030: 0a20 2020 2020 2020 2049 6e20 5b33 5d3a  .        In [3]:
+00015040: 2069 6620 313a 2070 7269 6e74 2862 3634   if 1: print(b64
+00015050: 6465 636f 6465 2827 6447 6c6e 5a58 493d  decode('dGlnZXI=
+00015060: 2729 2e64 6563 6f64 6528 2775 7466 2d38  ').decode('utf-8
+00015070: 2729 290a 2020 2020 2020 2020 7469 6765  ')).        tige
+00015080: 720a 2020 2020 2222 2229 0a0a 0a40 7265  r.    """)...@re
+00015090: 7472 790a 6465 6620 7465 7374 5f63 6f6d  try.def test_com
+000150a0: 706c 6574 655f 7379 6d62 6f6c 5f6d 756c  plete_symbol_mul
+000150b0: 7469 6c69 6e65 5f73 7461 7465 6d65 6e74  tiline_statement
+000150c0: 5f6d 656d 6265 725f 3128 6672 6f6e 7465  _member_1(fronte
+000150d0: 6e64 293a 0a20 2020 2069 6620 6672 6f6e  nd):.    if fron
+000150e0: 7465 6e64 203d 3d20 2270 726f 6d70 745f  tend == "prompt_
+000150f0: 746f 6f6c 6b69 7422 3a20 7079 7465 7374  toolkit": pytest
+00015100: 2e73 6b69 7028 290a 2020 2020 6970 7974  .skip().    ipyt
+00015110: 686f 6e28 2222 220a 2020 2020 2020 2020  hon(""".        
+00015120: 496e 205b 315d 3a20 696d 706f 7274 2070  In [1]: import p
+00015130: 7966 6c79 6279 3b20 7079 666c 7962 792e  yflyby; pyflyby.
+00015140: 656e 6162 6c65 5f61 7574 6f5f 696d 706f  enable_auto_impo
+00015150: 7274 6572 2829 0a20 2020 2020 2020 2049  rter().        I
+00015160: 6e20 5b32 5d3a 2069 6620 313a 0a20 2020  n [2]: if 1:.   
+00015170: 2020 2020 2020 2020 2e2e 2e3a 2020 2020          ...:    
+00015180: 2070 7269 6e74 2862 6173 6536 342e 6236   print(base64.b6
+00015190: 3464 5c74 0a20 2020 2020 2020 205b 5059  4d\t.        [PY
+000151a0: 464c 5942 595d 2069 6d70 6f72 7420 6261  FLYBY] import ba
+000151b0: 7365 3634 0a20 2020 2020 2020 2020 2020  se64.           
+000151c0: 2e2e 2e3a 2020 2020 2070 7269 6e74 2862  ...:     print(b
+000151d0: 6173 6536 342e 6236 3464 6563 6f64 6528  ase64.b64decode(
+000151e0: 275a 326c 7959 575a 6d5a 513d 3d27 2929  'Z2lyYWZmZQ=='))
+000151f0: 0a20 2020 2020 2020 2020 2020 2e2e 2e3a  .           ...:
+00015200: 2020 2020 2070 7269 6e74 2834 3229 0a20       print(42). 
+00015210: 2020 2020 2020 2020 2020 2e2e 2e3a 0a20            ...:. 
+00015220: 2020 2020 2020 2067 6972 6166 6665 0a20         giraffe. 
+00015230: 2020 2020 2020 2034 320a 2020 2020 2020         42.      
+00015240: 2020 496e 205b 335d 3a20 7072 696e 7428    In [3]: print(
+00015250: 6236 3464 5c74 6563 6f64 6528 2762 476c  b64d\tecode('bGl
+00015260: 7662 673d 3d27 2929 0a20 2020 2020 2020  vbg==')).       
+00015270: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
+00015280: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
+00015290: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
+000152a0: 6c69 6f6e 0a20 2020 2022 2222 2c20 6672  lion.    """, fr
+000152b0: 6f6e 7465 6e64 3d66 726f 6e74 656e 6429  ontend=frontend)
+000152c0: 0a0a 0a40 7265 7472 790a 6465 6620 7465  ...@retry.def te
+000152d0: 7374 5f63 6f6d 706c 6574 655f 7379 6d62  st_complete_symb
+000152e0: 6f6c 5f61 7574 6f63 616c 6c5f 6172 675f  ol_autocall_arg_
+000152f0: 3128 293a 0a20 2020 2023 2056 6572 6966  1():.    # Verif
+00015300: 7920 7468 6174 2074 6162 2063 6f6d 706c  y that tab compl
+00015310: 6574 696f 6e20 776f 726b 7320 7769 7468  etion works with
+00015320: 2061 7574 6f63 616c 6c2e 0a20 2020 2069   autocall..    i
+00015330: 6620 4950 7974 686f 6e2e 7665 7273 696f  f IPython.versio
+00015340: 6e5f 696e 666f 203c 2028 372c 3137 293a  n_info < (7,17):
+00015350: 0a20 2020 2020 2020 2023 2054 6865 2061  .        # The a
+00015360: 7574 6f63 616c 6c20 6172 726f 7773 2061  utocall arrows a
+00015370: 7265 2070 7269 6e74 6564 2074 7769 6365  re printed twice
+00015380: 2069 6e20 6e65 7765 7220 7665 7273 696f   in newer versio
+00015390: 6e73 206f 6620 4950 7974 686f 6e0a 2020  ns of IPython.  
+000153a0: 2020 2020 2020 2320 2868 7474 7073 3a2f        # (https:/
+000153b0: 2f67 6974 6875 622e 636f 6d2f 6970 7974  /github.com/ipyt
+000153c0: 686f 6e2f 6970 7974 686f 6e2f 6973 7375  hon/ipython/issu
+000153d0: 6573 2f31 3137 3134 292e 0a20 2020 2020  es/11714)..     
+000153e0: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
+000153f0: 2020 2020 2020 2020 2020 2049 6e20 5b31             In [1
+00015400: 5d3a 2069 6d70 6f72 7420 7079 666c 7962  ]: import pyflyb
+00015410: 793b 2070 7966 6c79 6279 2e65 6e61 626c  y; pyflyby.enabl
+00015420: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
+00015430: 290a 2020 2020 2020 2020 2020 2020 496e  ).            In
+00015440: 205b 325d 3a20 6279 7465 732e 7570 7065   [2]: bytes.uppe
+00015450: 7220 6236 3464 6563 6f5c 7464 6528 2751  r b64deco\tde('Q
+00015460: 3268 6c64 324a 6859 324e 6827 290a 2020  2hld2JhY2Nh').  
+00015470: 2020 2020 2020 2020 2020 2d2d 2d2d 2d2d            ------
+00015480: 3e20 6279 7465 732e 7570 7065 7228 6236  > bytes.upper(b6
+00015490: 3464 6563 6f64 6528 2751 3268 6c64 324a  4decode('Q2hld2J
+000154a0: 6859 324e 6827 2929 0a20 2020 2020 2020  hY2Nh')).       
+000154b0: 2020 2020 202d 2d2d 2d2d 2d3e 2062 7974       ------> byt
+000154c0: 6573 2e75 7070 6572 2862 3634 6465 636f  es.upper(b64deco
+000154d0: 6465 2827 5132 686c 6432 4a68 5932 4e68  de('Q2hld2JhY2Nh
+000154e0: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
+000154f0: 5b50 5946 4c59 4259 5d20 6672 6f6d 2062  [PYFLYBY] from b
+00015500: 6173 6536 3420 696d 706f 7274 2062 3634  ase64 import b64
+00015510: 6465 636f 6465 0a20 2020 2020 2020 2020  decode.         
+00015520: 2020 204f 7574 5b32 5d3a 2062 2743 4845     Out[2]: b'CHE
+00015530: 5742 4143 4341 270a 2020 2020 2020 2020  WBACCA'.        
+00015540: 2222 222c 2061 7574 6f63 616c 6c3d 5472  """, autocall=Tr
+00015550: 7565 290a 2020 2020 656c 7365 3a0a 2020  ue).    else:.  
+00015560: 2020 2020 2020 2320 4950 7974 686f 6e20        # IPython 
+00015570: 372e 3137 2b20 7368 6f75 646c 2068 6176  7.17+ shoudl hav
+00015580: 6520 6669 7865 6420 646f 7562 6c65 2061  e fixed double a
+00015590: 7574 6f63 616c 6c0a 2020 2020 2020 2020  utocall.        
+000155a0: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
+000155b0: 2020 2020 2020 2020 496e 205b 315d 3a20          In [1]: 
+000155c0: 696d 706f 7274 2070 7966 6c79 6279 3b20  import pyflyby; 
+000155d0: 7079 666c 7962 792e 656e 6162 6c65 5f61  pyflyby.enable_a
+000155e0: 7574 6f5f 696d 706f 7274 6572 2829 0a20  uto_importer(). 
+000155f0: 2020 2020 2020 2020 2020 2049 6e20 5b32             In [2
+00015600: 5d3a 2062 7974 6573 2e75 7070 6572 2062  ]: bytes.upper b
+00015610: 3634 6465 636f 5c74 6465 2827 5132 686c  64deco\tde('Q2hl
+00015620: 6432 4a68 5932 4e68 2729 0a20 2020 2020  d2JhY2Nh').     
+00015630: 2020 2020 2020 202d 2d2d 2d2d 2d3e 2062         ------> b
+00015640: 7974 6573 2e75 7070 6572 2862 3634 6465  ytes.upper(b64de
+00015650: 636f 6465 2827 5132 686c 6432 4a68 5932  code('Q2hld2JhY2
+00015660: 4e68 2729 290a 2020 2020 2020 2020 2020  Nh')).          
+00015670: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
+00015680: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
+00015690: 3634 6465 636f 6465 0a20 2020 2020 2020  64decode.       
+000156a0: 2020 2020 204f 7574 5b32 5d3a 2062 2743       Out[2]: b'C
+000156b0: 4845 5742 4143 4341 270a 2020 2020 2020  HEWBACCA'.      
+000156c0: 2020 2222 222c 2061 7574 6f63 616c 6c3d    """, autocall=
+000156d0: 5472 7565 290a 0a0a 4072 6574 7279 0a64  True)...@retry.d
+000156e0: 6566 2074 6573 745f 636f 6d70 6c65 7465  ef test_complete
+000156f0: 5f73 796d 626f 6c5f 616e 795f 6d6f 6475  _symbol_any_modu
+00015700: 6c65 5f31 2866 726f 6e74 656e 642c 2074  le_1(frontend, t
+00015710: 6d70 293a 0a20 2020 2023 2056 6572 6966  mp):.    # Verif
+00015720: 7920 7468 6174 2063 6f6d 706c 6574 696f  y that completio
+00015730: 6e20 616e 6420 6175 746f 696d 706f 7274  n and autoimport
+00015740: 2077 6f72 6b73 2066 6f72 2061 6e20 6172   works for an ar
+00015750: 6269 7472 6172 7920 6d6f 6475 6c65 2069  bitrary module i
+00015760: 6e0a 2020 2020 2320 2450 5954 484f 4e50  n.    # $PYTHONP
+00015770: 4154 482e 0a20 2020 2077 7269 7465 7465  ATH..    writete
+00015780: 7874 2874 6d70 2e64 6972 2f22 6d31 3839  xt(tmp.dir/"m189
+00015790: 3038 3639 375f 666f 6f2e 7079 222c 2022  08697_foo.py", "
+000157a0: 2222 0a20 2020 2020 2020 6465 6620 665f  "".       def f_
+000157b0: 3638 3432 3132 3034 2829 3a20 7265 7475  68421204(): retu
+000157c0: 726e 2027 676f 6f64 270a 2020 2020 2222  rn 'good'.    ""
+000157d0: 2229 0a20 2020 2069 7079 7468 6f6e 2822  ").    ipython("
+000157e0: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
+000157f0: 5d3a 2069 6d70 6f72 7420 7079 666c 7962  ]: import pyflyb
+00015800: 793b 2070 7966 6c79 6279 2e65 6e61 626c  y; pyflyby.enabl
+00015810: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
+00015820: 290a 2020 2020 2020 2020 496e 205b 325d  ).        In [2]
+00015830: 3a20 6d31 3839 3038 3639 375f 5c74 666f  : m18908697_\tfo
+00015840: 6f2e 665f 3638 3432 3132 3034 2829 0a20  o.f_68421204(). 
+00015850: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+00015860: 2069 6d70 6f72 7420 6d31 3839 3038 3639   import m1890869
+00015870: 375f 666f 6f0a 2020 2020 2020 2020 4f75  7_foo.        Ou
+00015880: 745b 325d 3a20 2767 6f6f 6427 0a20 2020  t[2]: 'good'.   
+00015890: 2022 2222 2c20 5059 5448 4f4e 5041 5448   """, PYTHONPATH
+000158a0: 3d74 6d70 2e64 6972 2c20 6672 6f6e 7465  =tmp.dir, fronte
+000158b0: 6e64 3d66 726f 6e74 656e 6429 0a0a 0a40  nd=frontend)...@
+000158c0: 7265 7472 790a 6465 6620 7465 7374 5f63  retry.def test_c
+000158d0: 6f6d 706c 6574 655f 7379 6d62 6f6c 5f61  omplete_symbol_a
+000158e0: 6e79 5f6d 6f64 756c 655f 6d65 6d62 6572  ny_module_member
+000158f0: 5f31 2866 726f 6e74 656e 642c 2074 6d70  _1(frontend, tmp
+00015900: 293a 0a20 2020 2023 2056 6572 6966 7920  ):.    # Verify 
+00015910: 7468 6174 2063 6f6d 706c 6574 696f 6e20  that completion 
+00015920: 6f6e 206d 656d 6265 7273 2077 6f72 6b73  on members works
+00015930: 2066 6f72 2061 6e20 6172 6269 7472 6172   for an arbitrar
+00015940: 7920 6d6f 6475 6c65 2069 6e0a 2020 2020  y module in.    
+00015950: 2320 2450 5954 484f 4e50 4154 482e 0a20  # $PYTHONPATH.. 
+00015960: 2020 2077 7269 7465 7465 7874 2874 6d70     writetext(tmp
+00015970: 2e64 6972 2f22 6d35 3131 3435 3130 385f  .dir/"m51145108_
+00015980: 666f 6f2e 7079 222c 2022 2222 0a20 2020  foo.py", """.   
+00015990: 2020 2020 2064 6566 2066 5f37 3633 3133       def f_76313
+000159a0: 3535 385f 3539 3537 3731 3931 2829 3a20  558_59577191(): 
+000159b0: 7265 7475 726e 2027 6f6b 270a 2020 2020  return 'ok'.    
+000159c0: 2222 2229 0a20 2020 2069 7079 7468 6f6e  """).    ipython
+000159d0: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
+000159e0: 5b31 5d3a 2069 6d70 6f72 7420 7079 666c  [1]: import pyfl
+000159f0: 7962 793b 2070 7966 6c79 6279 2e65 6e61  yby; pyflyby.ena
+00015a00: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
+00015a10: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
+00015a20: 325d 3a20 6d35 3131 3435 3130 385f 5c74  2]: m51145108_\t
+00015a30: 666f 6f2e 665f 3736 3331 3335 3538 5f5c  foo.f_76313558_\
+00015a40: 740a 2020 2020 2020 2020 5b50 5946 4c59  t.        [PYFLY
+00015a50: 4259 5d20 696d 706f 7274 206d 3531 3134  BY] import m5114
+00015a60: 3531 3038 5f66 6f6f 0a20 2020 2020 2020  5108_foo.       
+00015a70: 2049 6e20 5b32 5d3a 206d 3531 3134 3531   In [2]: m511451
+00015a80: 3038 5f66 6f6f 2e66 5f37 3633 3133 3535  08_foo.f_7631355
+00015a90: 385f 3539 3537 3731 3931 2829 0a20 2020  8_59577191().   
+00015aa0: 2020 2020 204f 7574 5b32 5d3a 2027 6f6b       Out[2]: 'ok
+00015ab0: 270a 2020 2020 2222 222c 2050 5954 484f  '.    """, PYTHO
+00015ac0: 4e50 4154 483d 746d 702e 6469 722c 2066  NPATH=tmp.dir, f
+00015ad0: 726f 6e74 656e 643d 6672 6f6e 7465 6e64  rontend=frontend
+00015ae0: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
+00015af0: 6573 745f 636f 6d70 6c65 7465 5f73 796d  est_complete_sym
+00015b00: 626f 6c5f 6261 645f 3128 6672 6f6e 7465  bol_bad_1(fronte
+00015b10: 6e64 2c20 746d 7029 3a0a 2020 2020 2320  nd, tmp):.    # 
+00015b20: 5665 7269 6679 2074 6861 7420 6966 2077  Verify that if w
+00015b30: 6520 6861 7665 2061 2062 6164 2069 7465  e have a bad ite
+00015b40: 6d20 696e 206b 6e6f 776e 2069 6d70 6f72  m in known impor
+00015b50: 7473 2c20 7765 2063 6f6d 706c 6574 6520  ts, we complete 
+00015b60: 6974 2073 7469 6c6c 2e0a 2020 2020 7772  it still..    wr
+00015b70: 6974 6574 6578 7428 746d 702e 6669 6c65  itetext(tmp.file
+00015b80: 2c20 2269 6d70 6f72 7420 666f 6f5f 3331  , "import foo_31
+00015b90: 3232 3130 3532 5f62 6172 5c6e 2229 0a20  221052_bar\n"). 
+00015ba0: 2020 2069 7079 7468 6f6e 280a 2020 2020     ipython(.    
+00015bb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00015bc0: 496e 205b 315d 3a20 696d 706f 7274 2070  In [1]: import p
+00015bd0: 7966 6c79 6279 3b20 7079 666c 7962 792e  yflyby; pyflyby.
+00015be0: 656e 6162 6c65 5f61 7574 6f5f 696d 706f  enable_auto_impo
+00015bf0: 7274 6572 2829 0a20 2020 2020 2020 2049  rter().        I
+00015c00: 6e20 5b32 5d3a 2066 6f6f 5f33 3132 3231  n [2]: foo_31221
+00015c10: 3035 325f 5c74 6261 720a 2020 2020 2020  052_\tbar.      
+00015c20: 2020 5b50 5946 4c59 4259 5d20 696d 706f    [PYFLYBY] impo
+00015c30: 7274 2066 6f6f 5f33 3132 3231 3035 325f  rt foo_31221052_
+00015c40: 6261 720a 2020 2020 2020 2020 5b50 5946  bar.        [PYF
+00015c50: 4c59 4259 5d20 4572 726f 7220 6174 7465  LYBY] Error atte
+00015c60: 6d70 7469 6e67 2074 6f20 2769 6d70 6f72  mpting to 'impor
+00015c70: 7420 666f 6f5f 3331 3232 3130 3532 5f62  t foo_31221052_b
+00015c80: 6172 273a 204d 6f64 756c 654e 6f74 466f  ar': ModuleNotFo
+00015c90: 756e 6445 7272 6f72 3a20 4e6f 206d 6f64  undError: No mod
+00015ca0: 756c 6520 6e61 6d65 6420 2766 6f6f 5f33  ule named 'foo_3
+00015cb0: 3132 3231 3035 325f 6261 7227 0a20 2020  1221052_bar'.   
+00015cc0: 2020 2020 202e 2e2e 2e0a 2020 2020 2020       .....      
+00015cd0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d    --------------
+00015ce0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00015cf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00015d00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00015d10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
+00015d20: 2020 2020 2020 4e61 6d65 4572 726f 7220        NameError 
+00015d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d50: 5472 6163 6562 6163 6b20 286d 6f73 7420  Traceback (most 
+00015d60: 7265 6365 6e74 2063 616c 6c20 6c61 7374  recent call last
+00015d70: 290a 2020 2020 2020 2020 2e2e 2e20 696e  ).        ... in
+00015d80: 202e 2e2e 0a20 2020 2020 2020 204e 616d   ....        Nam
+00015d90: 6545 7272 6f72 3a20 6e61 6d65 2027 666f  eError: name 'fo
+00015da0: 6f5f 3331 3232 3130 3532 5f62 6172 2720  o_31221052_bar' 
+00015db0: 6973 206e 6f74 2064 6566 696e 6564 0a20  is not defined. 
+00015dc0: 2020 2022 2222 2c0a 2020 2020 2020 2020     """,.        
+00015dd0: 5059 464c 5942 595f 5041 5448 3d74 6d70  PYFLYBY_PATH=tmp
+00015de0: 2e66 696c 652c 0a20 2020 2020 2020 2066  .file,.        f
+00015df0: 726f 6e74 656e 643d 6672 6f6e 7465 6e64  rontend=frontend
+00015e00: 2c0a 2020 2020 290a 0a0a 4072 6574 7279  ,.    )...@retry
+00015e10: 0a64 6566 2074 6573 745f 636f 6d70 6c65  .def test_comple
+00015e20: 7465 5f73 796d 626f 6c5f 6261 645f 6173  te_symbol_bad_as
+00015e30: 5f31 2866 726f 6e74 656e 642c 2074 6d70  _1(frontend, tmp
+00015e40: 293a 0a20 2020 2077 7269 7465 7465 7874  ):.    writetext
+00015e50: 2874 6d70 2e66 696c 652c 2022 696d 706f  (tmp.file, "impo
+00015e60: 7274 2066 6f6f 5f38 3634 3837 3137 3220  rt foo_86487172 
+00015e70: 6173 2062 6172 5f39 3830 3733 3036 395f  as bar_98073069_
+00015e80: 7175 7578 5c6e 2229 0a20 2020 2069 7079  quux\n").    ipy
+00015e90: 7468 6f6e 280a 2020 2020 2020 2020 2222  thon(.        ""
+00015ea0: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
+00015eb0: 3a20 696d 706f 7274 2070 7966 6c79 6279  : import pyflyby
+00015ec0: 3b20 7079 666c 7962 792e 656e 6162 6c65  ; pyflyby.enable
+00015ed0: 5f61 7574 6f5f 696d 706f 7274 6572 2829  _auto_importer()
+00015ee0: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
+00015ef0: 2062 6172 5f39 3830 3733 3036 395f 5c74   bar_98073069_\t
+00015f00: 7175 7578 2e61 7364 660a 2020 2020 2020  quux.asdf.      
+00015f10: 2020 5b50 5946 4c59 4259 5d20 696d 706f    [PYFLYBY] impo
+00015f20: 7274 2066 6f6f 5f38 3634 3837 3137 3220  rt foo_86487172 
+00015f30: 6173 2062 6172 5f39 3830 3733 3036 395f  as bar_98073069_
+00015f40: 7175 7578 0a20 2020 2020 2020 205b 5059  quux.        [PY
+00015f50: 464c 5942 595d 2045 7272 6f72 2061 7474  FLYBY] Error att
+00015f60: 656d 7074 696e 6720 746f 2027 696d 706f  empting to 'impo
+00015f70: 7274 2066 6f6f 5f38 3634 3837 3137 3220  rt foo_86487172 
+00015f80: 6173 2062 6172 5f39 3830 3733 3036 395f  as bar_98073069_
+00015f90: 7175 7578 273a 204d 6f64 756c 654e 6f74  quux': ModuleNot
+00015fa0: 466f 756e 6445 7272 6f72 3a20 4e6f 206d  FoundError: No m
+00015fb0: 6f64 756c 6520 6e61 6d65 6420 2766 6f6f  odule named 'foo
+00015fc0: 5f38 3634 3837 3137 3227 0a20 2020 2020  _86487172'.     
+00015fd0: 2020 202e 2e2e 2e0a 2020 2020 2020 2020     .....        
+00015fe0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00015ff0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00016000: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00016010: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00016020: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+00016030: 2020 2020 4e61 6d65 4572 726f 7220 2020      NameError   
+00016040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016050: 2020 2020 2020 2020 2020 2020 2020 5472                Tr
+00016060: 6163 6562 6163 6b20 286d 6f73 7420 7265  aceback (most re
+00016070: 6365 6e74 2063 616c 6c20 6c61 7374 290a  cent call last).
+00016080: 2020 2020 2020 2020 2e2e 2e20 696e 202e          ... in .
+00016090: 2e2e 0a20 2020 2020 2020 204e 616d 6545  ...        NameE
+000160a0: 7272 6f72 3a20 6e61 6d65 2027 6261 725f  rror: name 'bar_
+000160b0: 3938 3037 3330 3639 5f71 7575 7827 2069  98073069_quux' i
+000160c0: 7320 6e6f 7420 6465 6669 6e65 640a 2020  s not defined.  
+000160d0: 2020 2222 222c 0a20 2020 2020 2020 2050    """,.        P
+000160e0: 5946 4c59 4259 5f50 4154 483d 746d 702e  YFLYBY_PATH=tmp.
+000160f0: 6669 6c65 2c0a 2020 2020 2020 2020 6672  file,.        fr
+00016100: 6f6e 7465 6e64 3d66 726f 6e74 656e 642c  ontend=frontend,
+00016110: 0a20 2020 2029 0a0a 0a0a 4072 6574 7279  .    )....@retry
+00016120: 0a64 6566 2074 6573 745f 636f 6d70 6c65  .def test_comple
+00016130: 7465 5f73 796d 626f 6c5f 6e6f 6e6d 6f64  te_symbol_nonmod
+00016140: 756c 655f 3128 6672 6f6e 7465 6e64 2c20  ule_1(frontend, 
+00016150: 746d 7029 3a0a 2020 2020 2320 5665 7269  tmp):.    # Veri
+00016160: 6679 2074 6861 7420 636f 6d70 6c65 7469  fy that completi
+00016170: 6f6e 2077 6f72 6b73 2065 7665 6e20 6966  on works even if
+00016180: 2061 206d 6f64 756c 6520 7265 706c 6163   a module replac
+00016190: 6564 2069 7473 656c 6620 696e 0a20 2020  ed itself in.   
+000161a0: 2023 2073 7973 2e6d 6f64 756c 6573 2077   # sys.modules w
+000161b0: 6974 6820 6120 7073 6575 646f 2d6d 6f64  ith a pseudo-mod
+000161c0: 756c 6520 2870 6572 6861 7073 2069 6e20  ule (perhaps in 
+000161d0: 6f72 6465 7220 746f 2067 6574 206d 6f64  order to get mod
+000161e0: 756c 650a 2020 2020 2320 7072 6f70 6572  ule.    # proper
+000161f0: 7469 6573 292e 2020 452e 672e 2070 7375  ties).  E.g. psu
+00016200: 7469 6c2c 2068 7474 7073 3a2f 2f67 6974  til, https://git
+00016210: 6875 622e 636f 6d2f 6a6f 7369 6168 6361  hub.com/josiahca
+00016220: 726c 736f 6e2f 6d70 726f 702e 0a20 2020  rlson/mprop..   
+00016230: 2023 2041 7320 6f66 2032 3031 352d 3130   # As of 2015-10
+00016240: 2d30 3220 2838 3433 3863 3534 6329 2c20  -02 (8438c54c), 
+00016250: 4070 726f 7065 7274 6965 7320 6e6f 7720  @properties now 
+00016260: 6765 7420 6576 616c 7561 7465 6420 7477  get evaluated tw
+00016270: 6963 652c 2068 656e 6365 0a20 2020 2023  ice, hence.    #
+00016280: 2074 6865 2072 6570 6561 7465 6420 7072   the repeated pr
+00016290: 696e 7420 6f75 7470 7574 2e0a 2020 2020  int output..    
+000162a0: 2320 544f 444f 3a20 4669 7820 7468 6174  # TODO: Fix that
+000162b0: 2e20 2057 6520 6361 6e27 7420 6176 6f69  .  We can't avoi
+000162c0: 6420 7079 666c 7962 7920 6576 616c 7561  d pyflyby evalua
+000162d0: 7469 6e67 2074 6865 2070 726f 7065 7274  ting the propert
+000162e0: 792e 2020 4275 7420 6973 0a20 2020 2023  y.  But is.    #
+000162f0: 2074 6865 7265 2073 6f6d 6520 7761 7920   there some way 
+00016300: 746f 2069 6e74 6572 6365 7074 2069 7079  to intercept ipy
+00016310: 7468 6f6e 2773 2073 7562 7365 7175 656e  thon's subsequen
+00016320: 7420 6576 616c 7561 7469 6f6e 2061 6e64  t evaluation and
+00016330: 2072 6575 7365 0a20 2020 2023 2074 6865   reuse.    # the
+00016340: 2073 616d 6520 7265 7375 6c74 3f0a 2020   same result?.  
+00016350: 2020 7772 6974 6574 6578 7428 746d 702e    writetext(tmp.
+00016360: 6469 722f 2267 7261 7665 7365 6e64 3630  dir/"gravesend60
+00016370: 3036 3333 3933 2e70 7922 2c20 2222 220a  063393.py", """.
+00016380: 2020 2020 2020 2020 696d 706f 7274 2073          import s
+00016390: 7973 0a20 2020 2020 2020 2072 6976 6572  ys.        river
+000163a0: 203d 2027 5468 616d 6573 270a 2020 2020   = 'Thames'.    
+000163b0: 2020 2020 636c 6173 7320 4d28 6f62 6a65      class M(obje
+000163c0: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
+000163d0: 2040 7072 6f70 6572 7479 0a20 2020 2020   @property.     
+000163e0: 2020 2020 2020 2064 6566 2072 6976 6572         def river
+000163f0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00016400: 2020 2020 2020 2020 7072 696e 7428 2269          print("i
+00016410: 6e20 7468 6520 7269 7665 7222 290a 2020  n the river").  
+00016420: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00016430: 7475 726e 2027 4d65 6477 6179 270a 2020  turn 'Medway'.  
+00016440: 2020 2020 2020 2020 2020 4070 726f 7065            @prope
+00016450: 7274 790a 2020 2020 2020 2020 2020 2020  rty.            
+00016460: 6465 6620 6973 6c61 6e64 2873 656c 6629  def island(self)
+00016470: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016480: 2020 7072 696e 7428 226f 6e20 7468 6520    print("on the 
+00016490: 6973 6c61 6e64 2229 0a20 2020 2020 2020  island").       
+000164a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000164b0: 2743 616e 7665 7927 0a20 2020 2020 2020  'Canvey'.       
+000164c0: 2020 2020 205f 5f6e 616d 655f 5f20 3d20       __name__ = 
+000164d0: 5f5f 6e61 6d65 5f5f 0a20 2020 2020 2020  __name__.       
+000164e0: 2073 7973 2e6d 6f64 756c 6573 5b5f 5f6e   sys.modules[__n
+000164f0: 616d 655f 5f5d 203d 204d 2829 0a20 2020  ame__] = M().   
+00016500: 2022 2222 290a 0a20 2020 2069 6620 4950   """)..    if IP
+00016510: 7974 686f 6e2e 7665 7273 696f 6e5f 696e  ython.version_in
+00016520: 666f 203e 3d20 2838 2c20 3629 3a0a 2020  fo >= (8, 6):.  
+00016530: 2020 2020 2020 6578 7472 615f 636f 6d70        extra_comp
+00016540: 203d 2027 5c6e 2020 2020 2020 2020 2020   = '\n          
+00016550: 2020 696e 2074 6865 2072 6976 6572 270a    in the river'.
+00016560: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00016570: 2020 6578 7472 615f 636f 6d70 203d 2027    extra_comp = '
+00016580: 270a 0a20 2020 2023 2077 6520 7573 6520  '..    # we use 
+00016590: 222e 2e2e 2074 6865 2069 736c 616e 6422  "... the island"
+000165a0: 2061 7320 7468 6572 6520 6d69 6768 7420   as there might 
+000165b0: 6265 2070 726f 6d70 7420 696e 7365 7274  be prompt insert
+000165c0: 6564 2062 7920 7072 6576 696f 7573 2074  ed by previous t
+000165d0: 6162 2063 6f6d 706c 6574 696e 6f0a 2020  ab completino.  
+000165e0: 2020 6970 7974 686f 6e28 0a20 2020 2020    ipython(.     
+000165f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00016600: 2020 2020 2020 2049 6e20 5b31 5d3a 2069         In [1]: i
+00016610: 6d70 6f72 7420 7079 666c 7962 793b 2070  mport pyflyby; p
+00016620: 7966 6c79 6279 2e65 6e61 626c 655f 6175  yflyby.enable_au
+00016630: 746f 5f69 6d70 6f72 7465 7228 290a 2020  to_importer().  
+00016640: 2020 2020 2020 2020 2020 496e 205b 325d            In [2]
+00016650: 3a20 7072 696e 7428 6772 6176 6573 656e  : print(gravesen
+00016660: 6436 3030 3633 5c74 3339 332e 725c 740a  d60063\t393.r\t.
+00016670: 2020 2020 2020 2020 2020 2020 5b50 5946              [PYF
+00016680: 4c59 4259 5d20 696d 706f 7274 2067 7261  LYBY] import gra
+00016690: 7665 7365 6e64 3630 3036 3333 3933 7b7d  vesend60063393{}
+000166a0: 0a20 2020 2020 2020 2020 2020 2049 6e20  .            In 
+000166b0: 5b32 5d3a 2070 7269 6e74 2867 7261 7665  [2]: print(grave
+000166c0: 7365 6e64 3630 3036 3333 3933 2e72 6976  send60063393.riv
+000166d0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+000166e0: 696e 2074 6865 2072 6976 6572 0a20 2020  in the river.   
+000166f0: 2020 2020 2020 2020 2069 6e20 7468 6520           in the 
+00016700: 7269 7665 720a 2020 2020 2020 2020 2020  river.          
+00016710: 2020 4d65 6477 6179 0a20 2020 2020 2020    Medway.       
+00016720: 2020 2020 202e 2e2e 2074 6865 2069 736c       ... the isl
+00016730: 616e 640a 2020 2020 2020 2020 2020 2020  and.            
+00016740: 496e 205b 335d 3a20 7072 696e 7428 6772  In [3]: print(gr
+00016750: 6176 6573 656e 6436 3030 3633 335c 7439  avesend600633\t9
+00016760: 332e 6973 5c74 6c61 6e64 290a 2020 2020  3.is\tland).    
+00016770: 2020 2020 2020 2020 6f6e 2074 6865 2069          on the i
+00016780: 736c 616e 640a 2020 2020 2020 2020 2020  sland.          
+00016790: 2020 6f6e 2074 6865 2069 736c 616e 640a    on the island.
+000167a0: 2020 2020 2020 2020 2020 2020 4361 6e76              Canv
+000167b0: 6579 0a20 2020 2020 2020 2022 2222 2e66  ey.        """.f
+000167c0: 6f72 6d61 7428 6578 7472 615f 636f 6d70  ormat(extra_comp
+000167d0: 292c 0a20 2020 2020 2020 2020 2020 2050  ),.            P
+000167e0: 5954 484f 4e50 4154 483d 746d 702e 6469  YTHONPATH=tmp.di
+000167f0: 722c 0a20 2020 2020 2020 2020 2020 2066  r,.            f
+00016800: 726f 6e74 656e 643d 6672 6f6e 7465 6e64  rontend=frontend
+00016810: 2c0a 2020 2020 290a 0a0a 2320 544f 444f  ,.    )...# TODO
+00016820: 3a20 6669 6775 7265 206f 7574 2049 5079  : figure out IPy
+00016830: 7468 6f6e 3520 6571 7569 7661 6c65 6e74  thon5 equivalent
+00016840: 2066 6f72 2072 6561 646c 696e 655f 7265   for readline_re
+00016850: 6d6f 7665 5f64 656c 696d 730a 4070 7974  move_delims.@pyt
+00016860: 6573 742e 6d61 726b 2e73 6b69 7069 6628  est.mark.skipif(
+00016870: 0a20 2020 205f 4950 5954 484f 4e5f 5645  .    _IPYTHON_VE
+00016880: 5253 494f 4e20 3c20 2830 2c20 3132 292c  RSION < (0, 12),
+00016890: 0a20 2020 2072 6561 736f 6e3d 2274 6573  .    reason="tes
+000168a0: 7420 6e6f 7420 696d 706c 656d 656e 7465  t not implemente
+000168b0: 6420 666f 7220 7468 6973 2076 6572 7369  d for this versi
+000168c0: 6f6e 2229 0a64 6566 2074 6573 745f 636f  on").def test_co
+000168d0: 6d70 6c65 7465 5f73 796d 626f 6c5f 6765  mplete_symbol_ge
+000168e0: 7469 7465 6d5f 3128 6672 6f6e 7465 6e64  titem_1(frontend
+000168f0: 293a 0a20 2020 2069 6620 6672 6f6e 7465  ):.    if fronte
+00016900: 6e64 203d 3d20 2270 726f 6d70 745f 746f  nd == "prompt_to
+00016910: 6f6c 6b69 7422 3a20 7079 7465 7374 2e73  olkit": pytest.s
+00016920: 6b69 7028 290a 2020 2020 6966 205f 4950  kip().    if _IP
+00016930: 5954 484f 4e5f 5645 5253 494f 4e20 3e3d  YTHON_VERSION >=
+00016940: 2028 352c 293a 2070 7974 6573 742e 736b   (5,): pytest.sk
+00016950: 6970 2829 0a20 2020 2069 7079 7468 6f6e  ip().    ipython
+00016960: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
+00016970: 5b31 5d3a 2069 6d70 6f72 7420 7079 666c  [1]: import pyfl
+00016980: 7962 793b 2070 7966 6c79 6279 2e65 6e61  yby; pyflyby.ena
+00016990: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
+000169a0: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
+000169b0: 325d 3a20 6170 706c 6573 203d 205b 274d  2]: apples = ['M
+000169c0: 6349 6e74 6f73 6827 2c20 2750 696e 6b4c  cIntosh', 'PinkL
+000169d0: 6164 7927 5d0a 2020 2020 2020 2020 496e  ady'].        In
+000169e0: 205b 335d 3a20 6170 706c 6573 5b31 5d2e   [3]: apples[1].
+000169f0: 6c5c 740a 2020 2020 2020 2020 6170 706c  l\t.        appl
+00016a00: 6573 5b31 5d2e 6c6a 7573 7420 2020 6170  es[1].ljust   ap
+00016a10: 706c 6573 5b31 5d2e 6c6f 7765 7220 2020  ples[1].lower   
+00016a20: 6170 706c 6573 5b31 5d2e 6c73 7472 6970  apples[1].lstrip
+00016a30: 0a20 2020 2020 2020 2049 6e20 5b33 5d3a  .        In [3]:
+00016a40: 2061 7070 6c65 735b 315d 2e6c 5c78 3036   apples[1].l\x06
+00016a50: 6f77 5c74 6572 2829 0a20 2020 2020 2020  ow\ter().       
+00016a60: 204f 7574 5b33 5d3a 2027 7069 6e6b 6c61   Out[3]: 'pinkla
+00016a70: 6479 270a 2020 2020 2222 222c 2061 7267  dy'.    """, arg
+00016a80: 733d 5b27 2d2d 496e 7465 7261 6374 6976  s=['--Interactiv
+00016a90: 6553 6865 6c6c 2e72 6561 646c 696e 655f  eShell.readline_
+00016aa0: 7265 6d6f 7665 5f64 656c 696d 733d 2d2f  remove_delims=-/
+00016ab0: 7e5b 5d27 5d2c 0a20 2020 2020 2020 2020  ~[]'],.         
+00016ac0: 2020 2066 726f 6e74 656e 643d 6672 6f6e     frontend=fron
+00016ad0: 7465 6e64 290a 0a0a 4070 7974 6573 742e  tend)...@pytest.
+00016ae0: 6d61 726b 2e73 6b69 7069 6628 0a20 2020  mark.skipif(.   
+00016af0: 205f 4950 5954 484f 4e5f 5645 5253 494f   _IPYTHON_VERSIO
+00016b00: 4e20 3c20 2830 2c20 3132 292c 0a20 2020  N < (0, 12),.   
+00016b10: 2072 6561 736f 6e3d 2274 6573 7420 6e6f   reason="test no
+00016b20: 7420 696d 706c 656d 656e 7465 6420 666f  t implemented fo
+00016b30: 7220 6f6c 6420 636f 6e66 6967 2229 0a40  r old config").@
+00016b40: 7265 7472 790a 6465 6620 7465 7374 5f63  retry.def test_c
+00016b50: 6f6d 706c 6574 655f 7379 6d62 6f6c 5f67  omplete_symbol_g
+00016b60: 7265 6564 795f 6576 616c 5f31 2829 3a0a  reedy_eval_1():.
+00016b70: 2020 2020 6970 7974 686f 6e28 2222 220a      ipython(""".
+00016b80: 2020 2020 2020 2020 496e 205b 315d 3a20          In [1]: 
+00016b90: 696d 706f 7274 2070 7966 6c79 6279 3b20  import pyflyby; 
+00016ba0: 7079 666c 7962 792e 656e 6162 6c65 5f61  pyflyby.enable_a
+00016bb0: 7574 6f5f 696d 706f 7274 6572 2829 0a20  uto_importer(). 
+00016bc0: 2020 2020 2020 2049 6e20 5b32 5d3a 2025         In [2]: %
+00016bd0: 636f 6e66 6967 2049 5043 6f6d 706c 6574  config IPComplet
+00016be0: 6572 2e67 7265 6564 793d 5472 7565 0a20  er.greedy=True. 
+00016bf0: 2020 2020 2020 2049 6e20 5b33 5d3a 2061         In [3]: a
+00016c00: 7070 6c65 203d 2027 4675 6a69 270a 2020  pple = 'Fuji'.  
+00016c10: 2020 2020 2020 496e 205b 345d 3a20 6170        In [4]: ap
+00016c20: 706c 652e 6c6f 7765 7228 295b 305d 2e73  ple.lower()[0].s
+00016c30: 7472 695c 7470 2829 0a20 2020 2020 2020  tri\tp().       
+00016c40: 204f 7574 5b34 5d3a 2027 6627 0a20 2020   Out[4]: 'f'.   
+00016c50: 2022 2222 290a 0a0a 4070 7974 6573 742e   """)...@pytest.
+00016c60: 6d61 726b 2e73 6b69 7069 6628 0a20 2020  mark.skipif(.   
+00016c70: 205f 4950 5954 484f 4e5f 5645 5253 494f   _IPYTHON_VERSIO
+00016c80: 4e20 3c20 2830 2c20 3132 292c 0a20 2020  N < (0, 12),.   
+00016c90: 2072 6561 736f 6e3d 2274 6573 7420 6e6f   reason="test no
+00016ca0: 7420 696d 706c 656d 656e 7465 6420 666f  t implemented fo
+00016cb0: 7220 6f6c 6420 636f 6e66 6967 2229 0a64  r old config").d
+00016cc0: 6566 2074 6573 745f 636f 6d70 6c65 7465  ef test_complete
+00016cd0: 5f73 796d 626f 6c5f 6772 6565 6479 5f65  _symbol_greedy_e
+00016ce0: 7661 6c5f 6175 746f 696d 706f 7274 5f31  val_autoimport_1
+00016cf0: 2866 726f 6e74 656e 6429 3a0a 2020 2020  (frontend):.    
+00016d00: 6966 2066 726f 6e74 656e 6420 3d3d 2022  if frontend == "
+00016d10: 7072 6f6d 7074 5f74 6f6f 6c6b 6974 223a  prompt_toolkit":
+00016d20: 2070 7974 6573 742e 736b 6970 2829 0a20   pytest.skip(). 
+00016d30: 2020 2069 6620 5f49 5059 5448 4f4e 5f56     if _IPYTHON_V
+00016d40: 4552 5349 4f4e 203e 3d20 2835 2c29 3a20  ERSION >= (5,): 
+00016d50: 7079 7465 7374 2e73 6b69 7028 290a 2020  pytest.skip().  
+00016d60: 2020 6970 7974 686f 6e28 2222 220a 2020    ipython(""".  
+00016d70: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
+00016d80: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
+00016d90: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
+00016da0: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
+00016db0: 2020 2020 2049 6e20 5b32 5d3a 2025 636f       In [2]: %co
+00016dc0: 6e66 6967 2049 5043 6f6d 706c 6574 6572  nfig IPCompleter
+00016dd0: 2e67 7265 6564 793d 5472 7565 0a20 2020  .greedy=True.   
+00016de0: 2020 2020 2049 6e20 5b33 5d3a 206f 732e       In [3]: os.
+00016df0: 7365 702e 7374 7269 7028 292e 6c73 745c  sep.strip().lst\
+00016e00: 740a 2020 2020 2020 2020 5b50 5946 4c59  t.        [PYFLY
+00016e10: 4259 5d20 696d 706f 7274 206f 730a 2020  BY] import os.  
+00016e20: 2020 2020 2020 496e 205b 335d 3a20 6f73        In [3]: os
+00016e30: 2e73 6570 2e73 7472 6970 2829 2e6c 7374  .sep.strip().lst
+00016e40: 5c74 7269 7028 290a 2020 2020 2020 2020  \trip().        
+00016e50: 4f75 745b 335d 3a20 272f 270a 2020 2020  Out[3]: '/'.    
+00016e60: 2222 222c 2066 726f 6e74 656e 643d 6672  """, frontend=fr
+00016e70: 6f6e 7465 6e64 290a 0a0a 4072 6574 7279  ontend)...@retry
+00016e80: 0a64 6566 2074 6573 745f 636f 6d70 6c65  .def test_comple
+00016e90: 7465 5f73 796d 626f 6c5f 6572 726f 725f  te_symbol_error_
+00016ea0: 696e 5f67 6574 6174 7472 5f31 2866 726f  in_getattr_1(fro
+00016eb0: 6e74 656e 6429 3a0a 2020 2020 2320 5665  ntend):.    # Ve
+00016ec0: 7269 6679 2074 6861 7420 6966 2074 6865  rify that if the
+00016ed0: 7265 2773 2061 6e20 6578 6365 7074 696f  re's an exceptio
+00016ee0: 6e20 696e 7369 6465 2073 6f6d 6520 6375  n inside some cu
+00016ef0: 7374 6f6d 206f 626a 6563 7427 7320 6765  stom object's ge
+00016f00: 7461 7474 722c 0a20 2020 2023 2077 6520  tattr,.    # we 
+00016f10: 646f 6e27 7420 6765 7420 636f 6e66 7573  don't get confus
+00016f20: 6564 2e0a 2020 2020 6970 7974 686f 6e28  ed..    ipython(
+00016f30: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
+00016f40: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
+00016f50: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
+00016f60: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
+00016f70: 2829 0a20 2020 2020 2020 2049 6e20 5b32  ().        In [2
+00016f80: 5d3a 2063 6c61 7373 204e 6175 6768 7479  ]: class Naughty
+00016f90: 3a0a 2020 2020 2020 2020 2020 202e 2e2e  :.           ...
+00016fa0: 3a20 2020 2020 6465 6620 5f5f 6765 7461  :     def __geta
+00016fb0: 7474 725f 5f28 7365 6c66 2c20 6b29 3a0a  ttr__(self, k):.
+00016fc0: 2020 2020 2020 2020 2020 202e 2e2e 3a20             ...: 
+00016fd0: 2020 2020 2020 2020 312f 300a 2020 2020          1/0.    
+00016fe0: 2020 2020 2020 202e 2e2e 3a0a 2020 2020         ...:.    
+00016ff0: 2020 2020 496e 205b 335d 3a20 6e20 3d20      In [3]: n = 
+00017000: 4e61 7567 6874 7928 290a 2020 2020 2020  Naughty().      
+00017010: 2020 496e 205b 345d 3a20 6e2e 666f 6f2e    In [4]: n.foo.
+00017020: 625c 745c 7830 360a 2020 2020 2020 2020  b\t\x06.        
+00017030: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00017040: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00017050: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00017060: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00017070: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+00017080: 2020 2020 5a65 726f 4469 7669 7369 6f6e      ZeroDivision
+00017090: 4572 726f 7220 2020 2020 2020 2020 2020  Error           
+000170a0: 2020 2020 2020 2020 2020 2020 2020 5472                Tr
+000170b0: 6163 6562 6163 6b20 286d 6f73 7420 7265  aceback (most re
+000170c0: 6365 6e74 2063 616c 6c20 6c61 7374 290a  cent call last).
+000170d0: 2020 2020 2020 2020 2e2e 2e2e 0a20 2020          .....   
+000170e0: 2020 2020 205a 6572 6f44 6976 6973 696f       ZeroDivisio
+000170f0: 6e45 7272 6f72 3a20 6469 7669 7369 6f6e  nError: division
+00017100: 2062 7920 7a65 726f 0a20 2020 2020 2020   by zero.       
+00017110: 2049 6e20 5b35 5d3a 2073 7973 2e73 6574   In [5]: sys.set
+00017120: 7472 615c 740a 2020 2020 2020 2020 5b50  tra\t.        [P
+00017130: 5946 4c59 4259 5d20 696d 706f 7274 2073  YFLYBY] import s
+00017140: 7973 0a20 2020 2020 2020 2049 6e20 5b35  ys.        In [5
+00017150: 5d3a 2073 7973 2e73 6574 7472 6163 650a  ]: sys.settrace.
+00017160: 2020 2020 2020 2020 4f75 745b 355d 3a20          Out[5]: 
+00017170: 3c2e 2e2e 7365 7474 7261 6365 3e0a 2020  <...settrace>.  
+00017180: 2020 2222 222c 2066 726f 6e74 656e 643d    """, frontend=
+00017190: 6672 6f6e 7465 6e64 290a 0a0a 4070 7974  frontend)...@pyt
+000171a0: 6573 742e 6d61 726b 2e73 6b69 7069 6628  est.mark.skipif(
+000171b0: 0a20 2020 205f 4950 5954 484f 4e5f 5645  .    _IPYTHON_VE
+000171c0: 5253 494f 4e20 3c20 2830 2c20 3132 292c  RSION < (0, 12),
+000171d0: 0a20 2020 2072 6561 736f 6e3d 2249 5079  .    reason="IPy
+000171e0: 7468 6f6e 2076 6572 7369 6f6e 2025 7320  thon version %s 
+000171f0: 6974 7365 6c66 2069 7320 7472 6967 6765  itself is trigge
+00017200: 7273 2073 7570 6572 666c 756f 7573 2070  rs superfluous p
+00017210: 726f 7065 7274 7920 6163 6365 7373 2229  roperty access")
+00017220: 0a64 6566 2074 6573 745f 7072 6f70 6572  .def test_proper
+00017230: 7479 5f6e 6f5f 7375 7065 7266 6c75 6f75  ty_no_superfluou
+00017240: 735f 6163 6365 7373 5f31 2874 6d70 293a  s_access_1(tmp):
+00017250: 0a20 2020 2023 2056 6572 6966 7920 7468  .    # Verify th
+00017260: 6174 2077 6520 646f 6e27 7420 7472 6967  at we don't trig
+00017270: 6765 7220 7072 6f70 6572 7469 6573 206d  ger properties m
+00017280: 6f72 6520 7468 616e 206f 6e63 652e 0a20  ore than once.. 
+00017290: 2020 2077 7269 7465 7465 7874 2874 6d70     writetext(tmp
+000172a0: 2e64 6972 2f22 7261 7468 6275 6e33 3833  .dir/"rathbun383
+000172b0: 3536 3230 322e 7079 222c 2022 2222 0a20  56202.py", """. 
+000172c0: 2020 2020 2020 2063 6c61 7373 2041 286f         class A(o
+000172d0: 626a 6563 7429 3a0a 2020 2020 2020 2020  bject):.        
+000172e0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+000172f0: 2020 2020 2020 2020 2020 6465 6620 656c            def el
+00017300: 6c73 776f 7274 6828 7365 6c66 293a 0a20  lsworth(self):. 
+00017310: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00017320: 7269 6e74 2822 6564 6765 6772 6f76 6522  rint("edgegrove"
+00017330: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017340: 2020 7265 7475 726e 2022 6461 726c 696e    return "darlin
+00017350: 6774 6f6e 220a 2020 2020 2222 2229 0a20  gton".    """). 
+00017360: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
+00017370: 2020 2020 2020 2049 6e20 5b31 5d3a 2069         In [1]: i
+00017380: 6d70 6f72 7420 7079 666c 7962 793b 2070  mport pyflyby; p
+00017390: 7966 6c79 6279 2e65 6e61 626c 655f 6175  yflyby.enable_au
+000173a0: 746f 5f69 6d70 6f72 7465 7228 290a 2020  to_importer().  
+000173b0: 2020 2020 2020 496e 205b 325d 3a20 6120        In [2]: a 
+000173c0: 3d20 7261 7468 6275 6e33 3833 3536 3230  = rathbun3835620
+000173d0: 322e 4128 290a 2020 2020 2020 2020 5b50  2.A().        [P
+000173e0: 5946 4c59 4259 5d20 696d 706f 7274 2072  YFLYBY] import r
+000173f0: 6174 6862 756e 3338 3335 3632 3032 0a20  athbun38356202. 
+00017400: 2020 2020 2020 2049 6e20 5b33 5d3a 2061         In [3]: a
+00017410: 2e65 6c6c 7377 6f72 7468 0a20 2020 2020  .ellsworth.     
+00017420: 2020 2065 6467 6567 726f 7665 0a20 2020     edgegrove.   
+00017430: 2020 2020 204f 7574 5b33 5d3a 2027 6461       Out[3]: 'da
+00017440: 726c 696e 6774 6f6e 270a 2020 2020 2222  rlington'.    ""
+00017450: 222c 2050 5954 484f 4e50 4154 483d 746d  ", PYTHONPATH=tm
+00017460: 702e 6469 7229 0a0a 0a40 7265 7472 790a  p.dir)...@retry.
+00017470: 6465 6620 7465 7374 5f64 6973 6162 6c65  def test_disable
+00017480: 5f72 6565 6e61 626c 655f 6175 746f 696d  _reenable_autoim
+00017490: 706f 7274 5f31 2829 3a0a 2020 2020 6970  port_1():.    ip
+000174a0: 7974 686f 6e28 0a20 2020 2020 2020 2022  ython(.        "
+000174b0: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
+000174c0: 5d3a 2069 6d70 6f72 7420 7079 666c 7962  ]: import pyflyb
+000174d0: 790a 2020 2020 2020 2020 496e 205b 325d  y.        In [2]
+000174e0: 3a20 7079 666c 7962 792e 656e 6162 6c65  : pyflyby.enable
+000174f0: 5f61 7574 6f5f 696d 706f 7274 6572 2829  _auto_importer()
+00017500: 0a20 2020 2020 2020 2049 6e20 5b33 5d3a  .        In [3]:
+00017510: 2062 3634 656e 636f 6465 2862 2762 6c75   b64encode(b'blu
+00017520: 6527 290a 2020 2020 2020 2020 5b50 5946  e').        [PYF
+00017530: 4c59 4259 5d20 6672 6f6d 2062 6173 6536  LYBY] from base6
+00017540: 3420 696d 706f 7274 2062 3634 656e 636f  4 import b64enco
+00017550: 6465 0a20 2020 2020 2020 204f 7574 5b33  de.        Out[3
+00017560: 5d3a 2062 2759 6d78 315a 513d 3d27 0a20  ]: b'Ymx1ZQ=='. 
+00017570: 2020 2020 2020 2049 6e20 5b34 5d3a 2070         In [4]: p
+00017580: 7966 6c79 6279 2e64 6973 6162 6c65 5f61  yflyby.disable_a
+00017590: 7574 6f5f 696d 706f 7274 6572 2829 0a20  uto_importer(). 
+000175a0: 2020 2020 2020 2049 6e20 5b35 5d3a 2062         In [5]: b
+000175b0: 3634 6465 636f 6465 2827 636d 566b 2729  64decode('cmVk')
+000175c0: 2020 2020 2020 2020 2320 6578 7065 6374          # expect
+000175d0: 204e 616d 6545 7272 6f72 2073 696e 6365   NameError since
+000175e0: 206e 6f20 6175 746f 2069 6d70 6f72 7465   no auto importe
+000175f0: 720a 2020 2020 2020 2020 2d2d 2d2d 2d2d  r.        ------
+00017600: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00017610: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00017620: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00017630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00017640: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4e61  -----.        Na
+00017650: 6d65 4572 726f 7220 2020 2020 2020 2020  meError         
+00017660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017670: 2020 2020 2020 2020 5472 6163 6562 6163          Tracebac
+00017680: 6b20 286d 6f73 7420 7265 6365 6e74 2063  k (most recent c
+00017690: 616c 6c20 6c61 7374 290a 2020 2020 2020  all last).      
+000176a0: 2020 2e2e 2e20 696e 202e 2e2e 0a20 2020    ... in ....   
+000176b0: 2020 2020 204e 616d 6545 7272 6f72 3a20       NameError: 
+000176c0: 6e61 6d65 2027 6236 3464 6563 6f64 6527  name 'b64decode'
+000176d0: 2069 7320 6e6f 7420 6465 6669 6e65 640a   is not defined.
+000176e0: 2020 2020 2020 2020 496e 205b 365d 3a20          In [6]: 
+000176f0: 6236 3465 6e63 6f64 6528 6227 6772 6565  b64encode(b'gree
+00017700: 6e27 2920 2020 2020 2020 2320 7368 6f75  n')       # shou
+00017710: 6c64 2073 7469 6c6c 2077 6f72 6b20 6265  ld still work be
+00017720: 6361 7573 6520 616c 7265 6164 7920 696d  cause already im
+00017730: 706f 7274 6564 0a20 2020 2020 2020 204f  ported.        O
+00017740: 7574 5b36 5d3a 2062 275a 334a 6c5a 5734  ut[6]: b'Z3JlZW4
+00017750: 3d27 0a20 2020 2020 2020 2049 6e20 5b37  ='.        In [7
+00017760: 5d3a 2070 7966 6c79 6279 2e65 6e61 626c  ]: pyflyby.enabl
+00017770: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
+00017780: 290a 2020 2020 2020 2020 496e 205b 385d  ).        In [8]
+00017790: 3a20 6236 3464 6563 6f64 6528 2765 5756  : b64decode('eWV
+000177a0: 7362 4739 3327 2920 2020 2023 2073 686f  sbG93')    # sho
+000177b0: 756c 6420 776f 726b 206e 6f77 0a20 2020  uld work now.   
+000177c0: 2020 2020 205b 5059 464c 5942 595d 2066       [PYFLYBY] f
+000177d0: 726f 6d20 6261 7365 3634 2069 6d70 6f72  rom base64 impor
+000177e0: 7420 6236 3464 6563 6f64 650a 2020 2020  t b64decode.    
+000177f0: 2020 2020 4f75 745b 385d 3a20 6227 7965      Out[8]: b'ye
+00017800: 6c6c 6f77 270a 2020 2020 2222 220a 2020  llow'.    """.  
+00017810: 2020 290a 0a0a 4072 6574 7279 0a64 6566    )...@retry.def
+00017820: 2074 6573 745f 6469 7361 626c 655f 7265   test_disable_re
+00017830: 656e 6162 6c65 5f63 6f6d 706c 6574 696f  enable_completio
+00017840: 6e5f 3128 293a 0a20 2020 2069 7079 7468  n_1():.    ipyth
+00017850: 6f6e 280a 2020 2020 2020 2020 2222 220a  on(.        """.
+00017860: 2020 2020 2020 2020 496e 205b 315d 3a20          In [1]: 
+00017870: 696d 706f 7274 2070 7966 6c79 6279 0a20  import pyflyby. 
+00017880: 2020 2020 2020 2049 6e20 5b32 5d3a 2070         In [2]: p
+00017890: 7966 6c79 6279 2e65 6e61 626c 655f 6175  yflyby.enable_au
+000178a0: 746f 5f69 6d70 6f72 7465 7228 290a 2020  to_importer().  
+000178b0: 2020 2020 2020 496e 205b 335d 3a20 6236        In [3]: b6
+000178c0: 3465 6e63 6f5c 7464 6528 6227 666c 6f77  4enco\tde(b'flow
+000178d0: 6572 2729 0a20 2020 2020 2020 205b 5059  er').        [PY
+000178e0: 464c 5942 595d 2066 726f 6d20 6261 7365  FLYBY] from base
+000178f0: 3634 2069 6d70 6f72 7420 6236 3465 6e63  64 import b64enc
+00017900: 6f64 650a 2020 2020 2020 2020 4f75 745b  ode.        Out[
+00017910: 335d 3a20 6227 5a6d 7876 6432 5679 270a  3]: b'Zmxvd2Vy'.
+00017920: 2020 2020 2020 2020 496e 205b 345d 3a20          In [4]: 
+00017930: 7079 666c 7962 792e 6469 7361 626c 655f  pyflyby.disable_
+00017940: 6175 746f 5f69 6d70 6f72 7465 7228 290a  auto_importer().
+00017950: 2020 2020 2020 2020 496e 205b 355d 3a20          In [5]: 
+00017960: 6236 3464 6563 6f5c 7428 2759 3278 7664  b64deco\t('Y2xvd
+00017970: 5751 3d27 2920 2320 6578 7065 6374 204e  WQ=') # expect N
+00017980: 616d 6545 7272 6f72 2073 696e 6365 206e  ameError since n
+00017990: 6f20 6175 746f 2069 6d70 6f72 7465 720a  o auto importer.
+000179a0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000179b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000179c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000179d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000179e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000179f0: 2d2d 2d0a 2020 2020 2020 2020 4e61 6d65  ---.        Name
+00017a00: 4572 726f 7220 2020 2020 2020 2020 2020  Error           
+00017a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a20: 2020 2020 2020 5472 6163 6562 6163 6b20        Traceback 
+00017a30: 286d 6f73 7420 7265 6365 6e74 2063 616c  (most recent cal
+00017a40: 6c20 6c61 7374 290a 2020 2020 2020 2020  l last).        
+00017a50: 2e2e 2e20 696e 202e 2e2e 0a20 2020 2020  ... in ....     
+00017a60: 2020 204e 616d 6545 7272 6f72 3a20 6e61     NameError: na
+00017a70: 6d65 2027 6236 3464 6563 6f27 2069 7320  me 'b64deco' is 
+00017a80: 6e6f 7420 6465 6669 6e65 640a 2020 2020  not defined.    
+00017a90: 2020 2020 496e 205b 365d 3a20 6236 3465      In [6]: b64e
+00017aa0: 6e63 6f5c 7464 6528 6227 7472 6565 2729  nco\tde(b'tree')
+00017ab0: 2023 2073 686f 756c 6420 7374 696c 6c20   # should still 
+00017ac0: 776f 726b 2062 6563 6175 7365 2061 6c72  work because alr
+00017ad0: 6561 6479 2069 6d70 6f72 7465 640a 2020  eady imported.  
+00017ae0: 2020 2020 2020 4f75 745b 365d 3a20 6227        Out[6]: b'
+00017af0: 6448 4a6c 5a51 3d3d 270a 2020 2020 2020  dHJlZQ=='.      
+00017b00: 2020 496e 205b 375d 3a20 7079 666c 7962    In [7]: pyflyb
+00017b10: 792e 656e 6162 6c65 5f61 7574 6f5f 696d  y.enable_auto_im
+00017b20: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
+00017b30: 2049 6e20 5b38 5d3a 2062 3634 6465 636f   In [8]: b64deco
+00017b40: 5c74 6465 2827 5932 7876 6457 513d 2729  \tde('Y2xvdWQ=')
+00017b50: 2023 2073 686f 756c 6420 776f 726b 206e   # should work n
+00017b60: 6f77 0a20 2020 2020 2020 205b 5059 464c  ow.        [PYFL
+00017b70: 5942 595d 2066 726f 6d20 6261 7365 3634  YBY] from base64
+00017b80: 2069 6d70 6f72 7420 6236 3464 6563 6f64   import b64decod
+00017b90: 650a 2020 2020 2020 2020 4f75 745b 385d  e.        Out[8]
+00017ba0: 3a20 6227 636c 6f75 6427 0a20 2020 2022  : b'cloud'.    "
+00017bb0: 2222 0a20 2020 2029 0a0a 0a40 7265 7472  "".    )...@retr
+00017bc0: 790a 6465 6620 7465 7374 5f70 696e 666f  y.def test_pinfo
+00017bd0: 5f31 2874 6d70 293a 0a20 2020 2023 2054  _1(tmp):.    # T
+00017be0: 6573 7420 7468 6174 2070 696e 666f 2028  est that pinfo (
+00017bf0: 6f66 696e 6420 686f 6f6b 2920 776f 726b  ofind hook) work
+00017c00: 732e 0a20 2020 2077 7269 7465 7465 7874  s..    writetext
+00017c10: 2874 6d70 2e64 6972 2f22 6d31 3734 3236  (tmp.dir/"m17426
+00017c20: 3831 342e 7079 222c 2022 2222 0a20 2020  814.py", """.   
+00017c30: 2020 2020 2064 6566 2066 3334 3232 3931       def f342291
+00017c40: 3836 2829 3a0a 2020 2020 2020 2020 2020  86():.          
+00017c50: 2020 2768 656c 6c6f 2066 726f 6d20 2720    'hello from ' 
+00017c60: 2027 3334 3232 2720 2027 3931 3836 270a   '3422'  '9186'.
+00017c70: 2020 2020 2222 2229 0a20 2020 2077 7269      """).    wri
+00017c80: 7465 7465 7874 2874 6d70 2e66 696c 652c  tetext(tmp.file,
+00017c90: 2022 6672 6f6d 206d 3137 3432 3638 3134   "from m17426814
+00017ca0: 2069 6d70 6f72 7420 6633 3432 3239 3138   import f3422918
+00017cb0: 365c 6e22 290a 2020 2020 6970 7974 686f  6\n").    ipytho
+00017cc0: 6e28 2222 220a 2020 2020 2020 2020 496e  n(""".        In
+00017cd0: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
+00017ce0: 6c79 6279 3b20 7079 666c 7962 792e 656e  lyby; pyflyby.en
+00017cf0: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
+00017d00: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
+00017d10: 5b32 5d3a 2066 3334 3232 3931 3836 3f0a  [2]: f34229186?.
+00017d20: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
+00017d30: 5d20 6672 6f6d 206d 3137 3432 3638 3134  ] from m17426814
+00017d40: 2069 6d70 6f72 7420 6633 3432 3239 3138   import f3422918
+00017d50: 360a 2020 2020 2020 2020 2e2e 2e2e 0a20  6.        ..... 
+00017d60: 2020 2020 2020 2044 6f63 7374 7269 6e67         Docstring
+00017d70: 3a2e 2e2e 2e68 656c 6c6f 2066 726f 6d20  :....hello from 
+00017d80: 3334 3232 3931 3836 2e2e 2e2e 0a20 2020  34229186.....   
+00017d90: 2022 2222 2c20 5059 5448 4f4e 5041 5448   """, PYTHONPATH
+00017da0: 3d74 6d70 2e64 6972 2c20 5059 464c 5942  =tmp.dir, PYFLYB
+00017db0: 595f 5041 5448 3d74 6d70 2e66 696c 6529  Y_PATH=tmp.file)
+00017dc0: 0a0a 0a40 7265 7472 790a 6465 6620 7465  ...@retry.def te
+00017dd0: 7374 5f65 7272 6f72 5f64 7572 696e 675f  st_error_during_
+00017de0: 6175 746f 5f69 6d70 6f72 745f 7379 6d62  auto_import_symb
+00017df0: 6f6c 5f31 2874 6d70 293a 0a20 2020 2077  ol_1(tmp):.    w
+00017e00: 7269 7465 7465 7874 2874 6d70 2e66 696c  ritetext(tmp.fil
+00017e10: 652c 2022 332b 2229 0a20 2020 2069 7079  e, "3+").    ipy
+00017e20: 7468 6f6e 280a 2020 2020 2020 2020 2222  thon(.        ""
+00017e30: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
+00017e40: 3a20 696d 706f 7274 2070 7966 6c79 6279  : import pyflyby
+00017e50: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
+00017e60: 2070 7966 6c79 6279 2e65 6e61 626c 655f   pyflyby.enable_
+00017e70: 6175 746f 5f69 6d70 6f72 7465 7228 290a  auto_importer().
+00017e80: 2020 2020 2020 2020 496e 205b 335d 3a20          In [3]: 
+00017e90: 362a 370a 2020 2020 2020 2020 4f75 745b  6*7.        Out[
+00017ea0: 335d 3a20 3432 0a20 2020 2020 2020 2049  3]: 42.        I
+00017eb0: 6e20 5b34 5d3a 2075 6e6b 6e6f 776e 5f73  n [4]: unknown_s
+00017ec0: 796d 626f 6c5f 3638 3437 3030 3432 0a20  ymbol_68470042. 
+00017ed0: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+00017ee0: 2053 796e 7461 7845 7272 6f72 3a20 5768   SyntaxError: Wh
+00017ef0: 696c 6520 7061 7273 696e 6720 2e2e 2e3a  ile parsing ...:
+00017f00: 2069 6e76 616c 6964 2073 796e 7461 7820   invalid syntax 
+00017f10: 282e 2e2e 2c20 6c69 6e65 2031 290a 2020  (..., line 1).  
+00017f20: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
+00017f30: 5365 7420 7468 6520 656e 7620 7661 7220  Set the env var 
+00017f40: 5059 464c 5942 595f 4c4f 475f 4c45 5645  PYFLYBY_LOG_LEVE
+00017f50: 4c3d 4445 4255 4720 746f 2064 6562 7567  L=DEBUG to debug
+00017f60: 2e0a 2020 2020 2020 2020 5b50 5946 4c59  ..        [PYFLY
+00017f70: 4259 5d20 4469 7361 626c 696e 6720 7079  BY] Disabling py
+00017f80: 666c 7962 7920 6175 746f 2069 6d70 6f72  flyby auto impor
+00017f90: 7465 722e 0a20 2020 2020 2020 202d 2d2d  ter..        ---
+00017fa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00017fb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00017fc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00017fd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00017fe0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00017ff0: 204e 616d 6545 7272 6f72 2020 2020 2020   NameError      
+00018000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018010: 2020 2020 2020 2020 2020 2054 7261 6365             Trace
+00018020: 6261 636b 2028 6d6f 7374 2072 6563 656e  back (most recen
+00018030: 7420 6361 6c6c 206c 6173 7429 0a20 2020  t call last).   
+00018040: 2020 2020 202e 2e2e 2069 6e20 2e2e 2e0a       ... in ....
+00018050: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
+00018060: 723a 206e 616d 6520 2775 6e6b 6e6f 776e  r: name 'unknown
+00018070: 5f73 796d 626f 6c5f 3638 3437 3030 3432  _symbol_68470042
+00018080: 2720 6973 206e 6f74 2064 6566 696e 6564  ' is not defined
+00018090: 0a20 2020 2020 2020 2049 6e20 5b35 5d3a  .        In [5]:
+000180a0: 2075 6e6b 6e6f 776e 5f73 796d 626f 6c5f   unknown_symbol_
+000180b0: 3736 3636 3333 3837 0a20 2020 2020 2020  76663387.       
+000180c0: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
+000180d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000180e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000180f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00018100: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
+00018110: 2020 2020 204e 616d 6545 7272 6f72 2020       NameError  
+00018120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018130: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+00018140: 7261 6365 6261 636b 2028 6d6f 7374 2072  raceback (most r
+00018150: 6563 656e 7420 6361 6c6c 206c 6173 7429  ecent call last)
+00018160: 0a20 2020 2020 2020 202e 2e2e 2069 6e20  .        ... in 
+00018170: 2e2e 2e0a 2020 2020 2020 2020 4e61 6d65  ....        Name
+00018180: 4572 726f 723a 206e 616d 6520 2775 6e6b  Error: name 'unk
+00018190: 6e6f 776e 5f73 796d 626f 6c5f 3736 3636  nown_symbol_7666
+000181a0: 3333 3837 2720 6973 206e 6f74 2064 6566  3387' is not def
+000181b0: 696e 6564 0a20 2020 2022 2222 2c0a 2020  ined.    """,.  
+000181c0: 2020 2020 2020 5059 464c 5942 595f 5041        PYFLYBY_PA
+000181d0: 5448 3d74 6d70 2e66 696c 652c 0a20 2020  TH=tmp.file,.   
+000181e0: 2029 0a0a 0a40 7265 7472 790a 6465 6620   )...@retry.def 
+000181f0: 7465 7374 5f65 7272 6f72 5f64 7572 696e  test_error_durin
+00018200: 675f 6175 746f 5f69 6d70 6f72 745f 6578  g_auto_import_ex
+00018210: 7072 6573 7369 6f6e 5f31 2874 6d70 293a  pression_1(tmp):
+00018220: 0a20 2020 2077 7269 7465 7465 7874 2874  .    writetext(t
+00018230: 6d70 2e66 696c 652c 2022 332b 2229 0a20  mp.file, "3+"). 
+00018240: 2020 2069 7079 7468 6f6e 280a 2020 2020     ipython(.    
+00018250: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00018260: 496e 205b 315d 3a20 696d 706f 7274 2070  In [1]: import p
+00018270: 7966 6c79 6279 0a20 2020 2020 2020 2049  yflyby.        I
+00018280: 6e20 5b32 5d3a 2070 7966 6c79 6279 2e65  n [2]: pyflyby.e
+00018290: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+000182a0: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
+000182b0: 205b 335d 3a20 362a 370a 2020 2020 2020   [3]: 6*7.      
+000182c0: 2020 4f75 745b 335d 3a20 3432 0a20 2020    Out[3]: 42.   
+000182d0: 2020 2020 2049 6e20 5b34 5d3a 2034 322b       In [4]: 42+
+000182e0: 756e 6b6e 6f77 6e5f 7379 6d62 6f6c 5f37  unknown_symbol_7
+000182f0: 3231 3631 3837 300a 2020 2020 2020 2020  2161870.        
+00018300: 5b50 5946 4c59 4259 5d20 5379 6e74 6178  [PYFLYBY] Syntax
+00018310: 4572 726f 723a 2057 6869 6c65 2070 6172  Error: While par
+00018320: 7369 6e67 202e 2e2e 3a20 696e 7661 6c69  sing ...: invali
+00018330: 6420 7379 6e74 6178 2028 2e2e 2e2c 206c  d syntax (..., l
+00018340: 696e 6520 3129 0a20 2020 2020 2020 205b  ine 1).        [
+00018350: 5059 464c 5942 595d 2053 6574 2074 6865  PYFLYBY] Set the
+00018360: 2065 6e76 2076 6172 2050 5946 4c59 4259   env var PYFLYBY
+00018370: 5f4c 4f47 5f4c 4556 454c 3d44 4542 5547  _LOG_LEVEL=DEBUG
+00018380: 2074 6f20 6465 6275 672e 0a20 2020 2020   to debug..     
+00018390: 2020 205b 5059 464c 5942 595d 2044 6973     [PYFLYBY] Dis
+000183a0: 6162 6c69 6e67 2070 7966 6c79 6279 2061  abling pyflyby a
+000183b0: 7574 6f20 696d 706f 7274 6572 2e0a 2020  uto importer..  
+000183c0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+000183d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000183e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000183f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00018400: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00018410: 2d0a 2020 2020 2020 2020 4e61 6d65 4572  -.        NameEr
+00018420: 726f 7220 2020 2020 2020 2020 2020 2020  ror             
+00018430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018440: 2020 2020 5472 6163 6562 6163 6b20 286d      Traceback (m
+00018450: 6f73 7420 7265 6365 6e74 2063 616c 6c20  ost recent call 
+00018460: 6c61 7374 290a 2020 2020 2020 2020 2e2e  last).        ..
+00018470: 2e20 696e 202e 2e2e 0a20 2020 2020 2020  . in ....       
+00018480: 204e 616d 6545 7272 6f72 3a20 6e61 6d65   NameError: name
+00018490: 2027 756e 6b6e 6f77 6e5f 7379 6d62 6f6c   'unknown_symbol
+000184a0: 5f37 3231 3631 3837 3027 2069 7320 6e6f  _72161870' is no
+000184b0: 7420 6465 6669 6e65 640a 2020 2020 2020  t defined.      
+000184c0: 2020 496e 205b 355d 3a20 3432 2b75 6e6b    In [5]: 42+unk
+000184d0: 6e6f 776e 5f73 796d 626f 6c5f 3438 3531  nown_symbol_4851
+000184e0: 3733 3937 0a20 2020 2020 2020 202d 2d2d  7397.        ---
+000184f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00018500: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00018510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00018520: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00018530: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00018540: 204e 616d 6545 7272 6f72 2020 2020 2020   NameError      
+00018550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018560: 2020 2020 2020 2020 2020 2054 7261 6365             Trace
+00018570: 6261 636b 2028 6d6f 7374 2072 6563 656e  back (most recen
+00018580: 7420 6361 6c6c 206c 6173 7429 0a20 2020  t call last).   
+00018590: 2020 2020 202e 2e2e 2069 6e20 2e2e 2e0a       ... in ....
+000185a0: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
+000185b0: 723a 206e 616d 6520 2775 6e6b 6e6f 776e  r: name 'unknown
+000185c0: 5f73 796d 626f 6c5f 3438 3531 3733 3937  _symbol_48517397
+000185d0: 2720 6973 206e 6f74 2064 6566 696e 6564  ' is not defined
+000185e0: 0a20 2020 2022 2222 2c0a 2020 2020 2020  .    """,.      
+000185f0: 2020 5059 464c 5942 595f 5041 5448 3d74    PYFLYBY_PATH=t
+00018600: 6d70 2e66 696c 652c 0a20 2020 2029 0a0a  mp.file,.    )..
+00018610: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
+00018620: 5f65 7272 6f72 5f64 7572 696e 675f 636f  _error_during_co
+00018630: 6d70 6c65 7469 6f6e 5f31 2866 726f 6e74  mpletion_1(front
+00018640: 656e 642c 2074 6d70 293a 0a20 2020 2069  end, tmp):.    i
+00018650: 6620 6672 6f6e 7465 6e64 203d 3d20 2270  f frontend == "p
+00018660: 726f 6d70 745f 746f 6f6c 6b69 7422 3a20  rompt_toolkit": 
+00018670: 7079 7465 7374 2e73 6b69 7028 290a 2020  pytest.skip().  
+00018680: 2020 7772 6974 6574 6578 7428 746d 702e    writetext(tmp.
+00018690: 6669 6c65 2c20 2233 2b22 290a 2020 2020  file, "3+").    
+000186a0: 6970 7974 686f 6e28 0a20 2020 2020 2020  ipython(.       
+000186b0: 2022 2222 0a20 2020 2020 2020 2049 6e20   """.        In 
+000186c0: 5b31 5d3a 2069 6d70 6f72 7420 7079 666c  [1]: import pyfl
+000186d0: 7962 790a 2020 2020 2020 2020 496e 205b  yby.        In [
+000186e0: 325d 3a20 7079 666c 7962 792e 656e 6162  2]: pyflyby.enab
+000186f0: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
+00018700: 2829 0a20 2020 2020 2020 2049 6e20 5b33  ().        In [3
+00018710: 5d3a 2031 3030 0a20 2020 2020 2020 204f  ]: 100.        O
+00018720: 7574 5b33 5d3a 2031 3030 0a20 2020 2020  ut[3]: 100.     
+00018730: 2020 2049 6e20 5b34 5d3a 2075 6e6b 6e6f     In [4]: unkno
+00018740: 776e 5f73 796d 626f 6c5f 3134 3935 3433  wn_symbol_149543
+00018750: 3034 5f5c 740a 2020 2020 2020 2020 5b50  04_\t.        [P
+00018760: 5946 4c59 4259 5d20 5379 6e74 6178 4572  YFLYBY] SyntaxEr
+00018770: 726f 723a 2057 6869 6c65 2070 6172 7369  ror: While parsi
+00018780: 6e67 202e 2e2e 3a20 696e 7661 6c69 6420  ng ...: invalid 
+00018790: 7379 6e74 6178 2028 2e2e 2e2c 206c 696e  syntax (..., lin
+000187a0: 6520 3129 0a20 2020 2020 2020 205b 5059  e 1).        [PY
+000187b0: 464c 5942 595d 2053 6574 2074 6865 2065  FLYBY] Set the e
+000187c0: 6e76 2076 6172 2050 5946 4c59 4259 5f4c  nv var PYFLYBY_L
+000187d0: 4f47 5f4c 4556 454c 3d44 4542 5547 2074  OG_LEVEL=DEBUG t
+000187e0: 6f20 6465 6275 672e 0a20 2020 2020 2020  o debug..       
+000187f0: 205b 5059 464c 5942 595d 2044 6973 6162   [PYFLYBY] Disab
+00018800: 6c69 6e67 2070 7966 6c79 6279 2061 7574  ling pyflyby aut
+00018810: 6f20 696d 706f 7274 6572 2e0a 2020 2020  o importer..    
+00018820: 2020 2020 496e 205b 345d 3a20 756e 6b6e      In [4]: unkn
+00018830: 6f77 6e5f 7379 6d62 6f6c 5f31 3439 3534  own_symbol_14954
+00018840: 3330 345f 5c78 3036 666f 6f0a 2020 2020  304_\x06foo.    
+00018850: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
+00018860: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00018870: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00018880: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00018890: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
+000188a0: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
+000188b0: 7220 2020 2020 2020 2020 2020 2020 2020  r               
+000188c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188d0: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
+000188e0: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
+000188f0: 7374 290a 2020 2020 2020 2020 2e2e 2e20  st).        ... 
+00018900: 696e 202e 2e2e 0a20 2020 2020 2020 204e  in ....        N
+00018910: 616d 6545 7272 6f72 3a20 6e61 6d65 2027  ameError: name '
+00018920: 756e 6b6e 6f77 6e5f 7379 6d62 6f6c 5f31  unknown_symbol_1
+00018930: 3439 3534 3330 345f 666f 6f27 2069 7320  4954304_foo' is 
+00018940: 6e6f 7420 6465 6669 6e65 640a 2020 2020  not defined.    
+00018950: 2020 2020 496e 205b 355d 3a20 3230 300a      In [5]: 200.
+00018960: 2020 2020 2020 2020 4f75 745b 355d 3a20          Out[5]: 
+00018970: 3230 300a 2020 2020 2020 2020 496e 205b  200.        In [
+00018980: 365d 3a20 756e 6b6e 6f77 6e5f 7379 6d62  6]: unknown_symb
+00018990: 6f6c 5f36 3936 3937 3036 365f 5c74 5c78  ol_69697066_\t\x
+000189a0: 3036 666f 6f0a 2020 2020 2020 2020 2d2d  06foo.        --
+000189b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000189c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000189d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000189e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000189f0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00018a00: 2020 4e61 6d65 4572 726f 7220 2020 2020    NameError     
+00018a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a20: 2020 2020 2020 2020 2020 2020 5472 6163              Trac
+00018a30: 6562 6163 6b20 286d 6f73 7420 7265 6365  eback (most rece
+00018a40: 6e74 2063 616c 6c20 6c61 7374 290a 2020  nt call last).  
+00018a50: 2020 2020 2020 2e2e 2e20 696e 202e 2e2e        ... in ...
+00018a60: 0a20 2020 2020 2020 204e 616d 6545 7272  .        NameErr
+00018a70: 6f72 3a20 6e61 6d65 2027 756e 6b6e 6f77  or: name 'unknow
+00018a80: 6e5f 7379 6d62 6f6c 5f36 3936 3937 3036  n_symbol_6969706
+00018a90: 365f 666f 6f27 2069 7320 6e6f 7420 6465  6_foo' is not de
+00018aa0: 6669 6e65 640a 2020 2020 2020 2020 496e  fined.        In
+00018ab0: 205b 375d 3a20 3330 300a 2020 2020 2020   [7]: 300.      
+00018ac0: 2020 4f75 745b 375d 3a20 3330 300a 2020    Out[7]: 300.  
+00018ad0: 2020 2222 222c 0a20 2020 2020 2020 2050    """,.        P
+00018ae0: 5946 4c59 4259 5f50 4154 483d 746d 702e  YFLYBY_PATH=tmp.
+00018af0: 6669 6c65 2c0a 2020 2020 2020 2020 6672  file,.        fr
+00018b00: 6f6e 7465 6e64 3d66 726f 6e74 656e 642c  ontend=frontend,
+00018b10: 0a20 2020 2029 0a0a 0a40 7265 7472 790a  .    )...@retry.
+00018b20: 6465 6620 7465 7374 5f73 796e 7461 785f  def test_syntax_
+00018b30: 6572 726f 725f 696e 5f75 7365 725f 636f  error_in_user_co
+00018b40: 6465 5f31 2829 3a0a 2020 2020 2320 5665  de_1():.    # Ve
+00018b50: 7269 6679 2074 6861 7420 7765 2064 6f6e  rify that we don
+00018b60: 2774 2069 6e61 6476 6572 7465 6e74 6c79  't inadvertently
+00018b70: 2064 6973 6162 6c65 2074 6865 2061 7574   disable the aut
+00018b80: 6f69 6d70 6f72 7465 7220 6475 6520 746f  oimporter due to
+00018b90: 0a20 2020 2023 2061 2073 796e 7461 7820  .    # a syntax 
+00018ba0: 6572 726f 7220 696e 2074 6865 2069 6e74  error in the int
+00018bb0: 6572 6163 7469 7665 2063 6f6d 6d61 6e64  eractive command
+00018bc0: 2e0a 2020 2020 6970 7974 686f 6e28 2222  ..    ipython(""
+00018bd0: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
+00018be0: 3a20 696d 706f 7274 2070 7966 6c79 6279  : import pyflyby
+00018bf0: 3b20 7079 666c 7962 792e 656e 6162 6c65  ; pyflyby.enable
+00018c00: 5f61 7574 6f5f 696d 706f 7274 6572 2829  _auto_importer()
+00018c10: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
+00018c20: 2031 2f0a 2020 2020 2020 2020 2e2e 2e2e   1/.        ....
+00018c30: 0a20 2020 2020 2020 2053 796e 7461 7845  .        SyntaxE
+00018c40: 7272 6f72 3a20 696e 7661 6c69 6420 7379  rror: invalid sy
+00018c50: 6e74 6178 0a20 2020 2020 2020 2049 6e20  ntax.        In 
+00018c60: 5b33 5d3a 2062 3634 6465 636f 6465 2822  [3]: b64decode("
+00018c70: 6257 6c6b 626d 6c6e 6148 513d 2229 0a20  bWlkbmlnaHQ="). 
+00018c80: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+00018c90: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
+00018ca0: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
+00018cb0: 2020 2020 2020 4f75 745b 335d 3a20 6227        Out[3]: b'
+00018cc0: 6d69 646e 6967 6874 270a 2020 2020 2222  midnight'.    ""
+00018cd0: 2229 0a0a 0a40 7265 7472 790a 6465 6620  ")...@retry.def 
+00018ce0: 7465 7374 5f72 756e 5f31 2874 6d70 293a  test_run_1(tmp):
+00018cf0: 0a20 2020 2023 2054 6573 7420 7468 6174  .    # Test that
+00018d00: 2025 7275 6e20 776f 726b 7320 616e 6420   %run works and 
+00018d10: 6175 746f 696d 706f 7274 732e 0a20 2020  autoimports..   
+00018d20: 2077 7269 7465 7465 7874 2874 6d70 2e66   writetext(tmp.f
+00018d30: 696c 652c 2022 2222 0a20 2020 2020 2020  ile, """.       
+00018d40: 2070 7269 6e74 2827 6865 6c6c 6f27 290a   print('hello').
+00018d50: 2020 2020 2020 2020 7072 696e 7428 6236          print(b6
+00018d60: 3464 6563 6f64 6528 2752 5856 6a62 476c  4decode('RXVjbGl
+00018d70: 6b27 292e 6465 636f 6465 2827 7574 662d  k').decode('utf-
+00018d80: 3827 2929 0a20 2020 2022 2222 290a 2020  8')).    """).  
+00018d90: 2020 6970 7974 686f 6e28 2222 220a 2020    ipython(""".  
+00018da0: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
+00018db0: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
+00018dc0: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
+00018dd0: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
+00018de0: 2020 2020 2049 6e20 5b32 5d3a 2072 756e       In [2]: run
+00018df0: 207b 746d 702e 6669 6c65 7d0a 2020 2020   {tmp.file}.    
+00018e00: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
+00018e10: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
+00018e20: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
+00018e30: 2020 2068 656c 6c6f 0a20 2020 2020 2020     hello.       
+00018e40: 2045 7563 6c69 640a 2020 2020 2222 222e   Euclid.    """.
+00018e50: 666f 726d 6174 2874 6d70 3d74 6d70 2929  format(tmp=tmp))
+00018e60: 0a0a 0a40 7265 7472 790a 6465 6620 7465  ...@retry.def te
+00018e70: 7374 5f72 756e 5f72 6570 6561 745f 3128  st_run_repeat_1(
+00018e80: 746d 7029 3a0a 2020 2020 2320 5465 7374  tmp):.    # Test
+00018e90: 2074 6861 7420 7265 7065 6174 6564 2025   that repeated %
+00018ea0: 7275 6e20 776f 726b 732c 2061 6e64 2063  run works, and c
+00018eb0: 6f6e 7469 6e75 6573 2061 7574 6f69 6d70  ontinues autoimp
+00018ec0: 6f72 7469 6e67 2c20 7369 6e63 6520 7765  orting, since we
+00018ed0: 0a20 2020 2023 2073 7461 7274 2066 726f  .    # start fro
+00018ee0: 6d20 6120 6672 6573 6820 6e61 6d65 7370  m a fresh namesp
+00018ef0: 6163 6520 6561 6368 2074 696d 6520 2873  ace each time (s
+00018f00: 696e 6365 206e 6f20 222d 6922 206f 7074  ince no "-i" opt
+00018f10: 696f 6e20 746f 2025 7275 6e29 2e0a 2020  ion to %run)..  
+00018f20: 2020 7772 6974 6574 6578 7428 746d 702e    writetext(tmp.
+00018f30: 6669 6c65 2c20 2222 220a 2020 2020 2020  file, """.      
+00018f40: 2020 7072 696e 7428 6236 3464 6563 6f64    print(b64decod
+00018f50: 6528 2751 3246 7564 4739 7927 292e 6465  e('Q2FudG9y').de
+00018f60: 636f 6465 2827 7574 662d 3827 2929 0a20  code('utf-8')). 
+00018f70: 2020 2022 2222 290a 2020 2020 6970 7974     """).    ipyt
+00018f80: 686f 6e28 2222 220a 2020 2020 2020 2020  hon(""".        
+00018f90: 496e 205b 315d 3a20 696d 706f 7274 2070  In [1]: import p
+00018fa0: 7966 6c79 6279 3b20 7079 666c 7962 792e  yflyby; pyflyby.
+00018fb0: 656e 6162 6c65 5f61 7574 6f5f 696d 706f  enable_auto_impo
+00018fc0: 7274 6572 2829 0a20 2020 2020 2020 2049  rter().        I
+00018fd0: 6e20 5b32 5d3a 2072 756e 207b 746d 702e  n [2]: run {tmp.
+00018fe0: 6669 6c65 7d0a 2020 2020 2020 2020 5b50  file}.        [P
+00018ff0: 5946 4c59 4259 5d20 6672 6f6d 2062 6173  YFLYBY] from bas
+00019000: 6536 3420 696d 706f 7274 2062 3634 6465  e64 import b64de
+00019010: 636f 6465 0a20 2020 2020 2020 2043 616e  code.        Can
+00019020: 746f 720a 2020 2020 2020 2020 496e 205b  tor.        In [
+00019030: 335d 3a20 7275 6e20 7b74 6d70 2e66 696c  3]: run {tmp.fil
+00019040: 657d 0a20 2020 2020 2020 205b 5059 464c  e}.        [PYFL
+00019050: 5942 595d 2066 726f 6d20 6261 7365 3634  YBY] from base64
+00019060: 2069 6d70 6f72 7420 6236 3464 6563 6f64   import b64decod
+00019070: 650a 2020 2020 2020 2020 4361 6e74 6f72  e.        Cantor
+00019080: 0a20 2020 2022 2222 2e66 6f72 6d61 7428  .    """.format(
+00019090: 746d 703d 746d 7029 290a 0a0a 4072 6574  tmp=tmp))...@ret
+000190a0: 7279 0a64 6566 2074 6573 745f 7275 6e5f  ry.def test_run_
+000190b0: 7365 7061 7261 7465 5f73 6372 6970 745f  separate_script_
+000190c0: 6e61 6d65 7370 6163 655f 3128 746d 7029  namespace_1(tmp)
+000190d0: 3a0a 2020 2020 2320 416e 6f74 6865 7220  :.    # Another 
+000190e0: 6578 706c 6963 6974 2074 6573 7420 7468  explicit test th
+000190f0: 6174 2077 6520 7374 6172 7420 2572 756e  at we start %run
+00019100: 2066 726f 6d20 6120 6672 6573 6820 6e61   from a fresh na
+00019110: 6d65 7370 6163 650a 2020 2020 7772 6974  mespace.    writ
+00019120: 6574 6578 7428 746d 702e 6669 6c65 2c20  etext(tmp.file, 
+00019130: 2222 220a 2020 2020 2020 2020 7072 696e  """.        prin
+00019140: 7428 6236 3464 6563 6f64 6528 2755 6d6c  t(b64decode('Uml
+00019150: 6c62 5746 7562 673d 3d27 292e 6465 636f  lbWFubg==').deco
+00019160: 6465 2827 7574 662d 3827 2929 0a20 2020  de('utf-8')).   
+00019170: 2022 2222 290a 2020 2020 6970 7974 686f   """).    ipytho
+00019180: 6e28 2222 220a 2020 2020 2020 2020 496e  n(""".        In
+00019190: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
+000191a0: 6c79 6279 3b20 7079 666c 7962 792e 656e  lyby; pyflyby.en
+000191b0: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
+000191c0: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
+000191d0: 5b32 5d3a 2062 3634 6465 636f 6465 2827  [2]: b64decode('
+000191e0: 526d 6c69 6232 3568 5932 4e70 2729 0a20  Rmlib25hY2Np'). 
+000191f0: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+00019200: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
+00019210: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
+00019220: 2020 2020 2020 4f75 745b 325d 3a20 6227        Out[2]: b'
+00019230: 4669 626f 6e61 6363 6927 0a20 2020 2020  Fibonacci'.     
+00019240: 2020 2049 6e20 5b33 5d3a 2072 756e 207b     In [3]: run {
+00019250: 746d 702e 6669 6c65 7d0a 2020 2020 2020  tmp.file}.      
+00019260: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
+00019270: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
+00019280: 3634 6465 636f 6465 0a20 2020 2020 2020  64decode.       
+00019290: 2052 6965 6d61 6e6e 0a20 2020 2022 2222   Riemann.    """
+000192a0: 2e66 6f72 6d61 7428 746d 703d 746d 7029  .format(tmp=tmp)
+000192b0: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
+000192c0: 6573 745f 7275 6e5f 7365 7061 7261 7465  est_run_separate
+000192d0: 5f73 6372 6970 745f 6e61 6d65 7370 6163  _script_namespac
+000192e0: 655f 3228 746d 7029 3a0a 2020 2020 2320  e_2(tmp):.    # 
+000192f0: 416e 6f74 6865 7220 6578 706c 6963 6974  Another explicit
+00019300: 2074 6573 7420 7468 6174 2077 6520 7374   test that we st
+00019310: 6172 7420 2572 756e 2066 726f 6d20 6120  art %run from a 
+00019320: 6672 6573 6820 6e61 6d65 7370 6163 652c  fresh namespace,
+00019330: 206e 6f74 0a20 2020 2023 2069 6e68 6572   not.    # inher
+00019340: 6974 696e 6720 6576 656e 2065 7870 6c69  iting even expli
+00019350: 6369 746c 7920 6465 6669 6e65 6420 6675  citly defined fu
+00019360: 6e63 7469 6f6e 732e 0a20 2020 2077 7269  nctions..    wri
+00019370: 7465 7465 7874 2874 6d70 2e66 696c 652c  tetext(tmp.file,
+00019380: 2022 2222 0a20 2020 2020 2020 2070 7269   """.        pri
+00019390: 6e74 2862 3634 6465 636f 6465 2827 5347  nt(b64decode('SG
+000193a0: 6c73 596d 5679 6441 3d3d 2729 2e64 6563  lsYmVydA==').dec
+000193b0: 6f64 6528 2775 7466 2d38 2729 290a 2020  ode('utf-8')).  
+000193c0: 2020 2222 2229 0a20 2020 2069 7079 7468    """).    ipyth
+000193d0: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
+000193e0: 6e20 5b31 5d3a 2069 6d70 6f72 7420 7079  n [1]: import py
+000193f0: 666c 7962 793b 2070 7966 6c79 6279 2e65  flyby; pyflyby.e
+00019400: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+00019410: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
+00019420: 205b 325d 3a20 6465 6620 6236 3464 6563   [2]: def b64dec
+00019430: 6f64 6528 7829 3a0a 2020 2020 2020 2020  ode(x):.        
+00019440: 2020 202e 2e2e 3a20 2020 2020 7265 7475     ...:     retu
+00019450: 726e 2022 626f 6f67 6572 220a 2020 2020  rn "booger".    
+00019460: 2020 2020 2020 202e 2e2e 3a0a 2020 2020         ...:.    
+00019470: 2020 2020 496e 205b 335d 3a20 6236 3464      In [3]: b64d
+00019480: 6563 6f64 6528 2778 2729 0a20 2020 2020  ecode('x').     
+00019490: 2020 204f 7574 5b33 5d3a 2027 626f 6f67     Out[3]: 'boog
+000194a0: 6572 270a 2020 2020 2020 2020 496e 205b  er'.        In [
+000194b0: 345d 3a20 7275 6e20 7b74 6d70 2e66 696c  4]: run {tmp.fil
+000194c0: 657d 0a20 2020 2020 2020 205b 5059 464c  e}.        [PYFL
+000194d0: 5942 595d 2066 726f 6d20 6261 7365 3634  YBY] from base64
+000194e0: 2069 6d70 6f72 7420 6236 3464 6563 6f64   import b64decod
+000194f0: 650a 2020 2020 2020 2020 4869 6c62 6572  e.        Hilber
+00019500: 740a 2020 2020 2222 222e 666f 726d 6174  t.    """.format
+00019510: 2874 6d70 3d74 6d70 2929 0a0a 0a40 7265  (tmp=tmp))...@re
+00019520: 7472 790a 6465 6620 7465 7374 5f72 756e  try.def test_run
+00019530: 5f6d 6f64 6966 795f 696e 7465 7261 6374  _modify_interact
+00019540: 6976 655f 6e61 6d65 7370 6163 655f 3128  ive_namespace_1(
+00019550: 746d 7029 3a0a 2020 2020 2320 5665 7269  tmp):.    # Veri
+00019560: 6679 2074 6861 7420 2572 756e 2064 6f65  fy that %run doe
+00019570: 7320 6166 6665 6374 2074 6865 2069 6e74  s affect the int
+00019580: 6572 6163 7469 7665 206e 616d 6573 7061  eractive namespa
+00019590: 6365 2e0a 2020 2020 7772 6974 6574 6578  ce..    writetex
+000195a0: 7428 746d 702e 6669 6c65 2c20 2222 220a  t(tmp.file, """.
+000195b0: 2020 2020 2020 2020 7820 3d20 6236 3464          x = b64d
+000195c0: 6563 6f64 6528 2752 6d56 7962 5746 3027  ecode('RmVybWF0'
+000195d0: 290a 2020 2020 2222 2229 0a20 2020 2069  ).    """).    i
+000195e0: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
+000195f0: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
+00019600: 7420 7079 666c 7962 793b 2070 7966 6c79  t pyflyby; pyfly
+00019610: 6279 2e65 6e61 626c 655f 6175 746f 5f69  by.enable_auto_i
+00019620: 6d70 6f72 7465 7228 290a 2020 2020 2020  mporter().      
+00019630: 2020 496e 205b 325d 3a20 7275 6e20 7b74    In [2]: run {t
+00019640: 6d70 2e66 696c 657d 0a20 2020 2020 2020  mp.file}.       
+00019650: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
+00019660: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
+00019670: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
+00019680: 496e 205b 335d 3a20 780a 2020 2020 2020  In [3]: x.      
+00019690: 2020 4f75 745b 335d 3a20 6227 4665 726d    Out[3]: b'Ferm
+000196a0: 6174 270a 2020 2020 2020 2020 496e 205b  at'.        In [
+000196b0: 345d 3a20 6236 3464 6563 6f64 6528 2754  4]: b64decode('T
+000196c0: 4746 7762 4746 6a5a 513d 3d27 290a 2020  GFwbGFjZQ==').  
+000196d0: 2020 2020 2020 4f75 745b 345d 3a20 6227        Out[4]: b'
+000196e0: 4c61 706c 6163 6527 0a20 2020 2022 2222  Laplace'.    """
+000196f0: 2e66 6f72 6d61 7428 746d 703d 746d 7029  .format(tmp=tmp)
+00019700: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
+00019710: 6573 745f 7275 6e5f 695f 6175 746f 5f69  est_run_i_auto_i
+00019720: 6d70 6f72 745f 3128 746d 7029 3a0a 2020  mport_1(tmp):.  
+00019730: 2020 2320 5665 7269 6679 2074 6861 7420    # Verify that 
+00019740: 2725 7275 6e20 2d69 2720 776f 726b 7320  '%run -i' works 
+00019750: 616e 6420 6175 746f 696d 706f 7274 732e  and autoimports.
+00019760: 0a20 2020 2077 7269 7465 7465 7874 2874  .    writetext(t
+00019770: 6d70 2e66 696c 652c 2022 2222 0a20 2020  mp.file, """.   
+00019780: 2020 2020 2070 7269 6e74 2862 3634 6465       print(b64de
+00019790: 636f 6465 2827 5247 567a 5932 4679 6447  code('RGVzY2FydG
+000197a0: 567a 2729 2e64 6563 6f64 6528 2775 7466  Vz').decode('utf
+000197b0: 2d38 2729 290a 2020 2020 2222 2229 0a20  -8')).    """). 
+000197c0: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
+000197d0: 2020 2020 2020 2049 6e20 5b31 5d3a 2069         In [1]: i
+000197e0: 6d70 6f72 7420 7079 666c 7962 793b 2070  mport pyflyby; p
+000197f0: 7966 6c79 6279 2e65 6e61 626c 655f 6175  yflyby.enable_au
+00019800: 746f 5f69 6d70 6f72 7465 7228 290a 2020  to_importer().  
+00019810: 2020 2020 2020 496e 205b 325d 3a20 7275        In [2]: ru
+00019820: 6e20 2d69 207b 746d 702e 6669 6c65 7d0a  n -i {tmp.file}.
+00019830: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
+00019840: 5d20 6672 6f6d 2062 6173 6536 3420 696d  ] from base64 im
+00019850: 706f 7274 2062 3634 6465 636f 6465 0a20  port b64decode. 
+00019860: 2020 2020 2020 2044 6573 6361 7274 6573         Descartes
+00019870: 0a20 2020 2020 2020 2049 6e20 5b33 5d3a  .        In [3]:
+00019880: 2062 3634 6465 636f 6465 2827 5232 4631   b64decode('R2F1
+00019890: 6333 4d3d 2729 0a20 2020 2020 2020 204f  c3M=').        O
+000198a0: 7574 5b33 5d3a 2062 2747 6175 7373 270a  ut[3]: b'Gauss'.
+000198b0: 2020 2020 2222 222e 666f 726d 6174 2874      """.format(t
+000198c0: 6d70 3d74 6d70 2929 0a0a 4070 7974 6573  mp=tmp))..@pytes
+000198d0: 742e 6d61 726b 2e78 6661 696c 0a64 6566  t.mark.xfail.def
+000198e0: 2074 6573 745f 7275 6e5f 645f 646f 6e74   test_run_d_dont
+000198f0: 6572 6173 6528 746d 7029 3a0a 2020 2020  erase(tmp):.    
+00019900: 2222 220a 2020 2020 6163 6365 7373 696e  """.    accessin
+00019910: 6720 665f 6c6f 6361 6c73 206d 6179 2072  g f_locals may r
+00019920: 6573 6574 206e 616d 6573 7061 6365 2c0a  eset namespace,.
+00019930: 2020 2020 6865 7265 2077 6520 6368 6563      here we chec
+00019940: 6b20 7468 6174 206d 7976 6172 2063 6861  k that myvar cha
+00019950: 6e67 6573 2061 6674 6572 2061 7373 6967  nges after assig
+00019960: 6e6d 656e 7420 696e 2074 6865 2064 6562  nment in the deb
+00019970: 7567 6765 722e 0a20 2020 2022 2222 0a20  ugger..    """. 
+00019980: 2020 2069 7079 7468 6f6e 280a 2020 2020     ipython(.    
+00019990: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000199a0: 496e 205b 315d 3a20 696d 706f 7274 2070  In [1]: import p
+000199b0: 7966 6c79 6279 3b20 7079 666c 7962 792e  yflyby; pyflyby.
+000199c0: 656e 6162 6c65 5f61 7574 6f5f 696d 706f  enable_auto_impo
+000199d0: 7274 6572 2829 0a20 2020 2020 2020 2049  rter().        I
+000199e0: 6e20 5b32 5d3a 2064 6566 2073 696d 706c  n [2]: def simpl
+000199f0: 655f 6628 293a 0a20 2020 2020 2020 2020  e_f():.         
+00019a00: 2020 2e2e 2e3a 2020 2020 206d 7976 6172    ...:     myvar
+00019a10: 203d 2031 0a20 2020 2020 2020 2020 2020   = 1.           
+00019a20: 2e2e 2e3a 2020 2020 2070 7269 6e74 286d  ...:     print(m
+00019a30: 7976 6172 290a 2020 2020 2020 2020 2020  yvar).          
+00019a40: 202e 2e2e 3a20 2020 2020 312f 300a 2020   ...:     1/0.  
+00019a50: 2020 2020 2020 2020 202e 2e2e 3a20 2020           ...:   
+00019a60: 2020 7072 696e 7428 6d79 7661 7229 0a20    print(myvar). 
+00019a70: 2020 2020 2020 2020 2020 2e2e 2e3a 2073            ...: s
+00019a80: 696d 706c 655f 6628 290a 2020 2020 2020  imple_f().      
+00019a90: 2020 2020 202e 2e2e 3a0a 2020 2020 2020       ...:.      
+00019aa0: 2020 310a 2020 2020 2020 2020 2d2d 2d2d    1.        ----
+00019ab0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00019ac0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00019ad0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00019ae0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00019af0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00019b00: 5a65 726f 4469 7669 7369 6f6e 4572 726f  ZeroDivisionErro
+00019b10: 7220 2020 2020 2020 2020 2020 2020 2020  r               
+00019b20: 2020 2020 2020 2020 2020 5472 6163 6562            Traceb
+00019b30: 6163 6b20 286d 6f73 7420 7265 6365 6e74  ack (most recent
+00019b40: 2063 616c 6c20 6c61 7374 290a 2020 2020   call last).    
+00019b50: 2020 2020 2e2e 2e20 696e 202e 2e2e 0a20      ... in .... 
+00019b60: 2020 2020 2020 2020 2020 2020 2034 2020               4  
+00019b70: 2020 2031 2f30 0a20 2020 2020 2020 2020     1/0.         
+00019b80: 2020 2020 2035 2020 2020 2070 7269 6e74       5     print
+00019b90: 286d 7976 6172 290a 2020 2020 2020 2020  (myvar).        
+00019ba0: 2e2e 2e20 696e 2073 696d 706c 655f 6628  ... in simple_f(
+00019bb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019bc0: 3220 6d79 7661 7220 3d20 310a 2020 2020  2 myvar = 1.    
+00019bd0: 2020 2020 2020 2020 2020 3320 7072 696e            3 prin
+00019be0: 7428 6d79 7661 7229 0a20 2020 2020 2020  t(myvar).       
+00019bf0: 2020 2020 2020 2035 2070 7269 6e74 286d         5 print(m
+00019c00: 7976 6172 290a 2020 2020 2020 2020 5a65  yvar).        Ze
+00019c10: 726f 4469 7669 7369 6f6e 4572 726f 723a  roDivisionError:
+00019c20: 2064 6976 6973 696f 6e20 6279 207a 6572   division by zer
+00019c30: 6f0a 2020 2020 2020 2020 496e 205b 335d  o.        In [3]
+00019c40: 3a20 2564 6562 7567 0a20 2020 2020 2020  : %debug.       
+00019c50: 203e 203c 6970 7974 686f 6e2d 696e 7075   > <ipython-inpu
+00019c60: 743e 2834 2973 696d 706c 655f 6628 290a  t>(4)simple_f().
+00019c70: 2020 2020 2020 2020 2020 2020 2020 3220                2 
+00019c80: 2020 2020 6d79 7661 7220 3d20 310a 2020      myvar = 1.  
+00019c90: 2020 2020 2020 2020 2020 2020 3320 2020              3   
+00019ca0: 2020 7072 696e 7428 6d79 7661 7229 0a20    print(myvar). 
+00019cb0: 2020 2020 2020 2020 2020 2020 2035 2020               5  
+00019cc0: 2020 2070 7269 6e74 286d 7976 6172 290a     print(myvar).
+00019cd0: 2020 2020 2020 2020 2020 2020 2020 3620                6 
+00019ce0: 7369 6d70 6c65 5f66 2829 0a20 2020 2020  simple_f().     
+00019cf0: 2020 2069 7064 623e 206d 7976 6172 0a20     ipdb> myvar. 
+00019d00: 2020 2020 2020 2031 0a20 2020 2020 2020         1.       
+00019d10: 2069 7064 623e 206d 7976 6172 203d 2032   ipdb> myvar = 2
+00019d20: 0a20 2020 2020 2020 2069 7064 623e 206d  .        ipdb> m
+00019d30: 7976 6172 0a20 2020 2020 2020 2032 0a20  yvar.        2. 
+00019d40: 2020 2020 2020 2069 7064 623e 2063 0a22         ipdb> c."
+00019d50: 2222 0a20 2020 2029 0a0a 0a40 7265 7472  "".    )...@retr
+00019d60: 790a 6465 6620 7465 7374 5f72 756e 5f69  y.def test_run_i
+00019d70: 5f61 6c72 6561 6479 5f69 6d70 6f72 7465  _already_importe
+00019d80: 645f 3128 746d 7029 3a0a 2020 2020 2320  d_1(tmp):.    # 
+00019d90: 5665 7269 6679 2074 6861 7420 2725 7275  Verify that '%ru
+00019da0: 6e20 2d69 2720 696e 6865 7269 7473 2074  n -i' inherits t
+00019db0: 6865 2069 6e74 6572 6163 7469 7665 206e  he interactive n
+00019dc0: 616d 6573 7061 6365 2e0a 2020 2020 7772  amespace..    wr
+00019dd0: 6974 6574 6578 7428 746d 702e 6669 6c65  itetext(tmp.file
+00019de0: 2c20 2222 220a 2020 2020 2020 2020 7072  , """.        pr
+00019df0: 696e 7428 6236 3464 6563 6f64 6528 6b29  int(b64decode(k)
+00019e00: 2e64 6563 6f64 6528 2775 7466 2d38 2729  .decode('utf-8')
+00019e10: 290a 2020 2020 2222 2229 0a20 2020 2069  ).    """).    i
+00019e20: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
+00019e30: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
+00019e40: 7420 7079 666c 7962 793b 2070 7966 6c79  t pyflyby; pyfly
+00019e50: 6279 2e65 6e61 626c 655f 6175 746f 5f69  by.enable_auto_i
+00019e60: 6d70 6f72 7465 7228 290a 2020 2020 2020  mporter().      
+00019e70: 2020 496e 205b 325d 3a20 6236 3464 6563    In [2]: b64dec
+00019e80: 6f64 6528 2752 334a 7664 4768 6c62 6d52  ode('R3JvdGhlbmR
+00019e90: 705a 574e 7227 290a 2020 2020 2020 2020  pZWNr').        
+00019ea0: 5b50 5946 4c59 4259 5d20 6672 6f6d 2062  [PYFLYBY] from b
+00019eb0: 6173 6536 3420 696d 706f 7274 2062 3634  ase64 import b64
+00019ec0: 6465 636f 6465 0a20 2020 2020 2020 204f  decode.        O
+00019ed0: 7574 5b32 5d3a 2062 2747 726f 7468 656e  ut[2]: b'Grothen
+00019ee0: 6469 6563 6b27 0a20 2020 2020 2020 2049  dieck'.        I
+00019ef0: 6e20 5b33 5d3a 206b 203d 2027 5158 4a6a  n [3]: k = 'QXJj
+00019f00: 6147 6c74 5a57 526c 6377 3d3d 270a 2020  aGltZWRlcw=='.  
+00019f10: 2020 2020 2020 496e 205b 345d 3a20 7275        In [4]: ru
+00019f20: 6e20 2d69 207b 746d 702e 6669 6c65 7d0a  n -i {tmp.file}.
+00019f30: 2020 2020 2020 2020 4172 6368 696d 6564          Archimed
+00019f40: 6573 0a20 2020 2022 2222 2e66 6f72 6d61  es.    """.forma
+00019f50: 7428 746d 703d 746d 7029 290a 0a0a 4072  t(tmp=tmp))...@r
+00019f60: 6574 7279 0a64 6566 2074 6573 745f 7275  etry.def test_ru
+00019f70: 6e5f 695f 7265 7065 6174 6564 5f31 2874  n_i_repeated_1(t
+00019f80: 6d70 293a 0a20 2020 2023 2056 6572 6966  mp):.    # Verif
+00019f90: 7920 7468 6174 2027 2572 756e 202d 6927  y that '%run -i'
+00019fa0: 2061 6666 6563 7473 2074 6865 206e 6578   affects the nex
+00019fb0: 7420 6e61 6d65 7370 6163 6520 6f66 2074  t namespace of t
+00019fc0: 6865 206e 6578 7420 2725 7275 6e20 2d69  he next '%run -i
+00019fd0: 272e 0a20 2020 2077 7269 7465 7465 7874  '..    writetext
+00019fe0: 2874 6d70 2e66 696c 652c 2022 2222 0a20  (tmp.file, """. 
+00019ff0: 2020 2020 2020 2070 7269 6e74 2862 3634         print(b64
+0001a000: 6465 636f 6465 2827 5332 3973 6257 396e  decode('S29sbW9n
+0001a010: 6233 4a76 6467 3d3d 2729 2e64 6563 6f64  b3Jvdg==').decod
+0001a020: 6528 2775 7466 2d38 2729 290a 2020 2020  e('utf-8')).    
+0001a030: 2222 2229 0a20 2020 2069 7079 7468 6f6e  """).    ipython
+0001a040: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
+0001a050: 5b31 5d3a 2069 6d70 6f72 7420 7079 666c  [1]: import pyfl
+0001a060: 7962 793b 2070 7966 6c79 6279 2e65 6e61  yby; pyflyby.ena
+0001a070: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
+0001a080: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
+0001a090: 325d 3a20 7275 6e20 2d69 207b 746d 702e  2]: run -i {tmp.
+0001a0a0: 6669 6c65 7d0a 2020 2020 2020 2020 5b50  file}.        [P
+0001a0b0: 5946 4c59 4259 5d20 6672 6f6d 2062 6173  YFLYBY] from bas
+0001a0c0: 6536 3420 696d 706f 7274 2062 3634 6465  e64 import b64de
+0001a0d0: 636f 6465 0a20 2020 2020 2020 204b 6f6c  code.        Kol
+0001a0e0: 6d6f 676f 726f 760a 2020 2020 2020 2020  mogorov.        
+0001a0f0: 496e 205b 335d 3a20 7275 6e20 2d69 207b  In [3]: run -i {
+0001a100: 746d 702e 6669 6c65 7d0a 2020 2020 2020  tmp.file}.      
+0001a110: 2020 4b6f 6c6d 6f67 6f72 6f76 0a20 2020    Kolmogorov.   
+0001a120: 2022 2222 2e66 6f72 6d61 7428 746d 703d   """.format(tmp=
+0001a130: 746d 7029 290a 0a0a 4072 6574 7279 0a64  tmp))...@retry.d
+0001a140: 6566 2074 6573 745f 7275 6e5f 695f 6c6f  ef test_run_i_lo
+0001a150: 6361 6c6c 795f 6465 6669 6e65 645f 3128  cally_defined_1(
+0001a160: 746d 7029 3a0a 2020 2020 2320 5665 7269  tmp):.    # Veri
+0001a170: 6679 2074 6861 7420 2725 7275 6e20 2d69  fy that '%run -i
+0001a180: 2720 6361 6e20 696e 6865 7269 7420 696e  ' can inherit in
+0001a190: 7465 7261 6374 6976 656c 7920 6465 6669  teractively defi
+0001a1a0: 6e65 6420 7379 6d62 6f6c 732e 0a20 2020  ned symbols..   
+0001a1b0: 2077 7269 7465 7465 7874 2874 6d70 2e66   writetext(tmp.f
+0001a1c0: 696c 652c 2022 2222 0a20 2020 2020 2020  ile, """.       
+0001a1d0: 2070 7269 6e74 2862 3634 6465 636f 6465   print(b64decode
+0001a1e0: 2827 7a7a 7a27 2929 0a20 2020 2022 2222  ('zzz')).    """
+0001a1f0: 290a 2020 2020 6970 7974 686f 6e28 2222  ).    ipython(""
+0001a200: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
+0001a210: 3a20 696d 706f 7274 2070 7966 6c79 6279  : import pyflyby
+0001a220: 3b20 7079 666c 7962 792e 656e 6162 6c65  ; pyflyby.enable
+0001a230: 5f61 7574 6f5f 696d 706f 7274 6572 2829  _auto_importer()
+0001a240: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
+0001a250: 2064 6566 2062 3634 6465 636f 6465 2878   def b64decode(x
+0001a260: 293a 0a20 2020 2020 2020 2020 2020 2e2e  ):.           ..
+0001a270: 2e3a 2020 2020 2072 6574 7572 6e20 2242  .:     return "B
+0001a280: 6572 6e6f 756c 6c69 220a 2020 2020 2020  ernoulli".      
+0001a290: 2020 2020 202e 2e2e 3a0a 2020 2020 2020       ...:.      
+0001a2a0: 2020 496e 205b 335d 3a20 7275 6e20 2d69    In [3]: run -i
+0001a2b0: 207b 746d 702e 6669 6c65 7d0a 2020 2020   {tmp.file}.    
+0001a2c0: 2020 2020 4265 726e 6f75 6c6c 690a 2020      Bernoulli.  
+0001a2d0: 2020 2222 222e 666f 726d 6174 2874 6d70    """.format(tmp
+0001a2e0: 3d74 6d70 2929 0a0a 0a40 7265 7472 790a  =tmp))...@retry.
+0001a2f0: 6465 6620 7465 7374 5f72 756e 5f73 796e  def test_run_syn
+0001a300: 7461 785f 6572 726f 725f 3128 746d 7029  tax_error_1(tmp)
+0001a310: 3a0a 2020 2020 2320 5665 7269 6679 2074  :.    # Verify t
+0001a320: 6861 7420 6120 7379 6e74 6178 2065 7272  hat a syntax err
+0001a330: 6f72 2069 6e20 6120 7573 6572 2d72 756e  or in a user-run
+0001a340: 2073 6372 6970 7420 646f 6573 6e27 7420   script doesn't 
+0001a350: 6166 6665 6374 0a20 2020 2023 2061 7574  affect.    # aut
+0001a360: 6f69 6d70 6f72 7465 7220 6675 6e63 7469  oimporter functi
+0001a370: 6f6e 616c 6974 792e 0a20 2020 2077 7269  onality..    wri
+0001a380: 7465 7465 7874 2874 6d70 2e66 696c 652c  tetext(tmp.file,
+0001a390: 2022 2222 0a20 2020 2020 2020 2070 7269   """.        pri
+0001a3a0: 6e74 2827 6865 6c6c 6f27 290a 2020 2020  nt('hello').    
+0001a3b0: 2020 2020 7072 696e 7428 6236 3464 6563      print(b64dec
+0001a3c0: 6f64 6528 2755 486c 3061 4746 6e62 334a  ode('UHl0aGFnb3J
+0001a3d0: 6863 773d 3d27 292e 6465 636f 6465 2827  hcw==').decode('
+0001a3e0: 7574 662d 3827 2929 0a20 2020 2020 2020  utf-8')).       
+0001a3f0: 2031 202f 0a20 2020 2022 2222 290a 2020   1 /.    """).  
+0001a400: 2020 6970 7974 686f 6e28 2222 220a 2020    ipython(""".  
+0001a410: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
+0001a420: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
+0001a430: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
+0001a440: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
+0001a450: 2020 2020 2049 6e20 5b32 5d3a 2072 756e       In [2]: run
+0001a460: 207b 746d 702e 6669 6c65 7d0a 2020 2020   {tmp.file}.    
+0001a470: 2020 2020 2e2e 2e2e 0a20 2020 2020 2020      .....       
+0001a480: 2053 796e 7461 7845 7272 6f72 3a20 696e   SyntaxError: in
+0001a490: 7661 6c69 6420 7379 6e74 6178 2e2e 2e2e  valid syntax....
+0001a4a0: 0a20 2020 2020 2020 2049 6e20 5b33 5d3a  .        In [3]:
+0001a4b0: 2062 3634 6465 636f 6465 2827 5132 3975   b64decode('Q29u
+0001a4c0: 6432 4635 2729 0a20 2020 2020 2020 205b  d2F5').        [
+0001a4d0: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
+0001a4e0: 7365 3634 2069 6d70 6f72 7420 6236 3464  se64 import b64d
+0001a4f0: 6563 6f64 650a 2020 2020 2020 2020 4f75  ecode.        Ou
+0001a500: 745b 335d 3a20 6227 436f 6e77 6179 270a  t[3]: b'Conway'.
+0001a510: 2020 2020 2222 222e 666f 726d 6174 2874      """.format(t
+0001a520: 6d70 3d74 6d70 2929 0a0a 0a40 7265 7472  mp=tmp))...@retr
+0001a530: 790a 6465 6620 7465 7374 5f72 756e 5f6e  y.def test_run_n
+0001a540: 616d 655f 6d61 696e 5f31 2874 6d70 293a  ame_main_1(tmp):
+0001a550: 0a20 2020 2023 2056 6572 6966 7920 7468  .    # Verify th
+0001a560: 6174 205f 5f6e 616d 655f 5f20 3d3d 2022  at __name__ == "
+0001a570: 5f5f 6d61 696e 5f5f 2220 696e 2061 2025  __main__" in a %
+0001a580: 7275 6e20 7363 7269 7074 2e0a 2020 2020  run script..    
+0001a590: 7772 6974 6574 6578 7428 746d 702e 6669  writetext(tmp.fi
+0001a5a0: 6c65 2c20 2222 220a 2020 2020 2020 2020  le, """.        
+0001a5b0: 7072 696e 7428 6236 3465 6e63 6f64 6528  print(b64encode(
+0001a5c0: 5f5f 6e61 6d65 5f5f 2e65 6e63 6f64 6528  __name__.encode(
+0001a5d0: 2775 7466 2d38 2729 292e 6465 636f 6465  'utf-8')).decode
+0001a5e0: 2827 7574 662d 3827 2929 0a20 2020 2022  ('utf-8')).    "
+0001a5f0: 2222 290a 2020 2020 6970 7974 686f 6e28  "").    ipython(
+0001a600: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
+0001a610: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
+0001a620: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
+0001a630: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
+0001a640: 2829 0a20 2020 2020 2020 2049 6e20 5b32  ().        In [2
+0001a650: 5d3a 2072 756e 207b 746d 702e 6669 6c65  ]: run {tmp.file
+0001a660: 7d0a 2020 2020 2020 2020 5b50 5946 4c59  }.        [PYFLY
+0001a670: 4259 5d20 6672 6f6d 2062 6173 6536 3420  BY] from base64 
+0001a680: 696d 706f 7274 2062 3634 656e 636f 6465  import b64encode
+0001a690: 0a20 2020 2020 2020 2058 3139 7459 576c  .        X19tYWl
+0001a6a0: 7558 3138 3d0a 2020 2020 2222 222e 666f  uX18=.    """.fo
+0001a6b0: 726d 6174 2874 6d70 3d74 6d70 2929 0a0a  rmat(tmp=tmp))..
+0001a6c0: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
+0001a6d0: 5f72 756e 5f6e 616d 655f 6e6f 745f 6d61  _run_name_not_ma
+0001a6e0: 696e 5f31 2874 6d70 293a 0a20 2020 2023  in_1(tmp):.    #
+0001a6f0: 2056 6572 6966 7920 7468 6174 205f 5f6e   Verify that __n
+0001a700: 616d 655f 5f20 3d3d 2062 6173 656e 616d  ame__ == basenam
+0001a710: 6528 6669 6c65 6e61 6d65 2920 7573 696e  e(filename) usin
+0001a720: 6720 2725 7275 6e20 2d6e 272e 0a20 2020  g '%run -n'..   
+0001a730: 2066 203d 2077 7269 7465 7465 7874 2874   f = writetext(t
+0001a740: 6d70 2e64 6972 2f22 6638 3135 3634 3338  mp.dir/"f8156438
+0001a750: 322e 7079 222c 2022 2222 0a20 2020 2020  2.py", """.     
+0001a760: 2020 2070 7269 6e74 2862 3634 656e 636f     print(b64enco
+0001a770: 6465 285f 5f6e 616d 655f 5f2e 656e 636f  de(__name__.enco
+0001a780: 6465 2827 7574 662d 3827 2929 2e64 6563  de('utf-8')).dec
+0001a790: 6f64 6528 2775 7466 2d38 2729 290a 2020  ode('utf-8')).  
+0001a7a0: 2020 2222 2229 0a20 2020 2069 7079 7468    """).    ipyth
+0001a7b0: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
+0001a7c0: 6e20 5b31 5d3a 2069 6d70 6f72 7420 7079  n [1]: import py
+0001a7d0: 666c 7962 793b 2070 7966 6c79 6279 2e65  flyby; pyflyby.e
+0001a7e0: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+0001a7f0: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
+0001a800: 205b 325d 3a20 7275 6e20 2d6e 207b 667d   [2]: run -n {f}
+0001a810: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
+0001a820: 595d 2066 726f 6d20 6261 7365 3634 2069  Y] from base64 i
+0001a830: 6d70 6f72 7420 6236 3465 6e63 6f64 650a  mport b64encode.
+0001a840: 2020 2020 2020 2020 5a6a 6778 4e54 5930          ZjgxNTY0
+0001a850: 4d7a 6779 0a20 2020 2022 2222 2e66 6f72  Mzgy.    """.for
+0001a860: 6d61 7428 663d 6629 290a 0a0a 4072 6574  mat(f=f))...@ret
+0001a870: 7279 0a64 6566 2074 6573 745f 7469 6d65  ry.def test_time
+0001a880: 6974 5f31 2829 3a0a 2020 2020 2320 5665  it_1():.    # Ve
+0001a890: 7269 6679 2074 6861 7420 2574 696d 6569  rify that %timei
+0001a8a0: 7420 776f 726b 732e 0a20 2020 2069 7079  t works..    ipy
+0001a8b0: 7468 6f6e 2875 2222 220a 2020 2020 2020  thon(u""".      
+0001a8c0: 2020 496e 205b 315d 3a20 696d 706f 7274    In [1]: import
+0001a8d0: 2070 7966 6c79 6279 3b20 7079 666c 7962   pyflyby; pyflyb
+0001a8e0: 792e 656e 6162 6c65 5f61 7574 6f5f 696d  y.enable_auto_im
+0001a8f0: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
+0001a900: 2049 6e20 5b32 5d3a 2025 7469 6d65 6974   In [2]: %timeit
+0001a910: 202d 6e20 3220 2d72 2031 2062 3634 6465   -n 2 -r 1 b64de
+0001a920: 636f 6465 2827 5457 6c6a 6147 5673 5957  code('TWljaGVsYW
+0001a930: 356e 5a57 7876 2729 0a20 2020 2020 2020  5nZWxv').       
+0001a940: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
+0001a950: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
+0001a960: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
+0001a970: 2e2e 2e20 7065 7220 6c6f 6f70 2028 6d65  ... per loop (me
+0001a980: 616e 20c2 b120 7374 642e 2064 6576 2e20  an .. std. dev. 
+0001a990: 6f66 2031 2072 756e 2c20 3220 6c6f 6f70  of 1 run, 2 loop
+0001a9a0: 7320 6561 6368 290a 2020 2020 2020 2020  s each).        
+0001a9b0: 496e 205b 335d 3a20 2574 696d 6569 7420  In [3]: %timeit 
+0001a9c0: 2d6e 2032 202d 7220 3120 6236 3464 6563  -n 2 -r 1 b64dec
+0001a9d0: 6f64 6528 2752 4746 3261 5751 3d27 290a  ode('RGF2aWQ=').
+0001a9e0: 2020 2020 2020 2020 2e2e 2e20 7065 7220          ... per 
+0001a9f0: 6c6f 6f70 2028 6d65 616e 20c2 b120 7374  loop (mean .. st
+0001aa00: 642e 2064 6576 2e20 6f66 2031 2072 756e  d. dev. of 1 run
+0001aa10: 2c20 3220 6c6f 6f70 7320 6561 6368 290a  , 2 loops each).
+0001aa20: 2020 2020 2222 2229 0a0a 0a40 7265 7472      """)...@retr
+0001aa30: 790a 6465 6620 7465 7374 5f74 696d 6569  y.def test_timei
+0001aa40: 745f 636f 6d70 6c65 7465 5f31 2866 726f  t_complete_1(fro
+0001aa50: 6e74 656e 6429 3a0a 2020 2020 2320 5665  ntend):.    # Ve
+0001aa60: 7269 6679 2074 6861 7420 7461 6220 636f  rify that tab co
+0001aa70: 6d70 6c65 7469 6f6e 2077 6f72 6b73 2077  mpletion works w
+0001aa80: 6974 6820 2574 696d 6569 742e 0a20 2020  ith %timeit..   
+0001aa90: 2069 7079 7468 6f6e 2875 2222 220a 2020   ipython(u""".  
+0001aaa0: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
+0001aab0: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
+0001aac0: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
+0001aad0: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
+0001aae0: 2020 2020 2049 6e20 5b32 5d3a 2025 7469       In [2]: %ti
+0001aaf0: 6d65 6974 202d 6e20 3220 2d72 2031 2062  meit -n 2 -r 1 b
+0001ab00: 3634 6465 5c74 636f 6465 2827 6347 6c73  64de\tcode('cGls
+0001ab10: 6247 3933 2729 0a20 2020 2020 2020 205b  bG93').        [
+0001ab20: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
+0001ab30: 7365 3634 2069 6d70 6f72 7420 6236 3464  se64 import b64d
+0001ab40: 6563 6f64 650a 2020 2020 2020 2020 2e2e  ecode.        ..
+0001ab50: 2e20 7065 7220 6c6f 6f70 2028 6d65 616e  . per loop (mean
+0001ab60: 20c2 b120 7374 642e 2064 6576 2e20 6f66   .. std. dev. of
+0001ab70: 2031 2072 756e 2c20 3220 6c6f 6f70 7320   1 run, 2 loops 
+0001ab80: 6561 6368 290a 2020 2020 2222 222c 2066  each).    """, f
+0001ab90: 726f 6e74 656e 643d 6672 6f6e 7465 6e64  rontend=frontend
+0001aba0: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
+0001abb0: 6573 745f 7469 6d65 6974 5f63 6f6d 706c  est_timeit_compl
+0001abc0: 6574 655f 6d65 6e75 5f31 2866 726f 6e74  ete_menu_1(front
+0001abd0: 656e 6429 3a0a 2020 2020 2320 5665 7269  end):.    # Veri
+0001abe0: 6679 2074 6861 7420 6d65 6e75 2074 6162  fy that menu tab
+0001abf0: 2063 6f6d 706c 6574 696f 6e20 776f 726b   completion work
+0001ac00: 7320 7769 7468 2025 7469 6d65 6974 2e0a  s with %timeit..
+0001ac10: 2020 2020 6966 2066 726f 6e74 656e 6420      if frontend 
+0001ac20: 3d3d 2022 7072 6f6d 7074 5f74 6f6f 6c6b  == "prompt_toolk
+0001ac30: 6974 223a 2070 7974 6573 742e 736b 6970  it": pytest.skip
+0001ac40: 2829 0a20 2020 2069 7079 7468 6f6e 2822  ().    ipython("
+0001ac50: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
+0001ac60: 5d3a 2069 6d70 6f72 7420 7079 666c 7962  ]: import pyflyb
+0001ac70: 793b 2070 7966 6c79 6279 2e65 6e61 626c  y; pyflyby.enabl
+0001ac80: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
+0001ac90: 290a 2020 2020 2020 2020 496e 205b 325d  ).        In [2]
+0001aca0: 3a20 7469 6d65 6974 202d 6e20 3220 2d72  : timeit -n 2 -r
+0001acb0: 2031 2062 3634 5c74 0a20 2020 2020 2020   1 b64\t.       
+0001acc0: 2062 3634 6465 636f 6465 2020 6236 3465   b64decode  b64e
+0001acd0: 6e63 6f64 650a 2020 2020 2020 2020 496e  ncode.        In
+0001ace0: 205b 325d 3a20 7469 6d65 6974 202d 6e20   [2]: timeit -n 
+0001acf0: 3220 2d72 2031 2062 3634 5c78 3036 645c  2 -r 1 b64\x06d\
+0001ad00: 7465 636f 6465 2827 596d 7868 626d 746c  tecode('Ymxhbmtl
+0001ad10: 6441 3d3d 2729 0a20 2020 2020 2020 205b  dA==').        [
+0001ad20: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
+0001ad30: 7365 3634 2069 6d70 6f72 7420 6236 3464  se64 import b64d
+0001ad40: 6563 6f64 650a 2020 2020 2020 2020 3220  ecode.        2 
+0001ad50: 6c6f 6f70 732c 2062 6573 7420 6f66 2031  loops, best of 1
+0001ad60: 3a20 2e2e 2e20 7065 7220 6c6f 6f70 0a20  : ... per loop. 
+0001ad70: 2020 2022 2222 2c20 6672 6f6e 7465 6e64     """, frontend
+0001ad80: 3d66 726f 6e74 656e 6429 0a0a 0a40 7265  =frontend)...@re
+0001ad90: 7472 790a 6465 6620 7465 7374 5f74 696d  try.def test_tim
+0001ada0: 6569 745f 636f 6d70 6c65 7465 5f61 7574  eit_complete_aut
+0001adb0: 6f69 6d70 6f72 745f 6d65 6d62 6572 5f31  oimport_member_1
+0001adc0: 2866 726f 6e74 656e 6429 3a0a 2020 2020  (frontend):.    
+0001add0: 6966 2066 726f 6e74 656e 6420 3d3d 2022  if frontend == "
+0001ade0: 7072 6f6d 7074 5f74 6f6f 6c6b 6974 223a  prompt_toolkit":
+0001adf0: 2070 7974 6573 742e 736b 6970 2829 0a20   pytest.skip(). 
+0001ae00: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
+0001ae10: 2020 2020 2020 2049 6e20 5b31 5d3a 2069         In [1]: i
+0001ae20: 6d70 6f72 7420 7079 666c 7962 793b 2070  mport pyflyby; p
+0001ae30: 7966 6c79 6279 2e65 6e61 626c 655f 6175  yflyby.enable_au
+0001ae40: 746f 5f69 6d70 6f72 7465 7228 290a 2020  to_importer().  
+0001ae50: 2020 2020 2020 496e 205b 325d 3a20 7469        In [2]: ti
+0001ae60: 6d65 6974 202d 6e20 3220 2d72 2031 2062  meit -n 2 -r 1 b
+0001ae70: 6173 6536 342e 6236 5c74 0a20 2020 2020  ase64.b6\t.     
+0001ae80: 2020 205b 5059 464c 5942 595d 2069 6d70     [PYFLYBY] imp
+0001ae90: 6f72 7420 6261 7365 3634 0a20 2020 2020  ort base64.     
+0001aea0: 2020 2049 6e20 5b32 5d3a 2074 696d 6569     In [2]: timei
+0001aeb0: 7420 2d6e 2032 202d 7220 3120 6261 7365  t -n 2 -r 1 base
+0001aec0: 3634 2e62 360a 2020 2020 2020 2020 6261  64.b6.        ba
+0001aed0: 7365 3634 2e62 3634 6465 636f 6465 2020  se64.b64decode  
+0001aee0: 6261 7365 3634 2e62 3634 656e 636f 6465  base64.b64encode
+0001aef0: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
+0001af00: 2074 696d 6569 7420 2d6e 2032 202d 7220   timeit -n 2 -r 
+0001af10: 3120 6261 7365 3634 2e62 3634 5c78 3036  1 base64.b64\x06
+0001af20: 6465 635c 746f 6465 2827 6257 4630 6448  dec\tode('bWF0dH
+0001af30: 4a6c 6333 4d3d 2729 0a20 2020 2020 2020  Jlc3M=').       
+0001af40: 2032 206c 6f6f 7073 2c20 6265 7374 206f   2 loops, best o
+0001af50: 6620 313a 202e 2e2e 2070 6572 206c 6f6f  f 1: ... per loo
+0001af60: 700a 2020 2020 2222 222c 2066 726f 6e74  p.    """, front
+0001af70: 656e 643d 6672 6f6e 7465 6e64 290a 0a0a  end=frontend)...
+0001af80: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
+0001af90: 6e6f 6e69 6e74 6572 6163 7469 7665 5f74  noninteractive_t
+0001afa0: 696d 6569 745f 756e 6166 6665 6374 6564  imeit_unaffected
+0001afb0: 5f31 2829 3a0a 2020 2020 2320 5665 7269  _1():.    # Veri
+0001afc0: 6679 2074 6861 7420 7468 6520 7265 6775  fy that the regu
+0001afd0: 6c61 7220 7469 6d65 6974 206d 6f64 756c  lar timeit modul
+0001afe0: 6520 6973 2075 6e61 6666 6563 7465 642c  e is unaffected,
+0001aff0: 2069 2e65 2e20 7468 6174 2077 6520 6f6e   i.e. that we on
+0001b000: 6c79 0a20 2020 2023 2068 6f6f 6b65 6420  ly.    # hooked 
+0001b010: 7468 6520 4950 7974 686f 6e20 7772 6170  the IPython wrap
+0001b020: 7065 722e 0a20 2020 2069 7079 7468 6f6e  per..    ipython
+0001b030: 280a 2020 2020 2020 2020 2222 220a 2020  (.        """.  
+0001b040: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
+0001b050: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
+0001b060: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
+0001b070: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
+0001b080: 2020 2020 2049 6e20 5b32 5d3a 2074 696d       In [2]: tim
+0001b090: 6569 742e 7469 6d65 6974 2822 6261 7365  eit.timeit("base
+0001b0a0: 3634 2e62 3634 6465 636f 6465 222c 206e  64.b64decode", n
+0001b0b0: 756d 6265 723d 3129 0a20 2020 2020 2020  umber=1).       
+0001b0c0: 205b 5059 464c 5942 595d 2069 6d70 6f72   [PYFLYBY] impor
+0001b0d0: 7420 7469 6d65 6974 0a20 2020 2020 2020  t timeit.       
+0001b0e0: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
+0001b0f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001b100: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001b110: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001b120: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
+0001b130: 2020 2020 204e 616d 6545 7272 6f72 2020       NameError  
+0001b140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b150: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+0001b160: 7261 6365 6261 636b 2028 6d6f 7374 2072  raceback (most r
+0001b170: 6563 656e 7420 6361 6c6c 206c 6173 7429  ecent call last)
+0001b180: 0a20 2020 2020 2020 202e 2e2e 2069 6e20  .        ... in 
+0001b190: 2e2e 2e0a 2020 2020 2020 2020 2e2e 2e2e  ....        ....
+0001b1a0: 0a20 2020 2020 2020 204e 616d 6545 7272  .        NameErr
+0001b1b0: 6f72 3a20 6e61 6d65 2027 6261 7365 3634  or: name 'base64
+0001b1c0: 2720 6973 206e 6f74 2064 6566 696e 6564  ' is not defined
+0001b1d0: 0a20 2020 2022 2222 0a20 2020 2029 0a0a  .    """.    )..
+0001b1e0: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
+0001b1f0: 5f74 696d 655f 3128 6672 6f6e 7465 6e64  _time_1(frontend
+0001b200: 293a 0a20 2020 2023 2056 6572 6966 7920  ):.    # Verify 
+0001b210: 7468 6174 2025 7469 6d65 2061 7574 6f69  that %time autoi
+0001b220: 6d70 6f72 7420 776f 726b 732e 0a20 2020  mport works..   
+0001b230: 2069 7079 7468 6f6e 2822 2222 0a20 2020   ipython(""".   
+0001b240: 2020 2020 2049 6e20 5b31 5d3a 2069 6d70       In [1]: imp
+0001b250: 6f72 7420 7079 666c 7962 793b 2070 7966  ort pyflyby; pyf
+0001b260: 6c79 6279 2e65 6e61 626c 655f 6175 746f  lyby.enable_auto
+0001b270: 5f69 6d70 6f72 7465 7228 290a 2020 2020  _importer().    
+0001b280: 2020 2020 496e 205b 325d 3a20 2574 696d      In [2]: %tim
+0001b290: 6520 6236 3464 6563 6f64 6528 2264 4756  e b64decode("dGV
+0001b2a0: 735a 5842 6f62 3235 6c22 290a 2020 2020  sZXBob25l").    
+0001b2b0: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
+0001b2c0: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
+0001b2d0: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
+0001b2e0: 2020 2043 5055 2074 696d 6573 3a20 2e2e     CPU times: ..
+0001b2f0: 2e0a 2020 2020 2020 2020 5761 6c6c 2074  ..        Wall t
+0001b300: 696d 653a 202e 2e2e 0a20 2020 2020 2020  ime: ....       
+0001b310: 204f 7574 5b32 5d3a 2062 2774 656c 6570   Out[2]: b'telep
+0001b320: 686f 6e65 270a 2020 2020 2222 222c 2066  hone'.    """, f
+0001b330: 726f 6e74 656e 643d 6672 6f6e 7465 6e64  rontend=frontend
+0001b340: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
+0001b350: 6573 745f 7469 6d65 5f72 6570 6561 745f  est_time_repeat_
+0001b360: 3128 6672 6f6e 7465 6e64 293a 0a20 2020  1(frontend):.   
+0001b370: 2023 2056 6572 6966 7920 7468 6174 2025   # Verify that %
+0001b380: 7469 6d65 2061 7574 6f69 6d70 6f72 7420  time autoimport 
+0001b390: 776f 726b 732e 0a20 2020 2069 7079 7468  works..    ipyth
+0001b3a0: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
+0001b3b0: 6e20 5b31 5d3a 2069 6d70 6f72 7420 7079  n [1]: import py
+0001b3c0: 666c 7962 793b 2070 7966 6c79 6279 2e65  flyby; pyflyby.e
+0001b3d0: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+0001b3e0: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
+0001b3f0: 205b 325d 3a20 2574 696d 6520 6236 3464   [2]: %time b64d
+0001b400: 6563 6f64 6528 2264 4756 735a 5764 7959  ecode("dGVsZWdyY
+0001b410: 5842 6f22 290a 2020 2020 2020 2020 5b50  XBo").        [P
+0001b420: 5946 4c59 4259 5d20 6672 6f6d 2062 6173  YFLYBY] from bas
+0001b430: 6536 3420 696d 706f 7274 2062 3634 6465  e64 import b64de
+0001b440: 636f 6465 0a20 2020 2020 2020 2043 5055  code.        CPU
+0001b450: 2074 696d 6573 3a20 2e2e 2e0a 2020 2020   times: ....    
+0001b460: 2020 2020 5761 6c6c 2074 696d 653a 202e      Wall time: .
+0001b470: 2e2e 0a20 2020 2020 2020 204f 7574 5b32  ...        Out[2
+0001b480: 5d3a 2062 2774 656c 6567 7261 7068 270a  ]: b'telegraph'.
+0001b490: 2020 2020 2020 2020 496e 205b 335d 3a20          In [3]: 
+0001b4a0: 2574 696d 6520 6236 3464 6563 6f64 6528  %time b64decode(
+0001b4b0: 225a 5731 6861 5777 3d22 290a 2020 2020  "ZW1haWw=").    
+0001b4c0: 2020 2020 4350 5520 7469 6d65 733a 202e      CPU times: .
+0001b4d0: 2e2e 0a20 2020 2020 2020 2057 616c 6c20  ...        Wall 
+0001b4e0: 7469 6d65 3a20 2e2e 2e0a 2020 2020 2020  time: ....      
+0001b4f0: 2020 4f75 745b 335d 3a20 6227 656d 6169    Out[3]: b'emai
+0001b500: 6c27 0a20 2020 2022 2222 2c20 6672 6f6e  l'.    """, fron
+0001b510: 7465 6e64 3d66 726f 6e74 656e 6429 0a0a  tend=frontend)..
+0001b520: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
+0001b530: 5f74 696d 655f 636f 6d70 6c65 7465 5f31  _time_complete_1
+0001b540: 2866 726f 6e74 656e 6429 3a0a 2020 2020  (frontend):.    
+0001b550: 2320 5665 7269 6679 2074 6861 7420 7461  # Verify that ta
+0001b560: 6220 636f 6d70 6c65 7469 6f6e 2077 6f72  b completion wor
+0001b570: 6b73 2077 6974 6820 2574 696d 652e 0a20  ks with %time.. 
+0001b580: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
+0001b590: 2020 2020 2020 2049 6e20 5b31 5d3a 2069         In [1]: i
+0001b5a0: 6d70 6f72 7420 7079 666c 7962 793b 2070  mport pyflyby; p
+0001b5b0: 7966 6c79 6279 2e65 6e61 626c 655f 6175  yflyby.enable_au
+0001b5c0: 746f 5f69 6d70 6f72 7465 7228 290a 2020  to_importer().  
+0001b5d0: 2020 2020 2020 496e 205b 325d 3a20 2574        In [2]: %t
+0001b5e0: 696d 6520 6236 3464 655c 7463 6f64 6528  ime b64de\tcode(
+0001b5f0: 2763 3268 7063 6e51 3d27 290a 2020 2020  'c2hpcnQ=').    
+0001b600: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
+0001b610: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
+0001b620: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
+0001b630: 2020 2043 5055 2074 696d 6573 3a20 2e2e     CPU times: ..
+0001b640: 2e0a 2020 2020 2020 2020 5761 6c6c 2074  ..        Wall t
+0001b650: 696d 653a 202e 2e2e 0a20 2020 2020 2020  ime: ....       
+0001b660: 204f 7574 5b32 5d3a 2062 2773 6869 7274   Out[2]: b'shirt
+0001b670: 270a 2020 2020 2222 222c 2066 726f 6e74  '.    """, front
+0001b680: 656e 643d 6672 6f6e 7465 6e64 290a 0a0a  end=frontend)...
+0001b690: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
+0001b6a0: 7469 6d65 5f63 6f6d 706c 6574 655f 6d65  time_complete_me
+0001b6b0: 6e75 5f31 2866 726f 6e74 656e 6429 3a0a  nu_1(frontend):.
+0001b6c0: 2020 2020 2320 5665 7269 6679 2074 6861      # Verify tha
+0001b6d0: 7420 6d65 6e75 2074 6162 2063 6f6d 706c  t menu tab compl
+0001b6e0: 6574 696f 6e20 776f 726b 7320 7769 7468  etion works with
+0001b6f0: 2025 7469 6d65 2e0a 2020 2020 6966 2066   %time..    if f
+0001b700: 726f 6e74 656e 6420 3d3d 2022 7072 6f6d  rontend == "prom
+0001b710: 7074 5f74 6f6f 6c6b 6974 223a 2070 7974  pt_toolkit": pyt
+0001b720: 6573 742e 736b 6970 2829 0a20 2020 2069  est.skip().    i
+0001b730: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
+0001b740: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
+0001b750: 7420 7079 666c 7962 793b 2070 7966 6c79  t pyflyby; pyfly
+0001b760: 6279 2e65 6e61 626c 655f 6175 746f 5f69  by.enable_auto_i
+0001b770: 6d70 6f72 7465 7228 290a 2020 2020 2020  mporter().      
+0001b780: 2020 496e 205b 325d 3a20 7469 6d65 2062    In [2]: time b
+0001b790: 3634 5c74 0a20 2020 2020 2020 2062 3634  64\t.        b64
+0001b7a0: 6465 636f 6465 2020 6236 3465 6e63 6f64  decode  b64encod
+0001b7b0: 650a 2020 2020 2020 2020 496e 205b 325d  e.        In [2]
+0001b7c0: 3a20 7469 6d65 2062 3634 5c78 3036 645c  : time b64\x06d\
+0001b7d0: 7465 636f 6465 2827 6347 4675 6448 4d3d  tecode('cGFudHM=
+0001b7e0: 2729 0a20 2020 2020 2020 205b 5059 464c  ').        [PYFL
+0001b7f0: 5942 595d 2066 726f 6d20 6261 7365 3634  YBY] from base64
+0001b800: 2069 6d70 6f72 7420 6236 3464 6563 6f64   import b64decod
+0001b810: 650a 2020 2020 2020 2020 4350 5520 7469  e.        CPU ti
+0001b820: 6d65 733a 202e 2e2e 0a20 2020 2020 2020  mes: ....       
+0001b830: 2057 616c 6c20 7469 6d65 3a20 2e2e 2e0a   Wall time: ....
+0001b840: 2020 2020 2020 2020 4f75 745b 325d 3a20          Out[2]: 
+0001b850: 6227 7061 6e74 7327 0a20 2020 2022 2222  b'pants'.    """
+0001b860: 2c20 6672 6f6e 7465 6e64 3d66 726f 6e74  , frontend=front
+0001b870: 656e 6429 0a0a 0a40 7265 7472 790a 6465  end)...@retry.de
+0001b880: 6620 7465 7374 5f74 696d 655f 636f 6d70  f test_time_comp
+0001b890: 6c65 7465 5f61 7574 6f69 6d70 6f72 745f  lete_autoimport_
+0001b8a0: 6d65 6d62 6572 5f31 2866 726f 6e74 656e  member_1(fronten
+0001b8b0: 6429 3a0a 2020 2020 6966 2066 726f 6e74  d):.    if front
+0001b8c0: 656e 6420 3d3d 2022 7072 6f6d 7074 5f74  end == "prompt_t
+0001b8d0: 6f6f 6c6b 6974 223a 2070 7974 6573 742e  oolkit": pytest.
+0001b8e0: 736b 6970 2829 0a20 2020 2069 7079 7468  skip().    ipyth
+0001b8f0: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
+0001b900: 6e20 5b31 5d3a 2069 6d70 6f72 7420 7079  n [1]: import py
+0001b910: 666c 7962 793b 2070 7966 6c79 6279 2e65  flyby; pyflyby.e
+0001b920: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+0001b930: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
+0001b940: 205b 325d 3a20 7469 6d65 2062 6173 6536   [2]: time base6
+0001b950: 342e 6236 5c74 0a20 2020 2020 2020 205b  4.b6\t.        [
+0001b960: 5059 464c 5942 595d 2069 6d70 6f72 7420  PYFLYBY] import 
+0001b970: 6261 7365 3634 0a20 2020 2020 2020 2049  base64.        I
+0001b980: 6e20 5b32 5d3a 2074 696d 6520 6261 7365  n [2]: time base
+0001b990: 3634 2e62 360a 2020 2020 2020 2020 6261  64.b6.        ba
+0001b9a0: 7365 3634 2e62 3634 6465 636f 6465 2020  se64.b64decode  
+0001b9b0: 6261 7365 3634 2e62 3634 656e 636f 6465  base64.b64encode
+0001b9c0: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
+0001b9d0: 2074 696d 6520 6261 7365 3634 2e62 3634   time base64.b64
+0001b9e0: 5c78 3036 6465 635c 746f 6465 2827 616d  \x06dec\tode('am
+0001b9f0: 466a 6132 5630 2729 0a20 2020 2020 2020  Fja2V0').       
+0001ba00: 2043 5055 2074 696d 6573 3a20 2e2e 2e0a   CPU times: ....
+0001ba10: 2020 2020 2020 2020 5761 6c6c 2074 696d          Wall tim
+0001ba20: 653a 202e 2e2e 0a20 2020 2020 2020 204f  e: ....        O
+0001ba30: 7574 5b32 5d3a 2062 276a 6163 6b65 7427  ut[2]: b'jacket'
+0001ba40: 0a20 2020 2022 2222 2c20 6672 6f6e 7465  .    """, fronte
+0001ba50: 6e64 3d66 726f 6e74 656e 6429 0a0a 0a40  nd=frontend)...@
+0001ba60: 7265 7472 790a 6465 6620 7465 7374 5f70  retry.def test_p
+0001ba70: 7275 6e5f 3128 293a 0a20 2020 2023 2056  run_1():.    # V
+0001ba80: 6572 6966 7920 7468 6174 2025 7072 756e  erify that %prun
+0001ba90: 2077 6f72 6b73 2c20 6175 746f 696d 706f   works, autoimpo
+0001baa0: 7274 7320 7468 6520 6669 7273 7420 7469  rts the first ti
+0001bab0: 6d65 2c20 6275 7420 6e6f 7420 7468 6520  me, but not the 
+0001bac0: 7365 636f 6e64 0a20 2020 2023 2074 696d  second.    # tim
+0001bad0: 652e 0a20 2020 2069 7079 7468 6f6e 2822  e..    ipython("
+0001bae0: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
+0001baf0: 5d3a 2069 6d70 6f72 7420 7079 666c 7962  ]: import pyflyb
+0001bb00: 793b 2070 7966 6c79 6279 2e65 6e61 626c  y; pyflyby.enabl
+0001bb10: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
+0001bb20: 290a 2020 2020 2020 2020 496e 205b 325d  ).        In [2]
+0001bb30: 3a20 2570 7275 6e20 6236 3464 6563 6f64  : %prun b64decod
+0001bb40: 6528 2252 576c 7563 3352 6c61 5734 3d22  e("RWluc3RlaW4="
+0001bb50: 290a 2020 2020 2020 2020 5b50 5946 4c59  ).        [PYFLY
+0001bb60: 4259 5d20 6672 6f6d 2062 6173 6536 3420  BY] from base64 
+0001bb70: 696d 706f 7274 2062 3634 6465 636f 6465  import b64decode
+0001bb80: 0a20 2020 2020 2020 202e 2e2e 2e20 6675  .        .... fu
+0001bb90: 6e63 7469 6f6e 2063 616c 6c73 2069 6e20  nction calls in 
+0001bba0: 2e2e 2e20 7365 636f 6e64 730a 2020 2020  ... seconds.    
+0001bbb0: 2020 2020 2e2e 2e2e 0a20 2020 2020 2020      .....       
+0001bbc0: 2049 6e20 5b33 5d3a 2062 3634 6465 636f   In [3]: b64deco
+0001bbd0: 6465 2822 5347 4633 6132 6c75 5a77 3d3d  de("SGF3a2luZw==
+0001bbe0: 2229 0a20 2020 2020 2020 204f 7574 5b33  ").        Out[3
+0001bbf0: 5d3a 2062 2748 6177 6b69 6e67 270a 2020  ]: b'Hawking'.  
+0001bc00: 2020 2020 2020 496e 205b 345d 3a20 2570        In [4]: %p
+0001bc10: 7275 6e20 6236 3464 6563 6f64 6528 2254  run b64decode("T
+0001bc20: 4739 795a 5735 3065 673d 3d22 290a 2020  G9yZW50eg==").  
+0001bc30: 2020 2020 2020 2e2e 2e2e 2066 756e 6374        .... funct
+0001bc40: 696f 6e20 6361 6c6c 7320 696e 202e 2e2e  ion calls in ...
+0001bc50: 2073 6563 6f6e 6473 0a20 2020 2020 2020   seconds.       
+0001bc60: 202e 2e2e 2e0a 2020 2020 2222 2229 0a0a   .....    """)..
+0001bc70: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
+0001bc80: 5f6e 6f6e 696e 7465 7261 6374 6976 655f  _noninteractive_
+0001bc90: 7072 6f66 696c 655f 756e 6166 6665 6374  profile_unaffect
+0001bca0: 6564 5f31 2829 3a0a 2020 2020 2320 5665  ed_1():.    # Ve
+0001bcb0: 7269 6679 2074 6861 7420 7468 6520 7072  rify that the pr
+0001bcc0: 6f66 696c 6520 6d6f 6475 6c65 2069 7473  ofile module its
+0001bcd0: 656c 6620 6973 206e 6f74 2061 6666 6563  elf is not affec
+0001bce0: 7465 6420 2869 2e65 2e20 7665 7269 6679  ted (i.e. verify
+0001bcf0: 2074 6861 740a 2020 2020 2320 7765 206f   that.    # we o
+0001bd00: 6e6c 7920 686f 6f6b 2074 6865 2049 5079  nly hook the IPy
+0001bd10: 7468 6f6e 2075 7361 6765 206f 6620 6974  thon usage of it
+0001bd20: 292e 0a20 2020 2069 7079 7468 6f6e 280a  )..    ipython(.
+0001bd30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001bd40: 2020 2020 496e 205b 315d 3a20 696d 706f      In [1]: impo
+0001bd50: 7274 2070 7966 6c79 6279 3b20 7079 666c  rt pyflyby; pyfl
+0001bd60: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
+0001bd70: 696d 706f 7274 6572 2829 0a20 2020 2020  importer().     
+0001bd80: 2020 2049 6e20 5b32 5d3a 2070 726f 6669     In [2]: profi
+0001bd90: 6c65 2e50 726f 6669 6c65 2829 2e72 756e  le.Profile().run
+0001bda0: 2822 6261 7365 3634 2e62 3634 6465 636f  ("base64.b64deco
+0001bdb0: 6465 2229 0a20 2020 2020 2020 205b 5059  de").        [PY
+0001bdc0: 464c 5942 595d 2069 6d70 6f72 7420 7072  FLYBY] import pr
+0001bdd0: 6f66 696c 650a 2020 2020 2020 2020 2d2d  ofile.        --
+0001bde0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001bdf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001be00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001be10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001be20: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+0001be30: 2020 4e61 6d65 4572 726f 7220 2020 2020    NameError     
+0001be40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be50: 2020 2020 2020 2020 2020 2020 5472 6163              Trac
+0001be60: 6562 6163 6b20 286d 6f73 7420 7265 6365  eback (most rece
+0001be70: 6e74 2063 616c 6c20 6c61 7374 290a 2020  nt call last).  
+0001be80: 2020 2020 2020 2e2e 2e20 696e 202e 2e2e        ... in ...
+0001be90: 0a20 2020 2020 2020 202e 2e2e 2e0a 2020  .        .....  
+0001bea0: 2020 2020 2020 4e61 6d65 4572 726f 723a        NameError:
+0001beb0: 206e 616d 6520 2762 6173 6536 3427 2069   name 'base64' i
+0001bec0: 7320 6e6f 7420 6465 6669 6e65 640a 2020  s not defined.  
+0001bed0: 2020 2222 220a 2020 2020 290a 0a0a 4072    """.    )...@r
+0001bee0: 6574 7279 0a64 6566 2074 6573 745f 6572  etry.def test_er
+0001bef0: 726f 725f 6475 7269 6e67 5f65 6e61 626c  ror_during_enabl
+0001bf00: 655f 3128 293a 0a20 2020 2023 2056 6572  e_1():.    # Ver
+0001bf10: 6966 7920 7468 6174 2069 6620 616e 2065  ify that if an e
+0001bf20: 7272 6f72 206f 6363 7572 7320 6475 7269  rror occurs duri
+0001bf30: 6e67 2065 6e61 626c 696e 672c 2074 6861  ng enabling, tha
+0001bf40: 7420 7765 2064 6973 6162 6c65 2074 6865  t we disable the
+0001bf50: 0a20 2020 2023 2061 7574 6f69 6d70 6f72  .    # autoimpor
+0001bf60: 7465 722e 2020 5665 7269 6679 2074 6861  ter.  Verify tha
+0001bf70: 7420 7765 2064 6f6e 2774 2061 7474 656d  t we don't attem
+0001bf80: 7074 2074 6f20 7265 2d65 6e61 626c 6520  pt to re-enable 
+0001bf90: 6167 6169 6e2e 0a20 2020 2069 7079 7468  again..    ipyth
+0001bfa0: 6f6e 280a 2020 2020 2020 2020 2222 220a  on(.        """.
+0001bfb0: 2020 2020 2020 2020 496e 205b 315d 3a20          In [1]: 
+0001bfc0: 696d 706f 7274 2070 7966 6c79 6279 0a20  import pyflyby. 
+0001bfd0: 2020 2020 2020 2049 6e20 5b32 5d3a 2070         In [2]: p
+0001bfe0: 7966 6c79 6279 2e5f 696e 7465 7261 6374  yflyby._interact
+0001bff0: 6976 652e 4175 746f 496d 706f 7274 6572  ive.AutoImporter
+0001c000: 2e5f 656e 6162 6c65 5f69 6e74 6572 6e61  ._enable_interna
+0001c010: 6c20 3d20 4e6f 6e65 0a20 2020 2020 2020  l = None.       
+0001c020: 2049 6e20 5b33 5d3a 2070 7966 6c79 6279   In [3]: pyflyby
+0001c030: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
+0001c040: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
+0001c050: 5b50 5946 4c59 4259 5d20 5479 7065 4572  [PYFLYBY] TypeEr
+0001c060: 726f 723a 2027 4e6f 6e65 5479 7065 2720  ror: 'NoneType' 
+0001c070: 6f62 6a65 6374 2069 7320 6e6f 7420 6361  object is not ca
+0001c080: 6c6c 6162 6c65 0a20 2020 2020 2020 205b  llable.        [
+0001c090: 5059 464c 5942 595d 2053 6574 2074 6865  PYFLYBY] Set the
+0001c0a0: 2065 6e76 2076 6172 2050 5946 4c59 4259   env var PYFLYBY
+0001c0b0: 5f4c 4f47 5f4c 4556 454c 3d44 4542 5547  _LOG_LEVEL=DEBUG
+0001c0c0: 2074 6f20 6465 6275 672e 0a20 2020 2020   to debug..     
+0001c0d0: 2020 205b 5059 464c 5942 595d 2044 6973     [PYFLYBY] Dis
+0001c0e0: 6162 6c69 6e67 2070 7966 6c79 6279 2061  abling pyflyby a
+0001c0f0: 7574 6f20 696d 706f 7274 6572 2e0a 2020  uto importer..  
+0001c100: 2020 2020 2020 496e 205b 345d 3a20 7072        In [4]: pr
+0001c110: 696e 7428 2768 656c 6c6f 2729 0a20 2020  int('hello').   
+0001c120: 2020 2020 2068 656c 6c6f 0a20 2020 2020       hello.     
+0001c130: 2020 2049 6e20 5b35 5d3a 2073 7973 0a20     In [5]: sys. 
+0001c140: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0001c150: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001c160: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001c170: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001c180: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001c190: 2d2d 0a20 2020 2020 2020 204e 616d 6545  --.        NameE
+0001c1a0: 7272 6f72 2020 2020 2020 2020 2020 2020  rror            
+0001c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1c0: 2020 2020 2054 7261 6365 6261 636b 2028       Traceback (
+0001c1d0: 6d6f 7374 2072 6563 656e 7420 6361 6c6c  most recent call
+0001c1e0: 206c 6173 7429 0a20 2020 2020 2020 202e   last).        .
+0001c1f0: 2e2e 2069 6e20 2e2e 2e0a 2020 2020 2020  .. in ....      
+0001c200: 2020 4e61 6d65 4572 726f 723a 206e 616d    NameError: nam
+0001c210: 6520 2773 7973 2720 6973 206e 6f74 2064  e 'sys' is not d
+0001c220: 6566 696e 6564 0a20 2020 2020 2020 2049  efined.        I
+0001c230: 6e20 5b36 5d3a 2070 7966 6c79 6279 2e65  n [6]: pyflyby.e
+0001c240: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+0001c250: 7465 7228 290a 2020 2020 2020 2020 5b50  ter().        [P
+0001c260: 5946 4c59 4259 5d20 4e6f 7420 7265 6174  YFLYBY] Not reat
+0001c270: 7465 6d70 7469 6e67 2074 6f20 656e 6162  tempting to enab
+0001c280: 6c65 2061 7574 6f20 696d 706f 7274 6572  le auto importer
+0001c290: 2061 6674 6572 2065 6172 6c69 6572 2065   after earlier e
+0001c2a0: 7272 6f72 0a20 2020 2022 2222 0a20 2020  rror.    """.   
+0001c2b0: 2029 0a0a 0a73 6b69 7069 665f 6970 7974   )...skipif_ipyt
+0001c2c0: 686f 6e5f 746f 6f5f 6f6c 645f 666f 725f  hon_too_old_for_
+0001c2d0: 6b65 726e 656c 203d 2070 7974 6573 742e  kernel = pytest.
+0001c2e0: 6d61 726b 2e73 6b69 7069 6628 0a20 2020  mark.skipif(.   
+0001c2f0: 205f 4950 5954 484f 4e5f 5645 5253 494f   _IPYTHON_VERSIO
+0001c300: 4e20 3c20 2830 2c20 3132 292c 0a20 2020  N < (0, 12),.   
+0001c310: 2072 6561 736f 6e3d 2249 5079 7468 6f6e   reason="IPython
+0001c320: 2076 6572 7369 6f6e 2025 7320 646f 6573   version %s does
+0001c330: 206e 6f74 2073 7570 706f 7274 206b 6572   not support ker
+0001c340: 6e65 6c2c 2073 6f20 6e6f 7468 696e 6720  nel, so nothing 
+0001c350: 746f 2074 6573 7422 290a 0a23 2057 6520  to test")..# We 
+0001c360: 636f 756c 6420 7772 6974 6520 746f 206a  could write to j
+0001c370: 7570 7974 6572 5f63 6f6e 736f 6c65 5f63  upyter_console_c
+0001c380: 6f6e 6669 672e 7079 2061 6e64 2073 6574  onfig.py and set
+0001c390: 204a 5550 5954 4552 5f43 4f4e 4649 475f   JUPYTER_CONFIG_
+0001c3a0: 4449 522c 2062 7574 0a23 2069 7420 6f6e  DIR, but.# it on
+0001c3b0: 6c79 2073 7570 706f 7274 7320 6869 6768  ly supports high
+0001c3c0: 6c69 6768 745f 6d61 7463 6869 6e67 5f62  light_matching_b
+0001c3d0: 7261 636b 6574 732c 206e 6f74 0a23 2064  rackets, not.# d
+0001c3e0: 6973 706c 6179 5f63 6f6d 706c 6574 696f  isplay_completio
+0001c3f0: 6e73 3d27 7265 6164 6c69 6e65 6c69 6b65  ns='readlinelike
+0001c400: 272c 2073 6f20 616e 7920 7465 7374 2074  ', so any test t
+0001c410: 6861 7420 7573 6573 2074 6162 2063 6f6d  hat uses tab com
+0001c420: 706c 6574 696f 6e0a 2320 776f 6e27 7420  pletion.# won't 
+0001c430: 776f 726b 2e0a 0a0a 4073 6b69 7069 665f  work....@skipif_
+0001c440: 6970 7974 686f 6e5f 746f 6f5f 6f6c 645f  ipython_too_old_
+0001c450: 666f 725f 6b65 726e 656c 0a23 2040 7265  for_kernel.# @re
+0001c460: 7472 7928 4578 7065 6374 4572 726f 7229  try(ExpectError)
+0001c470: 0a40 7079 7465 7374 2e6d 6172 6b2e 7866  .@pytest.mark.xf
+0001c480: 6169 6c28 0a20 2020 2073 7973 2e76 6572  ail(.    sys.ver
+0001c490: 7369 6f6e 5f69 6e66 6f5b 305d 203d 3d20  sion_info[0] == 
+0001c4a0: 332c 0a20 2020 2072 6561 736f 6e3d 224e  3,.    reason="N
+0001c4b0: 6565 6420 6e65 7765 7220 7665 7273 696f  eed newer versio
+0001c4c0: 6e20 6f66 206a 7570 7974 6572 5f63 6f6e  n of jupyter_con
+0001c4d0: 736f 6c65 203e 2036 2e34 2e31 206d 6179  sole > 6.4.1 may
+0001c4e0: 6265 203f 2043 6f72 6f75 7469 6e65 206e  be ? Coroutine n
+0001c4f0: 6f74 2061 7761 6974 6564 222c 0a20 2020  ot awaited",.   
+0001c500: 2073 7472 6963 743d 4661 6c73 652c 0a29   strict=False,.)
+0001c510: 0a40 7079 7465 7374 2e6d 6172 6b2e 7061  .@pytest.mark.pa
+0001c520: 7261 6d65 7472 697a 6528 2773 656e 6465  rametrize('sende
+0001c530: 6f66 272c 205b 4661 6c73 652c 2054 7275  of', [False, Tru
+0001c540: 655d 290a 6465 6620 7465 7374 5f69 7079  e]).def test_ipy
+0001c550: 7468 6f6e 5f63 6f6e 736f 6c65 5f31 2873  thon_console_1(s
+0001c560: 656e 6465 6f66 293a 0a20 2020 2023 2056  endeof):.    # V
+0001c570: 6572 6966 7920 7468 6174 2061 7574 6f69  erify that autoi
+0001c580: 6d70 6f72 7420 616e 6420 7461 6220 636f  mport and tab co
+0001c590: 6d70 6c65 7469 6f6e 2077 6f72 6b20 696e  mpletion work in
+0001c5a0: 2049 5079 7468 6f6e 2063 6f6e 736f 6c65   IPython console
+0001c5b0: 2e0a 2020 2020 2320 5765 2072 6574 7279  ..    # We retry
+0001c5c0: 2061 2066 6577 2074 696d 6573 2075 6e74   a few times unt
+0001c5d0: 696c 2073 7563 6365 7373 2028 7669 6120  il success (via 
+0001c5e0: 7468 6520 4072 6574 7279 2064 6563 6f72  the @retry decor
+0001c5f0: 6174 6f72 2920 6265 6361 7573 650a 2020  ator) because.  
+0001c600: 2020 2320 666f 7220 736f 6d65 2076 6572    # for some ver
+0001c610: 7369 6f6e 7320 6f66 2069 7079 7468 6f6e  sions of ipython
+0001c620: 2c20 696e 2073 6f6d 6520 636f 6e66 6967  , in some config
+0001c630: 7572 6174 696f 6e73 2c20 2769 7079 7468  urations, 'ipyth
+0001c640: 6f6e 2063 6f6e 736f 6c65 270a 2020 2020  on console'.    
+0001c650: 2320 6f63 6361 7369 6f6e 616c 6c79 2068  # occasionally h
+0001c660: 616e 6773 206f 6e20 7374 6172 7475 703b  angs on startup;
+0001c670: 206e 6f74 2073 7572 6520 7768 792c 2062   not sure why, b
+0001c680: 7574 2069 7420 7365 656d 7320 756e 7265  ut it seems unre
+0001c690: 6c61 7465 6420 746f 0a20 2020 2023 2070  lated to.    # p
+0001c6a0: 7966 6c79 6279 2c20 7369 6e63 6520 6974  yflyby, since it
+0001c6b0: 2068 6170 7065 6e73 2062 6566 6f72 6520   happens before 
+0001c6c0: 616e 7920 7079 666c 7962 7920 636f 6d6d  any pyflyby comm
+0001c6d0: 616e 6473 2e0a 2020 2020 2320 5468 6520  ands..    # The 
+0001c6e0: 7265 6173 6f6e 2066 6f72 2074 6865 2027  reason for the '
+0001c6f0: 496e 205b 315d 3a20 7820 3d20 3931 3937  In [1]: x = 9197
+0001c700: 3630 3132 2720 6973 2074 6f20 6d61 6b65  6012' is to make
+0001c710: 2074 6869 7320 7465 7374 206d 6f72 650a   this test more.
+0001c720: 2020 2020 2320 726f 6275 7374 2069 6e20      # robust in 
+0001c730: 6f6c 6465 7220 7665 7273 696f 6e73 206f  older versions o
+0001c740: 6620 4950 7974 686f 6e2e 2020 496e 2073  f IPython.  In s
+0001c750: 6f6d 6520 7665 7273 696f 6e73 2028 302e  ome versions (0.
+0001c760: 7829 2c20 4950 7974 686f 6e0a 2020 2020  x), IPython.    
+0001c770: 2320 636f 6e73 6f6c 6520 6f63 6361 7369  # console occasi
+0001c780: 6f6e 616c 6c79 2064 6f65 736e 2774 2070  onally doesn't p
+0001c790: 7269 6e74 2074 6865 2066 6972 7374 206f  rint the first o
+0001c7a0: 7574 7075 7420 2869 2e65 2e20 4f75 745b  utput (i.e. Out[
+0001c7b0: 315d 292e 2020 5765 0a20 2020 2023 2077  1]).  We.    # w
+0001c7c0: 6f72 6b20 6172 6f75 6e64 2074 6869 7320  ork around this 
+0001c7d0: 6279 2066 6972 7374 2072 756e 6e69 6e67  by first running
+0001c7e0: 2073 6f6d 6574 6869 6e67 2077 6865 7265   something where
+0001c7f0: 2077 6520 646f 6e27 7420 6578 7065 6374   we don't expect
+0001c800: 2061 6e0a 2020 2020 2320 4f75 745b 315d   an.    # Out[1]
+0001c810: 2e0a 2020 2020 6966 2073 656e 6465 6f66  ..    if sendeof
+0001c820: 2061 6e64 205f 4950 5954 484f 4e5f 5645   and _IPYTHON_VE
+0001c830: 5253 494f 4e20 3e3d 2028 352c 293a 2070  RSION >= (5,): p
+0001c840: 7974 6573 742e 736b 6970 2829 0a20 2020  ytest.skip().   
+0001c850: 2069 7079 7468 6f6e 2822 2222 0a20 2020   ipython(""".   
+0001c860: 2020 2020 2049 6e20 5b31 5d3a 2078 203d       In [1]: x =
+0001c870: 2039 3139 3736 3031 320a 2020 2020 2020   91976012.      
+0001c880: 2020 496e 205b 325d 3a20 2761 636f 726e    In [2]: 'acorn
+0001c890: 270a 2020 2020 2020 2020 4f75 745b 325d  '.        Out[2]
+0001c8a0: 3a20 2761 636f 726e 270a 2020 2020 2020  : 'acorn'.      
+0001c8b0: 2020 496e 205b 335d 3a20 696d 706f 7274    In [3]: import
+0001c8c0: 2070 7966 6c79 6279 3b20 7079 666c 7962   pyflyby; pyflyb
+0001c8d0: 792e 656e 6162 6c65 5f61 7574 6f5f 696d  y.enable_auto_im
+0001c8e0: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
+0001c8f0: 2049 6e20 5b34 5d3a 2062 3634 6465 636f   In [4]: b64deco
+0001c900: 5c74 6465 2827 6347 5668 626e 5630 2729  \tde('cGVhbnV0')
+0001c910: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
+0001c920: 595d 2066 726f 6d20 6261 7365 3634 2069  Y] from base64 i
+0001c930: 6d70 6f72 7420 6236 3464 6563 6f64 650a  mport b64decode.
+0001c940: 2020 2020 2020 2020 4f75 745b 345d 3a20          Out[4]: 
+0001c950: 6227 7065 616e 7574 270a 2020 2020 2222  b'peanut'.    ""
+0001c960: 222c 2061 7267 733d 2763 6f6e 736f 6c65  ", args='console
+0001c970: 272c 2073 656e 6465 6f66 3d73 656e 6465  ', sendeof=sende
+0001c980: 6f66 290a 0a0a 4073 6b69 7069 665f 6970  of)...@skipif_ip
+0001c990: 7974 686f 6e5f 746f 6f5f 6f6c 645f 666f  ython_too_old_fo
+0001c9a0: 725f 6b65 726e 656c 0a40 7079 7465 7374  r_kernel.@pytest
+0001c9b0: 2e6d 6172 6b2e 7866 6169 6c28 0a20 2020  .mark.xfail(.   
+0001c9c0: 2073 7973 2e76 6572 7369 6f6e 5f69 6e66   sys.version_inf
+0001c9d0: 6f5b 305d 203d 3d20 332c 0a20 2020 2072  o[0] == 3,.    r
+0001c9e0: 6561 736f 6e3d 224e 6565 6420 6e65 7765  eason="Need newe
+0001c9f0: 7220 7665 7273 696f 6e20 6f66 206a 7570  r version of jup
+0001ca00: 7974 6572 5f63 6f6e 736f 6c65 203e 2036  yter_console > 6
+0001ca10: 2e34 2e31 206d 6179 6265 203f 2043 6f72  .4.1 maybe ? Cor
+0001ca20: 6f75 7469 6e65 206e 6f74 2061 7761 6974  outine not await
+0001ca30: 6564 222c 0a20 2020 2073 7472 6963 743d  ed",.    strict=
+0001ca40: 4661 6c73 652c 0a29 0a40 7265 7472 790a  False,.).@retry.
+0001ca50: 6465 6620 7465 7374 5f69 7079 7468 6f6e  def test_ipython
+0001ca60: 5f6b 6572 6e65 6c5f 636f 6e73 6f6c 655f  _kernel_console_
+0001ca70: 6578 6973 7469 6e67 5f31 2829 3a0a 2020  existing_1():.  
+0001ca80: 2020 2320 5665 7269 6679 2074 6861 7420    # Verify that 
+0001ca90: 6175 746f 696d 706f 7274 2061 6e64 2074  autoimport and t
+0001caa0: 6162 2063 6f6d 706c 6574 696f 6e20 776f  ab completion wo
+0001cab0: 726b 2069 6e20 4950 7974 686f 6e20 636f  rk in IPython co
+0001cac0: 6e73 6f6c 652c 2077 6865 6e0a 2020 2020  nsole, when.    
+0001cad0: 2320 7374 6172 7465 6420 696e 6465 7065  # started indepe
+0001cae0: 6e64 656e 746c 792e 0a20 2020 2023 2053  ndently..    # S
+0001caf0: 7461 7274 2022 4950 7974 686f 6e20 6b65  tart "IPython ke
+0001cb00: 726e 656c 222e 0a20 2020 2077 6974 6820  rnel"..    with 
+0001cb10: 4950 7974 686f 6e4b 6572 6e65 6c43 7478  IPythonKernelCtx
+0001cb20: 2829 2061 7320 6b65 726e 656c 3a0a 2020  () as kernel:.  
+0001cb30: 2020 2020 2020 2320 5374 6172 7420 6120        # Start a 
+0001cb40: 7365 7061 7261 7465 2022 6970 7974 686f  separate "ipytho
+0001cb50: 6e20 636f 6e73 6f6c 6520 2d2d 6578 6973  n console --exis
+0001cb60: 7469 6e67 206b 6572 6e65 6c2d 3132 3334  ting kernel-1234
+0001cb70: 2e6a 736f 6e22 2e0a 2020 2020 2020 2020  .json"..        
+0001cb80: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
+0001cb90: 2020 2020 2020 2020 496e 205b 315d 3a20          In [1]: 
+0001cba0: 696d 706f 7274 2070 7966 6c79 6279 3b20  import pyflyby; 
+0001cbb0: 7079 666c 7962 792e 656e 6162 6c65 5f61  pyflyby.enable_a
+0001cbc0: 7574 6f5f 696d 706f 7274 6572 2829 0a20  uto_importer(). 
+0001cbd0: 2020 2020 2020 2020 2020 2049 6e20 5b32             In [2
+0001cbe0: 5d3a 2062 3634 6465 636f 5c74 6465 2827  ]: b64deco\tde('
+0001cbf0: 6247 566e 6457 316c 2729 0a20 2020 2020  bGVndW1l').     
+0001cc00: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+0001cc10: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
+0001cc20: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
+0001cc30: 2020 2020 2020 2020 2020 4f75 745b 325d            Out[2]
+0001cc40: 3a20 6227 6c65 6775 6d65 270a 2020 2020  : b'legume'.    
+0001cc50: 2020 2020 2222 222c 2061 7267 733d 5b27      """, args=['
+0001cc60: 636f 6e73 6f6c 6527 5d2c 206b 6572 6e65  console'], kerne
+0001cc70: 6c3d 6b65 726e 656c 290a 0a0a 4073 6b69  l=kernel)...@ski
+0001cc80: 7069 665f 6970 7974 686f 6e5f 746f 6f5f  pif_ipython_too_
+0001cc90: 6f6c 645f 666f 725f 6b65 726e 656c 0a40  old_for_kernel.@
+0001cca0: 7079 7465 7374 2e6d 6172 6b2e 7866 6169  pytest.mark.xfai
+0001ccb0: 6c28 0a20 2020 2073 7973 2e76 6572 7369  l(.    sys.versi
+0001ccc0: 6f6e 5f69 6e66 6f5b 305d 203d 3d20 332c  on_info[0] == 3,
+0001ccd0: 0a20 2020 2072 6561 736f 6e3d 224e 6565  .    reason="Nee
+0001cce0: 6420 6e65 7765 7220 7665 7273 696f 6e20  d newer version 
+0001ccf0: 6f66 206a 7570 7974 6572 5f63 6f6e 736f  of jupyter_conso
+0001cd00: 6c65 203e 2036 2e34 2e31 206d 6179 6265  le > 6.4.1 maybe
+0001cd10: 203f 2043 6f72 6f75 7469 6e65 206e 6f74   ? Coroutine not
+0001cd20: 2061 7761 6974 6564 222c 0a20 2020 2073   awaited",.    s
+0001cd30: 7472 6963 743d 4661 6c73 652c 0a29 0a40  trict=False,.).@
+0001cd40: 7265 7472 790a 6465 6620 7465 7374 5f69  retry.def test_i
+0001cd50: 7079 7468 6f6e 5f6b 6572 6e65 6c5f 636f  python_kernel_co
+0001cd60: 6e73 6f6c 655f 6d75 6c74 6970 6c65 5f65  nsole_multiple_e
+0001cd70: 7869 7374 696e 675f 3128 293a 0a20 2020  xisting_1():.   
+0001cd80: 2023 2056 6572 6966 7920 7468 6174 2061   # Verify that a
+0001cd90: 7574 6f69 6d70 6f72 7420 616e 6420 7461  utoimport and ta
+0001cda0: 6220 636f 6d70 6c65 7469 6f6e 2077 6f72  b completion wor
+0001cdb0: 6b20 696e 2049 5079 7468 6f6e 2063 6f6e  k in IPython con
+0001cdc0: 736f 6c65 2c20 7768 656e 0a20 2020 2023  sole, when.    #
+0001cdd0: 2074 6865 2061 7574 6f20 696d 706f 7274   the auto import
+0001cde0: 6572 2069 7320 656e 6162 6c65 6420 6672  er is enabled fr
+0001cdf0: 6f6d 2061 2064 6966 6665 7265 6e74 2063  om a different c
+0001ce00: 6f6e 736f 6c65 2e0a 2020 2020 2320 5374  onsole..    # St
+0001ce10: 6172 7420 2249 5079 7468 6f6e 206b 6572  art "IPython ker
+0001ce20: 6e65 6c22 2e0a 2020 2020 7769 7468 2049  nel"..    with I
+0001ce30: 5079 7468 6f6e 4b65 726e 656c 4374 7828  PythonKernelCtx(
+0001ce40: 2920 6173 206b 6572 6e65 6c3a 0a20 2020  ) as kernel:.   
+0001ce50: 2020 2020 2023 2053 7461 7274 2061 2073       # Start a s
+0001ce60: 6570 6172 6174 6520 2269 7079 7468 6f6e  eparate "ipython
+0001ce70: 2063 6f6e 736f 6c65 202d 2d65 7869 7374   console --exist
+0001ce80: 696e 6720 6b65 726e 656c 2d31 3233 342e  ing kernel-1234.
+0001ce90: 6a73 6f6e 222e 0a20 2020 2020 2020 2023  json"..        #
+0001cea0: 2056 6572 6966 7920 7468 6174 2074 6865   Verify that the
+0001ceb0: 2061 7574 6f20 696d 706f 7274 6572 2069   auto importer i
+0001cec0: 736e 2774 2065 6e61 626c 6564 2079 6574  sn't enabled yet
+0001ced0: 2e0a 2020 2020 2020 2020 6970 7974 686f  ..        ipytho
+0001cee0: 6e28 0a20 2020 2020 2020 2020 2020 2022  n(.            "
+0001cef0: 2222 0a20 2020 2020 2020 2020 2020 2049  "".            I
+0001cf00: 6e20 5b31 5d3a 2062 3634 6465 636f 6465  n [1]: b64decode
+0001cf10: 2827 7827 290a 2020 2020 2020 2020 2020  ('x').          
+0001cf20: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d    --------------
+0001cf30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001cf40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001cf50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001cf60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
+0001cf70: 2020 2020 2020 2020 2020 4e61 6d65 4572            NameEr
+0001cf80: 726f 7220 2020 2020 2020 2020 2020 2020  ror             
+0001cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfa0: 2020 2020 5472 6163 6562 6163 6b20 286d      Traceback (m
+0001cfb0: 6f73 7420 7265 6365 6e74 2063 616c 6c20  ost recent call 
+0001cfc0: 6c61 7374 290a 2020 2020 2020 2020 2020  last).          
+0001cfd0: 2020 2e2e 2e20 696e 202e 2e2e 0a20 2020    ... in ....   
+0001cfe0: 2020 2020 2020 2020 204e 616d 6545 7272           NameErr
+0001cff0: 6f72 3a20 6e61 6d65 2027 6236 3464 6563  or: name 'b64dec
+0001d000: 6f64 6527 2069 7320 6e6f 7420 6465 6669  ode' is not defi
+0001d010: 6e65 640a 2020 2020 2020 2020 2222 222c  ned.        """,
+0001d020: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
+0001d030: 733d 5b22 636f 6e73 6f6c 6522 5d2c 0a20  s=["console"],. 
+0001d040: 2020 2020 2020 2020 2020 206b 6572 6e65             kerne
+0001d050: 6c3d 6b65 726e 656c 2c0a 2020 2020 2020  l=kernel,.      
+0001d060: 2020 290a 2020 2020 2020 2020 2320 456e    ).        # En
+0001d070: 6162 6c65 2074 6865 2061 7574 6f20 696d  able the auto im
+0001d080: 706f 7274 6572 2e0a 2020 2020 2020 2020  porter..        
+0001d090: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
+0001d0a0: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
+0001d0b0: 696d 706f 7274 2070 7966 6c79 6279 3b20  import pyflyby; 
+0001d0c0: 7079 666c 7962 792e 656e 6162 6c65 5f61  pyflyby.enable_a
+0001d0d0: 7574 6f5f 696d 706f 7274 6572 2829 0a20  uto_importer(). 
+0001d0e0: 2020 2020 2020 2022 2222 2c20 6172 6773         """, args
+0001d0f0: 3d5b 2763 6f6e 736f 6c65 275d 2c20 6b65  =['console'], ke
+0001d100: 726e 656c 3d6b 6572 6e65 6c29 0a20 2020  rnel=kernel).   
+0001d110: 2020 2020 2023 2056 6572 6966 7920 7468       # Verify th
+0001d120: 6174 2074 6865 2061 7574 6f20 696d 706f  at the auto impo
+0001d130: 7274 6572 2061 6e64 2074 6162 2063 6f6d  rter and tab com
+0001d140: 706c 6574 696f 6e20 776f 726b 2e0a 2020  pletion work..  
+0001d150: 2020 2020 2020 6970 7974 686f 6e28 2222        ipython(""
+0001d160: 220a 2020 2020 2020 2020 2020 2020 496e  ".            In
+0001d170: 205b 335d 3a20 6236 3464 6563 6f5c 7464   [3]: b64deco\td
+0001d180: 6528 2759 5778 7462 3235 6b27 290a 2020  e('YWxtb25k').  
+0001d190: 2020 2020 2020 2020 2020 5b50 5946 4c59            [PYFLY
+0001d1a0: 4259 5d20 6672 6f6d 2062 6173 6536 3420  BY] from base64 
+0001d1b0: 696d 706f 7274 2062 3634 6465 636f 6465  import b64decode
+0001d1c0: 0a20 2020 2020 2020 2020 2020 204f 7574  .            Out
+0001d1d0: 5b33 5d3a 2062 2761 6c6d 6f6e 6427 0a20  [3]: b'almond'. 
+0001d1e0: 2020 2020 2020 2022 2222 2c20 6172 6773         """, args
+0001d1f0: 3d5b 2763 6f6e 736f 6c65 275d 2c20 6b65  =['console'], ke
+0001d200: 726e 656c 3d6b 6572 6e65 6c29 0a0a 0a40  rnel=kernel)...@
+0001d210: 7079 7465 7374 2e6d 6172 6b2e 736b 6970  pytest.mark.skip
+0001d220: 2872 6561 736f 6e3d 2268 616e 6773 2229  (reason="hangs")
+0001d230: 0a40 736b 6970 6966 5f69 7079 7468 6f6e  .@skipif_ipython
+0001d240: 5f74 6f6f 5f6f 6c64 5f66 6f72 5f6b 6572  _too_old_for_ker
+0001d250: 6e65 6c0a 4072 6574 7279 0a64 6566 2074  nel.@retry.def t
+0001d260: 6573 745f 6970 7974 686f 6e5f 6e6f 7465  est_ipython_note
+0001d270: 626f 6f6b 5f62 6173 6963 5f31 2829 3a0a  book_basic_1():.
+0001d280: 2020 2020 7769 7468 2049 5079 7468 6f6e      with IPython
+0001d290: 4e6f 7465 626f 6f6b 4374 7828 2920 6173  NotebookCtx() as
+0001d2a0: 206b 6572 6e65 6c3a 0a20 2020 2020 2020   kernel:.       
+0001d2b0: 2069 7079 7468 6f6e 280a 2020 2020 2020   ipython(.      
+0001d2c0: 2020 2020 2020 2320 5665 7269 6679 2074        # Verify t
+0001d2d0: 6861 7420 7468 6520 6175 746f 2069 6d70  hat the auto imp
+0001d2e0: 6f72 7465 7220 6973 6e27 7420 656e 6162  orter isn't enab
+0001d2f0: 6c65 6420 7965 742e 0a20 2020 2020 2020  led yet..       
+0001d300: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001d310: 2020 2020 2049 6e20 5b31 5d3a 2033 2b34       In [1]: 3+4
+0001d320: 0a20 2020 2020 2020 2020 2020 204f 7574  .            Out
+0001d330: 5b31 5d3a 2037 0a20 2020 2020 2020 2020  [1]: 7.         
+0001d340: 2020 2049 6e20 5b32 5d3a 2033 332b 3434     In [2]: 33+44
+0001d350: 0a20 2020 2020 2020 2020 2020 204f 7574  .            Out
+0001d360: 5b32 5d3a 2037 370a 2020 2020 2020 2020  [2]: 77.        
+0001d370: 2020 2020 2222 222c 2061 7267 733d 5b27      """, args=['
+0001d380: 636f 6e73 6f6c 6527 5d2c 206b 6572 6e65  console'], kerne
+0001d390: 6c3d 6b65 726e 656c 290a 0a40 736b 6970  l=kernel)..@skip
+0001d3a0: 6966 5f69 7079 7468 6f6e 5f74 6f6f 5f6f  if_ipython_too_o
+0001d3b0: 6c64 5f66 6f72 5f6b 6572 6e65 6c0a 4070  ld_for_kernel.@p
+0001d3c0: 7974 6573 742e 6d61 726b 2e78 6661 696c  ytest.mark.xfail
+0001d3d0: 280a 2020 2020 7379 732e 7665 7273 696f  (.    sys.versio
+0001d3e0: 6e5f 696e 666f 5b30 5d20 3d3d 2033 2c0a  n_info[0] == 3,.
+0001d3f0: 2020 2020 7265 6173 6f6e 3d22 4e65 6564      reason="Need
+0001d400: 206e 6577 6572 2076 6572 7369 6f6e 206f   newer version o
+0001d410: 6620 6a75 7079 7465 725f 636f 6e73 6f6c  f jupyter_consol
+0001d420: 6520 3e20 362e 342e 3120 6d61 7962 6520  e > 6.4.1 maybe 
+0001d430: 3f20 436f 726f 7574 696e 6520 6e6f 7420  ? Coroutine not 
+0001d440: 6177 6169 7465 6422 2c0a 2020 2020 7374  awaited",.    st
+0001d450: 7269 6374 3d46 616c 7365 2c0a 290a 4072  rict=False,.).@r
+0001d460: 6574 7279 0a64 6566 2074 6573 745f 6970  etry.def test_ip
+0001d470: 7974 686f 6e5f 6e6f 7465 626f 6f6b 5f31  ython_notebook_1
+0001d480: 2829 3a0a 2020 2020 7769 7468 2049 5079  ():.    with IPy
+0001d490: 7468 6f6e 4e6f 7465 626f 6f6b 4374 7828  thonNotebookCtx(
+0001d4a0: 2920 6173 206b 6572 6e65 6c3a 0a20 2020  ) as kernel:.   
+0001d4b0: 2020 2020 2023 2031 2e20 5665 7269 6679       # 1. Verify
+0001d4c0: 2074 6861 7420 7468 6520 6175 746f 2069   that the auto i
+0001d4d0: 6d70 6f72 7465 7220 6973 6e27 7420 656e  mporter isn't en
+0001d4e0: 6162 6c65 6420 7965 742e 0a20 2020 2020  abled yet..     
+0001d4f0: 2020 2023 2032 2e20 456e 6162 6c65 2074     # 2. Enable t
+0001d500: 6865 2061 7574 6f20 696d 706f 7274 6572  he auto importer
+0001d510: 2e0a 2020 2020 2020 2020 2320 332e 2056  ..        # 3. V
+0001d520: 6572 6966 7920 7468 6174 2074 6865 2061  erify that the a
+0001d530: 7574 6f20 696d 706f 7274 6572 2061 6e64  uto importer and
+0001d540: 2074 6162 2063 6f6d 706c 6574 696f 6e20   tab completion 
+0001d550: 776f 726b 2e0a 2020 2020 2020 2020 6970  work..        ip
+0001d560: 7974 686f 6e28 0a20 2020 2020 2020 2020  ython(.         
+0001d570: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
+0001d580: 2020 2049 6e20 5b31 5d3a 2062 3634 6465     In [1]: b64de
+0001d590: 636f 6465 2827 7827 290a 2020 2020 2020  code('x').      
+0001d5a0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+0001d5b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001d5c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001d5d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001d5e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001d5f0: 2d0a 2020 2020 2020 2020 2020 2020 4e61  -.            Na
+0001d600: 6d65 4572 726f 7220 2020 2020 2020 2020  meError         
+0001d610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d620: 2020 2020 2020 2020 5472 6163 6562 6163          Tracebac
+0001d630: 6b20 286d 6f73 7420 7265 6365 6e74 2063  k (most recent c
+0001d640: 616c 6c20 6c61 7374 290a 2020 2020 2020  all last).      
+0001d650: 2020 2020 2020 2e2e 2e20 696e 202e 2e2e        ... in ...
+0001d660: 0a20 2020 2020 2020 2020 2020 204e 616d  .            Nam
+0001d670: 6545 7272 6f72 3a20 6e61 6d65 2027 6236  eError: name 'b6
+0001d680: 3464 6563 6f64 6527 2069 7320 6e6f 7420  4decode' is not 
+0001d690: 6465 6669 6e65 640a 2020 2020 2020 2020  defined.        
+0001d6a0: 2020 2020 496e 205b 325d 3a20 696d 706f      In [2]: impo
+0001d6b0: 7274 2070 7966 6c79 6279 3b20 7079 666c  rt pyflyby; pyfl
+0001d6c0: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
+0001d6d0: 696d 706f 7274 6572 2829 0a20 2020 2020  importer().     
+0001d6e0: 2020 2020 2020 2049 6e20 5b33 5d3a 2062         In [3]: b
+0001d6f0: 3634 6465 636f 5c74 6465 2827 6147 4636  64deco\tde('aGF6
+0001d700: 5a57 7875 6458 513d 2729 0a20 2020 2020  ZWxudXQ=').     
+0001d710: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+0001d720: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
+0001d730: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
+0001d740: 2020 2020 2020 2020 2020 4f75 745b 335d            Out[3]
+0001d750: 3a20 6227 6861 7a65 6c6e 7574 270a 2020  : b'hazelnut'.  
+0001d760: 2020 2020 2020 2020 2020 2222 222c 0a20            """,. 
+0001d770: 2020 2020 2020 2020 2020 2061 7267 733d             args=
+0001d780: 5b22 636f 6e73 6f6c 6522 5d2c 0a20 2020  ["console"],.   
+0001d790: 2020 2020 2020 2020 206b 6572 6e65 6c3d           kernel=
+0001d7a0: 6b65 726e 656c 2c0a 2020 2020 2020 2020  kernel,.        
+0001d7b0: 290a 0a0a 4073 6b69 7069 665f 6970 7974  )...@skipif_ipyt
+0001d7c0: 686f 6e5f 746f 6f5f 6f6c 645f 666f 725f  hon_too_old_for_
+0001d7d0: 6b65 726e 656c 0a40 7079 7465 7374 2e6d  kernel.@pytest.m
+0001d7e0: 6172 6b2e 7866 6169 6c28 0a20 2020 2073  ark.xfail(.    s
+0001d7f0: 7973 2e76 6572 7369 6f6e 5f69 6e66 6f5b  ys.version_info[
+0001d800: 305d 203d 3d20 332c 0a20 2020 2072 6561  0] == 3,.    rea
+0001d810: 736f 6e3d 224e 6565 6420 6e65 7765 7220  son="Need newer 
+0001d820: 7665 7273 696f 6e20 6f66 206a 7570 7974  version of jupyt
+0001d830: 6572 5f63 6f6e 736f 6c65 203e 2036 2e34  er_console > 6.4
+0001d840: 2e31 206d 6179 6265 203f 2043 6f72 6f75  .1 maybe ? Corou
+0001d850: 7469 6e65 206e 6f74 2061 7761 6974 6564  tine not awaited
+0001d860: 222c 0a20 2020 2073 7472 6963 743d 4661  ",.    strict=Fa
+0001d870: 6c73 652c 0a29 0a40 7265 7472 790a 6465  lse,.).@retry.de
+0001d880: 6620 7465 7374 5f69 7079 7468 6f6e 5f6e  f test_ipython_n
+0001d890: 6f74 6562 6f6f 6b5f 7265 636f 6e6e 6563  otebook_reconnec
+0001d8a0: 745f 3128 293a 0a20 2020 2023 2056 6572  t_1():.    # Ver
+0001d8b0: 6966 7920 7468 6174 2077 6520 6361 6e20  ify that we can 
+0001d8c0: 7265 636f 6e6e 6563 7420 746f 2074 6865  reconnect to the
+0001d8d0: 2073 616d 6520 6b65 726e 656c 2c20 616e   same kernel, an
+0001d8e0: 6420 7079 666c 7962 7920 6973 2073 7469  d pyflyby is sti
+0001d8f0: 6c6c 0a20 2020 2023 2065 6e61 626c 6564  ll.    # enabled
+0001d900: 2e0a 2020 2020 7769 7468 2049 5079 7468  ..    with IPyth
+0001d910: 6f6e 4e6f 7465 626f 6f6b 4374 7828 2920  onNotebookCtx() 
+0001d920: 6173 206b 6572 6e65 6c3a 0a20 2020 2020  as kernel:.     
+0001d930: 2020 2023 2056 6572 6966 7920 7468 6174     # Verify that
+0001d940: 2074 6865 2061 7574 6f20 696d 706f 7274   the auto import
+0001d950: 6572 2069 736e 2774 2065 6e61 626c 6564  er isn't enabled
+0001d960: 2079 6574 2e0a 2020 2020 2020 2020 6970   yet..        ip
+0001d970: 7974 686f 6e28 0a20 2020 2020 2020 2020  ython(.         
+0001d980: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
+0001d990: 2020 2049 6e20 5b31 5d3a 2062 3634 6465     In [1]: b64de
+0001d9a0: 636f 6465 2827 7827 290a 2020 2020 2020  code('x').      
+0001d9b0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+0001d9c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001d9d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001d9e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001d9f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001da00: 2d0a 2020 2020 2020 2020 2020 2020 4e61  -.            Na
+0001da10: 6d65 4572 726f 7220 2020 2020 2020 2020  meError         
+0001da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da30: 2020 2020 2020 2020 5472 6163 6562 6163          Tracebac
+0001da40: 6b20 286d 6f73 7420 7265 6365 6e74 2063  k (most recent c
+0001da50: 616c 6c20 6c61 7374 290a 2020 2020 2020  all last).      
+0001da60: 2020 2020 2020 2e2e 2e20 696e 202e 2e2e        ... in ...
+0001da70: 0a20 2020 2020 2020 2020 2020 204e 616d  .            Nam
+0001da80: 6545 7272 6f72 3a20 6e61 6d65 2027 6236  eError: name 'b6
+0001da90: 3464 6563 6f64 6527 2069 7320 6e6f 7420  4decode' is not 
+0001daa0: 6465 6669 6e65 640a 2020 2020 2020 2020  defined.        
+0001dab0: 2222 222c 0a20 2020 2020 2020 2020 2020  """,.           
+0001dac0: 2061 7267 733d 5b22 636f 6e73 6f6c 6522   args=["console"
+0001dad0: 5d2c 0a20 2020 2020 2020 2020 2020 206b  ],.            k
+0001dae0: 6572 6e65 6c3d 6b65 726e 656c 2c0a 2020  ernel=kernel,.  
+0001daf0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001db00: 2320 456e 6162 6c65 2074 6865 2061 7574  # Enable the aut
+0001db10: 6f20 696d 706f 7274 6572 2e0a 2020 2020  o importer..    
+0001db20: 2020 2020 6970 7974 686f 6e28 0a20 2020      ipython(.   
+0001db30: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001db40: 2020 2020 2049 6e20 5b32 5d3a 2069 6d70       In [2]: imp
+0001db50: 6f72 7420 7079 666c 7962 793b 2070 7966  ort pyflyby; pyf
+0001db60: 6c79 6279 2e65 6e61 626c 655f 6175 746f  lyby.enable_auto
+0001db70: 5f69 6d70 6f72 7465 7228 290a 2020 2020  _importer().    
+0001db80: 2020 2020 2222 222c 2061 7267 733d 5b27      """, args=['
+0001db90: 636f 6e73 6f6c 6527 5d2c 206b 6572 6e65  console'], kerne
+0001dba0: 6c3d 6b65 726e 656c 290a 2020 2020 2020  l=kernel).      
+0001dbb0: 2020 2320 5665 7269 6679 2074 6861 7420    # Verify that 
+0001dbc0: 7468 6520 6175 746f 2069 6d70 6f72 7465  the auto importe
+0001dbd0: 7220 616e 6420 7461 6220 636f 6d70 6c65  r and tab comple
+0001dbe0: 7469 6f6e 2077 6f72 6b2e 0a20 2020 2020  tion work..     
+0001dbf0: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
+0001dc00: 2020 2020 2020 2020 2020 2049 6e20 5b33             In [3
+0001dc10: 5d3a 2062 3634 6465 636f 5c74 6465 2827  ]: b64deco\tde('
+0001dc20: 6147 4636 5a57 7875 6458 513d 2729 0a20  aGF6ZWxudXQ='). 
+0001dc30: 2020 2020 2020 2020 2020 205b 5059 464c             [PYFL
+0001dc40: 5942 595d 2066 726f 6d20 6261 7365 3634  YBY] from base64
+0001dc50: 2069 6d70 6f72 7420 6236 3464 6563 6f64   import b64decod
+0001dc60: 650a 2020 2020 2020 2020 2020 2020 4f75  e.            Ou
+0001dc70: 745b 335d 3a20 6227 6861 7a65 6c6e 7574  t[3]: b'hazelnut
+0001dc80: 270a 2020 2020 2020 2020 2222 222c 2061  '.        """, a
+0001dc90: 7267 733d 5b27 636f 6e73 6f6c 6527 5d2c  rgs=['console'],
+0001dca0: 206b 6572 6e65 6c3d 6b65 726e 656c 290a   kernel=kernel).
+0001dcb0: 0a0a 4072 6574 7279 0a64 6566 2074 6573  ..@retry.def tes
+0001dcc0: 745f 7079 5f69 6e74 6572 6163 7469 7665  t_py_interactive
+0001dcd0: 5f31 2829 3a0a 2020 2020 2320 5665 7269  _1():.    # Veri
+0001dce0: 6679 2074 6861 7420 2770 7927 2065 6e61  fy that 'py' ena
+0001dcf0: 626c 6573 2070 7966 6c79 6279 2061 7574  bles pyflyby aut
+0001dd00: 6f69 6d70 6f72 7465 7220 6174 2073 7461  oimporter at sta
+0001dd10: 7274 2e0a 2020 2020 6970 7974 686f 6e28  rt..    ipython(
+0001dd20: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
+0001dd30: 315d 3a20 6236 3464 6563 6f5c 7464 6528  1]: b64deco\tde(
+0001dd40: 2763 476c 7a64 4746 6a61 476c 7627 290a  'cGlzdGFjaGlv').
+0001dd50: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
+0001dd60: 5d20 6672 6f6d 2062 6173 6536 3420 696d  ] from base64 im
+0001dd70: 706f 7274 2062 3634 6465 636f 6465 0a20  port b64decode. 
+0001dd80: 2020 2020 2020 204f 7574 5b31 5d3a 2062         Out[1]: b
+0001dd90: 2770 6973 7461 6368 696f 270a 2020 2020  'pistachio'.    
+0001dda0: 2222 222c 2070 726f 673d 2270 7922 290a  """, prog="py").
+0001ddb0: 0a0a 4072 6574 7279 0a64 6566 2074 6573  ..@retry.def tes
+0001ddc0: 745f 7079 5f69 5f69 6e74 6572 6163 7469  t_py_i_interacti
+0001ddd0: 7665 5f31 2874 6d70 293a 0a20 2020 2023  ve_1(tmp):.    #
+0001dde0: 2054 6573 7420 7468 6174 2027 7079 202d   Test that 'py -
+0001ddf0: 6927 2069 6e69 7469 616c 697a 6573 2049  i' initializes I
+0001de00: 5079 7468 6f6e 2062 6566 6f72 6520 7275  Python before ru
+0001de10: 6e6e 696e 6720 7468 6520 636f 6d6d 616e  nning the comman
+0001de20: 646c 696e 650a 2020 2020 2320 636f 6465  dline.    # code
+0001de30: 2e0a 2020 2020 2320 2854 6865 2063 6f6e  ..    # (The con
+0001de40: 7665 7273 6520 6973 2074 6573 7465 6420  verse is tested 
+0001de50: 6279 2074 6573 745f 7079 2e70 793a 7465  by test_py.py:te
+0001de60: 7374 5f6e 6f5f 6970 7974 686f 6e5f 666f  st_no_ipython_fo
+0001de70: 725f 6576 616c 5f31 2e29 0a20 2020 2077  r_eval_1.).    w
+0001de80: 7269 7465 7465 7874 2874 6d70 2e64 6972  ritetext(tmp.dir
+0001de90: 202f 2022 6d33 3236 3232 3136 372e 7079   / "m32622167.py
+0001dea0: 222c 2022 2222 0a20 2020 2020 2020 2069  ", """.        i
+0001deb0: 6d70 6f72 7420 7079 666c 7962 790a 2020  mport pyflyby.  
+0001dec0: 2020 2020 2020 6970 7974 686f 6e5f 6170        ipython_ap
+0001ded0: 7020 3d20 7079 666c 7962 792e 5f69 6e74  p = pyflyby._int
+0001dee0: 6572 6163 7469 7665 2e5f 6765 745f 6970  eractive._get_ip
+0001def0: 7974 686f 6e5f 6170 7028 290a 2020 2020  ython_app().    
+0001df00: 2222 2229 0a20 2020 2069 7079 7468 6f6e  """).    ipython
+0001df10: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
+0001df20: 5b31 5d3a 2062 6f6f 6c28 6d33 3236 3232  [1]: bool(m32622
+0001df30: 3136 372e 6970 7974 686f 6e5f 6170 7029  167.ipython_app)
+0001df40: 0a20 2020 2020 2020 204f 7574 5b31 5d3a  .        Out[1]:
+0001df50: 2054 7275 650a 2020 2020 2222 222c 2070   True.    """, p
+0001df60: 726f 673d 2270 7922 2c20 6172 6773 3d5b  rog="py", args=[
+0001df70: 272d 6927 2c20 2769 6d70 6f72 7420 6d33  '-i', 'import m3
+0001df80: 3236 3232 3136 3727 5d2c 2050 5954 484f  2622167'], PYTHO
+0001df90: 4e50 4154 483d 746d 702e 6469 7229 0a0a  NPATH=tmp.dir)..
+0001dfa0: 0a40 736b 6970 6966 5f69 7079 7468 6f6e  .@skipif_ipython
+0001dfb0: 5f74 6f6f 5f6f 6c64 5f66 6f72 5f6b 6572  _too_old_for_ker
+0001dfc0: 6e65 6c0a 4070 7974 6573 742e 6d61 726b  nel.@pytest.mark
+0001dfd0: 2e78 6661 696c 280a 2020 2020 7379 732e  .xfail(.    sys.
+0001dfe0: 7665 7273 696f 6e5f 696e 666f 5b30 5d20  version_info[0] 
+0001dff0: 3d3d 2033 2c0a 2020 2020 7265 6173 6f6e  == 3,.    reason
+0001e000: 3d22 4e65 6564 206e 6577 6572 2076 6572  ="Need newer ver
+0001e010: 7369 6f6e 206f 6620 6a75 7079 7465 725f  sion of jupyter_
+0001e020: 636f 6e73 6f6c 6520 3e20 362e 342e 3120  console > 6.4.1 
+0001e030: 6d61 7962 6520 3f20 436f 726f 7574 696e  maybe ? Coroutin
+0001e040: 6520 6e6f 7420 6177 6169 7465 6422 2c0a  e not awaited",.
+0001e050: 2020 2020 7374 7269 6374 3d46 616c 7365      strict=False
+0001e060: 2c0a 290a 4072 6574 7279 0a64 6566 2074  ,.).@retry.def t
+0001e070: 6573 745f 7079 5f63 6f6e 736f 6c65 5f31  est_py_console_1
+0001e080: 2829 3a0a 2020 2020 2320 5665 7269 6679  ():.    # Verify
+0001e090: 2074 6861 7420 2770 7920 636f 6e73 6f6c   that 'py consol
+0001e0a0: 6527 2077 6f72 6b73 2e0a 2020 2020 6970  e' works..    ip
+0001e0b0: 7974 686f 6e28 2222 220a 2020 2020 2020  ython(""".      
+0001e0c0: 2020 496e 205b 315d 3a20 6236 3464 6563    In [1]: b64dec
+0001e0d0: 6f5c 7464 6528 2764 3246 7362 6e56 3027  o\tde('d2FsbnV0'
+0001e0e0: 290a 2020 2020 2020 2020 5b50 5946 4c59  ).        [PYFLY
+0001e0f0: 4259 5d20 6672 6f6d 2062 6173 6536 3420  BY] from base64 
+0001e100: 696d 706f 7274 2062 3634 6465 636f 6465  import b64decode
+0001e110: 0a20 2020 2020 2020 204f 7574 5b31 5d3a  .        Out[1]:
+0001e120: 2062 2777 616c 6e75 7427 0a20 2020 2022   b'walnut'.    "
+0001e130: 2222 2c20 7072 6f67 3d22 7079 222c 2061  "", prog="py", a
+0001e140: 7267 733d 5b27 636f 6e73 6f6c 6527 5d29  rgs=['console'])
+0001e150: 0a0a 0a40 736b 6970 6966 5f69 7079 7468  ...@skipif_ipyth
+0001e160: 6f6e 5f74 6f6f 5f6f 6c64 5f66 6f72 5f6b  on_too_old_for_k
+0001e170: 6572 6e65 6c0a 4070 7974 6573 742e 6d61  ernel.@pytest.ma
+0001e180: 726b 2e78 6661 696c 280a 2020 2020 7379  rk.xfail(.    sy
+0001e190: 732e 7665 7273 696f 6e5f 696e 666f 5b30  s.version_info[0
+0001e1a0: 5d20 3d3d 2033 2c0a 2020 2020 7265 6173  ] == 3,.    reas
+0001e1b0: 6f6e 3d22 4e65 6564 206e 6577 6572 2076  on="Need newer v
+0001e1c0: 6572 7369 6f6e 206f 6620 6a75 7079 7465  ersion of jupyte
+0001e1d0: 725f 636f 6e73 6f6c 6520 3e20 362e 342e  r_console > 6.4.
+0001e1e0: 3120 6d61 7962 6520 3f20 436f 726f 7574  1 maybe ? Corout
+0001e1f0: 696e 6520 6e6f 7420 6177 6169 7465 6422  ine not awaited"
+0001e200: 2c0a 2020 2020 7374 7269 6374 3d46 616c  ,.    strict=Fal
+0001e210: 7365 2c0a 290a 4072 6574 7279 0a64 6566  se,.).@retry.def
+0001e220: 2074 6573 745f 7079 5f6b 6572 6e65 6c5f   test_py_kernel_
+0001e230: 3128 293a 0a20 2020 2023 2056 6572 6966  1():.    # Verif
+0001e240: 7920 7468 6174 2027 7079 206b 6572 6e65  y that 'py kerne
+0001e250: 6c27 2077 6f72 6b73 2e0a 2020 2020 7769  l' works..    wi
+0001e260: 7468 2049 5079 7468 6f6e 4b65 726e 656c  th IPythonKernel
+0001e270: 4374 7828 7072 6f67 3d22 7079 2229 2061  Ctx(prog="py") a
+0001e280: 7320 6b65 726e 656c 3a0a 2020 2020 2020  s kernel:.      
+0001e290: 2020 2320 5275 6e20 6970 7974 686f 6e20    # Run ipython 
+0001e2a0: 636f 6e73 6f6c 652e 2020 4e6f 7465 2074  console.  Note t
+0001e2b0: 6861 7420 7765 2064 6f6e 2774 206e 6565  hat we don't nee
+0001e2c0: 6420 746f 2075 7365 2070 726f 673d 2770  d to use prog='p
+0001e2d0: 7927 2068 6572 652c 0a20 2020 2020 2020  y' here,.       
+0001e2e0: 2023 2061 7320 7468 6520 6175 746f 696d   # as the autoim
+0001e2f0: 706f 7274 2026 2063 6f6d 706c 6574 696f  port & completio
+0001e300: 6e20 6973 2061 2070 726f 7065 7274 7920  n is a property 
+0001e310: 6f66 2074 6865 206b 6572 6e65 6c2e 0a20  of the kernel.. 
+0001e320: 2020 2020 2020 2069 7079 7468 6f6e 2822         ipython("
+0001e330: 2222 0a20 2020 2020 2020 2020 2020 2049  "".            I
+0001e340: 6e20 5b31 5d3a 2062 3634 6465 636f 5c74  n [1]: b64deco\t
+0001e350: 6465 2827 6257 466a 5957 5268 6257 6c68  de('bWFjYWRhbWlh
+0001e360: 2729 0a20 2020 2020 2020 2020 2020 205b  ').            [
+0001e370: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
+0001e380: 7365 3634 2069 6d70 6f72 7420 6236 3464  se64 import b64d
+0001e390: 6563 6f64 650a 2020 2020 2020 2020 2020  ecode.          
+0001e3a0: 2020 4f75 745b 315d 3a20 6227 6d61 6361    Out[1]: b'maca
+0001e3b0: 6461 6d69 6127 0a20 2020 2020 2020 2022  damia'.        "
+0001e3c0: 2222 2c20 6172 6773 3d5b 2763 6f6e 736f  "", args=['conso
+0001e3d0: 6c65 275d 2c20 6b65 726e 656c 3d6b 6572  le'], kernel=ker
+0001e3e0: 6e65 6c29 0a0a 0a40 736b 6970 6966 5f69  nel)...@skipif_i
+0001e3f0: 7079 7468 6f6e 5f74 6f6f 5f6f 6c64 5f66  python_too_old_f
+0001e400: 6f72 5f6b 6572 6e65 6c0a 4070 7974 6573  or_kernel.@pytes
+0001e410: 742e 6d61 726b 2e78 6661 696c 280a 2020  t.mark.xfail(.  
+0001e420: 2020 7379 732e 7665 7273 696f 6e5f 696e    sys.version_in
+0001e430: 666f 5b30 5d20 3d3d 2033 2c0a 2020 2020  fo[0] == 3,.    
+0001e440: 7265 6173 6f6e 3d22 4e65 6564 206e 6577  reason="Need new
+0001e450: 6572 2076 6572 7369 6f6e 206f 6620 6a75  er version of ju
+0001e460: 7079 7465 725f 636f 6e73 6f6c 6520 3e20  pyter_console > 
+0001e470: 362e 342e 3120 6d61 7962 6520 3f20 436f  6.4.1 maybe ? Co
+0001e480: 726f 7574 696e 6520 6e6f 7420 6177 6169  routine not awai
+0001e490: 7465 6422 2c0a 2020 2020 7374 7269 6374  ted",.    strict
+0001e4a0: 3d46 616c 7365 2c0a 290a 4072 6574 7279  =False,.).@retry
+0001e4b0: 0a64 6566 2074 6573 745f 7079 5f63 6f6e  .def test_py_con
+0001e4c0: 736f 6c65 5f65 7869 7374 696e 675f 3128  sole_existing_1(
+0001e4d0: 293a 0a20 2020 2023 2056 6572 6966 7920  ):.    # Verify 
+0001e4e0: 7468 6174 2027 7079 2063 6f6e 736f 6c65  that 'py console
+0001e4f0: 2720 776f 726b 7320 6173 2075 7375 616c  ' works as usual
+0001e500: 2028 6e6f 2065 7874 7261 2066 756e 6374   (no extra funct
+0001e510: 696f 6e61 6c69 7479 0a20 2020 2023 2065  ionality.    # e
+0001e520: 7870 6563 7465 6420 6f76 6572 2072 6567  xpected over reg
+0001e530: 756c 6172 2069 7079 7468 6f6e 2063 6f6e  ular ipython con
+0001e540: 736f 6c65 2c20 6275 7420 6a75 7374 2063  sole, but just c
+0001e550: 6865 636b 2074 6861 7420 6974 2073 7469  heck that it sti
+0001e560: 6c6c 0a20 2020 2023 2077 6f72 6b73 206e  ll.    # works n
+0001e570: 6f72 6d61 6c6c 7929 2e0a 2020 2020 7769  ormally)..    wi
+0001e580: 7468 2049 5079 7468 6f6e 4b65 726e 656c  th IPythonKernel
+0001e590: 4374 7828 2920 6173 206b 6572 6e65 6c3a  Ctx() as kernel:
+0001e5a0: 0a20 2020 2020 2020 2069 7079 7468 6f6e  .        ipython
+0001e5b0: 280a 2020 2020 2020 2020 2020 2020 2222  (.            ""
+0001e5c0: 220a 2020 2020 2020 2020 2020 2020 496e  ".            In
+0001e5d0: 205b 315d 3a20 6236 3464 6563 6f64 6528   [1]: b64decode(
+0001e5e0: 2778 2729 0a20 2020 2020 2020 2020 2020  'x').           
+0001e5f0: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
+0001e600: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001e610: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001e620: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001e630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
+0001e640: 2020 2020 2020 2020 204e 616d 6545 7272           NameErr
+0001e650: 6f72 2020 2020 2020 2020 2020 2020 2020  or              
+0001e660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e670: 2020 2054 7261 6365 6261 636b 2028 6d6f     Traceback (mo
+0001e680: 7374 2072 6563 656e 7420 6361 6c6c 206c  st recent call l
+0001e690: 6173 7429 0a20 2020 2020 2020 2020 2020  ast).           
+0001e6a0: 202e 2e2e 2069 6e20 2e2e 2e0a 2020 2020   ... in ....    
+0001e6b0: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
+0001e6c0: 723a 206e 616d 6520 2762 3634 6465 636f  r: name 'b64deco
+0001e6d0: 6465 2720 6973 206e 6f74 2064 6566 696e  de' is not defin
+0001e6e0: 6564 0a20 2020 2020 2020 2022 2222 2c0a  ed.        """,.
+0001e6f0: 2020 2020 2020 2020 2020 2020 7072 6f67              prog
+0001e700: 3d22 7079 222c 0a20 2020 2020 2020 2020  ="py",.         
+0001e710: 2020 2061 7267 733d 5b22 636f 6e73 6f6c     args=["consol
+0001e720: 6522 5d2c 0a20 2020 2020 2020 2020 2020  e"],.           
+0001e730: 206b 6572 6e65 6c3d 6b65 726e 656c 2c0a   kernel=kernel,.
+0001e740: 2020 2020 2020 2020 290a 0a0a 4073 6b69          )...@ski
+0001e750: 7069 665f 6970 7974 686f 6e5f 746f 6f5f  pif_ipython_too_
+0001e760: 6f6c 645f 666f 725f 6b65 726e 656c 0a40  old_for_kernel.@
+0001e770: 7079 7465 7374 2e6d 6172 6b2e 7866 6169  pytest.mark.xfai
+0001e780: 6c28 0a20 2020 2073 7973 2e76 6572 7369  l(.    sys.versi
+0001e790: 6f6e 5f69 6e66 6f5b 305d 203d 3d20 332c  on_info[0] == 3,
+0001e7a0: 0a20 2020 2072 6561 736f 6e3d 224e 6565  .    reason="Nee
+0001e7b0: 6420 6e65 7765 7220 7665 7273 696f 6e20  d newer version 
+0001e7c0: 6f66 206a 7570 7974 6572 5f63 6f6e 736f  of jupyter_conso
+0001e7d0: 6c65 203e 2036 2e34 2e31 206d 6179 6265  le > 6.4.1 maybe
+0001e7e0: 203f 2043 6f72 6f75 7469 6e65 206e 6f74   ? Coroutine not
+0001e7f0: 2061 7761 6974 6564 222c 0a20 2020 2073   awaited",.    s
+0001e800: 7472 6963 743d 4661 6c73 652c 0a29 0a40  trict=False,.).@
+0001e810: 7265 7472 790a 6465 6620 7465 7374 5f70  retry.def test_p
+0001e820: 795f 6e6f 7465 626f 6f6b 5f31 2829 3a0a  y_notebook_1():.
+0001e830: 2020 2020 7769 7468 2049 5079 7468 6f6e      with IPython
+0001e840: 4e6f 7465 626f 6f6b 4374 7828 7072 6f67  NotebookCtx(prog
+0001e850: 3d22 7079 2229 2061 7320 6b65 726e 656c  ="py") as kernel
+0001e860: 3a0a 2020 2020 2020 2020 2320 5665 7269  :.        # Veri
+0001e870: 6679 2074 6861 7420 7468 6520 6175 746f  fy that the auto
+0001e880: 2069 6d70 6f72 7465 7220 616e 6420 7461   importer and ta
+0001e890: 6220 636f 6d70 6c65 7469 6f6e 2077 6f72  b completion wor
+0001e8a0: 6b2e 0a20 2020 2020 2020 2069 7079 7468  k..        ipyth
+0001e8b0: 6f6e 2822 2222 0a20 2020 2020 2020 2020  on(""".         
+0001e8c0: 2020 2049 6e20 5b31 5d3a 2062 3634 6465     In [1]: b64de
+0001e8d0: 636f 5c74 6465 2827 5932 467a 6147 5633  co\tde('Y2FzaGV3
+0001e8e0: 2729 0a20 2020 2020 2020 2020 2020 205b  ').            [
+0001e8f0: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
+0001e900: 7365 3634 2069 6d70 6f72 7420 6236 3464  se64 import b64d
+0001e910: 6563 6f64 650a 2020 2020 2020 2020 2020  ecode.          
+0001e920: 2020 4f75 745b 315d 3a20 6227 6361 7368    Out[1]: b'cash
+0001e930: 6577 270a 2020 2020 2020 2020 2222 222c  ew'.        """,
+0001e940: 2061 7267 733d 5b27 636f 6e73 6f6c 6527   args=['console'
+0001e950: 5d2c 206b 6572 6e65 6c3d 6b65 726e 656c  ], kernel=kernel
+0001e960: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
+0001e970: 6573 745f 7079 5f64 6973 6162 6c65 5f31  est_py_disable_1
+0001e980: 2829 3a0a 2020 2020 2320 5665 7269 6679  ():.    # Verify
+0001e990: 2074 6861 7420 7768 656e 2075 7369 6e67   that when using
+0001e9a0: 2027 7079 272c 2077 6520 6361 6e20 6469   'py', we can di
+0001e9b0: 7361 626c 6520 7468 6520 6175 746f 696d  sable the autoim
+0001e9c0: 706f 7274 6572 2c20 616e 640a 2020 2020  porter, and.    
+0001e9d0: 2320 616c 736f 2072 652d 656e 6162 6c65  # also re-enable
+0001e9e0: 2069 742e 0a20 2020 2069 7079 7468 6f6e   it..    ipython
+0001e9f0: 280a 2020 2020 2020 2020 2222 220a 2020  (.        """.  
+0001ea00: 2020 2020 2020 496e 205b 315d 3a20 6236        In [1]: b6
+0001ea10: 3464 6563 6f5c 7464 6528 2761 476c 6a61  4deco\tde('aGlja
+0001ea20: 3239 7965 513d 3d27 290a 2020 2020 2020  29yeQ==').      
+0001ea30: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
+0001ea40: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
+0001ea50: 3634 6465 636f 6465 0a20 2020 2020 2020  64decode.       
+0001ea60: 204f 7574 5b31 5d3a 2062 2768 6963 6b6f   Out[1]: b'hicko
+0001ea70: 7279 270a 2020 2020 2020 2020 496e 205b  ry'.        In [
+0001ea80: 325d 3a20 7079 666c 7962 792e 6469 7361  2]: pyflyby.disa
+0001ea90: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
+0001eaa0: 7228 290a 2020 2020 2020 2020 5b50 5946  r().        [PYF
+0001eab0: 4c59 4259 5d20 696d 706f 7274 2070 7966  LYBY] import pyf
+0001eac0: 6c79 6279 0a20 2020 2020 2020 2049 6e20  lyby.        In 
+0001ead0: 5b33 5d3a 2062 3634 656e 636f 6465 2862  [3]: b64encode(b
+0001eae0: 2778 2729 0a20 2020 2020 2020 202d 2d2d  'x').        ---
+0001eaf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001eb00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001eb10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001eb20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001eb30: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0001eb40: 204e 616d 6545 7272 6f72 2020 2020 2020   NameError      
+0001eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb60: 2020 2020 2020 2020 2020 2054 7261 6365             Trace
+0001eb70: 6261 636b 2028 6d6f 7374 2072 6563 656e  back (most recen
+0001eb80: 7420 6361 6c6c 206c 6173 7429 0a20 2020  t call last).   
+0001eb90: 2020 2020 202e 2e2e 2069 6e20 2e2e 2e0a       ... in ....
+0001eba0: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
+0001ebb0: 723a 206e 616d 6520 2762 3634 656e 636f  r: name 'b64enco
+0001ebc0: 6465 2720 6973 206e 6f74 2064 6566 696e  de' is not defin
+0001ebd0: 6564 0a20 2020 2020 2020 2049 6e20 5b34  ed.        In [4
+0001ebe0: 5d3a 2062 3634 6465 636f 6465 2827 6257  ]: b64decode('bW
+0001ebf0: 396a 6132 5679 626e 5630 2729 0a20 2020  9ja2VybnV0').   
+0001ec00: 2020 2020 204f 7574 5b34 5d3a 2062 276d       Out[4]: b'm
+0001ec10: 6f63 6b65 726e 7574 270a 2020 2020 2020  ockernut'.      
+0001ec20: 2020 496e 205b 355d 3a20 7079 666c 7962    In [5]: pyflyb
+0001ec30: 792e 656e 6162 6c65 5f61 7574 6f5f 696d  y.enable_auto_im
+0001ec40: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
+0001ec50: 2049 6e20 5b36 5d3a 2062 3634 656e 636f   In [6]: b64enco
+0001ec60: 6465 2862 2770 6563 616e 2729 0a20 2020  de(b'pecan').   
+0001ec70: 2020 2020 205b 5059 464c 5942 595d 2066       [PYFLYBY] f
+0001ec80: 726f 6d20 6261 7365 3634 2069 6d70 6f72  rom base64 impor
+0001ec90: 7420 6236 3465 6e63 6f64 650a 2020 2020  t b64encode.    
+0001eca0: 2020 2020 4f75 745b 365d 3a20 6227 6347      Out[6]: b'cG
+0001ecb0: 566a 5957 343d 270a 2020 2020 2222 222c  VjYW4='.    """,
+0001ecc0: 0a20 2020 2020 2020 2070 726f 673d 2270  .        prog="p
+0001ecd0: 7922 2c0a 2020 2020 290a 0a0a 6465 6620  y",.    )...def 
+0001ece0: 5f69 6e73 7461 6c6c 5f6c 6f61 645f 6578  _install_load_ex
+0001ecf0: 745f 7079 666c 7962 795f 696e 5f63 6f6e  t_pyflyby_in_con
+0001ed00: 6669 6728 6970 7974 686f 6e5f 6469 7229  fig(ipython_dir)
+0001ed10: 3a0a 2020 2020 7769 7468 206f 7065 6e28  :.    with open(
+0001ed20: 7374 7228 6970 7974 686f 6e5f 6469 722f  str(ipython_dir/
+0001ed30: 2270 726f 6669 6c65 5f64 6566 6175 6c74  "profile_default
+0001ed40: 2f69 7079 7468 6f6e 5f63 6f6e 6669 672e  /ipython_config.
+0001ed50: 7079 2229 2c20 2761 2729 2061 7320 663a  py"), 'a') as f:
+0001ed60: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+0001ed70: 632e 496e 7465 7261 6374 6976 6553 6865  c.InteractiveShe
+0001ed80: 6c6c 4170 702e 6578 7465 6e73 696f 6e73  llApp.extensions
+0001ed90: 2e61 7070 656e 6428 2270 7966 6c79 6279  .append("pyflyby
+0001eda0: 2229 272c 2066 696c 653d 6629 0a0a 0a40  ")', file=f)...@
+0001edb0: 7265 7472 790a 6465 6620 7465 7374 5f69  retry.def test_i
+0001edc0: 6e73 7461 6c6c 6564 5f69 6e5f 636f 6e66  nstalled_in_conf
+0001edd0: 6967 5f69 7079 7468 6f6e 5f63 6d64 6c69  ig_ipython_cmdli
+0001ede0: 6e65 5f31 2874 6d70 293a 0a20 2020 2023  ne_1(tmp):.    #
+0001edf0: 2056 6572 6966 7920 7468 6174 2061 7574   Verify that aut
+0001ee00: 6f69 6d70 6f72 7420 776f 726b 7320 696e  oimport works in
+0001ee10: 2027 6970 7974 686f 6e27 2077 6865 6e20   'ipython' when 
+0001ee20: 7079 666c 7962 7920 6973 2069 6e73 7461  pyflyby is insta
+0001ee30: 6c6c 6564 2069 6e0a 2020 2020 2320 6970  lled in.    # ip
+0001ee40: 7974 686f 6e5f 636f 6e66 6967 2e0a 2020  ython_config..  
+0001ee50: 2020 5f69 6e73 7461 6c6c 5f6c 6f61 645f    _install_load_
+0001ee60: 6578 745f 7079 666c 7962 795f 696e 5f63  ext_pyflyby_in_c
+0001ee70: 6f6e 6669 6728 746d 702e 6970 7974 686f  onfig(tmp.ipytho
+0001ee80: 6e5f 6469 7229 0a20 2020 2069 7079 7468  n_dir).    ipyth
+0001ee90: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
+0001eea0: 6e20 5b31 5d3a 2062 3634 6465 636f 5c74  n [1]: b64deco\t
+0001eeb0: 6465 2827 6257 4677 6247 553d 2729 0a20  de('bWFwbGU='). 
+0001eec0: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+0001eed0: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
+0001eee0: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
+0001eef0: 2020 2020 2020 4f75 745b 315d 3a20 6227        Out[1]: b'
+0001ef00: 6d61 706c 6527 0a20 2020 2022 2222 2c20  maple'.    """, 
+0001ef10: 6970 7974 686f 6e5f 6469 723d 746d 702e  ipython_dir=tmp.
+0001ef20: 6970 7974 686f 6e5f 6469 7229 0a20 2020  ipython_dir).   
+0001ef30: 2023 2044 6f75 626c 652d 6368 6563 6b20   # Double-check 
+0001ef40: 7468 6174 2077 6520 6f6e 6c79 206d 6f64  that we only mod
+0001ef50: 6966 6965 6420 746d 702e 6970 7974 686f  ified tmp.ipytho
+0001ef60: 6e5f 6469 722e 0a20 2020 2069 7079 7468  n_dir..    ipyth
+0001ef70: 6f6e 280a 2020 2020 2020 2020 2222 220a  on(.        """.
+0001ef80: 2020 2020 2020 2020 496e 205b 315d 3a20          In [1]: 
+0001ef90: 6236 3464 6563 6f64 6528 2778 2729 0a20  b64decode('x'). 
+0001efa0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0001efb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001efc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001efd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001efe0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001eff0: 2d2d 0a20 2020 2020 2020 204e 616d 6545  --.        NameE
+0001f000: 7272 6f72 2020 2020 2020 2020 2020 2020  rror            
+0001f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f020: 2020 2020 2054 7261 6365 6261 636b 2028       Traceback (
+0001f030: 6d6f 7374 2072 6563 656e 7420 6361 6c6c  most recent call
+0001f040: 206c 6173 7429 0a20 2020 2020 2020 202e   last).        .
+0001f050: 2e2e 2069 6e20 2e2e 2e0a 2020 2020 2020  .. in ....      
+0001f060: 2020 4e61 6d65 4572 726f 723a 206e 616d    NameError: nam
+0001f070: 6520 2762 3634 6465 636f 6465 2720 6973  e 'b64decode' is
+0001f080: 206e 6f74 2064 6566 696e 6564 0a20 2020   not defined.   
+0001f090: 2022 2222 0a20 2020 2029 0a0a 0a40 7265   """.    )...@re
+0001f0a0: 7472 790a 6465 6620 7465 7374 5f69 6e73  try.def test_ins
+0001f0b0: 7461 6c6c 6564 5f69 6e5f 636f 6e66 6967  talled_in_config
+0001f0c0: 5f72 6564 756e 6461 6e74 5f31 2874 6d70  _redundant_1(tmp
+0001f0d0: 293a 0a20 2020 2023 2056 6572 6966 7920  ):.    # Verify 
+0001f0e0: 7468 6174 2072 6564 756e 6461 6e74 2069  that redundant i
+0001f0f0: 6e73 7461 6c6c 6174 696f 6e73 2061 7265  nstallations are
+0001f100: 2066 696e 652e 0a20 2020 205f 696e 7374   fine..    _inst
+0001f110: 616c 6c5f 6c6f 6164 5f65 7874 5f70 7966  all_load_ext_pyf
+0001f120: 6c79 6279 5f69 6e5f 636f 6e66 6967 2874  lyby_in_config(t
+0001f130: 6d70 2e69 7079 7468 6f6e 5f64 6972 290a  mp.ipython_dir).
+0001f140: 2020 2020 5f69 6e73 7461 6c6c 5f6c 6f61      _install_loa
+0001f150: 645f 6578 745f 7079 666c 7962 795f 696e  d_ext_pyflyby_in
+0001f160: 5f63 6f6e 6669 6728 746d 702e 6970 7974  _config(tmp.ipyt
+0001f170: 686f 6e5f 6469 7229 0a20 2020 2069 7079  hon_dir).    ipy
+0001f180: 7468 6f6e 2822 2222 0a20 2020 2020 2020  thon(""".       
+0001f190: 2049 6e20 5b31 5d3a 2062 3634 6465 636f   In [1]: b64deco
+0001f1a0: 5c74 6465 2827 6257 4677 6247 553d 2729  \tde('bWFwbGU=')
+0001f1b0: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
+0001f1c0: 595d 2066 726f 6d20 6261 7365 3634 2069  Y] from base64 i
+0001f1d0: 6d70 6f72 7420 6236 3464 6563 6f64 650a  mport b64decode.
+0001f1e0: 2020 2020 2020 2020 4f75 745b 315d 3a20          Out[1]: 
+0001f1f0: 6227 6d61 706c 6527 0a20 2020 2022 2222  b'maple'.    """
+0001f200: 2c20 6970 7974 686f 6e5f 6469 723d 746d  , ipython_dir=tm
+0001f210: 702e 6970 7974 686f 6e5f 6469 7229 0a20  p.ipython_dir). 
+0001f220: 2020 2023 2044 6f75 626c 652d 6368 6563     # Double-chec
+0001f230: 6b20 7468 6174 2077 6520 6f6e 6c79 206d  k that we only m
+0001f240: 6f64 6966 6965 6420 746d 702e 6970 7974  odified tmp.ipyt
+0001f250: 686f 6e5f 6469 722e 0a20 2020 2069 7079  hon_dir..    ipy
+0001f260: 7468 6f6e 280a 2020 2020 2020 2020 2222  thon(.        ""
+0001f270: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
+0001f280: 3a20 6236 3464 6563 6f64 6528 2778 2729  : b64decode('x')
+0001f290: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0001f2a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f2b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f2c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f2d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f2e0: 2d2d 2d2d 0a20 2020 2020 2020 204e 616d  ----.        Nam
+0001f2f0: 6545 7272 6f72 2020 2020 2020 2020 2020  eError          
+0001f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f310: 2020 2020 2020 2054 7261 6365 6261 636b         Traceback
+0001f320: 2028 6d6f 7374 2072 6563 656e 7420 6361   (most recent ca
+0001f330: 6c6c 206c 6173 7429 0a20 2020 2020 2020  ll last).       
+0001f340: 202e 2e2e 2069 6e20 2e2e 2e0a 2020 2020   ... in ....    
+0001f350: 2020 2020 4e61 6d65 4572 726f 723a 206e      NameError: n
+0001f360: 616d 6520 2762 3634 6465 636f 6465 2720  ame 'b64decode' 
+0001f370: 6973 206e 6f74 2064 6566 696e 6564 0a20  is not defined. 
+0001f380: 2020 2022 2222 0a20 2020 2029 0a0a 0a40     """.    )...@
+0001f390: 736b 6970 6966 5f69 7079 7468 6f6e 5f74  skipif_ipython_t
+0001f3a0: 6f6f 5f6f 6c64 5f66 6f72 5f6b 6572 6e65  oo_old_for_kerne
+0001f3b0: 6c0a 4072 6574 7279 0a40 7079 7465 7374  l.@retry.@pytest
+0001f3c0: 2e6d 6172 6b2e 7866 6169 6c28 0a20 2020  .mark.xfail(.   
+0001f3d0: 2073 7973 2e76 6572 7369 6f6e 5f69 6e66   sys.version_inf
+0001f3e0: 6f5b 305d 203d 3d20 332c 0a20 2020 2072  o[0] == 3,.    r
+0001f3f0: 6561 736f 6e3d 224e 6565 6420 6e65 7765  eason="Need newe
+0001f400: 7220 7665 7273 696f 6e20 6f66 206a 7570  r version of jup
+0001f410: 7974 6572 5f63 6f6e 736f 6c65 203e 2036  yter_console > 6
+0001f420: 2e34 2e31 206d 6179 6265 203f 2043 6f72  .4.1 maybe ? Cor
+0001f430: 6f75 7469 6e65 206e 6f74 2061 7761 6974  outine not await
+0001f440: 6564 222c 0a20 2020 2073 7472 6963 743d  ed",.    strict=
+0001f450: 4661 6c73 652c 0a29 0a64 6566 2074 6573  False,.).def tes
+0001f460: 745f 696e 7374 616c 6c65 645f 696e 5f63  t_installed_in_c
+0001f470: 6f6e 6669 675f 6970 7974 686f 6e5f 636f  onfig_ipython_co
+0001f480: 6e73 6f6c 655f 3128 746d 7029 3a0a 2020  nsole_1(tmp):.  
+0001f490: 2020 2320 5665 7269 6679 2074 6861 7420    # Verify that 
+0001f4a0: 6175 746f 696d 706f 7274 2077 6f72 6b73  autoimport works
+0001f4b0: 2069 6e20 2769 7079 7468 6f6e 2063 6f6e   in 'ipython con
+0001f4c0: 736f 6c65 2720 7768 656e 2070 7966 6c79  sole' when pyfly
+0001f4d0: 6279 2069 730a 2020 2020 2320 696e 7374  by is.    # inst
+0001f4e0: 616c 6c65 6420 696e 2069 7079 7468 6f6e  alled in ipython
+0001f4f0: 5f63 6f6e 6669 672e 0a20 2020 205f 696e  _config..    _in
+0001f500: 7374 616c 6c5f 6c6f 6164 5f65 7874 5f70  stall_load_ext_p
+0001f510: 7966 6c79 6279 5f69 6e5f 636f 6e66 6967  yflyby_in_config
+0001f520: 2874 6d70 2e69 7079 7468 6f6e 5f64 6972  (tmp.ipython_dir
+0001f530: 290a 2020 2020 6970 7974 686f 6e28 2222  ).    ipython(""
+0001f540: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
+0001f550: 3a20 6236 3464 6563 6f5c 7464 6528 2763  : b64deco\tde('c
+0001f560: 3342 7964 574e 6c27 290a 2020 2020 2020  3BydWNl').      
+0001f570: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
+0001f580: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
+0001f590: 3634 6465 636f 6465 0a20 2020 2020 2020  64decode.       
+0001f5a0: 204f 7574 5b31 5d3a 2062 2773 7072 7563   Out[1]: b'spruc
+0001f5b0: 6527 0a20 2020 2022 2222 2c20 6172 6773  e'.    """, args
+0001f5c0: 3d5b 2763 6f6e 736f 6c65 275d 2c20 6970  =['console'], ip
+0001f5d0: 7974 686f 6e5f 6469 723d 746d 702e 6970  ython_dir=tmp.ip
+0001f5e0: 7974 686f 6e5f 6469 7229 0a0a 0a40 736b  ython_dir)...@sk
+0001f5f0: 6970 6966 5f69 7079 7468 6f6e 5f74 6f6f  ipif_ipython_too
+0001f600: 5f6f 6c64 5f66 6f72 5f6b 6572 6e65 6c0a  _old_for_kernel.
+0001f610: 4072 6574 7279 0a40 7079 7465 7374 2e6d  @retry.@pytest.m
+0001f620: 6172 6b2e 7866 6169 6c28 0a20 2020 2073  ark.xfail(.    s
+0001f630: 7973 2e76 6572 7369 6f6e 5f69 6e66 6f5b  ys.version_info[
+0001f640: 305d 203d 3d20 332c 0a20 2020 2072 6561  0] == 3,.    rea
+0001f650: 736f 6e3d 224e 6565 6420 6e65 7765 7220  son="Need newer 
+0001f660: 7665 7273 696f 6e20 6f66 206a 7570 7974  version of jupyt
+0001f670: 6572 5f63 6f6e 736f 6c65 203e 2036 2e34  er_console > 6.4
+0001f680: 2e31 206d 6179 6265 203f 2043 6f72 6f75  .1 maybe ? Corou
+0001f690: 7469 6e65 206e 6f74 2061 7761 6974 6564  tine not awaited
+0001f6a0: 222c 0a20 2020 2073 7472 6963 743d 4661  ",.    strict=Fa
+0001f6b0: 6c73 652c 0a29 0a64 6566 2074 6573 745f  lse,.).def test_
+0001f6c0: 696e 7374 616c 6c65 645f 696e 5f63 6f6e  installed_in_con
+0001f6d0: 6669 675f 6970 7974 686f 6e5f 6b65 726e  fig_ipython_kern
+0001f6e0: 656c 5f31 2874 6d70 293a 0a20 2020 2023  el_1(tmp):.    #
+0001f6f0: 2056 6572 6966 7920 7468 6174 2061 7574   Verify that aut
+0001f700: 6f69 6d70 6f72 7420 776f 726b 7320 696e  oimport works in
+0001f710: 2027 6970 7974 686f 6e20 6b65 726e 656c   'ipython kernel
+0001f720: 2720 7768 656e 2070 7966 6c79 6279 2069  ' when pyflyby i
+0001f730: 730a 2020 2020 2320 696e 7374 616c 6c65  s.    # installe
+0001f740: 6420 696e 2069 7079 7468 6f6e 5f63 6f6e  d in ipython_con
+0001f750: 6669 672e 0a20 2020 205f 696e 7374 616c  fig..    _instal
+0001f760: 6c5f 6c6f 6164 5f65 7874 5f70 7966 6c79  l_load_ext_pyfly
+0001f770: 6279 5f69 6e5f 636f 6e66 6967 2874 6d70  by_in_config(tmp
+0001f780: 2e69 7079 7468 6f6e 5f64 6972 290a 2020  .ipython_dir).  
+0001f790: 2020 7769 7468 2049 5079 7468 6f6e 4b65    with IPythonKe
+0001f7a0: 726e 656c 4374 7828 6970 7974 686f 6e5f  rnelCtx(ipython_
+0001f7b0: 6469 723d 746d 702e 6970 7974 686f 6e5f  dir=tmp.ipython_
+0001f7c0: 6469 7229 2061 7320 6b65 726e 656c 3a0a  dir) as kernel:.
+0001f7d0: 2020 2020 2020 2020 6970 7974 686f 6e28          ipython(
+0001f7e0: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+0001f7f0: 496e 205b 315d 3a20 6236 3464 6563 6f5c  In [1]: b64deco\
+0001f800: 7464 6528 2762 3246 7227 290a 2020 2020  tde('b2Fr').    
+0001f810: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
+0001f820: 5d20 6672 6f6d 2062 6173 6536 3420 696d  ] from base64 im
+0001f830: 706f 7274 2062 3634 6465 636f 6465 0a20  port b64decode. 
+0001f840: 2020 2020 2020 2020 2020 204f 7574 5b31             Out[1
+0001f850: 5d3a 2062 276f 616b 270a 2020 2020 2020  ]: b'oak'.      
+0001f860: 2020 2222 222c 2061 7267 733d 5b27 636f    """, args=['co
+0001f870: 6e73 6f6c 6527 5d2c 206b 6572 6e65 6c3d  nsole'], kernel=
+0001f880: 6b65 726e 656c 290a 0a0a 4073 6b69 7069  kernel)...@skipi
+0001f890: 665f 6970 7974 686f 6e5f 746f 6f5f 6f6c  f_ipython_too_ol
+0001f8a0: 645f 666f 725f 6b65 726e 656c 0a40 7079  d_for_kernel.@py
+0001f8b0: 7465 7374 2e6d 6172 6b2e 7866 6169 6c28  test.mark.xfail(
+0001f8c0: 0a20 2020 2073 7973 2e76 6572 7369 6f6e  .    sys.version
+0001f8d0: 5f69 6e66 6f5b 305d 203d 3d20 332c 0a20  _info[0] == 3,. 
+0001f8e0: 2020 2072 6561 736f 6e3d 224e 6565 6420     reason="Need 
+0001f8f0: 6e65 7765 7220 7665 7273 696f 6e20 6f66  newer version of
+0001f900: 206a 7570 7974 6572 5f63 6f6e 736f 6c65   jupyter_console
+0001f910: 203e 2036 2e34 2e31 206d 6179 6265 203f   > 6.4.1 maybe ?
+0001f920: 2043 6f72 6f75 7469 6e65 206e 6f74 2061   Coroutine not a
+0001f930: 7761 6974 6564 222c 0a20 2020 2073 7472  waited",.    str
+0001f940: 6963 743d 4661 6c73 652c 0a29 0a40 7265  ict=False,.).@re
+0001f950: 7472 790a 6465 6620 7465 7374 5f69 6e73  try.def test_ins
+0001f960: 7461 6c6c 6564 5f69 6e5f 636f 6e66 6967  talled_in_config
+0001f970: 5f69 7079 7468 6f6e 5f6e 6f74 6562 6f6f  _ipython_noteboo
+0001f980: 6b5f 3128 746d 7029 3a0a 2020 2020 5f69  k_1(tmp):.    _i
+0001f990: 6e73 7461 6c6c 5f6c 6f61 645f 6578 745f  nstall_load_ext_
+0001f9a0: 7079 666c 7962 795f 696e 5f63 6f6e 6669  pyflyby_in_confi
+0001f9b0: 6728 746d 702e 6970 7974 686f 6e5f 6469  g(tmp.ipython_di
+0001f9c0: 7229 0a20 2020 2077 6974 6820 4950 7974  r).    with IPyt
+0001f9d0: 686f 6e4e 6f74 6562 6f6f 6b43 7478 2869  honNotebookCtx(i
+0001f9e0: 7079 7468 6f6e 5f64 6972 3d74 6d70 2e69  python_dir=tmp.i
+0001f9f0: 7079 7468 6f6e 5f64 6972 2920 6173 206b  python_dir) as k
+0001fa00: 6572 6e65 6c3a 0a20 2020 2020 2020 2069  ernel:.        i
+0001fa10: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
+0001fa20: 2020 2020 2020 2049 6e20 5b31 5d3a 2062         In [1]: b
+0001fa30: 3634 6465 636f 5c74 6465 2827 6333 6c6a  64deco\tde('c3lj
+0001fa40: 5957 3176 636d 553d 2729 0a20 2020 2020  YW1vcmU=').     
+0001fa50: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+0001fa60: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
+0001fa70: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
+0001fa80: 2020 2020 2020 2020 2020 4f75 745b 315d            Out[1]
+0001fa90: 3a20 6227 7379 6361 6d6f 7265 270a 2020  : b'sycamore'.  
+0001faa0: 2020 2020 2020 2222 222c 2061 7267 733d        """, args=
+0001fab0: 5b27 636f 6e73 6f6c 6527 5d2c 206b 6572  ['console'], ker
+0001fac0: 6e65 6c3d 6b65 726e 656c 290a 0a0a 4072  nel=kernel)...@r
+0001fad0: 6574 7279 0a64 6566 2074 6573 745f 696e  etry.def test_in
+0001fae0: 7374 616c 6c65 645f 696e 5f63 6f6e 6669  stalled_in_confi
+0001faf0: 675f 6469 7361 626c 655f 3128 746d 7029  g_disable_1(tmp)
+0001fb00: 3a0a 2020 2020 2320 5665 7269 6679 2074  :.    # Verify t
+0001fb10: 6861 7420 7768 656e 2077 6527 7665 2069  hat when we've i
+0001fb20: 6e73 7461 6c6c 6564 2c20 7765 2063 616e  nstalled, we can
+0001fb30: 2073 7469 6c6c 2064 6973 6162 6c65 2061   still disable a
+0001fb40: 7420 7275 6e2d 7469 6d65 2c20 616e 640a  t run-time, and.
+0001fb50: 2020 2020 2320 616c 736f 2072 652d 656e      # also re-en
+0001fb60: 6162 6c65 2e0a 2020 2020 5f69 6e73 7461  able..    _insta
+0001fb70: 6c6c 5f6c 6f61 645f 6578 745f 7079 666c  ll_load_ext_pyfl
+0001fb80: 7962 795f 696e 5f63 6f6e 6669 6728 746d  yby_in_config(tm
+0001fb90: 702e 6970 7974 686f 6e5f 6469 7229 0a20  p.ipython_dir). 
+0001fba0: 2020 2069 7079 7468 6f6e 280a 2020 2020     ipython(.    
+0001fbb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001fbc0: 496e 205b 315d 3a20 6236 3464 6563 6f5c  In [1]: b64deco\
+0001fbd0: 7464 6528 2763 476c 755a 513d 3d27 290a  tde('cGluZQ==').
+0001fbe0: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
+0001fbf0: 5d20 6672 6f6d 2062 6173 6536 3420 696d  ] from base64 im
+0001fc00: 706f 7274 2062 3634 6465 636f 6465 0a20  port b64decode. 
+0001fc10: 2020 2020 2020 204f 7574 5b31 5d3a 2062         Out[1]: b
+0001fc20: 2770 696e 6527 0a20 2020 2020 2020 2049  'pine'.        I
+0001fc30: 6e20 5b32 5d3a 2070 7966 6c79 6279 2e64  n [2]: pyflyby.d
+0001fc40: 6973 6162 6c65 5f61 7574 6f5f 696d 706f  isable_auto_impo
+0001fc50: 7274 6572 2829 0a20 2020 2020 2020 205b  rter().        [
+0001fc60: 5059 464c 5942 595d 2069 6d70 6f72 7420  PYFLYBY] import 
+0001fc70: 7079 666c 7962 790a 2020 2020 2020 2020  pyflyby.        
+0001fc80: 496e 205b 335d 3a20 6236 3465 6e63 6f64  In [3]: b64encod
+0001fc90: 6528 6227 7827 290a 2020 2020 2020 2020  e(b'x').        
+0001fca0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001fcb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001fcc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001fcd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001fce0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+0001fcf0: 2020 2020 4e61 6d65 4572 726f 7220 2020      NameError   
+0001fd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd10: 2020 2020 2020 2020 2020 2020 2020 5472                Tr
+0001fd20: 6163 6562 6163 6b20 286d 6f73 7420 7265  aceback (most re
+0001fd30: 6365 6e74 2063 616c 6c20 6c61 7374 290a  cent call last).
+0001fd40: 2020 2020 2020 2020 2e2e 2e20 696e 202e          ... in .
+0001fd50: 2e2e 0a20 2020 2020 2020 204e 616d 6545  ...        NameE
+0001fd60: 7272 6f72 3a20 6e61 6d65 2027 6236 3465  rror: name 'b64e
+0001fd70: 6e63 6f64 6527 2069 7320 6e6f 7420 6465  ncode' is not de
+0001fd80: 6669 6e65 640a 2020 2020 2020 2020 496e  fined.        In
+0001fd90: 205b 345d 3a20 6236 3464 6563 6f64 6528   [4]: b64decode(
+0001fda0: 2764 326c 7362 4739 3327 290a 2020 2020  'd2lsbG93').    
+0001fdb0: 2020 2020 4f75 745b 345d 3a20 6227 7769      Out[4]: b'wi
+0001fdc0: 6c6c 6f77 270a 2020 2020 2020 2020 496e  llow'.        In
+0001fdd0: 205b 355d 3a20 7079 666c 7962 792e 656e   [5]: pyflyby.en
+0001fde0: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
+0001fdf0: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
+0001fe00: 5b36 5d3a 2062 3634 656e 636f 6465 2862  [6]: b64encode(b
+0001fe10: 2765 6c6d 2729 0a20 2020 2020 2020 205b  'elm').        [
+0001fe20: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
+0001fe30: 7365 3634 2069 6d70 6f72 7420 6236 3465  se64 import b64e
+0001fe40: 6e63 6f64 650a 2020 2020 2020 2020 4f75  ncode.        Ou
+0001fe50: 745b 365d 3a20 6227 5a57 7874 270a 2020  t[6]: b'ZWxt'.  
+0001fe60: 2020 2222 222c 0a20 2020 2020 2020 2069    """,.        i
+0001fe70: 7079 7468 6f6e 5f64 6972 3d74 6d70 2e69  python_dir=tmp.i
+0001fe80: 7079 7468 6f6e 5f64 6972 2c0a 2020 2020  python_dir,.    
+0001fe90: 290a 0a0a 4072 6574 7279 0a64 6566 2074  )...@retry.def t
+0001fea0: 6573 745f 696e 7374 616c 6c65 645f 696e  est_installed_in
+0001feb0: 5f63 6f6e 6669 675f 656e 6162 6c65 5f6e  _config_enable_n
+0001fec0: 6f6f 705f 3128 746d 7029 3a0a 2020 2020  oop_1(tmp):.    
+0001fed0: 2320 5665 7269 6679 2074 6861 7420 6d61  # Verify that ma
+0001fee0: 6e75 616c 6c79 2063 616c 6c69 6e67 2065  nually calling e
+0001fef0: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+0001ff00: 7465 7228 2920 6973 2061 206e 6f2d 6f70  ter() is a no-op
+0001ff10: 2069 6620 7765 2776 650a 2020 2020 2320   if we've.    # 
+0001ff20: 696e 7374 616c 6c65 6420 7079 666c 7962  installed pyflyb
+0001ff30: 7920 696e 2069 7079 7468 6f6e 5f63 6f6e  y in ipython_con
+0001ff40: 6669 672e 0a20 2020 205f 696e 7374 616c  fig..    _instal
+0001ff50: 6c5f 6c6f 6164 5f65 7874 5f70 7966 6c79  l_load_ext_pyfly
+0001ff60: 6279 5f69 6e5f 636f 6e66 6967 2874 6d70  by_in_config(tmp
+0001ff70: 2e69 7079 7468 6f6e 5f64 6972 290a 2020  .ipython_dir).  
+0001ff80: 2020 6970 7974 686f 6e28 0a20 2020 2020    ipython(.     
+0001ff90: 2020 2022 2222 0a20 2020 2020 2020 2049     """.        I
+0001ffa0: 6e20 5b31 5d3a 2070 7966 6c79 6279 2e65  n [1]: pyflyby.e
+0001ffb0: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+0001ffc0: 7465 7228 290a 2020 2020 2020 2020 5b50  ter().        [P
+0001ffd0: 5946 4c59 4259 5d20 696d 706f 7274 2070  YFLYBY] import p
+0001ffe0: 7966 6c79 6279 0a20 2020 2020 2020 2049  yflyby.        I
+0001fff0: 6e20 5b32 5d3a 2062 3634 6465 636f 5c74  n [2]: b64deco\t
+00020000: 6465 2827 5932 686c 636e 4a35 2729 0a20  de('Y2hlcnJ5'). 
+00020010: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+00020020: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
+00020030: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
+00020040: 2020 2020 2020 4f75 745b 325d 3a20 6227        Out[2]: b'
+00020050: 6368 6572 7279 270a 2020 2020 2020 2020  cherry'.        
+00020060: 496e 205b 335d 3a20 7079 666c 7962 792e  In [3]: pyflyby.
+00020070: 6469 7361 626c 655f 6175 746f 5f69 6d70  disable_auto_imp
+00020080: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
+00020090: 496e 205b 345d 3a20 6236 3465 6e63 6f64  In [4]: b64encod
+000200a0: 6528 6227 7827 290a 2020 2020 2020 2020  e(b'x').        
+000200b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000200c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000200d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000200e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000200f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+00020100: 2020 2020 4e61 6d65 4572 726f 7220 2020      NameError   
+00020110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020120: 2020 2020 2020 2020 2020 2020 2020 5472                Tr
+00020130: 6163 6562 6163 6b20 286d 6f73 7420 7265  aceback (most re
+00020140: 6365 6e74 2063 616c 6c20 6c61 7374 290a  cent call last).
+00020150: 2020 2020 2020 2020 2e2e 2e20 696e 202e          ... in .
+00020160: 2e2e 0a20 2020 2020 2020 204e 616d 6545  ...        NameE
+00020170: 7272 6f72 3a20 6e61 6d65 2027 6236 3465  rror: name 'b64e
+00020180: 6e63 6f64 6527 2069 7320 6e6f 7420 6465  ncode' is not de
+00020190: 6669 6e65 640a 2020 2020 2020 2020 496e  fined.        In
+000201a0: 205b 355d 3a20 6236 3464 6563 6f64 6528   [5]: b64decode(
+000201b0: 2759 6d6c 7959 3267 3d27 290a 2020 2020  'YmlyY2g=').    
+000201c0: 2020 2020 4f75 745b 355d 3a20 6227 6269      Out[5]: b'bi
+000201d0: 7263 6827 0a20 2020 2020 2020 2049 6e20  rch'.        In 
+000201e0: 5b36 5d3a 2070 7966 6c79 6279 2e65 6e61  [6]: pyflyby.ena
+000201f0: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
+00020200: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
+00020210: 375d 3a20 6236 3465 6e63 6f64 6528 6227  7]: b64encode(b'
+00020220: 6669 7227 290a 2020 2020 2020 2020 5b50  fir').        [P
+00020230: 5946 4c59 4259 5d20 6672 6f6d 2062 6173  YFLYBY] from bas
+00020240: 6536 3420 696d 706f 7274 2062 3634 656e  e64 import b64en
+00020250: 636f 6465 0a20 2020 2020 2020 204f 7574  code.        Out
+00020260: 5b37 5d3a 2062 275a 6d6c 7927 0a20 2020  [7]: b'Zmly'.   
+00020270: 2022 2222 2c0a 2020 2020 2020 2020 6970   """,.        ip
+00020280: 7974 686f 6e5f 6469 723d 746d 702e 6970  ython_dir=tmp.ip
+00020290: 7974 686f 6e5f 6469 722c 0a20 2020 2029  ython_dir,.    )
+000202a0: 0a0a 0a40 7265 7472 790a 6465 6620 7465  ...@retry.def te
+000202b0: 7374 5f69 6e73 7461 6c6c 6564 5f69 6e5f  st_installed_in_
+000202c0: 636f 6e66 6967 5f69 7079 7468 6f6e 5f70  config_ipython_p
+000202d0: 795f 3128 746d 7029 3a0a 2020 2020 2320  y_1(tmp):.    # 
+000202e0: 5665 7269 6679 2074 6861 7420 696e 7374  Verify that inst
+000202f0: 616c 6c61 7469 6f6e 2069 6e20 6970 7974  allation in ipyt
+00020300: 686f 6e5f 636f 6e66 6967 2061 6e64 2027  hon_config and '
+00020310: 7079 2720 6172 6520 636f 6d70 6174 6962  py' are compatib
+00020320: 6c65 2e0a 2020 2020 5f69 6e73 7461 6c6c  le..    _install
+00020330: 5f6c 6f61 645f 6578 745f 7079 666c 7962  _load_ext_pyflyb
+00020340: 795f 696e 5f63 6f6e 6669 6728 746d 702e  y_in_config(tmp.
+00020350: 6970 7974 686f 6e5f 6469 7229 0a20 2020  ipython_dir).   
+00020360: 2069 7079 7468 6f6e 280a 2020 2020 2020   ipython(.      
+00020370: 2020 2222 220a 2020 2020 2020 2020 496e    """.        In
 00020380: 205b 315d 3a20 6236 3464 6563 6f5c 7464   [1]: b64deco\td
-00020390: 6528 2762 5746 7762 4755 3d27 290a 2020  e('bWFwbGU=').  
-000203a0: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
-000203b0: 6672 6f6d 2062 6173 6536 3420 696d 706f  from base64 impo
-000203c0: 7274 2062 3634 6465 636f 6465 0a20 2020  rt b64decode.   
-000203d0: 2020 2020 204f 7574 5b31 5d3a 2062 276d       Out[1]: b'm
-000203e0: 6170 6c65 270a 2020 2020 2222 222c 2069  aple'.    """, i
-000203f0: 7079 7468 6f6e 5f64 6972 3d74 6d70 2e69  python_dir=tmp.i
-00020400: 7079 7468 6f6e 5f64 6972 290a 2020 2020  python_dir).    
-00020410: 2320 446f 7562 6c65 2d63 6865 636b 2074  # Double-check t
-00020420: 6861 7420 7765 206f 6e6c 7920 6d6f 6469  hat we only modi
-00020430: 6669 6564 2074 6d70 2e69 7079 7468 6f6e  fied tmp.ipython
-00020440: 5f64 6972 2e0a 2020 2020 6970 7974 686f  _dir..    ipytho
-00020450: 6e28 0a20 2020 2020 2020 2022 2222 0a20  n(.        """. 
-00020460: 2020 2020 2020 2049 6e20 5b31 5d3a 2062         In [1]: b
-00020470: 3634 6465 636f 6465 2827 7827 290a 2020  64decode('x').  
-00020480: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00020390: 6528 2759 6d46 7a63 3364 7662 3251 3d27  e('YmFzc3dvb2Q='
+000203a0: 290a 2020 2020 2020 2020 5b50 5946 4c59  ).        [PYFLY
+000203b0: 4259 5d20 6672 6f6d 2062 6173 6536 3420  BY] from base64 
+000203c0: 696d 706f 7274 2062 3634 6465 636f 6465  import b64decode
+000203d0: 0a20 2020 2020 2020 204f 7574 5b31 5d3a  .        Out[1]:
+000203e0: 2062 2762 6173 7377 6f6f 6427 0a20 2020   b'basswood'.   
+000203f0: 2020 2020 2049 6e20 5b32 5d3a 2070 7966       In [2]: pyf
+00020400: 6c79 6279 2e64 6973 6162 6c65 5f61 7574  lyby.disable_aut
+00020410: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
+00020420: 2020 2020 205b 5059 464c 5942 595d 2069       [PYFLYBY] i
+00020430: 6d70 6f72 7420 7079 666c 7962 790a 2020  mport pyflyby.  
+00020440: 2020 2020 2020 496e 205b 335d 3a20 6236        In [3]: b6
+00020450: 3465 6e63 6f64 6528 6227 7827 290a 2020  4encode(b'x').  
+00020460: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00020470: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00020480: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00020490: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 000204a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000204b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000204c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000204d0: 2d0a 2020 2020 2020 2020 4e61 6d65 4572  -.        NameEr
-000204e0: 726f 7220 2020 2020 2020 2020 2020 2020  ror             
-000204f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020500: 2020 2020 5472 6163 6562 6163 6b20 286d      Traceback (m
-00020510: 6f73 7420 7265 6365 6e74 2063 616c 6c20  ost recent call 
-00020520: 6c61 7374 290a 2020 2020 2020 2020 2e2e  last).        ..
-00020530: 2e20 696e 202e 2e2e 0a20 2020 2020 2020  . in ....       
-00020540: 204e 616d 6545 7272 6f72 3a20 6e61 6d65   NameError: name
-00020550: 2027 6236 3464 6563 6f64 6527 2069 7320   'b64decode' is 
-00020560: 6e6f 7420 6465 6669 6e65 640a 2020 2020  not defined.    
-00020570: 2222 220a 2020 2020 290a 0a0a 4073 6b69  """.    )...@ski
-00020580: 7069 665f 6970 7974 686f 6e5f 746f 6f5f  pif_ipython_too_
-00020590: 6f6c 645f 666f 725f 6b65 726e 656c 0a40  old_for_kernel.@
-000205a0: 7265 7472 790a 4070 7974 6573 742e 6d61  retry.@pytest.ma
-000205b0: 726b 2e78 6661 696c 280a 2020 2020 7379  rk.xfail(.    sy
-000205c0: 732e 7665 7273 696f 6e5f 696e 666f 5b30  s.version_info[0
-000205d0: 5d20 3d3d 2033 2c0a 2020 2020 7265 6173  ] == 3,.    reas
-000205e0: 6f6e 3d22 4e65 6564 206e 6577 6572 2076  on="Need newer v
-000205f0: 6572 7369 6f6e 206f 6620 6a75 7079 7465  ersion of jupyte
-00020600: 725f 636f 6e73 6f6c 6520 3e20 362e 342e  r_console > 6.4.
-00020610: 3120 6d61 7962 6520 3f20 436f 726f 7574  1 maybe ? Corout
-00020620: 696e 6520 6e6f 7420 6177 6169 7465 6422  ine not awaited"
-00020630: 2c0a 2020 2020 7374 7269 6374 3d46 616c  ,.    strict=Fal
-00020640: 7365 2c0a 290a 6465 6620 7465 7374 5f69  se,.).def test_i
-00020650: 6e73 7461 6c6c 6564 5f69 6e5f 636f 6e66  nstalled_in_conf
-00020660: 6967 5f69 7079 7468 6f6e 5f63 6f6e 736f  ig_ipython_conso
-00020670: 6c65 5f31 2874 6d70 293a 0a20 2020 2023  le_1(tmp):.    #
-00020680: 2056 6572 6966 7920 7468 6174 2061 7574   Verify that aut
-00020690: 6f69 6d70 6f72 7420 776f 726b 7320 696e  oimport works in
-000206a0: 2027 6970 7974 686f 6e20 636f 6e73 6f6c   'ipython consol
-000206b0: 6527 2077 6865 6e20 7079 666c 7962 7920  e' when pyflyby 
-000206c0: 6973 0a20 2020 2023 2069 6e73 7461 6c6c  is.    # install
-000206d0: 6564 2069 6e20 6970 7974 686f 6e5f 636f  ed in ipython_co
-000206e0: 6e66 6967 2e0a 2020 2020 5f69 6e73 7461  nfig..    _insta
-000206f0: 6c6c 5f6c 6f61 645f 6578 745f 7079 666c  ll_load_ext_pyfl
-00020700: 7962 795f 696e 5f63 6f6e 6669 6728 746d  yby_in_config(tm
-00020710: 702e 6970 7974 686f 6e5f 6469 7229 0a20  p.ipython_dir). 
-00020720: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
-00020730: 2020 2020 2020 2049 6e20 5b31 5d3a 2062         In [1]: b
-00020740: 3634 6465 636f 5c74 6465 2827 6333 4279  64deco\tde('c3By
-00020750: 6457 4e6c 2729 0a20 2020 2020 2020 205b  dWNl').        [
-00020760: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
-00020770: 7365 3634 2069 6d70 6f72 7420 6236 3464  se64 import b64d
-00020780: 6563 6f64 650a 2020 2020 2020 2020 4f75  ecode.        Ou
-00020790: 745b 315d 3a20 6227 7370 7275 6365 270a  t[1]: b'spruce'.
-000207a0: 2020 2020 2222 222c 2061 7267 733d 5b27      """, args=['
-000207b0: 636f 6e73 6f6c 6527 5d2c 2069 7079 7468  console'], ipyth
-000207c0: 6f6e 5f64 6972 3d74 6d70 2e69 7079 7468  on_dir=tmp.ipyth
-000207d0: 6f6e 5f64 6972 290a 0a0a 4073 6b69 7069  on_dir)...@skipi
-000207e0: 665f 6970 7974 686f 6e5f 746f 6f5f 6f6c  f_ipython_too_ol
-000207f0: 645f 666f 725f 6b65 726e 656c 0a40 7265  d_for_kernel.@re
-00020800: 7472 790a 4070 7974 6573 742e 6d61 726b  try.@pytest.mark
-00020810: 2e78 6661 696c 280a 2020 2020 7379 732e  .xfail(.    sys.
-00020820: 7665 7273 696f 6e5f 696e 666f 5b30 5d20  version_info[0] 
-00020830: 3d3d 2033 2c0a 2020 2020 7265 6173 6f6e  == 3,.    reason
-00020840: 3d22 4e65 6564 206e 6577 6572 2076 6572  ="Need newer ver
-00020850: 7369 6f6e 206f 6620 6a75 7079 7465 725f  sion of jupyter_
-00020860: 636f 6e73 6f6c 6520 3e20 362e 342e 3120  console > 6.4.1 
-00020870: 6d61 7962 6520 3f20 436f 726f 7574 696e  maybe ? Coroutin
-00020880: 6520 6e6f 7420 6177 6169 7465 6422 2c0a  e not awaited",.
-00020890: 2020 2020 7374 7269 6374 3d46 616c 7365      strict=False
-000208a0: 2c0a 290a 6465 6620 7465 7374 5f69 6e73  ,.).def test_ins
-000208b0: 7461 6c6c 6564 5f69 6e5f 636f 6e66 6967  talled_in_config
-000208c0: 5f69 7079 7468 6f6e 5f6b 6572 6e65 6c5f  _ipython_kernel_
-000208d0: 3128 746d 7029 3a0a 2020 2020 2320 5665  1(tmp):.    # Ve
-000208e0: 7269 6679 2074 6861 7420 6175 746f 696d  rify that autoim
-000208f0: 706f 7274 2077 6f72 6b73 2069 6e20 2769  port works in 'i
-00020900: 7079 7468 6f6e 206b 6572 6e65 6c27 2077  python kernel' w
-00020910: 6865 6e20 7079 666c 7962 7920 6973 0a20  hen pyflyby is. 
-00020920: 2020 2023 2069 6e73 7461 6c6c 6564 2069     # installed i
-00020930: 6e20 6970 7974 686f 6e5f 636f 6e66 6967  n ipython_config
-00020940: 2e0a 2020 2020 5f69 6e73 7461 6c6c 5f6c  ..    _install_l
-00020950: 6f61 645f 6578 745f 7079 666c 7962 795f  oad_ext_pyflyby_
-00020960: 696e 5f63 6f6e 6669 6728 746d 702e 6970  in_config(tmp.ip
-00020970: 7974 686f 6e5f 6469 7229 0a20 2020 2077  ython_dir).    w
-00020980: 6974 6820 4950 7974 686f 6e4b 6572 6e65  ith IPythonKerne
-00020990: 6c43 7478 2869 7079 7468 6f6e 5f64 6972  lCtx(ipython_dir
-000209a0: 3d74 6d70 2e69 7079 7468 6f6e 5f64 6972  =tmp.ipython_dir
-000209b0: 2920 6173 206b 6572 6e65 6c3a 0a20 2020  ) as kernel:.   
-000209c0: 2020 2020 2069 7079 7468 6f6e 2822 2222       ipython("""
-000209d0: 0a20 2020 2020 2020 2020 2020 2049 6e20  .            In 
-000209e0: 5b31 5d3a 2062 3634 6465 636f 5c74 6465  [1]: b64deco\tde
-000209f0: 2827 6232 4672 2729 0a20 2020 2020 2020  ('b2Fr').       
-00020a00: 2020 2020 205b 5059 464c 5942 595d 2066       [PYFLYBY] f
-00020a10: 726f 6d20 6261 7365 3634 2069 6d70 6f72  rom base64 impor
-00020a20: 7420 6236 3464 6563 6f64 650a 2020 2020  t b64decode.    
-00020a30: 2020 2020 2020 2020 4f75 745b 315d 3a20          Out[1]: 
-00020a40: 6227 6f61 6b27 0a20 2020 2020 2020 2022  b'oak'.        "
-00020a50: 2222 2c20 6172 6773 3d5b 2763 6f6e 736f  "", args=['conso
-00020a60: 6c65 275d 2c20 6b65 726e 656c 3d6b 6572  le'], kernel=ker
-00020a70: 6e65 6c29 0a0a 0a40 736b 6970 6966 5f69  nel)...@skipif_i
-00020a80: 7079 7468 6f6e 5f74 6f6f 5f6f 6c64 5f66  python_too_old_f
-00020a90: 6f72 5f6b 6572 6e65 6c0a 4070 7974 6573  or_kernel.@pytes
-00020aa0: 742e 6d61 726b 2e78 6661 696c 280a 2020  t.mark.xfail(.  
-00020ab0: 2020 7379 732e 7665 7273 696f 6e5f 696e    sys.version_in
-00020ac0: 666f 5b30 5d20 3d3d 2033 2c0a 2020 2020  fo[0] == 3,.    
-00020ad0: 7265 6173 6f6e 3d22 4e65 6564 206e 6577  reason="Need new
-00020ae0: 6572 2076 6572 7369 6f6e 206f 6620 6a75  er version of ju
-00020af0: 7079 7465 725f 636f 6e73 6f6c 6520 3e20  pyter_console > 
-00020b00: 362e 342e 3120 6d61 7962 6520 3f20 436f  6.4.1 maybe ? Co
-00020b10: 726f 7574 696e 6520 6e6f 7420 6177 6169  routine not awai
-00020b20: 7465 6422 2c0a 2020 2020 7374 7269 6374  ted",.    strict
-00020b30: 3d46 616c 7365 2c0a 290a 4072 6574 7279  =False,.).@retry
-00020b40: 0a64 6566 2074 6573 745f 696e 7374 616c  .def test_instal
-00020b50: 6c65 645f 696e 5f63 6f6e 6669 675f 6970  led_in_config_ip
-00020b60: 7974 686f 6e5f 6e6f 7465 626f 6f6b 5f31  ython_notebook_1
-00020b70: 2874 6d70 293a 0a20 2020 205f 696e 7374  (tmp):.    _inst
-00020b80: 616c 6c5f 6c6f 6164 5f65 7874 5f70 7966  all_load_ext_pyf
-00020b90: 6c79 6279 5f69 6e5f 636f 6e66 6967 2874  lyby_in_config(t
-00020ba0: 6d70 2e69 7079 7468 6f6e 5f64 6972 290a  mp.ipython_dir).
-00020bb0: 2020 2020 7769 7468 2049 5079 7468 6f6e      with IPython
-00020bc0: 4e6f 7465 626f 6f6b 4374 7828 6970 7974  NotebookCtx(ipyt
-00020bd0: 686f 6e5f 6469 723d 746d 702e 6970 7974  hon_dir=tmp.ipyt
-00020be0: 686f 6e5f 6469 7229 2061 7320 6b65 726e  hon_dir) as kern
-00020bf0: 656c 3a0a 2020 2020 2020 2020 6970 7974  el:.        ipyt
-00020c00: 686f 6e28 2222 220a 2020 2020 2020 2020  hon(""".        
-00020c10: 2020 2020 496e 205b 315d 3a20 6236 3464      In [1]: b64d
-00020c20: 6563 6f5c 7464 6528 2763 336c 6a59 5731  eco\tde('c3ljYW1
-00020c30: 7663 6d55 3d27 290a 2020 2020 2020 2020  vcmU=').        
-00020c40: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
-00020c50: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
-00020c60: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
-00020c70: 2020 2020 2020 204f 7574 5b31 5d3a 2062         Out[1]: b
-00020c80: 2773 7963 616d 6f72 6527 0a20 2020 2020  'sycamore'.     
-00020c90: 2020 2022 2222 2c20 6172 6773 3d5b 2763     """, args=['c
-00020ca0: 6f6e 736f 6c65 275d 2c20 6b65 726e 656c  onsole'], kernel
-00020cb0: 3d6b 6572 6e65 6c29 0a0a 0a40 7265 7472  =kernel)...@retr
-00020cc0: 790a 6465 6620 7465 7374 5f69 6e73 7461  y.def test_insta
-00020cd0: 6c6c 6564 5f69 6e5f 636f 6e66 6967 5f64  lled_in_config_d
-00020ce0: 6973 6162 6c65 5f31 2874 6d70 293a 0a20  isable_1(tmp):. 
-00020cf0: 2020 2023 2056 6572 6966 7920 7468 6174     # Verify that
-00020d00: 2077 6865 6e20 7765 2776 6520 696e 7374   when we've inst
-00020d10: 616c 6c65 642c 2077 6520 6361 6e20 7374  alled, we can st
-00020d20: 696c 6c20 6469 7361 626c 6520 6174 2072  ill disable at r
-00020d30: 756e 2d74 696d 652c 2061 6e64 0a20 2020  un-time, and.   
-00020d40: 2023 2061 6c73 6f20 7265 2d65 6e61 626c   # also re-enabl
-00020d50: 652e 0a20 2020 205f 696e 7374 616c 6c5f  e..    _install_
-00020d60: 6c6f 6164 5f65 7874 5f70 7966 6c79 6279  load_ext_pyflyby
-00020d70: 5f69 6e5f 636f 6e66 6967 2874 6d70 2e69  _in_config(tmp.i
-00020d80: 7079 7468 6f6e 5f64 6972 290a 2020 2020  python_dir).    
-00020d90: 6970 7974 686f 6e28 0a20 2020 2020 2020  ipython(.       
-00020da0: 2022 2222 0a20 2020 2020 2020 2049 6e20   """.        In 
-00020db0: 5b31 5d3a 2062 3634 6465 636f 5c74 6465  [1]: b64deco\tde
-00020dc0: 2827 6347 6c75 5a51 3d3d 2729 0a20 2020  ('cGluZQ==').   
-00020dd0: 2020 2020 205b 5059 464c 5942 595d 2066       [PYFLYBY] f
-00020de0: 726f 6d20 6261 7365 3634 2069 6d70 6f72  rom base64 impor
-00020df0: 7420 6236 3464 6563 6f64 650a 2020 2020  t b64decode.    
-00020e00: 2020 2020 4f75 745b 315d 3a20 6227 7069      Out[1]: b'pi
-00020e10: 6e65 270a 2020 2020 2020 2020 496e 205b  ne'.        In [
-00020e20: 325d 3a20 7079 666c 7962 792e 6469 7361  2]: pyflyby.disa
-00020e30: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
-00020e40: 7228 290a 2020 2020 2020 2020 5b50 5946  r().        [PYF
-00020e50: 4c59 4259 5d20 696d 706f 7274 2070 7966  LYBY] import pyf
-00020e60: 6c79 6279 0a20 2020 2020 2020 2049 6e20  lyby.        In 
-00020e70: 5b33 5d3a 2062 3634 656e 636f 6465 2862  [3]: b64encode(b
-00020e80: 2778 2729 0a20 2020 2020 2020 202d 2d2d  'x').        ---
-00020e90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00020ea0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00020eb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00020ec0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00020ed0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00020ee0: 204e 616d 6545 7272 6f72 2020 2020 2020   NameError      
-00020ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f00: 2020 2020 2020 2020 2020 2054 7261 6365             Trace
-00020f10: 6261 636b 2028 6d6f 7374 2072 6563 656e  back (most recen
-00020f20: 7420 6361 6c6c 206c 6173 7429 0a20 2020  t call last).   
-00020f30: 2020 2020 202e 2e2e 2069 6e20 2e2e 2e0a       ... in ....
-00020f40: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
-00020f50: 723a 206e 616d 6520 2762 3634 656e 636f  r: name 'b64enco
-00020f60: 6465 2720 6973 206e 6f74 2064 6566 696e  de' is not defin
-00020f70: 6564 0a20 2020 2020 2020 2049 6e20 5b34  ed.        In [4
-00020f80: 5d3a 2062 3634 6465 636f 6465 2827 6432  ]: b64decode('d2
-00020f90: 6c73 6247 3933 2729 0a20 2020 2020 2020  lsbG93').       
-00020fa0: 204f 7574 5b34 5d3a 2062 2777 696c 6c6f   Out[4]: b'willo
-00020fb0: 7727 0a20 2020 2020 2020 2049 6e20 5b35  w'.        In [5
-00020fc0: 5d3a 2070 7966 6c79 6279 2e65 6e61 626c  ]: pyflyby.enabl
-00020fd0: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
-00020fe0: 290a 2020 2020 2020 2020 496e 205b 365d  ).        In [6]
-00020ff0: 3a20 6236 3465 6e63 6f64 6528 6227 656c  : b64encode(b'el
-00021000: 6d27 290a 2020 2020 2020 2020 5b50 5946  m').        [PYF
-00021010: 4c59 4259 5d20 6672 6f6d 2062 6173 6536  LYBY] from base6
-00021020: 3420 696d 706f 7274 2062 3634 656e 636f  4 import b64enco
-00021030: 6465 0a20 2020 2020 2020 204f 7574 5b36  de.        Out[6
-00021040: 5d3a 2062 275a 5778 7427 0a20 2020 2022  ]: b'ZWxt'.    "
-00021050: 2222 2c0a 2020 2020 2020 2020 6970 7974  "",.        ipyt
-00021060: 686f 6e5f 6469 723d 746d 702e 6970 7974  hon_dir=tmp.ipyt
-00021070: 686f 6e5f 6469 722c 0a20 2020 2029 0a0a  hon_dir,.    )..
-00021080: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
-00021090: 5f69 6e73 7461 6c6c 6564 5f69 6e5f 636f  _installed_in_co
-000210a0: 6e66 6967 5f65 6e61 626c 655f 6e6f 6f70  nfig_enable_noop
-000210b0: 5f31 2874 6d70 293a 0a20 2020 2023 2056  _1(tmp):.    # V
-000210c0: 6572 6966 7920 7468 6174 206d 616e 7561  erify that manua
-000210d0: 6c6c 7920 6361 6c6c 696e 6720 656e 6162  lly calling enab
-000210e0: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-000210f0: 2829 2069 7320 6120 6e6f 2d6f 7020 6966  () is a no-op if
-00021100: 2077 6527 7665 0a20 2020 2023 2069 6e73   we've.    # ins
-00021110: 7461 6c6c 6564 2070 7966 6c79 6279 2069  talled pyflyby i
-00021120: 6e20 6970 7974 686f 6e5f 636f 6e66 6967  n ipython_config
-00021130: 2e0a 2020 2020 5f69 6e73 7461 6c6c 5f6c  ..    _install_l
-00021140: 6f61 645f 6578 745f 7079 666c 7962 795f  oad_ext_pyflyby_
-00021150: 696e 5f63 6f6e 6669 6728 746d 702e 6970  in_config(tmp.ip
-00021160: 7974 686f 6e5f 6469 7229 0a20 2020 2069  ython_dir).    i
-00021170: 7079 7468 6f6e 280a 2020 2020 2020 2020  python(.        
-00021180: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-00021190: 315d 3a20 7079 666c 7962 792e 656e 6162  1]: pyflyby.enab
-000211a0: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-000211b0: 2829 0a20 2020 2020 2020 205b 5059 464c  ().        [PYFL
-000211c0: 5942 595d 2069 6d70 6f72 7420 7079 666c  YBY] import pyfl
-000211d0: 7962 790a 2020 2020 2020 2020 496e 205b  yby.        In [
-000211e0: 325d 3a20 6236 3464 6563 6f5c 7464 6528  2]: b64deco\tde(
-000211f0: 2759 3268 6c63 6e4a 3527 290a 2020 2020  'Y2hlcnJ5').    
-00021200: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
-00021210: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
-00021220: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
-00021230: 2020 204f 7574 5b32 5d3a 2062 2763 6865     Out[2]: b'che
-00021240: 7272 7927 0a20 2020 2020 2020 2049 6e20  rry'.        In 
-00021250: 5b33 5d3a 2070 7966 6c79 6279 2e64 6973  [3]: pyflyby.dis
-00021260: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
-00021270: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
-00021280: 5b34 5d3a 2062 3634 656e 636f 6465 2862  [4]: b64encode(b
-00021290: 2778 2729 0a20 2020 2020 2020 202d 2d2d  'x').        ---
-000212a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000212b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000212c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000212d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000212e0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-000212f0: 204e 616d 6545 7272 6f72 2020 2020 2020   NameError      
-00021300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021310: 2020 2020 2020 2020 2020 2054 7261 6365             Trace
-00021320: 6261 636b 2028 6d6f 7374 2072 6563 656e  back (most recen
-00021330: 7420 6361 6c6c 206c 6173 7429 0a20 2020  t call last).   
-00021340: 2020 2020 202e 2e2e 2069 6e20 2e2e 2e0a       ... in ....
-00021350: 2020 2020 2020 2020 4e61 6d65 4572 726f          NameErro
-00021360: 723a 206e 616d 6520 2762 3634 656e 636f  r: name 'b64enco
-00021370: 6465 2720 6973 206e 6f74 2064 6566 696e  de' is not defin
-00021380: 6564 0a20 2020 2020 2020 2049 6e20 5b35  ed.        In [5
-00021390: 5d3a 2062 3634 6465 636f 6465 2827 596d  ]: b64decode('Ym
-000213a0: 6c79 5932 673d 2729 0a20 2020 2020 2020  lyY2g=').       
-000213b0: 204f 7574 5b35 5d3a 2062 2762 6972 6368   Out[5]: b'birch
-000213c0: 270a 2020 2020 2020 2020 496e 205b 365d  '.        In [6]
-000213d0: 3a20 7079 666c 7962 792e 656e 6162 6c65  : pyflyby.enable
-000213e0: 5f61 7574 6f5f 696d 706f 7274 6572 2829  _auto_importer()
-000213f0: 0a20 2020 2020 2020 2049 6e20 5b37 5d3a  .        In [7]:
-00021400: 2062 3634 656e 636f 6465 2862 2766 6972   b64encode(b'fir
-00021410: 2729 0a20 2020 2020 2020 205b 5059 464c  ').        [PYFL
-00021420: 5942 595d 2066 726f 6d20 6261 7365 3634  YBY] from base64
-00021430: 2069 6d70 6f72 7420 6236 3465 6e63 6f64   import b64encod
-00021440: 650a 2020 2020 2020 2020 4f75 745b 375d  e.        Out[7]
-00021450: 3a20 6227 5a6d 6c79 270a 2020 2020 2222  : b'Zmly'.    ""
-00021460: 222c 0a20 2020 2020 2020 2069 7079 7468  ",.        ipyth
-00021470: 6f6e 5f64 6972 3d74 6d70 2e69 7079 7468  on_dir=tmp.ipyth
-00021480: 6f6e 5f64 6972 2c0a 2020 2020 290a 0a0a  on_dir,.    )...
-00021490: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
-000214a0: 696e 7374 616c 6c65 645f 696e 5f63 6f6e  installed_in_con
-000214b0: 6669 675f 6970 7974 686f 6e5f 7079 5f31  fig_ipython_py_1
-000214c0: 2874 6d70 293a 0a20 2020 2023 2056 6572  (tmp):.    # Ver
-000214d0: 6966 7920 7468 6174 2069 6e73 7461 6c6c  ify that install
-000214e0: 6174 696f 6e20 696e 2069 7079 7468 6f6e  ation in ipython
-000214f0: 5f63 6f6e 6669 6720 616e 6420 2770 7927  _config and 'py'
-00021500: 2061 7265 2063 6f6d 7061 7469 626c 652e   are compatible.
-00021510: 0a20 2020 205f 696e 7374 616c 6c5f 6c6f  .    _install_lo
-00021520: 6164 5f65 7874 5f70 7966 6c79 6279 5f69  ad_ext_pyflyby_i
-00021530: 6e5f 636f 6e66 6967 2874 6d70 2e69 7079  n_config(tmp.ipy
-00021540: 7468 6f6e 5f64 6972 290a 2020 2020 6970  thon_dir).    ip
-00021550: 7974 686f 6e28 0a20 2020 2020 2020 2022  ython(.        "
-00021560: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
-00021570: 5d3a 2062 3634 6465 636f 5c74 6465 2827  ]: b64deco\tde('
-00021580: 596d 467a 6333 6476 6232 513d 2729 0a20  YmFzc3dvb2Q='). 
-00021590: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
-000215a0: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
-000215b0: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
-000215c0: 2020 2020 2020 4f75 745b 315d 3a20 6227        Out[1]: b'
-000215d0: 6261 7373 776f 6f64 270a 2020 2020 2020  basswood'.      
-000215e0: 2020 496e 205b 325d 3a20 7079 666c 7962    In [2]: pyflyb
-000215f0: 792e 6469 7361 626c 655f 6175 746f 5f69  y.disable_auto_i
-00021600: 6d70 6f72 7465 7228 290a 2020 2020 2020  mporter().      
-00021610: 2020 5b50 5946 4c59 4259 5d20 696d 706f    [PYFLYBY] impo
-00021620: 7274 2070 7966 6c79 6279 0a20 2020 2020  rt pyflyby.     
-00021630: 2020 2049 6e20 5b33 5d3a 2062 3634 656e     In [3]: b64en
-00021640: 636f 6465 2862 2778 2729 0a20 2020 2020  code(b'x').     
-00021650: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     -------------
-00021660: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00021670: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00021680: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00021690: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
-000216a0: 2020 2020 2020 204e 616d 6545 7272 6f72         NameError
-000216b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000216c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000216d0: 2054 7261 6365 6261 636b 2028 6d6f 7374   Traceback (most
-000216e0: 2072 6563 656e 7420 6361 6c6c 206c 6173   recent call las
-000216f0: 7429 0a20 2020 2020 2020 202e 2e2e 2069  t).        ... i
-00021700: 6e20 2e2e 2e0a 2020 2020 2020 2020 4e61  n ....        Na
-00021710: 6d65 4572 726f 723a 206e 616d 6520 2762  meError: name 'b
-00021720: 3634 656e 636f 6465 2720 6973 206e 6f74  64encode' is not
-00021730: 2064 6566 696e 6564 0a20 2020 2020 2020   defined.       
-00021740: 2049 6e20 5b34 5d3a 2062 3634 6465 636f   In [4]: b64deco
-00021750: 6465 2827 596e 5630 6447 5679 626e 5630  de('YnV0dGVybnV0
-00021760: 2729 0a20 2020 2020 2020 204f 7574 5b34  ').        Out[4
-00021770: 5d3a 2062 2762 7574 7465 726e 7574 270a  ]: b'butternut'.
-00021780: 2020 2020 2020 2020 496e 205b 355d 3a20          In [5]: 
-00021790: 7079 666c 7962 792e 656e 6162 6c65 5f61  pyflyby.enable_a
-000217a0: 7574 6f5f 696d 706f 7274 6572 2829 0a20  uto_importer(). 
-000217b0: 2020 2020 2020 2049 6e20 5b36 5d3a 2062         In [6]: b
-000217c0: 3634 656e 636f 6465 2862 276c 6172 6368  64encode(b'larch
-000217d0: 2729 0a20 2020 2020 2020 205b 5059 464c  ').        [PYFL
-000217e0: 5942 595d 2066 726f 6d20 6261 7365 3634  YBY] from base64
-000217f0: 2069 6d70 6f72 7420 6236 3465 6e63 6f64   import b64encod
-00021800: 650a 2020 2020 2020 2020 4f75 745b 365d  e.        Out[6]
-00021810: 3a20 6227 6247 4679 5932 673d 270a 2020  : b'bGFyY2g='.  
-00021820: 2020 2222 222c 0a20 2020 2020 2020 2070    """,.        p
-00021830: 726f 673d 2270 7922 2c0a 2020 2020 2020  rog="py",.      
-00021840: 2020 6970 7974 686f 6e5f 6469 723d 746d    ipython_dir=tm
-00021850: 702e 6970 7974 686f 6e5f 6469 722c 0a20  p.ipython_dir,. 
-00021860: 2020 2029 0a0a 0a40 7079 7465 7374 2e6d     )...@pytest.m
-00021870: 6172 6b2e 736b 6970 6966 280a 2020 2020  ark.skipif(.    
-00021880: 5f49 5059 5448 4f4e 5f56 4552 5349 4f4e  _IPYTHON_VERSION
-00021890: 203c 2028 302c 2031 3229 2c0a 2020 2020   < (0, 12),.    
-000218a0: 7265 6173 6f6e 3d22 6f6c 6420 4950 7974  reason="old IPyt
-000218b0: 686f 6e20 646f 6573 6e27 7420 7375 7070  hon doesn't supp
-000218c0: 6f72 7420 7374 6172 7475 7020 6469 7265  ort startup dire
-000218d0: 6374 6f72 7922 290a 4072 6574 7279 0a64  ctory").@retry.d
-000218e0: 6566 2074 6573 745f 6d61 6e75 616c 5f69  ef test_manual_i
-000218f0: 6e73 7461 6c6c 5f70 726f 6669 6c65 5f73  nstall_profile_s
-00021900: 7461 7274 7570 5f31 2874 6d70 293a 0a20  tartup_1(tmp):. 
-00021910: 2020 2023 2054 6573 7420 7468 6174 206d     # Test that m
-00021920: 616e 7561 6c6c 7920 696e 7374 616c 6c69  anually installi
-00021930: 6e67 2074 6f20 7468 6520 7374 6172 7475  ng to the startu
-00021940: 7020 666f 6c64 6572 2077 6f72 6b73 2e0a  p folder works..
-00021950: 2020 2020 7772 6974 6574 6578 7428 746d      writetext(tm
-00021960: 702e 6970 7974 686f 6e5f 6469 722f 2270  p.ipython_dir/"p
-00021970: 726f 6669 6c65 5f64 6566 6175 6c74 2f73  rofile_default/s
-00021980: 7461 7274 7570 2f66 6f6f 2e70 7922 2c20  tartup/foo.py", 
-00021990: 2222 220a 2020 2020 2020 2020 5f5f 696d  """.        __im
-000219a0: 706f 7274 5f5f 2822 7079 666c 7962 7922  port__("pyflyby"
-000219b0: 292e 656e 6162 6c65 5f61 7574 6f5f 696d  ).enable_auto_im
-000219c0: 706f 7274 6572 2829 0a20 2020 2022 2222  porter().    """
-000219d0: 290a 2020 2020 6970 7974 686f 6e28 2222  ).    ipython(""
-000219e0: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
-000219f0: 3a20 6236 3464 6563 6f5c 7464 6528 275a  : b64deco\tde('Z
-00021a00: 4739 325a 513d 3d27 290a 2020 2020 2020  G92ZQ==').      
-00021a10: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
-00021a20: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
-00021a30: 3634 6465 636f 6465 0a20 2020 2020 2020  64decode.       
-00021a40: 204f 7574 5b31 5d3a 2062 2764 6f76 6527   Out[1]: b'dove'
-00021a50: 0a20 2020 2022 2222 2c20 6970 7974 686f  .    """, ipytho
-00021a60: 6e5f 6469 723d 746d 702e 6970 7974 686f  n_dir=tmp.ipytho
-00021a70: 6e5f 6469 7229 0a0a 0a40 7079 7465 7374  n_dir)...@pytest
-00021a80: 2e6d 6172 6b2e 736b 6970 6966 280a 2020  .mark.skipif(.  
-00021a90: 2020 5f49 5059 5448 4f4e 5f56 4552 5349    _IPYTHON_VERSI
-00021aa0: 4f4e 203c 2028 302c 2031 3129 2c0a 2020  ON < (0, 11),.  
-00021ab0: 2020 7265 6173 6f6e 3d22 6f6c 6420 4950    reason="old IP
-00021ac0: 7974 686f 6e20 646f 6573 6e27 7420 7375  ython doesn't su
-00021ad0: 7070 6f72 7420 6970 7974 686f 6e5f 636f  pport ipython_co
-00021ae0: 6e66 6967 2e70 7922 290a 4072 6574 7279  nfig.py").@retry
-00021af0: 0a64 6566 2074 6573 745f 6d61 6e75 616c  .def test_manual
-00021b00: 5f69 6e73 7461 6c6c 5f69 7079 7468 6f6e  _install_ipython
-00021b10: 5f63 6f6e 6669 675f 6469 7265 6374 5f31  _config_direct_1
-00021b20: 2874 6d70 293a 0a20 2020 2023 2056 6572  (tmp):.    # Ver
-00021b30: 6966 7920 7468 6174 206d 616e 7561 6c6c  ify that manuall
-00021b40: 7920 696e 7374 616c 6c69 6e67 2069 6e20  y installing in 
-00021b50: 6970 7974 686f 6e5f 636f 6e66 6967 2e70  ipython_config.p
-00021b60: 7920 776f 726b 7320 7768 656e 2065 6e61  y works when ena
-00021b70: 626c 696e 670a 2020 2020 2320 6174 2074  bling.    # at t
-00021b80: 6f70 206c 6576 656c 2e0a 2020 2020 7772  op level..    wr
-00021b90: 6974 6574 6578 7428 746d 702e 6970 7974  itetext(tmp.ipyt
-00021ba0: 686f 6e5f 6469 722f 2270 726f 6669 6c65  hon_dir/"profile
-00021bb0: 5f64 6566 6175 6c74 2f69 7079 7468 6f6e  _default/ipython
-00021bc0: 5f63 6f6e 6669 672e 7079 222c 2022 2222  _config.py", """
-00021bd0: 0a20 2020 2020 2020 205f 5f69 6d70 6f72  .        __impor
-00021be0: 745f 5f28 2270 7966 6c79 6279 2229 2e65  t__("pyflyby").e
-00021bf0: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
-00021c00: 7465 7228 290a 2020 2020 2222 222c 206d  ter().    """, m
-00021c10: 6f64 653d 2761 2729 0a20 2020 2069 7079  ode='a').    ipy
-00021c20: 7468 6f6e 2822 2222 0a20 2020 2020 2020  thon(""".       
-00021c30: 2049 6e20 5b31 5d3a 2062 3634 6465 636f   In [1]: b64deco
-00021c40: 5c74 6465 2827 6148 5674 6257 6c75 5a32  \tde('aHVtbWluZ2
-00021c50: 4a70 636d 513d 2729 0a20 2020 2020 2020  JpcmQ=').       
-00021c60: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
-00021c70: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
-00021c80: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
-00021c90: 4f75 745b 315d 3a20 6227 6875 6d6d 696e  Out[1]: b'hummin
-00021ca0: 6762 6972 6427 0a20 2020 2022 2222 2c20  gbird'.    """, 
-00021cb0: 6970 7974 686f 6e5f 6469 723d 746d 702e  ipython_dir=tmp.
-00021cc0: 6970 7974 686f 6e5f 6469 7229 0a0a 0a40  ipython_dir)...@
-00021cd0: 7079 7465 7374 2e6d 6172 6b2e 736b 6970  pytest.mark.skip
-00021ce0: 6966 280a 2020 2020 5f49 5059 5448 4f4e  if(.    _IPYTHON
-00021cf0: 5f56 4552 5349 4f4e 203c 2028 302c 2031  _VERSION < (0, 1
-00021d00: 3129 2c0a 2020 2020 7265 6173 6f6e 3d22  1),.    reason="
-00021d10: 6f6c 6420 4950 7974 686f 6e20 646f 6573  old IPython does
-00021d20: 6e27 7420 7375 7070 6f72 7420 6970 7974  n't support ipyt
-00021d30: 686f 6e5f 636f 6e66 6967 2e70 7922 290a  hon_config.py").
-00021d40: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
-00021d50: 6d61 6e75 616c 5f69 6e73 7461 6c6c 5f65  manual_install_e
-00021d60: 7865 635f 6c69 6e65 735f 3128 746d 7029  xec_lines_1(tmp)
-00021d70: 3a0a 2020 2020 7772 6974 6574 6578 7428  :.    writetext(
-00021d80: 746d 702e 6970 7974 686f 6e5f 6469 722f  tmp.ipython_dir/
-00021d90: 2270 726f 6669 6c65 5f64 6566 6175 6c74  "profile_default
-00021da0: 2f69 7079 7468 6f6e 5f63 6f6e 6669 672e  /ipython_config.
-00021db0: 7079 222c 2022 2222 0a20 2020 2020 2020  py", """.       
-00021dc0: 2063 203d 2067 6574 5f63 6f6e 6669 6728   c = get_config(
-00021dd0: 290a 2020 2020 2020 2020 632e 496e 7465  ).        c.Inte
-00021de0: 7261 6374 6976 6553 6865 6c6c 4170 702e  ractiveShellApp.
-00021df0: 6578 6563 5f6c 696e 6573 203d 205b 0a20  exec_lines = [. 
-00021e00: 2020 2020 2020 2020 2020 2027 5f5f 696d             '__im
-00021e10: 706f 7274 5f5f 2822 7079 666c 7962 7922  port__("pyflyby"
-00021e20: 292e 656e 6162 6c65 5f61 7574 6f5f 696d  ).enable_auto_im
-00021e30: 706f 7274 6572 2829 272c 0a20 2020 2020  porter()',.     
-00021e40: 2020 205d 0a20 2020 2022 2222 2c20 6d6f     ].    """, mo
-00021e50: 6465 3d27 6127 290a 2020 2020 6970 7974  de='a').    ipyt
-00021e60: 686f 6e28 2222 220a 2020 2020 2020 2020  hon(""".        
-00021e70: 496e 205b 315d 3a20 6236 3464 6563 6f5c  In [1]: b64deco\
-00021e80: 7464 6528 2763 3256 685a 3356 7362 413d  tde('c2VhZ3VsbA=
-00021e90: 3d27 290a 2020 2020 2020 2020 5b50 5946  =').        [PYF
-00021ea0: 4c59 4259 5d20 6672 6f6d 2062 6173 6536  LYBY] from base6
-00021eb0: 3420 696d 706f 7274 2062 3634 6465 636f  4 import b64deco
-00021ec0: 6465 0a20 2020 2020 2020 204f 7574 5b31  de.        Out[1
-00021ed0: 5d3a 2062 2773 6561 6775 6c6c 270a 2020  ]: b'seagull'.  
-00021ee0: 2020 2222 222c 2069 7079 7468 6f6e 5f64    """, ipython_d
-00021ef0: 6972 3d74 6d70 2e69 7079 7468 6f6e 5f64  ir=tmp.ipython_d
-00021f00: 6972 290a 0a0a 4070 7974 6573 742e 6d61  ir)...@pytest.ma
-00021f10: 726b 2e73 6b69 7069 6628 0a20 2020 205f  rk.skipif(.    _
-00021f20: 4950 5954 484f 4e5f 5645 5253 494f 4e20  IPYTHON_VERSION 
-00021f30: 3c20 2830 2c20 3131 292c 0a20 2020 2072  < (0, 11),.    r
-00021f40: 6561 736f 6e3d 226f 6c64 2049 5079 7468  eason="old IPyth
-00021f50: 6f6e 2064 6f65 736e 2774 2073 7570 706f  on doesn't suppo
-00021f60: 7274 2069 7079 7468 6f6e 5f63 6f6e 6669  rt ipython_confi
-00021f70: 672e 7079 2229 0a40 7265 7472 790a 6465  g.py").@retry.de
-00021f80: 6620 7465 7374 5f6d 616e 7561 6c5f 696e  f test_manual_in
-00021f90: 7374 616c 6c5f 6578 6563 5f66 696c 6573  stall_exec_files
-00021fa0: 5f31 2874 6d70 293a 0a20 2020 2077 7269  _1(tmp):.    wri
-00021fb0: 7465 7465 7874 2874 6d70 2e66 696c 652c  tetext(tmp.file,
-00021fc0: 2022 2222 0a20 2020 2020 2020 2069 6d70   """.        imp
-00021fd0: 6f72 7420 7079 666c 7962 790a 2020 2020  ort pyflyby.    
-00021fe0: 2020 2020 7079 666c 7962 792e 656e 6162      pyflyby.enab
-00021ff0: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-00022000: 2829 0a20 2020 2022 2222 290a 2020 2020  ().    """).    
-00022010: 7772 6974 6574 6578 7428 746d 702e 6970  writetext(tmp.ip
-00022020: 7974 686f 6e5f 6469 722f 2270 726f 6669  ython_dir/"profi
-00022030: 6c65 5f64 6566 6175 6c74 2f69 7079 7468  le_default/ipyth
-00022040: 6f6e 5f63 6f6e 6669 672e 7079 222c 2022  on_config.py", "
-00022050: 2222 0a20 2020 2020 2020 2063 203d 2067  "".        c = g
-00022060: 6574 5f63 6f6e 6669 6728 290a 2020 2020  et_config().    
-00022070: 2020 2020 632e 496e 7465 7261 6374 6976      c.Interactiv
-00022080: 6553 6865 6c6c 4170 702e 6578 6563 5f66  eShellApp.exec_f
-00022090: 696c 6573 203d 205b 2572 5d0a 2020 2020  iles = [%r].    
-000220a0: 2222 2220 2520 2873 7472 2874 6d70 2e66  """ % (str(tmp.f
-000220b0: 696c 6529 2c29 2c20 6d6f 6465 3d27 6127  ile),), mode='a'
-000220c0: 290a 2020 2020 6970 7974 686f 6e28 2222  ).    ipython(""
-000220d0: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
-000220e0: 3a20 6236 3464 6563 6f5c 7464 6528 2759  : b64deco\tde('Y
-000220f0: 3356 6a61 3239 7627 290a 2020 2020 2020  3Vja29v').      
-00022100: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
-00022110: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
-00022120: 3634 6465 636f 6465 0a20 2020 2020 2020  64decode.       
-00022130: 204f 7574 5b31 5d3a 2062 2763 7563 6b6f   Out[1]: b'cucko
-00022140: 6f27 0a20 2020 2022 2222 2c20 6970 7974  o'.    """, ipyt
-00022150: 686f 6e5f 6469 723d 746d 702e 6970 7974  hon_dir=tmp.ipyt
-00022160: 686f 6e5f 6469 7229 0a0a 0a40 7079 7465  hon_dir)...@pyte
-00022170: 7374 2e6d 6172 6b2e 736b 6970 6966 280a  st.mark.skipif(.
-00022180: 2020 2020 5f49 5059 5448 4f4e 5f56 4552      _IPYTHON_VER
-00022190: 5349 4f4e 203e 3d20 2830 2c20 3131 292c  SION >= (0, 11),
-000221a0: 0a20 2020 2072 6561 736f 6e3d 2249 5079  .    reason="IPy
-000221b0: 7468 6f6e 2030 2e31 312b 2064 6f65 736e  thon 0.11+ doesn
-000221c0: 2774 2073 7570 706f 7274 2069 7079 7468  't support ipyth
-000221d0: 6f6e 7263 2229 0a40 7265 7472 790a 6465  onrc").@retry.de
-000221e0: 6620 7465 7374 5f6d 616e 7561 6c5f 696e  f test_manual_in
-000221f0: 7374 616c 6c5f 6970 7974 686f 6e72 635f  stall_ipythonrc_
-00022200: 6578 6563 7574 655f 3128 746d 7029 3a0a  execute_1(tmp):.
-00022210: 2020 2020 7772 6974 6574 6578 7428 746d      writetext(tm
-00022220: 702e 6970 7974 686f 6e5f 6469 722f 2269  p.ipython_dir/"i
-00022230: 7079 7468 6f6e 7263 222c 2022 2222 0a20  pythonrc", """. 
-00022240: 2020 2020 2020 2065 7865 6375 7465 205f         execute _
-00022250: 5f69 6d70 6f72 745f 5f28 2270 7966 6c79  _import__("pyfly
-00022260: 6279 2229 2e65 6e61 626c 655f 6175 746f  by").enable_auto
-00022270: 5f69 6d70 6f72 7465 7228 290a 2020 2020  _importer().    
-00022280: 2222 222c 206d 6f64 653d 2761 2729 0a20  """, mode='a'). 
-00022290: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
-000222a0: 2020 2020 2020 2049 6e20 5b31 5d3a 2062         In [1]: b
-000222b0: 3634 6465 636f 5c74 6465 2827 6347 5675  64deco\tde('cGVu
-000222c0: 5a33 5670 6267 3d3d 2729 0a20 2020 2020  Z3Vpbg==').     
-000222d0: 2020 205b 5059 464c 5942 595d 2066 726f     [PYFLYBY] fro
-000222e0: 6d20 6261 7365 3634 2069 6d70 6f72 7420  m base64 import 
-000222f0: 6236 3464 6563 6f64 650a 2020 2020 2020  b64decode.      
-00022300: 2020 4f75 745b 315d 3a20 6227 7065 6e67    Out[1]: b'peng
-00022310: 7569 6e27 0a20 2020 2022 2222 2c20 6970  uin'.    """, ip
-00022320: 7974 686f 6e5f 6469 723d 746d 702e 6970  ython_dir=tmp.ip
-00022330: 7974 686f 6e5f 6469 7229 0a0a 0a40 7079  ython_dir)...@py
-00022340: 7465 7374 2e6d 6172 6b2e 736b 6970 6966  test.mark.skipif
-00022350: 280a 2020 2020 5f49 5059 5448 4f4e 5f56  (.    _IPYTHON_V
-00022360: 4552 5349 4f4e 203e 3d20 2830 2c20 3131  ERSION >= (0, 11
-00022370: 292c 0a20 2020 2072 6561 736f 6e3d 2249  ),.    reason="I
-00022380: 5079 7468 6f6e 2030 2e31 312b 2064 6f65  Python 0.11+ doe
-00022390: 736e 2774 2073 7570 706f 7274 2069 7079  sn't support ipy
-000223a0: 5f75 7365 725f 636f 6e66 2229 0a40 7265  _user_conf").@re
-000223b0: 7472 790a 6465 6620 7465 7374 5f6d 616e  try.def test_man
-000223c0: 7561 6c5f 696e 7374 616c 6c5f 6970 795f  ual_install_ipy_
-000223d0: 7573 6572 5f63 6f6e 665f 3128 746d 7029  user_conf_1(tmp)
-000223e0: 3a0a 2020 2020 7772 6974 6574 6578 7428  :.    writetext(
-000223f0: 746d 702e 6970 7974 686f 6e5f 6469 722f  tmp.ipython_dir/
-00022400: 2269 7079 5f75 7365 725f 636f 6e66 2e70  "ipy_user_conf.p
-00022410: 7922 2c20 2222 220a 2020 2020 2020 2020  y", """.        
-00022420: 696d 706f 7274 2070 7966 6c79 6279 0a20  import pyflyby. 
-00022430: 2020 2020 2020 2070 7966 6c79 6279 2e65         pyflyby.e
-00022440: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
-00022450: 7465 7228 290a 2020 2020 2222 2229 0a20  ter().    """). 
-00022460: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
-00022470: 2020 2020 2020 2049 6e20 5b31 5d3a 2062         In [1]: b
-00022480: 3634 6465 636f 5c74 6465 2827 6247 3976  64deco\tde('bG9v
-00022490: 6267 3d3d 2729 0a20 2020 2020 2020 205b  bg==').        [
-000224a0: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
-000224b0: 7365 3634 2069 6d70 6f72 7420 6236 3464  se64 import b64d
-000224c0: 6563 6f64 650a 2020 2020 2020 2020 4f75  ecode.        Ou
-000224d0: 745b 315d 3a20 6227 6c6f 6f6e 270a 2020  t[1]: b'loon'.  
-000224e0: 2020 2222 222c 2069 7079 7468 6f6e 5f64    """, ipython_d
-000224f0: 6972 3d74 6d70 2e69 7079 7468 6f6e 5f64  ir=tmp.ipython_d
-00022500: 6972 290a 0a0a 4070 7974 6573 742e 6d61  ir)...@pytest.ma
-00022510: 726b 2e73 6b69 7069 6628 0a20 2020 2028  rk.skipif(.    (
-00022520: 302c 2031 3129 203c 3d20 5f49 5059 5448  0, 11) <= _IPYTH
-00022530: 4f4e 5f56 4552 5349 4f4e 203c 2028 302c  ON_VERSION < (0,
-00022540: 2031 3229 2c0a 2020 2020 7265 6173 6f6e   12),.    reason
-00022550: 3d22 4950 7974 686f 6e20 302e 3131 2064  ="IPython 0.11 d
-00022560: 6f65 736e 2774 2073 7570 706f 7274 202d  oesn't support -
-00022570: 6322 290a 4072 6574 7279 0a64 6566 2074  c").@retry.def t
-00022580: 6573 745f 636d 646c 696e 655f 656e 6162  est_cmdline_enab
-00022590: 6c65 5f63 5f69 5f31 2874 6d70 293a 0a20  le_c_i_1(tmp):. 
-000225a0: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
-000225b0: 2020 2020 2020 2049 6e20 5b31 5d3a 2062         In [1]: b
-000225c0: 3634 6465 636f 5c74 6465 2827 5a6d 3934  64deco\tde('Zm94
-000225d0: 6147 3931 626d 513d 2729 0a20 2020 2020  aG91bmQ=').     
-000225e0: 2020 205b 5059 464c 5942 595d 2066 726f     [PYFLYBY] fro
-000225f0: 6d20 6261 7365 3634 2069 6d70 6f72 7420  m base64 import 
-00022600: 6236 3464 6563 6f64 650a 2020 2020 2020  b64decode.      
-00022610: 2020 4f75 745b 315d 3a20 6227 666f 7868    Out[1]: b'foxh
-00022620: 6f75 6e64 270a 2020 2020 2222 222c 2061  ound'.    """, a
-00022630: 7267 733d 5b27 2d63 272c 2027 696d 706f  rgs=['-c', 'impo
-00022640: 7274 2070 7966 6c79 6279 3b20 7079 666c  rt pyflyby; pyfl
-00022650: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
-00022660: 696d 706f 7274 6572 2829 272c 2027 2d69  importer()', '-i
-00022670: 275d 290a 0a0a 4070 7974 6573 742e 6d61  '])...@pytest.ma
-00022680: 726b 2e73 6b69 7069 6628 0a20 2020 205f  rk.skipif(.    _
-00022690: 4950 5954 484f 4e5f 5645 5253 494f 4e20  IPYTHON_VERSION 
-000226a0: 3c20 2830 2c20 3131 292c 0a20 2020 2072  < (0, 11),.    r
-000226b0: 6561 736f 6e3d 226f 6c64 2049 5079 7468  eason="old IPyth
-000226c0: 6f6e 2064 6f65 736e 2774 2073 7570 706f  on doesn't suppo
-000226d0: 7274 2049 6e74 6572 6163 7469 7665 5368  rt InteractiveSh
-000226e0: 656c 6c41 7070 2063 6f6e 6669 6722 290a  ellApp config").
-000226f0: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
-00022700: 636d 646c 696e 655f 656e 6162 6c65 5f63  cmdline_enable_c
-00022710: 6f64 655f 746f 5f72 756e 5f69 5f31 2874  ode_to_run_i_1(t
-00022720: 6d70 293a 0a20 2020 2069 7079 7468 6f6e  mp):.    ipython
-00022730: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
-00022740: 5b31 5d3a 2062 3634 6465 636f 5c74 6465  [1]: b64deco\tde
-00022750: 2827 636d 3930 6448 646c 6157 786c 6367  ('cm90dHdlaWxlcg
-00022760: 3d3d 2729 0a20 2020 2020 2020 205b 5059  ==').        [PY
-00022770: 464c 5942 595d 2066 726f 6d20 6261 7365  FLYBY] from base
-00022780: 3634 2069 6d70 6f72 7420 6236 3464 6563  64 import b64dec
-00022790: 6f64 650a 2020 2020 2020 2020 4f75 745b  ode.        Out[
-000227a0: 315d 3a20 6227 726f 7474 7765 696c 6572  1]: b'rottweiler
-000227b0: 270a 2020 2020 2222 222c 2061 7267 733d  '.    """, args=
-000227c0: 5b27 2d2d 496e 7465 7261 6374 6976 6553  ['--InteractiveS
-000227d0: 6865 6c6c 4170 702e 636f 6465 5f74 6f5f  hellApp.code_to_
-000227e0: 7275 6e3d 270a 2020 2020 2020 2020 2020  run='.          
-000227f0: 2020 2020 2027 696d 706f 7274 2070 7966       'import pyf
-00022800: 6c79 6279 3b20 7079 666c 7962 792e 656e  lyby; pyflyby.en
-00022810: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
-00022820: 6572 2829 272c 2027 2d69 275d 290a 0a0a  er()', '-i'])...
-00022830: 4070 7974 6573 742e 6d61 726b 2e73 6b69  @pytest.mark.ski
-00022840: 7069 6628 0a20 2020 205f 4950 5954 484f  pif(.    _IPYTHO
-00022850: 4e5f 5645 5253 494f 4e20 3c20 2830 2c20  N_VERSION < (0, 
-00022860: 3131 292c 0a20 2020 2072 6561 736f 6e3d  11),.    reason=
-00022870: 226f 6c64 2049 5079 7468 6f6e 2064 6f65  "old IPython doe
-00022880: 736e 2774 2073 7570 706f 7274 2049 6e74  sn't support Int
-00022890: 6572 6163 7469 7665 5368 656c 6c41 7070  eractiveShellApp
-000228a0: 2063 6f6e 6669 6722 290a 4072 6574 7279   config").@retry
-000228b0: 0a64 6566 2074 6573 745f 636d 646c 696e  .def test_cmdlin
-000228c0: 655f 656e 6162 6c65 5f65 7865 635f 6c69  e_enable_exec_li
-000228d0: 6e65 735f 3128 746d 7029 3a0a 2020 2020  nes_1(tmp):.    
-000228e0: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
-000228f0: 2020 2020 496e 205b 315d 3a20 6236 3464      In [1]: b64d
-00022900: 6563 6f5c 7464 6528 2763 4739 765a 4778  eco\tde('cG9vZGx
-00022910: 6c27 290a 2020 2020 2020 2020 5b50 5946  l').        [PYF
-00022920: 4c59 4259 5d20 6672 6f6d 2062 6173 6536  LYBY] from base6
-00022930: 3420 696d 706f 7274 2062 3634 6465 636f  4 import b64deco
-00022940: 6465 0a20 2020 2020 2020 204f 7574 5b31  de.        Out[1
-00022950: 5d3a 2062 2770 6f6f 646c 6527 0a20 2020  ]: b'poodle'.   
-00022960: 2022 2222 2c20 6172 6773 3d5b 0a20 2020   """, args=[.   
-00022970: 2020 2020 2027 2d2d 496e 7465 7261 6374       '--Interact
-00022980: 6976 6553 6865 6c6c 4170 702e 6578 6563  iveShellApp.exec
-00022990: 5f6c 696e 6573 3d27 0a20 2020 2020 2020  _lines='.       
-000229a0: 2027 2727 5b22 5f5f 696d 706f 7274 5f5f   '''["__import__
-000229b0: 2827 7079 666c 7962 7927 292e 656e 6162  ('pyflyby').enab
-000229c0: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-000229d0: 2829 225d 2727 275d 290a 0a0a 4070 7974  ()"]'''])...@pyt
-000229e0: 6573 742e 6d61 726b 2e73 6b69 7069 6628  est.mark.skipif(
-000229f0: 0a20 2020 205f 4950 5954 484f 4e5f 5645  .    _IPYTHON_VE
-00022a00: 5253 494f 4e20 3c20 2830 2c20 3131 292c  RSION < (0, 11),
-00022a10: 0a20 2020 2072 6561 736f 6e3d 226f 6c64  .    reason="old
-00022a20: 2049 5079 7468 6f6e 2064 6f65 736e 2774   IPython doesn't
-00022a30: 2073 7570 706f 7274 2049 6e74 6572 6163   support Interac
-00022a40: 7469 7665 5368 656c 6c41 7070 2063 6f6e  tiveShellApp con
-00022a50: 6669 6722 290a 6465 6620 7465 7374 5f63  fig").def test_c
-00022a60: 6d64 6c69 6e65 5f65 6e61 626c 655f 6578  mdline_enable_ex
-00022a70: 6563 5f66 696c 6573 5f31 2874 6d70 293a  ec_files_1(tmp):
-00022a80: 0a20 2020 2077 7269 7465 7465 7874 2874  .    writetext(t
-00022a90: 6d70 2e66 696c 652c 2022 2222 0a20 2020  mp.file, """.   
-00022aa0: 2020 2020 2069 6d70 6f72 7420 7079 666c       import pyfl
-00022ab0: 7962 790a 2020 2020 2020 2020 7079 666c  yby.        pyfl
-00022ac0: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
-00022ad0: 696d 706f 7274 6572 2829 0a20 2020 2022  importer().    "
-00022ae0: 2222 290a 2020 2020 6970 7974 686f 6e28  "").    ipython(
-00022af0: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-00022b00: 315d 3a20 6236 3464 6563 6f5c 7464 6528  1]: b64deco\tde(
-00022b10: 2759 3356 6a61 3239 7627 290a 2020 2020  'Y3Vja29v').    
-00022b20: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
-00022b30: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
-00022b40: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
-00022b50: 2020 204f 7574 5b31 5d3a 2062 2763 7563     Out[1]: b'cuc
-00022b60: 6b6f 6f27 0a20 2020 2022 2222 2c20 6172  koo'.    """, ar
-00022b70: 6773 3d5b 0a20 2020 2020 2020 2027 2d2d  gs=[.        '--
-00022b80: 496e 7465 7261 6374 6976 6553 6865 6c6c  InteractiveShell
-00022b90: 4170 702e 6578 6563 5f66 696c 6573 3d5b  App.exec_files=[
-00022ba0: 2572 5d27 2025 2028 7374 7228 746d 702e  %r]' % (str(tmp.
-00022bb0: 6669 6c65 292c 295d 290a 0a0a 4072 6574  file),)])...@ret
-00022bc0: 7279 0a64 6566 2074 6573 745f 6465 6275  ry.def test_debu
-00022bd0: 675f 6261 7365 6c69 6e65 5f31 2866 726f  g_baseline_1(fro
-00022be0: 6e74 656e 6429 3a0a 2020 2020 2320 5665  ntend):.    # Ve
-00022bf0: 7269 6679 2074 6861 7420 7765 2063 616e  rify that we can
-00022c00: 2074 6573 7420 6970 6462 2077 6974 686f   test ipdb witho
-00022c10: 7574 2061 6e79 2070 7966 6c79 6279 2069  ut any pyflyby i
-00022c20: 6e76 6f6c 7665 642e 0a20 2020 2069 7079  nvolved..    ipy
-00022c30: 7468 6f6e 2822 2222 0a20 2020 2020 2020  thon(""".       
-00022c40: 2049 6e20 5b31 5d3a 2038 3233 3138 3231   In [1]: 8231821
-00022c50: 352f 300a 2020 2020 2020 2020 2e2e 2e2e  5/0.        ....
-00022c60: 0a20 2020 2020 2020 205a 6572 6f44 6976  .        ZeroDiv
-00022c70: 6973 696f 6e45 7272 6f72 3a20 2e2e 2e0a  isionError: ....
-00022c80: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
-00022c90: 2564 6562 7567 0a20 2020 2020 2020 202e  %debug.        .
-00022ca0: 2e2e 2e0a 2020 2020 2020 2020 6970 6462  ....        ipdb
-00022cb0: 3e20 7020 3433 3430 3537 3238 202b 2036  > p 43405728 + 6
-00022cc0: 3936 3432 3936 380a 2020 2020 2020 2020  9642968.        
-00022cd0: 3131 3330 3438 3639 360a 2020 2020 2020  113048696.      
-00022ce0: 2020 6970 6462 3e20 710a 2020 2020 2222    ipdb> q.    ""
-00022cf0: 222c 2066 726f 6e74 656e 643d 6672 6f6e  ", frontend=fron
-00022d00: 7465 6e64 290a 0a0a 4072 6574 7279 0a64  tend)...@retry.d
-00022d10: 6566 2074 6573 745f 6465 6275 675f 7769  ef test_debug_wi
-00022d20: 7468 6f75 745f 6175 746f 696d 706f 7274  thout_autoimport
-00022d30: 5f31 2866 726f 6e74 656e 6429 3a0a 2020  _1(frontend):.  
-00022d40: 2020 2320 5665 7269 6679 2074 6861 7420    # Verify that 
-00022d50: 7769 7468 6f75 7420 6175 746f 696d 706f  without autoimpo
-00022d60: 7274 2c20 7765 2067 6574 2061 204e 616d  rt, we get a Nam
-00022d70: 6545 7272 6f72 2e0a 2020 2020 6970 7974  eError..    ipyt
-00022d80: 686f 6e28 2222 220a 2020 2020 2020 2020  hon(""".        
-00022d90: 496e 205b 315d 3a20 3730 3530 3633 3537  In [1]: 70506357
-00022da0: 2f30 0a20 2020 2020 2020 202e 2e2e 2e0a  /0.        .....
-00022db0: 2020 2020 2020 2020 5a65 726f 4469 7669          ZeroDivi
-00022dc0: 7369 6f6e 4572 726f 723a 202e 2e2e 0a20  sionError: .... 
-00022dd0: 2020 2020 2020 2049 6e20 5b32 5d3a 2025         In [2]: %
-00022de0: 6465 6275 670a 2020 2020 2020 2020 2e2e  debug.        ..
-00022df0: 2e2e 0a20 2020 2020 2020 2069 7064 623e  ...        ipdb>
-00022e00: 2070 2062 3634 6465 636f 6465 2822 5158   p b64decode("QX
-00022e10: 566b 6457 4a76 6267 3d3d 2229 0a20 2020  VkdWJvbg==").   
-00022e20: 2020 2020 202a 2a2a 204e 616d 6545 7272       *** NameErr
-00022e30: 6f72 3a20 6e61 6d65 2027 6236 3464 6563  or: name 'b64dec
-00022e40: 6f64 6527 2069 7320 6e6f 7420 6465 6669  ode' is not defi
-00022e50: 6e65 640a 2020 2020 2020 2020 6970 6462  ned.        ipdb
-00022e60: 3e20 710a 2020 2020 2222 222c 2066 726f  > q.    """, fro
-00022e70: 6e74 656e 643d 6672 6f6e 7465 6e64 290a  ntend=frontend).
-00022e80: 0a0a 4072 6574 7279 0a64 6566 2074 6573  ..@retry.def tes
-00022e90: 745f 6465 6275 675f 6175 746f 5f69 6d70  t_debug_auto_imp
-00022ea0: 6f72 745f 705f 3128 6672 6f6e 7465 6e64  ort_p_1(frontend
-00022eb0: 293a 0a20 2020 2069 7079 7468 6f6e 2822  ):.    ipython("
-00022ec0: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
-00022ed0: 5d3a 2069 6d70 6f72 7420 7079 666c 7962  ]: import pyflyb
-00022ee0: 793b 2070 7966 6c79 6279 2e65 6e61 626c  y; pyflyby.enabl
-00022ef0: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
-00022f00: 290a 2020 2020 2020 2020 496e 205b 325d  ).        In [2]
-00022f10: 3a20 3137 3833 3932 3339 2f30 0a20 2020  : 17839239/0.   
-00022f20: 2020 2020 202e 2e2e 2e0a 2020 2020 2020       .....      
-00022f30: 2020 5a65 726f 4469 7669 7369 6f6e 4572    ZeroDivisionEr
-00022f40: 726f 723a 202e 2e2e 0a20 2020 2020 2020  ror: ....       
-00022f50: 2049 6e20 5b33 5d3a 2025 6465 6275 670a   In [3]: %debug.
-00022f60: 2020 2020 2020 2020 2e2e 2e2e 0a20 2020          .....   
-00022f70: 2020 2020 2069 7064 623e 2070 2062 3634       ipdb> p b64
-00022f80: 6465 636f 6465 2822 5332 5675 6332 6c75  decode("S2Vuc2lu
-00022f90: 5a33 5276 6267 3d3d 2229 0a20 2020 2020  Z3Rvbg==").     
-00022fa0: 2020 205b 5059 464c 5942 595d 2066 726f     [PYFLYBY] fro
-00022fb0: 6d20 6261 7365 3634 2069 6d70 6f72 7420  m base64 import 
-00022fc0: 6236 3464 6563 6f64 650a 2020 2020 2020  b64decode.      
-00022fd0: 2020 6227 4b65 6e73 696e 6774 6f6e 270a    b'Kensington'.
-00022fe0: 2020 2020 2020 2020 6970 6462 3e20 710a          ipdb> q.
-00022ff0: 2020 2020 2222 222c 2066 726f 6e74 656e      """, fronten
-00023000: 643d 6672 6f6e 7465 6e64 290a 0a0a 4072  d=frontend)...@r
-00023010: 6574 7279 0a64 6566 2074 6573 745f 6465  etry.def test_de
-00023020: 6275 675f 6175 746f 5f69 6d70 6f72 745f  bug_auto_import_
-00023030: 7070 5f31 2866 726f 6e74 656e 6429 3a0a  pp_1(frontend):.
-00023040: 2020 2020 2320 5665 7269 6679 2074 6861      # Verify tha
-00023050: 7420 6175 746f 2069 6d70 6f72 7469 6e67  t auto importing
-00023060: 2077 6f72 6b73 2077 6974 6820 2270 7020   works with "pp 
-00023070: 666f 6f22 2e0a 2020 2020 6970 7974 686f  foo"..    ipytho
-00023080: 6e28 2222 220a 2020 2020 2020 2020 496e  n(""".        In
-00023090: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
-000230a0: 6c79 6279 3b20 7079 666c 7962 792e 656e  lyby; pyflyby.en
-000230b0: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
-000230c0: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
-000230d0: 5b32 5d3a 2038 3734 3834 3335 352f 300a  [2]: 87484355/0.
-000230e0: 2020 2020 2020 2020 2e2e 2e2e 0a20 2020          .....   
-000230f0: 2020 2020 205a 6572 6f44 6976 6973 696f       ZeroDivisio
-00023100: 6e45 7272 6f72 3a20 2e2e 2e0a 2020 2020  nError: ....    
-00023110: 2020 2020 496e 205b 335d 3a20 2564 6562      In [3]: %deb
-00023120: 7567 0a20 2020 2020 2020 202e 2e2e 2e0a  ug.        .....
-00023130: 2020 2020 2020 2020 6970 6462 3e20 7020          ipdb> p 
-00023140: 6236 3464 6563 6f64 6528 2252 3246 795a  b64decode("R2FyZ
-00023150: 4756 7522 290a 2020 2020 2020 2020 5b50  GVu").        [P
-00023160: 5946 4c59 4259 5d20 6672 6f6d 2062 6173  YFLYBY] from bas
-00023170: 6536 3420 696d 706f 7274 2062 3634 6465  e64 import b64de
-00023180: 636f 6465 0a20 2020 2020 2020 2062 2747  code.        b'G
-00023190: 6172 6465 6e27 0a20 2020 2020 2020 2069  arden'.        i
-000231a0: 7064 623e 2071 0a20 2020 2022 2222 2c20  pdb> q.    """, 
-000231b0: 6672 6f6e 7465 6e64 3d66 726f 6e74 656e  frontend=fronten
-000231c0: 6429 0a0a 0a40 7265 7472 790a 6465 6620  d)...@retry.def 
-000231d0: 7465 7374 5f64 6562 7567 5f61 7574 6f5f  test_debug_auto_
-000231e0: 696d 706f 7274 5f64 6566 6175 6c74 5f31  import_default_1
-000231f0: 2866 726f 6e74 656e 6429 3a0a 2020 2020  (frontend):.    
-00023200: 2320 5665 7269 6679 2074 6861 7420 6175  # Verify that au
-00023210: 746f 2069 6d70 6f72 7469 6e67 2077 6f72  to importing wor
-00023220: 6b73 2077 6974 6820 2266 6f6f 282e 2e2e  ks with "foo(...
-00023230: 2922 2e0a 2020 2020 6970 7974 686f 6e28  )"..    ipython(
-00023240: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-00023250: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
-00023260: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
-00023270: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-00023280: 2829 0a20 2020 2020 2020 2049 6e20 5b32  ().        In [2
-00023290: 5d3a 2034 3135 3934 3036 392f 300a 2020  ]: 41594069/0.  
-000232a0: 2020 2020 2020 2e2e 2e2e 0a20 2020 2020        .....     
-000232b0: 2020 205a 6572 6f44 6976 6973 696f 6e45     ZeroDivisionE
-000232c0: 7272 6f72 3a20 2e2e 2e0a 2020 2020 2020  rror: ....      
-000232d0: 2020 496e 205b 335d 3a20 2564 6562 7567    In [3]: %debug
-000232e0: 0a20 2020 2020 2020 202e 2e2e 2e0a 2020  .        .....  
-000232f0: 2020 2020 2020 6970 6462 3e20 6236 3464        ipdb> b64d
-00023300: 6563 6f64 6528 2255 484a 7663 3342 6c59  ecode("UHJvc3BlY
-00023310: 3351 3d22 290a 2020 2020 2020 2020 5b50  3Q=").        [P
-00023320: 5946 4c59 4259 5d20 6672 6f6d 2062 6173  YFLYBY] from bas
-00023330: 6536 3420 696d 706f 7274 2062 3634 6465  e64 import b64de
-00023340: 636f 6465 0a20 2020 2020 2020 2062 2750  code.        b'P
-00023350: 726f 7370 6563 7427 0a20 2020 2020 2020  rospect'.       
-00023360: 2069 7064 623e 2071 0a20 2020 2022 2222   ipdb> q.    """
-00023370: 2c20 6672 6f6e 7465 6e64 3d66 726f 6e74  , frontend=front
-00023380: 656e 6429 0a0a 0a40 7265 7472 790a 6465  end)...@retry.de
-00023390: 6620 7465 7374 5f64 6562 7567 5f61 7574  f test_debug_aut
-000233a0: 6f5f 696d 706f 7274 5f70 7269 6e74 5f31  o_import_print_1
-000233b0: 2866 726f 6e74 656e 6429 3a0a 2020 2020  (frontend):.    
-000233c0: 2320 5665 7269 6679 2074 6861 7420 6175  # Verify that au
-000233d0: 746f 2069 6d70 6f72 7469 6e67 2077 6f72  to importing wor
-000233e0: 6b73 2077 6974 6820 2270 7269 6e74 2066  ks with "print f
-000233f0: 6f6f 222e 2020 2854 6869 7320 6973 2065  oo".  (This is e
-00023400: 7865 6375 7465 6420 6173 0a20 2020 2023  xecuted as.    #
-00023410: 2061 2073 7461 7465 6d65 6e74 3b20 6120   a statement; a 
-00023420: 7370 6563 6961 6c20 6361 7365 206f 6620  special case of 
-00023430: 2264 6566 6175 6c74 222e 290a 2020 2020  "default".).    
-00023440: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
-00023450: 2020 2020 496e 205b 315d 3a20 696d 706f      In [1]: impo
-00023460: 7274 2070 7966 6c79 6279 3b20 7079 666c  rt pyflyby; pyfl
-00023470: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
-00023480: 696d 706f 7274 6572 2829 0a20 2020 2020  importer().     
-00023490: 2020 2049 6e20 5b32 5d3a 2034 3034 3630     In [2]: 40460
-000234a0: 3239 2f30 0a20 2020 2020 2020 202e 2e2e  29/0.        ...
-000234b0: 2e0a 2020 2020 2020 2020 5a65 726f 4469  ..        ZeroDi
-000234c0: 7669 7369 6f6e 4572 726f 723a 202e 2e2e  visionError: ...
-000234d0: 0a20 2020 2020 2020 2049 6e20 5b33 5d3a  .        In [3]:
-000234e0: 2025 6465 6275 670a 2020 2020 2020 2020   %debug.        
-000234f0: 2e2e 2e2e 0a20 2020 2020 2020 2069 7064  .....        ipd
-00023500: 623e 2069 6620 313a 2070 7269 6e74 2862  b> if 1: print(b
-00023510: 3634 6465 636f 6465 2822 5457 3975 6447  64decode("TW9udG
-00023520: 6476 6257 5679 6551 3d3d 2229 2e64 6563  dvbWVyeQ==").dec
-00023530: 6f64 6528 2775 7466 2d38 2729 290a 2020  ode('utf-8')).  
-00023540: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
-00023550: 6672 6f6d 2062 6173 6536 3420 696d 706f  from base64 impo
-00023560: 7274 2062 3634 6465 636f 6465 0a20 2020  rt b64decode.   
-00023570: 2020 2020 204d 6f6e 7467 6f6d 6572 790a       Montgomery.
-00023580: 2020 2020 2020 2020 6970 6462 3e20 710a          ipdb> q.
-00023590: 2020 2020 2222 222c 2066 726f 6e74 656e      """, fronten
-000235a0: 643d 6672 6f6e 7465 6e64 290a 0a0a 4072  d=frontend)...@r
-000235b0: 6574 7279 0a64 6566 2074 6573 745f 6465  etry.def test_de
-000235c0: 6275 675f 6175 746f 5f69 6d70 6f72 745f  bug_auto_import_
-000235d0: 6261 6e67 5f64 6566 6175 6c74 5f31 2866  bang_default_1(f
-000235e0: 726f 6e74 656e 6429 3a0a 2020 2020 2320  rontend):.    # 
-000235f0: 5665 7269 6679 2074 6861 7420 2221 626c  Verify that "!bl
-00023600: 6168 2220 776f 726b 7320 7769 7468 2061  ah" works with a
-00023610: 7574 6f20 696d 706f 7274 696e 672e 0a20  uto importing.. 
-00023620: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
-00023630: 2020 2020 2020 2049 6e20 5b31 5d3a 2069         In [1]: i
-00023640: 6d70 6f72 7420 7079 666c 7962 793b 2070  mport pyflyby; p
-00023650: 7966 6c79 6279 2e65 6e61 626c 655f 6175  yflyby.enable_au
-00023660: 746f 5f69 6d70 6f72 7465 7228 290a 2020  to_importer().  
-00023670: 2020 2020 2020 496e 205b 325d 3a20 3636        In [2]: 66
-00023680: 3738 3334 3734 2f30 0a20 2020 2020 2020  783474/0.       
-00023690: 202e 2e2e 2e0a 2020 2020 2020 2020 5a65   .....        Ze
-000236a0: 726f 4469 7669 7369 6f6e 4572 726f 723a  roDivisionError:
-000236b0: 202e 2e2e 0a20 2020 2020 2020 2049 6e20   ....        In 
-000236c0: 5b33 5d3a 2025 6465 6275 670a 2020 2020  [3]: %debug.    
-000236d0: 2020 2020 2e2e 2e2e 0a20 2020 2020 2020      .....       
-000236e0: 2069 7064 623e 2021 7120 3d20 6236 3464   ipdb> !q = b64d
-000236f0: 6563 6f64 6528 2253 4746 3364 4768 7663  ecode("SGF3dGhvc
-00023700: 6d35 6c22 290a 2020 2020 2020 2020 5b50  m5l").        [P
-00023710: 5946 4c59 4259 5d20 6672 6f6d 2062 6173  YFLYBY] from bas
-00023720: 6536 3420 696d 706f 7274 2062 3634 6465  e64 import b64de
-00023730: 636f 6465 0a20 2020 2020 2020 2069 7064  code.        ipd
-00023740: 623e 2021 710a 2020 2020 2020 2020 6227  b> !q.        b'
-00023750: 4861 7774 686f 726e 6527 0a20 2020 2020  Hawthorne'.     
-00023760: 2020 2069 7064 623e 2071 0a20 2020 2022     ipdb> q.    "
-00023770: 2222 2c20 6672 6f6e 7465 6e64 3d66 726f  "", frontend=fro
-00023780: 6e74 656e 6429 0a0a 0a40 7265 7472 790a  ntend)...@retry.
-00023790: 6465 6620 7465 7374 5f64 6562 7567 5f70  def test_debug_p
-000237a0: 6f73 746d 6f72 7465 6d5f 6175 746f 5f69  ostmortem_auto_i
-000237b0: 6d70 6f72 745f 3128 6672 6f6e 7465 6e64  mport_1(frontend
-000237c0: 293a 0a20 2020 2023 2056 6572 6966 7920  ):.    # Verify 
-000237d0: 7468 6174 2025 6465 6275 6720 706f 7374  that %debug post
-000237e0: 6d6f 7274 656d 206d 6f64 6520 776f 726b  mortem mode work
-000237f0: 732e 0a20 2020 2069 7079 7468 6f6e 2822  s..    ipython("
-00023800: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
-00023810: 5d3a 2069 6d70 6f72 7420 7079 666c 7962  ]: import pyflyb
-00023820: 793b 2070 7966 6c79 6279 2e65 6e61 626c  y; pyflyby.enabl
-00023830: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
-00023840: 290a 2020 2020 2020 2020 496e 205b 325d  ).        In [2]
-00023850: 3a20 6465 6620 666f 6f28 782c 2079 293a  : def foo(x, y):
-00023860: 0a20 2020 2020 2020 2020 2020 2e2e 2e3a  .           ...:
-00023870: 2020 2020 2072 6574 7572 6e20 7820 2f20       return x / 
-00023880: 790a 2020 2020 2020 2020 2020 202e 2e2e  y.           ...
-00023890: 3a0a 2020 2020 2020 2020 496e 205b 335d  :.        In [3]
-000238a0: 3a20 666f 6f28 2242 6f77 6372 6166 7422  : foo("Bowcraft"
-000238b0: 2c20 224d 6f75 6e74 6169 6e22 290a 2020  , "Mountain").  
-000238c0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-000238d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000238e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000238f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00023900: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00023910: 2d0a 2020 2020 2020 2020 5479 7065 4572  -.        TypeEr
-00023920: 726f 7220 2020 2020 2020 2020 2020 2020  ror             
-00023930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023940: 2020 2020 5472 6163 6562 6163 6b20 286d      Traceback (m
-00023950: 6f73 7420 7265 6365 6e74 2063 616c 6c20  ost recent call 
-00023960: 6c61 7374 290a 2020 2020 2020 2020 2e2e  last).        ..
-00023970: 2e2e 0a20 2020 2020 2020 2054 7970 6545  ...        TypeE
-00023980: 7272 6f72 3a20 756e 7375 7070 6f72 7465  rror: unsupporte
-00023990: 6420 6f70 6572 616e 6420 7479 7065 2873  d operand type(s
-000239a0: 2920 666f 7220 2f3a 2027 7374 7227 2061  ) for /: 'str' a
-000239b0: 6e64 2027 7374 7227 0a20 2020 2020 2020  nd 'str'.       
-000239c0: 2049 6e20 5b34 5d3a 2025 6465 6275 670a   In [4]: %debug.
-000239d0: 2020 2020 2020 2020 2e2e 2e2e 0a20 2020          .....   
-000239e0: 2020 2020 2069 7064 623e 2070 7269 6e74       ipdb> print
-000239f0: 2878 202b 2062 3634 6465 636f 6465 2822  (x + b64decode("
-00023a00: 5141 3d3d 2229 2e64 6563 6f64 6528 2775  QA==").decode('u
-00023a10: 7466 2d38 2729 202b 2079 290a 2020 2020  tf-8') + y).    
-00023a20: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
-00023a30: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
-00023a40: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
-00023a50: 2020 2042 6f77 6372 6166 7440 4d6f 756e     Bowcraft@Moun
-00023a60: 7461 696e 0a20 2020 2020 2020 2069 7064  tain.        ipd
-00023a70: 623e 2071 0a20 2020 2022 2222 2c20 6672  b> q.    """, fr
-00023a80: 6f6e 7465 6e64 3d66 726f 6e74 656e 6429  ontend=frontend)
-00023a90: 0a0a 0a40 7265 7472 790a 6465 6620 7465  ...@retry.def te
-00023aa0: 7374 5f64 6562 7567 5f74 6162 5f63 6f6d  st_debug_tab_com
-00023ab0: 706c 6574 696f 6e5f 6462 5f31 2866 726f  pletion_db_1(fro
-00023ac0: 6e74 656e 6429 3a0a 2020 2020 2320 5665  ntend):.    # Ve
-00023ad0: 7269 6679 2074 6861 7420 7461 6220 636f  rify that tab co
-00023ae0: 6d70 6c65 7469 6f6e 2066 726f 6d20 6461  mpletion from da
-00023af0: 7461 6261 7365 2077 6f72 6b73 2e0a 2020  tabase works..  
-00023b00: 2020 6970 7974 686f 6e28 2222 220a 2020    ipython(""".  
-00023b10: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
-00023b20: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
-00023b30: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
-00023b40: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
-00023b50: 2020 2020 2049 6e20 5b32 5d3a 2039 3033       In [2]: 903
-00023b60: 3833 3935 312f 300a 2020 2020 2020 2020  83951/0.        
-00023b70: 2e2e 2e2e 0a20 2020 2020 2020 205a 6572  .....        Zer
-00023b80: 6f44 6976 6973 696f 6e45 7272 6f72 3a20  oDivisionError: 
-00023b90: 2e2e 2e0a 2020 2020 2020 2020 496e 205b  ....        In [
-00023ba0: 335d 3a20 2564 6562 7567 0a20 2020 2020  3]: %debug.     
-00023bb0: 2020 202e 2e2e 2e0a 2020 2020 2020 2020     .....        
-00023bc0: 6970 6462 3e20 7072 696e 7428 6236 3464  ipdb> print(b64d
-00023bd0: 6563 5c74 6f64 6528 2252 3246 795a 6d6c  ec\tode("R2FyZml
-00023be0: 6c62 4751 3d22 292e 6465 636f 6465 2827  lbGQ=").decode('
-00023bf0: 7574 662d 3827 2929 0a20 2020 2020 2020  utf-8')).       
-00023c00: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
-00023c10: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
-00023c20: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
-00023c30: 4761 7266 6965 6c64 0a20 2020 2020 2020  Garfield.       
-00023c40: 2069 7064 623e 2071 0a20 2020 2022 2222   ipdb> q.    """
-00023c50: 2c20 6672 6f6e 7465 6e64 3d66 726f 6e74  , frontend=front
-00023c60: 656e 6429 0a0a 0a40 7265 7472 790a 6465  end)...@retry.de
-00023c70: 6620 7465 7374 5f64 6562 7567 5f74 6162  f test_debug_tab
-00023c80: 5f63 6f6d 706c 6574 696f 6e5f 6d6f 6475  _completion_modu
-00023c90: 6c65 5f31 2866 726f 6e74 656e 642c 2074  le_1(frontend, t
-00023ca0: 6d70 293a 0a20 2020 2023 2056 6572 6966  mp):.    # Verif
-00023cb0: 7920 7468 6174 2074 6162 2063 6f6d 706c  y that tab compl
-00023cc0: 6574 696f 6e20 6f6e 206d 6f64 756c 6520  etion on module 
-00023cd0: 6e61 6d65 7320 776f 726b 732e 0a20 2020  names works..   
-00023ce0: 2077 7269 7465 7465 7874 2874 6d70 2e64   writetext(tmp.d
-00023cf0: 6972 2f22 7468 6f72 6e74 6f6e 3630 3039  ir/"thornton6009
-00023d00: 3731 3831 2e70 7922 2c20 2222 220a 2020  7181.py", """.  
-00023d10: 2020 2020 2020 7261 6e64 6f6c 7068 203d        randolph =
-00023d20: 2031 3431 3634 3539 380a 2020 2020 2222   14164598.    ""
-00023d30: 2229 0a20 2020 2069 7079 7468 6f6e 2822  ").    ipython("
-00023d40: 2222 0a20 2020 2020 2020 2049 6e20 5b31  "".        In [1
-00023d50: 5d3a 2069 6d70 6f72 7420 7079 666c 7962  ]: import pyflyb
-00023d60: 793b 2070 7966 6c79 6279 2e65 6e61 626c  y; pyflyby.enabl
-00023d70: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
-00023d80: 290a 2020 2020 2020 2020 496e 205b 325d  ).        In [2]
-00023d90: 3a20 3533 3431 3834 3033 2f30 0a20 2020  : 53418403/0.   
-00023da0: 2020 2020 202e 2e2e 2e0a 2020 2020 2020       .....      
-00023db0: 2020 5a65 726f 4469 7669 7369 6f6e 4572    ZeroDivisionEr
-00023dc0: 726f 723a 202e 2e2e 0a20 2020 2020 2020  ror: ....       
-00023dd0: 2049 6e20 5b33 5d3a 2025 6465 6275 670a   In [3]: %debug.
-00023de0: 2020 2020 2020 2020 2e2e 2e2e 0a20 2020          .....   
-00023df0: 2020 2020 2069 7064 623e 2070 7269 6e74       ipdb> print
-00023e00: 2874 686f 726e 746f 6e36 3030 3937 5c74  (thornton60097\t
-00023e10: 3138 312e 7261 6e64 6f5c 740a 2020 2020  181.rando\t.    
-00023e20: 2020 2020 5b50 5946 4c59 4259 5d20 696d      [PYFLYBY] im
-00023e30: 706f 7274 2074 686f 726e 746f 6e36 3030  port thornton600
-00023e40: 3937 3138 310a 2020 2020 2020 2020 6970  97181.        ip
-00023e50: 6462 3e20 7072 696e 7428 7468 6f72 6e74  db> print(thornt
-00023e60: 6f6e 3630 3039 3731 3831 2e72 616e 646f  on60097181.rando
-00023e70: 6c70 6829 0a20 2020 2020 2020 2031 3431  lph).        141
-00023e80: 3634 3539 380a 2020 2020 2020 2020 6970  64598.        ip
-00023e90: 6462 3e20 710a 2020 2020 2222 222c 2050  db> q.    """, P
-00023ea0: 5954 484f 4e50 4154 483d 746d 702e 6469  YTHONPATH=tmp.di
-00023eb0: 722c 2066 726f 6e74 656e 643d 6672 6f6e  r, frontend=fron
-00023ec0: 7465 6e64 290a 0a0a 4072 6574 7279 0a64  tend)...@retry.d
-00023ed0: 6566 2074 6573 745f 6465 6275 675f 7461  ef test_debug_ta
-00023ee0: 625f 636f 6d70 6c65 7469 6f6e 5f6d 756c  b_completion_mul
-00023ef0: 7469 706c 655f 3128 6672 6f6e 7465 6e64  tiple_1(frontend
-00023f00: 2c20 746d 7029 3a0a 2020 2020 2320 5665  , tmp):.    # Ve
-00023f10: 7269 6679 2074 6861 7420 7461 6220 636f  rify that tab co
-00023f20: 6d70 6c65 7469 6f6e 2077 6974 6820 616d  mpletion with am
-00023f30: 6269 6775 6f75 7320 6e61 6d65 7320 776f  biguous names wo
-00023f40: 726b 732e 0a20 2020 2069 6620 6672 6f6e  rks..    if fron
-00023f50: 7465 6e64 203d 3d20 2270 726f 6d70 745f  tend == "prompt_
-00023f60: 746f 6f6c 6b69 7422 3a20 7079 7465 7374  toolkit": pytest
-00023f70: 2e73 6b69 7028 290a 2020 2020 7772 6974  .skip().    writ
-00023f80: 6574 6578 7428 746d 702e 6469 722f 2273  etext(tmp.dir/"s
-00023f90: 7475 7262 7269 6467 6539 3038 3833 3333  turbridge9088333
-00023fa0: 2e70 7922 2c20 2222 220a 2020 2020 2020  .py", """.      
-00023fb0: 2020 6e65 6275 6c61 5f34 3136 3935 3435    nebula_4169545
-00023fc0: 3820 3d20 310a 2020 2020 2020 2020 6e65  8 = 1.        ne
-00023fd0: 6275 6c61 5f31 3039 3833 3834 3020 3d20  bula_10983840 = 
-00023fe0: 320a 2020 2020 2222 2229 0a20 2020 2069  2.    """).    i
-00023ff0: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
-00024000: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
-00024010: 7420 7079 666c 7962 793b 2070 7966 6c79  t pyflyby; pyfly
-00024020: 6279 2e65 6e61 626c 655f 6175 746f 5f69  by.enable_auto_i
-00024030: 6d70 6f72 7465 7228 290a 2020 2020 2020  mporter().      
-00024040: 2020 496e 205b 325d 3a20 3631 3736 3435    In [2]: 617645
-00024050: 3235 2f30 0a20 2020 2020 2020 202e 2e2e  25/0.        ...
-00024060: 2e0a 2020 2020 2020 2020 5a65 726f 4469  ..        ZeroDi
-00024070: 7669 7369 6f6e 4572 726f 723a 202e 2e2e  visionError: ...
-00024080: 0a20 2020 2020 2020 2049 6e20 5b33 5d3a  .        In [3]:
-00024090: 2025 6465 6275 670a 2020 2020 2020 2020   %debug.        
-000240a0: 2e2e 2e2e 0a20 2020 2020 2020 2069 7064  .....        ipd
-000240b0: 623e 2070 7269 6e74 2873 7475 7262 7269  b> print(sturbri
-000240c0: 6467 6539 3038 3833 3333 2e6e 6562 5c74  dge9088333.neb\t
-000240d0: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
-000240e0: 595d 2069 6d70 6f72 7420 7374 7572 6272  Y] import sturbr
-000240f0: 6964 6765 3930 3838 3333 330a 2020 2020  idge9088333.    
-00024100: 2020 2020 6970 6462 3e20 7072 696e 7428      ipdb> print(
-00024110: 7374 7572 6272 6964 6765 3930 3838 3333  sturbridge908833
-00024120: 332e 6e65 620a 2020 2020 2020 2020 7374  3.neb.        st
-00024130: 7572 6272 6964 6765 3930 3838 3333 332e  urbridge9088333.
-00024140: 6e65 6275 6c61 5f31 3039 3833 3834 3020  nebula_10983840 
-00024150: 2073 7475 7262 7269 6467 6539 3038 3833   sturbridge90883
-00024160: 3333 2e6e 6562 756c 615f 3431 3639 3534  33.nebula_416954
-00024170: 3538 0a20 2020 2020 2020 2069 7064 623e  58.        ipdb>
-00024180: 2070 7269 6e74 2873 7475 7262 7269 6467   print(sturbridg
-00024190: 6539 3038 3833 3333 2e6e 6562 756c 615f  e9088333.nebula_
-000241a0: 290a 2020 2020 2020 2020 2a2a 2a20 4174  ).        *** At
-000241b0: 7472 6962 7574 6545 7272 6f72 3a20 7374  tributeError: st
-000241c0: 7572 6272 6964 6765 3930 3838 3333 3320  urbridge9088333 
-000241d0: 6861 7320 6e6f 2061 7474 7269 6275 7465  has no attribute
-000241e0: 2027 6e65 6275 6c61 5f27 0a20 2020 2020   'nebula_'.     
-000241f0: 2020 2069 7064 623e 2071 0a20 2020 2022     ipdb> q.    "
-00024200: 2222 2c20 5059 5448 4f4e 5041 5448 3d74  "", PYTHONPATH=t
-00024210: 6d70 2e64 6972 2c20 6672 6f6e 7465 6e64  mp.dir, frontend
-00024220: 3d66 726f 6e74 656e 6429 0a0a 0a40 7265  =frontend)...@re
-00024230: 7472 790a 6465 6620 7465 7374 5f64 6562  try.def test_deb
-00024240: 7567 5f70 6f73 746d 6f72 7465 6d5f 7461  ug_postmortem_ta
-00024250: 625f 636f 6d70 6c65 7469 6f6e 5f31 2866  b_completion_1(f
-00024260: 726f 6e74 656e 6429 3a0a 2020 2020 2320  rontend):.    # 
-00024270: 5665 7269 6679 2074 6861 7420 7461 6220  Verify that tab 
-00024280: 636f 6d70 6c65 7469 6f6e 2069 6e20 2564  completion in %d
-00024290: 6562 7567 2070 6f73 746d 6f72 7465 6d20  ebug postmortem 
-000242a0: 6d6f 6465 2077 6f72 6b73 2e0a 2020 2020  mode works..    
-000242b0: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
-000242c0: 2020 2020 496e 205b 315d 3a20 696d 706f      In [1]: impo
-000242d0: 7274 2070 7966 6c79 6279 3b20 7079 666c  rt pyflyby; pyfl
-000242e0: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
-000242f0: 696d 706f 7274 6572 2829 0a20 2020 2020  importer().     
-00024300: 2020 2049 6e20 5b32 5d3a 2064 6566 2066     In [2]: def f
-00024310: 6f6f 2878 2c20 7929 3a0a 2020 2020 2020  oo(x, y):.      
-00024320: 2020 2020 202e 2e2e 3a20 2020 2020 7265       ...:     re
-00024330: 7475 726e 2078 202f 2079 0a20 2020 2020  turn x / y.     
-00024340: 2020 2020 2020 2e2e 2e3a 0a20 2020 2020        ...:.     
-00024350: 2020 2049 6e20 5b33 5d3a 2066 6f6f 2822     In [3]: foo("
-00024360: 4361 6d64 656e 222c 2022 486f 706b 696e  Camden", "Hopkin
-00024370: 736f 6e22 290a 2020 2020 2020 2020 2d2d  son").        --
-00024380: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00024390: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000243a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000243b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000243c0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-000243d0: 2020 5479 7065 4572 726f 7220 2020 2020    TypeError     
-000243e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000243f0: 2020 2020 2020 2020 2020 2020 5472 6163              Trac
-00024400: 6562 6163 6b20 286d 6f73 7420 7265 6365  eback (most rece
-00024410: 6e74 2063 616c 6c20 6c61 7374 290a 2020  nt call last).  
-00024420: 2020 2020 2020 2e2e 2e2e 0a20 2020 2020        .....     
-00024430: 2020 2054 7970 6545 7272 6f72 3a20 756e     TypeError: un
-00024440: 7375 7070 6f72 7465 6420 6f70 6572 616e  supported operan
-00024450: 6420 7479 7065 2873 2920 666f 7220 2f3a  d type(s) for /:
-00024460: 2027 7374 7227 2061 6e64 2027 7374 7227   'str' and 'str'
-00024470: 0a20 2020 2020 2020 2049 6e20 5b34 5d3a  .        In [4]:
-00024480: 2025 6465 6275 670a 2020 2020 2020 2020   %debug.        
-00024490: 2e2e 2e2e 0a20 2020 2020 2020 2069 7064  .....        ipd
-000244a0: 623e 2070 7269 6e74 2878 202b 2062 6173  b> print(x + bas
-000244b0: 6536 342e 6236 3464 5c74 0a20 2020 2020  e64.b64d\t.     
-000244c0: 2020 205b 5059 464c 5942 595d 2069 6d70     [PYFLYBY] imp
-000244d0: 6f72 7420 6261 7365 3634 0a20 2020 2020  ort base64.     
-000244e0: 2020 2069 7064 623e 2070 7269 6e74 2878     ipdb> print(x
-000244f0: 202b 2062 6173 6536 342e 6236 3464 6563   + base64.b64dec
-00024500: 6f64 6528 224c 773d 3d22 292e 6465 636f  ode("Lw==").deco
-00024510: 6465 2827 7574 662d 3827 2920 2b20 7929  de('utf-8') + y)
-00024520: 0a20 2020 2020 2020 2043 616d 6465 6e2f  .        Camden/
-00024530: 486f 706b 696e 736f 6e0a 2020 2020 2020  Hopkinson.      
-00024540: 2020 6970 6462 3e20 710a 2020 2020 2222    ipdb> q.    ""
-00024550: 222c 2066 726f 6e74 656e 643d 6672 6f6e  ", frontend=fron
-00024560: 7465 6e64 290a 0a0a 4070 7974 6573 742e  tend)...@pytest.
-00024570: 6d61 726b 2e73 6b69 7069 6628 0a20 2020  mark.skipif(.   
-00024580: 2073 7973 2e76 6572 7369 6f6e 5f69 6e66   sys.version_inf
-00024590: 6f5b 305d 203d 3d20 322c 0a20 2020 2072  o[0] == 2,.    r
-000245a0: 6561 736f 6e3d 225b 5059 464c 5942 595d  eason="[PYFLYBY]
-000245b0: 2069 6d70 6f72 7420 6261 7365 3634 2069   import base64 i
-000245c0: 7320 6e6f 7420 7472 6967 6765 7265 6420  s not triggered 
-000245d0: 6174 2074 6865 2073 616d 6520 7469 6d65  at the same time
-000245e0: 2064 6570 656e 6469 6e67 206f 6e20 7079   depending on py
-000245f0: 7468 6f6e 2076 6572 7369 6f6e 7322 2c0a  thon versions",.
-00024600: 290a 6465 6620 7465 7374 5f64 6562 7567  ).def test_debug
-00024610: 5f6e 616d 6573 7061 6365 5f31 5f70 7933  _namespace_1_py3
-00024620: 2866 726f 6e74 656e 6429 3a0a 2020 2020  (frontend):.    
-00024630: 2320 5665 7269 6679 2074 6861 7420 6175  # Verify that au
-00024640: 746f 696d 706f 7274 696e 6720 616e 6420  toimporting and 
-00024650: 7461 6220 636f 6d70 6c65 7469 6f6e 2068  tab completion h
-00024660: 6170 7065 6e20 696e 2074 6865 206c 6f63  appen in the loc
-00024670: 616c 0a20 2020 2023 206e 616d 6573 7061  al.    # namespa
-00024680: 6365 2e0a 2020 2020 2320 496e 2074 6869  ce..    # In thi
-00024690: 7320 6578 616d 706c 652c 2069 6e20 7468  s example, in th
-000246a0: 6520 6c6f 6361 6c20 6e61 6d65 7370 6163  e local namespac
-000246b0: 652c 2027 6261 7365 3634 2720 6973 2061  e, 'base64' is a
-000246c0: 2076 6172 6961 626c 6520 2877 6869 6368   variable (which
-000246d0: 0a20 2020 2023 2069 7320 6120 7374 7269  .    # is a stri
-000246e0: 6e67 292c 2061 6e64 2073 686f 756c 646e  ng), and shouldn
-000246f0: 2774 2072 6566 6572 2074 6f20 7468 6520  't refer to the 
-00024700: 676c 6f62 616c 2027 6261 7365 3634 272e  global 'base64'.
-00024710: 0a20 2020 2069 7079 7468 6f6e 2822 2222  .    ipython("""
-00024720: 0a20 2020 2020 2020 2049 6e20 5b31 5d3a  .        In [1]:
-00024730: 2069 6d70 6f72 7420 7079 666c 7962 793b   import pyflyby;
-00024740: 2070 7966 6c79 6279 2e65 6e61 626c 655f   pyflyby.enable_
-00024750: 6175 746f 5f69 6d70 6f72 7465 7228 290a  auto_importer().
-00024760: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
-00024770: 6465 6620 666f 6f28 782c 2062 6173 6536  def foo(x, base6
-00024780: 3429 3a0a 2020 2020 2020 2020 2020 202e  4):.           .
-00024790: 2e2e 3a20 2020 2020 7265 7475 726e 2078  ..:     return x
-000247a0: 202f 2062 6173 6536 340a 2020 2020 2020   / base64.      
-000247b0: 2020 2020 202e 2e2e 3a0a 2020 2020 2020       ...:.      
-000247c0: 2020 496e 205b 335d 3a20 666f 6f28 224c    In [3]: foo("L
-000247d0: 6578 696e 6774 6f6e 222c 2022 6174 6c61  exington", "atla
-000247e0: 6e74 6963 2229 0a20 2020 2020 2020 202d  ntic").        -
-000247f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00024800: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00024810: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00024820: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00024830: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00024840: 2020 2054 7970 6545 7272 6f72 2020 2020     TypeError    
-00024850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024860: 2020 2020 2020 2020 2020 2020 2054 7261               Tra
-00024870: 6365 6261 636b 2028 6d6f 7374 2072 6563  ceback (most rec
-00024880: 656e 7420 6361 6c6c 206c 6173 7429 0a20  ent call last). 
-00024890: 2020 2020 2020 202e 2e2e 2e0a 2020 2020         .....    
-000248a0: 2020 2020 5479 7065 4572 726f 723a 2075      TypeError: u
-000248b0: 6e73 7570 706f 7274 6564 206f 7065 7261  nsupported opera
-000248c0: 6e64 2074 7970 6528 7329 2066 6f72 202f  nd type(s) for /
-000248d0: 3a20 2773 7472 2720 616e 6420 2773 7472  : 'str' and 'str
-000248e0: 270a 2020 2020 2020 2020 496e 205b 345d  '.        In [4]
-000248f0: 3a20 2564 6562 7567 0a20 2020 2020 2020  : %debug.       
-00024900: 202e 2e2e 2e0a 2020 2020 2020 2020 6970   .....        ip
-00024910: 6462 3e20 7072 696e 7428 6261 7365 3634  db> print(base64
-00024920: 2e63 6170 5c74 6974 616c 697a 6528 2920  .cap\titalize() 
-00024930: 2b20 6236 3464 6563 6f5c 7464 6528 2255  + b64deco\tde("U
-00024940: 4746 6a61 575a 7059 773d 3d22 292e 6465  GFjaWZpYw==").de
-00024950: 636f 6465 2827 7574 662d 3827 2929 0a20  code('utf-8')). 
-00024960: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
-00024970: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
-00024980: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
-00024990: 2020 2020 2020 4174 6c61 6e74 6963 5061        AtlanticPa
-000249a0: 6369 6669 630a 2020 2020 2020 2020 6970  cific.        ip
-000249b0: 6462 3e20 7020 6236 3464 6563 6f5c 7464  db> p b64deco\td
-000249c0: 6528 2251 3239 7564 476c 755a 5735 3059  e("Q29udGluZW50Y
-000249d0: 5777 3d22 290a 2020 2020 2020 2020 6227  Ww=").        b'
-000249e0: 436f 6e74 696e 656e 7461 6c27 0a20 2020  Continental'.   
-000249f0: 2020 2020 2069 7064 623e 2071 0a20 2020       ipdb> q.   
-00024a00: 2020 2020 2049 6e20 5b35 5d3a 2062 6173       In [5]: bas
-00024a10: 6536 342e 6236 3464 655c 740a 2020 2020  e64.b64de\t.    
-00024a20: 2020 2020 496e 205b 355d 3a20 6261 7365      In [5]: base
-00024a30: 3634 2e62 3634 6465 636f 6465 2822 5347  64.b64decode("SG
-00024a40: 6c73 6241 3d3d 2229 202b 2062 3634 6465  lsbA==") + b64de
-00024a50: 636f 5c74 6465 2822 5447 4672 5a51 3d3d  co\tde("TGFrZQ==
-00024a60: 2229 0a20 2020 2020 2020 205b 5059 464c  ").        [PYFL
-00024a70: 5942 595d 2066 726f 6d20 6261 7365 3634  YBY] from base64
-00024a80: 2069 6d70 6f72 7420 6236 3464 6563 6f64   import b64decod
-00024a90: 650a 2020 2020 2020 2020 4f75 745b 355d  e.        Out[5]
-00024aa0: 3a20 6227 4869 6c6c 4c61 6b65 270a 2020  : b'HillLake'.  
-00024ab0: 2020 2222 222c 2066 726f 6e74 656e 643d    """, frontend=
-00024ac0: 6672 6f6e 7465 6e64 290a 0a40 7079 7465  frontend)..@pyte
-00024ad0: 7374 2e6d 6172 6b2e 736b 6970 6966 280a  st.mark.skipif(.
-00024ae0: 2020 2020 7379 732e 7665 7273 696f 6e5f      sys.version_
-00024af0: 696e 666f 5b30 5d20 3d3d 2033 2c0a 2020  info[0] == 3,.  
-00024b00: 2020 7265 6173 6f6e 3d22 5b50 5946 4c59    reason="[PYFLY
-00024b10: 4259 5d20 696d 706f 7274 2062 6173 6536  BY] import base6
-00024b20: 3420 6973 206e 6f74 2074 7269 6767 6572  4 is not trigger
-00024b30: 6564 2061 7420 7468 6520 7361 6d65 2074  ed at the same t
-00024b40: 696d 6520 6465 7065 6e64 696e 6720 6f6e  ime depending on
-00024b50: 2070 7974 686f 6e20 7665 7273 696f 6e73   python versions
-00024b60: 222c 0a29 0a64 6566 2074 6573 745f 6465  ",.).def test_de
-00024b70: 6275 675f 6e61 6d65 7370 6163 655f 315f  bug_namespace_1_
-00024b80: 7079 3228 6672 6f6e 7465 6e64 293a 0a20  py2(frontend):. 
-00024b90: 2020 2023 2056 6572 6966 7920 7468 6174     # Verify that
-00024ba0: 2061 7574 6f69 6d70 6f72 7469 6e67 2061   autoimporting a
-00024bb0: 6e64 2074 6162 2063 6f6d 706c 6574 696f  nd tab completio
-00024bc0: 6e20 6861 7070 656e 2069 6e20 7468 6520  n happen in the 
-00024bd0: 6c6f 6361 6c0a 2020 2020 2320 6e61 6d65  local.    # name
-00024be0: 7370 6163 652e 0a20 2020 2023 2049 6e20  space..    # In 
-00024bf0: 7468 6973 2065 7861 6d70 6c65 2c20 696e  this example, in
-00024c00: 2074 6865 206c 6f63 616c 206e 616d 6573   the local names
-00024c10: 7061 6365 2c20 2762 6173 6536 3427 2069  pace, 'base64' i
-00024c20: 7320 6120 7661 7269 6162 6c65 2028 7768  s a variable (wh
-00024c30: 6963 680a 2020 2020 2320 6973 2061 2073  ich.    # is a s
-00024c40: 7472 696e 6729 2c20 616e 6420 7368 6f75  tring), and shou
-00024c50: 6c64 6e27 7420 7265 6665 7220 746f 2074  ldn't refer to t
-00024c60: 6865 2067 6c6f 6261 6c20 2762 6173 6536  he global 'base6
-00024c70: 3427 2e0a 2020 2020 6970 7974 686f 6e28  4'..    ipython(
-00024c80: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-00024c90: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
-00024ca0: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
-00024cb0: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-00024cc0: 2829 0a20 2020 2020 2020 2049 6e20 5b32  ().        In [2
-00024cd0: 5d3a 2064 6566 2066 6f6f 2878 2c20 6261  ]: def foo(x, ba
-00024ce0: 7365 3634 293a 0a20 2020 2020 2020 2020  se64):.         
-00024cf0: 2020 2e2e 2e3a 2020 2020 2072 6574 7572    ...:     retur
-00024d00: 6e20 7820 2f20 6261 7365 3634 0a20 2020  n x / base64.   
-00024d10: 2020 2020 2020 2020 2e2e 2e3a 0a20 2020          ...:.   
-00024d20: 2020 2020 2049 6e20 5b33 5d3a 2066 6f6f       In [3]: foo
-00024d30: 2822 4c65 7869 6e67 746f 6e22 2c20 2261  ("Lexington", "a
-00024d40: 746c 616e 7469 6322 290a 2020 2020 2020  tlantic").      
-00024d50: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d    --------------
-00024d60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00024d70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00024d80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00024d90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
-00024da0: 2020 2020 2020 5479 7065 4572 726f 7220        TypeError 
-00024db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024dd0: 5472 6163 6562 6163 6b20 286d 6f73 7420  Traceback (most 
-00024de0: 7265 6365 6e74 2063 616c 6c20 6c61 7374  recent call last
-00024df0: 290a 2020 2020 2020 2020 2e2e 2e2e 0a20  ).        ..... 
-00024e00: 2020 2020 2020 2054 7970 6545 7272 6f72         TypeError
-00024e10: 3a20 756e 7375 7070 6f72 7465 6420 6f70  : unsupported op
-00024e20: 6572 616e 6420 7479 7065 2873 2920 666f  erand type(s) fo
-00024e30: 7220 2f3a 2027 7374 7227 2061 6e64 2027  r /: 'str' and '
-00024e40: 7374 7227 0a20 2020 2020 2020 2049 6e20  str'.        In 
-00024e50: 5b34 5d3a 2025 6465 6275 670a 2020 2020  [4]: %debug.    
-00024e60: 2020 2020 2e2e 2e2e 0a20 2020 2020 2020      .....       
-00024e70: 2069 7064 623e 2070 7269 6e74 2862 6173   ipdb> print(bas
-00024e80: 6536 342e 6361 705c 7469 7461 6c69 7a65  e64.cap\titalize
-00024e90: 2829 202b 2062 3634 6465 636f 5c74 6465  () + b64deco\tde
-00024ea0: 2822 5547 466a 6157 5a70 5977 3d3d 2229  ("UGFjaWZpYw==")
-00024eb0: 2e64 6563 6f64 6528 2775 7466 2d38 2729  .decode('utf-8')
-00024ec0: 290a 2020 2020 2020 2020 5b50 5946 4c59  ).        [PYFLY
-00024ed0: 4259 5d20 6672 6f6d 2062 6173 6536 3420  BY] from base64 
-00024ee0: 696d 706f 7274 2062 3634 6465 636f 6465  import b64decode
-00024ef0: 0a20 2020 2020 2020 2041 746c 616e 7469  .        Atlanti
-00024f00: 6350 6163 6966 6963 0a20 2020 2020 2020  cPacific.       
-00024f10: 2069 7064 623e 2070 2062 3634 6465 636f   ipdb> p b64deco
-00024f20: 5c74 6465 2822 5132 3975 6447 6c75 5a57  \tde("Q29udGluZW
-00024f30: 3530 5957 773d 2229 0a20 2020 2020 2020  50YWw=").       
-00024f40: 2062 2743 6f6e 7469 6e65 6e74 616c 270a   b'Continental'.
-00024f50: 2020 2020 2020 2020 6970 6462 3e20 710a          ipdb> q.
-00024f60: 2020 2020 2020 2020 496e 205b 355d 3a20          In [5]: 
-00024f70: 6261 7365 3634 2e62 3634 6465 5c74 0a20  base64.b64de\t. 
-00024f80: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
-00024f90: 2069 6d70 6f72 7420 6261 7365 3634 0a20   import base64. 
-00024fa0: 2020 2020 2020 2049 6e20 5b35 5d3a 2062         In [5]: b
-00024fb0: 6173 6536 342e 6236 3464 6563 6f64 6528  ase64.b64decode(
-00024fc0: 2253 476c 7362 413d 3d22 2920 2b20 6236  "SGlsbA==") + b6
-00024fd0: 3464 6563 6f5c 7464 6528 2254 4746 725a  4deco\tde("TGFrZ
-00024fe0: 513d 3d22 290a 2020 2020 2020 2020 5b50  Q==").        [P
-00024ff0: 5946 4c59 4259 5d20 6672 6f6d 2062 6173  YFLYBY] from bas
-00025000: 6536 3420 696d 706f 7274 2062 3634 6465  e64 import b64de
-00025010: 636f 6465 0a20 2020 2020 2020 204f 7574  code.        Out
-00025020: 5b35 5d3a 2062 2748 696c 6c4c 616b 6527  [5]: b'HillLake'
-00025030: 0a20 2020 2022 2222 2c20 6672 6f6e 7465  .    """, fronte
-00025040: 6e64 3d66 726f 6e74 656e 6429 0a0a 0a40  nd=frontend)...@
-00025050: 7265 7472 790a 6465 6620 7465 7374 5f64  retry.def test_d
-00025060: 6562 7567 5f73 6563 6f6e 645f 3128 6672  ebug_second_1(fr
-00025070: 6f6e 7465 6e64 293a 0a20 2020 2023 2056  ontend):.    # V
-00025080: 6572 6966 7920 7468 6174 2061 2073 6563  erify that a sec
-00025090: 6f6e 6420 706f 7374 6d6f 7274 656d 2064  ond postmortem d
-000250a0: 6562 7567 206f 6620 7468 6520 7361 6d65  ebug of the same
-000250b0: 2066 756e 6374 696f 6e20 6265 6861 7665   function behave
-000250c0: 7320 6173 0a20 2020 2023 2065 7870 6563  s as.    # expec
-000250d0: 7465 642e 0a20 2020 2069 7079 7468 6f6e  ted..    ipython
-000250e0: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
-000250f0: 5b31 5d3a 2069 6d70 6f72 7420 7079 666c  [1]: import pyfl
-00025100: 7962 793b 2070 7966 6c79 6279 2e65 6e61  yby; pyflyby.ena
-00025110: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
-00025120: 7228 290a 2020 2020 2020 2020 496e 205b  r().        In [
-00025130: 325d 3a20 6465 6620 666f 6f28 782c 2079  2]: def foo(x, y
-00025140: 293a 0a20 2020 2020 2020 2020 2020 2e2e  ):.           ..
-00025150: 2e3a 2020 2020 2072 6574 7572 6e20 7820  .:     return x 
-00025160: 2f20 790a 2020 2020 2020 2020 2020 202e  / y.           .
-00025170: 2e2e 3a0a 2020 2020 2020 2020 496e 205b  ..:.        In [
-00025180: 335d 3a20 666f 6f28 2248 7572 6f6e 222c  3]: foo("Huron",
-00025190: 2022 4f73 6167 6522 290a 2020 2020 2020   "Osage").      
-000251a0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d    --------------
-000251b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000251c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000251d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000251e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
-000251f0: 2020 2020 2020 5479 7065 4572 726f 7220        TypeError 
-00025200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025220: 5472 6163 6562 6163 6b20 286d 6f73 7420  Traceback (most 
-00025230: 7265 6365 6e74 2063 616c 6c20 6c61 7374  recent call last
-00025240: 290a 2020 2020 2020 2020 2e2e 2e2e 0a20  ).        ..... 
-00025250: 2020 2020 2020 2054 7970 6545 7272 6f72         TypeError
-00025260: 3a20 756e 7375 7070 6f72 7465 6420 6f70  : unsupported op
-00025270: 6572 616e 6420 7479 7065 2873 2920 666f  erand type(s) fo
-00025280: 7220 2f3a 2027 7374 7227 2061 6e64 2027  r /: 'str' and '
-00025290: 7374 7227 0a20 2020 2020 2020 2049 6e20  str'.        In 
-000252a0: 5b34 5d3a 2025 6465 6275 670a 2020 2020  [4]: %debug.    
-000252b0: 2020 2020 2e2e 2e2e 0a20 2020 2020 2020      .....       
-000252c0: 2069 7064 623e 2062 3634 6465 636f 5c74   ipdb> b64deco\t
-000252d0: 6465 2822 536d 397a 5a58 426f 2229 0a20  de("Sm9zZXBo"). 
-000252e0: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
-000252f0: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
-00025300: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
-00025310: 2020 2020 2020 6227 4a6f 7365 7068 270a        b'Joseph'.
-00025320: 2020 2020 2020 2020 6970 6462 3e20 6236          ipdb> b6
-00025330: 3464 6563 6f5c 7464 6528 2255 3256 7461  4deco\tde("U2Vta
-00025340: 5735 7662 4755 3d22 290a 2020 2020 2020  W5vbGU=").      
-00025350: 2020 6227 5365 6d69 6e6f 6c65 270a 2020    b'Seminole'.  
-00025360: 2020 2020 2020 6970 6462 3e20 710a 2020        ipdb> q.  
-00025370: 2020 2020 2020 496e 205b 355d 3a20 666f        In [5]: fo
-00025380: 6f28 2251 7569 6e63 6522 2c20 224c 696c  o("Quince", "Lil
-00025390: 6163 2229 0a20 2020 2020 2020 202d 2d2d  ac").        ---
-000253a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000253b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000253c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000253d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000253e0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-000253f0: 2054 7970 6545 7272 6f72 2020 2020 2020   TypeError      
-00025400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025410: 2020 2020 2020 2020 2020 2054 7261 6365             Trace
-00025420: 6261 636b 2028 6d6f 7374 2072 6563 656e  back (most recen
-00025430: 7420 6361 6c6c 206c 6173 7429 0a20 2020  t call last).   
-00025440: 2020 2020 202e 2e2e 2e0a 2020 2020 2020       .....      
-00025450: 2020 5479 7065 4572 726f 723a 2075 6e73    TypeError: uns
-00025460: 7570 706f 7274 6564 206f 7065 7261 6e64  upported operand
-00025470: 2074 7970 6528 7329 2066 6f72 202f 3a20   type(s) for /: 
-00025480: 2773 7472 2720 616e 6420 2773 7472 270a  'str' and 'str'.
-00025490: 2020 2020 2020 2020 496e 205b 365d 3a20          In [6]: 
-000254a0: 2564 6562 7567 0a20 2020 2020 2020 202e  %debug.        .
-000254b0: 2e2e 2e0a 2020 2020 2020 2020 6970 6462  ....        ipdb
-000254c0: 3e20 6236 3464 6563 6f5c 7464 6528 2251  > b64deco\tde("Q
-000254d0: 334a 7659 3356 7a22 290a 2020 2020 2020  3JvY3Vz").      
-000254e0: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
-000254f0: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
-00025500: 3634 6465 636f 6465 0a20 2020 2020 2020  64decode.       
-00025510: 2062 2743 726f 6375 7327 0a20 2020 2020   b'Crocus'.     
-00025520: 2020 2069 7064 623e 2071 0a20 2020 2022     ipdb> q.    "
-00025530: 2222 2c20 6672 6f6e 7465 6e64 3d66 726f  "", frontend=fro
-00025540: 6e74 656e 6429 0a0a 0a40 7079 7465 7374  ntend)...@pytest
-00025550: 2e6d 6172 6b2e 736b 6970 6966 280a 2020  .mark.skipif(.  
-00025560: 2020 5f49 5059 5448 4f4e 5f56 4552 5349    _IPYTHON_VERSI
-00025570: 4f4e 203c 2028 312c 2030 292c 0a20 2020  ON < (1, 0),.   
-00025580: 2072 6561 736f 6e3d 226f 6c64 2049 5079   reason="old IPy
-00025590: 7468 6f6e 2064 6f65 736e 2774 2073 7570  thon doesn't sup
-000255a0: 706f 7274 2064 6562 7567 203c 7374 6174  port debug <stat
-000255b0: 656d 656e 743e 2229 0a40 7265 7472 790a  ement>").@retry.
-000255c0: 6465 6620 7465 7374 5f64 6562 7567 5f61  def test_debug_a
-000255d0: 7574 6f5f 696d 706f 7274 5f73 7472 696e  uto_import_strin
-000255e0: 675f 3128 6672 6f6e 7465 6e64 293a 0a20  g_1(frontend):. 
-000255f0: 2020 2023 2056 6572 6966 7920 7468 6174     # Verify that
-00025600: 2061 7574 6f20 696d 706f 7274 696e 6720   auto importing 
-00025610: 776f 726b 7320 696e 7369 6465 2074 6865  works inside the
-00025620: 2064 6562 7567 6765 7220 6166 7465 7220   debugger after 
-00025630: 7275 6e6e 696e 670a 2020 2020 2320 2225  running.    # "%
-00025640: 6465 6275 6720 3c73 7472 696e 673e 222e  debug <string>".
-00025650: 0a20 2020 2069 7079 7468 6f6e 2822 2222  .    ipython("""
-00025660: 0a20 2020 2020 2020 2049 6e20 5b31 5d3a  .        In [1]:
-00025670: 2069 6d70 6f72 7420 7079 666c 7962 793b   import pyflyby;
-00025680: 2070 7966 6c79 6279 2e65 6e61 626c 655f   pyflyby.enable_
-00025690: 6175 746f 5f69 6d70 6f72 7465 7228 290a  auto_importer().
-000256a0: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
-000256b0: 2564 6562 7567 2034 3439 3638 3831 370a  %debug 44968817.
-000256c0: 2020 2020 2020 2020 4e4f 5445 3a20 456e          NOTE: En
-000256d0: 7465 7220 2763 2720 6174 2074 6865 2069  ter 'c' at the i
-000256e0: 7064 623e 2020 7072 6f6d 7074 2074 6f20  pdb>  prompt to 
-000256f0: 636f 6e74 696e 7565 2065 7865 6375 7469  continue executi
-00025700: 6f6e 2e0a 2020 2020 2020 2020 3e20 3c73  on..        > <s
-00025710: 7472 696e 673e 2831 293c 6d6f 6475 6c65  tring>(1)<module
-00025720: 3e28 290a 2020 2020 2020 2020 6970 6462  >().        ipdb
-00025730: 3e20 7020 6236 3464 6563 6f64 6528 2254  > p b64decode("T
-00025740: 476c 7563 3278 6c65 513d 3d22 290a 2020  Gluc2xleQ==").  
-00025750: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
-00025760: 6672 6f6d 2062 6173 6536 3420 696d 706f  from base64 impo
-00025770: 7274 2062 3634 6465 636f 6465 0a20 2020  rt b64decode.   
-00025780: 2020 2020 2062 274c 696e 736c 6579 270a       b'Linsley'.
-00025790: 2020 2020 2020 2020 6970 6462 3e20 710a          ipdb> q.
-000257a0: 2020 2020 2222 222c 2066 726f 6e74 656e      """, fronten
-000257b0: 643d 6672 6f6e 7465 6e64 290a 0a0a 4070  d=frontend)...@p
-000257c0: 7974 6573 742e 6d61 726b 2e73 6b69 7069  ytest.mark.skipi
-000257d0: 6628 0a20 2020 205f 4950 5954 484f 4e5f  f(.    _IPYTHON_
-000257e0: 5645 5253 494f 4e20 3c20 2831 2c20 3029  VERSION < (1, 0)
-000257f0: 2c0a 2020 2020 7265 6173 6f6e 3d22 6f6c  ,.    reason="ol
-00025800: 6420 4950 7974 686f 6e20 646f 6573 6e27  d IPython doesn'
-00025810: 7420 7375 7070 6f72 7420 6465 6275 6720  t support debug 
-00025820: 3c73 7461 7465 6d65 6e74 3e22 290a 6465  <statement>").de
-00025830: 6620 7465 7374 5f64 6562 7567 5f61 7574  f test_debug_aut
-00025840: 6f5f 696d 706f 7274 5f6f 665f 7374 7269  o_import_of_stri
-00025850: 6e67 5f31 2866 726f 6e74 656e 642c 2074  ng_1(frontend, t
-00025860: 6d70 293a 0a20 2020 2023 2056 6572 6966  mp):.    # Verif
-00025870: 7920 7468 6174 2061 7574 6f20 696d 706f  y that auto impo
-00025880: 7274 696e 6720 776f 726b 7320 666f 7220  rting works for 
-00025890: 7468 6520 7374 7269 6e67 2074 6f20 6265  the string to be
-000258a0: 2064 6562 7567 6765 642e 0a20 2020 2077   debugged..    w
-000258b0: 7269 7465 7465 7874 2874 6d70 2e64 6972  ritetext(tmp.dir
-000258c0: 2f22 7065 656b 736b 696c 6c34 3336 3636  /"peekskill43666
-000258d0: 3933 302e 7079 222c 2022 2222 0a20 2020  930.py", """.   
-000258e0: 2020 2020 2064 6566 2068 6f6c 6c6f 7728       def hollow(
-000258f0: 7829 3a0a 2020 2020 2020 2020 2020 2020  x):.            
-00025900: 7072 696e 7428 7820 2a20 3229 0a20 2020  print(x * 2).   
-00025910: 2022 2222 290a 2020 2020 6970 7974 686f   """).    ipytho
-00025920: 6e28 2222 220a 2020 2020 2020 2020 496e  n(""".        In
-00025930: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
-00025940: 6c79 6279 3b20 7079 666c 7962 792e 656e  lyby; pyflyby.en
-00025950: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
-00025960: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
-00025970: 5b32 5d3a 2025 6465 6275 6720 7065 656b  [2]: %debug peek
-00025980: 736b 696c 6c34 3336 3636 3933 302e 686f  skill43666930.ho
-00025990: 6c6c 6f77 2836 3736 3538 3134 3129 0a20  llow(67658141). 
-000259a0: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
-000259b0: 2069 6d70 6f72 7420 7065 656b 736b 696c   import peekskil
-000259c0: 6c34 3336 3636 3933 300a 2020 2020 2020  l43666930.      
-000259d0: 2020 4e4f 5445 3a20 456e 7465 7220 2763    NOTE: Enter 'c
-000259e0: 2720 6174 2074 6865 2069 7064 623e 2020  ' at the ipdb>  
-000259f0: 7072 6f6d 7074 2074 6f20 636f 6e74 696e  prompt to contin
-00025a00: 7565 2065 7865 6375 7469 6f6e 2e0a 2020  ue execution..  
-00025a10: 2020 2020 2020 3e20 3c73 7472 696e 673e        > <string>
-00025a20: 2831 293c 6d6f 6475 6c65 3e28 290a 2020  (1)<module>().  
-00025a30: 2020 2020 2020 6970 6462 3e20 630a 2020        ipdb> c.  
-00025a40: 2020 2020 2020 3133 3533 3136 3238 320a        135316282.
-00025a50: 2020 2020 2222 222c 2050 5954 484f 4e50      """, PYTHONP
-00025a60: 4154 483d 746d 702e 6469 722c 2066 726f  ATH=tmp.dir, fro
-00025a70: 6e74 656e 643d 6672 6f6e 7465 6e64 290a  ntend=frontend).
-00025a80: 0a0a 4070 7974 6573 742e 6d61 726b 2e73  ..@pytest.mark.s
-00025a90: 6b69 7069 6628 0a20 2020 205f 4950 5954  kipif(.    _IPYT
-00025aa0: 484f 4e5f 5645 5253 494f 4e20 3c20 2831  HON_VERSION < (1
-00025ab0: 2c20 3029 2c0a 2020 2020 7265 6173 6f6e  , 0),.    reason
-00025ac0: 3d22 6f6c 6420 4950 7974 686f 6e20 646f  ="old IPython do
-00025ad0: 6573 6e27 7420 7375 7070 6f72 7420 6465  esn't support de
-00025ae0: 6275 6720 3c73 7461 7465 6d65 6e74 3e22  bug <statement>"
-00025af0: 290a 4072 6574 7279 0a64 6566 2074 6573  ).@retry.def tes
-00025b00: 745f 6465 6275 675f 6175 746f 5f69 6d70  t_debug_auto_imp
-00025b10: 6f72 745f 7374 6174 656d 656e 745f 7374  ort_statement_st
-00025b20: 6570 5f31 2866 726f 6e74 656e 642c 2074  ep_1(frontend, t
-00025b30: 6d70 293a 0a20 2020 2023 2056 6572 6966  mp):.    # Verif
-00025b40: 7920 7468 6174 2073 7465 7020 6675 6e63  y that step func
-00025b50: 7469 6f6e 616c 6974 7920 6973 6e27 7420  tionality isn't 
-00025b60: 6272 6f6b 656e 2e0a 2020 2020 7772 6974  broken..    writ
-00025b70: 6574 6578 7428 746d 702e 6469 722f 2274  etext(tmp.dir/"t
-00025b80: 6163 6f6e 6963 3732 3338 3334 3238 2e70  aconic72383428.p
-00025b90: 7922 2c20 2222 220a 2020 2020 2020 2020  y", """.        
-00025ba0: 6465 6620 7075 6464 696e 6728 7829 3a0a  def pudding(x):.
-00025bb0: 2020 2020 2020 2020 2020 2020 7920 3d20              y = 
-00025bc0: 7820 2a20 350a 2020 2020 2020 2020 2020  x * 5.          
-00025bd0: 2020 7072 696e 7428 7929 0a20 2020 2022    print(y).    "
-00025be0: 2222 290a 2020 2020 6970 7974 686f 6e28  "").    ipython(
-00025bf0: 2222 220a 2020 2020 2020 2020 496e 205b  """.        In [
-00025c00: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
-00025c10: 6279 3b20 7079 666c 7962 792e 656e 6162  by; pyflyby.enab
-00025c20: 6c65 5f61 7574 6f5f 696d 706f 7274 6572  le_auto_importer
-00025c30: 2829 0a20 2020 2020 2020 2049 6e20 5b32  ().        In [2
-00025c40: 5d3a 2025 6465 6275 6720 7461 636f 6e69  ]: %debug taconi
-00025c50: 6337 3233 3833 3432 382e 7075 6464 696e  c72383428.puddin
-00025c60: 6728 3438 3336 3433 3235 290a 2020 2020  g(48364325).    
-00025c70: 2020 2020 5b50 5946 4c59 4259 5d20 696d      [PYFLYBY] im
-00025c80: 706f 7274 2074 6163 6f6e 6963 3732 3338  port taconic7238
-00025c90: 3334 3238 0a20 2020 2020 2020 204e 4f54  3428.        NOT
-00025ca0: 453a 2045 6e74 6572 2027 6327 2061 7420  E: Enter 'c' at 
-00025cb0: 7468 6520 6970 6462 3e20 2070 726f 6d70  the ipdb>  promp
-00025cc0: 7420 746f 2063 6f6e 7469 6e75 6520 6578  t to continue ex
-00025cd0: 6563 7574 696f 6e2e 0a20 2020 2020 2020  ecution..       
-00025ce0: 203e 203c 7374 7269 6e67 3e28 3129 3c6d   > <string>(1)<m
-00025cf0: 6f64 756c 653e 2829 0a20 2020 2020 2020  odule>().       
-00025d00: 2069 7064 623e 2073 0a20 2020 2020 2020   ipdb> s.       
-00025d10: 202e 2e2e 2e0a 2020 2020 2020 2020 6970   .....        ip
-00025d20: 6462 3e20 6e0a 2020 2020 2020 2020 2e2e  db> n.        ..
-00025d30: 2e2e 0a20 2020 2020 2020 2069 7064 623e  ...        ipdb>
-00025d40: 2070 7269 6e74 2878 290a 2020 2020 2020   print(x).      
-00025d50: 2020 3438 3336 3433 3235 0a20 2020 2020    48364325.     
-00025d60: 2020 2069 7064 623e 2078 203d 206f 732e     ipdb> x = os.
-00025d70: 7061 7468 2e73 6570 0a20 2020 2020 2020  path.sep.       
-00025d80: 205b 5059 464c 5942 595d 2069 6d70 6f72   [PYFLYBY] impor
-00025d90: 7420 6f73 2e70 6174 680a 2020 2020 2020  t os.path.      
-00025da0: 2020 6970 6462 3e20 630a 2020 2020 2020    ipdb> c.      
-00025db0: 2020 2f2f 2f2f 2f0a 2020 2020 2222 222c    /////.    """,
-00025dc0: 2050 5954 484f 4e50 4154 483d 746d 702e   PYTHONPATH=tmp.
-00025dd0: 6469 722c 2066 726f 6e74 656e 643d 6672  dir, frontend=fr
-00025de0: 6f6e 7465 6e64 290a 0a23 2054 4f44 4f3a  ontend)..# TODO:
-00025df0: 2074 6573 7420 656d 6265 6464 6564 206d   test embedded m
-00025e00: 6f64 652e 2020 536f 6d65 7468 696e 6720  ode.  Something 
-00025e10: 6c69 6b65 2074 6869 733a 0a23 2020 2020  like this:.#    
-00025e20: 2020 2020 203e 3e3e 2073 7973 203d 2038       >>> sys = 8
-00025e30: 3631 3736 3130 340a 2320 2020 2020 2020  6176104.#       
-00025e40: 2020 3e3e 3e20 696d 706f 7274 2049 5079    >>> import IPy
-00025e50: 7468 6f6e 0a23 2020 2020 2020 2020 203e  thon.#         >
-00025e60: 3e3e 2049 5079 7468 6f6e 2e65 6d62 6564  >> IPython.embed
-00025e70: 2829 0a23 2020 2020 2020 2020 202e 2e2e  ().#         ...
-00025e80: 2e0a 2320 2020 2020 2020 2020 496e 205b  ..#         In [
-00025e90: 315d 3a20 696d 706f 7274 2070 7966 6c79  1]: import pyfly
-00025ea0: 6279 0a23 2020 2020 2020 2020 2049 6e20  by.#         In 
-00025eb0: 5b32 5d3a 2070 7966 6c79 6279 2e65 6e61  [2]: pyflyby.ena
-00025ec0: 626c 655f 6175 746f 5f69 6d70 6f72 7465  ble_auto_importe
-00025ed0: 7228 290a 2320 2020 2020 2020 2020 496e  r().#         In
-00025ee0: 205b 335d 3a20 6236 3464 6563 6f64 6528   [3]: b64decode(
-00025ef0: 2263 4739 3362 6d46 7322 290a 2320 2020  "cG93bmFs").#   
-00025f00: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
-00025f10: 6672 6f6d 2062 6173 6536 3420 696d 706f  from base64 impo
-00025f20: 7274 2062 3634 6465 636f 6465 0a23 2020  rt b64decode.#  
-00025f30: 2020 2020 2020 204f 7574 5b33 5d3a 2062         Out[3]: b
-00025f40: 2770 6f77 6e61 6c27 0a23 2020 2020 2020  'pownal'.#      
-00025f50: 2020 2049 6e20 5b34 5d3a 2073 7973 0a23     In [4]: sys.#
-00025f60: 2020 2020 2020 2020 204f 7574 5b34 5d3a           Out[4]:
-00025f70: 2038 3631 3736 3130 340a 2320 2020 2020   86176104.#     
-00025f80: 2020 2020 496e 205b 355d 3a20 6578 6974      In [5]: exit
-00025f90: 2829 0a23 2020 2020 2020 2020 203e 3e3e  ().#         >>>
-00025fa0: 2062 3634 6465 636f 6465 2822 2e2e 2e22   b64decode("..."
-00025fb0: 290a 2320 2020 2020 2020 2020 2e2e 2e0a  ).#         ....
-00025fc0: 2320 2020 2020 2020 2020 3e3e 3e20 6236  #         >>> b6
-00025fd0: 3465 6e63 6f64 6528 6222 2e2e 2e22 290a  4encode(b"...").
-00025fe0: 2320 2020 2020 2020 2020 4e61 6d65 4572  #         NameEr
-00025ff0: 726f 723a 202e 2e2e 0a0a 2320 544f 444f  ror: .....# TODO
-00026000: 3a20 6164 6420 7465 7374 7320 666f 7220  : add tests for 
-00026010: 7768 656e 2049 5079 7468 6f6e 2069 7320  when IPython is 
-00026020: 6e6f 7420 696e 7374 616c 6c65 642e 2020  not installed.  
-00026030: 6569 7468 6572 2075 7369 6e67 2061 2074  either using a t
-00026040: 6f78 0a23 2065 6e76 6972 6f6e 6d65 6e74  ox.# environment
-00026050: 2c20 6f72 2075 7369 6e67 2061 2050 5954  , or using a PYT
-00026060: 484f 4e50 4154 4820 7468 6174 2073 6861  HONPATH that sha
-00026070: 646f 7773 2049 5079 7468 6f6e 2077 6974  dows IPython wit
-00026080: 6820 736f 6d65 7468 696e 670a 2320 756e  h something.# un
-00026090: 696d 706f 7274 6162 6c65 2e0a 0a0a 4070  importable....@p
-000260a0: 7974 6573 742e 6d61 726b 2e73 6b69 7069  ytest.mark.skipi
-000260b0: 6628 0a20 2020 205f 4950 5954 484f 4e5f  f(.    _IPYTHON_
-000260c0: 5645 5253 494f 4e20 3c20 2837 2c20 3029  VERSION < (7, 0)
-000260d0: 206f 7220 2873 7973 2e76 6572 7369 6f6e   or (sys.version
-000260e0: 5f69 6e66 6f20 3c20 2833 2c20 3729 292c  _info < (3, 7)),
-000260f0: 0a20 2020 2072 6561 736f 6e3d 226f 6c64  .    reason="old
-00026100: 2049 5079 7468 6f6e 2061 6e64 2050 7974   IPython and Pyt
-00026110: 686f 6e20 776f 6e27 7420 776f 726b 2077  hon won't work w
-00026120: 6974 6820 6272 6561 6b70 6f69 6e74 2829  ith breakpoint()
-00026130: 222c 0a29 0a40 7265 7472 790a 6465 6620  ",.).@retry.def 
-00026140: 7465 7374 5f62 7265 616b 706f 696e 745f  test_breakpoint_
-00026150: 494f 5374 7265 616d 5f62 726f 6b65 6e28  IOStream_broken(
-00026160: 293a 0a20 2020 2023 2056 6572 6966 7920  ):.    # Verify 
-00026170: 7468 6174 2073 7465 7020 6675 6e63 7469  that step functi
-00026180: 6f6e 616c 6974 7920 6973 6e27 7420 6272  onality isn't br
-00026190: 6f6b 656e 2e0a 2020 2020 6970 7974 686f  oken..    ipytho
-000261a0: 6e28 0a20 2020 2020 2020 2027 2727 0a20  n(.        '''. 
-000261b0: 2020 2020 2020 2049 6e20 5b31 5d3a 2062         In [1]: b
-000261c0: 7265 616b 706f 696e 7428 290a 2020 2020  reakpoint().    
-000261d0: 2020 2020 2d2d 4361 6c6c 2d2d 0a20 2020      --Call--.   
-000261e0: 2020 2020 203e 202e 2e2e 0a20 2020 2020       > ....     
-000261f0: 2020 2020 2020 202e 2e2e 0a20 2020 2020         ....     
-00026200: 2020 2020 2020 202e 2e2e 0a20 2020 2020         ....     
-00026210: 2020 202d 2d3e 202e 2e2e 2020 2020 2064     --> ...     d
-00026220: 6566 205f 5f63 616c 6c5f 5f28 7365 6c66  ef __call__(self
-00026230: 2c20 7265 7375 6c74 3d4e 6f6e 6529 3a0a  , result=None):.
-00026240: 2020 2020 2020 2020 2020 2020 2e2e 2e20              ... 
-00026250: 2020 2020 2020 2020 2222 2250 7269 6e74          """Print
-00026260: 696e 6720 7769 7468 2068 6973 746f 7279  ing with history
-00026270: 2063 6163 6865 206d 616e 6167 656d 656e   cache managemen
-00026280: 742e 0a20 2020 2020 2020 2020 2020 202e  t..            .
-00026290: 2e2e 0a20 2020 2020 2020 2069 7064 623e  ...        ipdb>
-000262a0: 2063 0a20 2020 2027 2727 2c0a 2020 2020   c.    ''',.    
-000262b0: 2020 2020 6672 6f6e 7465 6e64 3d27 7072      frontend='pr
-000262c0: 6f6d 7074 5f74 6f6f 6c6b 6974 272c 0a20  ompt_toolkit',. 
-000262d0: 2020 2029 0a                                ).
+000204b0: 2d0a 2020 2020 2020 2020 4e61 6d65 4572  -.        NameEr
+000204c0: 726f 7220 2020 2020 2020 2020 2020 2020  ror             
+000204d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000204e0: 2020 2020 5472 6163 6562 6163 6b20 286d      Traceback (m
+000204f0: 6f73 7420 7265 6365 6e74 2063 616c 6c20  ost recent call 
+00020500: 6c61 7374 290a 2020 2020 2020 2020 2e2e  last).        ..
+00020510: 2e20 696e 202e 2e2e 0a20 2020 2020 2020  . in ....       
+00020520: 204e 616d 6545 7272 6f72 3a20 6e61 6d65   NameError: name
+00020530: 2027 6236 3465 6e63 6f64 6527 2069 7320   'b64encode' is 
+00020540: 6e6f 7420 6465 6669 6e65 640a 2020 2020  not defined.    
+00020550: 2020 2020 496e 205b 345d 3a20 6236 3464      In [4]: b64d
+00020560: 6563 6f64 6528 2759 6e56 3064 4756 7962  ecode('YnV0dGVyb
+00020570: 6e56 3027 290a 2020 2020 2020 2020 4f75  nV0').        Ou
+00020580: 745b 345d 3a20 6227 6275 7474 6572 6e75  t[4]: b'butternu
+00020590: 7427 0a20 2020 2020 2020 2049 6e20 5b35  t'.        In [5
+000205a0: 5d3a 2070 7966 6c79 6279 2e65 6e61 626c  ]: pyflyby.enabl
+000205b0: 655f 6175 746f 5f69 6d70 6f72 7465 7228  e_auto_importer(
+000205c0: 290a 2020 2020 2020 2020 496e 205b 365d  ).        In [6]
+000205d0: 3a20 6236 3465 6e63 6f64 6528 6227 6c61  : b64encode(b'la
+000205e0: 7263 6827 290a 2020 2020 2020 2020 5b50  rch').        [P
+000205f0: 5946 4c59 4259 5d20 6672 6f6d 2062 6173  YFLYBY] from bas
+00020600: 6536 3420 696d 706f 7274 2062 3634 656e  e64 import b64en
+00020610: 636f 6465 0a20 2020 2020 2020 204f 7574  code.        Out
+00020620: 5b36 5d3a 2062 2762 4746 7959 3267 3d27  [6]: b'bGFyY2g='
+00020630: 0a20 2020 2022 2222 2c0a 2020 2020 2020  .    """,.      
+00020640: 2020 7072 6f67 3d22 7079 222c 0a20 2020    prog="py",.   
+00020650: 2020 2020 2069 7079 7468 6f6e 5f64 6972       ipython_dir
+00020660: 3d74 6d70 2e69 7079 7468 6f6e 5f64 6972  =tmp.ipython_dir
+00020670: 2c0a 2020 2020 290a 0a0a 4070 7974 6573  ,.    )...@pytes
+00020680: 742e 6d61 726b 2e73 6b69 7069 6628 0a20  t.mark.skipif(. 
+00020690: 2020 205f 4950 5954 484f 4e5f 5645 5253     _IPYTHON_VERS
+000206a0: 494f 4e20 3c20 2830 2c20 3132 292c 0a20  ION < (0, 12),. 
+000206b0: 2020 2072 6561 736f 6e3d 226f 6c64 2049     reason="old I
+000206c0: 5079 7468 6f6e 2064 6f65 736e 2774 2073  Python doesn't s
+000206d0: 7570 706f 7274 2073 7461 7274 7570 2064  upport startup d
+000206e0: 6972 6563 746f 7279 2229 0a40 7265 7472  irectory").@retr
+000206f0: 790a 6465 6620 7465 7374 5f6d 616e 7561  y.def test_manua
+00020700: 6c5f 696e 7374 616c 6c5f 7072 6f66 696c  l_install_profil
+00020710: 655f 7374 6172 7475 705f 3128 746d 7029  e_startup_1(tmp)
+00020720: 3a0a 2020 2020 2320 5465 7374 2074 6861  :.    # Test tha
+00020730: 7420 6d61 6e75 616c 6c79 2069 6e73 7461  t manually insta
+00020740: 6c6c 696e 6720 746f 2074 6865 2073 7461  lling to the sta
+00020750: 7274 7570 2066 6f6c 6465 7220 776f 726b  rtup folder work
+00020760: 732e 0a20 2020 2077 7269 7465 7465 7874  s..    writetext
+00020770: 2874 6d70 2e69 7079 7468 6f6e 5f64 6972  (tmp.ipython_dir
+00020780: 2f22 7072 6f66 696c 655f 6465 6661 756c  /"profile_defaul
+00020790: 742f 7374 6172 7475 702f 666f 6f2e 7079  t/startup/foo.py
+000207a0: 222c 2022 2222 0a20 2020 2020 2020 205f  ", """.        _
+000207b0: 5f69 6d70 6f72 745f 5f28 2270 7966 6c79  _import__("pyfly
+000207c0: 6279 2229 2e65 6e61 626c 655f 6175 746f  by").enable_auto
+000207d0: 5f69 6d70 6f72 7465 7228 290a 2020 2020  _importer().    
+000207e0: 2222 2229 0a20 2020 2069 7079 7468 6f6e  """).    ipython
+000207f0: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
+00020800: 5b31 5d3a 2062 3634 6465 636f 5c74 6465  [1]: b64deco\tde
+00020810: 2827 5a47 3932 5a51 3d3d 2729 0a20 2020  ('ZG92ZQ==').   
+00020820: 2020 2020 205b 5059 464c 5942 595d 2066       [PYFLYBY] f
+00020830: 726f 6d20 6261 7365 3634 2069 6d70 6f72  rom base64 impor
+00020840: 7420 6236 3464 6563 6f64 650a 2020 2020  t b64decode.    
+00020850: 2020 2020 4f75 745b 315d 3a20 6227 646f      Out[1]: b'do
+00020860: 7665 270a 2020 2020 2222 222c 2069 7079  ve'.    """, ipy
+00020870: 7468 6f6e 5f64 6972 3d74 6d70 2e69 7079  thon_dir=tmp.ipy
+00020880: 7468 6f6e 5f64 6972 290a 0a0a 4070 7974  thon_dir)...@pyt
+00020890: 6573 742e 6d61 726b 2e73 6b69 7069 6628  est.mark.skipif(
+000208a0: 0a20 2020 205f 4950 5954 484f 4e5f 5645  .    _IPYTHON_VE
+000208b0: 5253 494f 4e20 3c20 2830 2c20 3131 292c  RSION < (0, 11),
+000208c0: 0a20 2020 2072 6561 736f 6e3d 226f 6c64  .    reason="old
+000208d0: 2049 5079 7468 6f6e 2064 6f65 736e 2774   IPython doesn't
+000208e0: 2073 7570 706f 7274 2069 7079 7468 6f6e   support ipython
+000208f0: 5f63 6f6e 6669 672e 7079 2229 0a40 7265  _config.py").@re
+00020900: 7472 790a 6465 6620 7465 7374 5f6d 616e  try.def test_man
+00020910: 7561 6c5f 696e 7374 616c 6c5f 6970 7974  ual_install_ipyt
+00020920: 686f 6e5f 636f 6e66 6967 5f64 6972 6563  hon_config_direc
+00020930: 745f 3128 746d 7029 3a0a 2020 2020 2320  t_1(tmp):.    # 
+00020940: 5665 7269 6679 2074 6861 7420 6d61 6e75  Verify that manu
+00020950: 616c 6c79 2069 6e73 7461 6c6c 696e 6720  ally installing 
+00020960: 696e 2069 7079 7468 6f6e 5f63 6f6e 6669  in ipython_confi
+00020970: 672e 7079 2077 6f72 6b73 2077 6865 6e20  g.py works when 
+00020980: 656e 6162 6c69 6e67 0a20 2020 2023 2061  enabling.    # a
+00020990: 7420 746f 7020 6c65 7665 6c2e 0a20 2020  t top level..   
+000209a0: 2077 7269 7465 7465 7874 2874 6d70 2e69   writetext(tmp.i
+000209b0: 7079 7468 6f6e 5f64 6972 2f22 7072 6f66  python_dir/"prof
+000209c0: 696c 655f 6465 6661 756c 742f 6970 7974  ile_default/ipyt
+000209d0: 686f 6e5f 636f 6e66 6967 2e70 7922 2c20  hon_config.py", 
+000209e0: 2222 220a 2020 2020 2020 2020 5f5f 696d  """.        __im
+000209f0: 706f 7274 5f5f 2822 7079 666c 7962 7922  port__("pyflyby"
+00020a00: 292e 656e 6162 6c65 5f61 7574 6f5f 696d  ).enable_auto_im
+00020a10: 706f 7274 6572 2829 0a20 2020 2022 2222  porter().    """
+00020a20: 2c20 6d6f 6465 3d27 6127 290a 2020 2020  , mode='a').    
+00020a30: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
+00020a40: 2020 2020 496e 205b 315d 3a20 6236 3464      In [1]: b64d
+00020a50: 6563 6f5c 7464 6528 2761 4856 7462 576c  eco\tde('aHVtbWl
+00020a60: 755a 324a 7063 6d51 3d27 290a 2020 2020  uZ2JpcmQ=').    
+00020a70: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
+00020a80: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
+00020a90: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
+00020aa0: 2020 204f 7574 5b31 5d3a 2062 2768 756d     Out[1]: b'hum
+00020ab0: 6d69 6e67 6269 7264 270a 2020 2020 2222  mingbird'.    ""
+00020ac0: 222c 2069 7079 7468 6f6e 5f64 6972 3d74  ", ipython_dir=t
+00020ad0: 6d70 2e69 7079 7468 6f6e 5f64 6972 290a  mp.ipython_dir).
+00020ae0: 0a0a 4070 7974 6573 742e 6d61 726b 2e73  ..@pytest.mark.s
+00020af0: 6b69 7069 6628 0a20 2020 205f 4950 5954  kipif(.    _IPYT
+00020b00: 484f 4e5f 5645 5253 494f 4e20 3c20 2830  HON_VERSION < (0
+00020b10: 2c20 3131 292c 0a20 2020 2072 6561 736f  , 11),.    reaso
+00020b20: 6e3d 226f 6c64 2049 5079 7468 6f6e 2064  n="old IPython d
+00020b30: 6f65 736e 2774 2073 7570 706f 7274 2069  oesn't support i
+00020b40: 7079 7468 6f6e 5f63 6f6e 6669 672e 7079  python_config.py
+00020b50: 2229 0a40 7265 7472 790a 6465 6620 7465  ").@retry.def te
+00020b60: 7374 5f6d 616e 7561 6c5f 696e 7374 616c  st_manual_instal
+00020b70: 6c5f 6578 6563 5f6c 696e 6573 5f31 2874  l_exec_lines_1(t
+00020b80: 6d70 293a 0a20 2020 2077 7269 7465 7465  mp):.    writete
+00020b90: 7874 2874 6d70 2e69 7079 7468 6f6e 5f64  xt(tmp.ipython_d
+00020ba0: 6972 2f22 7072 6f66 696c 655f 6465 6661  ir/"profile_defa
+00020bb0: 756c 742f 6970 7974 686f 6e5f 636f 6e66  ult/ipython_conf
+00020bc0: 6967 2e70 7922 2c20 2222 220a 2020 2020  ig.py", """.    
+00020bd0: 2020 2020 6320 3d20 6765 745f 636f 6e66      c = get_conf
+00020be0: 6967 2829 0a20 2020 2020 2020 2063 2e49  ig().        c.I
+00020bf0: 6e74 6572 6163 7469 7665 5368 656c 6c41  nteractiveShellA
+00020c00: 7070 2e65 7865 635f 6c69 6e65 7320 3d20  pp.exec_lines = 
+00020c10: 5b0a 2020 2020 2020 2020 2020 2020 275f  [.            '_
+00020c20: 5f69 6d70 6f72 745f 5f28 2270 7966 6c79  _import__("pyfly
+00020c30: 6279 2229 2e65 6e61 626c 655f 6175 746f  by").enable_auto
+00020c40: 5f69 6d70 6f72 7465 7228 2927 2c0a 2020  _importer()',.  
+00020c50: 2020 2020 2020 5d0a 2020 2020 2222 222c        ].    """,
+00020c60: 206d 6f64 653d 2761 2729 0a20 2020 2069   mode='a').    i
+00020c70: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
+00020c80: 2020 2049 6e20 5b31 5d3a 2062 3634 6465     In [1]: b64de
+00020c90: 636f 5c74 6465 2827 6332 5668 5a33 5673  co\tde('c2VhZ3Vs
+00020ca0: 6241 3d3d 2729 0a20 2020 2020 2020 205b  bA==').        [
+00020cb0: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
+00020cc0: 7365 3634 2069 6d70 6f72 7420 6236 3464  se64 import b64d
+00020cd0: 6563 6f64 650a 2020 2020 2020 2020 4f75  ecode.        Ou
+00020ce0: 745b 315d 3a20 6227 7365 6167 756c 6c27  t[1]: b'seagull'
+00020cf0: 0a20 2020 2022 2222 2c20 6970 7974 686f  .    """, ipytho
+00020d00: 6e5f 6469 723d 746d 702e 6970 7974 686f  n_dir=tmp.ipytho
+00020d10: 6e5f 6469 7229 0a0a 0a40 7079 7465 7374  n_dir)...@pytest
+00020d20: 2e6d 6172 6b2e 736b 6970 6966 280a 2020  .mark.skipif(.  
+00020d30: 2020 5f49 5059 5448 4f4e 5f56 4552 5349    _IPYTHON_VERSI
+00020d40: 4f4e 203c 2028 302c 2031 3129 2c0a 2020  ON < (0, 11),.  
+00020d50: 2020 7265 6173 6f6e 3d22 6f6c 6420 4950    reason="old IP
+00020d60: 7974 686f 6e20 646f 6573 6e27 7420 7375  ython doesn't su
+00020d70: 7070 6f72 7420 6970 7974 686f 6e5f 636f  pport ipython_co
+00020d80: 6e66 6967 2e70 7922 290a 4072 6574 7279  nfig.py").@retry
+00020d90: 0a64 6566 2074 6573 745f 6d61 6e75 616c  .def test_manual
+00020da0: 5f69 6e73 7461 6c6c 5f65 7865 635f 6669  _install_exec_fi
+00020db0: 6c65 735f 3128 746d 7029 3a0a 2020 2020  les_1(tmp):.    
+00020dc0: 7772 6974 6574 6578 7428 746d 702e 6669  writetext(tmp.fi
+00020dd0: 6c65 2c20 2222 220a 2020 2020 2020 2020  le, """.        
+00020de0: 696d 706f 7274 2070 7966 6c79 6279 0a20  import pyflyby. 
+00020df0: 2020 2020 2020 2070 7966 6c79 6279 2e65         pyflyby.e
+00020e00: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+00020e10: 7465 7228 290a 2020 2020 2222 2229 0a20  ter().    """). 
+00020e20: 2020 2077 7269 7465 7465 7874 2874 6d70     writetext(tmp
+00020e30: 2e69 7079 7468 6f6e 5f64 6972 2f22 7072  .ipython_dir/"pr
+00020e40: 6f66 696c 655f 6465 6661 756c 742f 6970  ofile_default/ip
+00020e50: 7974 686f 6e5f 636f 6e66 6967 2e70 7922  ython_config.py"
+00020e60: 2c20 2222 220a 2020 2020 2020 2020 6320  , """.        c 
+00020e70: 3d20 6765 745f 636f 6e66 6967 2829 0a20  = get_config(). 
+00020e80: 2020 2020 2020 2063 2e49 6e74 6572 6163         c.Interac
+00020e90: 7469 7665 5368 656c 6c41 7070 2e65 7865  tiveShellApp.exe
+00020ea0: 635f 6669 6c65 7320 3d20 5b25 725d 0a20  c_files = [%r]. 
+00020eb0: 2020 2022 2222 2025 2028 7374 7228 746d     """ % (str(tm
+00020ec0: 702e 6669 6c65 292c 292c 206d 6f64 653d  p.file),), mode=
+00020ed0: 2761 2729 0a20 2020 2069 7079 7468 6f6e  'a').    ipython
+00020ee0: 2822 2222 0a20 2020 2020 2020 2049 6e20  (""".        In 
+00020ef0: 5b31 5d3a 2062 3634 6465 636f 5c74 6465  [1]: b64deco\tde
+00020f00: 2827 5933 566a 6132 3976 2729 0a20 2020  ('Y3Vja29v').   
+00020f10: 2020 2020 205b 5059 464c 5942 595d 2066       [PYFLYBY] f
+00020f20: 726f 6d20 6261 7365 3634 2069 6d70 6f72  rom base64 impor
+00020f30: 7420 6236 3464 6563 6f64 650a 2020 2020  t b64decode.    
+00020f40: 2020 2020 4f75 745b 315d 3a20 6227 6375      Out[1]: b'cu
+00020f50: 636b 6f6f 270a 2020 2020 2222 222c 2069  ckoo'.    """, i
+00020f60: 7079 7468 6f6e 5f64 6972 3d74 6d70 2e69  python_dir=tmp.i
+00020f70: 7079 7468 6f6e 5f64 6972 290a 0a0a 4070  python_dir)...@p
+00020f80: 7974 6573 742e 6d61 726b 2e73 6b69 7069  ytest.mark.skipi
+00020f90: 6628 0a20 2020 205f 4950 5954 484f 4e5f  f(.    _IPYTHON_
+00020fa0: 5645 5253 494f 4e20 3e3d 2028 302c 2031  VERSION >= (0, 1
+00020fb0: 3129 2c0a 2020 2020 7265 6173 6f6e 3d22  1),.    reason="
+00020fc0: 4950 7974 686f 6e20 302e 3131 2b20 646f  IPython 0.11+ do
+00020fd0: 6573 6e27 7420 7375 7070 6f72 7420 6970  esn't support ip
+00020fe0: 7974 686f 6e72 6322 290a 4072 6574 7279  ythonrc").@retry
+00020ff0: 0a64 6566 2074 6573 745f 6d61 6e75 616c  .def test_manual
+00021000: 5f69 6e73 7461 6c6c 5f69 7079 7468 6f6e  _install_ipython
+00021010: 7263 5f65 7865 6375 7465 5f31 2874 6d70  rc_execute_1(tmp
+00021020: 293a 0a20 2020 2077 7269 7465 7465 7874  ):.    writetext
+00021030: 2874 6d70 2e69 7079 7468 6f6e 5f64 6972  (tmp.ipython_dir
+00021040: 2f22 6970 7974 686f 6e72 6322 2c20 2222  /"ipythonrc", ""
+00021050: 220a 2020 2020 2020 2020 6578 6563 7574  ".        execut
+00021060: 6520 5f5f 696d 706f 7274 5f5f 2822 7079  e __import__("py
+00021070: 666c 7962 7922 292e 656e 6162 6c65 5f61  flyby").enable_a
+00021080: 7574 6f5f 696d 706f 7274 6572 2829 0a20  uto_importer(). 
+00021090: 2020 2022 2222 2c20 6d6f 6465 3d27 6127     """, mode='a'
+000210a0: 290a 2020 2020 6970 7974 686f 6e28 2222  ).    ipython(""
+000210b0: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
+000210c0: 3a20 6236 3464 6563 6f5c 7464 6528 2763  : b64deco\tde('c
+000210d0: 4756 755a 3356 7062 673d 3d27 290a 2020  GVuZ3Vpbg==').  
+000210e0: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
+000210f0: 6672 6f6d 2062 6173 6536 3420 696d 706f  from base64 impo
+00021100: 7274 2062 3634 6465 636f 6465 0a20 2020  rt b64decode.   
+00021110: 2020 2020 204f 7574 5b31 5d3a 2062 2770       Out[1]: b'p
+00021120: 656e 6775 696e 270a 2020 2020 2222 222c  enguin'.    """,
+00021130: 2069 7079 7468 6f6e 5f64 6972 3d74 6d70   ipython_dir=tmp
+00021140: 2e69 7079 7468 6f6e 5f64 6972 290a 0a0a  .ipython_dir)...
+00021150: 4070 7974 6573 742e 6d61 726b 2e73 6b69  @pytest.mark.ski
+00021160: 7069 6628 0a20 2020 205f 4950 5954 484f  pif(.    _IPYTHO
+00021170: 4e5f 5645 5253 494f 4e20 3e3d 2028 302c  N_VERSION >= (0,
+00021180: 2031 3129 2c0a 2020 2020 7265 6173 6f6e   11),.    reason
+00021190: 3d22 4950 7974 686f 6e20 302e 3131 2b20  ="IPython 0.11+ 
+000211a0: 646f 6573 6e27 7420 7375 7070 6f72 7420  doesn't support 
+000211b0: 6970 795f 7573 6572 5f63 6f6e 6622 290a  ipy_user_conf").
+000211c0: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
+000211d0: 6d61 6e75 616c 5f69 6e73 7461 6c6c 5f69  manual_install_i
+000211e0: 7079 5f75 7365 725f 636f 6e66 5f31 2874  py_user_conf_1(t
+000211f0: 6d70 293a 0a20 2020 2077 7269 7465 7465  mp):.    writete
+00021200: 7874 2874 6d70 2e69 7079 7468 6f6e 5f64  xt(tmp.ipython_d
+00021210: 6972 2f22 6970 795f 7573 6572 5f63 6f6e  ir/"ipy_user_con
+00021220: 662e 7079 222c 2022 2222 0a20 2020 2020  f.py", """.     
+00021230: 2020 2069 6d70 6f72 7420 7079 666c 7962     import pyflyb
+00021240: 790a 2020 2020 2020 2020 7079 666c 7962  y.        pyflyb
+00021250: 792e 656e 6162 6c65 5f61 7574 6f5f 696d  y.enable_auto_im
+00021260: 706f 7274 6572 2829 0a20 2020 2022 2222  porter().    """
+00021270: 290a 2020 2020 6970 7974 686f 6e28 2222  ).    ipython(""
+00021280: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
+00021290: 3a20 6236 3464 6563 6f5c 7464 6528 2762  : b64deco\tde('b
+000212a0: 4739 7662 673d 3d27 290a 2020 2020 2020  G9vbg==').      
+000212b0: 2020 5b50 5946 4c59 4259 5d20 6672 6f6d    [PYFLYBY] from
+000212c0: 2062 6173 6536 3420 696d 706f 7274 2062   base64 import b
+000212d0: 3634 6465 636f 6465 0a20 2020 2020 2020  64decode.       
+000212e0: 204f 7574 5b31 5d3a 2062 276c 6f6f 6e27   Out[1]: b'loon'
+000212f0: 0a20 2020 2022 2222 2c20 6970 7974 686f  .    """, ipytho
+00021300: 6e5f 6469 723d 746d 702e 6970 7974 686f  n_dir=tmp.ipytho
+00021310: 6e5f 6469 7229 0a0a 0a40 7079 7465 7374  n_dir)...@pytest
+00021320: 2e6d 6172 6b2e 736b 6970 6966 280a 2020  .mark.skipif(.  
+00021330: 2020 2830 2c20 3131 2920 3c3d 205f 4950    (0, 11) <= _IP
+00021340: 5954 484f 4e5f 5645 5253 494f 4e20 3c20  YTHON_VERSION < 
+00021350: 2830 2c20 3132 292c 0a20 2020 2072 6561  (0, 12),.    rea
+00021360: 736f 6e3d 2249 5079 7468 6f6e 2030 2e31  son="IPython 0.1
+00021370: 3120 646f 6573 6e27 7420 7375 7070 6f72  1 doesn't suppor
+00021380: 7420 2d63 2229 0a40 7265 7472 790a 6465  t -c").@retry.de
+00021390: 6620 7465 7374 5f63 6d64 6c69 6e65 5f65  f test_cmdline_e
+000213a0: 6e61 626c 655f 635f 695f 3128 746d 7029  nable_c_i_1(tmp)
+000213b0: 3a0a 2020 2020 6970 7974 686f 6e28 2222  :.    ipython(""
+000213c0: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
+000213d0: 3a20 6236 3464 6563 6f5c 7464 6528 275a  : b64deco\tde('Z
+000213e0: 6d39 3461 4739 3162 6d51 3d27 290a 2020  m94aG91bmQ=').  
+000213f0: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
+00021400: 6672 6f6d 2062 6173 6536 3420 696d 706f  from base64 impo
+00021410: 7274 2062 3634 6465 636f 6465 0a20 2020  rt b64decode.   
+00021420: 2020 2020 204f 7574 5b31 5d3a 2062 2766       Out[1]: b'f
+00021430: 6f78 686f 756e 6427 0a20 2020 2022 2222  oxhound'.    """
+00021440: 2c20 6172 6773 3d5b 272d 6327 2c20 2769  , args=['-c', 'i
+00021450: 6d70 6f72 7420 7079 666c 7962 793b 2070  mport pyflyby; p
+00021460: 7966 6c79 6279 2e65 6e61 626c 655f 6175  yflyby.enable_au
+00021470: 746f 5f69 6d70 6f72 7465 7228 2927 2c20  to_importer()', 
+00021480: 272d 6927 5d29 0a0a 0a40 7079 7465 7374  '-i'])...@pytest
+00021490: 2e6d 6172 6b2e 736b 6970 6966 280a 2020  .mark.skipif(.  
+000214a0: 2020 5f49 5059 5448 4f4e 5f56 4552 5349    _IPYTHON_VERSI
+000214b0: 4f4e 203c 2028 302c 2031 3129 2c0a 2020  ON < (0, 11),.  
+000214c0: 2020 7265 6173 6f6e 3d22 6f6c 6420 4950    reason="old IP
+000214d0: 7974 686f 6e20 646f 6573 6e27 7420 7375  ython doesn't su
+000214e0: 7070 6f72 7420 496e 7465 7261 6374 6976  pport Interactiv
+000214f0: 6553 6865 6c6c 4170 7020 636f 6e66 6967  eShellApp config
+00021500: 2229 0a40 7265 7472 790a 6465 6620 7465  ").@retry.def te
+00021510: 7374 5f63 6d64 6c69 6e65 5f65 6e61 626c  st_cmdline_enabl
+00021520: 655f 636f 6465 5f74 6f5f 7275 6e5f 695f  e_code_to_run_i_
+00021530: 3128 746d 7029 3a0a 2020 2020 6970 7974  1(tmp):.    ipyt
+00021540: 686f 6e28 2222 220a 2020 2020 2020 2020  hon(""".        
+00021550: 496e 205b 315d 3a20 6236 3464 6563 6f5c  In [1]: b64deco\
+00021560: 7464 6528 2763 6d39 3064 4864 6c61 5778  tde('cm90dHdlaWx
+00021570: 6c63 673d 3d27 290a 2020 2020 2020 2020  lcg==').        
+00021580: 5b50 5946 4c59 4259 5d20 6672 6f6d 2062  [PYFLYBY] from b
+00021590: 6173 6536 3420 696d 706f 7274 2062 3634  ase64 import b64
+000215a0: 6465 636f 6465 0a20 2020 2020 2020 204f  decode.        O
+000215b0: 7574 5b31 5d3a 2062 2772 6f74 7477 6569  ut[1]: b'rottwei
+000215c0: 6c65 7227 0a20 2020 2022 2222 2c20 6172  ler'.    """, ar
+000215d0: 6773 3d5b 272d 2d49 6e74 6572 6163 7469  gs=['--Interacti
+000215e0: 7665 5368 656c 6c41 7070 2e63 6f64 655f  veShellApp.code_
+000215f0: 746f 5f72 756e 3d27 0a20 2020 2020 2020  to_run='.       
+00021600: 2020 2020 2020 2020 2769 6d70 6f72 7420          'import 
+00021610: 7079 666c 7962 793b 2070 7966 6c79 6279  pyflyby; pyflyby
+00021620: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
+00021630: 6f72 7465 7228 2927 2c20 272d 6927 5d29  orter()', '-i'])
+00021640: 0a0a 0a40 7079 7465 7374 2e6d 6172 6b2e  ...@pytest.mark.
+00021650: 736b 6970 6966 280a 2020 2020 5f49 5059  skipif(.    _IPY
+00021660: 5448 4f4e 5f56 4552 5349 4f4e 203c 2028  THON_VERSION < (
+00021670: 302c 2031 3129 2c0a 2020 2020 7265 6173  0, 11),.    reas
+00021680: 6f6e 3d22 6f6c 6420 4950 7974 686f 6e20  on="old IPython 
+00021690: 646f 6573 6e27 7420 7375 7070 6f72 7420  doesn't support 
+000216a0: 496e 7465 7261 6374 6976 6553 6865 6c6c  InteractiveShell
+000216b0: 4170 7020 636f 6e66 6967 2229 0a40 7265  App config").@re
+000216c0: 7472 790a 6465 6620 7465 7374 5f63 6d64  try.def test_cmd
+000216d0: 6c69 6e65 5f65 6e61 626c 655f 6578 6563  line_enable_exec
+000216e0: 5f6c 696e 6573 5f31 2874 6d70 293a 0a20  _lines_1(tmp):. 
+000216f0: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
+00021700: 2020 2020 2020 2049 6e20 5b31 5d3a 2062         In [1]: b
+00021710: 3634 6465 636f 5c74 6465 2827 6347 3976  64deco\tde('cG9v
+00021720: 5a47 786c 2729 0a20 2020 2020 2020 205b  ZGxl').        [
+00021730: 5059 464c 5942 595d 2066 726f 6d20 6261  PYFLYBY] from ba
+00021740: 7365 3634 2069 6d70 6f72 7420 6236 3464  se64 import b64d
+00021750: 6563 6f64 650a 2020 2020 2020 2020 4f75  ecode.        Ou
+00021760: 745b 315d 3a20 6227 706f 6f64 6c65 270a  t[1]: b'poodle'.
+00021770: 2020 2020 2222 222c 2061 7267 733d 5b0a      """, args=[.
+00021780: 2020 2020 2020 2020 272d 2d49 6e74 6572          '--Inter
+00021790: 6163 7469 7665 5368 656c 6c41 7070 2e65  activeShellApp.e
+000217a0: 7865 635f 6c69 6e65 733d 270a 2020 2020  xec_lines='.    
+000217b0: 2020 2020 2727 275b 225f 5f69 6d70 6f72      '''["__impor
+000217c0: 745f 5f28 2770 7966 6c79 6279 2729 2e65  t__('pyflyby').e
+000217d0: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+000217e0: 7465 7228 2922 5d27 2727 5d29 0a0a 0a40  ter()"]'''])...@
+000217f0: 7079 7465 7374 2e6d 6172 6b2e 736b 6970  pytest.mark.skip
+00021800: 6966 280a 2020 2020 5f49 5059 5448 4f4e  if(.    _IPYTHON
+00021810: 5f56 4552 5349 4f4e 203c 2028 302c 2031  _VERSION < (0, 1
+00021820: 3129 2c0a 2020 2020 7265 6173 6f6e 3d22  1),.    reason="
+00021830: 6f6c 6420 4950 7974 686f 6e20 646f 6573  old IPython does
+00021840: 6e27 7420 7375 7070 6f72 7420 496e 7465  n't support Inte
+00021850: 7261 6374 6976 6553 6865 6c6c 4170 7020  ractiveShellApp 
+00021860: 636f 6e66 6967 2229 0a64 6566 2074 6573  config").def tes
+00021870: 745f 636d 646c 696e 655f 656e 6162 6c65  t_cmdline_enable
+00021880: 5f65 7865 635f 6669 6c65 735f 3128 746d  _exec_files_1(tm
+00021890: 7029 3a0a 2020 2020 7772 6974 6574 6578  p):.    writetex
+000218a0: 7428 746d 702e 6669 6c65 2c20 2222 220a  t(tmp.file, """.
+000218b0: 2020 2020 2020 2020 696d 706f 7274 2070          import p
+000218c0: 7966 6c79 6279 0a20 2020 2020 2020 2070  yflyby.        p
+000218d0: 7966 6c79 6279 2e65 6e61 626c 655f 6175  yflyby.enable_au
+000218e0: 746f 5f69 6d70 6f72 7465 7228 290a 2020  to_importer().  
+000218f0: 2020 2222 2229 0a20 2020 2069 7079 7468    """).    ipyth
+00021900: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
+00021910: 6e20 5b31 5d3a 2062 3634 6465 636f 5c74  n [1]: b64deco\t
+00021920: 6465 2827 5933 566a 6132 3976 2729 0a20  de('Y3Vja29v'). 
+00021930: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+00021940: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
+00021950: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
+00021960: 2020 2020 2020 4f75 745b 315d 3a20 6227        Out[1]: b'
+00021970: 6375 636b 6f6f 270a 2020 2020 2222 222c  cuckoo'.    """,
+00021980: 2061 7267 733d 5b0a 2020 2020 2020 2020   args=[.        
+00021990: 272d 2d49 6e74 6572 6163 7469 7665 5368  '--InteractiveSh
+000219a0: 656c 6c41 7070 2e65 7865 635f 6669 6c65  ellApp.exec_file
+000219b0: 733d 5b25 725d 2720 2520 2873 7472 2874  s=[%r]' % (str(t
+000219c0: 6d70 2e66 696c 6529 2c29 5d29 0a0a 0a40  mp.file),)])...@
+000219d0: 7265 7472 790a 6465 6620 7465 7374 5f64  retry.def test_d
+000219e0: 6562 7567 5f62 6173 656c 696e 655f 3128  ebug_baseline_1(
+000219f0: 6672 6f6e 7465 6e64 293a 0a20 2020 2023  frontend):.    #
+00021a00: 2056 6572 6966 7920 7468 6174 2077 6520   Verify that we 
+00021a10: 6361 6e20 7465 7374 2069 7064 6220 7769  can test ipdb wi
+00021a20: 7468 6f75 7420 616e 7920 7079 666c 7962  thout any pyflyb
+00021a30: 7920 696e 766f 6c76 6564 2e0a 2020 2020  y involved..    
+00021a40: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
+00021a50: 2020 2020 496e 205b 315d 3a20 3832 3331      In [1]: 8231
+00021a60: 3832 3135 2f30 0a20 2020 2020 2020 202e  8215/0.        .
+00021a70: 2e2e 2e0a 2020 2020 2020 2020 5a65 726f  ....        Zero
+00021a80: 4469 7669 7369 6f6e 4572 726f 723a 202e  DivisionError: .
+00021a90: 2e2e 0a20 2020 2020 2020 2049 6e20 5b32  ...        In [2
+00021aa0: 5d3a 2025 6465 6275 670a 2020 2020 2020  ]: %debug.      
+00021ab0: 2020 2e2e 2e2e 0a20 2020 2020 2020 2069    .....        i
+00021ac0: 7064 623e 2070 2034 3334 3035 3732 3820  pdb> p 43405728 
+00021ad0: 2b20 3639 3634 3239 3638 0a20 2020 2020  + 69642968.     
+00021ae0: 2020 2031 3133 3034 3836 3936 0a20 2020     113048696.   
+00021af0: 2020 2020 2069 7064 623e 2071 0a20 2020       ipdb> q.   
+00021b00: 2022 2222 2c20 6672 6f6e 7465 6e64 3d66   """, frontend=f
+00021b10: 726f 6e74 656e 6429 0a0a 0a40 7265 7472  rontend)...@retr
+00021b20: 790a 6465 6620 7465 7374 5f64 6562 7567  y.def test_debug
+00021b30: 5f77 6974 686f 7574 5f61 7574 6f69 6d70  _without_autoimp
+00021b40: 6f72 745f 3128 6672 6f6e 7465 6e64 293a  ort_1(frontend):
+00021b50: 0a20 2020 2023 2056 6572 6966 7920 7468  .    # Verify th
+00021b60: 6174 2077 6974 686f 7574 2061 7574 6f69  at without autoi
+00021b70: 6d70 6f72 742c 2077 6520 6765 7420 6120  mport, we get a 
+00021b80: 4e61 6d65 4572 726f 722e 0a20 2020 2069  NameError..    i
+00021b90: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
+00021ba0: 2020 2049 6e20 5b31 5d3a 2037 3035 3036     In [1]: 70506
+00021bb0: 3335 372f 300a 2020 2020 2020 2020 2e2e  357/0.        ..
+00021bc0: 2e2e 0a20 2020 2020 2020 205a 6572 6f44  ...        ZeroD
+00021bd0: 6976 6973 696f 6e45 7272 6f72 3a20 2e2e  ivisionError: ..
+00021be0: 2e0a 2020 2020 2020 2020 496e 205b 325d  ..        In [2]
+00021bf0: 3a20 2564 6562 7567 0a20 2020 2020 2020  : %debug.       
+00021c00: 202e 2e2e 2e0a 2020 2020 2020 2020 6970   .....        ip
+00021c10: 6462 3e20 7020 6236 3464 6563 6f64 6528  db> p b64decode(
+00021c20: 2251 5856 6b64 574a 7662 673d 3d22 290a  "QXVkdWJvbg==").
+00021c30: 2020 2020 2020 2020 2a2a 2a20 4e61 6d65          *** Name
+00021c40: 4572 726f 723a 206e 616d 6520 2762 3634  Error: name 'b64
+00021c50: 6465 636f 6465 2720 6973 206e 6f74 2064  decode' is not d
+00021c60: 6566 696e 6564 0a20 2020 2020 2020 2069  efined.        i
+00021c70: 7064 623e 2071 0a20 2020 2022 2222 2c20  pdb> q.    """, 
+00021c80: 6672 6f6e 7465 6e64 3d66 726f 6e74 656e  frontend=fronten
+00021c90: 6429 0a0a 0a40 7265 7472 790a 6465 6620  d)...@retry.def 
+00021ca0: 7465 7374 5f64 6562 7567 5f61 7574 6f5f  test_debug_auto_
+00021cb0: 696d 706f 7274 5f70 5f31 2866 726f 6e74  import_p_1(front
+00021cc0: 656e 6429 3a0a 2020 2020 6970 7974 686f  end):.    ipytho
+00021cd0: 6e28 2222 220a 2020 2020 2020 2020 496e  n(""".        In
+00021ce0: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
+00021cf0: 6c79 6279 3b20 7079 666c 7962 792e 656e  lyby; pyflyby.en
+00021d00: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
+00021d10: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
+00021d20: 5b32 5d3a 2031 3738 3339 3233 392f 300a  [2]: 17839239/0.
+00021d30: 2020 2020 2020 2020 2e2e 2e2e 0a20 2020          .....   
+00021d40: 2020 2020 205a 6572 6f44 6976 6973 696f       ZeroDivisio
+00021d50: 6e45 7272 6f72 3a20 2e2e 2e0a 2020 2020  nError: ....    
+00021d60: 2020 2020 496e 205b 335d 3a20 2564 6562      In [3]: %deb
+00021d70: 7567 0a20 2020 2020 2020 202e 2e2e 2e0a  ug.        .....
+00021d80: 2020 2020 2020 2020 6970 6462 3e20 7020          ipdb> p 
+00021d90: 6236 3464 6563 6f64 6528 2253 3256 7563  b64decode("S2Vuc
+00021da0: 326c 755a 3352 7662 673d 3d22 290a 2020  2luZ3Rvbg==").  
+00021db0: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
+00021dc0: 6672 6f6d 2062 6173 6536 3420 696d 706f  from base64 impo
+00021dd0: 7274 2062 3634 6465 636f 6465 0a20 2020  rt b64decode.   
+00021de0: 2020 2020 2062 274b 656e 7369 6e67 746f       b'Kensingto
+00021df0: 6e27 0a20 2020 2020 2020 2069 7064 623e  n'.        ipdb>
+00021e00: 2071 0a20 2020 2022 2222 2c20 6672 6f6e   q.    """, fron
+00021e10: 7465 6e64 3d66 726f 6e74 656e 6429 0a0a  tend=frontend)..
+00021e20: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
+00021e30: 5f64 6562 7567 5f61 7574 6f5f 696d 706f  _debug_auto_impo
+00021e40: 7274 5f70 705f 3128 6672 6f6e 7465 6e64  rt_pp_1(frontend
+00021e50: 293a 0a20 2020 2023 2056 6572 6966 7920  ):.    # Verify 
+00021e60: 7468 6174 2061 7574 6f20 696d 706f 7274  that auto import
+00021e70: 696e 6720 776f 726b 7320 7769 7468 2022  ing works with "
+00021e80: 7070 2066 6f6f 222e 0a20 2020 2069 7079  pp foo"..    ipy
+00021e90: 7468 6f6e 2822 2222 0a20 2020 2020 2020  thon(""".       
+00021ea0: 2049 6e20 5b31 5d3a 2069 6d70 6f72 7420   In [1]: import 
+00021eb0: 7079 666c 7962 793b 2070 7966 6c79 6279  pyflyby; pyflyby
+00021ec0: 2e65 6e61 626c 655f 6175 746f 5f69 6d70  .enable_auto_imp
+00021ed0: 6f72 7465 7228 290a 2020 2020 2020 2020  orter().        
+00021ee0: 496e 205b 325d 3a20 3837 3438 3433 3535  In [2]: 87484355
+00021ef0: 2f30 0a20 2020 2020 2020 202e 2e2e 2e0a  /0.        .....
+00021f00: 2020 2020 2020 2020 5a65 726f 4469 7669          ZeroDivi
+00021f10: 7369 6f6e 4572 726f 723a 202e 2e2e 0a20  sionError: .... 
+00021f20: 2020 2020 2020 2049 6e20 5b33 5d3a 2025         In [3]: %
+00021f30: 6465 6275 670a 2020 2020 2020 2020 2e2e  debug.        ..
+00021f40: 2e2e 0a20 2020 2020 2020 2069 7064 623e  ...        ipdb>
+00021f50: 2070 2062 3634 6465 636f 6465 2822 5232   p b64decode("R2
+00021f60: 4679 5a47 5675 2229 0a20 2020 2020 2020  FyZGVu").       
+00021f70: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
+00021f80: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
+00021f90: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
+00021fa0: 6227 4761 7264 656e 270a 2020 2020 2020  b'Garden'.      
+00021fb0: 2020 6970 6462 3e20 710a 2020 2020 2222    ipdb> q.    ""
+00021fc0: 222c 2066 726f 6e74 656e 643d 6672 6f6e  ", frontend=fron
+00021fd0: 7465 6e64 290a 0a0a 4072 6574 7279 0a64  tend)...@retry.d
+00021fe0: 6566 2074 6573 745f 6465 6275 675f 6175  ef test_debug_au
+00021ff0: 746f 5f69 6d70 6f72 745f 6465 6661 756c  to_import_defaul
+00022000: 745f 3128 6672 6f6e 7465 6e64 293a 0a20  t_1(frontend):. 
+00022010: 2020 2023 2056 6572 6966 7920 7468 6174     # Verify that
+00022020: 2061 7574 6f20 696d 706f 7274 696e 6720   auto importing 
+00022030: 776f 726b 7320 7769 7468 2022 666f 6f28  works with "foo(
+00022040: 2e2e 2e29 222e 0a20 2020 2069 7079 7468  ...)"..    ipyth
+00022050: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
+00022060: 6e20 5b31 5d3a 2069 6d70 6f72 7420 7079  n [1]: import py
+00022070: 666c 7962 793b 2070 7966 6c79 6279 2e65  flyby; pyflyby.e
+00022080: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+00022090: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
+000220a0: 205b 325d 3a20 3431 3539 3430 3639 2f30   [2]: 41594069/0
+000220b0: 0a20 2020 2020 2020 202e 2e2e 2e0a 2020  .        .....  
+000220c0: 2020 2020 2020 5a65 726f 4469 7669 7369        ZeroDivisi
+000220d0: 6f6e 4572 726f 723a 202e 2e2e 0a20 2020  onError: ....   
+000220e0: 2020 2020 2049 6e20 5b33 5d3a 2025 6465       In [3]: %de
+000220f0: 6275 670a 2020 2020 2020 2020 2e2e 2e2e  bug.        ....
+00022100: 0a20 2020 2020 2020 2069 7064 623e 2062  .        ipdb> b
+00022110: 3634 6465 636f 6465 2822 5548 4a76 6333  64decode("UHJvc3
+00022120: 426c 5933 513d 2229 0a20 2020 2020 2020  BlY3Q=").       
+00022130: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
+00022140: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
+00022150: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
+00022160: 6227 5072 6f73 7065 6374 270a 2020 2020  b'Prospect'.    
+00022170: 2020 2020 6970 6462 3e20 710a 2020 2020      ipdb> q.    
+00022180: 2222 222c 2066 726f 6e74 656e 643d 6672  """, frontend=fr
+00022190: 6f6e 7465 6e64 290a 0a0a 4072 6574 7279  ontend)...@retry
+000221a0: 0a64 6566 2074 6573 745f 6465 6275 675f  .def test_debug_
+000221b0: 6175 746f 5f69 6d70 6f72 745f 7072 696e  auto_import_prin
+000221c0: 745f 3128 6672 6f6e 7465 6e64 293a 0a20  t_1(frontend):. 
+000221d0: 2020 2023 2056 6572 6966 7920 7468 6174     # Verify that
+000221e0: 2061 7574 6f20 696d 706f 7274 696e 6720   auto importing 
+000221f0: 776f 726b 7320 7769 7468 2022 7072 696e  works with "prin
+00022200: 7420 666f 6f22 2e20 2028 5468 6973 2069  t foo".  (This i
+00022210: 7320 6578 6563 7574 6564 2061 730a 2020  s executed as.  
+00022220: 2020 2320 6120 7374 6174 656d 656e 743b    # a statement;
+00022230: 2061 2073 7065 6369 616c 2063 6173 6520   a special case 
+00022240: 6f66 2022 6465 6661 756c 7422 2e29 0a20  of "default".). 
+00022250: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
+00022260: 2020 2020 2020 2049 6e20 5b31 5d3a 2069         In [1]: i
+00022270: 6d70 6f72 7420 7079 666c 7962 793b 2070  mport pyflyby; p
+00022280: 7966 6c79 6279 2e65 6e61 626c 655f 6175  yflyby.enable_au
+00022290: 746f 5f69 6d70 6f72 7465 7228 290a 2020  to_importer().  
+000222a0: 2020 2020 2020 496e 205b 325d 3a20 3430        In [2]: 40
+000222b0: 3436 3032 392f 300a 2020 2020 2020 2020  46029/0.        
+000222c0: 2e2e 2e2e 0a20 2020 2020 2020 205a 6572  .....        Zer
+000222d0: 6f44 6976 6973 696f 6e45 7272 6f72 3a20  oDivisionError: 
+000222e0: 2e2e 2e0a 2020 2020 2020 2020 496e 205b  ....        In [
+000222f0: 335d 3a20 2564 6562 7567 0a20 2020 2020  3]: %debug.     
+00022300: 2020 202e 2e2e 2e0a 2020 2020 2020 2020     .....        
+00022310: 6970 6462 3e20 6966 2031 3a20 7072 696e  ipdb> if 1: prin
+00022320: 7428 6236 3464 6563 6f64 6528 2254 5739  t(b64decode("TW9
+00022330: 7564 4764 7662 5756 7965 513d 3d22 292e  udGdvbWVyeQ==").
+00022340: 6465 636f 6465 2827 7574 662d 3827 2929  decode('utf-8'))
+00022350: 0a20 2020 2020 2020 205b 5059 464c 5942  .        [PYFLYB
+00022360: 595d 2066 726f 6d20 6261 7365 3634 2069  Y] from base64 i
+00022370: 6d70 6f72 7420 6236 3464 6563 6f64 650a  mport b64decode.
+00022380: 2020 2020 2020 2020 4d6f 6e74 676f 6d65          Montgome
+00022390: 7279 0a20 2020 2020 2020 2069 7064 623e  ry.        ipdb>
+000223a0: 2071 0a20 2020 2022 2222 2c20 6672 6f6e   q.    """, fron
+000223b0: 7465 6e64 3d66 726f 6e74 656e 6429 0a0a  tend=frontend)..
+000223c0: 0a40 7265 7472 790a 6465 6620 7465 7374  .@retry.def test
+000223d0: 5f64 6562 7567 5f61 7574 6f5f 696d 706f  _debug_auto_impo
+000223e0: 7274 5f62 616e 675f 6465 6661 756c 745f  rt_bang_default_
+000223f0: 3128 6672 6f6e 7465 6e64 293a 0a20 2020  1(frontend):.   
+00022400: 2023 2056 6572 6966 7920 7468 6174 2022   # Verify that "
+00022410: 2162 6c61 6822 2077 6f72 6b73 2077 6974  !blah" works wit
+00022420: 6820 6175 746f 2069 6d70 6f72 7469 6e67  h auto importing
+00022430: 2e0a 2020 2020 6970 7974 686f 6e28 2222  ..    ipython(""
+00022440: 220a 2020 2020 2020 2020 496e 205b 315d  ".        In [1]
+00022450: 3a20 696d 706f 7274 2070 7966 6c79 6279  : import pyflyby
+00022460: 3b20 7079 666c 7962 792e 656e 6162 6c65  ; pyflyby.enable
+00022470: 5f61 7574 6f5f 696d 706f 7274 6572 2829  _auto_importer()
+00022480: 0a20 2020 2020 2020 2049 6e20 5b32 5d3a  .        In [2]:
+00022490: 2036 3637 3833 3437 342f 300a 2020 2020   66783474/0.    
+000224a0: 2020 2020 2e2e 2e2e 0a20 2020 2020 2020      .....       
+000224b0: 205a 6572 6f44 6976 6973 696f 6e45 7272   ZeroDivisionErr
+000224c0: 6f72 3a20 2e2e 2e0a 2020 2020 2020 2020  or: ....        
+000224d0: 496e 205b 335d 3a20 2564 6562 7567 0a20  In [3]: %debug. 
+000224e0: 2020 2020 2020 202e 2e2e 2e0a 2020 2020         .....    
+000224f0: 2020 2020 6970 6462 3e20 2171 203d 2062      ipdb> !q = b
+00022500: 3634 6465 636f 6465 2822 5347 4633 6447  64decode("SGF3dG
+00022510: 6876 636d 356c 2229 0a20 2020 2020 2020  hvcm5l").       
+00022520: 205b 5059 464c 5942 595d 2066 726f 6d20   [PYFLYBY] from 
+00022530: 6261 7365 3634 2069 6d70 6f72 7420 6236  base64 import b6
+00022540: 3464 6563 6f64 650a 2020 2020 2020 2020  4decode.        
+00022550: 6970 6462 3e20 2171 0a20 2020 2020 2020  ipdb> !q.       
+00022560: 2062 2748 6177 7468 6f72 6e65 270a 2020   b'Hawthorne'.  
+00022570: 2020 2020 2020 6970 6462 3e20 710a 2020        ipdb> q.  
+00022580: 2020 2222 222c 2066 726f 6e74 656e 643d    """, frontend=
+00022590: 6672 6f6e 7465 6e64 290a 0a0a 4072 6574  frontend)...@ret
+000225a0: 7279 0a64 6566 2074 6573 745f 6465 6275  ry.def test_debu
+000225b0: 675f 706f 7374 6d6f 7274 656d 5f61 7574  g_postmortem_aut
+000225c0: 6f5f 696d 706f 7274 5f31 2866 726f 6e74  o_import_1(front
+000225d0: 656e 6429 3a0a 2020 2020 2320 5665 7269  end):.    # Veri
+000225e0: 6679 2074 6861 7420 2564 6562 7567 2070  fy that %debug p
+000225f0: 6f73 746d 6f72 7465 6d20 6d6f 6465 2077  ostmortem mode w
+00022600: 6f72 6b73 2e0a 2020 2020 6970 7974 686f  orks..    ipytho
+00022610: 6e28 2222 220a 2020 2020 2020 2020 496e  n(""".        In
+00022620: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
+00022630: 6c79 6279 3b20 7079 666c 7962 792e 656e  lyby; pyflyby.en
+00022640: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
+00022650: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
+00022660: 5b32 5d3a 2064 6566 2066 6f6f 2878 2c20  [2]: def foo(x, 
+00022670: 7929 3a0a 2020 2020 2020 2020 2020 202e  y):.           .
+00022680: 2e2e 3a20 2020 2020 7265 7475 726e 2078  ..:     return x
+00022690: 202f 2079 0a20 2020 2020 2020 2020 2020   / y.           
+000226a0: 2e2e 2e3a 0a20 2020 2020 2020 2049 6e20  ...:.        In 
+000226b0: 5b33 5d3a 2066 6f6f 2822 426f 7763 7261  [3]: foo("Bowcra
+000226c0: 6674 222c 2022 4d6f 756e 7461 696e 2229  ft", "Mountain")
+000226d0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000226e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000226f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00022700: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00022710: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00022720: 2d2d 2d2d 0a20 2020 2020 2020 2054 7970  ----.        Typ
+00022730: 6545 7272 6f72 2020 2020 2020 2020 2020  eError          
+00022740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022750: 2020 2020 2020 2054 7261 6365 6261 636b         Traceback
+00022760: 2028 6d6f 7374 2072 6563 656e 7420 6361   (most recent ca
+00022770: 6c6c 206c 6173 7429 0a20 2020 2020 2020  ll last).       
+00022780: 202e 2e2e 2e0a 2020 2020 2020 2020 5479   .....        Ty
+00022790: 7065 4572 726f 723a 2075 6e73 7570 706f  peError: unsuppo
+000227a0: 7274 6564 206f 7065 7261 6e64 2074 7970  rted operand typ
+000227b0: 6528 7329 2066 6f72 202f 3a20 2773 7472  e(s) for /: 'str
+000227c0: 2720 616e 6420 2773 7472 270a 2020 2020  ' and 'str'.    
+000227d0: 2020 2020 496e 205b 345d 3a20 2564 6562      In [4]: %deb
+000227e0: 7567 0a20 2020 2020 2020 202e 2e2e 2e0a  ug.        .....
+000227f0: 2020 2020 2020 2020 6970 6462 3e20 7072          ipdb> pr
+00022800: 696e 7428 7820 2b20 6236 3464 6563 6f64  int(x + b64decod
+00022810: 6528 2251 413d 3d22 292e 6465 636f 6465  e("QA==").decode
+00022820: 2827 7574 662d 3827 2920 2b20 7929 0a20  ('utf-8') + y). 
+00022830: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+00022840: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
+00022850: 6f72 7420 6236 3464 6563 6f64 650a 2020  ort b64decode.  
+00022860: 2020 2020 2020 426f 7763 7261 6674 404d        Bowcraft@M
+00022870: 6f75 6e74 6169 6e0a 2020 2020 2020 2020  ountain.        
+00022880: 6970 6462 3e20 710a 2020 2020 2222 222c  ipdb> q.    """,
+00022890: 2066 726f 6e74 656e 643d 6672 6f6e 7465   frontend=fronte
+000228a0: 6e64 290a 0a0a 4072 6574 7279 0a64 6566  nd)...@retry.def
+000228b0: 2074 6573 745f 6465 6275 675f 7461 625f   test_debug_tab_
+000228c0: 636f 6d70 6c65 7469 6f6e 5f64 625f 3128  completion_db_1(
+000228d0: 6672 6f6e 7465 6e64 293a 0a20 2020 2023  frontend):.    #
+000228e0: 2056 6572 6966 7920 7468 6174 2074 6162   Verify that tab
+000228f0: 2063 6f6d 706c 6574 696f 6e20 6672 6f6d   completion from
+00022900: 2064 6174 6162 6173 6520 776f 726b 732e   database works.
+00022910: 0a20 2020 2069 7079 7468 6f6e 2822 2222  .    ipython("""
+00022920: 0a20 2020 2020 2020 2049 6e20 5b31 5d3a  .        In [1]:
+00022930: 2069 6d70 6f72 7420 7079 666c 7962 793b   import pyflyby;
+00022940: 2070 7966 6c79 6279 2e65 6e61 626c 655f   pyflyby.enable_
+00022950: 6175 746f 5f69 6d70 6f72 7465 7228 290a  auto_importer().
+00022960: 2020 2020 2020 2020 496e 205b 325d 3a20          In [2]: 
+00022970: 3930 3338 3339 3531 2f30 0a20 2020 2020  90383951/0.     
+00022980: 2020 202e 2e2e 2e0a 2020 2020 2020 2020     .....        
+00022990: 5a65 726f 4469 7669 7369 6f6e 4572 726f  ZeroDivisionErro
+000229a0: 723a 202e 2e2e 0a20 2020 2020 2020 2049  r: ....        I
+000229b0: 6e20 5b33 5d3a 2025 6465 6275 670a 2020  n [3]: %debug.  
+000229c0: 2020 2020 2020 2e2e 2e2e 0a20 2020 2020        .....     
+000229d0: 2020 2069 7064 623e 2070 7269 6e74 2862     ipdb> print(b
+000229e0: 3634 6465 635c 746f 6465 2822 5232 4679  64dec\tode("R2Fy
+000229f0: 5a6d 6c6c 6247 513d 2229 2e64 6563 6f64  ZmllbGQ=").decod
+00022a00: 6528 2775 7466 2d38 2729 290a 2020 2020  e('utf-8')).    
+00022a10: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
+00022a20: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
+00022a30: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
+00022a40: 2020 2047 6172 6669 656c 640a 2020 2020     Garfield.    
+00022a50: 2020 2020 6970 6462 3e20 710a 2020 2020      ipdb> q.    
+00022a60: 2222 222c 2066 726f 6e74 656e 643d 6672  """, frontend=fr
+00022a70: 6f6e 7465 6e64 290a 0a0a 4072 6574 7279  ontend)...@retry
+00022a80: 0a64 6566 2074 6573 745f 6465 6275 675f  .def test_debug_
+00022a90: 7461 625f 636f 6d70 6c65 7469 6f6e 5f6d  tab_completion_m
+00022aa0: 6f64 756c 655f 3128 6672 6f6e 7465 6e64  odule_1(frontend
+00022ab0: 2c20 746d 7029 3a0a 2020 2020 2320 5665  , tmp):.    # Ve
+00022ac0: 7269 6679 2074 6861 7420 7461 6220 636f  rify that tab co
+00022ad0: 6d70 6c65 7469 6f6e 206f 6e20 6d6f 6475  mpletion on modu
+00022ae0: 6c65 206e 616d 6573 2077 6f72 6b73 2e0a  le names works..
+00022af0: 2020 2020 7772 6974 6574 6578 7428 746d      writetext(tm
+00022b00: 702e 6469 722f 2274 686f 726e 746f 6e36  p.dir/"thornton6
+00022b10: 3030 3937 3138 312e 7079 222c 2022 2222  0097181.py", """
+00022b20: 0a20 2020 2020 2020 2072 616e 646f 6c70  .        randolp
+00022b30: 6820 3d20 3134 3136 3435 3938 0a20 2020  h = 14164598.   
+00022b40: 2022 2222 290a 2020 2020 6970 7974 686f   """).    ipytho
+00022b50: 6e28 2222 220a 2020 2020 2020 2020 496e  n(""".        In
+00022b60: 205b 315d 3a20 696d 706f 7274 2070 7966   [1]: import pyf
+00022b70: 6c79 6279 3b20 7079 666c 7962 792e 656e  lyby; pyflyby.en
+00022b80: 6162 6c65 5f61 7574 6f5f 696d 706f 7274  able_auto_import
+00022b90: 6572 2829 0a20 2020 2020 2020 2049 6e20  er().        In 
+00022ba0: 5b32 5d3a 2035 3334 3138 3430 332f 300a  [2]: 53418403/0.
+00022bb0: 2020 2020 2020 2020 2e2e 2e2e 0a20 2020          .....   
+00022bc0: 2020 2020 205a 6572 6f44 6976 6973 696f       ZeroDivisio
+00022bd0: 6e45 7272 6f72 3a20 2e2e 2e0a 2020 2020  nError: ....    
+00022be0: 2020 2020 496e 205b 335d 3a20 2564 6562      In [3]: %deb
+00022bf0: 7567 0a20 2020 2020 2020 202e 2e2e 2e0a  ug.        .....
+00022c00: 2020 2020 2020 2020 6970 6462 3e20 7072          ipdb> pr
+00022c10: 696e 7428 7468 6f72 6e74 6f6e 3630 3039  int(thornton6009
+00022c20: 375c 7431 3831 2e72 616e 646f 5c74 0a20  7\t181.rando\t. 
+00022c30: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+00022c40: 2069 6d70 6f72 7420 7468 6f72 6e74 6f6e   import thornton
+00022c50: 3630 3039 3731 3831 0a20 2020 2020 2020  60097181.       
+00022c60: 2069 7064 623e 2070 7269 6e74 2874 686f   ipdb> print(tho
+00022c70: 726e 746f 6e36 3030 3937 3138 312e 7261  rnton60097181.ra
+00022c80: 6e64 6f6c 7068 290a 2020 2020 2020 2020  ndolph).        
+00022c90: 3134 3136 3435 3938 0a20 2020 2020 2020  14164598.       
+00022ca0: 2069 7064 623e 2071 0a20 2020 2022 2222   ipdb> q.    """
+00022cb0: 2c20 5059 5448 4f4e 5041 5448 3d74 6d70  , PYTHONPATH=tmp
+00022cc0: 2e64 6972 2c20 6672 6f6e 7465 6e64 3d66  .dir, frontend=f
+00022cd0: 726f 6e74 656e 6429 0a0a 0a40 7265 7472  rontend)...@retr
+00022ce0: 790a 6465 6620 7465 7374 5f64 6562 7567  y.def test_debug
+00022cf0: 5f74 6162 5f63 6f6d 706c 6574 696f 6e5f  _tab_completion_
+00022d00: 6d75 6c74 6970 6c65 5f31 2866 726f 6e74  multiple_1(front
+00022d10: 656e 642c 2074 6d70 293a 0a20 2020 2023  end, tmp):.    #
+00022d20: 2056 6572 6966 7920 7468 6174 2074 6162   Verify that tab
+00022d30: 2063 6f6d 706c 6574 696f 6e20 7769 7468   completion with
+00022d40: 2061 6d62 6967 756f 7573 206e 616d 6573   ambiguous names
+00022d50: 2077 6f72 6b73 2e0a 2020 2020 6966 2066   works..    if f
+00022d60: 726f 6e74 656e 6420 3d3d 2022 7072 6f6d  rontend == "prom
+00022d70: 7074 5f74 6f6f 6c6b 6974 223a 2070 7974  pt_toolkit": pyt
+00022d80: 6573 742e 736b 6970 2829 0a20 2020 2077  est.skip().    w
+00022d90: 7269 7465 7465 7874 2874 6d70 2e64 6972  ritetext(tmp.dir
+00022da0: 2f22 7374 7572 6272 6964 6765 3930 3838  /"sturbridge9088
+00022db0: 3333 332e 7079 222c 2022 2222 0a20 2020  333.py", """.   
+00022dc0: 2020 2020 206e 6562 756c 615f 3431 3639       nebula_4169
+00022dd0: 3534 3538 203d 2031 0a20 2020 2020 2020  5458 = 1.       
+00022de0: 206e 6562 756c 615f 3130 3938 3338 3430   nebula_10983840
+00022df0: 203d 2032 0a20 2020 2022 2222 290a 2020   = 2.    """).  
+00022e00: 2020 6970 7974 686f 6e28 2222 220a 2020    ipython(""".  
+00022e10: 2020 2020 2020 496e 205b 315d 3a20 696d        In [1]: im
+00022e20: 706f 7274 2070 7966 6c79 6279 3b20 7079  port pyflyby; py
+00022e30: 666c 7962 792e 656e 6162 6c65 5f61 7574  flyby.enable_aut
+00022e40: 6f5f 696d 706f 7274 6572 2829 0a20 2020  o_importer().   
+00022e50: 2020 2020 2049 6e20 5b32 5d3a 2036 3137       In [2]: 617
+00022e60: 3634 3532 352f 300a 2020 2020 2020 2020  64525/0.        
+00022e70: 2e2e 2e2e 0a20 2020 2020 2020 205a 6572  .....        Zer
+00022e80: 6f44 6976 6973 696f 6e45 7272 6f72 3a20  oDivisionError: 
+00022e90: 2e2e 2e0a 2020 2020 2020 2020 496e 205b  ....        In [
+00022ea0: 335d 3a20 2564 6562 7567 0a20 2020 2020  3]: %debug.     
+00022eb0: 2020 202e 2e2e 2e0a 2020 2020 2020 2020     .....        
+00022ec0: 6970 6462 3e20 7072 696e 7428 7374 7572  ipdb> print(stur
+00022ed0: 6272 6964 6765 3930 3838 3333 332e 6e65  bridge9088333.ne
+00022ee0: 625c 740a 2020 2020 2020 2020 5b50 5946  b\t.        [PYF
+00022ef0: 4c59 4259 5d20 696d 706f 7274 2073 7475  LYBY] import stu
+00022f00: 7262 7269 6467 6539 3038 3833 3333 0a20  rbridge9088333. 
+00022f10: 2020 2020 2020 2069 7064 623e 2070 7269         ipdb> pri
+00022f20: 6e74 2873 7475 7262 7269 6467 6539 3038  nt(sturbridge908
+00022f30: 3833 3333 2e6e 6562 0a20 2020 2020 2020  8333.neb.       
+00022f40: 2073 7475 7262 7269 6467 6539 3038 3833   sturbridge90883
+00022f50: 3333 2e6e 6562 756c 615f 3130 3938 3338  33.nebula_109838
+00022f60: 3430 2020 7374 7572 6272 6964 6765 3930  40  sturbridge90
+00022f70: 3838 3333 332e 6e65 6275 6c61 5f34 3136  88333.nebula_416
+00022f80: 3935 3435 380a 2020 2020 2020 2020 6970  95458.        ip
+00022f90: 6462 3e20 7072 696e 7428 7374 7572 6272  db> print(sturbr
+00022fa0: 6964 6765 3930 3838 3333 332e 6e65 6275  idge9088333.nebu
+00022fb0: 6c61 5f29 0a20 2020 2020 2020 202a 2a2a  la_).        ***
+00022fc0: 2041 7474 7269 6275 7465 4572 726f 723a   AttributeError:
+00022fd0: 2073 7475 7262 7269 6467 6539 3038 3833   sturbridge90883
+00022fe0: 3333 2068 6173 206e 6f20 6174 7472 6962  33 has no attrib
+00022ff0: 7574 6520 276e 6562 756c 615f 270a 2020  ute 'nebula_'.  
+00023000: 2020 2020 2020 6970 6462 3e20 710a 2020        ipdb> q.  
+00023010: 2020 2222 222c 2050 5954 484f 4e50 4154    """, PYTHONPAT
+00023020: 483d 746d 702e 6469 722c 2066 726f 6e74  H=tmp.dir, front
+00023030: 656e 643d 6672 6f6e 7465 6e64 290a 0a0a  end=frontend)...
+00023040: 4072 6574 7279 0a64 6566 2074 6573 745f  @retry.def test_
+00023050: 6465 6275 675f 706f 7374 6d6f 7274 656d  debug_postmortem
+00023060: 5f74 6162 5f63 6f6d 706c 6574 696f 6e5f  _tab_completion_
+00023070: 3128 6672 6f6e 7465 6e64 293a 0a20 2020  1(frontend):.   
+00023080: 2023 2056 6572 6966 7920 7468 6174 2074   # Verify that t
+00023090: 6162 2063 6f6d 706c 6574 696f 6e20 696e  ab completion in
+000230a0: 2025 6465 6275 6720 706f 7374 6d6f 7274   %debug postmort
+000230b0: 656d 206d 6f64 6520 776f 726b 732e 0a20  em mode works.. 
+000230c0: 2020 2069 7079 7468 6f6e 2822 2222 0a20     ipython(""". 
+000230d0: 2020 2020 2020 2049 6e20 5b31 5d3a 2069         In [1]: i
+000230e0: 6d70 6f72 7420 7079 666c 7962 793b 2070  mport pyflyby; p
+000230f0: 7966 6c79 6279 2e65 6e61 626c 655f 6175  yflyby.enable_au
+00023100: 746f 5f69 6d70 6f72 7465 7228 290a 2020  to_importer().  
+00023110: 2020 2020 2020 496e 205b 325d 3a20 6465        In [2]: de
+00023120: 6620 666f 6f28 782c 2079 293a 0a20 2020  f foo(x, y):.   
+00023130: 2020 2020 2020 2020 2e2e 2e3a 2020 2020          ...:    
+00023140: 2072 6574 7572 6e20 7820 2f20 790a 2020   return x / y.  
+00023150: 2020 2020 2020 2020 202e 2e2e 3a0a 2020           ...:.  
+00023160: 2020 2020 2020 496e 205b 335d 3a20 666f        In [3]: fo
+00023170: 6f28 2243 616d 6465 6e22 2c20 2248 6f70  o("Camden", "Hop
+00023180: 6b69 6e73 6f6e 2229 0a20 2020 2020 2020  kinson").       
+00023190: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
+000231a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000231b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000231c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000231d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
+000231e0: 2020 2020 2054 7970 6545 7272 6f72 2020       TypeError  
+000231f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023200: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+00023210: 7261 6365 6261 636b 2028 6d6f 7374 2072  raceback (most r
+00023220: 6563 656e 7420 6361 6c6c 206c 6173 7429  ecent call last)
+00023230: 0a20 2020 2020 2020 202e 2e2e 2e0a 2020  .        .....  
+00023240: 2020 2020 2020 5479 7065 4572 726f 723a        TypeError:
+00023250: 2075 6e73 7570 706f 7274 6564 206f 7065   unsupported ope
+00023260: 7261 6e64 2074 7970 6528 7329 2066 6f72  rand type(s) for
+00023270: 202f 3a20 2773 7472 2720 616e 6420 2773   /: 'str' and 's
+00023280: 7472 270a 2020 2020 2020 2020 496e 205b  tr'.        In [
+00023290: 345d 3a20 2564 6562 7567 0a20 2020 2020  4]: %debug.     
+000232a0: 2020 202e 2e2e 2e0a 2020 2020 2020 2020     .....        
+000232b0: 6970 6462 3e20 7072 696e 7428 7820 2b20  ipdb> print(x + 
+000232c0: 6261 7365 3634 2e62 3634 645c 740a 2020  base64.b64d\t.  
+000232d0: 2020 2020 2020 5b50 5946 4c59 4259 5d20        [PYFLYBY] 
+000232e0: 696d 706f 7274 2062 6173 6536 340a 2020  import base64.  
+000232f0: 2020 2020 2020 6970 6462 3e20 7072 696e        ipdb> prin
+00023300: 7428 7820 2b20 6261 7365 3634 2e62 3634  t(x + base64.b64
+00023310: 6465 636f 6465 2822 4c77 3d3d 2229 2e64  decode("Lw==").d
+00023320: 6563 6f64 6528 2775 7466 2d38 2729 202b  ecode('utf-8') +
+00023330: 2079 290a 2020 2020 2020 2020 4361 6d64   y).        Camd
+00023340: 656e 2f48 6f70 6b69 6e73 6f6e 0a20 2020  en/Hopkinson.   
+00023350: 2020 2020 2069 7064 623e 2071 0a20 2020       ipdb> q.   
+00023360: 2022 2222 2c20 6672 6f6e 7465 6e64 3d66   """, frontend=f
+00023370: 726f 6e74 656e 6429 0a0a 0a64 6566 2074  rontend)...def t
+00023380: 6573 745f 6465 6275 675f 6e61 6d65 7370  est_debug_namesp
+00023390: 6163 655f 315f 7079 3328 6672 6f6e 7465  ace_1_py3(fronte
+000233a0: 6e64 293a 0a20 2020 2023 2056 6572 6966  nd):.    # Verif
+000233b0: 7920 7468 6174 2061 7574 6f69 6d70 6f72  y that autoimpor
+000233c0: 7469 6e67 2061 6e64 2074 6162 2063 6f6d  ting and tab com
+000233d0: 706c 6574 696f 6e20 6861 7070 656e 2069  pletion happen i
+000233e0: 6e20 7468 6520 6c6f 6361 6c0a 2020 2020  n the local.    
+000233f0: 2320 6e61 6d65 7370 6163 652e 0a20 2020  # namespace..   
+00023400: 2023 2049 6e20 7468 6973 2065 7861 6d70   # In this examp
+00023410: 6c65 2c20 696e 2074 6865 206c 6f63 616c  le, in the local
+00023420: 206e 616d 6573 7061 6365 2c20 2762 6173   namespace, 'bas
+00023430: 6536 3427 2069 7320 6120 7661 7269 6162  e64' is a variab
+00023440: 6c65 2028 7768 6963 680a 2020 2020 2320  le (which.    # 
+00023450: 6973 2061 2073 7472 696e 6729 2c20 616e  is a string), an
+00023460: 6420 7368 6f75 6c64 6e27 7420 7265 6665  d shouldn't refe
+00023470: 7220 746f 2074 6865 2067 6c6f 6261 6c20  r to the global 
+00023480: 2762 6173 6536 3427 2e0a 2020 2020 6970  'base64'..    ip
+00023490: 7974 686f 6e28 2222 220a 2020 2020 2020  ython(""".      
+000234a0: 2020 496e 205b 315d 3a20 696d 706f 7274    In [1]: import
+000234b0: 2070 7966 6c79 6279 3b20 7079 666c 7962   pyflyby; pyflyb
+000234c0: 792e 656e 6162 6c65 5f61 7574 6f5f 696d  y.enable_auto_im
+000234d0: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
+000234e0: 2049 6e20 5b32 5d3a 2064 6566 2066 6f6f   In [2]: def foo
+000234f0: 2878 2c20 6261 7365 3634 293a 0a20 2020  (x, base64):.   
+00023500: 2020 2020 2020 2020 2e2e 2e3a 2020 2020          ...:    
+00023510: 2072 6574 7572 6e20 7820 2f20 6261 7365   return x / base
+00023520: 3634 0a20 2020 2020 2020 2020 2020 2e2e  64.           ..
+00023530: 2e3a 0a20 2020 2020 2020 2049 6e20 5b33  .:.        In [3
+00023540: 5d3a 2066 6f6f 2822 4c65 7869 6e67 746f  ]: foo("Lexingto
+00023550: 6e22 2c20 2261 746c 616e 7469 6322 290a  n", "atlantic").
+00023560: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00023570: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00023580: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00023590: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000235a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000235b0: 2d2d 2d0a 2020 2020 2020 2020 5479 7065  ---.        Type
+000235c0: 4572 726f 7220 2020 2020 2020 2020 2020  Error           
+000235d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000235e0: 2020 2020 2020 5472 6163 6562 6163 6b20        Traceback 
+000235f0: 286d 6f73 7420 7265 6365 6e74 2063 616c  (most recent cal
+00023600: 6c20 6c61 7374 290a 2020 2020 2020 2020  l last).        
+00023610: 2e2e 2e2e 0a20 2020 2020 2020 2054 7970  .....        Typ
+00023620: 6545 7272 6f72 3a20 756e 7375 7070 6f72  eError: unsuppor
+00023630: 7465 6420 6f70 6572 616e 6420 7479 7065  ted operand type
+00023640: 2873 2920 666f 7220 2f3a 2027 7374 7227  (s) for /: 'str'
+00023650: 2061 6e64 2027 7374 7227 0a20 2020 2020   and 'str'.     
+00023660: 2020 2049 6e20 5b34 5d3a 2025 6465 6275     In [4]: %debu
+00023670: 670a 2020 2020 2020 2020 2e2e 2e2e 0a20  g.        ..... 
+00023680: 2020 2020 2020 2069 7064 623e 2070 7269         ipdb> pri
+00023690: 6e74 2862 6173 6536 342e 6361 705c 7469  nt(base64.cap\ti
+000236a0: 7461 6c69 7a65 2829 202b 2062 3634 6465  talize() + b64de
+000236b0: 636f 5c74 6465 2822 5547 466a 6157 5a70  co\tde("UGFjaWZp
+000236c0: 5977 3d3d 2229 2e64 6563 6f64 6528 2775  Yw==").decode('u
+000236d0: 7466 2d38 2729 290a 2020 2020 2020 2020  tf-8')).        
+000236e0: 5b50 5946 4c59 4259 5d20 6672 6f6d 2062  [PYFLYBY] from b
+000236f0: 6173 6536 3420 696d 706f 7274 2062 3634  ase64 import b64
+00023700: 6465 636f 6465 0a20 2020 2020 2020 2041  decode.        A
+00023710: 746c 616e 7469 6350 6163 6966 6963 0a20  tlanticPacific. 
+00023720: 2020 2020 2020 2069 7064 623e 2070 2062         ipdb> p b
+00023730: 3634 6465 636f 5c74 6465 2822 5132 3975  64deco\tde("Q29u
+00023740: 6447 6c75 5a57 3530 5957 773d 2229 0a20  dGluZW50YWw="). 
+00023750: 2020 2020 2020 2062 2743 6f6e 7469 6e65         b'Contine
+00023760: 6e74 616c 270a 2020 2020 2020 2020 6970  ntal'.        ip
+00023770: 6462 3e20 710a 2020 2020 2020 2020 496e  db> q.        In
+00023780: 205b 355d 3a20 6261 7365 3634 2e62 3634   [5]: base64.b64
+00023790: 6465 5c74 0a20 2020 2020 2020 2049 6e20  de\t.        In 
+000237a0: 5b35 5d3a 2062 6173 6536 342e 6236 3464  [5]: base64.b64d
+000237b0: 6563 6f64 6528 2253 476c 7362 413d 3d22  ecode("SGlsbA=="
+000237c0: 2920 2b20 6236 3464 6563 6f5c 7464 6528  ) + b64deco\tde(
+000237d0: 2254 4746 725a 513d 3d22 290a 2020 2020  "TGFrZQ==").    
+000237e0: 2020 2020 5b50 5946 4c59 4259 5d20 6672      [PYFLYBY] fr
+000237f0: 6f6d 2062 6173 6536 3420 696d 706f 7274  om base64 import
+00023800: 2062 3634 6465 636f 6465 0a20 2020 2020   b64decode.     
+00023810: 2020 204f 7574 5b35 5d3a 2062 2748 696c     Out[5]: b'Hil
+00023820: 6c4c 616b 6527 0a20 2020 2022 2222 2c20  lLake'.    """, 
+00023830: 6672 6f6e 7465 6e64 3d66 726f 6e74 656e  frontend=fronten
+00023840: 6429 0a0a 0a40 7265 7472 790a 6465 6620  d)...@retry.def 
+00023850: 7465 7374 5f64 6562 7567 5f73 6563 6f6e  test_debug_secon
+00023860: 645f 3128 6672 6f6e 7465 6e64 293a 0a20  d_1(frontend):. 
+00023870: 2020 2023 2056 6572 6966 7920 7468 6174     # Verify that
+00023880: 2061 2073 6563 6f6e 6420 706f 7374 6d6f   a second postmo
+00023890: 7274 656d 2064 6562 7567 206f 6620 7468  rtem debug of th
+000238a0: 6520 7361 6d65 2066 756e 6374 696f 6e20  e same function 
+000238b0: 6265 6861 7665 7320 6173 0a20 2020 2023  behaves as.    #
+000238c0: 2065 7870 6563 7465 642e 0a20 2020 2069   expected..    i
+000238d0: 7079 7468 6f6e 2822 2222 0a20 2020 2020  python(""".     
+000238e0: 2020 2049 6e20 5b31 5d3a 2069 6d70 6f72     In [1]: impor
+000238f0: 7420 7079 666c 7962 793b 2070 7966 6c79  t pyflyby; pyfly
+00023900: 6279 2e65 6e61 626c 655f 6175 746f 5f69  by.enable_auto_i
+00023910: 6d70 6f72 7465 7228 290a 2020 2020 2020  mporter().      
+00023920: 2020 496e 205b 325d 3a20 6465 6620 666f    In [2]: def fo
+00023930: 6f28 782c 2079 293a 0a20 2020 2020 2020  o(x, y):.       
+00023940: 2020 2020 2e2e 2e3a 2020 2020 2072 6574      ...:     ret
+00023950: 7572 6e20 7820 2f20 790a 2020 2020 2020  urn x / y.      
+00023960: 2020 2020 202e 2e2e 3a0a 2020 2020 2020       ...:.      
+00023970: 2020 496e 205b 335d 3a20 666f 6f28 2248    In [3]: foo("H
+00023980: 7572 6f6e 222c 2022 4f73 6167 6522 290a  uron", "Osage").
+00023990: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000239a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000239b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000239c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000239d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000239e0: 2d2d 2d0a 2020 2020 2020 2020 5479 7065  ---.        Type
+000239f0: 4572 726f 7220 2020 2020 2020 2020 2020  Error           
+00023a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023a10: 2020 2020 2020 5472 6163 6562 6163 6b20        Traceback 
+00023a20: 286d 6f73 7420 7265 6365 6e74 2063 616c  (most recent cal
+00023a30: 6c20 6c61 7374 290a 2020 2020 2020 2020  l last).        
+00023a40: 2e2e 2e2e 0a20 2020 2020 2020 2054 7970  .....        Typ
+00023a50: 6545 7272 6f72 3a20 756e 7375 7070 6f72  eError: unsuppor
+00023a60: 7465 6420 6f70 6572 616e 6420 7479 7065  ted operand type
+00023a70: 2873 2920 666f 7220 2f3a 2027 7374 7227  (s) for /: 'str'
+00023a80: 2061 6e64 2027 7374 7227 0a20 2020 2020   and 'str'.     
+00023a90: 2020 2049 6e20 5b34 5d3a 2025 6465 6275     In [4]: %debu
+00023aa0: 670a 2020 2020 2020 2020 2e2e 2e2e 0a20  g.        ..... 
+00023ab0: 2020 2020 2020 2069 7064 623e 2062 3634         ipdb> b64
+00023ac0: 6465 636f 5c74 6465 2822 536d 397a 5a58  deco\tde("Sm9zZX
+00023ad0: 426f 2229 0a20 2020 2020 2020 205b 5059  Bo").        [PY
+00023ae0: 464c 5942 595d 2066 726f 6d20 6261 7365  FLYBY] from base
+00023af0: 3634 2069 6d70 6f72 7420 6236 3464 6563  64 import b64dec
+00023b00: 6f64 650a 2020 2020 2020 2020 6227 4a6f  ode.        b'Jo
+00023b10: 7365 7068 270a 2020 2020 2020 2020 6970  seph'.        ip
+00023b20: 6462 3e20 6236 3464 6563 6f5c 7464 6528  db> b64deco\tde(
+00023b30: 2255 3256 7461 5735 7662 4755 3d22 290a  "U2VtaW5vbGU=").
+00023b40: 2020 2020 2020 2020 6227 5365 6d69 6e6f          b'Semino
+00023b50: 6c65 270a 2020 2020 2020 2020 6970 6462  le'.        ipdb
+00023b60: 3e20 710a 2020 2020 2020 2020 496e 205b  > q.        In [
+00023b70: 355d 3a20 666f 6f28 2251 7569 6e63 6522  5]: foo("Quince"
+00023b80: 2c20 224c 696c 6163 2229 0a20 2020 2020  , "Lilac").     
+00023b90: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     -------------
+00023ba0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00023bb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00023bc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00023bd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
+00023be0: 2020 2020 2020 2054 7970 6545 7272 6f72         TypeError
+00023bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023c10: 2054 7261 6365 6261 636b 2028 6d6f 7374   Traceback (most
+00023c20: 2072 6563 656e 7420 6361 6c6c 206c 6173   recent call las
+00023c30: 7429 0a20 2020 2020 2020 202e 2e2e 2e0a  t).        .....
+00023c40: 2020 2020 2020 2020 5479 7065 4572 726f          TypeErro
+00023c50: 723a 2075 6e73 7570 706f 7274 6564 206f  r: unsupported o
+00023c60: 7065 7261 6e64 2074 7970 6528 7329 2066  perand type(s) f
+00023c70: 6f72 202f 3a20 2773 7472 2720 616e 6420  or /: 'str' and 
+00023c80: 2773 7472 270a 2020 2020 2020 2020 496e  'str'.        In
+00023c90: 205b 365d 3a20 2564 6562 7567 0a20 2020   [6]: %debug.   
+00023ca0: 2020 2020 202e 2e2e 2e0a 2020 2020 2020       .....      
+00023cb0: 2020 6970 6462 3e20 6236 3464 6563 6f5c    ipdb> b64deco\
+00023cc0: 7464 6528 2251 334a 7659 3356 7a22 290a  tde("Q3JvY3Vz").
+00023cd0: 2020 2020 2020 2020 5b50 5946 4c59 4259          [PYFLYBY
+00023ce0: 5d20 6672 6f6d 2062 6173 6536 3420 696d  ] from base64 im
+00023cf0: 706f 7274 2062 3634 6465 636f 6465 0a20  port b64decode. 
+00023d00: 2020 2020 2020 2062 2743 726f 6375 7327         b'Crocus'
+00023d10: 0a20 2020 2020 2020 2069 7064 623e 2071  .        ipdb> q
+00023d20: 0a20 2020 2022 2222 2c20 6672 6f6e 7465  .    """, fronte
+00023d30: 6e64 3d66 726f 6e74 656e 6429 0a0a 0a40  nd=frontend)...@
+00023d40: 7079 7465 7374 2e6d 6172 6b2e 736b 6970  pytest.mark.skip
+00023d50: 6966 280a 2020 2020 5f49 5059 5448 4f4e  if(.    _IPYTHON
+00023d60: 5f56 4552 5349 4f4e 203c 2028 312c 2030  _VERSION < (1, 0
+00023d70: 292c 0a20 2020 2072 6561 736f 6e3d 226f  ),.    reason="o
+00023d80: 6c64 2049 5079 7468 6f6e 2064 6f65 736e  ld IPython doesn
+00023d90: 2774 2073 7570 706f 7274 2064 6562 7567  't support debug
+00023da0: 203c 7374 6174 656d 656e 743e 2229 0a40   <statement>").@
+00023db0: 7265 7472 790a 6465 6620 7465 7374 5f64  retry.def test_d
+00023dc0: 6562 7567 5f61 7574 6f5f 696d 706f 7274  ebug_auto_import
+00023dd0: 5f73 7472 696e 675f 3128 6672 6f6e 7465  _string_1(fronte
+00023de0: 6e64 293a 0a20 2020 2023 2056 6572 6966  nd):.    # Verif
+00023df0: 7920 7468 6174 2061 7574 6f20 696d 706f  y that auto impo
+00023e00: 7274 696e 6720 776f 726b 7320 696e 7369  rting works insi
+00023e10: 6465 2074 6865 2064 6562 7567 6765 7220  de the debugger 
+00023e20: 6166 7465 7220 7275 6e6e 696e 670a 2020  after running.  
+00023e30: 2020 2320 2225 6465 6275 6720 3c73 7472    # "%debug <str
+00023e40: 696e 673e 222e 0a20 2020 2069 7079 7468  ing>"..    ipyth
+00023e50: 6f6e 2822 2222 0a20 2020 2020 2020 2049  on(""".        I
+00023e60: 6e20 5b31 5d3a 2069 6d70 6f72 7420 7079  n [1]: import py
+00023e70: 666c 7962 793b 2070 7966 6c79 6279 2e65  flyby; pyflyby.e
+00023e80: 6e61 626c 655f 6175 746f 5f69 6d70 6f72  nable_auto_impor
+00023e90: 7465 7228 290a 2020 2020 2020 2020 496e  ter().        In
+00023ea0: 205b 325d 3a20 2564 6562 7567 2034 3439   [2]: %debug 449
+00023eb0: 3638 3831 370a 2020 2020 2020 2020 4e4f  68817.        NO
+00023ec0: 5445 3a20 456e 7465 7220 2763 2720 6174  TE: Enter 'c' at
+00023ed0: 2074 6865 2069 7064 623e 2020 7072 6f6d   the ipdb>  prom
+00023ee0: 7074 2074 6f20 636f 6e74 696e 7565 2065  pt to continue e
+00023ef0: 7865 6375 7469 6f6e 2e0a 2020 2020 2020  xecution..      
+00023f00: 2020 3e20 3c73 7472 696e 673e 2831 293c    > <string>(1)<
+00023f10: 6d6f 6475 6c65 3e28 290a 2020 2020 2020  module>().      
+00023f20: 2020 6970 6462 3e20 7020 6236 3464 6563    ipdb> p b64dec
+00023f30: 6f64 6528 2254 476c 7563 3278 6c65 513d  ode("TGluc2xleQ=
+00023f40: 3d22 290a 2020 2020 2020 2020 5b50 5946  =").        [PYF
+00023f50: 4c59 4259 5d20 6672 6f6d 2062 6173 6536  LYBY] from base6
+00023f60: 3420 696d 706f 7274 2062 3634 6465 636f  4 import b64deco
+00023f70: 6465 0a20 2020 2020 2020 2062 274c 696e  de.        b'Lin
+00023f80: 736c 6579 270a 2020 2020 2020 2020 6970  sley'.        ip
+00023f90: 6462 3e20 710a 2020 2020 2222 222c 2066  db> q.    """, f
+00023fa0: 726f 6e74 656e 643d 6672 6f6e 7465 6e64  rontend=frontend
+00023fb0: 290a 0a0a 4070 7974 6573 742e 6d61 726b  )...@pytest.mark
+00023fc0: 2e73 6b69 7069 6628 0a20 2020 205f 4950  .skipif(.    _IP
+00023fd0: 5954 484f 4e5f 5645 5253 494f 4e20 3c20  YTHON_VERSION < 
+00023fe0: 2831 2c20 3029 2c0a 2020 2020 7265 6173  (1, 0),.    reas
+00023ff0: 6f6e 3d22 6f6c 6420 4950 7974 686f 6e20  on="old IPython 
+00024000: 646f 6573 6e27 7420 7375 7070 6f72 7420  doesn't support 
+00024010: 6465 6275 6720 3c73 7461 7465 6d65 6e74  debug <statement
+00024020: 3e22 290a 6465 6620 7465 7374 5f64 6562  >").def test_deb
+00024030: 7567 5f61 7574 6f5f 696d 706f 7274 5f6f  ug_auto_import_o
+00024040: 665f 7374 7269 6e67 5f31 2866 726f 6e74  f_string_1(front
+00024050: 656e 642c 2074 6d70 293a 0a20 2020 2023  end, tmp):.    #
+00024060: 2056 6572 6966 7920 7468 6174 2061 7574   Verify that aut
+00024070: 6f20 696d 706f 7274 696e 6720 776f 726b  o importing work
+00024080: 7320 666f 7220 7468 6520 7374 7269 6e67  s for the string
+00024090: 2074 6f20 6265 2064 6562 7567 6765 642e   to be debugged.
+000240a0: 0a20 2020 2077 7269 7465 7465 7874 2874  .    writetext(t
+000240b0: 6d70 2e64 6972 2f22 7065 656b 736b 696c  mp.dir/"peekskil
+000240c0: 6c34 3336 3636 3933 302e 7079 222c 2022  l43666930.py", "
+000240d0: 2222 0a20 2020 2020 2020 2064 6566 2068  "".        def h
+000240e0: 6f6c 6c6f 7728 7829 3a0a 2020 2020 2020  ollow(x):.      
+000240f0: 2020 2020 2020 7072 696e 7428 7820 2a20        print(x * 
+00024100: 3229 0a20 2020 2022 2222 290a 2020 2020  2).    """).    
+00024110: 6970 7974 686f 6e28 2222 220a 2020 2020  ipython(""".    
+00024120: 2020 2020 496e 205b 315d 3a20 696d 706f      In [1]: impo
+00024130: 7274 2070 7966 6c79 6279 3b20 7079 666c  rt pyflyby; pyfl
+00024140: 7962 792e 656e 6162 6c65 5f61 7574 6f5f  yby.enable_auto_
+00024150: 696d 706f 7274 6572 2829 0a20 2020 2020  importer().     
+00024160: 2020 2049 6e20 5b32 5d3a 2025 6465 6275     In [2]: %debu
+00024170: 6720 7065 656b 736b 696c 6c34 3336 3636  g peekskill43666
+00024180: 3933 302e 686f 6c6c 6f77 2836 3736 3538  930.hollow(67658
+00024190: 3134 3129 0a20 2020 2020 2020 205b 5059  141).        [PY
+000241a0: 464c 5942 595d 2069 6d70 6f72 7420 7065  FLYBY] import pe
+000241b0: 656b 736b 696c 6c34 3336 3636 3933 300a  ekskill43666930.
+000241c0: 2020 2020 2020 2020 4e4f 5445 3a20 456e          NOTE: En
+000241d0: 7465 7220 2763 2720 6174 2074 6865 2069  ter 'c' at the i
+000241e0: 7064 623e 2020 7072 6f6d 7074 2074 6f20  pdb>  prompt to 
+000241f0: 636f 6e74 696e 7565 2065 7865 6375 7469  continue executi
+00024200: 6f6e 2e0a 2020 2020 2020 2020 3e20 3c73  on..        > <s
+00024210: 7472 696e 673e 2831 293c 6d6f 6475 6c65  tring>(1)<module
+00024220: 3e28 290a 2020 2020 2020 2020 6970 6462  >().        ipdb
+00024230: 3e20 630a 2020 2020 2020 2020 3133 3533  > c.        1353
+00024240: 3136 3238 320a 2020 2020 2222 222c 2050  16282.    """, P
+00024250: 5954 484f 4e50 4154 483d 746d 702e 6469  YTHONPATH=tmp.di
+00024260: 722c 2066 726f 6e74 656e 643d 6672 6f6e  r, frontend=fron
+00024270: 7465 6e64 290a 0a0a 4070 7974 6573 742e  tend)...@pytest.
+00024280: 6d61 726b 2e73 6b69 7069 6628 0a20 2020  mark.skipif(.   
+00024290: 205f 4950 5954 484f 4e5f 5645 5253 494f   _IPYTHON_VERSIO
+000242a0: 4e20 3c20 2831 2c20 3029 2c0a 2020 2020  N < (1, 0),.    
+000242b0: 7265 6173 6f6e 3d22 6f6c 6420 4950 7974  reason="old IPyt
+000242c0: 686f 6e20 646f 6573 6e27 7420 7375 7070  hon doesn't supp
+000242d0: 6f72 7420 6465 6275 6720 3c73 7461 7465  ort debug <state
+000242e0: 6d65 6e74 3e22 290a 4072 6574 7279 0a64  ment>").@retry.d
+000242f0: 6566 2074 6573 745f 6465 6275 675f 6175  ef test_debug_au
+00024300: 746f 5f69 6d70 6f72 745f 7374 6174 656d  to_import_statem
+00024310: 656e 745f 7374 6570 5f31 2866 726f 6e74  ent_step_1(front
+00024320: 656e 642c 2074 6d70 293a 0a20 2020 2023  end, tmp):.    #
+00024330: 2056 6572 6966 7920 7468 6174 2073 7465   Verify that ste
+00024340: 7020 6675 6e63 7469 6f6e 616c 6974 7920  p functionality 
+00024350: 6973 6e27 7420 6272 6f6b 656e 2e0a 2020  isn't broken..  
+00024360: 2020 7772 6974 6574 6578 7428 746d 702e    writetext(tmp.
+00024370: 6469 722f 2274 6163 6f6e 6963 3732 3338  dir/"taconic7238
+00024380: 3334 3238 2e70 7922 2c20 2222 220a 2020  3428.py", """.  
+00024390: 2020 2020 2020 6465 6620 7075 6464 696e        def puddin
+000243a0: 6728 7829 3a0a 2020 2020 2020 2020 2020  g(x):.          
+000243b0: 2020 7920 3d20 7820 2a20 350a 2020 2020    y = x * 5.    
+000243c0: 2020 2020 2020 2020 7072 696e 7428 7929          print(y)
+000243d0: 0a20 2020 2022 2222 290a 2020 2020 6970  .    """).    ip
+000243e0: 7974 686f 6e28 2222 220a 2020 2020 2020  ython(""".      
+000243f0: 2020 496e 205b 315d 3a20 696d 706f 7274    In [1]: import
+00024400: 2070 7966 6c79 6279 3b20 7079 666c 7962   pyflyby; pyflyb
+00024410: 792e 656e 6162 6c65 5f61 7574 6f5f 696d  y.enable_auto_im
+00024420: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
+00024430: 2049 6e20 5b32 5d3a 2025 6465 6275 6720   In [2]: %debug 
+00024440: 7461 636f 6e69 6337 3233 3833 3432 382e  taconic72383428.
+00024450: 7075 6464 696e 6728 3438 3336 3433 3235  pudding(48364325
+00024460: 290a 2020 2020 2020 2020 5b50 5946 4c59  ).        [PYFLY
+00024470: 4259 5d20 696d 706f 7274 2074 6163 6f6e  BY] import tacon
+00024480: 6963 3732 3338 3334 3238 0a20 2020 2020  ic72383428.     
+00024490: 2020 204e 4f54 453a 2045 6e74 6572 2027     NOTE: Enter '
+000244a0: 6327 2061 7420 7468 6520 6970 6462 3e20  c' at the ipdb> 
+000244b0: 2070 726f 6d70 7420 746f 2063 6f6e 7469   prompt to conti
+000244c0: 6e75 6520 6578 6563 7574 696f 6e2e 0a20  nue execution.. 
+000244d0: 2020 2020 2020 203e 203c 7374 7269 6e67         > <string
+000244e0: 3e28 3129 3c6d 6f64 756c 653e 2829 0a20  >(1)<module>(). 
+000244f0: 2020 2020 2020 2069 7064 623e 2073 0a20         ipdb> s. 
+00024500: 2020 2020 2020 202e 2e2e 2e0a 2020 2020         .....    
+00024510: 2020 2020 6970 6462 3e20 6e0a 2020 2020      ipdb> n.    
+00024520: 2020 2020 2e2e 2e2e 0a20 2020 2020 2020      .....       
+00024530: 2069 7064 623e 2070 7269 6e74 2878 290a   ipdb> print(x).
+00024540: 2020 2020 2020 2020 3438 3336 3433 3235          48364325
+00024550: 0a20 2020 2020 2020 2069 7064 623e 2078  .        ipdb> x
+00024560: 203d 206f 732e 7061 7468 2e73 6570 0a20   = os.path.sep. 
+00024570: 2020 2020 2020 205b 5059 464c 5942 595d         [PYFLYBY]
+00024580: 2069 6d70 6f72 7420 6f73 2e70 6174 680a   import os.path.
+00024590: 2020 2020 2020 2020 6970 6462 3e20 630a          ipdb> c.
+000245a0: 2020 2020 2020 2020 2f2f 2f2f 2f0a 2020          /////.  
+000245b0: 2020 2222 222c 2050 5954 484f 4e50 4154    """, PYTHONPAT
+000245c0: 483d 746d 702e 6469 722c 2066 726f 6e74  H=tmp.dir, front
+000245d0: 656e 643d 6672 6f6e 7465 6e64 290a 0a23  end=frontend)..#
+000245e0: 2054 4f44 4f3a 2074 6573 7420 656d 6265   TODO: test embe
+000245f0: 6464 6564 206d 6f64 652e 2020 536f 6d65  dded mode.  Some
+00024600: 7468 696e 6720 6c69 6b65 2074 6869 733a  thing like this:
+00024610: 0a23 2020 2020 2020 2020 203e 3e3e 2073  .#         >>> s
+00024620: 7973 203d 2038 3631 3736 3130 340a 2320  ys = 86176104.# 
+00024630: 2020 2020 2020 2020 3e3e 3e20 696d 706f          >>> impo
+00024640: 7274 2049 5079 7468 6f6e 0a23 2020 2020  rt IPython.#    
+00024650: 2020 2020 203e 3e3e 2049 5079 7468 6f6e       >>> IPython
+00024660: 2e65 6d62 6564 2829 0a23 2020 2020 2020  .embed().#      
+00024670: 2020 202e 2e2e 2e0a 2320 2020 2020 2020     .....#       
+00024680: 2020 496e 205b 315d 3a20 696d 706f 7274    In [1]: import
+00024690: 2070 7966 6c79 6279 0a23 2020 2020 2020   pyflyby.#      
+000246a0: 2020 2049 6e20 5b32 5d3a 2070 7966 6c79     In [2]: pyfly
+000246b0: 6279 2e65 6e61 626c 655f 6175 746f 5f69  by.enable_auto_i
+000246c0: 6d70 6f72 7465 7228 290a 2320 2020 2020  mporter().#     
+000246d0: 2020 2020 496e 205b 335d 3a20 6236 3464      In [3]: b64d
+000246e0: 6563 6f64 6528 2263 4739 3362 6d46 7322  ecode("cG93bmFs"
+000246f0: 290a 2320 2020 2020 2020 2020 5b50 5946  ).#         [PYF
+00024700: 4c59 4259 5d20 6672 6f6d 2062 6173 6536  LYBY] from base6
+00024710: 3420 696d 706f 7274 2062 3634 6465 636f  4 import b64deco
+00024720: 6465 0a23 2020 2020 2020 2020 204f 7574  de.#         Out
+00024730: 5b33 5d3a 2062 2770 6f77 6e61 6c27 0a23  [3]: b'pownal'.#
+00024740: 2020 2020 2020 2020 2049 6e20 5b34 5d3a           In [4]:
+00024750: 2073 7973 0a23 2020 2020 2020 2020 204f   sys.#         O
+00024760: 7574 5b34 5d3a 2038 3631 3736 3130 340a  ut[4]: 86176104.
+00024770: 2320 2020 2020 2020 2020 496e 205b 355d  #         In [5]
+00024780: 3a20 6578 6974 2829 0a23 2020 2020 2020  : exit().#      
+00024790: 2020 203e 3e3e 2062 3634 6465 636f 6465     >>> b64decode
+000247a0: 2822 2e2e 2e22 290a 2320 2020 2020 2020  ("...").#       
+000247b0: 2020 2e2e 2e0a 2320 2020 2020 2020 2020    ....#         
+000247c0: 3e3e 3e20 6236 3465 6e63 6f64 6528 6222  >>> b64encode(b"
+000247d0: 2e2e 2e22 290a 2320 2020 2020 2020 2020  ...").#         
+000247e0: 4e61 6d65 4572 726f 723a 202e 2e2e 0a0a  NameError: .....
+000247f0: 2320 544f 444f 3a20 6164 6420 7465 7374  # TODO: add test
+00024800: 7320 666f 7220 7768 656e 2049 5079 7468  s for when IPyth
+00024810: 6f6e 2069 7320 6e6f 7420 696e 7374 616c  on is not instal
+00024820: 6c65 642e 2020 6569 7468 6572 2075 7369  led.  either usi
+00024830: 6e67 2061 2074 6f78 0a23 2065 6e76 6972  ng a tox.# envir
+00024840: 6f6e 6d65 6e74 2c20 6f72 2075 7369 6e67  onment, or using
+00024850: 2061 2050 5954 484f 4e50 4154 4820 7468   a PYTHONPATH th
+00024860: 6174 2073 6861 646f 7773 2049 5079 7468  at shadows IPyth
+00024870: 6f6e 2077 6974 6820 736f 6d65 7468 696e  on with somethin
+00024880: 670a 2320 756e 696d 706f 7274 6162 6c65  g.# unimportable
+00024890: 2e0a 0a0a 4070 7974 6573 742e 6d61 726b  ....@pytest.mark
+000248a0: 2e73 6b69 7069 6628 0a20 2020 205f 4950  .skipif(.    _IP
+000248b0: 5954 484f 4e5f 5645 5253 494f 4e20 3c20  YTHON_VERSION < 
+000248c0: 2837 2c20 3029 206f 7220 2873 7973 2e76  (7, 0) or (sys.v
+000248d0: 6572 7369 6f6e 5f69 6e66 6f20 3c20 2833  ersion_info < (3
+000248e0: 2c20 3729 292c 0a20 2020 2072 6561 736f  , 7)),.    reaso
+000248f0: 6e3d 226f 6c64 2049 5079 7468 6f6e 2061  n="old IPython a
+00024900: 6e64 2050 7974 686f 6e20 776f 6e27 7420  nd Python won't 
+00024910: 776f 726b 2077 6974 6820 6272 6561 6b70  work with breakp
+00024920: 6f69 6e74 2829 222c 0a29 0a40 7265 7472  oint()",.).@retr
+00024930: 790a 6465 6620 7465 7374 5f62 7265 616b  y.def test_break
+00024940: 706f 696e 745f 494f 5374 7265 616d 5f62  point_IOStream_b
+00024950: 726f 6b65 6e28 293a 0a20 2020 2023 2056  roken():.    # V
+00024960: 6572 6966 7920 7468 6174 2073 7465 7020  erify that step 
+00024970: 6675 6e63 7469 6f6e 616c 6974 7920 6973  functionality is
+00024980: 6e27 7420 6272 6f6b 656e 2e0a 2020 2020  n't broken..    
+00024990: 6970 7974 686f 6e28 0a20 2020 2020 2020  ipython(.       
+000249a0: 2027 2727 0a20 2020 2020 2020 2049 6e20   '''.        In 
+000249b0: 5b31 5d3a 2062 7265 616b 706f 696e 7428  [1]: breakpoint(
+000249c0: 290a 2020 2020 2020 2020 2d2d 4361 6c6c  ).        --Call
+000249d0: 2d2d 0a20 2020 2020 2020 203e 202e 2e2e  --.        > ...
+000249e0: 0a20 2020 2020 2020 2020 2020 202e 2e2e  .            ...
+000249f0: 0a20 2020 2020 2020 2020 2020 202e 2e2e  .            ...
+00024a00: 0a20 2020 2020 2020 202d 2d3e 202e 2e2e  .        --> ...
+00024a10: 2020 2020 2064 6566 205f 5f63 616c 6c5f       def __call_
+00024a20: 5f28 7365 6c66 2c20 7265 7375 6c74 3d4e  _(self, result=N
+00024a30: 6f6e 6529 3a0a 2020 2020 2020 2020 2020  one):.          
+00024a40: 2020 2e2e 2e20 2020 2020 2020 2020 2222    ...         ""
+00024a50: 2250 7269 6e74 696e 6720 7769 7468 2068  "Printing with h
+00024a60: 6973 746f 7279 2063 6163 6865 206d 616e  istory cache man
+00024a70: 6167 656d 656e 742e 0a20 2020 2020 2020  agement..       
+00024a80: 2020 2020 202e 2e2e 0a20 2020 2020 2020       ....       
+00024a90: 2069 7064 623e 2063 0a20 2020 2027 2727   ipdb> c.    '''
+00024aa0: 2c0a 2020 2020 2020 2020 6672 6f6e 7465  ,.        fronte
+00024ab0: 6e64 3d27 7072 6f6d 7074 5f74 6f6f 6c6b  nd='prompt_toolk
+00024ac0: 6974 272c 0a20 2020 2029 0a              it',.    ).
```

### Comparing `pyflyby-1.8.4/tests/test_jupyterlab_pyflyby.py` & `pyflyby-1.8.5/tests/test_jupyterlab_pyflyby.py`

 * *Files identical despite different names*

### Comparing `pyflyby-1.8.4/tests/test_livepatch.py` & `pyflyby-1.8.5/tests/test_livepatch.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,20 +1,16 @@
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import os
 import pytest
 from   shutil                   import rmtree
 import sys
 from   tempfile                 import mkdtemp
 from   textwrap                 import dedent
-import types
-
-from   six                      import PY2, PY3
 
 from   pyflyby                  import Filename, xreload
 from   pyflyby._livepatch       import UnknownModuleError
 
 
 @pytest.fixture
 def tpp(request):
@@ -592,66 +588,14 @@
             def stone(self): return 23495300
         class T(B):
             def rock(self): return self.stone() + 6
     """)
     xreload("shoulder77076723")
     assert t.rock() == 23495306
 
-@pytest.mark.skipif(
-    PY3,
-    reason="Python 3 doesn't have old style classes")
-def test_xreload_oldstyle_to_newstyle_1(tpp):
-    # Verify that when a class changes from old-style to new-style we fallback
-    # to not patching.
-    writetext(tpp/"elite49829216.py", """
-        class Bride():
-            def judge(self): return 13184519
-    """)
-    import elite49829216 as m
-    Bride = m.Bride
-    assert   Bride().judge() == 13184519
-    assert m.Bride().judge() == 13184519
-    assert     isinstance(  Bride, types.ClassType)
-    assert     isinstance(m.Bride, types.ClassType)
-    writetext(tpp/"elite49829216.py", """
-        class Bride(object):
-            def judge(self): return 21901074
-    """)
-    xreload("elite49829216")
-    assert   Bride().judge() == 13184519
-    assert m.Bride().judge() == 21901074
-    assert     isinstance(  Bride, types.ClassType)
-    assert not isinstance(m.Bride, types.ClassType)
-
-@pytest.mark.skipif(
-    PY3,
-    reason="Python 3 doesn't have old style classes")
-def test_xreload_newstyle_to_oldstyle_1(tpp):
-    # Verify that when a class changes from new-style to old-style we fallback
-    # to not patching.
-    writetext(tpp/"display5888706449829216.py", """
-        class Child(object):
-            def peach(self): return 14071526
-    """)
-    import display5888706449829216 as m
-    Child = m.Child
-    assert   Child().peach() == 14071526
-    assert m.Child().peach() == 14071526
-    assert not isinstance(  Child, types.ClassType)
-    assert not isinstance(m.Child, types.ClassType)
-    writetext(tpp/"display5888706449829216.py", """
-        class Child():
-            def peach(self): return 27893050
-    """)
-    xreload("display5888706449829216")
-    assert   Child().peach() == 14071526
-    assert m.Child().peach() == 27893050
-    assert not isinstance(  Child, types.ClassType)
-    assert     isinstance(m.Child, types.ClassType)
-
 
 def test_xreload_classmethod_1(tpp):
     # Verify that xreload works on classmethods.
     writetext(tpp/"weekday4165008.py", """
         class Monday(object):
             x = 100
             @classmethod
@@ -1807,251 +1751,147 @@
     assert C.a is A
     assert C.b is B
 
 
 def test_xreload_metaclass_function_1(tpp):
     # Verify that xreload() works correctly when the metaclass is a custom
     # function.
-    if PY2:
-        writetext(tpp/"weird32312765.py", """
-            def my_meta(name, bases, attrs):
-                attrs['bar'] = attrs.pop("foo")
-                return type(name, bases, attrs)
-            class Sport(object):
-                __metaclass__ = my_meta
-                def __init__(self, x):
-                    self.x = x
-                def foo(self, y):
-                    return self.x + y
-        """)
-    else:
-        writetext(tpp/"weird32312765.py", """
-            def my_meta(name, bases, attrs):
-                attrs['bar'] = attrs.pop("foo")
-                return type(name, bases, attrs)
-            class Sport(object, metaclass=my_meta):
-                def __init__(self, x):
-                    self.x = x
-                def foo(self, y):
-                    return self.x + y
-        """)
+    writetext(tpp/"weird32312765.py", """
+        def my_meta(name, bases, attrs):
+            attrs['bar'] = attrs.pop("foo")
+            return type(name, bases, attrs)
+        class Sport(object, metaclass=my_meta):
+            def __init__(self, x):
+                self.x = x
+            def foo(self, y):
+                return self.x + y
+    """)
 
     from weird32312765 import Sport
     a = Sport(34129000)
     assert a.bar(3) == 34129003
     assert not hasattr(a, 'foo')
-    if PY2:
-        writetext(tpp/"weird32312765.py", """
-            def my_meta(name, bases, attrs):
-                attrs['bar'] = attrs.pop("foo")
-                return type(name, bases, attrs)
-            class Sport(object):
-                __metaclass__ = my_meta
-                def __init__(self, x):
-                    self.x = x
-                def foo(self, y):
-                    return self.x + 2*y
-        """)
-    else:
-        writetext(tpp/"weird32312765.py", """
-            def my_meta(name, bases, attrs):
-                attrs['bar'] = attrs.pop("foo")
-                return type(name, bases, attrs)
-            class Sport(object, metaclass=my_meta):
-                def __init__(self, x):
-                    self.x = x
-                def foo(self, y):
-                    return self.x + 2*y
-        """)
+    writetext(tpp/"weird32312765.py", """
+        def my_meta(name, bases, attrs):
+            attrs['bar'] = attrs.pop("foo")
+            return type(name, bases, attrs)
+        class Sport(object, metaclass=my_meta):
+            def __init__(self, x):
+                self.x = x
+            def foo(self, y):
+                return self.x + 2*y
+    """)
     xreload("weird32312765")
     assert a.bar(3) == 34129006
     assert not hasattr(a, 'foo')
 
 
 def test_xreload_metaclass_subclass_type_separate_file_1(tpp):
     # Verify that xreload() works correctly when the metaclass is a custom
     # subclass of type, and the metaclass is defined in another file.
     writetext(tpp/"metaclass17670900.py", """
         class MyType(type):
             def __new__(cls, name, bases, attrs):
                 attrs['bar'] = attrs.pop("foo")
                 return type.__new__(cls, name, bases, attrs)
     """)
-    if PY2:
-        writetext(tpp/"research72020159.py", """
-            from metaclass17670900 import MyType
-            class Employment(object):
-                __metaclass__ = MyType
-                def __init__(self, x):
-                    self.x = x
-                def foo(self, y):
-                    return self.x + y
-        """)
-    else:
-        writetext(tpp/"research72020159.py", """
-            from metaclass17670900 import MyType
-            class Employment(object, metaclass=MyType):
-                def __init__(self, x):
-                    self.x = x
-                def foo(self, y):
-                    return self.x + y
-        """)
+    writetext(tpp/"research72020159.py", """
+        from metaclass17670900 import MyType
+        class Employment(object, metaclass=MyType):
+            def __init__(self, x):
+                self.x = x
+            def foo(self, y):
+                return self.x + y
+    """)
 
 
     from research72020159 import Employment
     a = Employment(97993000)
     assert a.bar(4) == 97993004
     assert not hasattr(a, 'foo')
-    if PY2:
-        writetext(tpp/"research72020159.py", """
-            from metaclass17670900 import MyType
-            class Employment(object):
-                __metaclass__ = MyType
-                def __init__(self, x):
-                    self.x = x
-                def foo(self, y):
-                    return self.x + 2*y
-        """)
-    else:
-        writetext(tpp/"research72020159.py", """
-            from metaclass17670900 import MyType
-            class Employment(object, metaclass=MyType):
-                def __init__(self, x):
-                    self.x = x
-                def foo(self, y):
-                    return self.x + 2*y
-        """)
+    writetext(tpp/"research72020159.py", """
+        from metaclass17670900 import MyType
+        class Employment(object, metaclass=MyType):
+            def __init__(self, x):
+                self.x = x
+            def foo(self, y):
+                return self.x + 2*y
+    """)
 
     xreload("research72020159")
     assert a.bar(4) == 97993008
     assert not hasattr(a, 'foo')
 
 
 def test_xreload_metaclass_subclass_type_same_file_1(tpp):
     # Verify that xreload() works correctly when the metaclass is a custom
     # class of type, and the metaclass is defined in the same file.
-    if PY2:
-        writetext(tpp/"damage28847789.py", """
-            class MyType(type):
-                def __new__(cls, name, bases, attrs):
-                    attrs['bar'] = attrs.pop("foo")
-                    return type.__new__(cls, name, bases, attrs)
-            class Agriculture(object):
-                __metaclass__ = MyType
-                def __init__(self, x):
-                    self.x = x
-                def foo(self, y):
-                    return self.x + y
-        """)
-    else:
-        writetext(tpp/"damage28847789.py", """
-            class MyType(type):
-                def __new__(cls, name, bases, attrs):
-                    attrs['bar'] = attrs.pop("foo")
-                    return type.__new__(cls, name, bases, attrs)
-            class Agriculture(object, metaclass=MyType):
-                def __init__(self, x):
-                    self.x = x
-                def foo(self, y):
-                    return self.x + y
-        """)
+    writetext(tpp/"damage28847789.py", """
+        class MyType(type):
+            def __new__(cls, name, bases, attrs):
+                attrs['bar'] = attrs.pop("foo")
+                return type.__new__(cls, name, bases, attrs)
+        class Agriculture(object, metaclass=MyType):
+            def __init__(self, x):
+                self.x = x
+            def foo(self, y):
+                return self.x + y
+    """)
 
     from damage28847789 import Agriculture
     a = Agriculture(72991000)
     assert a.bar(3) == 72991003
     assert not hasattr(a, 'foo')
-    if PY2:
-        writetext(tpp/"damage28847789.py", """
-            class MyType(type):
-                def __new__(cls, name, bases, attrs):
-                    attrs['bar'] = attrs.pop("foo")
-                    return type.__new__(cls, name, bases, attrs)
-            class Agriculture(object):
-                __metaclass__ = MyType
-                def __init__(self, x):
-                    self.x = x
-                def foo(self, y):
-                    return self.x + 2*y
-        """)
-    else:
-        writetext(tpp/"damage28847789.py", """
-            class MyType(type):
-                def __new__(cls, name, bases, attrs):
-                    attrs['bar'] = attrs.pop("foo")
-                    return type.__new__(cls, name, bases, attrs)
-            class Agriculture(object, metaclass=MyType):
-                def __init__(self, x):
-                    self.x = x
-                def foo(self, y):
-                    return self.x + 2*y
-        """)
+    writetext(tpp/"damage28847789.py", """
+        class MyType(type):
+            def __new__(cls, name, bases, attrs):
+                attrs['bar'] = attrs.pop("foo")
+                return type.__new__(cls, name, bases, attrs)
+        class Agriculture(object, metaclass=MyType):
+            def __init__(self, x):
+                self.x = x
+            def foo(self, y):
+                return self.x + 2*y
+    """)
 
     xreload("damage28847789")
     assert a.bar(3) == 72991006
     assert not hasattr(a, 'fooxreload_')
 
 
 def test_xreload_metaclass_changed_1(tpp):
     # Verify that xreload() works correctly when the metaclass definition
     # changed.
-    if PY2:
-        writetext(tpp/"commitee91173998.py", """
-            class MyType(type):
-                def __new__(cls, name, bases, attrs):
-                    attrs['technology'] = attrs.pop("procedure")
-                    return type.__new__(cls, name, bases, attrs)
-            class Significance(object):
-                __metaclass__ = MyType
-                def __init__(self, x):
-                    self.x = x
-                def procedure(self, y):
-                    return self.x + y
-        """)
-    else:
-        writetext(tpp/"commitee91173998.py", """
-            class MyType(type):
-                def __new__(cls, name, bases, attrs):
-                    attrs['technology'] = attrs.pop("procedure")
-                    return type.__new__(cls, name, bases, attrs)
-            class Significance(object, metaclass=MyType):
-                def __init__(self, x):
-                    self.x = x
-                def procedure(self, y):
-                    return self.x + y
-        """)
+    writetext(tpp/"commitee91173998.py", """
+        class MyType(type):
+            def __new__(cls, name, bases, attrs):
+                attrs['technology'] = attrs.pop("procedure")
+                return type.__new__(cls, name, bases, attrs)
+        class Significance(object, metaclass=MyType):
+            def __init__(self, x):
+                self.x = x
+            def procedure(self, y):
+                return self.x + y
+    """)
 
     from commitee91173998 import Significance
     x = Significance(56638000)
     assert x.technology(3) == 56638003
     assert not hasattr(x, 'procedure')
-    if PY2:
-        writetext(tpp/"commitee91173998.py", """
-            class MyType(type):
-                def __new__(cls, name, bases, attrs):
-                    attrs['cloud'] = attrs.pop("procedure")
-                    return type.__new__(cls, name, bases, attrs)
-            class Significance(object):
-                __metaclass__ = MyType
-                def __init__(self, x):
-                    self.x = x
-                def procedure(self, y):
-                    return self.x + 2*y
-        """)
-    else:
-        writetext(tpp/"commitee91173998.py", """
-            class MyType(type):
-                def __new__(cls, name, bases, attrs):
-                    attrs['cloud'] = attrs.pop("procedure")
-                    return type.__new__(cls, name, bases, attrs)
-            class Significance(object, metaclass=MyType):
-                def __init__(self, x):
-                    self.x = x
-                def procedure(self, y):
-                    return self.x + 2*y
-        """)
+    writetext(tpp/"commitee91173998.py", """
+        class MyType(type):
+            def __new__(cls, name, bases, attrs):
+                attrs['cloud'] = attrs.pop("procedure")
+                return type.__new__(cls, name, bases, attrs)
+        class Significance(object, metaclass=MyType):
+            def __init__(self, x):
+                self.x = x
+            def procedure(self, y):
+                return self.x + 2*y
+    """)
 
     xreload("commitee91173998")
     assert x.cloud(3) == 56638006
     assert not hasattr(x, 'procedure')
     assert not hasattr(x, 'technology')
```

### Comparing `pyflyby-1.8.4/tests/test_modules.py` & `pyflyby-1.8.5/tests/test_modules.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,14 +1,13 @@
 # pyflyby/test_modules.py
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 
 import logging.handlers
 from   pyflyby._file            import Filename
 from   pyflyby._idents          import DottedIdentifier
 from   pyflyby._modules         import ModuleHandle
 import re
```

### Comparing `pyflyby-1.8.4/tests/test_parse.py` & `pyflyby-1.8.5/tests/test_parse.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,22 +1,19 @@
 # pyflyby/test_parse.py
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import pytest
 import sys
 from   textwrap                 import dedent
 import warnings
 
-from   six                      import PY2, PY3
-
 from   pyflyby._file            import FilePos, FileText, Filename
 from   pyflyby._flags           import CompilerFlags
 from   pyflyby._parse           import PythonBlock, PythonStatement
 from   pyflyby._imports2s       import SourceToSourceFileImportsTransformation
 
 
 if sys.version_info < (3, 8, 3):
@@ -460,24 +457,14 @@
     """).lstrip())
     expected = [PythonBlock('C(13798505)\n', startpos=(2,5)),
                 PythonBlock('C(25709748)\n', startpos=(4,9)),
                 PythonBlock('C(32231717)\n', startpos=(6,9))]
     assert block.get_doctests() == expected
 
 
-@pytest.mark.skipif(
-    PY3,
-    reason="print function is not invalid syntax in Python 3.")
-def test_PythonBlock_flags_bad_1():
-    # In Python2.x, this should cause a syntax error, since we didn't do
-    # flags='print_function':
-    with pytest.raises(SyntaxError):
-        PythonBlock('print("x",\n file=None)\n').statements
-
-
 def test_PythonBlock_flags_good_1():
     PythonBlock('print("x",\n file=None)\n', flags="print_function").statements
 
 
 def test_PythonBlock_flags_1():
     block = PythonBlock('print("x",\n file=None)\n', flags="print_function")
     with warnings.catch_warnings():
@@ -556,23 +543,23 @@
     assert s.output() == block
 
 
 examples_transform = ["""
     a = None # type: ignore
     """]
 
-if PY3:
-    examples_transform.append(
+examples_transform.append(
+"""
+class A:
+    async def func(self, location: str) -> bytes:
+        async with aiofiles.open(location, "rb") as file:
+            return await file.read()
     """
-    class A:
-        async def func(self, location: str) -> bytes:
-            async with aiofiles.open(location, "rb") as file:
-                return await file.read()
-        """
         )
+
 if sys.version_info >= (3, 8):
     examples_transform.append(
     # positional only
     """ 
     def f(x, y=None, / , z=None):
          pass"""
         )
@@ -677,22 +664,14 @@
 
 
 def test_PythonStatement_bad_from_multi_statements_1():
     with pytest.raises(ValueError):
         PythonStatement("a\nb\n")
 
 
-@pytest.mark.skipif(PY3, reason="print function is not invalid syntax in Python 3.")
-def test_PythonStatement_flags_bad_1():
-    # In Python2.x, this should cause a syntax error, since we didn't do
-    # flags='print_function':
-    with pytest.raises(SyntaxError):
-        PythonStatement('print("x",\n file=None)\n')
-
-
 def test_PythonStatement_flags_good_1():
     PythonStatement('print("x",\n file=None)\n', flags="print_function")
 
 
 def test_str_lineno_simple_1():
     block = PythonBlock(dedent(r'''
         a = [
@@ -789,38 +768,27 @@
 
 def test_str_lineno_strprefix_1():
     code = r'''
         r"aa\nbb"
         0
         r"x"
 '''
-    if PY2:
-        # ur"" is not valid syntax in Python 3
-        code += r'''        Ur"""cc\n
-        dd"""
-    '''
     block = PythonBlock(dedent(code).lstrip(), startpos=(101,1))
     expected_statements = (
         PythonStatement('r"aa\\nbb"\n'       , startpos=(101,1)),
         PythonStatement('0\n'                , startpos=(102,1)),
         PythonStatement('r"x"\n'             , startpos=(103,1)),
     )
-    if PY2:
-        expected_statements += (
-        PythonStatement('Ur"""cc\\n\ndd"""\n', startpos=(104,1)),
-    )
     assert block.statements == expected_statements
     literals = [(f.s, f.startpos) for f in block.string_literals()]
     expected_literals = [
         ('aa\\nbb'  , FilePos(101,1)),
         ('x'        , FilePos(103,1)),
     ]
 
-    if PY2:
-        expected_literals += [('cc\\n\ndd', FilePos(104,1))]
     assert literals == expected_literals
 
 
 def test_str_lineno_escaped_single_1():
     block = PythonBlock(dedent(r'''
         x = "a\
         #b" 'c\
@@ -871,25 +839,14 @@
         """
         P
         """
         "Q" "q"""
         "R" "r""" + "S""""s""S""""s""""
         S"""
 '''
-    if PY2:
-        # ur"" is not valid syntax in Python 3
-        code += """\
-        Ur'''
-        t'''
-"""
-        # Implicit string concatenation of non-bytes and bytes literals is not
-        # valid syntax in Python 3
-        code += '''\
-        r"U" u'u' b"""U"""
-    '''
 
     block = PythonBlock(dedent(code).lstrip(), startpos=(101,1))
     expected_statements = (
         PythonStatement('''"A" "a"\n'''            , startpos=(101,1)),
         PythonStatement('''"B" 'b'\n'''            , startpos=(102,1)),
         PythonStatement(''''C' 'c'\n'''            , startpos=(103,1)),
         PythonStatement(''''D' "d"\n'''            , startpos=(104,1)),
@@ -904,19 +861,15 @@
         PythonStatement('''r"M" u\'m\'\n''' , startpos=(122,1)),
         PythonStatement('''"N" ''"" "n" """"""\'\'\'\'\'\'\'N\'\'\'\n'''  , startpos=(123,1)),
         PythonStatement('''"""\nO\n"""\n'''        , startpos=(124,1)),
         PythonStatement('''"""\nP\n"""\n'''        , startpos=(127,1)),
         PythonStatement('''"Q" "q"""\n'''          , startpos=(130,1)),
         PythonStatement('''"R" "r""" + "S""""s""S""""s""""\nS"""\n'''     , startpos=(131,1)),
     )
-    if PY2:
-        expected_statements += (
-            PythonStatement("""Ur'''\nt'''\n""" , startpos=(133,1)),
-            PythonStatement('''r"U" u'u' b"""U"""\n''' , startpos=(135,1)),
-        )
+
     assert block.statements == expected_statements
     literals = [(f.s, f.startpos) for f in block.string_literals()]
     expected_literals = [
         ("Aa", FilePos(101,1)),
         ("Bb", FilePos(102,1)),
         ("Cc", FilePos(103,1)),
         ("Dd", FilePos(104,1)),
@@ -932,19 +885,14 @@
         ("NnN", FilePos(123,1)),
         ("\nO\n", FilePos(124,1)),
         ("\nP\n", FilePos(127,1)),
         ("Qq", FilePos(130,1)),
         ("Rr", FilePos(131,1)),
         ('Ss""Ss\nS', FilePos(131,13)),
     ]
-    if PY2:
-        expected_literals += [
-            ('\nt', FilePos(133, 1)),
-            ("UuU", FilePos(135,1)),
-        ]
     assert literals == expected_literals
 
 
 def test_PythonBlock_compound_statements_1():
     block = PythonBlock(dedent('''
         foo(); bar()
         if condition:
@@ -1068,17 +1016,14 @@
     '''))
     doctest_blocks = block.get_doctests()
     doctest_block, = doctest_blocks
     expected = (PythonStatement("123 # doctest:+FOOBAR\n", startpos=(4, 9)),)
     assert doctest_block.statements == expected
 
 
-@pytest.mark.skipif(
-    sys.version_info < (2,7),
-    reason="Old Python doesn't support multiple context managers")
 def test_PythonBlock_with_multi_1():
     block = PythonBlock(dedent('''
         with   A  as  a, B as b, C as c:
             pass
     ''').lstrip(), startpos=(101,1))
     expected = (
         PythonStatement("with   A  as  a, B as b, C as c:\n    pass\n",
@@ -1093,42 +1038,22 @@
 #   pf = code contains print function
 #   pn = code does not contain print statement or function
 #   px = code contains ambiguous print statement/function
 #   flagps = flags does not contain CompilerFlags("print_function")
 #   flagpf = flags contains CompilerFlags("print_function")
 #   futpf = code contains 'from __future__ import print_function'
 
-@pytest.mark.skipif(
-    PY3,
-    reason="print statement not valid syntax in Python 3.")
-def test_PythonBlock_no_auto_flags_ps_flagps_1():
-    block = PythonBlock(dedent('''
-        print 42
-    ''').lstrip())
-    assert not (block.flags                & "print_function")
-    assert not (block.ast_node.input_flags & "print_function")
-    assert not (block.source_flags         & "print_function")
 
 def test_PythonBlock_no_auto_flags_ps_flagpf_1():
     block = PythonBlock(dedent('''
         print 42
     ''').lstrip(), flags="print_function")
     with pytest.raises(SyntaxError):
         block.ast_node
 
-@pytest.mark.skipif(
-    PY3,
-    reason="print function is not invalid syntax in Python 3.")
-def test_PythonBlock_no_auto_flags_pf_flagps_1():
-    block = PythonBlock(dedent('''
-        print(42, out=x)
-    ''').lstrip())
-    with pytest.raises(SyntaxError):
-        block.ast_node
-
 
 def test_PythonBlock_no_auto_flags_pf_flagpf_1():
     block = PythonBlock(dedent('''
         print(42, out=x)
     ''').lstrip(), flags="print_function")
     assert     (block.flags                & "print_function")
     assert     (block.ast_node.input_flags & "print_function")
@@ -1197,38 +1122,14 @@
         42
     ''').lstrip())
     assert     (block.flags                & "print_function")
     assert not (block.ast_node.input_flags & "print_function")
     assert     (block.source_flags         & "print_function")
 
 
-@pytest.mark.skipif(
-    PY3,
-    reason="print statement is not valid syntax in Python 3.")
-def test_PythonBlock_auto_flags_ps_flagps_1():
-    block = PythonBlock(dedent('''
-        print 42
-    ''').lstrip(), auto_flags=True)
-    assert not (block.flags                & "print_function")
-    assert not (block.ast_node.input_flags & "print_function")
-    assert not (block.source_flags         & "print_function")
-
-
-@pytest.mark.skipif(
-    PY3,
-    reason="print statement is not valid syntax in Python 3.")
-def test_PythonBlock_auto_flags_ps_flagpf_1():
-    block = PythonBlock(dedent('''
-        print 42
-    ''').lstrip(), flags="print_function", auto_flags=True)
-    assert not (block.flags                & "print_function")
-    assert not (block.ast_node.input_flags & "print_function")
-    assert not (block.source_flags         & "print_function")
-
-
 def test_PythonBlock_auto_flags_ps_flagpf_futpf_1():
     block = PythonBlock(dedent('''
         from __future__ import print_function
         print 42
     ''').lstrip(), flags="print_function", auto_flags=True)
     with pytest.raises(SyntaxError):
         block.ast_node
@@ -1243,22 +1144,17 @@
         block.ast_node
 
 
 def test_PythonBlock_auto_flags_pf_flagps_1():
     block = PythonBlock(dedent('''
         print(42, out=x)
     ''').lstrip(), auto_flags=True)
-    if PY2:
-        assert     (block.flags                & "print_function")
-        assert     (block.ast_node.input_flags & "print_function")
-        assert not (block.source_flags         & "print_function")
-    else:
-        assert not (block.flags                & "print_function")
-        assert not (block.ast_node.input_flags & "print_function")
-        assert not (block.source_flags         & "print_function")
+    assert not (block.flags                & "print_function")
+    assert not (block.ast_node.input_flags & "print_function")
+    assert not (block.source_flags         & "print_function")
 
 
 def test_PythonBlock_auto_flags_pf_flagpf_1():
     block = PythonBlock(dedent('''
         print(42, out=x)
     ''').lstrip(), flags="print_function", auto_flags=True)
     assert     (block.flags                & "print_function")
@@ -1383,19 +1279,15 @@
         "from __future__ import unicode_literals\nprint(1,file=x)\n",
         flags="division", auto_flags=True)
     s0, s1 = block.statements
     assert s0.block.source_flags == CompilerFlags("unicode_literals")
     with warnings.catch_warnings():
         warnings.simplefilter("ignore", DeprecationWarning)
         assert s1.block.source_flags == CompilerFlags(0)
-    if PY2:
-        expected = CompilerFlags("unicode_literals", "division",
-                                 "print_function")
-    else:
-        expected = CompilerFlags("unicode_literals", "division")
+    expected = CompilerFlags("unicode_literals", "division")
     assert s0.block.flags        == expected
     assert s1.block.flags        == expected
 
 
 def test_parsable_1():
     block = PythonBlock("if 1:\n  2")
     assert block.parsable
@@ -1407,58 +1299,47 @@
 
 
 def test_parsable_explicit_flags_1():
     block = PythonBlock("print(3, file=4)", flags="print_function")
     assert block.parsable
 
 
-@pytest.mark.skipif(
-    PY3,
-    reason="print function is not invalid syntax in Python 3.")
-def test_parsable_missing_flags_no_auto_flags_1():
-    block = PythonBlock("print(3, file=4)")
-    assert not block.parsable
-
-
 def test_parsable_missing_flags_auto_flags_1():
     block = PythonBlock("print(3, file=4)", auto_flags=True)
     assert block.parsable
 
 
-@pytest.mark.skipif(PY2, reason="invalid early python syntax")
 @pytest.mark.parametrize(
     "input",
     [
         "print(abc=123, *args, **kwargs)",
         "print(*args, ijk=123, **kwargs)",
         "print(7, *args, **kwargs)",
         "print(*args, 12, **kwargs)",
     ],
 )
 def test_parsable_Call_Ast_args_kwargs(input):
     block = PythonBlock(input, auto_flags=True)
     assert block.annotated_ast_node
 
 
-@pytest.mark.skipif(PY2, reason="invalid early python syntax")
 @pytest.mark.parametrize(
     "input",
     [
         """
 def func(x: List[int], y: List[int]) -> List[int]:
     return x + y
 """
     ],
 )
 def test_parsable_annotation_order(input):
     block = PythonBlock(input, auto_flags=True)
     assert block.annotated_ast_node
 
 
-@pytest.mark.skipif(PY2, reason="invalid early python syntax")
 @pytest.mark.parametrize(
     "input",
     [
         '''x='abc'
 f"""\
 This is a
 multi-line
@@ -1487,15 +1368,14 @@
     ],
 )
 def test_parse_f_string_ast_ann(input):
     block = PythonBlock(input, auto_flags=True)
     assert block.annotated_ast_node
 
 
-@pytest.mark.skipif(PY2, reason="invalid early python syntax")
 @pytest.mark.parametrize(
     "input",
     [
         """
 x = 123
 fail_here = f"{x.stem} is no-op. \\
 (Do we need to delete this still?)"
@@ -1510,14 +1390,18 @@
 """)
 ''',
 '''
 def foo():
     return f"""
         {name}
     """
+''',
+'''
+func(arg=f"""
+""")
 '''
     ],
 )
 def test_join_formatted_string_columns(input):
     block = PythonBlock(input, auto_flags=True)
     assert block.annotated_ast_node
```

### Comparing `pyflyby-1.8.4/tests/test_py.py` & `pyflyby-1.8.5/tests/test_py.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,26 +1,25 @@
 # pyflyby/test_py.py
 
 # License for THIS FILE ONLY: CC0 Public Domain Dedication
 # http://creativecommons.org/publicdomain/zero/1.0/
 
-from __future__ import (absolute_import, division, print_function,
-                        with_statement)
+
 
 import os
 import pytest
 from   shutil                   import rmtree
 import six
 import subprocess
 import sys
 import tempfile
 from   tempfile                 import NamedTemporaryFile, mkdtemp
 from   textwrap                 import dedent
 
-from   six                      import PY2, PY3, string_types
+from   six                      import string_types
 
 import pyflyby
 from   pyflyby._file            import Filename
 from   pyflyby._util            import cached_attribute
 
 
 PYFLYBY_HOME = Filename(__file__).real.dir.dir
@@ -161,73 +160,60 @@
 def test_eval_1():
     result = py("--eval", "b64decode('VGhvbXBzb24=')")
     expected = dedent("""
         [PYFLYBY] from base64 import b64decode
         [PYFLYBY] b64decode('VGhvbXBzb24=')
         b'Thompson'
     """).strip()
-    if PY2:
-        expected = expected.replace("b'Thompson'", "'Thompson'")
     assert expected == result
 
 
 def test_eval_single_dash_1():
     result = py("-eval", "b64decode('V29vc3Rlcg==')")
     expected = dedent("""
         [PYFLYBY] from base64 import b64decode
         [PYFLYBY] b64decode('V29vc3Rlcg==')
         b'Wooster'
     """).strip()
-    if PY2:
-        expected = expected.replace("b'Wooster'", "'Wooster'")
     assert expected == result
 
 
 def test_eval_equals_1():
     result = py("--eval=b64decode('TWVyY2Vy')")
     expected = dedent("""
         [PYFLYBY] from base64 import b64decode
         [PYFLYBY] b64decode('TWVyY2Vy')
         b'Mercer'
     """).strip()
-    if PY2:
-        expected = expected.replace("b'Mercer'", "'Mercer'")
     assert expected == result
 
 
 def test_eval_single_dash_equals_1():
     result = py("-eval=b64decode('VW5pdmVyc2l0eQ==')")
     expected = dedent("""
         [PYFLYBY] from base64 import b64decode
         [PYFLYBY] b64decode('VW5pdmVyc2l0eQ==')
         b'University'
     """).strip()
-    if PY2:
-        expected = expected.replace("b'University'", "'University'")
     assert expected == result
 
 
 def test_eval_c_1():
     result = py("-c", "b64decode('QmxlZWNrZXI=')")
     expected = dedent("""
         [PYFLYBY] from base64 import b64decode
         [PYFLYBY] b64decode('QmxlZWNrZXI=')
         b'Bleecker'
     """).strip()
-    if PY2:
-        expected = expected.replace("b'Bleecker'", "'Bleecker'")
     assert expected == result
 
 
 def test_eval_quiet_1():
     result = py("-q", "-c", "b64decode('U3VsbGl2YW4=')")
-    if PY2:
-        expected = "'Sullivan'"
-    else:
-        expected = "b'Sullivan'"
+    expected = "b'Sullivan'"
     assert expected == result
 
 
 def test_eval_expression_1():
     result = py("--eval", "calendar.WEDNESDAY")
     expected = dedent("""
         [PYFLYBY] import calendar
@@ -246,16 +232,14 @@
 def test_exec_1():
     result = py("-c", "if 1: print(b64decode('UHJpbmNl'))")
     expected = dedent("""
         [PYFLYBY] from base64 import b64decode
         [PYFLYBY] if 1: print(b64decode('UHJpbmNl'))
         b'Prince'
     """).strip()
-    if PY2:
-        expected = expected.replace("b'Prince'", "Prince")
     assert expected == result
 
 
 def test_argv_1():
     result = py("-c", "sys.argv", "x", "y")
     expected = dedent("""
         [PYFLYBY] import sys
@@ -368,122 +352,32 @@
     expected = dedent("""
         [PYFLYBY] round(2.984375, ndigits=3)
         2.984
     """).strip()
     assert expected == result
 
 
-@pytest.mark.skipif(
-    sys.version_info[0] != 3, reason="keyword-only args require Python 3"
-)
 def test_apply_kwonlyargs_1():
     result = py("--apply", "lambda x, *, y: x + y", "2", "--y=3")
     expected = dedent("""
         [PYFLYBY] (lambda x, *, y: x + y)(2, y=3)
         5
     """).strip()
     assert expected == result
 
 
-@pytest.mark.skipif(
-    sys.version_info[0] != 3, reason="keyword-only args require Python 3"
-)
 def test_apply_kwonlyargs_2():
     result = py("--apply", "lambda x, *, y, z=1: x + y + z", "2", "--y=3")
     expected = dedent("""
         [PYFLYBY] (lambda x, *, y, z=1: x + y + z)(2, y=3, z=1)
         6
     """).strip()
     assert expected == result
 
 
-@pytest.mark.skipif(
-    sys.version_info[0] != 3, reason="keyword-only args require Python 3"
-)
-def test_apply_kwonlyargs_3():
-    result = py("--apply", "lambda x, *, y, z=1: x + y + z", "2", "--y=3", "--z=4")
-    expected = dedent("""
-        [PYFLYBY] (lambda x, *, y, z=1: x + y + z)(2, y=3, z=4)
-        9
-    """).strip()
-    assert expected == result
-
-
-@pytest.mark.skipif(
-    sys.version_info[0] != 3, reason="keyword-only args require Python 3"
-)
-def test_apply_kwonlyargs_4():
-    result = py("--apply", "lambda x, *, y, z=1: x + y + z", "2", "3")
-    expected = dedent("""
-        [PYFLYBY] missing required keyword argument y
-
-        Python signature:
-          >>> (lambda x, *, y, z=1: x + y + z)(x, *, y, z=1)
-
-        Command-line signature:
-          $ py 'lambda x, *, y, z=1: x + y + z' x --y=... [--z=...]
-          $ py 'lambda x, *, y, z=1: x + y + z' --x=... --y=... [--z=...]
-
-        Filename:
-          <unknown>
-
-        Docstring:
-          (No docstring)
-    """).strip(), 1
-    assert expected == result
-
-
-@pytest.mark.skipif(
-    sys.version_info[0] != 3, reason="keyword-only args require Python 3"
-)
-def test_apply_kwonlyargs_5():
-    result = py("--apply", "lambda x, *, y, z=1: x + y + z", "2", "--z=3")
-    expected = dedent("""
-        [PYFLYBY] missing required keyword argument y
-
-        Python signature:
-          >>> (lambda x, *, y, z=1: x + y + z)(x, *, y, z=1)
-
-        Command-line signature:
-          $ py 'lambda x, *, y, z=1: x + y + z' x --y=... [--z=...]
-          $ py 'lambda x, *, y, z=1: x + y + z' --x=... --y=... [--z=...]
-
-        Filename:
-          <unknown>
-
-        Docstring:
-          (No docstring)
-    """).strip(), 1
-    assert expected == result
-
-
-@pytest.mark.skipif(
-    sys.version_info[0] != 3, reason="keyword-only args require Python 3"
-)
-def test_apply_unknown_option():
-    result = py("--apply", "lambda a, *, b=10, c: a + b", "2", "--b=15", "-c=1", "-d=6")
-    expected = dedent("""
-        [PYFLYBY] Unknown option name d
-
-        Python signature:
-          >>> (lambda a, *, b=10, c: a + b)(a, *, b=10, c)
-
-        Command-line signature:
-          $ py 'lambda a, *, b=10, c: a + b' a [--b=...] --c=...
-          $ py 'lambda a, *, b=10, c: a + b' --a=... [--b=...] --c=...
-
-        Filename:
-          <unknown>
-
-        Docstring:
-          (No docstring)
-    """).strip(), 1
-    assert expected == result
-
-
 def test_apply_print_function_1():
     result = py("--apply", "print", "50810461")
     expected = dedent("""
         [PYFLYBY] print(50810461)
         50810461
     """).strip()
     assert expected == result
@@ -846,24 +740,18 @@
         2.984
     """).strip()
     assert expected == result
 
 
 def test_heuristic_apply_builtin_args_2():
     result = py("round", "2.984375")
-    if PY2:
-        expected = dedent("""
-            [PYFLYBY] round(2.984375)
-            3.0
-        """).strip()
-    else:
-        expected = dedent("""
-            [PYFLYBY] round(2.984375)
-            3
-        """).strip()
+    expected = dedent("""
+        [PYFLYBY] round(2.984375)
+        3
+    """).strip()
     assert expected == result
 
 
 def test_heuristic_apply_builtin_kwargs_1():
     result = py("round", "2.984375", "--ndigits=3")
     expected = dedent("""
         [PYFLYBY] round(2.984375, ndigits=3)
@@ -924,29 +812,14 @@
         [PYFLYBY] import os
         [PYFLYBY] os.getcwd.__name__
         'getcwd'
     """).strip()
     assert expected == result
 
 
-@pytest.mark.skipif(
-    sys.version_info[0] == 3, reason="xml.dom.minidom also need import on py3"
-)
-def test_heuristic_eval_symbol_submodule_1():
-    # Verify that heuristic eval of an expression in a module in a package
-    # works, and also verify that we log the submodule import.
-    result = py("xml.dom.minidom.XMLNS_NAMESPACE")
-    expected = dedent("""
-        [PYFLYBY] import xml.dom
-        [PYFLYBY] xml.dom.minidom.XMLNS_NAMESPACE
-        'http://www.w3.org/2000/xmlns/'
-    """).strip()
-    assert expected == result
-
-
 def test_heuristic_apply_method_arg_1():
     result = py("float.is_integer", "3.0")
     expected = dedent("""
         [PYFLYBY] float.is_integer(3.0)
         True
     """).strip()
     assert expected == result
@@ -957,18 +830,15 @@
     """).strip()
     assert expected == result
 
 
 def test_apply_builtin_too_few_args_1():
     result, retcode = py("round")
     assert retcode == 1
-    if PY2:
-        assert "TypeError: Required argument 'number' (pos 1) not found" in result
-    else:
-        assert "TypeError: round() missing required argument 'number' (pos 1)" in result
+    assert "TypeError: round() missing required argument 'number' (pos 1)" in result
 
 
 def test_apply_builtin_too_many_args_1():
     result, retcode = py("round", "6", "7", "8")
     assert retcode == 1
     assert "TypeError: round() takes at most 2 arguments (3 given)" in result
 
@@ -1029,40 +899,31 @@
     assert expected == result
 
 
 def test_apply_argspec_too_few_args_1():
     result, retcode = py("base64.b64decode")
     assert retcode == 1
     assert "[PYFLYBY] missing required argument s" in result
-    if PY2:
-        assert "$ py base64.b64decode s [altchars]" in result, result
-    else:
-        assert "$ py base64.b64decode s [altchars [validate]]" in result
+    assert "$ py base64.b64decode s [altchars [validate]]" in result
 
 
 def test_apply_argspec_too_few_args_2():
     result, retcode = py("calendar.weekday")
     assert retcode == 1
     assert "[PYFLYBY] missing required argument year" in result
     assert "$ py calendar.weekday year month day" in result
 
 
 def test_apply_argspec_too_many_args_1():
     result, retcode = py("base64.b64decode", "a", "b", "c", "d")
     assert retcode == 1
-    if PY2:
-        assert ("[PYFLYBY] Too many positional arguments.  "
-                "Expected 1-2 positional argument(s): s, altchars.  "
-                "Got 4 args: a b c d") in result, result
-        assert "$ py base64.b64decode s [altchars]" in result
-    else:
-        assert ("[PYFLYBY] Too many positional arguments.  "
-        "Expected 1-3 positional argument(s): s, altchars, validate.  "
-        "Got 4 args: a b c d") in result, result
-        assert "$ py base64.b64decode s [altchars [validate]]" in result
+    assert ("[PYFLYBY] Too many positional arguments.  "
+    "Expected 1-3 positional argument(s): s, altchars, validate.  "
+    "Got 4 args: a b c d") in result, result
+    assert "$ py base64.b64decode s [altchars [validate]]" in result
 
 
 def test_apply_argspec_too_many_args_2():
     result, retcode = py("calendar.weekday", "a", "b", "c", "d")
     assert retcode == 1
     assert ("[PYFLYBY] Too many positional arguments.  "
             "Expected 3 positional argument(s): year, month, day.  "
@@ -1070,18 +931,15 @@
     assert "$ py calendar.weekday year month day" in result
 
 
 def test_apply_argspec_bad_kwarg_1():
     result, retcode = py("base64.b64decode", "x", "--christopher=sheridan")
     assert retcode == 1
     assert "[PYFLYBY] Unknown option name christopher" in result
-    if PY2:
-        assert "$ py base64.b64decode s [altchars]" in result
-    else:
-        assert "$ py base64.b64decode s [altchars [validate]]" in result
+    assert "$ py base64.b64decode s [altchars [validate]]" in result
 
 
 def test_apply_dashdash_1():
     result = py('--apply', 'print', '4.000', '--', '--help', '5.000')
     expected = dedent("""
         [PYFLYBY] print(4.0, '--help', '5.000')
         4.0 --help 5.000
@@ -1105,26 +963,14 @@
     expected = dedent("""
         [PYFLYBY] 'Astor'
         'Astor'
     """).strip()
     assert expected == result
 
 
-@pytest.mark.skipif(
-    PY3,
-    reason="Long integers are not valid syntax in Python 3.")
-def test_repr_long_1():
-    result = py("5L")
-    expected = dedent("""
-        [PYFLYBY] 5L
-        5L
-    """).strip()
-    assert expected == result
-
-
 def test_future_division_1():
     result = py("1/2")
     expected = dedent("""
         [PYFLYBY] 1/2
         0.5
     """).strip()
     assert expected == result
@@ -1146,24 +992,18 @@
         42
     """).strip()
     assert expected == result
 
 
 def test_print_statement_sep_1():
     result = py("print", "43")
-    if PY2:
-        expected = dedent("""
-            [PYFLYBY] print 43
-            43
-        """).strip()
-    else:
-        expected = dedent("""
-            [PYFLYBY] print(43)
-            43
-        """).strip()
+    expected = dedent("""
+        [PYFLYBY] print(43)
+        43
+    """).strip()
     assert expected == result
 
 
 def test_print_function_1():
     result = py("print(44, file=sys.stdout)")
     expected = dedent("""
         [PYFLYBY] import sys
@@ -1216,18 +1056,15 @@
     output = py("base64.b64encode", "--help")
     assert "s [altchars]" in output
     assert ">>> base64.b64encode(s, altchars=None)" in output
     assert "$ py base64.b64encode s [altchars]" in output
     assert "$ py base64.b64encode --s=... [--altchars=...]" in output
     assert "--version" not in output
     assert "[PYFLYBY] import base64" in output
-    if PY2:
-        assert "\n  Encode a string using Base64." in output
-    else:
-        assert "\n  Encode the bytes-like object s using Base64 and return a bytes object." in output
+    assert "\n  Encode the bytes-like object s using Base64 and return a bytes object." in output
     assert "binascii.b2a_base64" not in output
 
 
 def test_function_help_autoimport_1():
     output = py("b64encode", "--help")
     assert "[PYFLYBY] from base64 import b64encode" in output
     assert "s [altchars]" in output
@@ -1235,18 +1072,15 @@
     assert "binascii.b2a_base64" not in output
 
 
 def test_function_help_expression_1():
     output = py("sys.stdout.write", "--help")
     assert '>>> sys.stdout.write(' in output
     assert "$ py sys.stdout.write " in output
-    if PY2:
-        assert "Write string str to file." in output, output
-    else:
-        assert "Write string to stream." in output, output
+    assert "Write string to stream." in output, output
 
 
 def test_function_help_quote_need_parens_1():
     output = py('lambda a,b: a*b', '-h')
     assert ">>> (lambda a,b: a*b)(a, b)" in output
     assert "$ py 'lambda a,b: a*b' a b" in output
 
@@ -1347,32 +1181,26 @@
 def test_function_source_1():
     output = py("base64.b64encode", "--source")
     assert "[PYFLYBY] import base64" in output
     assert ">>> base64.b64encode(s, altchars=None)" in output
     assert "$ py base64.b64encode s [altchars]" in output
     assert "$ py base64.b64encode --s=... [--altchars=...]" in output
     assert "binascii.b2a_base64" in output # from source code
-    if PY2:
-        assert output.count("Encode a string using Base64") == 1, output
-    else:
-        assert output.count("Encode the bytes-like object s using Base64 and return a bytes object.") == 1
+    assert output.count("Encode the bytes-like object s using Base64 and return a bytes object.") == 1
     assert "--version" not in output
 
 
 def test_function_source_autoimport_1():
     output = py("b64encode", "--source")
     assert "[PYFLYBY] from base64 import b64encode" in output
     assert ">>> b64encode(s, altchars=None)" in output
     assert "$ py b64encode s [altchars]" in output
     assert "$ py b64encode --s=... [--altchars=...]" in output
     assert "binascii.b2a_base64" in output # from source code
-    if PY2:
-        assert output.count("Encode a string using Base64") == 1, output
-    else:
-        assert output.count("Encode the bytes-like object s using Base64 and return a bytes object.") == 1
+    assert output.count("Encode the bytes-like object s using Base64 and return a bytes object.") == 1
 
 
 @pytest.mark.parametrize("cmdline", [
     "b64encode --source",
     "b64encode -source",
     "b64encode --??",
     "b64encode -??",
@@ -1696,57 +1524,38 @@
         8
     """).strip()
     assert expected == result
 
 
 def test_print_joinstr_1():
     result = py("print", "3", "+", "5")
-    if PY2:
-        expected = dedent("""
-            [PYFLYBY] print 3 + 5
-            8
-        """).strip()
-    else:
-        expected = dedent("""
-            [PYFLYBY] print(3, '+', 5)
-            3 + 5
-        """).strip()
+    expected = dedent("""
+        [PYFLYBY] print(3, '+', 5)
+        3 + 5
+    """).strip()
     assert expected == result
 
 def test_print_joinstr_2():
     result = py("print", "3 + 5")
-    if PY2:
-        expected = dedent("""
-            [PYFLYBY] print 3 + 5
-            8
-        """).strip()
-    else:
-        expected = dedent("""
-            [PYFLYBY] print(8)
-            8
-        """).strip()
+    expected = dedent("""
+        [PYFLYBY] print(8)
+        8
+    """).strip()
     assert expected == result
 
 
 def test_join_single_arg_1():
     result = py("print", "sys")
-    if PY2:
-        expected = dedent("""
-            [PYFLYBY] import sys
-            [PYFLYBY] print sys
-            <module 'sys' (built-in)>
-        """).strip()
-    else:
-        # In autocall mode, the arguments are evaluated and the repr() is
-        # printed for the [PYFLYBY] line
-        expected = dedent("""
-            [PYFLYBY] import sys
-            [PYFLYBY] print(<module 'sys' (built-in)>)
-            <module 'sys' (built-in)>
-        """).strip()
+    # In autocall mode, the arguments are evaluated and the repr() is
+    # printed for the [PYFLYBY] line
+    expected = dedent("""
+        [PYFLYBY] import sys
+        [PYFLYBY] print(<module 'sys' (built-in)>)
+        <module 'sys' (built-in)>
+    """).strip()
 
     assert expected == result
 
 
 def test_join_single_arg_fallback_1():
     # Verify that when heuristically joining, we fall back to heuristic apply.
     # Even though "print foo" is parsable as a joined string, if ``foo`` is not
@@ -2272,18 +2081,15 @@
     # Heuristic runmodule.  Verify that ImportError in module doesn't confuse
     # us.
     writetext(tmp.dir/"griswold73262001.py", """
         import whitewood62047754
     """)
     result, retcode = py("griswold73262001", PYTHONPATH=tmp.dir)
     assert retcode == 1
-    if PY2:
-        assert result.endswith("ImportError: No module named whitewood62047754")
-    else:
-        assert result.endswith("ModuleNotFoundError: No module named 'whitewood62047754'")
+    assert result.endswith("ModuleNotFoundError: No module named 'whitewood62047754'")
 
 
 def test_heuristic_run_module_argstr_1(tmp):
     # Heuristic runmodule.  Verify that arguments are strings and not
     # evaluated, and verify that argv works correctly.
     writetext(tmp.dir/"gantry20720070.py", """
         from __future__ import print_function
@@ -2302,24 +2108,18 @@
 
 def test_builtin_no_run_module_1(tmp):
     # Verify that builtins take precedence over modules.
     writetext(tmp.dir/"round.py", """
         print('bad morrison56321353')
     """)
     result = py("round", "17534159.5", PYTHONPATH=tmp.dir)
-    if PY2:
-        expected = dedent("""
-            [PYFLYBY] round(17534159.5)
-            17534160.0
-        """).strip()
-    else:
-        expected = dedent("""
-            [PYFLYBY] round(17534159.5)
-            17534160
-        """).strip()
+    expected = dedent("""
+        [PYFLYBY] round(17534159.5)
+        17534160
+    """).strip()
     assert expected == result
 
 
 def test_run_module_no_superfluous_import_1(tmp):
     # Verify that 'py -m foomodule' doesn't cause a superfluous import of
     # foomodule.
     writetext(tmp.dir/"delafield47227231.py", """
@@ -2389,41 +2189,28 @@
         85883909
     """).strip()
     assert expected == result
 
 
 def test_unsafe_args_1():
     result = py("type", "sys")
-    if PY2:
-        expected = dedent("""
-            [PYFLYBY] import sys
-            [PYFLYBY] type(<module 'sys' (built-in)>)
-            <type 'module'>
-        """).strip()
-    else:
-        expected = dedent("""
-            [PYFLYBY] import sys
-            [PYFLYBY] type(<module 'sys' (built-in)>)
-            <class 'module'>
-        """).strip()
+    expected = dedent("""
+        [PYFLYBY] import sys
+        [PYFLYBY] type(<module 'sys' (built-in)>)
+        <class 'module'>
+    """).strip()
     assert expected == result
 
 
 def test_safe_args_1():
     result = py("--safe", "type", "sys")
-    if PY2:
-        expected = dedent("""
-            [PYFLYBY] type('sys')
-            <type 'str'>
-        """).strip()
-    else:
-        expected = dedent("""
-            [PYFLYBY] type('sys')
-            <class 'str'>
-        """).strip()
+    expected = dedent("""
+        [PYFLYBY] type('sys')
+        <class 'str'>
+    """).strip()
     assert expected == result
 
 
 def test_argmode_string_dashdash_1():
     result = py("--args=string", "print", "Beekman/", "--", "Spruce/", "--")
     expected = dedent("""
         [PYFLYBY] print('Beekman/', 'Spruce/', '--')
@@ -2476,15 +2263,14 @@
         [PYFLYBY] print(<module 'sys' (built-in)>)
         <module 'sys' (built-in)>
     """).strip()
     assert expected == result
 
 
 def test_exec_stdin_print_statement_1():
-    # This is still a print statement in Python 2 (with redundant parentheses)
     result = py(stdin=b"print('Carnegie')")
     expected = "Carnegie"
     assert expected == result
 
 
 def test_exec_stdin_print_function_1():
     result = py(stdin=b"print('Sinai', file=sys.stdout)")
@@ -2697,28 +2483,20 @@
     if uname == 'Linux':
         libname = "libc.so.6"
     elif uname == 'Darwin':
         libname = "libc.dylib"
     else:
         raise AssertionError
     result = py('--output=silent', 'ctypes.CDLL("%s").printf'%libname, "b'%03d'", "7")
-    if PY2:
-        expected = dedent("""
-            [PYFLYBY] import ctypes
-            [PYFLYBY] ctypes.CDLL("{libname}").printf
-            [PYFLYBY] ctypes.CDLL("{libname}").printf('%03d', 7)
-            007
-        """).strip().format(libname=libname)
-    else:
-        expected = dedent("""
-            [PYFLYBY] import ctypes
-            [PYFLYBY] ctypes.CDLL("{libname}").printf
-            [PYFLYBY] ctypes.CDLL("{libname}").printf(b'%03d', 7)
-            007
-        """).strip().format(libname=libname)
+    expected = dedent("""
+        [PYFLYBY] import ctypes
+        [PYFLYBY] ctypes.CDLL("{libname}").printf
+        [PYFLYBY] ctypes.CDLL("{libname}").printf(b'%03d', 7)
+        007
+    """).strip().format(libname=libname)
     assert expected == result, repr(result)
 
 
 def test_name_eval_1():
     result = py("-c", "__name__")
     expected = dedent("""
         [PYFLYBY] __name__
@@ -2744,24 +2522,18 @@
         __main__
     """).strip()
     assert expected == result
 
 
 def test_name_heuristic_join_eval_1():
     result = py("print", "'Castle'", ",", "__name__")
-    if PY2:
-        expected = dedent("""
-            [PYFLYBY] print 'Castle' , __name__
-            Castle __main__
-        """).strip()
-    else:
-        expected = dedent("""
-            [PYFLYBY] print('Castle', ',', '__main__')
-            Castle , __main__
-        """).strip()
+    expected = dedent("""
+        [PYFLYBY] print('Castle', ',', '__main__')
+        Castle , __main__
+    """).strip()
     assert expected == result
 
 
 def test_name_stdin_1():
     result = py(stdin=b"print(('Winter', __name__))")
     expected = dedent("""
         ('Winter', '__main__')
@@ -2917,18 +2689,15 @@
         mosholu = Mosholu()
     """)
     result, retcode = py(
         "sys.stdout.write", "kingsbridge90850275.mosholu.cortlandt",
         PYTHONPATH=tmp.dir)
     assert retcode == 1
     assert "[PYFLYBY] import kingsbridge90850275\n" in result
-    if PY2:
-        assert "NameError: global name 'Woodlawn' is not defined" in result
-    else:
-        assert "NameError: name 'Woodlawn' is not defined" in result
+    assert "NameError: name 'Woodlawn' is not defined" in result
 
 
 @pytest.mark.xfail # TODO FIXME
 def test_auto_arg_broken_import_1(tmp):
     # Verify that an ImportError in user code doesn't confuse us into
     # using an argument as a string.
     writetext(tmp.dir/"mclean76253083.py", """
```

### Comparing `pyflyby-1.8.4/tox.ini` & `pyflyby-1.8.5/tox.ini`

 * *Files identical despite different names*

