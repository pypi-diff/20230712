# Comparing `tmp/mariqt-0.5.2-py2.py3-none-any.whl.zip` & `tmp/mariqt-0.5.3-py2.py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,33 +1,33 @@
-Zip file size: 213532 bytes, number of entries: 31
--rw-r--r--  2.0 unx     5876 b- defN 23-Jul-10 14:54 mariqt/converters.py
--rw-r--r--  2.0 unx    14710 b- defN 23-Jul-10 14:54 mariqt/core.py
--rw-r--r--  2.0 unx     8485 b- defN 23-Jul-10 14:54 mariqt/directories.py
--rw-r--r--  2.0 unx      465 b- defN 23-Jul-10 14:54 mariqt/equipment.py
--rw-r--r--  2.0 unx    16621 b- defN 23-Jul-10 14:54 mariqt/files.py
--rw-r--r--  2.0 unx    27845 b- defN 23-Jul-10 14:54 mariqt/geo.py
--rw-r--r--  2.0 unx    23207 b- defN 23-Jul-10 14:54 mariqt/image.py
--rw-r--r--  2.0 unx     3090 b- defN 23-Jul-10 14:54 mariqt/misc.py
--rw-r--r--  2.0 unx    40059 b- defN 23-Jul-10 14:54 mariqt/navigation.py
--rw-r--r--  2.0 unx     7345 b- defN 23-Jul-10 14:54 mariqt/provenance.py
--rw-r--r--  2.0 unx    22316 b- defN 23-Jul-10 14:54 mariqt/reports.py
--rw-r--r--  2.0 unx     4376 b- defN 23-Jul-10 14:54 mariqt/settings.py
--rw-r--r--  2.0 unx     8323 b- defN 23-Jul-10 14:54 mariqt/tests.py
--rw-r--r--  2.0 unx     9613 b- defN 23-Jul-10 14:54 mariqt/variables.py
--rw-r--r--  2.0 unx       21 b- defN 23-Jul-10 14:54 mariqt/version.py
--rw-rw-rw-  2.0 unx     6175 b- defN 23-Jul-10 14:54 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
--rw-rw-rw-  2.0 unx    42461 b- defN 23-Jul-10 14:54 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json
--rw-rw-rw-  2.0 unx     3218 b- defN 23-Jul-10 14:54 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
--rw-r--r--  2.0 unx    12135 b- defN 23-Jul-10 14:54 mariqt/sources/dship.py
--rw-r--r--  2.0 unx     4586 b- defN 23-Jul-10 14:54 mariqt/sources/dship_settings.py
--rw-r--r--  2.0 unx     2177 b- defN 23-Jul-10 14:54 mariqt/sources/elements.py
--rw-r--r--  2.0 unx   113679 b- defN 23-Jul-10 14:54 mariqt/sources/ifdo.py
--rw-r--r--  2.0 unx     5533 b- defN 23-Jul-10 14:54 mariqt/sources/ofop.py
--rw-r--r--  2.0 unx   650149 b- defN 23-Jul-10 14:54 mariqt/sources/svgs.py
--rw-r--r--  2.0 unx     3728 b- defN 23-Jul-10 14:54 mariqt/sources/underway.py
--rw-rw-rw-  2.0 unx      162 b- defN 23-Jul-10 14:56 mariqt-0.5.2.dist-info/AUTHORS.md
--rw-rw-rw-  2.0 unx    35140 b- defN 23-Jul-10 14:56 mariqt-0.5.2.dist-info/LICENSE
--rw-r--r--  2.0 unx     1133 b- defN 23-Jul-10 14:56 mariqt-0.5.2.dist-info/METADATA
--rw-r--r--  2.0 unx      110 b- defN 23-Jul-10 14:56 mariqt-0.5.2.dist-info/WHEEL
--rw-r--r--  2.0 unx        7 b- defN 23-Jul-10 14:56 mariqt-0.5.2.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2542 b- defN 23-Jul-10 14:56 mariqt-0.5.2.dist-info/RECORD
-31 files, 1075287 bytes uncompressed, 209506 bytes compressed:  80.5%
+Zip file size: 213726 bytes, number of entries: 31
+-rw-r--r--  2.0 unx     5876 b- defN 23-Jul-12 15:06 mariqt/converters.py
+-rw-r--r--  2.0 unx    14710 b- defN 23-Jul-12 15:06 mariqt/core.py
+-rw-r--r--  2.0 unx     8485 b- defN 23-Jul-12 15:06 mariqt/directories.py
+-rw-r--r--  2.0 unx      465 b- defN 23-Jul-12 15:06 mariqt/equipment.py
+-rw-r--r--  2.0 unx    16621 b- defN 23-Jul-12 15:06 mariqt/files.py
+-rw-r--r--  2.0 unx    27845 b- defN 23-Jul-12 15:06 mariqt/geo.py
+-rw-r--r--  2.0 unx    23207 b- defN 23-Jul-12 15:06 mariqt/image.py
+-rw-r--r--  2.0 unx     3090 b- defN 23-Jul-12 15:06 mariqt/misc.py
+-rw-r--r--  2.0 unx    40059 b- defN 23-Jul-12 15:06 mariqt/navigation.py
+-rw-r--r--  2.0 unx     7345 b- defN 23-Jul-12 15:06 mariqt/provenance.py
+-rw-r--r--  2.0 unx    22316 b- defN 23-Jul-12 15:06 mariqt/reports.py
+-rw-r--r--  2.0 unx     4376 b- defN 23-Jul-12 15:06 mariqt/settings.py
+-rw-r--r--  2.0 unx     8323 b- defN 23-Jul-12 15:06 mariqt/tests.py
+-rw-r--r--  2.0 unx     9613 b- defN 23-Jul-12 15:06 mariqt/variables.py
+-rw-r--r--  2.0 unx       21 b- defN 23-Jul-12 15:06 mariqt/version.py
+-rw-rw-rw-  2.0 unx     6175 b- defN 23-Jul-12 15:06 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
+-rw-rw-rw-  2.0 unx    42461 b- defN 23-Jul-12 15:06 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json
+-rw-rw-rw-  2.0 unx     3218 b- defN 23-Jul-12 15:06 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
+-rw-r--r--  2.0 unx    12135 b- defN 23-Jul-12 15:06 mariqt/sources/dship.py
+-rw-r--r--  2.0 unx     4586 b- defN 23-Jul-12 15:06 mariqt/sources/dship_settings.py
+-rw-r--r--  2.0 unx     2177 b- defN 23-Jul-12 15:06 mariqt/sources/elements.py
+-rw-r--r--  2.0 unx   114743 b- defN 23-Jul-12 15:06 mariqt/sources/ifdo.py
+-rw-r--r--  2.0 unx     5533 b- defN 23-Jul-12 15:06 mariqt/sources/ofop.py
+-rw-r--r--  2.0 unx   650149 b- defN 23-Jul-12 15:06 mariqt/sources/svgs.py
+-rw-r--r--  2.0 unx     3728 b- defN 23-Jul-12 15:06 mariqt/sources/underway.py
+-rw-rw-rw-  2.0 unx      162 b- defN 23-Jul-12 15:07 mariqt-0.5.3.dist-info/AUTHORS.md
+-rw-rw-rw-  2.0 unx    35140 b- defN 23-Jul-12 15:07 mariqt-0.5.3.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1133 b- defN 23-Jul-12 15:07 mariqt-0.5.3.dist-info/METADATA
+-rw-r--r--  2.0 unx      110 b- defN 23-Jul-12 15:07 mariqt-0.5.3.dist-info/WHEEL
+-rw-r--r--  2.0 unx        7 b- defN 23-Jul-12 15:07 mariqt-0.5.3.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2542 b- defN 23-Jul-12 15:07 mariqt-0.5.3.dist-info/RECORD
+31 files, 1076351 bytes uncompressed, 209700 bytes compressed:  80.5%
```

## zipnote {}

```diff
@@ -69,26 +69,26 @@
 
 Filename: mariqt/sources/svgs.py
 Comment: 
 
 Filename: mariqt/sources/underway.py
 Comment: 
 
-Filename: mariqt-0.5.2.dist-info/AUTHORS.md
+Filename: mariqt-0.5.3.dist-info/AUTHORS.md
 Comment: 
 
-Filename: mariqt-0.5.2.dist-info/LICENSE
+Filename: mariqt-0.5.3.dist-info/LICENSE
 Comment: 
 
-Filename: mariqt-0.5.2.dist-info/METADATA
+Filename: mariqt-0.5.3.dist-info/METADATA
 Comment: 
 
-Filename: mariqt-0.5.2.dist-info/WHEEL
+Filename: mariqt-0.5.3.dist-info/WHEEL
 Comment: 
 
-Filename: mariqt-0.5.2.dist-info/top_level.txt
+Filename: mariqt-0.5.3.dist-info/top_level.txt
 Comment: 
 
-Filename: mariqt-0.5.2.dist-info/RECORD
+Filename: mariqt-0.5.3.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## mariqt/version.py

```diff
@@ -1 +1 @@
-__version__ = '0.5.2'
+__version__ = '0.5.3'
```

## mariqt/sources/ifdo.py

```diff
@@ -1486,5620 +1486,5687 @@
 00005cd0: 2073 7562 666f 6c64 6572 2e0a 2020 2020   subfolder..    
 00005ce0: 2020 2020 2020 2020 2d20 7665 7262 6f73          - verbos
 00005cf0: 653a 2062 6f6f 6c20 7768 6574 6865 7220  e: bool whether 
 00005d00: 746f 2070 7269 6e74 206f 7574 2069 6e66  to print out inf
 00005d10: 6f72 6d61 7469 6f6e 2e20 4465 6661 756c  ormation. Defaul
 00005d20: 743a 2054 7275 652e 0a20 2020 2020 2020  t: True..       
 00005d30: 2020 2020 202d 2069 676e 6f72 655f 696d       - ignore_im
-00005d40: 6167 655f 6669 6c65 733a 2062 6f6f 6c20  age_files: bool 
-00005d50: 7768 6574 6865 7220 6974 2773 2061 6363  whether it's acc
-00005d60: 6570 7465 6420 7468 6174 2074 6865 7265  epted that there
-00005d70: 2061 7265 206e 6f74 2069 6d61 6765 7320   are not images 
-00005d80: 7965 7420 696e 2027 6469 7227 2e20 4465  yet in 'dir'. De
-00005d90: 6661 756c 743a 2046 616c 7365 2e0a 2020  fault: False..  
-00005da0: 2020 2020 2020 2020 2020 2d20 7772 6974            - writ
-00005db0: 6554 6d70 5072 6f76 4669 6c65 3a20 626f  eTmpProvFile: bo
-00005dc0: 6f6c 2077 6865 7468 6572 2074 6f20 7772  ol whether to wr
-00005dd0: 6974 6520 6120 7465 6d70 6f72 6172 7920  ite a temporary 
-00005de0: 7072 6f76 656e 616e 6365 2066 696c 6520  provenance file 
-00005df0: 6475 7269 6e67 2074 6865 2069 4644 4f20  during the iFDO 
-00005e00: 6372 6561 7469 6f6e 2070 726f 6365 7373  creation process
-00005e10: 2077 6869 6368 2077 696c 6c20 6265 2072   which will be r
-00005e20: 6570 6c61 6365 6420 6279 2061 2066 696e  eplaced by a fin
-00005e30: 616c 206f 6e65 2069 6e20 7468 6520 656e  al one in the en
-00005e40: 642e 2044 6566 6175 6c74 3a20 5472 7565  d. Default: True
-00005e50: 0a20 2020 2020 2020 2020 2020 202d 2069  .            - i
-00005e60: 4644 4f66 696c 653a 2073 7472 696e 6720  FDOfile: string 
-00005e70: 7061 7468 2074 6f20 6c6f 6164 2061 6e20  path to load an 
-00005e80: 6578 706c 6963 6974 2069 4644 4f20 6669  explicit iFDO fi
-00005e90: 6c65 2e20 4966 206e 6f74 2070 726f 7669  le. If not provi
-00005ea0: 6465 6420 6120 6d61 7463 6869 6e67 2069  ded a matching i
-00005eb0: 4644 4f20 6669 6c65 2028 6966 2069 7420  FDO file (if it 
-00005ec0: 616c 7265 6164 7920 6578 6973 7473 2920  already exists) 
-00005ed0: 7769 6c6c 2062 6520 6c6f 6164 6564 2066  will be loaded f
-00005ee0: 726f 6d20 7468 6520 2770 726f 6475 6374  rom the 'product
-00005ef0: 7327 2073 7562 6469 7265 6374 6f72 792e  s' subdirectory.
-00005f00: 2044 6566 6175 6c74 3a20 4e6f 6e65 200a   Default: None .
-00005f10: 2020 2020 2020 2020 2020 2020 2d20 696d              - im
-00005f20: 6167 655f 6272 6f6b 6572 5f75 7569 643a  age_broker_uuid:
-00005f30: 2075 7569 6420 6f66 2069 6d61 6765 2062   uuid of image b
-00005f40: 726f 6b65 7220 746f 2063 7265 6174 6520  roker to create 
-00005f50: 696d 6167 6520 6861 6e64 6c65 7320 6173  image handles as
-00005f60: 2068 7474 7073 3a2f 2f68 646c 2e68 616e   https://hdl.han
-00005f70: 646c 652e 6e65 742f 3c68 616e 646c 655f  dle.net/<handle_
-00005f80: 7072 6566 6978 3e2f 3c69 6d61 6765 5f62  prefix>/<image_b
-00005f90: 726f 6b65 725f 7575 6964 3e40 3c69 6d61  roker_uuid>@<ima
-00005fa0: 6765 2d75 7569 643e 2022 2222 0a0a 2020  ge-uuid> """..  
-00005fb0: 2020 2020 2020 2320 6368 6563 6b20 7468        # check th
-00005fc0: 6174 2061 7420 6469 7220 6f72 2069 4644  at at dir or iFD
-00005fd0: 4f66 696c 6520 7072 6f76 6964 6564 0a20  Ofile provided. 
-00005fe0: 2020 2020 2020 2069 6620 6469 7220 6973         if dir is
-00005ff0: 204e 6f6e 6520 616e 6420 6946 444f 6669   None and iFDOfi
-00006000: 6c65 2069 7320 4e6f 6e65 3a0a 2020 2020  le is None:.    
-00006010: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
-00006020: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
-00006030: 6e28 224e 6569 7468 6572 2064 6972 206e  n("Neither dir n
-00006040: 6f72 2069 4644 4f66 696c 6520 7072 6f76  or iFDOfile prov
-00006050: 6964 6564 2066 6f72 2069 4644 4f2e 2229  ided for iFDO.")
-00006060: 0a0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
-00006070: 6972 203d 2064 6972 0a20 2020 2020 2020  ir = dir.       
-00006080: 2073 656c 662e 696d 6167 6573 4469 7220   self.imagesDir 
-00006090: 3d20 6469 722e 746f 7479 7065 2829 0a20  = dir.totype(). 
-000060a0: 2020 2020 2020 2073 656c 662e 6469 722e         self.dir.
-000060b0: 6372 6561 7465 5479 7065 466f 6c64 6572  createTypeFolder
-000060c0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-000060d0: 6861 6e64 6c65 5f70 7265 6669 7820 3d20  handle_prefix = 
-000060e0: 2268 7474 7073 3a2f 2f68 646c 2e68 616e  "https://hdl.han
-000060f0: 646c 652e 6e65 742f 2220 2b20 6861 6e64  dle.net/" + hand
-00006100: 6c65 5f70 7265 6669 780a 2020 2020 2020  le_prefix.      
-00006110: 2020 7365 6c66 2e69 6d61 6765 5f68 616e    self.image_han
-00006120: 646c 655f 7072 6566 6978 203d 2073 656c  dle_prefix = sel
-00006130: 662e 6861 6e64 6c65 5f70 7265 6669 7820  f.handle_prefix 
-00006140: 2b20 222f 2220 2b20 696d 6167 655f 6272  + "/" + image_br
-00006150: 6f6b 6572 5f75 7569 640a 2020 2020 2020  oker_uuid.      
-00006160: 2020 7365 6c66 2e69 676e 6f72 655f 696d    self.ignore_im
-00006170: 6167 655f 6669 6c65 7320 3d20 6967 6e6f  age_files = igno
-00006180: 7265 5f69 6d61 6765 5f66 696c 6573 0a0a  re_image_files..
-00006190: 2020 2020 2020 2020 7365 6c66 2e69 6d61          self.ima
-000061a0: 6765 5365 7448 6561 6465 724b 6579 203d  geSetHeaderKey =
-000061b0: 206d 6971 7476 2e69 6d61 6765 5f73 6574   miqtv.image_set
-000061c0: 5f68 6561 6465 725f 6b65 790a 2020 2020  _header_key.    
-000061d0: 2020 2020 7365 6c66 2e69 6d61 6765 5365      self.imageSe
-000061e0: 7449 7465 6d73 4b65 7920 3d20 6d69 7174  tItemsKey = miqt
-000061f0: 762e 696d 6167 655f 7365 745f 6974 656d  v.image_set_item
-00006200: 735f 6b65 790a 2020 2020 2020 2020 7365  s_key.        se
-00006210: 6c66 2e69 6664 6f5f 746d 7020 3d20 7b73  lf.ifdo_tmp = {s
-00006220: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-00006230: 6572 4b65 793a 207b 7d2c 0a20 2020 2020  erKey: {},.     
-00006240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006250: 2020 2020 7365 6c66 2e69 6d61 6765 5365      self.imageSe
-00006260: 7449 7465 6d73 4b65 793a 207b 7d7d 0a20  tItemsKey: {}}. 
-00006270: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
-00006280: 5f70 6172 7365 6420 3d20 4e6f 6e65 0a20  _parsed = None. 
-00006290: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
-000062a0: 5f63 6865 636b 6564 203d 2063 6f70 792e  _checked = copy.
-000062b0: 6465 6570 636f 7079 2873 656c 662e 6966  deepcopy(self.if
-000062c0: 646f 5f74 6d70 2920 2023 2074 6f20 6265  do_tmp)  # to be
-000062d0: 2073 6574 2062 7920 6372 6561 7465 6946   set by createiF
-000062e0: 444f 2829 206f 6e6c 7921 0a20 2020 2020  DO() only!.     
-000062f0: 2020 2073 656c 662e 5f5f 616c 6c55 5549     self.__allUUI
-00006300: 4473 4368 6563 6b65 6420 3d20 4661 6c73  DsChecked = Fals
-00006310: 650a 2020 2020 2020 2020 7365 6c66 2e70  e.        self.p
-00006320: 726f 7620 3d20 7072 6f76 656e 616e 6365  rov = provenance
-00006330: 0a20 2020 2020 2020 2069 6620 7072 6f76  .        if prov
-00006340: 656e 616e 6365 203d 3d20 4e6f 6e65 3a0a  enance == None:.
-00006350: 2020 2020 2020 2020 2020 2020 746d 7046              tmpF
-00006360: 696c 6550 6174 6820 3d20 2222 0a20 2020  ilePath = "".   
-00006370: 2020 2020 2020 2020 2069 6620 7772 6974           if writ
-00006380: 6554 6d70 5072 6f76 4669 6c65 3a0a 2020  eTmpProvFile:.  
-00006390: 2020 2020 2020 2020 2020 2020 2020 746d                tm
-000063a0: 7046 696c 6550 6174 6820 3d20 7365 6c66  pFilePath = self
-000063b0: 2e64 6972 2e74 6f28 7365 6c66 2e64 6972  .dir.to(self.dir
-000063c0: 2e64 742e 7072 6f74 6f63 6f6c 290a 2020  .dt.protocol).  
-000063d0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-000063e0: 726f 7620 3d20 6d69 7174 702e 5072 6f76  rov = miqtp.Prov
-000063f0: 656e 616e 6365 2822 6946 444f 222c 7665  enance("iFDO",ve
-00006400: 7262 6f73 653d 7665 7262 6f73 652c 746d  rbose=verbose,tm
-00006410: 7046 696c 6550 6174 683d 746d 7046 696c  pFilePath=tmpFil
-00006420: 6550 6174 6829 0a0a 2020 2020 2020 2020  ePath)..        
-00006430: 2320 7365 7420 676c 6f62 616c 2076 6572  # set global ver
-00006440: 626f 7369 7479 0a20 2020 2020 2020 206d  bosity.        m
-00006450: 6971 7476 2e73 6574 476c 6f62 616c 5665  iqtv.setGlobalVe
-00006460: 7262 6f73 6528 7665 7262 6f73 6529 0a0a  rbose(verbose)..
-00006470: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
-00006480: 6972 2e65 7869 7374 7328 293a 0a20 2020  ir.exists():.   
-00006490: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
-000064a0: 7863 6570 7469 6f6e 2822 6469 7265 6374  xception("direct
-000064b0: 726f 7922 2c20 6469 722e 7374 7228 292c  roy", dir.str(),
-000064c0: 2022 646f 6573 206e 6f74 2065 7869 7374   "does not exist
-000064d0: 2e22 290a 0a20 2020 2020 2020 2069 6620  .")..        if 
-000064e0: 6e6f 7420 6469 722e 7661 6c69 6444 6174  not dir.validDat
-000064f0: 6144 6972 2829 3a0a 2020 2020 2020 2020  aDir():.        
-00006500: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-00006510: 696f 6e28 2264 6972 6563 7472 6f79 222c  ion("directroy",
-00006520: 2064 6972 2e73 7472 2829 2c20 226e 6f74   dir.str(), "not
-00006530: 2076 616c 6964 2e20 446f 6573 206e 6f74   valid. Does not
-00006540: 2063 6f6d 706c 7920 7769 7468 2073 7472   comply with str
-00006550: 7563 7475 7265 202f 6261 7365 2f70 726f  ucture /base/pro
-00006560: 6a65 6374 2f5b 4765 6172 2f5d 6576 656e  ject/[Gear/]even
-00006570: 742f 7365 6e73 6f72 2f64 6174 615f 7479  t/sensor/data_ty
-00006580: 7065 2f22 290a 0a20 2020 2020 2020 2023  pe/")..        #
-00006590: 2063 6865 636b 2069 4644 4f20 6669 6c65   check iFDO file
-000065a0: 0a20 2020 2020 2020 2073 656c 662e 6946  .        self.iF
-000065b0: 444f 6669 6c65 5f20 3d20 2222 2023 2069  DOfile_ = "" # i
-000065c0: 7320 7365 7420 6279 2073 6574 6946 444f  s set by setiFDO
-000065d0: 4669 6c65 4e61 6d65 2829 0a20 2020 2020  FileName().     
-000065e0: 2020 206c 6f61 6465 6469 4644 4f20 3d20     loadediFDO = 
-000065f0: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
-00006600: 206e 6f74 2069 4644 4f66 696c 6520 6973   not iFDOfile is
-00006610: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00006620: 2020 2069 4644 4f66 696c 655f 203d 2069     iFDOfile_ = i
-00006630: 4644 4f66 696c 650a 2020 2020 2020 2020  FDOfile.        
-00006640: 2020 2020 7365 6c66 2e73 6574 6946 444f      self.setiFDO
-00006650: 4669 6c65 4e61 6d65 2869 4644 4f66 696c  FileName(iFDOfil
-00006660: 655f 290a 2020 2020 2020 2020 2020 2020  e_).            
-00006670: 6966 206e 6f74 206f 732e 7061 7468 2e69  if not os.path.i
-00006680: 7366 696c 6528 6946 444f 6669 6c65 5f29  sfile(iFDOfile_)
-00006690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000066a0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
-000066b0: 646f 4578 6365 7074 696f 6e28 2269 4644  doException("iFD
-000066c0: 4f20 6669 6c65 206e 6f74 2066 6f75 6e64  O file not found
-000066d0: 3a20 2220 2b20 6946 444f 6669 6c65 5f29  : " + iFDOfile_)
-000066e0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-000066f0: 2020 2020 2020 2020 2020 2069 4644 4f66             iFDOf
-00006700: 696c 655f 203d 2073 656c 662e 6469 722e  ile_ = self.dir.
-00006710: 746f 2873 656c 662e 6469 722e 6474 2e70  to(self.dir.dt.p
-00006720: 726f 6475 6374 7329 2b73 656c 662e 636f  roducts)+self.co
-00006730: 6e73 7472 7563 7469 4644 4f66 696c 654e  nstructiFDOfileN
-00006740: 616d 6528 7365 6c66 2e64 6972 2e70 726f  ame(self.dir.pro
-00006750: 6a65 6374 2829 2c73 656c 662e 6469 722e  ject(),self.dir.
-00006760: 6576 656e 7428 292c 7365 6c66 2e64 6972  event(),self.dir
-00006770: 2e73 656e 736f 7228 2929 0a0a 2020 2020  .sensor())..    
-00006780: 2020 2020 7365 6c66 2e5f 696d 6167 6573      self._images
-00006790: 496e 496d 6167 6573 4469 7220 3d20 6d69  InImagesDir = mi
-000067a0: 7174 692e 6272 6f77 7365 466f 7249 6d61  qti.browseForIma
-000067b0: 6765 4669 6c65 7328 7365 6c66 2e69 6d61  geFiles(self.ima
-000067c0: 6765 7344 6972 290a 2020 2020 2020 2020  gesDir).        
-000067d0: 7365 6c66 2e5f 696d 6167 6573 496e 496d  self._imagesInIm
-000067e0: 6167 6573 4469 7253 6f72 7465 644c 6973  agesDirSortedLis
-000067f0: 7420 3d20 5b66 696c 6520 666f 7220 6669  t = [file for fi
-00006800: 6c65 2069 6e20 7365 6c66 2e5f 696d 6167  le in self._imag
-00006810: 6573 496e 496d 6167 6573 4469 725d 0a20  esInImagesDir]. 
-00006820: 2020 2020 2020 2073 656c 662e 5f69 6d61         self._ima
-00006830: 6765 7349 6e49 6d61 6765 7344 6972 536f  gesInImagesDirSo
-00006840: 7274 6564 4c69 7374 2e73 6f72 7428 290a  rtedList.sort().
-00006850: 2020 2020 2020 2020 7365 6c66 2e5f 696d          self._im
-00006860: 6167 654e 616d 6573 496d 6167 6573 4469  ageNamesImagesDi
-00006870: 7220 3d20 5b6f 732e 7061 7468 2e62 6173  r = [os.path.bas
-00006880: 656e 616d 6528 6669 6c65 2920 666f 7220  ename(file) for 
-00006890: 6669 6c65 2069 6e20 7365 6c66 2e5f 696d  file in self._im
-000068a0: 6167 6573 496e 496d 6167 6573 4469 725d  agesInImagesDir]
-000068b0: 0a0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-000068c0: 2873 656c 662e 5f69 6d61 6765 7349 6e49  (self._imagesInI
-000068d0: 6d61 6765 7344 6972 2920 3d3d 2030 2061  magesDir) == 0 a
-000068e0: 6e64 206e 6f74 2069 676e 6f72 655f 696d  nd not ignore_im
-000068f0: 6167 655f 6669 6c65 733a 0a20 2020 2020  age_files:.     
-00006900: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-00006910: 6570 7469 6f6e 2822 4e6f 2069 6d61 6765  eption("No image
-00006920: 7320 6669 6c65 7320 666f 756e 6420 696e  s files found in
-00006930: 2022 202b 2073 656c 662e 696d 6167 6573   " + self.images
-00006940: 4469 7220 2b20 2220 616e 6420 6974 7320  Dir + " and its 
-00006950: 7375 6264 6972 6563 746f 7269 6573 2229  subdirectories")
-00006960: 0a0a 2020 2020 2020 2020 756e 6971 7565  ..        unique
-00006970: 2c20 6475 7020 3d20 6d69 7174 742e 6669  , dup = miqtt.fi
-00006980: 6c65 7348 6176 6555 6e69 7175 654e 616d  lesHaveUniqueNam
-00006990: 6528 7365 6c66 2e5f 696d 6167 6573 496e  e(self._imagesIn
-000069a0: 496d 6167 6573 4469 7229 0a20 2020 2020  ImagesDir).     
-000069b0: 2020 2069 6620 6e6f 7420 756e 6971 7565     if not unique
-000069c0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000069d0: 6973 6520 4578 6365 7074 696f 6e28 0a20  ise Exception(. 
-000069e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000069f0: 4e6f 7420 616c 6c20 6669 6c65 7320 6861  Not all files ha
-00006a00: 7665 2075 6e69 7175 6520 6e61 6d65 732e  ve unique names.
-00006a10: 2044 7570 6c69 6361 7465 733a 2022 202b   Duplicates: " +
-00006a20: 2073 7472 2864 7570 2929 0a0a 2020 2020   str(dup))..    
-00006a30: 2020 2020 616c 6c76 616c 6964 2c20 6d73      allvalid, ms
-00006a40: 6720 3d20 6d69 7174 742e 616c 6c49 6d61  g = miqtt.allIma
-00006a50: 6765 4e61 6d65 7356 616c 6964 2873 656c  geNamesValid(sel
-00006a60: 662e 5f69 6d61 6765 7349 6e49 6d61 6765  f._imagesInImage
-00006a70: 7344 6972 2920 0a20 2020 2020 2020 2069  sDir) .        i
-00006a80: 6620 6e6f 7420 616c 6c76 616c 6964 3a0a  f not allvalid:.
+00005d40: 6167 655f 6669 6c65 733a 2069 6d61 6765  age_files: image
+00005d50: 7320 6669 6c65 7320 6172 6520 6967 6e6f  s files are igno
+00005d60: 7265 642e 2054 6865 7920 6172 6520 6e6f  red. They are no
+00005d70: 7420 7365 6172 6368 6564 2066 6f72 2069  t searched for i
+00005d80: 6e20 2772 6177 2720 616e 6420 6974 656d  n 'raw' and item
+00005d90: 7320 7661 6c75 6573 2061 7265 206e 6f74  s values are not
+00005da0: 2075 7064 6174 6564 206e 6f72 2063 6865   updated nor che
+00005db0: 636b 6564 2e20 4465 6661 756c 7420 3d20  cked. Default = 
+00005dc0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00005dd0: 2020 2d20 7772 6974 6554 6d70 5072 6f76    - writeTmpProv
+00005de0: 4669 6c65 3a20 626f 6f6c 2077 6865 7468  File: bool wheth
+00005df0: 6572 2074 6f20 7772 6974 6520 6120 7465  er to write a te
+00005e00: 6d70 6f72 6172 7920 7072 6f76 656e 616e  mporary provenan
+00005e10: 6365 2066 696c 6520 6475 7269 6e67 2074  ce file during t
+00005e20: 6865 2069 4644 4f20 6372 6561 7469 6f6e  he iFDO creation
+00005e30: 2070 726f 6365 7373 2077 6869 6368 2077   process which w
+00005e40: 696c 6c20 6265 2072 6570 6c61 6365 6420  ill be replaced 
+00005e50: 6279 2061 2066 696e 616c 206f 6e65 2069  by a final one i
+00005e60: 6e20 7468 6520 656e 642e 2044 6566 6175  n the end. Defau
+00005e70: 6c74 3a20 5472 7565 0a20 2020 2020 2020  lt: True.       
+00005e80: 2020 2020 202d 2069 4644 4f66 696c 653a       - iFDOfile:
+00005e90: 2073 7472 696e 6720 7061 7468 2074 6f20   string path to 
+00005ea0: 6c6f 6164 2061 6e20 6578 706c 6963 6974  load an explicit
+00005eb0: 2069 4644 4f20 6669 6c65 2e20 4966 206e   iFDO file. If n
+00005ec0: 6f74 2070 726f 7669 6465 6420 6120 6d61  ot provided a ma
+00005ed0: 7463 6869 6e67 2069 4644 4f20 6669 6c65  tching iFDO file
+00005ee0: 2028 6966 2069 7420 616c 7265 6164 7920   (if it already 
+00005ef0: 6578 6973 7473 2920 7769 6c6c 2062 6520  exists) will be 
+00005f00: 6c6f 6164 6564 2066 726f 6d20 7468 6520  loaded from the 
+00005f10: 2770 726f 6475 6374 7327 2073 7562 6469  'products' subdi
+00005f20: 7265 6374 6f72 792e 2044 6566 6175 6c74  rectory. Default
+00005f30: 3a20 4e6f 6e65 200a 2020 2020 2020 2020  : None .        
+00005f40: 2020 2020 2d20 696d 6167 655f 6272 6f6b      - image_brok
+00005f50: 6572 5f75 7569 643a 2075 7569 6420 6f66  er_uuid: uuid of
+00005f60: 2069 6d61 6765 2062 726f 6b65 7220 746f   image broker to
+00005f70: 2063 7265 6174 6520 696d 6167 6520 6861   create image ha
+00005f80: 6e64 6c65 7320 6173 2068 7474 7073 3a2f  ndles as https:/
+00005f90: 2f68 646c 2e68 616e 646c 652e 6e65 742f  /hdl.handle.net/
+00005fa0: 3c68 616e 646c 655f 7072 6566 6978 3e2f  <handle_prefix>/
+00005fb0: 3c69 6d61 6765 5f62 726f 6b65 725f 7575  <image_broker_uu
+00005fc0: 6964 3e40 3c69 6d61 6765 2d75 7569 643e  id>@<image-uuid>
+00005fd0: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
+00005fe0: 6368 6563 6b20 7468 6174 2061 7420 6469  check that at di
+00005ff0: 7220 6f72 2069 4644 4f66 696c 6520 7072  r or iFDOfile pr
+00006000: 6f76 6964 6564 0a20 2020 2020 2020 2069  ovided.        i
+00006010: 6620 6469 7220 6973 204e 6f6e 6520 616e  f dir is None an
+00006020: 6420 6946 444f 6669 6c65 2069 7320 4e6f  d iFDOfile is No
+00006030: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00006040: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
+00006050: 4578 6365 7074 696f 6e28 224e 6569 7468  Exception("Neith
+00006060: 6572 2064 6972 206e 6f72 2069 4644 4f66  er dir nor iFDOf
+00006070: 696c 6520 7072 6f76 6964 6564 2066 6f72  ile provided for
+00006080: 2069 4644 4f2e 2229 0a0a 2020 2020 2020   iFDO.")..      
+00006090: 2020 7365 6c66 2e64 6972 203d 2064 6972    self.dir = dir
+000060a0: 0a20 2020 2020 2020 2073 656c 662e 696d  .        self.im
+000060b0: 6167 6573 4469 7220 3d20 6469 722e 746f  agesDir = dir.to
+000060c0: 7479 7065 2829 0a20 2020 2020 2020 2073  type().        s
+000060d0: 656c 662e 6469 722e 6372 6561 7465 5479  elf.dir.createTy
+000060e0: 7065 466f 6c64 6572 2829 0a20 2020 2020  peFolder().     
+000060f0: 2020 2073 656c 662e 6861 6e64 6c65 5f70     self.handle_p
+00006100: 7265 6669 7820 3d20 2268 7474 7073 3a2f  refix = "https:/
+00006110: 2f68 646c 2e68 616e 646c 652e 6e65 742f  /hdl.handle.net/
+00006120: 2220 2b20 6861 6e64 6c65 5f70 7265 6669  " + handle_prefi
+00006130: 780a 2020 2020 2020 2020 7365 6c66 2e69  x.        self.i
+00006140: 6d61 6765 5f68 616e 646c 655f 7072 6566  mage_handle_pref
+00006150: 6978 203d 2073 656c 662e 6861 6e64 6c65  ix = self.handle
+00006160: 5f70 7265 6669 7820 2b20 222f 2220 2b20  _prefix + "/" + 
+00006170: 696d 6167 655f 6272 6f6b 6572 5f75 7569  image_broker_uui
+00006180: 640a 2020 2020 2020 2020 7365 6c66 2e69  d.        self.i
+00006190: 676e 6f72 655f 696d 6167 655f 6669 6c65  gnore_image_file
+000061a0: 7320 3d20 6967 6e6f 7265 5f69 6d61 6765  s = ignore_image
+000061b0: 5f66 696c 6573 0a0a 2020 2020 2020 2020  _files..        
+000061c0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+000061d0: 6465 724b 6579 203d 206d 6971 7476 2e69  derKey = miqtv.i
+000061e0: 6d61 6765 5f73 6574 5f68 6561 6465 725f  mage_set_header_
+000061f0: 6b65 790a 2020 2020 2020 2020 7365 6c66  key.        self
+00006200: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+00006210: 7920 3d20 6d69 7174 762e 696d 6167 655f  y = miqtv.image_
+00006220: 7365 745f 6974 656d 735f 6b65 790a 2020  set_items_key.  
+00006230: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+00006240: 746d 7020 3d20 7b73 656c 662e 696d 6167  tmp = {self.imag
+00006250: 6553 6574 4865 6164 6572 4b65 793a 207b  eSetHeaderKey: {
+00006260: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+00006270: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006280: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+00006290: 793a 207b 7d7d 0a20 2020 2020 2020 2073  y: {}}.        s
+000062a0: 656c 662e 6966 646f 5f70 6172 7365 6420  elf.ifdo_parsed 
+000062b0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
+000062c0: 656c 662e 6966 646f 5f63 6865 636b 6564  elf.ifdo_checked
+000062d0: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+000062e0: 2873 656c 662e 6966 646f 5f74 6d70 2920  (self.ifdo_tmp) 
+000062f0: 2023 2074 6f20 6265 2073 6574 2062 7920   # to be set by 
+00006300: 6372 6561 7465 6946 444f 2829 206f 6e6c  createiFDO() onl
+00006310: 7921 0a20 2020 2020 2020 2073 656c 662e  y!.        self.
+00006320: 5f5f 616c 6c55 5549 4473 4368 6563 6b65  __allUUIDsChecke
+00006330: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
+00006340: 2020 7365 6c66 2e70 726f 7620 3d20 7072    self.prov = pr
+00006350: 6f76 656e 616e 6365 0a20 2020 2020 2020  ovenance.       
+00006360: 2069 6620 7072 6f76 656e 616e 6365 203d   if provenance =
+00006370: 3d20 4e6f 6e65 3a0a 2020 2020 2020 2020  = None:.        
+00006380: 2020 2020 746d 7046 696c 6550 6174 6820      tmpFilePath 
+00006390: 3d20 2222 0a20 2020 2020 2020 2020 2020  = "".           
+000063a0: 2069 6620 7772 6974 6554 6d70 5072 6f76   if writeTmpProv
+000063b0: 4669 6c65 3a0a 2020 2020 2020 2020 2020  File:.          
+000063c0: 2020 2020 2020 746d 7046 696c 6550 6174        tmpFilePat
+000063d0: 6820 3d20 7365 6c66 2e64 6972 2e74 6f28  h = self.dir.to(
+000063e0: 7365 6c66 2e64 6972 2e64 742e 7072 6f74  self.dir.dt.prot
+000063f0: 6f63 6f6c 290a 2020 2020 2020 2020 2020  ocol).          
+00006400: 2020 7365 6c66 2e70 726f 7620 3d20 6d69    self.prov = mi
+00006410: 7174 702e 5072 6f76 656e 616e 6365 2822  qtp.Provenance("
+00006420: 6946 444f 222c 7665 7262 6f73 653d 7665  iFDO",verbose=ve
+00006430: 7262 6f73 652c 746d 7046 696c 6550 6174  rbose,tmpFilePat
+00006440: 683d 746d 7046 696c 6550 6174 6829 0a0a  h=tmpFilePath)..
+00006450: 2020 2020 2020 2020 2320 7365 7420 676c          # set gl
+00006460: 6f62 616c 2076 6572 626f 7369 7479 0a20  obal verbosity. 
+00006470: 2020 2020 2020 206d 6971 7476 2e73 6574         miqtv.set
+00006480: 476c 6f62 616c 5665 7262 6f73 6528 7665  GlobalVerbose(ve
+00006490: 7262 6f73 6529 0a0a 2020 2020 2020 2020  rbose)..        
+000064a0: 6966 206e 6f74 2064 6972 2e65 7869 7374  if not dir.exist
+000064b0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+000064c0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+000064d0: 2822 6469 7265 6374 726f 7922 2c20 6469  ("directroy", di
+000064e0: 722e 7374 7228 292c 2022 646f 6573 206e  r.str(), "does n
+000064f0: 6f74 2065 7869 7374 2e22 290a 0a20 2020  ot exist.")..   
+00006500: 2020 2020 2069 6620 6e6f 7420 6469 722e       if not dir.
+00006510: 7661 6c69 6444 6174 6144 6972 2829 3a0a  validDataDir():.
+00006520: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00006530: 6520 4578 6365 7074 696f 6e28 2264 6972  e Exception("dir
+00006540: 6563 7472 6f79 222c 2064 6972 2e73 7472  ectroy", dir.str
+00006550: 2829 2c20 226e 6f74 2076 616c 6964 2e20  (), "not valid. 
+00006560: 446f 6573 206e 6f74 2063 6f6d 706c 7920  Does not comply 
+00006570: 7769 7468 2073 7472 7563 7475 7265 202f  with structure /
+00006580: 6261 7365 2f70 726f 6a65 6374 2f5b 4765  base/project/[Ge
+00006590: 6172 2f5d 6576 656e 742f 7365 6e73 6f72  ar/]event/sensor
+000065a0: 2f64 6174 615f 7479 7065 2f22 290a 0a20  /data_type/").. 
+000065b0: 2020 2020 2020 2023 2063 6865 636b 2069         # check i
+000065c0: 4644 4f20 6669 6c65 0a20 2020 2020 2020  FDO file.       
+000065d0: 2073 656c 662e 6946 444f 6669 6c65 5f20   self.iFDOfile_ 
+000065e0: 3d20 2222 2023 2069 7320 7365 7420 6279  = "" # is set by
+000065f0: 2073 6574 6946 444f 4669 6c65 4e61 6d65   setiFDOFileName
+00006600: 2829 0a20 2020 2020 2020 206c 6f61 6465  ().        loade
+00006610: 6469 4644 4f20 3d20 4661 6c73 650a 2020  diFDO = False.  
+00006620: 2020 2020 2020 6966 206e 6f74 2069 4644        if not iFD
+00006630: 4f66 696c 6520 6973 204e 6f6e 653a 0a20  Ofile is None:. 
+00006640: 2020 2020 2020 2020 2020 2069 4644 4f66             iFDOf
+00006650: 696c 655f 203d 2069 4644 4f66 696c 650a  ile_ = iFDOfile.
+00006660: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006670: 2e73 6574 6946 444f 4669 6c65 4e61 6d65  .setiFDOFileName
+00006680: 2869 4644 4f66 696c 655f 290a 2020 2020  (iFDOfile_).    
+00006690: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+000066a0: 732e 7061 7468 2e69 7366 696c 6528 6946  s.path.isfile(iF
+000066b0: 444f 6669 6c65 5f29 3a0a 2020 2020 2020  DOfile_):.      
+000066c0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000066d0: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+000066e0: 696f 6e28 2269 4644 4f20 6669 6c65 206e  ion("iFDO file n
+000066f0: 6f74 2066 6f75 6e64 3a20 2220 2b20 6946  ot found: " + iF
+00006700: 444f 6669 6c65 5f29 0a20 2020 2020 2020  DOfile_).       
+00006710: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00006720: 2020 2069 4644 4f66 696c 655f 203d 2073     iFDOfile_ = s
+00006730: 656c 662e 6469 722e 746f 2873 656c 662e  elf.dir.to(self.
+00006740: 6469 722e 6474 2e70 726f 6475 6374 7329  dir.dt.products)
+00006750: 2b73 656c 662e 636f 6e73 7472 7563 7469  +self.constructi
+00006760: 4644 4f66 696c 654e 616d 6528 7365 6c66  FDOfileName(self
+00006770: 2e64 6972 2e70 726f 6a65 6374 2829 2c73  .dir.project(),s
+00006780: 656c 662e 6469 722e 6576 656e 7428 292c  elf.dir.event(),
+00006790: 7365 6c66 2e64 6972 2e73 656e 736f 7228  self.dir.sensor(
+000067a0: 2929 0a0a 2020 2020 2020 2020 0a20 2020  ))..        .   
+000067b0: 2020 2020 2073 656c 662e 5f69 6d61 6765       self._image
+000067c0: 7349 6e49 6d61 6765 7344 6972 203d 205b  sInImagesDir = [
+000067d0: 5d0a 2020 2020 2020 2020 6966 2073 656c  ].        if sel
+000067e0: 662e 6967 6e6f 7265 5f69 6d61 6765 5f66  f.ignore_image_f
+000067f0: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
+00006800: 2020 7072 696e 7428 2243 6175 7469 6f6e    print("Caution
+00006810: 2120 7275 6e6e 696e 6720 696e 2069 676e  ! running in ign
+00006820: 6f72 655f 696d 6167 655f 6669 6c65 7320  ore_image_files 
+00006830: 6d6f 6465 2e22 290a 2020 2020 2020 2020  mode.").        
+00006840: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00006850: 2020 7365 6c66 2e5f 696d 6167 6573 496e    self._imagesIn
+00006860: 496d 6167 6573 4469 7220 3d20 6d69 7174  ImagesDir = miqt
+00006870: 692e 6272 6f77 7365 466f 7249 6d61 6765  i.browseForImage
+00006880: 4669 6c65 7328 7365 6c66 2e69 6d61 6765  Files(self.image
+00006890: 7344 6972 290a 2020 2020 2020 2020 7365  sDir).        se
+000068a0: 6c66 2e5f 696d 6167 6573 496e 496d 6167  lf._imagesInImag
+000068b0: 6573 4469 7253 6f72 7465 644c 6973 7420  esDirSortedList 
+000068c0: 3d20 5b66 696c 6520 666f 7220 6669 6c65  = [file for file
+000068d0: 2069 6e20 7365 6c66 2e5f 696d 6167 6573   in self._images
+000068e0: 496e 496d 6167 6573 4469 725d 0a20 2020  InImagesDir].   
+000068f0: 2020 2020 2073 656c 662e 5f69 6d61 6765       self._image
+00006900: 7349 6e49 6d61 6765 7344 6972 536f 7274  sInImagesDirSort
+00006910: 6564 4c69 7374 2e73 6f72 7428 290a 2020  edList.sort().  
+00006920: 2020 2020 2020 7365 6c66 2e5f 696d 6167        self._imag
+00006930: 654e 616d 6573 496d 6167 6573 4469 7220  eNamesImagesDir 
+00006940: 3d20 5b6f 732e 7061 7468 2e62 6173 656e  = [os.path.basen
+00006950: 616d 6528 6669 6c65 2920 666f 7220 6669  ame(file) for fi
+00006960: 6c65 2069 6e20 7365 6c66 2e5f 696d 6167  le in self._imag
+00006970: 6573 496e 496d 6167 6573 4469 725d 0a0a  esInImagesDir]..
+00006980: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+00006990: 656c 662e 5f69 6d61 6765 7349 6e49 6d61  elf._imagesInIma
+000069a0: 6765 7344 6972 2920 3d3d 2030 2061 6e64  gesDir) == 0 and
+000069b0: 206e 6f74 2069 676e 6f72 655f 696d 6167   not ignore_imag
+000069c0: 655f 6669 6c65 733a 0a20 2020 2020 2020  e_files:.       
+000069d0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
+000069e0: 7469 6f6e 2822 4e6f 2069 6d61 6765 7320  tion("No images 
+000069f0: 6669 6c65 7320 666f 756e 6420 696e 2022  files found in "
+00006a00: 202b 2073 656c 662e 696d 6167 6573 4469   + self.imagesDi
+00006a10: 7220 2b20 2220 616e 6420 6974 7320 7375  r + " and its su
+00006a20: 6264 6972 6563 746f 7269 6573 2229 0a0a  bdirectories")..
+00006a30: 2020 2020 2020 2020 756e 6971 7565 2c20          unique, 
+00006a40: 6475 7020 3d20 6d69 7174 742e 6669 6c65  dup = miqtt.file
+00006a50: 7348 6176 6555 6e69 7175 654e 616d 6528  sHaveUniqueName(
+00006a60: 7365 6c66 2e5f 696d 6167 6573 496e 496d  self._imagesInIm
+00006a70: 6167 6573 4469 7229 0a20 2020 2020 2020  agesDir).       
+00006a80: 2069 6620 6e6f 7420 756e 6971 7565 3a0a   if not unique:.
 00006a90: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00006aa0: 6520 4578 6365 7074 696f 6e28 6d73 6729  e Exception(msg)
-00006ab0: 0a0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-00006ac0: 726f 762e 6c6f 6728 7374 7228 6c65 6e28  rov.log(str(len(
-00006ad0: 7365 6c66 2e5f 696d 6167 6573 496e 496d  self._imagesInIm
-00006ae0: 6167 6573 4469 7229 2920 2b20 2220 696d  agesDir)) + " im
-00006af0: 6167 6520 6669 6c65 7320 666f 756e 642e  age files found.
-00006b00: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-00006b10: 7072 6f76 2e6c 6f67 2822 2229 0a20 2020  prov.log("").   
-00006b20: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-00006b30: 6f67 2822 466f 6c6c 6f77 696e 6720 696e  og("Following in
-00006b40: 666f 726d 6174 696f 6e20 7761 7320 7061  formation was pa
-00006b50: 7273 6564 2066 726f 6d20 6469 7265 6374  rsed from direct
-00006b60: 6f72 792c 2070 6c65 6173 6520 6368 6563  ory, please chec
-00006b70: 6b20 666f 7220 636f 7272 6563 746e 6573  k for correctnes
-00006b80: 733a 2229 0a20 2020 2020 2020 2073 656c  s:").        sel
-00006b90: 662e 7072 6f76 2e6c 6f67 2822 5072 6f6a  f.prov.log("Proj
-00006ba0: 6563 743a 5c74 222b 7365 6c66 2e64 6972  ect:\t"+self.dir
-00006bb0: 2e70 726f 6a65 6374 2829 290a 2020 2020  .project()).    
-00006bc0: 2020 2020 6966 2073 656c 662e 6469 722e      if self.dir.
-00006bd0: 7769 7468 5f67 6561 723a 0a20 2020 2020  with_gear:.     
-00006be0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-00006bf0: 2e6c 6f67 2822 4765 6172 3a5c 745c 7422  .log("Gear:\t\t"
-00006c00: 2b73 656c 662e 6469 722e 6765 6172 2829  +self.dir.gear()
-00006c10: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
-00006c20: 726f 762e 6c6f 6728 2245 7665 6e74 3a5c  rov.log("Event:\
-00006c30: 745c 7422 2b73 656c 662e 6469 722e 6576  t\t"+self.dir.ev
-00006c40: 656e 7428 2929 0a20 2020 2020 2020 2073  ent()).        s
-00006c50: 656c 662e 7072 6f76 2e6c 6f67 2822 5365  elf.prov.log("Se
-00006c60: 6e73 6f72 3a5c 745c 7422 2b73 656c 662e  nsor:\t\t"+self.
-00006c70: 6469 722e 7365 6e73 6f72 2829 290a 2020  dir.sensor()).  
-00006c80: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-00006c90: 6c6f 6728 2222 290a 0a20 2020 2020 2020  log("")..       
-00006ca0: 2023 2069 6e74 6572 6d65 6469 6174 6520   # intermediate 
-00006cb0: 6669 6c65 730a 2020 2020 2020 2020 7365  files.        se
-00006cc0: 6c66 2e5f 5f69 6e69 7449 6e74 6572 6d65  lf.__initInterme
-00006cd0: 6469 6174 6546 696c 6573 2829 2020 2020  diateFiles()    
-00006ce0: 0a0a 2020 2020 2020 2020 2320 7472 7920  ..        # try 
-00006cf0: 6c6f 6164 2065 7869 7374 696e 6720 6946  load existing iF
-00006d00: 444f 2066 696c 650a 2020 2020 2020 2020  DO file.        
-00006d10: 6966 2873 656c 662e 7265 6164 6946 444f  if(self.readiFDO
-00006d20: 6669 6c65 2869 4644 4f66 696c 655f 2929  file(iFDOfile_))
-00006d30: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-00006d40: 6164 6564 6946 444f 203d 2054 7275 650a  adediFDO = True.
-00006d50: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00006d60: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00006d70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00006d80: 6174 6820 3d20 7365 6c66 2e64 6972 2e74  ath = self.dir.t
-00006d90: 6f28 7365 6c66 2e64 6972 2e64 742e 7072  o(self.dir.dt.pr
-00006da0: 6f64 7563 7473 290a 2020 2020 2020 2020  oducts).        
-00006db0: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
-00006dc0: 5f20 696e 206f 732e 6c69 7374 6469 7228  _ in os.listdir(
-00006dd0: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
-00006de0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
-00006df0: 6c65 5f5b 2d31 303a 2d34 5d20 3d3d 2022  le_[-10:-4] == "
-00006e00: 5f69 4644 4f2e 2220 616e 6420 7365 6c66  _iFDO." and self
-00006e10: 2e72 6561 6469 4644 4f66 696c 6528 7061  .readiFDOfile(pa
-00006e20: 7468 2b66 696c 655f 293a 0a20 2020 2020  th+file_):.     
-00006e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e40: 2020 206c 6f61 6465 6469 4644 4f20 3d20     loadediFDO = 
-00006e50: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00006e60: 2020 2020 2020 2020 2020 2020 2069 4644               iFD
-00006e70: 4f66 696c 655f 203d 2070 6174 682b 6669  Ofile_ = path+fi
-00006e80: 6c65 5f0a 2020 2020 2020 2020 2020 2020  le_.            
-00006e90: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00006ea0: 6b0a 2020 2020 2020 2020 2020 2020 6578  k.            ex
-00006eb0: 6365 7074 2046 696c 654e 6f74 466f 756e  cept FileNotFoun
-00006ec0: 6445 7272 6f72 3a0a 2020 2020 2020 2020  dError:.        
-00006ed0: 2020 2020 2020 2020 7061 7373 2020 2020          pass    
-00006ee0: 2020 2020 0a0a 2020 2020 2020 2020 7365      ..        se
-00006ef0: 6c66 2e74 7279 4175 746f 5365 7448 6561  lf.tryAutoSetHea
-00006f00: 6465 7246 6965 6c64 7328 290a 2020 2020  derFields().    
-00006f10: 2020 2020 7365 6c66 2e73 6574 4865 6164      self.setHead
-00006f20: 6572 496d 6167 654c 6f63 616c 5061 7468  erImageLocalPath
-00006f30: 4669 656c 6428 290a 2020 2020 2020 2020  Field().        
-00006f40: 6966 206c 6f61 6465 6469 4644 4f3a 0a20  if loadediFDO:. 
-00006f50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006f60: 7365 7469 4644 4f46 696c 654e 616d 6528  setiFDOFileName(
-00006f70: 6946 444f 6669 6c65 5f29 0a0a 0a20 2020  iFDOfile_)...   
-00006f80: 2064 6566 2072 6561 6469 4644 4f66 696c   def readiFDOfil
-00006f90: 6528 7365 6c66 2c66 696c 653a 7374 7229  e(self,file:str)
-00006fa0: 3a0a 2020 2020 2020 2020 2222 2220 7265  :.        """ re
-00006fb0: 6164 7320 6946 444f 2066 696c 6520 2222  ads iFDO file ""
-00006fc0: 220a 2020 2020 2020 2020 7472 795f 7961  ".        try_ya
-00006fd0: 6d6c 203d 2046 616c 7365 0a0a 2020 2020  ml = False..    
-00006fe0: 2020 2020 2320 6966 2066 696c 6520 6973      # if file is
-00006ff0: 2079 616d 6c20 6669 6c65 206c 6f61 6420   yaml file load 
-00007000: 6974 2061 7320 7375 6368 0a20 2020 2020  it as such.     
-00007010: 2020 2069 6620 6669 6c65 2e73 706c 6974     if file.split
-00007020: 2827 2e27 295b 2d31 5d20 3d3d 2027 7961  ('.')[-1] == 'ya
-00007030: 6d6c 273a 0a20 2020 2020 2020 2020 2020  ml':.           
-00007040: 2074 7279 5f79 616d 6c20 3d20 5472 7565   try_yaml = True
-00007050: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00007060: 655f 7961 6d6c 203d 2066 696c 650a 0a20  e_yaml = file.. 
-00007070: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-00007080: 2e70 6174 682e 6973 6669 6c65 2866 696c  .path.isfile(fil
-00007090: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-000070a0: 2320 6966 2066 696c 6520 646f 6573 206e  # if file does n
-000070b0: 6f74 2065 7869 7374 2063 6865 636b 2069  ot exist check i
-000070c0: 6620 7961 6d6c 2076 6572 7369 6f6e 2065  f yaml version e
-000070d0: 7873 6973 7420 616e 6420 7472 7920 746f  xsist and try to
-000070e0: 206c 6f61 6420 7468 6174 206f 6e65 0a20   load that one. 
-000070f0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-00007100: 7961 6d6c 203d 2066 696c 652e 7265 706c  yaml = file.repl
-00007110: 6163 6528 272e 6a73 6f6e 272c 272e 7961  ace('.json','.ya
-00007120: 6d6c 2729 0a20 2020 2020 2020 2020 2020  ml').           
-00007130: 2069 6620 6f73 2e70 6174 682e 6973 6669   if os.path.isfi
-00007140: 6c65 2866 696c 655f 7961 6d6c 293a 0a20  le(file_yaml):. 
-00007150: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00007160: 7279 5f79 616d 6c20 3d20 5472 7565 0a20  ry_yaml = True. 
-00007170: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00007180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007190: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
-000071a0: 2020 2020 2020 2073 203d 206d 6971 7463         s = miqtc
-000071b0: 2e50 7269 6e74 4c6f 6164 696e 674d 7367  .PrintLoadingMsg
-000071c0: 2822 4c6f 6164 696e 6720 6946 444f 2066  ("Loading iFDO f
-000071d0: 696c 6522 290a 2020 2020 2020 2020 7472  ile").        tr
-000071e0: 793a 0a20 2020 2020 2020 2020 2020 2023  y:.            #
-000071f0: 2074 7279 206c 6f61 6420 6a73 6f6e 2c20   try load json, 
-00007200: 6f74 6865 7277 6973 6520 7472 7920 7961  otherwise try ya
-00007210: 6d6c 0a20 2020 2020 2020 2020 2020 2069  ml.            i
-00007220: 6620 7472 795f 7961 6d6c 3a0a 2020 2020  f try_yaml:.    
-00007230: 2020 2020 2020 2020 2020 2020 6f20 3d20              o = 
-00007240: 6f70 656e 2866 696c 655f 7961 6d6c 2c20  open(file_yaml, 
-00007250: 2772 2729 0a20 2020 2020 2020 2020 2020  'r').           
-00007260: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
-00007270: 6d70 203d 2079 616d 6c2e 6c6f 6164 286f  mp = yaml.load(o
-00007280: 2c20 204c 6f61 6465 723d 7961 6d6c 2e43  ,  Loader=yaml.C
-00007290: 4c6f 6164 6572 290a 2020 2020 2020 2020  Loader).        
-000072a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000072b0: 2020 2020 2020 2020 2020 6f20 3d20 6f70            o = op
-000072c0: 656e 2866 696c 652c 2027 7227 290a 2020  en(file, 'r').  
-000072d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000072e0: 6c66 2e69 6664 6f5f 746d 7020 3d20 6a73  lf.ifdo_tmp = js
-000072f0: 6f6e 2e6c 6f61 6428 6f29 0a0a 2020 2020  on.load(o)..    
-00007300: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-00007310: 6f5f 7061 7273 6564 203d 2063 6f70 792e  o_parsed = copy.
-00007320: 6465 6570 636f 7079 2873 656c 662e 6966  deepcopy(self.if
-00007330: 646f 5f74 6d70 290a 2020 2020 2020 2020  do_tmp).        
-00007340: 2020 2020 6f2e 636c 6f73 6528 290a 2020      o.close().  
-00007350: 2020 2020 2020 2020 2020 732e 7374 6f70            s.stop
-00007360: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
-00007370: 656c 662e 7072 6f76 2e61 6464 5072 6576  elf.prov.addPrev
-00007380: 696f 7573 5072 6f76 656e 616e 6365 2873  iousProvenance(s
-00007390: 656c 662e 7072 6f76 2e67 6574 4c61 7374  elf.prov.getLast
-000073a0: 5072 6f76 656e 616e 6365 4669 6c65 2873  ProvenanceFile(s
-000073b0: 656c 662e 6469 722e 746f 2873 656c 662e  elf.dir.to(self.
-000073c0: 6469 722e 6474 2e70 726f 746f 636f 6c29  dir.dt.protocol)
-000073d0: 2c73 656c 662e 7072 6f76 2e65 7865 6375  ,self.prov.execu
-000073e0: 7461 626c 6529 290a 2020 2020 2020 2020  table)).        
-000073f0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00007400: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-00007410: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00007420: 2873 7472 2865 2e61 7267 7329 290a 2020  (str(e.args)).  
-00007430: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00007440: 2046 616c 7365 0a20 2020 2020 2020 2073   False.        s
-00007450: 2e73 746f 7028 290a 0a20 2020 2020 2020  .stop()..       
-00007460: 2023 2074 7279 2074 6f20 7061 7273 6520   # try to parse 
-00007470: 652e 672e 2073 7472 696e 6773 2074 6861  e.g. strings tha
-00007480: 7420 7265 7072 6573 656e 7420 6469 6374  t represent dict
-00007490: 730a 2020 2020 2020 2020 6d69 7174 632e  s.        miqtc.
-000074a0: 7265 6375 7273 6976 6545 7661 6c28 7365  recursiveEval(se
-000074b0: 6c66 2e69 6664 6f5f 746d 7029 0a0a 2020  lf.ifdo_tmp)..  
-000074c0: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
-000074d0: 6167 6553 6574 4865 6164 6572 4b65 7920  ageSetHeaderKey 
-000074e0: 6e6f 7420 696e 2073 656c 662e 6966 646f  not in self.ifdo
-000074f0: 5f74 6d70 3a0a 2020 2020 2020 2020 2020  _tmp:.          
-00007500: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-00007510: 6e28 2245 7272 6f72 206c 6f61 6469 6e67  n("Error loading
-00007520: 2069 4644 4f20 6669 6c65 222c 6669 6c65   iFDO file",file
-00007530: 2c22 646f 6573 206e 6f74 2063 6f6e 7461  ,"does not conta
-00007540: 696e 222c 7365 6c66 2e69 6d61 6765 5365  in",self.imageSe
-00007550: 7448 6561 6465 724b 6579 290a 2020 2020  tHeaderKey).    
-00007560: 2020 2020 6966 2073 656c 662e 696d 6167      if self.imag
-00007570: 6553 6574 4974 656d 734b 6579 206e 6f74  eSetItemsKey not
-00007580: 2069 6e20 7365 6c66 2e69 6664 6f5f 746d   in self.ifdo_tm
-00007590: 703a 0a20 2020 2020 2020 2020 2020 2072  p:.            r
-000075a0: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
-000075b0: 4572 726f 7220 6c6f 6164 696e 6720 6946  Error loading iF
-000075c0: 444f 2066 696c 6522 2c66 696c 652c 2264  DO file",file,"d
-000075d0: 6f65 7320 6e6f 7420 636f 6e74 6169 6e22  oes not contain"
-000075e0: 2c73 656c 662e 696d 6167 6553 6574 4974  ,self.imageSetIt
-000075f0: 656d 734b 6579 290a 0a20 2020 2020 2020  emsKey)..       
-00007600: 2069 6620 2073 656c 662e 6966 646f 5f74   if  self.ifdo_t
-00007610: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-00007620: 4865 6164 6572 4b65 795d 203d 3d20 4e6f  HeaderKey] == No
-00007630: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00007640: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-00007650: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-00007660: 724b 6579 5d20 3d20 7b7d 0a20 2020 2020  rKey] = {}.     
-00007670: 2020 2069 6620 7365 6c66 2e69 6664 6f5f     if self.ifdo_
-00007680: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-00007690: 7449 7465 6d73 4b65 795d 203d 3d20 4e6f  tItemsKey] == No
-000076a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000076b0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-000076c0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-000076d0: 4b65 795d 203d 207b 7d0a 0a20 2020 2020  Key] = {}..     
-000076e0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-000076f0: 2822 6946 444f 2066 696c 6520 6c6f 6164  ("iFDO file load
-00007700: 6564 3a5c 7422 2b6f 732e 7061 7468 2e62  ed:\t"+os.path.b
-00007710: 6173 656e 616d 6528 6669 6c65 2929 0a0a  asename(file))..
-00007720: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
-00007730: 6946 444f 2076 6572 7369 6f6e 0a20 2020  iFDO version.   
-00007740: 2020 2020 2072 6561 6456 6572 7369 6f6e       readVersion
-00007750: 203d 2022 762e 312e 302e 3022 2023 2064   = "v.1.0.0" # d
-00007760: 6964 206e 6f74 2068 6176 6520 7468 6520  id not have the 
-00007770: 2769 6d61 6765 2d73 6574 2d69 6664 6f2d  'image-set-ifdo-
-00007780: 7665 7273 696f 6e27 2066 6965 6c64 2079  version' field y
-00007790: 6574 0a20 2020 2020 2020 2074 7279 3a20  et.        try: 
-000077a0: 0a20 2020 2020 2020 2020 2020 2072 6561  .            rea
-000077b0: 6456 6572 7369 6f6e 203d 2073 656c 662e  dVersion = self.
-000077c0: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
-000077d0: 6167 652d 7365 742d 6966 646f 2d76 6572  age-set-ifdo-ver
-000077e0: 7369 6f6e 2729 0a20 2020 2020 2020 2065  sion').        e
-000077f0: 7863 6570 7420 4b65 7945 7272 6f72 3a0a  xcept KeyError:.
-00007800: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00007810: 0a20 2020 2020 2020 2069 6e74 5265 6164  .        intRead
-00007820: 5665 7273 696f 6e20 3d20 5665 7273 696f  Version = Versio
-00007830: 6e28 7265 6164 5665 7273 696f 6e29 0a20  n(readVersion). 
-00007840: 2020 2020 2020 2069 6e74 5468 6973 5665         intThisVe
-00007850: 7273 696f 6e20 3d20 5665 7273 696f 6e28  rsion = Version(
-00007860: 6d69 7174 762e 6946 444f 5f76 6572 7369  miqtv.iFDO_versi
-00007870: 6f6e 290a 2020 2020 2020 2020 6966 2069  on).        if i
-00007880: 6e74 5265 6164 5665 7273 696f 6e20 3c20  ntReadVersion < 
-00007890: 696e 7454 6869 7356 6572 7369 6f6e 3a0a  intThisVersion:.
-000078a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000078b0: 2e70 726f 762e 6c6f 6728 224c 6f61 6465  .prov.log("Loade
-000078c0: 6420 6946 444f 2068 6173 2076 6572 7369  d iFDO has versi
-000078d0: 6f6e 2022 202b 2072 6561 6456 6572 7369  on " + readVersi
-000078e0: 6f6e 202b 2022 2061 6e64 2077 696c 6c20  on + " and will 
-000078f0: 6265 2075 7064 6174 6564 2074 6f20 7665  be updated to ve
-00007900: 7273 696f 6e20 2220 2b20 6d69 7174 762e  rsion " + miqtv.
-00007910: 6946 444f 5f76 6572 7369 6f6e 290a 2020  iFDO_version).  
-00007920: 2020 2020 2020 6966 2069 6e74 5265 6164        if intRead
-00007930: 5665 7273 696f 6e20 3e20 696e 7454 6869  Version > intThi
-00007940: 7356 6572 7369 6f6e 3a0a 2020 2020 2020  sVersion:.      
-00007950: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-00007960: 6c6f 6728 2243 4155 5449 4f4e 3a20 4c6f  log("CAUTION: Lo
-00007970: 6164 6564 2069 4644 4f20 6861 7320 7665  aded iFDO has ve
-00007980: 7273 696f 6e20 2220 2b20 7265 6164 5665  rsion " + readVe
-00007990: 7273 696f 6e20 2b20 2220 6973 2061 6865  rsion + " is ahe
-000079a0: 6164 206f 6620 7665 7273 696f 6e20 7573  ad of version us
-000079b0: 6564 2068 6572 653a 2022 202b 206d 6971  ed here: " + miq
-000079c0: 7476 2e69 4644 4f5f 7665 7273 696f 6e29  tv.iFDO_version)
-000079d0: 0a0a 2020 2020 2020 2020 2320 666f 7220  ..        # for 
-000079e0: 736f 6f6f 6f6f 6d65 2072 6561 736f 6e20  sooooome reason 
-000079f0: 7468 6973 2066 6978 6573 2061 2068 6963  this fixes a hic
-00007a00: 6b75 7020 6f66 2074 6865 2070 726f 6720  kup of the prog 
-00007a10: 696e 2063 7265 6174 6569 4644 4f28 290a  in createiFDO().
-00007a20: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
-00007a30: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
-00007a40: 726f 6772 6573 734d 7367 2822 666f 6f22  rogressMsg("foo"
-00007a50: 2c20 312c 6d6f 6475 6c6f 3d31 290a 2020  , 1,modulo=1).  
-00007a60: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
-00007a70: 2829 0a20 2020 2020 2020 2074 7279 3a0a  ().        try:.
-00007a80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007a90: 2e63 6f6e 7665 7274 546f 4465 6661 756c  .convertToDefaul
-00007aa0: 7444 6174 6554 696d 6546 6f72 6d61 7428  tDateTimeFormat(
-00007ab0: 7365 6c66 2e69 6664 6f5f 746d 7029 0a20  self.ifdo_tmp). 
-00007ac0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-00007ad0: 6365 7074 696f 6e20 6173 2065 783a 0a20  ception as ex:. 
-00007ae0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007af0: 7072 6f76 2e6c 6f67 2822 4368 6563 6b69  prov.log("Checki
-00007b00: 6e67 2064 6174 6574 696d 6520 666f 726d  ng datetime form
-00007b10: 6174 3a20 2220 2b20 7374 7228 6578 2929  at: " + str(ex))
-00007b20: 0a0a 2020 2020 2020 2020 2320 666f 7220  ..        # for 
-00007b30: 736f 6f6f 6f6f 6d65 2072 6561 736f 6e20  sooooome reason 
-00007b40: 7468 6973 2066 6978 6573 2061 2068 6963  this fixes a hic
-00007b50: 6b75 7020 6f66 2074 6865 2070 726f 6720  kup of the prog 
-00007b60: 696e 2063 7265 6174 6569 4644 4f28 290a  in createiFDO().
-00007b70: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
-00007b80: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
-00007b90: 726f 6772 6573 734d 7367 2822 666f 6f22  rogressMsg("foo"
-00007ba0: 2c20 312c 6d6f 6475 6c6f 3d31 290a 2020  , 1,modulo=1).  
-00007bb0: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
-00007bc0: 2829 0a0a 2020 2020 2020 2020 7365 6c66  ()..        self
-00007bd0: 2e5f 7472 795f 7570 6772 6164 655f 746f  ._try_upgrade_to
-00007be0: 5f69 6664 6f5f 7665 7273 696f 6e5f 3278  _ifdo_version_2x
-00007bf0: 2829 0a0a 2020 2020 2020 2020 2320 6368  ()..        # ch
-00007c00: 6563 6b20 7265 6164 2069 4644 4f20 6669  eck read iFDO fi
-00007c10: 6c65 0a20 2020 2020 2020 2074 7279 3a0a  le.        try:.
-00007c20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007c30: 2e63 7265 6174 6569 4644 4f28 7365 6c66  .createiFDO(self
-00007c40: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-00007c50: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-00007c60: 5d2c 206d 6971 7469 2e63 7265 6174 6549  ], miqti.createI
-00007c70: 6d61 6765 4974 656d 734c 6973 7446 726f  mageItemsListFro
-00007c80: 6d49 6d61 6765 4974 656d 7344 6963 7428  mImageItemsDict(
-00007c90: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-00007ca0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-00007cb0: 4b65 795d 2929 0a20 2020 2020 2020 2065  Key])).        e
-00007cc0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-00007cd0: 6173 2065 783a 0a20 2020 2020 2020 2020  as ex:.         
-00007ce0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00007cf0: 2822 4c6f 6164 6564 2069 4644 4f20 6669  ("Loaded iFDO fi
-00007d00: 6c65 206e 6f74 2076 616c 6964 2079 6574  le not valid yet
-00007d10: 3a20 2220 2b20 7374 7228 6578 2929 0a0a  : " + str(ex))..
-00007d20: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00007d30: 7275 650a 0a0a 2020 2020 6465 6620 7772  rue...    def wr
-00007d40: 6974 655f 6966 646f 5f66 696c 6528 7365  ite_ifdo_file(se
-00007d50: 6c66 2c61 6c6c 6f77 5f6d 6973 7369 6e67  lf,allow_missing
-00007d60: 5f72 6571 7569 7265 643d 4661 6c73 6529  _required=False)
-00007d70: 3a0a 2020 2020 2020 2020 2222 2220 5772  :.        """ Wr
-00007d80: 6974 6573 2061 6e20 6946 444f 2066 696c  ites an iFDO fil
-00007d90: 6520 746f 2064 6973 6b2e 204f 7665 7277  e to disk. Overw
-00007da0: 7269 7465 7320 706f 7465 6e74 6961 6c6c  rites potentiall
-00007db0: 7920 6578 6973 7469 6e67 2066 696c 652e  y existing file.
-00007dc0: 2222 220a 0a20 2020 2020 2020 2073 203d  """..        s =
-00007dd0: 206d 6971 7463 2e50 7269 6e74 4c6f 6164   miqtc.PrintLoad
-00007de0: 696e 674d 7367 2822 5772 6974 696e 6720  ingMsg("Writing 
-00007df0: 6946 444f 2066 696c 6522 290a 0a20 2020  iFDO file")..   
-00007e00: 2020 2020 2023 2063 6865 636b 2066 6965       # check fie
-00007e10: 6c64 7320 6167 6169 6e20 6966 2063 6861  lds again if cha
-00007e20: 6e67 6564 2073 696e 6365 206c 6173 7420  nged since last 
-00007e30: 6368 6563 6b20 2863 7265 6174 6569 4644  check (createiFD
-00007e40: 4f29 0a20 2020 2020 2020 2069 6620 7365  O).        if se
-00007e50: 6c66 2e69 6664 6f5f 746d 7020 213d 2073  lf.ifdo_tmp != s
-00007e60: 656c 662e 6966 646f 5f63 6865 636b 6564  elf.ifdo_checked
-00007e70: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00007e80: 6c66 2e63 7265 6174 6569 4644 4f28 7365  lf.createiFDO(se
-00007e90: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00007ea0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-00007eb0: 6579 5d2c 206d 6971 7469 2e63 7265 6174  ey], miqti.creat
-00007ec0: 6549 6d61 6765 4974 656d 734c 6973 7446  eImageItemsListF
-00007ed0: 726f 6d49 6d61 6765 4974 656d 7344 6963  romImageItemsDic
-00007ee0: 7428 7365 6c66 2e69 6664 6f5f 746d 705b  t(self.ifdo_tmp[
-00007ef0: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
-00007f00: 6d73 4b65 795d 292c 0a20 2020 2020 2020  msKey]),.       
-00007f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f20: 2020 2020 2061 6c6c 6f77 5f6d 6973 7369       allow_missi
-00007f30: 6e67 5f72 6571 7569 7265 643d 616c 6c6f  ng_required=allo
-00007f40: 775f 6d69 7373 696e 675f 7265 7175 6972  w_missing_requir
-00007f50: 6564 290a 2020 2020 2020 2020 0a20 2020  ed).        .   
-00007f60: 2020 2020 2023 2061 6464 2022 2473 6368       # add "$sch
-00007f70: 656d 6122 0a20 2020 2020 2020 2073 656c  ema".        sel
-00007f80: 662e 6966 646f 5f63 6865 636b 6564 5b22  f.ifdo_checked["
-00007f90: 2473 6368 656d 6122 5d20 3d20 6d69 7174  $schema"] = miqt
-00007fa0: 762e 6966 646f 5f73 6368 656d 615b 2724  v.ifdo_schema['$
-00007fb0: 6964 275d 0a20 2020 2020 2020 200a 2020  id'].        .  
-00007fc0: 2020 2020 2020 6946 444f 5f70 6174 6820        iFDO_path 
-00007fd0: 3d20 7365 6c66 2e67 6574 6946 444f 4669  = self.getiFDOFi
-00007fe0: 6c65 4e61 6d65 286f 7665 7277 7269 7465  leName(overwrite
-00007ff0: 3d54 7275 6529 0a0a 2020 2020 2020 2020  =True)..        
-00008000: 2320 7075 7473 2065 7665 7279 7468 696e  # puts everythin
-00008010: 6720 696e 206f 6e65 206c 696e 650a 2020  g in one line.  
-00008020: 2020 2020 2020 2377 6974 6820 6f70 656e        #with open
-00008030: 2869 4644 4f5f 7061 7468 2e72 6570 6c61  (iFDO_path.repla
-00008040: 6365 2822 7961 6d6c 222c 226a 736f 6e22  ce("yaml","json"
-00008050: 292c 2027 7727 2920 6173 2066 703a 0a20  ), 'w') as fp:. 
-00008060: 2020 2020 2020 2023 2020 2020 6a73 6f6e         #    json
-00008070: 2e64 756d 7028 7365 6c66 2e69 6664 6f5f  .dump(self.ifdo_
-00008080: 6368 6563 6b65 642c 2066 7029 0a0a 2020  checked, fp)..  
-00008090: 2020 2020 2020 2320 636f 6e76 6572 7420        # convert 
-000080a0: 6469 6374 696f 6e61 7279 2074 6f20 4a53  dictionary to JS
-000080b0: 4f4e 2073 7472 696e 670a 2020 2020 2020  ON string.      
-000080c0: 2020 6a73 6f6e 5f64 6174 6120 3d20 6a73    json_data = js
-000080d0: 6f6e 2e64 756d 7073 2873 656c 662e 6966  on.dumps(self.if
-000080e0: 646f 5f63 6865 636b 6564 2c20 696e 6465  do_checked, inde
-000080f0: 6e74 203d 2034 2c20 736f 7274 5f6b 6579  nt = 4, sort_key
-00008100: 733d 5472 7565 290a 0a20 2020 2020 2020  s=True)..       
-00008110: 2023 2077 7269 7465 2074 6865 204a 534f   # write the JSO
-00008120: 4e20 7374 7269 6e67 2074 6f20 6120 6669  N string to a fi
-00008130: 6c65 0a20 2020 2020 2020 2077 6974 6820  le.        with 
-00008140: 6f70 656e 2869 4644 4f5f 7061 7468 2c20  open(iFDO_path, 
-00008150: 2777 2729 2061 7320 663a 0a20 2020 2020  'w') as f:.     
-00008160: 2020 2020 2020 2066 2e77 7269 7465 286a         f.write(j
-00008170: 736f 6e5f 6461 7461 290a 2020 2020 2020  son_data).      
-00008180: 2020 0a20 2020 2020 2020 2023 206c 6f67    .        # log
-00008190: 2063 6861 6e67 6573 0a20 2020 2020 2020   changes.       
-000081a0: 2069 6620 6e6f 7420 7365 6c66 2e69 6664   if not self.ifd
-000081b0: 6f5f 7061 7273 6564 2069 7320 4e6f 6e65  o_parsed is None
-000081c0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000081d0: 646f 5f75 7064 6174 6520 3d20 4465 6570  do_update = Deep
-000081e0: 4469 6666 2873 656c 662e 6966 646f 5f70  Diff(self.ifdo_p
-000081f0: 6172 7365 642c 7365 6c66 2e69 6664 6f5f  arsed,self.ifdo_
-00008200: 6368 6563 6b65 6429 0a20 2020 2020 2020  checked).       
-00008210: 2020 2020 2023 7070 7269 6e74 2869 6664       #pprint(ifd
-00008220: 6f5f 7570 6461 7465 290a 2020 2020 2020  o_update).      
-00008230: 2020 2020 2020 6966 2069 6664 6f5f 7570        if ifdo_up
-00008240: 6461 7465 2021 3d20 7b7d 3a0a 2020 2020  date != {}:.    
-00008250: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008260: 2e70 726f 762e 6c6f 6728 2269 4644 4f20  .prov.log("iFDO 
-00008270: 7570 6461 7465 6422 290a 2020 2020 2020  updated").      
-00008280: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00008290: 726f 762e 6c6f 6728 7374 7228 6966 646f  rov.log(str(ifdo
-000082a0: 5f75 7064 6174 6529 2c64 6f6e 7453 686f  _update),dontSho
-000082b0: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
-000082c0: 7365 6c66 2e70 726f 762e 6c6f 6728 2257  self.prov.log("W
-000082d0: 726f 7465 2069 4644 4f20 746f 2066 696c  rote iFDO to fil
-000082e0: 6520 2220 2b20 6946 444f 5f70 6174 6829  e " + iFDO_path)
-000082f0: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
-00008300: 6f76 2e77 7269 7465 2873 656c 662e 6469  ov.write(self.di
-00008310: 722e 746f 2873 656c 662e 6469 722e 6474  r.to(self.dir.dt
-00008320: 2e70 726f 746f 636f 6c29 290a 2020 2020  .protocol)).    
-00008330: 2020 2020 732e 7374 6f70 2829 0a0a 2020      s.stop()..  
-00008340: 2020 6465 6620 7772 6974 6569 4644 4f66    def writeiFDOf
-00008350: 696c 6528 7365 6c66 2c61 6c6c 6f77 5f6d  ile(self,allow_m
-00008360: 6973 7369 6e67 5f72 6571 7569 7265 643d  issing_required=
-00008370: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-00008380: 2222 2220 4465 7072 6563 6174 6564 202d  """ Deprecated -
-00008390: 2075 7365 2077 7269 7465 5f69 6664 6f5f   use write_ifdo_
-000083a0: 6669 6c65 2022 2222 0a20 2020 2020 2020  file """.       
-000083b0: 2073 656c 662e 7772 6974 655f 6966 646f   self.write_ifdo
-000083c0: 5f66 696c 6528 616c 6c6f 775f 6d69 7373  _file(allow_miss
-000083d0: 696e 675f 7265 7175 6972 6564 290a 0a0a  ing_required)...
-000083e0: 2020 2020 6465 6620 7365 7469 4644 4f46      def setiFDOF
-000083f0: 696c 654e 616d 6528 7365 6c66 2c69 4644  ileName(self,iFD
-00008400: 4f66 696c 653a 7374 7229 3a0a 2020 2020  Ofile:str):.    
-00008410: 2020 2020 2222 2220 5365 7420 7468 6520      """ Set the 
-00008420: 6375 7272 656e 7420 6946 444f 2066 696c  current iFDO fil
-00008430: 6520 6e61 6d65 2077 6974 6820 7061 7468  e name with path
-00008440: 2e20 5365 7420 746f 2022 2220 696e 206f  . Set to "" in o
-00008450: 7264 6572 2074 6f20 6765 7420 6465 6661  rder to get defa
-00008460: 756c 7420 6e61 6d65 2061 6e64 206c 6f63  ult name and loc
-00008470: 6174 696f 6e2e 2022 2222 0a20 2020 2020  ation. """.     
-00008480: 2020 2073 656c 662e 6946 444f 6669 6c65     self.iFDOfile
-00008490: 5f20 3d20 6946 444f 6669 6c65 0a20 2020  _ = iFDOfile.   
-000084a0: 2020 2020 2073 656c 662e 6946 444f 6669       self.iFDOfi
-000084b0: 6c65 5f20 3d20 7365 6c66 2e67 6574 6946  le_ = self.getiF
-000084c0: 444f 4669 6c65 4e61 6d65 2829 2023 2063  DOFileName() # c
-000084d0: 6f6e 7374 7275 6374 2064 6566 6175 6c74  onstruct default
-000084e0: 206e 616d 6520 6966 2065 6d70 7479 0a20   name if empty. 
-000084f0: 2020 2020 2020 2069 6620 6d69 7174 632e         if miqtc.
-00008500: 6173 7365 7274 536c 6173 6828 6f73 2e70  assertSlash(os.p
-00008510: 6174 682e 6469 726e 616d 6528 7365 6c66  ath.dirname(self
-00008520: 2e69 4644 4f66 696c 655f 2929 2021 3d20  .iFDOfile_)) != 
-00008530: 6d69 7174 632e 6173 7365 7274 536c 6173  miqtc.assertSlas
-00008540: 6828 7365 6c66 2e64 6972 2e74 6f28 7365  h(self.dir.to(se
-00008550: 6c66 2e64 6972 2e64 742e 7072 6f64 7563  lf.dir.dt.produc
-00008560: 7473 2929 3a0a 2020 2020 2020 2020 2020  ts)):.          
-00008570: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-00008580: 2243 6175 7469 6f6e 2120 6946 444f 2066  "Caution! iFDO f
-00008590: 696c 6520 7061 7468 2069 7320 6e6f 7420  ile path is not 
-000085a0: 696e 2027 7072 6f64 7563 7473 2720 7375  in 'products' su
-000085b0: 6220 666f 6c64 6572 2061 7320 7265 636f  b folder as reco
-000085c0: 6d6d 656e 6465 642e 2043 6f6e 7369 6465  mmended. Conside
-000085d0: 7220 7265 7365 7474 696e 6720 7769 7468  r resetting with
-000085e0: 2073 6574 6946 444f 4669 6c65 4e61 6d65   setiFDOFileName
-000085f0: 2829 2e20 2220 2b20 6946 444f 6669 6c65  (). " + iFDOfile
-00008600: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
-00008610: 2020 2020 2020 2020 2020 2065 7665 6e74             event
-00008620: 203d 2073 656c 662e 6669 6e64 546d 7046   = self.findTmpF
-00008630: 6965 6c64 2827 696d 6167 652d 6576 656e  ield('image-even
-00008640: 7427 295b 276e 616d 6527 5d0a 2020 2020  t')['name'].    
-00008650: 2020 2020 2020 2020 7365 6e73 6f72 203d          sensor =
-00008660: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
-00008670: 6c64 2827 696d 6167 652d 7365 6e73 6f72  ld('image-sensor
-00008680: 2729 5b27 6e61 6d65 275d 0a20 2020 2020  ')['name'].     
-00008690: 2020 2065 7863 6570 7420 6d69 7174 632e     except miqtc.
-000086a0: 4966 646f 4578 6365 7074 696f 6e3a 0a20  IfdoException:. 
-000086b0: 2020 2020 2020 2020 2020 2065 7665 6e74             event
-000086c0: 203d 2073 656c 662e 6469 722e 6576 656e   = self.dir.even
-000086d0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-000086e0: 7365 6e73 6f72 203d 2073 656c 662e 6469  sensor = self.di
-000086f0: 722e 7365 6e73 6f72 2829 0a0a 2020 2020  r.sensor()..    
-00008700: 2020 2020 6946 444f 6669 6c65 4e61 6d65      iFDOfileName
-00008710: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
-00008720: 616d 6528 7365 6c66 2e69 4644 4f66 696c  ame(self.iFDOfil
-00008730: 655f 290a 2020 2020 2020 2020 6966 206e  e_).        if n
-00008740: 6f74 2065 7665 6e74 2069 6e20 6946 444f  ot event in iFDO
-00008750: 6669 6c65 4e61 6d65 206f 7220 6e6f 7420  fileName or not 
-00008760: 6946 444f 2e67 6574 5368 6f72 7445 7175  iFDO.getShortEqu
-00008770: 6970 6d65 6e74 4944 2873 656e 736f 7229  ipmentID(sensor)
-00008780: 2069 6e20 6946 444f 6669 6c65 4e61 6d65   in iFDOfileName
-00008790: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-000087a0: 6c66 2e70 726f 762e 6c6f 6728 2243 6175  lf.prov.log("Cau
-000087b0: 7469 6f6e 2120 6946 444f 2066 696c 6520  tion! iFDO file 
-000087c0: 6e61 6d65 2064 6f65 7320 6e6f 7420 636f  name does not co
-000087d0: 6e74 6169 6e20 7072 6f6a 6563 742c 2065  ntain project, e
-000087e0: 7665 6e74 2061 6e64 2073 656e 736f 7220  vent and sensor 
-000087f0: 6e61 6d65 2061 7320 7265 636f 6d6d 656e  name as recommen
-00008800: 6465 642e 2043 6f6e 7369 6465 7220 7265  ded. Consider re
-00008810: 7365 7474 696e 6720 7769 7468 2073 6574  setting with set
-00008820: 6946 444f 4669 6c65 4e61 6d65 2829 2e20  iFDOFileName(). 
-00008830: 2220 2b20 6946 444f 6669 6c65 290a 0a0a  " + iFDOfile)...
-00008840: 2020 2020 6465 6620 6765 7469 4644 4f46      def getiFDOF
-00008850: 696c 654e 616d 6528 7365 6c66 2c6f 7665  ileName(self,ove
-00008860: 7277 7269 7465 3d46 616c 7365 293a 0a20  rwrite=False):. 
-00008870: 2020 2020 2020 2022 2222 2052 6574 7572         """ Retur
-00008880: 6e73 2074 6865 2063 7572 7265 6e74 2069  ns the current i
-00008890: 4644 4f20 6669 6c65 2773 206e 616d 6520  FDO file's name 
-000088a0: 7769 7468 2070 6174 682e 2049 6620 6e6f  with path. If no
-000088b0: 7420 7365 7420 7965 7420 6f72 206f 7665  t set yet or ove
-000088c0: 7277 7269 7465 3d3d 5472 7565 2069 7420  rwrite==True it 
-000088d0: 7265 7475 726e 7320 7468 6520 6f6e 6520  returns the one 
-000088e0: 6d61 7463 6869 6e67 2069 6d61 6765 2d73  matching image-s
-000088f0: 6574 2d6e 616d 652e 2022 2222 0a20 2020  et-name. """.   
-00008900: 2020 2020 2069 6620 7365 6c66 2e69 4644       if self.iFD
-00008910: 4f66 696c 655f 203d 3d20 2222 206f 7220  Ofile_ == "" or 
-00008920: 6f76 6572 7772 6974 653a 0a20 2020 2020  overwrite:.     
-00008930: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
-00008940: 203d 2073 656c 662e 6669 6e64 546d 7046   = self.findTmpF
-00008950: 6965 6c64 2827 696d 6167 652d 7365 742d  ield('image-set-
-00008960: 6e61 6d65 2729 202b 2027 5f69 4644 4f2e  name') + '_iFDO.
-00008970: 6a73 6f6e 270a 2020 2020 2020 2020 2020  json'.          
-00008980: 2020 6966 2073 656c 662e 6946 444f 6669    if self.iFDOfi
-00008990: 6c65 5f20 213d 2022 223a 0a20 2020 2020  le_ != "":.     
-000089a0: 2020 2020 2020 2020 2020 2023 2072 656e             # ren
-000089b0: 616d 6520 6669 6c65 2062 7574 206b 6565  ame file but kee
-000089c0: 7020 6c6f 6361 7469 6f6e 0a20 2020 2020  p location.     
-000089d0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
-000089e0: 6c65 5f6e 616d 6520 213d 206f 732e 7061  le_name != os.pa
-000089f0: 7468 2e62 6173 656e 616d 6528 7365 6c66  th.basename(self
-00008a00: 2e69 4644 4f66 696c 655f 2920 616e 6420  .iFDOfile_) and 
-00008a10: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
-00008a20: 656c 662e 6946 444f 6669 6c65 5f29 3a0a  elf.iFDOfile_):.
-00008a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a40: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-00008a50: 6728 2243 6175 7469 6f6e 2c20 6966 646f  g("Caution, ifdo
-00008a60: 2066 696c 6520 7265 6e61 6d65 6420 746f   file renamed to
-00008a70: 2022 202b 2066 696c 655f 6e61 6d65 290a   " + file_name).
-00008a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a90: 7365 6c66 2e69 4644 4f66 696c 655f 203d  self.iFDOfile_ =
-00008aa0: 206f 732e 7061 7468 2e6a 6f69 6e28 6f73   os.path.join(os
-00008ab0: 2e70 6174 682e 6469 726e 616d 6528 7365  .path.dirname(se
-00008ac0: 6c66 2e69 4644 4f66 696c 655f 292c 6669  lf.iFDOfile_),fi
-00008ad0: 6c65 5f6e 616d 6529 0a20 2020 2020 2020  le_name).       
-00008ae0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00008af0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008b00: 6946 444f 6669 6c65 5f20 3d20 6f73 2e70  iFDOfile_ = os.p
-00008b10: 6174 682e 6a6f 696e 2873 656c 662e 6469  ath.join(self.di
-00008b20: 722e 746f 2873 656c 662e 6469 722e 6474  r.to(self.dir.dt
-00008b30: 2e70 726f 6475 6374 7329 2c20 6669 6c65  .products), file
-00008b40: 5f6e 616d 6529 0a20 2020 2020 2020 2072  _name).        r
-00008b50: 6574 7572 6e20 7365 6c66 2e69 4644 4f66  eturn self.iFDOf
-00008b60: 696c 655f 0a0a 0a20 2020 2064 6566 2073  ile_...    def s
-00008b70: 6574 5f69 6d61 6765 5f73 6574 5f6e 616d  et_image_set_nam
-00008b80: 655f 6669 656c 645f 6672 6f6d 5f70 726f  e_field_from_pro
-00008b90: 6a65 6374 5f65 7665 6e74 5f73 656e 736f  ject_event_senso
-00008ba0: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
-00008bb0: 2022 2222 2053 6574 7320 6669 656c 6420   """ Sets field 
-00008bc0: 696d 6167 652d 7365 742d 6e61 6d65 2066  image-set-name f
-00008bd0: 726f 6d20 6375 7272 656e 7420 746d 7020  rom current tmp 
-00008be0: 6669 656c 6473 2066 6f72 2070 726f 6a65  fields for proje
-00008bf0: 6374 2c20 6576 656e 7420 616e 6420 7365  ct, event and se
-00008c00: 6e73 6f72 2e20 0a20 2020 2020 2020 2052  nsor. .        R
-00008c10: 6574 7572 6e73 2069 6d61 6765 2d73 6574  eturns image-set
-00008c20: 2d6e 616d 6520 7661 6c75 652e 2022 2222  -name value. """
-00008c30: 0a20 2020 2020 2020 206e 6577 5f69 6d61  .        new_ima
-00008c40: 6765 5f73 6574 5f6e 616d 6520 3d20 7365  ge_set_name = se
-00008c50: 6c66 2e63 6f6e 7374 7275 6374 496d 6167  lf.constructImag
-00008c60: 6553 6574 4e61 6d65 2873 656c 662e 6966  eSetName(self.if
-00008c70: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-00008c80: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
-00008c90: 696d 6167 652d 7072 6f6a 6563 7427 5d5b  image-project'][
-00008ca0: 276e 616d 6527 5d2c 0a20 2020 2020 2020  'name'],.       
-00008cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008cd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00008ce0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-00008cf0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-00008d00: 795d 5b27 696d 6167 652d 6576 656e 7427  y]['image-event'
-00008d10: 5d5b 276e 616d 6527 5d2c 0a20 2020 2020  ]['name'],.     
-00008d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00008d50: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-00008d60: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-00008d70: 4b65 795d 5b27 696d 6167 652d 7365 6e73  Key]['image-sens
-00008d80: 6f72 275d 5b27 6e61 6d65 275d 290a 2020  or']['name']).  
-00008d90: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
-00008da0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-00008db0: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
-00008dc0: 6765 2d73 6574 2d6e 616d 6527 5d20 3d20  ge-set-name'] = 
-00008dd0: 6e65 775f 696d 6167 655f 7365 745f 6e61  new_image_set_na
-00008de0: 6d65 0a20 2020 2020 2020 2072 6574 7572  me.        retur
-00008df0: 6e20 6e65 775f 696d 6167 655f 7365 745f  n new_image_set_
-00008e00: 6e61 6d65 0a20 2020 2020 2020 200a 0a20  name.        .. 
-00008e10: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-00008e20: 0a20 2020 2064 6566 2063 6f6e 7374 7275  .    def constru
-00008e30: 6374 496d 6167 6553 6574 4e61 6d65 2870  ctImageSetName(p
-00008e40: 726f 6a65 6374 3a73 7472 2c65 7665 6e74  roject:str,event
-00008e50: 3a73 7472 2c73 656e 736f 723a 7374 7229  :str,sensor:str)
-00008e60: 3a0a 2020 2020 2020 2020 2222 2220 7265  :.        """ re
-00008e70: 7475 726e 7320 3c70 726f 6a65 6374 3e5f  turns <project>_
-00008e80: 3c65 7665 6e74 3e5f 3c73 656e 736f 723e  <event>_<sensor>
-00008e90: 2c20 7769 7468 2073 686f 7274 2076 6572  , with short ver
-00008ea0: 7369 6f6e 206f 6620 3c73 656e 736f 723e  sion of <sensor>
-00008eb0: 2028 6f6e 6c79 2069 6429 2c20 7072 6576   (only id), prev
-00008ec0: 656e 7469 6e67 2070 6f74 656e 7469 616c  enting potential
-00008ed0: 2064 6f75 626c 696e 6720 6f66 203c 7072   doubling of <pr
-00008ee0: 6f6a 6563 743e 2020 2222 220a 2020 2020  oject>  """.    
-00008ef0: 2020 2020 7365 6e73 6f72 5f73 686f 7274      sensor_short
-00008f00: 203d 2069 4644 4f2e 6765 7453 686f 7274   = iFDO.getShort
-00008f10: 4571 7569 706d 656e 7449 4428 7365 6e73  EquipmentID(sens
-00008f20: 6f72 290a 2020 2020 2020 2020 6966 206c  or).        if l
-00008f30: 656e 2865 7665 6e74 2920 3e20 6c65 6e28  en(event) > len(
-00008f40: 7072 6f6a 6563 7429 2061 6e64 2065 7665  project) and eve
-00008f50: 6e74 5b30 3a6c 656e 2870 726f 6a65 6374  nt[0:len(project
-00008f60: 295d 203d 3d20 7072 6f6a 6563 743a 0a20  )] == project:. 
-00008f70: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-00008f80: 5f73 6574 5f6e 616d 655f 203d 2065 7665  _set_name_ = eve
-00008f90: 6e74 202b 2022 5f22 202b 2073 656e 736f  nt + "_" + senso
-00008fa0: 725f 7368 6f72 740a 2020 2020 2020 2020  r_short.        
-00008fb0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00008fc0: 2020 696d 6167 655f 7365 745f 6e61 6d65    image_set_name
-00008fd0: 5f20 3d20 7072 6f6a 6563 7420 2b20 225f  _ = project + "_
-00008fe0: 2220 2b20 6576 656e 7420 2b20 225f 2220  " + event + "_" 
-00008ff0: 2b20 7365 6e73 6f72 5f73 686f 7274 0a20  + sensor_short. 
-00009000: 2020 2020 2020 2072 6574 7572 6e20 696d         return im
-00009010: 6167 655f 7365 745f 6e61 6d65 5f20 2320  age_set_name_ # 
-00009020: 544f 444f 2069 6e63 6c75 6465 2064 6174  TODO include dat
-00009030: 6154 7970 653f 0a0a 0a20 2020 2040 7374  aType?...    @st
-00009040: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-00009050: 6566 2067 6574 5368 6f72 7445 7175 6970  ef getShortEquip
-00009060: 6d65 6e74 4944 2865 7175 6970 6d65 6e74  mentID(equipment
-00009070: 4944 3a73 7472 293a 0a20 2020 2020 2020  ID:str):.       
-00009080: 2022 2222 2072 6574 7572 6e73 2065 7175   """ returns equ
-00009090: 6970 6d65 6e74 2069 6420 7769 7468 6f75  ipment id withou
-000090a0: 7420 706f 7465 6e74 6961 6c6c 206c 6f6e  t potentiall lon
-000090b0: 6720 3c6e 616d 653e 2070 6172 742c 2069  g <name> part, i
-000090c0: 2e65 2e3a 203c 6f77 6e65 723e 5f3c 7479  .e.: <owner>_<ty
-000090d0: 7065 3e2d 3c74 7970 6520 696e 6465 785b  pe>-<type index[
-000090e0: 5f3c 7375 6274 7970 653e 5d20 2222 220a  _<subtype>] """.
-000090f0: 2020 2020 2020 2020 7265 7475 726e 2027          return '
-00009100: 5f27 2e6a 6f69 6e28 6571 7569 706d 656e  _'.join(equipmen
-00009110: 7449 442e 7370 6c69 7428 275f 2729 5b30  tID.split('_')[0
-00009120: 3a33 5d29 0a0a 2020 2020 4073 7461 7469  :3])..    @stati
-00009130: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-00009140: 636f 6e73 7472 7563 7469 4644 4f66 696c  constructiFDOfil
-00009150: 654e 616d 6528 7072 6f6a 6563 743a 7374  eName(project:st
-00009160: 722c 6576 656e 743a 7374 722c 7365 6e73  r,event:str,sens
-00009170: 6f72 3a73 7472 293a 0a20 2020 2020 2020  or:str):.       
-00009180: 2022 2222 2072 6574 7572 6e73 203c 636f   """ returns <co
-00009190: 6e73 7472 7563 7449 6d61 6765 5365 744e  nstructImageSetN
-000091a0: 616d 6528 293e 5f69 4644 4f2e 6a73 6f6e  ame()>_iFDO.json
-000091b0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-000091c0: 7572 6e20 6946 444f 2e63 6f6e 7374 7275  urn iFDO.constru
-000091d0: 6374 496d 6167 6553 6574 4e61 6d65 2870  ctImageSetName(p
-000091e0: 726f 6a65 6374 2c65 7665 6e74 2c73 656e  roject,event,sen
-000091f0: 736f 7229 202b 2027 5f69 4644 4f2e 6a73  sor) + '_iFDO.js
-00009200: 6f6e 2720 0a0a 2020 2020 0a20 2020 2040  on' ..    .    @
-00009210: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
-00009220: 2064 6566 205f 5f67 6574 4669 656c 6456   def __getFieldV
-00009230: 616c 7565 2869 6664 6f3a 6469 6374 2c6b  alue(ifdo:dict,k
-00009240: 6579 733a 6c69 7374 2c64 6566 6175 6c74  eys:list,default
-00009250: 5f6f 6e6c 7920 3d20 4661 6c73 6529 3a0a  _only = False):.
-00009260: 2020 2020 2020 2020 2222 2220 7265 7475          """ retu
-00009270: 726e 7320 636f 7079 206f 6620 7365 7420  rns copy of set 
-00009280: 6f72 2069 7465 6d20 6669 656c 6420 7661  or item field va
-00009290: 6c75 652c 2061 6c73 6f20 636f 6e73 6964  lue, also consid
-000092a0: 6572 6e67 2064 6566 6175 6c74 2076 616c  erng default val
-000092b0: 7565 7320 6672 6f6d 2068 6561 6465 722e  ues from header.
-000092c0: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
-000092d0: 206b 6579 7320 6173 2065 2e67 2e20 5b3c   keys as e.g. [<
-000092e0: 6974 656d 3e2c 3c6b 6579 3e2c 2e2e 5d2e  item>,<key>,..].
-000092f0: 2043 616e 2062 6520 7573 6564 2066 6f72   Can be used for
-00009300: 2068 6561 6465 7220 6669 656c 6473 2061   header fields a
-00009310: 7320 7765 6c6c 2061 7320 6974 656d 2066  s well as item f
-00009320: 6965 6c64 732e 0a20 2020 2020 2020 2020  ields..         
-00009330: 2020 2049 7465 6d20 696e 6465 7820 6361     Item index ca
-00009340: 6e20 6265 206e 6567 6c65 6374 6564 2c20  n be neglected, 
-00009350: 696e 2063 6173 6520 6f66 2076 6964 656f  in case of video
-00009360: 2061 2064 6963 7420 7b3c 696d 6167 652d   a dict {<image-
-00009370: 6461 7461 7469 6d65 3e3a 3c76 616c 7565  datatime>:<value
-00009380: 3e2c 2e2e 2e7d 2069 7320 7265 7475 726e  >,...} is return
-00009390: 6564 0a20 2020 2020 2020 2020 2020 2075  ed.            u
-000093a0: 6e6c 6573 7320 6465 6661 756c 745f 6f6e  nless default_on
-000093b0: 6c79 203d 2046 616c 7365 2c20 7468 656e  ly = False, then
-000093c0: 2064 6566 6175 6c74 2076 616c 7565 7320   default values 
-000093d0: 6174 2069 6e64 6578 2030 2069 7320 7265  at index 0 is re
-000093e0: 7475 726e 6564 2e0a 2020 2020 2020 2020  turned..        
-000093f0: 2020 2020 5261 6973 6573 2049 6664 6f45      Raises IfdoE
-00009400: 7863 6570 7469 6f6e 2069 6620 6b65 7973  xception if keys
-00009410: 2064 6f20 6e6f 7420 6578 6973 742e 2022   do not exist. "
-00009420: 2222 0a0a 2020 2020 2020 2020 6966 206e  ""..        if n
-00009430: 6f74 206d 6971 7476 2e69 6d61 6765 5f73  ot miqtv.image_s
-00009440: 6574 5f69 7465 6d73 5f6b 6579 2069 6e20  et_items_key in 
-00009450: 6966 646f 206f 7220 6e6f 7420 6d69 7174  ifdo or not miqt
-00009460: 762e 696d 6167 655f 7365 745f 6865 6164  v.image_set_head
-00009470: 6572 5f6b 6579 2069 6e20 6966 646f 3a0a  er_key in ifdo:.
-00009480: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00009490: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
-000094a0: 7074 696f 6e28 2249 6e76 616c 6964 2069  ption("Invalid i
-000094b0: 6664 6f20 6469 6374 2c20 6d69 7373 696e  fdo dict, missin
-000094c0: 6720 6974 656d 7320 6f72 2068 6561 6465  g items or heade
-000094d0: 7220 6b65 793a 2022 202b 2073 7472 2869  r key: " + str(i
-000094e0: 6664 6f29 290a 2020 2020 2020 2020 0a20  fdo)).        . 
-000094f0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-00009500: 696e 7374 616e 6365 286b 6579 732c 6c69  instance(keys,li
-00009510: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
-00009520: 206b 6579 7320 3d20 5b6b 6579 735d 0a0a   keys = [keys]..
-00009530: 2020 2020 2020 2020 2320 7265 6d6f 7665          # remove
-00009540: 2068 6561 6465 7220 6f72 2069 7465 6d20   header or item 
-00009550: 7072 6566 6978 6573 2069 6620 7468 6572  prefixes if ther
-00009560: 650a 2020 2020 2020 2020 6966 206b 6579  e.        if key
-00009570: 735b 305d 203d 3d20 6d69 7174 762e 696d  s[0] == miqtv.im
-00009580: 6167 655f 7365 745f 6974 656d 735f 6b65  age_set_items_ke
-00009590: 7920 6f72 206b 6579 735b 305d 203d 3d20  y or keys[0] == 
-000095a0: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
-000095b0: 6865 6164 6572 5f6b 6579 3a0a 2020 2020  header_key:.    
-000095c0: 2020 2020 2020 2020 6b65 7973 203d 206b          keys = k
-000095d0: 6579 735b 313a 3a5d 0a0a 2020 2020 2020  eys[1::]..      
-000095e0: 2020 6865 6164 6572 203d 2069 6664 6f5b    header = ifdo[
-000095f0: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
-00009600: 6865 6164 6572 5f6b 6579 5d0a 2020 2020  header_key].    
-00009610: 2020 2020 6974 656d 7320 3d20 6966 646f      items = ifdo
-00009620: 5b6d 6971 7476 2e69 6d61 6765 5f73 6574  [miqtv.image_set
-00009630: 5f69 7465 6d73 5f6b 6579 5d0a 2020 2020  _items_key].    
-00009640: 2020 2020 2320 6c6f 6f6b 2066 6f72 2064      # look for d
-00009650: 6566 6175 6c74 2076 616c 7565 0a20 2020  efault value.   
-00009660: 2020 2020 2066 6f72 2073 6b69 7070 6564       for skipped
-00009670: 496e 4865 6164 6572 2069 6e20 7261 6e67  InHeader in rang
-00009680: 6528 6c65 6e28 6b65 7973 2929 3a0a 2020  e(len(keys)):.  
-00009690: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000096a0: 7456 616c 203d 2066 696e 6446 6965 6c64  tVal = findField
-000096b0: 2868 6561 6465 722c 6b65 7973 5b73 6b69  (header,keys[ski
-000096c0: 7070 6564 496e 4865 6164 6572 3a3a 5d29  ppedInHeader::])
-000096d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000096e0: 6465 6661 756c 7456 616c 2021 3d20 2222  defaultVal != ""
-000096f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009700: 2020 6272 6561 6b0a 0a20 2020 2020 2020    break..       
-00009710: 2023 2320 6c6f 6f6b 2066 6f72 2069 7465   ## look for ite
-00009720: 6d20 7661 6c75 650a 2020 2020 2020 2020  m value.        
-00009730: 2320 6865 6164 6572 206f 6e6c 7920 7661  # header only va
-00009740: 6c75 652c 2064 6f6e 2774 2063 6865 636b  lue, don't check
-00009750: 2069 6e20 6974 656d 730a 2020 2020 2020   in items.      
-00009760: 2020 6966 2066 696e 6446 6965 6c64 2869    if findField(i
-00009770: 7465 6d73 2c6b 6579 735b 303a 315d 2920  tems,keys[0:1]) 
-00009780: 3d3d 2022 2220 616e 6420 736b 6970 7065  == "" and skippe
-00009790: 6449 6e48 6561 6465 7220 3d3d 2030 3a0a  dInHeader == 0:.
-000097a0: 2020 2020 2020 2020 2020 2020 7265 7420              ret 
-000097b0: 3d20 6465 6661 756c 7456 616c 0a20 2020  = defaultVal.   
-000097c0: 2020 2020 2020 2020 2069 6620 7265 7420           if ret 
-000097d0: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
-000097e0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-000097f0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-00009800: 2822 6b65 7920 646f 6573 206e 6f74 2065  ("key does not e
-00009810: 7869 7374 3a22 202b 2073 7472 286b 6579  xist:" + str(key
-00009820: 7329 290a 2020 2020 2020 2020 656c 7365  s)).        else
-00009830: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00009840: 6966 2066 6972 7374 206b 6579 206e 6f74  if first key not
-00009850: 2066 6f75 6e64 2069 6e20 6974 656d 732c   found in items,
-00009860: 2069 2e65 2e20 6973 206e 6f74 2061 2069   i.e. is not a i
-00009870: 6d61 6765 206e 616d 652c 2061 6e64 2066  mage name, and f
-00009880: 6972 7374 206b 6579 2069 7320 6e6f 7420  irst key is not 
-00009890: 6120 6865 6164 6572 206b 6579 3a0a 2020  a header key:.  
-000098a0: 2020 2020 2020 2020 2020 6966 2066 696e            if fin
-000098b0: 6446 6965 6c64 2869 7465 6d73 2c6b 6579  dField(items,key
-000098c0: 735b 303a 315d 2920 3d3d 2022 2220 616e  s[0:1]) == "" an
-000098d0: 6420 736b 6970 7065 6449 6e48 6561 6465  d skippedInHeade
-000098e0: 7220 213d 2030 3a0a 2020 2020 2020 2020  r != 0:.        
-000098f0: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
-00009900: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
-00009910: 6e28 2269 7465 6d20 646f 6573 206e 6f74  n("item does not
-00009920: 2065 7869 7374 3a22 202b 2073 7472 286b   exist:" + str(k
-00009930: 6579 735b 303a 315d 2929 0a0a 2020 2020  eys[0:1]))..    
-00009940: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
-00009950: 6966 2069 6e64 6578 2070 726f 7669 6465  if index provide
-00009960: 640a 2020 2020 2020 2020 2020 2020 696e  d.            in
-00009970: 6465 7850 726f 7669 6465 6420 3d20 5472  dexProvided = Tr
-00009980: 7565 0a20 2020 2020 2020 2020 2020 2069  ue.            i
-00009990: 6620 6c65 6e28 6b65 7973 2920 3e20 313a  f len(keys) > 1:
-000099a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000099b0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-000099c0: 2020 2020 2020 2020 2020 696e 6465 7820            index 
-000099d0: 3d20 696e 7428 6b65 7973 5b31 5d29 0a20  = int(keys[1]). 
-000099e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000099f0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
-00009a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009a10: 2020 2020 2069 6e64 6578 5072 6f76 6964       indexProvid
-00009a20: 6564 203d 2046 616c 7365 0a20 2020 2020  ed = False.     
-00009a30: 2020 2020 2020 2065 6c69 6620 6c65 6e28         elif len(
-00009a40: 6b65 7973 2920 3d3d 2031 3a0a 2020 2020  keys) == 1:.    
-00009a50: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-00009a60: 7850 726f 7669 6465 6420 3d20 4661 6c73  xProvided = Fals
-00009a70: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00009a80: 2020 0a20 2020 2020 2020 2020 2020 2069    .            i
-00009a90: 6d61 6765 4974 656d 5469 6d65 506f 696e  mageItemTimePoin
-00009aa0: 7473 203d 2069 7465 6d73 5b6b 6579 735b  ts = items[keys[
-00009ab0: 305d 5d0a 0a20 2020 2020 2020 2020 2020  0]]..           
-00009ac0: 2069 6620 696e 6465 7850 726f 7669 6465   if indexProvide
-00009ad0: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-00009ae0: 2020 2023 2069 6620 6b65 7920 6973 2077     # if key is w
-00009af0: 686f 6c65 2069 6d61 6765 2061 6464 2061  hole image add a
-00009b00: 6c6c 2076 616c 7565 7320 6672 6f6d 2068  ll values from h
-00009b10: 6561 6465 720a 2020 2020 2020 2020 2020  eader.          
-00009b20: 2020 2020 2020 6966 206c 656e 286b 6579        if len(key
-00009b30: 7329 203d 3d20 323a 0a20 2020 2020 2020  s) == 2:.       
-00009b40: 2020 2020 2020 2020 2020 2020 2064 6566               def
-00009b50: 6175 6c74 5661 6c20 3d20 6865 6164 6572  aultVal = header
-00009b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009b70: 2023 2061 6464 2064 6566 6175 6c74 2066   # add default f
-00009b80: 726f 6d20 696e 6465 7820 300a 2020 2020  rom index 0.    
-00009b90: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00009ba0: 656e 286b 6579 7329 203e 2031 2061 6e64  en(keys) > 1 and
-00009bb0: 2069 6e64 6578 2021 3d20 303a 0a20 2020   index != 0:.   
-00009bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bd0: 206b 6579 735f 3020 3d20 636f 7079 2e64   keys_0 = copy.d
-00009be0: 6565 7063 6f70 7928 6b65 7973 290a 2020  eepcopy(keys).  
-00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c00: 2020 6b65 7973 5f30 5b31 5d20 3d20 300a    keys_0[1] = 0.
-00009c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c20: 2020 2020 7265 745f 3020 3d20 6946 444f      ret_0 = iFDO
-00009c30: 2e5f 5f67 6574 4974 656d 5661 6c75 6528  .__getItemValue(
-00009c40: 6974 656d 732c 6b65 7973 5f30 2c73 6b69  items,keys_0,ski
-00009c50: 7070 6564 496e 4865 6164 6572 2c64 6566  ppedInHeader,def
-00009c60: 6175 6c74 5661 6c29 0a20 2020 2020 2020  aultVal).       
-00009c70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00009c80: 6973 696e 7374 616e 6365 2872 6574 5f30  isinstance(ret_0
-00009c90: 2c64 6963 7429 3a0a 2020 2020 2020 2020  ,dict):.        
-00009ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009cb0: 6465 6661 756c 7456 616c 203d 207b 2a2a  defaultVal = {**
-00009cc0: 6465 6661 756c 7456 616c 2c2a 2a72 6574  defaultVal,**ret
-00009cd0: 5f30 7d0a 2020 2020 2020 2020 2020 2020  _0}.            
-00009ce0: 2020 2020 7265 7420 3d20 6946 444f 2e5f      ret = iFDO._
-00009cf0: 5f67 6574 4974 656d 5661 6c75 6528 6974  _getItemValue(it
-00009d00: 656d 732c 6b65 7973 2c73 6b69 7070 6564  ems,keys,skipped
-00009d10: 496e 4865 6164 6572 2c64 6566 6175 6c74  InHeader,default
-00009d20: 5661 6c29 0a20 2020 2020 2020 2020 2020  Val).           
-00009d30: 200a 2020 2020 2020 2020 2020 2020 656c   .            el
-00009d40: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00009d50: 2020 2020 2320 6966 206b 6579 2069 7320      # if key is 
-00009d60: 7768 6f6c 6520 696d 6167 6520 6164 6420  whole image add 
-00009d70: 616c 6c20 7661 6c75 6573 2066 726f 6d20  all values from 
-00009d80: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
-00009d90: 2020 2020 2020 2069 6620 6c65 6e28 6b65         if len(ke
-00009da0: 7973 2920 3d3d 2031 3a0a 2020 2020 2020  ys) == 1:.      
-00009db0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00009dc0: 6661 756c 7456 616c 203d 2068 6561 6465  faultVal = heade
-00009dd0: 720a 0a20 2020 2020 2020 2020 2020 2020  r..             
-00009de0: 2020 2023 2070 6963 7475 7265 202d 3e20     # picture -> 
-00009df0: 6a75 7374 206f 6e65 2065 6e74 7279 2c20  just one entry, 
-00009e00: 696e 7365 7274 2069 6e64 6578 2030 0a20  insert index 0. 
-00009e10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00009e20: 6620 6c65 6e28 696d 6167 6549 7465 6d54  f len(imageItemT
-00009e30: 696d 6550 6f69 6e74 7329 203d 3d20 313a  imePoints) == 1:
-00009e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009e50: 2020 2020 206b 6579 7320 3d20 6b65 7973       keys = keys
-00009e60: 5b30 3a31 5d20 2b20 5b30 5d20 2b20 6b65  [0:1] + [0] + ke
-00009e70: 7973 5b31 3a3a 5d0a 2020 2020 2020 2020  ys[1::].        
-00009e80: 2020 2020 2020 2020 2020 2020 7265 7420              ret 
-00009e90: 3d20 6946 444f 2e5f 5f67 6574 4974 656d  = iFDO.__getItem
-00009ea0: 5661 6c75 6528 6974 656d 732c 6b65 7973  Value(items,keys
-00009eb0: 2c73 6b69 7070 6564 496e 4865 6164 6572  ,skippedInHeader
-00009ec0: 2c64 6566 6175 6c74 5661 6c29 0a20 2020  ,defaultVal).   
-00009ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ee0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00009ef0: 2020 2320 7669 6465 6f20 2d3e 2072 6574    # video -> ret
-00009f00: 7572 6e20 7661 6c75 6573 2066 6f72 2065  urn values for e
-00009f10: 6163 6820 7469 6d65 2073 7461 6d70 0a20  ach time stamp. 
-00009f20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00009f30: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00009f40: 2020 2020 2020 2020 2072 6574 203d 207b           ret = {
-00009f50: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-00009f60: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00009f70: 616e 6765 286c 656e 2869 6d61 6765 4974  ange(len(imageIt
-00009f80: 656d 5469 6d65 506f 696e 7473 2929 3a0a  emTimePoints)):.
-00009f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009fa0: 2020 2020 2020 2020 7469 6d65 506f 696e          timePoin
-00009fb0: 7444 6174 6120 3d20 696d 6167 6549 7465  tData = imageIte
-00009fc0: 6d54 696d 6550 6f69 6e74 735b 695d 0a20  mTimePoints[i]. 
-00009fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009fe0: 2020 2020 2020 206b 6579 735f 6920 3d20         keys_i = 
-00009ff0: 6b65 7973 5b30 3a31 5d20 2b20 5b69 5d20  keys[0:1] + [i] 
-0000a000: 2b20 6b65 7973 5b31 3a3a 5d0a 2020 2020  + keys[1::].    
+00006aa0: 6520 4578 6365 7074 696f 6e28 0a20 2020  e Exception(.   
+00006ab0: 2020 2020 2020 2020 2020 2020 2022 4e6f               "No
+00006ac0: 7420 616c 6c20 6669 6c65 7320 6861 7665  t all files have
+00006ad0: 2075 6e69 7175 6520 6e61 6d65 732e 2044   unique names. D
+00006ae0: 7570 6c69 6361 7465 733a 2022 202b 2073  uplicates: " + s
+00006af0: 7472 2864 7570 2929 0a0a 2020 2020 2020  tr(dup))..      
+00006b00: 2020 616c 6c76 616c 6964 2c20 6d73 6720    allvalid, msg 
+00006b10: 3d20 6d69 7174 742e 616c 6c49 6d61 6765  = miqtt.allImage
+00006b20: 4e61 6d65 7356 616c 6964 2873 656c 662e  NamesValid(self.
+00006b30: 5f69 6d61 6765 7349 6e49 6d61 6765 7344  _imagesInImagesD
+00006b40: 6972 2920 0a20 2020 2020 2020 2069 6620  ir) .        if 
+00006b50: 6e6f 7420 616c 6c76 616c 6964 3a0a 2020  not allvalid:.  
+00006b60: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00006b70: 4578 6365 7074 696f 6e28 6d73 6729 0a0a  Exception(msg)..
+00006b80: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+00006b90: 762e 6c6f 6728 7374 7228 6c65 6e28 7365  v.log(str(len(se
+00006ba0: 6c66 2e5f 696d 6167 6573 496e 496d 6167  lf._imagesInImag
+00006bb0: 6573 4469 7229 2920 2b20 2220 696d 6167  esDir)) + " imag
+00006bc0: 6520 6669 6c65 7320 666f 756e 642e 2229  e files found.")
+00006bd0: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
+00006be0: 6f76 2e6c 6f67 2822 2229 0a20 2020 2020  ov.log("").     
+00006bf0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+00006c00: 2822 466f 6c6c 6f77 696e 6720 696e 666f  ("Following info
+00006c10: 726d 6174 696f 6e20 7761 7320 7061 7273  rmation was pars
+00006c20: 6564 2066 726f 6d20 6469 7265 6374 6f72  ed from director
+00006c30: 792c 2070 6c65 6173 6520 6368 6563 6b20  y, please check 
+00006c40: 666f 7220 636f 7272 6563 746e 6573 733a  for correctness:
+00006c50: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+00006c60: 7072 6f76 2e6c 6f67 2822 5072 6f6a 6563  prov.log("Projec
+00006c70: 743a 5c74 222b 7365 6c66 2e64 6972 2e70  t:\t"+self.dir.p
+00006c80: 726f 6a65 6374 2829 290a 2020 2020 2020  roject()).      
+00006c90: 2020 6966 2073 656c 662e 6469 722e 7769    if self.dir.wi
+00006ca0: 7468 5f67 6561 723a 0a20 2020 2020 2020  th_gear:.       
+00006cb0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+00006cc0: 6f67 2822 4765 6172 3a5c 745c 7422 2b73  og("Gear:\t\t"+s
+00006cd0: 656c 662e 6469 722e 6765 6172 2829 290a  elf.dir.gear()).
+00006ce0: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+00006cf0: 762e 6c6f 6728 2245 7665 6e74 3a5c 745c  v.log("Event:\t\
+00006d00: 7422 2b73 656c 662e 6469 722e 6576 656e  t"+self.dir.even
+00006d10: 7428 2929 0a20 2020 2020 2020 2073 656c  t()).        sel
+00006d20: 662e 7072 6f76 2e6c 6f67 2822 5365 6e73  f.prov.log("Sens
+00006d30: 6f72 3a5c 745c 7422 2b73 656c 662e 6469  or:\t\t"+self.di
+00006d40: 722e 7365 6e73 6f72 2829 290a 2020 2020  r.sensor()).    
+00006d50: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00006d60: 6728 2222 290a 0a20 2020 2020 2020 2023  g("")..        #
+00006d70: 2069 6e74 6572 6d65 6469 6174 6520 6669   intermediate fi
+00006d80: 6c65 730a 2020 2020 2020 2020 7365 6c66  les.        self
+00006d90: 2e5f 5f69 6e69 7449 6e74 6572 6d65 6469  .__initIntermedi
+00006da0: 6174 6546 696c 6573 2829 2020 2020 0a0a  ateFiles()    ..
+00006db0: 2020 2020 2020 2020 2320 7472 7920 6c6f          # try lo
+00006dc0: 6164 2065 7869 7374 696e 6720 6946 444f  ad existing iFDO
+00006dd0: 2066 696c 650a 2020 2020 2020 2020 6966   file.        if
+00006de0: 2873 656c 662e 7265 6164 6946 444f 6669  (self.readiFDOfi
+00006df0: 6c65 2869 4644 4f66 696c 655f 2929 3a0a  le(iFDOfile_)):.
+00006e00: 2020 2020 2020 2020 2020 2020 6c6f 6164              load
+00006e10: 6564 6946 444f 203d 2054 7275 650a 2020  ediFDO = True.  
+00006e20: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00006e30: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00006e40: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+00006e50: 6820 3d20 7365 6c66 2e64 6972 2e74 6f28  h = self.dir.to(
+00006e60: 7365 6c66 2e64 6972 2e64 742e 7072 6f64  self.dir.dt.prod
+00006e70: 7563 7473 290a 2020 2020 2020 2020 2020  ucts).          
+00006e80: 2020 2020 2020 666f 7220 6669 6c65 5f20        for file_ 
+00006e90: 696e 206f 732e 6c69 7374 6469 7228 7061  in os.listdir(pa
+00006ea0: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
+00006eb0: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
+00006ec0: 5f5b 2d31 303a 2d34 5d20 3d3d 2022 5f69  _[-10:-4] == "_i
+00006ed0: 4644 4f2e 2220 616e 6420 7365 6c66 2e72  FDO." and self.r
+00006ee0: 6561 6469 4644 4f66 696c 6528 7061 7468  eadiFDOfile(path
+00006ef0: 2b66 696c 655f 293a 0a20 2020 2020 2020  +file_):.       
+00006f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f10: 206c 6f61 6465 6469 4644 4f20 3d20 5472   loadediFDO = Tr
+00006f20: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00006f30: 2020 2020 2020 2020 2020 2069 4644 4f66             iFDOf
+00006f40: 696c 655f 203d 2070 6174 682b 6669 6c65  ile_ = path+file
+00006f50: 5f0a 2020 2020 2020 2020 2020 2020 2020  _.              
+00006f60: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+00006f70: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00006f80: 7074 2046 696c 654e 6f74 466f 756e 6445  pt FileNotFoundE
+00006f90: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+00006fa0: 2020 2020 2020 7061 7373 2020 2020 2020        pass      
+00006fb0: 2020 0a0a 2020 2020 2020 2020 7365 6c66    ..        self
+00006fc0: 2e74 7279 4175 746f 5365 7448 6561 6465  .tryAutoSetHeade
+00006fd0: 7246 6965 6c64 7328 290a 2020 2020 2020  rFields().      
+00006fe0: 2020 7365 6c66 2e73 6574 4865 6164 6572    self.setHeader
+00006ff0: 496d 6167 654c 6f63 616c 5061 7468 4669  ImageLocalPathFi
+00007000: 656c 6428 290a 2020 2020 2020 2020 6966  eld().        if
+00007010: 206c 6f61 6465 6469 4644 4f3a 0a20 2020   loadediFDO:.   
+00007020: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
+00007030: 7469 4644 4f46 696c 654e 616d 6528 6946  tiFDOFileName(iF
+00007040: 444f 6669 6c65 5f29 0a0a 0a20 2020 2064  DOfile_)...    d
+00007050: 6566 2072 6561 6469 4644 4f66 696c 6528  ef readiFDOfile(
+00007060: 7365 6c66 2c66 696c 653a 7374 7229 3a0a  self,file:str):.
+00007070: 2020 2020 2020 2020 2222 2220 7265 6164          """ read
+00007080: 7320 6946 444f 2066 696c 6520 2222 220a  s iFDO file """.
+00007090: 2020 2020 2020 2020 7472 795f 7961 6d6c          try_yaml
+000070a0: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
+000070b0: 2020 2320 6966 2066 696c 6520 6973 2079    # if file is y
+000070c0: 616d 6c20 6669 6c65 206c 6f61 6420 6974  aml file load it
+000070d0: 2061 7320 7375 6368 0a20 2020 2020 2020   as such.       
+000070e0: 2069 6620 6669 6c65 2e73 706c 6974 2827   if file.split('
+000070f0: 2e27 295b 2d31 5d20 3d3d 2027 7961 6d6c  .')[-1] == 'yaml
+00007100: 273a 0a20 2020 2020 2020 2020 2020 2074  ':.            t
+00007110: 7279 5f79 616d 6c20 3d20 5472 7565 0a20  ry_yaml = True. 
+00007120: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+00007130: 7961 6d6c 203d 2066 696c 650a 0a20 2020  yaml = file..   
+00007140: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+00007150: 6174 682e 6973 6669 6c65 2866 696c 6529  ath.isfile(file)
+00007160: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00007170: 6966 2066 696c 6520 646f 6573 206e 6f74  if file does not
+00007180: 2065 7869 7374 2063 6865 636b 2069 6620   exist check if 
+00007190: 7961 6d6c 2076 6572 7369 6f6e 2065 7873  yaml version exs
+000071a0: 6973 7420 616e 6420 7472 7920 746f 206c  ist and try to l
+000071b0: 6f61 6420 7468 6174 206f 6e65 0a20 2020  oad that one.   
+000071c0: 2020 2020 2020 2020 2066 696c 655f 7961           file_ya
+000071d0: 6d6c 203d 2066 696c 652e 7265 706c 6163  ml = file.replac
+000071e0: 6528 272e 6a73 6f6e 272c 272e 7961 6d6c  e('.json','.yaml
+000071f0: 2729 0a20 2020 2020 2020 2020 2020 2069  ').            i
+00007200: 6620 6f73 2e70 6174 682e 6973 6669 6c65  f os.path.isfile
+00007210: 2866 696c 655f 7961 6d6c 293a 0a20 2020  (file_yaml):.   
+00007220: 2020 2020 2020 2020 2020 2020 2074 7279               try
+00007230: 5f79 616d 6c20 3d20 5472 7565 0a20 2020  _yaml = True.   
+00007240: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00007250: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00007260: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+00007270: 2020 2020 2073 203d 206d 6971 7463 2e50       s = miqtc.P
+00007280: 7269 6e74 4c6f 6164 696e 674d 7367 2822  rintLoadingMsg("
+00007290: 4c6f 6164 696e 6720 6946 444f 2066 696c  Loading iFDO fil
+000072a0: 6522 290a 2020 2020 2020 2020 7472 793a  e").        try:
+000072b0: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
+000072c0: 7279 206c 6f61 6420 6a73 6f6e 2c20 6f74  ry load json, ot
+000072d0: 6865 7277 6973 6520 7472 7920 7961 6d6c  herwise try yaml
+000072e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000072f0: 7472 795f 7961 6d6c 3a0a 2020 2020 2020  try_yaml:.      
+00007300: 2020 2020 2020 2020 2020 6f20 3d20 6f70            o = op
+00007310: 656e 2866 696c 655f 7961 6d6c 2c20 2772  en(file_yaml, 'r
+00007320: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00007330: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
+00007340: 203d 2079 616d 6c2e 6c6f 6164 286f 2c20   = yaml.load(o, 
+00007350: 204c 6f61 6465 723d 7961 6d6c 2e43 4c6f   Loader=yaml.CLo
+00007360: 6164 6572 290a 2020 2020 2020 2020 2020  ader).          
+00007370: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00007380: 2020 2020 2020 2020 6f20 3d20 6f70 656e          o = open
+00007390: 2866 696c 652c 2027 7227 290a 2020 2020  (file, 'r').    
+000073a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000073b0: 2e69 6664 6f5f 746d 7020 3d20 6a73 6f6e  .ifdo_tmp = json
+000073c0: 2e6c 6f61 6428 6f29 0a0a 2020 2020 2020  .load(o)..      
+000073d0: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+000073e0: 7061 7273 6564 203d 2063 6f70 792e 6465  parsed = copy.de
+000073f0: 6570 636f 7079 2873 656c 662e 6966 646f  epcopy(self.ifdo
+00007400: 5f74 6d70 290a 2020 2020 2020 2020 2020  _tmp).          
+00007410: 2020 6f2e 636c 6f73 6528 290a 2020 2020    o.close().    
+00007420: 2020 2020 2020 2020 732e 7374 6f70 2829          s.stop()
+00007430: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007440: 662e 7072 6f76 2e61 6464 5072 6576 696f  f.prov.addPrevio
+00007450: 7573 5072 6f76 656e 616e 6365 2873 656c  usProvenance(sel
+00007460: 662e 7072 6f76 2e67 6574 4c61 7374 5072  f.prov.getLastPr
+00007470: 6f76 656e 616e 6365 4669 6c65 2873 656c  ovenanceFile(sel
+00007480: 662e 6469 722e 746f 2873 656c 662e 6469  f.dir.to(self.di
+00007490: 722e 6474 2e70 726f 746f 636f 6c29 2c73  r.dt.protocol),s
+000074a0: 656c 662e 7072 6f76 2e65 7865 6375 7461  elf.prov.executa
+000074b0: 626c 6529 290a 2020 2020 2020 2020 6578  ble)).        ex
+000074c0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+000074d0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+000074e0: 2073 656c 662e 7072 6f76 2e6c 6f67 2873   self.prov.log(s
+000074f0: 7472 2865 2e61 7267 7329 290a 2020 2020  tr(e.args)).    
+00007500: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00007510: 616c 7365 0a20 2020 2020 2020 2073 2e73  alse.        s.s
+00007520: 746f 7028 290a 0a20 2020 2020 2020 2023  top()..        #
+00007530: 2074 7279 2074 6f20 7061 7273 6520 652e   try to parse e.
+00007540: 672e 2073 7472 696e 6773 2074 6861 7420  g. strings that 
+00007550: 7265 7072 6573 656e 7420 6469 6374 730a  represent dicts.
+00007560: 2020 2020 2020 2020 6d69 7174 632e 7265          miqtc.re
+00007570: 6375 7273 6976 6545 7661 6c28 7365 6c66  cursiveEval(self
+00007580: 2e69 6664 6f5f 746d 7029 0a0a 2020 2020  .ifdo_tmp)..    
+00007590: 2020 2020 6966 2073 656c 662e 696d 6167      if self.imag
+000075a0: 6553 6574 4865 6164 6572 4b65 7920 6e6f  eSetHeaderKey no
+000075b0: 7420 696e 2073 656c 662e 6966 646f 5f74  t in self.ifdo_t
+000075c0: 6d70 3a0a 2020 2020 2020 2020 2020 2020  mp:.            
+000075d0: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+000075e0: 2245 7272 6f72 206c 6f61 6469 6e67 2069  "Error loading i
+000075f0: 4644 4f20 6669 6c65 222c 6669 6c65 2c22  FDO file",file,"
+00007600: 646f 6573 206e 6f74 2063 6f6e 7461 696e  does not contain
+00007610: 222c 7365 6c66 2e69 6d61 6765 5365 7448  ",self.imageSetH
+00007620: 6561 6465 724b 6579 290a 2020 2020 2020  eaderKey).      
+00007630: 2020 6966 2073 656c 662e 696d 6167 6553    if self.imageS
+00007640: 6574 4974 656d 734b 6579 206e 6f74 2069  etItemsKey not i
+00007650: 6e20 7365 6c66 2e69 6664 6f5f 746d 703a  n self.ifdo_tmp:
+00007660: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00007670: 7365 2045 7863 6570 7469 6f6e 2822 4572  se Exception("Er
+00007680: 726f 7220 6c6f 6164 696e 6720 6946 444f  ror loading iFDO
+00007690: 2066 696c 6522 2c66 696c 652c 2264 6f65   file",file,"doe
+000076a0: 7320 6e6f 7420 636f 6e74 6169 6e22 2c73  s not contain",s
+000076b0: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
+000076c0: 734b 6579 290a 0a20 2020 2020 2020 2069  sKey)..        i
+000076d0: 6620 2073 656c 662e 6966 646f 5f74 6d70  f  self.ifdo_tmp
+000076e0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+000076f0: 6164 6572 4b65 795d 203d 3d20 4e6f 6e65  aderKey] == None
+00007700: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00007710: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00007720: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+00007730: 6579 5d20 3d20 7b7d 0a20 2020 2020 2020  ey] = {}.       
+00007740: 2069 6620 7365 6c66 2e69 6664 6f5f 746d   if self.ifdo_tm
+00007750: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
+00007760: 7465 6d73 4b65 795d 203d 3d20 4e6f 6e65  temsKey] == None
+00007770: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00007780: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00007790: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+000077a0: 795d 203d 207b 7d0a 0a20 2020 2020 2020  y] = {}..       
+000077b0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+000077c0: 6946 444f 2066 696c 6520 6c6f 6164 6564  iFDO file loaded
+000077d0: 3a5c 7422 2b6f 732e 7061 7468 2e62 6173  :\t"+os.path.bas
+000077e0: 656e 616d 6528 6669 6c65 2929 0a0a 2020  ename(file))..  
+000077f0: 2020 2020 2020 2320 6368 6563 6b20 6946        # check iF
+00007800: 444f 2076 6572 7369 6f6e 0a20 2020 2020  DO version.     
+00007810: 2020 2072 6561 6456 6572 7369 6f6e 203d     readVersion =
+00007820: 2022 762e 312e 302e 3022 2023 2064 6964   "v.1.0.0" # did
+00007830: 206e 6f74 2068 6176 6520 7468 6520 2769   not have the 'i
+00007840: 6d61 6765 2d73 6574 2d69 6664 6f2d 7665  mage-set-ifdo-ve
+00007850: 7273 696f 6e27 2066 6965 6c64 2079 6574  rsion' field yet
+00007860: 0a20 2020 2020 2020 2074 7279 3a20 0a20  .        try: . 
+00007870: 2020 2020 2020 2020 2020 2072 6561 6456             readV
+00007880: 6572 7369 6f6e 203d 2073 656c 662e 6669  ersion = self.fi
+00007890: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
+000078a0: 652d 7365 742d 6966 646f 2d76 6572 7369  e-set-ifdo-versi
+000078b0: 6f6e 2729 0a20 2020 2020 2020 2065 7863  on').        exc
+000078c0: 6570 7420 4b65 7945 7272 6f72 3a0a 2020  ept KeyError:.  
+000078d0: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+000078e0: 2020 2020 2020 2069 6e74 5265 6164 5665         intReadVe
+000078f0: 7273 696f 6e20 3d20 5665 7273 696f 6e28  rsion = Version(
+00007900: 7265 6164 5665 7273 696f 6e29 0a20 2020  readVersion).   
+00007910: 2020 2020 2069 6e74 5468 6973 5665 7273       intThisVers
+00007920: 696f 6e20 3d20 5665 7273 696f 6e28 6d69  ion = Version(mi
+00007930: 7174 762e 6946 444f 5f76 6572 7369 6f6e  qtv.iFDO_version
+00007940: 290a 2020 2020 2020 2020 6966 2069 6e74  ).        if int
+00007950: 5265 6164 5665 7273 696f 6e20 3c20 696e  ReadVersion < in
+00007960: 7454 6869 7356 6572 7369 6f6e 3a0a 2020  tThisVersion:.  
+00007970: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00007980: 726f 762e 6c6f 6728 224c 6f61 6465 6420  rov.log("Loaded 
+00007990: 6946 444f 2068 6173 2076 6572 7369 6f6e  iFDO has version
+000079a0: 2022 202b 2072 6561 6456 6572 7369 6f6e   " + readVersion
+000079b0: 202b 2022 2061 6e64 2077 696c 6c20 6265   + " and will be
+000079c0: 2075 7064 6174 6564 2074 6f20 7665 7273   updated to vers
+000079d0: 696f 6e20 2220 2b20 6d69 7174 762e 6946  ion " + miqtv.iF
+000079e0: 444f 5f76 6572 7369 6f6e 290a 2020 2020  DO_version).    
+000079f0: 2020 2020 6966 2069 6e74 5265 6164 5665      if intReadVe
+00007a00: 7273 696f 6e20 3e20 696e 7454 6869 7356  rsion > intThisV
+00007a10: 6572 7369 6f6e 3a0a 2020 2020 2020 2020  ersion:.        
+00007a20: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00007a30: 6728 2243 6175 7469 6f6e 2120 4c6f 6164  g("Caution! Load
+00007a40: 6564 2069 4644 4f20 6861 7320 7665 7273  ed iFDO has vers
+00007a50: 696f 6e20 2220 2b20 7265 6164 5665 7273  ion " + readVers
+00007a60: 696f 6e20 2b20 2220 6973 2061 6865 6164  ion + " is ahead
+00007a70: 206f 6620 7665 7273 696f 6e20 7573 6564   of version used
+00007a80: 2068 6572 653a 2022 202b 206d 6971 7476   here: " + miqtv
+00007a90: 2e69 4644 4f5f 7665 7273 696f 6e29 0a0a  .iFDO_version)..
+00007aa0: 2020 2020 2020 2020 2320 666f 7220 736f          # for so
+00007ab0: 6f6f 6f6f 6d65 2072 6561 736f 6e20 7468  oooome reason th
+00007ac0: 6973 2066 6978 6573 2061 2068 6963 6b75  is fixes a hicku
+00007ad0: 7020 6f66 2074 6865 2070 726f 6720 696e  p of the prog in
+00007ae0: 2063 7265 6174 6569 4644 4f28 290a 2020   createiFDO().  
+00007af0: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
+00007b00: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
+00007b10: 6772 6573 734d 7367 2822 666f 6f22 2c20  gressMsg("foo", 
+00007b20: 312c 6d6f 6475 6c6f 3d31 290a 2020 2020  1,modulo=1).    
+00007b30: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
+00007b40: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00007b50: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+00007b60: 6f6e 7665 7274 546f 4465 6661 756c 7444  onvertToDefaultD
+00007b70: 6174 6554 696d 6546 6f72 6d61 7428 7365  ateTimeFormat(se
+00007b80: 6c66 2e69 6664 6f5f 746d 7029 0a20 2020  lf.ifdo_tmp).   
+00007b90: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00007ba0: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
+00007bb0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00007bc0: 6f76 2e6c 6f67 2822 4368 6563 6b69 6e67  ov.log("Checking
+00007bd0: 2064 6174 6574 696d 6520 666f 726d 6174   datetime format
+00007be0: 3a20 2220 2b20 7374 7228 6578 2929 0a0a  : " + str(ex))..
+00007bf0: 2020 2020 2020 2020 2320 666f 7220 736f          # for so
+00007c00: 6f6f 6f6f 6d65 2072 6561 736f 6e20 7468  oooome reason th
+00007c10: 6973 2066 6978 6573 2061 2068 6963 6b75  is fixes a hicku
+00007c20: 7020 6f66 2074 6865 2070 726f 6720 696e  p of the prog in
+00007c30: 2063 7265 6174 6569 4644 4f28 290a 2020   createiFDO().  
+00007c40: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
+00007c50: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
+00007c60: 6772 6573 734d 7367 2822 666f 6f22 2c20  gressMsg("foo", 
+00007c70: 312c 6d6f 6475 6c6f 3d31 290a 2020 2020  1,modulo=1).    
+00007c80: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
+00007c90: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+00007ca0: 7472 795f 7570 6772 6164 655f 746f 5f69  try_upgrade_to_i
+00007cb0: 6664 6f5f 7665 7273 696f 6e5f 3278 2829  fdo_version_2x()
+00007cc0: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
+00007cd0: 6b20 7265 6164 2069 4644 4f20 6669 6c65  k read iFDO file
+00007ce0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00007cf0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00007d00: 2073 656c 662e 6967 6e6f 7265 5f69 6d61   self.ignore_ima
+00007d10: 6765 5f66 696c 6573 3a0a 2020 2020 2020  ge_files:.      
+00007d20: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+00007d30: 7265 6174 6569 4644 4f28 7365 6c66 2e69  reateiFDO(self.i
+00007d40: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+00007d50: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
+00007d60: 206d 6971 7469 2e63 7265 6174 6549 6d61   miqti.createIma
+00007d70: 6765 4974 656d 734c 6973 7446 726f 6d49  geItemsListFromI
+00007d80: 6d61 6765 4974 656d 7344 6963 7428 7365  mageItemsDict(se
+00007d90: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00007da0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+00007db0: 795d 2929 0a20 2020 2020 2020 2020 2020  y])).           
+00007dc0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00007dd0: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
+00007de0: 7465 6946 444f 2873 656c 662e 6966 646f  teiFDO(self.ifdo
+00007df0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+00007e00: 6574 4865 6164 6572 4b65 795d 2c20 6d69  etHeaderKey], mi
+00007e10: 7174 692e 6372 6561 7465 496d 6167 6549  qti.createImageI
+00007e20: 7465 6d73 4c69 7374 4672 6f6d 496d 6167  temsListFromImag
+00007e30: 6549 7465 6d73 4469 6374 2873 656c 662e  eItemsDict(self.
+00007e40: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+00007e50: 6167 6553 6574 4974 656d 734b 6579 5d29  ageSetItemsKey])
+00007e60: 2c68 6561 6465 724f 6e6c 793d 7365 6c66  ,headerOnly=self
+00007e70: 2e69 676e 6f72 655f 696d 6167 655f 6669  .ignore_image_fi
+00007e80: 6c65 7329 0a20 2020 2020 2020 2065 7863  les).        exc
+00007e90: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00007ea0: 2065 783a 0a20 2020 2020 2020 2020 2020   ex:.           
+00007eb0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+00007ec0: 4c6f 6164 6564 2069 4644 4f20 6669 6c65  Loaded iFDO file
+00007ed0: 206e 6f74 2076 616c 6964 2079 6574 3a20   not valid yet: 
+00007ee0: 2220 2b20 7374 7228 6578 2929 0a0a 2020  " + str(ex))..  
+00007ef0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00007f00: 650a 0a0a 2020 2020 6465 6620 7772 6974  e...    def writ
+00007f10: 655f 6966 646f 5f66 696c 6528 7365 6c66  e_ifdo_file(self
+00007f20: 2c61 6c6c 6f77 5f6d 6973 7369 6e67 5f72  ,allow_missing_r
+00007f30: 6571 7569 7265 643d 4661 6c73 6529 3a0a  equired=False):.
+00007f40: 2020 2020 2020 2020 2222 2220 5772 6974          """ Writ
+00007f50: 6573 2061 6e20 6946 444f 2066 696c 6520  es an iFDO file 
+00007f60: 746f 2064 6973 6b2e 204f 7665 7277 7269  to disk. Overwri
+00007f70: 7465 7320 706f 7465 6e74 6961 6c6c 7920  tes potentially 
+00007f80: 6578 6973 7469 6e67 2066 696c 652e 2222  existing file.""
+00007f90: 220a 0a20 2020 2020 2020 2073 203d 206d  "..        s = m
+00007fa0: 6971 7463 2e50 7269 6e74 4c6f 6164 696e  iqtc.PrintLoadin
+00007fb0: 674d 7367 2822 5772 6974 696e 6720 6946  gMsg("Writing iF
+00007fc0: 444f 2066 696c 6522 290a 0a20 2020 2020  DO file")..     
+00007fd0: 2020 2023 2063 6865 636b 2066 6965 6c64     # check field
+00007fe0: 7320 6167 6169 6e20 6966 2063 6861 6e67  s again if chang
+00007ff0: 6564 2073 696e 6365 206c 6173 7420 6368  ed since last ch
+00008000: 6563 6b20 2863 7265 6174 6569 4644 4f29  eck (createiFDO)
+00008010: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00008020: 2e69 6664 6f5f 746d 7020 213d 2073 656c  .ifdo_tmp != sel
+00008030: 662e 6966 646f 5f63 6865 636b 6564 3a0a  f.ifdo_checked:.
+00008040: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008050: 2e63 7265 6174 6569 4644 4f28 7365 6c66  .createiFDO(self
+00008060: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+00008070: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+00008080: 5d2c 206d 6971 7469 2e63 7265 6174 6549  ], miqti.createI
+00008090: 6d61 6765 4974 656d 734c 6973 7446 726f  mageItemsListFro
+000080a0: 6d49 6d61 6765 4974 656d 7344 6963 7428  mImageItemsDict(
+000080b0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+000080c0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+000080d0: 4b65 795d 292c 0a20 2020 2020 2020 2020  Key]),.         
+000080e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000080f0: 2020 2061 6c6c 6f77 5f6d 6973 7369 6e67     allow_missing
+00008100: 5f72 6571 7569 7265 643d 616c 6c6f 775f  _required=allow_
+00008110: 6d69 7373 696e 675f 7265 7175 6972 6564  missing_required
+00008120: 290a 2020 2020 2020 2020 0a20 2020 2020  ).        .     
+00008130: 2020 2023 2061 6464 2022 2473 6368 656d     # add "$schem
+00008140: 6122 0a20 2020 2020 2020 2073 656c 662e  a".        self.
+00008150: 6966 646f 5f63 6865 636b 6564 5b22 2473  ifdo_checked["$s
+00008160: 6368 656d 6122 5d20 3d20 6d69 7174 762e  chema"] = miqtv.
+00008170: 6966 646f 5f73 6368 656d 615b 2724 6964  ifdo_schema['$id
+00008180: 275d 0a20 2020 2020 2020 200a 2020 2020  '].        .    
+00008190: 2020 2020 6946 444f 5f70 6174 6820 3d20      iFDO_path = 
+000081a0: 7365 6c66 2e67 6574 6946 444f 4669 6c65  self.getiFDOFile
+000081b0: 4e61 6d65 286f 7665 7277 7269 7465 3d54  Name(overwrite=T
+000081c0: 7275 6529 0a0a 2020 2020 2020 2020 2320  rue)..        # 
+000081d0: 7075 7473 2065 7665 7279 7468 696e 6720  puts everything 
+000081e0: 696e 206f 6e65 206c 696e 650a 2020 2020  in one line.    
+000081f0: 2020 2020 2377 6974 6820 6f70 656e 2869      #with open(i
+00008200: 4644 4f5f 7061 7468 2e72 6570 6c61 6365  FDO_path.replace
+00008210: 2822 7961 6d6c 222c 226a 736f 6e22 292c  ("yaml","json"),
+00008220: 2027 7727 2920 6173 2066 703a 0a20 2020   'w') as fp:.   
+00008230: 2020 2020 2023 2020 2020 6a73 6f6e 2e64       #    json.d
+00008240: 756d 7028 7365 6c66 2e69 6664 6f5f 6368  ump(self.ifdo_ch
+00008250: 6563 6b65 642c 2066 7029 0a0a 2020 2020  ecked, fp)..    
+00008260: 2020 2020 2320 636f 6e76 6572 7420 6469      # convert di
+00008270: 6374 696f 6e61 7279 2074 6f20 4a53 4f4e  ctionary to JSON
+00008280: 2073 7472 696e 670a 2020 2020 2020 2020   string.        
+00008290: 6a73 6f6e 5f64 6174 6120 3d20 6a73 6f6e  json_data = json
+000082a0: 2e64 756d 7073 2873 656c 662e 6966 646f  .dumps(self.ifdo
+000082b0: 5f63 6865 636b 6564 2c20 696e 6465 6e74  _checked, indent
+000082c0: 203d 2034 2c20 736f 7274 5f6b 6579 733d   = 4, sort_keys=
+000082d0: 5472 7565 290a 0a20 2020 2020 2020 2023  True)..        #
+000082e0: 2077 7269 7465 2074 6865 204a 534f 4e20   write the JSON 
+000082f0: 7374 7269 6e67 2074 6f20 6120 6669 6c65  string to a file
+00008300: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
+00008310: 656e 2869 4644 4f5f 7061 7468 2c20 2777  en(iFDO_path, 'w
+00008320: 2729 2061 7320 663a 0a20 2020 2020 2020  ') as f:.       
+00008330: 2020 2020 2066 2e77 7269 7465 286a 736f       f.write(jso
+00008340: 6e5f 6461 7461 290a 2020 2020 2020 2020  n_data).        
+00008350: 0a20 2020 2020 2020 2023 206c 6f67 2063  .        # log c
+00008360: 6861 6e67 6573 0a20 2020 2020 2020 2069  hanges.        i
+00008370: 6620 6e6f 7420 7365 6c66 2e69 6664 6f5f  f not self.ifdo_
+00008380: 7061 7273 6564 2069 7320 4e6f 6e65 3a0a  parsed is None:.
+00008390: 2020 2020 2020 2020 2020 2020 6966 646f              ifdo
+000083a0: 5f75 7064 6174 6520 3d20 4465 6570 4469  _update = DeepDi
+000083b0: 6666 2873 656c 662e 6966 646f 5f70 6172  ff(self.ifdo_par
+000083c0: 7365 642c 7365 6c66 2e69 6664 6f5f 6368  sed,self.ifdo_ch
+000083d0: 6563 6b65 6429 0a20 2020 2020 2020 2020  ecked).         
+000083e0: 2020 2023 7070 7269 6e74 2869 6664 6f5f     #pprint(ifdo_
+000083f0: 7570 6461 7465 290a 2020 2020 2020 2020  update).        
+00008400: 2020 2020 6966 2069 6664 6f5f 7570 6461      if ifdo_upda
+00008410: 7465 2021 3d20 7b7d 3a0a 2020 2020 2020  te != {}:.      
+00008420: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00008430: 726f 762e 6c6f 6728 2269 4644 4f20 7570  rov.log("iFDO up
+00008440: 6461 7465 6422 290a 2020 2020 2020 2020  dated").        
+00008450: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+00008460: 762e 6c6f 6728 7374 7228 6966 646f 5f75  v.log(str(ifdo_u
+00008470: 7064 6174 6529 2c64 6f6e 7453 686f 773d  pdate),dontShow=
+00008480: 5472 7565 290a 2020 2020 2020 2020 7365  True).        se
+00008490: 6c66 2e70 726f 762e 6c6f 6728 2257 726f  lf.prov.log("Wro
+000084a0: 7465 2069 4644 4f20 746f 2066 696c 6520  te iFDO to file 
+000084b0: 2220 2b20 6946 444f 5f70 6174 6829 0a20  " + iFDO_path). 
+000084c0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+000084d0: 2e77 7269 7465 2873 656c 662e 6469 722e  .write(self.dir.
+000084e0: 746f 2873 656c 662e 6469 722e 6474 2e70  to(self.dir.dt.p
+000084f0: 726f 746f 636f 6c29 290a 2020 2020 2020  rotocol)).      
+00008500: 2020 732e 7374 6f70 2829 0a0a 2020 2020    s.stop()..    
+00008510: 6465 6620 7772 6974 6569 4644 4f66 696c  def writeiFDOfil
+00008520: 6528 7365 6c66 2c61 6c6c 6f77 5f6d 6973  e(self,allow_mis
+00008530: 7369 6e67 5f72 6571 7569 7265 643d 4661  sing_required=Fa
+00008540: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
+00008550: 2220 4465 7072 6563 6174 6564 202d 2075  " Deprecated - u
+00008560: 7365 2077 7269 7465 5f69 6664 6f5f 6669  se write_ifdo_fi
+00008570: 6c65 2022 2222 0a20 2020 2020 2020 2073  le """.        s
+00008580: 656c 662e 7772 6974 655f 6966 646f 5f66  elf.write_ifdo_f
+00008590: 696c 6528 616c 6c6f 775f 6d69 7373 696e  ile(allow_missin
+000085a0: 675f 7265 7175 6972 6564 290a 0a0a 2020  g_required)...  
+000085b0: 2020 6465 6620 7365 7469 4644 4f46 696c    def setiFDOFil
+000085c0: 654e 616d 6528 7365 6c66 2c69 4644 4f66  eName(self,iFDOf
+000085d0: 696c 653a 7374 7229 3a0a 2020 2020 2020  ile:str):.      
+000085e0: 2020 2222 2220 5365 7420 7468 6520 6375    """ Set the cu
+000085f0: 7272 656e 7420 6946 444f 2066 696c 6520  rrent iFDO file 
+00008600: 6e61 6d65 2077 6974 6820 7061 7468 2e20  name with path. 
+00008610: 5365 7420 746f 2022 2220 696e 206f 7264  Set to "" in ord
+00008620: 6572 2074 6f20 6765 7420 6465 6661 756c  er to get defaul
+00008630: 7420 6e61 6d65 2061 6e64 206c 6f63 6174  t name and locat
+00008640: 696f 6e2e 2022 2222 0a20 2020 2020 2020  ion. """.       
+00008650: 2073 656c 662e 6946 444f 6669 6c65 5f20   self.iFDOfile_ 
+00008660: 3d20 6946 444f 6669 6c65 0a20 2020 2020  = iFDOfile.     
+00008670: 2020 2073 656c 662e 6946 444f 6669 6c65     self.iFDOfile
+00008680: 5f20 3d20 7365 6c66 2e67 6574 6946 444f  _ = self.getiFDO
+00008690: 4669 6c65 4e61 6d65 2829 2023 2063 6f6e  FileName() # con
+000086a0: 7374 7275 6374 2064 6566 6175 6c74 206e  struct default n
+000086b0: 616d 6520 6966 2065 6d70 7479 0a20 2020  ame if empty.   
+000086c0: 2020 2020 2069 6620 6d69 7174 632e 6173       if miqtc.as
+000086d0: 7365 7274 536c 6173 6828 6f73 2e70 6174  sertSlash(os.pat
+000086e0: 682e 6469 726e 616d 6528 7365 6c66 2e69  h.dirname(self.i
+000086f0: 4644 4f66 696c 655f 2929 2021 3d20 6d69  FDOfile_)) != mi
+00008700: 7174 632e 6173 7365 7274 536c 6173 6828  qtc.assertSlash(
+00008710: 7365 6c66 2e64 6972 2e74 6f28 7365 6c66  self.dir.to(self
+00008720: 2e64 6972 2e64 742e 7072 6f64 7563 7473  .dir.dt.products
+00008730: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00008740: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
+00008750: 6175 7469 6f6e 2120 6946 444f 2066 696c  aution! iFDO fil
+00008760: 6520 7061 7468 2069 7320 6e6f 7420 696e  e path is not in
+00008770: 2027 7072 6f64 7563 7473 2720 7375 6220   'products' sub 
+00008780: 666f 6c64 6572 2061 7320 7265 636f 6d6d  folder as recomm
+00008790: 656e 6465 642e 2043 6f6e 7369 6465 7220  ended. Consider 
+000087a0: 7265 7365 7474 696e 6720 7769 7468 2073  resetting with s
+000087b0: 6574 6946 444f 4669 6c65 4e61 6d65 2829  etiFDOFileName()
+000087c0: 2e20 2220 2b20 6946 444f 6669 6c65 290a  . " + iFDOfile).
+000087d0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+000087e0: 2020 2020 2020 2020 2065 7665 6e74 203d           event =
+000087f0: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
+00008800: 6c64 2827 696d 6167 652d 6576 656e 7427  ld('image-event'
+00008810: 295b 276e 616d 6527 5d0a 2020 2020 2020  )['name'].      
+00008820: 2020 2020 2020 7365 6e73 6f72 203d 2073        sensor = s
+00008830: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
+00008840: 2827 696d 6167 652d 7365 6e73 6f72 2729  ('image-sensor')
+00008850: 5b27 6e61 6d65 275d 0a20 2020 2020 2020  ['name'].       
+00008860: 2065 7863 6570 7420 6d69 7174 632e 4966   except miqtc.If
+00008870: 646f 4578 6365 7074 696f 6e3a 0a20 2020  doException:.   
+00008880: 2020 2020 2020 2020 2065 7665 6e74 203d           event =
+00008890: 2073 656c 662e 6469 722e 6576 656e 7428   self.dir.event(
+000088a0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000088b0: 6e73 6f72 203d 2073 656c 662e 6469 722e  nsor = self.dir.
+000088c0: 7365 6e73 6f72 2829 0a0a 2020 2020 2020  sensor()..      
+000088d0: 2020 6946 444f 6669 6c65 4e61 6d65 203d    iFDOfileName =
+000088e0: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
+000088f0: 6528 7365 6c66 2e69 4644 4f66 696c 655f  e(self.iFDOfile_
+00008900: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+00008910: 2065 7665 6e74 2069 6e20 6946 444f 6669   event in iFDOfi
+00008920: 6c65 4e61 6d65 206f 7220 6e6f 7420 6946  leName or not iF
+00008930: 444f 2e67 6574 5368 6f72 7445 7175 6970  DO.getShortEquip
+00008940: 6d65 6e74 4944 2873 656e 736f 7229 2069  mentID(sensor) i
+00008950: 6e20 6946 444f 6669 6c65 4e61 6d65 3a0a  n iFDOfileName:.
+00008960: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008970: 2e70 726f 762e 6c6f 6728 2243 6175 7469  .prov.log("Cauti
+00008980: 6f6e 2120 6946 444f 2066 696c 6520 6e61  on! iFDO file na
+00008990: 6d65 2064 6f65 7320 6e6f 7420 636f 6e74  me does not cont
+000089a0: 6169 6e20 7072 6f6a 6563 742c 2065 7665  ain project, eve
+000089b0: 6e74 2061 6e64 2073 656e 736f 7220 6e61  nt and sensor na
+000089c0: 6d65 2061 7320 7265 636f 6d6d 656e 6465  me as recommende
+000089d0: 642e 2043 6f6e 7369 6465 7220 7265 7365  d. Consider rese
+000089e0: 7474 696e 6720 7769 7468 2073 6574 6946  tting with setiF
+000089f0: 444f 4669 6c65 4e61 6d65 2829 2e20 2220  DOFileName(). " 
+00008a00: 2b20 6946 444f 6669 6c65 290a 0a0a 2020  + iFDOfile)...  
+00008a10: 2020 6465 6620 6765 7469 4644 4f46 696c    def getiFDOFil
+00008a20: 654e 616d 6528 7365 6c66 2c6f 7665 7277  eName(self,overw
+00008a30: 7269 7465 3d46 616c 7365 293a 0a20 2020  rite=False):.   
+00008a40: 2020 2020 2022 2222 2052 6574 7572 6e73       """ Returns
+00008a50: 2074 6865 2063 7572 7265 6e74 2069 4644   the current iFD
+00008a60: 4f20 6669 6c65 2773 206e 616d 6520 7769  O file's name wi
+00008a70: 7468 2070 6174 682e 2049 6620 6e6f 7420  th path. If not 
+00008a80: 7365 7420 7965 7420 6f72 206f 7665 7277  set yet or overw
+00008a90: 7269 7465 3d3d 5472 7565 2069 7420 7265  rite==True it re
+00008aa0: 7475 726e 7320 7468 6520 6f6e 6520 6d61  turns the one ma
+00008ab0: 7463 6869 6e67 2069 6d61 6765 2d73 6574  tching image-set
+00008ac0: 2d6e 616d 652e 2022 2222 0a20 2020 2020  -name. """.     
+00008ad0: 2020 2069 6620 7365 6c66 2e69 4644 4f66     if self.iFDOf
+00008ae0: 696c 655f 203d 3d20 2222 206f 7220 6f76  ile_ == "" or ov
+00008af0: 6572 7772 6974 653a 0a20 2020 2020 2020  erwrite:.       
+00008b00: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
+00008b10: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
+00008b20: 6c64 2827 696d 6167 652d 7365 742d 6e61  ld('image-set-na
+00008b30: 6d65 2729 202b 2027 5f69 4644 4f2e 6a73  me') + '_iFDO.js
+00008b40: 6f6e 270a 2020 2020 2020 2020 2020 2020  on'.            
+00008b50: 6966 2073 656c 662e 6946 444f 6669 6c65  if self.iFDOfile
+00008b60: 5f20 213d 2022 223a 0a20 2020 2020 2020  _ != "":.       
+00008b70: 2020 2020 2020 2020 2023 2072 656e 616d           # renam
+00008b80: 6520 6669 6c65 2062 7574 206b 6565 7020  e file but keep 
+00008b90: 6c6f 6361 7469 6f6e 0a20 2020 2020 2020  location.       
+00008ba0: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
+00008bb0: 5f6e 616d 6520 213d 206f 732e 7061 7468  _name != os.path
+00008bc0: 2e62 6173 656e 616d 6528 7365 6c66 2e69  .basename(self.i
+00008bd0: 4644 4f66 696c 655f 2920 616e 6420 6f73  FDOfile_) and os
+00008be0: 2e70 6174 682e 6578 6973 7473 2873 656c  .path.exists(sel
+00008bf0: 662e 6946 444f 6669 6c65 5f29 3a0a 2020  f.iFDOfile_):.  
+00008c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008c10: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+00008c20: 2243 6175 7469 6f6e 2120 6966 646f 2066  "Caution! ifdo f
+00008c30: 696c 6520 7265 6e61 6d65 6420 746f 2022  ile renamed to "
+00008c40: 202b 2066 696c 655f 6e61 6d65 290a 2020   + file_name).  
+00008c50: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00008c60: 6c66 2e69 4644 4f66 696c 655f 203d 206f  lf.iFDOfile_ = o
+00008c70: 732e 7061 7468 2e6a 6f69 6e28 6f73 2e70  s.path.join(os.p
+00008c80: 6174 682e 6469 726e 616d 6528 7365 6c66  ath.dirname(self
+00008c90: 2e69 4644 4f66 696c 655f 292c 6669 6c65  .iFDOfile_),file
+00008ca0: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
+00008cb0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00008cc0: 2020 2020 2020 2020 2073 656c 662e 6946           self.iF
+00008cd0: 444f 6669 6c65 5f20 3d20 6f73 2e70 6174  DOfile_ = os.pat
+00008ce0: 682e 6a6f 696e 2873 656c 662e 6469 722e  h.join(self.dir.
+00008cf0: 746f 2873 656c 662e 6469 722e 6474 2e70  to(self.dir.dt.p
+00008d00: 726f 6475 6374 7329 2c20 6669 6c65 5f6e  roducts), file_n
+00008d10: 616d 6529 0a20 2020 2020 2020 2072 6574  ame).        ret
+00008d20: 7572 6e20 7365 6c66 2e69 4644 4f66 696c  urn self.iFDOfil
+00008d30: 655f 0a0a 0a20 2020 2064 6566 2073 6574  e_...    def set
+00008d40: 5f69 6d61 6765 5f73 6574 5f6e 616d 655f  _image_set_name_
+00008d50: 6669 656c 645f 6672 6f6d 5f70 726f 6a65  field_from_proje
+00008d60: 6374 5f65 7665 6e74 5f73 656e 736f 7228  ct_event_sensor(
+00008d70: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00008d80: 2222 2053 6574 7320 6669 656c 6420 696d  "" Sets field im
+00008d90: 6167 652d 7365 742d 6e61 6d65 2066 726f  age-set-name fro
+00008da0: 6d20 6375 7272 656e 7420 746d 7020 6669  m current tmp fi
+00008db0: 656c 6473 2066 6f72 2070 726f 6a65 6374  elds for project
+00008dc0: 2c20 6576 656e 7420 616e 6420 7365 6e73  , event and sens
+00008dd0: 6f72 2e20 0a20 2020 2020 2020 2052 6574  or. .        Ret
+00008de0: 7572 6e73 2069 6d61 6765 2d73 6574 2d6e  urns image-set-n
+00008df0: 616d 6520 7661 6c75 652e 2022 2222 0a20  ame value. """. 
+00008e00: 2020 2020 2020 206e 6577 5f69 6d61 6765         new_image
+00008e10: 5f73 6574 5f6e 616d 6520 3d20 7365 6c66  _set_name = self
+00008e20: 2e63 6f6e 7374 7275 6374 496d 6167 6553  .constructImageS
+00008e30: 6574 4e61 6d65 2873 656c 662e 6966 646f  etName(self.ifdo
+00008e40: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+00008e50: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
+00008e60: 6167 652d 7072 6f6a 6563 7427 5d5b 276e  age-project']['n
+00008e70: 616d 6527 5d2c 0a20 2020 2020 2020 2020  ame'],.         
+00008e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ea0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008eb0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+00008ec0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+00008ed0: 5b27 696d 6167 652d 6576 656e 7427 5d5b  ['image-event'][
+00008ee0: 276e 616d 6527 5d2c 0a20 2020 2020 2020  'name'],.       
+00008ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f10: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00008f20: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+00008f30: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+00008f40: 795d 5b27 696d 6167 652d 7365 6e73 6f72  y]['image-sensor
+00008f50: 275d 5b27 6e61 6d65 275d 290a 2020 2020  ']['name']).    
+00008f60: 2020 2020 7365 6c66 2e69 6664 6f5f 746d      self.ifdo_tm
+00008f70: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
+00008f80: 6561 6465 724b 6579 5d5b 2769 6d61 6765  eaderKey]['image
+00008f90: 2d73 6574 2d6e 616d 6527 5d20 3d20 6e65  -set-name'] = ne
+00008fa0: 775f 696d 6167 655f 7365 745f 6e61 6d65  w_image_set_name
+00008fb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00008fc0: 6e65 775f 696d 6167 655f 7365 745f 6e61  new_image_set_na
+00008fd0: 6d65 0a20 2020 2020 2020 200a 0a20 2020  me.        ..   
+00008fe0: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
+00008ff0: 2020 2064 6566 2063 6f6e 7374 7275 6374     def construct
+00009000: 496d 6167 6553 6574 4e61 6d65 2870 726f  ImageSetName(pro
+00009010: 6a65 6374 3a73 7472 2c65 7665 6e74 3a73  ject:str,event:s
+00009020: 7472 2c73 656e 736f 723a 7374 7229 3a0a  tr,sensor:str):.
+00009030: 2020 2020 2020 2020 2222 2220 7265 7475          """ retu
+00009040: 726e 7320 3c70 726f 6a65 6374 3e5f 3c65  rns <project>_<e
+00009050: 7665 6e74 3e5f 3c73 656e 736f 723e 2c20  vent>_<sensor>, 
+00009060: 7769 7468 2073 686f 7274 2076 6572 7369  with short versi
+00009070: 6f6e 206f 6620 3c73 656e 736f 723e 2028  on of <sensor> (
+00009080: 6f6e 6c79 2069 6429 2c20 7072 6576 656e  only id), preven
+00009090: 7469 6e67 2070 6f74 656e 7469 616c 2064  ting potential d
+000090a0: 6f75 626c 696e 6720 6f66 203c 7072 6f6a  oubling of <proj
+000090b0: 6563 743e 2020 2222 220a 2020 2020 2020  ect>  """.      
+000090c0: 2020 7365 6e73 6f72 5f73 686f 7274 203d    sensor_short =
+000090d0: 2069 4644 4f2e 6765 7453 686f 7274 4571   iFDO.getShortEq
+000090e0: 7569 706d 656e 7449 4428 7365 6e73 6f72  uipmentID(sensor
+000090f0: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
+00009100: 2865 7665 6e74 2920 3e20 6c65 6e28 7072  (event) > len(pr
+00009110: 6f6a 6563 7429 2061 6e64 2065 7665 6e74  oject) and event
+00009120: 5b30 3a6c 656e 2870 726f 6a65 6374 295d  [0:len(project)]
+00009130: 203d 3d20 7072 6f6a 6563 743a 0a20 2020   == project:.   
+00009140: 2020 2020 2020 2020 2069 6d61 6765 5f73           image_s
+00009150: 6574 5f6e 616d 655f 203d 2065 7665 6e74  et_name_ = event
+00009160: 202b 2022 5f22 202b 2073 656e 736f 725f   + "_" + sensor_
+00009170: 7368 6f72 740a 2020 2020 2020 2020 656c  short.        el
+00009180: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00009190: 696d 6167 655f 7365 745f 6e61 6d65 5f20  image_set_name_ 
+000091a0: 3d20 7072 6f6a 6563 7420 2b20 225f 2220  = project + "_" 
+000091b0: 2b20 6576 656e 7420 2b20 225f 2220 2b20  + event + "_" + 
+000091c0: 7365 6e73 6f72 5f73 686f 7274 0a20 2020  sensor_short.   
+000091d0: 2020 2020 2072 6574 7572 6e20 696d 6167       return imag
+000091e0: 655f 7365 745f 6e61 6d65 5f20 2320 544f  e_set_name_ # TO
+000091f0: 444f 2069 6e63 6c75 6465 2064 6174 6154  DO include dataT
+00009200: 7970 653f 0a0a 0a20 2020 2040 7374 6174  ype?...    @stat
+00009210: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+00009220: 2067 6574 5368 6f72 7445 7175 6970 6d65   getShortEquipme
+00009230: 6e74 4944 2865 7175 6970 6d65 6e74 4944  ntID(equipmentID
+00009240: 3a73 7472 293a 0a20 2020 2020 2020 2022  :str):.        "
+00009250: 2222 2072 6574 7572 6e73 2065 7175 6970  "" returns equip
+00009260: 6d65 6e74 2069 6420 7769 7468 6f75 7420  ment id without 
+00009270: 706f 7465 6e74 6961 6c6c 206c 6f6e 6720  potentiall long 
+00009280: 3c6e 616d 653e 2070 6172 742c 2069 2e65  <name> part, i.e
+00009290: 2e3a 203c 6f77 6e65 723e 5f3c 7479 7065  .: <owner>_<type
+000092a0: 3e2d 3c74 7970 6520 696e 6465 785b 5f3c  >-<type index[_<
+000092b0: 7375 6274 7970 653e 5d20 2222 220a 2020  subtype>] """.  
+000092c0: 2020 2020 2020 7265 7475 726e 2027 5f27        return '_'
+000092d0: 2e6a 6f69 6e28 6571 7569 706d 656e 7449  .join(equipmentI
+000092e0: 442e 7370 6c69 7428 275f 2729 5b30 3a33  D.split('_')[0:3
+000092f0: 5d29 0a0a 2020 2020 4073 7461 7469 636d  ])..    @staticm
+00009300: 6574 686f 640a 2020 2020 6465 6620 636f  ethod.    def co
+00009310: 6e73 7472 7563 7469 4644 4f66 696c 654e  nstructiFDOfileN
+00009320: 616d 6528 7072 6f6a 6563 743a 7374 722c  ame(project:str,
+00009330: 6576 656e 743a 7374 722c 7365 6e73 6f72  event:str,sensor
+00009340: 3a73 7472 293a 0a20 2020 2020 2020 2022  :str):.        "
+00009350: 2222 2072 6574 7572 6e73 203c 636f 6e73  "" returns <cons
+00009360: 7472 7563 7449 6d61 6765 5365 744e 616d  tructImageSetNam
+00009370: 6528 293e 5f69 4644 4f2e 6a73 6f6e 2022  e()>_iFDO.json "
+00009380: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+00009390: 6e20 6946 444f 2e63 6f6e 7374 7275 6374  n iFDO.construct
+000093a0: 496d 6167 6553 6574 4e61 6d65 2870 726f  ImageSetName(pro
+000093b0: 6a65 6374 2c65 7665 6e74 2c73 656e 736f  ject,event,senso
+000093c0: 7229 202b 2027 5f69 4644 4f2e 6a73 6f6e  r) + '_iFDO.json
+000093d0: 2720 0a0a 2020 2020 0a20 2020 2040 7374  ' ..    .    @st
+000093e0: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+000093f0: 6566 205f 5f67 6574 4669 656c 6456 616c  ef __getFieldVal
+00009400: 7565 2869 6664 6f3a 6469 6374 2c6b 6579  ue(ifdo:dict,key
+00009410: 733a 6c69 7374 2c64 6566 6175 6c74 5f6f  s:list,default_o
+00009420: 6e6c 7920 3d20 4661 6c73 6529 3a0a 2020  nly = False):.  
+00009430: 2020 2020 2020 2222 2220 7265 7475 726e        """ return
+00009440: 7320 636f 7079 206f 6620 7365 7420 6f72  s copy of set or
+00009450: 2069 7465 6d20 6669 656c 6420 7661 6c75   item field valu
+00009460: 652c 2061 6c73 6f20 636f 6e73 6964 6572  e, also consider
+00009470: 6e67 2064 6566 6175 6c74 2076 616c 7565  ng default value
+00009480: 7320 6672 6f6d 2068 6561 6465 722e 0a20  s from header.. 
+00009490: 2020 2020 2020 2020 2020 2055 7365 206b             Use k
+000094a0: 6579 7320 6173 2065 2e67 2e20 5b3c 6974  eys as e.g. [<it
+000094b0: 656d 3e2c 3c6b 6579 3e2c 2e2e 5d2e 2043  em>,<key>,..]. C
+000094c0: 616e 2062 6520 7573 6564 2066 6f72 2068  an be used for h
+000094d0: 6561 6465 7220 6669 656c 6473 2061 7320  eader fields as 
+000094e0: 7765 6c6c 2061 7320 6974 656d 2066 6965  well as item fie
+000094f0: 6c64 732e 0a20 2020 2020 2020 2020 2020  lds..           
+00009500: 2049 7465 6d20 696e 6465 7820 6361 6e20   Item index can 
+00009510: 6265 206e 6567 6c65 6374 6564 2c20 696e  be neglected, in
+00009520: 2063 6173 6520 6f66 2076 6964 656f 2061   case of video a
+00009530: 2064 6963 7420 7b3c 696d 6167 652d 6461   dict {<image-da
+00009540: 7461 7469 6d65 3e3a 3c76 616c 7565 3e2c  tatime>:<value>,
+00009550: 2e2e 2e7d 2069 7320 7265 7475 726e 6564  ...} is returned
+00009560: 0a20 2020 2020 2020 2020 2020 2075 6e6c  .            unl
+00009570: 6573 7320 6465 6661 756c 745f 6f6e 6c79  ess default_only
+00009580: 203d 2046 616c 7365 2c20 7468 656e 2064   = False, then d
+00009590: 6566 6175 6c74 2076 616c 7565 7320 6174  efault values at
+000095a0: 2069 6e64 6578 2030 2069 7320 7265 7475   index 0 is retu
+000095b0: 726e 6564 2e0a 2020 2020 2020 2020 2020  rned..          
+000095c0: 2020 5261 6973 6573 2049 6664 6f45 7863    Raises IfdoExc
+000095d0: 6570 7469 6f6e 2069 6620 6b65 7973 2064  eption if keys d
+000095e0: 6f20 6e6f 7420 6578 6973 742e 2022 2222  o not exist. """
+000095f0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00009600: 206d 6971 7476 2e69 6d61 6765 5f73 6574   miqtv.image_set
+00009610: 5f69 7465 6d73 5f6b 6579 2069 6e20 6966  _items_key in if
+00009620: 646f 206f 7220 6e6f 7420 6d69 7174 762e  do or not miqtv.
+00009630: 696d 6167 655f 7365 745f 6865 6164 6572  image_set_header
+00009640: 5f6b 6579 2069 6e20 6966 646f 3a0a 2020  _key in ifdo:.  
+00009650: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00009660: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+00009670: 696f 6e28 2249 6e76 616c 6964 2069 6664  ion("Invalid ifd
+00009680: 6f20 6469 6374 2c20 6d69 7373 696e 6720  o dict, missing 
+00009690: 6974 656d 7320 6f72 2068 6561 6465 7220  items or header 
+000096a0: 6b65 793a 2022 202b 2073 7472 2869 6664  key: " + str(ifd
+000096b0: 6f29 290a 2020 2020 2020 2020 0a20 2020  o)).        .   
+000096c0: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+000096d0: 7374 616e 6365 286b 6579 732c 6c69 7374  stance(keys,list
+000096e0: 293a 0a20 2020 2020 2020 2020 2020 206b  ):.            k
+000096f0: 6579 7320 3d20 5b6b 6579 735d 0a0a 2020  eys = [keys]..  
+00009700: 2020 2020 2020 2320 7265 6d6f 7665 2068        # remove h
+00009710: 6561 6465 7220 6f72 2069 7465 6d20 7072  eader or item pr
+00009720: 6566 6978 6573 2069 6620 7468 6572 650a  efixes if there.
+00009730: 2020 2020 2020 2020 6966 206b 6579 735b          if keys[
+00009740: 305d 203d 3d20 6d69 7174 762e 696d 6167  0] == miqtv.imag
+00009750: 655f 7365 745f 6974 656d 735f 6b65 7920  e_set_items_key 
+00009760: 6f72 206b 6579 735b 305d 203d 3d20 6d69  or keys[0] == mi
+00009770: 7174 762e 696d 6167 655f 7365 745f 6865  qtv.image_set_he
+00009780: 6164 6572 5f6b 6579 3a0a 2020 2020 2020  ader_key:.      
+00009790: 2020 2020 2020 6b65 7973 203d 206b 6579        keys = key
+000097a0: 735b 313a 3a5d 0a0a 2020 2020 2020 2020  s[1::]..        
+000097b0: 6865 6164 6572 203d 2069 6664 6f5b 6d69  header = ifdo[mi
+000097c0: 7174 762e 696d 6167 655f 7365 745f 6865  qtv.image_set_he
+000097d0: 6164 6572 5f6b 6579 5d0a 2020 2020 2020  ader_key].      
+000097e0: 2020 6974 656d 7320 3d20 6966 646f 5b6d    items = ifdo[m
+000097f0: 6971 7476 2e69 6d61 6765 5f73 6574 5f69  iqtv.image_set_i
+00009800: 7465 6d73 5f6b 6579 5d0a 2020 2020 2020  tems_key].      
+00009810: 2020 2320 6c6f 6f6b 2066 6f72 2064 6566    # look for def
+00009820: 6175 6c74 2076 616c 7565 0a20 2020 2020  ault value.     
+00009830: 2020 2066 6f72 2073 6b69 7070 6564 496e     for skippedIn
+00009840: 4865 6164 6572 2069 6e20 7261 6e67 6528  Header in range(
+00009850: 6c65 6e28 6b65 7973 2929 3a0a 2020 2020  len(keys)):.    
+00009860: 2020 2020 2020 2020 6465 6661 756c 7456          defaultV
+00009870: 616c 203d 2066 696e 6446 6965 6c64 2868  al = findField(h
+00009880: 6561 6465 722c 6b65 7973 5b73 6b69 7070  eader,keys[skipp
+00009890: 6564 496e 4865 6164 6572 3a3a 5d29 0a20  edInHeader::]). 
+000098a0: 2020 2020 2020 2020 2020 2069 6620 6465             if de
+000098b0: 6661 756c 7456 616c 2021 3d20 2222 3a0a  faultVal != "":.
+000098c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000098d0: 6272 6561 6b0a 0a20 2020 2020 2020 2023  break..        #
+000098e0: 2320 6c6f 6f6b 2066 6f72 2069 7465 6d20  # look for item 
+000098f0: 7661 6c75 650a 2020 2020 2020 2020 2320  value.        # 
+00009900: 6865 6164 6572 206f 6e6c 7920 7661 6c75  header only valu
+00009910: 652c 2064 6f6e 2774 2063 6865 636b 2069  e, don't check i
+00009920: 6e20 6974 656d 730a 2020 2020 2020 2020  n items.        
+00009930: 6966 2066 696e 6446 6965 6c64 2869 7465  if findField(ite
+00009940: 6d73 2c6b 6579 735b 303a 315d 2920 3d3d  ms,keys[0:1]) ==
+00009950: 2022 2220 616e 6420 736b 6970 7065 6449   "" and skippedI
+00009960: 6e48 6561 6465 7220 3d3d 2030 3a0a 2020  nHeader == 0:.  
+00009970: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
+00009980: 6465 6661 756c 7456 616c 0a20 2020 2020  defaultVal.     
+00009990: 2020 2020 2020 2069 6620 7265 7420 3d3d         if ret ==
+000099a0: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
+000099b0: 2020 2020 2072 6169 7365 206d 6971 7463       raise miqtc
+000099c0: 2e49 6664 6f45 7863 6570 7469 6f6e 2822  .IfdoException("
+000099d0: 6b65 7920 646f 6573 206e 6f74 2065 7869  key does not exi
+000099e0: 7374 3a22 202b 2073 7472 286b 6579 7329  st:" + str(keys)
+000099f0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00009a00: 2020 2020 2020 2020 2020 2020 2320 6966              # if
+00009a10: 2066 6972 7374 206b 6579 206e 6f74 2066   first key not f
+00009a20: 6f75 6e64 2069 6e20 6974 656d 732c 2069  ound in items, i
+00009a30: 2e65 2e20 6973 206e 6f74 2061 2069 6d61  .e. is not a ima
+00009a40: 6765 206e 616d 652c 2061 6e64 2066 6972  ge name, and fir
+00009a50: 7374 206b 6579 2069 7320 6e6f 7420 6120  st key is not a 
+00009a60: 6865 6164 6572 206b 6579 3a0a 2020 2020  header key:.    
+00009a70: 2020 2020 2020 2020 6966 2066 696e 6446          if findF
+00009a80: 6965 6c64 2869 7465 6d73 2c6b 6579 735b  ield(items,keys[
+00009a90: 303a 315d 2920 3d3d 2022 2220 616e 6420  0:1]) == "" and 
+00009aa0: 736b 6970 7065 6449 6e48 6561 6465 7220  skippedInHeader 
+00009ab0: 213d 2030 3a0a 2020 2020 2020 2020 2020  != 0:.          
+00009ac0: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
+00009ad0: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
+00009ae0: 2269 7465 6d20 646f 6573 206e 6f74 2065  "item does not e
+00009af0: 7869 7374 3a22 202b 2073 7472 286b 6579  xist:" + str(key
+00009b00: 735b 303a 315d 2929 0a0a 2020 2020 2020  s[0:1]))..      
+00009b10: 2020 2020 2020 2320 6368 6563 6b20 6966        # check if
+00009b20: 2069 6e64 6578 2070 726f 7669 6465 640a   index provided.
+00009b30: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+00009b40: 7850 726f 7669 6465 6420 3d20 5472 7565  xProvided = True
+00009b50: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00009b60: 6c65 6e28 6b65 7973 2920 3e20 313a 0a20  len(keys) > 1:. 
+00009b70: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00009b80: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00009b90: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
+00009ba0: 696e 7428 6b65 7973 5b31 5d29 0a20 2020  int(keys[1]).   
+00009bb0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00009bc0: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+00009bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009be0: 2020 2069 6e64 6578 5072 6f76 6964 6564     indexProvided
+00009bf0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00009c00: 2020 2020 2065 6c69 6620 6c65 6e28 6b65       elif len(ke
+00009c10: 7973 2920 3d3d 2031 3a0a 2020 2020 2020  ys) == 1:.      
+00009c20: 2020 2020 2020 2020 2020 696e 6465 7850            indexP
+00009c30: 726f 7669 6465 6420 3d20 4661 6c73 650a  rovided = False.
+00009c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c50: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
+00009c60: 6765 4974 656d 5469 6d65 506f 696e 7473  geItemTimePoints
+00009c70: 203d 2069 7465 6d73 5b6b 6579 735b 305d   = items[keys[0]
+00009c80: 5d0a 0a20 2020 2020 2020 2020 2020 2069  ]..            i
+00009c90: 6620 696e 6465 7850 726f 7669 6465 643a  f indexProvided:
+00009ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009cb0: 2023 2069 6620 6b65 7920 6973 2077 686f   # if key is who
+00009cc0: 6c65 2069 6d61 6765 2061 6464 2061 6c6c  le image add all
+00009cd0: 2076 616c 7565 7320 6672 6f6d 2068 6561   values from hea
+00009ce0: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
+00009cf0: 2020 2020 6966 206c 656e 286b 6579 7329      if len(keys)
+00009d00: 203d 3d20 323a 0a20 2020 2020 2020 2020   == 2:.         
+00009d10: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00009d20: 6c74 5661 6c20 3d20 6865 6164 6572 0a20  ltVal = header. 
+00009d30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009d40: 2061 6464 2064 6566 6175 6c74 2066 726f   add default fro
+00009d50: 6d20 696e 6465 7820 300a 2020 2020 2020  m index 0.      
+00009d60: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00009d70: 286b 6579 7329 203e 2031 2061 6e64 2069  (keys) > 1 and i
+00009d80: 6e64 6578 2021 3d20 303a 0a20 2020 2020  ndex != 0:.     
+00009d90: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00009da0: 6579 735f 3020 3d20 636f 7079 2e64 6565  eys_0 = copy.dee
+00009db0: 7063 6f70 7928 6b65 7973 290a 2020 2020  pcopy(keys).    
+00009dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009dd0: 6b65 7973 5f30 5b31 5d20 3d20 300a 2020  keys_0[1] = 0.  
+00009de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009df0: 2020 7265 745f 3020 3d20 6946 444f 2e5f    ret_0 = iFDO._
+00009e00: 5f67 6574 4974 656d 5661 6c75 6528 6974  _getItemValue(it
+00009e10: 656d 732c 6b65 7973 5f30 2c73 6b69 7070  ems,keys_0,skipp
+00009e20: 6564 496e 4865 6164 6572 2c64 6566 6175  edInHeader,defau
+00009e30: 6c74 5661 6c29 0a20 2020 2020 2020 2020  ltVal).         
+00009e40: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00009e50: 696e 7374 616e 6365 2872 6574 5f30 2c64  instance(ret_0,d
+00009e60: 6963 7429 3a0a 2020 2020 2020 2020 2020  ict):.          
+00009e70: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00009e80: 6661 756c 7456 616c 203d 207b 2a2a 6465  faultVal = {**de
+00009e90: 6661 756c 7456 616c 2c2a 2a72 6574 5f30  faultVal,**ret_0
+00009ea0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00009eb0: 2020 7265 7420 3d20 6946 444f 2e5f 5f67    ret = iFDO.__g
+00009ec0: 6574 4974 656d 5661 6c75 6528 6974 656d  etItemValue(item
+00009ed0: 732c 6b65 7973 2c73 6b69 7070 6564 496e  s,keys,skippedIn
+00009ee0: 4865 6164 6572 2c64 6566 6175 6c74 5661  Header,defaultVa
+00009ef0: 6c29 0a20 2020 2020 2020 2020 2020 200a  l).            .
+00009f00: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00009f10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00009f20: 2020 2320 6966 206b 6579 2069 7320 7768    # if key is wh
+00009f30: 6f6c 6520 696d 6167 6520 6164 6420 616c  ole image add al
+00009f40: 6c20 7661 6c75 6573 2066 726f 6d20 6865  l values from he
+00009f50: 6164 6572 0a20 2020 2020 2020 2020 2020  ader.           
+00009f60: 2020 2020 2069 6620 6c65 6e28 6b65 7973       if len(keys
+00009f70: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
+00009f80: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00009f90: 756c 7456 616c 203d 2068 6561 6465 720a  ultVal = header.
+00009fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009fb0: 2023 2070 6963 7475 7265 202d 3e20 6a75   # picture -> ju
+00009fc0: 7374 206f 6e65 2065 6e74 7279 2c20 696e  st one entry, in
+00009fd0: 7365 7274 2069 6e64 6578 2030 0a20 2020  sert index 0.   
+00009fe0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00009ff0: 6c65 6e28 696d 6167 6549 7465 6d54 696d  len(imageItemTim
+0000a000: 6550 6f69 6e74 7329 203d 3d20 313a 0a20  ePoints) == 1:. 
 0000a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a020: 2020 2020 7661 6c5f 6920 3d20 6946 444f      val_i = iFDO
-0000a030: 2e5f 5f67 6574 4974 656d 5661 6c75 6528  .__getItemValue(
-0000a040: 6974 656d 732c 6b65 7973 5f69 2c73 6b69  items,keys_i,ski
-0000a050: 7070 6564 496e 4865 6164 6572 2c64 6566  ppedInHeader,def
-0000a060: 6175 6c74 5661 6c29 0a20 2020 2020 2020  aultVal).       
-0000a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a080: 2023 2064 6566 6175 6c74 206f 6e6c 790a   # default only.
-0000a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0a0: 2020 2020 2020 2020 6966 2064 6566 6175          if defau
-0000a0b0: 6c74 5f6f 6e6c 793a 0a20 2020 2020 2020  lt_only:.       
-0000a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0d0: 2020 2020 2072 6574 203d 2076 616c 5f69       ret = val_i
-0000a0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a0f0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-0000a100: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-0000a110: 2020 2020 2020 2020 2020 2072 6574 5b74             ret[t
-0000a120: 696d 6550 6f69 6e74 4461 7461 5b27 696d  imePointData['im
-0000a130: 6167 652d 6461 7465 7469 6d65 275d 5d20  age-datetime']] 
-0000a140: 3d20 7661 6c5f 690a 2020 2020 2020 2020  = val_i.        
-0000a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a160: 2320 7265 6d6f 7665 2069 6d61 6765 2d64  # remove image-d
-0000a170: 6174 6574 696d 6520 6966 2074 6865 7265  atetime if there
-0000a180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a190: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-0000a1a0: 7374 616e 6365 2872 6574 5b74 696d 6550  stance(ret[timeP
-0000a1b0: 6f69 6e74 4461 7461 5b27 696d 6167 652d  ointData['image-
-0000a1c0: 6461 7465 7469 6d65 275d 5d2c 6469 6374  datetime']],dict
-0000a1d0: 2920 616e 6420 2769 6d61 6765 2d64 6174  ) and 'image-dat
-0000a1e0: 6574 696d 6527 2069 6e20 7265 745b 7469  etime' in ret[ti
-0000a1f0: 6d65 506f 696e 7444 6174 615b 2769 6d61  mePointData['ima
-0000a200: 6765 2d64 6174 6574 696d 6527 5d5d 3a0a  ge-datetime']]:.
-0000a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a220: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-0000a230: 7265 745b 7469 6d65 506f 696e 7444 6174  ret[timePointDat
-0000a240: 615b 2769 6d61 6765 2d64 6174 6574 696d  a['image-datetim
-0000a250: 6527 5d5d 5b27 696d 6167 652d 6461 7465  e']]['image-date
-0000a260: 7469 6d65 275d 0a20 2020 2020 2020 2020  time'].         
-0000a270: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000a280: 2076 6964 656f 2064 6566 6175 6c74 730a   video defaults.
+0000a020: 2020 206b 6579 7320 3d20 6b65 7973 5b30     keys = keys[0
+0000a030: 3a31 5d20 2b20 5b30 5d20 2b20 6b65 7973  :1] + [0] + keys
+0000a040: 5b31 3a3a 5d0a 2020 2020 2020 2020 2020  [1::].          
+0000a050: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
+0000a060: 6946 444f 2e5f 5f67 6574 4974 656d 5661  iFDO.__getItemVa
+0000a070: 6c75 6528 6974 656d 732c 6b65 7973 2c73  lue(items,keys,s
+0000a080: 6b69 7070 6564 496e 4865 6164 6572 2c64  kippedInHeader,d
+0000a090: 6566 6175 6c74 5661 6c29 0a20 2020 2020  efaultVal).     
+0000a0a0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+0000a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0c0: 2320 7669 6465 6f20 2d3e 2072 6574 7572  # video -> retur
+0000a0d0: 6e20 7661 6c75 6573 2066 6f72 2065 6163  n values for eac
+0000a0e0: 6820 7469 6d65 2073 7461 6d70 0a20 2020  h time stamp.   
+0000a0f0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0000a100: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000a110: 2020 2020 2020 2072 6574 203d 207b 7d0a         ret = {}.
+0000a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a130: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+0000a140: 6765 286c 656e 2869 6d61 6765 4974 656d  ge(len(imageItem
+0000a150: 5469 6d65 506f 696e 7473 2929 3a0a 2020  TimePoints)):.  
+0000a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a170: 2020 2020 2020 7469 6d65 506f 696e 7444        timePointD
+0000a180: 6174 6120 3d20 696d 6167 6549 7465 6d54  ata = imageItemT
+0000a190: 696d 6550 6f69 6e74 735b 695d 0a20 2020  imePoints[i].   
+0000a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a1b0: 2020 2020 206b 6579 735f 6920 3d20 6b65       keys_i = ke
+0000a1c0: 7973 5b30 3a31 5d20 2b20 5b69 5d20 2b20  ys[0:1] + [i] + 
+0000a1d0: 6b65 7973 5b31 3a3a 5d0a 2020 2020 2020  keys[1::].      
+0000a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a1f0: 2020 7661 6c5f 6920 3d20 6946 444f 2e5f    val_i = iFDO._
+0000a200: 5f67 6574 4974 656d 5661 6c75 6528 6974  _getItemValue(it
+0000a210: 656d 732c 6b65 7973 5f69 2c73 6b69 7070  ems,keys_i,skipp
+0000a220: 6564 496e 4865 6164 6572 2c64 6566 6175  edInHeader,defau
+0000a230: 6c74 5661 6c29 0a20 2020 2020 2020 2020  ltVal).         
+0000a240: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000a250: 2064 6566 6175 6c74 206f 6e6c 790a 2020   default only.  
+0000a260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a270: 2020 2020 2020 6966 2064 6566 6175 6c74        if default
+0000a280: 5f6f 6e6c 793a 0a20 2020 2020 2020 2020  _only:.         
 0000a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2a0: 2020 2020 2020 2020 6966 2069 203d 3d20          if i == 
-0000a2b0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0000a2c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000a2d0: 6620 6973 696e 7374 616e 6365 2872 6574  f isinstance(ret
-0000a2e0: 5b74 696d 6550 6f69 6e74 4461 7461 5b27  [timePointData['
-0000a2f0: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
-0000a300: 5d2c 6469 6374 293a 0a20 2020 2020 2020  ],dict):.       
-0000a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a320: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-0000a330: 5661 6c20 3d20 7b2a 2a64 6566 6175 6c74  Val = {**default
-0000a340: 5661 6c2c 2a2a 7265 745b 7469 6d65 506f  Val,**ret[timePo
-0000a350: 696e 7444 6174 615b 2769 6d61 6765 2d64  intData['image-d
-0000a360: 6174 6574 696d 6527 5d5d 7d0a 2020 2020  atetime']]}.    
-0000a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a380: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3a0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0000a3b0: 6661 756c 7456 616c 203d 2072 6574 5b74  faultVal = ret[t
-0000a3c0: 696d 6550 6f69 6e74 4461 7461 5b27 696d  imePointData['im
-0000a3d0: 6167 652d 6461 7465 7469 6d65 275d 5d0a  age-datetime']].
-0000a3e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a3f0: 2020 2020 2020 2020 2069 202b 3d20 310a           i += 1.
-0000a400: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-0000a410: 7374 616e 6365 2872 6574 2c64 6963 7429  stance(ret,dict)
-0000a420: 206f 7220 6973 696e 7374 616e 6365 2872   or isinstance(r
-0000a430: 6574 2c6c 6973 7429 3a0a 2020 2020 2020  et,list):.      
-0000a440: 2020 2020 2020 7265 7420 3d20 636f 7079        ret = copy
-0000a450: 2e64 6565 7063 6f70 7928 7265 7429 0a20  .deepcopy(ret). 
-0000a460: 2020 2020 2020 2069 6620 7265 7420 3d3d         if ret ==
-0000a470: 2022 2220 6f72 2072 6574 203d 3d20 7b7d   "" or ret == {}
-0000a480: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000a490: 6973 6520 6d69 7174 632e 4966 646f 4578  ise miqtc.IfdoEx
-0000a4a0: 6365 7074 696f 6e28 226b 6579 7320 646f  ception("keys do
-0000a4b0: 206e 6f74 2065 7869 7374 3a22 202b 2073   not exist:" + s
-0000a4c0: 7472 286b 6579 7329 290a 2020 2020 2020  tr(keys)).      
-0000a4d0: 2020 7265 7475 726e 2072 6574 0a0a 0a20    return ret... 
-0000a4e0: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-0000a4f0: 0a20 2020 2064 6566 205f 5f67 6574 4974  .    def __getIt
-0000a500: 656d 5661 6c75 6528 6974 656d 732c 6b65  emValue(items,ke
-0000a510: 7973 2c73 6b69 7070 6564 496e 4865 6164  ys,skippedInHead
-0000a520: 6572 2c64 6566 6175 6c74 5661 6c29 3a0a  er,defaultVal):.
-0000a530: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0000a540: 2023 2069 6e20 6361 7365 2069 7465 6d20   # in case item 
-0000a550: 6973 206e 6f74 2061 206c 6973 7420 2873  is not a list (s
-0000a560: 686f 756c 6420 6e6f 7420 6265 2070 6f73  hould not be pos
-0000a570: 7369 626c 6529 0a20 2020 2020 2020 2069  sible).        i
-0000a580: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-0000a590: 2869 7465 6d73 5b6b 6579 735b 305d 5d2c  (items[keys[0]],
-0000a5a0: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
-0000a5b0: 2020 2069 7465 6d73 5b6b 6579 735b 305d     items[keys[0]
-0000a5c0: 5d20 3d20 5b69 7465 6d73 5b6b 6579 735b  ] = [items[keys[
-0000a5d0: 305d 5d5d 0a0a 2020 2020 2020 2020 6974  0]]]..        it
-0000a5e0: 656d 5661 6c75 6520 3d20 6669 6e64 4669  emValue = findFi
-0000a5f0: 656c 6428 6974 656d 732c 6b65 7973 290a  eld(items,keys).
-0000a600: 0a20 2020 2020 2020 2069 6620 6974 656d  .        if item
-0000a610: 5661 6c75 6520 3d3d 2022 223a 0a20 2020  Value == "":.   
-0000a620: 2020 2020 2020 2020 2072 6574 203d 2064           ret = d
-0000a630: 6566 6175 6c74 5661 6c0a 2020 2020 2020  efaultVal.      
-0000a640: 2020 2320 696e 2063 6173 6520 6f66 2064    # in case of d
-0000a650: 6963 7473 206a 6f69 6e74 2068 6561 6465  icts joint heade
-0000a660: 7220 616e 6420 6974 656d 2066 6965 6c64  r and item field
-0000a670: 730a 2020 2020 2020 2020 656c 6966 2069  s.        elif i
-0000a680: 7369 6e73 7461 6e63 6528 6974 656d 5661  sinstance(itemVa
-0000a690: 6c75 652c 6469 6374 2920 616e 6420 6465  lue,dict) and de
-0000a6a0: 6661 756c 7456 616c 2021 3d20 2222 3a0a  faultVal != "":.
-0000a6b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000a6c0: 6f74 2069 7369 6e73 7461 6e63 6528 6465  ot isinstance(de
-0000a6d0: 6661 756c 7456 616c 2c64 6963 7429 3a0a  faultVal,dict):.
-0000a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6f0: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
-0000a700: 4578 6365 7074 696f 6e28 2249 7465 6d20  Exception("Item 
-0000a710: 6669 656c 6420 6973 2064 6963 7420 6275  field is dict bu
-0000a720: 7420 6465 6661 756c 7420 7661 6c75 6520  t default value 
-0000a730: 696e 2068 6561 6465 7220 6973 206e 6f74  in header is not
-0000a740: 3a20 2220 2b20 7374 7228 6b65 7973 2929  : " + str(keys))
-0000a750: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000a760: 203d 207b 2a2a 6465 6661 756c 7456 616c   = {**defaultVal
-0000a770: 2c2a 2a69 7465 6d56 616c 7565 7d0a 2020  ,**itemValue}.  
-0000a780: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000a790: 2020 2020 2020 2020 7265 7420 3d20 6974          ret = it
-0000a7a0: 656d 5661 6c75 650a 2020 2020 2020 2020  emValue.        
-0000a7b0: 7265 7475 726e 2072 6574 0a0a 0a20 2020  return ret...   
-0000a7c0: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
-0000a7d0: 6629 202d 3e20 7374 723a 0a20 2020 2020  f) -> str:.     
-0000a7e0: 2020 2022 2222 2050 7269 6e74 7320 6375     """ Prints cu
-0000a7f0: 7272 656e 7420 6946 444f 2066 696c 6520  rrent iFDO file 
-0000a800: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0000a810: 726e 2079 616d 6c2e 6475 6d70 2873 656c  rn yaml.dump(sel
-0000a820: 662e 6966 646f 5f63 6865 636b 6564 2c20  f.ifdo_checked, 
-0000a830: 6465 6661 756c 745f 7374 796c 653d 4e6f  default_style=No
-0000a840: 6e65 2c20 6465 6661 756c 745f 666c 6f77  ne, default_flow
-0000a850: 5f73 7479 6c65 3d4e 6f6e 652c 2061 6c6c  _style=None, all
-0000a860: 6f77 5f75 6e69 636f 6465 3d54 7275 652c  ow_unicode=True,
-0000a870: 2077 6964 7468 3d66 6c6f 6174 2822 696e   width=float("in
-0000a880: 6622 2929 0a0a 0a20 2020 2064 6566 205f  f"))...    def _
-0000a890: 5f67 6574 6974 656d 5f5f 2873 656c 662c  _getitem__(self,
-0000a8a0: 206b 6579 7329 3a0a 2020 2020 2020 2020   keys):.        
-0000a8b0: 2222 2220 5265 7475 726e 7320 636f 7079  """ Returns copy
-0000a8c0: 206f 6620 6368 6563 6b65 6420 6966 646f   of checked ifdo
-0000a8d0: 2073 6574 206f 7220 6974 656d 2066 6965   set or item fie
-0000a8e0: 6c64 2076 616c 7565 2c20 616c 736f 2063  ld value, also c
-0000a8f0: 6f6e 7369 6465 726e 6720 6465 6661 756c  onsiderng defaul
-0000a900: 7420 7661 6c75 6573 2066 726f 6d20 6865  t values from he
-0000a910: 6164 6572 2e0a 2020 2020 2020 2020 2020  ader..          
-0000a920: 2020 5573 6520 6b65 7973 2061 7320 652e    Use keys as e.
-0000a930: 672e 2027 3c69 7465 6d3e 3a3c 6b65 793e  g. '<item>:<key>
-0000a940: 3a2e 2e2e 272e 2043 616e 2062 6520 7573  :...'. Can be us
-0000a950: 6564 2066 6f72 2068 6561 6465 7220 6669  ed for header fi
-0000a960: 656c 6473 2061 7320 7765 6c6c 2061 7320  elds as well as 
-0000a970: 6974 656d 2066 6965 6c64 732e 0a20 2020  item fields..   
-0000a980: 2020 2020 2020 2020 2049 7465 6d20 696e           Item in
-0000a990: 6465 7820 6361 6e20 6265 206c 6567 6c65  dex can be legle
-0000a9a0: 6374 6564 2c20 696e 2063 6173 6520 6f66  cted, in case of
-0000a9b0: 2076 6964 656f 2061 2064 6963 7420 7b3c   video a dict {<
-0000a9c0: 696d 6167 652d 6461 7461 7469 6d65 3e3a  image-datatime>:
-0000a9d0: 3c76 616c 7565 3e2c 2e2e 2e7d 2069 7320  <value>,...} is 
-0000a9e0: 7265 7475 726e 6564 2e0a 2020 2020 2020  returned..      
-0000a9f0: 2020 2020 2020 5261 6973 6573 2049 6664        Raises Ifd
-0000aa00: 6f45 7863 6570 7469 6f6e 2069 6620 6974  oException if it
-0000aa10: 656d 2064 6f65 7320 6e6f 7420 6578 6973  em does not exis
-0000aa20: 742e 2022 2222 0a20 2020 2020 2020 206b  t. """.        k
-0000aa30: 6579 7320 3d20 6b65 7973 2e73 706c 6974  eys = keys.split
-0000aa40: 2827 3a27 290a 2020 2020 2020 2020 7265  (':').        re
-0000aa50: 7475 726e 2073 656c 662e 5f5f 6765 7446  turn self.__getF
-0000aa60: 6965 6c64 5661 6c75 6528 7365 6c66 2e69  ieldValue(self.i
-0000aa70: 6664 6f5f 6368 6563 6b65 642c 6b65 7973  fdo_checked,keys
-0000aa80: 290a 0a0a 2020 2020 6465 6620 6669 6e64  )...    def find
-0000aa90: 546d 7046 6965 6c64 2873 656c 662c 6b65  TmpField(self,ke
-0000aaa0: 7973 293a 0a20 2020 2020 2020 2022 2222  ys):.        """
-0000aab0: 2052 6574 7572 6e73 2063 6f70 7920 6f66   Returns copy of
-0000aac0: 2074 656d 706f 7261 7279 2075 6e63 6865   temporary unche
-0000aad0: 636b 6564 2069 6664 6f20 7365 7420 6f72  cked ifdo set or
-0000aae0: 2069 7465 6d20 6669 656c 6420 7661 6c75   item field valu
-0000aaf0: 652c 2061 6c73 6f20 636f 6e73 6964 6572  e, also consider
-0000ab00: 6e67 2064 6566 6175 6c74 2076 616c 7565  ng default value
-0000ab10: 7320 6672 6f6d 2068 6561 6465 722e 0a20  s from header.. 
-0000ab20: 2020 2020 2020 2020 2020 2055 7365 206b             Use k
-0000ab30: 6579 7320 6173 2065 2e67 2e20 273c 6974  eys as e.g. '<it
-0000ab40: 656d 3e3a 3c6b 6579 3e3a 2e2e 2e27 2e20  em>:<key>:...'. 
-0000ab50: 4361 6e20 6265 2075 7365 6420 666f 7220  Can be used for 
-0000ab60: 6865 6164 6572 2066 6965 6c64 7320 6173  header fields as
-0000ab70: 2077 656c 6c20 6173 2069 7465 6d20 6669   well as item fi
-0000ab80: 656c 6473 2e0a 2020 2020 2020 2020 2020  elds..          
-0000ab90: 2020 4974 656d 2069 6e64 6578 2063 616e    Item index can
-0000aba0: 2062 6520 6c65 676c 6563 7465 642c 2069   be leglected, i
-0000abb0: 6e20 6361 7365 206f 6620 7669 6465 6f20  n case of video 
-0000abc0: 6120 6469 6374 207b 3c69 6d61 6765 2d64  a dict {<image-d
-0000abd0: 6174 6174 696d 653e 3a3c 7661 6c75 653e  atatime>:<value>
-0000abe0: 2c2e 2e2e 7d20 6973 2072 6574 7572 6e65  ,...} is returne
-0000abf0: 642e 0a20 2020 2020 2020 2020 2020 2052  d..            R
-0000ac00: 6169 7365 7320 4966 646f 4578 6365 7074  aises IfdoExcept
-0000ac10: 696f 6e20 6966 2069 7465 6d20 646f 6573  ion if item does
-0000ac20: 206e 6f74 2065 7869 7374 2e20 2222 220a   not exist. """.
-0000ac30: 2020 2020 2020 2020 6b65 7973 203d 206b          keys = k
-0000ac40: 6579 732e 7370 6c69 7428 273a 2729 0a20  eys.split(':'). 
-0000ac50: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000ac60: 6c66 2e5f 5f67 6574 4669 656c 6456 616c  lf.__getFieldVal
-0000ac70: 7565 2873 656c 662e 6966 646f 5f74 6d70  ue(self.ifdo_tmp
-0000ac80: 2c6b 6579 7329 0a20 2020 200a 0a20 2020  ,keys).    ..   
-0000ac90: 2064 6566 2066 696e 6454 6d70 4669 656c   def findTmpFiel
-0000aca0: 6432 2873 656c 662c 6b65 7973 293a 0a20  d2(self,keys):. 
-0000acb0: 2020 2020 2020 2022 2222 2053 616d 6520         """ Same 
-0000acc0: 6173 2066 696e 6454 6d70 4669 656c 6420  as findTmpField 
-0000acd0: 696e 7374 6561 6420 6f66 2072 6169 7369  instead of raisi
-0000ace0: 6e67 2065 7863 6570 7469 6f6e 2069 7420  ng exception it 
-0000acf0: 7265 7475 726e 2065 6d70 7479 2073 7472  return empty str
-0000ad00: 696e 672e 2022 2222 0a20 2020 2020 2020  ing. """.       
-0000ad10: 206b 6579 7320 3d20 6b65 7973 2e73 706c   keys = keys.spl
-0000ad20: 6974 2827 3a27 290a 2020 2020 2020 2020  it(':').        
-0000ad30: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000ad40: 2072 6574 203d 2073 656c 662e 5f5f 6765   ret = self.__ge
-0000ad50: 7446 6965 6c64 5661 6c75 6528 7365 6c66  tFieldValue(self
-0000ad60: 2e69 6664 6f5f 746d 702c 6b65 7973 290a  .ifdo_tmp,keys).
-0000ad70: 2020 2020 2020 2020 6578 6365 7074 206d          except m
-0000ad80: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-0000ad90: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-0000ada0: 7265 7420 3d20 2222 0a20 2020 2020 2020  ret = "".       
-0000adb0: 2072 6574 7572 6e20 7265 740a 0a0a 2020   return ret...  
-0000adc0: 2020 6465 6620 7365 7469 4644 4f48 6561    def setiFDOHea
-0000add0: 6465 7246 6965 6c64 7328 7365 6c66 2c20  derFields(self, 
-0000ade0: 6865 6164 6572 3a20 6469 6374 293a 0a20  header: dict):. 
-0000adf0: 2020 2020 2020 2022 2222 2043 6c65 6172         """ Clear
-0000ae00: 7320 6375 7272 656e 7420 6865 6164 6572  s current header
-0000ae10: 2066 6965 6c64 7320 756e 6420 7365 7473   fields und sets
-0000ae20: 2070 726f 7669 6465 6420 6669 656c 6420   provided field 
-0000ae30: 7661 6c75 6573 2e20 466f 7220 7570 6461  values. For upda
-0000ae40: 7469 6e67 2065 7869 7374 696e 6720 6f6e  ting existing on
-0000ae50: 6573 2075 7365 2075 7064 6174 655f 6966  es use update_if
-0000ae60: 646f 5f68 6561 6465 725f 6669 656c 6473  do_header_fields
-0000ae70: 2829 2022 2222 0a20 2020 2020 2020 2073  () """.        s
-0000ae80: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000ae90: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-0000aea0: 4b65 795d 203d 207b 7d0a 2020 2020 2020  Key] = {}.      
-0000aeb0: 2020 6966 2073 656c 662e 696d 6167 6553    if self.imageS
-0000aec0: 6574 4865 6164 6572 4b65 7920 696e 2068  etHeaderKey in h
-0000aed0: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
-0000aee0: 2020 2068 6561 6465 7220 3d20 6865 6164     header = head
-0000aef0: 6572 5b73 656c 662e 696d 6167 6553 6574  er[self.imageSet
-0000af00: 4865 6164 6572 4b65 795d 0a20 2020 2020  HeaderKey].     
-0000af10: 2020 2066 6f72 2066 6965 6c64 2069 6e20     for field in 
-0000af20: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
-0000af30: 2020 2020 2369 6620 6669 656c 6420 6e6f      #if field no
-0000af40: 7420 696e 206d 6971 7476 2e69 6664 6f5f  t in miqtv.ifdo_
-0000af50: 6865 6164 6572 5f63 6f72 655f 6669 656c  header_core_fiel
-0000af60: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
-0000af70: 2320 2020 2073 656c 662e 7072 6f76 2e6c  #    self.prov.l
-0000af80: 6f67 2822 4361 7574 696f 6e3a 2055 6e6b  og("Caution: Unk
-0000af90: 6e6f 776e 2068 6561 6465 7220 6669 656c  nown header fiel
-0000afa0: 6420 5c22 2220 2b20 6669 656c 6420 2b20  d \"" + field + 
-0000afb0: 225c 222e 204d 6179 6265 2061 2074 7970  "\". Maybe a typ
-0000afc0: 6f3f 204f 7468 6572 7769 7365 2069 676e  o? Otherwise ign
-0000afd0: 6f72 6520 6d65 2e22 290a 2020 2020 2020  ore me.").      
-0000afe0: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
-0000aff0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-0000b000: 7448 6561 6465 724b 6579 5d5b 6669 656c  tHeaderKey][fiel
-0000b010: 645d 203d 2068 6561 6465 725b 6669 656c  d] = header[fiel
-0000b020: 645d 0a0a 0a20 2020 2064 6566 2075 7064  d]...    def upd
-0000b030: 6174 655f 6966 646f 5f68 6561 6465 725f  ate_ifdo_header_
-0000b040: 6669 656c 6473 2873 656c 662c 2068 6561  fields(self, hea
-0000b050: 6465 723a 2064 6963 7429 3a0a 2020 2020  der: dict):.    
-0000b060: 2020 2020 2222 2220 5570 6461 7465 7320      """ Updates 
-0000b070: 6578 6973 7469 6e67 2068 6561 6465 7220  existing header 
-0000b080: 6669 656c 6473 2022 2222 0a20 2020 2020  fields """.     
-0000b090: 2020 2069 6620 7365 6c66 2e69 6d61 6765     if self.image
-0000b0a0: 5365 7448 6561 6465 724b 6579 2069 6e20  SetHeaderKey in 
-0000b0b0: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
-0000b0c0: 2020 2020 6865 6164 6572 203d 2068 6561      header = hea
-0000b0d0: 6465 725b 7365 6c66 2e69 6d61 6765 5365  der[self.imageSe
-0000b0e0: 7448 6561 6465 724b 6579 5d0a 2020 2020  tHeaderKey].    
-0000b0f0: 2020 2020 6c6f 6720 3d20 6d69 7174 632e      log = miqtc.
-0000b100: 7265 6375 7273 6976 656c 7955 7064 6174  recursivelyUpdat
-0000b110: 6544 6963 7473 2873 656c 662e 6966 646f  eDicts(self.ifdo
-0000b120: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000b130: 6574 4865 6164 6572 4b65 795d 2c20 6865  etHeaderKey], he
-0000b140: 6164 6572 290a 2020 2020 2020 2020 7365  ader).        se
-0000b150: 6c66 2e70 726f 762e 6c6f 6728 6c6f 672c  lf.prov.log(log,
-0000b160: 646f 6e74 5368 6f77 3d54 7275 6529 0a0a  dontShow=True)..
-0000b170: 2020 2020 6465 6620 7570 6461 7465 6946      def updateiF
-0000b180: 444f 4865 6164 6572 4669 656c 6473 2873  DOHeaderFields(s
-0000b190: 656c 662c 2068 6561 6465 723a 2064 6963  elf, header: dic
-0000b1a0: 7429 3a0a 2020 2020 2020 2020 2222 2220  t):.        """ 
-0000b1b0: 4465 7072 6563 6174 6564 202d 2075 7365  Deprecated - use
-0000b1c0: 2075 7064 6174 655f 6966 646f 5f68 6561   update_ifdo_hea
-0000b1d0: 6465 725f 6669 656c 6473 2022 2222 0a20  der_fields """. 
-0000b1e0: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
-0000b1f0: 7465 5f69 6664 6f5f 6865 6164 6572 5f66  te_ifdo_header_f
-0000b200: 6965 6c64 7328 6865 6164 6572 290a 0a0a  ields(header)...
-0000b210: 2020 2020 6465 6620 5f74 7279 5f75 7067      def _try_upg
-0000b220: 7261 6465 5f74 6f5f 6966 646f 5f76 6572  rade_to_ifdo_ver
-0000b230: 7369 6f6e 5f32 7828 7365 6c66 293a 0a20  sion_2x(self):. 
-0000b240: 2020 2020 2020 2022 2222 2054 7279 2074         """ Try t
-0000b250: 6f20 636f 6e76 6572 7420 6669 656c 6473  o convert fields
-0000b260: 2066 726f 6d20 6946 444f 2076 6572 7369   from iFDO versi
-0000b270: 6f6e 203c 2032 2e30 2e30 2074 6f20 322e  on < 2.0.0 to 2.
-0000b280: 7820 2222 220a 2020 2020 2020 2020 7265  x """.        re
-0000b290: 6164 5f76 6572 7369 6f6e 5f73 7472 203d  ad_version_str =
-0000b2a0: 2022 7631 2e30 2e30 2220 2320 6469 6420   "v1.0.0" # did 
-0000b2b0: 6e6f 7420 6861 7665 2074 6865 2027 696d  not have the 'im
-0000b2c0: 6167 652d 7365 742d 6966 646f 2d76 6572  age-set-ifdo-ver
-0000b2d0: 7369 6f6e 2720 6669 656c 6420 7965 740a  sion' field yet.
-0000b2e0: 2020 2020 2020 2020 7472 793a 200a 2020          try: .  
-0000b2f0: 2020 2020 2020 2020 2020 7265 6164 5f76            read_v
-0000b300: 6572 7369 6f6e 5f73 7472 203d 2073 656c  ersion_str = sel
-0000b310: 662e 6669 6e64 546d 7046 6965 6c64 2827  f.findTmpField('
-0000b320: 696d 6167 652d 7365 742d 6966 646f 2d76  image-set-ifdo-v
-0000b330: 6572 7369 6f6e 2729 0a20 2020 2020 2020  ersion').       
-0000b340: 2065 7863 6570 7420 6d69 7174 632e 4966   except miqtc.If
-0000b350: 646f 4578 6365 7074 696f 6e3a 0a20 2020  doException:.   
-0000b360: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-0000b370: 2020 2020 2020 7265 6164 5f76 6572 7369        read_versi
-0000b380: 6f6e 203d 2056 6572 7369 6f6e 2872 6561  on = Version(rea
-0000b390: 645f 7665 7273 696f 6e5f 7374 7229 0a0a  d_version_str)..
-0000b3a0: 2020 2020 2020 2020 6966 2072 6561 645f          if read_
-0000b3b0: 7665 7273 696f 6e20 3c20 5665 7273 696f  version < Versio
-0000b3c0: 6e28 2232 2e30 2e30 2229 3a0a 2020 2020  n("2.0.0"):.    
-0000b3d0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0000b3e0: 2020 2020 2023 206e 6577 2055 5249 206f       # new URI o
-0000b3f0: 626a 6563 7420 6669 656c 6473 0a20 2020  bject fields.   
-0000b400: 2020 2020 2020 2020 206e 6577 5f75 7269           new_uri
-0000b410: 5f66 6965 6c64 7320 3d20 5b27 696d 6167  _fields = ['imag
-0000b420: 652d 7365 6e73 6f72 272c 2769 6d61 6765  e-sensor','image
-0000b430: 2d65 7665 6e74 272c 2769 6d61 6765 2d70  -event','image-p
-0000b440: 726f 6a65 6374 272c 2769 6d61 6765 2d63  roject','image-c
-0000b450: 6f6e 7465 7874 272c 2769 6d61 6765 2d6c  ontext','image-l
-0000b460: 6963 656e 7365 272c 2769 6d61 6765 2d70  icense','image-p
-0000b470: 6c61 7466 6f72 6d27 5d0a 2020 2020 2020  latform'].      
-0000b480: 2020 2020 2020 666f 7220 7572 695f 6669        for uri_fi
-0000b490: 656c 6420 696e 206e 6577 5f75 7269 5f66  eld in new_uri_f
-0000b4a0: 6965 6c64 733a 0a20 2020 2020 2020 2020  ields:.         
-0000b4b0: 2020 2020 2020 206f 6c64 5f73 7472 5f76         old_str_v
-0000b4c0: 616c 203d 2073 656c 662e 6669 6e64 546d  al = self.findTm
-0000b4d0: 7046 6965 6c64 3228 7572 695f 6669 656c  pField2(uri_fiel
-0000b4e0: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
-0000b4f0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000b500: 286f 6c64 5f73 7472 5f76 616c 2c73 7472  (old_str_val,str
-0000b510: 2920 616e 6420 6f6c 645f 7374 725f 7661  ) and old_str_va
-0000b520: 6c20 213d 2022 223a 2020 2020 2020 2020  l != "":        
-0000b530: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0000b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b550: 206e 6577 5f6f 626a 5f76 616c 203d 207b   new_obj_val = {
-0000b560: 276e 616d 6527 3a20 6f6c 645f 7374 725f  'name': old_str_
-0000b570: 7661 6c7d 0a20 2020 2020 2020 2020 2020  val}.           
-0000b580: 2020 2020 2020 2020 2069 735f 7572 692c           is_uri,
-0000b590: 206d 7367 203d 206d 6971 7474 2e76 616c   msg = miqtt.val
-0000b5a0: 6964 6174 655f 6167 6169 6e73 745f 7363  idate_against_sc
-0000b5b0: 6865 6d61 286f 6c64 5f73 7472 5f76 616c  hema(old_str_val
-0000b5c0: 2c7b 2274 7970 6522 3a20 2273 7472 696e  ,{"type": "strin
-0000b5d0: 6722 2c22 666f 726d 6174 223a 2022 7572  g","format": "ur
-0000b5e0: 6922 7d29 0a20 2020 2020 2020 2020 2020  i"}).           
-0000b5f0: 2020 2020 2020 2020 2069 6620 6973 5f75           if is_u
-0000b600: 7269 3a0a 2020 2020 2020 2020 2020 2020  ri:.            
-0000b610: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0000b620: 6f62 6a5f 7661 6c5b 2775 7269 275d 203d  obj_val['uri'] =
-0000b630: 206f 6c64 5f73 7472 5f76 616c 0a20 2020   old_str_val.   
-0000b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b650: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-0000b660: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000b670: 6572 4b65 795d 5b75 7269 5f66 6965 6c64  erKey][uri_field
-0000b680: 5d20 3d20 6e65 775f 6f62 6a5f 7661 6c0a  ] = new_obj_val.
-0000b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6a0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-0000b6b0: 6728 2241 7574 6f2d 7570 6772 6164 6564  g("Auto-upgraded
-0000b6c0: 2022 202b 2075 7269 5f66 6965 6c64 202b   " + uri_field +
-0000b6d0: 2022 2066 726f 6d20 2220 2b20 6f6c 645f   " from " + old_
-0000b6e0: 7374 725f 7661 6c20 2b20 2220 746f 2022  str_val + " to "
-0000b6f0: 202b 2073 7472 286e 6577 5f6f 626a 5f76   + str(new_obj_v
-0000b700: 616c 2929 0a0a 0a0a 2020 2020 6465 6620  al))....    def 
-0000b710: 7472 7941 7574 6f53 6574 4865 6164 6572  tryAutoSetHeader
-0000b720: 4669 656c 6473 2873 656c 6629 3a0a 2020  Fields(self):.  
-0000b730: 2020 2020 2020 2222 2220 5365 7473 2063        """ Sets c
-0000b740: 6572 7461 696e 2068 6561 6465 7220 6669  ertain header fi
-0000b750: 656c 6473 2065 2e67 2e20 6672 6f6d 2064  elds e.g. from d
-0000b760: 6972 6563 746f 7279 2069 6620 7468 6579  irectory if they
-0000b770: 2061 7265 206e 6f74 2073 6574 2079 6574   are not set yet
-0000b780: 2022 2222 0a0a 2020 2020 2020 2020 6966   """..        if
-0000b790: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
-0000b7a0: 6c64 3228 2769 6d61 6765 2d73 656e 736f  ld2('image-senso
-0000b7b0: 7227 2920 3d3d 2022 223a 0a20 2020 2020  r') == "":.     
-0000b7c0: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
-0000b7d0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000b7e0: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
-0000b7f0: 6167 652d 7365 6e73 6f72 275d 203d 207b  age-sensor'] = {
-0000b800: 276e 616d 6527 3a20 7365 6c66 2e64 6972  'name': self.dir
-0000b810: 2e73 656e 736f 7228 297d 0a20 2020 2020  .sensor()}.     
-0000b820: 2020 2065 6c69 6620 7365 6c66 2e66 696e     elif self.fin
-0000b830: 6454 6d70 4669 656c 6428 2769 6d61 6765  dTmpField('image
-0000b840: 2d73 656e 736f 7227 295b 276e 616d 6527  -sensor')['name'
-0000b850: 5d20 213d 2073 656c 662e 6469 722e 7365  ] != self.dir.se
-0000b860: 6e73 6f72 2829 3a0a 2020 2020 2020 2020  nsor():.        
-0000b870: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-0000b880: 6728 2243 6175 7469 6f6e 3a20 2769 6d61  g("Caution: 'ima
-0000b890: 6765 2d73 656e 736f 7227 2022 2b20 7374  ge-sensor' "+ st
-0000b8a0: 7228 7365 6c66 2e66 696e 6454 6d70 4669  r(self.findTmpFi
-0000b8b0: 656c 6428 2769 6d61 6765 2d73 656e 736f  eld('image-senso
-0000b8c0: 7227 2929 202b 2022 2064 6966 6665 7273  r')) + " differs
-0000b8d0: 2066 726f 6d20 7365 6e73 6f72 2070 6172   from sensor par
-0000b8e0: 7365 6420 6672 6f6d 2064 6972 6563 746f  sed from directo
-0000b8f0: 7279 3a20 2220 2b20 7365 6c66 2e64 6972  ry: " + self.dir
-0000b900: 2e73 656e 736f 7228 2929 0a0a 2020 2020  .sensor())..    
-0000b910: 2020 2020 6966 2073 656c 662e 6669 6e64      if self.find
-0000b920: 546d 7046 6965 6c64 3228 2769 6d61 6765  TmpField2('image
-0000b930: 2d65 7665 6e74 2729 203d 3d20 2222 3a0a  -event') == "":.
-0000b940: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000b950: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-0000b960: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000b970: 5d5b 2769 6d61 6765 2d65 7665 6e74 275d  ]['image-event']
-0000b980: 203d 207b 276e 616d 6527 3a20 7365 6c66   = {'name': self
-0000b990: 2e64 6972 2e65 7665 6e74 2829 7d0a 2020  .dir.event()}.  
-0000b9a0: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-0000b9b0: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
-0000b9c0: 6167 652d 6576 656e 7427 295b 276e 616d  age-event')['nam
-0000b9d0: 6527 5d20 213d 2073 656c 662e 6469 722e  e'] != self.dir.
-0000b9e0: 6576 656e 7428 293a 0a20 2020 2020 2020  event():.       
-0000b9f0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-0000ba00: 6f67 2822 4361 7574 696f 6e3a 2027 696d  og("Caution: 'im
-0000ba10: 6167 652d 6576 656e 7427 2022 202b 2073  age-event' " + s
-0000ba20: 7472 2873 656c 662e 6669 6e64 546d 7046  tr(self.findTmpF
-0000ba30: 6965 6c64 2827 696d 6167 652d 6576 656e  ield('image-even
-0000ba40: 7427 2929 202b 2022 2064 6966 6665 7273  t')) + " differs
-0000ba50: 2066 726f 6d20 6576 656e 7420 7061 7273   from event pars
-0000ba60: 6564 2066 726f 6d20 6469 7265 6374 6f72  ed from director
-0000ba70: 793a 2022 202b 2073 656c 662e 6469 722e  y: " + self.dir.
-0000ba80: 6576 656e 7428 2929 0a0a 2020 2020 2020  event())..      
-0000ba90: 2020 6966 2073 656c 662e 6669 6e64 546d    if self.findTm
-0000baa0: 7046 6965 6c64 3228 2769 6d61 6765 2d70  pField2('image-p
-0000bab0: 726f 6a65 6374 2729 203d 3d20 2222 3a0a  roject') == "":.
-0000bac0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000bad0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-0000bae0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000baf0: 5d5b 2769 6d61 6765 2d70 726f 6a65 6374  ]['image-project
-0000bb00: 275d 203d 2020 7b27 6e61 6d65 273a 2073  '] =  {'name': s
-0000bb10: 656c 662e 6469 722e 7072 6f6a 6563 7428  elf.dir.project(
-0000bb20: 297d 0a20 2020 2020 2020 2065 6c69 6620  )}.        elif 
-0000bb30: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-0000bb40: 6428 2769 6d61 6765 2d70 726f 6a65 6374  d('image-project
-0000bb50: 2729 5b27 6e61 6d65 275d 2021 3d20 7365  ')['name'] != se
-0000bb60: 6c66 2e64 6972 2e70 726f 6a65 6374 2829  lf.dir.project()
-0000bb70: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000bb80: 6c66 2e70 726f 762e 6c6f 6728 2243 6175  lf.prov.log("Cau
-0000bb90: 7469 6f6e 3a20 2769 6d61 6765 2d70 726f  tion: 'image-pro
-0000bba0: 6a65 6374 2720 2220 2b20 7374 7228 7365  ject' " + str(se
-0000bbb0: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
-0000bbc0: 2769 6d61 6765 2d70 726f 6a65 6374 2729  'image-project')
-0000bbd0: 2920 2b20 2220 6469 6666 6572 7320 6672  ) + " differs fr
-0000bbe0: 6f6d 2070 726f 6a65 6374 2070 6172 7365  om project parse
-0000bbf0: 6420 6672 6f6d 2064 6972 6563 746f 7279  d from directory
-0000bc00: 3a20 2220 2b20 7365 6c66 2e64 6972 2e70  : " + self.dir.p
-0000bc10: 726f 6a65 6374 2829 290a 0a20 2020 2020  roject())..     
-0000bc20: 2020 2069 6620 7365 6c66 2e66 696e 6454     if self.findT
-0000bc30: 6d70 4669 656c 6432 2827 696d 6167 652d  mpField2('image-
-0000bc40: 706c 6174 666f 726d 2729 203d 3d20 2222  platform') == ""
-0000bc50: 2061 6e64 2073 656c 662e 6469 722e 6765   and self.dir.ge
-0000bc60: 6172 2829 2021 3d20 2222 3a0a 2020 2020  ar() != "":.    
-0000bc70: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-0000bc80: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000bc90: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
-0000bca0: 6d61 6765 2d70 6c61 7466 6f72 6d27 5d20  mage-platform'] 
-0000bcb0: 3d20 7b27 6e61 6d65 273a 2073 656c 662e  = {'name': self.
-0000bcc0: 6469 722e 6765 6172 2829 7d0a 0a20 2020  dir.gear()}..   
-0000bcd0: 2020 2020 2069 6620 6e6f 7420 2769 6d61       if not 'ima
-0000bce0: 6765 2d73 6574 2d75 7569 6427 2069 6e20  ge-set-uuid' in 
-0000bcf0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000bd00: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000bd10: 724b 6579 5d3a 0a20 2020 2020 2020 2020  rKey]:.         
-0000bd20: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0000bd30: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000bd40: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-0000bd50: 7365 742d 7575 6964 275d 203d 2073 7472  set-uuid'] = str
-0000bd60: 286d 6971 7463 2e75 7569 6434 2829 290a  (miqtc.uuid4()).
-0000bd70: 2020 2020 2020 2020 6966 206e 6f74 2027          if not '
-0000bd80: 696d 6167 652d 7365 742d 6861 6e64 6c65  image-set-handle
-0000bd90: 2720 696e 2073 656c 662e 6966 646f 5f74  ' in self.ifdo_t
-0000bda0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-0000bdb0: 4865 6164 6572 4b65 795d 3a0a 2020 2020  HeaderKey]:.    
-0000bdc0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-0000bdd0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000bde0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
-0000bdf0: 6d61 6765 2d73 6574 2d68 616e 646c 6527  mage-set-handle'
-0000be00: 5d20 3d20 7365 6c66 2e68 616e 646c 655f  ] = self.handle_
-0000be10: 7072 6566 6978 202b 2022 2f22 202b 2073  prefix + "/" + s
-0000be20: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
-0000be30: 2827 696d 6167 652d 7365 742d 7575 6964  ('image-set-uuid
-0000be40: 2729 0a20 2020 2020 2020 2069 6620 6e6f  ').        if no
-0000be50: 7420 2769 6d61 6765 2d73 6574 2d6e 616d  t 'image-set-nam
-0000be60: 6527 2069 6e20 7365 6c66 2e69 6664 6f5f  e' in self.ifdo_
-0000be70: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-0000be80: 7448 6561 6465 724b 6579 5d20 6f72 2073  tHeaderKey] or s
-0000be90: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
-0000bea0: 3228 2769 6d61 6765 2d73 6574 2d6e 616d  2('image-set-nam
-0000beb0: 6527 2920 3d3d 2022 223a 0a20 2020 2020  e') == "":.     
-0000bec0: 2020 2020 2020 2023 2063 6f6e 7374 7275         # constru
-0000bed0: 6374 2061 7320 3c70 726f 6a65 6374 3e5f  ct as <project>_
-0000bee0: 3c65 7665 6e74 3e5f 3c73 656e 736f 723e  <event>_<sensor>
-0000bef0: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
-0000bf00: 6a65 6374 5f20 3d20 7365 6c66 2e66 696e  ject_ = self.fin
-0000bf10: 6454 6d70 4669 656c 6432 2822 696d 6167  dTmpField2("imag
-0000bf20: 652d 7072 6f6a 6563 7422 295b 276e 616d  e-project")['nam
-0000bf30: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
-0000bf40: 6576 656e 745f 203d 2073 656c 662e 6669  event_ = self.fi
-0000bf50: 6e64 546d 7046 6965 6c64 3228 2269 6d61  ndTmpField2("ima
-0000bf60: 6765 2d65 7665 6e74 2229 5b27 6e61 6d65  ge-event")['name
-0000bf70: 275d 0a20 2020 2020 2020 2020 2020 2069  '].            i
-0000bf80: 6620 6576 656e 745f 203d 3d20 2222 3a0a  f event_ == "":.
-0000bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bfa0: 6576 656e 745f 203d 2073 656c 662e 6469  event_ = self.di
-0000bfb0: 722e 6576 656e 7428 290a 2020 2020 2020  r.event().      
-0000bfc0: 2020 2020 2020 7365 6e73 6f72 5f20 3d20        sensor_ = 
-0000bfd0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-0000bfe0: 6432 2822 696d 6167 652d 7365 6e73 6f72  d2("image-sensor
-0000bff0: 2229 5b27 6e61 6d65 275d 0a20 2020 2020  ")['name'].     
-0000c000: 2020 2020 2020 2069 6620 7365 6e73 6f72         if sensor
-0000c010: 5f20 3d3d 2022 223a 0a20 2020 2020 2020  _ == "":.       
-0000c020: 2020 2020 2020 2020 2073 656e 736f 725f           sensor_
-0000c030: 203d 2073 656c 662e 6469 722e 7365 6e73   = self.dir.sens
-0000c040: 6f72 2829 0a20 2020 2020 2020 2020 2020  or().           
-0000c050: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-0000c060: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000c070: 6572 4b65 795d 5b27 696d 6167 652d 7365  erKey]['image-se
-0000c080: 742d 6e61 6d65 275d 203d 2069 4644 4f2e  t-name'] = iFDO.
-0000c090: 636f 6e73 7472 7563 7449 6d61 6765 5365  constructImageSe
-0000c0a0: 744e 616d 6528 7072 6f6a 6563 745f 2c65  tName(project_,e
-0000c0b0: 7665 6e74 5f2c 7365 6e73 6f72 5f29 0a0a  vent_,sensor_)..
-0000c0c0: 2020 2020 2020 2020 2320 7365 7420 7665          # set ve
-0000c0d0: 7273 696f 6e0a 2020 2020 2020 2020 7365  rsion.        se
-0000c0e0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-0000c0f0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-0000c100: 6579 5d5b 2769 6d61 6765 2d73 6574 2d69  ey]['image-set-i
-0000c110: 6664 6f2d 7665 7273 696f 6e27 5d20 3d20  fdo-version'] = 
-0000c120: 6d69 7174 762e 6946 444f 5f76 6572 7369  miqtv.iFDO_versi
-0000c130: 6f6e 0a0a 0a20 2020 2064 6566 2073 6574  on...    def set
-0000c140: 4865 6164 6572 496d 6167 654c 6f63 616c  HeaderImageLocal
-0000c150: 5061 7468 4669 656c 6428 7365 6c66 293a  PathField(self):
-0000c160: 0a20 2020 2020 2020 2022 2222 2053 6574  .        """ Set
-0000c170: 7320 6865 6164 6572 2066 6965 6c64 2027  s header field '
-0000c180: 696d 6167 652d 6c6f 6361 6c2d 7061 7468  image-local-path
-0000c190: 2720 6672 6f6d 2069 6d61 6765 2064 6972  ' from image dir
-0000c1a0: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
-0000c1b0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000c1c0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000c1d0: 795d 5b27 696d 6167 652d 6c6f 6361 6c2d  y]['image-local-
-0000c1e0: 7061 7468 275d 203d 206f 732e 7061 7468  path'] = os.path
-0000c1f0: 2e72 656c 7061 7468 2873 656c 662e 696d  .relpath(self.im
-0000c200: 6167 6573 4469 722c 206f 732e 7061 7468  agesDir, os.path
-0000c210: 2e64 6972 6e61 6d65 2873 656c 662e 6765  .dirname(self.ge
-0000c220: 7469 4644 4f46 696c 654e 616d 6528 2929  tiFDOFileName())
-0000c230: 290a 0a0a 2020 2020 6465 6620 6372 6561  )...    def crea
-0000c240: 7465 5f66 6965 6c64 7328 7365 6c66 2c20  te_fields(self, 
-0000c250: 616c 6c6f 775f 6d69 7373 696e 675f 7265  allow_missing_re
-0000c260: 7175 6972 6564 3d46 616c 7365 293a 0a20  quired=False):. 
-0000c270: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
-0000c280: 6520 616e 6420 7661 6c69 6461 7465 2063  e and validate c
-0000c290: 7572 7265 6e74 2068 6561 6465 7220 6669  urrent header fi
-0000c2a0: 656c 6473 2061 6e64 2069 7465 6d20 6669  elds and item fi
-0000c2b0: 656c 6473 2066 726f 6d20 696e 7465 726d  elds from interm
-0000c2c0: 6564 6961 7465 2066 696c 6573 2e20 4f76  ediate files. Ov
-0000c2d0: 6572 7772 6974 6573 2065 7869 7374 696e  erwrites existin
-0000c2e0: 6720 6669 656c 6473 2e20 2222 220a 2020  g fields. """.  
-0000c2f0: 2020 2020 2020 6974 656d 5f64 6174 6120        item_data 
-0000c300: 3d20 7365 6c66 2e5f 6765 745f 6974 656d  = self._get_item
-0000c310: 5f64 6174 615f 6672 6f6d 5f69 6e74 6572  _data_from_inter
-0000c320: 6d65 6469 6174 655f 6669 6c65 7328 290a  mediate_files().
-0000c330: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000c340: 656c 662e 6372 6561 7465 6946 444f 2873  elf.createiFDO(s
-0000c350: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000c360: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-0000c370: 4b65 795d 2c20 6974 656d 5f64 6174 612e  Key], item_data.
-0000c380: 7661 6c75 6573 2829 2c20 616c 6c6f 775f  values(), allow_
-0000c390: 6d69 7373 696e 675f 7265 7175 6972 6564  missing_required
-0000c3a0: 3d61 6c6c 6f77 5f6d 6973 7369 6e67 5f72  =allow_missing_r
-0000c3b0: 6571 7569 7265 6429 0a0a 0a20 2020 2064  equired)...    d
-0000c3c0: 6566 2075 7064 6174 655f 6669 656c 6473  ef update_fields
-0000c3d0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000c3e0: 2222 2220 5570 6461 7465 2061 6e64 2076  """ Update and v
-0000c3f0: 616c 6964 6174 6520 6375 7272 656e 7420  alidate current 
-0000c400: 6865 6164 6572 2066 6965 6c64 7320 616e  header fields an
-0000c410: 6420 6974 656d 2066 6965 6c64 7320 6672  d item fields fr
-0000c420: 6f6d 2069 6e74 6572 6d65 6469 6174 6520  om intermediate 
-0000c430: 6669 6c65 732e 2022 2222 0a20 2020 2020  files. """.     
-0000c440: 2020 2069 7465 6d5f 6461 7461 203d 2073     item_data = s
-0000c450: 656c 662e 5f67 6574 5f69 7465 6d5f 6461  elf._get_item_da
-0000c460: 7461 5f66 726f 6d5f 696e 7465 726d 6564  ta_from_intermed
-0000c470: 6961 7465 5f66 696c 6573 2829 0a20 2020  iate_files().   
-0000c480: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000c490: 2e75 7064 6174 6569 4644 4f28 7365 6c66  .updateiFDO(self
-0000c4a0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-0000c4b0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000c4c0: 5d2c 2069 7465 6d5f 6461 7461 2e76 616c  ], item_data.val
-0000c4d0: 7565 7328 2929 0a0a 0a20 2020 2064 6566  ues())...    def
-0000c4e0: 2063 7265 6174 6543 6f72 6546 6965 6c64   createCoreField
-0000c4f0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-0000c500: 2022 2222 2044 4550 5245 4341 4445 542c   """ DEPRECADET,
-0000c510: 2075 7365 2063 7265 6174 655f 6669 656c   use create_fiel
-0000c520: 6473 2829 206f 7220 7570 6461 7465 5f66  ds() or update_f
-0000c530: 6965 6c64 7328 2920 696e 7374 6564 2e0a  ields() insted..
-0000c540: 2020 2020 2020 2020 4669 6c6c 7320 7468          Fills th
-0000c550: 6520 6946 444f 2063 6f72 6520 6669 656c  e iFDO core fiel
-0000c560: 6473 2066 726f 6d20 696e 7465 726d 6564  ds from intermed
-0000c570: 6961 7465 2066 696c 6573 2e20 5769 7468  iate files. With
-0000c580: 6f75 7420 7468 656d 206e 6f20 7661 6c69  out them no vali
-0000c590: 6420 6946 444f 2063 616e 2062 6520 6372  d iFDO can be cr
-0000c5a0: 6561 7465 642e 0a20 2020 2020 2020 2022  eated..        "
-0000c5b0: 2222 0a20 2020 2020 2020 2069 7465 6d5f  "".        item_
-0000c5c0: 6461 7461 203d 2073 656c 662e 5f67 6574  data = self._get
-0000c5d0: 5f69 7465 6d5f 6461 7461 5f66 726f 6d5f  _item_data_from_
-0000c5e0: 696e 7465 726d 6564 6961 7465 5f66 696c  intermediate_fil
-0000c5f0: 6573 5f63 6f72 6528 290a 2020 2020 2020  es_core().      
-0000c600: 2020 2320 6368 6563 6b20 6669 656c 6473    # check fields
-0000c610: 2066 6f72 2076 616c 6964 6974 790a 2020   for validity.  
-0000c620: 2020 2020 2020 2320 6974 656d 5f64 6174        # item_dat
-0000c630: 6120 636f 6e74 6169 6e73 2066 6965 6c64  a contains field
-0000c640: 2069 6d61 6765 2d66 696c 656e 616d 652c   image-filename,
-0000c650: 2077 6869 6368 2077 6869 6368 2077 696c   which which wil
-0000c660: 6c20 6e6f 7420 6265 2073 746f 7265 6420  l not be stored 
-0000c670: 6173 2061 6e20 6974 656d 2066 6965 6c64  as an item field
-0000c680: 2069 6e20 6946 4f44 2062 7574 2061 7320   in iFOD but as 
-0000c690: 7468 6520 6974 656d 206e 616d 6520 6974  the item name it
-0000c6a0: 7365 6c66 0a20 2020 2020 2020 2072 6574  self.        ret
-0000c6b0: 7572 6e20 7365 6c66 2e75 7064 6174 6569  urn self.updatei
-0000c6c0: 4644 4f28 7365 6c66 2e69 6664 6f5f 746d  FDO(self.ifdo_tm
-0000c6d0: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
-0000c6e0: 6561 6465 724b 6579 5d2c 2069 7465 6d5f  eaderKey], item_
-0000c6f0: 6461 7461 2e76 616c 7565 7328 2929 0a0a  data.values())..
-0000c700: 0a20 2020 2064 6566 2063 7265 6174 6543  .    def createC
-0000c710: 6170 7475 7265 416e 6443 6f6e 7465 6e74  aptureAndContent
-0000c720: 4669 656c 6473 2873 656c 6629 3a0a 2020  Fields(self):.  
-0000c730: 2020 2020 2020 2222 2220 4445 5052 4543        """ DEPREC
-0000c740: 4144 4554 2c20 7573 6520 6372 6561 7465  ADET, use create
-0000c750: 5f66 6965 6c64 7328 2920 6f72 2075 7064  _fields() or upd
-0000c760: 6174 655f 6669 656c 6473 2829 2069 6e73  ate_fields() ins
-0000c770: 7465 642e 0a20 2020 2020 2020 2046 696c  ted..        Fil
-0000c780: 6c73 2074 6865 2069 4644 4f20 6361 7075  ls the iFDO capu
-0000c790: 7472 6520 616e 6420 636f 6e74 656e 7420  tre and content 
-0000c7a0: 6669 6564 7320 6672 6f6d 2070 726f 7669  fieds from provi
-0000c7b0: 6465 6420 6461 7461 2066 6965 6c64 7320  ded data fields 
-0000c7c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000c7d0: 2020 2020 2069 7465 6d5f 6461 7461 203d       item_data =
-0000c7e0: 2073 656c 662e 5f67 6574 5f69 7465 6d5f   self._get_item_
-0000c7f0: 6461 7461 5f66 726f 6d5f 696e 7465 726d  data_from_interm
-0000c800: 6564 6961 7465 5f66 696c 6573 5f6e 6f6e  ediate_files_non
-0000c810: 655f 636f 7265 2829 0a20 2020 2020 2020  e_core().       
-0000c820: 2023 2063 6865 636b 2066 6965 6c64 7320   # check fields 
-0000c830: 666f 7220 7661 6c69 6469 7479 0a20 2020  for validity.   
-0000c840: 2020 2020 2023 2069 7465 6d5f 6461 7461       # item_data
-0000c850: 2063 6f6e 7461 696e 7320 6669 656c 6420   contains field 
-0000c860: 696d 6167 652d 6669 6c65 6e61 6d65 2c20  image-filename, 
-0000c870: 7768 6963 6820 7768 6963 6820 7769 6c6c  which which will
-0000c880: 206e 6f74 2062 6520 7374 6f72 6564 2061   not be stored a
-0000c890: 7320 616e 2069 7465 6d20 6669 656c 6420  s an item field 
-0000c8a0: 696e 2069 464f 4420 6275 7420 6173 2074  in iFOD but as t
-0000c8b0: 6865 2069 7465 6d20 6e61 6d65 2069 7473  he item name its
-0000c8c0: 656c 660a 2020 2020 2020 2020 7265 7475  elf.        retu
-0000c8d0: 726e 2073 656c 662e 7570 6461 7465 6946  rn self.updateiF
-0000c8e0: 444f 2873 656c 662e 6966 646f 5f74 6d70  DO(self.ifdo_tmp
-0000c8f0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000c900: 6164 6572 4b65 795d 2c20 6974 656d 5f64  aderKey], item_d
-0000c910: 6174 612e 7661 6c75 6573 2829 290a 0a20  ata.values()).. 
-0000c920: 2020 200a 2020 2020 6465 6620 5f67 6574     .    def _get
-0000c930: 5f69 7465 6d5f 6461 7461 5f66 726f 6d5f  _item_data_from_
-0000c940: 696e 7465 726d 6564 6961 7465 5f66 696c  intermediate_fil
-0000c950: 6573 2873 656c 6629 3a0a 2020 2020 2020  es(self):.      
-0000c960: 2020 2222 2220 5265 6164 2064 6174 6120    """ Read data 
-0000c970: 6672 6f6d 2063 6f72 6520 616e 6420 6e6f  from core and no
-0000c980: 6e65 2d63 6f72 6520 696e 7465 726d 6465  ne-core intermde
-0000c990: 6174 6520 6669 6c65 732c 2063 6865 636b  ate files, check
-0000c9a0: 2066 696c 6573 2065 7869 7374 2c20 6164   files exist, ad
-0000c9b0: 6420 2769 6d61 6765 2d68 616e 646c 6527  d 'image-handle'
-0000c9c0: 2e0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-0000c9d0: 7320 6469 6374 206f 6620 666f 726d 207b  s dict of form {
-0000c9e0: 696d 6167 652d 6669 6c65 2d6e 616d 653a  image-file-name:
-0000c9f0: 7b66 6965 6c64 3a76 616c 7565 7d2c 2e2e  {field:value},..
-0000ca00: 2e7d 200a 2020 2020 2020 2020 2222 220a  .} .        """.
-0000ca10: 2020 2020 2020 2020 6974 656d 5f64 6174          item_dat
-0000ca20: 615f 636f 7265 203d 2073 656c 662e 5f67  a_core = self._g
-0000ca30: 6574 5f69 7465 6d5f 6461 7461 5f66 726f  et_item_data_fro
-0000ca40: 6d5f 696e 7465 726d 6564 6961 7465 5f66  m_intermediate_f
-0000ca50: 696c 6573 5f63 6f72 6528 290a 2020 2020  iles_core().    
-0000ca60: 2020 2020 6974 656d 5f64 6174 615f 6e6f      item_data_no
-0000ca70: 6e65 5f63 6f72 6520 3d20 7365 6c66 2e5f  ne_core = self._
-0000ca80: 6765 745f 6974 656d 5f64 6174 615f 6672  get_item_data_fr
-0000ca90: 6f6d 5f69 6e74 6572 6d65 6469 6174 655f  om_intermediate_
-0000caa0: 6669 6c65 735f 6e6f 6e65 5f63 6f72 6528  files_none_core(
-0000cab0: 290a 2020 2020 2020 2020 2370 7072 696e  ).        #pprin
-0000cac0: 7428 6974 656d 5f64 6174 615f 6e6f 6e65  t(item_data_none
-0000cad0: 5f63 6f72 6529 0a20 2020 2020 2020 2023  _core).        #
-0000cae0: 7070 7269 6e74 2869 7465 6d5f 6461 7461  pprint(item_data
-0000caf0: 5f63 6f72 6529 0a20 2020 2020 2020 2069  _core).        i
-0000cb00: 7465 6d5f 6461 7461 203d 2069 7465 6d5f  tem_data = item_
-0000cb10: 6461 7461 5f63 6f72 650a 2020 2020 2020  data_core.      
-0000cb20: 2020 6c6f 6720 3d20 6d69 7174 632e 7265    log = miqtc.re
-0000cb30: 6375 7273 6976 656c 7955 7064 6174 6544  cursivelyUpdateD
-0000cb40: 6963 7473 2869 7465 6d5f 6461 7461 2c20  icts(item_data, 
-0000cb50: 6974 656d 5f64 6174 615f 6e6f 6e65 5f63  item_data_none_c
-0000cb60: 6f72 6529 0a20 2020 2020 2020 2023 7070  ore).        #pp
-0000cb70: 7269 6e74 2869 7465 6d5f 6461 7461 290a  rint(item_data).
-0000cb80: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-0000cb90: 762e 6c6f 6728 6c6f 672c 646f 6e74 5368  v.log(log,dontSh
-0000cba0: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
-0000cbb0: 2072 6574 7572 6e20 6974 656d 5f64 6174   return item_dat
-0000cbc0: 610a 0a20 2020 2064 6566 205f 6765 745f  a..    def _get_
-0000cbd0: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
-0000cbe0: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
-0000cbf0: 735f 6e6f 6e65 5f63 6f72 6528 7365 6c66  s_none_core(self
-0000cc00: 293a 0a20 2020 2020 2020 2022 2222 2052  ):.        """ R
-0000cc10: 6561 6420 6461 7461 2066 726f 6d20 6e6f  ead data from no
-0000cc20: 6e2d 636f 7265 2069 6e74 6572 6d64 6561  n-core intermdea
-0000cc30: 7465 2066 696c 6573 2e0a 2020 2020 2020  te files..      
-0000cc40: 2020 5265 7475 726e 7320 6469 6374 206f    Returns dict o
-0000cc50: 6620 666f 726d 207b 696d 6167 652d 6669  f form {image-fi
-0000cc60: 6c65 2d6e 616d 653a 7b66 6965 6c64 3a76  le-name:{field:v
-0000cc70: 616c 7565 7d2c 2e2e 2e7d 200a 2020 2020  alue},...} .    
-0000cc80: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000cc90: 7265 7120 3d20 7365 6c66 2e6e 6f6e 436f  req = self.nonCo
-0000cca0: 7265 4669 656c 6449 6e74 6572 6d65 6469  reFieldIntermedi
-0000ccb0: 6174 6549 7465 6d49 6e66 6f46 696c 6573  ateItemInfoFiles
-0000ccc0: 0a0a 2020 2020 2020 2020 6974 656d 5f64  ..        item_d
-0000ccd0: 6174 6120 3d20 7b7d 0a20 2020 2020 2020  ata = {}.       
-0000cce0: 2066 6f72 2072 2069 6e20 7265 713a 0a20   for r in req:. 
-0000ccf0: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
-0000cd00: 2e70 6174 682e 6578 6973 7473 2872 2e66  .path.exists(r.f
-0000cd10: 696c 654e 616d 6529 3a0a 2020 2020 2020  ileName):.      
-0000cd20: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000cd30: 7261 7365 4974 656d 4461 7461 4672 6f6d  raseItemDataFrom
-0000cd40: 4669 6c65 2869 7465 6d5f 6461 7461 2c72  File(item_data,r
-0000cd50: 2e66 696c 654e 616d 652c 722e 7365 7061  .fileName,r.sepa
-0000cd60: 7261 746f 722c 722e 6865 6164 6572 2c20  rator,r.header, 
-0000cd70: 722e 6461 7465 7469 6d65 5f66 6f72 6d61  r.datetime_forma
-0000cd80: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-0000cd90: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0000cda0: 2822 5061 7273 6564 2069 7465 6d20 6461  ("Parsed item da
-0000cdb0: 7461 2066 726f 6d3a 2022 202b 2072 2e66  ta from: " + r.f
-0000cdc0: 696c 654e 616d 6529 0a20 2020 2020 2020  ileName).       
-0000cdd0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000cde0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000cdf0: 7072 6f76 2e6c 6f67 2822 4669 6c65 2064  prov.log("File d
-0000ce00: 6f65 7320 6e6f 7420 6578 6973 7473 3a20  oes not exists: 
-0000ce10: 2220 2b20 722e 6669 6c65 4e61 6d65 290a  " + r.fileName).
-0000ce20: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
-0000ce30: 2066 696c 6573 2065 7869 7374 0a20 2020   files exist.   
-0000ce40: 2020 2020 2072 656d 6f76 6520 3d20 5b5d       remove = []
-0000ce50: 0a20 2020 2020 2020 2066 6f72 2069 6d67  .        for img
-0000ce60: 2069 6e20 6974 656d 5f64 6174 613a 0a20   in item_data:. 
-0000ce70: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000ce80: 7420 696d 6720 696e 2073 656c 662e 5f69  t img in self._i
-0000ce90: 6d61 6765 4e61 6d65 7349 6d61 6765 7344  mageNamesImagesD
-0000cea0: 6972 3a0a 2020 2020 2020 2020 2020 2020  ir:.            
-0000ceb0: 2020 2020 7265 6d6f 7665 2e61 7070 656e      remove.appen
-0000cec0: 6428 696d 6729 0a20 2020 2020 2020 2066  d(img).        f
-0000ced0: 6f72 2069 6d67 2069 6e20 7265 6d6f 7665  or img in remove
-0000cee0: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
-0000cef0: 6c20 6974 656d 5f64 6174 615b 696d 675d  l item_data[img]
-0000cf00: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000cf10: 2069 7465 6d5f 6461 7461 0a0a 0a20 2020   item_data...   
-0000cf20: 2064 6566 205f 6765 745f 6974 656d 5f64   def _get_item_d
-0000cf30: 6174 615f 6672 6f6d 5f69 6e74 6572 6d65  ata_from_interme
-0000cf40: 6469 6174 655f 6669 6c65 735f 636f 7265  diate_files_core
-0000cf50: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000cf60: 2222 2220 5265 6164 2064 6174 6120 6672  """ Read data fr
-0000cf70: 6f6d 2063 6f72 6520 696e 7465 726d 6465  om core intermde
-0000cf80: 6174 6520 6669 6c65 732c 2063 6865 636b  ate files, check
-0000cf90: 2066 696c 6573 2065 7869 7374 2c20 6164   files exist, ad
-0000cfa0: 6420 2769 6d61 6765 2d68 616e 646c 6527  d 'image-handle'
-0000cfb0: 2e0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-0000cfc0: 7320 6469 6374 206f 6620 666f 726d 207b  s dict of form {
-0000cfd0: 696d 6167 652d 6669 6c65 2d6e 616d 653a  image-file-name:
-0000cfe0: 7b66 6965 6c64 3a76 616c 7565 7d2c 2e2e  {field:value},..
-0000cff0: 2e7d 200a 2020 2020 2020 2020 2222 220a  .} .        """.
-0000d000: 0a20 2020 2020 2020 2023 2057 6869 6368  .        # Which
-0000d010: 2066 696c 6573 2063 6f6e 7461 696e 2074   files contain t
-0000d020: 6865 2069 6e66 6f72 6d61 7469 6f6e 206e  he information n
-0000d030: 6565 6465 6420 746f 2063 7265 6174 6520  eeded to create 
-0000d040: 7468 6520 6946 444f 2069 7465 6d73 2063  the iFDO items c
-0000d050: 6f72 6520 696e 666f 726d 6174 696f 6e20  ore information 
-0000d060: 616e 6420 7768 6963 6820 636f 6c75 6d6e  and which column
-0000d070: 7320 7368 616c 6c20 6265 2075 7365 640a  s shall be used.
-0000d080: 2020 2020 2020 2020 7265 7120 3d20 7365          req = se
-0000d090: 6c66 2e69 6e74 6572 6d65 6469 6174 6546  lf.intermediateF
-0000d0a0: 696c 6573 4465 665f 636f 7265 0a0a 2020  ilesDef_core..  
-0000d0b0: 2020 2020 2020 6974 656d 5f64 6174 6120        item_data 
-0000d0c0: 3d20 7b7d 0a20 2020 2020 2020 2070 726f  = {}.        pro
-0000d0d0: 6720 3d20 6d69 7174 632e 5072 696e 744b  g = miqtc.PrintK
-0000d0e0: 6e6f 776e 5072 6f67 7265 7373 4d73 6728  nownProgressMsg(
-0000d0f0: 2250 6172 7369 6e67 2069 6e74 6572 6d65  "Parsing interme
-0000d100: 6469 6174 6520 6461 7461 222c 206c 656e  diate data", len
-0000d110: 2872 6571 2929 0a20 2020 2020 2020 2066  (req)).        f
-0000d120: 6f72 2072 2069 6e20 7265 713a 0a20 2020  or r in req:.   
-0000d130: 2020 2020 2020 2020 2070 726f 672e 7072           prog.pr
-0000d140: 6f67 7265 7373 2829 0a20 2020 2020 2020  ogress().       
-0000d150: 2020 2020 2066 696c 6520 3d20 7365 6c66       file = self
-0000d160: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
-0000d170: 7072 6566 6978 2829 202b 2072 6571 5b72  prefix() + req[r
-0000d180: 5d5b 2773 7566 6669 7827 5d0a 2020 2020  ]['suffix'].    
-0000d190: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-0000d1a0: 732e 7061 7468 2e65 7869 7374 7328 6669  s.path.exists(fi
-0000d1b0: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-0000d1c0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-0000d1d0: 6f67 2822 5741 524e 494e 4721 2046 6f72  og("WARNING! For
-0000d1e0: 2061 6368 6965 7669 6e67 2046 4149 526e   achieving FAIRn
-0000d1f0: 6573 7320 616e 2069 6e74 6572 6d65 6469  ess an intermedi
-0000d200: 6174 6520 696d 6167 6520 696e 666f 2066  ate image info f
-0000d210: 696c 6520 6973 206d 6973 7369 6e67 3a20  ile is missing: 
-0000d220: 222b 2073 656c 662e 5f5f 6765 745f 696e  "+ self.__get_in
-0000d230: 745f 6669 6c65 5f70 7265 6669 7828 2920  t_file_prefix() 
-0000d240: 2b20 7265 715b 725d 5b27 7375 6666 6978  + req[r]['suffix
-0000d250: 275d 2b20 2220 7275 6e20 6669 7273 743a  ']+ " run first:
-0000d260: 2022 202b 2072 6571 5b72 5d5b 2763 7265   " + req[r]['cre
-0000d270: 6174 696f 6e46 6374 275d 290a 2020 2020  ationFct']).    
-0000d280: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000d290: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000d2a0: 6c66 2e70 6172 7365 4974 656d 4461 7461  lf.parseItemData
-0000d2b0: 6672 6f6d 5461 6246 696c 6544 6174 6128  fromTabFileData(
-0000d2c0: 6974 656d 5f64 6174 612c 2066 696c 652c  item_data, file,
-0000d2d0: 2072 6571 5b72 5d5b 2763 6f6c 7327 5d2c   req[r]['cols'],
-0000d2e0: 2072 6571 5b72 5d5b 276f 7074 696f 6e61   req[r]['optiona
-0000d2f0: 6c27 5d29 0a20 2020 2020 2020 2020 2020  l']).           
-0000d300: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-0000d310: 6f67 2822 5061 7273 6564 2069 7465 6d20  og("Parsed item 
-0000d320: 6461 7461 2066 726f 6d3a 2022 202b 2066  data from: " + f
-0000d330: 696c 6529 0a0a 2020 2020 2020 2020 7072  ile)..        pr
-0000d340: 6f67 2e63 6c65 6172 2829 0a20 2020 2020  og.clear().     
-0000d350: 2020 2069 6620 6c65 6e28 6974 656d 5f64     if len(item_d
-0000d360: 6174 6129 203d 3d20 303a 0a20 2020 2020  ata) == 0:.     
-0000d370: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-0000d380: 6570 7469 6f6e 2822 4e6f 2069 4644 4f20  eption("No iFDO 
-0000d390: 6974 656d 7322 290a 0a20 2020 2020 2020  items")..       
-0000d3a0: 2023 2063 6865 636b 2066 696c 6573 2065   # check files e
-0000d3b0: 7869 7374 0a20 2020 2020 2020 2072 656d  xist.        rem
-0000d3c0: 6f76 6520 3d20 5b5d 0a20 2020 2020 2020  ove = [].       
-0000d3d0: 2066 6f72 2069 6d67 2069 6e20 6974 656d   for img in item
-0000d3e0: 5f64 6174 613a 0a20 2020 2020 2020 2020  _data:.         
-0000d3f0: 2020 2069 6620 6e6f 7420 696d 6720 696e     if not img in
-0000d400: 2073 656c 662e 5f69 6d61 6765 4e61 6d65   self._imageName
-0000d410: 7349 6d61 6765 7344 6972 3a0a 2020 2020  sImagesDir:.    
-0000d420: 2020 2020 2020 2020 2020 2020 7265 6d6f              remo
-0000d430: 7665 2e61 7070 656e 6428 696d 6729 0a20  ve.append(img). 
-0000d440: 2020 2020 2020 2066 6f72 2069 6d67 2069         for img i
-0000d450: 6e20 7265 6d6f 7665 3a0a 2020 2020 2020  n remove:.      
-0000d460: 2020 2020 2020 6465 6c20 6974 656d 5f64        del item_d
-0000d470: 6174 615b 696d 675d 0a0a 2020 2020 2020  ata[img]..      
-0000d480: 2020 2320 6164 6420 696d 6167 652d 7572    # add image-ur
-0000d490: 6c0a 2020 2020 2020 2020 666f 7220 696d  l.        for im
-0000d4a0: 6720 696e 2069 7465 6d5f 6461 7461 3a0a  g in item_data:.
-0000d4b0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0000d4c0: 7369 6e73 7461 6e63 6528 6974 656d 5f64  sinstance(item_d
-0000d4d0: 6174 615b 696d 675d 2c6c 6973 7429 3a20  ata[img],list): 
-0000d4e0: 2320 6974 656d 2069 7320 616c 7265 6164  # item is alread
-0000d4f0: 7920 6120 6c69 7374 2028 7669 6465 6f29  y a list (video)
-0000d500: 2062 7574 2070 6172 7365 6420 6461 7461   but parsed data
-0000d510: 2069 7320 6e6f 742c 2069 2e65 2e20 7061   is not, i.e. pa
-0000d520: 7273 6564 2064 6174 6120 7265 6665 7273  rsed data refers
-0000d530: 2074 6f20 7768 6f6c 6520 7669 6465 6f20   to whole video 
-0000d540: 2874 696d 6520 696e 6465 7065 6e64 656e  (time independen
-0000d550: 7429 2c20 692e 652e 2077 7269 7465 2074  t), i.e. write t
-0000d560: 6f20 6669 7273 7420 656e 7472 790a 2020  o first entry.  
-0000d570: 2020 2020 2020 2020 2020 2020 2020 7575                uu
-0000d580: 6964 203d 2066 696e 6446 6965 6c64 2869  id = findField(i
-0000d590: 7465 6d5f 6461 7461 5b69 6d67 5d5b 305d  tem_data[img][0]
-0000d5a0: 2c27 696d 6167 652d 7575 6964 2729 0a20  ,'image-uuid'). 
-0000d5b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000d5c0: 6620 7575 6964 203d 3d20 2222 3a0a 2020  f uuid == "":.  
-0000d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5e0: 2020 7072 696e 7428 6974 656d 5f64 6174    print(item_dat
-0000d5f0: 615b 696d 675d 290a 2020 2020 2020 2020  a[img]).        
-0000d600: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000d610: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
-0000d620: 7074 696f 6e28 2275 7569 6420 6e6f 7420  ption("uuid not 
-0000d630: 666f 756e 6420 2861 2922 290a 2020 2020  found (a)").    
-0000d640: 2020 2020 2020 2020 2020 2020 6974 656d              item
-0000d650: 5f64 6174 615b 696d 675d 5b30 5d5b 2769  _data[img][0]['i
-0000d660: 6d61 6765 2d68 616e 646c 6527 5d20 3d20  mage-handle'] = 
-0000d670: 7365 6c66 2e69 6d61 6765 5f68 616e 646c  self.image_handl
-0000d680: 655f 7072 6566 6978 202b 2027 4027 202b  e_prefix + '@' +
-0000d690: 2075 7569 640a 2020 2020 2020 2020 2020   uuid.          
-0000d6a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000d6b0: 2020 2020 2020 2020 7575 6964 203d 2066          uuid = f
-0000d6c0: 696e 6446 6965 6c64 2869 7465 6d5f 6461  indField(item_da
-0000d6d0: 7461 5b69 6d67 5d2c 2769 6d61 6765 2d75  ta[img],'image-u
-0000d6e0: 7569 6427 290a 2020 2020 2020 2020 2020  uid').          
-0000d6f0: 2020 2020 2020 6966 2075 7569 6420 3d3d        if uuid ==
-0000d700: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-0000d710: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-0000d720: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-0000d730: 6f6e 2822 7575 6964 206e 6f74 2066 6f75  on("uuid not fou
-0000d740: 6e64 2028 6229 2229 0a20 2020 2020 2020  nd (b)").       
-0000d750: 2020 2020 2020 2020 2069 7465 6d5f 6461           item_da
-0000d760: 7461 5b69 6d67 5d5b 2769 6d61 6765 2d68  ta[img]['image-h
-0000d770: 616e 646c 6527 5d20 3d20 7365 6c66 2e69  andle'] = self.i
-0000d780: 6d61 6765 5f68 616e 646c 655f 7072 6566  mage_handle_pref
-0000d790: 6978 202b 2027 4027 202b 2075 7569 640a  ix + '@' + uuid.
-0000d7a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000d7b0: 6974 656d 5f64 6174 610a 0a0a 2020 2020  item_data...    
-0000d7c0: 6465 6620 6164 645f 6974 656d 5f69 6e66  def add_item_inf
-0000d7d0: 6f5f 7461 625f 6669 6c65 2873 656c 662c  o_tab_file(self,
-0000d7e0: 2066 696c 654e 616d 653a 2073 7472 2c20   fileName: str, 
-0000d7f0: 7365 7061 7261 746f 723a 7374 722c 2068  separator:str, h
-0000d800: 6561 6465 723a 6469 6374 2c20 6461 7465  eader:dict, date
-0000d810: 7469 6d65 5f66 6f72 6d61 7420 3d20 6d69  time_format = mi
-0000d820: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
-0000d830: 5b27 6d61 7269 7174 275d 293a 0a20 2020  ['mariqt']):.   
-0000d840: 2020 2020 2022 2222 2041 6464 2061 2063       """ Add a c
-0000d850: 6f6c 756d 6e20 7365 7065 7261 7465 6420  olumn seperated 
-0000d860: 7465 7874 2066 696c 6520 746f 2070 6172  text file to par
-0000d870: 7365 2069 7465 6d20 6461 7461 2066 726f  se item data fro
-0000d880: 6d20 6279 2063 7265 6174 6543 6170 7475  m by createCaptu
-0000d890: 7265 416e 6443 6f6e 7465 6e74 4669 656c  reAndContentFiel
-0000d8a0: 6473 2829 2e20 0a20 2020 2020 2020 2043  ds(). .        C
-0000d8b0: 6f6c 756d 6e73 2068 6561 6465 7273 2077  olumns headers w
-0000d8c0: 696c 6c20 6265 2073 6574 2061 7320 6974  ill be set as it
-0000d8d0: 656d 2066 6965 6c64 206e 616d 6573 2e20  em field names. 
-0000d8e0: 4d75 7374 2063 6f6e 7461 696e 2063 6f6c  Must contain col
-0000d8f0: 756d 6e20 2769 6d61 6765 2d66 696c 656e  umn 'image-filen
-0000d900: 616d 6527 2e0a 2020 2020 2020 2020 2222  ame'..        ""
-0000d910: 220a 2020 2020 2020 2020 6966 2066 696c  ".        if fil
-0000d920: 654e 616d 6520 3d3d 204e 6f6e 6520 6f72  eName == None or
-0000d930: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
-0000d940: 7374 7328 6669 6c65 4e61 6d65 293a 0a20  sts(fileName):. 
-0000d950: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000d960: 2045 7863 6570 7469 6f6e 2822 4669 6c65   Exception("File
-0000d970: 222c 6669 6c65 4e61 6d65 2c22 6e6f 7420  ",fileName,"not 
-0000d980: 666f 756e 6422 290a 0a20 2020 2020 2020  found")..       
-0000d990: 2066 6f72 2066 6965 6c64 2069 6e20 6865   for field in he
-0000d9a0: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
-0000d9b0: 2020 6966 2068 6561 6465 725b 6669 656c    if header[fiel
-0000d9c0: 645d 206e 6f74 2069 6e20 6d69 7174 662e  d] not in miqtf.
-0000d9d0: 7461 6246 696c 6543 6f6c 756d 6e4e 616d  tabFileColumnNam
-0000d9e0: 6573 2866 696c 654e 616d 652c 636f 6c5f  es(fileName,col_
-0000d9f0: 7365 7061 7261 746f 723d 7365 7061 7261  separator=separa
-0000da00: 746f 7229 3a0a 2020 2020 2020 2020 2020  tor):.          
-0000da10: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-0000da20: 7074 696f 6e28 2243 6f6c 756d 6e22 2c20  ption("Column", 
-0000da30: 6865 6164 6572 5b66 6965 6c64 5d2c 2022  header[field], "
-0000da40: 6e6f 7420 696e 2066 696c 6522 2c20 6669  not in file", fi
-0000da50: 6c65 4e61 6d65 290a 0a20 2020 2020 2020  leName)..       
-0000da60: 2069 6620 6d69 7174 632e 6173 7365 7274   if miqtc.assert
-0000da70: 536c 6173 6828 6f73 2e70 6174 682e 6469  Slash(os.path.di
-0000da80: 726e 616d 6528 6669 6c65 4e61 6d65 2929  rname(fileName))
-0000da90: 2021 3d20 6d69 7174 632e 6173 7365 7274   != miqtc.assert
-0000daa0: 536c 6173 6828 7365 6c66 2e64 6972 2e74  Slash(self.dir.t
-0000dab0: 6f28 7365 6c66 2e64 6972 2e64 742e 696e  o(self.dir.dt.in
-0000dac0: 7465 726d 6564 6961 7465 2929 3a0a 2020  termediate)):.  
-0000dad0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000dae0: 726f 762e 6c6f 6728 2022 4361 7574 696f  rov.log( "Cautio
-0000daf0: 6e3a 2049 7420 6973 2072 6563 6f6d 6d65  n: It is recomme
-0000db00: 6e64 6564 2074 6f20 7075 7420 6669 6c65  nded to put file
-0000db10: 2069 6e20 7468 6520 6469 7265 6374 6f72   in the director
-0000db20: 7927 7320 2769 6e74 6572 6d65 6469 6174  y's 'intermediat
-0000db30: 6527 2066 6f6c 6465 723a 2022 202b 2066  e' folder: " + f
-0000db40: 696c 654e 616d 6529 0a20 2020 2020 2020  ileName).       
-0000db50: 206e 6366 6969 6620 3d20 6e6f 6e43 6f72   ncfiif = nonCor
-0000db60: 6546 6965 6c64 496e 7465 726d 6564 6961  eFieldIntermedia
-0000db70: 7465 4974 656d 496e 666f 4669 6c65 2866  teItemInfoFile(f
-0000db80: 696c 654e 616d 652c 2073 6570 6172 6174  ileName, separat
-0000db90: 6f72 2c20 6865 6164 6572 2c20 6461 7465  or, header, date
-0000dba0: 7469 6d65 5f66 6f72 6d61 7429 0a20 2020  time_format).   
-0000dbb0: 2020 2020 2069 6620 6e63 6669 6966 206e       if ncfiif n
-0000dbc0: 6f74 2069 6e20 7365 6c66 2e6e 6f6e 436f  ot in self.nonCo
-0000dbd0: 7265 4669 656c 6449 6e74 6572 6d65 6469  reFieldIntermedi
-0000dbe0: 6174 6549 7465 6d49 6e66 6f46 696c 6573  ateItemInfoFiles
-0000dbf0: 3a20 0a20 2020 2020 2020 2020 2020 2073  : .            s
-0000dc00: 656c 662e 6e6f 6e43 6f72 6546 6965 6c64  elf.nonCoreField
-0000dc10: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
-0000dc20: 496e 666f 4669 6c65 732e 6170 7065 6e64  InfoFiles.append
-0000dc30: 286e 6366 6969 6629 0a0a 2020 2020 6465  (ncfiif)..    de
-0000dc40: 6620 6164 6449 7465 6d49 6e66 6f54 6162  f addItemInfoTab
-0000dc50: 4669 6c65 2873 656c 662c 2066 696c 654e  File(self, fileN
-0000dc60: 616d 653a 2073 7472 2c20 7365 7061 7261  ame: str, separa
-0000dc70: 746f 723a 7374 722c 2068 6561 6465 723a  tor:str, header:
-0000dc80: 6469 6374 2c20 6461 7465 7469 6d65 5f66  dict, datetime_f
-0000dc90: 6f72 6d61 7420 3d20 6d69 7174 762e 6461  ormat = miqtv.da
-0000dca0: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
-0000dcb0: 7174 275d 293a 0a20 2020 2020 2020 2022  qt']):.        "
-0000dcc0: 2222 2044 6570 7265 6361 7465 6420 2d20  "" Deprecated - 
-0000dcd0: 7573 6520 6164 645f 6974 656d 5f69 6e66  use add_item_inf
-0000dce0: 6f5f 7461 625f 6669 6c65 2022 2222 0a20  o_tab_file """. 
-0000dcf0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-0000dd00: 6974 656d 5f69 6e66 6f5f 7461 625f 6669  item_info_tab_fi
-0000dd10: 6c65 2866 696c 654e 616d 652c 7365 7061  le(fileName,sepa
-0000dd20: 7261 746f 722c 6865 6164 6572 2c64 6174  rator,header,dat
-0000dd30: 6574 696d 655f 666f 726d 6174 290a 0a20  etime_format).. 
-0000dd40: 2020 2020 2020 200a 2020 2020 6465 6620         .    def 
-0000dd50: 7265 6d6f 7665 4974 656d 496e 666f 5461  removeItemInfoTa
-0000dd60: 6246 696c 6528 7365 6c66 2c20 6669 6c65  bFile(self, file
-0000dd70: 4e61 6d65 3a20 7374 722c 2073 6570 6172  Name: str, separ
-0000dd80: 6174 6f72 3a73 7472 2c20 6865 6164 6572  ator:str, header
-0000dd90: 3a64 6963 742c 2064 6174 6574 696d 655f  :dict, datetime_
-0000dda0: 666f 726d 6174 3a73 7472 293a 0a20 2020  format:str):.   
-0000ddb0: 2020 2020 2022 2222 2072 656d 6f76 6573       """ removes
-0000ddc0: 2066 696c 6520 6974 656d 2066 726f 6d20   file item from 
-0000ddd0: 6c69 7374 206f 6620 6669 6c65 7320 746f  list of files to
-0000dde0: 2070 6172 7365 2069 7465 6d20 6461 7461   parse item data
-0000ddf0: 2066 726f 6d20 6279 2063 7265 6174 6543   from by createC
-0000de00: 6170 7475 7265 416e 6443 6f6e 7465 6e74  aptureAndContent
-0000de10: 4669 656c 6473 2829 2022 2222 0a20 2020  Fields() """.   
-0000de20: 2020 2020 206e 6366 6969 6620 3d20 6e6f       ncfiif = no
-0000de30: 6e43 6f72 6546 6965 6c64 496e 7465 726d  nCoreFieldInterm
-0000de40: 6564 6961 7465 4974 656d 496e 666f 4669  ediateItemInfoFi
-0000de50: 6c65 2866 696c 654e 616d 652c 2073 6570  le(fileName, sep
-0000de60: 6172 6174 6f72 2c20 6865 6164 6572 2c20  arator, header, 
-0000de70: 6461 7465 7469 6d65 5f66 6f72 6d61 7429  datetime_format)
-0000de80: 0a20 2020 2020 2020 2069 6620 6e63 6669  .        if ncfi
-0000de90: 6966 2069 6e20 7365 6c66 2e6e 6f6e 436f  if in self.nonCo
-0000dea0: 7265 4669 656c 6449 6e74 6572 6d65 6469  reFieldIntermedi
-0000deb0: 6174 6549 7465 6d49 6e66 6f46 696c 6573  ateItemInfoFiles
-0000dec0: 3a20 0a20 2020 2020 2020 2020 2020 2073  : .            s
-0000ded0: 656c 662e 6e6f 6e43 6f72 6546 6965 6c64  elf.nonCoreField
-0000dee0: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
-0000def0: 496e 666f 4669 6c65 732e 7265 6d6f 7665  InfoFiles.remove
-0000df00: 286e 6366 6969 6629 0a0a 0a20 2020 2064  (ncfiif)...    d
-0000df10: 6566 2075 7064 6174 6569 4644 4f28 7365  ef updateiFDO(se
-0000df20: 6c66 2c20 6865 6164 6572 3a20 6469 6374  lf, header: dict
-0000df30: 2c20 6974 656d 733a 206c 6973 7429 3a0a  , items: list):.
-0000df40: 2020 2020 2020 2020 2222 2220 5570 6461          """ Upda
-0000df50: 7465 7320 7468 6520 6375 7272 656e 7420  tes the current 
-0000df60: 7661 6c75 6573 2069 4644 4f20 7769 7468  values iFDO with
-0000df70: 2074 6865 2070 726f 7669 6465 6420 6e65   the provided ne
-0000df80: 7720 7661 6c75 6573 2022 2222 0a20 2020  w values """.   
-0000df90: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000dfa0: 2e63 7265 6174 6569 4644 4f28 6865 6164  .createiFDO(head
-0000dfb0: 6572 2c20 6974 656d 732c 2075 7064 6174  er, items, updat
-0000dfc0: 6545 7869 7374 696e 673d 5472 7565 290a  eExisting=True).
-0000dfd0: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
-0000dfe0: 6946 444f 2873 656c 662c 2068 6561 6465  iFDO(self, heade
-0000dff0: 723a 2064 6963 742c 2069 7465 6d73 3a20  r: dict, items: 
-0000e000: 6c69 7374 2c20 7570 6461 7465 4578 6973  list, updateExis
-0000e010: 7469 6e67 3d46 616c 7365 2c68 6561 6465  ting=False,heade
-0000e020: 724f 6e6c 793d 4661 6c73 652c 616c 6c6f  rOnly=False,allo
-0000e030: 775f 6d69 7373 696e 675f 7265 7175 6972  w_missing_requir
-0000e040: 6564 3d46 616c 7365 293a 0a20 2020 2020  ed=False):.     
-0000e050: 2020 2022 2222 2043 7265 6174 6573 2046     """ Creates F
-0000e060: 4149 5220 6469 6769 7461 6c20 6f62 6a65  AIR digital obje
-0000e070: 6374 2066 6f72 2074 6865 2069 6d61 6765  ct for the image
-0000e080: 2064 6174 6120 6974 7365 6c66 2e20 5468   data itself. Th
-0000e090: 6973 2063 6f6e 7369 7374 7320 6f66 2068  is consists of h
-0000e0a0: 6561 6465 7220 696e 666f 726d 6174 696f  eader informatio
-0000e0b0: 6e20 616e 6420 6974 656d 2069 6e66 6f72  n and item infor
-0000e0c0: 6d61 7469 6f6e 2e0a 2020 2020 2020 2020  mation..        
-0000e0d0: 7570 6461 7465 4578 6973 7469 6e67 3a20  updateExisting: 
-0000e0e0: 6966 2046 616c 7365 206f 6c64 2076 616c  if False old val
-0000e0f0: 7565 7320 6172 6520 7265 6d6f 7665 642c  ues are removed,
-0000e100: 206f 7468 6572 7769 7365 2074 6865 7920   otherwise they 
-0000e110: 6172 6520 7570 6461 7465 642e 0a20 2020  are updated..   
-0000e120: 2020 2020 2068 6561 6465 724f 6e6c 793a       headerOnly:
-0000e130: 2069 6620 5472 7565 2069 7465 6d73 206d   if True items m
-0000e140: 6179 2062 6520 656d 7074 7920 6c69 7374  ay be empty list
-0000e150: 2e0a 2020 2020 2020 2020 616c 6c6f 775f  ..        allow_
-0000e160: 6d69 7373 696e 675f 7265 7175 6972 6564  missing_required
-0000e170: 3a20 6966 2054 7275 652c 206e 6f20 6578  : if True, no ex
-0000e180: 6365 7074 696f 6e20 7269 7365 6e20 6966  ception risen if
-0000e190: 2061 2072 6571 7569 7265 6420 6669 656c   a required fiel
-0000e1a0: 6420 6973 206d 6973 7369 6e67 2e20 2022  d is missing.  "
-0000e1b0: 2222 0a0a 2020 2020 2020 2020 6966 206e  ""..        if n
-0000e1c0: 6f74 2075 7064 6174 6545 7869 7374 696e  ot updateExistin
-0000e1d0: 6720 616e 6420 6c65 6e28 6974 656d 7329  g and len(items)
-0000e1e0: 203d 3d20 3020 616e 6420 6e6f 7420 6865   == 0 and not he
-0000e1f0: 6164 6572 4f6e 6c79 3a0a 2020 2020 2020  aderOnly:.      
-0000e200: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-0000e210: 7074 696f 6e28 274e 6f20 6974 656d 2069  ption('No item i
-0000e220: 6e66 6f72 6d61 7469 6f6e 2067 6976 656e  nformation given
-0000e230: 2729 0a0a 2020 2020 2020 2020 6966 2075  ')..        if u
-0000e240: 7064 6174 6545 7869 7374 696e 673a 0a20  pdateExisting:. 
-0000e250: 2020 2020 2020 2020 2020 2023 2068 6561             # hea
-0000e260: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
-0000e270: 7365 6c66 2e75 7064 6174 655f 6966 646f  self.update_ifdo
-0000e280: 5f68 6561 6465 725f 6669 656c 6473 2868  _header_fields(h
-0000e290: 6561 6465 7229 0a20 2020 2020 2020 2020  eader).         
-0000e2a0: 2020 2023 2069 7465 6d73 0a20 2020 2020     # items.     
-0000e2b0: 2020 2020 2020 2023 2075 7064 6174 6520         # update 
-0000e2c0: 636f 7079 206f 6620 6375 7272 656e 7420  copy of current 
-0000e2d0: 6974 656d 7320 7769 7468 206e 6577 2069  items with new i
-0000e2e0: 7465 6d73 2066 6965 6c64 730a 2020 2020  tems fields.    
-0000e2f0: 2020 2020 2020 2020 6974 656d 7344 6963          itemsDic
-0000e300: 7420 3d20 6d69 7174 692e 6372 6561 7465  t = miqti.create
-0000e310: 496d 6167 6549 7465 6d73 4469 6374 4672  ImageItemsDictFr
-0000e320: 6f6d 496d 6167 6549 7465 6d73 4c69 7374  omImageItemsList
-0000e330: 2869 7465 6d73 290a 2020 2020 2020 2020  (items).        
-0000e340: 2020 2020 7570 6461 7465 6449 7465 6d73      updatedItems
-0000e350: 5f63 6f70 7920 3d20 636f 7079 2e64 6565  _copy = copy.dee
-0000e360: 7063 6f70 7928 7365 6c66 2e69 6664 6f5f  pcopy(self.ifdo_
-0000e370: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-0000e380: 7449 7465 6d73 4b65 795d 290a 2020 2020  tItemsKey]).    
-0000e390: 2020 2020 2020 2020 6c6f 6720 3d20 6d69          log = mi
-0000e3a0: 7174 632e 7265 6375 7273 6976 656c 7955  qtc.recursivelyU
-0000e3b0: 7064 6174 6544 6963 7473 2875 7064 6174  pdateDicts(updat
-0000e3c0: 6564 4974 656d 735f 636f 7079 2c20 6974  edItems_copy, it
-0000e3d0: 656d 7344 6963 7429 0a20 2020 2020 2020  emsDict).       
-0000e3e0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-0000e3f0: 6f67 286c 6f67 2c64 6f6e 7453 686f 773d  og(log,dontShow=
-0000e400: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-0000e410: 2020 6974 656d 7320 3d20 6d69 7174 692e    items = miqti.
-0000e420: 6372 6561 7465 496d 6167 6549 7465 6d73  createImageItems
-0000e430: 4c69 7374 4672 6f6d 496d 6167 6549 7465  ListFromImageIte
-0000e440: 6d73 4469 6374 2875 7064 6174 6564 4974  msDict(updatedIt
-0000e450: 656d 735f 636f 7079 290a 0a20 2020 2020  ems_copy)..     
-0000e460: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000e470: 2020 2020 2023 206f 7665 7277 7269 7465       # overwrite
-0000e480: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
-0000e490: 2020 2020 7365 6c66 2e73 6574 6946 444f      self.setiFDO
-0000e4a0: 4865 6164 6572 4669 656c 6473 2868 6561  HeaderFields(hea
-0000e4b0: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
-0000e4c0: 2023 2063 6c65 6172 2069 7465 6d73 2073   # clear items s
-0000e4d0: 6563 7469 6f6e 0a20 2020 2020 2020 2020  ection.         
-0000e4e0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0000e4f0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
-0000e500: 656d 734b 6579 5d20 3d20 7b7d 0a0a 0a20  emsKey] = {}... 
-0000e510: 2020 2020 2020 2023 2050 6172 7365 2069         # Parse i
-0000e520: 6d61 6765 2d61 6273 7472 6163 7420 616e  mage-abstract an
-0000e530: 6420 6669 6c6c 2069 7473 2070 6c61 6365  d fill its place
-0000e540: 686f 6c64 6572 7320 7769 7468 2069 6e66  holders with inf
-0000e550: 6f72 6d61 7469 6f6e 0a20 2020 2020 2020  ormation.       
-0000e560: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000e570: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
-0000e580: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000e590: 6465 724b 6579 5d5b 2769 6d61 6765 2d61  derKey]['image-a
-0000e5a0: 6273 7472 6163 7427 5d20 3d20 6d69 7174  bstract'] = miqt
-0000e5b0: 732e 7061 7273 6552 6570 6c61 6365 5661  s.parseReplaceVa
-0000e5c0: 6c28 7365 6c66 2e69 6664 6f5f 746d 705b  l(self.ifdo_tmp[
-0000e5d0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000e5e0: 6465 724b 6579 5d2c 2027 696d 6167 652d  derKey], 'image-
-0000e5f0: 6162 7374 7261 6374 2729 0a20 2020 2020  abstract').     
-0000e600: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-0000e610: 696f 6e20 6173 2065 783a 0a20 2020 2020  ion as ex:.     
-0000e620: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0000e630: 2e6c 6f67 2822 436f 756c 6420 6e6f 7420  .log("Could not 
-0000e640: 7265 706c 6163 6520 6b65 7973 2069 6e20  replace keys in 
-0000e650: 5c27 696d 6167 652d 6162 7374 7261 6374  \'image-abstract
-0000e660: 5c27 3a20 2220 2b20 7374 7228 6578 2929  \': " + str(ex))
-0000e670: 0a0a 0a20 2020 2020 2020 2023 2073 6574  ...        # set
-0000e680: 2076 6572 7369 6f6e 2028 736f 2069 7420   version (so it 
-0000e690: 6361 6e6e 6f74 2062 6520 6368 616e 6765  cannot be change
-0000e6a0: 6420 6279 2075 7365 7229 0a20 2020 2020  d by user).     
-0000e6b0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0000e6c0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000e6d0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-0000e6e0: 7365 742d 6966 646f 2d76 6572 7369 6f6e  set-ifdo-version
-0000e6f0: 275d 203d 206d 6971 7476 2e69 4644 4f5f  '] = miqtv.iFDO_
-0000e700: 7665 7273 696f 6e0a 0a20 2020 2020 2020  version..       
-0000e710: 2023 2056 616c 6964 6174 6520 6974 656d   # Validate item
-0000e720: 2069 6e66 6f72 6d61 7469 6f6e 0a20 2020   information.   
-0000e730: 2020 2020 2069 6e76 616c 6964 5f69 7465       invalid_ite
-0000e740: 6d73 203d 2030 0a20 2020 2020 2020 2069  ms = 0.        i
-0000e750: 6d61 6765 5f73 6574 5f69 7465 6d73 203d  mage_set_items =
-0000e760: 207b 7d0a 0a20 2020 2020 2020 2070 726f   {}..        pro
-0000e770: 6720 3d20 6d69 7174 632e 5072 696e 744b  g = miqtc.PrintK
-0000e780: 6e6f 776e 5072 6f67 7265 7373 4d73 6728  nownProgressMsg(
-0000e790: 2243 6865 636b 696e 6720 6974 656d 7322  "Checking items"
-0000e7a0: 2c20 6c65 6e28 6974 656d 7329 2c6d 6f64  , len(items),mod
-0000e7b0: 756c 6f3d 3529 0a20 2020 2020 2020 2066  ulo=5).        f
-0000e7c0: 6f72 2069 7465 6d20 696e 2069 7465 6d73  or item in items
-0000e7d0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-0000e7e0: 6f67 2e70 726f 6772 6573 7328 290a 2020  og.progress().  
-0000e7f0: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
-0000e800: 6b20 6966 2061 6c6c 2063 6f72 6520 6669  k if all core fi
-0000e810: 656c 6473 2061 7265 2066 696c 6c65 6420  elds are filled 
-0000e820: 616e 6420 6172 6520 6669 6c6c 6564 2076  and are filled v
-0000e830: 616c 6964 6c79 0a20 2020 2020 2020 2020  alidly.         
-0000e840: 2020 2074 7279 3a0a 0a20 2020 2020 2020     try:..       
-0000e850: 2020 2020 2020 2020 2023 2063 6865 636b           # check
-0000e860: 2069 7465 6d20 696d 6167 6520 6578 6973   item image exis
-0000e870: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
-0000e880: 2020 2023 2069 6620 6974 656d 2069 7320     # if item is 
-0000e890: 6120 6c69 7374 2028 7669 6465 6f29 2c20  a list (video), 
-0000e8a0: 6f6e 6520 776f 756c 6420 6861 7665 2074  one would have t
-0000e8b0: 6f20 6368 6563 6b20 6966 2065 6163 6820  o check if each 
-0000e8c0: 656e 7472 7920 6973 2076 616c 6964 2067  entry is valid g
-0000e8d0: 6976 656e 2074 6865 2064 6566 6175 6c74  iven the default
-0000e8e0: 2076 616c 7565 7320 696e 2066 6972 7374   values in first
-0000e8f0: 2065 6e74 7279 2070 6c75 7320 6769 7665   entry plus give
-0000e900: 6e20 6465 6661 756c 7420 7661 6c75 6573  n default values
-0000e910: 2069 6e20 6865 6164 6572 0a20 2020 2020   in header.     
-0000e920: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000e930: 7420 6973 696e 7374 616e 6365 2869 7465  t isinstance(ite
-0000e940: 6d2c 6c69 7374 293a 0a20 2020 2020 2020  m,list):.       
-0000e950: 2020 2020 2020 2020 2020 2020 2069 7465               ite
-0000e960: 6d20 3d20 5b69 7465 6d5d 0a20 2020 2020  m = [item].     
-0000e970: 2020 2020 2020 2020 2020 2073 7562 4974             subIt
-0000e980: 656d 4465 6661 756c 7420 3d20 6974 656d  emDefault = item
-0000e990: 5b30 5d20 0a20 2020 2020 2020 2020 2020  [0] .           
-0000e9a0: 2020 2020 2066 6f72 2073 7562 4974 656d       for subItem
-0000e9b0: 2069 6e20 6974 656d 3a0a 2020 2020 2020   in item:.      
-0000e9c0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0000e9d0: 6c65 5f6e 616d 6520 3d20 7375 6249 7465  le_name = subIte
-0000e9e0: 6d5b 2769 6d61 6765 2d66 696c 656e 616d  m['image-filenam
-0000e9f0: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
-0000ea00: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0000ea10: 656c 662e 6967 6e6f 7265 5f69 6d61 6765  elf.ignore_image
-0000ea20: 5f66 696c 6573 2061 6e64 2066 696c 655f  _files and file_
-0000ea30: 6e61 6d65 206e 6f74 2069 6e20 7365 6c66  name not in self
-0000ea40: 2e5f 696d 6167 654e 616d 6573 496d 6167  ._imageNamesImag
-0000ea50: 6573 4469 723a 0a20 2020 2020 2020 2020  esDir:.         
-0000ea60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000ea70: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
-0000ea80: 4974 656d 2027 2220 2b20 6669 6c65 5f6e  Item '" + file_n
-0000ea90: 616d 6520 2b20 2227 206e 6f74 2066 6f75  ame + "' not fou
-0000eaa0: 6e64 2069 6e20 2f72 6177 2064 6972 6563  nd in /raw direc
-0000eab0: 746f 7279 2e22 290a 0a20 2020 2020 2020  tory.")..       
-0000eac0: 2020 2020 2020 2020 2020 2020 206d 6971               miq
-0000ead0: 7474 2e61 7265 5f76 616c 6964 5f69 6664  tt.are_valid_ifd
-0000eae0: 6f5f 6669 656c 6473 2873 7562 4974 656d  o_fields(subItem
-0000eaf0: 2920 2020 2020 2020 2020 2020 2020 2020  )               
-0000eb00: 2020 2020 2020 2020 2020 0a0a 2020 2020            ..    
-0000eb10: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-0000eb20: 655f 7365 745f 6974 656d 735b 7375 6249  e_set_items[subI
-0000eb30: 7465 6d44 6566 6175 6c74 5b27 696d 6167  temDefault['imag
-0000eb40: 652d 6669 6c65 6e61 6d65 275d 5d20 3d20  e-filename']] = 
-0000eb50: 5b5d 2023 2063 6f75 6c64 206d 616b 6520  [] # could make 
-0000eb60: 616e 2065 7874 7261 2063 6173 6520 666f  an extra case fo
-0000eb70: 7220 696d 6167 6573 206f 6d69 7474 696e  r images omittin
-0000eb80: 6720 7468 6520 6c69 7374 0a20 2020 2020  g the list.     
-0000eb90: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-0000eba0: 7562 4974 656d 2069 6e20 6974 656d 3a0a  ubItem in item:.
-0000ebb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ebc0: 2020 2020 7375 6249 7465 6d44 6963 7420      subItemDict 
-0000ebd0: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
-0000ebe0: 2020 2020 2020 2020 2066 6f72 2069 7420           for it 
-0000ebf0: 696e 2073 7562 4974 656d 3a0a 2020 2020  in subItem:.    
-0000ec00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec10: 2020 2020 6966 2069 7420 213d 2027 696d      if it != 'im
-0000ec20: 6167 652d 6669 6c65 6e61 6d65 273a 0a20  age-filename':. 
+0000a2a0: 2020 2072 6574 203d 2076 616c 5f69 0a20     ret = val_i. 
+0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2c0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0000a2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a2e0: 2020 2020 2020 2020 2072 6574 5b74 696d           ret[tim
+0000a2f0: 6550 6f69 6e74 4461 7461 5b27 696d 6167  ePointData['imag
+0000a300: 652d 6461 7465 7469 6d65 275d 5d20 3d20  e-datetime']] = 
+0000a310: 7661 6c5f 690a 2020 2020 2020 2020 2020  val_i.          
+0000a320: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000a330: 7265 6d6f 7665 2069 6d61 6765 2d64 6174  remove image-dat
+0000a340: 6574 696d 6520 6966 2074 6865 7265 0a20  etime if there. 
+0000a350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a360: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0000a370: 616e 6365 2872 6574 5b74 696d 6550 6f69  ance(ret[timePoi
+0000a380: 6e74 4461 7461 5b27 696d 6167 652d 6461  ntData['image-da
+0000a390: 7465 7469 6d65 275d 5d2c 6469 6374 2920  tetime']],dict) 
+0000a3a0: 616e 6420 2769 6d61 6765 2d64 6174 6574  and 'image-datet
+0000a3b0: 696d 6527 2069 6e20 7265 745b 7469 6d65  ime' in ret[time
+0000a3c0: 506f 696e 7444 6174 615b 2769 6d61 6765  PointData['image
+0000a3d0: 2d64 6174 6574 696d 6527 5d5d 3a0a 2020  -datetime']]:.  
+0000a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3f0: 2020 2020 2020 2020 2020 6465 6c20 7265            del re
+0000a400: 745b 7469 6d65 506f 696e 7444 6174 615b  t[timePointData[
+0000a410: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
+0000a420: 5d5d 5b27 696d 6167 652d 6461 7465 7469  ]]['image-dateti
+0000a430: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
+0000a440: 2020 2020 2020 2020 2020 2020 2023 2076               # v
+0000a450: 6964 656f 2064 6566 6175 6c74 730a 2020  ideo defaults.  
+0000a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a470: 2020 2020 2020 6966 2069 203d 3d20 303a        if i == 0:
+0000a480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a490: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000a4a0: 6973 696e 7374 616e 6365 2872 6574 5b74  isinstance(ret[t
+0000a4b0: 696d 6550 6f69 6e74 4461 7461 5b27 696d  imePointData['im
+0000a4c0: 6167 652d 6461 7465 7469 6d65 275d 5d2c  age-datetime']],
+0000a4d0: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
+0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4f0: 2020 2020 2020 2064 6566 6175 6c74 5661         defaultVa
+0000a500: 6c20 3d20 7b2a 2a64 6566 6175 6c74 5661  l = {**defaultVa
+0000a510: 6c2c 2a2a 7265 745b 7469 6d65 506f 696e  l,**ret[timePoin
+0000a520: 7444 6174 615b 2769 6d61 6765 2d64 6174  tData['image-dat
+0000a530: 6574 696d 6527 5d5d 7d0a 2020 2020 2020  etime']]}.      
+0000a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a550: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a570: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+0000a580: 756c 7456 616c 203d 2072 6574 5b74 696d  ultVal = ret[tim
+0000a590: 6550 6f69 6e74 4461 7461 5b27 696d 6167  ePointData['imag
+0000a5a0: 652d 6461 7465 7469 6d65 275d 5d0a 0a20  e-datetime']].. 
+0000a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5c0: 2020 2020 2020 2069 202b 3d20 310a 0a20         i += 1.. 
+0000a5d0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0000a5e0: 616e 6365 2872 6574 2c64 6963 7429 206f  ance(ret,dict) o
+0000a5f0: 7220 6973 696e 7374 616e 6365 2872 6574  r isinstance(ret
+0000a600: 2c6c 6973 7429 3a0a 2020 2020 2020 2020  ,list):.        
+0000a610: 2020 2020 7265 7420 3d20 636f 7079 2e64      ret = copy.d
+0000a620: 6565 7063 6f70 7928 7265 7429 0a20 2020  eepcopy(ret).   
+0000a630: 2020 2020 2069 6620 7265 7420 3d3d 2022       if ret == "
+0000a640: 2220 6f72 2072 6574 203d 3d20 7b7d 3a0a  " or ret == {}:.
+0000a650: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000a660: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
+0000a670: 7074 696f 6e28 226b 6579 7320 646f 206e  ption("keys do n
+0000a680: 6f74 2065 7869 7374 3a22 202b 2073 7472  ot exist:" + str
+0000a690: 286b 6579 7329 290a 2020 2020 2020 2020  (keys)).        
+0000a6a0: 7265 7475 726e 2072 6574 0a0a 0a20 2020  return ret...   
+0000a6b0: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
+0000a6c0: 2020 2064 6566 205f 5f67 6574 4974 656d     def __getItem
+0000a6d0: 5661 6c75 6528 6974 656d 732c 6b65 7973  Value(items,keys
+0000a6e0: 2c73 6b69 7070 6564 496e 4865 6164 6572  ,skippedInHeader
+0000a6f0: 2c64 6566 6175 6c74 5661 6c29 3a0a 2020  ,defaultVal):.  
+0000a700: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
+0000a710: 2069 6e20 6361 7365 2069 7465 6d20 6973   in case item is
+0000a720: 206e 6f74 2061 206c 6973 7420 2873 686f   not a list (sho
+0000a730: 756c 6420 6e6f 7420 6265 2070 6f73 7369  uld not be possi
+0000a740: 626c 6529 0a20 2020 2020 2020 2069 6620  ble).        if 
+0000a750: 6e6f 7420 6973 696e 7374 616e 6365 2869  not isinstance(i
+0000a760: 7465 6d73 5b6b 6579 735b 305d 5d2c 6c69  tems[keys[0]],li
+0000a770: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
+0000a780: 2069 7465 6d73 5b6b 6579 735b 305d 5d20   items[keys[0]] 
+0000a790: 3d20 5b69 7465 6d73 5b6b 6579 735b 305d  = [items[keys[0]
+0000a7a0: 5d5d 0a0a 2020 2020 2020 2020 6974 656d  ]]..        item
+0000a7b0: 5661 6c75 6520 3d20 6669 6e64 4669 656c  Value = findFiel
+0000a7c0: 6428 6974 656d 732c 6b65 7973 290a 0a20  d(items,keys).. 
+0000a7d0: 2020 2020 2020 2069 6620 6974 656d 5661         if itemVa
+0000a7e0: 6c75 6520 3d3d 2022 223a 0a20 2020 2020  lue == "":.     
+0000a7f0: 2020 2020 2020 2072 6574 203d 2064 6566         ret = def
+0000a800: 6175 6c74 5661 6c0a 2020 2020 2020 2020  aultVal.        
+0000a810: 2320 696e 2063 6173 6520 6f66 2064 6963  # in case of dic
+0000a820: 7473 206a 6f69 6e74 2068 6561 6465 7220  ts joint header 
+0000a830: 616e 6420 6974 656d 2066 6965 6c64 730a  and item fields.
+0000a840: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+0000a850: 6e73 7461 6e63 6528 6974 656d 5661 6c75  nstance(itemValu
+0000a860: 652c 6469 6374 2920 616e 6420 6465 6661  e,dict) and defa
+0000a870: 756c 7456 616c 2021 3d20 2222 3a0a 2020  ultVal != "":.  
+0000a880: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000a890: 2069 7369 6e73 7461 6e63 6528 6465 6661   isinstance(defa
+0000a8a0: 756c 7456 616c 2c64 6963 7429 3a0a 2020  ultVal,dict):.  
+0000a8b0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0000a8c0: 6973 6520 6d69 7174 632e 4966 646f 4578  ise miqtc.IfdoEx
+0000a8d0: 6365 7074 696f 6e28 2249 7465 6d20 6669  ception("Item fi
+0000a8e0: 656c 6420 6973 2064 6963 7420 6275 7420  eld is dict but 
+0000a8f0: 6465 6661 756c 7420 7661 6c75 6520 696e  default value in
+0000a900: 2068 6561 6465 7220 6973 206e 6f74 3a20   header is not: 
+0000a910: 2220 2b20 7374 7228 6b65 7973 2929 0a20  " + str(keys)). 
+0000a920: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
+0000a930: 207b 2a2a 6465 6661 756c 7456 616c 2c2a   {**defaultVal,*
+0000a940: 2a69 7465 6d56 616c 7565 7d0a 2020 2020  *itemValue}.    
+0000a950: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000a960: 2020 2020 2020 7265 7420 3d20 6974 656d        ret = item
+0000a970: 5661 6c75 650a 2020 2020 2020 2020 7265  Value.        re
+0000a980: 7475 726e 2072 6574 0a0a 0a20 2020 2064  turn ret...    d
+0000a990: 6566 205f 5f73 7472 5f5f 2873 656c 6629  ef __str__(self)
+0000a9a0: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
+0000a9b0: 2022 2222 2050 7269 6e74 7320 6375 7272   """ Prints curr
+0000a9c0: 656e 7420 6946 444f 2066 696c 6520 2222  ent iFDO file ""
+0000a9d0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+0000a9e0: 2079 616d 6c2e 6475 6d70 2873 656c 662e   yaml.dump(self.
+0000a9f0: 6966 646f 5f63 6865 636b 6564 2c20 6465  ifdo_checked, de
+0000aa00: 6661 756c 745f 7374 796c 653d 4e6f 6e65  fault_style=None
+0000aa10: 2c20 6465 6661 756c 745f 666c 6f77 5f73  , default_flow_s
+0000aa20: 7479 6c65 3d4e 6f6e 652c 2061 6c6c 6f77  tyle=None, allow
+0000aa30: 5f75 6e69 636f 6465 3d54 7275 652c 2077  _unicode=True, w
+0000aa40: 6964 7468 3d66 6c6f 6174 2822 696e 6622  idth=float("inf"
+0000aa50: 2929 0a0a 0a20 2020 2064 6566 205f 5f67  ))...    def __g
+0000aa60: 6574 6974 656d 5f5f 2873 656c 662c 206b  etitem__(self, k
+0000aa70: 6579 7329 3a0a 2020 2020 2020 2020 2222  eys):.        ""
+0000aa80: 2220 5265 7475 726e 7320 636f 7079 206f  " Returns copy o
+0000aa90: 6620 6368 6563 6b65 6420 6966 646f 2073  f checked ifdo s
+0000aaa0: 6574 206f 7220 6974 656d 2066 6965 6c64  et or item field
+0000aab0: 2076 616c 7565 2c20 616c 736f 2063 6f6e   value, also con
+0000aac0: 7369 6465 726e 6720 6465 6661 756c 7420  siderng default 
+0000aad0: 7661 6c75 6573 2066 726f 6d20 6865 6164  values from head
+0000aae0: 6572 2e0a 2020 2020 2020 2020 2020 2020  er..            
+0000aaf0: 5573 6520 6b65 7973 2061 7320 652e 672e  Use keys as e.g.
+0000ab00: 2027 3c69 7465 6d3e 3a3c 6b65 793e 3a2e   '<item>:<key>:.
+0000ab10: 2e2e 272e 2043 616e 2062 6520 7573 6564  ..'. Can be used
+0000ab20: 2066 6f72 2068 6561 6465 7220 6669 656c   for header fiel
+0000ab30: 6473 2061 7320 7765 6c6c 2061 7320 6974  ds as well as it
+0000ab40: 656d 2066 6965 6c64 732e 0a20 2020 2020  em fields..     
+0000ab50: 2020 2020 2020 2049 7465 6d20 696e 6465         Item inde
+0000ab60: 7820 6361 6e20 6265 206c 6567 6c65 6374  x can be leglect
+0000ab70: 6564 2c20 696e 2063 6173 6520 6f66 2076  ed, in case of v
+0000ab80: 6964 656f 2061 2064 6963 7420 7b3c 696d  ideo a dict {<im
+0000ab90: 6167 652d 6461 7461 7469 6d65 3e3a 3c76  age-datatime>:<v
+0000aba0: 616c 7565 3e2c 2e2e 2e7d 2069 7320 7265  alue>,...} is re
+0000abb0: 7475 726e 6564 2e0a 2020 2020 2020 2020  turned..        
+0000abc0: 2020 2020 5261 6973 6573 2049 6664 6f45      Raises IfdoE
+0000abd0: 7863 6570 7469 6f6e 2069 6620 6974 656d  xception if item
+0000abe0: 2064 6f65 7320 6e6f 7420 6578 6973 742e   does not exist.
+0000abf0: 2022 2222 0a20 2020 2020 2020 206b 6579   """.        key
+0000ac00: 7320 3d20 6b65 7973 2e73 706c 6974 2827  s = keys.split('
+0000ac10: 3a27 290a 2020 2020 2020 2020 7265 7475  :').        retu
+0000ac20: 726e 2073 656c 662e 5f5f 6765 7446 6965  rn self.__getFie
+0000ac30: 6c64 5661 6c75 6528 7365 6c66 2e69 6664  ldValue(self.ifd
+0000ac40: 6f5f 6368 6563 6b65 642c 6b65 7973 290a  o_checked,keys).
+0000ac50: 0a0a 2020 2020 6465 6620 6669 6e64 546d  ..    def findTm
+0000ac60: 7046 6965 6c64 2873 656c 662c 6b65 7973  pField(self,keys
+0000ac70: 293a 0a20 2020 2020 2020 2022 2222 2052  ):.        """ R
+0000ac80: 6574 7572 6e73 2063 6f70 7920 6f66 2074  eturns copy of t
+0000ac90: 656d 706f 7261 7279 2075 6e63 6865 636b  emporary uncheck
+0000aca0: 6564 2069 6664 6f20 7365 7420 6f72 2069  ed ifdo set or i
+0000acb0: 7465 6d20 6669 656c 6420 7661 6c75 652c  tem field value,
+0000acc0: 2061 6c73 6f20 636f 6e73 6964 6572 6e67   also considerng
+0000acd0: 2064 6566 6175 6c74 2076 616c 7565 7320   default values 
+0000ace0: 6672 6f6d 2068 6561 6465 722e 0a20 2020  from header..   
+0000acf0: 2020 2020 2020 2020 2055 7365 206b 6579           Use key
+0000ad00: 7320 6173 2065 2e67 2e20 273c 6974 656d  s as e.g. '<item
+0000ad10: 3e3a 3c6b 6579 3e3a 2e2e 2e27 2e20 4361  >:<key>:...'. Ca
+0000ad20: 6e20 6265 2075 7365 6420 666f 7220 6865  n be used for he
+0000ad30: 6164 6572 2066 6965 6c64 7320 6173 2077  ader fields as w
+0000ad40: 656c 6c20 6173 2069 7465 6d20 6669 656c  ell as item fiel
+0000ad50: 6473 2e0a 2020 2020 2020 2020 2020 2020  ds..            
+0000ad60: 4974 656d 2069 6e64 6578 2063 616e 2062  Item index can b
+0000ad70: 6520 6c65 676c 6563 7465 642c 2069 6e20  e leglected, in 
+0000ad80: 6361 7365 206f 6620 7669 6465 6f20 6120  case of video a 
+0000ad90: 6469 6374 207b 3c69 6d61 6765 2d64 6174  dict {<image-dat
+0000ada0: 6174 696d 653e 3a3c 7661 6c75 653e 2c2e  atime>:<value>,.
+0000adb0: 2e2e 7d20 6973 2072 6574 7572 6e65 642e  ..} is returned.
+0000adc0: 0a20 2020 2020 2020 2020 2020 2052 6169  .            Rai
+0000add0: 7365 7320 4966 646f 4578 6365 7074 696f  ses IfdoExceptio
+0000ade0: 6e20 6966 2069 7465 6d20 646f 6573 206e  n if item does n
+0000adf0: 6f74 2065 7869 7374 2e20 2222 220a 2020  ot exist. """.  
+0000ae00: 2020 2020 2020 6b65 7973 203d 206b 6579        keys = key
+0000ae10: 732e 7370 6c69 7428 273a 2729 0a20 2020  s.split(':').   
+0000ae20: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000ae30: 2e5f 5f67 6574 4669 656c 6456 616c 7565  .__getFieldValue
+0000ae40: 2873 656c 662e 6966 646f 5f74 6d70 2c6b  (self.ifdo_tmp,k
+0000ae50: 6579 7329 0a20 2020 200a 0a20 2020 2064  eys).    ..    d
+0000ae60: 6566 2066 696e 6454 6d70 4669 656c 6432  ef findTmpField2
+0000ae70: 2873 656c 662c 6b65 7973 293a 0a20 2020  (self,keys):.   
+0000ae80: 2020 2020 2022 2222 2053 616d 6520 6173       """ Same as
+0000ae90: 2066 696e 6454 6d70 4669 656c 6420 696e   findTmpField in
+0000aea0: 7374 6561 6420 6f66 2072 6169 7369 6e67  stead of raising
+0000aeb0: 2065 7863 6570 7469 6f6e 2069 7420 7265   exception it re
+0000aec0: 7475 726e 2065 6d70 7479 2073 7472 696e  turn empty strin
+0000aed0: 672e 2022 2222 0a20 2020 2020 2020 206b  g. """.        k
+0000aee0: 6579 7320 3d20 6b65 7973 2e73 706c 6974  eys = keys.split
+0000aef0: 2827 3a27 290a 2020 2020 2020 2020 7472  (':').        tr
+0000af00: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
+0000af10: 6574 203d 2073 656c 662e 5f5f 6765 7446  et = self.__getF
+0000af20: 6965 6c64 5661 6c75 6528 7365 6c66 2e69  ieldValue(self.i
+0000af30: 6664 6f5f 746d 702c 6b65 7973 290a 2020  fdo_tmp,keys).  
+0000af40: 2020 2020 2020 6578 6365 7074 206d 6971        except miq
+0000af50: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+0000af60: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000af70: 7420 3d20 2222 0a20 2020 2020 2020 2072  t = "".        r
+0000af80: 6574 7572 6e20 7265 740a 0a0a 2020 2020  eturn ret...    
+0000af90: 6465 6620 7365 7469 4644 4f48 6561 6465  def setiFDOHeade
+0000afa0: 7246 6965 6c64 7328 7365 6c66 2c20 6865  rFields(self, he
+0000afb0: 6164 6572 3a20 6469 6374 293a 0a20 2020  ader: dict):.   
+0000afc0: 2020 2020 2022 2222 2043 6c65 6172 7320       """ Clears 
+0000afd0: 6375 7272 656e 7420 6865 6164 6572 2066  current header f
+0000afe0: 6965 6c64 7320 756e 6420 7365 7473 2070  ields und sets p
+0000aff0: 726f 7669 6465 6420 6669 656c 6420 7661  rovided field va
+0000b000: 6c75 6573 2e20 466f 7220 7570 6461 7469  lues. For updati
+0000b010: 6e67 2065 7869 7374 696e 6720 6f6e 6573  ng existing ones
+0000b020: 2075 7365 2075 7064 6174 655f 6966 646f   use update_ifdo
+0000b030: 5f68 6561 6465 725f 6669 656c 6473 2829  _header_fields()
+0000b040: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+0000b050: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000b060: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000b070: 795d 203d 207b 7d0a 2020 2020 2020 2020  y] = {}.        
+0000b080: 6966 2073 656c 662e 696d 6167 6553 6574  if self.imageSet
+0000b090: 4865 6164 6572 4b65 7920 696e 2068 6561  HeaderKey in hea
+0000b0a0: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
+0000b0b0: 2068 6561 6465 7220 3d20 6865 6164 6572   header = header
+0000b0c0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000b0d0: 6164 6572 4b65 795d 0a20 2020 2020 2020  aderKey].       
+0000b0e0: 2066 6f72 2066 6965 6c64 2069 6e20 6865   for field in he
+0000b0f0: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+0000b100: 2020 2369 6620 6669 656c 6420 6e6f 7420    #if field not 
+0000b110: 696e 206d 6971 7476 2e69 6664 6f5f 6865  in miqtv.ifdo_he
+0000b120: 6164 6572 5f63 6f72 655f 6669 656c 6473  ader_core_fields
+0000b130: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0000b140: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+0000b150: 2822 4361 7574 696f 6e21 2055 6e6b 6e6f  ("Caution! Unkno
+0000b160: 776e 2068 6561 6465 7220 6669 656c 6420  wn header field 
+0000b170: 5c22 2220 2b20 6669 656c 6420 2b20 225c  \"" + field + "\
+0000b180: 222e 204d 6179 6265 2061 2074 7970 6f3f  ". Maybe a typo?
+0000b190: 204f 7468 6572 7769 7365 2069 676e 6f72   Otherwise ignor
+0000b1a0: 6520 6d65 2e22 290a 2020 2020 2020 2020  e me.").        
+0000b1b0: 2020 2020 7365 6c66 2e69 6664 6f5f 746d      self.ifdo_tm
+0000b1c0: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
+0000b1d0: 6561 6465 724b 6579 5d5b 6669 656c 645d  eaderKey][field]
+0000b1e0: 203d 2068 6561 6465 725b 6669 656c 645d   = header[field]
+0000b1f0: 0a0a 0a20 2020 2064 6566 2075 7064 6174  ...    def updat
+0000b200: 655f 6966 646f 5f68 6561 6465 725f 6669  e_ifdo_header_fi
+0000b210: 656c 6473 2873 656c 662c 2068 6561 6465  elds(self, heade
+0000b220: 723a 2064 6963 7429 3a0a 2020 2020 2020  r: dict):.      
+0000b230: 2020 2222 2220 5570 6461 7465 7320 6578    """ Updates ex
+0000b240: 6973 7469 6e67 2068 6561 6465 7220 6669  isting header fi
+0000b250: 656c 6473 2022 2222 0a20 2020 2020 2020  elds """.       
+0000b260: 2069 6620 7365 6c66 2e69 6d61 6765 5365   if self.imageSe
+0000b270: 7448 6561 6465 724b 6579 2069 6e20 6865  tHeaderKey in he
+0000b280: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+0000b290: 2020 6865 6164 6572 203d 2068 6561 6465    header = heade
+0000b2a0: 725b 7365 6c66 2e69 6d61 6765 5365 7448  r[self.imageSetH
+0000b2b0: 6561 6465 724b 6579 5d0a 2020 2020 2020  eaderKey].      
+0000b2c0: 2020 6c6f 6720 3d20 6d69 7174 632e 7265    log = miqtc.re
+0000b2d0: 6375 7273 6976 656c 7955 7064 6174 6544  cursivelyUpdateD
+0000b2e0: 6963 7473 2873 656c 662e 6966 646f 5f74  icts(self.ifdo_t
+0000b2f0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+0000b300: 4865 6164 6572 4b65 795d 2c20 6865 6164  HeaderKey], head
+0000b310: 6572 290a 2020 2020 2020 2020 7365 6c66  er).        self
+0000b320: 2e70 726f 762e 6c6f 6728 6c6f 672c 646f  .prov.log(log,do
+0000b330: 6e74 5368 6f77 3d54 7275 6529 0a0a 2020  ntShow=True)..  
+0000b340: 2020 6465 6620 7570 6461 7465 6946 444f    def updateiFDO
+0000b350: 4865 6164 6572 4669 656c 6473 2873 656c  HeaderFields(sel
+0000b360: 662c 2068 6561 6465 723a 2064 6963 7429  f, header: dict)
+0000b370: 3a0a 2020 2020 2020 2020 2222 2220 4465  :.        """ De
+0000b380: 7072 6563 6174 6564 202d 2075 7365 2075  precated - use u
+0000b390: 7064 6174 655f 6966 646f 5f68 6561 6465  pdate_ifdo_heade
+0000b3a0: 725f 6669 656c 6473 2022 2222 0a20 2020  r_fields """.   
+0000b3b0: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
+0000b3c0: 5f69 6664 6f5f 6865 6164 6572 5f66 6965  _ifdo_header_fie
+0000b3d0: 6c64 7328 6865 6164 6572 290a 0a0a 2020  lds(header)...  
+0000b3e0: 2020 6465 6620 5f74 7279 5f75 7067 7261    def _try_upgra
+0000b3f0: 6465 5f74 6f5f 6966 646f 5f76 6572 7369  de_to_ifdo_versi
+0000b400: 6f6e 5f32 7828 7365 6c66 293a 0a20 2020  on_2x(self):.   
+0000b410: 2020 2020 2022 2222 2054 7279 2074 6f20       """ Try to 
+0000b420: 636f 6e76 6572 7420 6669 656c 6473 2066  convert fields f
+0000b430: 726f 6d20 6946 444f 2076 6572 7369 6f6e  rom iFDO version
+0000b440: 203c 2032 2e30 2e30 2074 6f20 322e 7820   < 2.0.0 to 2.x 
+0000b450: 2222 220a 2020 2020 2020 2020 7265 6164  """.        read
+0000b460: 5f76 6572 7369 6f6e 5f73 7472 203d 2022  _version_str = "
+0000b470: 7631 2e30 2e30 2220 2320 6469 6420 6e6f  v1.0.0" # did no
+0000b480: 7420 6861 7665 2074 6865 2027 696d 6167  t have the 'imag
+0000b490: 652d 7365 742d 6966 646f 2d76 6572 7369  e-set-ifdo-versi
+0000b4a0: 6f6e 2720 6669 656c 6420 7965 740a 2020  on' field yet.  
+0000b4b0: 2020 2020 2020 7472 793a 200a 2020 2020        try: .    
+0000b4c0: 2020 2020 2020 2020 7265 6164 5f76 6572          read_ver
+0000b4d0: 7369 6f6e 5f73 7472 203d 2073 656c 662e  sion_str = self.
+0000b4e0: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
+0000b4f0: 6167 652d 7365 742d 6966 646f 2d76 6572  age-set-ifdo-ver
+0000b500: 7369 6f6e 2729 0a20 2020 2020 2020 2065  sion').        e
+0000b510: 7863 6570 7420 6d69 7174 632e 4966 646f  xcept miqtc.Ifdo
+0000b520: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+0000b530: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+0000b540: 2020 2020 7265 6164 5f76 6572 7369 6f6e      read_version
+0000b550: 203d 2056 6572 7369 6f6e 2872 6561 645f   = Version(read_
+0000b560: 7665 7273 696f 6e5f 7374 7229 0a0a 2020  version_str)..  
+0000b570: 2020 2020 2020 6966 2072 6561 645f 7665        if read_ve
+0000b580: 7273 696f 6e20 3c20 5665 7273 696f 6e28  rsion < Version(
+0000b590: 2232 2e30 2e30 2229 3a0a 2020 2020 2020  "2.0.0"):.      
+0000b5a0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+0000b5b0: 2020 2023 206e 6577 2055 5249 206f 626a     # new URI obj
+0000b5c0: 6563 7420 6669 656c 6473 0a20 2020 2020  ect fields.     
+0000b5d0: 2020 2020 2020 206e 6577 5f75 7269 5f66         new_uri_f
+0000b5e0: 6965 6c64 7320 3d20 5b27 696d 6167 652d  ields = ['image-
+0000b5f0: 7365 6e73 6f72 272c 2769 6d61 6765 2d65  sensor','image-e
+0000b600: 7665 6e74 272c 2769 6d61 6765 2d70 726f  vent','image-pro
+0000b610: 6a65 6374 272c 2769 6d61 6765 2d63 6f6e  ject','image-con
+0000b620: 7465 7874 272c 2769 6d61 6765 2d6c 6963  text','image-lic
+0000b630: 656e 7365 272c 2769 6d61 6765 2d70 6c61  ense','image-pla
+0000b640: 7466 6f72 6d27 5d0a 2020 2020 2020 2020  tform'].        
+0000b650: 2020 2020 666f 7220 7572 695f 6669 656c      for uri_fiel
+0000b660: 6420 696e 206e 6577 5f75 7269 5f66 6965  d in new_uri_fie
+0000b670: 6c64 733a 0a20 2020 2020 2020 2020 2020  lds:.           
+0000b680: 2020 2020 206f 6c64 5f73 7472 5f76 616c       old_str_val
+0000b690: 203d 2073 656c 662e 6669 6e64 546d 7046   = self.findTmpF
+0000b6a0: 6965 6c64 3228 7572 695f 6669 656c 6429  ield2(uri_field)
+0000b6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b6c0: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
+0000b6d0: 6c64 5f73 7472 5f76 616c 2c73 7472 2920  ld_str_val,str) 
+0000b6e0: 616e 6420 6f6c 645f 7374 725f 7661 6c20  and old_str_val 
+0000b6f0: 213d 2022 223a 2020 2020 2020 2020 2020  != "":          
+0000b700: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0000b710: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0000b720: 6577 5f6f 626a 5f76 616c 203d 207b 276e  ew_obj_val = {'n
+0000b730: 616d 6527 3a20 6f6c 645f 7374 725f 7661  ame': old_str_va
+0000b740: 6c7d 0a20 2020 2020 2020 2020 2020 2020  l}.             
+0000b750: 2020 2020 2020 2069 735f 7572 692c 206d         is_uri, m
+0000b760: 7367 203d 206d 6971 7474 2e76 616c 6964  sg = miqtt.valid
+0000b770: 6174 655f 6167 6169 6e73 745f 7363 6865  ate_against_sche
+0000b780: 6d61 286f 6c64 5f73 7472 5f76 616c 2c7b  ma(old_str_val,{
+0000b790: 2274 7970 6522 3a20 2273 7472 696e 6722  "type": "string"
+0000b7a0: 2c22 666f 726d 6174 223a 2022 7572 6922  ,"format": "uri"
+0000b7b0: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
+0000b7c0: 2020 2020 2020 2069 6620 6973 5f75 7269         if is_uri
+0000b7d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000b7e0: 2020 2020 2020 2020 2020 6e65 775f 6f62            new_ob
+0000b7f0: 6a5f 7661 6c5b 2775 7269 275d 203d 206f  j_val['uri'] = o
+0000b800: 6c64 5f73 7472 5f76 616c 0a20 2020 2020  ld_str_val.     
+0000b810: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000b820: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0000b830: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000b840: 4b65 795d 5b75 7269 5f66 6965 6c64 5d20  Key][uri_field] 
+0000b850: 3d20 6e65 775f 6f62 6a5f 7661 6c0a 2020  = new_obj_val.  
+0000b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b870: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+0000b880: 2241 7574 6f2d 7570 6772 6164 6564 2022  "Auto-upgraded "
+0000b890: 202b 2075 7269 5f66 6965 6c64 202b 2022   + uri_field + "
+0000b8a0: 2066 726f 6d20 2220 2b20 6f6c 645f 7374   from " + old_st
+0000b8b0: 725f 7661 6c20 2b20 2220 746f 2022 202b  r_val + " to " +
+0000b8c0: 2073 7472 286e 6577 5f6f 626a 5f76 616c   str(new_obj_val
+0000b8d0: 2929 0a0a 0a0a 2020 2020 6465 6620 7472  ))....    def tr
+0000b8e0: 7941 7574 6f53 6574 4865 6164 6572 4669  yAutoSetHeaderFi
+0000b8f0: 656c 6473 2873 656c 6629 3a0a 2020 2020  elds(self):.    
+0000b900: 2020 2020 2222 2220 5365 7473 2063 6572      """ Sets cer
+0000b910: 7461 696e 2068 6561 6465 7220 6669 656c  tain header fiel
+0000b920: 6473 2065 2e67 2e20 6672 6f6d 2064 6972  ds e.g. from dir
+0000b930: 6563 746f 7279 2069 6620 7468 6579 2061  ectory if they a
+0000b940: 7265 206e 6f74 2073 6574 2079 6574 2022  re not set yet "
+0000b950: 2222 0a0a 2020 2020 2020 2020 6966 2073  ""..        if s
+0000b960: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
+0000b970: 3228 2769 6d61 6765 2d73 656e 736f 7227  2('image-sensor'
+0000b980: 2920 3d3d 2022 223a 0a20 2020 2020 2020  ) == "":.       
+0000b990: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
+0000b9a0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+0000b9b0: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
+0000b9c0: 652d 7365 6e73 6f72 275d 203d 207b 276e  e-sensor'] = {'n
+0000b9d0: 616d 6527 3a20 7365 6c66 2e64 6972 2e73  ame': self.dir.s
+0000b9e0: 656e 736f 7228 297d 0a20 2020 2020 2020  ensor()}.       
+0000b9f0: 2065 6c69 6620 7365 6c66 2e66 696e 6454   elif self.findT
+0000ba00: 6d70 4669 656c 6428 2769 6d61 6765 2d73  mpField('image-s
+0000ba10: 656e 736f 7227 295b 276e 616d 6527 5d20  ensor')['name'] 
+0000ba20: 213d 2073 656c 662e 6469 722e 7365 6e73  != self.dir.sens
+0000ba30: 6f72 2829 3a0a 2020 2020 2020 2020 2020  or():.          
+0000ba40: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+0000ba50: 2243 6175 7469 6f6e 2120 2769 6d61 6765  "Caution! 'image
+0000ba60: 2d73 656e 736f 7227 2022 2b20 7374 7228  -sensor' "+ str(
+0000ba70: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+0000ba80: 6428 2769 6d61 6765 2d73 656e 736f 7227  d('image-sensor'
+0000ba90: 2929 202b 2022 2064 6966 6665 7273 2066  )) + " differs f
+0000baa0: 726f 6d20 7365 6e73 6f72 2070 6172 7365  rom sensor parse
+0000bab0: 6420 6672 6f6d 2064 6972 6563 746f 7279  d from directory
+0000bac0: 3a20 2220 2b20 7365 6c66 2e64 6972 2e73  : " + self.dir.s
+0000bad0: 656e 736f 7228 2929 0a0a 2020 2020 2020  ensor())..      
+0000bae0: 2020 6966 2073 656c 662e 6669 6e64 546d    if self.findTm
+0000baf0: 7046 6965 6c64 3228 2769 6d61 6765 2d65  pField2('image-e
+0000bb00: 7665 6e74 2729 203d 3d20 2222 3a0a 2020  vent') == "":.  
+0000bb10: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+0000bb20: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+0000bb30: 6765 5365 7448 6561 6465 724b 6579 5d5b  geSetHeaderKey][
+0000bb40: 2769 6d61 6765 2d65 7665 6e74 275d 203d  'image-event'] =
+0000bb50: 207b 276e 616d 6527 3a20 7365 6c66 2e64   {'name': self.d
+0000bb60: 6972 2e65 7665 6e74 2829 7d0a 2020 2020  ir.event()}.    
+0000bb70: 2020 2020 656c 6966 2073 656c 662e 6669      elif self.fi
+0000bb80: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
+0000bb90: 652d 6576 656e 7427 295b 276e 616d 6527  e-event')['name'
+0000bba0: 5d20 213d 2073 656c 662e 6469 722e 6576  ] != self.dir.ev
+0000bbb0: 656e 7428 293a 0a20 2020 2020 2020 2020  ent():.         
+0000bbc0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+0000bbd0: 2822 4361 7574 696f 6e21 2027 696d 6167  ("Caution! 'imag
+0000bbe0: 652d 6576 656e 7427 2022 202b 2073 7472  e-event' " + str
+0000bbf0: 2873 656c 662e 6669 6e64 546d 7046 6965  (self.findTmpFie
+0000bc00: 6c64 2827 696d 6167 652d 6576 656e 7427  ld('image-event'
+0000bc10: 2929 202b 2022 2064 6966 6665 7273 2066  )) + " differs f
+0000bc20: 726f 6d20 6576 656e 7420 7061 7273 6564  rom event parsed
+0000bc30: 2066 726f 6d20 6469 7265 6374 6f72 793a   from directory:
+0000bc40: 2022 202b 2073 656c 662e 6469 722e 6576   " + self.dir.ev
+0000bc50: 656e 7428 2929 0a0a 2020 2020 2020 2020  ent())..        
+0000bc60: 6966 2073 656c 662e 6669 6e64 546d 7046  if self.findTmpF
+0000bc70: 6965 6c64 3228 2769 6d61 6765 2d70 726f  ield2('image-pro
+0000bc80: 6a65 6374 2729 203d 3d20 2222 3a0a 2020  ject') == "":.  
+0000bc90: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+0000bca0: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+0000bcb0: 6765 5365 7448 6561 6465 724b 6579 5d5b  geSetHeaderKey][
+0000bcc0: 2769 6d61 6765 2d70 726f 6a65 6374 275d  'image-project']
+0000bcd0: 203d 2020 7b27 6e61 6d65 273a 2073 656c   =  {'name': sel
+0000bce0: 662e 6469 722e 7072 6f6a 6563 7428 297d  f.dir.project()}
+0000bcf0: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
+0000bd00: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
+0000bd10: 2769 6d61 6765 2d70 726f 6a65 6374 2729  'image-project')
+0000bd20: 5b27 6e61 6d65 275d 2021 3d20 7365 6c66  ['name'] != self
+0000bd30: 2e64 6972 2e70 726f 6a65 6374 2829 3a0a  .dir.project():.
+0000bd40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000bd50: 2e70 726f 762e 6c6f 6728 2243 6175 7469  .prov.log("Cauti
+0000bd60: 6f6e 2120 2769 6d61 6765 2d70 726f 6a65  on! 'image-proje
+0000bd70: 6374 2720 2220 2b20 7374 7228 7365 6c66  ct' " + str(self
+0000bd80: 2e66 696e 6454 6d70 4669 656c 6428 2769  .findTmpField('i
+0000bd90: 6d61 6765 2d70 726f 6a65 6374 2729 2920  mage-project')) 
+0000bda0: 2b20 2220 6469 6666 6572 7320 6672 6f6d  + " differs from
+0000bdb0: 2070 726f 6a65 6374 2070 6172 7365 6420   project parsed 
+0000bdc0: 6672 6f6d 2064 6972 6563 746f 7279 3a20  from directory: 
+0000bdd0: 2220 2b20 7365 6c66 2e64 6972 2e70 726f  " + self.dir.pro
+0000bde0: 6a65 6374 2829 290a 0a20 2020 2020 2020  ject())..       
+0000bdf0: 2069 6620 7365 6c66 2e66 696e 6454 6d70   if self.findTmp
+0000be00: 4669 656c 6432 2827 696d 6167 652d 706c  Field2('image-pl
+0000be10: 6174 666f 726d 2729 203d 3d20 2222 2061  atform') == "" a
+0000be20: 6e64 2073 656c 662e 6469 722e 6765 6172  nd self.dir.gear
+0000be30: 2829 2021 3d20 2222 3a0a 2020 2020 2020  () != "":.      
+0000be40: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+0000be50: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000be60: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
+0000be70: 6765 2d70 6c61 7466 6f72 6d27 5d20 3d20  ge-platform'] = 
+0000be80: 7b27 6e61 6d65 273a 2073 656c 662e 6469  {'name': self.di
+0000be90: 722e 6765 6172 2829 7d0a 0a20 2020 2020  r.gear()}..     
+0000bea0: 2020 2069 6620 6e6f 7420 2769 6d61 6765     if not 'image
+0000beb0: 2d73 6574 2d75 7569 6427 2069 6e20 7365  -set-uuid' in se
+0000bec0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+0000bed0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+0000bee0: 6579 5d3a 0a20 2020 2020 2020 2020 2020  ey]:.           
+0000bef0: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+0000bf00: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000bf10: 6572 4b65 795d 5b27 696d 6167 652d 7365  erKey]['image-se
+0000bf20: 742d 7575 6964 275d 203d 2073 7472 286d  t-uuid'] = str(m
+0000bf30: 6971 7463 2e75 7569 6434 2829 290a 2020  iqtc.uuid4()).  
+0000bf40: 2020 2020 2020 6966 206e 6f74 2027 696d        if not 'im
+0000bf50: 6167 652d 7365 742d 6861 6e64 6c65 2720  age-set-handle' 
+0000bf60: 696e 2073 656c 662e 6966 646f 5f74 6d70  in self.ifdo_tmp
+0000bf70: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000bf80: 6164 6572 4b65 795d 3a0a 2020 2020 2020  aderKey]:.      
+0000bf90: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+0000bfa0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000bfb0: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
+0000bfc0: 6765 2d73 6574 2d68 616e 646c 6527 5d20  ge-set-handle'] 
+0000bfd0: 3d20 7365 6c66 2e68 616e 646c 655f 7072  = self.handle_pr
+0000bfe0: 6566 6978 202b 2022 2f22 202b 2073 656c  efix + "/" + sel
+0000bff0: 662e 6669 6e64 546d 7046 6965 6c64 2827  f.findTmpField('
+0000c000: 696d 6167 652d 7365 742d 7575 6964 2729  image-set-uuid')
+0000c010: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000c020: 2769 6d61 6765 2d73 6574 2d6e 616d 6527  'image-set-name'
+0000c030: 2069 6e20 7365 6c66 2e69 6664 6f5f 746d   in self.ifdo_tm
+0000c040: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
+0000c050: 6561 6465 724b 6579 5d20 6f72 2073 656c  eaderKey] or sel
+0000c060: 662e 6669 6e64 546d 7046 6965 6c64 3228  f.findTmpField2(
+0000c070: 2769 6d61 6765 2d73 6574 2d6e 616d 6527  'image-set-name'
+0000c080: 2920 3d3d 2022 223a 0a20 2020 2020 2020  ) == "":.       
+0000c090: 2020 2020 2023 2063 6f6e 7374 7275 6374       # construct
+0000c0a0: 2061 7320 3c70 726f 6a65 6374 3e5f 3c65   as <project>_<e
+0000c0b0: 7665 6e74 3e5f 3c73 656e 736f 723e 0a20  vent>_<sensor>. 
+0000c0c0: 2020 2020 2020 2020 2020 2070 726f 6a65             proje
+0000c0d0: 6374 5f20 3d20 7365 6c66 2e66 696e 6454  ct_ = self.findT
+0000c0e0: 6d70 4669 656c 6432 2822 696d 6167 652d  mpField2("image-
+0000c0f0: 7072 6f6a 6563 7422 295b 276e 616d 6527  project")['name'
+0000c100: 5d0a 2020 2020 2020 2020 2020 2020 6576  ].            ev
+0000c110: 656e 745f 203d 2073 656c 662e 6669 6e64  ent_ = self.find
+0000c120: 546d 7046 6965 6c64 3228 2269 6d61 6765  TmpField2("image
+0000c130: 2d65 7665 6e74 2229 5b27 6e61 6d65 275d  -event")['name']
+0000c140: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000c150: 6576 656e 745f 203d 3d20 2222 3a0a 2020  event_ == "":.  
+0000c160: 2020 2020 2020 2020 2020 2020 2020 6576                ev
+0000c170: 656e 745f 203d 2073 656c 662e 6469 722e  ent_ = self.dir.
+0000c180: 6576 656e 7428 290a 2020 2020 2020 2020  event().        
+0000c190: 2020 2020 7365 6e73 6f72 5f20 3d20 7365      sensor_ = se
+0000c1a0: 6c66 2e66 696e 6454 6d70 4669 656c 6432  lf.findTmpField2
+0000c1b0: 2822 696d 6167 652d 7365 6e73 6f72 2229  ("image-sensor")
+0000c1c0: 5b27 6e61 6d65 275d 0a20 2020 2020 2020  ['name'].       
+0000c1d0: 2020 2020 2069 6620 7365 6e73 6f72 5f20       if sensor_ 
+0000c1e0: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
+0000c1f0: 2020 2020 2020 2073 656e 736f 725f 203d         sensor_ =
+0000c200: 2073 656c 662e 6469 722e 7365 6e73 6f72   self.dir.sensor
+0000c210: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+0000c220: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0000c230: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000c240: 4b65 795d 5b27 696d 6167 652d 7365 742d  Key]['image-set-
+0000c250: 6e61 6d65 275d 203d 2069 4644 4f2e 636f  name'] = iFDO.co
+0000c260: 6e73 7472 7563 7449 6d61 6765 5365 744e  nstructImageSetN
+0000c270: 616d 6528 7072 6f6a 6563 745f 2c65 7665  ame(project_,eve
+0000c280: 6e74 5f2c 7365 6e73 6f72 5f29 0a0a 2020  nt_,sensor_)..  
+0000c290: 2020 2020 2020 2320 7365 7420 7665 7273        # set vers
+0000c2a0: 696f 6e0a 2020 2020 2020 2020 7365 6c66  ion.        self
+0000c2b0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+0000c2c0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000c2d0: 5d5b 2769 6d61 6765 2d73 6574 2d69 6664  ]['image-set-ifd
+0000c2e0: 6f2d 7665 7273 696f 6e27 5d20 3d20 6d69  o-version'] = mi
+0000c2f0: 7174 762e 6946 444f 5f76 6572 7369 6f6e  qtv.iFDO_version
+0000c300: 0a0a 0a20 2020 2064 6566 2073 6574 4865  ...    def setHe
+0000c310: 6164 6572 496d 6167 654c 6f63 616c 5061  aderImageLocalPa
+0000c320: 7468 4669 656c 6428 7365 6c66 293a 0a20  thField(self):. 
+0000c330: 2020 2020 2020 2022 2222 2053 6574 7320         """ Sets 
+0000c340: 6865 6164 6572 2066 6965 6c64 2027 696d  header field 'im
+0000c350: 6167 652d 6c6f 6361 6c2d 7061 7468 2720  age-local-path' 
+0000c360: 6672 6f6d 2069 6d61 6765 2064 6972 2022  from image dir "
+0000c370: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+0000c380: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+0000c390: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+0000c3a0: 5b27 696d 6167 652d 6c6f 6361 6c2d 7061  ['image-local-pa
+0000c3b0: 7468 275d 203d 206f 732e 7061 7468 2e72  th'] = os.path.r
+0000c3c0: 656c 7061 7468 2873 656c 662e 696d 6167  elpath(self.imag
+0000c3d0: 6573 4469 722c 206f 732e 7061 7468 2e64  esDir, os.path.d
+0000c3e0: 6972 6e61 6d65 2873 656c 662e 6765 7469  irname(self.geti
+0000c3f0: 4644 4f46 696c 654e 616d 6528 2929 290a  FDOFileName())).
+0000c400: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
+0000c410: 5f66 6965 6c64 7328 7365 6c66 2c20 616c  _fields(self, al
+0000c420: 6c6f 775f 6d69 7373 696e 675f 7265 7175  low_missing_requ
+0000c430: 6972 6564 3d46 616c 7365 293a 0a20 2020  ired=False):.   
+0000c440: 2020 2020 2022 2222 2043 7265 6174 6520       """ Create 
+0000c450: 616e 6420 7661 6c69 6461 7465 2063 7572  and validate cur
+0000c460: 7265 6e74 2068 6561 6465 7220 6669 656c  rent header fiel
+0000c470: 6473 2061 6e64 2069 7465 6d20 6669 656c  ds and item fiel
+0000c480: 6473 2066 726f 6d20 696e 7465 726d 6564  ds from intermed
+0000c490: 6961 7465 2066 696c 6573 2e20 4f76 6572  iate files. Over
+0000c4a0: 7772 6974 6573 2065 7869 7374 696e 6720  writes existing 
+0000c4b0: 6669 656c 6473 2e20 2222 220a 2020 2020  fields. """.    
+0000c4c0: 2020 2020 6974 656d 5f64 6174 6120 3d20      item_data = 
+0000c4d0: 7365 6c66 2e5f 6765 745f 6974 656d 5f64  self._get_item_d
+0000c4e0: 6174 615f 6672 6f6d 5f69 6e74 6572 6d65  ata_from_interme
+0000c4f0: 6469 6174 655f 6669 6c65 7328 290a 2020  diate_files().  
+0000c500: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000c510: 662e 6372 6561 7465 6946 444f 2873 656c  f.createiFDO(sel
+0000c520: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000c530: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000c540: 795d 2c20 6974 656d 5f64 6174 612e 7661  y], item_data.va
+0000c550: 6c75 6573 2829 2c20 616c 6c6f 775f 6d69  lues(), allow_mi
+0000c560: 7373 696e 675f 7265 7175 6972 6564 3d61  ssing_required=a
+0000c570: 6c6c 6f77 5f6d 6973 7369 6e67 5f72 6571  llow_missing_req
+0000c580: 7569 7265 6429 0a0a 0a20 2020 2064 6566  uired)...    def
+0000c590: 2075 7064 6174 655f 6669 656c 6473 2873   update_fields(s
+0000c5a0: 656c 662c 2068 6561 6465 725f 6f6e 6c79  elf, header_only
+0000c5b0: 3a62 6f6f 6c3d 4e6f 6e65 293a 0a20 2020  :bool=None):.   
+0000c5c0: 2020 2020 2022 2222 2055 7064 6174 6520       """ Update 
+0000c5d0: 616e 6420 7661 6c69 6461 7465 2063 7572  and validate cur
+0000c5e0: 7265 6e74 2068 6561 6465 7220 6669 656c  rent header fiel
+0000c5f0: 6473 2061 6e64 2069 7465 6d20 6669 656c  ds and item fiel
+0000c600: 6473 2066 726f 6d20 696e 7465 726d 6564  ds from intermed
+0000c610: 6961 7465 2066 696c 6573 2e20 2222 220a  iate files. """.
+0000c620: 2020 2020 2020 2020 6966 2068 6561 6465          if heade
+0000c630: 725f 6f6e 6c79 2069 7320 4e6f 6e65 3a0a  r_only is None:.
+0000c640: 2020 2020 2020 2020 2020 2020 6865 6164              head
+0000c650: 6572 5f6f 6e6c 7920 3d20 7365 6c66 2e69  er_only = self.i
+0000c660: 676e 6f72 655f 696d 6167 655f 6669 6c65  gnore_image_file
+0000c670: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
+0000c680: 2068 6561 6465 725f 6f6e 6c79 3a0a 2020   header_only:.  
+0000c690: 2020 2020 2020 2020 2020 6974 656d 5f64            item_d
+0000c6a0: 6174 6120 3d20 7365 6c66 2e5f 6765 745f  ata = self._get_
+0000c6b0: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
+0000c6c0: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
+0000c6d0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+0000c6e0: 7265 7475 726e 2073 656c 662e 7570 6461  return self.upda
+0000c6f0: 7465 6946 444f 2873 656c 662e 6966 646f  teiFDO(self.ifdo
+0000c700: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000c710: 6574 4865 6164 6572 4b65 795d 2c20 6974  etHeaderKey], it
+0000c720: 656d 5f64 6174 612e 7661 6c75 6573 2829  em_data.values()
+0000c730: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0000c740: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000c750: 726e 2073 656c 662e 7570 6461 7465 6946  rn self.updateiF
+0000c760: 444f 2873 656c 662e 6966 646f 5f74 6d70  DO(self.ifdo_tmp
+0000c770: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000c780: 6164 6572 4b65 795d 2c20 5b5d 2c20 6865  aderKey], [], he
+0000c790: 6164 6572 5f6f 6e6c 793d 5472 7565 290a  ader_only=True).
+0000c7a0: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
+0000c7b0: 436f 7265 4669 656c 6473 2873 656c 6629  CoreFields(self)
+0000c7c0: 3a0a 2020 2020 2020 2020 2222 2220 4445  :.        """ DE
+0000c7d0: 5052 4543 4144 4554 2c20 7573 6520 6372  PRECADET, use cr
+0000c7e0: 6561 7465 5f66 6965 6c64 7328 2920 6f72  eate_fields() or
+0000c7f0: 2075 7064 6174 655f 6669 656c 6473 2829   update_fields()
+0000c800: 2069 6e73 7465 642e 0a20 2020 2020 2020   insted..       
+0000c810: 2046 696c 6c73 2074 6865 2069 4644 4f20   Fills the iFDO 
+0000c820: 636f 7265 2066 6965 6c64 7320 6672 6f6d  core fields from
+0000c830: 2069 6e74 6572 6d65 6469 6174 6520 6669   intermediate fi
+0000c840: 6c65 732e 2057 6974 686f 7574 2074 6865  les. Without the
+0000c850: 6d20 6e6f 2076 616c 6964 2069 4644 4f20  m no valid iFDO 
+0000c860: 6361 6e20 6265 2063 7265 6174 6564 2e0a  can be created..
+0000c870: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000c880: 2020 2020 6974 656d 5f64 6174 6120 3d20      item_data = 
+0000c890: 7365 6c66 2e5f 6765 745f 6974 656d 5f64  self._get_item_d
+0000c8a0: 6174 615f 6672 6f6d 5f69 6e74 6572 6d65  ata_from_interme
+0000c8b0: 6469 6174 655f 6669 6c65 735f 636f 7265  diate_files_core
+0000c8c0: 2829 0a20 2020 2020 2020 2023 2063 6865  ().        # che
+0000c8d0: 636b 2066 6965 6c64 7320 666f 7220 7661  ck fields for va
+0000c8e0: 6c69 6469 7479 0a20 2020 2020 2020 2023  lidity.        #
+0000c8f0: 2069 7465 6d5f 6461 7461 2063 6f6e 7461   item_data conta
+0000c900: 696e 7320 6669 656c 6420 696d 6167 652d  ins field image-
+0000c910: 6669 6c65 6e61 6d65 2c20 7768 6963 6820  filename, which 
+0000c920: 7768 6963 6820 7769 6c6c 206e 6f74 2062  which will not b
+0000c930: 6520 7374 6f72 6564 2061 7320 616e 2069  e stored as an i
+0000c940: 7465 6d20 6669 656c 6420 696e 2069 464f  tem field in iFO
+0000c950: 4420 6275 7420 6173 2074 6865 2069 7465  D but as the ite
+0000c960: 6d20 6e61 6d65 2069 7473 656c 660a 2020  m name itself.  
+0000c970: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000c980: 662e 7570 6461 7465 6946 444f 2873 656c  f.updateiFDO(sel
+0000c990: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000c9a0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000c9b0: 795d 2c20 6974 656d 5f64 6174 612e 7661  y], item_data.va
+0000c9c0: 6c75 6573 2829 290a 0a0a 2020 2020 6465  lues())...    de
+0000c9d0: 6620 6372 6561 7465 4361 7074 7572 6541  f createCaptureA
+0000c9e0: 6e64 436f 6e74 656e 7446 6965 6c64 7328  ndContentFields(
+0000c9f0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+0000ca00: 2222 2044 4550 5245 4341 4445 542c 2075  "" DEPRECADET, u
+0000ca10: 7365 2063 7265 6174 655f 6669 656c 6473  se create_fields
+0000ca20: 2829 206f 7220 7570 6461 7465 5f66 6965  () or update_fie
+0000ca30: 6c64 7328 2920 696e 7374 6564 2e0a 2020  lds() insted..  
+0000ca40: 2020 2020 2020 4669 6c6c 7320 7468 6520        Fills the 
+0000ca50: 6946 444f 2063 6170 7574 7265 2061 6e64  iFDO caputre and
+0000ca60: 2063 6f6e 7465 6e74 2066 6965 6473 2066   content fieds f
+0000ca70: 726f 6d20 7072 6f76 6964 6564 2064 6174  rom provided dat
+0000ca80: 6120 6669 656c 6473 200a 2020 2020 2020  a fields .      
+0000ca90: 2020 2222 220a 2020 2020 2020 2020 6974    """.        it
+0000caa0: 656d 5f64 6174 6120 3d20 7365 6c66 2e5f  em_data = self._
+0000cab0: 6765 745f 6974 656d 5f64 6174 615f 6672  get_item_data_fr
+0000cac0: 6f6d 5f69 6e74 6572 6d65 6469 6174 655f  om_intermediate_
+0000cad0: 6669 6c65 735f 6e6f 6e65 5f63 6f72 6528  files_none_core(
+0000cae0: 290a 2020 2020 2020 2020 2320 6368 6563  ).        # chec
+0000caf0: 6b20 6669 656c 6473 2066 6f72 2076 616c  k fields for val
+0000cb00: 6964 6974 790a 2020 2020 2020 2020 2320  idity.        # 
+0000cb10: 6974 656d 5f64 6174 6120 636f 6e74 6169  item_data contai
+0000cb20: 6e73 2066 6965 6c64 2069 6d61 6765 2d66  ns field image-f
+0000cb30: 696c 656e 616d 652c 2077 6869 6368 2077  ilename, which w
+0000cb40: 6869 6368 2077 696c 6c20 6e6f 7420 6265  hich will not be
+0000cb50: 2073 746f 7265 6420 6173 2061 6e20 6974   stored as an it
+0000cb60: 656d 2066 6965 6c64 2069 6e20 6946 4f44  em field in iFOD
+0000cb70: 2062 7574 2061 7320 7468 6520 6974 656d   but as the item
+0000cb80: 206e 616d 6520 6974 7365 6c66 0a20 2020   name itself.   
+0000cb90: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000cba0: 2e75 7064 6174 6569 4644 4f28 7365 6c66  .updateiFDO(self
+0000cbb0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+0000cbc0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000cbd0: 5d2c 2069 7465 6d5f 6461 7461 2e76 616c  ], item_data.val
+0000cbe0: 7565 7328 2929 0a0a 2020 2020 0a20 2020  ues())..    .   
+0000cbf0: 2064 6566 205f 6765 745f 6974 656d 5f64   def _get_item_d
+0000cc00: 6174 615f 6672 6f6d 5f69 6e74 6572 6d65  ata_from_interme
+0000cc10: 6469 6174 655f 6669 6c65 7328 7365 6c66  diate_files(self
+0000cc20: 293a 0a20 2020 2020 2020 2022 2222 2052  ):.        """ R
+0000cc30: 6561 6420 6461 7461 2066 726f 6d20 636f  ead data from co
+0000cc40: 7265 2061 6e64 206e 6f6e 652d 636f 7265  re and none-core
+0000cc50: 2069 6e74 6572 6d64 6561 7465 2066 696c   intermdeate fil
+0000cc60: 6573 2c20 6368 6563 6b20 6669 6c65 7320  es, check files 
+0000cc70: 6578 6973 742c 2061 6464 2027 696d 6167  exist, add 'imag
+0000cc80: 652d 6861 6e64 6c65 272e 0a20 2020 2020  e-handle'..     
+0000cc90: 2020 2052 6574 7572 6e73 2064 6963 7420     Returns dict 
+0000cca0: 6f66 2066 6f72 6d20 7b69 6d61 6765 2d66  of form {image-f
+0000ccb0: 696c 652d 6e61 6d65 3a7b 6669 656c 643a  ile-name:{field:
+0000ccc0: 7661 6c75 657d 2c2e 2e2e 7d20 0a20 2020  value},...} .   
+0000ccd0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000cce0: 2069 7465 6d5f 6461 7461 5f63 6f72 6520   item_data_core 
+0000ccf0: 3d20 7365 6c66 2e5f 6765 745f 6974 656d  = self._get_item
+0000cd00: 5f64 6174 615f 6672 6f6d 5f69 6e74 6572  _data_from_inter
+0000cd10: 6d65 6469 6174 655f 6669 6c65 735f 636f  mediate_files_co
+0000cd20: 7265 2829 0a20 2020 2020 2020 2069 7465  re().        ite
+0000cd30: 6d5f 6461 7461 5f6e 6f6e 655f 636f 7265  m_data_none_core
+0000cd40: 203d 2073 656c 662e 5f67 6574 5f69 7465   = self._get_ite
+0000cd50: 6d5f 6461 7461 5f66 726f 6d5f 696e 7465  m_data_from_inte
+0000cd60: 726d 6564 6961 7465 5f66 696c 6573 5f6e  rmediate_files_n
+0000cd70: 6f6e 655f 636f 7265 2829 0a20 2020 2020  one_core().     
+0000cd80: 2020 2023 7070 7269 6e74 2869 7465 6d5f     #pprint(item_
+0000cd90: 6461 7461 5f6e 6f6e 655f 636f 7265 290a  data_none_core).
+0000cda0: 2020 2020 2020 2020 2370 7072 696e 7428          #pprint(
+0000cdb0: 6974 656d 5f64 6174 615f 636f 7265 290a  item_data_core).
+0000cdc0: 2020 2020 2020 2020 6974 656d 5f64 6174          item_dat
+0000cdd0: 6120 3d20 6974 656d 5f64 6174 615f 636f  a = item_data_co
+0000cde0: 7265 0a20 2020 2020 2020 206c 6f67 203d  re.        log =
+0000cdf0: 206d 6971 7463 2e72 6563 7572 7369 7665   miqtc.recursive
+0000ce00: 6c79 5570 6461 7465 4469 6374 7328 6974  lyUpdateDicts(it
+0000ce10: 656d 5f64 6174 612c 2069 7465 6d5f 6461  em_data, item_da
+0000ce20: 7461 5f6e 6f6e 655f 636f 7265 290a 2020  ta_none_core).  
+0000ce30: 2020 2020 2020 2370 7072 696e 7428 6974        #pprint(it
+0000ce40: 656d 5f64 6174 6129 0a20 2020 2020 2020  em_data).       
+0000ce50: 2073 656c 662e 7072 6f76 2e6c 6f67 286c   self.prov.log(l
+0000ce60: 6f67 2c64 6f6e 7453 686f 773d 5472 7565  og,dontShow=True
+0000ce70: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000ce80: 2069 7465 6d5f 6461 7461 0a0a 2020 2020   item_data..    
+0000ce90: 6465 6620 5f67 6574 5f69 7465 6d5f 6461  def _get_item_da
+0000cea0: 7461 5f66 726f 6d5f 696e 7465 726d 6564  ta_from_intermed
+0000ceb0: 6961 7465 5f66 696c 6573 5f6e 6f6e 655f  iate_files_none_
+0000cec0: 636f 7265 2873 656c 6629 3a0a 2020 2020  core(self):.    
+0000ced0: 2020 2020 2222 2220 5265 6164 2064 6174      """ Read dat
+0000cee0: 6120 6672 6f6d 206e 6f6e 2d63 6f72 6520  a from non-core 
+0000cef0: 696e 7465 726d 6465 6174 6520 6669 6c65  intermdeate file
+0000cf00: 732e 0a20 2020 2020 2020 2052 6574 7572  s..        Retur
+0000cf10: 6e73 2064 6963 7420 6f66 2066 6f72 6d20  ns dict of form 
+0000cf20: 7b69 6d61 6765 2d66 696c 652d 6e61 6d65  {image-file-name
+0000cf30: 3a7b 6669 656c 643a 7661 6c75 657d 2c2e  :{field:value},.
+0000cf40: 2e2e 7d20 0a20 2020 2020 2020 2022 2222  ..} .        """
+0000cf50: 0a20 2020 2020 2020 2072 6571 203d 2073  .        req = s
+0000cf60: 656c 662e 6e6f 6e43 6f72 6546 6965 6c64  elf.nonCoreField
+0000cf70: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
+0000cf80: 496e 666f 4669 6c65 730a 0a20 2020 2020  InfoFiles..     
+0000cf90: 2020 2069 7465 6d5f 6461 7461 203d 207b     item_data = {
+0000cfa0: 7d0a 2020 2020 2020 2020 666f 7220 7220  }.        for r 
+0000cfb0: 696e 2072 6571 3a0a 2020 2020 2020 2020  in req:.        
+0000cfc0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+0000cfd0: 7869 7374 7328 722e 6669 6c65 4e61 6d65  xists(r.fileName
+0000cfe0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000cff0: 2020 2073 656c 662e 7072 6173 6549 7465     self.praseIte
+0000d000: 6d44 6174 6146 726f 6d46 696c 6528 6974  mDataFromFile(it
+0000d010: 656d 5f64 6174 612c 722e 6669 6c65 4e61  em_data,r.fileNa
+0000d020: 6d65 2c72 2e73 6570 6172 6174 6f72 2c72  me,r.separator,r
+0000d030: 2e68 6561 6465 722c 2072 2e64 6174 6574  .header, r.datet
+0000d040: 696d 655f 666f 726d 6174 290a 2020 2020  ime_format).    
+0000d050: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000d060: 2e70 726f 762e 6c6f 6728 2250 6172 7365  .prov.log("Parse
+0000d070: 6420 6974 656d 2064 6174 6120 6672 6f6d  d item data from
+0000d080: 3a20 2220 2b20 722e 6669 6c65 4e61 6d65  : " + r.fileName
+0000d090: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0000d0a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000d0b0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+0000d0c0: 6728 2246 696c 6520 646f 6573 206e 6f74  g("File does not
+0000d0d0: 2065 7869 7374 733a 2022 202b 2072 2e66   exists: " + r.f
+0000d0e0: 696c 654e 616d 6529 0a0a 2020 2020 2020  ileName)..      
+0000d0f0: 2020 2320 6368 6563 6b20 6669 6c65 7320    # check files 
+0000d100: 6578 6973 740a 2020 2020 2020 2020 7265  exist.        re
+0000d110: 6d6f 7665 203d 205b 5d0a 2020 2020 2020  move = [].      
+0000d120: 2020 666f 7220 696d 6720 696e 2069 7465    for img in ite
+0000d130: 6d5f 6461 7461 3a0a 2020 2020 2020 2020  m_data:.        
+0000d140: 2020 2020 6966 206e 6f74 2069 6d67 2069      if not img i
+0000d150: 6e20 7365 6c66 2e5f 696d 6167 654e 616d  n self._imageNam
+0000d160: 6573 496d 6167 6573 4469 723a 0a20 2020  esImagesDir:.   
+0000d170: 2020 2020 2020 2020 2020 2020 2072 656d               rem
+0000d180: 6f76 652e 6170 7065 6e64 2869 6d67 290a  ove.append(img).
+0000d190: 2020 2020 2020 2020 666f 7220 696d 6720          for img 
+0000d1a0: 696e 2072 656d 6f76 653a 0a20 2020 2020  in remove:.     
+0000d1b0: 2020 2020 2020 2064 656c 2069 7465 6d5f         del item_
+0000d1c0: 6461 7461 5b69 6d67 5d0a 0a20 2020 2020  data[img]..     
+0000d1d0: 2020 2072 6574 7572 6e20 6974 656d 5f64     return item_d
+0000d1e0: 6174 610a 0a0a 2020 2020 6465 6620 5f67  ata...    def _g
+0000d1f0: 6574 5f69 7465 6d5f 6461 7461 5f66 726f  et_item_data_fro
+0000d200: 6d5f 696e 7465 726d 6564 6961 7465 5f66  m_intermediate_f
+0000d210: 696c 6573 5f63 6f72 6528 7365 6c66 293a  iles_core(self):
+0000d220: 0a20 2020 2020 2020 2022 2222 2052 6561  .        """ Rea
+0000d230: 6420 6461 7461 2066 726f 6d20 636f 7265  d data from core
+0000d240: 2069 6e74 6572 6d64 6561 7465 2066 696c   intermdeate fil
+0000d250: 6573 2c20 6368 6563 6b20 6669 6c65 7320  es, check files 
+0000d260: 6578 6973 742c 2061 6464 2027 696d 6167  exist, add 'imag
+0000d270: 652d 6861 6e64 6c65 272e 0a20 2020 2020  e-handle'..     
+0000d280: 2020 2052 6574 7572 6e73 2064 6963 7420     Returns dict 
+0000d290: 6f66 2066 6f72 6d20 7b69 6d61 6765 2d66  of form {image-f
+0000d2a0: 696c 652d 6e61 6d65 3a7b 6669 656c 643a  ile-name:{field:
+0000d2b0: 7661 6c75 657d 2c2e 2e2e 7d20 0a20 2020  value},...} .   
+0000d2c0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0000d2d0: 2020 2320 5768 6963 6820 6669 6c65 7320    # Which files 
+0000d2e0: 636f 6e74 6169 6e20 7468 6520 696e 666f  contain the info
+0000d2f0: 726d 6174 696f 6e20 6e65 6564 6564 2074  rmation needed t
+0000d300: 6f20 6372 6561 7465 2074 6865 2069 4644  o create the iFD
+0000d310: 4f20 6974 656d 7320 636f 7265 2069 6e66  O items core inf
+0000d320: 6f72 6d61 7469 6f6e 2061 6e64 2077 6869  ormation and whi
+0000d330: 6368 2063 6f6c 756d 6e73 2073 6861 6c6c  ch columns shall
+0000d340: 2062 6520 7573 6564 0a20 2020 2020 2020   be used.       
+0000d350: 2072 6571 203d 2073 656c 662e 696e 7465   req = self.inte
+0000d360: 726d 6564 6961 7465 4669 6c65 7344 6566  rmediateFilesDef
+0000d370: 5f63 6f72 650a 0a20 2020 2020 2020 2069  _core..        i
+0000d380: 7465 6d5f 6461 7461 203d 207b 7d0a 2020  tem_data = {}.  
+0000d390: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
+0000d3a0: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
+0000d3b0: 6772 6573 734d 7367 2822 5061 7273 696e  gressMsg("Parsin
+0000d3c0: 6720 696e 7465 726d 6564 6961 7465 2064  g intermediate d
+0000d3d0: 6174 6122 2c20 6c65 6e28 7265 7129 290a  ata", len(req)).
+0000d3e0: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
+0000d3f0: 2072 6571 3a0a 2020 2020 2020 2020 2020   req:.          
+0000d400: 2020 7072 6f67 2e70 726f 6772 6573 7328    prog.progress(
+0000d410: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
+0000d420: 6c65 203d 2073 656c 662e 5f5f 6765 745f  le = self.__get_
+0000d430: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
+0000d440: 2920 2b20 7265 715b 725d 5b27 7375 6666  ) + req[r]['suff
+0000d450: 6978 275d 0a20 2020 2020 2020 2020 2020  ix'].           
+0000d460: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+0000d470: 6578 6973 7473 2866 696c 6529 3a0a 2020  exists(file):.  
+0000d480: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000d490: 6c66 2e70 726f 762e 6c6f 6728 2257 4152  lf.prov.log("WAR
+0000d4a0: 4e49 4e47 2120 466f 7220 6163 6869 6576  NING! For achiev
+0000d4b0: 696e 6720 4641 4952 6e65 7373 2061 6e20  ing FAIRness an 
+0000d4c0: 696e 7465 726d 6564 6961 7465 2069 6d61  intermediate ima
+0000d4d0: 6765 2069 6e66 6f20 6669 6c65 2069 7320  ge info file is 
+0000d4e0: 6d69 7373 696e 673a 2022 2b20 7365 6c66  missing: "+ self
+0000d4f0: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
+0000d500: 7072 6566 6978 2829 202b 2072 6571 5b72  prefix() + req[r
+0000d510: 5d5b 2773 7566 6669 7827 5d2b 2022 2072  ]['suffix']+ " r
+0000d520: 756e 2066 6972 7374 3a20 2220 2b20 7265  un first: " + re
+0000d530: 715b 725d 5b27 6372 6561 7469 6f6e 4663  q[r]['creationFc
+0000d540: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
+0000d550: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000d560: 2020 2020 2020 2073 656c 662e 7061 7273         self.pars
+0000d570: 6549 7465 6d44 6174 6166 726f 6d54 6162  eItemDatafromTab
+0000d580: 4669 6c65 4461 7461 2869 7465 6d5f 6461  FileData(item_da
+0000d590: 7461 2c20 6669 6c65 2c20 7265 715b 725d  ta, file, req[r]
+0000d5a0: 5b27 636f 6c73 275d 2c20 7265 715b 725d  ['cols'], req[r]
+0000d5b0: 5b27 6f70 7469 6f6e 616c 275d 290a 2020  ['optional']).  
+0000d5c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000d5d0: 6c66 2e70 726f 762e 6c6f 6728 2250 6172  lf.prov.log("Par
+0000d5e0: 7365 6420 6974 656d 2064 6174 6120 6672  sed item data fr
+0000d5f0: 6f6d 3a20 2220 2b20 6669 6c65 290a 0a20  om: " + file).. 
+0000d600: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
+0000d610: 7228 290a 2020 2020 2020 2020 6966 206c  r().        if l
+0000d620: 656e 2869 7465 6d5f 6461 7461 2920 3d3d  en(item_data) ==
+0000d630: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0000d640: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+0000d650: 224e 6f20 6946 444f 2069 7465 6d73 2229  "No iFDO items")
+0000d660: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
+0000d670: 6b20 6669 6c65 7320 6578 6973 740a 2020  k files exist.  
+0000d680: 2020 2020 2020 7265 6d6f 7665 203d 205b        remove = [
+0000d690: 5d0a 2020 2020 2020 2020 666f 7220 696d  ].        for im
+0000d6a0: 6720 696e 2069 7465 6d5f 6461 7461 3a0a  g in item_data:.
+0000d6b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000d6c0: 6f74 2069 6d67 2069 6e20 7365 6c66 2e5f  ot img in self._
+0000d6d0: 696d 6167 654e 616d 6573 496d 6167 6573  imageNamesImages
+0000d6e0: 4469 723a 0a20 2020 2020 2020 2020 2020  Dir:.           
+0000d6f0: 2020 2020 2072 656d 6f76 652e 6170 7065       remove.appe
+0000d700: 6e64 2869 6d67 290a 2020 2020 2020 2020  nd(img).        
+0000d710: 666f 7220 696d 6720 696e 2072 656d 6f76  for img in remov
+0000d720: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
+0000d730: 656c 2069 7465 6d5f 6461 7461 5b69 6d67  el item_data[img
+0000d740: 5d0a 0a20 2020 2020 2020 2023 2061 6464  ]..        # add
+0000d750: 2069 6d61 6765 2d75 726c 0a20 2020 2020   image-url.     
+0000d760: 2020 2066 6f72 2069 6d67 2069 6e20 6974     for img in it
+0000d770: 656d 5f64 6174 613a 0a20 2020 2020 2020  em_data:.       
+0000d780: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0000d790: 6365 2869 7465 6d5f 6461 7461 5b69 6d67  ce(item_data[img
+0000d7a0: 5d2c 6c69 7374 293a 2023 2069 7465 6d20  ],list): # item 
+0000d7b0: 6973 2061 6c72 6561 6479 2061 206c 6973  is already a lis
+0000d7c0: 7420 2876 6964 656f 2920 6275 7420 7061  t (video) but pa
+0000d7d0: 7273 6564 2064 6174 6120 6973 206e 6f74  rsed data is not
+0000d7e0: 2c20 692e 652e 2070 6172 7365 6420 6461  , i.e. parsed da
+0000d7f0: 7461 2072 6566 6572 7320 746f 2077 686f  ta refers to who
+0000d800: 6c65 2076 6964 656f 2028 7469 6d65 2069  le video (time i
+0000d810: 6e64 6570 656e 6465 6e74 292c 2069 2e65  ndependent), i.e
+0000d820: 2e20 7772 6974 6520 746f 2066 6972 7374  . write to first
+0000d830: 2065 6e74 7279 0a20 2020 2020 2020 2020   entry.         
+0000d840: 2020 2020 2020 2075 7569 6420 3d20 6669         uuid = fi
+0000d850: 6e64 4669 656c 6428 6974 656d 5f64 6174  ndField(item_dat
+0000d860: 615b 696d 675d 5b30 5d2c 2769 6d61 6765  a[img][0],'image
+0000d870: 2d75 7569 6427 290a 2020 2020 2020 2020  -uuid').        
+0000d880: 2020 2020 2020 2020 6966 2075 7569 6420          if uuid 
+0000d890: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
+0000d8a0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000d8b0: 2869 7465 6d5f 6461 7461 5b69 6d67 5d29  (item_data[img])
+0000d8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d8d0: 2020 2020 2072 6169 7365 206d 6971 7463       raise miqtc
+0000d8e0: 2e49 6664 6f45 7863 6570 7469 6f6e 2822  .IfdoException("
+0000d8f0: 7575 6964 206e 6f74 2066 6f75 6e64 2028  uuid not found (
+0000d900: 6129 2229 0a20 2020 2020 2020 2020 2020  a)").           
+0000d910: 2020 2020 2069 7465 6d5f 6461 7461 5b69       item_data[i
+0000d920: 6d67 5d5b 305d 5b27 696d 6167 652d 6861  mg][0]['image-ha
+0000d930: 6e64 6c65 275d 203d 2073 656c 662e 696d  ndle'] = self.im
+0000d940: 6167 655f 6861 6e64 6c65 5f70 7265 6669  age_handle_prefi
+0000d950: 7820 2b20 2740 2720 2b20 7575 6964 0a20  x + '@' + uuid. 
+0000d960: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000d970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d980: 2075 7569 6420 3d20 6669 6e64 4669 656c   uuid = findFiel
+0000d990: 6428 6974 656d 5f64 6174 615b 696d 675d  d(item_data[img]
+0000d9a0: 2c27 696d 6167 652d 7575 6964 2729 0a20  ,'image-uuid'). 
+0000d9b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000d9c0: 6620 7575 6964 203d 3d20 2222 3a0a 2020  f uuid == "":.  
+0000d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d9e0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+0000d9f0: 646f 4578 6365 7074 696f 6e28 2275 7569  doException("uui
+0000da00: 6420 6e6f 7420 666f 756e 6420 2862 2922  d not found (b)"
+0000da10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000da20: 2020 6974 656d 5f64 6174 615b 696d 675d    item_data[img]
+0000da30: 5b27 696d 6167 652d 6861 6e64 6c65 275d  ['image-handle']
+0000da40: 203d 2073 656c 662e 696d 6167 655f 6861   = self.image_ha
+0000da50: 6e64 6c65 5f70 7265 6669 7820 2b20 2740  ndle_prefix + '@
+0000da60: 2720 2b20 7575 6964 0a0a 2020 2020 2020  ' + uuid..      
+0000da70: 2020 7265 7475 726e 2069 7465 6d5f 6461    return item_da
+0000da80: 7461 0a0a 0a20 2020 2064 6566 2061 6464  ta...    def add
+0000da90: 5f69 7465 6d5f 696e 666f 5f74 6162 5f66  _item_info_tab_f
+0000daa0: 696c 6528 7365 6c66 2c20 6669 6c65 4e61  ile(self, fileNa
+0000dab0: 6d65 3a20 7374 722c 2073 6570 6172 6174  me: str, separat
+0000dac0: 6f72 3a73 7472 2c20 6865 6164 6572 3a64  or:str, header:d
+0000dad0: 6963 742c 2064 6174 6574 696d 655f 666f  ict, datetime_fo
+0000dae0: 726d 6174 203d 206d 6971 7476 2e64 6174  rmat = miqtv.dat
+0000daf0: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
+0000db00: 7427 5d29 3a0a 2020 2020 2020 2020 2222  t']):.        ""
+0000db10: 2220 4164 6420 6120 636f 6c75 6d6e 2073  " Add a column s
+0000db20: 6570 6572 6174 6564 2074 6578 7420 6669  eperated text fi
+0000db30: 6c65 2074 6f20 7061 7273 6520 6974 656d  le to parse item
+0000db40: 2064 6174 6120 6672 6f6d 2062 7920 6372   data from by cr
+0000db50: 6561 7465 4361 7074 7572 6541 6e64 436f  eateCaptureAndCo
+0000db60: 6e74 656e 7446 6965 6c64 7328 292e 200a  ntentFields(). .
+0000db70: 2020 2020 2020 2020 436f 6c75 6d6e 7320          Columns 
+0000db80: 6865 6164 6572 7320 7769 6c6c 2062 6520  headers will be 
+0000db90: 7365 7420 6173 2069 7465 6d20 6669 656c  set as item fiel
+0000dba0: 6420 6e61 6d65 732e 204d 7573 7420 636f  d names. Must co
+0000dbb0: 6e74 6169 6e20 636f 6c75 6d6e 2027 696d  ntain column 'im
+0000dbc0: 6167 652d 6669 6c65 6e61 6d65 272e 0a20  age-filename'.. 
+0000dbd0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000dbe0: 2020 2069 6620 6669 6c65 4e61 6d65 203d     if fileName =
+0000dbf0: 3d20 4e6f 6e65 206f 7220 6e6f 7420 6f73  = None or not os
+0000dc00: 2e70 6174 682e 6578 6973 7473 2866 696c  .path.exists(fil
+0000dc10: 654e 616d 6529 3a0a 2020 2020 2020 2020  eName):.        
+0000dc20: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+0000dc30: 696f 6e28 2246 696c 6522 2c66 696c 654e  ion("File",fileN
+0000dc40: 616d 652c 226e 6f74 2066 6f75 6e64 2229  ame,"not found")
+0000dc50: 0a0a 2020 2020 2020 2020 666f 7220 6669  ..        for fi
+0000dc60: 656c 6420 696e 2068 6561 6465 723a 0a20  eld in header:. 
+0000dc70: 2020 2020 2020 2020 2020 2069 6620 6865             if he
+0000dc80: 6164 6572 5b66 6965 6c64 5d20 6e6f 7420  ader[field] not 
+0000dc90: 696e 206d 6971 7466 2e74 6162 4669 6c65  in miqtf.tabFile
+0000dca0: 436f 6c75 6d6e 4e61 6d65 7328 6669 6c65  ColumnNames(file
+0000dcb0: 4e61 6d65 2c63 6f6c 5f73 6570 6172 6174  Name,col_separat
+0000dcc0: 6f72 3d73 6570 6172 6174 6f72 293a 0a20  or=separator):. 
+0000dcd0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000dce0: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
+0000dcf0: 436f 6c75 6d6e 222c 2068 6561 6465 725b  Column", header[
+0000dd00: 6669 656c 645d 2c20 226e 6f74 2069 6e20  field], "not in 
+0000dd10: 6669 6c65 222c 2066 696c 654e 616d 6529  file", fileName)
+0000dd20: 0a0a 2020 2020 2020 2020 6966 206d 6971  ..        if miq
+0000dd30: 7463 2e61 7373 6572 7453 6c61 7368 286f  tc.assertSlash(o
+0000dd40: 732e 7061 7468 2e64 6972 6e61 6d65 2866  s.path.dirname(f
+0000dd50: 696c 654e 616d 6529 2920 213d 206d 6971  ileName)) != miq
+0000dd60: 7463 2e61 7373 6572 7453 6c61 7368 2873  tc.assertSlash(s
+0000dd70: 656c 662e 6469 722e 746f 2873 656c 662e  elf.dir.to(self.
+0000dd80: 6469 722e 6474 2e69 6e74 6572 6d65 6469  dir.dt.intermedi
+0000dd90: 6174 6529 293a 0a20 2020 2020 2020 2020  ate)):.         
+0000dda0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+0000ddb0: 2820 2243 6175 7469 6f6e 2120 4974 2069  ( "Caution! It i
+0000ddc0: 7320 7265 636f 6d6d 656e 6465 6420 746f  s recommended to
+0000ddd0: 2070 7574 2066 696c 6520 696e 2074 6865   put file in the
+0000dde0: 2064 6972 6563 746f 7279 2773 2027 696e   directory's 'in
+0000ddf0: 7465 726d 6564 6961 7465 2720 666f 6c64  termediate' fold
+0000de00: 6572 3a20 2220 2b20 6669 6c65 4e61 6d65  er: " + fileName
+0000de10: 290a 2020 2020 2020 2020 6e63 6669 6966  ).        ncfiif
+0000de20: 203d 206e 6f6e 436f 7265 4669 656c 6449   = nonCoreFieldI
+0000de30: 6e74 6572 6d65 6469 6174 6549 7465 6d49  ntermediateItemI
+0000de40: 6e66 6f46 696c 6528 6669 6c65 4e61 6d65  nfoFile(fileName
+0000de50: 2c20 7365 7061 7261 746f 722c 2068 6561  , separator, hea
+0000de60: 6465 722c 2064 6174 6574 696d 655f 666f  der, datetime_fo
+0000de70: 726d 6174 290a 2020 2020 2020 2020 6966  rmat).        if
+0000de80: 206e 6366 6969 6620 6e6f 7420 696e 2073   ncfiif not in s
+0000de90: 656c 662e 6e6f 6e43 6f72 6546 6965 6c64  elf.nonCoreField
+0000dea0: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
+0000deb0: 496e 666f 4669 6c65 733a 200a 2020 2020  InfoFiles: .    
+0000dec0: 2020 2020 2020 2020 7365 6c66 2e6e 6f6e          self.non
+0000ded0: 436f 7265 4669 656c 6449 6e74 6572 6d65  CoreFieldInterme
+0000dee0: 6469 6174 6549 7465 6d49 6e66 6f46 696c  diateItemInfoFil
+0000def0: 6573 2e61 7070 656e 6428 6e63 6669 6966  es.append(ncfiif
+0000df00: 290a 0a20 2020 2064 6566 2061 6464 4974  )..    def addIt
+0000df10: 656d 496e 666f 5461 6246 696c 6528 7365  emInfoTabFile(se
+0000df20: 6c66 2c20 6669 6c65 4e61 6d65 3a20 7374  lf, fileName: st
+0000df30: 722c 2073 6570 6172 6174 6f72 3a73 7472  r, separator:str
+0000df40: 2c20 6865 6164 6572 3a64 6963 742c 2064  , header:dict, d
+0000df50: 6174 6574 696d 655f 666f 726d 6174 203d  atetime_format =
+0000df60: 206d 6971 7476 2e64 6174 655f 666f 726d   miqtv.date_form
+0000df70: 6174 735b 276d 6172 6971 7427 5d29 3a0a  ats['mariqt']):.
+0000df80: 2020 2020 2020 2020 2222 2220 4465 7072          """ Depr
+0000df90: 6563 6174 6564 202d 2075 7365 2061 6464  ecated - use add
+0000dfa0: 5f69 7465 6d5f 696e 666f 5f74 6162 5f66  _item_info_tab_f
+0000dfb0: 696c 6520 2222 220a 2020 2020 2020 2020  ile """.        
+0000dfc0: 7365 6c66 2e61 6464 5f69 7465 6d5f 696e  self.add_item_in
+0000dfd0: 666f 5f74 6162 5f66 696c 6528 6669 6c65  fo_tab_file(file
+0000dfe0: 4e61 6d65 2c73 6570 6172 6174 6f72 2c68  Name,separator,h
+0000dff0: 6561 6465 722c 6461 7465 7469 6d65 5f66  eader,datetime_f
+0000e000: 6f72 6d61 7429 0a0a 2020 2020 2020 2020  ormat)..        
+0000e010: 0a20 2020 2064 6566 2072 656d 6f76 6549  .    def removeI
+0000e020: 7465 6d49 6e66 6f54 6162 4669 6c65 2873  temInfoTabFile(s
+0000e030: 656c 662c 2066 696c 654e 616d 653a 2073  elf, fileName: s
+0000e040: 7472 2c20 7365 7061 7261 746f 723a 7374  tr, separator:st
+0000e050: 722c 2068 6561 6465 723a 6469 6374 2c20  r, header:dict, 
+0000e060: 6461 7465 7469 6d65 5f66 6f72 6d61 743a  datetime_format:
+0000e070: 7374 7229 3a0a 2020 2020 2020 2020 2222  str):.        ""
+0000e080: 2220 7265 6d6f 7665 7320 6669 6c65 2069  " removes file i
+0000e090: 7465 6d20 6672 6f6d 206c 6973 7420 6f66  tem from list of
+0000e0a0: 2066 696c 6573 2074 6f20 7061 7273 6520   files to parse 
+0000e0b0: 6974 656d 2064 6174 6120 6672 6f6d 2062  item data from b
+0000e0c0: 7920 6372 6561 7465 4361 7074 7572 6541  y createCaptureA
+0000e0d0: 6e64 436f 6e74 656e 7446 6965 6c64 7328  ndContentFields(
+0000e0e0: 2920 2222 220a 2020 2020 2020 2020 6e63  ) """.        nc
+0000e0f0: 6669 6966 203d 206e 6f6e 436f 7265 4669  fiif = nonCoreFi
+0000e100: 656c 6449 6e74 6572 6d65 6469 6174 6549  eldIntermediateI
+0000e110: 7465 6d49 6e66 6f46 696c 6528 6669 6c65  temInfoFile(file
+0000e120: 4e61 6d65 2c20 7365 7061 7261 746f 722c  Name, separator,
+0000e130: 2068 6561 6465 722c 2064 6174 6574 696d   header, datetim
+0000e140: 655f 666f 726d 6174 290a 2020 2020 2020  e_format).      
+0000e150: 2020 6966 206e 6366 6969 6620 696e 2073    if ncfiif in s
+0000e160: 656c 662e 6e6f 6e43 6f72 6546 6965 6c64  elf.nonCoreField
+0000e170: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
+0000e180: 496e 666f 4669 6c65 733a 200a 2020 2020  InfoFiles: .    
+0000e190: 2020 2020 2020 2020 7365 6c66 2e6e 6f6e          self.non
+0000e1a0: 436f 7265 4669 656c 6449 6e74 6572 6d65  CoreFieldInterme
+0000e1b0: 6469 6174 6549 7465 6d49 6e66 6f46 696c  diateItemInfoFil
+0000e1c0: 6573 2e72 656d 6f76 6528 6e63 6669 6966  es.remove(ncfiif
+0000e1d0: 290a 0a0a 2020 2020 6465 6620 7570 6461  )...    def upda
+0000e1e0: 7465 6946 444f 2873 656c 662c 2068 6561  teiFDO(self, hea
+0000e1f0: 6465 723a 2064 6963 742c 2069 7465 6d73  der: dict, items
+0000e200: 3a20 6c69 7374 2c20 6865 6164 6572 5f6f  : list, header_o
+0000e210: 6e6c 793d 4661 6c73 6529 3a0a 2020 2020  nly=False):.    
+0000e220: 2020 2020 2222 2220 5570 6461 7465 7320      """ Updates 
+0000e230: 7468 6520 6375 7272 656e 7420 7661 6c75  the current valu
+0000e240: 6573 2069 4644 4f20 7769 7468 2074 6865  es iFDO with the
+0000e250: 2070 726f 7669 6465 6420 6e65 7720 7661   provided new va
+0000e260: 6c75 6573 2022 2222 0a20 2020 2020 2020  lues """.       
+0000e270: 2072 6574 7572 6e20 7365 6c66 2e63 7265   return self.cre
+0000e280: 6174 6569 4644 4f28 6865 6164 6572 2c20  ateiFDO(header, 
+0000e290: 6974 656d 732c 2075 7064 6174 6545 7869  items, updateExi
+0000e2a0: 7374 696e 673d 5472 7565 2c20 6865 6164  sting=True, head
+0000e2b0: 6572 4f6e 6c79 3d68 6561 6465 725f 6f6e  erOnly=header_on
+0000e2c0: 6c79 290a 0a0a 2020 2020 6465 6620 6372  ly)...    def cr
+0000e2d0: 6561 7465 6946 444f 2873 656c 662c 2068  eateiFDO(self, h
+0000e2e0: 6561 6465 723a 2064 6963 742c 2069 7465  eader: dict, ite
+0000e2f0: 6d73 3a20 6c69 7374 2c20 7570 6461 7465  ms: list, update
+0000e300: 4578 6973 7469 6e67 3d46 616c 7365 2c68  Existing=False,h
+0000e310: 6561 6465 724f 6e6c 793d 4661 6c73 652c  eaderOnly=False,
+0000e320: 616c 6c6f 775f 6d69 7373 696e 675f 7265  allow_missing_re
+0000e330: 7175 6972 6564 3d46 616c 7365 293a 0a20  quired=False):. 
+0000e340: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
+0000e350: 6573 2046 4149 5220 6469 6769 7461 6c20  es FAIR digital 
+0000e360: 6f62 6a65 6374 2066 6f72 2074 6865 2069  object for the i
+0000e370: 6d61 6765 2064 6174 6120 6974 7365 6c66  mage data itself
+0000e380: 2e20 5468 6973 2063 6f6e 7369 7374 7320  . This consists 
+0000e390: 6f66 2068 6561 6465 7220 696e 666f 726d  of header inform
+0000e3a0: 6174 696f 6e20 616e 6420 6974 656d 2069  ation and item i
+0000e3b0: 6e66 6f72 6d61 7469 6f6e 2e0a 2020 2020  nformation..    
+0000e3c0: 2020 2020 7570 6461 7465 4578 6973 7469      updateExisti
+0000e3d0: 6e67 3a20 6966 2046 616c 7365 206f 6c64  ng: if False old
+0000e3e0: 2076 616c 7565 7320 6172 6520 7265 6d6f   values are remo
+0000e3f0: 7665 642c 206f 7468 6572 7769 7365 2074  ved, otherwise t
+0000e400: 6865 7920 6172 6520 7570 6461 7465 642e  hey are updated.
+0000e410: 0a20 2020 2020 2020 2068 6561 6465 724f  .        headerO
+0000e420: 6e6c 793a 2069 6620 5472 7565 2069 7465  nly: if True ite
+0000e430: 6d73 206d 6179 2062 6520 656d 7074 7920  ms may be empty 
+0000e440: 6c69 7374 2e0a 2020 2020 2020 2020 616c  list..        al
+0000e450: 6c6f 775f 6d69 7373 696e 675f 7265 7175  low_missing_requ
+0000e460: 6972 6564 3a20 6966 2054 7275 652c 206e  ired: if True, n
+0000e470: 6f20 6578 6365 7074 696f 6e20 7269 7365  o exception rise
+0000e480: 6e20 6966 2061 2072 6571 7569 7265 6420  n if a required 
+0000e490: 6669 656c 6420 6973 206d 6973 7369 6e67  field is missing
+0000e4a0: 2e20 2022 2222 0a0a 2020 2020 2020 2020  .  """..        
+0000e4b0: 6966 206e 6f74 2075 7064 6174 6545 7869  if not updateExi
+0000e4c0: 7374 696e 6720 616e 6420 6c65 6e28 6974  sting and len(it
+0000e4d0: 656d 7329 203d 3d20 3020 616e 6420 6e6f  ems) == 0 and no
+0000e4e0: 7420 6865 6164 6572 4f6e 6c79 3a0a 2020  t headerOnly:.  
+0000e4f0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000e500: 4578 6365 7074 696f 6e28 274e 6f20 6974  Exception('No it
+0000e510: 656d 2069 6e66 6f72 6d61 7469 6f6e 2067  em information g
+0000e520: 6976 656e 2729 0a0a 2020 2020 2020 2020  iven')..        
+0000e530: 6966 2075 7064 6174 6545 7869 7374 696e  if updateExistin
+0000e540: 673a 0a20 2020 2020 2020 2020 2020 2023  g:.            #
+0000e550: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
+0000e560: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
+0000e570: 6966 646f 5f68 6561 6465 725f 6669 656c  ifdo_header_fiel
+0000e580: 6473 2868 6561 6465 7229 0a20 2020 2020  ds(header).     
+0000e590: 2020 2020 2020 2023 2069 7465 6d73 0a20         # items. 
+0000e5a0: 2020 2020 2020 2020 2020 2023 2075 7064             # upd
+0000e5b0: 6174 6520 636f 7079 206f 6620 6375 7272  ate copy of curr
+0000e5c0: 656e 7420 6974 656d 7320 7769 7468 206e  ent items with n
+0000e5d0: 6577 2069 7465 6d73 2066 6965 6c64 730a  ew items fields.
+0000e5e0: 2020 2020 2020 2020 2020 2020 6974 656d              item
+0000e5f0: 7344 6963 7420 3d20 6d69 7174 692e 6372  sDict = miqti.cr
+0000e600: 6561 7465 496d 6167 6549 7465 6d73 4469  eateImageItemsDi
+0000e610: 6374 4672 6f6d 496d 6167 6549 7465 6d73  ctFromImageItems
+0000e620: 4c69 7374 2869 7465 6d73 290a 2020 2020  List(items).    
+0000e630: 2020 2020 2020 2020 7570 6461 7465 6449          updatedI
+0000e640: 7465 6d73 5f63 6f70 7920 3d20 636f 7079  tems_copy = copy
+0000e650: 2e64 6565 7063 6f70 7928 7365 6c66 2e69  .deepcopy(self.i
+0000e660: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+0000e670: 6765 5365 7449 7465 6d73 4b65 795d 290a  geSetItemsKey]).
+0000e680: 2020 2020 2020 2020 2020 2020 6c6f 6720              log 
+0000e690: 3d20 6d69 7174 632e 7265 6375 7273 6976  = miqtc.recursiv
+0000e6a0: 656c 7955 7064 6174 6544 6963 7473 2875  elyUpdateDicts(u
+0000e6b0: 7064 6174 6564 4974 656d 735f 636f 7079  pdatedItems_copy
+0000e6c0: 2c20 6974 656d 7344 6963 7429 0a20 2020  , itemsDict).   
+0000e6d0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0000e6e0: 6f76 2e6c 6f67 286c 6f67 2c64 6f6e 7453  ov.log(log,dontS
+0000e6f0: 686f 773d 5472 7565 290a 2020 2020 2020  how=True).      
+0000e700: 2020 2020 2020 6974 656d 7320 3d20 6d69        items = mi
+0000e710: 7174 692e 6372 6561 7465 496d 6167 6549  qti.createImageI
+0000e720: 7465 6d73 4c69 7374 4672 6f6d 496d 6167  temsListFromImag
+0000e730: 6549 7465 6d73 4469 6374 2875 7064 6174  eItemsDict(updat
+0000e740: 6564 4974 656d 735f 636f 7079 290a 0a20  edItems_copy).. 
+0000e750: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000e760: 2020 2020 2020 2020 2023 206f 7665 7277           # overw
+0000e770: 7269 7465 2068 6561 6465 720a 2020 2020  rite header.    
+0000e780: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
+0000e790: 6946 444f 4865 6164 6572 4669 656c 6473  iFDOHeaderFields
+0000e7a0: 2868 6561 6465 7229 0a20 2020 2020 2020  (header).       
+0000e7b0: 2020 2020 2023 2063 6c65 6172 2069 7465       # clear ite
+0000e7c0: 6d73 2073 6563 7469 6f6e 0a20 2020 2020  ms section.     
+0000e7d0: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
+0000e7e0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000e7f0: 6574 4974 656d 734b 6579 5d20 3d20 7b7d  etItemsKey] = {}
+0000e800: 0a0a 0a20 2020 2020 2020 2023 2050 6172  ...        # Par
+0000e810: 7365 2069 6d61 6765 2d61 6273 7472 6163  se image-abstrac
+0000e820: 7420 616e 6420 6669 6c6c 2069 7473 2070  t and fill its p
+0000e830: 6c61 6365 686f 6c64 6572 7320 7769 7468  laceholders with
+0000e840: 2069 6e66 6f72 6d61 7469 6f6e 0a20 2020   information.   
+0000e850: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000e860: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+0000e870: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000e880: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
+0000e890: 6765 2d61 6273 7472 6163 7427 5d20 3d20  ge-abstract'] = 
+0000e8a0: 6d69 7174 732e 7061 7273 6552 6570 6c61  miqts.parseRepla
+0000e8b0: 6365 5661 6c28 7365 6c66 2e69 6664 6f5f  ceVal(self.ifdo_
+0000e8c0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000e8d0: 7448 6561 6465 724b 6579 5d2c 2027 696d  tHeaderKey], 'im
+0000e8e0: 6167 652d 6162 7374 7261 6374 2729 0a20  age-abstract'). 
+0000e8f0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+0000e900: 6365 7074 696f 6e20 6173 2065 783a 0a20  ception as ex:. 
+0000e910: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000e920: 7072 6f76 2e6c 6f67 2822 436f 756c 6420  prov.log("Could 
+0000e930: 6e6f 7420 7265 706c 6163 6520 6b65 7973  not replace keys
+0000e940: 2069 6e20 5c27 696d 6167 652d 6162 7374   in \'image-abst
+0000e950: 7261 6374 5c27 3a20 2220 2b20 7374 7228  ract\': " + str(
+0000e960: 6578 2929 0a0a 0a20 2020 2020 2020 2023  ex))...        #
+0000e970: 2073 6574 2076 6572 7369 6f6e 2028 736f   set version (so
+0000e980: 2069 7420 6361 6e6e 6f74 2062 6520 6368   it cannot be ch
+0000e990: 616e 6765 6420 6279 2075 7365 7229 0a20  anged by user). 
+0000e9a0: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
+0000e9b0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000e9c0: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
+0000e9d0: 6167 652d 7365 742d 6966 646f 2d76 6572  age-set-ifdo-ver
+0000e9e0: 7369 6f6e 275d 203d 206d 6971 7476 2e69  sion'] = miqtv.i
+0000e9f0: 4644 4f5f 7665 7273 696f 6e0a 0a20 2020  FDO_version..   
+0000ea00: 2020 2020 2023 2056 616c 6964 6174 6520       # Validate 
+0000ea10: 6974 656d 2069 6e66 6f72 6d61 7469 6f6e  item information
+0000ea20: 0a20 2020 2020 2020 2069 6d61 6765 5f73  .        image_s
+0000ea30: 6574 5f69 7465 6d73 203d 207b 7d0a 2020  et_items = {}.  
+0000ea40: 2020 2020 2020 6966 2068 6561 6465 724f        if headerO
+0000ea50: 6e6c 793a 0a20 2020 2020 2020 2020 2020  nly:.           
+0000ea60: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+0000ea70: 4361 7574 696f 6e21 2069 4644 4f20 6372  Caution! iFDO cr
+0000ea80: 6561 7465 6420 696e 2068 6561 6465 725f  eated in header_
+0000ea90: 6f6e 6c79 2f69 676e 6f72 655f 696d 6167  only/ignore_imag
+0000eaa0: 655f 6669 6c65 206d 6f64 652e 2049 6d61  e_file mode. Ima
+0000eab0: 6765 2069 7465 6d73 2061 7265 206e 6569  ge items are nei
+0000eac0: 7468 6572 2075 7064 6174 6564 206e 6f72  ther updated nor
+0000ead0: 2063 6865 636b 6564 2e22 290a 2020 2020   checked.").    
+0000eae0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000eaf0: 2020 2020 2020 696e 7661 6c69 645f 6974        invalid_it
+0000eb00: 656d 7320 3d20 300a 0a20 2020 2020 2020  ems = 0..       
+0000eb10: 2020 2020 2070 726f 6720 3d20 6d69 7174       prog = miqt
+0000eb20: 632e 5072 696e 744b 6e6f 776e 5072 6f67  c.PrintKnownProg
+0000eb30: 7265 7373 4d73 6728 2243 6865 636b 696e  ressMsg("Checkin
+0000eb40: 6720 6974 656d 7322 2c20 6c65 6e28 6974  g items", len(it
+0000eb50: 656d 7329 2c6d 6f64 756c 6f3d 3529 0a20  ems),modulo=5). 
+0000eb60: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+0000eb70: 7465 6d20 696e 2069 7465 6d73 3a0a 2020  tem in items:.  
+0000eb80: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0000eb90: 6f67 2e70 726f 6772 6573 7328 290a 2020  og.progress().  
+0000eba0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000ebb0: 6368 6563 6b20 6966 2061 6c6c 2063 6f72  check if all cor
+0000ebc0: 6520 6669 656c 6473 2061 7265 2066 696c  e fields are fil
+0000ebd0: 6c65 6420 616e 6420 6172 6520 6669 6c6c  led and are fill
+0000ebe0: 6564 2076 616c 6964 6c79 0a20 2020 2020  ed validly.     
+0000ebf0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0000ec00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ec10: 2020 2020 2023 2063 6865 636b 2069 7465       # check ite
+0000ec20: 6d20 696d 6167 6520 6578 6973 7473 0a20  m image exists. 
 0000ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec40: 2020 2020 2020 2020 2020 2073 7562 4974             subIt
-0000ec50: 656d 4469 6374 5b69 745d 203d 2073 7562  emDict[it] = sub
-0000ec60: 4974 656d 5b69 745d 0a20 2020 2020 2020  Item[it].       
-0000ec70: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
-0000ec80: 6765 5f73 6574 5f69 7465 6d73 5b73 7562  ge_set_items[sub
-0000ec90: 4974 656d 4465 6661 756c 745b 2769 6d61  ItemDefault['ima
-0000eca0: 6765 2d66 696c 656e 616d 6527 5d5d 2e61  ge-filename']].a
-0000ecb0: 7070 656e 6428 7375 6249 7465 6d44 6963  ppend(subItemDic
-0000ecc0: 7429 0a20 2020 2020 2020 2020 2020 200a  t).            .
-0000ecd0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0000ece0: 7074 206d 6971 7463 2e49 6664 6f45 7863  pt miqtc.IfdoExc
-0000ecf0: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
-0000ed00: 2020 2020 2020 2020 2020 2020 2069 6e76               inv
-0000ed10: 616c 6964 5f69 7465 6d73 202b 3d20 310a  alid_items += 1.
-0000ed20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed30: 7365 6c66 2e70 726f 762e 6c6f 6728 2249  self.prov.log("I
-0000ed40: 6e76 616c 6964 2069 6d61 6765 2069 7465  nvalid image ite
-0000ed50: 6d3a 2022 2b20 7374 7228 6974 656d 292c  m: "+ str(item),
-0000ed60: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
-0000ed70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000ed80: 656c 662e 7072 6f76 2e6c 6f67 2822 4578  elf.prov.log("Ex
-0000ed90: 6365 7074 696f 6e3a 5c6e 222b 2073 7472  ception:\n"+ str
-0000eda0: 2865 2e61 7267 7329 2c64 6f6e 7453 686f  (e.args),dontSho
-0000edb0: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
-0000edc0: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
-0000edd0: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
-0000ede0: 6e28 2249 6e76 616c 6964 2069 6d61 6765  n("Invalid image
-0000edf0: 2069 7465 6d20 222b 2066 696c 655f 6e61   item "+ file_na
-0000ee00: 6d65 202b 2022 3a5c 6e45 7863 6570 7469  me + ":\nExcepti
-0000ee10: 6f6e 3a5c 6e22 2b20 7374 7228 652e 6172  on:\n"+ str(e.ar
-0000ee20: 6773 2929 2023 206f 7468 6572 7769 7365  gs)) # otherwise
-0000ee30: 2c20 696e 2063 6173 6520 6f66 206d 616e  , in case of man
-0000ee40: 7920 696d 6167 6573 2c20 6974 206d 6179  y images, it may
-0000ee50: 206b 6565 7020 7275 6e6e 696e 6720 616e   keep running an
-0000ee60: 6420 7468 726f 7769 6e67 2065 7272 6f72  d throwing error
-0000ee70: 7320 666f 7220 7175 6974 2073 6f6d 6520  s for quit some 
-0000ee80: 7469 6d65 0a20 2020 2020 2020 2070 726f  time.        pro
-0000ee90: 672e 636c 6561 7228 290a 0a20 2020 2020  g.clear()..     
-0000eea0: 2020 2069 6620 6c65 6e28 6974 656d 7329     if len(items)
-0000eeb0: 2021 3d20 3020 616e 6420 696e 7661 6c69   != 0 and invali
-0000eec0: 645f 6974 656d 7320 3d3d 206c 656e 2869  d_items == len(i
-0000eed0: 7465 6d73 293a 0a20 2020 2020 2020 2020  tems):.         
-0000eee0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-0000eef0: 6f6e 2822 416c 6c20 6974 656d 7320 6172  on("All items ar
-0000ef00: 6520 696e 7661 6c69 6422 290a 2020 2020  e invalid").    
-0000ef10: 2020 2020 656c 6966 2069 6e76 616c 6964      elif invalid
-0000ef20: 5f69 7465 6d73 203e 2030 3a0a 2020 2020  _items > 0:.    
-0000ef30: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-0000ef40: 762e 6c6f 6728 2241 7420 6c65 6173 7420  v.log("At least 
-0000ef50: 2220 2b20 7374 7228 696e 7661 6c69 645f  " + str(invalid_
-0000ef60: 6974 656d 7329 202b 2022 2069 7465 6d73  items) + " items
-0000ef70: 2077 6572 6520 696e 7661 6c69 6420 286f   were invalid (o
-0000ef80: 6622 202b 2073 7472 286c 656e 2869 7465  f" + str(len(ite
-0000ef90: 6d73 2929 2b20 2229 2229 0a0a 2020 2020  ms))+ ")")..    
-0000efa0: 2020 2020 2320 5661 6c69 6461 7465 2068      # Validate h
-0000efb0: 6561 6465 7220 696e 666f 726d 6174 696f  eader informatio
-0000efc0: 6e0a 2020 2020 2020 2020 7472 793a 0a20  n.        try:. 
-0000efd0: 2020 2020 2020 2020 2020 206d 6971 7474             miqtt
-0000efe0: 2e61 7265 5f76 616c 6964 5f69 6664 6f5f  .are_valid_ifdo_
-0000eff0: 6669 656c 6473 2873 656c 662e 6966 646f  fields(self.ifdo
-0000f000: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000f010: 6574 4865 6164 6572 4b65 795d 290a 2020  etHeaderKey]).  
-0000f020: 2020 2020 2020 6578 6365 7074 206d 6971        except miq
-0000f030: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-0000f040: 2061 7320 6578 3a0a 2020 2020 2020 2020   as ex:.        
-0000f050: 2020 2020 6d73 6720 3d20 2249 6e76 616c      msg = "Inval
-0000f060: 6964 2068 6561 6465 7220 6669 656c 643a  id header field:
-0000f070: 2022 202b 2073 7472 2865 7829 0a20 2020   " + str(ex).   
-0000f080: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-0000f090: 6f76 2e6c 6f67 2822 4578 6365 7074 696f  ov.log("Exceptio
-0000f0a0: 6e3a 2022 202b 206d 7367 2c20 646f 6e74  n: " + msg, dont
-0000f0b0: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
-0000f0c0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-0000f0d0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-0000f0e0: 286d 7367 290a 0a20 2020 2020 2020 2023  (msg)..        #
-0000f0f0: 2070 7574 2069 7465 6d20 696e 666f 2069   put item info i
-0000f100: 6e74 6f20 7365 6c66 2e69 6664 6f5f 746d  nto self.ifdo_tm
-0000f110: 700a 2020 2020 2020 2020 7320 3d20 6d69  p.        s = mi
-0000f120: 7174 632e 5072 696e 744c 6f61 6469 6e67  qtc.PrintLoading
-0000f130: 4d73 6728 2255 7064 6174 696e 6722 290a  Msg("Updating").
-0000f140: 2020 2020 2020 2020 6c6f 6720 3d20 6d69          log = mi
-0000f150: 7174 632e 7265 6375 7273 6976 656c 7955  qtc.recursivelyU
-0000f160: 7064 6174 6544 6963 7473 2873 656c 662e  pdateDicts(self.
-0000f170: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-0000f180: 6167 6553 6574 4974 656d 734b 6579 5d2c  ageSetItemsKey],
-0000f190: 2069 6d61 6765 5f73 6574 5f69 7465 6d73   image_set_items
-0000f1a0: 290a 2020 2020 2020 2020 732e 7374 6f70  ).        s.stop
-0000f1b0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-0000f1c0: 7072 6f76 2e6c 6f67 286c 6f67 290a 0a20  prov.log(log).. 
-0000f1d0: 2020 2020 2020 2023 2073 6574 206c 6174         # set lat
-0000f1e0: 206c 6f6e 2062 6f75 6e64 696e 6720 626f   lon bounding bo
-0000f1f0: 780a 2020 2020 2020 2020 7365 6c66 2e5f  x.        self._
-0000f200: 7365 745f 6c61 745f 6c6f 6e5f 626f 756e  set_lat_lon_boun
-0000f210: 6469 6e67 5f62 6f78 2873 656c 662e 6966  ding_box(self.if
-0000f220: 646f 5f74 6d70 290a 0a20 2020 2020 2020  do_tmp)..       
-0000f230: 2023 2073 6574 2072 6570 7265 7365 6e74   # set represent
-0000f240: 6174 6976 6520 6865 6164 6572 2066 6965  ative header fie
-0000f250: 6c64 7320 6461 7465 7469 6d65 2c20 6c61  lds datetime, la
-0000f260: 742c 206c 6f6e 2c20 616c 740a 2020 2020  t, lon, alt.    
-0000f270: 2020 2020 7365 6c66 2e5f 7365 745f 7265      self._set_re
-0000f280: 705f 6865 6164 6572 5f66 6965 6c64 735f  p_header_fields_
-0000f290: 6474 5f6c 6174 5f6c 6f6e 5f61 6c74 2873  dt_lat_lon_alt(s
-0000f2a0: 656c 662e 6966 646f 5f74 6d70 290a 0a20  elf.ifdo_tmp).. 
-0000f2b0: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
-0000f2c0: 5f69 6d61 6765 5f69 7465 6d5f 6964 656e  _image_item_iden
-0000f2d0: 7469 6669 6361 7469 6f6e 5f73 6368 656d  tification_schem
-0000f2e0: 6528 7365 6c66 2e69 6664 6f5f 746d 7029  e(self.ifdo_tmp)
-0000f2f0: 0a0a 2020 2020 2020 2020 2320 7265 6d6f  ..        # remo
-0000f300: 7665 2065 6d74 7079 2066 6965 6c64 730a  ve emtpy fields.
-0000f310: 2020 2020 2020 2020 7320 3d20 6d69 7174          s = miqt
-0000f320: 632e 5072 696e 744c 6f61 6469 6e67 4d73  c.PrintLoadingMs
-0000f330: 6728 2252 656d 6f76 696e 6720 656d 7074  g("Removing empt
-0000f340: 7920 6669 656c 6473 2229 0a20 2020 2020  y fields").     
-0000f350: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0000f360: 203d 206d 6971 7463 2e72 6563 7572 7369   = miqtc.recursi
-0000f370: 7665 6c79 5265 6d6f 7665 456d 7074 7946  velyRemoveEmptyF
-0000f380: 6965 6c64 7328 7365 6c66 2e69 6664 6f5f  ields(self.ifdo_
-0000f390: 746d 7029 0a20 2020 2020 2020 2069 6620  tmp).        if 
-0000f3a0: 6e6f 7420 7365 6c66 2e69 6d61 6765 5365  not self.imageSe
-0000f3b0: 7449 7465 6d73 4b65 7920 696e 2073 656c  tItemsKey in sel
-0000f3c0: 662e 6966 646f 5f74 6d70 3a0a 2020 2020  f.ifdo_tmp:.    
-0000f3d0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-0000f3e0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000f3f0: 5365 7449 7465 6d73 4b65 795d 203d 205b  SetItemsKey] = [
-0000f400: 5d0a 2020 2020 2020 2020 2320 7265 6d6f  ].        # remo
-0000f410: 7665 2066 6965 6c64 7320 7468 6174 2063  ve fields that c
-0000f420: 6f6e 7461 696e 2027 696d 6167 652d 6461  ontain 'image-da
-0000f430: 7465 7469 6d65 2720 6f6e 6c79 0a20 2020  tetime' only.   
-0000f440: 2020 2020 2073 656c 662e 7265 6d6f 7665       self.remove
-0000f450: 4974 656d 4669 656c 6473 5769 7468 4f6e  ItemFieldsWithOn
-0000f460: 6c79 4461 7465 5469 6d65 2829 0a20 2020  lyDateTime().   
-0000f470: 2020 2020 2073 2e73 746f 7028 290a 0a20       s.stop().. 
-0000f480: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-0000f490: 6c66 2e69 676e 6f72 655f 696d 6167 655f  lf.ignore_image_
-0000f4a0: 6669 6c65 733a 0a20 2020 2020 2020 2020  files:.         
-0000f4b0: 2020 2073 656c 662e 6368 6563 6b41 6c6c     self.checkAll
-0000f4c0: 4974 656d 4861 7368 6573 2829 0a0a 2020  ItemHashes()..  
-0000f4d0: 2020 2020 2020 2320 6368 6563 6b20 6167        # check ag
-0000f4e0: 6169 6e73 7420 7363 6865 6d61 0a20 2020  ainst schema.   
-0000f4f0: 2020 2020 2076 616c 6964 2c20 6d73 6720       valid, msg 
-0000f500: 3d20 6d69 7174 742e 7661 6c69 6461 7465  = miqtt.validate
-0000f510: 5f69 6664 6f28 7365 6c66 2e69 6664 6f5f  _ifdo(self.ifdo_
-0000f520: 746d 7029 0a20 2020 2020 2020 2069 6620  tmp).        if 
-0000f530: 6e6f 7420 7661 6c69 6420 616e 6420 6e6f  not valid and no
-0000f540: 7420 616c 6c6f 775f 6d69 7373 696e 675f  t allow_missing_
-0000f550: 7265 7175 6972 6564 3a0a 2020 2020 2020  required:.      
-0000f560: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-0000f570: 6c6f 6728 2257 6172 6e69 6e67 2120 6946  log("Warning! iF
-0000f580: 444f 206e 6f20 7661 6c69 6420 7965 743a  DO no valid yet:
-0000f590: 2022 202b 206d 7367 290a 2020 2020 2020   " + msg).      
-0000f5a0: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
-0000f5b0: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
-0000f5c0: 6d73 6729 0a0a 2020 2020 2020 2020 2320  msg)..        # 
-0000f5d0: 7365 7420 6669 6e61 6c20 6f6e 650a 2020  set final one.  
-0000f5e0: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
-0000f5f0: 6368 6563 6b65 6420 3d20 636f 7079 2e64  checked = copy.d
-0000f600: 6565 7063 6f70 7928 7365 6c66 2e69 6664  eepcopy(self.ifd
-0000f610: 6f5f 746d 7029 0a20 2020 2020 2020 2072  o_tmp).        r
-0000f620: 6574 7572 6e20 7365 6c66 2e69 6664 6f5f  eturn self.ifdo_
-0000f630: 6368 6563 6b65 640a 0a0a 2020 2020 6465  checked...    de
-0000f640: 6620 5f73 6574 5f69 6d61 6765 5f69 7465  f _set_image_ite
-0000f650: 6d5f 6964 656e 7469 6669 6361 7469 6f6e  m_identification
-0000f660: 5f73 6368 656d 6528 7365 6c66 2c69 6664  _scheme(self,ifd
-0000f670: 6f3a 6469 6374 293a 0a20 2020 2020 2020  o:dict):.       
-0000f680: 2022 2222 2053 6574 2069 6d61 6765 2d69   """ Set image-i
-0000f690: 7465 6d2d 6964 656e 7469 6669 6361 7469  tem-identificati
-0000f6a0: 6f6e 2d73 6368 656d 6520 746f 2060 696d  on-scheme to `im
-0000f6b0: 6167 652d 7072 6f6a 6563 745f 696d 6167  age-project_imag
-0000f6c0: 652d 6576 656e 745f 696d 6167 652d 7365  e-event_image-se
-0000f6d0: 6e73 6f72 5f69 6d61 6765 2d64 6174 6574  nsor_image-datet
-0000f6e0: 696d 652e 6578 7460 2069 6620 656d 7074  ime.ext` if empt
-0000f6f0: 792e 2022 2222 0a20 2020 2020 2020 2069  y. """.        i
-0000f700: 6620 6669 6e64 4669 656c 6428 6966 646f  f findField(ifdo
-0000f710: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000f720: 6164 6572 4b65 795d 2c27 696d 6167 652d  aderKey],'image-
-0000f730: 6974 656d 2d69 6465 6e74 6966 6963 6174  item-identificat
-0000f740: 696f 6e2d 7363 6865 6d65 2729 203d 3d20  ion-scheme') == 
-0000f750: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
-0000f760: 6966 646f 5b73 656c 662e 696d 6167 6553  ifdo[self.imageS
-0000f770: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
-0000f780: 6167 652d 6974 656d 2d69 6465 6e74 6966  age-item-identif
-0000f790: 6963 6174 696f 6e2d 7363 6865 6d65 275d  ication-scheme']
-0000f7a0: 203d 2020 2769 6d61 6765 2d70 726f 6a65   =  'image-proje
-0000f7b0: 6374 5f69 6d61 6765 2d65 7665 6e74 5f69  ct_image-event_i
-0000f7c0: 6d61 6765 2d73 656e 736f 725f 696d 6167  mage-sensor_imag
-0000f7d0: 652d 6461 7465 7469 6d65 2e65 7874 270a  e-datetime.ext'.
-0000f7e0: 0a0a 2020 2020 6465 6620 5f73 6574 5f72  ..    def _set_r
-0000f7f0: 6570 5f68 6561 6465 725f 6669 656c 6473  ep_header_fields
-0000f800: 5f64 745f 6c61 745f 6c6f 6e5f 616c 7428  _dt_lat_lon_alt(
-0000f810: 7365 6c66 2c69 6664 6f3a 6469 6374 293a  self,ifdo:dict):
-0000f820: 0a20 2020 2020 2020 2022 2222 2046 696c  .        """ Fil
-0000f830: 6c20 6865 6164 6572 2066 6965 6c64 7320  l header fields 
-0000f840: 696d 6167 652d 6461 7465 7469 6d65 2c20  image-datetime, 
-0000f850: 2d6c 6174 6974 7564 652c 202d 6c6f 6e67  -latitude, -long
-0000f860: 6974 7565 6465 2c20 2d61 6c74 6974 7564  ituede, -altitud
-0000f870: 652d 6d65 7465 7273 2c20 6966 2065 6d70  e-meters, if emp
-0000f880: 7479 2c0a 2020 2020 2020 2020 7265 7072  ty,.        repr
-0000f890: 6573 656e 7461 7469 7665 6c79 2077 6974  esentatively wit
-0000f8a0: 6820 7661 6c75 6573 2066 726f 6d20 6669  h values from fi
-0000f8b0: 7273 7420 6974 656d 2e20 2222 220a 2020  rst item. """.  
-0000f8c0: 2020 2020 2020 6669 7273 745f 696d 6167        first_imag
-0000f8d0: 6520 3d20 736f 7274 6564 2869 6664 6f5b  e = sorted(ifdo[
-0000f8e0: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
-0000f8f0: 6d73 4b65 795d 2e6b 6579 7328 2929 5b30  msKey].keys())[0
-0000f900: 5d0a 2020 2020 2020 2020 7265 705f 6865  ].        rep_he
-0000f910: 6164 6572 5f66 6965 6c64 7320 3d20 5b27  ader_fields = ['
-0000f920: 696d 6167 652d 6461 7465 7469 6d65 272c  image-datetime',
-0000f930: 2769 6d61 6765 2d6c 6174 6974 7564 6527  'image-latitude'
-0000f940: 2c27 696d 6167 652d 6c6f 6e67 6974 7564  ,'image-longitud
-0000f950: 6527 2c27 696d 6167 652d 616c 7469 7475  e','image-altitu
-0000f960: 6465 2d6d 6574 6572 7327 5d0a 2020 2020  de-meters'].    
-0000f970: 2020 2020 666f 7220 6669 656c 6420 696e      for field in
-0000f980: 2072 6570 5f68 6561 6465 725f 6669 656c   rep_header_fiel
-0000f990: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
-0000f9a0: 6966 2066 696e 6446 6965 6c64 2869 6664  if findField(ifd
-0000f9b0: 6f5b 7365 6c66 2e69 6d61 6765 5365 7448  o[self.imageSetH
-0000f9c0: 6561 6465 724b 6579 5d2c 6669 656c 6429  eaderKey],field)
-0000f9d0: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
-0000f9e0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000f9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa00: 2069 6664 6f5b 7365 6c66 2e69 6d61 6765   ifdo[self.image
-0000fa10: 5365 7448 6561 6465 724b 6579 5d5b 6669  SetHeaderKey][fi
-0000fa20: 656c 645d 203d 2073 656c 662e 5f5f 6765  eld] = self.__ge
-0000fa30: 7446 6965 6c64 5661 6c75 6528 6966 646f  tFieldValue(ifdo
-0000fa40: 2c5b 6669 7273 745f 696d 6167 652c 6669  ,[first_image,fi
-0000fa50: 656c 645d 2c64 6566 6175 6c74 5f6f 6e6c  eld],default_onl
-0000fa60: 793d 5472 7565 290a 2020 2020 2020 2020  y=True).        
-0000fa70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000fa80: 2e70 726f 762e 6c6f 6728 2253 6574 2072  .prov.log("Set r
-0000fa90: 6570 7265 7365 6e74 6174 6976 6520 6865  epresentative he
-0000faa0: 6164 6572 2066 6965 6c64 2027 2220 2b20  ader field '" + 
-0000fab0: 6669 656c 6420 2b20 2227 2074 6f20 2220  field + "' to " 
-0000fac0: 2b20 7374 7228 6966 646f 5b73 656c 662e  + str(ifdo[self.
-0000fad0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000fae0: 795d 5b66 6965 6c64 5d29 202b 2022 2066  y][field]) + " f
-0000faf0: 726f 6d20 6669 7273 7420 696d 6167 652e  rom first image.
-0000fb00: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000fb10: 2020 2065 7863 6570 7420 6d69 7174 632e     except miqtc.
-0000fb20: 4966 646f 4578 6365 7074 696f 6e20 6173  IfdoException as
-0000fb30: 2065 783a 0a20 2020 2020 2020 2020 2020   ex:.           
-0000fb40: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-0000fb50: 6f76 2e6c 6f67 2822 436f 756c 6420 6e6f  ov.log("Could no
-0000fb60: 7420 7365 7420 7265 7072 6573 656e 7461  t set representa
-0000fb70: 7469 7665 2068 6561 6465 7220 6669 656c  tive header fiel
-0000fb80: 643a 2022 202b 2073 7472 2865 7829 290a  d: " + str(ex)).
-0000fb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fba0: 2020 2020 7061 7373 0a0a 0a20 2020 2064      pass...    d
-0000fbb0: 6566 205f 7365 745f 6c61 745f 6c6f 6e5f  ef _set_lat_lon_
-0000fbc0: 626f 756e 6469 6e67 5f62 6f78 2873 656c  bounding_box(sel
-0000fbd0: 662c 6966 646f 3a64 6963 7429 3a0a 2020  f,ifdo:dict):.  
-0000fbe0: 2020 2020 2020 2222 2220 5365 7420 696d        """ Set im
-0000fbf0: 6167 652d 7365 742d 5b6d 696e 2c6d 6178  age-set-[min,max
-0000fc00: 5d2d 5b6c 6174 6974 7564 652c 6c6f 6e67  ]-[latitude,long
-0000fc10: 6974 7564 655d 2d64 6567 7265 6573 2022  itude]-degrees "
-0000fc20: 2222 0a20 2020 2020 2020 206c 6174 5f6d  "".        lat_m
-0000fc30: 696e 2c20 6c61 745f 6d61 782c 206c 6f6e  in, lat_max, lon
-0000fc40: 5f6d 696e 2c20 6c6f 6e5f 6d61 7820 3d20  _min, lon_max = 
-0000fc50: 7365 6c66 2e5f 6765 745f 6c61 745f 6c6f  self._get_lat_lo
-0000fc60: 6e5f 626f 756e 6469 6e67 5f62 6f78 2869  n_bounding_box(i
-0000fc70: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
-0000fc80: 7449 7465 6d73 4b65 795d 290a 2020 2020  tItemsKey]).    
-0000fc90: 2020 2020 6966 206e 6f74 204e 6f6e 6520      if not None 
-0000fca0: 696e 205b 6c61 745f 6d69 6e2c 206c 6174  in [lat_min, lat
-0000fcb0: 5f6d 6178 2c20 6c6f 6e5f 6d69 6e2c 206c  _max, lon_min, l
-0000fcc0: 6f6e 5f6d 6178 5d3a 0a20 2020 2020 2020  on_max]:.       
-0000fcd0: 2020 2020 2069 6664 6f5b 7365 6c66 2e69       ifdo[self.i
-0000fce0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000fcf0: 5d5b 2769 6d61 6765 2d73 6574 2d6d 696e  ]['image-set-min
-0000fd00: 2d6c 6174 6974 7564 652d 6465 6772 6565  -latitude-degree
-0000fd10: 7327 5d20 3d20 6c61 745f 6d69 6e0a 2020  s'] = lat_min.  
-0000fd20: 2020 2020 2020 2020 2020 6966 646f 5b73            ifdo[s
-0000fd30: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000fd40: 6572 4b65 795d 5b27 696d 6167 652d 7365  erKey]['image-se
-0000fd50: 742d 6d61 782d 6c61 7469 7475 6465 2d64  t-max-latitude-d
-0000fd60: 6567 7265 6573 275d 203d 206c 6174 5f6d  egrees'] = lat_m
-0000fd70: 6178 0a20 2020 2020 2020 2020 2020 2069  ax.            i
-0000fd80: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
-0000fd90: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
-0000fda0: 6765 2d73 6574 2d6d 696e 2d6c 6f6e 6769  ge-set-min-longi
-0000fdb0: 7475 6465 2d64 6567 7265 6573 275d 203d  tude-degrees'] =
-0000fdc0: 206c 6f6e 5f6d 696e 0a20 2020 2020 2020   lon_min.       
-0000fdd0: 2020 2020 2069 6664 6f5b 7365 6c66 2e69       ifdo[self.i
+0000ec40: 2020 2023 2069 6620 6974 656d 2069 7320     # if item is 
+0000ec50: 6120 6c69 7374 2028 7669 6465 6f29 2c20  a list (video), 
+0000ec60: 6f6e 6520 776f 756c 6420 6861 7665 2074  one would have t
+0000ec70: 6f20 6368 6563 6b20 6966 2065 6163 6820  o check if each 
+0000ec80: 656e 7472 7920 6973 2076 616c 6964 2067  entry is valid g
+0000ec90: 6976 656e 2074 6865 2064 6566 6175 6c74  iven the default
+0000eca0: 2076 616c 7565 7320 696e 2066 6972 7374   values in first
+0000ecb0: 2065 6e74 7279 2070 6c75 7320 6769 7665   entry plus give
+0000ecc0: 6e20 6465 6661 756c 7420 7661 6c75 6573  n default values
+0000ecd0: 2069 6e20 6865 6164 6572 0a20 2020 2020   in header.     
+0000ece0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000ecf0: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+0000ed00: 2869 7465 6d2c 6c69 7374 293a 0a20 2020  (item,list):.   
+0000ed10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed20: 2020 2020 2069 7465 6d20 3d20 5b69 7465       item = [ite
+0000ed30: 6d5d 0a20 2020 2020 2020 2020 2020 2020  m].             
+0000ed40: 2020 2020 2020 2073 7562 4974 656d 4465         subItemDe
+0000ed50: 6661 756c 7420 3d20 6974 656d 5b30 5d20  fault = item[0] 
+0000ed60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ed70: 2020 2020 2066 6f72 2073 7562 4974 656d       for subItem
+0000ed80: 2069 6e20 6974 656d 3a0a 2020 2020 2020   in item:.      
+0000ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eda0: 2020 6669 6c65 5f6e 616d 6520 3d20 7375    file_name = su
+0000edb0: 6249 7465 6d5b 2769 6d61 6765 2d66 696c  bItem['image-fil
+0000edc0: 656e 616d 6527 5d0a 2020 2020 2020 2020  ename'].        
+0000edd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ede0: 6966 206e 6f74 2073 656c 662e 6967 6e6f  if not self.igno
+0000edf0: 7265 5f69 6d61 6765 5f66 696c 6573 2061  re_image_files a
+0000ee00: 6e64 2066 696c 655f 6e61 6d65 206e 6f74  nd file_name not
+0000ee10: 2069 6e20 7365 6c66 2e5f 696d 6167 654e   in self._imageN
+0000ee20: 616d 6573 496d 6167 6573 4469 723a 0a20  amesImagesDir:. 
+0000ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee40: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000ee50: 2045 7863 6570 7469 6f6e 2822 4974 656d   Exception("Item
+0000ee60: 2027 2220 2b20 6669 6c65 5f6e 616d 6520   '" + file_name 
+0000ee70: 2b20 2227 206e 6f74 2066 6f75 6e64 2069  + "' not found i
+0000ee80: 6e20 2f72 6177 2064 6972 6563 746f 7279  n /raw directory
+0000ee90: 2e22 290a 0a20 2020 2020 2020 2020 2020  .")..           
+0000eea0: 2020 2020 2020 2020 2020 2020 206d 6971               miq
+0000eeb0: 7474 2e61 7265 5f76 616c 6964 5f69 6664  tt.are_valid_ifd
+0000eec0: 6f5f 6669 656c 6473 2873 7562 4974 656d  o_fields(subItem
+0000eed0: 2920 2020 2020 2020 2020 2020 2020 2020  )               
+0000eee0: 2020 2020 2020 2020 2020 0a0a 2020 2020            ..    
+0000eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef00: 696d 6167 655f 7365 745f 6974 656d 735b  image_set_items[
+0000ef10: 7375 6249 7465 6d44 6566 6175 6c74 5b27  subItemDefault['
+0000ef20: 696d 6167 652d 6669 6c65 6e61 6d65 275d  image-filename']
+0000ef30: 5d20 3d20 5b5d 2023 2063 6f75 6c64 206d  ] = [] # could m
+0000ef40: 616b 6520 616e 2065 7874 7261 2063 6173  ake an extra cas
+0000ef50: 6520 666f 7220 696d 6167 6573 206f 6d69  e for images omi
+0000ef60: 7474 696e 6720 7468 6520 6c69 7374 0a20  tting the list. 
+0000ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef80: 2020 2066 6f72 2073 7562 4974 656d 2069     for subItem i
+0000ef90: 6e20 6974 656d 3a0a 2020 2020 2020 2020  n item:.        
+0000efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efb0: 7375 6249 7465 6d44 6963 7420 3d20 7b7d  subItemDict = {}
+0000efc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000efd0: 2020 2020 2020 2020 2066 6f72 2069 7420           for it 
+0000efe0: 696e 2073 7562 4974 656d 3a0a 2020 2020  in subItem:.    
+0000eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f000: 2020 2020 2020 2020 6966 2069 7420 213d          if it !=
+0000f010: 2027 696d 6167 652d 6669 6c65 6e61 6d65   'image-filename
+0000f020: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+0000f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f040: 2020 2073 7562 4974 656d 4469 6374 5b69     subItemDict[i
+0000f050: 745d 203d 2073 7562 4974 656d 5b69 745d  t] = subItem[it]
+0000f060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f070: 2020 2020 2020 2020 2069 6d61 6765 5f73           image_s
+0000f080: 6574 5f69 7465 6d73 5b73 7562 4974 656d  et_items[subItem
+0000f090: 4465 6661 756c 745b 2769 6d61 6765 2d66  Default['image-f
+0000f0a0: 696c 656e 616d 6527 5d5d 2e61 7070 656e  ilename']].appen
+0000f0b0: 6428 7375 6249 7465 6d44 6963 7429 0a20  d(subItemDict). 
+0000f0c0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+0000f0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0e0: 6578 6365 7074 206d 6971 7463 2e49 6664  except miqtc.Ifd
+0000f0f0: 6f45 7863 6570 7469 6f6e 2061 7320 653a  oException as e:
+0000f100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f110: 2020 2020 2069 6e76 616c 6964 5f69 7465       invalid_ite
+0000f120: 6d73 202b 3d20 310a 2020 2020 2020 2020  ms += 1.        
+0000f130: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000f140: 2e70 726f 762e 6c6f 6728 2249 6e76 616c  .prov.log("Inval
+0000f150: 6964 2069 6d61 6765 2069 7465 6d3a 2022  id image item: "
+0000f160: 2b20 7374 7228 6974 656d 292c 646f 6e74  + str(item),dont
+0000f170: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
+0000f180: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000f190: 656c 662e 7072 6f76 2e6c 6f67 2822 4578  elf.prov.log("Ex
+0000f1a0: 6365 7074 696f 6e3a 5c6e 222b 2073 7472  ception:\n"+ str
+0000f1b0: 2865 2e61 7267 7329 2c64 6f6e 7453 686f  (e.args),dontSho
+0000f1c0: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
+0000f1d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000f1e0: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
+0000f1f0: 7074 696f 6e28 2249 6e76 616c 6964 2069  ption("Invalid i
+0000f200: 6d61 6765 2069 7465 6d20 222b 2066 696c  mage item "+ fil
+0000f210: 655f 6e61 6d65 202b 2022 3a5c 6e45 7863  e_name + ":\nExc
+0000f220: 6570 7469 6f6e 3a5c 6e22 2b20 7374 7228  eption:\n"+ str(
+0000f230: 652e 6172 6773 2929 2023 206f 7468 6572  e.args)) # other
+0000f240: 7769 7365 2c20 696e 2063 6173 6520 6f66  wise, in case of
+0000f250: 206d 616e 7920 696d 6167 6573 2c20 6974   many images, it
+0000f260: 206d 6179 206b 6565 7020 7275 6e6e 696e   may keep runnin
+0000f270: 6720 616e 6420 7468 726f 7769 6e67 2065  g and throwing e
+0000f280: 7272 6f72 7320 666f 7220 7175 6974 2073  rrors for quit s
+0000f290: 6f6d 6520 7469 6d65 0a20 2020 2020 2020  ome time.       
+0000f2a0: 2020 2020 2070 726f 672e 636c 6561 7228       prog.clear(
+0000f2b0: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0000f2c0: 6620 6c65 6e28 6974 656d 7329 2021 3d20  f len(items) != 
+0000f2d0: 3020 616e 6420 696e 7661 6c69 645f 6974  0 and invalid_it
+0000f2e0: 656d 7320 3d3d 206c 656e 2869 7465 6d73  ems == len(items
+0000f2f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000f300: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+0000f310: 6f6e 2822 416c 6c20 6974 656d 7320 6172  on("All items ar
+0000f320: 6520 696e 7661 6c69 6422 290a 2020 2020  e invalid").    
+0000f330: 2020 2020 2020 2020 656c 6966 2069 6e76          elif inv
+0000f340: 616c 6964 5f69 7465 6d73 203e 2030 3a0a  alid_items > 0:.
+0000f350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f360: 7365 6c66 2e70 726f 762e 6c6f 6728 2241  self.prov.log("A
+0000f370: 7420 6c65 6173 7420 2220 2b20 7374 7228  t least " + str(
+0000f380: 696e 7661 6c69 645f 6974 656d 7329 202b  invalid_items) +
+0000f390: 2022 2069 7465 6d73 2077 6572 6520 696e   " items were in
+0000f3a0: 7661 6c69 6420 286f 6622 202b 2073 7472  valid (of" + str
+0000f3b0: 286c 656e 2869 7465 6d73 2929 2b20 2229  (len(items))+ ")
+0000f3c0: 2229 0a0a 2020 2020 2020 2020 2320 5661  ")..        # Va
+0000f3d0: 6c69 6461 7465 2068 6561 6465 7220 696e  lidate header in
+0000f3e0: 666f 726d 6174 696f 6e0a 2020 2020 2020  formation.      
+0000f3f0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000f400: 2020 206d 6971 7474 2e61 7265 5f76 616c     miqtt.are_val
+0000f410: 6964 5f69 6664 6f5f 6669 656c 6473 2873  id_ifdo_fields(s
+0000f420: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0000f430: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000f440: 4b65 795d 290a 2020 2020 2020 2020 6578  Key]).        ex
+0000f450: 6365 7074 206d 6971 7463 2e49 6664 6f45  cept miqtc.IfdoE
+0000f460: 7863 6570 7469 6f6e 2061 7320 6578 3a0a  xception as ex:.
+0000f470: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
+0000f480: 3d20 2249 6e76 616c 6964 2068 6561 6465  = "Invalid heade
+0000f490: 7220 6669 656c 643a 2022 202b 2073 7472  r field: " + str
+0000f4a0: 2865 7829 0a20 2020 2020 2020 2020 2020  (ex).           
+0000f4b0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+0000f4c0: 4578 6365 7074 696f 6e3a 2022 202b 206d  Exception: " + m
+0000f4d0: 7367 2c20 646f 6e74 5368 6f77 3d54 7275  sg, dontShow=Tru
+0000f4e0: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
+0000f4f0: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
+0000f500: 7863 6570 7469 6f6e 286d 7367 290a 0a20  xception(msg).. 
+0000f510: 2020 2020 2020 2023 2070 7574 2069 7465         # put ite
+0000f520: 6d20 696e 666f 2069 6e74 6f20 7365 6c66  m info into self
+0000f530: 2e69 6664 6f5f 746d 700a 2020 2020 2020  .ifdo_tmp.      
+0000f540: 2020 7320 3d20 6d69 7174 632e 5072 696e    s = miqtc.Prin
+0000f550: 744c 6f61 6469 6e67 4d73 6728 2255 7064  tLoadingMsg("Upd
+0000f560: 6174 696e 6722 290a 2020 2020 2020 2020  ating").        
+0000f570: 6c6f 6720 3d20 6d69 7174 632e 7265 6375  log = miqtc.recu
+0000f580: 7273 6976 656c 7955 7064 6174 6544 6963  rsivelyUpdateDic
+0000f590: 7473 2873 656c 662e 6966 646f 5f74 6d70  ts(self.ifdo_tmp
+0000f5a0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
+0000f5b0: 656d 734b 6579 5d2c 2069 6d61 6765 5f73  emsKey], image_s
+0000f5c0: 6574 5f69 7465 6d73 290a 2020 2020 2020  et_items).      
+0000f5d0: 2020 732e 7374 6f70 2829 0a20 2020 2020    s.stop().     
+0000f5e0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+0000f5f0: 286c 6f67 290a 0a20 2020 2020 2020 2023  (log)..        #
+0000f600: 2073 6574 206c 6174 206c 6f6e 2062 6f75   set lat lon bou
+0000f610: 6e64 696e 6720 626f 780a 2020 2020 2020  nding box.      
+0000f620: 2020 7365 6c66 2e5f 7365 745f 6c61 745f    self._set_lat_
+0000f630: 6c6f 6e5f 626f 756e 6469 6e67 5f62 6f78  lon_bounding_box
+0000f640: 2873 656c 662e 6966 646f 5f74 6d70 290a  (self.ifdo_tmp).
+0000f650: 0a20 2020 2020 2020 2023 2073 6574 2072  .        # set r
+0000f660: 6570 7265 7365 6e74 6174 6976 6520 6865  epresentative he
+0000f670: 6164 6572 2066 6965 6c64 7320 6461 7465  ader fields date
+0000f680: 7469 6d65 2c20 6c61 742c 206c 6f6e 2c20  time, lat, lon, 
+0000f690: 616c 740a 2020 2020 2020 2020 7365 6c66  alt.        self
+0000f6a0: 2e5f 7365 745f 7265 705f 6865 6164 6572  ._set_rep_header
+0000f6b0: 5f66 6965 6c64 735f 6474 5f6c 6174 5f6c  _fields_dt_lat_l
+0000f6c0: 6f6e 5f61 6c74 2873 656c 662e 6966 646f  on_alt(self.ifdo
+0000f6d0: 5f74 6d70 290a 0a20 2020 2020 2020 2073  _tmp)..        s
+0000f6e0: 656c 662e 5f73 6574 5f69 6d61 6765 5f69  elf._set_image_i
+0000f6f0: 7465 6d5f 6964 656e 7469 6669 6361 7469  tem_identificati
+0000f700: 6f6e 5f73 6368 656d 6528 7365 6c66 2e69  on_scheme(self.i
+0000f710: 6664 6f5f 746d 7029 0a0a 2020 2020 2020  fdo_tmp)..      
+0000f720: 2020 2320 7265 6d6f 7665 2065 6d74 7079    # remove emtpy
+0000f730: 2066 6965 6c64 730a 2020 2020 2020 2020   fields.        
+0000f740: 7320 3d20 6d69 7174 632e 5072 696e 744c  s = miqtc.PrintL
+0000f750: 6f61 6469 6e67 4d73 6728 2252 656d 6f76  oadingMsg("Remov
+0000f760: 696e 6720 656d 7074 7920 6669 656c 6473  ing empty fields
+0000f770: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+0000f780: 6966 646f 5f74 6d70 203d 206d 6971 7463  ifdo_tmp = miqtc
+0000f790: 2e72 6563 7572 7369 7665 6c79 5265 6d6f  .recursivelyRemo
+0000f7a0: 7665 456d 7074 7946 6965 6c64 7328 7365  veEmptyFields(se
+0000f7b0: 6c66 2e69 6664 6f5f 746d 7029 0a20 2020  lf.ifdo_tmp).   
+0000f7c0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0000f7d0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+0000f7e0: 7920 696e 2073 656c 662e 6966 646f 5f74  y in self.ifdo_t
+0000f7f0: 6d70 3a0a 2020 2020 2020 2020 2020 2020  mp:.            
+0000f800: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000f810: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+0000f820: 4b65 795d 203d 205b 5d0a 2020 2020 2020  Key] = [].      
+0000f830: 2020 2320 7265 6d6f 7665 2066 6965 6c64    # remove field
+0000f840: 7320 7468 6174 2063 6f6e 7461 696e 2027  s that contain '
+0000f850: 696d 6167 652d 6461 7465 7469 6d65 2720  image-datetime' 
+0000f860: 6f6e 6c79 0a20 2020 2020 2020 2073 656c  only.        sel
+0000f870: 662e 7265 6d6f 7665 4974 656d 4669 656c  f.removeItemFiel
+0000f880: 6473 5769 7468 4f6e 6c79 4461 7465 5469  dsWithOnlyDateTi
+0000f890: 6d65 2829 0a20 2020 2020 2020 2073 2e73  me().        s.s
+0000f8a0: 746f 7028 290a 0a20 2020 2020 2020 2069  top()..        i
+0000f8b0: 6620 6e6f 7420 7365 6c66 2e69 676e 6f72  f not self.ignor
+0000f8c0: 655f 696d 6167 655f 6669 6c65 733a 0a20  e_image_files:. 
+0000f8d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000f8e0: 6368 6563 6b41 6c6c 4974 656d 4861 7368  checkAllItemHash
+0000f8f0: 6573 2829 0a0a 2020 2020 2020 2020 2320  es()..        # 
+0000f900: 6368 6563 6b20 6167 6169 6e73 7420 7363  check against sc
+0000f910: 6865 6d61 0a20 2020 2020 2020 2076 616c  hema.        val
+0000f920: 6964 2c20 6d73 6720 3d20 6d69 7174 742e  id, msg = miqtt.
+0000f930: 7661 6c69 6461 7465 5f69 6664 6f28 7365  validate_ifdo(se
+0000f940: 6c66 2e69 6664 6f5f 746d 7029 0a20 2020  lf.ifdo_tmp).   
+0000f950: 2020 2020 2069 6620 6e6f 7420 7661 6c69       if not vali
+0000f960: 6420 616e 6420 6e6f 7420 616c 6c6f 775f  d and not allow_
+0000f970: 6d69 7373 696e 675f 7265 7175 6972 6564  missing_required
+0000f980: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000f990: 6c66 2e70 726f 762e 6c6f 6728 2257 6172  lf.prov.log("War
+0000f9a0: 6e69 6e67 2120 6946 444f 206e 6f20 7661  ning! iFDO no va
+0000f9b0: 6c69 6420 7965 743a 2022 202b 206d 7367  lid yet: " + msg
+0000f9c0: 290a 2020 2020 2020 2020 2020 2020 7261  ).            ra
+0000f9d0: 6973 6520 6d69 7174 632e 4966 646f 4578  ise miqtc.IfdoEx
+0000f9e0: 6365 7074 696f 6e28 6d73 6729 0a0a 2020  ception(msg)..  
+0000f9f0: 2020 2020 2020 2320 7365 7420 6669 6e61        # set fina
+0000fa00: 6c20 6f6e 650a 2020 2020 2020 2020 7365  l one.        se
+0000fa10: 6c66 2e69 6664 6f5f 6368 6563 6b65 6420  lf.ifdo_checked 
+0000fa20: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
+0000fa30: 7365 6c66 2e69 6664 6f5f 746d 7029 0a20  self.ifdo_tmp). 
+0000fa40: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000fa50: 6c66 2e69 6664 6f5f 6368 6563 6b65 640a  lf.ifdo_checked.
+0000fa60: 0a0a 2020 2020 6465 6620 5f73 6574 5f69  ..    def _set_i
+0000fa70: 6d61 6765 5f69 7465 6d5f 6964 656e 7469  mage_item_identi
+0000fa80: 6669 6361 7469 6f6e 5f73 6368 656d 6528  fication_scheme(
+0000fa90: 7365 6c66 2c69 6664 6f3a 6469 6374 293a  self,ifdo:dict):
+0000faa0: 0a20 2020 2020 2020 2022 2222 2053 6574  .        """ Set
+0000fab0: 2069 6d61 6765 2d69 7465 6d2d 6964 656e   image-item-iden
+0000fac0: 7469 6669 6361 7469 6f6e 2d73 6368 656d  tification-schem
+0000fad0: 6520 746f 2060 696d 6167 652d 7072 6f6a  e to `image-proj
+0000fae0: 6563 745f 696d 6167 652d 6576 656e 745f  ect_image-event_
+0000faf0: 696d 6167 652d 7365 6e73 6f72 5f69 6d61  image-sensor_ima
+0000fb00: 6765 2d64 6174 6574 696d 652e 6578 7460  ge-datetime.ext`
+0000fb10: 2069 6620 656d 7074 792e 2022 2222 0a20   if empty. """. 
+0000fb20: 2020 2020 2020 2069 6620 6669 6e64 4669         if findFi
+0000fb30: 656c 6428 6966 646f 5b73 656c 662e 696d  eld(ifdo[self.im
+0000fb40: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+0000fb50: 2c27 696d 6167 652d 6974 656d 2d69 6465  ,'image-item-ide
+0000fb60: 6e74 6966 6963 6174 696f 6e2d 7363 6865  ntification-sche
+0000fb70: 6d65 2729 203d 3d20 2222 3a0a 2020 2020  me') == "":.    
+0000fb80: 2020 2020 2020 2020 6966 646f 5b73 656c          ifdo[sel
+0000fb90: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000fba0: 4b65 795d 5b27 696d 6167 652d 6974 656d  Key]['image-item
+0000fbb0: 2d69 6465 6e74 6966 6963 6174 696f 6e2d  -identification-
+0000fbc0: 7363 6865 6d65 275d 203d 2020 2769 6d61  scheme'] =  'ima
+0000fbd0: 6765 2d70 726f 6a65 6374 5f69 6d61 6765  ge-project_image
+0000fbe0: 2d65 7665 6e74 5f69 6d61 6765 2d73 656e  -event_image-sen
+0000fbf0: 736f 725f 696d 6167 652d 6461 7465 7469  sor_image-dateti
+0000fc00: 6d65 2e65 7874 270a 0a0a 2020 2020 6465  me.ext'...    de
+0000fc10: 6620 5f73 6574 5f72 6570 5f68 6561 6465  f _set_rep_heade
+0000fc20: 725f 6669 656c 6473 5f64 745f 6c61 745f  r_fields_dt_lat_
+0000fc30: 6c6f 6e5f 616c 7428 7365 6c66 2c69 6664  lon_alt(self,ifd
+0000fc40: 6f3a 6469 6374 293a 0a20 2020 2020 2020  o:dict):.       
+0000fc50: 2022 2222 2046 696c 6c20 6865 6164 6572   """ Fill header
+0000fc60: 2066 6965 6c64 7320 696d 6167 652d 6461   fields image-da
+0000fc70: 7465 7469 6d65 2c20 2d6c 6174 6974 7564  tetime, -latitud
+0000fc80: 652c 202d 6c6f 6e67 6974 7565 6465 2c20  e, -longituede, 
+0000fc90: 2d61 6c74 6974 7564 652d 6d65 7465 7273  -altitude-meters
+0000fca0: 2c20 6966 2065 6d70 7479 2c0a 2020 2020  , if empty,.    
+0000fcb0: 2020 2020 7265 7072 6573 656e 7461 7469      representati
+0000fcc0: 7665 6c79 2077 6974 6820 7661 6c75 6573  vely with values
+0000fcd0: 2066 726f 6d20 6669 7273 7420 6974 656d   from first item
+0000fce0: 2e20 2222 220a 2020 2020 2020 2020 6669  . """.        fi
+0000fcf0: 7273 745f 696d 6167 6520 3d20 736f 7274  rst_image = sort
+0000fd00: 6564 2869 6664 6f5b 7365 6c66 2e69 6d61  ed(ifdo[self.ima
+0000fd10: 6765 5365 7449 7465 6d73 4b65 795d 2e6b  geSetItemsKey].k
+0000fd20: 6579 7328 2929 5b30 5d0a 2020 2020 2020  eys())[0].      
+0000fd30: 2020 7265 705f 6865 6164 6572 5f66 6965    rep_header_fie
+0000fd40: 6c64 7320 3d20 5b27 696d 6167 652d 6461  lds = ['image-da
+0000fd50: 7465 7469 6d65 272c 2769 6d61 6765 2d6c  tetime','image-l
+0000fd60: 6174 6974 7564 6527 2c27 696d 6167 652d  atitude','image-
+0000fd70: 6c6f 6e67 6974 7564 6527 2c27 696d 6167  longitude','imag
+0000fd80: 652d 616c 7469 7475 6465 2d6d 6574 6572  e-altitude-meter
+0000fd90: 7327 5d0a 2020 2020 2020 2020 666f 7220  s'].        for 
+0000fda0: 6669 656c 6420 696e 2072 6570 5f68 6561  field in rep_hea
+0000fdb0: 6465 725f 6669 656c 6473 3a0a 2020 2020  der_fields:.    
+0000fdc0: 2020 2020 2020 2020 6966 2066 696e 6446          if findF
+0000fdd0: 6965 6c64 2869 6664 6f5b 7365 6c66 2e69  ield(ifdo[self.i
 0000fde0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000fdf0: 5d5b 2769 6d61 6765 2d73 6574 2d6d 6178  ]['image-set-max
-0000fe00: 2d6c 6f6e 6769 7475 6465 2d64 6567 7265  -longitude-degre
-0000fe10: 6573 275d 203d 206c 6f6e 5f6d 6178 0a0a  es'] = lon_max..
-0000fe20: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
-0000fe30: 6f64 0a20 2020 2064 6566 205f 6765 745f  od.    def _get_
-0000fe40: 6c61 745f 6c6f 6e5f 626f 756e 6469 6e67  lat_lon_bounding
-0000fe50: 5f62 6f78 2869 7465 6d73 3a64 6963 7429  _box(items:dict)
-0000fe60: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
-0000fe70: 7475 726e 7320 6c61 745f 6d69 6e2c 206c  turns lat_min, l
-0000fe80: 6174 5f6d 6178 2c20 6c6f 6e5f 6d69 6e2c  at_max, lon_min,
-0000fe90: 206c 6f6e 5f6d 6178 2022 2222 0a20 2020   lon_max """.   
-0000fea0: 2020 2020 206c 6174 5f6d 696e 2c20 6c61       lat_min, la
-0000feb0: 745f 6d61 782c 206c 6f6e 5f6d 696e 2c20  t_max, lon_min, 
-0000fec0: 6c6f 6e5f 6d61 7820 3d20 4e6f 6e65 2c20  lon_max = None, 
-0000fed0: 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65  None, None, None
-0000fee0: 0a20 2020 2020 2020 2069 203d 2030 0a20  .        i = 0. 
-0000fef0: 2020 2020 2020 2066 6f72 2069 6d61 6765         for image
-0000ff00: 2c20 6461 7461 2069 6e20 6974 656d 732e  , data in items.
-0000ff10: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-0000ff20: 2020 2020 2023 206d 616b 6520 696d 6167       # make imag
-0000ff30: 6520 656e 7472 7920 6c69 7374 2028 616c  e entry list (al
-0000ff40: 736f 2069 6620 6974 7320 6120 7069 6374  so if its a pict
-0000ff50: 7572 6529 0a20 2020 2020 2020 2020 2020  ure).           
-0000ff60: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-0000ff70: 6365 2864 6174 612c 206c 6973 7429 3a0a  ce(data, list):.
-0000ff80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff90: 6461 7461 203d 205b 6461 7461 5d0a 2020  data = [data].  
-0000ffa0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0000ffb0: 2020 2020 2020 2066 6f72 2074 696d 6570         for timep
-0000ffc0: 6f69 6e74 5f64 6174 6120 696e 2064 6174  oint_data in dat
-0000ffd0: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
-0000ffe0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000fff0: 2020 2020 2020 2020 2020 2020 6c61 7420              lat 
-00010000: 3d20 7469 6d65 706f 696e 745f 6461 7461  = timepoint_data
-00010010: 5b27 696d 6167 652d 6c61 7469 7475 6465  ['image-latitude
-00010020: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-00010030: 2020 2020 2020 206c 6f6e 203d 2074 696d         lon = tim
-00010040: 6570 6f69 6e74 5f64 6174 615b 2769 6d61  epoint_data['ima
-00010050: 6765 2d6c 6f6e 6769 7475 6465 275d 0a20  ge-longitude']. 
-00010060: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00010070: 7863 6570 7420 4b65 7945 7272 6f72 2061  xcept KeyError a
-00010080: 7320 6578 3a0a 2020 2020 2020 2020 2020  s ex:.          
-00010090: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-000100a0: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
-000100b0: 2020 2020 6966 2069 203d 3d20 303a 0a20      if i == 0:. 
-000100c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100d0: 2020 206c 6174 5f6d 696e 2c20 6c61 745f     lat_min, lat_
-000100e0: 6d61 7820 3d20 6c61 742c 206c 6174 0a20  max = lat, lat. 
-000100f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010100: 2020 206c 6f6e 5f6d 696e 2c20 6c6f 6e5f     lon_min, lon_
-00010110: 6d61 7820 3d20 6c6f 6e2c 206c 6f6e 0a20  max = lon, lon. 
-00010120: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00010130: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00010140: 2020 2020 2020 2020 2069 6620 6c61 7420           if lat 
-00010150: 3c20 6c61 745f 6d69 6e3a 0a20 2020 2020  < lat_min:.     
-00010160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010170: 2020 206c 6174 5f6d 696e 203d 206c 6174     lat_min = lat
-00010180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010190: 2020 2020 2069 6620 6c61 7420 3e20 6c61       if lat > la
-000101a0: 745f 6d61 783a 0a20 2020 2020 2020 2020  t_max:.         
-000101b0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000101c0: 6174 5f6d 6178 203d 206c 6174 0a20 2020  at_max = lat.   
-000101d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000101e0: 2069 6620 6c6f 6e20 3c20 6c6f 6e5f 6d69   if lon < lon_mi
-000101f0: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-00010200: 2020 2020 2020 2020 2020 206c 6f6e 5f6d             lon_m
-00010210: 696e 203d 206c 6f6e 0a20 2020 2020 2020  in = lon.       
-00010220: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00010230: 6c6f 6e20 3e20 6c6f 6e5f 6d61 783a 0a20  lon > lon_max:. 
-00010240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010250: 2020 2020 2020 206c 6f6e 5f6d 6178 203d         lon_max =
-00010260: 206c 6f6e 0a20 2020 2020 2020 2020 2020   lon.           
-00010270: 2020 2020 2069 202b 3d20 310a 2020 2020       i += 1.    
-00010280: 2020 2020 7265 7475 726e 206c 6174 5f6d      return lat_m
-00010290: 696e 2c20 6c61 745f 6d61 782c 206c 6f6e  in, lat_max, lon
-000102a0: 5f6d 696e 2c20 6c6f 6e5f 6d61 780a 0a0a  _min, lon_max...
-000102b0: 2020 2020 6465 6620 7265 6d6f 7665 4974      def removeIt
-000102c0: 656d 4669 656c 6473 5769 7468 4f6e 6c79  emFieldsWithOnly
-000102d0: 4461 7465 5469 6d65 2873 656c 6629 3a0a  DateTime(self):.
-000102e0: 2020 2020 2020 2020 2222 2220 6974 2063          """ it c
-000102f0: 616e 2068 6170 7065 6e20 7468 6174 2061  an happen that a
-00010300: 6e20 696d 6167 6520 7469 6d65 7374 616d  n image timestam
-00010310: 7020 646f 6573 206e 6f74 2063 6f6e 7461  p does not conta
-00010320: 696e 2061 6e79 2066 6965 6c64 7320 6275  in any fields bu
-00010330: 7420 7468 6520 7469 6d65 7374 616d 7020  t the timestamp 
-00010340: 616e 7920 6d6f 7265 2e20 5468 6f73 6520  any more. Those 
-00010350: 6172 6520 7265 6d6f 7665 6420 6865 7265  are removed here
-00010360: 2e20 2222 2220 0a20 2020 2020 2020 2066  . """ .        f
-00010370: 6f72 2069 7465 6d20 696e 2073 656c 662e  or item in self.
-00010380: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-00010390: 6167 6553 6574 4974 656d 734b 6579 5d3a  ageSetItemsKey]:
-000103a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000103b0: 6e6f 7420 6973 696e 7374 616e 6365 2873  not isinstance(s
-000103c0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-000103d0: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-000103e0: 6579 5d5b 6974 656d 5d2c 6c69 7374 293a  ey][item],list):
-000103f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010400: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-00010410: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-00010420: 734b 6579 5d5b 6974 656d 5d20 3d20 5b73  sKey][item] = [s
-00010430: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-00010440: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-00010450: 6579 5d5b 6974 656d 5d5d 0a20 2020 2020  ey][item]].     
-00010460: 2020 2020 2020 2074 6f42 6552 656d 6f76         toBeRemov
-00010470: 6564 203d 205b 5d0a 2020 2020 2020 2020  ed = [].        
-00010480: 2020 2020 666f 7220 656e 7472 7920 696e      for entry in
-00010490: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-000104a0: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-000104b0: 734b 6579 5d5b 6974 656d 5d3a 0a20 2020  sKey][item]:.   
-000104c0: 2020 2020 2020 2020 2020 2020 2023 7072               #pr
-000104d0: 696e 7428 656e 7472 7929 0a20 2020 2020  int(entry).     
-000104e0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-000104f0: 6e28 656e 7472 7929 203d 3d20 3120 616e  n(entry) == 1 an
-00010500: 6420 2769 6d61 6765 2d64 6174 6574 696d  d 'image-datetim
-00010510: 6527 2069 6e20 656e 7472 793a 0a20 2020  e' in entry:.   
-00010520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010530: 2074 6f42 6552 656d 6f76 6564 2e61 7070   toBeRemoved.app
-00010540: 656e 6428 656e 7472 7929 0a20 2020 2020  end(entry).     
-00010550: 2020 2020 2020 2066 6f72 2065 6e74 7279         for entry
-00010560: 2069 6e20 746f 4265 5265 6d6f 7665 643a   in toBeRemoved:
-00010570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010580: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-00010590: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-000105a0: 734b 6579 5d5b 6974 656d 5d2e 7265 6d6f  sKey][item].remo
-000105b0: 7665 2865 6e74 7279 2920 0a0a 0a20 2020  ve(entry) ...   
-000105c0: 2064 6566 2063 6865 636b 416c 6c49 7465   def checkAllIte
-000105d0: 6d48 6173 6865 7328 7365 6c66 2c20 6861  mHashes(self, ha
-000105e0: 7264 3d46 616c 7365 2c20 7261 6973 6545  rd=False, raiseE
-000105f0: 7863 6570 7469 6f6e 203d 2054 7275 6529  xception = True)
-00010600: 3a0a 2020 2020 2020 2020 2222 2220 0a20  :.        """ . 
-00010610: 2020 2020 2020 2043 6865 636b 7320 6966         Checks if
-00010620: 2068 6173 6865 7320 696e 2069 4644 4f20   hashes in iFDO 
-00010630: 6d61 7463 6820 6861 7368 6573 2069 6e20  match hashes in 
-00010640: 696e 7465 726d 6569 6461 7465 2068 6173  intermeidate has
-00010650: 6820 6669 6c65 2069 6620 7468 6520 6c61  h file if the la
-00010660: 7474 6572 2077 6173 2063 6861 6e67 6564  tter was changed
-00010670: 206c 6173 7420 6166 7465 7220 7468 6520   last after the 
-00010680: 696d 6167 6573 2068 6173 2063 6861 6e67  images has chang
-00010690: 6564 2e0a 2020 2020 2020 2020 4f74 6865  ed..        Othe
-000106a0: 7277 6973 6520 6f72 2069 6620 6861 7264  rwise or if hard
-000106b0: 3d3d 5472 7565 2069 7420 7265 6465 7465  ==True it redete
-000106c0: 726d 696e 6573 2074 6865 2061 6374 7561  rmines the actua
-000106d0: 6c6c 2066 696c 6527 7320 6861 7368 2061  ll file's hash a
-000106e0: 6e64 2063 6f6d 7061 7265 7320 7468 6520  nd compares the 
-000106f0: 6946 444f 2069 7465 6d27 7320 6861 7368  iFDO item's hash
-00010700: 2077 6974 6820 7468 6174 2e0a 2020 2020   with that..    
-00010710: 2020 2020 4966 2068 6173 6865 7320 646f      If hashes do
-00010720: 206e 6f74 206d 6174 6368 2061 206d 6172   not match a mar
-00010730: 6971 742e 636f 7265 2e49 6664 6f45 7863  iqt.core.IfdoExc
-00010740: 6570 7469 6f6e 2069 7320 7269 7365 6e20  eption is risen 
-00010750: 756e 736c 6573 7320 7261 6973 6545 7863  unsless raiseExc
-00010760: 6570 7469 6f6e 203d 3d20 4661 6c73 652c  eption == False,
-00010770: 2074 6865 6e20 6120 6c69 7374 206f 6620   then a list of 
-00010780: 6c69 7374 7320 5b3c 6669 6c65 3e2c 3c65  lists [<file>,<e
-00010790: 7863 6570 7469 6f6e 3e5d 2069 7320 7265  xception>] is re
-000107a0: 7475 726e 6564 2e0a 2020 2020 2020 2020  turned..        
-000107b0: 2222 220a 2020 2020 2020 2020 6861 7368  """.        hash
-000107c0: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
-000107d0: 6861 7368 4669 6c65 4d6f 6454 696d 6520  hashFileModTime 
-000107e0: 3d20 3130 652b 3130 300a 2020 2020 2020  = 10e+100.      
-000107f0: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-00010800: 7374 7328 7365 6c66 2e67 6574 5f69 6e74  sts(self.get_int
-00010810: 5f68 6173 685f 6669 6c65 2829 293a 0a20  _hash_file()):. 
-00010820: 2020 2020 2020 2020 2020 2068 6173 6865             hashe
-00010830: 7320 3d20 6d69 7174 662e 7461 6246 696c  s = miqtf.tabFil
-00010840: 6544 6174 6128 7365 6c66 2e67 6574 5f69  eData(self.get_i
-00010850: 6e74 5f68 6173 685f 6669 6c65 2829 2c20  nt_hash_file(), 
-00010860: 5b6d 6971 7476 2e63 6f6c 5f68 6561 6465  [miqtv.col_heade
-00010870: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-00010880: 275d 2c20 6d69 7174 762e 636f 6c5f 6865  '], miqtv.col_he
-00010890: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-000108a0: 6861 7368 275d 5d2c 206b 6579 5f63 6f6c  hash']], key_col
-000108b0: 3d6d 6971 7476 2e63 6f6c 5f68 6561 6465  =miqtv.col_heade
-000108c0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-000108d0: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-000108e0: 6861 7368 4669 6c65 4d6f 6454 696d 6520  hashFileModTime 
-000108f0: 3d20 6f73 2e70 6174 682e 6765 746d 7469  = os.path.getmti
-00010900: 6d65 2873 656c 662e 6765 745f 696e 745f  me(self.get_int_
-00010910: 6861 7368 5f66 696c 6528 2929 0a0a 2020  hash_file())..  
-00010920: 2020 2020 2020 6578 6365 7074 696f 6e4c        exceptionL
-00010930: 6973 7420 3d20 5b5d 0a0a 2020 2020 2020  ist = []..      
-00010940: 2020 6861 7368 556e 6368 6563 6b49 6d61    hashUncheckIma
-00010950: 6765 7349 6e52 6177 203d 2073 656c 662e  gesInRaw = self.
-00010960: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
-00010970: 7228 290a 2020 2020 2020 2020 7072 6f67  r().        prog
-00010980: 203d 206d 6971 7463 2e50 7269 6e74 4b6e   = miqtc.PrintKn
-00010990: 6f77 6e50 726f 6772 6573 734d 7367 2822  ownProgressMsg("
-000109a0: 4368 6563 6b69 6e67 2069 7465 6d20 6861  Checking item ha
-000109b0: 7368 6573 222c 206c 656e 2873 656c 662e  shes", len(self.
-000109c0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-000109d0: 6167 6553 6574 4974 656d 734b 6579 5d29  ageSetItemsKey])
-000109e0: 290a 2020 2020 2020 2020 666f 7220 6974  ).        for it
-000109f0: 656d 2069 6e20 7365 6c66 2e69 6664 6f5f  em in self.ifdo_
-00010a00: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-00010a10: 7449 7465 6d73 4b65 795d 3a0a 2020 2020  tItemsKey]:.    
-00010a20: 2020 2020 2020 2020 7072 6f67 2e70 726f          prog.pro
-00010a30: 6772 6573 7328 290a 0a20 2020 2020 2020  gress()..       
-00010a40: 2020 2020 2066 6f75 6e64 203d 2046 616c       found = Fal
-00010a50: 7365 0a20 2020 2020 2020 2020 2020 2066  se.            f
-00010a60: 6f72 2069 6d61 6765 2069 6e20 6861 7368  or image in hash
-00010a70: 556e 6368 6563 6b49 6d61 6765 7349 6e52  UncheckImagesInR
-00010a80: 6177 3a0a 2020 2020 2020 2020 2020 2020  aw:.            
-00010a90: 2020 2020 6669 6c65 4e61 6d65 203d 206f      fileName = o
-00010aa0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-00010ab0: 696d 6167 6529 0a20 2020 2020 2020 2020  image).         
-00010ac0: 2020 2020 2020 2069 6620 6669 6c65 4e61         if fileNa
-00010ad0: 6d65 203d 3d20 6974 656d 3a0a 2020 2020  me == item:.    
-00010ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010af0: 666f 756e 6420 3d20 5472 7565 0a20 2020  found = True.   
-00010b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b10: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
-00010b20: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-00010b30: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-00010b40: 6579 5d5b 6974 656d 5d2c 6c69 7374 293a  ey][item],list):
-00010b50: 2023 2069 6e20 6361 7365 206f 6620 7669   # in case of vi
-00010b60: 6465 6f20 7769 7468 2069 7465 6d20 6173  deo with item as
-00010b70: 206c 6973 7420 7468 6520 6669 7273 7420   list the first 
-00010b80: 656e 7472 7920 686f 6c64 7320 7468 6520  entry holds the 
-00010b90: 6465 6661 756c 7420 616e 6420 7468 6520  default and the 
-00010ba0: 6861 7368 2063 616e 6e6f 7420 7661 7279  hash cannot vary
-00010bb0: 2066 6f72 2074 6865 2073 616d 6520 696d   for the same im
-00010bc0: 6167 650a 2020 2020 2020 2020 2020 2020  age.            
-00010bd0: 2020 2020 2020 2020 2020 2020 6974 656d              item
-00010be0: 456e 7472 7920 3d20 7365 6c66 2e69 6664  Entry = self.ifd
-00010bf0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-00010c00: 5365 7449 7465 6d73 4b65 795d 5b69 7465  SetItemsKey][ite
-00010c10: 6d5d 5b30 5d20 0a20 2020 2020 2020 2020  m][0] .         
-00010c20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00010c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010c40: 2020 2020 2020 2020 2069 7465 6d45 6e74           itemEnt
-00010c50: 7279 203d 2073 656c 662e 6966 646f 5f74  ry = self.ifdo_t
-00010c60: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-00010c70: 4974 656d 734b 6579 5d5b 6974 656d 5d0a  ItemsKey][item].
-00010c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010c90: 2020 2020 2069 6d61 6765 4d6f 6454 696d       imageModTim
-00010ca0: 6520 3d20 6f73 2e70 6174 682e 6765 746d  e = os.path.getm
-00010cb0: 7469 6d65 2869 6d61 6765 290a 2020 2020  time(image).    
-00010cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010cd0: 6966 206e 6f74 2068 6172 6420 616e 6420  if not hard and 
-00010ce0: 696d 6167 654d 6f64 5469 6d65 203c 2068  imageModTime < h
-00010cf0: 6173 6846 696c 654d 6f64 5469 6d65 3a0a  ashFileModTime:.
-00010d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d10: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-00010d20: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-00010d30: 696d 6167 6529 2069 6e20 6861 7368 6573  image) in hashes
-00010d40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010d50: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00010d60: 2072 6169 7365 4578 6365 7074 696f 6e3a   raiseException:
-00010d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d90: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
-00010da0: 6f45 7863 6570 7469 6f6e 2869 7465 6d2c  oException(item,
-00010db0: 2022 6e6f 7420 666f 756e 6420 696e 2069   "not found in i
-00010dc0: 6e74 6572 6d65 6964 6174 6520 6861 7368  ntermeidate hash
-00010dd0: 2066 696c 6522 2c73 656c 662e 6765 745f   file",self.get_
-00010de0: 696e 745f 6861 7368 5f66 696c 6528 292c  int_hash_file(),
-00010df0: 2220 7275 6e20 6372 6561 7465 5f69 6d61  " run create_ima
-00010e00: 6765 5f73 6861 3235 365f 6669 6c65 2829  ge_sha256_file()
-00010e10: 2066 6972 7374 2229 200a 2020 2020 2020   first") .      
-00010e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e30: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00010e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e50: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00010e60: 7074 696f 6e4c 6973 742e 6170 7065 6e64  ptionList.append
-00010e70: 285b 6669 6c65 4e61 6d65 2c22 6e6f 7420  ([fileName,"not 
-00010e80: 666f 756e 6420 696e 2069 6e74 6572 6d65  found in interme
-00010e90: 6964 6174 6520 6861 7368 2066 696c 6520  idate hash file 
-00010ea0: 2220 2b20 7374 7228 7365 6c66 2e67 6574  " + str(self.get
-00010eb0: 5f69 6e74 5f68 6173 685f 6669 6c65 2829  _int_hash_file()
-00010ec0: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
-00010ed0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00010ee0: 6f74 2069 7465 6d45 6e74 7279 5b27 696d  ot itemEntry['im
-00010ef0: 6167 652d 6861 7368 2d73 6861 3235 3627  age-hash-sha256'
-00010f00: 5d20 3d3d 2068 6173 6865 735b 6f73 2e70  ] == hashes[os.p
-00010f10: 6174 682e 6261 7365 6e61 6d65 2869 6d61  ath.basename(ima
-00010f20: 6765 295d 5b27 696d 6167 652d 6861 7368  ge)]['image-hash
-00010f30: 2d73 6861 3235 3627 5d3a 0a20 2020 2020  -sha256']:.     
-00010f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f50: 2020 2020 2020 2069 6620 7261 6973 6545         if raiseE
-00010f60: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-00010f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f80: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00010f90: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-00010fa0: 696f 6e28 6974 656d 2c20 2269 6e63 6f72  ion(item, "incor
-00010fb0: 7265 6374 2073 6861 3235 3620 6861 7368  rect sha256 hash
-00010fc0: 222c 2069 7465 6d45 6e74 7279 5b27 696d  ", itemEntry['im
-00010fd0: 6167 652d 6861 7368 2d73 6861 3235 3627  age-hash-sha256'
-00010fe0: 5d2c 2266 6f72 2066 696c 6522 2c66 696c  ],"for file",fil
-00010ff0: 654e 616d 652c 2220 7275 6e20 6372 6561  eName," run crea
-00011000: 7465 5f69 6d61 6765 5f73 6861 3235 365f  te_image_sha256_
-00011010: 6669 6c65 2829 2066 6972 7374 2229 0a20  file() first"). 
-00011020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011030: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00011040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011060: 2065 7863 6570 7469 6f6e 4c69 7374 2e61   exceptionList.a
-00011070: 7070 656e 6428 5b66 696c 654e 616d 652c  ppend([fileName,
-00011080: 2269 6e63 6f72 7265 6374 2073 6861 3235  "incorrect sha25
-00011090: 3620 6861 7368 225d 290a 2020 2020 2020  6 hash"]).      
-000110a0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000110b0: 6966 206e 6f74 2069 7465 6d45 6e74 7279  if not itemEntry
-000110c0: 5b27 696d 6167 652d 6861 7368 2d73 6861  ['image-hash-sha
-000110d0: 3235 3627 5d20 3d3d 206d 6971 7463 2e73  256'] == miqtc.s
-000110e0: 6861 3235 3648 6173 6846 696c 6528 696d  ha256HashFile(im
-000110f0: 6167 6529 3a0a 2020 2020 2020 2020 2020  age):.          
-00011100: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00011110: 2072 6169 7365 4578 6365 7074 696f 6e3a   raiseException:
-00011120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011130: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00011140: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
-00011150: 6570 7469 6f6e 2869 7465 6d2c 2022 696e  eption(item, "in
-00011160: 636f 7272 6563 7420 7368 6132 3536 2068  correct sha256 h
-00011170: 6173 6822 2c20 6974 656d 456e 7472 795b  ash", itemEntry[
-00011180: 2769 6d61 6765 2d68 6173 682d 7368 6132  'image-hash-sha2
-00011190: 3536 275d 2c22 666f 7220 6669 6c65 222c  56'],"for file",
-000111a0: 6669 6c65 4e61 6d65 2c22 2072 756e 2063  fileName," run c
-000111b0: 7265 6174 655f 696d 6167 655f 7368 6132  reate_image_sha2
-000111c0: 3536 5f66 696c 6528 2920 6669 7273 7422  56_file() first"
-000111d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000111e0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000111f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011200: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00011210: 7074 696f 6e4c 6973 742e 6170 7065 6e64  ptionList.append
-00011220: 285b 6669 6c65 4e61 6d65 2c22 696e 636f  ([fileName,"inco
-00011230: 7272 6563 7420 7368 6132 3536 2068 6173  rrect sha256 has
-00011240: 6822 5d29 0a20 2020 2020 2020 2020 2020  h"]).           
-00011250: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-00011260: 2020 2020 2020 2020 2020 2069 6620 666f             if fo
-00011270: 756e 643a 0a20 2020 2020 2020 2020 2020  und:.           
-00011280: 2020 2020 2064 656c 2068 6173 6855 6e63       del hashUnc
-00011290: 6865 636b 496d 6167 6573 496e 5261 775b  heckImagesInRaw[
-000112a0: 696d 6167 655d 0a20 2020 2020 2020 2020  image].         
-000112b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000112c0: 2020 2020 2020 2020 2069 6620 7261 6973           if rais
-000112d0: 6545 7863 6570 7469 6f6e 3a0a 2020 2020  eException:.    
-000112e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112f0: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
-00011300: 4578 6365 7074 696f 6e28 2022 696d 6167  Exception( "imag
-00011310: 6522 2c20 6974 656d 2c20 226e 6f74 2066  e", item, "not f
-00011320: 6f75 6e64 2069 6e20 6469 7265 6374 6f72  ound in director
-00011330: 7927 7320 7261 7720 666f 6c64 6572 2122  y's raw folder!"
-00011340: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00011350: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00011360: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00011370: 7074 696f 6e4c 6973 742e 6170 7065 6e64  ptionList.append
-00011380: 285b 6669 6c65 4e61 6d65 2c22 6669 6c65  ([fileName,"file
-00011390: 206e 6f74 2066 6f75 6e64 225d 290a 2020   not found"]).  
-000113a0: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
-000113b0: 2829 0a20 2020 2020 2020 2069 6620 6e6f  ().        if no
-000113c0: 7420 7261 6973 6545 7863 6570 7469 6f6e  t raiseException
-000113d0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000113e0: 7475 726e 2065 7863 6570 7469 6f6e 4c69  turn exceptionLi
-000113f0: 7374 0a0a 0a20 2020 2064 6566 2063 7265  st...    def cre
-00011400: 6174 655f 7575 6964 5f66 696c 6528 7365  ate_uuid_file(se
-00011410: 6c66 2c63 6c65 616e 3d54 7275 6529 3a0a  lf,clean=True):.
-00011420: 2020 2020 2020 2020 2222 2220 4372 6561          """ Crea
-00011430: 7465 7320 696e 202f 696e 7465 726d 6564  tes in /intermed
-00011440: 6961 7465 2061 2074 6578 7420 6669 6c65  iate a text file
-00011450: 2063 6f6e 7461 696e 696e 6720 7065 7220   containing per 
-00011460: 696d 6167 6520 6120 6372 6561 7465 6420  image a created 
-00011470: 7575 6964 2028 7665 7273 696f 6e20 3429  uuid (version 4)
-00011480: 2e0a 0a20 2020 2020 2020 2054 6865 2055  ...        The U
-00011490: 5549 4420 6973 206f 6e6c 7920 2a74 616b  UID is only *tak
-000114a0: 656e 2a20 6672 6f6d 2074 6865 206d 6574  en* from the met
-000114b0: 6164 6174 6120 6f66 2074 6865 2069 6d61  adata of the ima
-000114c0: 6765 732e 2049 7420 646f 6573 206e 6f74  ges. It does not
-000114d0: 2077 7269 7465 2055 5549 4473 2074 6f20   write UUIDs to 
-000114e0: 7468 6520 6d65 7461 6461 7461 2069 6e20  the metadata in 
-000114f0: 6361 7365 2073 6f6d 6520 6669 6c65 7320  case some files 
-00011500: 6172 6520 6d69 7373 696e 6720 6974 2e0a  are missing it..
-00011510: 2020 2020 2020 2020 4275 742c 2069 7420          But, it 
-00011520: 6372 6561 7465 7320 6120 4353 5620 6669  creates a CSV fi
-00011530: 6c65 2069 6e20 7468 6174 2063 6173 6520  le in that case 
-00011540: 7468 6174 2079 6f75 2063 616e 2075 7365  that you can use
-00011550: 2074 6f67 6574 6865 7220 7769 7468 2065   together with e
-00011560: 7869 6674 6f6f 6c20 746f 2061 6464 2074  xiftool to add t
-00011570: 6865 2055 5549 4420 746f 2079 6f75 7220  he UUID to your 
-00011580: 6461 7461 2e20 4265 7761 7265 2120 7468  data. Beware! th
-00011590: 6973 2063 616e 2064 6573 7472 6f79 2079  is can destroy y
-000115a0: 6f75 7220 696d 6167 6573 0a20 2020 2020  our images.     
-000115b0: 2020 2069 6620 6e6f 7420 646f 6e65 2070     if not done p
-000115c0: 726f 7065 726c 7921 204e 6f20 6775 6172  roperly! No guar
-000115d0: 616e 7465 6520 6973 2067 6976 656e 2069  antee is given i
-000115e0: 7420 7769 6c6c 2077 6f72 6b2e 2042 6520  t will work. Be 
-000115f0: 6361 7265 6675 6c21 0a0a 2020 2020 2020  careful!..      
-00011600: 2020 5573 6520 636c 6561 6e3d 4661 6c73    Use clean=Fals
-00011610: 6520 746f 206e 6f74 2063 6865 636b 2074  e to not check t
-00011620: 686f 7365 2066 696c 6573 2061 6761 696e  hose files again
-00011630: 2077 6869 6368 2061 7265 2061 6c72 6561   which are alrea
-00011640: 6479 2066 6f75 6e64 2069 6e20 696e 7465  dy found in inte
-00011650: 726d 6564 6961 7465 2075 7569 6420 6669  rmediate uuid fi
-00011660: 6c65 0a20 2020 2020 2020 2022 2222 0a0a  le.        """..
-00011670: 2020 2020 2020 2020 7575 6964 7320 3d20          uuids = 
-00011680: 7b7d 0a20 2020 2020 2020 2023 2043 6865  {}.        # Che
-00011690: 636b 2077 6865 7468 6572 2061 2066 696c  ck whether a fil
-000116a0: 6520 7769 7468 2055 5549 4473 2065 7869  e with UUIDs exi
-000116b0: 7374 732c 2074 6865 6e20 7265 6164 2069  sts, then read i
-000116c0: 740a 2020 2020 2020 2020 6966 206e 6f74  t.        if not
-000116d0: 2063 6c65 616e 2061 6e64 206f 732e 7061   clean and os.pa
-000116e0: 7468 2e65 7869 7374 7328 7365 6c66 2e67  th.exists(self.g
-000116f0: 6574 5f69 6e74 5f75 7569 645f 6669 6c65  et_int_uuid_file
-00011700: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
-00011710: 2075 7569 6473 203d 206d 6971 7466 2e74   uuids = miqtf.t
-00011720: 6162 4669 6c65 4461 7461 2873 656c 662e  abFileData(self.
-00011730: 6765 745f 696e 745f 7575 6964 5f66 696c  get_int_uuid_fil
-00011740: 6528 292c 205b 6d69 7174 762e 636f 6c5f  e(), [miqtv.col_
-00011750: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00011760: 5b27 696d 6727 5d2c 206d 6971 7476 2e63  ['img'], miqtv.c
-00011770: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00011780: 7427 5d5b 2775 7569 6427 5d5d 2c20 6b65  t']['uuid']], ke
-00011790: 795f 636f 6c3d 6d69 7174 762e 636f 6c5f  y_col=miqtv.col_
-000117a0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-000117b0: 5b27 696d 6727 5d29 0a20 2020 2020 2020  ['img']).       
-000117c0: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
-000117d0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-000117e0: 7365 6c66 2e69 6d61 6765 7344 6972 293a  self.imagesDir):
-000117f0: 0a0a 2020 2020 2020 2020 2020 2020 6d69  ..            mi
-00011800: 7373 696e 675f 7575 6964 7320 3d20 7b7d  ssing_uuids = {}
-00011810: 0a20 2020 2020 2020 2020 2020 2061 6464  .            add
-00011820: 6564 5f75 7569 6473 203d 2030 0a0a 2020  ed_uuids = 0..  
-00011830: 2020 2020 2020 2020 2020 756e 6b6e 6f77            unknow
-00011840: 6e46 696c 6573 203d 205b 5d0a 2020 2020  nFiles = [].    
-00011850: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
-00011860: 2069 6e20 7365 6c66 2e69 6d61 6765 7349   in self.imagesI
-00011870: 6e49 6d61 6765 7344 6972 2829 3a0a 2020  nImagesDir():.  
-00011880: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00011890: 6c65 5f6e 616d 6520 3d20 6f73 2e70 6174  le_name = os.pat
-000118a0: 682e 6261 7365 6e61 6d65 2866 696c 6529  h.basename(file)
-000118b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000118c0: 2069 6620 6669 6c65 5f6e 616d 6520 6e6f   if file_name no
-000118d0: 7420 696e 2075 7569 6473 3a0a 2020 2020  t in uuids:.    
-000118e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118f0: 756e 6b6e 6f77 6e46 696c 6573 2e61 7070  unknownFiles.app
-00011900: 656e 6428 6669 6c65 290a 2020 2020 2020  end(file).      
-00011910: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00011920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011930: 2020 2020 7575 6964 735b 6669 6c65 5f6e      uuids[file_n
-00011940: 616d 655d 203d 2075 7569 6473 5b66 696c  ame] = uuids[fil
-00011950: 655f 6e61 6d65 5d5b 6d69 7174 762e 636f  e_name][miqtv.co
-00011960: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00011970: 275d 5b27 7575 6964 275d 5d0a 0a20 2020  ']['uuid']]..   
-00011980: 2020 2020 2020 2020 2075 6e6b 6e6f 776e           unknown
-00011990: 4669 6c65 7355 5549 4473 203d 206d 6971  FilesUUIDs = miq
-000119a0: 7469 2e69 6d61 6765 7343 6f6e 7461 696e  ti.imagesContain
-000119b0: 5661 6c69 6455 5549 4428 756e 6b6e 6f77  ValidUUID(unknow
-000119c0: 6e46 696c 6573 290a 2020 2020 2020 2020  nFiles).        
-000119d0: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
-000119e0: 756e 6b6e 6f77 6e46 696c 6573 5555 4944  unknownFilesUUID
-000119f0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00011a00: 2020 2066 696c 655f 6e61 6d65 203d 206f     file_name = o
-00011a10: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-00011a20: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
-00011a30: 2020 2020 2020 6966 206e 6f74 2075 6e6b        if not unk
-00011a40: 6e6f 776e 4669 6c65 7355 5549 4473 5b66  nownFilesUUIDs[f
-00011a50: 696c 655d 5b27 7661 6c69 6427 5d3a 0a20  ile]['valid']:. 
-00011a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a70: 2020 2075 7569 6420 3d20 6d69 7174 632e     uuid = miqtc.
-00011a80: 7575 6964 3428 290a 2020 2020 2020 2020  uuid4().        
-00011a90: 2020 2020 2020 2020 2020 2020 6d69 7373              miss
-00011aa0: 696e 675f 7575 6964 735b 6669 6c65 5d20  ing_uuids[file] 
-00011ab0: 3d20 7575 6964 0a20 2020 2020 2020 2020  = uuid.         
-00011ac0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00011ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ae0: 2075 7569 6473 5b66 696c 655f 6e61 6d65   uuids[file_name
-00011af0: 5d20 3d20 756e 6b6e 6f77 6e46 696c 6573  ] = unknownFiles
-00011b00: 5555 4944 735b 6669 6c65 5d5b 2775 7569  UUIDs[file]['uui
-00011b10: 6427 5d0a 2020 2020 2020 2020 2020 2020  d'].            
-00011b20: 2020 2020 2020 2020 6164 6465 645f 7575          added_uu
-00011b30: 6964 7320 2b3d 2031 0a0a 2020 2020 2020  ids += 1..      
-00011b40: 2020 2020 2020 2320 4966 2070 7265 7669        # If previ
-00011b50: 6f75 736c 7920 756e 6b6e 6f77 6e20 5555  ously unknown UU
-00011b60: 4944 7320 7765 7265 2066 6f75 6e64 2069  IDs were found i
-00011b70: 6e20 7468 6520 6669 6c65 2068 6561 6465  n the file heade
-00011b80: 7273 2c20 6164 6420 7468 656d 2074 6f20  rs, add them to 
-00011b90: 7468 6520 5555 4944 2066 696c 650a 2020  the UUID file.  
-00011ba0: 2020 2020 2020 2020 2020 6966 2061 6464            if add
-00011bb0: 6564 5f75 7569 6473 203e 2030 3a0a 2020  ed_uuids > 0:.  
-00011bc0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00011bd0: 7320 3d20 6f70 656e 2873 656c 662e 6765  s = open(self.ge
-00011be0: 745f 696e 745f 7575 6964 5f66 696c 6528  t_int_uuid_file(
-00011bf0: 292c 2022 7722 290a 2020 2020 2020 2020  ), "w").        
-00011c00: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
-00011c10: 6528 6d69 7174 762e 636f 6c5f 6865 6164  e(miqtv.col_head
-00011c20: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
-00011c30: 6727 5d20 2b22 5c74 222b 6d69 7174 762e  g'] +"\t"+miqtv.
-00011c40: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00011c50: 7174 275d 5b27 7575 6964 275d 2b22 5c6e  qt']['uuid']+"\n
-00011c60: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00011c70: 2020 2066 6f72 2066 696c 6520 696e 2075     for file in u
-00011c80: 7569 6473 3a0a 2020 2020 2020 2020 2020  uids:.          
-00011c90: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00011ca0: 6974 6528 6669 6c65 2b22 5c74 222b 7374  ite(file+"\t"+st
-00011cb0: 7228 7575 6964 735b 6669 6c65 5d29 2b22  r(uuids[file])+"
-00011cc0: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
-00011cd0: 2020 2020 2072 6573 2e63 6c6f 7365 2829       res.close()
-00011ce0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00011cf0: 206c 656e 286d 6973 7369 6e67 5f75 7569   len(missing_uui
-00011d00: 6473 2920 3e20 303a 0a20 2020 2020 2020  ds) > 0:.       
-00011d10: 2020 2020 2020 2020 2065 6373 765f 7061           ecsv_pa
-00011d20: 7468 203d 2073 656c 662e 5f5f 6765 745f  th = self.__get_
-00011d30: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
-00011d40: 2920 2b20 225f 6578 6966 2d61 6464 2d75  ) + "_exif-add-u
-00011d50: 7569 642e 6373 7622 0a20 2020 2020 2020  uid.csv".       
-00011d60: 2020 2020 2020 2020 2063 7376 203d 206f           csv = o
-00011d70: 7065 6e28 6563 7376 5f70 6174 682c 2022  pen(ecsv_path, "
-00011d80: 7722 290a 2020 2020 2020 2020 2020 2020  w").            
-00011d90: 2020 2020 6373 762e 7772 6974 6528 6d69      csv.write(mi
-00011da0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00011db0: 6578 6966 275d 5b27 696d 6727 5d20 2b0a  exif']['img'] +.
-00011dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011dd0: 2020 2020 2020 2020 2020 222c 222b 6d69            ","+mi
-00011de0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00011df0: 6578 6966 275d 5b27 7575 6964 275d 2b22  exif']['uuid']+"
-00011e00: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
-00011e10: 2020 2020 2064 6966 6665 7265 6e74 5f70       different_p
-00011e20: 6174 6873 203d 205b 5d0a 2020 2020 2020  aths = [].      
-00011e30: 2020 2020 2020 2020 2020 666f 7220 696d            for im
-00011e40: 6720 696e 206d 6973 7369 6e67 5f75 7569  g in missing_uui
-00011e50: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
-00011e60: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-00011e70: 7468 2e62 6173 656e 616d 6528 696d 6729  th.basename(img)
-00011e80: 206e 6f74 2069 6e20 6469 6666 6572 656e   not in differen
-00011e90: 745f 7061 7468 733a 0a20 2020 2020 2020  t_paths:.       
-00011ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011eb0: 2064 6966 6665 7265 6e74 5f70 6174 6873   different_paths
-00011ec0: 2e61 7070 656e 6428 6f73 2e70 6174 682e  .append(os.path.
-00011ed0: 6261 7365 6e61 6d65 2869 6d67 2929 0a20  basename(img)). 
-00011ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ef0: 2020 2063 7376 2e77 7269 7465 2869 6d67     csv.write(img
-00011f00: 2b22 2c22 2b73 7472 286d 6973 7369 6e67  +","+str(missing
-00011f10: 5f75 7569 6473 5b69 6d67 5d29 2b22 5c6e  _uuids[img])+"\n
-00011f20: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00011f30: 2020 2023 7265 7475 726e 2046 616c 7365     #return False
-00011f40: 2c20 2265 7869 6674 6f6f 6c20 2d63 7376  , "exiftool -csv
-00011f50: 3d22 2b65 6373 765f 7061 7468 2b22 2022  ="+ecsv_path+" "
-00011f60: 2b22 2022 2e6a 6f69 6e28 6469 6666 6572  +" ".join(differ
-00011f70: 656e 745f 7061 7468 7329 0a20 2020 2020  ent_paths).     
-00011f80: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00011f90: 6e20 4661 6c73 652c 2022 4e6f 7420 616c  n False, "Not al
-00011fa0: 6c20 696d 6167 6573 2068 6176 6520 7661  l images have va
-00011fb0: 6c69 6420 5555 4944 732e 204d 6973 7369  lid UUIDs. Missi
-00011fc0: 6e67 2066 6f72 2066 6f6c 6c6f 7769 6e67  ng for following
-00011fd0: 2066 696c 6573 3a5c 6e22 2b22 5cc5 8622   files:\n"+"\.."
-00011fe0: 2e6a 6f69 6e28 6469 6666 6572 656e 745f  .join(different_
-00011ff0: 7061 7468 7329 0a20 2020 2020 2020 2020  paths).         
-00012000: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00012010: 7365 6c66 2e5f 5f61 6c6c 5555 4944 7343  self.__allUUIDsC
-00012020: 6865 636b 6564 203d 2054 7275 650a 2020  hecked = True.  
-00012030: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00012040: 2054 7275 652c 2022 416c 6c20 696d 6167   True, "All imag
-00012050: 6573 2068 6176 6520 6120 5555 4944 220a  es have a UUID".
-00012060: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00012070: 616c 7365 2c20 2250 6174 6820 222b 7365  alse, "Path "+se
-00012080: 6c66 2e69 6d61 6765 7344 6972 202b 2022  lf.imagesDir + "
-00012090: 206e 6f74 2066 6f75 6e64 2e22 0a0a 2020   not found."..  
-000120a0: 2020 6465 6620 6372 6561 7465 5555 4944    def createUUID
-000120b0: 4669 6c65 2873 656c 662c 636c 6561 6e3d  File(self,clean=
-000120c0: 5472 7565 293a 0a20 2020 2020 2020 2022  True):.        "
-000120d0: 2222 2044 6570 7265 6361 7465 6420 2d20  "" Deprecated - 
-000120e0: 7573 6520 6372 6561 7465 5f75 7569 645f  use create_uuid_
-000120f0: 6669 6c65 2022 2222 0a20 2020 2020 2020  file """.       
-00012100: 2072 6574 7572 6e20 7365 6c66 2e63 7265   return self.cre
-00012110: 6174 655f 7575 6964 5f66 696c 6528 636c  ate_uuid_file(cl
-00012120: 6561 6e29 0a0a 0a20 2020 2064 6566 2073  ean)...    def s
-00012130: 6574 5f69 6d61 6765 5f73 6574 5f61 7474  et_image_set_att
-00012140: 6974 7564 6528 7365 6c66 2c79 6177 5f66  itude(self,yaw_f
-00012150: 7261 6d65 3a66 6c6f 6174 2c70 6974 6368  rame:float,pitch
-00012160: 5f66 7261 6d65 3a66 6c6f 6174 2c72 6f6c  _frame:float,rol
-00012170: 6c5f 6672 616d 653a 666c 6f61 742c 7961  l_frame:float,ya
-00012180: 775f 6361 6d32 6672 616d 653a 666c 6f61  w_cam2frame:floa
-00012190: 742c 7069 7463 685f 6361 6d32 6672 616d  t,pitch_cam2fram
-000121a0: 653a 666c 6f61 742c 726f 6c6c 5f63 616d  e:float,roll_cam
-000121b0: 3266 7261 6d65 3a66 6c6f 6174 293a 0a20  2frame:float):. 
-000121c0: 2020 2020 2020 2022 2222 2063 616c 6375         """ calcu
-000121d0: 6c61 7465 7320 7468 6520 7468 6520 6361  lates the the ca
-000121e0: 6d65 7261 7320 6162 736f 6c75 7465 2061  meras absolute a
-000121f0: 7474 6974 7564 6520 616e 6420 7365 7473  ttitude and sets
-00012200: 2069 7420 746f 2069 6d61 6765 2073 6574   it to image set
-00012210: 2068 6561 6465 722e 2041 6c6c 2061 6e67   header. All ang
-00012220: 6c65 7320 6172 6520 6578 7065 6374 6564  les are expected
-00012230: 2069 6e20 6465 6772 6565 732e 200a 2020   in degrees. .  
-00012240: 2020 2020 2020 6361 6d65 7261 3266 7261        camera2fra
-00012250: 6d65 2061 6e67 6c65 733a 2072 6f74 6174  me angles: rotat
-00012260: 696f 6e20 6f66 2063 616d 6572 6120 636f  ion of camera co
-00012270: 6f72 6469 6e61 7465 7320 2878 2c79 2c7a  ordinates (x,y,z
-00012280: 203d 2074 6f70 2c20 7269 6768 742c 206c   = top, right, l
-00012290: 696e 6520 6f66 2073 6967 6874 2920 7769  ine of sight) wi
-000122a0: 7468 2072 6573 7065 6374 2074 6f20 7665  th respect to ve
-000122b0: 6869 636c 6520 636f 6f72 6469 6e61 7465  hicle coordinate
-000122c0: 7320 2878 2c79 2c7a 203d 2066 6f72 7761  s (x,y,z = forwa
-000122d0: 7264 2c72 6967 6874 2c64 6f77 6e29 200a  rd,right,down) .
-000122e0: 2020 2020 2020 2020 696e 2061 6363 6f72          in accor
-000122f0: 6461 6e63 6520 7769 7468 2074 6865 2079  dance with the y
-00012300: 6177 2c70 6974 6368 2c72 6f6c 6c20 726f  aw,pitch,roll ro
-00012310: 7461 7469 6f6e 206f 7264 6572 2063 6f6e  tation order con
-00012320: 7665 6e74 696f 6e3a 0a0a 2020 2020 2020  vention:..      
-00012330: 2020 312e 2079 6177 2061 726f 756e 6420    1. yaw around 
-00012340: 7a2c 0a20 2020 2020 2020 2032 2e20 7069  z,.        2. pi
-00012350: 7463 6820 6172 6f75 6e64 2072 6f74 6174  tch around rotat
-00012360: 6564 2079 2c0a 2020 2020 2020 2020 332e  ed y,.        3.
-00012370: 2072 6f6c 6c20 6172 6f75 6e64 2072 6f74   roll around rot
-00012380: 6174 6564 2078 0a0a 2020 2020 2020 2020  ated x..        
-00012390: 526f 7461 7469 6f6e 2064 6972 6563 7469  Rotation directi
-000123a0: 6f6e 7320 6163 636f 7264 696e 6720 746f  ons according to
-000123b0: 205c 2772 6967 6874 2d68 616e 6420 7275   \'right-hand ru
-000123c0: 6c65 5c27 2e0a 0a20 2020 2020 2020 2049  le\'...        I
-000123d0: 2e65 2e20 6361 6d65 7261 3246 7261 6d65  .e. camera2Frame
-000123e0: 2061 6e67 6c65 7320 3d20 302c 302c 3020   angles = 0,0,0 
-000123f0: 6361 6d65 7261 2069 7320 6661 6369 6e67  camera is facing
-00012400: 2064 6f77 6e77 6172 6420 7769 7468 2074   downward with t
-00012410: 6f70 2073 6964 6520 746f 7761 7264 7320  op side towards 
-00012420: 7665 6869 636c 6527 7320 666f 7277 6172  vehicle's forwar
-00012430: 6420 6469 7265 6374 696f 6e27 2022 2222  d direction' """
-00012440: 0a0a 2020 2020 2020 2020 525f 6672 616d  ..        R_fram
-00012450: 6532 6e65 6420 3d20 6d69 7174 672e 525f  e2ned = miqtg.R_
-00012460: 5961 7750 6974 6368 526f 6c6c 2879 6177  YawPitchRoll(yaw
-00012470: 5f66 7261 6d65 2c70 6974 6368 5f66 7261  _frame,pitch_fra
-00012480: 6d65 2c72 6f6c 6c5f 6672 616d 6529 0a20  me,roll_frame). 
-00012490: 2020 2020 2020 2052 5f63 616d 3266 7261         R_cam2fra
-000124a0: 6d65 203d 206d 6971 7467 2e52 5f59 6177  me = miqtg.R_Yaw
-000124b0: 5069 7463 6852 6f6c 6c28 7961 775f 6361  PitchRoll(yaw_ca
-000124c0: 6d32 6672 616d 652c 7069 7463 685f 6361  m2frame,pitch_ca
-000124d0: 6d32 6672 616d 652c 726f 6c6c 5f63 616d  m2frame,roll_cam
-000124e0: 3266 7261 6d65 290a 2020 2020 2020 2020  2frame).        
-000124f0: 525f 6361 6d32 6e65 6420 3d20 525f 6672  R_cam2ned = R_fr
-00012500: 616d 6532 6e65 642e 646f 7428 525f 6361  ame2ned.dot(R_ca
-00012510: 6d32 6672 616d 6529 0a20 2020 2020 2020  m2frame).       
-00012520: 2079 6177 2c70 6974 6368 2c72 6f6c 6c20   yaw,pitch,roll 
-00012530: 3d20 6d69 7174 672e 7961 7750 6974 6368  = miqtg.yawPitch
-00012540: 526f 6c6c 2852 5f63 616d 326e 6564 290a  Roll(R_cam2ned).
-00012550: 0a20 2020 2020 2020 2023 2070 6f73 6520  .        # pose 
-00012560: 6d61 7472 6978 2063 616d 3275 746d 0a20  matrix cam2utm. 
-00012570: 2020 2020 2020 2052 5f63 616d 5374 6432         R_camStd2
-00012580: 7574 6d20 3d20 7365 6c66 2e67 6574 5f52  utm = self.get_R
-00012590: 5f63 616d 5374 6432 7574 6d28 525f 6361  _camStd2utm(R_ca
-000125a0: 6d32 6672 616d 652c 525f 6672 616d 6532  m2frame,R_frame2
-000125b0: 6e65 6429 0a0a 2020 2020 2020 2020 2222  ned)..        ""
-000125c0: 220a 2020 2020 2020 2020 7820 3d20 6e70  ".        x = np
-000125d0: 2e61 7272 6179 285b 312c 302c 305d 290a  .array([1,0,0]).
-000125e0: 2020 2020 2020 2020 7920 3d20 6e70 2e61          y = np.a
-000125f0: 7272 6179 285b 302c 312c 305d 290a 2020  rray([0,1,0]).  
-00012600: 2020 2020 2020 7a20 3d20 6e70 2e61 7272        z = np.arr
-00012610: 6179 285b 302c 302c 315d 290a 2020 2020  ay([0,0,1]).    
-00012620: 2020 2020 7072 696e 7428 2778 272c 525f      print('x',R_
-00012630: 6361 6d53 7464 3275 746d 2e64 6f74 2878  camStd2utm.dot(x
-00012640: 292e 726f 756e 6428 3529 290a 2020 2020  ).round(5)).    
-00012650: 2020 2020 7072 696e 7428 2779 272c 525f      print('y',R_
-00012660: 6361 6d53 7464 3275 746d 2e64 6f74 2879  camStd2utm.dot(y
-00012670: 292e 726f 756e 6428 3529 290a 2020 2020  ).round(5)).    
-00012680: 2020 2020 7072 696e 7428 277a 272c 525f      print('z',R_
-00012690: 6361 6d53 7464 3275 746d 2e64 6f74 287a  camStd2utm.dot(z
-000126a0: 292e 726f 756e 6428 3529 290a 2020 2020  ).round(5)).    
-000126b0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-000126c0: 2068 6561 6465 7255 7064 6174 6520 3d20   headerUpdate = 
-000126d0: 7b0a 2020 2020 2020 2020 2020 2020 6d69  {.            mi
-000126e0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-000126f0: 6d61 7269 7174 275d 5b27 7961 7727 5d3a  mariqt']['yaw']:
-00012700: 7961 772c 0a20 2020 2020 2020 2020 2020  yaw,.           
-00012710: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-00012720: 725b 276d 6172 6971 7427 5d5b 2770 6974  r['mariqt']['pit
-00012730: 6368 275d 3a70 6974 6368 2c0a 2020 2020  ch']:pitch,.    
-00012740: 2020 2020 2020 2020 6d69 7174 762e 636f          miqtv.co
-00012750: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00012760: 275d 5b27 726f 6c6c 275d 3a72 6f6c 6c2c  ']['roll']:roll,
-00012770: 0a20 2020 2020 2020 2020 2020 206d 6971  .            miq
-00012780: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00012790: 6172 6971 7427 5d5b 2770 6f73 6527 5d3a  ariqt']['pose']:
-000127a0: 7b27 706f 7365 2d61 6273 6f6c 7574 652d  {'pose-absolute-
-000127b0: 6f72 6965 6e74 6174 696f 6e2d 7574 6d2d  orientation-utm-
-000127c0: 6d61 7472 6978 273a 525f 6361 6d53 7464  matrix':R_camStd
-000127d0: 3275 746d 2e66 6c61 7474 656e 2829 2e74  2utm.flatten().t
-000127e0: 6f6c 6973 7428 297d 0a20 2020 2020 2020  olist()}.       
-000127f0: 207d 0a20 2020 2020 2020 2073 656c 662e   }.        self.
-00012800: 7570 6461 7465 5f69 6664 6f5f 6865 6164  update_ifdo_head
-00012810: 6572 5f66 6965 6c64 7328 6865 6164 6572  er_fields(header
-00012820: 5570 6461 7465 290a 0a20 2020 2064 6566  Update)..    def
-00012830: 2073 6574 496d 6167 6553 6574 4174 7469   setImageSetAtti
-00012840: 7475 6465 2873 656c 662c 7961 775f 6672  tude(self,yaw_fr
-00012850: 616d 653a 666c 6f61 742c 7069 7463 685f  ame:float,pitch_
-00012860: 6672 616d 653a 666c 6f61 742c 726f 6c6c  frame:float,roll
-00012870: 5f66 7261 6d65 3a66 6c6f 6174 2c79 6177  _frame:float,yaw
-00012880: 5f63 616d 3266 7261 6d65 3a66 6c6f 6174  _cam2frame:float
-00012890: 2c70 6974 6368 5f63 616d 3266 7261 6d65  ,pitch_cam2frame
-000128a0: 3a66 6c6f 6174 2c72 6f6c 6c5f 6361 6d32  :float,roll_cam2
-000128b0: 6672 616d 653a 666c 6f61 7429 3a0a 2020  frame:float):.  
-000128c0: 2020 2020 2020 2222 2220 4465 7072 6563        """ Deprec
-000128d0: 6174 6564 202d 2075 7365 2073 6574 5f69  ated - use set_i
-000128e0: 6d61 6765 5f73 6574 5f61 7474 6974 7564  mage_set_attitud
-000128f0: 6520 2222 220a 2020 2020 2020 2020 7365  e """.        se
-00012900: 6c66 2e73 6574 5f69 6d61 6765 5f73 6574  lf.set_image_set
-00012910: 5f61 7474 6974 7564 6528 7961 775f 6672  _attitude(yaw_fr
-00012920: 616d 652c 2070 6974 6368 5f66 7261 6d65  ame, pitch_frame
-00012930: 2c20 726f 6c6c 5f66 7261 6d65 2c20 7961  , roll_frame, ya
-00012940: 775f 6361 6d32 6672 616d 652c 2070 6974  w_cam2frame, pit
-00012950: 6368 5f63 616d 3266 7261 6d65 2c20 726f  ch_cam2frame, ro
-00012960: 6c6c 5f63 616d 3266 7261 6d65 290a 0a0a  ll_cam2frame)...
-00012970: 2020 2020 6465 6620 6372 6561 7465 5f69      def create_i
-00012980: 6d61 6765 5f61 7474 6974 7564 655f 6669  mage_attitude_fi
-00012990: 6c65 2873 656c 662c 2061 7474 5f70 6174  le(self, att_pat
-000129a0: 683a 7374 722c 2066 7261 6d65 5f61 7474  h:str, frame_att
-000129b0: 5f68 6561 6465 723a 6469 6374 2c20 6361  _header:dict, ca
-000129c0: 6d65 7261 3246 7261 6d65 5f79 6177 3a66  mera2Frame_yaw:f
-000129d0: 6c6f 6174 2c63 616d 6572 6132 4672 616d  loat,camera2Fram
-000129e0: 655f 7069 7463 683a 666c 6f61 742c 6361  e_pitch:float,ca
-000129f0: 6d65 7261 3246 7261 6d65 5f72 6f6c 6c3a  mera2Frame_roll:
-00012a00: 666c 6f61 742c 0a20 2020 2020 2020 2020  float,.         
-00012a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a20: 2020 2020 2020 2064 6174 655f 666f 726d         date_form
-00012a30: 6174 3d6d 6971 7476 2e64 6174 655f 666f  at=miqtv.date_fo
-00012a40: 726d 6174 735b 2770 616e 6761 6561 275d  rmats['pangaea']
-00012a50: 2c20 636f 6e73 745f 7661 6c75 6573 203d  , const_values =
-00012a60: 207b 7d2c 206f 7665 7277 7269 7465 3d46   {}, overwrite=F
-00012a70: 616c 7365 2c20 636f 6c5f 7365 7061 7261  alse, col_separa
-00012a80: 746f 7220 3d20 225c 7422 2c0a 2020 2020  tor = "\t",.    
-00012a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012aa0: 2020 2020 2020 2020 2020 2020 6174 745f              att_
-00012ab0: 7061 7468 5f61 6e67 6c65 735f 696e 5f72  path_angles_in_r
-00012ac0: 6164 203d 2046 616c 7365 2c20 7669 6465  ad = False, vide
-00012ad0: 6f53 616d 706c 6553 6563 6f6e 6473 3d31  oSampleSeconds=1
-00012ae0: 2c72 6563 6f72 6473 3262 6549 6e76 6572  ,records2beInver
-00012af0: 7465 643d 5b5d 293a 0a20 2020 2020 2020  ted=[]):.       
-00012b00: 2022 2222 2043 7265 6174 6573 2069 6e20   """ Creates in 
-00012b10: 2f69 6e74 6572 6d65 6469 6174 6520 6120  /intermediate a 
-00012b20: 7465 7874 2066 696c 6520 7769 7468 2063  text file with c
-00012b30: 616d 6572 6120 6174 7469 7475 6465 2064  amera attitude d
-00012b40: 6174 6120 666f 7220 6561 6368 2069 6d61  ata for each ima
-00012b50: 6765 2e20 416c 6c20 616e 676c 6573 2061  ge. All angles a
-00012b60: 7265 2065 7870 6563 7465 6420 696e 2064  re expected in d
-00012b70: 6567 7265 6573 2e20 5573 6520 6174 745f  egrees. Use att_
-00012b80: 7061 7468 5f61 6e67 6c65 735f 696e 5f72  path_angles_in_r
-00012b90: 6164 2069 6620 6e65 6365 7373 6172 792e  ad if necessary.
-00012ba0: 200a 2020 2020 2020 2020 6361 6d65 7261   .        camera
-00012bb0: 3246 7261 6d65 2061 6e67 6c65 733a 2072  2Frame angles: r
-00012bc0: 6f74 6174 696f 6e20 6f66 2063 616d 6572  otation of camer
-00012bd0: 6120 636f 6f72 6469 6e61 7465 7320 2878  a coordinates (x
-00012be0: 2c79 2c7a 203d 2074 6f70 2c20 7269 6768  ,y,z = top, righ
-00012bf0: 742c 206c 696e 6520 6f66 2073 6967 6874  t, line of sight
-00012c00: 2920 7769 7468 2072 6573 7065 6374 2074  ) with respect t
-00012c10: 6f20 7665 6869 636c 6520 636f 6f72 6469  o vehicle coordi
-00012c20: 6e61 7465 7320 2878 2c79 2c7a 203d 2066  nates (x,y,z = f
-00012c30: 6f72 7761 7264 2c72 6967 6874 2c64 6f77  orward,right,dow
-00012c40: 6e29 200a 2020 2020 2020 2020 696e 2061  n) .        in a
-00012c50: 6363 6f72 6461 6e63 6520 7769 7468 2074  ccordance with t
-00012c60: 6865 2079 6177 2c70 6974 6368 2c72 6f6c  he yaw,pitch,rol
-00012c70: 6c20 726f 7461 7469 6f6e 206f 7264 6572  l rotation order
-00012c80: 2063 6f6e 7665 6e74 696f 6e3a 0a20 2020   convention:.   
-00012c90: 2020 2020 2031 2e20 7961 7720 6172 6f75       1. yaw arou
-00012ca0: 6e64 207a 2c0a 2020 2020 2020 2020 322e  nd z,.        2.
-00012cb0: 2070 6974 6368 2061 726f 756e 6420 726f   pitch around ro
-00012cc0: 7461 7465 6420 792c 0a20 2020 2020 2020  tated y,.       
-00012cd0: 2033 2e20 726f 6c6c 2061 726f 756e 6420   3. roll around 
-00012ce0: 726f 7461 7465 6420 780a 0a20 2020 2020  rotated x..     
-00012cf0: 2020 2052 6f74 6174 696f 6e20 6469 7265     Rotation dire
-00012d00: 6374 696f 6e73 2061 6363 6f72 6469 6e67  ctions according
-00012d10: 2074 6f20 5c27 7269 6768 742d 6861 6e64   to \'right-hand
-00012d20: 2072 756c 655c 272e 0a0a 2020 2020 2020   rule\'...      
-00012d30: 2020 492e 652e 2063 616d 6572 6132 4672    I.e. camera2Fr
-00012d40: 616d 6520 616e 676c 6573 203d 2030 2c30  ame angles = 0,0
-00012d50: 2c30 2063 616d 6572 6120 6973 2066 6163  ,0 camera is fac
-00012d60: 696e 6720 646f 776e 7761 7264 2077 6974  ing downward wit
-00012d70: 6820 746f 7020 7369 6465 2074 6f77 6172  h top side towar
-00012d80: 6473 2076 6568 6963 6c65 2773 2066 6f72  ds vehicle's for
-00012d90: 7761 7264 2064 6972 6563 7469 6f6e 2720  ward direction' 
-00012da0: 2222 220a 0a20 2020 2020 2020 2069 6e74  """..        int
-00012db0: 5f61 7474 7574 7564 655f 6669 6c65 203d  _attutude_file =
-00012dc0: 2073 656c 662e 5f5f 6765 745f 696e 745f   self.__get_int_
-00012dd0: 6669 6c65 5f70 7265 6669 7828 2920 2b20  file_prefix() + 
-00012de0: 275f 696d 6167 652d 6174 7469 7475 6465  '_image-attitude
-00012df0: 2e74 7874 270a 2020 2020 2020 2020 6f75  .txt'.        ou
-00012e00: 7470 7574 5f68 6561 6465 725f 6174 7420  tput_header_att 
-00012e10: 3d20 7b20 2020 6d69 7174 762e 636f 6c5f  = {   miqtv.col_
-00012e20: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00012e30: 5b27 696d 6727 5d3a 2020 6d69 7174 762e  ['img']:  miqtv.
-00012e40: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00012e50: 7174 275d 5b27 696d 6727 5d2c 0a20 2020  qt']['img'],.   
-00012e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e70: 2020 2020 2020 2020 2020 2020 206d 6971               miq
-00012e80: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00012e90: 6172 6971 7427 5d5b 2775 7463 275d 3a6d  ariqt']['utc']:m
-00012ea0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00012eb0: 276d 6172 6971 7427 5d5b 2775 7463 275d  'mariqt']['utc']
-00012ec0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00012ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ee0: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
-00012ef0: 6572 5b27 6d61 7269 7174 275d 5b27 7961  er['mariqt']['ya
-00012f00: 7727 5d3a 6d69 7174 762e 636f 6c5f 6865  w']:miqtv.col_he
-00012f10: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00012f20: 7961 7727 5d2c 0a20 2020 2020 2020 2020  yaw'],.         
-00012f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f40: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
-00012f50: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00012f60: 5d5b 2770 6974 6368 275d 3a6d 6971 7476  ]['pitch']:miqtv
-00012f70: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00012f80: 6971 7427 5d5b 2770 6974 6368 275d 2c0a  iqt']['pitch'],.
-00012f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fb0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00012fc0: 5b27 6d61 7269 7174 275d 5b27 726f 6c6c  ['mariqt']['roll
-00012fd0: 275d 3a6d 6971 7476 2e63 6f6c 5f68 6561  ']:miqtv.col_hea
-00012fe0: 6465 725b 276d 6172 6971 7427 5d5b 2772  der['mariqt']['r
-00012ff0: 6f6c 6c27 5d2c 0a20 2020 2020 2020 2020  oll'],.         
-00013000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013010: 2020 207d 0a0a 2020 2020 2020 2020 696e     }..        in
-00013020: 745f 706f 7365 5f66 696c 6520 3d20 7365  t_pose_file = se
-00013030: 6c66 2e5f 5f67 6574 5f69 6e74 5f66 696c  lf.__get_int_fil
-00013040: 655f 7072 6566 6978 2829 202b 2027 5f69  e_prefix() + '_i
-00013050: 6d61 6765 2d63 616d 6572 612d 706f 7365  mage-camera-pose
-00013060: 2e74 7874 270a 2020 2020 2020 2020 6f75  .txt'.        ou
-00013070: 7470 7574 5f68 6561 6465 725f 706f 7365  tput_header_pose
-00013080: 203d 207b 2020 6d69 7174 762e 636f 6c5f   = {  miqtv.col_
-00013090: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-000130a0: 5b27 696d 6727 5d3a 6d69 7174 762e 636f  ['img']:miqtv.co
-000130b0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-000130c0: 275d 5b27 696d 6727 5d2c 0a20 2020 2020  ']['img'],.     
-000130d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000130e0: 2020 2020 2020 2020 2020 206d 6971 7476             miqtv
-000130f0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00013100: 6971 7427 5d5b 2775 7463 275d 3a6d 6971  iqt']['utc']:miq
-00013110: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00013120: 6172 6971 7427 5d5b 2775 7463 275d 2c0a  ariqt']['utc'],.
-00013130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013150: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00013160: 5b27 6d61 7269 7174 275d 5b27 706f 7365  ['mariqt']['pose
-00013170: 275d 3a6d 6971 7476 2e63 6f6c 5f68 6561  ']:miqtv.col_hea
-00013180: 6465 725b 276d 6172 6971 7427 5d5b 2770  der['mariqt']['p
-00013190: 6f73 6527 5d2c 0a20 2020 2020 2020 2020  ose'],.         
-000131a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131b0: 2020 207d 0a0a 2020 2020 2020 2020 6966     }..        if
-000131c0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-000131d0: 696e 745f 6174 7475 7475 6465 5f66 696c  int_attutude_fil
-000131e0: 6529 2061 6e64 206e 6f74 206f 7665 7277  e) and not overw
-000131f0: 7269 7465 3a0a 2020 2020 2020 2020 2020  rite:.          
-00013200: 2020 7365 6c66 2e61 6464 5f69 7465 6d5f    self.add_item_
-00013210: 696e 666f 5f74 6162 5f66 696c 6528 696e  info_tab_file(in
-00013220: 745f 6174 7475 7475 6465 5f66 696c 652c  t_attutude_file,
-00013230: 225c 7422 2c6f 7574 7075 745f 6865 6164  "\t",output_head
-00013240: 6572 5f61 7474 290a 2020 2020 2020 2020  er_att).        
-00013250: 2020 2020 6578 7472 615f 6d73 6720 3d20      extra_msg = 
-00013260: 2222 0a20 2020 2020 2020 2020 2020 2069  "".            i
-00013270: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
-00013280: 2869 6e74 5f70 6f73 655f 6669 6c65 293a  (int_pose_file):
-00013290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000132a0: 2073 656c 662e 6164 645f 6974 656d 5f69   self.add_item_i
-000132b0: 6e66 6f5f 7461 625f 6669 6c65 2869 6e74  nfo_tab_file(int
-000132c0: 5f70 6f73 655f 6669 6c65 2c22 5c74 222c  _pose_file,"\t",
-000132d0: 6f75 7470 7574 5f68 6561 6465 725f 706f  output_header_po
-000132e0: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-000132f0: 2020 2020 6578 7472 615f 6d73 6720 3d20      extra_msg = 
-00013300: 222c 2022 202b 2069 6e74 5f70 6f73 655f  ", " + int_pose_
-00013310: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
-00013320: 2072 6574 7572 6e20 5472 7565 2c20 224f   return True, "O
-00013330: 7574 7075 7420 6669 6c65 2065 7869 7374  utput file exist
-00013340: 733a 2022 2b69 6e74 5f61 7474 7574 7564  s: "+int_attutud
-00013350: 655f 6669 6c65 202b 2065 7874 7261 5f6d  e_file + extra_m
-00013360: 7367 0a0a 2020 2020 2020 2020 6966 206e  sg..        if n
-00013370: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-00013380: 7328 6174 745f 7061 7468 293a 0a20 2020  s(att_path):.   
-00013390: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000133a0: 4661 6c73 652c 2022 4174 7469 7475 6465  False, "Attitude
-000133b0: 2066 696c 6520 6e6f 7420 666f 756e 643a   file not found:
-000133c0: 2022 2b61 7474 5f70 6174 680a 0a20 2020   "+att_path..   
-000133d0: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
-000133e0: 6174 682e 6578 6973 7473 2873 656c 662e  ath.exists(self.
-000133f0: 696d 6167 6573 4469 7229 3a0a 2020 2020  imagesDir):.    
-00013400: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00013410: 616c 7365 2c20 2249 6d61 6765 2066 6f6c  alse, "Image fol
-00013420: 6465 7220 6e6f 7420 666f 756e 643a 2022  der not found: "
-00013430: 2b20 7365 6c66 2e69 6d61 6765 7344 6972  + self.imagesDir
-00013440: 0a0a 2020 2020 2020 2020 7320 3d20 6d69  ..        s = mi
-00013450: 7174 632e 5072 696e 744c 6f61 6469 6e67  qtc.PrintLoading
-00013460: 4d73 6728 2243 7265 6174 696e 6720 6974  Msg("Creating it
-00013470: 656d 7327 2061 7474 6974 7564 6520 6461  ems' attitude da
-00013480: 7461 2229 0a0a 2020 2020 2020 2020 2320  ta")..        # 
-00013490: 6c6f 6164 2066 7261 6d65 2061 7474 6974  load frame attit
-000134a0: 7564 6520 6461 7461 2066 726f 6d20 6669  ude data from fi
-000134b0: 6c65 0a20 2020 2020 2020 2061 7474 5f64  le.        att_d
-000134c0: 6174 612c 2070 6172 7365 4d73 6720 3d20  ata, parseMsg = 
-000134d0: 6d69 7174 6e2e 7265 6164 416c 6c41 7474  miqtn.readAllAtt
-000134e0: 6974 7564 6573 4672 6f6d 4669 6c65 5061  itudesFromFilePa
-000134f0: 7468 2861 7474 5f70 6174 682c 2066 7261  th(att_path, fra
-00013500: 6d65 5f61 7474 5f68 6561 6465 722c 2064  me_att_header, d
-00013510: 6174 655f 666f 726d 6174 2c63 6f6c 5f73  ate_format,col_s
-00013520: 6570 6172 6174 6f72 3d63 6f6c 5f73 6570  eparator=col_sep
-00013530: 6172 6174 6f72 2c63 6f6e 7374 5f76 616c  arator,const_val
-00013540: 7565 733d 636f 6e73 745f 7661 6c75 6573  ues=const_values
-00013550: 2c61 6e67 6c65 7349 6e52 6164 3d61 7474  ,anglesInRad=att
-00013560: 5f70 6174 685f 616e 676c 6573 5f69 6e5f  _path_angles_in_
-00013570: 7261 6429 0a20 2020 2020 2020 2069 6620  rad).        if 
-00013580: 7061 7273 654d 7367 2021 3d20 2222 3a0a  parseMsg != "":.
-00013590: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000135a0: 2e70 726f 762e 6c6f 6728 7061 7273 654d  .prov.log(parseM
-000135b0: 7367 2c64 6f6e 7453 686f 773d 5472 7565  sg,dontShow=True
-000135c0: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
-000135d0: 7273 654d 7367 203d 2022 5c6e 2220 2b20  rseMsg = "\n" + 
-000135e0: 7061 7273 654d 7367 0a0a 2020 2020 2020  parseMsg..      
-000135f0: 2020 2320 6669 6e64 2066 6f72 2065 6163    # find for eac
-00013600: 6820 696d 6167 6520 7468 6520 7265 7370  h image the resp
-00013610: 6563 7469 7665 206e 6176 6967 6174 696f  ective navigatio
-00013620: 6e20 6461 7461 0a20 2020 2020 2020 2073  n data.        s
-00013630: 2e73 746f 7028 290a 2020 2020 2020 2020  .stop().        
-00013640: 7375 6363 6573 732c 2069 6d61 6765 5f64  success, image_d
-00013650: 7473 2c20 6d73 6720 3d20 7365 6c66 2e66  ts, msg = self.f
-00013660: 696e 644e 6176 4461 7461 466f 7249 6d61  indNavDataForIma
-00013670: 6765 2861 7474 5f64 6174 612c 7669 6465  ge(att_data,vide
-00013680: 6f53 616d 706c 6553 6563 6f6e 6473 290a  oSampleSeconds).
-00013690: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-000136a0: 7563 6365 7373 3a0a 2020 2020 2020 2020  uccess:.        
-000136b0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-000136c0: 2c20 6d73 6720 2b20 7061 7273 654d 7367  , msg + parseMsg
-000136d0: 0a20 2020 2020 2020 2073 203d 206d 6971  .        s = miq
-000136e0: 7463 2e50 7269 6e74 4c6f 6164 696e 674d  tc.PrintLoadingM
-000136f0: 7367 2822 4372 6561 7469 6e67 2069 7465  sg("Creating ite
-00013700: 6d73 2720 6174 7469 7475 6465 2064 6174  ms' attitude dat
-00013710: 6122 290a 0a20 2020 2020 2020 2023 2061  a")..        # a
-00013720: 6464 2063 616d 6572 6132 4672 616d 6520  dd camera2Frame 
-00013730: 616e 676c 6573 0a20 2020 2020 2020 2052  angles.        R
-00013740: 5f63 616d 3266 7261 6d65 203d 206d 6971  _cam2frame = miq
-00013750: 7467 2e52 5f59 6177 5069 7463 6852 6f6c  tg.R_YawPitchRol
-00013760: 6c28 6361 6d65 7261 3246 7261 6d65 5f79  l(camera2Frame_y
-00013770: 6177 2c63 616d 6572 6132 4672 616d 655f  aw,camera2Frame_
-00013780: 7069 7463 682c 6361 6d65 7261 3246 7261  pitch,camera2Fra
-00013790: 6d65 5f72 6f6c 6c29 0a20 2020 2020 2020  me_roll).       
-000137a0: 2052 5f63 616d 3275 746d 5f6c 6973 7420   R_cam2utm_list 
-000137b0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-000137c0: 2066 696c 6520 696e 2069 6d61 6765 5f64   file in image_d
-000137d0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-000137e0: 666f 7220 7469 6d65 706f 696e 7420 696e  for timepoint in
-000137f0: 2069 6d61 6765 5f64 7473 5b66 696c 655d   image_dts[file]
-00013800: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013810: 2020 6174 7469 7475 6465 203d 2074 696d    attitude = tim
-00013820: 6570 6f69 6e74 0a20 2020 2020 2020 2020  epoint.         
-00013830: 2020 2020 2020 2069 6620 6174 7469 7475         if attitu
-00013840: 6465 2e79 6177 2069 7320 4e6f 6e65 206f  de.yaw is None o
-00013850: 7220 6174 7469 7475 6465 2e70 6974 6368  r attitude.pitch
-00013860: 2069 7320 4e6f 6e65 206f 7220 6174 7469   is None or atti
-00013870: 7475 6465 2e72 6f6c 6c20 6973 204e 6f6e  tude.roll is Non
-00013880: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00013890: 2020 2020 2020 2052 5f63 616d 3275 746d         R_cam2utm
-000138a0: 5f6c 6973 742e 6170 7065 6e64 2822 2229  _list.append("")
-000138b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000138c0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-000138d0: 2020 2020 2020 2020 2020 2020 2020 525f                R_
-000138e0: 6672 616d 6532 6e65 6420 3d20 6d69 7174  frame2ned = miqt
-000138f0: 672e 525f 5961 7750 6974 6368 526f 6c6c  g.R_YawPitchRoll
-00013900: 2861 7474 6974 7564 652e 7961 772c 6174  (attitude.yaw,at
-00013910: 7469 7475 6465 2e70 6974 6368 2c61 7474  titude.pitch,att
-00013920: 6974 7564 652e 726f 6c6c 290a 2020 2020  itude.roll).    
-00013930: 2020 2020 2020 2020 2020 2020 525f 6361              R_ca
-00013940: 6d32 6e65 6420 3d20 525f 6672 616d 6532  m2ned = R_frame2
-00013950: 6e65 642e 646f 7428 525f 6361 6d32 6672  ned.dot(R_cam2fr
-00013960: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00013970: 2020 2020 2079 6177 2c70 6974 6368 2c72       yaw,pitch,r
-00013980: 6f6c 6c20 3d20 6d69 7174 672e 7961 7750  oll = miqtg.yawP
-00013990: 6974 6368 526f 6c6c 2852 5f63 616d 326e  itchRoll(R_cam2n
-000139a0: 6564 290a 2020 2020 2020 2020 2020 2020  ed).            
-000139b0: 2020 2020 6174 7469 7475 6465 2e79 6177      attitude.yaw
-000139c0: 203d 2079 6177 0a20 2020 2020 2020 2020   = yaw.         
-000139d0: 2020 2020 2020 2061 7474 6974 7564 652e         attitude.
-000139e0: 7069 7463 6820 3d20 7069 7463 680a 2020  pitch = pitch.  
-000139f0: 2020 2020 2020 2020 2020 2020 2020 6174                at
-00013a00: 7469 7475 6465 2e72 6f6c 6c20 3d20 726f  titude.roll = ro
-00013a10: 6c6c 0a0a 2020 2020 2020 2020 2020 2020  ll..            
-00013a20: 2020 2020 525f 6361 6d53 7464 3275 746d      R_camStd2utm
-00013a30: 203d 2073 656c 662e 6765 745f 525f 6361   = self.get_R_ca
-00013a40: 6d53 7464 3275 746d 2852 5f63 616d 3266  mStd2utm(R_cam2f
-00013a50: 7261 6d65 2c52 5f66 7261 6d65 326e 6564  rame,R_frame2ned
-00013a60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00013a70: 2020 525f 6361 6d32 7574 6d5f 6c69 7374    R_cam2utm_list
-00013a80: 2e61 7070 656e 6428 525f 6361 6d53 7464  .append(R_camStd
-00013a90: 3275 746d 2e66 6c61 7474 656e 2829 2e74  2utm.flatten().t
-00013aa0: 6f6c 6973 7428 2929 0a0a 2020 2020 2020  olist())..      
-00013ab0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-00013ac0: 2261 7070 6c69 6564 2066 7261 6d65 2074  "applied frame t
-00013ad0: 6f20 6361 6d65 7261 2072 6f74 6174 696f  o camera rotatio
-00013ae0: 6e20 7961 772c 7069 7463 682c 726f 6c6c  n yaw,pitch,roll
-00013af0: 203d 2022 202b 2073 7472 2863 616d 6572   = " + str(camer
-00013b00: 6132 4672 616d 655f 7961 7729 202b 2022  a2Frame_yaw) + "
-00013b10: 2c22 202b 2073 7472 2863 616d 6572 6132  ," + str(camera2
-00013b20: 4672 616d 655f 7069 7463 6829 202b 2022  Frame_pitch) + "
-00013b30: 2c22 202b 2073 7472 2863 616d 6572 6132  ," + str(camera2
-00013b40: 4672 616d 655f 726f 6c6c 292c 646f 6e74  Frame_roll),dont
-00013b50: 5368 6f77 3d54 7275 6529 0a0a 2020 2020  Show=True)..    
-00013b60: 2020 2020 6966 206c 656e 2869 6d61 6765      if len(image
-00013b70: 5f64 7473 2920 3e20 303a 0a0a 2020 2020  _dts) > 0:..    
-00013b80: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
-00013b90: 746f 206e 6176 6967 6174 696f 6e20 7478  to navigation tx
-00013ba0: 7420 6669 6c65 0a20 2020 2020 2020 2020  t file.         
-00013bb0: 2020 2023 2068 6561 6465 720a 2020 2020     # header.    
-00013bc0: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
-00013bd0: 656e 2869 6e74 5f61 7474 7574 7564 655f  en(int_attutude_
-00013be0: 6669 6c65 2c20 2277 2229 0a20 2020 2020  file, "w").     
-00013bf0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00013c00: 286d 6971 7476 2e63 6f6c 5f68 6561 6465  (miqtv.col_heade
-00013c10: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-00013c20: 275d 2b22 5c74 222b 6d69 7174 762e 636f  ']+"\t"+miqtv.co
-00013c30: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00013c40: 275d 5b27 7574 6327 5d29 0a20 2020 2020  ']['utc']).     
-00013c50: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00013c60: 2822 5c74 222b 6d69 7174 762e 636f 6c5f  ("\t"+miqtv.col_
-00013c70: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00013c80: 5b27 7961 7727 5d29 0a20 2020 2020 2020  ['yaw']).       
-00013c90: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00013ca0: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
-00013cb0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00013cc0: 7069 7463 6827 5d29 0a20 2020 2020 2020  pitch']).       
-00013cd0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00013ce0: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
-00013cf0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00013d00: 726f 6c6c 275d 290a 0a20 2020 2020 2020  roll'])..       
-00013d10: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00013d20: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
-00013d30: 2023 2064 6174 6120 6c69 6e65 730a 2020   # data lines.  
-00013d40: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
-00013d50: 6c65 2069 6e20 696d 6167 655f 6474 733a  le in image_dts:
-00013d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013d70: 2066 6f72 2074 696d 6570 6f69 6e74 2069   for timepoint i
-00013d80: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
-00013d90: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00013da0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00013db0: 2866 696c 652b 225c 7422 2b74 696d 6570  (file+"\t"+timep
-00013dc0: 6f69 6e74 2e64 6174 6554 696d 6528 292e  oint.dateTime().
-00013dd0: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
-00013de0: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
-00013df0: 6971 7427 5d29 2920 0a20 2020 2020 2020  iqt'])) .       
-00013e00: 2020 2020 2020 2020 2020 2020 2076 616c               val
-00013e10: 203d 2074 696d 6570 6f69 6e74 2e79 6177   = timepoint.yaw
-00013e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013e30: 2020 2020 2069 6620 2779 6177 2720 696e       if 'yaw' in
-00013e40: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
-00013e50: 7465 643a 0a20 2020 2020 2020 2020 2020  ted:.           
-00013e60: 2020 2020 2020 2020 2020 2020 2076 616c               val
-00013e70: 202a 3d20 2d31 0a20 2020 2020 2020 2020   *= -1.         
-00013e80: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
-00013e90: 7269 7465 2822 5c74 222b 7374 7228 7661  rite("\t"+str(va
-00013ea0: 6c29 290a 2020 2020 2020 2020 2020 2020  l)).            
-00013eb0: 2020 2020 2020 2020 7661 6c20 3d20 7469          val = ti
-00013ec0: 6d65 706f 696e 742e 7069 7463 680a 2020  mepoint.pitch.  
-00013ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ee0: 2020 6966 2027 7069 7463 6827 2069 6e20    if 'pitch' in 
-00013ef0: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
-00013f00: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
-00013f10: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
-00013f20: 2a3d 202d 310a 2020 2020 2020 2020 2020  *= -1.          
-00013f30: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00013f40: 6974 6528 225c 7422 2b73 7472 2876 616c  ite("\t"+str(val
-00013f50: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00013f60: 2020 2020 2020 2076 616c 203d 2074 696d         val = tim
-00013f70: 6570 6f69 6e74 2e72 6f6c 6c0a 2020 2020  epoint.roll.    
-00013f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f90: 6966 2027 726f 6c6c 2720 696e 2072 6563  if 'roll' in rec
-00013fa0: 6f72 6473 3262 6549 6e76 6572 7465 643a  ords2beInverted:
-00013fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013fc0: 2020 2020 2020 2020 2076 616c 202a 3d20           val *= 
-00013fd0: 2d31 0a20 2020 2020 2020 2020 2020 2020  -1.             
-00013fe0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00013ff0: 2822 5c74 222b 7374 7228 7661 6c29 290a  ("\t"+str(val)).
-00014000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014010: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
-00014020: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-00014030: 7265 732e 636c 6f73 6528 290a 0a20 2020  res.close()..   
-00014040: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00014050: 6f76 2e61 6464 4172 6775 6d65 6e74 2822  ov.addArgument("
-00014060: 696e 7075 7441 7474 6974 7564 6546 696c  inputAttitudeFil
-00014070: 6522 2c61 7474 5f70 6174 682c 6f76 6572  e",att_path,over
-00014080: 7772 6974 653d 5472 7565 290a 2020 2020  write=True).    
-00014090: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-000140a0: 762e 6c6f 6728 2270 6172 7365 6420 6672  v.log("parsed fr
-000140b0: 6f6d 2069 6e70 7574 4174 7469 7475 6465  om inputAttitude
-000140c0: 4669 6c65 3a20 2220 2b20 7374 7228 6672  File: " + str(fr
-000140d0: 616d 655f 6174 745f 6865 6164 6572 292c  ame_att_header),
-000140e0: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
-000140f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00014100: 6164 645f 6974 656d 5f69 6e66 6f5f 7461  add_item_info_ta
-00014110: 625f 6669 6c65 2869 6e74 5f61 7474 7574  b_file(int_attut
-00014120: 7564 655f 6669 6c65 2c22 5c74 222c 6f75  ude_file,"\t",ou
-00014130: 7470 7574 5f68 6561 6465 725f 6174 7429  tput_header_att)
-00014140: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00014150: 5772 6974 6520 746f 2070 6f73 6520 7478  Write to pose tx
-00014160: 7420 6669 6c65 0a20 2020 2020 2020 2020  t file.         
-00014170: 2020 2023 2068 6561 6465 720a 2020 2020     # header.    
-00014180: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
-00014190: 656e 2869 6e74 5f70 6f73 655f 6669 6c65  en(int_pose_file
-000141a0: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
-000141b0: 2020 2072 6573 2e77 7269 7465 286d 6971     res.write(miq
-000141c0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-000141d0: 6172 6971 7427 5d5b 2769 6d67 275d 2b22  ariqt']['img']+"
-000141e0: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
-000141f0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00014200: 7574 6327 5d29 0a20 2020 2020 2020 2020  utc']).         
-00014210: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
-00014220: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
-00014230: 6572 5b27 6d61 7269 7174 275d 5b27 706f  er['mariqt']['po
-00014240: 7365 275d 290a 2020 2020 2020 2020 2020  se']).          
-00014250: 2020 7265 732e 7772 6974 6528 225c 6e22    res.write("\n"
-00014260: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-00014270: 6461 7461 206c 696e 6573 0a20 2020 2020  data lines.     
-00014280: 2020 2020 2020 2069 203d 2030 0a20 2020         i = 0.   
-00014290: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
-000142a0: 6520 696e 2069 6d61 6765 5f64 7473 3a0a  e in image_dts:.
-000142b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142c0: 666f 7220 7469 6d65 706f 696e 7420 696e  for timepoint in
-000142d0: 2069 6d61 6765 5f64 7473 5b66 696c 655d   image_dts[file]
-000142e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000142f0: 2020 2020 2020 6966 2052 5f63 616d 3275        if R_cam2u
-00014300: 746d 5f6c 6973 745b 695d 203d 3d20 2222  tm_list[i] == ""
-00014310: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014320: 2020 2020 2020 2020 2020 6920 2b3d 2031            i += 1
-00014330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014340: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00014350: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00014360: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-00014370: 6669 6c65 2b22 5c74 222b 7469 6d65 706f  file+"\t"+timepo
-00014380: 696e 742e 6461 7465 5469 6d65 2829 2e73  int.dateTime().s
-00014390: 7472 6674 696d 6528 6d69 7174 762e 6461  trftime(miqtv.da
-000143a0: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
-000143b0: 7174 275d 2929 200a 2020 2020 2020 2020  qt'])) .        
-000143c0: 2020 2020 2020 2020 2020 2020 656e 7472              entr
-000143d0: 7920 3d20 7374 7228 7b27 706f 7365 2d61  y = str({'pose-a
-000143e0: 6273 6f6c 7574 652d 6f72 6965 6e74 6174  bsolute-orientat
-000143f0: 696f 6e2d 7574 6d2d 6d61 7472 6978 273a  ion-utm-matrix':
-00014400: 525f 6361 6d32 7574 6d5f 6c69 7374 5b69  R_cam2utm_list[i
-00014410: 5d7d 292e 7265 706c 6163 6528 275c 6e27  ]}).replace('\n'
-00014420: 2c27 2729 0a20 2020 2020 2020 2020 2020  ,'').           
-00014430: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00014440: 7465 2822 5c74 222b 656e 7472 7929 0a20  te("\t"+entry). 
-00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014460: 2020 2069 202b 3d20 310a 2020 2020 2020     i += 1.      
-00014470: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00014480: 732e 7772 6974 6528 225c 6e22 290a 2020  s.write("\n").  
-00014490: 2020 2020 2020 2020 2020 7265 732e 636c            res.cl
-000144a0: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
-000144b0: 2020 7365 6c66 2e61 6464 5f69 7465 6d5f    self.add_item_
-000144c0: 696e 666f 5f74 6162 5f66 696c 6528 696e  info_tab_file(in
-000144d0: 745f 706f 7365 5f66 696c 652c 225c 7422  t_pose_file,"\t"
-000144e0: 2c6f 7574 7075 745f 6865 6164 6572 5f70  ,output_header_p
-000144f0: 6f73 6529 0a20 2020 2020 2020 2020 2020  ose).           
-00014500: 2073 2e73 746f 7028 290a 2020 2020 2020   s.stop().      
-00014510: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-00014520: 652c 2022 4174 7469 7475 6465 2064 6174  e, "Attitude dat
-00014530: 6120 6372 6561 7465 6422 202b 2070 6172  a created" + par
-00014540: 7365 4d73 670a 2020 2020 2020 2020 656c  seMsg.        el
-00014550: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00014560: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
-00014570: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00014580: 652c 2022 4e6f 2069 6d61 6765 2061 7474  e, "No image att
-00014590: 6974 7564 6573 2066 6f75 6e64 2220 2b20  itudes found" + 
-000145a0: 7061 7273 654d 7367 0a20 2020 2020 2020  parseMsg.       
-000145b0: 200a 2020 2020 2020 2020 0a20 2020 2064   .        .    d
-000145c0: 6566 2063 7265 6174 6549 6d61 6765 4174  ef createImageAt
-000145d0: 7469 7475 6465 4669 6c65 2873 656c 662c  titudeFile(self,
-000145e0: 2061 7474 5f70 6174 683a 7374 722c 2066   att_path:str, f
-000145f0: 7261 6d65 5f61 7474 5f68 6561 6465 723a  rame_att_header:
-00014600: 6469 6374 2c20 6361 6d65 7261 3246 7261  dict, camera2Fra
-00014610: 6d65 5f79 6177 3a66 6c6f 6174 2c63 616d  me_yaw:float,cam
-00014620: 6572 6132 4672 616d 655f 7069 7463 683a  era2Frame_pitch:
-00014630: 666c 6f61 742c 6361 6d65 7261 3246 7261  float,camera2Fra
-00014640: 6d65 5f72 6f6c 6c3a 666c 6f61 742c 0a20  me_roll:float,. 
-00014650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014660: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00014670: 6174 655f 666f 726d 6174 3d6d 6971 7476  ate_format=miqtv
-00014680: 2e64 6174 655f 666f 726d 6174 735b 2770  .date_formats['p
-00014690: 616e 6761 6561 275d 2c20 636f 6e73 745f  angaea'], const_
-000146a0: 7661 6c75 6573 203d 207b 7d2c 206f 7665  values = {}, ove
-000146b0: 7277 7269 7465 3d46 616c 7365 2c20 636f  rwrite=False, co
-000146c0: 6c5f 7365 7061 7261 746f 7220 3d20 225c  l_separator = "\
-000146d0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
-000146e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146f0: 2020 2020 6174 745f 7061 7468 5f61 6e67      att_path_ang
-00014700: 6c65 735f 696e 5f72 6164 203d 2046 616c  les_in_rad = Fal
-00014710: 7365 2c20 7669 6465 6f53 616d 706c 6553  se, videoSampleS
-00014720: 6563 6f6e 6473 3d31 2c72 6563 6f72 6473  econds=1,records
-00014730: 3262 6549 6e76 6572 7465 643d 5b5d 293a  2beInverted=[]):
-00014740: 0a20 2020 2020 2020 2022 2222 2044 6570  .        """ Dep
-00014750: 7265 6361 7464 6520 2d20 7573 6520 6372  recatde - use cr
-00014760: 6561 7465 5f69 6d61 6765 5f61 7474 6974  eate_image_attit
-00014770: 7564 655f 6669 6c65 2022 2222 0a20 2020  ude_file """.   
-00014780: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00014790: 2e63 7265 6174 655f 696d 6167 655f 6174  .create_image_at
-000147a0: 7469 7475 6465 5f66 696c 6528 6174 745f  titude_file(att_
-000147b0: 7061 7468 2c20 6672 616d 655f 6174 745f  path, frame_att_
-000147c0: 6865 6164 6572 2c20 6361 6d65 7261 3246  header, camera2F
-000147d0: 7261 6d65 5f79 6177 2c20 6361 6d65 7261  rame_yaw, camera
-000147e0: 3246 7261 6d65 5f70 6974 6368 2c20 6361  2Frame_pitch, ca
-000147f0: 6d65 7261 3246 7261 6d65 5f72 6f6c 6c2c  mera2Frame_roll,
-00014800: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00014810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014830: 2064 6174 655f 666f 726d 6174 2c20 636f   date_format, co
-00014840: 6e73 745f 7661 6c75 6573 2c20 6f76 6572  nst_values, over
-00014850: 7772 6974 652c 2063 6f6c 5f73 6570 6172  write, col_separ
-00014860: 6174 6f72 2c20 6174 745f 7061 7468 5f61  ator, att_path_a
-00014870: 6e67 6c65 735f 696e 5f72 6164 2c20 7669  ngles_in_rad, vi
-00014880: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
-00014890: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000148a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148c0: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
-000148d0: 7465 6429 0a20 2020 2020 2020 200a 0a20  ted).        .. 
-000148e0: 2020 2064 6566 2067 6574 5f52 5f63 616d     def get_R_cam
-000148f0: 5374 6432 7574 6d28 7365 6c66 2c52 5f63  Std2utm(self,R_c
-00014900: 616d 3266 7261 6d65 3a6e 702e 6172 7261  am2frame:np.arra
-00014910: 792c 525f 6672 616d 6532 6e65 643a 6e70  y,R_frame2ned:np
-00014920: 2e61 7272 6179 293a 0a20 2020 2020 2020  .array):.       
-00014930: 2022 2222 2072 6574 7275 6e20 726f 7461   """ retrun rota
-00014940: 7469 6f6e 206d 6174 7269 7820 5220 7472  tion matrix R tr
-00014950: 616e 666f 726d 696e 6720 6672 6f6d 2063  anforming from c
-00014960: 616d 5374 643a 2028 782c 792c 7a20 3d20  amStd: (x,y,z = 
-00014970: 7269 6768 742c 6275 7474 6f6d 2c6c 696e  right,buttom,lin
-00014980: 6520 6f66 2073 6967 6874 2920 746f 2075  e of sight) to u
-00014990: 746d 2028 782c 792c 7a20 3d20 6561 7374  tm (x,y,z = east
-000149a0: 696e 672c 6e6f 7274 6869 6e67 2c75 7029  ing,northing,up)
-000149b0: 2022 2222 0a20 2020 2020 2020 2052 5f63   """.        R_c
-000149c0: 616d 6946 444f 3263 616d 5374 6420 3d20  amiFDO2camStd = 
-000149d0: 6d69 7174 672e 525f 5961 7750 6974 6368  miqtg.R_YawPitch
-000149e0: 526f 6c6c 2839 302c 302c 3029 2023 2069  Roll(90,0,0) # i
-000149f0: 6e20 6946 444f 2063 616d 3a20 2878 2c79  n iFDO cam: (x,y
-00014a00: 2c7a 203d 2074 6f70 2c72 6967 6874 2c6c  ,z = top,right,l
-00014a10: 696e 6520 6f66 2073 6967 6874 2920 6275  ine of sight) bu
-00014a20: 7420 666f 7220 706f 7365 2074 6865 2027  t for pose the '
-00014a30: 7374 616e 6461 7264 2720 6361 6d53 7464  standard' camStd
-00014a40: 3a20 2878 2c79 2c7a 203d 2072 6967 6874  : (x,y,z = right
-00014a50: 2c62 7574 746f 6d2c 6c69 6e65 206f 6620  ,buttom,line of 
-00014a60: 7369 6768 7429 2069 7320 6578 7065 6374  sight) is expect
-00014a70: 6564 0a20 2020 2020 2020 2052 5f63 616d  ed.        R_cam
-00014a80: 5374 6432 6672 616d 6520 3d20 525f 6361  Std2frame = R_ca
-00014a90: 6d32 6672 616d 652e 646f 7428 525f 6361  m2frame.dot(R_ca
-00014aa0: 6d69 4644 4f32 6361 6d53 7464 290a 2020  miFDO2camStd).  
-00014ab0: 2020 2020 2020 525f 6361 6d53 7464 326e        R_camStd2n
-00014ac0: 6564 203d 2052 5f66 7261 6d65 326e 6564  ed = R_frame2ned
-00014ad0: 2e64 6f74 2852 5f63 616d 5374 6432 6672  .dot(R_camStd2fr
-00014ae0: 616d 6529 0a20 2020 2020 2020 2052 5f6e  ame).        R_n
-00014af0: 6564 3275 746d 203d 206d 6971 7467 2e52  ed2utm = miqtg.R
-00014b00: 5f58 595a 2831 3830 2c30 2c39 3029 2023  _XYZ(180,0,90) #
-00014b10: 2077 6974 6820 7574 6d20 782c 792c 7a20   with utm x,y,z 
-00014b20: 3d20 6561 7374 696e 672c 6e6f 7274 6869  = easting,northi
-00014b30: 6e67 2c75 700a 2020 2020 2020 2020 525f  ng,up.        R_
-00014b40: 6361 6d53 7464 3275 746d 203d 2052 5f6e  camStd2utm = R_n
-00014b50: 6564 3275 746d 2e64 6f74 2852 5f63 616d  ed2utm.dot(R_cam
-00014b60: 5374 6432 6e65 6429 2e72 6f75 6e64 2835  Std2ned).round(5
-00014b70: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00014b80: 2052 5f63 616d 5374 6432 7574 6d0a 0a0a   R_camStd2utm...
-00014b90: 2020 2020 6465 6620 6669 6e64 4e61 7644      def findNavD
-00014ba0: 6174 6146 6f72 496d 6167 6528 7365 6c66  ataForImage(self
-00014bb0: 2c64 6174 613a 6d69 7174 672e 4e75 6d44  ,data:miqtg.NumD
-00014bc0: 6174 6154 696d 6553 7461 6d70 6564 2c76  ataTimeStamped,v
-00014bd0: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
-00014be0: 733d 3129 3a0a 2020 2020 2020 2020 2222  s=1):.        ""
-00014bf0: 2220 6372 6561 7465 7320 6120 6469 6374  " creates a dict
-00014c00: 2028 696d 6167 655f 6474 7329 2077 6974   (image_dts) wit
-00014c10: 6820 6669 6c65 206e 616d 6520 6173 206b  h file name as k
-00014c20: 6579 2061 6e64 2061 206c 6973 7420 6f66  ey and a list of
-00014c30: 2064 6174 6120 656c 656d 656e 7473 2061   data elements a
-00014c40: 7320 7661 6c75 652e 200a 2020 2020 2020  s value. .      
-00014c50: 2020 2020 2020 496e 2063 6173 6520 6f66        In case of
-00014c60: 2070 686f 746f 7320 7468 6520 6c69 7374   photos the list
-00014c70: 2068 6173 206f 6e6c 7920 6120 7369 6e67   has only a sing
-00014c80: 6c65 2065 6e74 7279 2c20 666f 7220 7669  le entry, for vi
-00014c90: 6465 6f73 2069 7420 6861 7320 7669 6465  deos it has vide
-00014ca0: 6f20 6475 7261 7469 6f6e 205b 7365 635d  o duration [sec]
-00014cb0: 202f 2076 6964 656f 5361 6d70 6c65 5365   / videoSampleSe
-00014cc0: 636f 6e64 7320 656e 7472 6965 732e 0a20  conds entries.. 
-00014cd0: 2020 2020 2020 2020 2020 2052 6574 7572             Retur
-00014ce0: 6e73 2073 7563 6365 7373 2c20 696d 6167  ns success, imag
-00014cf0: 655f 6474 732c 206d 7367 2022 2222 0a0a  e_dts, msg """..
-00014d00: 2020 2020 2020 2020 6966 2076 6964 656f          if video
-00014d10: 5361 6d70 6c65 5365 636f 6e64 7320 3c3d  SampleSeconds <=
-00014d20: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00014d30: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-00014d40: 2266 696e 644e 6176 4461 7461 466f 7249  "findNavDataForI
-00014d50: 6d61 6765 3a20 7669 6465 6f53 616d 706c  mage: videoSampl
-00014d60: 6553 6563 6f6e 6473 206d 7573 7420 6265  eSeconds must be
-00014d70: 2067 7265 6174 6572 2030 2229 0a0a 2020   greater 0")..  
-00014d80: 2020 2020 2020 2320 6372 6561 7465 2073        # create s
-00014d90: 6f72 7465 6420 7469 6d65 2070 6f69 6e74  orted time point
-00014da0: 730a 2020 2020 2020 2020 7469 6d65 5f70  s.        time_p
-00014db0: 6f69 6e74 7320 3d20 6c69 7374 2864 6174  oints = list(dat
-00014dc0: 612e 6b65 7973 2829 290a 2020 2020 2020  a.keys()).      
-00014dd0: 2020 7469 6d65 5f70 6f69 6e74 732e 736f    time_points.so
-00014de0: 7274 2829 0a20 2020 2020 2020 2075 6e6d  rt().        unm
-00014df0: 6174 6368 6564 5469 6d65 506f 696e 7473  atchedTimePoints
-00014e00: 203d 205b 5d0a 2020 2020 2020 2020 696d   = [].        im
-00014e10: 6167 655f 6474 7320 3d20 7b7d 0a20 2020  age_dts = {}.   
-00014e20: 2020 2020 2073 7461 7274 5365 6172 6368       startSearch
-00014e30: 496e 6465 7820 3d20 300a 2020 2020 2020  Index = 0.      
-00014e40: 2020 696d 6167 6573 496e 5261 7720 3d20    imagesInRaw = 
-00014e50: 2073 656c 662e 696d 6167 6573 496e 496d   self.imagesInIm
-00014e60: 6167 6573 4469 7228 290a 2020 2020 2020  agesDir().      
-00014e70: 2020 696d 6167 6573 496e 5261 7753 6f72    imagesInRawSor
-00014e80: 7465 644c 6973 7420 3d20 7365 6c66 2e69  tedList = self.i
-00014e90: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
-00014ea0: 536f 7274 6564 4c69 7374 2829 0a20 2020  SortedList().   
-00014eb0: 2020 2020 2070 726f 6720 3d20 6d69 7174       prog = miqt
-00014ec0: 632e 5072 696e 744b 6e6f 776e 5072 6f67  c.PrintKnownProg
-00014ed0: 7265 7373 4d73 6728 2249 6e74 6572 706f  ressMsg("Interpo
-00014ee0: 6c61 7469 6e67 206e 6176 6967 6174 696f  lating navigatio
-00014ef0: 6e20 666f 7220 696d 6167 6522 2c20 6c65  n for image", le
-00014f00: 6e28 696d 6167 6573 496e 5261 7729 2c6d  n(imagesInRaw),m
-00014f10: 6f64 756c 6f3d 3129 0a20 2020 2020 2020  odulo=1).       
-00014f20: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
-00014f30: 6765 7349 6e52 6177 536f 7274 6564 4c69  gesInRawSortedLi
-00014f40: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-00014f50: 7072 6f67 2e70 726f 6772 6573 7328 290a  prog.progress().
-00014f60: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00014f70: 5f6e 616d 6520 3d20 6f73 2e70 6174 682e  _name = os.path.
-00014f80: 6261 7365 6e61 6d65 2866 696c 6529 0a0a  basename(file)..
-00014f90: 2020 2020 2020 2020 2020 2020 6474 5f69              dt_i
-00014fa0: 6d61 6765 203d 206d 6971 7463 2e70 6172  mage = miqtc.par
-00014fb0: 7365 4669 6c65 4461 7465 5469 6d65 4173  seFileDateTimeAs
-00014fc0: 5554 4328 6669 6c65 5f6e 616d 6529 0a20  UTC(file_name). 
-00014fd0: 2020 2020 2020 2020 2020 2064 745f 696d             dt_im
-00014fe0: 6167 655f 7473 203d 2069 6e74 2864 745f  age_ts = int(dt_
-00014ff0: 696d 6167 652e 7469 6d65 7374 616d 7028  image.timestamp(
-00015000: 2920 2a20 3130 3030 290a 0a20 2020 2020  ) * 1000)..     
-00015010: 2020 2020 2020 2072 756e 5469 6d65 203d         runTime =
-00015020: 2069 6d61 6765 7349 6e52 6177 5b66 696c   imagesInRaw[fil
-00015030: 655d 5b31 5d20 2320 2d31 2066 6f72 2070  e][1] # -1 for p
-00015040: 686f 746f 730a 2020 2020 2020 2020 2020  hotos.          
-00015050: 2020 2320 7669 6465 6f0a 2020 2020 2020    # video.      
-00015060: 2020 2020 2020 6966 2069 6d61 6765 7349        if imagesI
-00015070: 6e52 6177 5b66 696c 655d 5b32 5d20 696e  nRaw[file][2] in
-00015080: 206d 6971 7476 2e76 6964 656f 5f74 7970   miqtv.video_typ
-00015090: 6573 2061 6e64 2072 756e 5469 6d65 203c  es and runTime <
-000150a0: 3d20 303a 2023 2065 7874 0a20 2020 2020  = 0: # ext.     
-000150b0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000150c0: 2822 4361 7574 696f 6e21 2043 6f75 6c64  ("Caution! Could
-000150d0: 206e 6f74 2072 6561 6420 7669 6465 6f20   not read video 
-000150e0: 7275 6e20 7469 6d65 2066 726f 6d20 6669  run time from fi
-000150f0: 6c65 222c 6669 6c65 2920 2320 544f 444f  le",file) # TODO
-00015100: 2064 6f65 7320 7468 6973 2068 6170 7065   does this happe
-00015110: 6e3f 2048 616e 646c 6520 6265 7474 6572  n? Handle better
-00015120: 3f0a 0a20 2020 2020 2020 2020 2020 2073  ?..            s
-00015130: 616d 706c 6554 696d 6553 6563 7320 3d20  ampleTimeSecs = 
-00015140: 300a 2020 2020 2020 2020 2020 2020 706f  0.            po
-00015150: 735f 6c69 7374 203d 205b 5d0a 2020 2020  s_list = [].    
-00015160: 2020 2020 2020 2020 676f 203d 2054 7275          go = Tru
-00015170: 650a 2020 2020 2020 2020 2020 2020 7768  e.            wh
-00015180: 696c 6520 676f 3a0a 2020 2020 2020 2020  ile go:.        
-00015190: 2020 2020 2020 2020 7472 793a 2020 2020          try:    
-000151a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000151c0: 2020 2020 2070 6f73 2c20 7374 6172 7453       pos, startS
-000151d0: 6561 7263 6849 6e64 6578 203d 2064 6174  earchIndex = dat
-000151e0: 612e 696e 7465 7270 6f6c 6174 6541 7454  a.interpolateAtT
-000151f0: 696d 6528 6474 5f69 6d61 6765 5f74 7320  ime(dt_image_ts 
-00015200: 2b20 7361 6d70 6c65 5469 6d65 5365 6373  + sampleTimeSecs
-00015210: 202a 2031 3030 302c 7469 6d65 5f70 6f69   * 1000,time_poi
-00015220: 6e74 732c 7374 6172 7453 6561 7263 6849  nts,startSearchI
-00015230: 6e64 6578 290a 2020 2020 2020 2020 2020  ndex).          
-00015240: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00015250: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00015260: 2069 6e74 6572 706f 6c61 7465 4174 5469   interpolateAtTi
-00015270: 6d65 2072 6574 7572 6e73 204e 6f6e 6520  me returns None 
-00015280: 7661 6c75 6573 2069 6620 7469 6d65 206f  values if time o
-00015290: 7574 206f 6620 7261 6e67 650a 2020 2020  ut of range.    
-000152a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152b0: 6966 2070 6f73 2e63 6f74 6169 6e73 4e6f  if pos.cotainsNo
-000152c0: 6e65 5661 6c75 6573 496e 5265 7175 6972  neValuesInRequir
-000152d0: 6564 4669 656c 6473 2829 3a0a 2020 2020  edFields():.    
-000152e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152f0: 2020 2020 756e 6d61 7463 6865 6454 696d      unmatchedTim
-00015300: 6550 6f69 6e74 732e 6170 7065 6e64 2828  ePoints.append((
-00015310: 6474 5f69 6d61 6765 5f74 7320 2b20 7361  dt_image_ts + sa
-00015320: 6d70 6c65 5469 6d65 5365 6373 202a 2031  mpleTimeSecs * 1
-00015330: 3030 3029 2f31 3030 3029 0a20 2020 2020  000)/1000).     
-00015340: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00015350: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00015360: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
-00015370: 5f6c 6973 742e 6170 7065 6e64 2870 6f73  _list.append(pos
-00015380: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00015390: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-000153a0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-000153b0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000153c0: 7572 6e20 4661 6c73 652c 2069 6d61 6765  urn False, image
-000153d0: 5f64 7473 2c20 2243 6f75 6c64 206e 6f74  _dts, "Could not
-000153e0: 2066 696e 6420 696d 6167 6520 7469 6d65   find image time
-000153f0: 2022 2b20 6461 7465 7469 6d65 2e64 6174   "+ datetime.dat
-00015400: 6574 696d 652e 7574 6366 726f 6d74 696d  etime.utcfromtim
-00015410: 6573 7461 6d70 2828 6474 5f69 6d61 6765  estamp((dt_image
-00015420: 5f74 7320 2b20 7361 6d70 6c65 5469 6d65  _ts + sampleTime
-00015430: 5365 6373 202a 2031 3030 3029 2f31 3030  Secs * 1000)/100
-00015440: 3029 2e73 7472 6674 696d 6528 6d69 7174  0).strftime(miqt
-00015450: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-00015460: 6d61 7269 7174 275d 2920 2b22 2069 6e20  mariqt']) +" in 
-00015470: 222b 7374 7228 6461 7461 2e6c 656e 2829  "+str(data.len()
-00015480: 292b 2220 6461 7461 2070 6f73 6974 696f  )+" data positio
-00015490: 6e73 2220 2b20 7374 7228 652e 6172 6773  ns" + str(e.args
-000154a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000154b0: 2020 7361 6d70 6c65 5469 6d65 5365 6373    sampleTimeSecs
-000154c0: 202b 3d20 7669 6465 6f53 616d 706c 6553   += videoSampleS
-000154d0: 6563 6f6e 6473 0a20 2020 2020 2020 2020  econds.         
-000154e0: 2020 2020 2020 2069 6620 7361 6d70 6c65         if sample
-000154f0: 5469 6d65 5365 6373 203e 2072 756e 5469  TimeSecs > runTi
-00015500: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
-00015510: 2020 2020 2020 2020 676f 203d 2046 616c          go = Fal
-00015520: 7365 0a20 2020 2020 2020 2020 2020 200a  se.            .
-00015530: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-00015540: 655f 6474 735b 6669 6c65 5f6e 616d 655d  e_dts[file_name]
-00015550: 203d 2070 6f73 5f6c 6973 740a 2020 2020   = pos_list.    
-00015560: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
-00015570: 0a20 2020 2020 2020 2072 6574 7572 6e4d  .        returnM
-00015580: 7367 203d 2022 220a 2020 2020 2020 2020  sg = "".        
-00015590: 6966 206c 656e 2875 6e6d 6174 6368 6564  if len(unmatched
-000155a0: 5469 6d65 506f 696e 7473 2920 213d 2030  TimePoints) != 0
-000155b0: 3a0a 2020 2020 2020 2020 2020 2020 756e  :.            un
-000155c0: 6d61 7463 6865 6454 696d 6550 6f69 6e74  matchedTimePoint
-000155d0: 732e 736f 7274 2829 0a20 2020 2020 2020  s.sort().       
-000155e0: 2020 2020 2075 6e6d 6174 6368 6564 5469       unmatchedTi
-000155f0: 6d65 506f 696e 7473 203d 205b 6461 7465  mePoints = [date
-00015600: 7469 6d65 2e64 6174 6574 696d 652e 7574  time.datetime.ut
-00015610: 6366 726f 6d74 696d 6573 7461 6d70 2874  cfromtimestamp(t
-00015620: 7329 2e73 7472 6674 696d 6528 6d69 7174  s).strftime(miqt
-00015630: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-00015640: 6d61 7269 7174 275d 2920 666f 7220 7473  mariqt']) for ts
-00015650: 2069 6e20 756e 6d61 7463 6865 6454 696d   in unmatchedTim
-00015660: 6550 6f69 6e74 735d 0a20 2020 2020 2020  ePoints].       
-00015670: 2020 2020 2072 6574 7572 6e4d 7367 203d       returnMsg =
-00015680: 2022 4341 5554 494f 4e21 204e 6176 6967   "CAUTION! Navig
-00015690: 6174 696f 6e20 6e6f 7420 666f 756e 6420  ation not found 
-000156a0: 666f 7220 7468 6520 666f 6c6c 6f77 696e  for the followin
-000156b0: 6720 696d 6167 6520 7469 6d65 2070 6f69  g image time poi
-000156c0: 6e74 732e 2044 6f75 626c 6520 6368 6563  nts. Double chec
-000156d0: 6b20 6f72 2070 726f 7669 6465 2061 7420  k or provide at 
-000156e0: 6c65 6173 7420 7374 6174 6963 2064 6566  least static def
-000156f0: 6175 6c74 206e 6176 6967 6174 696f 6e20  ault navigation 
-00015700: 696e 2068 6561 6465 7220 6669 656c 6473  in header fields
-00015710: 2e22 0a20 2020 2020 2020 2020 2020 2072  .".            r
-00015720: 6574 7572 6e4d 7367 202b 3d20 225c 6e22  eturnMsg += "\n"
-00015730: 202b 2022 5c6e 222e 6a6f 696e 2875 6e6d   + "\n".join(unm
-00015740: 6174 6368 6564 5469 6d65 506f 696e 7473  atchedTimePoints
-00015750: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00015760: 2054 7275 652c 2069 6d61 6765 5f64 7473   True, image_dts
-00015770: 2c20 7265 7475 726e 4d73 670a 0a0a 2020  , returnMsg...  
-00015780: 2020 6465 6620 6372 6561 7465 5f69 6d61    def create_ima
-00015790: 6765 5f6e 6176 6967 6174 696f 6e5f 6669  ge_navigation_fi
-000157a0: 6c65 2873 656c 662c 206e 6176 5f70 6174  le(self, nav_pat
-000157b0: 683a 2073 7472 2c20 6e61 765f 6865 6164  h: str, nav_head
-000157c0: 6572 3d6d 6971 7476 2e70 6f73 5f68 6561  er=miqtv.pos_hea
-000157d0: 6465 725b 2770 616e 6761 6561 275d 2c20  der['pangaea'], 
-000157e0: 6461 7465 5f66 6f72 6d61 743d 6d69 7174  date_format=miqt
-000157f0: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-00015800: 7061 6e67 6165 6127 5d2c 206f 7665 7277  pangaea'], overw
-00015810: 7269 7465 3d46 616c 7365 2c20 636f 6c5f  rite=False, col_
-00015820: 7365 7061 7261 746f 7220 3d20 225c 7422  separator = "\t"
-00015830: 2c20 7669 6465 6f53 616d 706c 6553 6563  , videoSampleSec
-00015840: 6f6e 6473 3d31 2c0a 2020 2020 2020 2020  onds=1,.        
-00015850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015860: 2020 2020 2020 2020 2020 2020 6f66 6673              offs
-00015870: 6574 5f78 3d30 2c20 6f66 6673 6574 5f79  et_x=0, offset_y
-00015880: 3d30 2c20 6f66 6673 6574 5f7a 3d30 2c61  =0, offset_z=0,a
-00015890: 6e67 6c65 735f 696e 5f72 6164 203d 2046  ngles_in_rad = F
-000158a0: 616c 7365 2c20 7265 636f 7264 7332 6265  alse, records2be
-000158b0: 496e 7665 7274 6564 3d5b 5d29 3a0a 2020  Inverted=[]):.  
-000158c0: 2020 2020 2020 2222 2220 4372 6561 7465        """ Create
-000158d0: 7320 696e 202f 696e 7465 726d 6564 6961  s in /intermedia
-000158e0: 7465 2061 2074 6578 7420 6669 6c65 2077  te a text file w
-000158f0: 6974 6820 342e 3544 206e 6176 6967 6174  ith 4.5D navigat
-00015900: 696f 6e20 6461 7461 2066 6f72 2065 6163  ion data for eac
-00015910: 6820 696d 6167 652c 2069 2e65 2e20 6120  h image, i.e. a 
-00015920: 7369 6e67 6c65 2072 6f77 2070 6572 2070  single row per p
-00015930: 686f 746f 2c20 7669 6465 6f20 6475 7261  hoto, video dura
-00015940: 7469 6f6e 205b 7365 635d 202f 2076 6964  tion [sec] / vid
-00015950: 656f 5361 6d70 6c65 5365 636f 6e64 7320  eoSampleSeconds 
-00015960: 726f 7773 2070 6572 2076 6964 656f 2e0a  rows per video..
-00015970: 2020 2020 2020 2020 2020 2020 6e61 765f              nav_
-00015980: 6865 6164 6572 206d 7573 7420 6265 2064  header must be d
-00015990: 6963 7420 636f 6e74 6169 6e69 6e67 2074  ict containing t
-000159a0: 6865 206b 6579 7320 2775 7463 272c 276c  he keys 'utc','l
-000159b0: 6174 272c 276c 6f6e 272c 2764 6570 2728  at','lon','dep'(
-000159c0: 6f72 2027 616c 7427 292c 206f 7074 696f  or 'alt'), optio
-000159d0: 6e61 6c3a 2027 6867 7427 2c27 756e 6365  nal: 'hgt','unce
-000159e0: 7274 2720 7769 7468 2074 6865 2072 6573  rt' with the res
-000159f0: 7065 6374 6976 6520 636f 6c75 6d6e 2068  pective column h
-00015a00: 6561 6465 7273 2061 7320 7661 6c75 6573  eaders as values
-00015a10: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
-00015a20: 206f 6e65 206f 6620 7468 6520 7665 6869   one of the vehi
-00015a30: 636c 6520 782c 792c 7a20 6f66 6673 6574  cle x,y,z offset
-00015a40: 7320 5b6d 5d20 6973 206e 6f74 2030 2061  s [m] is not 0 a
-00015a50: 6e64 206e 6176 5f68 6561 6465 7220 616c  nd nav_header al
-00015a60: 736f 2063 6f6e 7461 696e 7320 2779 6177  so contains 'yaw
-00015a70: 272c 2770 6974 6368 272c 2772 6f6c 6c27  ','pitch','roll'
-00015a80: 206c 6576 6572 6172 6d20 6f66 6673 6574   leverarm offset
-00015a90: 7320 6172 6520 636f 6d70 656e 7361 7465  s are compensate
-00015aa0: 6420 666f 7220 2222 220a 0a20 2020 2020  d for """..     
-00015ab0: 2020 2069 6620 7365 6c66 2e69 6e74 6572     if self.inter
-00015ac0: 6d65 6469 6174 654e 6176 4669 6c65 4578  mediateNavFileEx
-00015ad0: 6973 7473 2829 2061 6e64 206e 6f74 206f  ists() and not o
-00015ae0: 7665 7277 7269 7465 3a0a 2020 2020 2020  verwrite:.      
-00015af0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-00015b00: 652c 2022 4f75 7470 7574 2066 696c 6520  e, "Output file 
-00015b10: 6578 6973 7473 3a20 222b 7365 6c66 2e67  exists: "+self.g
-00015b20: 6574 5f69 6e74 5f6e 6176 5f66 696c 6528  et_int_nav_file(
-00015b30: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
-00015b40: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-00015b50: 286e 6176 5f70 6174 6829 3a0a 2020 2020  (nav_path):.    
-00015b60: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00015b70: 616c 7365 2c20 224e 6176 6967 6174 696f  alse, "Navigatio
-00015b80: 6e20 6669 6c65 206e 6f74 2066 6f75 6e64  n file not found
-00015b90: 3a20 222b 6e61 765f 7061 7468 0a0a 2020  : "+nav_path..  
-00015ba0: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
-00015bb0: 7061 7468 2e65 7869 7374 7328 7365 6c66  path.exists(self
-00015bc0: 2e69 6d61 6765 7344 6972 293a 0a20 2020  .imagesDir):.   
-00015bd0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00015be0: 4661 6c73 652c 2022 496d 6167 6520 666f  False, "Image fo
-00015bf0: 6c64 6572 206e 6f74 2066 6f75 6e64 3a20  lder not found: 
-00015c00: 222b 2073 656c 662e 696d 6167 6573 4469  "+ self.imagesDi
-00015c10: 720a 0a20 2020 2020 2020 2073 203d 206d  r..        s = m
-00015c20: 6971 7463 2e50 7269 6e74 4c6f 6164 696e  iqtc.PrintLoadin
-00015c30: 674d 7367 2822 4372 6561 7469 6e67 2069  gMsg("Creating i
-00015c40: 7465 6d73 2720 6e61 7669 6761 7469 6f6e  tems' navigation
-00015c50: 2064 6174 6122 290a 2020 2020 2020 2020   data").        
-00015c60: 7265 7475 726e 4d73 6720 3d20 2222 0a20  returnMsg = "". 
-00015c70: 2020 2020 2020 2063 6f6d 7065 6e73 6174         compensat
-00015c80: 4f66 6673 6574 7320 3d20 4661 6c73 650a  Offsets = False.
-00015c90: 2020 2020 2020 2020 6966 2028 6f66 6673          if (offs
-00015ca0: 6574 5f78 213d 3020 6f72 206f 6666 7365  et_x!=0 or offse
-00015cb0: 745f 7921 3d30 206f 7220 6f66 6673 6574  t_y!=0 or offset
-00015cc0: 5f7a 213d 3029 2061 6e64 2027 7961 7727  _z!=0) and 'yaw'
-00015cd0: 2069 6e20 6e61 765f 6865 6164 6572 2061   in nav_header a
-00015ce0: 6e64 2027 7069 7463 6827 2069 6e20 6e61  nd 'pitch' in na
-00015cf0: 765f 6865 6164 6572 2061 6e64 2027 726f  v_header and 'ro
-00015d00: 6c6c 2720 696e 206e 6176 5f68 6561 6465  ll' in nav_heade
-00015d10: 723a 0a20 2020 2020 2020 2020 2020 2063  r:.            c
-00015d20: 6f6d 7065 6e73 6174 4f66 6673 6574 7320  ompensatOffsets 
-00015d30: 3d20 5472 7565 0a0a 2020 2020 2020 2020  = True..        
-00015d40: 2320 6368 6563 6b20 6966 2066 6f72 206d  # check if for m
-00015d50: 6973 7369 6e67 2066 6965 6c64 7320 7468  issing fields th
-00015d60: 6572 6520 6172 6520 636f 6e73 7420 7661  ere are const va
-00015d70: 6c75 6573 2069 6e20 6865 6164 6572 0a20  lues in header. 
-00015d80: 2020 2020 2020 2063 6f6e 7374 5f76 616c         const_val
-00015d90: 7565 7320 3d20 7b7d 0a20 2020 2020 2020  ues = {}.       
-00015da0: 2066 6f72 206e 6176 4669 656c 6420 696e   for navField in
-00015db0: 206d 6971 7476 2e70 6f73 5f68 6561 6465   miqtv.pos_heade
-00015dc0: 725b 276d 6172 6971 7427 5d3a 0a20 2020  r['mariqt']:.   
-00015dd0: 2020 2020 2020 2020 2072 6573 7065 6374           respect
-00015de0: 6976 6548 6561 6465 7246 6965 6c64 203d  iveHeaderField =
-00015df0: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-00015e00: 725b 226d 6172 6971 7422 5d5b 6e61 7646  r["mariqt"][navF
-00015e10: 6965 6c64 5d0a 2020 2020 2020 2020 2020  ield].          
-00015e20: 2020 6966 206e 6176 4669 656c 6420 6e6f    if navField no
-00015e30: 7420 696e 206e 6176 5f68 6561 6465 7220  t in nav_header 
-00015e40: 616e 6420 2872 6573 7065 6374 6976 6548  and (respectiveH
-00015e50: 6561 6465 7246 6965 6c64 2069 6e20 7365  eaderField in se
-00015e60: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00015e70: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-00015e80: 6579 5d20 616e 6420 7365 6c66 2e66 696e  ey] and self.fin
-00015e90: 6454 6d70 4669 656c 6432 2872 6573 7065  dTmpField2(respe
-00015ea0: 6374 6976 6548 6561 6465 7246 6965 6c64  ctiveHeaderField
-00015eb0: 2920 213d 2022 2229 3a20 0a20 2020 2020  ) != ""): .     
-00015ec0: 2020 2020 2020 2020 2020 2063 6f6e 7374             const
-00015ed0: 5f76 616c 7565 735b 6e61 7646 6965 6c64  _values[navField
-00015ee0: 5d20 3d20 7365 6c66 2e66 696e 6454 6d70  ] = self.findTmp
-00015ef0: 4669 656c 6428 7265 7370 6563 7469 7665  Field(respective
-00015f00: 4865 6164 6572 4669 656c 6429 0a0a 2020  HeaderField)..  
-00015f10: 2020 2020 2020 2320 4c6f 6164 206e 6176        # Load nav
-00015f20: 6967 6174 696f 6e20 6461 7461 0a20 2020  igation data.   
-00015f30: 2020 2020 206e 6176 5f64 6174 612c 2070       nav_data, p
-00015f40: 6172 7365 4d73 6720 3d20 6d69 7174 6e2e  arseMsg = miqtn.
-00015f50: 7265 6164 416c 6c50 6f73 6974 696f 6e73  readAllPositions
-00015f60: 4672 6f6d 4669 6c65 5061 7468 286e 6176  FromFilePath(nav
-00015f70: 5f70 6174 682c 206e 6176 5f68 6561 6465  _path, nav_heade
-00015f80: 722c 2064 6174 655f 666f 726d 6174 2c63  r, date_format,c
-00015f90: 6f6c 5f73 6570 6172 6174 6f72 3d63 6f6c  ol_separator=col
-00015fa0: 5f73 6570 6172 6174 6f72 2c63 6f6e 7374  _separator,const
-00015fb0: 5f76 616c 7565 733d 636f 6e73 745f 7661  _values=const_va
-00015fc0: 6c75 6573 290a 2020 2020 2020 2020 6966  lues).        if
-00015fd0: 2070 6172 7365 4d73 6720 213d 2022 223a   parseMsg != "":
-00015fe0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00015ff0: 662e 7072 6f76 2e6c 6f67 2870 6172 7365  f.prov.log(parse
-00016000: 4d73 672c 646f 6e74 5368 6f77 3d54 7275  Msg,dontShow=Tru
-00016010: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
-00016020: 6574 7572 6e4d 7367 203d 2022 5c6e 2220  eturnMsg = "\n" 
-00016030: 2b20 7061 7273 654d 7367 0a0a 2020 2020  + parseMsg..    
-00016040: 2020 2020 2320 6669 6e64 2066 6f72 2065      # find for e
-00016050: 6163 6820 696d 6167 6520 7468 6520 7265  ach image the re
-00016060: 7370 6563 7469 7665 206e 6176 6967 6174  spective navigat
-00016070: 696f 6e20 6461 7461 0a20 2020 2020 2020  ion data.       
-00016080: 2073 2e73 746f 7028 290a 2020 2020 2020   s.stop().      
-00016090: 2020 7375 6363 6573 732c 2069 6d61 6765    success, image
-000160a0: 5f64 7473 2c20 6d73 6720 3d20 7365 6c66  _dts, msg = self
-000160b0: 2e66 696e 644e 6176 4461 7461 466f 7249  .findNavDataForI
-000160c0: 6d61 6765 286e 6176 5f64 6174 612c 7669  mage(nav_data,vi
-000160d0: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
-000160e0: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
-000160f0: 726f 762e 6c6f 6728 6d73 672c 646f 6e74  rov.log(msg,dont
-00016100: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
-00016110: 2020 2069 6620 6d73 6720 213d 2022 223a     if msg != "":
-00016120: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00016130: 7572 6e4d 7367 202b 3d20 225c 6e22 202b  urnMsg += "\n" +
-00016140: 206d 7367 0a20 2020 2020 2020 2069 6620   msg.        if 
-00016150: 6e6f 7420 7375 6363 6573 733a 0a20 2020  not success:.   
-00016160: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00016170: 4661 6c73 652c 2072 6574 7572 6e4d 7367  False, returnMsg
-00016180: 0a20 2020 2020 2020 2073 203d 206d 6971  .        s = miq
-00016190: 7463 2e50 7269 6e74 4c6f 6164 696e 674d  tc.PrintLoadingM
-000161a0: 7367 2822 4372 6561 7469 6e67 2069 7465  sg("Creating ite
-000161b0: 6d73 2720 6e61 7669 6761 7469 6f6e 2064  ms' navigation d
-000161c0: 6174 6122 290a 0a20 2020 2020 2020 2023  ata")..        #
-000161d0: 2063 6f6d 7065 6e73 6174 6520 6c65 7665   compensate leve
-000161e0: 7261 726d 206f 6666 7365 7473 0a20 2020  rarm offsets.   
-000161f0: 2020 2020 2069 6620 636f 6d70 656e 7361       if compensa
-00016200: 744f 6666 7365 7473 3a0a 0a20 2020 2020  tOffsets:..     
-00016210: 2020 2020 2020 2023 206c 6f61 6420 6672         # load fr
-00016220: 616d 6520 6174 7469 7475 6465 2064 6174  ame attitude dat
-00016230: 6120 6672 6f6d 2066 696c 650a 2020 2020  a from file.    
-00016240: 2020 2020 2020 2020 6174 745f 6461 7461          att_data
-00016250: 2c20 7061 7273 654d 7367 203d 206d 6971  , parseMsg = miq
-00016260: 746e 2e72 6561 6441 6c6c 4174 7469 7475  tn.readAllAttitu
-00016270: 6465 7346 726f 6d46 696c 6550 6174 6828  desFromFilePath(
-00016280: 6e61 765f 7061 7468 2c20 6e61 765f 6865  nav_path, nav_he
-00016290: 6164 6572 2c20 6461 7465 5f66 6f72 6d61  ader, date_forma
-000162a0: 742c 636f 6c5f 7365 7061 7261 746f 723d  t,col_separator=
-000162b0: 636f 6c5f 7365 7061 7261 746f 722c 636f  col_separator,co
-000162c0: 6e73 745f 7661 6c75 6573 3d63 6f6e 7374  nst_values=const
-000162d0: 5f76 616c 7565 732c 616e 676c 6573 496e  _values,anglesIn
-000162e0: 5261 643d 616e 676c 6573 5f69 6e5f 7261  Rad=angles_in_ra
-000162f0: 6429 0a20 2020 2020 2020 2020 2020 2069  d).            i
-00016300: 6620 7061 7273 654d 7367 2021 3d20 2222  f parseMsg != ""
-00016310: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016320: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-00016330: 7061 7273 654d 7367 2c64 6f6e 7453 686f  parseMsg,dontSho
-00016340: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
-00016350: 2020 2020 2020 2020 7265 7475 726e 4d73          returnMs
-00016360: 6720 2b3d 2022 5c6e 2220 2b20 7061 7273  g += "\n" + pars
-00016370: 654d 7367 0a0a 2020 2020 2020 2020 2020  eMsg..          
-00016380: 2020 2320 6669 6e64 2066 6f72 2065 6163    # find for eac
-00016390: 6820 696d 6167 6520 7468 6520 7265 7370  h image the resp
-000163a0: 6563 7469 7665 206e 6176 6967 6174 696f  ective navigatio
-000163b0: 6e20 6461 7461 0a20 2020 2020 2020 2020  n data.         
-000163c0: 2020 2073 7563 6365 7373 2c20 696d 6167     success, imag
-000163d0: 655f 6474 735f 6174 742c 206d 7367 203d  e_dts_att, msg =
-000163e0: 2073 656c 662e 6669 6e64 4e61 7644 6174   self.findNavDat
-000163f0: 6146 6f72 496d 6167 6528 6174 745f 6461  aForImage(att_da
-00016400: 7461 2c76 6964 656f 5361 6d70 6c65 5365  ta,videoSampleSe
-00016410: 636f 6e64 7329 0a20 2020 2020 2020 2020  conds).         
-00016420: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00016430: 286d 7367 2c64 6f6e 7453 686f 773d 5472  (msg,dontShow=Tr
-00016440: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00016450: 6966 206d 7367 2021 3d20 2222 3a0a 2020  if msg != "":.  
-00016460: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00016470: 7475 726e 4d73 6720 2b3d 2022 5c6e 2220  turnMsg += "\n" 
-00016480: 2b20 6d73 670a 2020 2020 2020 2020 2020  + msg.          
-00016490: 2020 6966 206e 6f74 2073 7563 6365 7373    if not success
-000164a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000164b0: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
-000164c0: 7265 7475 726e 4d73 670a 0a20 2020 2020  returnMsg..     
-000164d0: 2020 2020 2020 2023 2063 6f6d 7065 6e73         # compens
-000164e0: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-000164f0: 666f 7220 6669 6c65 2069 6e20 696d 6167  for file in imag
-00016500: 655f 6474 733a 0a20 2020 2020 2020 2020  e_dts:.         
-00016510: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
-00016520: 203d 2069 6d61 6765 5f64 7473 5b66 696c   = image_dts[fil
-00016530: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
-00016540: 2020 2061 7474 6974 7564 6573 203d 2069     attitudes = i
-00016550: 6d61 6765 5f64 7473 5f61 7474 5b66 696c  mage_dts_att[fil
-00016560: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
-00016570: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00016580: 6528 6c65 6e28 706f 7369 7469 6f6e 7329  e(len(positions)
-00016590: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000165a0: 2020 2020 2020 206c 6174 203d 2070 6f73         lat = pos
-000165b0: 6974 696f 6e73 5b69 5d2e 6c61 740a 2020  itions[i].lat.  
-000165c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000165d0: 2020 6c6f 6e20 3d20 706f 7369 7469 6f6e    lon = position
-000165e0: 735b 695d 2e6c 6f6e 0a20 2020 2020 2020  s[i].lon.       
-000165f0: 2020 2020 2020 2020 2020 2020 2064 6570               dep
-00016600: 203d 2070 6f73 6974 696f 6e73 5b69 5d2e   = positions[i].
-00016610: 6465 700a 2020 2020 2020 2020 2020 2020  dep.            
-00016620: 2020 2020 2020 2020 6966 2027 616c 7427          if 'alt'
-00016630: 2069 6e20 6e61 765f 6865 6164 6572 2061   in nav_header a
-00016640: 6e64 206e 6f74 2027 6465 7027 2069 6e20  nd not 'dep' in 
-00016650: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
-00016660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016670: 2020 2020 6465 7020 2a3d 202d 310a 2020      dep *= -1.  
-00016680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016690: 2020 7961 7720 3d20 6174 7469 7475 6465    yaw = attitude
-000166a0: 735b 695d 2e79 6177 0a20 2020 2020 2020  s[i].yaw.       
-000166b0: 2020 2020 2020 2020 2020 2020 2070 6974               pit
-000166c0: 6368 203d 2061 7474 6974 7564 6573 5b69  ch = attitudes[i
-000166d0: 5d2e 7069 7463 680a 2020 2020 2020 2020  ].pitch.        
-000166e0: 2020 2020 2020 2020 2020 2020 726f 6c6c              roll
-000166f0: 203d 2061 7474 6974 7564 6573 5b69 5d2e   = attitudes[i].
-00016700: 726f 6c6c 0a20 2020 2020 2020 2020 2020  roll.           
-00016710: 2020 2020 2020 2020 2069 6620 7961 7720           if yaw 
-00016720: 6973 204e 6f6e 6520 6f72 2070 6974 6368  is None or pitch
-00016730: 2069 7320 4e6f 6e65 206f 7220 726f 6c6c   is None or roll
-00016740: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00016750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016760: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00016770: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00016780: 6577 5f6c 6174 2c6e 6577 5f6c 6f6e 2c6e  ew_lat,new_lon,n
-00016790: 6577 5f64 6570 203d 206d 6971 7467 2e61  ew_dep = miqtg.a
-000167a0: 6464 4c65 7665 7261 726d 7332 4c61 746c  ddLeverarms2Latl
-000167b0: 6f6e 286c 6174 2c6c 6f6e 2c64 6570 2c6f  on(lat,lon,dep,o
-000167c0: 6666 7365 745f 782c 6f66 6673 6574 5f79  ffset_x,offset_y
-000167d0: 2c6f 6666 7365 745f 7a2c 7961 772c 7069  ,offset_z,yaw,pi
-000167e0: 7463 682c 726f 6c6c 290a 2020 2020 2020  tch,roll).      
-000167f0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00016800: 7369 7469 6f6e 735b 695d 2e6c 6174 203d  sitions[i].lat =
-00016810: 206e 6577 5f6c 6174 0a20 2020 2020 2020   new_lat.       
-00016820: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
-00016830: 6974 696f 6e73 5b69 5d2e 6c6f 6e20 3d20  itions[i].lon = 
-00016840: 6e65 775f 6c6f 6e0a 2020 2020 2020 2020  new_lon.        
-00016850: 2020 2020 2020 2020 2020 2020 706f 7369              posi
-00016860: 7469 6f6e 735b 695d 2e64 6570 203d 206e  tions[i].dep = n
-00016870: 6577 5f64 6570 0a0a 2020 2020 2020 2020  ew_dep..        
-00016880: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-00016890: 6728 2261 7070 6c69 6564 206c 6576 6572  g("applied lever
-000168a0: 2061 726d 2063 6f6d 7065 6e73 6174 696f   arm compensatio
-000168b0: 6e20 782c 792c 7a20 3d20 2220 2b20 7374  n x,y,z = " + st
-000168c0: 7228 6f66 6673 6574 5f78 2920 2b20 222c  r(offset_x) + ",
-000168d0: 2220 2b20 7374 7228 6f66 6673 6574 5f79  " + str(offset_y
-000168e0: 2920 2b20 222c 2220 2b20 7374 7228 6f66  ) + "," + str(of
-000168f0: 6673 6574 5f7a 292c 646f 6e74 5368 6f77  fset_z),dontShow
-00016900: 3d54 7275 6529 0a0a 2020 2020 2020 2020  =True)..        
-00016910: 6966 206c 656e 2869 6d61 6765 5f64 7473  if len(image_dts
-00016920: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
-00016930: 2020 2023 2043 6865 636b 2077 6865 7468     # Check wheth
-00016940: 6572 2064 6570 7468 2061 6e64 2068 6569  er depth and hei
-00016950: 6768 7420 6172 6520 7365 740a 2020 2020  ght are set.    
-00016960: 2020 2020 2020 2020 6c61 745f 6964 656e          lat_iden
-00016970: 7469 6361 6c2c 206c 6f6e 5f69 6465 6e74  tical, lon_ident
-00016980: 6963 616c 2c20 6465 705f 6964 656e 7469  ical, dep_identi
-00016990: 6361 6c2c 2068 6774 5f69 6465 6e74 6963  cal, hgt_identic
-000169a0: 616c 2c20 6465 705f 6e6f 745f 7a65 726f  al, dep_not_zero
-000169b0: 2c20 6867 745f 6e6f 745f 7a65 726f 2c75  , hgt_not_zero,u
-000169c0: 6e63 6572 745f 6e6f 745f 7a65 726f 203d  ncert_not_zero =
-000169d0: 206e 6176 5f64 6174 612e 6368 6563 6b50   nav_data.checkP
-000169e0: 6f73 6974 696f 6e73 436f 6e74 656e 7428  ositionsContent(
-000169f0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00016a00: 2057 7269 7465 2074 6f20 6e61 7669 6761   Write to naviga
-00016a10: 7469 6f6e 2074 7874 2066 696c 650a 2020  tion txt file.  
-00016a20: 2020 2020 2020 2020 2020 2320 6865 6164            # head
-00016a30: 6572 0a20 2020 2020 2020 2020 2020 2072  er.            r
-00016a40: 6573 203d 206f 7065 6e28 7365 6c66 2e67  es = open(self.g
-00016a50: 6574 5f69 6e74 5f6e 6176 5f66 696c 6528  et_int_nav_file(
-00016a60: 292c 2022 7722 290a 2020 2020 2020 2020  ), "w").        
-00016a70: 2020 2020 7265 732e 7772 6974 6528 6d69      res.write(mi
-00016a80: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00016a90: 6d61 7269 7174 275d 5b27 696d 6727 5d2b  mariqt']['img']+
-00016aa0: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
-00016ab0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00016ac0: 2775 7463 275d 290a 0a20 2020 2020 2020  'utc'])..       
-00016ad0: 2020 2020 2068 6173 5f61 6c74 203d 2054       has_alt = T
-00016ae0: 7275 6520 6966 2064 6570 5f6e 6f74 5f7a  rue if dep_not_z
-00016af0: 6572 6f20 616e 6420 2820 2764 6570 2720  ero and ( 'dep' 
-00016b00: 696e 206e 6176 5f68 6561 6465 7220 6f72  in nav_header or
-00016b10: 2027 616c 7427 2069 6e20 6e61 765f 6865   'alt' in nav_he
-00016b20: 6164 6572 2029 2065 6c73 6520 4661 6c73  ader ) else Fals
-00016b30: 650a 0a20 2020 2020 2020 2020 2020 2069  e..            i
-00016b40: 6620 276c 6174 2720 696e 206e 6176 5f68  f 'lat' in nav_h
-00016b50: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
-00016b60: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00016b70: 2822 5c74 222b 6d69 7174 762e 636f 6c5f  ("\t"+miqtv.col_
-00016b80: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00016b90: 5b27 6c61 7427 5d29 0a20 2020 2020 2020  ['lat']).       
-00016ba0: 2020 2020 2069 6620 276c 6f6e 2720 696e       if 'lon' in
-00016bb0: 206e 6176 5f68 6561 6465 723a 0a20 2020   nav_header:.   
-00016bc0: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00016bd0: 2e77 7269 7465 2822 5c74 222b 6d69 7174  .write("\t"+miqt
-00016be0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00016bf0: 7269 7174 275d 5b27 6c6f 6e27 5d29 0a20  riqt']['lon']). 
-00016c00: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
-00016c10: 735f 616c 743a 0a20 2020 2020 2020 2020  s_alt:.         
-00016c20: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00016c30: 2822 5c74 222b 6d69 7174 762e 636f 6c5f  ("\t"+miqtv.col_
-00016c40: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00016c50: 5b27 616c 7427 5d29 0a20 2020 2020 2020  ['alt']).       
-00016c60: 2020 2020 2069 6620 6867 745f 6e6f 745f       if hgt_not_
-00016c70: 7a65 726f 2061 6e64 2027 6867 7427 2069  zero and 'hgt' i
-00016c80: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
-00016c90: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00016ca0: 732e 7772 6974 6528 225c 7422 2b6d 6971  s.write("\t"+miq
-00016cb0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00016cc0: 6172 6971 7427 5d5b 2768 6774 275d 290a  ariqt']['hgt']).
-00016cd0: 2020 2020 2020 2020 2020 2020 6966 2075              if u
-00016ce0: 6e63 6572 745f 6e6f 745f 7a65 726f 2061  ncert_not_zero a
-00016cf0: 6e64 2027 756e 6365 7274 2720 696e 206e  nd 'uncert' in n
-00016d00: 6176 5f68 6561 6465 723a 0a20 2020 2020  av_header:.     
-00016d10: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
-00016d20: 7269 7465 2822 5c74 222b 6d69 7174 762e  rite("\t"+miqtv.
-00016d30: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00016d40: 7174 275d 5b27 756e 6365 7274 275d 290a  qt']['uncert']).
-00016d50: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00016d60: 7772 6974 6528 225c 6e22 290a 2020 2020  write("\n").    
-00016d70: 2020 2020 2020 2020 2320 6461 7461 206c          # data l
-00016d80: 696e 6573 0a20 2020 2020 2020 2020 2020  ines.           
-00016d90: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
-00016da0: 6765 5f64 7473 3a0a 2020 2020 2020 2020  ge_dts:.        
-00016db0: 2020 2020 2020 2020 666f 7220 7469 6d65          for time
-00016dc0: 706f 696e 7420 696e 2069 6d61 6765 5f64  point in image_d
-00016dd0: 7473 5b66 696c 655d 3a0a 2020 2020 2020  ts[file]:.      
-00016de0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00016df0: 732e 7772 6974 6528 6669 6c65 2b22 5c74  s.write(file+"\t
-00016e00: 222b 7469 6d65 706f 696e 742e 6461 7465  "+timepoint.date
-00016e10: 5469 6d65 2829 2e73 7472 6674 696d 6528  Time().strftime(
-00016e20: 6d69 7174 762e 6461 7465 5f66 6f72 6d61  miqtv.date_forma
-00016e30: 7473 5b27 6d61 7269 7174 275d 2929 200a  ts['mariqt'])) .
-00016e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e50: 2020 2020 6966 2027 6c61 7427 2069 6e20      if 'lat' in 
-00016e60: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
-00016e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e80: 2020 2020 7661 6c20 3d20 7469 6d65 706f      val = timepo
-00016e90: 696e 742e 6c61 740a 2020 2020 2020 2020  int.lat.        
-00016ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016eb0: 6966 2027 6c61 7427 2069 6e20 7265 636f  if 'lat' in reco
-00016ec0: 7264 7332 6265 496e 7665 7274 6564 3a0a  rds2beInverted:.
-00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ee0: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
-00016ef0: 2a3d 202d 310a 2020 2020 2020 2020 2020  *= -1.          
-00016f00: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00016f10: 732e 7772 6974 6528 225c 7422 2b73 7472  s.write("\t"+str
-00016f20: 2876 616c 2929 0a20 2020 2020 2020 2020  (val)).         
-00016f30: 2020 2020 2020 2020 2020 2069 6620 276c             if 'l
-00016f40: 6f6e 2720 696e 206e 6176 5f68 6561 6465  on' in nav_heade
-00016f50: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00016f60: 2020 2020 2020 2020 2020 2076 616c 203d             val =
-00016f70: 2074 696d 6570 6f69 6e74 2e6c 6f6e 0a20   timepoint.lon. 
-00016f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f90: 2020 2020 2020 2069 6620 276c 6f6e 2720         if 'lon' 
-00016fa0: 696e 2072 6563 6f72 6473 3262 6549 6e76  in records2beInv
-00016fb0: 6572 7465 643a 0a20 2020 2020 2020 2020  erted:.         
-00016fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016fd0: 2020 2076 616c 202a 3d20 2d31 0a20 2020     val *= -1.   
-00016fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fdf0: 5d2c 6669 656c 6429 203d 3d20 2222 3a0a  ],field) == "":.
+0000fe00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe10: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000fe20: 2020 2020 2020 2020 2069 6664 6f5b 7365           ifdo[se
+0000fe30: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000fe40: 724b 6579 5d5b 6669 656c 645d 203d 2073  rKey][field] = s
+0000fe50: 656c 662e 5f5f 6765 7446 6965 6c64 5661  elf.__getFieldVa
+0000fe60: 6c75 6528 6966 646f 2c5b 6669 7273 745f  lue(ifdo,[first_
+0000fe70: 696d 6167 652c 6669 656c 645d 2c64 6566  image,field],def
+0000fe80: 6175 6c74 5f6f 6e6c 793d 5472 7565 290a  ault_only=True).
+0000fe90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fea0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+0000feb0: 6728 2253 6574 2072 6570 7265 7365 6e74  g("Set represent
+0000fec0: 6174 6976 6520 6865 6164 6572 2066 6965  ative header fie
+0000fed0: 6c64 2027 2220 2b20 6669 656c 6420 2b20  ld '" + field + 
+0000fee0: 2227 2074 6f20 2220 2b20 7374 7228 6966  "' to " + str(if
+0000fef0: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
+0000ff00: 4865 6164 6572 4b65 795d 5b66 6965 6c64  HeaderKey][field
+0000ff10: 5d29 202b 2022 2066 726f 6d20 6669 7273  ]) + " from firs
+0000ff20: 7420 696d 6167 652e 2229 0a20 2020 2020  t image.").     
+0000ff30: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0000ff40: 7420 6d69 7174 632e 4966 646f 4578 6365  t miqtc.IfdoExce
+0000ff50: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
+0000ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff70: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+0000ff80: 436f 756c 6420 6e6f 7420 7365 7420 7265  Could not set re
+0000ff90: 7072 6573 656e 7461 7469 7665 2068 6561  presentative hea
+0000ffa0: 6465 7220 6669 656c 643a 2022 202b 2073  der field: " + s
+0000ffb0: 7472 2865 7829 290a 2020 2020 2020 2020  tr(ex)).        
+0000ffc0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+0000ffd0: 0a0a 0a20 2020 2064 6566 205f 7365 745f  ...    def _set_
+0000ffe0: 6c61 745f 6c6f 6e5f 626f 756e 6469 6e67  lat_lon_bounding
+0000fff0: 5f62 6f78 2873 656c 662c 6966 646f 3a64  _box(self,ifdo:d
+00010000: 6963 7429 3a0a 2020 2020 2020 2020 2222  ict):.        ""
+00010010: 2220 5365 7420 696d 6167 652d 7365 742d  " Set image-set-
+00010020: 5b6d 696e 2c6d 6178 5d2d 5b6c 6174 6974  [min,max]-[latit
+00010030: 7564 652c 6c6f 6e67 6974 7564 655d 2d64  ude,longitude]-d
+00010040: 6567 7265 6573 2022 2222 0a20 2020 2020  egrees """.     
+00010050: 2020 206c 6174 5f6d 696e 2c20 6c61 745f     lat_min, lat_
+00010060: 6d61 782c 206c 6f6e 5f6d 696e 2c20 6c6f  max, lon_min, lo
+00010070: 6e5f 6d61 7820 3d20 7365 6c66 2e5f 6765  n_max = self._ge
+00010080: 745f 6c61 745f 6c6f 6e5f 626f 756e 6469  t_lat_lon_boundi
+00010090: 6e67 5f62 6f78 2869 6664 6f5b 7365 6c66  ng_box(ifdo[self
+000100a0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+000100b0: 795d 290a 2020 2020 2020 2020 6966 206e  y]).        if n
+000100c0: 6f74 204e 6f6e 6520 696e 205b 6c61 745f  ot None in [lat_
+000100d0: 6d69 6e2c 206c 6174 5f6d 6178 2c20 6c6f  min, lat_max, lo
+000100e0: 6e5f 6d69 6e2c 206c 6f6e 5f6d 6178 5d3a  n_min, lon_max]:
+000100f0: 0a20 2020 2020 2020 2020 2020 2069 6664  .            ifd
+00010100: 6f5b 7365 6c66 2e69 6d61 6765 5365 7448  o[self.imageSetH
+00010110: 6561 6465 724b 6579 5d5b 2769 6d61 6765  eaderKey]['image
+00010120: 2d73 6574 2d6d 696e 2d6c 6174 6974 7564  -set-min-latitud
+00010130: 652d 6465 6772 6565 7327 5d20 3d20 6c61  e-degrees'] = la
+00010140: 745f 6d69 6e0a 2020 2020 2020 2020 2020  t_min.          
+00010150: 2020 6966 646f 5b73 656c 662e 696d 6167    ifdo[self.imag
+00010160: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
+00010170: 696d 6167 652d 7365 742d 6d61 782d 6c61  image-set-max-la
+00010180: 7469 7475 6465 2d64 6567 7265 6573 275d  titude-degrees']
+00010190: 203d 206c 6174 5f6d 6178 0a20 2020 2020   = lat_max.     
+000101a0: 2020 2020 2020 2069 6664 6f5b 7365 6c66         ifdo[self
+000101b0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+000101c0: 6579 5d5b 2769 6d61 6765 2d73 6574 2d6d  ey]['image-set-m
+000101d0: 696e 2d6c 6f6e 6769 7475 6465 2d64 6567  in-longitude-deg
+000101e0: 7265 6573 275d 203d 206c 6f6e 5f6d 696e  rees'] = lon_min
+000101f0: 0a20 2020 2020 2020 2020 2020 2069 6664  .            ifd
+00010200: 6f5b 7365 6c66 2e69 6d61 6765 5365 7448  o[self.imageSetH
+00010210: 6561 6465 724b 6579 5d5b 2769 6d61 6765  eaderKey]['image
+00010220: 2d73 6574 2d6d 6178 2d6c 6f6e 6769 7475  -set-max-longitu
+00010230: 6465 2d64 6567 7265 6573 275d 203d 206c  de-degrees'] = l
+00010240: 6f6e 5f6d 6178 0a0a 0a20 2020 2040 7374  on_max...    @st
+00010250: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+00010260: 6566 205f 6765 745f 6c61 745f 6c6f 6e5f  ef _get_lat_lon_
+00010270: 626f 756e 6469 6e67 5f62 6f78 2869 7465  bounding_box(ite
+00010280: 6d73 3a64 6963 7429 3a0a 2020 2020 2020  ms:dict):.      
+00010290: 2020 2222 2220 5265 7475 726e 7320 6c61    """ Returns la
+000102a0: 745f 6d69 6e2c 206c 6174 5f6d 6178 2c20  t_min, lat_max, 
+000102b0: 6c6f 6e5f 6d69 6e2c 206c 6f6e 5f6d 6178  lon_min, lon_max
+000102c0: 2022 2222 0a20 2020 2020 2020 206c 6174   """.        lat
+000102d0: 5f6d 696e 2c20 6c61 745f 6d61 782c 206c  _min, lat_max, l
+000102e0: 6f6e 5f6d 696e 2c20 6c6f 6e5f 6d61 7820  on_min, lon_max 
+000102f0: 3d20 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f  = None, None, No
+00010300: 6e65 2c20 4e6f 6e65 0a20 2020 2020 2020  ne, None.       
+00010310: 2069 203d 2030 0a20 2020 2020 2020 2066   i = 0.        f
+00010320: 6f72 2069 6d61 6765 2c20 6461 7461 2069  or image, data i
+00010330: 6e20 6974 656d 732e 6974 656d 7328 293a  n items.items():
+00010340: 0a20 2020 2020 2020 2020 2020 2023 206d  .            # m
+00010350: 616b 6520 696d 6167 6520 656e 7472 7920  ake image entry 
+00010360: 6c69 7374 2028 616c 736f 2069 6620 6974  list (also if it
+00010370: 7320 6120 7069 6374 7572 6529 0a20 2020  s a picture).   
+00010380: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00010390: 6973 696e 7374 616e 6365 2864 6174 612c  isinstance(data,
+000103a0: 206c 6973 7429 3a0a 2020 2020 2020 2020   list):.        
+000103b0: 2020 2020 2020 2020 6461 7461 203d 205b          data = [
+000103c0: 6461 7461 5d0a 2020 2020 2020 2020 2020  data].          
+000103d0: 2020 0a20 2020 2020 2020 2020 2020 2066    .            f
+000103e0: 6f72 2074 696d 6570 6f69 6e74 5f64 6174  or timepoint_dat
+000103f0: 6120 696e 2064 6174 613a 0a20 2020 2020  a in data:.     
+00010400: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00010410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010420: 2020 2020 6c61 7420 3d20 7469 6d65 706f      lat = timepo
+00010430: 696e 745f 6461 7461 5b27 696d 6167 652d  int_data['image-
+00010440: 6c61 7469 7475 6465 275d 0a20 2020 2020  latitude'].     
+00010450: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00010460: 6f6e 203d 2074 696d 6570 6f69 6e74 5f64  on = timepoint_d
+00010470: 6174 615b 2769 6d61 6765 2d6c 6f6e 6769  ata['image-longi
+00010480: 7475 6465 275d 0a20 2020 2020 2020 2020  tude'].         
+00010490: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
+000104a0: 7945 7272 6f72 2061 7320 6578 3a0a 2020  yError as ex:.  
+000104b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104c0: 2020 636f 6e74 696e 7565 0a0a 2020 2020    continue..    
+000104d0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+000104e0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+000104f0: 2020 2020 2020 2020 2020 206c 6174 5f6d             lat_m
+00010500: 696e 2c20 6c61 745f 6d61 7820 3d20 6c61  in, lat_max = la
+00010510: 742c 206c 6174 0a20 2020 2020 2020 2020  t, lat.         
+00010520: 2020 2020 2020 2020 2020 206c 6f6e 5f6d             lon_m
+00010530: 696e 2c20 6c6f 6e5f 6d61 7820 3d20 6c6f  in, lon_max = lo
+00010540: 6e2c 206c 6f6e 0a20 2020 2020 2020 2020  n, lon.         
+00010550: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00010560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010570: 2069 6620 6c61 7420 3c20 6c61 745f 6d69   if lat < lat_mi
+00010580: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
+00010590: 2020 2020 2020 2020 2020 206c 6174 5f6d             lat_m
+000105a0: 696e 203d 206c 6174 0a20 2020 2020 2020  in = lat.       
+000105b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000105c0: 6c61 7420 3e20 6c61 745f 6d61 783a 0a20  lat > lat_max:. 
+000105d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105e0: 2020 2020 2020 206c 6174 5f6d 6178 203d         lat_max =
+000105f0: 206c 6174 0a20 2020 2020 2020 2020 2020   lat.           
+00010600: 2020 2020 2020 2020 2069 6620 6c6f 6e20           if lon 
+00010610: 3c20 6c6f 6e5f 6d69 6e3a 0a20 2020 2020  < lon_min:.     
+00010620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010630: 2020 206c 6f6e 5f6d 696e 203d 206c 6f6e     lon_min = lon
+00010640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010650: 2020 2020 2069 6620 6c6f 6e20 3e20 6c6f       if lon > lo
+00010660: 6e5f 6d61 783a 0a20 2020 2020 2020 2020  n_max:.         
+00010670: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00010680: 6f6e 5f6d 6178 203d 206c 6f6e 0a20 2020  on_max = lon.   
+00010690: 2020 2020 2020 2020 2020 2020 2069 202b               i +
+000106a0: 3d20 310a 2020 2020 2020 2020 7265 7475  = 1.        retu
+000106b0: 726e 206c 6174 5f6d 696e 2c20 6c61 745f  rn lat_min, lat_
+000106c0: 6d61 782c 206c 6f6e 5f6d 696e 2c20 6c6f  max, lon_min, lo
+000106d0: 6e5f 6d61 780a 0a0a 2020 2020 6465 6620  n_max...    def 
+000106e0: 7265 6d6f 7665 4974 656d 4669 656c 6473  removeItemFields
+000106f0: 5769 7468 4f6e 6c79 4461 7465 5469 6d65  WithOnlyDateTime
+00010700: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00010710: 2222 2220 6974 2063 616e 2068 6170 7065  """ it can happe
+00010720: 6e20 7468 6174 2061 6e20 696d 6167 6520  n that an image 
+00010730: 7469 6d65 7374 616d 7020 646f 6573 206e  timestamp does n
+00010740: 6f74 2063 6f6e 7461 696e 2061 6e79 2066  ot contain any f
+00010750: 6965 6c64 7320 6275 7420 7468 6520 7469  ields but the ti
+00010760: 6d65 7374 616d 7020 616e 7920 6d6f 7265  mestamp any more
+00010770: 2e20 5468 6f73 6520 6172 6520 7265 6d6f  . Those are remo
+00010780: 7665 6420 6865 7265 2e20 2222 2220 0a20  ved here. """ . 
+00010790: 2020 2020 2020 2066 6f72 2069 7465 6d20         for item 
+000107a0: 696e 2073 656c 662e 6966 646f 5f74 6d70  in self.ifdo_tmp
+000107b0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
+000107c0: 656d 734b 6579 5d3a 0a20 2020 2020 2020  emsKey]:.       
+000107d0: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+000107e0: 7374 616e 6365 2873 656c 662e 6966 646f  stance(self.ifdo
+000107f0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+00010800: 6574 4974 656d 734b 6579 5d5b 6974 656d  etItemsKey][item
+00010810: 5d2c 6c69 7374 293a 0a20 2020 2020 2020  ],list):.       
+00010820: 2020 2020 2020 2020 2073 656c 662e 6966           self.if
+00010830: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+00010840: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
+00010850: 656d 5d20 3d20 5b73 656c 662e 6966 646f  em] = [self.ifdo
+00010860: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+00010870: 6574 4974 656d 734b 6579 5d5b 6974 656d  etItemsKey][item
+00010880: 5d5d 0a20 2020 2020 2020 2020 2020 2074  ]].            t
+00010890: 6f42 6552 656d 6f76 6564 203d 205b 5d0a  oBeRemoved = [].
+000108a0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000108b0: 656e 7472 7920 696e 2073 656c 662e 6966  entry in self.if
+000108c0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+000108d0: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
+000108e0: 656d 5d3a 0a20 2020 2020 2020 2020 2020  em]:.           
+000108f0: 2020 2020 2023 7072 696e 7428 656e 7472       #print(entr
+00010900: 7929 0a20 2020 2020 2020 2020 2020 2020  y).             
+00010910: 2020 2069 6620 6c65 6e28 656e 7472 7929     if len(entry)
+00010920: 203d 3d20 3120 616e 6420 2769 6d61 6765   == 1 and 'image
+00010930: 2d64 6174 6574 696d 6527 2069 6e20 656e  -datetime' in en
+00010940: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00010950: 2020 2020 2020 2020 2074 6f42 6552 656d           toBeRem
+00010960: 6f76 6564 2e61 7070 656e 6428 656e 7472  oved.append(entr
+00010970: 7929 0a20 2020 2020 2020 2020 2020 2066  y).            f
+00010980: 6f72 2065 6e74 7279 2069 6e20 746f 4265  or entry in toBe
+00010990: 5265 6d6f 7665 643a 0a20 2020 2020 2020  Removed:.       
+000109a0: 2020 2020 2020 2020 2073 656c 662e 6966           self.if
+000109b0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+000109c0: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
+000109d0: 656d 5d2e 7265 6d6f 7665 2865 6e74 7279  em].remove(entry
+000109e0: 2920 0a0a 0a20 2020 2064 6566 2063 6865  ) ...    def che
+000109f0: 636b 416c 6c49 7465 6d48 6173 6865 7328  ckAllItemHashes(
+00010a00: 7365 6c66 2c20 6861 7264 3d46 616c 7365  self, hard=False
+00010a10: 2c20 7261 6973 6545 7863 6570 7469 6f6e  , raiseException
+00010a20: 203d 2054 7275 6529 3a0a 2020 2020 2020   = True):.      
+00010a30: 2020 2222 2220 0a20 2020 2020 2020 2043    """ .        C
+00010a40: 6865 636b 7320 6966 2068 6173 6865 7320  hecks if hashes 
+00010a50: 696e 2069 4644 4f20 6d61 7463 6820 6861  in iFDO match ha
+00010a60: 7368 6573 2069 6e20 696e 7465 726d 6569  shes in intermei
+00010a70: 6461 7465 2068 6173 6820 6669 6c65 2069  date hash file i
+00010a80: 6620 7468 6520 6c61 7474 6572 2077 6173  f the latter was
+00010a90: 2063 6861 6e67 6564 206c 6173 7420 6166   changed last af
+00010aa0: 7465 7220 7468 6520 696d 6167 6573 2068  ter the images h
+00010ab0: 6173 2063 6861 6e67 6564 2e0a 2020 2020  as changed..    
+00010ac0: 2020 2020 4f74 6865 7277 6973 6520 6f72      Otherwise or
+00010ad0: 2069 6620 6861 7264 3d3d 5472 7565 2069   if hard==True i
+00010ae0: 7420 7265 6465 7465 726d 696e 6573 2074  t redetermines t
+00010af0: 6865 2061 6374 7561 6c6c 2066 696c 6527  he actuall file'
+00010b00: 7320 6861 7368 2061 6e64 2063 6f6d 7061  s hash and compa
+00010b10: 7265 7320 7468 6520 6946 444f 2069 7465  res the iFDO ite
+00010b20: 6d27 7320 6861 7368 2077 6974 6820 7468  m's hash with th
+00010b30: 6174 2e0a 2020 2020 2020 2020 4966 2068  at..        If h
+00010b40: 6173 6865 7320 646f 206e 6f74 206d 6174  ashes do not mat
+00010b50: 6368 2061 206d 6172 6971 742e 636f 7265  ch a mariqt.core
+00010b60: 2e49 6664 6f45 7863 6570 7469 6f6e 2069  .IfdoException i
+00010b70: 7320 7269 7365 6e20 756e 736c 6573 7320  s risen unsless 
+00010b80: 7261 6973 6545 7863 6570 7469 6f6e 203d  raiseException =
+00010b90: 3d20 4661 6c73 652c 2074 6865 6e20 6120  = False, then a 
+00010ba0: 6c69 7374 206f 6620 6c69 7374 7320 5b3c  list of lists [<
+00010bb0: 6669 6c65 3e2c 3c65 7863 6570 7469 6f6e  file>,<exception
+00010bc0: 3e5d 2069 7320 7265 7475 726e 6564 2e0a  >] is returned..
+00010bd0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010be0: 2020 2020 6861 7368 6573 203d 207b 7d0a      hashes = {}.
+00010bf0: 2020 2020 2020 2020 6861 7368 4669 6c65          hashFile
+00010c00: 4d6f 6454 696d 6520 3d20 3130 652b 3130  ModTime = 10e+10
+00010c10: 300a 2020 2020 2020 2020 6966 206f 732e  0.        if os.
+00010c20: 7061 7468 2e65 7869 7374 7328 7365 6c66  path.exists(self
+00010c30: 2e67 6574 5f69 6e74 5f68 6173 685f 6669  .get_int_hash_fi
+00010c40: 6c65 2829 293a 0a20 2020 2020 2020 2020  le()):.         
+00010c50: 2020 2068 6173 6865 7320 3d20 6d69 7174     hashes = miqt
+00010c60: 662e 7461 6246 696c 6544 6174 6128 7365  f.tabFileData(se
+00010c70: 6c66 2e67 6574 5f69 6e74 5f68 6173 685f  lf.get_int_hash_
+00010c80: 6669 6c65 2829 2c20 5b6d 6971 7476 2e63  file(), [miqtv.c
+00010c90: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00010ca0: 7427 5d5b 2769 6d67 275d 2c20 6d69 7174  t']['img'], miqt
+00010cb0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00010cc0: 7269 7174 275d 5b27 6861 7368 275d 5d2c  riqt']['hash']],
+00010cd0: 206b 6579 5f63 6f6c 3d6d 6971 7476 2e63   key_col=miqtv.c
+00010ce0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00010cf0: 7427 5d5b 2769 6d67 275d 290a 2020 2020  t']['img']).    
+00010d00: 2020 2020 2020 2020 6861 7368 4669 6c65          hashFile
+00010d10: 4d6f 6454 696d 6520 3d20 6f73 2e70 6174  ModTime = os.pat
+00010d20: 682e 6765 746d 7469 6d65 2873 656c 662e  h.getmtime(self.
+00010d30: 6765 745f 696e 745f 6861 7368 5f66 696c  get_int_hash_fil
+00010d40: 6528 2929 0a0a 2020 2020 2020 2020 6578  e())..        ex
+00010d50: 6365 7074 696f 6e4c 6973 7420 3d20 5b5d  ceptionList = []
+00010d60: 0a0a 2020 2020 2020 2020 6861 7368 556e  ..        hashUn
+00010d70: 6368 6563 6b49 6d61 6765 7349 6e52 6177  checkImagesInRaw
+00010d80: 203d 2073 656c 662e 696d 6167 6573 496e   = self.imagesIn
+00010d90: 496d 6167 6573 4469 7228 290a 2020 2020  ImagesDir().    
+00010da0: 2020 2020 7072 6f67 203d 206d 6971 7463      prog = miqtc
+00010db0: 2e50 7269 6e74 4b6e 6f77 6e50 726f 6772  .PrintKnownProgr
+00010dc0: 6573 734d 7367 2822 4368 6563 6b69 6e67  essMsg("Checking
+00010dd0: 2069 7465 6d20 6861 7368 6573 222c 206c   item hashes", l
+00010de0: 656e 2873 656c 662e 6966 646f 5f74 6d70  en(self.ifdo_tmp
+00010df0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
+00010e00: 656d 734b 6579 5d29 290a 2020 2020 2020  emsKey])).      
+00010e10: 2020 666f 7220 6974 656d 2069 6e20 7365    for item in se
+00010e20: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00010e30: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+00010e40: 795d 3a0a 2020 2020 2020 2020 2020 2020  y]:.            
+00010e50: 7072 6f67 2e70 726f 6772 6573 7328 290a  prog.progress().
+00010e60: 0a20 2020 2020 2020 2020 2020 2066 6f75  .            fou
+00010e70: 6e64 203d 2046 616c 7365 0a20 2020 2020  nd = False.     
+00010e80: 2020 2020 2020 2066 6f72 2069 6d61 6765         for image
+00010e90: 2069 6e20 6861 7368 556e 6368 6563 6b49   in hashUncheckI
+00010ea0: 6d61 6765 7349 6e52 6177 3a0a 2020 2020  magesInRaw:.    
+00010eb0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00010ec0: 4e61 6d65 203d 206f 732e 7061 7468 2e62  Name = os.path.b
+00010ed0: 6173 656e 616d 6528 696d 6167 6529 0a20  asename(image). 
+00010ee0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00010ef0: 6620 6669 6c65 4e61 6d65 203d 3d20 6974  f fileName == it
+00010f00: 656d 3a0a 2020 2020 2020 2020 2020 2020  em:.            
+00010f10: 2020 2020 2020 2020 666f 756e 6420 3d20          found = 
+00010f20: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00010f30: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+00010f40: 7374 616e 6365 2873 656c 662e 6966 646f  stance(self.ifdo
+00010f50: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+00010f60: 6574 4974 656d 734b 6579 5d5b 6974 656d  etItemsKey][item
+00010f70: 5d2c 6c69 7374 293a 2023 2069 6e20 6361  ],list): # in ca
+00010f80: 7365 206f 6620 7669 6465 6f20 7769 7468  se of video with
+00010f90: 2069 7465 6d20 6173 206c 6973 7420 7468   item as list th
+00010fa0: 6520 6669 7273 7420 656e 7472 7920 686f  e first entry ho
+00010fb0: 6c64 7320 7468 6520 6465 6661 756c 7420  lds the default 
+00010fc0: 616e 6420 7468 6520 6861 7368 2063 616e  and the hash can
+00010fd0: 6e6f 7420 7661 7279 2066 6f72 2074 6865  not vary for the
+00010fe0: 2073 616d 6520 696d 6167 650a 2020 2020   same image.    
+00010ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011000: 2020 2020 6974 656d 456e 7472 7920 3d20      itemEntry = 
+00011010: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+00011020: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+00011030: 4b65 795d 5b69 7465 6d5d 5b30 5d20 0a20  Key][item][0] . 
+00011040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011050: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00011060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011070: 2069 7465 6d45 6e74 7279 203d 2073 656c   itemEntry = sel
+00011080: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+00011090: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
+000110a0: 5d5b 6974 656d 5d0a 0a20 2020 2020 2020  ][item]..       
+000110b0: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
+000110c0: 6765 4d6f 6454 696d 6520 3d20 6f73 2e70  geModTime = os.p
+000110d0: 6174 682e 6765 746d 7469 6d65 2869 6d61  ath.getmtime(ima
+000110e0: 6765 290a 2020 2020 2020 2020 2020 2020  ge).            
+000110f0: 2020 2020 2020 2020 6966 206e 6f74 2068          if not h
+00011100: 6172 6420 616e 6420 696d 6167 654d 6f64  ard and imageMod
+00011110: 5469 6d65 203c 2068 6173 6846 696c 654d  Time < hashFileM
+00011120: 6f64 5469 6d65 3a0a 2020 2020 2020 2020  odTime:.        
+00011130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011140: 6966 206e 6f74 206f 732e 7061 7468 2e62  if not os.path.b
+00011150: 6173 656e 616d 6528 696d 6167 6529 2069  asename(image) i
+00011160: 6e20 6861 7368 6573 3a0a 2020 2020 2020  n hashes:.      
+00011170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011180: 2020 2020 2020 6966 2072 6169 7365 4578        if raiseEx
+00011190: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+000111a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000111b0: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
+000111c0: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+000111d0: 6f6e 2869 7465 6d2c 2022 6e6f 7420 666f  on(item, "not fo
+000111e0: 756e 6420 696e 2069 6e74 6572 6d65 6964  und in intermeid
+000111f0: 6174 6520 6861 7368 2066 696c 6522 2c73  ate hash file",s
+00011200: 656c 662e 6765 745f 696e 745f 6861 7368  elf.get_int_hash
+00011210: 5f66 696c 6528 292c 2220 7275 6e20 6372  _file()," run cr
+00011220: 6561 7465 5f69 6d61 6765 5f73 6861 3235  eate_image_sha25
+00011230: 365f 6669 6c65 2829 2066 6972 7374 2229  6_file() first")
+00011240: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00011250: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00011260: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00011270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011280: 2020 2020 6578 6365 7074 696f 6e4c 6973      exceptionLis
+00011290: 742e 6170 7065 6e64 285b 6669 6c65 4e61  t.append([fileNa
+000112a0: 6d65 2c22 6e6f 7420 666f 756e 6420 696e  me,"not found in
+000112b0: 2069 6e74 6572 6d65 6964 6174 6520 6861   intermeidate ha
+000112c0: 7368 2066 696c 6520 2220 2b20 7374 7228  sh file " + str(
+000112d0: 7365 6c66 2e67 6574 5f69 6e74 5f68 6173  self.get_int_has
+000112e0: 685f 6669 6c65 2829 295d 290a 2020 2020  h_file())]).    
+000112f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011300: 2020 2020 6966 206e 6f74 2069 7465 6d45      if not itemE
+00011310: 6e74 7279 5b27 696d 6167 652d 6861 7368  ntry['image-hash
+00011320: 2d73 6861 3235 3627 5d20 3d3d 2068 6173  -sha256'] == has
+00011330: 6865 735b 6f73 2e70 6174 682e 6261 7365  hes[os.path.base
+00011340: 6e61 6d65 2869 6d61 6765 295d 5b27 696d  name(image)]['im
+00011350: 6167 652d 6861 7368 2d73 6861 3235 3627  age-hash-sha256'
+00011360: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00011370: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00011380: 6620 7261 6973 6545 7863 6570 7469 6f6e  f raiseException
+00011390: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000113a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000113b0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+000113c0: 646f 4578 6365 7074 696f 6e28 6974 656d  doException(item
+000113d0: 2c20 2269 6e63 6f72 7265 6374 2073 6861  , "incorrect sha
+000113e0: 3235 3620 6861 7368 222c 2069 7465 6d45  256 hash", itemE
+000113f0: 6e74 7279 5b27 696d 6167 652d 6861 7368  ntry['image-hash
+00011400: 2d73 6861 3235 3627 5d2c 2266 6f72 2066  -sha256'],"for f
+00011410: 696c 6522 2c66 696c 654e 616d 652c 2220  ile",fileName," 
+00011420: 7275 6e20 6372 6561 7465 5f69 6d61 6765  run create_image
+00011430: 5f73 6861 3235 365f 6669 6c65 2829 2066  _sha256_file() f
+00011440: 6972 7374 2229 0a20 2020 2020 2020 2020  irst").         
+00011450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011460: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00011470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011480: 2020 2020 2020 2020 2065 7863 6570 7469           excepti
+00011490: 6f6e 4c69 7374 2e61 7070 656e 6428 5b66  onList.append([f
+000114a0: 696c 654e 616d 652c 2269 6e63 6f72 7265  ileName,"incorre
+000114b0: 6374 2073 6861 3235 3620 6861 7368 225d  ct sha256 hash"]
+000114c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000114d0: 2020 2020 2020 656c 6966 206e 6f74 2069        elif not i
+000114e0: 7465 6d45 6e74 7279 5b27 696d 6167 652d  temEntry['image-
+000114f0: 6861 7368 2d73 6861 3235 3627 5d20 3d3d  hash-sha256'] ==
+00011500: 206d 6971 7463 2e73 6861 3235 3648 6173   miqtc.sha256Has
+00011510: 6846 696c 6528 696d 6167 6529 3a0a 2020  hFile(image):.  
+00011520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011530: 2020 2020 2020 6966 2072 6169 7365 4578        if raiseEx
+00011540: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+00011550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011560: 2020 2020 2072 6169 7365 206d 6971 7463       raise miqtc
+00011570: 2e49 6664 6f45 7863 6570 7469 6f6e 2869  .IfdoException(i
+00011580: 7465 6d2c 2022 696e 636f 7272 6563 7420  tem, "incorrect 
+00011590: 7368 6132 3536 2068 6173 6822 2c20 6974  sha256 hash", it
+000115a0: 656d 456e 7472 795b 2769 6d61 6765 2d68  emEntry['image-h
+000115b0: 6173 682d 7368 6132 3536 275d 2c22 666f  ash-sha256'],"fo
+000115c0: 7220 6669 6c65 222c 6669 6c65 4e61 6d65  r file",fileName
+000115d0: 2c22 2072 756e 2063 7265 6174 655f 696d  ," run create_im
+000115e0: 6167 655f 7368 6132 3536 5f66 696c 6528  age_sha256_file(
+000115f0: 2920 6669 7273 7422 290a 2020 2020 2020  ) first").      
+00011600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011610: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00011620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011630: 2020 2020 6578 6365 7074 696f 6e4c 6973      exceptionLis
+00011640: 742e 6170 7065 6e64 285b 6669 6c65 4e61  t.append([fileNa
+00011650: 6d65 2c22 696e 636f 7272 6563 7420 7368  me,"incorrect sh
+00011660: 6132 3536 2068 6173 6822 5d29 0a20 2020  a256 hash"]).   
+00011670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011680: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+00011690: 2020 2069 6620 666f 756e 643a 0a20 2020     if found:.   
+000116a0: 2020 2020 2020 2020 2020 2020 2064 656c               del
+000116b0: 2068 6173 6855 6e63 6865 636b 496d 6167   hashUncheckImag
+000116c0: 6573 496e 5261 775b 696d 6167 655d 0a20  esInRaw[image]. 
+000116d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000116e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000116f0: 2069 6620 7261 6973 6545 7863 6570 7469   if raiseExcepti
+00011700: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+00011710: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
+00011720: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
+00011730: 6e28 2022 696d 6167 6522 2c20 6974 656d  n( "image", item
+00011740: 2c20 226e 6f74 2066 6f75 6e64 2069 6e20  , "not found in 
+00011750: 6469 7265 6374 6f72 7927 7320 7261 7720  directory's raw 
+00011760: 666f 6c64 6572 2122 290a 2020 2020 2020  folder!").      
+00011770: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00011780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011790: 2020 2020 6578 6365 7074 696f 6e4c 6973      exceptionLis
+000117a0: 742e 6170 7065 6e64 285b 6669 6c65 4e61  t.append([fileNa
+000117b0: 6d65 2c22 6669 6c65 206e 6f74 2066 6f75  me,"file not fou
+000117c0: 6e64 225d 290a 2020 2020 2020 2020 7072  nd"]).        pr
+000117d0: 6f67 2e63 6c65 6172 2829 0a20 2020 2020  og.clear().     
+000117e0: 2020 2069 6620 6e6f 7420 7261 6973 6545     if not raiseE
+000117f0: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
+00011800: 2020 2020 2020 7265 7475 726e 2065 7863        return exc
+00011810: 6570 7469 6f6e 4c69 7374 0a0a 0a20 2020  eptionList...   
+00011820: 2064 6566 2063 7265 6174 655f 7575 6964   def create_uuid
+00011830: 5f66 696c 6528 7365 6c66 2c63 6c65 616e  _file(self,clean
+00011840: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+00011850: 2222 2220 4372 6561 7465 7320 696e 202f  """ Creates in /
+00011860: 696e 7465 726d 6564 6961 7465 2061 2074  intermediate a t
+00011870: 6578 7420 6669 6c65 2063 6f6e 7461 696e  ext file contain
+00011880: 696e 6720 7065 7220 696d 6167 6520 6120  ing per image a 
+00011890: 6372 6561 7465 6420 7575 6964 2028 7665  created uuid (ve
+000118a0: 7273 696f 6e20 3429 2e0a 0a20 2020 2020  rsion 4)...     
+000118b0: 2020 2054 6865 2055 5549 4420 6973 206f     The UUID is o
+000118c0: 6e6c 7920 2a74 616b 656e 2a20 6672 6f6d  nly *taken* from
+000118d0: 2074 6865 206d 6574 6164 6174 6120 6f66   the metadata of
+000118e0: 2074 6865 2069 6d61 6765 732e 2049 7420   the images. It 
+000118f0: 646f 6573 206e 6f74 2077 7269 7465 2055  does not write U
+00011900: 5549 4473 2074 6f20 7468 6520 6d65 7461  UIDs to the meta
+00011910: 6461 7461 2069 6e20 6361 7365 2073 6f6d  data in case som
+00011920: 6520 6669 6c65 7320 6172 6520 6d69 7373  e files are miss
+00011930: 696e 6720 6974 2e0a 2020 2020 2020 2020  ing it..        
+00011940: 4275 742c 2069 7420 6372 6561 7465 7320  But, it creates 
+00011950: 6120 4353 5620 6669 6c65 2069 6e20 7468  a CSV file in th
+00011960: 6174 2063 6173 6520 7468 6174 2079 6f75  at case that you
+00011970: 2063 616e 2075 7365 2074 6f67 6574 6865   can use togethe
+00011980: 7220 7769 7468 2065 7869 6674 6f6f 6c20  r with exiftool 
+00011990: 746f 2061 6464 2074 6865 2055 5549 4420  to add the UUID 
+000119a0: 746f 2079 6f75 7220 6461 7461 2e20 4265  to your data. Be
+000119b0: 7761 7265 2120 7468 6973 2063 616e 2064  ware! this can d
+000119c0: 6573 7472 6f79 2079 6f75 7220 696d 6167  estroy your imag
+000119d0: 6573 0a20 2020 2020 2020 2069 6620 6e6f  es.        if no
+000119e0: 7420 646f 6e65 2070 726f 7065 726c 7921  t done properly!
+000119f0: 204e 6f20 6775 6172 616e 7465 6520 6973   No guarantee is
+00011a00: 2067 6976 656e 2069 7420 7769 6c6c 2077   given it will w
+00011a10: 6f72 6b2e 2042 6520 6361 7265 6675 6c21  ork. Be careful!
+00011a20: 0a0a 2020 2020 2020 2020 5573 6520 636c  ..        Use cl
+00011a30: 6561 6e3d 4661 6c73 6520 746f 206e 6f74  ean=False to not
+00011a40: 2063 6865 636b 2074 686f 7365 2066 696c   check those fil
+00011a50: 6573 2061 6761 696e 2077 6869 6368 2061  es again which a
+00011a60: 7265 2061 6c72 6561 6479 2066 6f75 6e64  re already found
+00011a70: 2069 6e20 696e 7465 726d 6564 6961 7465   in intermediate
+00011a80: 2075 7569 6420 6669 6c65 0a20 2020 2020   uuid file.     
+00011a90: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00011aa0: 7575 6964 7320 3d20 7b7d 0a20 2020 2020  uuids = {}.     
+00011ab0: 2020 2023 2043 6865 636b 2077 6865 7468     # Check wheth
+00011ac0: 6572 2061 2066 696c 6520 7769 7468 2055  er a file with U
+00011ad0: 5549 4473 2065 7869 7374 732c 2074 6865  UIDs exists, the
+00011ae0: 6e20 7265 6164 2069 740a 2020 2020 2020  n read it.      
+00011af0: 2020 6966 206e 6f74 2063 6c65 616e 2061    if not clean a
+00011b00: 6e64 206f 732e 7061 7468 2e65 7869 7374  nd os.path.exist
+00011b10: 7328 7365 6c66 2e67 6574 5f69 6e74 5f75  s(self.get_int_u
+00011b20: 7569 645f 6669 6c65 2829 293a 0a20 2020  uid_file()):.   
+00011b30: 2020 2020 2020 2020 2075 7569 6473 203d           uuids =
+00011b40: 206d 6971 7466 2e74 6162 4669 6c65 4461   miqtf.tabFileDa
+00011b50: 7461 2873 656c 662e 6765 745f 696e 745f  ta(self.get_int_
+00011b60: 7575 6964 5f66 696c 6528 292c 205b 6d69  uuid_file(), [mi
+00011b70: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00011b80: 6d61 7269 7174 275d 5b27 696d 6727 5d2c  mariqt']['img'],
+00011b90: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
+00011ba0: 725b 276d 6172 6971 7427 5d5b 2775 7569  r['mariqt']['uui
+00011bb0: 6427 5d5d 2c20 6b65 795f 636f 6c3d 6d69  d']], key_col=mi
+00011bc0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00011bd0: 6d61 7269 7174 275d 5b27 696d 6727 5d29  mariqt']['img'])
+00011be0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00011bf0: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+00011c00: 2e65 7869 7374 7328 7365 6c66 2e69 6d61  .exists(self.ima
+00011c10: 6765 7344 6972 293a 0a0a 2020 2020 2020  gesDir):..      
+00011c20: 2020 2020 2020 6d69 7373 696e 675f 7575        missing_uu
+00011c30: 6964 7320 3d20 7b7d 0a20 2020 2020 2020  ids = {}.       
+00011c40: 2020 2020 2061 6464 6564 5f75 7569 6473       added_uuids
+00011c50: 203d 2030 0a0a 2020 2020 2020 2020 2020   = 0..          
+00011c60: 2020 756e 6b6e 6f77 6e46 696c 6573 203d    unknownFiles =
+00011c70: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00011c80: 666f 7220 6669 6c65 2069 6e20 7365 6c66  for file in self
+00011c90: 2e69 6d61 6765 7349 6e49 6d61 6765 7344  .imagesInImagesD
+00011ca0: 6972 2829 3a0a 2020 2020 2020 2020 2020  ir():.          
+00011cb0: 2020 2020 2020 6669 6c65 5f6e 616d 6520        file_name 
+00011cc0: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
+00011cd0: 6d65 2866 696c 6529 0a20 2020 2020 2020  me(file).       
+00011ce0: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
+00011cf0: 5f6e 616d 6520 6e6f 7420 696e 2075 7569  _name not in uui
+00011d00: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
+00011d10: 2020 2020 2020 2020 756e 6b6e 6f77 6e46          unknownF
+00011d20: 696c 6573 2e61 7070 656e 6428 6669 6c65  iles.append(file
+00011d30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00011d40: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00011d50: 2020 2020 2020 2020 2020 2020 7575 6964              uuid
+00011d60: 735b 6669 6c65 5f6e 616d 655d 203d 2075  s[file_name] = u
+00011d70: 7569 6473 5b66 696c 655f 6e61 6d65 5d5b  uids[file_name][
+00011d80: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00011d90: 5b27 6d61 7269 7174 275d 5b27 7575 6964  ['mariqt']['uuid
+00011da0: 275d 5d0a 0a20 2020 2020 2020 2020 2020  ']]..           
+00011db0: 2075 6e6b 6e6f 776e 4669 6c65 7355 5549   unknownFilesUUI
+00011dc0: 4473 203d 206d 6971 7469 2e69 6d61 6765  Ds = miqti.image
+00011dd0: 7343 6f6e 7461 696e 5661 6c69 6455 5549  sContainValidUUI
+00011de0: 4428 756e 6b6e 6f77 6e46 696c 6573 290a  D(unknownFiles).
+00011df0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00011e00: 6669 6c65 2069 6e20 756e 6b6e 6f77 6e46  file in unknownF
+00011e10: 696c 6573 5555 4944 733a 0a20 2020 2020  ilesUUIDs:.     
+00011e20: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+00011e30: 6e61 6d65 203d 206f 732e 7061 7468 2e62  name = os.path.b
+00011e40: 6173 656e 616d 6528 6669 6c65 290a 2020  asename(file).  
+00011e50: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00011e60: 206e 6f74 2075 6e6b 6e6f 776e 4669 6c65   not unknownFile
+00011e70: 7355 5549 4473 5b66 696c 655d 5b27 7661  sUUIDs[file]['va
+00011e80: 6c69 6427 5d3a 0a20 2020 2020 2020 2020  lid']:.         
+00011e90: 2020 2020 2020 2020 2020 2075 7569 6420             uuid 
+00011ea0: 3d20 6d69 7174 632e 7575 6964 3428 290a  = miqtc.uuid4().
+00011eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ec0: 2020 2020 6d69 7373 696e 675f 7575 6964      missing_uuid
+00011ed0: 735b 6669 6c65 5d20 3d20 7575 6964 0a20  s[file] = uuid. 
+00011ee0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00011ef0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00011f00: 2020 2020 2020 2020 2075 7569 6473 5b66           uuids[f
+00011f10: 696c 655f 6e61 6d65 5d20 3d20 756e 6b6e  ile_name] = unkn
+00011f20: 6f77 6e46 696c 6573 5555 4944 735b 6669  ownFilesUUIDs[fi
+00011f30: 6c65 5d5b 2775 7569 6427 5d0a 2020 2020  le]['uuid'].    
+00011f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f50: 6164 6465 645f 7575 6964 7320 2b3d 2031  added_uuids += 1
+00011f60: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00011f70: 4966 2070 7265 7669 6f75 736c 7920 756e  If previously un
+00011f80: 6b6e 6f77 6e20 5555 4944 7320 7765 7265  known UUIDs were
+00011f90: 2066 6f75 6e64 2069 6e20 7468 6520 6669   found in the fi
+00011fa0: 6c65 2068 6561 6465 7273 2c20 6164 6420  le headers, add 
+00011fb0: 7468 656d 2074 6f20 7468 6520 5555 4944  them to the UUID
+00011fc0: 2066 696c 650a 2020 2020 2020 2020 2020   file.          
+00011fd0: 2020 6966 2061 6464 6564 5f75 7569 6473    if added_uuids
+00011fe0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+00011ff0: 2020 2020 2020 7265 7320 3d20 6f70 656e        res = open
+00012000: 2873 656c 662e 6765 745f 696e 745f 7575  (self.get_int_uu
+00012010: 6964 5f66 696c 6528 292c 2022 7722 290a  id_file(), "w").
+00012020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012030: 7265 732e 7772 6974 6528 6d69 7174 762e  res.write(miqtv.
+00012040: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00012050: 7174 275d 5b27 696d 6727 5d20 2b22 5c74  qt']['img'] +"\t
+00012060: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
+00012070: 6572 5b27 6d61 7269 7174 275d 5b27 7575  er['mariqt']['uu
+00012080: 6964 275d 2b22 5c6e 2229 0a20 2020 2020  id']+"\n").     
+00012090: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+000120a0: 696c 6520 696e 2075 7569 6473 3a0a 2020  ile in uuids:.  
+000120b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000120c0: 2020 7265 732e 7772 6974 6528 6669 6c65    res.write(file
+000120d0: 2b22 5c74 222b 7374 7228 7575 6964 735b  +"\t"+str(uuids[
+000120e0: 6669 6c65 5d29 2b22 5c6e 2229 0a20 2020  file])+"\n").   
+000120f0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00012100: 2e63 6c6f 7365 2829 0a0a 2020 2020 2020  .close()..      
+00012110: 2020 2020 2020 6966 206c 656e 286d 6973        if len(mis
+00012120: 7369 6e67 5f75 7569 6473 2920 3e20 303a  sing_uuids) > 0:
+00012130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012140: 2065 6373 765f 7061 7468 203d 2073 656c   ecsv_path = sel
+00012150: 662e 5f5f 6765 745f 696e 745f 6669 6c65  f.__get_int_file
+00012160: 5f70 7265 6669 7828 2920 2b20 225f 6578  _prefix() + "_ex
+00012170: 6966 2d61 6464 2d75 7569 642e 6373 7622  if-add-uuid.csv"
+00012180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012190: 2063 7376 203d 206f 7065 6e28 6563 7376   csv = open(ecsv
+000121a0: 5f70 6174 682c 2022 7722 290a 2020 2020  _path, "w").    
+000121b0: 2020 2020 2020 2020 2020 2020 6373 762e              csv.
+000121c0: 7772 6974 6528 6d69 7174 762e 636f 6c5f  write(miqtv.col_
+000121d0: 6865 6164 6572 5b27 6578 6966 275d 5b27  header['exif']['
+000121e0: 696d 6727 5d20 2b0a 2020 2020 2020 2020  img'] +.        
+000121f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012200: 2020 222c 222b 6d69 7174 762e 636f 6c5f    ","+miqtv.col_
+00012210: 6865 6164 6572 5b27 6578 6966 275d 5b27  header['exif']['
+00012220: 7575 6964 275d 2b22 5c6e 2229 0a20 2020  uuid']+"\n").   
+00012230: 2020 2020 2020 2020 2020 2020 2064 6966               dif
+00012240: 6665 7265 6e74 5f70 6174 6873 203d 205b  ferent_paths = [
+00012250: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00012260: 2020 666f 7220 696d 6720 696e 206d 6973    for img in mis
+00012270: 7369 6e67 5f75 7569 6473 3a0a 2020 2020  sing_uuids:.    
+00012280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012290: 6966 206f 732e 7061 7468 2e62 6173 656e  if os.path.basen
+000122a0: 616d 6528 696d 6729 206e 6f74 2069 6e20  ame(img) not in 
+000122b0: 6469 6666 6572 656e 745f 7061 7468 733a  different_paths:
+000122c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000122d0: 2020 2020 2020 2020 2064 6966 6665 7265           differe
+000122e0: 6e74 5f70 6174 6873 2e61 7070 656e 6428  nt_paths.append(
+000122f0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+00012300: 2869 6d67 2929 0a20 2020 2020 2020 2020  (img)).         
+00012310: 2020 2020 2020 2020 2020 2063 7376 2e77             csv.w
+00012320: 7269 7465 2869 6d67 2b22 2c22 2b73 7472  rite(img+","+str
+00012330: 286d 6973 7369 6e67 5f75 7569 6473 5b69  (missing_uuids[i
+00012340: 6d67 5d29 2b22 5c6e 2229 0a20 2020 2020  mg])+"\n").     
+00012350: 2020 2020 2020 2020 2020 2023 7265 7475             #retu
+00012360: 726e 2046 616c 7365 2c20 2265 7869 6674  rn False, "exift
+00012370: 6f6f 6c20 2d63 7376 3d22 2b65 6373 765f  ool -csv="+ecsv_
+00012380: 7061 7468 2b22 2022 2b22 2022 2e6a 6f69  path+" "+" ".joi
+00012390: 6e28 6469 6666 6572 656e 745f 7061 7468  n(different_path
+000123a0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+000123b0: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
+000123c0: 2022 4e6f 7420 616c 6c20 696d 6167 6573   "Not all images
+000123d0: 2068 6176 6520 7661 6c69 6420 5555 4944   have valid UUID
+000123e0: 732e 204d 6973 7369 6e67 2066 6f72 2066  s. Missing for f
+000123f0: 6f6c 6c6f 7769 6e67 2066 696c 6573 3a5c  ollowing files:\
+00012400: 6e22 2b22 5cc5 8622 2e6a 6f69 6e28 6469  n"+"\..".join(di
+00012410: 6666 6572 656e 745f 7061 7468 7329 0a20  fferent_paths). 
+00012420: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00012430: 2020 2020 2020 2020 7365 6c66 2e5f 5f61          self.__a
+00012440: 6c6c 5555 4944 7343 6865 636b 6564 203d  llUUIDsChecked =
+00012450: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+00012460: 2020 7265 7475 726e 2054 7275 652c 2022    return True, "
+00012470: 416c 6c20 696d 6167 6573 2068 6176 6520  All images have 
+00012480: 6120 5555 4944 220a 2020 2020 2020 2020  a UUID".        
+00012490: 7265 7475 726e 2046 616c 7365 2c20 2250  return False, "P
+000124a0: 6174 6820 222b 7365 6c66 2e69 6d61 6765  ath "+self.image
+000124b0: 7344 6972 202b 2022 206e 6f74 2066 6f75  sDir + " not fou
+000124c0: 6e64 2e22 0a0a 2020 2020 6465 6620 6372  nd."..    def cr
+000124d0: 6561 7465 5555 4944 4669 6c65 2873 656c  eateUUIDFile(sel
+000124e0: 662c 636c 6561 6e3d 5472 7565 293a 0a20  f,clean=True):. 
+000124f0: 2020 2020 2020 2022 2222 2044 6570 7265         """ Depre
+00012500: 6361 7465 6420 2d20 7573 6520 6372 6561  cated - use crea
+00012510: 7465 5f75 7569 645f 6669 6c65 2022 2222  te_uuid_file """
+00012520: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00012530: 7365 6c66 2e63 7265 6174 655f 7575 6964  self.create_uuid
+00012540: 5f66 696c 6528 636c 6561 6e29 0a0a 0a20  _file(clean)... 
+00012550: 2020 2064 6566 2073 6574 5f69 6d61 6765     def set_image
+00012560: 5f73 6574 5f61 7474 6974 7564 6528 7365  _set_attitude(se
+00012570: 6c66 2c79 6177 5f66 7261 6d65 3a66 6c6f  lf,yaw_frame:flo
+00012580: 6174 2c70 6974 6368 5f66 7261 6d65 3a66  at,pitch_frame:f
+00012590: 6c6f 6174 2c72 6f6c 6c5f 6672 616d 653a  loat,roll_frame:
+000125a0: 666c 6f61 742c 7961 775f 6361 6d32 6672  float,yaw_cam2fr
+000125b0: 616d 653a 666c 6f61 742c 7069 7463 685f  ame:float,pitch_
+000125c0: 6361 6d32 6672 616d 653a 666c 6f61 742c  cam2frame:float,
+000125d0: 726f 6c6c 5f63 616d 3266 7261 6d65 3a66  roll_cam2frame:f
+000125e0: 6c6f 6174 293a 0a20 2020 2020 2020 2022  loat):.        "
+000125f0: 2222 2063 616c 6375 6c61 7465 7320 7468  "" calculates th
+00012600: 6520 7468 6520 6361 6d65 7261 7320 6162  e the cameras ab
+00012610: 736f 6c75 7465 2061 7474 6974 7564 6520  solute attitude 
+00012620: 616e 6420 7365 7473 2069 7420 746f 2069  and sets it to i
+00012630: 6d61 6765 2073 6574 2068 6561 6465 722e  mage set header.
+00012640: 2041 6c6c 2061 6e67 6c65 7320 6172 6520   All angles are 
+00012650: 6578 7065 6374 6564 2069 6e20 6465 6772  expected in degr
+00012660: 6565 732e 200a 2020 2020 2020 2020 6361  ees. .        ca
+00012670: 6d65 7261 3266 7261 6d65 2061 6e67 6c65  mera2frame angle
+00012680: 733a 2072 6f74 6174 696f 6e20 6f66 2063  s: rotation of c
+00012690: 616d 6572 6120 636f 6f72 6469 6e61 7465  amera coordinate
+000126a0: 7320 2878 2c79 2c7a 203d 2074 6f70 2c20  s (x,y,z = top, 
+000126b0: 7269 6768 742c 206c 696e 6520 6f66 2073  right, line of s
+000126c0: 6967 6874 2920 7769 7468 2072 6573 7065  ight) with respe
+000126d0: 6374 2074 6f20 7665 6869 636c 6520 636f  ct to vehicle co
+000126e0: 6f72 6469 6e61 7465 7320 2878 2c79 2c7a  ordinates (x,y,z
+000126f0: 203d 2066 6f72 7761 7264 2c72 6967 6874   = forward,right
+00012700: 2c64 6f77 6e29 200a 2020 2020 2020 2020  ,down) .        
+00012710: 696e 2061 6363 6f72 6461 6e63 6520 7769  in accordance wi
+00012720: 7468 2074 6865 2079 6177 2c70 6974 6368  th the yaw,pitch
+00012730: 2c72 6f6c 6c20 726f 7461 7469 6f6e 206f  ,roll rotation o
+00012740: 7264 6572 2063 6f6e 7665 6e74 696f 6e3a  rder convention:
+00012750: 0a0a 2020 2020 2020 2020 312e 2079 6177  ..        1. yaw
+00012760: 2061 726f 756e 6420 7a2c 0a20 2020 2020   around z,.     
+00012770: 2020 2032 2e20 7069 7463 6820 6172 6f75     2. pitch arou
+00012780: 6e64 2072 6f74 6174 6564 2079 2c0a 2020  nd rotated y,.  
+00012790: 2020 2020 2020 332e 2072 6f6c 6c20 6172        3. roll ar
+000127a0: 6f75 6e64 2072 6f74 6174 6564 2078 0a0a  ound rotated x..
+000127b0: 2020 2020 2020 2020 526f 7461 7469 6f6e          Rotation
+000127c0: 2064 6972 6563 7469 6f6e 7320 6163 636f   directions acco
+000127d0: 7264 696e 6720 746f 205c 2772 6967 6874  rding to \'right
+000127e0: 2d68 616e 6420 7275 6c65 5c27 2e0a 0a20  -hand rule\'... 
+000127f0: 2020 2020 2020 2049 2e65 2e20 6361 6d65         I.e. came
+00012800: 7261 3246 7261 6d65 2061 6e67 6c65 7320  ra2Frame angles 
+00012810: 3d20 302c 302c 3020 6361 6d65 7261 2069  = 0,0,0 camera i
+00012820: 7320 6661 6369 6e67 2064 6f77 6e77 6172  s facing downwar
+00012830: 6420 7769 7468 2074 6f70 2073 6964 6520  d with top side 
+00012840: 746f 7761 7264 7320 7665 6869 636c 6527  towards vehicle'
+00012850: 7320 666f 7277 6172 6420 6469 7265 6374  s forward direct
+00012860: 696f 6e27 2022 2222 0a0a 2020 2020 2020  ion' """..      
+00012870: 2020 525f 6672 616d 6532 6e65 6420 3d20    R_frame2ned = 
+00012880: 6d69 7174 672e 525f 5961 7750 6974 6368  miqtg.R_YawPitch
+00012890: 526f 6c6c 2879 6177 5f66 7261 6d65 2c70  Roll(yaw_frame,p
+000128a0: 6974 6368 5f66 7261 6d65 2c72 6f6c 6c5f  itch_frame,roll_
+000128b0: 6672 616d 6529 0a20 2020 2020 2020 2052  frame).        R
+000128c0: 5f63 616d 3266 7261 6d65 203d 206d 6971  _cam2frame = miq
+000128d0: 7467 2e52 5f59 6177 5069 7463 6852 6f6c  tg.R_YawPitchRol
+000128e0: 6c28 7961 775f 6361 6d32 6672 616d 652c  l(yaw_cam2frame,
+000128f0: 7069 7463 685f 6361 6d32 6672 616d 652c  pitch_cam2frame,
+00012900: 726f 6c6c 5f63 616d 3266 7261 6d65 290a  roll_cam2frame).
+00012910: 2020 2020 2020 2020 525f 6361 6d32 6e65          R_cam2ne
+00012920: 6420 3d20 525f 6672 616d 6532 6e65 642e  d = R_frame2ned.
+00012930: 646f 7428 525f 6361 6d32 6672 616d 6529  dot(R_cam2frame)
+00012940: 0a20 2020 2020 2020 2079 6177 2c70 6974  .        yaw,pit
+00012950: 6368 2c72 6f6c 6c20 3d20 6d69 7174 672e  ch,roll = miqtg.
+00012960: 7961 7750 6974 6368 526f 6c6c 2852 5f63  yawPitchRoll(R_c
+00012970: 616d 326e 6564 290a 0a20 2020 2020 2020  am2ned)..       
+00012980: 2023 2070 6f73 6520 6d61 7472 6978 2063   # pose matrix c
+00012990: 616d 3275 746d 0a20 2020 2020 2020 2052  am2utm.        R
+000129a0: 5f63 616d 5374 6432 7574 6d20 3d20 7365  _camStd2utm = se
+000129b0: 6c66 2e67 6574 5f52 5f63 616d 5374 6432  lf.get_R_camStd2
+000129c0: 7574 6d28 525f 6361 6d32 6672 616d 652c  utm(R_cam2frame,
+000129d0: 525f 6672 616d 6532 6e65 6429 0a0a 2020  R_frame2ned)..  
+000129e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000129f0: 2020 7820 3d20 6e70 2e61 7272 6179 285b    x = np.array([
+00012a00: 312c 302c 305d 290a 2020 2020 2020 2020  1,0,0]).        
+00012a10: 7920 3d20 6e70 2e61 7272 6179 285b 302c  y = np.array([0,
+00012a20: 312c 305d 290a 2020 2020 2020 2020 7a20  1,0]).        z 
+00012a30: 3d20 6e70 2e61 7272 6179 285b 302c 302c  = np.array([0,0,
+00012a40: 315d 290a 2020 2020 2020 2020 7072 696e  1]).        prin
+00012a50: 7428 2778 272c 525f 6361 6d53 7464 3275  t('x',R_camStd2u
+00012a60: 746d 2e64 6f74 2878 292e 726f 756e 6428  tm.dot(x).round(
+00012a70: 3529 290a 2020 2020 2020 2020 7072 696e  5)).        prin
+00012a80: 7428 2779 272c 525f 6361 6d53 7464 3275  t('y',R_camStd2u
+00012a90: 746d 2e64 6f74 2879 292e 726f 756e 6428  tm.dot(y).round(
+00012aa0: 3529 290a 2020 2020 2020 2020 7072 696e  5)).        prin
+00012ab0: 7428 277a 272c 525f 6361 6d53 7464 3275  t('z',R_camStd2u
+00012ac0: 746d 2e64 6f74 287a 292e 726f 756e 6428  tm.dot(z).round(
+00012ad0: 3529 290a 2020 2020 2020 2020 2222 220a  5)).        """.
+00012ae0: 0a20 2020 2020 2020 2068 6561 6465 7255  .        headerU
+00012af0: 7064 6174 6520 3d20 7b0a 2020 2020 2020  pdate = {.      
+00012b00: 2020 2020 2020 6d69 7174 762e 636f 6c5f        miqtv.col_
+00012b10: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00012b20: 5b27 7961 7727 5d3a 7961 772c 0a20 2020  ['yaw']:yaw,.   
+00012b30: 2020 2020 2020 2020 206d 6971 7476 2e63           miqtv.c
+00012b40: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00012b50: 7427 5d5b 2770 6974 6368 275d 3a70 6974  t']['pitch']:pit
+00012b60: 6368 2c0a 2020 2020 2020 2020 2020 2020  ch,.            
+00012b70: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00012b80: 5b27 6d61 7269 7174 275d 5b27 726f 6c6c  ['mariqt']['roll
+00012b90: 275d 3a72 6f6c 6c2c 0a20 2020 2020 2020  ']:roll,.       
+00012ba0: 2020 2020 206d 6971 7476 2e63 6f6c 5f68       miqtv.col_h
+00012bb0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00012bc0: 2770 6f73 6527 5d3a 7b27 706f 7365 2d61  'pose']:{'pose-a
+00012bd0: 6273 6f6c 7574 652d 6f72 6965 6e74 6174  bsolute-orientat
+00012be0: 696f 6e2d 7574 6d2d 6d61 7472 6978 273a  ion-utm-matrix':
+00012bf0: 525f 6361 6d53 7464 3275 746d 2e66 6c61  R_camStd2utm.fla
+00012c00: 7474 656e 2829 2e74 6f6c 6973 7428 297d  tten().tolist()}
+00012c10: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
+00012c20: 2020 2073 656c 662e 7570 6461 7465 5f69     self.update_i
+00012c30: 6664 6f5f 6865 6164 6572 5f66 6965 6c64  fdo_header_field
+00012c40: 7328 6865 6164 6572 5570 6461 7465 290a  s(headerUpdate).
+00012c50: 0a20 2020 2064 6566 2073 6574 496d 6167  .    def setImag
+00012c60: 6553 6574 4174 7469 7475 6465 2873 656c  eSetAttitude(sel
+00012c70: 662c 7961 775f 6672 616d 653a 666c 6f61  f,yaw_frame:floa
+00012c80: 742c 7069 7463 685f 6672 616d 653a 666c  t,pitch_frame:fl
+00012c90: 6f61 742c 726f 6c6c 5f66 7261 6d65 3a66  oat,roll_frame:f
+00012ca0: 6c6f 6174 2c79 6177 5f63 616d 3266 7261  loat,yaw_cam2fra
+00012cb0: 6d65 3a66 6c6f 6174 2c70 6974 6368 5f63  me:float,pitch_c
+00012cc0: 616d 3266 7261 6d65 3a66 6c6f 6174 2c72  am2frame:float,r
+00012cd0: 6f6c 6c5f 6361 6d32 6672 616d 653a 666c  oll_cam2frame:fl
+00012ce0: 6f61 7429 3a0a 2020 2020 2020 2020 2222  oat):.        ""
+00012cf0: 2220 4465 7072 6563 6174 6564 202d 2075  " Deprecated - u
+00012d00: 7365 2073 6574 5f69 6d61 6765 5f73 6574  se set_image_set
+00012d10: 5f61 7474 6974 7564 6520 2222 220a 2020  _attitude """.  
+00012d20: 2020 2020 2020 7365 6c66 2e73 6574 5f69        self.set_i
+00012d30: 6d61 6765 5f73 6574 5f61 7474 6974 7564  mage_set_attitud
+00012d40: 6528 7961 775f 6672 616d 652c 2070 6974  e(yaw_frame, pit
+00012d50: 6368 5f66 7261 6d65 2c20 726f 6c6c 5f66  ch_frame, roll_f
+00012d60: 7261 6d65 2c20 7961 775f 6361 6d32 6672  rame, yaw_cam2fr
+00012d70: 616d 652c 2070 6974 6368 5f63 616d 3266  ame, pitch_cam2f
+00012d80: 7261 6d65 2c20 726f 6c6c 5f63 616d 3266  rame, roll_cam2f
+00012d90: 7261 6d65 290a 0a0a 2020 2020 6465 6620  rame)...    def 
+00012da0: 6372 6561 7465 5f69 6d61 6765 5f61 7474  create_image_att
+00012db0: 6974 7564 655f 6669 6c65 2873 656c 662c  itude_file(self,
+00012dc0: 2061 7474 5f70 6174 683a 7374 722c 2066   att_path:str, f
+00012dd0: 7261 6d65 5f61 7474 5f68 6561 6465 723a  rame_att_header:
+00012de0: 6469 6374 2c20 6361 6d65 7261 3246 7261  dict, camera2Fra
+00012df0: 6d65 5f79 6177 3a66 6c6f 6174 2c63 616d  me_yaw:float,cam
+00012e00: 6572 6132 4672 616d 655f 7069 7463 683a  era2Frame_pitch:
+00012e10: 666c 6f61 742c 6361 6d65 7261 3246 7261  float,camera2Fra
+00012e20: 6d65 5f72 6f6c 6c3a 666c 6f61 742c 0a20  me_roll:float,. 
+00012e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e40: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00012e50: 6174 655f 666f 726d 6174 3d6d 6971 7476  ate_format=miqtv
+00012e60: 2e64 6174 655f 666f 726d 6174 735b 2770  .date_formats['p
+00012e70: 616e 6761 6561 275d 2c20 636f 6e73 745f  angaea'], const_
+00012e80: 7661 6c75 6573 203d 207b 7d2c 206f 7665  values = {}, ove
+00012e90: 7277 7269 7465 3d46 616c 7365 2c20 636f  rwrite=False, co
+00012ea0: 6c5f 7365 7061 7261 746f 7220 3d20 225c  l_separator = "\
+00012eb0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
+00012ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ed0: 2020 2020 6174 745f 7061 7468 5f61 6e67      att_path_ang
+00012ee0: 6c65 735f 696e 5f72 6164 203d 2046 616c  les_in_rad = Fal
+00012ef0: 7365 2c20 7669 6465 6f53 616d 706c 6553  se, videoSampleS
+00012f00: 6563 6f6e 6473 3d31 2c72 6563 6f72 6473  econds=1,records
+00012f10: 3262 6549 6e76 6572 7465 643d 5b5d 293a  2beInverted=[]):
+00012f20: 0a20 2020 2020 2020 2022 2222 2043 7265  .        """ Cre
+00012f30: 6174 6573 2069 6e20 2f69 6e74 6572 6d65  ates in /interme
+00012f40: 6469 6174 6520 6120 7465 7874 2066 696c  diate a text fil
+00012f50: 6520 7769 7468 2063 616d 6572 6120 6174  e with camera at
+00012f60: 7469 7475 6465 2064 6174 6120 666f 7220  titude data for 
+00012f70: 6561 6368 2069 6d61 6765 2e20 416c 6c20  each image. All 
+00012f80: 616e 676c 6573 2061 7265 2065 7870 6563  angles are expec
+00012f90: 7465 6420 696e 2064 6567 7265 6573 2e20  ted in degrees. 
+00012fa0: 5573 6520 6174 745f 7061 7468 5f61 6e67  Use att_path_ang
+00012fb0: 6c65 735f 696e 5f72 6164 2069 6620 6e65  les_in_rad if ne
+00012fc0: 6365 7373 6172 792e 200a 2020 2020 2020  cessary. .      
+00012fd0: 2020 6361 6d65 7261 3246 7261 6d65 2061    camera2Frame a
+00012fe0: 6e67 6c65 733a 2072 6f74 6174 696f 6e20  ngles: rotation 
+00012ff0: 6f66 2063 616d 6572 6120 636f 6f72 6469  of camera coordi
+00013000: 6e61 7465 7320 2878 2c79 2c7a 203d 2074  nates (x,y,z = t
+00013010: 6f70 2c20 7269 6768 742c 206c 696e 6520  op, right, line 
+00013020: 6f66 2073 6967 6874 2920 7769 7468 2072  of sight) with r
+00013030: 6573 7065 6374 2074 6f20 7665 6869 636c  espect to vehicl
+00013040: 6520 636f 6f72 6469 6e61 7465 7320 2878  e coordinates (x
+00013050: 2c79 2c7a 203d 2066 6f72 7761 7264 2c72  ,y,z = forward,r
+00013060: 6967 6874 2c64 6f77 6e29 200a 2020 2020  ight,down) .    
+00013070: 2020 2020 696e 2061 6363 6f72 6461 6e63      in accordanc
+00013080: 6520 7769 7468 2074 6865 2079 6177 2c70  e with the yaw,p
+00013090: 6974 6368 2c72 6f6c 6c20 726f 7461 7469  itch,roll rotati
+000130a0: 6f6e 206f 7264 6572 2063 6f6e 7665 6e74  on order convent
+000130b0: 696f 6e3a 0a20 2020 2020 2020 2031 2e20  ion:.        1. 
+000130c0: 7961 7720 6172 6f75 6e64 207a 2c0a 2020  yaw around z,.  
+000130d0: 2020 2020 2020 322e 2070 6974 6368 2061        2. pitch a
+000130e0: 726f 756e 6420 726f 7461 7465 6420 792c  round rotated y,
+000130f0: 0a20 2020 2020 2020 2033 2e20 726f 6c6c  .        3. roll
+00013100: 2061 726f 756e 6420 726f 7461 7465 6420   around rotated 
+00013110: 780a 0a20 2020 2020 2020 2052 6f74 6174  x..        Rotat
+00013120: 696f 6e20 6469 7265 6374 696f 6e73 2061  ion directions a
+00013130: 6363 6f72 6469 6e67 2074 6f20 5c27 7269  ccording to \'ri
+00013140: 6768 742d 6861 6e64 2072 756c 655c 272e  ght-hand rule\'.
+00013150: 0a0a 2020 2020 2020 2020 492e 652e 2063  ..        I.e. c
+00013160: 616d 6572 6132 4672 616d 6520 616e 676c  amera2Frame angl
+00013170: 6573 203d 2030 2c30 2c30 2063 616d 6572  es = 0,0,0 camer
+00013180: 6120 6973 2066 6163 696e 6720 646f 776e  a is facing down
+00013190: 7761 7264 2077 6974 6820 746f 7020 7369  ward with top si
+000131a0: 6465 2074 6f77 6172 6473 2076 6568 6963  de towards vehic
+000131b0: 6c65 2773 2066 6f72 7761 7264 2064 6972  le's forward dir
+000131c0: 6563 7469 6f6e 2720 2222 220a 0a20 2020  ection' """..   
+000131d0: 2020 2020 2069 6e74 5f61 7474 7574 7564       int_attutud
+000131e0: 655f 6669 6c65 203d 2073 656c 662e 5f5f  e_file = self.__
+000131f0: 6765 745f 696e 745f 6669 6c65 5f70 7265  get_int_file_pre
+00013200: 6669 7828 2920 2b20 275f 696d 6167 652d  fix() + '_image-
+00013210: 6174 7469 7475 6465 2e74 7874 270a 2020  attitude.txt'.  
+00013220: 2020 2020 2020 6f75 7470 7574 5f68 6561        output_hea
+00013230: 6465 725f 6174 7420 3d20 7b20 2020 6d69  der_att = {   mi
+00013240: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00013250: 6d61 7269 7174 275d 5b27 696d 6727 5d3a  mariqt']['img']:
+00013260: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
+00013270: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
+00013280: 6727 5d2c 0a20 2020 2020 2020 2020 2020  g'],.           
+00013290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000132a0: 2020 2020 206d 6971 7476 2e63 6f6c 5f68       miqtv.col_h
+000132b0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+000132c0: 2775 7463 275d 3a6d 6971 7476 2e63 6f6c  'utc']:miqtv.col
+000132d0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+000132e0: 5d5b 2775 7463 275d 2c0a 2020 2020 2020  ]['utc'],.      
+000132f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013300: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
+00013310: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00013320: 7174 275d 5b27 7961 7727 5d3a 6d69 7174  qt']['yaw']:miqt
+00013330: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00013340: 7269 7174 275d 5b27 7961 7727 5d2c 0a20  riqt']['yaw'],. 
+00013350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013360: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00013370: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00013380: 276d 6172 6971 7427 5d5b 2770 6974 6368  'mariqt']['pitch
+00013390: 275d 3a6d 6971 7476 2e63 6f6c 5f68 6561  ']:miqtv.col_hea
+000133a0: 6465 725b 276d 6172 6971 7427 5d5b 2770  der['mariqt']['p
+000133b0: 6974 6368 275d 2c0a 2020 2020 2020 2020  itch'],.        
+000133c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133d0: 2020 2020 2020 2020 6d69 7174 762e 636f          miqtv.co
+000133e0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+000133f0: 275d 5b27 726f 6c6c 275d 3a6d 6971 7476  ']['roll']:miqtv
+00013400: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00013410: 6971 7427 5d5b 2772 6f6c 6c27 5d2c 0a20  iqt']['roll'],. 
+00013420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013430: 2020 2020 2020 2020 2020 207d 0a0a 2020             }..  
+00013440: 2020 2020 2020 696e 745f 706f 7365 5f66        int_pose_f
+00013450: 696c 6520 3d20 7365 6c66 2e5f 5f67 6574  ile = self.__get
+00013460: 5f69 6e74 5f66 696c 655f 7072 6566 6978  _int_file_prefix
+00013470: 2829 202b 2027 5f69 6d61 6765 2d63 616d  () + '_image-cam
+00013480: 6572 612d 706f 7365 2e74 7874 270a 2020  era-pose.txt'.  
+00013490: 2020 2020 2020 6f75 7470 7574 5f68 6561        output_hea
+000134a0: 6465 725f 706f 7365 203d 207b 2020 6d69  der_pose = {  mi
+000134b0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+000134c0: 6d61 7269 7174 275d 5b27 696d 6727 5d3a  mariqt']['img']:
+000134d0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+000134e0: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+000134f0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00013500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013510: 2020 206d 6971 7476 2e63 6f6c 5f68 6561     miqtv.col_hea
+00013520: 6465 725b 276d 6172 6971 7427 5d5b 2775  der['mariqt']['u
+00013530: 7463 275d 3a6d 6971 7476 2e63 6f6c 5f68  tc']:miqtv.col_h
+00013540: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00013550: 2775 7463 275d 2c0a 2020 2020 2020 2020  'utc'],.        
+00013560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013570: 2020 2020 2020 2020 6d69 7174 762e 636f          miqtv.co
+00013580: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00013590: 275d 5b27 706f 7365 275d 3a6d 6971 7476  ']['pose']:miqtv
+000135a0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+000135b0: 6971 7427 5d5b 2770 6f73 6527 5d2c 0a20  iqt']['pose'],. 
+000135c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000135d0: 2020 2020 2020 2020 2020 207d 0a0a 2020             }..  
+000135e0: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+000135f0: 2e65 7869 7374 7328 696e 745f 6174 7475  .exists(int_attu
+00013600: 7475 6465 5f66 696c 6529 2061 6e64 206e  tude_file) and n
+00013610: 6f74 206f 7665 7277 7269 7465 3a0a 2020  ot overwrite:.  
+00013620: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00013630: 6464 5f69 7465 6d5f 696e 666f 5f74 6162  dd_item_info_tab
+00013640: 5f66 696c 6528 696e 745f 6174 7475 7475  _file(int_attutu
+00013650: 6465 5f66 696c 652c 225c 7422 2c6f 7574  de_file,"\t",out
+00013660: 7075 745f 6865 6164 6572 5f61 7474 290a  put_header_att).
+00013670: 2020 2020 2020 2020 2020 2020 6578 7472              extr
+00013680: 615f 6d73 6720 3d20 2222 0a20 2020 2020  a_msg = "".     
+00013690: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+000136a0: 682e 6578 6973 7473 2869 6e74 5f70 6f73  h.exists(int_pos
+000136b0: 655f 6669 6c65 293a 0a20 2020 2020 2020  e_file):.       
+000136c0: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
+000136d0: 645f 6974 656d 5f69 6e66 6f5f 7461 625f  d_item_info_tab_
+000136e0: 6669 6c65 2869 6e74 5f70 6f73 655f 6669  file(int_pose_fi
+000136f0: 6c65 2c22 5c74 222c 6f75 7470 7574 5f68  le,"\t",output_h
+00013700: 6561 6465 725f 706f 7365 290a 2020 2020  eader_pose).    
+00013710: 2020 2020 2020 2020 2020 2020 6578 7472              extr
+00013720: 615f 6d73 6720 3d20 222c 2022 202b 2069  a_msg = ", " + i
+00013730: 6e74 5f70 6f73 655f 6669 6c65 0a20 2020  nt_pose_file.   
+00013740: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00013750: 5472 7565 2c20 224f 7574 7075 7420 6669  True, "Output fi
+00013760: 6c65 2065 7869 7374 733a 2022 2b69 6e74  le exists: "+int
+00013770: 5f61 7474 7574 7564 655f 6669 6c65 202b  _attutude_file +
+00013780: 2065 7874 7261 5f6d 7367 0a0a 2020 2020   extra_msg..    
+00013790: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+000137a0: 7468 2e65 7869 7374 7328 6174 745f 7061  th.exists(att_pa
+000137b0: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
+000137c0: 2072 6574 7572 6e20 4661 6c73 652c 2022   return False, "
+000137d0: 4174 7469 7475 6465 2066 696c 6520 6e6f  Attitude file no
+000137e0: 7420 666f 756e 643a 2022 2b61 7474 5f70  t found: "+att_p
+000137f0: 6174 680a 0a20 2020 2020 2020 2069 6620  ath..        if 
+00013800: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+00013810: 7473 2873 656c 662e 696d 6167 6573 4469  ts(self.imagesDi
+00013820: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00013830: 7265 7475 726e 2046 616c 7365 2c20 2249  return False, "I
+00013840: 6d61 6765 2066 6f6c 6465 7220 6e6f 7420  mage folder not 
+00013850: 666f 756e 643a 2022 2b20 7365 6c66 2e69  found: "+ self.i
+00013860: 6d61 6765 7344 6972 0a0a 2020 2020 2020  magesDir..      
+00013870: 2020 7320 3d20 6d69 7174 632e 5072 696e    s = miqtc.Prin
+00013880: 744c 6f61 6469 6e67 4d73 6728 2243 7265  tLoadingMsg("Cre
+00013890: 6174 696e 6720 6974 656d 7327 2061 7474  ating items' att
+000138a0: 6974 7564 6520 6461 7461 2229 0a0a 2020  itude data")..  
+000138b0: 2020 2020 2020 2320 6c6f 6164 2066 7261        # load fra
+000138c0: 6d65 2061 7474 6974 7564 6520 6461 7461  me attitude data
+000138d0: 2066 726f 6d20 6669 6c65 0a20 2020 2020   from file.     
+000138e0: 2020 2061 7474 5f64 6174 612c 2070 6172     att_data, par
+000138f0: 7365 4d73 6720 3d20 6d69 7174 6e2e 7265  seMsg = miqtn.re
+00013900: 6164 416c 6c41 7474 6974 7564 6573 4672  adAllAttitudesFr
+00013910: 6f6d 4669 6c65 5061 7468 2861 7474 5f70  omFilePath(att_p
+00013920: 6174 682c 2066 7261 6d65 5f61 7474 5f68  ath, frame_att_h
+00013930: 6561 6465 722c 2064 6174 655f 666f 726d  eader, date_form
+00013940: 6174 2c63 6f6c 5f73 6570 6172 6174 6f72  at,col_separator
+00013950: 3d63 6f6c 5f73 6570 6172 6174 6f72 2c63  =col_separator,c
+00013960: 6f6e 7374 5f76 616c 7565 733d 636f 6e73  onst_values=cons
+00013970: 745f 7661 6c75 6573 2c61 6e67 6c65 7349  t_values,anglesI
+00013980: 6e52 6164 3d61 7474 5f70 6174 685f 616e  nRad=att_path_an
+00013990: 676c 6573 5f69 6e5f 7261 6429 0a20 2020  gles_in_rad).   
+000139a0: 2020 2020 2069 6620 7061 7273 654d 7367       if parseMsg
+000139b0: 2021 3d20 2222 3a0a 2020 2020 2020 2020   != "":.        
+000139c0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+000139d0: 6728 7061 7273 654d 7367 2c64 6f6e 7453  g(parseMsg,dontS
+000139e0: 686f 773d 5472 7565 290a 2020 2020 2020  how=True).      
+000139f0: 2020 2020 2020 7061 7273 654d 7367 203d        parseMsg =
+00013a00: 2022 5c6e 2220 2b20 7061 7273 654d 7367   "\n" + parseMsg
+00013a10: 0a0a 2020 2020 2020 2020 2320 6669 6e64  ..        # find
+00013a20: 2066 6f72 2065 6163 6820 696d 6167 6520   for each image 
+00013a30: 7468 6520 7265 7370 6563 7469 7665 206e  the respective n
+00013a40: 6176 6967 6174 696f 6e20 6461 7461 0a20  avigation data. 
+00013a50: 2020 2020 2020 2073 2e73 746f 7028 290a         s.stop().
+00013a60: 2020 2020 2020 2020 7375 6363 6573 732c          success,
+00013a70: 2069 6d61 6765 5f64 7473 2c20 6d73 6720   image_dts, msg 
+00013a80: 3d20 7365 6c66 2e66 696e 644e 6176 4461  = self.findNavDa
+00013a90: 7461 466f 7249 6d61 6765 2861 7474 5f64  taForImage(att_d
+00013aa0: 6174 612c 7669 6465 6f53 616d 706c 6553  ata,videoSampleS
+00013ab0: 6563 6f6e 6473 290a 2020 2020 2020 2020  econds).        
+00013ac0: 6966 206e 6f74 2073 7563 6365 7373 3a0a  if not success:.
+00013ad0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00013ae0: 726e 2046 616c 7365 2c20 6d73 6720 2b20  rn False, msg + 
+00013af0: 7061 7273 654d 7367 0a20 2020 2020 2020  parseMsg.       
+00013b00: 2073 203d 206d 6971 7463 2e50 7269 6e74   s = miqtc.Print
+00013b10: 4c6f 6164 696e 674d 7367 2822 4372 6561  LoadingMsg("Crea
+00013b20: 7469 6e67 2069 7465 6d73 2720 6174 7469  ting items' atti
+00013b30: 7475 6465 2064 6174 6122 290a 0a20 2020  tude data")..   
+00013b40: 2020 2020 2023 2061 6464 2063 616d 6572       # add camer
+00013b50: 6132 4672 616d 6520 616e 676c 6573 0a20  a2Frame angles. 
+00013b60: 2020 2020 2020 2052 5f63 616d 3266 7261         R_cam2fra
+00013b70: 6d65 203d 206d 6971 7467 2e52 5f59 6177  me = miqtg.R_Yaw
+00013b80: 5069 7463 6852 6f6c 6c28 6361 6d65 7261  PitchRoll(camera
+00013b90: 3246 7261 6d65 5f79 6177 2c63 616d 6572  2Frame_yaw,camer
+00013ba0: 6132 4672 616d 655f 7069 7463 682c 6361  a2Frame_pitch,ca
+00013bb0: 6d65 7261 3246 7261 6d65 5f72 6f6c 6c29  mera2Frame_roll)
+00013bc0: 0a20 2020 2020 2020 2052 5f63 616d 3275  .        R_cam2u
+00013bd0: 746d 5f6c 6973 7420 3d20 5b5d 0a20 2020  tm_list = [].   
+00013be0: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
+00013bf0: 2069 6d61 6765 5f64 7473 3a0a 2020 2020   image_dts:.    
+00013c00: 2020 2020 2020 2020 666f 7220 7469 6d65          for time
+00013c10: 706f 696e 7420 696e 2069 6d61 6765 5f64  point in image_d
+00013c20: 7473 5b66 696c 655d 3a0a 2020 2020 2020  ts[file]:.      
+00013c30: 2020 2020 2020 2020 2020 6174 7469 7475            attitu
+00013c40: 6465 203d 2074 696d 6570 6f69 6e74 0a20  de = timepoint. 
+00013c50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00013c60: 6620 6174 7469 7475 6465 2e79 6177 2069  f attitude.yaw i
+00013c70: 7320 4e6f 6e65 206f 7220 6174 7469 7475  s None or attitu
+00013c80: 6465 2e70 6974 6368 2069 7320 4e6f 6e65  de.pitch is None
+00013c90: 206f 7220 6174 7469 7475 6465 2e72 6f6c   or attitude.rol
+00013ca0: 6c20 6973 204e 6f6e 653a 0a20 2020 2020  l is None:.     
+00013cb0: 2020 2020 2020 2020 2020 2020 2020 2052                 R
+00013cc0: 5f63 616d 3275 746d 5f6c 6973 742e 6170  _cam2utm_list.ap
+00013cd0: 7065 6e64 2822 2229 0a20 2020 2020 2020  pend("").       
+00013ce0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00013cf0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+00013d00: 2020 2020 2020 525f 6672 616d 6532 6e65        R_frame2ne
+00013d10: 6420 3d20 6d69 7174 672e 525f 5961 7750  d = miqtg.R_YawP
+00013d20: 6974 6368 526f 6c6c 2861 7474 6974 7564  itchRoll(attitud
+00013d30: 652e 7961 772c 6174 7469 7475 6465 2e70  e.yaw,attitude.p
+00013d40: 6974 6368 2c61 7474 6974 7564 652e 726f  itch,attitude.ro
+00013d50: 6c6c 290a 2020 2020 2020 2020 2020 2020  ll).            
+00013d60: 2020 2020 525f 6361 6d32 6e65 6420 3d20      R_cam2ned = 
+00013d70: 525f 6672 616d 6532 6e65 642e 646f 7428  R_frame2ned.dot(
+00013d80: 525f 6361 6d32 6672 616d 6529 0a20 2020  R_cam2frame).   
+00013d90: 2020 2020 2020 2020 2020 2020 2079 6177               yaw
+00013da0: 2c70 6974 6368 2c72 6f6c 6c20 3d20 6d69  ,pitch,roll = mi
+00013db0: 7174 672e 7961 7750 6974 6368 526f 6c6c  qtg.yawPitchRoll
+00013dc0: 2852 5f63 616d 326e 6564 290a 2020 2020  (R_cam2ned).    
+00013dd0: 2020 2020 2020 2020 2020 2020 6174 7469              atti
+00013de0: 7475 6465 2e79 6177 203d 2079 6177 0a20  tude.yaw = yaw. 
+00013df0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00013e00: 7474 6974 7564 652e 7069 7463 6820 3d20  ttitude.pitch = 
+00013e10: 7069 7463 680a 2020 2020 2020 2020 2020  pitch.          
+00013e20: 2020 2020 2020 6174 7469 7475 6465 2e72        attitude.r
+00013e30: 6f6c 6c20 3d20 726f 6c6c 0a0a 2020 2020  oll = roll..    
+00013e40: 2020 2020 2020 2020 2020 2020 525f 6361              R_ca
+00013e50: 6d53 7464 3275 746d 203d 2073 656c 662e  mStd2utm = self.
+00013e60: 6765 745f 525f 6361 6d53 7464 3275 746d  get_R_camStd2utm
+00013e70: 2852 5f63 616d 3266 7261 6d65 2c52 5f66  (R_cam2frame,R_f
+00013e80: 7261 6d65 326e 6564 290a 2020 2020 2020  rame2ned).      
+00013e90: 2020 2020 2020 2020 2020 525f 6361 6d32            R_cam2
+00013ea0: 7574 6d5f 6c69 7374 2e61 7070 656e 6428  utm_list.append(
+00013eb0: 525f 6361 6d53 7464 3275 746d 2e66 6c61  R_camStd2utm.fla
+00013ec0: 7474 656e 2829 2e74 6f6c 6973 7428 2929  tten().tolist())
+00013ed0: 0a0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00013ee0: 726f 762e 6c6f 6728 2261 7070 6c69 6564  rov.log("applied
+00013ef0: 2066 7261 6d65 2074 6f20 6361 6d65 7261   frame to camera
+00013f00: 2072 6f74 6174 696f 6e20 7961 772c 7069   rotation yaw,pi
+00013f10: 7463 682c 726f 6c6c 203d 2022 202b 2073  tch,roll = " + s
+00013f20: 7472 2863 616d 6572 6132 4672 616d 655f  tr(camera2Frame_
+00013f30: 7961 7729 202b 2022 2c22 202b 2073 7472  yaw) + "," + str
+00013f40: 2863 616d 6572 6132 4672 616d 655f 7069  (camera2Frame_pi
+00013f50: 7463 6829 202b 2022 2c22 202b 2073 7472  tch) + "," + str
+00013f60: 2863 616d 6572 6132 4672 616d 655f 726f  (camera2Frame_ro
+00013f70: 6c6c 292c 646f 6e74 5368 6f77 3d54 7275  ll),dontShow=Tru
+00013f80: 6529 0a0a 2020 2020 2020 2020 6966 206c  e)..        if l
+00013f90: 656e 2869 6d61 6765 5f64 7473 2920 3e20  en(image_dts) > 
+00013fa0: 303a 0a0a 2020 2020 2020 2020 2020 2020  0:..            
+00013fb0: 2320 5772 6974 6520 746f 206e 6176 6967  # Write to navig
+00013fc0: 6174 696f 6e20 7478 7420 6669 6c65 0a20  ation txt file. 
+00013fd0: 2020 2020 2020 2020 2020 2023 2068 6561             # hea
+00013fe0: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
+00013ff0: 7265 7320 3d20 6f70 656e 2869 6e74 5f61  res = open(int_a
+00014000: 7474 7574 7564 655f 6669 6c65 2c20 2277  ttutude_file, "w
+00014010: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+00014020: 6573 2e77 7269 7465 286d 6971 7476 2e63  es.write(miqtv.c
+00014030: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00014040: 7427 5d5b 2769 6d67 275d 2b22 5c74 222b  t']['img']+"\t"+
+00014050: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00014060: 5b27 6d61 7269 7174 275d 5b27 7574 6327  ['mariqt']['utc'
+00014070: 5d29 0a20 2020 2020 2020 2020 2020 2072  ]).            r
+00014080: 6573 2e77 7269 7465 2822 5c74 222b 6d69  es.write("\t"+mi
+00014090: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+000140a0: 6d61 7269 7174 275d 5b27 7961 7727 5d29  mariqt']['yaw'])
+000140b0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+000140c0: 2e77 7269 7465 2822 5c74 222b 6d69 7174  .write("\t"+miqt
+000140d0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+000140e0: 7269 7174 275d 5b27 7069 7463 6827 5d29  riqt']['pitch'])
+000140f0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00014100: 2e77 7269 7465 2822 5c74 222b 6d69 7174  .write("\t"+miqt
+00014110: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00014120: 7269 7174 275d 5b27 726f 6c6c 275d 290a  riqt']['roll']).
+00014130: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00014140: 2e77 7269 7465 2822 5c6e 2229 0a20 2020  .write("\n").   
+00014150: 2020 2020 2020 2020 2023 2064 6174 6120           # data 
+00014160: 6c69 6e65 730a 2020 2020 2020 2020 2020  lines.          
+00014170: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
+00014180: 6167 655f 6474 733a 0a20 2020 2020 2020  age_dts:.       
+00014190: 2020 2020 2020 2020 2066 6f72 2074 696d           for tim
+000141a0: 6570 6f69 6e74 2069 6e20 696d 6167 655f  epoint in image_
+000141b0: 6474 735b 6669 6c65 5d3a 0a20 2020 2020  dts[file]:.     
+000141c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000141d0: 6573 2e77 7269 7465 2866 696c 652b 225c  es.write(file+"\
+000141e0: 7422 2b74 696d 6570 6f69 6e74 2e64 6174  t"+timepoint.dat
+000141f0: 6554 696d 6528 292e 7374 7266 7469 6d65  eTime().strftime
+00014200: 286d 6971 7476 2e64 6174 655f 666f 726d  (miqtv.date_form
+00014210: 6174 735b 276d 6172 6971 7427 5d29 2920  ats['mariqt'])) 
+00014220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014230: 2020 2020 2076 616c 203d 2074 696d 6570       val = timep
+00014240: 6f69 6e74 2e79 6177 0a20 2020 2020 2020  oint.yaw.       
+00014250: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00014260: 2779 6177 2720 696e 2072 6563 6f72 6473  'yaw' in records
+00014270: 3262 6549 6e76 6572 7465 643a 0a20 2020  2beInverted:.   
+00014280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014290: 2020 2020 2076 616c 202a 3d20 2d31 0a20       val *= -1. 
+000142a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142b0: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
+000142c0: 222b 7374 7228 7661 6c29 290a 2020 2020  "+str(val)).    
+000142d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142e0: 7661 6c20 3d20 7469 6d65 706f 696e 742e  val = timepoint.
+000142f0: 7069 7463 680a 2020 2020 2020 2020 2020  pitch.          
+00014300: 2020 2020 2020 2020 2020 6966 2027 7069            if 'pi
+00014310: 7463 6827 2069 6e20 7265 636f 7264 7332  tch' in records2
+00014320: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
+00014330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014340: 2020 2020 7661 6c20 2a3d 202d 310a 2020      val *= -1.  
+00014350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014360: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
+00014370: 2b73 7472 2876 616c 2929 0a20 2020 2020  +str(val)).     
+00014380: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00014390: 616c 203d 2074 696d 6570 6f69 6e74 2e72  al = timepoint.r
+000143a0: 6f6c 6c0a 2020 2020 2020 2020 2020 2020  oll.            
+000143b0: 2020 2020 2020 2020 6966 2027 726f 6c6c          if 'roll
+000143c0: 2720 696e 2072 6563 6f72 6473 3262 6549  ' in records2beI
+000143d0: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
+000143e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000143f0: 2076 616c 202a 3d20 2d31 0a20 2020 2020   val *= -1.     
+00014400: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00014410: 6573 2e77 7269 7465 2822 5c74 222b 7374  es.write("\t"+st
+00014420: 7228 7661 6c29 290a 2020 2020 2020 2020  r(val)).        
+00014430: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00014440: 7772 6974 6528 225c 6e22 290a 2020 2020  write("\n").    
+00014450: 2020 2020 2020 2020 7265 732e 636c 6f73          res.clos
+00014460: 6528 290a 0a20 2020 2020 2020 2020 2020  e()..           
+00014470: 2073 656c 662e 7072 6f76 2e61 6464 4172   self.prov.addAr
+00014480: 6775 6d65 6e74 2822 696e 7075 7441 7474  gument("inputAtt
+00014490: 6974 7564 6546 696c 6522 2c61 7474 5f70  itudeFile",att_p
+000144a0: 6174 682c 6f76 6572 7772 6974 653d 5472  ath,overwrite=Tr
+000144b0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+000144c0: 7365 6c66 2e70 726f 762e 6c6f 6728 2270  self.prov.log("p
+000144d0: 6172 7365 6420 6672 6f6d 2069 6e70 7574  arsed from input
+000144e0: 4174 7469 7475 6465 4669 6c65 3a20 2220  AttitudeFile: " 
+000144f0: 2b20 7374 7228 6672 616d 655f 6174 745f  + str(frame_att_
+00014500: 6865 6164 6572 292c 646f 6e74 5368 6f77  header),dontShow
+00014510: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00014520: 2020 2073 656c 662e 6164 645f 6974 656d     self.add_item
+00014530: 5f69 6e66 6f5f 7461 625f 6669 6c65 2869  _info_tab_file(i
+00014540: 6e74 5f61 7474 7574 7564 655f 6669 6c65  nt_attutude_file
+00014550: 2c22 5c74 222c 6f75 7470 7574 5f68 6561  ,"\t",output_hea
+00014560: 6465 725f 6174 7429 0a0a 2020 2020 2020  der_att)..      
+00014570: 2020 2020 2020 2320 5772 6974 6520 746f        # Write to
+00014580: 2070 6f73 6520 7478 7420 6669 6c65 0a20   pose txt file. 
+00014590: 2020 2020 2020 2020 2020 2023 2068 6561             # hea
+000145a0: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
+000145b0: 7265 7320 3d20 6f70 656e 2869 6e74 5f70  res = open(int_p
+000145c0: 6f73 655f 6669 6c65 2c20 2277 2229 0a20  ose_file, "w"). 
+000145d0: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+000145e0: 7269 7465 286d 6971 7476 2e63 6f6c 5f68  rite(miqtv.col_h
+000145f0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00014600: 2769 6d67 275d 2b22 5c74 222b 6d69 7174  'img']+"\t"+miqt
+00014610: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00014620: 7269 7174 275d 5b27 7574 6327 5d29 0a20  riqt']['utc']). 
+00014630: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+00014640: 7269 7465 2822 5c74 222b 6d69 7174 762e  rite("\t"+miqtv.
+00014650: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00014660: 7174 275d 5b27 706f 7365 275d 290a 2020  qt']['pose']).  
+00014670: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00014680: 6974 6528 225c 6e22 290a 2020 2020 2020  ite("\n").      
+00014690: 2020 2020 2020 2320 6461 7461 206c 696e        # data lin
+000146a0: 6573 0a20 2020 2020 2020 2020 2020 2069  es.            i
+000146b0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+000146c0: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
+000146d0: 6765 5f64 7473 3a0a 2020 2020 2020 2020  ge_dts:.        
+000146e0: 2020 2020 2020 2020 666f 7220 7469 6d65          for time
+000146f0: 706f 696e 7420 696e 2069 6d61 6765 5f64  point in image_d
+00014700: 7473 5b66 696c 655d 3a0a 2020 2020 2020  ts[file]:.      
+00014710: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00014720: 2052 5f63 616d 3275 746d 5f6c 6973 745b   R_cam2utm_list[
+00014730: 695d 203d 3d20 2222 3a0a 2020 2020 2020  i] == "":.      
+00014740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014750: 2020 6920 2b3d 2031 0a20 2020 2020 2020    i += 1.       
+00014760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014770: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+00014780: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00014790: 732e 7772 6974 6528 6669 6c65 2b22 5c74  s.write(file+"\t
+000147a0: 222b 7469 6d65 706f 696e 742e 6461 7465  "+timepoint.date
+000147b0: 5469 6d65 2829 2e73 7472 6674 696d 6528  Time().strftime(
+000147c0: 6d69 7174 762e 6461 7465 5f66 6f72 6d61  miqtv.date_forma
+000147d0: 7473 5b27 6d61 7269 7174 275d 2929 200a  ts['mariqt'])) .
+000147e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147f0: 2020 2020 656e 7472 7920 3d20 7374 7228      entry = str(
+00014800: 7b27 706f 7365 2d61 6273 6f6c 7574 652d  {'pose-absolute-
+00014810: 6f72 6965 6e74 6174 696f 6e2d 7574 6d2d  orientation-utm-
+00014820: 6d61 7472 6978 273a 525f 6361 6d32 7574  matrix':R_cam2ut
+00014830: 6d5f 6c69 7374 5b69 5d7d 292e 7265 706c  m_list[i]}).repl
+00014840: 6163 6528 275c 6e27 2c27 2729 0a20 2020  ace('\n','').   
+00014850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014860: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
+00014870: 656e 7472 7929 0a20 2020 2020 2020 2020  entry).         
+00014880: 2020 2020 2020 2020 2020 2069 202b 3d20             i += 
+00014890: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+000148a0: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+000148b0: 225c 6e22 290a 2020 2020 2020 2020 2020  "\n").          
+000148c0: 2020 7265 732e 636c 6f73 6528 290a 2020    res.close().  
+000148d0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000148e0: 6464 5f69 7465 6d5f 696e 666f 5f74 6162  dd_item_info_tab
+000148f0: 5f66 696c 6528 696e 745f 706f 7365 5f66  _file(int_pose_f
+00014900: 696c 652c 225c 7422 2c6f 7574 7075 745f  ile,"\t",output_
+00014910: 6865 6164 6572 5f70 6f73 6529 0a20 2020  header_pose).   
+00014920: 2020 2020 2020 2020 2073 2e73 746f 7028           s.stop(
+00014930: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00014940: 7475 726e 2054 7275 652c 2022 4174 7469  turn True, "Atti
+00014950: 7475 6465 2064 6174 6120 6372 6561 7465  tude data create
+00014960: 6422 202b 2070 6172 7365 4d73 670a 2020  d" + parseMsg.  
+00014970: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00014980: 2020 2020 2020 2020 732e 7374 6f70 2829          s.stop()
+00014990: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000149a0: 7572 6e20 4661 6c73 652c 2022 4e6f 2069  urn False, "No i
+000149b0: 6d61 6765 2061 7474 6974 7564 6573 2066  mage attitudes f
+000149c0: 6f75 6e64 2220 2b20 7061 7273 654d 7367  ound" + parseMsg
+000149d0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+000149e0: 2020 0a20 2020 2064 6566 2063 7265 6174    .    def creat
+000149f0: 6549 6d61 6765 4174 7469 7475 6465 4669  eImageAttitudeFi
+00014a00: 6c65 2873 656c 662c 2061 7474 5f70 6174  le(self, att_pat
+00014a10: 683a 7374 722c 2066 7261 6d65 5f61 7474  h:str, frame_att
+00014a20: 5f68 6561 6465 723a 6469 6374 2c20 6361  _header:dict, ca
+00014a30: 6d65 7261 3246 7261 6d65 5f79 6177 3a66  mera2Frame_yaw:f
+00014a40: 6c6f 6174 2c63 616d 6572 6132 4672 616d  loat,camera2Fram
+00014a50: 655f 7069 7463 683a 666c 6f61 742c 6361  e_pitch:float,ca
+00014a60: 6d65 7261 3246 7261 6d65 5f72 6f6c 6c3a  mera2Frame_roll:
+00014a70: 666c 6f61 742c 0a20 2020 2020 2020 2020  float,.         
+00014a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a90: 2020 2020 2020 2064 6174 655f 666f 726d         date_form
+00014aa0: 6174 3d6d 6971 7476 2e64 6174 655f 666f  at=miqtv.date_fo
+00014ab0: 726d 6174 735b 2770 616e 6761 6561 275d  rmats['pangaea']
+00014ac0: 2c20 636f 6e73 745f 7661 6c75 6573 203d  , const_values =
+00014ad0: 207b 7d2c 206f 7665 7277 7269 7465 3d46   {}, overwrite=F
+00014ae0: 616c 7365 2c20 636f 6c5f 7365 7061 7261  alse, col_separa
+00014af0: 746f 7220 3d20 225c 7422 2c0a 2020 2020  tor = "\t",.    
+00014b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b10: 2020 2020 2020 2020 2020 2020 6174 745f              att_
+00014b20: 7061 7468 5f61 6e67 6c65 735f 696e 5f72  path_angles_in_r
+00014b30: 6164 203d 2046 616c 7365 2c20 7669 6465  ad = False, vide
+00014b40: 6f53 616d 706c 6553 6563 6f6e 6473 3d31  oSampleSeconds=1
+00014b50: 2c72 6563 6f72 6473 3262 6549 6e76 6572  ,records2beInver
+00014b60: 7465 643d 5b5d 293a 0a20 2020 2020 2020  ted=[]):.       
+00014b70: 2022 2222 2044 6570 7265 6361 7464 6520   """ Deprecatde 
+00014b80: 2d20 7573 6520 6372 6561 7465 5f69 6d61  - use create_ima
+00014b90: 6765 5f61 7474 6974 7564 655f 6669 6c65  ge_attitude_file
+00014ba0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+00014bb0: 7572 6e20 7365 6c66 2e63 7265 6174 655f  urn self.create_
+00014bc0: 696d 6167 655f 6174 7469 7475 6465 5f66  image_attitude_f
+00014bd0: 696c 6528 6174 745f 7061 7468 2c20 6672  ile(att_path, fr
+00014be0: 616d 655f 6174 745f 6865 6164 6572 2c20  ame_att_header, 
+00014bf0: 6361 6d65 7261 3246 7261 6d65 5f79 6177  camera2Frame_yaw
+00014c00: 2c20 6361 6d65 7261 3246 7261 6d65 5f70  , camera2Frame_p
+00014c10: 6974 6368 2c20 6361 6d65 7261 3246 7261  itch, camera2Fra
+00014c20: 6d65 5f72 6f6c 6c2c 200a 2020 2020 2020  me_roll, .      
+00014c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c50: 2020 2020 2020 2020 2064 6174 655f 666f           date_fo
+00014c60: 726d 6174 2c20 636f 6e73 745f 7661 6c75  rmat, const_valu
+00014c70: 6573 2c20 6f76 6572 7772 6974 652c 2063  es, overwrite, c
+00014c80: 6f6c 5f73 6570 6172 6174 6f72 2c20 6174  ol_separator, at
+00014c90: 745f 7061 7468 5f61 6e67 6c65 735f 696e  t_path_angles_in
+00014ca0: 5f72 6164 2c20 7669 6465 6f53 616d 706c  _rad, videoSampl
+00014cb0: 6553 6563 6f6e 6473 2c0a 2020 2020 2020  eSeconds,.      
+00014cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ce0: 2020 2020 2020 2020 2072 6563 6f72 6473           records
+00014cf0: 3262 6549 6e76 6572 7465 6429 0a20 2020  2beInverted).   
+00014d00: 2020 2020 200a 0a20 2020 2064 6566 2067       ..    def g
+00014d10: 6574 5f52 5f63 616d 5374 6432 7574 6d28  et_R_camStd2utm(
+00014d20: 7365 6c66 2c52 5f63 616d 3266 7261 6d65  self,R_cam2frame
+00014d30: 3a6e 702e 6172 7261 792c 525f 6672 616d  :np.array,R_fram
+00014d40: 6532 6e65 643a 6e70 2e61 7272 6179 293a  e2ned:np.array):
+00014d50: 0a20 2020 2020 2020 2022 2222 2072 6574  .        """ ret
+00014d60: 7275 6e20 726f 7461 7469 6f6e 206d 6174  run rotation mat
+00014d70: 7269 7820 5220 7472 616e 666f 726d 696e  rix R tranformin
+00014d80: 6720 6672 6f6d 2063 616d 5374 643a 2028  g from camStd: (
+00014d90: 782c 792c 7a20 3d20 7269 6768 742c 6275  x,y,z = right,bu
+00014da0: 7474 6f6d 2c6c 696e 6520 6f66 2073 6967  ttom,line of sig
+00014db0: 6874 2920 746f 2075 746d 2028 782c 792c  ht) to utm (x,y,
+00014dc0: 7a20 3d20 6561 7374 696e 672c 6e6f 7274  z = easting,nort
+00014dd0: 6869 6e67 2c75 7029 2022 2222 0a20 2020  hing,up) """.   
+00014de0: 2020 2020 2052 5f63 616d 6946 444f 3263       R_camiFDO2c
+00014df0: 616d 5374 6420 3d20 6d69 7174 672e 525f  amStd = miqtg.R_
+00014e00: 5961 7750 6974 6368 526f 6c6c 2839 302c  YawPitchRoll(90,
+00014e10: 302c 3029 2023 2069 6e20 6946 444f 2063  0,0) # in iFDO c
+00014e20: 616d 3a20 2878 2c79 2c7a 203d 2074 6f70  am: (x,y,z = top
+00014e30: 2c72 6967 6874 2c6c 696e 6520 6f66 2073  ,right,line of s
+00014e40: 6967 6874 2920 6275 7420 666f 7220 706f  ight) but for po
+00014e50: 7365 2074 6865 2027 7374 616e 6461 7264  se the 'standard
+00014e60: 2720 6361 6d53 7464 3a20 2878 2c79 2c7a  ' camStd: (x,y,z
+00014e70: 203d 2072 6967 6874 2c62 7574 746f 6d2c   = right,buttom,
+00014e80: 6c69 6e65 206f 6620 7369 6768 7429 2069  line of sight) i
+00014e90: 7320 6578 7065 6374 6564 0a20 2020 2020  s expected.     
+00014ea0: 2020 2052 5f63 616d 5374 6432 6672 616d     R_camStd2fram
+00014eb0: 6520 3d20 525f 6361 6d32 6672 616d 652e  e = R_cam2frame.
+00014ec0: 646f 7428 525f 6361 6d69 4644 4f32 6361  dot(R_camiFDO2ca
+00014ed0: 6d53 7464 290a 2020 2020 2020 2020 525f  mStd).        R_
+00014ee0: 6361 6d53 7464 326e 6564 203d 2052 5f66  camStd2ned = R_f
+00014ef0: 7261 6d65 326e 6564 2e64 6f74 2852 5f63  rame2ned.dot(R_c
+00014f00: 616d 5374 6432 6672 616d 6529 0a20 2020  amStd2frame).   
+00014f10: 2020 2020 2052 5f6e 6564 3275 746d 203d       R_ned2utm =
+00014f20: 206d 6971 7467 2e52 5f58 595a 2831 3830   miqtg.R_XYZ(180
+00014f30: 2c30 2c39 3029 2023 2077 6974 6820 7574  ,0,90) # with ut
+00014f40: 6d20 782c 792c 7a20 3d20 6561 7374 696e  m x,y,z = eastin
+00014f50: 672c 6e6f 7274 6869 6e67 2c75 700a 2020  g,northing,up.  
+00014f60: 2020 2020 2020 525f 6361 6d53 7464 3275        R_camStd2u
+00014f70: 746d 203d 2052 5f6e 6564 3275 746d 2e64  tm = R_ned2utm.d
+00014f80: 6f74 2852 5f63 616d 5374 6432 6e65 6429  ot(R_camStd2ned)
+00014f90: 2e72 6f75 6e64 2835 290a 2020 2020 2020  .round(5).      
+00014fa0: 2020 7265 7475 726e 2052 5f63 616d 5374    return R_camSt
+00014fb0: 6432 7574 6d0a 0a0a 2020 2020 6465 6620  d2utm...    def 
+00014fc0: 6669 6e64 4e61 7644 6174 6146 6f72 496d  findNavDataForIm
+00014fd0: 6167 6528 7365 6c66 2c64 6174 613a 6d69  age(self,data:mi
+00014fe0: 7174 672e 4e75 6d44 6174 6154 696d 6553  qtg.NumDataTimeS
+00014ff0: 7461 6d70 6564 2c76 6964 656f 5361 6d70  tamped,videoSamp
+00015000: 6c65 5365 636f 6e64 733d 3129 3a0a 2020  leSeconds=1):.  
+00015010: 2020 2020 2020 2222 2220 6372 6561 7465        """ create
+00015020: 7320 6120 6469 6374 2028 696d 6167 655f  s a dict (image_
+00015030: 6474 7329 2077 6974 6820 6669 6c65 206e  dts) with file n
+00015040: 616d 6520 6173 206b 6579 2061 6e64 2061  ame as key and a
+00015050: 206c 6973 7420 6f66 2064 6174 6120 656c   list of data el
+00015060: 656d 656e 7473 2061 7320 7661 6c75 652e  ements as value.
+00015070: 200a 2020 2020 2020 2020 2020 2020 496e   .            In
+00015080: 2063 6173 6520 6f66 2070 686f 746f 7320   case of photos 
+00015090: 7468 6520 6c69 7374 2068 6173 206f 6e6c  the list has onl
+000150a0: 7920 6120 7369 6e67 6c65 2065 6e74 7279  y a single entry
+000150b0: 2c20 666f 7220 7669 6465 6f73 2069 7420  , for videos it 
+000150c0: 6861 7320 7669 6465 6f20 6475 7261 7469  has video durati
+000150d0: 6f6e 205b 7365 635d 202f 2076 6964 656f  on [sec] / video
+000150e0: 5361 6d70 6c65 5365 636f 6e64 7320 656e  SampleSeconds en
+000150f0: 7472 6965 732e 0a20 2020 2020 2020 2020  tries..         
+00015100: 2020 2052 6574 7572 6e73 2073 7563 6365     Returns succe
+00015110: 7373 2c20 696d 6167 655f 6474 732c 206d  ss, image_dts, m
+00015120: 7367 2022 2222 0a0a 2020 2020 2020 2020  sg """..        
+00015130: 6966 2076 6964 656f 5361 6d70 6c65 5365  if videoSampleSe
+00015140: 636f 6e64 7320 3c3d 2030 3a0a 2020 2020  conds <= 0:.    
+00015150: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+00015160: 6365 7074 696f 6e28 2266 696e 644e 6176  ception("findNav
+00015170: 4461 7461 466f 7249 6d61 6765 3a20 7669  DataForImage: vi
+00015180: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
+00015190: 206d 7573 7420 6265 2067 7265 6174 6572   must be greater
+000151a0: 2030 2229 0a0a 2020 2020 2020 2020 2320   0")..        # 
+000151b0: 6372 6561 7465 2073 6f72 7465 6420 7469  create sorted ti
+000151c0: 6d65 2070 6f69 6e74 730a 2020 2020 2020  me points.      
+000151d0: 2020 7469 6d65 5f70 6f69 6e74 7320 3d20    time_points = 
+000151e0: 6c69 7374 2864 6174 612e 6b65 7973 2829  list(data.keys()
+000151f0: 290a 2020 2020 2020 2020 7469 6d65 5f70  ).        time_p
+00015200: 6f69 6e74 732e 736f 7274 2829 0a20 2020  oints.sort().   
+00015210: 2020 2020 2075 6e6d 6174 6368 6564 5469       unmatchedTi
+00015220: 6d65 506f 696e 7473 203d 205b 5d0a 2020  mePoints = [].  
+00015230: 2020 2020 2020 696d 6167 655f 6474 7320        image_dts 
+00015240: 3d20 7b7d 0a20 2020 2020 2020 2073 7461  = {}.        sta
+00015250: 7274 5365 6172 6368 496e 6465 7820 3d20  rtSearchIndex = 
+00015260: 300a 2020 2020 2020 2020 696d 6167 6573  0.        images
+00015270: 496e 5261 7720 3d20 2073 656c 662e 696d  InRaw =  self.im
+00015280: 6167 6573 496e 496d 6167 6573 4469 7228  agesInImagesDir(
+00015290: 290a 2020 2020 2020 2020 696d 6167 6573  ).        images
+000152a0: 496e 5261 7753 6f72 7465 644c 6973 7420  InRawSortedList 
+000152b0: 3d20 7365 6c66 2e69 6d61 6765 7349 6e49  = self.imagesInI
+000152c0: 6d61 6765 7344 6972 536f 7274 6564 4c69  magesDirSortedLi
+000152d0: 7374 2829 0a20 2020 2020 2020 2070 726f  st().        pro
+000152e0: 6720 3d20 6d69 7174 632e 5072 696e 744b  g = miqtc.PrintK
+000152f0: 6e6f 776e 5072 6f67 7265 7373 4d73 6728  nownProgressMsg(
+00015300: 2249 6e74 6572 706f 6c61 7469 6e67 206e  "Interpolating n
+00015310: 6176 6967 6174 696f 6e20 666f 7220 696d  avigation for im
+00015320: 6167 6522 2c20 6c65 6e28 696d 6167 6573  age", len(images
+00015330: 496e 5261 7729 2c6d 6f64 756c 6f3d 3129  InRaw),modulo=1)
+00015340: 0a20 2020 2020 2020 2066 6f72 2066 696c  .        for fil
+00015350: 6520 696e 2069 6d61 6765 7349 6e52 6177  e in imagesInRaw
+00015360: 536f 7274 6564 4c69 7374 3a0a 2020 2020  SortedList:.    
+00015370: 2020 2020 2020 2020 7072 6f67 2e70 726f          prog.pro
+00015380: 6772 6573 7328 290a 2020 2020 2020 2020  gress().        
+00015390: 2020 2020 6669 6c65 5f6e 616d 6520 3d20      file_name = 
+000153a0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+000153b0: 2866 696c 6529 0a0a 2020 2020 2020 2020  (file)..        
+000153c0: 2020 2020 6474 5f69 6d61 6765 203d 206d      dt_image = m
+000153d0: 6971 7463 2e70 6172 7365 4669 6c65 4461  iqtc.parseFileDa
+000153e0: 7465 5469 6d65 4173 5554 4328 6669 6c65  teTimeAsUTC(file
+000153f0: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
+00015400: 2020 2064 745f 696d 6167 655f 7473 203d     dt_image_ts =
+00015410: 2069 6e74 2864 745f 696d 6167 652e 7469   int(dt_image.ti
+00015420: 6d65 7374 616d 7028 2920 2a20 3130 3030  mestamp() * 1000
+00015430: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
+00015440: 756e 5469 6d65 203d 2069 6d61 6765 7349  unTime = imagesI
+00015450: 6e52 6177 5b66 696c 655d 5b31 5d20 2320  nRaw[file][1] # 
+00015460: 2d31 2066 6f72 2070 686f 746f 730a 2020  -1 for photos.  
+00015470: 2020 2020 2020 2020 2020 2320 7669 6465            # vide
+00015480: 6f0a 2020 2020 2020 2020 2020 2020 6966  o.            if
+00015490: 2069 6d61 6765 7349 6e52 6177 5b66 696c   imagesInRaw[fil
+000154a0: 655d 5b32 5d20 696e 206d 6971 7476 2e76  e][2] in miqtv.v
+000154b0: 6964 656f 5f74 7970 6573 2061 6e64 2072  ideo_types and r
+000154c0: 756e 5469 6d65 203c 3d20 303a 2023 2065  unTime <= 0: # e
+000154d0: 7874 0a20 2020 2020 2020 2020 2020 2020  xt.             
+000154e0: 2020 2070 7269 6e74 2822 4361 7574 696f     print("Cautio
+000154f0: 6e21 2043 6f75 6c64 206e 6f74 2072 6561  n! Could not rea
+00015500: 6420 7669 6465 6f20 7275 6e20 7469 6d65  d video run time
+00015510: 2066 726f 6d20 6669 6c65 222c 6669 6c65   from file",file
+00015520: 2920 2320 544f 444f 2064 6f65 7320 7468  ) # TODO does th
+00015530: 6973 2068 6170 7065 6e3f 2048 616e 646c  is happen? Handl
+00015540: 6520 6265 7474 6572 3f0a 0a20 2020 2020  e better?..     
+00015550: 2020 2020 2020 2073 616d 706c 6554 696d         sampleTim
+00015560: 6553 6563 7320 3d20 300a 2020 2020 2020  eSecs = 0.      
+00015570: 2020 2020 2020 706f 735f 6c69 7374 203d        pos_list =
+00015580: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00015590: 676f 203d 2054 7275 650a 2020 2020 2020  go = True.      
+000155a0: 2020 2020 2020 7768 696c 6520 676f 3a0a        while go:.
+000155b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155c0: 7472 793a 2020 2020 2020 2020 2020 2020  try:            
+000155d0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000155e0: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
+000155f0: 2c20 7374 6172 7453 6561 7263 6849 6e64  , startSearchInd
+00015600: 6578 203d 2064 6174 612e 696e 7465 7270  ex = data.interp
+00015610: 6f6c 6174 6541 7454 696d 6528 6474 5f69  olateAtTime(dt_i
+00015620: 6d61 6765 5f74 7320 2b20 7361 6d70 6c65  mage_ts + sample
+00015630: 5469 6d65 5365 6373 202a 2031 3030 302c  TimeSecs * 1000,
+00015640: 7469 6d65 5f70 6f69 6e74 732c 7374 6172  time_points,star
+00015650: 7453 6561 7263 6849 6e64 6578 290a 2020  tSearchIndex).  
+00015660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015670: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+00015680: 2020 2020 2020 2023 2069 6e74 6572 706f         # interpo
+00015690: 6c61 7465 4174 5469 6d65 2072 6574 7572  lateAtTime retur
+000156a0: 6e73 204e 6f6e 6520 7661 6c75 6573 2069  ns None values i
+000156b0: 6620 7469 6d65 206f 7574 206f 6620 7261  f time out of ra
+000156c0: 6e67 650a 2020 2020 2020 2020 2020 2020  nge.            
+000156d0: 2020 2020 2020 2020 6966 2070 6f73 2e63          if pos.c
+000156e0: 6f74 6169 6e73 4e6f 6e65 5661 6c75 6573  otainsNoneValues
+000156f0: 496e 5265 7175 6972 6564 4669 656c 6473  InRequiredFields
+00015700: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00015710: 2020 2020 2020 2020 2020 2020 756e 6d61              unma
+00015720: 7463 6865 6454 696d 6550 6f69 6e74 732e  tchedTimePoints.
+00015730: 6170 7065 6e64 2828 6474 5f69 6d61 6765  append((dt_image
+00015740: 5f74 7320 2b20 7361 6d70 6c65 5469 6d65  _ts + sampleTime
+00015750: 5365 6373 202a 2031 3030 3029 2f31 3030  Secs * 1000)/100
+00015760: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
+00015770: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00015780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015790: 2020 2020 2070 6f73 5f6c 6973 742e 6170       pos_list.ap
+000157a0: 7065 6e64 2870 6f73 290a 2020 2020 2020  pend(pos).      
+000157b0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+000157c0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+000157d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000157e0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+000157f0: 652c 2069 6d61 6765 5f64 7473 2c20 2243  e, image_dts, "C
+00015800: 6f75 6c64 206e 6f74 2066 696e 6420 696d  ould not find im
+00015810: 6167 6520 7469 6d65 2022 2b20 6461 7465  age time "+ date
+00015820: 7469 6d65 2e64 6174 6574 696d 652e 7574  time.datetime.ut
+00015830: 6366 726f 6d74 696d 6573 7461 6d70 2828  cfromtimestamp((
+00015840: 6474 5f69 6d61 6765 5f74 7320 2b20 7361  dt_image_ts + sa
+00015850: 6d70 6c65 5469 6d65 5365 6373 202a 2031  mpleTimeSecs * 1
+00015860: 3030 3029 2f31 3030 3029 2e73 7472 6674  000)/1000).strft
+00015870: 696d 6528 6d69 7174 762e 6461 7465 5f66  ime(miqtv.date_f
+00015880: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
+00015890: 2920 2b22 2069 6e20 222b 7374 7228 6461  ) +" in "+str(da
+000158a0: 7461 2e6c 656e 2829 292b 2220 6461 7461  ta.len())+" data
+000158b0: 2070 6f73 6974 696f 6e73 2220 2b20 7374   positions" + st
+000158c0: 7228 652e 6172 6773 290a 2020 2020 2020  r(e.args).      
+000158d0: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
+000158e0: 5469 6d65 5365 6373 202b 3d20 7669 6465  TimeSecs += vide
+000158f0: 6f53 616d 706c 6553 6563 6f6e 6473 0a20  oSampleSeconds. 
+00015900: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00015910: 6620 7361 6d70 6c65 5469 6d65 5365 6373  f sampleTimeSecs
+00015920: 203e 2072 756e 5469 6d65 3a0a 2020 2020   > runTime:.    
+00015930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015940: 676f 203d 2046 616c 7365 0a20 2020 2020  go = False.     
+00015950: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00015960: 2020 2020 696d 6167 655f 6474 735b 6669      image_dts[fi
+00015970: 6c65 5f6e 616d 655d 203d 2070 6f73 5f6c  le_name] = pos_l
+00015980: 6973 740a 2020 2020 2020 2020 7072 6f67  ist.        prog
+00015990: 2e63 6c65 6172 2829 0a20 2020 2020 2020  .clear().       
+000159a0: 2072 6574 7572 6e4d 7367 203d 2022 220a   returnMsg = "".
+000159b0: 2020 2020 2020 2020 6966 206c 656e 2875          if len(u
+000159c0: 6e6d 6174 6368 6564 5469 6d65 506f 696e  nmatchedTimePoin
+000159d0: 7473 2920 213d 2030 3a0a 2020 2020 2020  ts) != 0:.      
+000159e0: 2020 2020 2020 756e 6d61 7463 6865 6454        unmatchedT
+000159f0: 696d 6550 6f69 6e74 732e 736f 7274 2829  imePoints.sort()
+00015a00: 0a20 2020 2020 2020 2020 2020 2075 6e6d  .            unm
+00015a10: 6174 6368 6564 5469 6d65 506f 696e 7473  atchedTimePoints
+00015a20: 203d 205b 6461 7465 7469 6d65 2e64 6174   = [datetime.dat
+00015a30: 6574 696d 652e 7574 6366 726f 6d74 696d  etime.utcfromtim
+00015a40: 6573 7461 6d70 2874 7329 2e73 7472 6674  estamp(ts).strft
+00015a50: 696d 6528 6d69 7174 762e 6461 7465 5f66  ime(miqtv.date_f
+00015a60: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
+00015a70: 2920 666f 7220 7473 2069 6e20 756e 6d61  ) for ts in unma
+00015a80: 7463 6865 6454 696d 6550 6f69 6e74 735d  tchedTimePoints]
+00015a90: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00015aa0: 7572 6e4d 7367 203d 2022 4361 7574 696f  urnMsg = "Cautio
+00015ab0: 6e21 204e 6176 6967 6174 696f 6e20 6e6f  n! Navigation no
+00015ac0: 7420 666f 756e 6420 666f 7220 7468 6520  t found for the 
+00015ad0: 666f 6c6c 6f77 696e 6720 696d 6167 6520  following image 
+00015ae0: 7469 6d65 2070 6f69 6e74 732e 2044 6f75  time points. Dou
+00015af0: 626c 6520 6368 6563 6b20 6f72 2070 726f  ble check or pro
+00015b00: 7669 6465 2061 7420 6c65 6173 7420 7374  vide at least st
+00015b10: 6174 6963 2064 6566 6175 6c74 206e 6176  atic default nav
+00015b20: 6967 6174 696f 6e20 696e 2068 6561 6465  igation in heade
+00015b30: 7220 6669 656c 6473 2e22 0a20 2020 2020  r fields.".     
+00015b40: 2020 2020 2020 2072 6574 7572 6e4d 7367         returnMsg
+00015b50: 202b 3d20 225c 6e22 202b 2022 5c6e 222e   += "\n" + "\n".
+00015b60: 6a6f 696e 2875 6e6d 6174 6368 6564 5469  join(unmatchedTi
+00015b70: 6d65 506f 696e 7473 290a 2020 2020 2020  mePoints).      
+00015b80: 2020 7265 7475 726e 2054 7275 652c 2069    return True, i
+00015b90: 6d61 6765 5f64 7473 2c20 7265 7475 726e  mage_dts, return
+00015ba0: 4d73 670a 0a0a 2020 2020 6465 6620 6372  Msg...    def cr
+00015bb0: 6561 7465 5f69 6d61 6765 5f6e 6176 6967  eate_image_navig
+00015bc0: 6174 696f 6e5f 6669 6c65 2873 656c 662c  ation_file(self,
+00015bd0: 206e 6176 5f70 6174 683a 2073 7472 2c20   nav_path: str, 
+00015be0: 6e61 765f 6865 6164 6572 3d6d 6971 7476  nav_header=miqtv
+00015bf0: 2e70 6f73 5f68 6561 6465 725b 2770 616e  .pos_header['pan
+00015c00: 6761 6561 275d 2c20 6461 7465 5f66 6f72  gaea'], date_for
+00015c10: 6d61 743d 6d69 7174 762e 6461 7465 5f66  mat=miqtv.date_f
+00015c20: 6f72 6d61 7473 5b27 7061 6e67 6165 6127  ormats['pangaea'
+00015c30: 5d2c 206f 7665 7277 7269 7465 3d46 616c  ], overwrite=Fal
+00015c40: 7365 2c20 636f 6c5f 7365 7061 7261 746f  se, col_separato
+00015c50: 7220 3d20 225c 7422 2c20 7669 6465 6f53  r = "\t", videoS
+00015c60: 616d 706c 6553 6563 6f6e 6473 3d31 2c0a  ampleSeconds=1,.
+00015c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c90: 2020 2020 6f66 6673 6574 5f78 3d30 2c20      offset_x=0, 
+00015ca0: 6f66 6673 6574 5f79 3d30 2c20 6f66 6673  offset_y=0, offs
+00015cb0: 6574 5f7a 3d30 2c61 6e67 6c65 735f 696e  et_z=0,angles_in
+00015cc0: 5f72 6164 203d 2046 616c 7365 2c20 7265  _rad = False, re
+00015cd0: 636f 7264 7332 6265 496e 7665 7274 6564  cords2beInverted
+00015ce0: 3d5b 5d29 3a0a 2020 2020 2020 2020 2222  =[]):.        ""
+00015cf0: 2220 4372 6561 7465 7320 696e 202f 696e  " Creates in /in
+00015d00: 7465 726d 6564 6961 7465 2061 2074 6578  termediate a tex
+00015d10: 7420 6669 6c65 2077 6974 6820 342e 3544  t file with 4.5D
+00015d20: 206e 6176 6967 6174 696f 6e20 6461 7461   navigation data
+00015d30: 2066 6f72 2065 6163 6820 696d 6167 652c   for each image,
+00015d40: 2069 2e65 2e20 6120 7369 6e67 6c65 2072   i.e. a single r
+00015d50: 6f77 2070 6572 2070 686f 746f 2c20 7669  ow per photo, vi
+00015d60: 6465 6f20 6475 7261 7469 6f6e 205b 7365  deo duration [se
+00015d70: 635d 202f 2076 6964 656f 5361 6d70 6c65  c] / videoSample
+00015d80: 5365 636f 6e64 7320 726f 7773 2070 6572  Seconds rows per
+00015d90: 2076 6964 656f 2e0a 2020 2020 2020 2020   video..        
+00015da0: 2020 2020 6e61 765f 6865 6164 6572 206d      nav_header m
+00015db0: 7573 7420 6265 2064 6963 7420 636f 6e74  ust be dict cont
+00015dc0: 6169 6e69 6e67 2074 6865 206b 6579 7320  aining the keys 
+00015dd0: 2775 7463 272c 276c 6174 272c 276c 6f6e  'utc','lat','lon
+00015de0: 272c 2764 6570 2728 6f72 2027 616c 7427  ','dep'(or 'alt'
+00015df0: 292c 206f 7074 696f 6e61 6c3a 2027 6867  ), optional: 'hg
+00015e00: 7427 2c27 756e 6365 7274 2720 7769 7468  t','uncert' with
+00015e10: 2074 6865 2072 6573 7065 6374 6976 6520   the respective 
+00015e20: 636f 6c75 6d6e 2068 6561 6465 7273 2061  column headers a
+00015e30: 7320 7661 6c75 6573 200a 2020 2020 2020  s values .      
+00015e40: 2020 2020 2020 6966 206f 6e65 206f 6620        if one of 
+00015e50: 7468 6520 7665 6869 636c 6520 782c 792c  the vehicle x,y,
+00015e60: 7a20 6f66 6673 6574 7320 5b6d 5d20 6973  z offsets [m] is
+00015e70: 206e 6f74 2030 2061 6e64 206e 6176 5f68   not 0 and nav_h
+00015e80: 6561 6465 7220 616c 736f 2063 6f6e 7461  eader also conta
+00015e90: 696e 7320 2779 6177 272c 2770 6974 6368  ins 'yaw','pitch
+00015ea0: 272c 2772 6f6c 6c27 206c 6576 6572 6172  ','roll' leverar
+00015eb0: 6d20 6f66 6673 6574 7320 6172 6520 636f  m offsets are co
+00015ec0: 6d70 656e 7361 7465 6420 666f 7220 2222  mpensated for ""
+00015ed0: 220a 0a20 2020 2020 2020 2069 6620 7365  "..        if se
+00015ee0: 6c66 2e69 6e74 6572 6d65 6469 6174 654e  lf.intermediateN
+00015ef0: 6176 4669 6c65 4578 6973 7473 2829 2061  avFileExists() a
+00015f00: 6e64 206e 6f74 206f 7665 7277 7269 7465  nd not overwrite
+00015f10: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00015f20: 7475 726e 2054 7275 652c 2022 4f75 7470  turn True, "Outp
+00015f30: 7574 2066 696c 6520 6578 6973 7473 3a20  ut file exists: 
+00015f40: 222b 7365 6c66 2e67 6574 5f69 6e74 5f6e  "+self.get_int_n
+00015f50: 6176 5f66 696c 6528 290a 0a20 2020 2020  av_file()..     
+00015f60: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
+00015f70: 682e 6578 6973 7473 286e 6176 5f70 6174  h.exists(nav_pat
+00015f80: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
+00015f90: 7265 7475 726e 2046 616c 7365 2c20 224e  return False, "N
+00015fa0: 6176 6967 6174 696f 6e20 6669 6c65 206e  avigation file n
+00015fb0: 6f74 2066 6f75 6e64 3a20 222b 6e61 765f  ot found: "+nav_
+00015fc0: 7061 7468 0a0a 2020 2020 2020 2020 6966  path..        if
+00015fd0: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
+00015fe0: 7374 7328 7365 6c66 2e69 6d61 6765 7344  sts(self.imagesD
+00015ff0: 6972 293a 0a20 2020 2020 2020 2020 2020  ir):.           
+00016000: 2072 6574 7572 6e20 4661 6c73 652c 2022   return False, "
+00016010: 496d 6167 6520 666f 6c64 6572 206e 6f74  Image folder not
+00016020: 2066 6f75 6e64 3a20 222b 2073 656c 662e   found: "+ self.
+00016030: 696d 6167 6573 4469 720a 0a20 2020 2020  imagesDir..     
+00016040: 2020 2073 203d 206d 6971 7463 2e50 7269     s = miqtc.Pri
+00016050: 6e74 4c6f 6164 696e 674d 7367 2822 4372  ntLoadingMsg("Cr
+00016060: 6561 7469 6e67 2069 7465 6d73 2720 6e61  eating items' na
+00016070: 7669 6761 7469 6f6e 2064 6174 6122 290a  vigation data").
+00016080: 2020 2020 2020 2020 7265 7475 726e 4d73          returnMs
+00016090: 6720 3d20 2222 0a20 2020 2020 2020 2063  g = "".        c
+000160a0: 6f6d 7065 6e73 6174 4f66 6673 6574 7320  ompensatOffsets 
+000160b0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+000160c0: 6966 2028 6f66 6673 6574 5f78 213d 3020  if (offset_x!=0 
+000160d0: 6f72 206f 6666 7365 745f 7921 3d30 206f  or offset_y!=0 o
+000160e0: 7220 6f66 6673 6574 5f7a 213d 3029 2061  r offset_z!=0) a
+000160f0: 6e64 2027 7961 7727 2069 6e20 6e61 765f  nd 'yaw' in nav_
+00016100: 6865 6164 6572 2061 6e64 2027 7069 7463  header and 'pitc
+00016110: 6827 2069 6e20 6e61 765f 6865 6164 6572  h' in nav_header
+00016120: 2061 6e64 2027 726f 6c6c 2720 696e 206e   and 'roll' in n
+00016130: 6176 5f68 6561 6465 723a 0a20 2020 2020  av_header:.     
+00016140: 2020 2020 2020 2063 6f6d 7065 6e73 6174         compensat
+00016150: 4f66 6673 6574 7320 3d20 5472 7565 0a0a  Offsets = True..
+00016160: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+00016170: 6966 2066 6f72 206d 6973 7369 6e67 2066  if for missing f
+00016180: 6965 6c64 7320 7468 6572 6520 6172 6520  ields there are 
+00016190: 636f 6e73 7420 7661 6c75 6573 2069 6e20  const values in 
+000161a0: 6865 6164 6572 0a20 2020 2020 2020 2063  header.        c
+000161b0: 6f6e 7374 5f76 616c 7565 7320 3d20 7b7d  onst_values = {}
+000161c0: 0a20 2020 2020 2020 2066 6f72 206e 6176  .        for nav
+000161d0: 4669 656c 6420 696e 206d 6971 7476 2e70  Field in miqtv.p
+000161e0: 6f73 5f68 6561 6465 725b 276d 6172 6971  os_header['mariq
+000161f0: 7427 5d3a 0a20 2020 2020 2020 2020 2020  t']:.           
+00016200: 2072 6573 7065 6374 6976 6548 6561 6465   respectiveHeade
+00016210: 7246 6965 6c64 203d 206d 6971 7476 2e63  rField = miqtv.c
+00016220: 6f6c 5f68 6561 6465 725b 226d 6172 6971  ol_header["mariq
+00016230: 7422 5d5b 6e61 7646 6965 6c64 5d0a 2020  t"][navField].  
+00016240: 2020 2020 2020 2020 2020 6966 206e 6176            if nav
+00016250: 4669 656c 6420 6e6f 7420 696e 206e 6176  Field not in nav
+00016260: 5f68 6561 6465 7220 616e 6420 2872 6573  _header and (res
+00016270: 7065 6374 6976 6548 6561 6465 7246 6965  pectiveHeaderFie
+00016280: 6c64 2069 6e20 7365 6c66 2e69 6664 6f5f  ld in self.ifdo_
+00016290: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+000162a0: 7448 6561 6465 724b 6579 5d20 616e 6420  tHeaderKey] and 
+000162b0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+000162c0: 6432 2872 6573 7065 6374 6976 6548 6561  d2(respectiveHea
+000162d0: 6465 7246 6965 6c64 2920 213d 2022 2229  derField) != "")
+000162e0: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+000162f0: 2020 2063 6f6e 7374 5f76 616c 7565 735b     const_values[
+00016300: 6e61 7646 6965 6c64 5d20 3d20 7365 6c66  navField] = self
+00016310: 2e66 696e 6454 6d70 4669 656c 6428 7265  .findTmpField(re
+00016320: 7370 6563 7469 7665 4865 6164 6572 4669  spectiveHeaderFi
+00016330: 656c 6429 0a0a 2020 2020 2020 2020 2320  eld)..        # 
+00016340: 4c6f 6164 206e 6176 6967 6174 696f 6e20  Load navigation 
+00016350: 6461 7461 0a20 2020 2020 2020 206e 6176  data.        nav
+00016360: 5f64 6174 612c 2070 6172 7365 4d73 6720  _data, parseMsg 
+00016370: 3d20 6d69 7174 6e2e 7265 6164 416c 6c50  = miqtn.readAllP
+00016380: 6f73 6974 696f 6e73 4672 6f6d 4669 6c65  ositionsFromFile
+00016390: 5061 7468 286e 6176 5f70 6174 682c 206e  Path(nav_path, n
+000163a0: 6176 5f68 6561 6465 722c 2064 6174 655f  av_header, date_
+000163b0: 666f 726d 6174 2c63 6f6c 5f73 6570 6172  format,col_separ
+000163c0: 6174 6f72 3d63 6f6c 5f73 6570 6172 6174  ator=col_separat
+000163d0: 6f72 2c63 6f6e 7374 5f76 616c 7565 733d  or,const_values=
+000163e0: 636f 6e73 745f 7661 6c75 6573 290a 2020  const_values).  
+000163f0: 2020 2020 2020 6966 2070 6172 7365 4d73        if parseMs
+00016400: 6720 213d 2022 223a 0a20 2020 2020 2020  g != "":.       
+00016410: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+00016420: 6f67 2870 6172 7365 4d73 672c 646f 6e74  og(parseMsg,dont
+00016430: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
+00016440: 2020 2020 2020 2072 6574 7572 6e4d 7367         returnMsg
+00016450: 203d 2022 5c6e 2220 2b20 7061 7273 654d   = "\n" + parseM
+00016460: 7367 0a0a 2020 2020 2020 2020 2320 6669  sg..        # fi
+00016470: 6e64 2066 6f72 2065 6163 6820 696d 6167  nd for each imag
+00016480: 6520 7468 6520 7265 7370 6563 7469 7665  e the respective
+00016490: 206e 6176 6967 6174 696f 6e20 6461 7461   navigation data
+000164a0: 0a20 2020 2020 2020 2073 2e73 746f 7028  .        s.stop(
+000164b0: 290a 2020 2020 2020 2020 7375 6363 6573  ).        succes
+000164c0: 732c 2069 6d61 6765 5f64 7473 2c20 6d73  s, image_dts, ms
+000164d0: 6720 3d20 7365 6c66 2e66 696e 644e 6176  g = self.findNav
+000164e0: 4461 7461 466f 7249 6d61 6765 286e 6176  DataForImage(nav
+000164f0: 5f64 6174 612c 7669 6465 6f53 616d 706c  _data,videoSampl
+00016500: 6553 6563 6f6e 6473 290a 2020 2020 2020  eSeconds).      
+00016510: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+00016520: 6d73 672c 646f 6e74 5368 6f77 3d54 7275  msg,dontShow=Tru
+00016530: 6529 0a20 2020 2020 2020 2069 6620 6d73  e).        if ms
+00016540: 6720 213d 2022 223a 0a20 2020 2020 2020  g != "":.       
+00016550: 2020 2020 2072 6574 7572 6e4d 7367 202b       returnMsg +
+00016560: 3d20 225c 6e22 202b 206d 7367 0a20 2020  = "\n" + msg.   
+00016570: 2020 2020 2069 6620 6e6f 7420 7375 6363       if not succ
+00016580: 6573 733a 0a20 2020 2020 2020 2020 2020  ess:.           
+00016590: 2072 6574 7572 6e20 4661 6c73 652c 2072   return False, r
+000165a0: 6574 7572 6e4d 7367 0a20 2020 2020 2020  eturnMsg.       
+000165b0: 2073 203d 206d 6971 7463 2e50 7269 6e74   s = miqtc.Print
+000165c0: 4c6f 6164 696e 674d 7367 2822 4372 6561  LoadingMsg("Crea
+000165d0: 7469 6e67 2069 7465 6d73 2720 6e61 7669  ting items' navi
+000165e0: 6761 7469 6f6e 2064 6174 6122 290a 0a20  gation data").. 
+000165f0: 2020 2020 2020 2023 2063 6f6d 7065 6e73         # compens
+00016600: 6174 6520 6c65 7665 7261 726d 206f 6666  ate leverarm off
+00016610: 7365 7473 0a20 2020 2020 2020 2069 6620  sets.        if 
+00016620: 636f 6d70 656e 7361 744f 6666 7365 7473  compensatOffsets
+00016630: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
+00016640: 206c 6f61 6420 6672 616d 6520 6174 7469   load frame atti
+00016650: 7475 6465 2064 6174 6120 6672 6f6d 2066  tude data from f
+00016660: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
+00016670: 6174 745f 6461 7461 2c20 7061 7273 654d  att_data, parseM
+00016680: 7367 203d 206d 6971 746e 2e72 6561 6441  sg = miqtn.readA
+00016690: 6c6c 4174 7469 7475 6465 7346 726f 6d46  llAttitudesFromF
+000166a0: 696c 6550 6174 6828 6e61 765f 7061 7468  ilePath(nav_path
+000166b0: 2c20 6e61 765f 6865 6164 6572 2c20 6461  , nav_header, da
+000166c0: 7465 5f66 6f72 6d61 742c 636f 6c5f 7365  te_format,col_se
+000166d0: 7061 7261 746f 723d 636f 6c5f 7365 7061  parator=col_sepa
+000166e0: 7261 746f 722c 636f 6e73 745f 7661 6c75  rator,const_valu
+000166f0: 6573 3d63 6f6e 7374 5f76 616c 7565 732c  es=const_values,
+00016700: 616e 676c 6573 496e 5261 643d 616e 676c  anglesInRad=angl
+00016710: 6573 5f69 6e5f 7261 6429 0a20 2020 2020  es_in_rad).     
+00016720: 2020 2020 2020 2069 6620 7061 7273 654d         if parseM
+00016730: 7367 2021 3d20 2222 3a0a 2020 2020 2020  sg != "":.      
+00016740: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00016750: 726f 762e 6c6f 6728 7061 7273 654d 7367  rov.log(parseMsg
+00016760: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
+00016770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016780: 7265 7475 726e 4d73 6720 2b3d 2022 5c6e  returnMsg += "\n
+00016790: 2220 2b20 7061 7273 654d 7367 0a0a 2020  " + parseMsg..  
+000167a0: 2020 2020 2020 2020 2020 2320 6669 6e64            # find
+000167b0: 2066 6f72 2065 6163 6820 696d 6167 6520   for each image 
+000167c0: 7468 6520 7265 7370 6563 7469 7665 206e  the respective n
+000167d0: 6176 6967 6174 696f 6e20 6461 7461 0a20  avigation data. 
+000167e0: 2020 2020 2020 2020 2020 2073 7563 6365             succe
+000167f0: 7373 2c20 696d 6167 655f 6474 735f 6174  ss, image_dts_at
+00016800: 742c 206d 7367 203d 2073 656c 662e 6669  t, msg = self.fi
+00016810: 6e64 4e61 7644 6174 6146 6f72 496d 6167  ndNavDataForImag
+00016820: 6528 6174 745f 6461 7461 2c76 6964 656f  e(att_data,video
+00016830: 5361 6d70 6c65 5365 636f 6e64 7329 0a20  SampleSeconds). 
+00016840: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00016850: 7072 6f76 2e6c 6f67 286d 7367 2c64 6f6e  prov.log(msg,don
+00016860: 7453 686f 773d 5472 7565 290a 2020 2020  tShow=True).    
+00016870: 2020 2020 2020 2020 6966 206d 7367 2021          if msg !
+00016880: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+00016890: 2020 2020 2020 7265 7475 726e 4d73 6720        returnMsg 
+000168a0: 2b3d 2022 5c6e 2220 2b20 6d73 670a 2020  += "\n" + msg.  
+000168b0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+000168c0: 2073 7563 6365 7373 3a0a 2020 2020 2020   success:.      
+000168d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000168e0: 2046 616c 7365 2c20 7265 7475 726e 4d73   False, returnMs
+000168f0: 670a 0a20 2020 2020 2020 2020 2020 2023  g..            #
+00016900: 2063 6f6d 7065 6e73 6174 650a 2020 2020   compensate.    
+00016910: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+00016920: 2069 6e20 696d 6167 655f 6474 733a 0a20   in image_dts:. 
+00016930: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00016940: 6f73 6974 696f 6e73 203d 2069 6d61 6765  ositions = image
+00016950: 5f64 7473 5b66 696c 655d 0a20 2020 2020  _dts[file].     
+00016960: 2020 2020 2020 2020 2020 2061 7474 6974             attit
+00016970: 7564 6573 203d 2069 6d61 6765 5f64 7473  udes = image_dts
+00016980: 5f61 7474 5b66 696c 655d 0a20 2020 2020  _att[file].     
+00016990: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+000169a0: 2069 6e20 7261 6e67 6528 6c65 6e28 706f   in range(len(po
+000169b0: 7369 7469 6f6e 7329 293a 0a20 2020 2020  sitions)):.     
+000169c0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000169d0: 6174 203d 2070 6f73 6974 696f 6e73 5b69  at = positions[i
+000169e0: 5d2e 6c61 740a 2020 2020 2020 2020 2020  ].lat.          
+000169f0: 2020 2020 2020 2020 2020 6c6f 6e20 3d20            lon = 
+00016a00: 706f 7369 7469 6f6e 735b 695d 2e6c 6f6e  positions[i].lon
+00016a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016a20: 2020 2020 2064 6570 203d 2070 6f73 6974       dep = posit
+00016a30: 696f 6e73 5b69 5d2e 6465 700a 2020 2020  ions[i].dep.    
+00016a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a50: 6966 2027 616c 7427 2069 6e20 6e61 765f  if 'alt' in nav_
+00016a60: 6865 6164 6572 2061 6e64 206e 6f74 2027  header and not '
+00016a70: 6465 7027 2069 6e20 6e61 765f 6865 6164  dep' in nav_head
+00016a80: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00016a90: 2020 2020 2020 2020 2020 2020 6465 7020              dep 
+00016aa0: 2a3d 202d 310a 2020 2020 2020 2020 2020  *= -1.          
+00016ab0: 2020 2020 2020 2020 2020 7961 7720 3d20            yaw = 
+00016ac0: 6174 7469 7475 6465 735b 695d 2e79 6177  attitudes[i].yaw
+00016ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016ae0: 2020 2020 2070 6974 6368 203d 2061 7474       pitch = att
+00016af0: 6974 7564 6573 5b69 5d2e 7069 7463 680a  itudes[i].pitch.
+00016b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b10: 2020 2020 726f 6c6c 203d 2061 7474 6974      roll = attit
+00016b20: 7564 6573 5b69 5d2e 726f 6c6c 0a20 2020  udes[i].roll.   
+00016b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b40: 2069 6620 7961 7720 6973 204e 6f6e 6520   if yaw is None 
+00016b50: 6f72 2070 6974 6368 2069 7320 4e6f 6e65  or pitch is None
+00016b60: 206f 7220 726f 6c6c 2069 7320 4e6f 6e65   or roll is None
+00016b70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016b80: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00016b90: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00016ba0: 2020 2020 2020 206e 6577 5f6c 6174 2c6e         new_lat,n
+00016bb0: 6577 5f6c 6f6e 2c6e 6577 5f64 6570 203d  ew_lon,new_dep =
+00016bc0: 206d 6971 7467 2e61 6464 4c65 7665 7261   miqtg.addLevera
+00016bd0: 726d 7332 4c61 746c 6f6e 286c 6174 2c6c  rms2Latlon(lat,l
+00016be0: 6f6e 2c64 6570 2c6f 6666 7365 745f 782c  on,dep,offset_x,
+00016bf0: 6f66 6673 6574 5f79 2c6f 6666 7365 745f  offset_y,offset_
+00016c00: 7a2c 7961 772c 7069 7463 682c 726f 6c6c  z,yaw,pitch,roll
+00016c10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00016c20: 2020 2020 2020 706f 7369 7469 6f6e 735b        positions[
+00016c30: 695d 2e6c 6174 203d 206e 6577 5f6c 6174  i].lat = new_lat
+00016c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016c50: 2020 2020 2070 6f73 6974 696f 6e73 5b69       positions[i
+00016c60: 5d2e 6c6f 6e20 3d20 6e65 775f 6c6f 6e0a  ].lon = new_lon.
+00016c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c80: 2020 2020 706f 7369 7469 6f6e 735b 695d      positions[i]
+00016c90: 2e64 6570 203d 206e 6577 5f64 6570 0a0a  .dep = new_dep..
+00016ca0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00016cb0: 2e70 726f 762e 6c6f 6728 2261 7070 6c69  .prov.log("appli
+00016cc0: 6564 206c 6576 6572 2061 726d 2063 6f6d  ed lever arm com
+00016cd0: 7065 6e73 6174 696f 6e20 782c 792c 7a20  pensation x,y,z 
+00016ce0: 3d20 2220 2b20 7374 7228 6f66 6673 6574  = " + str(offset
+00016cf0: 5f78 2920 2b20 222c 2220 2b20 7374 7228  _x) + "," + str(
+00016d00: 6f66 6673 6574 5f79 2920 2b20 222c 2220  offset_y) + "," 
+00016d10: 2b20 7374 7228 6f66 6673 6574 5f7a 292c  + str(offset_z),
+00016d20: 646f 6e74 5368 6f77 3d54 7275 6529 0a0a  dontShow=True)..
+00016d30: 2020 2020 2020 2020 6966 206c 656e 2869          if len(i
+00016d40: 6d61 6765 5f64 7473 2920 3e20 303a 0a20  mage_dts) > 0:. 
+00016d50: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+00016d60: 636b 2077 6865 7468 6572 2064 6570 7468  ck whether depth
+00016d70: 2061 6e64 2068 6569 6768 7420 6172 6520   and height are 
+00016d80: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
+00016d90: 6c61 745f 6964 656e 7469 6361 6c2c 206c  lat_identical, l
+00016da0: 6f6e 5f69 6465 6e74 6963 616c 2c20 6465  on_identical, de
+00016db0: 705f 6964 656e 7469 6361 6c2c 2068 6774  p_identical, hgt
+00016dc0: 5f69 6465 6e74 6963 616c 2c20 6465 705f  _identical, dep_
+00016dd0: 6e6f 745f 7a65 726f 2c20 6867 745f 6e6f  not_zero, hgt_no
+00016de0: 745f 7a65 726f 2c75 6e63 6572 745f 6e6f  t_zero,uncert_no
+00016df0: 745f 7a65 726f 203d 206e 6176 5f64 6174  t_zero = nav_dat
+00016e00: 612e 6368 6563 6b50 6f73 6974 696f 6e73  a.checkPositions
+00016e10: 436f 6e74 656e 7428 290a 0a20 2020 2020  Content()..     
+00016e20: 2020 2020 2020 2023 2057 7269 7465 2074         # Write t
+00016e30: 6f20 6e61 7669 6761 7469 6f6e 2074 7874  o navigation txt
+00016e40: 2066 696c 650a 2020 2020 2020 2020 2020   file.          
+00016e50: 2020 2320 6865 6164 6572 0a20 2020 2020    # header.     
+00016e60: 2020 2020 2020 2072 6573 203d 206f 7065         res = ope
+00016e70: 6e28 7365 6c66 2e67 6574 5f69 6e74 5f6e  n(self.get_int_n
+00016e80: 6176 5f66 696c 6528 292c 2022 7722 290a  av_file(), "w").
+00016e90: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00016ea0: 7772 6974 6528 6d69 7174 762e 636f 6c5f  write(miqtv.col_
+00016eb0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00016ec0: 5b27 696d 6727 5d2b 225c 7422 2b6d 6971  ['img']+"\t"+miq
+00016ed0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00016ee0: 6172 6971 7427 5d5b 2775 7463 275d 290a  ariqt']['utc']).
+00016ef0: 0a20 2020 2020 2020 2020 2020 2068 6173  .            has
+00016f00: 5f61 6c74 203d 2054 7275 6520 6966 2064  _alt = True if d
+00016f10: 6570 5f6e 6f74 5f7a 6572 6f20 616e 6420  ep_not_zero and 
+00016f20: 2820 2764 6570 2720 696e 206e 6176 5f68  ( 'dep' in nav_h
+00016f30: 6561 6465 7220 6f72 2027 616c 7427 2069  eader or 'alt' i
+00016f40: 6e20 6e61 765f 6865 6164 6572 2029 2065  n nav_header ) e
+00016f50: 6c73 6520 4661 6c73 650a 0a20 2020 2020  lse False..     
+00016f60: 2020 2020 2020 2069 6620 276c 6174 2720         if 'lat' 
+00016f70: 696e 206e 6176 5f68 6561 6465 723a 0a20  in nav_header:. 
+00016f80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00016f90: 6573 2e77 7269 7465 2822 5c74 222b 6d69  es.write("\t"+mi
+00016fa0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00016fb0: 6d61 7269 7174 275d 5b27 6c61 7427 5d29  mariqt']['lat'])
+00016fc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016fd0: 276c 6f6e 2720 696e 206e 6176 5f68 6561  'lon' in nav_hea
+00016fe0: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
 00016ff0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00017000: 5c74 222b 7374 7228 7661 6c29 290a 2020  \t"+str(val)).  
-00017010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017020: 2020 6966 2068 6173 5f61 6c74 3a0a 2020    if has_alt:.  
-00017030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017040: 2020 2020 2020 7661 6c20 3d20 7469 6d65        val = time
-00017050: 706f 696e 742e 6465 700a 2020 2020 2020  point.dep.      
-00017060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017070: 2020 6966 2027 6465 7027 2069 6e20 6e61    if 'dep' in na
-00017080: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
-00017090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170a0: 2020 2020 2020 7661 6c20 2a3d 202d 310a        val *= -1.
-000170b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170c0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-000170d0: 6465 7027 2069 6e20 7265 636f 7264 7332  dep' in records2
-000170e0: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
-000170f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017100: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
-00017110: 2a3d 202d 310a 2020 2020 2020 2020 2020  *= -1.          
-00017120: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00017130: 6966 2020 2761 6c74 2720 696e 206e 6176  if  'alt' in nav
-00017140: 5f68 6561 6465 7220 616e 6420 2761 6c74  _header and 'alt
-00017150: 2720 696e 2072 6563 6f72 6473 3262 6549  ' in records2beI
-00017160: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
-00017170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017180: 2020 2020 2076 616c 202a 3d20 2d31 0a20       val *= -1. 
-00017190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000171a0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-000171b0: 2822 5c74 222b 7374 7228 7661 6c29 290a  ("\t"+str(val)).
-000171c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000171d0: 2020 2020 6966 2068 6774 5f6e 6f74 5f7a      if hgt_not_z
-000171e0: 6572 6f20 616e 6420 2768 6774 2720 696e  ero and 'hgt' in
-000171f0: 206e 6176 5f68 6561 6465 723a 0a20 2020   nav_header:.   
-00017200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017210: 2020 2020 2076 616c 203d 2074 696d 6570       val = timep
-00017220: 6f69 6e74 2e68 6774 0a20 2020 2020 2020  oint.hgt.       
-00017230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017240: 2069 6620 2768 6774 2720 696e 2072 6563   if 'hgt' in rec
-00017250: 6f72 6473 3262 6549 6e76 6572 7465 643a  ords2beInverted:
-00017260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017270: 2020 2020 2020 2020 2020 2020 2076 616c               val
-00017280: 202a 3d20 2d31 0a20 2020 2020 2020 2020   *= -1.         
-00017290: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000172a0: 6573 2e77 7269 7465 2822 5c74 222b 7374  es.write("\t"+st
-000172b0: 7228 7661 6c29 290a 2020 2020 2020 2020  r(val)).        
-000172c0: 2020 2020 2020 2020 2020 2020 6966 2075              if u
-000172d0: 6e63 6572 745f 6e6f 745f 7a65 726f 2061  ncert_not_zero a
-000172e0: 6e64 2027 756e 6365 7274 2720 696e 206e  nd 'uncert' in n
-000172f0: 6176 5f68 6561 6465 723a 0a20 2020 2020  av_header:.     
+00017000: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
+00017010: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00017020: 6c6f 6e27 5d29 0a20 2020 2020 2020 2020  lon']).         
+00017030: 2020 2069 6620 6861 735f 616c 743a 0a20     if has_alt:. 
+00017040: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00017050: 6573 2e77 7269 7465 2822 5c74 222b 6d69  es.write("\t"+mi
+00017060: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00017070: 6d61 7269 7174 275d 5b27 616c 7427 5d29  mariqt']['alt'])
+00017080: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00017090: 6867 745f 6e6f 745f 7a65 726f 2061 6e64  hgt_not_zero and
+000170a0: 2027 6867 7427 2069 6e20 6e61 765f 6865   'hgt' in nav_he
+000170b0: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+000170c0: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+000170d0: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
+000170e0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+000170f0: 2768 6774 275d 290a 2020 2020 2020 2020  'hgt']).        
+00017100: 2020 2020 6966 2075 6e63 6572 745f 6e6f      if uncert_no
+00017110: 745f 7a65 726f 2061 6e64 2027 756e 6365  t_zero and 'unce
+00017120: 7274 2720 696e 206e 6176 5f68 6561 6465  rt' in nav_heade
+00017130: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00017140: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
+00017150: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
+00017160: 6572 5b27 6d61 7269 7174 275d 5b27 756e  er['mariqt']['un
+00017170: 6365 7274 275d 290a 2020 2020 2020 2020  cert']).        
+00017180: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
+00017190: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+000171a0: 2320 6461 7461 206c 696e 6573 0a20 2020  # data lines.   
+000171b0: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
+000171c0: 6520 696e 2069 6d61 6765 5f64 7473 3a0a  e in image_dts:.
+000171d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171e0: 666f 7220 7469 6d65 706f 696e 7420 696e  for timepoint in
+000171f0: 2069 6d61 6765 5f64 7473 5b66 696c 655d   image_dts[file]
+00017200: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017210: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00017220: 6669 6c65 2b22 5c74 222b 7469 6d65 706f  file+"\t"+timepo
+00017230: 696e 742e 6461 7465 5469 6d65 2829 2e73  int.dateTime().s
+00017240: 7472 6674 696d 6528 6d69 7174 762e 6461  trftime(miqtv.da
+00017250: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
+00017260: 7174 275d 2929 200a 2020 2020 2020 2020  qt'])) .        
+00017270: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00017280: 6c61 7427 2069 6e20 6e61 765f 6865 6164  lat' in nav_head
+00017290: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+000172a0: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
+000172b0: 3d20 7469 6d65 706f 696e 742e 6c61 740a  = timepoint.lat.
+000172c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172d0: 2020 2020 2020 2020 6966 2027 6c61 7427          if 'lat'
+000172e0: 2069 6e20 7265 636f 7264 7332 6265 496e   in records2beIn
+000172f0: 7665 7274 6564 3a0a 2020 2020 2020 2020  verted:.        
 00017300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017310: 2020 2076 616c 203d 2074 696d 6570 6f69     val = timepoi
-00017320: 6e74 2e75 6e63 6572 740a 2020 2020 2020  nt.uncert.      
-00017330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017340: 2020 6966 2027 756e 6365 7274 2720 696e    if 'uncert' in
-00017350: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
-00017360: 7465 643a 0a20 2020 2020 2020 2020 2020  ted:.           
-00017370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017380: 2076 616c 202a 3d20 2d31 0a20 2020 2020   val *= -1.     
-00017390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173a0: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
-000173b0: 222b 7374 7228 7661 6c29 290a 2020 2020  "+str(val)).    
-000173c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173d0: 7265 732e 7772 6974 6528 225c 6e22 290a  res.write("\n").
-000173e0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-000173f0: 636c 6f73 6528 290a 0a20 2020 2020 2020  close()..       
-00017400: 2020 2020 2023 2057 7269 7465 2074 6f20       # Write to 
-00017410: 6765 6f6a 736f 6e20 6669 6c65 0a20 2020  geojson file.   
-00017420: 2020 2020 2020 2020 2067 656f 6a73 6f6e           geojson
-00017430: 203d 207b 2774 7970 6527 3a20 2746 6561   = {'type': 'Fea
-00017440: 7475 7265 436f 6c6c 6563 7469 6f6e 272c  tureCollection',
-00017450: 2027 6e61 6d65 273a 2073 656c 662e 6469   'name': self.di
-00017460: 722e 6576 656e 7428 292b 225f 222b 7365  r.event()+"_"+se
-00017470: 6c66 2e64 6972 2e73 656e 736f 7228 292b  lf.dir.sensor()+
-00017480: 225f 696d 6167 652d 6e61 7669 6761 7469  "_image-navigati
-00017490: 6f6e 222c 2027 6665 6174 7572 6573 273a  on", 'features':
-000174a0: 205b 5d7d 0a20 2020 2020 2020 2020 2020   []}.           
-000174b0: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
-000174c0: 6765 5f64 7473 3a0a 2020 2020 2020 2020  ge_dts:.        
-000174d0: 2020 2020 2020 2020 2320 7068 6f74 6f0a          # photo.
+00017310: 2020 2020 7661 6c20 2a3d 202d 310a 2020      val *= -1.  
+00017320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017330: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00017340: 225c 7422 2b73 7472 2876 616c 2929 0a20  "\t"+str(val)). 
+00017350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017360: 2020 2069 6620 276c 6f6e 2720 696e 206e     if 'lon' in n
+00017370: 6176 5f68 6561 6465 723a 0a20 2020 2020  av_header:.     
+00017380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017390: 2020 2076 616c 203d 2074 696d 6570 6f69     val = timepoi
+000173a0: 6e74 2e6c 6f6e 0a20 2020 2020 2020 2020  nt.lon.         
+000173b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000173c0: 6620 276c 6f6e 2720 696e 2072 6563 6f72  f 'lon' in recor
+000173d0: 6473 3262 6549 6e76 6572 7465 643a 0a20  ds2beInverted:. 
+000173e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173f0: 2020 2020 2020 2020 2020 2076 616c 202a             val *
+00017400: 3d20 2d31 0a20 2020 2020 2020 2020 2020  = -1.           
+00017410: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00017420: 2e77 7269 7465 2822 5c74 222b 7374 7228  .write("\t"+str(
+00017430: 7661 6c29 290a 2020 2020 2020 2020 2020  val)).          
+00017440: 2020 2020 2020 2020 2020 6966 2068 6173            if has
+00017450: 5f61 6c74 3a0a 2020 2020 2020 2020 2020  _alt:.          
+00017460: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00017470: 6c20 3d20 7469 6d65 706f 696e 742e 6465  l = timepoint.de
+00017480: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
+00017490: 2020 2020 2020 2020 2020 6966 2027 6465            if 'de
+000174a0: 7027 2069 6e20 6e61 765f 6865 6164 6572  p' in nav_header
+000174b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000174c0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+000174d0: 6c20 2a3d 202d 310a 2020 2020 2020 2020  l *= -1.        
 000174e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174f0: 6966 206c 656e 2869 6d61 6765 5f64 7473  if len(image_dts
-00017500: 5b66 696c 655d 2920 3d3d 2031 3a0a 2020  [file]) == 1:.  
-00017510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017520: 2020 6966 2064 6570 5f6e 6f74 5f7a 6572    if dep_not_zer
-00017530: 6f3a 0a20 2020 2020 2020 2020 2020 2020  o:.             
-00017540: 2020 2020 2020 2020 2020 2067 656f 6d65             geome
-00017550: 7472 7920 3d20 207b 2774 7970 6527 3a20  try =  {'type': 
-00017560: 2250 6f69 6e74 222c 2027 636f 6f72 6469  "Point", 'coordi
-00017570: 6e61 7465 7327 3a20 0a20 2020 2020 2020  nates': .       
-00017580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000175a0: 205b 666c 6f61 7428 696d 6167 655f 6474   [float(image_dt
-000175b0: 735b 6669 6c65 5d5b 305d 2e6c 6f6e 292c  s[file][0].lon),
-000175c0: 2066 6c6f 6174 2869 6d61 6765 5f64 7473   float(image_dts
-000175d0: 5b66 696c 655d 5b30 5d2e 6c61 7429 2c20  [file][0].lat), 
-000175e0: 666c 6f61 7428 696d 6167 655f 6474 735b  float(image_dts[
-000175f0: 6669 6c65 5d5b 305d 2e64 6570 295d 0a20  file][0].dep)]. 
-00017600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017620: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-00017630: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00017640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017650: 2020 2020 2020 2067 656f 6d65 7472 7920         geometry 
-00017660: 3d20 207b 2774 7970 6527 3a20 2250 6f69  =  {'type': "Poi
-00017670: 6e74 222c 2027 636f 6f72 6469 6e61 7465  nt", 'coordinate
-00017680: 7327 3a20 0a20 2020 2020 2020 2020 2020  s': .           
+000174f0: 2020 2020 6966 2027 6465 7027 2069 6e20      if 'dep' in 
+00017500: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
+00017510: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00017520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017530: 2020 2020 7661 6c20 2a3d 202d 310a 2020      val *= -1.  
+00017540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017550: 2020 2020 2020 656c 6966 2020 2761 6c74        elif  'alt
+00017560: 2720 696e 206e 6176 5f68 6561 6465 7220  ' in nav_header 
+00017570: 616e 6420 2761 6c74 2720 696e 2072 6563  and 'alt' in rec
+00017580: 6f72 6473 3262 6549 6e76 6572 7465 643a  ords2beInverted:
+00017590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000175a0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+000175b0: 202a 3d20 2d31 0a20 2020 2020 2020 2020   *= -1.         
+000175c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000175d0: 6573 2e77 7269 7465 2822 5c74 222b 7374  es.write("\t"+st
+000175e0: 7228 7661 6c29 290a 2020 2020 2020 2020  r(val)).        
+000175f0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00017600: 6774 5f6e 6f74 5f7a 6572 6f20 616e 6420  gt_not_zero and 
+00017610: 2768 6774 2720 696e 206e 6176 5f68 6561  'hgt' in nav_hea
+00017620: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
+00017630: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00017640: 203d 2074 696d 6570 6f69 6e74 2e68 6774   = timepoint.hgt
+00017650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017660: 2020 2020 2020 2020 2069 6620 2768 6774           if 'hgt
+00017670: 2720 696e 2072 6563 6f72 6473 3262 6549  ' in records2beI
+00017680: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
 00017690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176a0: 2020 2020 2020 2020 2020 2020 205b 666c               [fl
-000176b0: 6f61 7428 696d 6167 655f 6474 735b 6669  oat(image_dts[fi
-000176c0: 6c65 5d5b 305d 2e6c 6f6e 292c 2066 6c6f  le][0].lon), flo
-000176d0: 6174 2869 6d61 6765 5f64 7473 5b66 696c  at(image_dts[fil
-000176e0: 655d 5b30 5d2e 6c61 7429 5d0a 2020 2020  e][0].lat)].    
-000176f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017710: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-00017720: 2020 2020 2020 6966 2054 7275 6520 696e        if True in
-00017730: 205b 6d61 7468 2e69 736e 616e 2878 2920   [math.isnan(x) 
-00017740: 666f 7220 7820 696e 2067 656f 6d65 7472  for x in geometr
-00017750: 795b 2763 6f6f 7264 696e 6174 6573 275d  y['coordinates']
-00017760: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00017770: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00017780: 6e75 650a 0a20 2020 2020 2020 2020 2020  nue..           
-00017790: 2020 2020 2023 2076 6964 656f 0a20 2020       # video.   
-000177a0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-000177b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000177c0: 2020 2020 2020 2069 6620 6465 705f 6e6f         if dep_no
-000177d0: 745f 7a65 726f 3a0a 2020 2020 2020 2020  t_zero:.        
-000177e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000177f0: 6765 6f6d 6574 7279 203d 2020 7b27 7479  geometry =  {'ty
-00017800: 7065 273a 2022 4d75 6c74 6950 6f69 6e74  pe': "MultiPoint
-00017810: 222c 2027 636f 6f72 6469 6e61 7465 7327  ", 'coordinates'
-00017820: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017840: 2020 2020 2020 2020 2020 5b5b 666c 6f61            [[floa
-00017850: 7428 642e 6c6f 6e29 2c20 666c 6f61 7428  t(d.lon), float(
-00017860: 642e 6c61 7429 2c20 666c 6f61 7428 642e  d.lat), float(d.
-00017870: 6465 7029 5d20 666f 7220 6420 696e 2069  dep)] for d in i
-00017880: 6d61 6765 5f64 7473 5b66 696c 655d 5d0a  mage_dts[file]].
-00017890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000178a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000178b0: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-000178c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000178d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000178e0: 2020 2020 2020 2020 6765 6f6d 6574 7279          geometry
-000178f0: 203d 2020 7b27 7479 7065 273a 2022 4d75   =  {'type': "Mu
-00017900: 6c74 6950 6f69 6e74 222c 2027 636f 6f72  ltiPoint", 'coor
-00017910: 6469 6e61 7465 7327 3a0a 2020 2020 2020  dinates':.      
-00017920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017940: 2020 5b5b 666c 6f61 7428 642e 6c6f 6e29    [[float(d.lon)
-00017950: 2c20 666c 6f61 7428 642e 6c61 7429 5d20  , float(d.lat)] 
-00017960: 666f 7220 6420 696e 2069 6d61 6765 5f64  for d in image_d
-00017970: 7473 5b66 696c 655d 5d0a 2020 2020 2020  ts[file]].      
-00017980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017990: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-000179a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179b0: 2020 2020 6966 2054 7275 6520 696e 205b      if True in [
-000179c0: 6d61 7468 2e69 736e 616e 2878 2920 666f  math.isnan(x) fo
-000179d0: 7220 7820 696e 205b 6974 656d 2066 6f72  r x in [item for
-000179e0: 2073 7562 6c69 7374 2069 6e20 6765 6f6d   sublist in geom
-000179f0: 6574 7279 5b27 636f 6f72 6469 6e61 7465  etry['coordinate
-00017a00: 7327 5d20 666f 7220 6974 656d 2069 6e20  s'] for item in 
-00017a10: 7375 626c 6973 745d 5d3a 0a20 2020 2020  sublist]]:.     
-00017a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a30: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
-00017a40: 2020 2020 2020 2020 2020 2020 2067 656f               geo
-00017a50: 6a73 6f6e 5b27 6665 6174 7572 6573 275d  json['features']
-00017a60: 2e61 7070 656e 6428 7b27 7479 7065 273a  .append({'type':
-00017a70: 2027 4665 6174 7572 6527 2c20 2770 726f   'Feature', 'pro
-00017a80: 7065 7274 6965 7327 3a20 7b27 6964 273a  perties': {'id':
-00017a90: 2066 696c 657d 2c20 2767 656f 6d65 7472   file}, 'geometr
-00017aa0: 7927 3a20 6765 6f6d 6574 7279 207d 290a  y': geometry }).
+000176a0: 2020 2020 2076 616c 202a 3d20 2d31 0a20       val *= -1. 
+000176b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176c0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+000176d0: 2822 5c74 222b 7374 7228 7661 6c29 290a  ("\t"+str(val)).
+000176e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176f0: 2020 2020 6966 2075 6e63 6572 745f 6e6f      if uncert_no
+00017700: 745f 7a65 726f 2061 6e64 2027 756e 6365  t_zero and 'unce
+00017710: 7274 2720 696e 206e 6176 5f68 6561 6465  rt' in nav_heade
+00017720: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00017730: 2020 2020 2020 2020 2020 2076 616c 203d             val =
+00017740: 2074 696d 6570 6f69 6e74 2e75 6e63 6572   timepoint.uncer
+00017750: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00017760: 2020 2020 2020 2020 2020 6966 2027 756e            if 'un
+00017770: 6365 7274 2720 696e 2072 6563 6f72 6473  cert' in records
+00017780: 3262 6549 6e76 6572 7465 643a 0a20 2020  2beInverted:.   
+00017790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177a0: 2020 2020 2020 2020 2076 616c 202a 3d20           val *= 
+000177b0: 2d31 0a20 2020 2020 2020 2020 2020 2020  -1.             
+000177c0: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+000177d0: 7269 7465 2822 5c74 222b 7374 7228 7661  rite("\t"+str(va
+000177e0: 6c29 290a 2020 2020 2020 2020 2020 2020  l)).            
+000177f0: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00017800: 6528 225c 6e22 290a 2020 2020 2020 2020  e("\n").        
+00017810: 2020 2020 7265 732e 636c 6f73 6528 290a      res.close().
+00017820: 0a20 2020 2020 2020 2020 2020 2023 2057  .            # W
+00017830: 7269 7465 2074 6f20 6765 6f6a 736f 6e20  rite to geojson 
+00017840: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
+00017850: 2067 656f 6a73 6f6e 203d 207b 2774 7970   geojson = {'typ
+00017860: 6527 3a20 2746 6561 7475 7265 436f 6c6c  e': 'FeatureColl
+00017870: 6563 7469 6f6e 272c 2027 6e61 6d65 273a  ection', 'name':
+00017880: 2073 656c 662e 6469 722e 6576 656e 7428   self.dir.event(
+00017890: 292b 225f 222b 7365 6c66 2e64 6972 2e73  )+"_"+self.dir.s
+000178a0: 656e 736f 7228 292b 225f 696d 6167 652d  ensor()+"_image-
+000178b0: 6e61 7669 6761 7469 6f6e 222c 2027 6665  navigation", 'fe
+000178c0: 6174 7572 6573 273a 205b 5d7d 0a20 2020  atures': []}.   
+000178d0: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
+000178e0: 6520 696e 2069 6d61 6765 5f64 7473 3a0a  e in image_dts:.
+000178f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017900: 2320 7068 6f74 6f0a 2020 2020 2020 2020  # photo.        
+00017910: 2020 2020 2020 2020 6966 206c 656e 2869          if len(i
+00017920: 6d61 6765 5f64 7473 5b66 696c 655d 2920  mage_dts[file]) 
+00017930: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+00017940: 2020 2020 2020 2020 2020 6966 2064 6570            if dep
+00017950: 5f6e 6f74 5f7a 6572 6f3a 0a20 2020 2020  _not_zero:.     
+00017960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017970: 2020 2067 656f 6d65 7472 7920 3d20 207b     geometry =  {
+00017980: 2774 7970 6527 3a20 2250 6f69 6e74 222c  'type': "Point",
+00017990: 2027 636f 6f72 6469 6e61 7465 7327 3a20   'coordinates': 
+000179a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000179b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000179c0: 2020 2020 2020 2020 205b 666c 6f61 7428           [float(
+000179d0: 696d 6167 655f 6474 735b 6669 6c65 5d5b  image_dts[file][
+000179e0: 305d 2e6c 6f6e 292c 2066 6c6f 6174 2869  0].lon), float(i
+000179f0: 6d61 6765 5f64 7473 5b66 696c 655d 5b30  mage_dts[file][0
+00017a00: 5d2e 6c61 7429 2c20 666c 6f61 7428 696d  ].lat), float(im
+00017a10: 6167 655f 6474 735b 6669 6c65 5d5b 305d  age_dts[file][0]
+00017a20: 2e64 6570 295d 0a20 2020 2020 2020 2020  .dep)].         
+00017a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a40: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+00017a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a60: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00017a70: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00017a80: 656f 6d65 7472 7920 3d20 207b 2774 7970  eometry =  {'typ
+00017a90: 6527 3a20 2250 6f69 6e74 222c 2027 636f  e': "Point", 'co
+00017aa0: 6f72 6469 6e61 7465 7327 3a20 0a20 2020  ordinates': .   
 00017ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ac0: 0a20 2020 2020 2020 2020 2020 206f 203d  .            o =
-00017ad0: 206f 7065 6e28 7365 6c66 2e67 6574 5f69   open(self.get_i
-00017ae0: 6e74 5f6e 6176 5f66 696c 6528 292e 7265  nt_nav_file().re
-00017af0: 706c 6163 6528 222e 7478 7422 2c20 222e  place(".txt", ".
-00017b00: 6765 6f6a 736f 6e22 292c 0a20 2020 2020  geojson"),.     
-00017b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b20: 2277 222c 2065 7272 6f72 733d 2269 676e  "w", errors="ign
-00017b30: 6f72 6522 2c20 656e 636f 6469 6e67 3d27  ore", encoding='
-00017b40: 7574 662d 3827 290a 2020 2020 2020 2020  utf-8').        
-00017b50: 2020 2020 6a73 6f6e 2e64 756d 7028 6765      json.dump(ge
-00017b60: 6f6a 736f 6e2c 206f 2c20 656e 7375 7265  ojson, o, ensure
-00017b70: 5f61 7363 6969 3d46 616c 7365 2c20 696e  _ascii=False, in
-00017b80: 6465 6e74 3d34 290a 2020 2020 2020 2020  dent=4).        
-00017b90: 2020 2020 6f2e 636c 6f73 6528 290a 0a20      o.close().. 
-00017ba0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00017bb0: 7072 6f76 2e61 6464 4172 6775 6d65 6e74  prov.addArgument
-00017bc0: 2822 696e 7075 744e 6176 6967 6174 696f  ("inputNavigatio
-00017bd0: 6e46 696c 6522 2c6e 6176 5f70 6174 682c  nFile",nav_path,
-00017be0: 6f76 6572 7772 6974 653d 5472 7565 290a  overwrite=True).
-00017bf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00017c00: 2e70 726f 762e 6c6f 6728 2270 6172 7365  .prov.log("parse
-00017c10: 6420 6672 6f6d 2069 6e70 7574 4e61 7669  d from inputNavi
-00017c20: 6761 7469 6f6e 4669 6c65 3a20 2220 2b20  gationFile: " + 
-00017c30: 7374 7228 6e61 765f 6865 6164 6572 292c  str(nav_header),
-00017c40: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
-00017c50: 2020 2020 2020 2020 2020 2073 2e73 746f             s.sto
-00017c60: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
-00017c70: 7265 7475 726e 2054 7275 652c 2022 4e61  return True, "Na
-00017c80: 7669 6761 7469 6f6e 2064 6174 6120 6372  vigation data cr
-00017c90: 6561 7465 6422 202b 2072 6574 7572 6e4d  eated" + returnM
-00017ca0: 7367 0a20 2020 2020 2020 2065 6c73 653a  sg.        else:
-00017cb0: 0a20 2020 2020 2020 2020 2020 2073 2e73  .            s.s
-00017cc0: 746f 7028 290a 2020 2020 2020 2020 2020  top().          
-00017cd0: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
-00017ce0: 224e 6f20 696d 6167 6520 636f 6f72 6469  "No image coordi
-00017cf0: 6e61 7465 7320 666f 756e 6422 202b 2072  nates found" + r
-00017d00: 6574 7572 6e4d 7367 0a0a 2020 2020 6465  eturnMsg..    de
-00017d10: 6620 6372 6561 7465 496d 6167 654e 6176  f createImageNav
-00017d20: 6967 6174 696f 6e46 696c 6528 7365 6c66  igationFile(self
-00017d30: 2c20 6e61 765f 7061 7468 3a20 7374 722c  , nav_path: str,
-00017d40: 206e 6176 5f68 6561 6465 723d 6d69 7174   nav_header=miqt
-00017d50: 762e 706f 735f 6865 6164 6572 5b27 7061  v.pos_header['pa
-00017d60: 6e67 6165 6127 5d2c 2064 6174 655f 666f  ngaea'], date_fo
-00017d70: 726d 6174 3d6d 6971 7476 2e64 6174 655f  rmat=miqtv.date_
-00017d80: 666f 726d 6174 735b 2770 616e 6761 6561  formats['pangaea
-00017d90: 275d 2c20 6f76 6572 7772 6974 653d 4661  '], overwrite=Fa
-00017da0: 6c73 652c 2063 6f6c 5f73 6570 6172 6174  lse, col_separat
-00017db0: 6f72 203d 2022 5c74 222c 2076 6964 656f  or = "\t", video
-00017dc0: 5361 6d70 6c65 5365 636f 6e64 733d 312c  SampleSeconds=1,
-00017dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017df0: 2020 2020 206f 6666 7365 745f 783d 302c       offset_x=0,
-00017e00: 206f 6666 7365 745f 793d 302c 206f 6666   offset_y=0, off
-00017e10: 7365 745f 7a3d 302c 616e 676c 6573 5f69  set_z=0,angles_i
-00017e20: 6e5f 7261 6420 3d20 4661 6c73 652c 2072  n_rad = False, r
-00017e30: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
-00017e40: 643d 5b5d 293a 0a20 2020 2020 2020 2022  d=[]):.        "
-00017e50: 2222 2044 6570 7265 6361 7465 6420 2d20  "" Deprecated - 
-00017e60: 7573 6520 6372 6561 7465 5f69 6d61 6765  use create_image
-00017e70: 5f6e 6176 6967 6174 696f 6e5f 6669 6c65  _navigation_file
-00017e80: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
-00017e90: 662e 6372 6561 7465 5f69 6d61 6765 5f6e  f.create_image_n
-00017ea0: 6176 6967 6174 696f 6e5f 6669 6c65 286e  avigation_file(n
-00017eb0: 6176 5f70 6174 682c 206e 6176 5f68 6561  av_path, nav_hea
-00017ec0: 6465 722c 2064 6174 655f 666f 726d 6174  der, date_format
-00017ed0: 2c20 6f76 6572 7772 6974 652c 2063 6f6c  , overwrite, col
-00017ee0: 5f73 6570 6172 6174 6f72 2c20 7669 6465  _separator, vide
-00017ef0: 6f53 616d 706c 6553 6563 6f6e 6473 2c20  oSampleSeconds, 
-00017f00: 6f66 6673 6574 5f78 2c20 6f66 6673 6574  offset_x, offset
-00017f10: 5f79 2c20 6f66 6673 6574 5f7a 2c20 616e  _y, offset_z, an
-00017f20: 676c 6573 5f69 6e5f 7261 642c 2072 6563  gles_in_rad, rec
-00017f30: 6f72 6473 3262 6549 6e76 6572 7465 6429  ords2beInverted)
-00017f40: 0a0a 0a20 2020 2064 6566 2063 7265 6174  ...    def creat
-00017f50: 655f 696d 6167 655f 7368 6132 3536 5f66  e_image_sha256_f
-00017f60: 696c 6528 7365 6c66 2c72 6552 6561 6441  ile(self,reReadA
-00017f70: 6c6c 3d54 7275 6529 3a0a 2020 2020 2020  ll=True):.      
-00017f80: 2020 2222 2220 4372 6561 7465 7320 696e    """ Creates in
-00017f90: 202f 696e 7465 726d 6564 6961 7465 2061   /intermediate a
-00017fa0: 2074 6578 7420 6669 6c65 2063 6f6e 7461   text file conta
-00017fb0: 696e 696e 6720 7065 7220 696d 6167 6520  ining per image 
-00017fc0: 6974 7320 5348 4132 3536 2068 6173 682e  its SHA256 hash.
-00017fd0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00017fe0: 7265 5265 6164 416c 6c20 6973 2054 7275  reReadAll is Tru
-00017ff0: 6520 616c 6c20 696d 6167 6573 2720 6861  e all images' ha
-00018000: 7368 6573 2061 7265 2064 6574 6572 6d69  shes are determi
-00018010: 6e65 642e 204f 7468 6572 7769 7365 206f  ned. Otherwise o
-00018020: 6e6c 7920 666f 7220 7468 6f73 6520 6669  nly for those fi
-00018030: 6c65 730a 2020 2020 2020 2020 2020 2020  les.            
-00018040: 7768 6963 6820 6172 6520 6e6f 7420 7965  which are not ye
-00018050: 7420 696e 2074 6865 2069 6e74 6572 6d65  t in the interme
-00018060: 6469 6174 6520 6669 6c65 2063 6f6e 7461  diate file conta
-00018070: 696e 696e 6720 7468 6520 696d 6167 6520  ining the image 
-00018080: 6861 7368 6573 2020 2222 220a 2020 2020  hashes  """.    
-00018090: 2020 2020 6861 7368 6573 203d 207b 7d0a      hashes = {}.
-000180a0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-000180b0: 7468 2e65 7869 7374 7328 7365 6c66 2e67  th.exists(self.g
-000180c0: 6574 5f69 6e74 5f68 6173 685f 6669 6c65  et_int_hash_file
-000180d0: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
-000180e0: 2068 6173 6865 7320 3d20 6d69 7174 662e   hashes = miqtf.
-000180f0: 7461 6246 696c 6544 6174 6128 7365 6c66  tabFileData(self
-00018100: 2e67 6574 5f69 6e74 5f68 6173 685f 6669  .get_int_hash_fi
-00018110: 6c65 2829 2c20 5b6d 6971 7476 2e63 6f6c  le(), [miqtv.col
-00018120: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00018130: 5d5b 2769 6d67 275d 2c20 6d69 7174 762e  ]['img'], miqtv.
-00018140: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00018150: 7174 275d 5b27 6861 7368 275d 5d2c 206b  qt']['hash']], k
-00018160: 6579 5f63 6f6c 3d6d 6971 7476 2e63 6f6c  ey_col=miqtv.col
-00018170: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00018180: 5d5b 2769 6d67 275d 290a 0a20 2020 2020  ]['img'])..     
-00018190: 2020 2069 6d61 6765 7349 6e52 6177 203d     imagesInRaw =
-000181a0: 2073 656c 662e 696d 6167 6573 496e 496d   self.imagesInIm
-000181b0: 6167 6573 4469 7228 290a 2020 2020 2020  agesDir().      
-000181c0: 2020 6966 206c 656e 2869 6d61 6765 7349    if len(imagesI
-000181d0: 6e52 6177 2920 3e20 303a 0a0a 2020 2020  nRaw) > 0:..    
-000181e0: 2020 2020 2020 2020 6164 6465 645f 6861          added_ha
-000181f0: 7368 6573 203d 2030 0a20 2020 2020 2020  shes = 0.       
-00018200: 2020 2020 2070 726f 6720 3d20 6d69 7174       prog = miqt
-00018210: 632e 5072 696e 744b 6e6f 776e 5072 6f67  c.PrintKnownProg
-00018220: 7265 7373 4d73 6728 2243 6865 636b 696e  ressMsg("Checkin
-00018230: 6720 6861 7368 6573 222c 206c 656e 2869  g hashes", len(i
-00018240: 6d61 6765 7349 6e52 6177 292c 6d6f 6475  magesInRaw),modu
-00018250: 6c6f 3d35 290a 2020 2020 2020 2020 2020  lo=5).          
-00018260: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
-00018270: 6167 6573 496e 5261 773a 0a20 2020 2020  agesInRaw:.     
-00018280: 2020 2020 2020 2020 2020 2070 726f 672e             prog.
-00018290: 7072 6f67 7265 7373 2829 0a0a 2020 2020  progress()..    
-000182a0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-000182b0: 6f74 2073 656c 662e 5f5f 616c 6c55 5549  ot self.__allUUI
-000182c0: 4473 4368 6563 6b65 6420 616e 6420 6e6f  DsChecked and no
-000182d0: 7420 6d69 7174 692e 696d 6167 6543 6f6e  t miqti.imageCon
-000182e0: 7461 696e 7356 616c 6964 5555 4944 2866  tainsValidUUID(f
-000182f0: 696c 6529 5b30 5d3a 0a20 2020 2020 2020  ile)[0]:.       
-00018300: 2020 2020 2020 2020 2020 2020 2023 2072               # r
-00018310: 656d 6f76 6520 6672 6f6d 2075 7569 6420  emove from uuid 
-00018320: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
-00018330: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
-00018340: 6174 682e 6578 6973 7473 2873 656c 662e  ath.exists(self.
-00018350: 6765 745f 696e 745f 7575 6964 5f66 696c  get_int_uuid_fil
-00018360: 6528 2929 3a0a 2020 2020 2020 2020 2020  e()):.          
-00018370: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00018380: 7320 3d20 6f70 656e 2873 656c 662e 6765  s = open(self.ge
-00018390: 745f 696e 745f 7575 6964 5f66 696c 6528  t_int_uuid_file(
-000183a0: 292c 2022 7222 290a 2020 2020 2020 2020  ), "r").        
-000183b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183c0: 6c69 6e65 7320 3d20 7265 732e 7265 6164  lines = res.read
-000183d0: 6c69 6e65 7328 290a 2020 2020 2020 2020  lines().        
-000183e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183f0: 7265 732e 636c 6f73 6528 290a 2020 2020  res.close().    
-00018400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018410: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00018420: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-00018430: 6e65 7320 3d20 5b5d 0a20 2020 2020 2020  nes = [].       
-00018440: 2020 2020 2020 2020 2020 2020 2069 203d               i =
-00018450: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
-00018460: 2020 2020 2020 206c 696e 654e 7220 3d20         lineNr = 
-00018470: 690a 2020 2020 2020 2020 2020 2020 2020  i.              
-00018480: 2020 2020 2020 666f 7220 6c69 6e65 2069        for line i
-00018490: 6e20 6c69 6e65 733a 0a20 2020 2020 2020  n lines:.       
-000184a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184b0: 2069 6620 6f73 2e70 6174 682e 6261 7365   if os.path.base
-000184c0: 6e61 6d65 2866 696c 6529 2069 6e20 6c69  name(file) in li
-000184d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000184e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184f0: 6c69 6e65 4e72 203d 2069 0a20 2020 2020  lineNr = i.     
-00018500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018510: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-00018520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018530: 2020 2020 2069 202b 3d20 310a 2020 2020       i += 1.    
-00018540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018550: 6966 206c 696e 654e 7220 213d 2030 3a0a  if lineNr != 0:.
-00018560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018570: 2020 2020 2020 2020 6465 6c20 6c69 6e65          del line
-00018580: 735b 6c69 6e65 4e72 5d0a 2020 2020 2020  s[lineNr].      
-00018590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185a0: 2020 7265 7320 3d20 6f70 656e 2873 656c    res = open(sel
-000185b0: 662e 6765 745f 696e 745f 7575 6964 5f66  f.get_int_uuid_f
-000185c0: 696c 6528 292c 2022 7722 290a 2020 2020  ile(), "w").    
-000185d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185e0: 2020 2020 7265 732e 7772 6974 656c 696e      res.writelin
-000185f0: 6573 286c 696e 6573 290a 2020 2020 2020  es(lines).      
-00018600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018610: 2020 7265 732e 636c 6f73 6528 290a 2020    res.close().  
-00018620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018630: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-00018640: 6e28 2022 4669 6c65 2022 202b 2066 696c  n( "File " + fil
-00018650: 6520 2b20 2220 646f 6573 206e 6f74 2063  e + " does not c
-00018660: 6f74 6169 6e20 6120 7661 6c69 6420 5555  otain a valid UU
-00018670: 4944 2e20 5275 6e20 6372 6561 7465 5f75  ID. Run create_u
-00018680: 7569 645f 6669 6c65 2829 2066 6972 7374  uid_file() first
-00018690: 2122 290a 0a20 2020 2020 2020 2020 2020  !")..           
-000186a0: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
-000186b0: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
-000186c0: 6528 6669 6c65 290a 2020 2020 2020 2020  e(file).        
-000186d0: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
-000186e0: 6552 6561 6441 6c6c 2061 6e64 2066 696c  eReadAll and fil
-000186f0: 655f 6e61 6d65 2069 6e20 6861 7368 6573  e_name in hashes
-00018700: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018710: 2020 2020 2020 6861 7368 6573 5b66 696c        hashes[fil
-00018720: 655f 6e61 6d65 5d20 3d20 6861 7368 6573  e_name] = hashes
-00018730: 5b66 696c 655f 6e61 6d65 5d5b 6d69 7174  [file_name][miqt
-00018740: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00018750: 7269 7174 275d 5b27 6861 7368 275d 5d0a  riqt']['hash']].
-00018760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018770: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00018780: 2020 2020 2020 2020 2020 6861 7368 6573            hashes
-00018790: 5b66 696c 655f 6e61 6d65 5d20 3d20 6d69  [file_name] = mi
-000187a0: 7174 632e 7368 6132 3536 4861 7368 4669  qtc.sha256HashFi
-000187b0: 6c65 2866 696c 6529 0a20 2020 2020 2020  le(file).       
-000187c0: 2020 2020 2020 2020 2020 2020 2061 6464               add
-000187d0: 6564 5f68 6173 6865 7320 2b3d 2031 0a20  ed_hashes += 1. 
-000187e0: 2020 2020 2020 2020 2020 2070 726f 672e             prog.
-000187f0: 636c 6561 7228 290a 0a20 2020 2020 2020  clear()..       
-00018800: 2020 2020 2069 6620 7265 5265 6164 416c       if reReadAl
-00018810: 6c20 6f72 2061 6464 6564 5f68 6173 6865  l or added_hashe
-00018820: 7320 3e20 303a 0a20 2020 2020 2020 2020  s > 0:.         
-00018830: 2020 2020 2020 2068 6173 685f 6669 6c65         hash_file
-00018840: 203d 206f 7065 6e28 7365 6c66 2e67 6574   = open(self.get
-00018850: 5f69 6e74 5f68 6173 685f 6669 6c65 2829  _int_hash_file()
-00018860: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
-00018870: 2020 2020 2020 2068 6173 685f 6669 6c65         hash_file
-00018880: 2e77 7269 7465 2820 6d69 7174 762e 636f  .write( miqtv.co
-00018890: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-000188a0: 275d 5b27 696d 6727 5d2b 225c 7422 2b6d  ']['img']+"\t"+m
-000188b0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-000188c0: 276d 6172 6971 7427 5d5b 2768 6173 6827  'mariqt']['hash'
-000188d0: 5d2b 225c 6e22 290a 2020 2020 2020 2020  ]+"\n").        
-000188e0: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
-000188f0: 5f6e 616d 6520 696e 2068 6173 6865 733a  _name in hashes:
-00018900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018910: 2020 2020 2068 6173 685f 6669 6c65 2e77       hash_file.w
-00018920: 7269 7465 2866 696c 655f 6e61 6d65 2b22  rite(file_name+"
-00018930: 5c74 222b 6861 7368 6573 5b66 696c 655f  \t"+hashes[file_
-00018940: 6e61 6d65 5d2b 225c 6e22 290a 0a20 2020  name]+"\n")..   
-00018950: 2020 2020 2020 2020 2020 2020 2068 6173               has
-00018960: 685f 6669 6c65 2e63 6c6f 7365 2829 0a20  h_file.close(). 
-00018970: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00018980: 6574 7572 6e20 5472 7565 2c20 2241 6464  eturn True, "Add
-00018990: 6564 2022 2b73 7472 2861 6464 6564 5f68  ed "+str(added_h
-000189a0: 6173 6865 7329 2b22 2068 6173 6865 7320  ashes)+" hashes 
-000189b0: 746f 2068 6173 6820 6669 6c65 220a 2020  to hash file".  
-000189c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000189d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189e0: 7265 7475 726e 2054 7275 652c 2022 416c  return True, "Al
-000189f0: 6c20 6861 7368 6573 2065 7869 7374 220a  l hashes exist".
-00018a00: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00018a10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00018a20: 6e20 4661 6c73 652c 2022 4e6f 2069 6d61  n False, "No ima
-00018a30: 6765 7320 666f 756e 6420 746f 2068 6173  ges found to has
-00018a40: 6822 0a20 2020 2020 2020 200a 2020 2020  h".        .    
-00018a50: 6465 6620 6372 6561 7465 496d 6167 6553  def createImageS
-00018a60: 4841 3235 3646 696c 6528 7365 6c66 2c72  HA256File(self,r
-00018a70: 6552 6561 6441 6c6c 3d54 7275 6529 3a0a  eReadAll=True):.
-00018a80: 2020 2020 2020 2020 2222 2220 4465 7072          """ Depr
-00018a90: 6563 6174 6564 202d 2075 7365 2063 7265  ecated - use cre
-00018aa0: 6174 655f 696d 6167 655f 7368 6132 3536  ate_image_sha256
-00018ab0: 5f66 696c 6520 2222 220a 2020 2020 2020  _file """.      
-00018ac0: 2020 7265 7475 726e 2073 656c 662e 6372    return self.cr
-00018ad0: 6561 7465 5f69 6d61 6765 5f73 6861 3235  eate_image_sha25
-00018ae0: 365f 6669 6c65 2872 6552 6561 6441 6c6c  6_file(reReadAll
-00018af0: 290a 0a0a 2020 2020 6465 6620 6372 6561  )...    def crea
-00018b00: 7465 5f73 7461 7274 5f74 696d 655f 6669  te_start_time_fi
-00018b10: 6c65 2873 656c 6629 3a0a 2020 2020 2020  le(self):.      
-00018b20: 2020 2222 2220 4372 6561 7465 7320 696e    """ Creates in
-00018b30: 202f 696e 7465 726d 6564 6961 7465 2061   /intermediate a
-00018b40: 2074 6578 7420 6669 6c65 2063 6f6e 7461   text file conta
-00018b50: 696e 696e 6720 7065 7220 696d 6167 6520  ining per image 
-00018b60: 6974 7320 7374 6172 7420 7469 6d65 2070  its start time p
-00018b70: 6172 7365 6420 6672 6f6d 2074 6865 2066  arsed from the f
-00018b80: 696c 6520 6e61 6d65 2022 2222 0a0a 2020  ile name """..  
-00018b90: 2020 2020 2020 7320 3d20 6d69 7174 632e        s = miqtc.
-00018ba0: 5072 696e 744c 6f61 6469 6e67 4d73 6728  PrintLoadingMsg(
-00018bb0: 2243 7265 6174 696e 6720 696e 7465 726d  "Creating interm
-00018bc0: 6564 6961 7465 2073 7461 7274 7469 6d65  ediate starttime
-00018bd0: 2066 696c 6520 2229 0a20 2020 2020 2020   file ").       
-00018be0: 2069 6d61 6765 7349 6e52 6177 203d 2073   imagesInRaw = s
-00018bf0: 656c 662e 696d 6167 6573 496e 496d 6167  elf.imagesInImag
-00018c00: 6573 4469 7253 6f72 7465 644c 6973 7428  esDirSortedList(
-00018c10: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
-00018c20: 2869 6d61 6765 7349 6e52 6177 2920 3e20  (imagesInRaw) > 
-00018c30: 303a 0a0a 2020 2020 2020 2020 2020 2020  0:..            
-00018c40: 6f20 3d20 6f70 656e 2873 656c 662e 6765  o = open(self.ge
-00018c50: 745f 696e 745f 7374 6172 7454 696d 6573  t_int_startTimes
-00018c60: 5f66 696c 6528 292c 2022 7722 290a 2020  _file(), "w").  
-00018c70: 2020 2020 2020 2020 2020 6f2e 7772 6974            o.writ
-00018c80: 6528 6d69 7174 762e 636f 6c5f 6865 6164  e(miqtv.col_head
-00018c90: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
-00018ca0: 6727 5d20 2b0a 2020 2020 2020 2020 2020  g'] +.          
-00018cb0: 2020 2020 2020 2020 2020 225c 7422 2b6d            "\t"+m
-00018cc0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00018cd0: 276d 6172 6971 7427 5d5b 2775 7463 275d  'mariqt']['utc']
-00018ce0: 2b22 5c6e 2229 0a0a 2020 2020 2020 2020  +"\n")..        
-00018cf0: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
-00018d00: 696d 6167 6573 496e 5261 773a 0a20 2020  imagesInRaw:.   
-00018d10: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00018d20: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
-00018d30: 2e62 6173 656e 616d 6528 6669 6c65 290a  .basename(file).
-00018d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018d50: 2064 7420 3d20 6d69 7174 632e 7061 7273   dt = miqtc.pars
-00018d60: 6546 696c 6544 6174 6554 696d 6541 7355  eFileDateTimeAsU
-00018d70: 5443 2866 696c 655f 6e61 6d65 290a 2020  TC(file_name).  
-00018d80: 2020 2020 2020 2020 2020 2020 2020 6f2e                o.
-00018d90: 7772 6974 6528 6669 6c65 5f6e 616d 652b  write(file_name+
-00018da0: 225c 7422 202b 2064 742e 7374 7266 7469  "\t" + dt.strfti
-00018db0: 6d65 286d 6971 7476 2e64 6174 655f 666f  me(miqtv.date_fo
-00018dc0: 726d 6174 735b 276d 6172 6971 7427 5d29  rmats['mariqt'])
-00018dd0: 2b22 5c6e 2229 0a0a 2020 2020 2020 2020  +"\n")..        
-00018de0: 2020 2020 6f2e 636c 6f73 6528 290a 2020      o.close().  
-00018df0: 2020 2020 2020 2020 2020 732e 7374 6f70            s.stop
-00018e00: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
-00018e10: 6574 7572 6e20 5472 7565 2c20 2243 7265  eturn True, "Cre
-00018e20: 6174 6564 2073 7461 7274 2074 696d 6520  ated start time 
-00018e30: 6669 6c65 220a 2020 2020 2020 2020 656c  file".        el
-00018e40: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00018e50: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
-00018e60: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00018e70: 652c 2022 4e6f 2069 6d61 6765 7320 666f  e, "No images fo
-00018e80: 756e 6420 746f 2072 6561 6420 7374 6172  und to read star
-00018e90: 7420 7469 6d65 7322 0a20 2020 2020 2020  t times".       
-00018ea0: 200a 2020 2020 6465 6620 6372 6561 7465   .    def create
-00018eb0: 5374 6172 7454 696d 6546 696c 6528 7365  StartTimeFile(se
-00018ec0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00018ed0: 2044 6570 7265 6361 7465 6420 2d20 7573   Deprecated - us
-00018ee0: 6520 6372 6561 7465 5f73 7461 7274 5f74  e create_start_t
-00018ef0: 696d 655f 6669 6c65 2022 2222 0a20 2020  ime_file """.   
-00018f00: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00018f10: 2e63 7265 6174 655f 7374 6172 745f 7469  .create_start_ti
-00018f20: 6d65 5f66 696c 6528 290a 0a0a 2020 2020  me_file()...    
-00018f30: 6465 6620 6372 6561 7465 4163 7175 6973  def createAcquis
-00018f40: 6974 696f 6e53 6574 7469 6e67 7345 5849  itionSettingsEXI
-00018f50: 4646 696c 6528 7365 6c66 2c6f 7665 7272  FFile(self,overr
-00018f60: 6964 653d 4661 6c73 6529 3a0a 2020 2020  ide=False):.    
-00018f70: 2020 2020 2222 2220 4372 6561 7465 7320      """ Creates 
-00018f80: 696e 202f 696e 7465 726d 6564 6961 7465  in /intermediate
-00018f90: 2061 2074 6578 7420 6669 6c65 2063 6f6e   a text file con
-00018fa0: 7461 696e 696e 6720 7065 7220 696d 6167  taining per imag
-00018fb0: 6520 6120 6469 6374 206f 6620 6578 6966  e a dict of exif
-00018fc0: 2074 6167 7320 616e 6420 7468 6569 7220   tags and their 
-00018fd0: 7661 6c75 6573 2070 6172 7365 6420 6672  values parsed fr
-00018fe0: 6f6d 2074 6865 2069 6d61 6765 2022 2222  om the image """
-00018ff0: 0a0a 2020 2020 2020 2020 696e 745f 6163  ..        int_ac
-00019000: 7175 6973 6974 696f 6e53 6574 7469 6e67  quisitionSetting
-00019010: 5f66 696c 6520 3d20 7365 6c66 2e5f 5f67  _file = self.__g
-00019020: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
-00019030: 6978 2829 202b 2027 5f69 6d61 6765 2d61  ix() + '_image-a
-00019040: 6371 7569 7369 7469 6f6e 2d73 6574 7469  cquisition-setti
-00019050: 6e67 732e 7478 7427 0a20 2020 2020 2020  ngs.txt'.       
-00019060: 2068 6561 6465 7220 3d20 7b20 206d 6971   header = {  miq
-00019070: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00019080: 6172 6971 7427 5d5b 2769 6d67 275d 3a20  ariqt']['img']: 
-00019090: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-000190a0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-000190b0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-000190c0: 2020 2020 2020 2020 6d69 7174 762e 636f          miqtv.co
-000190d0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-000190e0: 275d 5b27 6163 7175 6927 5d3a 6d69 7174  ']['acqui']:miqt
-000190f0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00019100: 7269 7174 275d 5b27 6163 7175 6927 5d7d  riqt']['acqui']}
-00019110: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
-00019120: 6174 682e 6578 6973 7473 2869 6e74 5f61  ath.exists(int_a
-00019130: 6371 7569 7369 7469 6f6e 5365 7474 696e  cquisitionSettin
-00019140: 675f 6669 6c65 2920 616e 6420 6e6f 7420  g_file) and not 
-00019150: 6f76 6572 7269 6465 3a0a 2020 2020 2020  override:.      
-00019160: 2020 2020 2020 7365 6c66 2e61 6464 5f69        self.add_i
-00019170: 7465 6d5f 696e 666f 5f74 6162 5f66 696c  tem_info_tab_fil
-00019180: 6528 696e 745f 6163 7175 6973 6974 696f  e(int_acquisitio
-00019190: 6e53 6574 7469 6e67 5f66 696c 652c 225c  nSetting_file,"\
-000191a0: 7422 2c68 6561 6465 7229 0a20 2020 2020  t",header).     
-000191b0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-000191c0: 7565 2c20 2252 6573 756c 7420 6669 6c65  ue, "Result file
-000191d0: 2065 7869 7374 7322 0a0a 2020 2020 2020   exists"..      
-000191e0: 2020 696d 6167 6573 496e 5261 7720 3d20    imagesInRaw = 
-000191f0: 7365 6c66 2e69 6d61 6765 7349 6e49 6d61  self.imagesInIma
-00019200: 6765 7344 6972 536f 7274 6564 4c69 7374  gesDirSortedList
-00019210: 2829 0a20 2020 2020 2020 2069 6620 6c65  ().        if le
-00019220: 6e28 696d 6167 6573 496e 5261 7729 203e  n(imagesInRaw) >
-00019230: 2030 3a0a 0a20 2020 2020 2020 2020 2020   0:..           
-00019240: 206f 203d 206f 7065 6e28 696e 745f 6163   o = open(int_ac
-00019250: 7175 6973 6974 696f 6e53 6574 7469 6e67  quisitionSetting
-00019260: 5f66 696c 652c 2022 7722 290a 2020 2020  _file, "w").    
-00019270: 2020 2020 2020 2020 6f2e 7772 6974 6528          o.write(
-00019280: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00019290: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-000192a0: 5d20 2b20 225c 7422 2b6d 6971 7476 2e63  ] + "\t"+miqtv.c
-000192b0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-000192c0: 7427 5d5b 2761 6371 7569 275d 2b22 5c6e  t']['acqui']+"\n
-000192d0: 2229 0a20 0a20 2020 2020 2020 2020 2020  "). .           
-000192e0: 2069 6d61 6765 7345 7869 6673 203d 206d   imagesExifs = m
-000192f0: 6971 7469 2e67 6574 496d 6167 6573 416c  iqti.getImagesAl
-00019300: 6c45 7869 6656 616c 7565 7328 696d 6167  lExifValues(imag
-00019310: 6573 496e 5261 772c 7365 6c66 2e70 726f  esInRaw,self.pro
-00019320: 7629 0a20 2020 2020 2020 2020 2020 2066  v).            f
-00019330: 6f72 2066 696c 6520 696e 2069 6d61 6765  or file in image
-00019340: 7345 7869 6673 3a0a 2020 2020 2020 2020  sExifs:.        
-00019350: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
-00019360: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
-00019370: 6e61 6d65 2866 696c 6529 0a20 2020 2020  name(file).     
-00019380: 2020 2020 2020 2020 2020 206f 2e77 7269             o.wri
-00019390: 7465 2866 696c 655f 6e61 6d65 2b22 5c74  te(file_name+"\t
-000193a0: 222b 7374 7228 696d 6167 6573 4578 6966  "+str(imagesExif
-000193b0: 735b 6669 6c65 5d29 2b22 5c6e 2229 0a0a  s[file])+"\n")..
-000193c0: 2020 2020 2020 2020 2020 2020 6f2e 636c              o.cl
-000193d0: 6f73 6528 290a 0a20 2020 2020 2020 2020  ose()..         
-000193e0: 2020 2073 656c 662e 6164 645f 6974 656d     self.add_item
-000193f0: 5f69 6e66 6f5f 7461 625f 6669 6c65 2869  _info_tab_file(i
-00019400: 6e74 5f61 6371 7569 7369 7469 6f6e 5365  nt_acquisitionSe
-00019410: 7474 696e 675f 6669 6c65 2c22 5c74 222c  tting_file,"\t",
-00019420: 6865 6164 6572 290a 2020 2020 2020 2020  header).        
-00019430: 2020 2020 7265 7475 726e 2054 7275 652c      return True,
-00019440: 2022 4372 6561 7465 6420 6163 7175 6973   "Created acquis
-00019450: 6974 696f 6e20 7365 7474 696e 6773 2066  ition settings f
-00019460: 696c 6522 0a20 2020 2020 2020 2065 6c73  ile".        els
-00019470: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00019480: 6574 7572 6e20 4661 6c73 652c 2022 4e6f  eturn False, "No
-00019490: 2069 6d61 6765 7320 666f 756e 6422 0a0a   images found"..
-000194a0: 0a20 2020 2064 6566 2069 6d61 6765 7349  .    def imagesI
-000194b0: 6e49 6d61 6765 7344 6972 2873 656c 6629  nImagesDir(self)
-000194c0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000194d0: 2063 6f70 792e 6465 6570 636f 7079 2873   copy.deepcopy(s
-000194e0: 656c 662e 5f69 6d61 6765 7349 6e49 6d61  elf._imagesInIma
-000194f0: 6765 7344 6972 290a 0a20 2020 2064 6566  gesDir)..    def
-00019500: 2069 6d61 6765 7349 6e49 6d61 6765 7344   imagesInImagesD
-00019510: 6972 536f 7274 6564 4c69 7374 2873 656c  irSortedList(sel
-00019520: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-00019530: 726e 2063 6f70 792e 6465 6570 636f 7079  rn copy.deepcopy
-00019540: 2873 656c 662e 5f69 6d61 6765 7349 6e49  (self._imagesInI
-00019550: 6d61 6765 7344 6972 536f 7274 6564 4c69  magesDirSortedLi
-00019560: 7374 290a 0a0a 2020 2020 6465 6620 7061  st)...    def pa
-00019570: 7273 6549 7465 6d44 6174 6166 726f 6d54  rseItemDatafromT
-00019580: 6162 4669 6c65 4461 7461 2873 656c 662c  abFileData(self,
-00019590: 2069 7465 6d73 3a20 6469 6374 2c20 6669   items: dict, fi
-000195a0: 6c65 3a20 7374 722c 2063 6f6c 733a 206c  le: str, cols: l
-000195b0: 6973 742c 206f 7074 696f 6e61 6c3a 206c  ist, optional: l
-000195c0: 6973 7420 3d20 5b5d 2c20 6461 7465 7469  ist = [], dateti
-000195d0: 6d65 5f66 6f72 6d61 743a 7374 723d 6d69  me_format:str=mi
-000195e0: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
-000195f0: 5b27 6d61 7269 7174 275d 293a 0a20 2020  ['mariqt']):.   
-00019600: 2020 2020 2022 2222 2070 6172 7365 7320       """ parses 
-00019610: 6461 7461 2066 726f 6d20 636f 6c75 6d6e  data from column
-00019620: 7320 696e 2063 6f6c 7320 616e 6420 7772  s in cols and wr
-00019630: 6974 6573 2069 6e66 6f20 746f 2069 7465  ites info to ite
-00019640: 6d73 2e20 436f 6c75 6d6e 2027 696d 6167  ms. Column 'imag
-00019650: 652d 6669 6c65 6e61 6d65 2720 6d75 7374  e-filename' must
-00019660: 2062 6520 696e 2066 696c 6520 616e 6420   be in file and 
-00019670: 646f 6573 206e 6f74 206e 6565 6420 746f  does not need to
-00019680: 2062 6520 7061 7373 6564 2069 6e20 636f   be passed in co
-00019690: 6c73 2e20 0a20 2020 2020 2020 2020 2020  ls. .           
-000196a0: 2046 696c 6520 6d75 7374 2062 6520 7461   File must be ta
-000196b0: 6220 7365 7061 7261 7465 6420 616e 6420  b separated and 
-000196c0: 636f 6c75 6d6e 7320 6e61 6d65 7320 6d75  columns names mu
-000196d0: 7374 2065 7175 616c 2069 7465 6d20 6669  st equal item fi
-000196e0: 656c 6420 6e61 6d65 7322 2222 0a20 2020  eld names""".   
-000196f0: 2020 2020 2074 6d70 5f64 6174 6120 3d20       tmp_data = 
-00019700: 6d69 7174 662e 7461 6246 696c 6544 6174  miqtf.tabFileDat
-00019710: 6128 6669 6c65 2c20 636f 6c73 2b5b 2769  a(file, cols+['i
-00019720: 6d61 6765 2d66 696c 656e 616d 6527 5d2b  mage-filename']+
-00019730: 6f70 7469 6f6e 616c 2c20 6b65 795f 636f  optional, key_co
-00019740: 6c3d 2769 6d61 6765 2d66 696c 656e 616d  l='image-filenam
-00019750: 6527 2c20 6f70 7469 6f6e 616c 3d6f 7074  e', optional=opt
-00019760: 696f 6e61 6c2c 636f 6e76 6572 743d 5472  ional,convert=Tr
-00019770: 7565 290a 2020 2020 2020 2020 7365 6c66  ue).        self
-00019780: 2e77 7269 7465 5061 7273 6564 4461 7461  .writeParsedData
-00019790: 546f 4974 656d 7328 746d 705f 6461 7461  ToItems(tmp_data
-000197a0: 2c69 7465 6d73 2c73 656c 662e 6966 646f  ,items,self.ifdo
-000197b0: 5f74 6d70 5b6d 6971 7476 2e69 6d61 6765  _tmp[miqtv.image
-000197c0: 5f73 6574 5f68 6561 6465 725f 6b65 795d  _set_header_key]
-000197d0: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
-000197e0: 743d 6461 7465 7469 6d65 5f66 6f72 6d61  t=datetime_forma
-000197f0: 7429 0a0a 0a20 2020 2064 6566 2070 7261  t)...    def pra
-00019800: 7365 4974 656d 4461 7461 4672 6f6d 4669  seItemDataFromFi
-00019810: 6c65 2873 656c 662c 6974 656d 733a 6469  le(self,items:di
-00019820: 6374 2c66 696c 653a 7374 722c 7365 7061  ct,file:str,sepa
-00019830: 7261 746f 723a 7374 722c 6865 6164 6572  rator:str,header
-00019840: 3a64 6963 742c 2064 6174 6574 696d 655f  :dict, datetime_
-00019850: 666f 726d 6174 3a73 7472 3d6d 6971 7476  format:str=miqtv
-00019860: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
-00019870: 6172 6971 7427 5d29 3a0a 2020 2020 2020  ariqt']):.      
-00019880: 2020 2222 2220 7061 7273 6573 2064 6174    """ parses dat
-00019890: 6120 6672 6f6d 2066 726f 6d20 6669 6c65  a from from file
-000198a0: 2074 6f20 6974 656d 732e 2068 6561 6465   to items. heade
-000198b0: 7220 6469 6374 206d 7573 7420 6265 206f  r dict must be o
-000198c0: 6620 7374 7275 6374 7572 653a 207b 3c69  f structure: {<i
-000198d0: 7465 6d2d 6669 656c 642d 6e61 6d65 3e3a  tem-field-name>:
-000198e0: 3c63 6f6c 756d 6e2d 6e61 6d65 3e7d 0a20  <column-name>}. 
-000198f0: 2020 2020 2020 2020 2020 2061 6e64 206d             and m
-00019900: 7573 7420 636f 6e74 6169 6e20 656e 7472  ust contain entr
-00019910: 7920 2769 6d61 6765 2d66 696c 656e 616d  y 'image-filenam
-00019920: 6527 2022 2222 0a20 2020 2020 2020 2069  e' """.        i
-00019930: 6620 6e6f 7420 2769 6d61 6765 2d66 696c  f not 'image-fil
-00019940: 656e 616d 6527 2069 6e20 6865 6164 6572  ename' in header
-00019950: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00019960: 6973 6520 4578 6365 7074 696f 6e28 2268  ise Exception("h
-00019970: 6561 6465 7220 646f 6573 206e 6f74 2063  eader does not c
-00019980: 6f6e 7461 696e 2027 696d 6167 652d 6669  ontain 'image-fi
-00019990: 6c65 6e61 6d65 2722 290a 2020 2020 2020  lename'").      
-000199a0: 2020 0a20 2020 2020 2020 2074 6d70 5f64    .        tmp_d
-000199b0: 6174 6120 3d20 6d69 7174 662e 7461 6246  ata = miqtf.tabF
-000199c0: 696c 6544 6174 6128 6669 6c65 2c20 6865  ileData(file, he
-000199d0: 6164 6572 2c63 6f6c 5f73 6570 6172 6174  ader,col_separat
-000199e0: 6f72 3d73 6570 6172 6174 6f72 2c20 6b65  or=separator, ke
-000199f0: 795f 636f 6c3d 2769 6d61 6765 2d66 696c  y_col='image-fil
-00019a00: 656e 616d 6527 2c63 6f6e 7665 7274 3d54  ename',convert=T
-00019a10: 7275 6529 0a20 2020 2020 2020 2073 656c  rue).        sel
-00019a20: 662e 7772 6974 6550 6172 7365 6444 6174  f.writeParsedDat
-00019a30: 6154 6f49 7465 6d73 2874 6d70 5f64 6174  aToItems(tmp_dat
-00019a40: 612c 6974 656d 732c 7365 6c66 2e69 6664  a,items,self.ifd
-00019a50: 6f5f 746d 705b 6d69 7174 762e 696d 6167  o_tmp[miqtv.imag
-00019a60: 655f 7365 745f 6865 6164 6572 5f6b 6579  e_set_header_key
-00019a70: 5d2c 2064 6174 6574 696d 655f 666f 726d  ], datetime_form
-00019a80: 6174 3d64 6174 6574 696d 655f 666f 726d  at=datetime_form
-00019a90: 6174 290a 0a0a 2020 2020 6465 6620 7772  at)...    def wr
-00019aa0: 6974 6550 6172 7365 6444 6174 6154 6f49  iteParsedDataToI
-00019ab0: 7465 6d73 2873 656c 662c 6461 7461 3a64  tems(self,data:d
-00019ac0: 6963 742c 6974 656d 733a 6469 6374 2c68  ict,items:dict,h
-00019ad0: 6561 6465 723a 6469 6374 2c20 6461 7465  eader:dict, date
-00019ae0: 7469 6d65 5f66 6f72 6d61 743a 7374 723d  time_format:str=
-00019af0: 6d69 7174 762e 6461 7465 5f66 6f72 6d61  miqtv.date_forma
-00019b00: 7473 5b27 6d61 7269 7174 275d 293a 0a0a  ts['mariqt']):..
-00019b10: 2020 2020 2020 2020 2320 6576 616c 2073          # eval s
-00019b20: 7472 696e 6773 2061 7320 6469 6374 206f  trings as dict o
-00019b30: 7220 6c69 7374 0a20 2020 2020 2020 206d  r list.        m
-00019b40: 6971 7463 2e72 6563 7572 7369 7665 4576  iqtc.recursiveEv
-00019b50: 616c 2864 6174 6129 0a0a 2020 2020 2020  al(data)..      
-00019b60: 2020 2320 706f 7465 6e74 6169 6c6c 7920    # potentailly 
-00019b70: 7265 6d6f 7665 2063 6f6e 7374 2064 6174  remove const dat
-00019b80: 6120 6672 6f6d 2069 7465 6d73 2061 6e64  a from items and
-00019b90: 2070 7574 2069 6e20 6865 6164 6572 0a20   put in header. 
-00019ba0: 2020 2020 2020 2073 656c 662e 6578 7472         self.extr
-00019bb0: 6163 7443 6f6e 7374 4461 7461 5661 6c75  actConstDataValu
-00019bc0: 6573 2864 6174 612c 6865 6164 6572 290a  es(data,header).
-00019bd0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00019be0: 6d69 7174 632e 7265 6375 7273 6976 656c  miqtc.recursivel
-00019bf0: 7952 656d 6f76 6545 6d70 7479 4669 656c  yRemoveEmptyFiel
-00019c00: 6473 2864 6174 612c 636f 6e74 656e 7432  ds(data,content2
-00019c10: 6265 5265 6d6f 7665 643d 4e6f 6e65 290a  beRemoved=None).
-00019c20: 0a20 2020 2020 2020 2023 2061 6464 2027  .        # add '
-00019c30: 696d 6167 652d 6669 6c65 6e61 6d65 2720  image-filename' 
-00019c40: 6669 656c 640a 2020 2020 2020 2020 666f  field.        fo
-00019c50: 7220 696d 672c 2065 6e74 7279 2069 6e20  r img, entry in 
-00019c60: 6461 7461 2e69 7465 6d73 2829 3a0a 0a20  data.items():.. 
-00019c70: 2020 2020 2020 2020 2020 2023 206c 6973             # lis
-00019c80: 740a 2020 2020 2020 2020 2020 2020 6966  t.            if
-00019c90: 2069 7369 6e73 7461 6e63 6528 656e 7472   isinstance(entr
-00019ca0: 792c 6c69 7374 293a 0a20 2020 2020 2020  y,list):.       
-00019cb0: 2020 2020 2020 2020 2066 6f72 206c 6973           for lis
-00019cc0: 7449 7465 6d20 696e 2065 6e74 7279 3a0a  tItem in entry:.
-00019cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ce0: 2020 2020 6c69 7374 4974 656d 5b27 696d      listItem['im
-00019cf0: 6167 652d 6669 6c65 6e61 6d65 275d 203d  age-filename'] =
-00019d00: 2069 6d67 0a20 2020 2020 2020 2020 2020   img.           
-00019d10: 2020 2020 2020 2020 2023 2063 6f76 6572           # cover
-00019d20: 7420 6461 7465 7469 6d65 2073 7472 696e  t datetime strin
-00019d30: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-00019d40: 2020 2020 2020 6966 2027 696d 6167 652d        if 'image-
-00019d50: 6461 7465 7469 6d65 2720 696e 206c 6973  datetime' in lis
-00019d60: 7449 7465 6d3a 0a20 2020 2020 2020 2020  tItem:.         
-00019d70: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00019d80: 7420 3d20 6461 7465 7469 6d65 2e64 6174  t = datetime.dat
-00019d90: 6574 696d 652e 7374 7270 7469 6d65 286c  etime.strptime(l
-00019da0: 6973 7449 7465 6d5b 2769 6d61 6765 2d64  istItem['image-d
-00019db0: 6174 6574 696d 6527 5d2c 2064 6174 6574  atetime'], datet
-00019dc0: 696d 655f 666f 726d 6174 290a 2020 2020  ime_format).    
-00019dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019de0: 2020 2020 6c69 7374 4974 656d 5b27 696d      listItem['im
-00019df0: 6167 652d 6461 7465 7469 6d65 275d 203d  age-datetime'] =
-00019e00: 2064 742e 7374 7266 7469 6d65 286d 6971   dt.strftime(miq
-00019e10: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
-00019e20: 276d 6172 6971 7427 5d29 0a20 2020 2020  'mariqt']).     
-00019e30: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-00019e40: 7374 616e 6365 2865 6e74 7279 2c64 6963  stance(entry,dic
-00019e50: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-00019e60: 2020 2020 656e 7472 795b 2769 6d61 6765      entry['image
-00019e70: 2d66 696c 656e 616d 6527 5d20 3d20 696d  -filename'] = im
-00019e80: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-00019e90: 2020 2320 636f 7665 7274 2064 6174 6574    # covert datet
-00019ea0: 696d 6520 7374 7269 6e67 0a20 2020 2020  ime string.     
-00019eb0: 2020 2020 2020 2020 2020 2069 6620 2769             if 'i
-00019ec0: 6d61 6765 2d64 6174 6574 696d 6527 2069  mage-datetime' i
-00019ed0: 6e20 656e 7472 793a 0a20 2020 2020 2020  n entry:.       
-00019ee0: 2020 2020 2020 2020 2020 2020 2064 7420               dt 
-00019ef0: 3d20 6461 7465 7469 6d65 2e64 6174 6574  = datetime.datet
-00019f00: 696d 652e 7374 7270 7469 6d65 2865 6e74  ime.strptime(ent
-00019f10: 7279 5b27 696d 6167 652d 6461 7465 7469  ry['image-dateti
-00019f20: 6d65 275d 2c20 6461 7465 7469 6d65 5f66  me'], datetime_f
-00019f30: 6f72 6d61 7429 0a20 2020 2020 2020 2020  ormat).         
-00019f40: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
-00019f50: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
-00019f60: 275d 203d 2064 742e 7374 7266 7469 6d65  '] = dt.strftime
-00019f70: 286d 6971 7476 2e64 6174 655f 666f 726d  (miqtv.date_form
-00019f80: 6174 735b 276d 6172 6971 7427 5d29 0a20  ats['mariqt']). 
-00019f90: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00019fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019fb0: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
-00019fc0: 6f45 7863 6570 7469 6f6e 2822 6461 7461  oException("data
-00019fd0: 2065 6e74 7269 6573 206d 7573 7420 6265   entries must be
-00019fe0: 2064 6963 7420 6f72 206c 6973 7420 6966   dict or list if
-00019ff0: 2064 6963 7473 2229 0a0a 2020 2020 2020   dicts")..      
-0001a000: 2020 6d69 7174 632e 7265 6375 7273 6976    miqtc.recursiv
-0001a010: 656c 7955 7064 6174 6544 6963 7473 2869  elyUpdateDicts(i
-0001a020: 7465 6d73 2c64 6174 6129 0a0a 0a20 2020  tems,data)...   
-0001a030: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
-0001a040: 2020 2064 6566 2065 7874 7261 6374 436f     def extractCo
-0001a050: 6e73 7444 6174 6156 616c 7565 7328 6461  nstDataValues(da
-0001a060: 7461 3a64 6963 742c 6865 6164 6572 3a64  ta:dict,header:d
-0001a070: 6963 7429 3a0a 2020 2020 2020 2020 2222  ict):.        ""
-0001a080: 2220 5265 6d6f 7665 7320 6669 656c 6473  " Removes fields
-0001a090: 2074 6861 7420 6172 6520 636f 6e73 7461   that are consta
-0001a0a0: 6e74 2066 6f72 2061 6c6c 2065 6e74 7269  nt for all entri
-0001a0b0: 6573 2066 726f 6d20 6461 7461 2064 6963  es from data dic
-0001a0c0: 7420 616e 6420 7075 7420 7468 656d 2069  t and put them i
-0001a0d0: 6e20 6865 6164 6572 2064 6963 742e 200a  n header dict. .
-0001a0e0: 2020 2020 2020 2020 2020 2020 4561 6368              Each
-0001a0f0: 2065 6e74 7279 206f 6620 6461 7461 206d   entry of data m
-0001a100: 7573 7420 6265 2061 2064 6963 7420 7769  ust be a dict wi
-0001a110: 7468 2074 6865 2073 616d 6520 7365 7420  th the same set 
-0001a120: 6f66 206b 6579 732e 2022 2222 0a20 2020  of keys. """.   
-0001a130: 200a 2020 2020 2020 2020 6669 656c 6473   .        fields
-0001a140: 546f 4967 6e6f 7265 203d 205b 2769 6d61  ToIgnore = ['ima
-0001a150: 6765 2d64 6174 6574 696d 6527 5d0a 2020  ge-datetime'].  
-0001a160: 2020 2020 2020 636f 6e73 7444 6174 6120        constData 
-0001a170: 3d20 7b7d 0a20 2020 2020 2020 2066 6972  = {}.        fir
-0001a180: 7374 496d 6167 6520 3d20 5472 7565 0a20  stImage = True. 
-0001a190: 2020 2020 2020 2066 6f72 2069 6d61 6765         for image
-0001a1a0: 2c69 6d61 6765 5f64 6174 6120 696e 2064  ,image_data in d
-0001a1b0: 6174 612e 6974 656d 7328 293a 0a20 2020  ata.items():.   
-0001a1c0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0001a1d0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-0001a1e0: 6e73 7461 6e63 6528 696d 6167 655f 6461  nstance(image_da
-0001a1f0: 7461 2c6c 6973 7429 3a0a 2020 2020 2020  ta,list):.      
-0001a200: 2020 2020 2020 2020 2020 696d 6167 655f            image_
-0001a210: 6461 7461 203d 205b 696d 6167 655f 6461  data = [image_da
-0001a220: 7461 5d0a 0a20 2020 2020 2020 2020 2020  ta]..           
-0001a230: 2069 6620 6e6f 7420 6669 7273 7449 6d61   if not firstIma
-0001a240: 6765 2061 6e64 2063 6f6e 7374 4461 7461  ge and constData
-0001a250: 203d 3d20 7b7d 3a0a 2020 2020 2020 2020   == {}:.        
-0001a260: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-0001a270: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0001a280: 2020 2020 2020 2066 6972 7374 5469 6d65         firstTime
-0001a290: 506f 696e 7420 3d20 5472 7565 0a20 2020  Point = True.   
-0001a2a0: 2020 2020 2020 2020 2066 6f72 2069 6d61           for ima
-0001a2b0: 6765 5f74 705f 6461 7461 2069 6e20 696d  ge_tp_data in im
-0001a2c0: 6167 655f 6461 7461 3a0a 2020 2020 2020  age_data:.      
-0001a2d0: 2020 2020 2020 2020 2020 2320 7665 7279            # very
-0001a2e0: 2066 6972 7374 2064 6174 6120 666f 7220   first data for 
-0001a2f0: 636f 6d70 6172 6973 6f6e 0a20 2020 2020  comparison.     
-0001a300: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
-0001a310: 7273 7449 6d61 6765 2061 6e64 2066 6972  rstImage and fir
-0001a320: 7374 5469 6d65 506f 696e 743a 0a20 2020  stTimePoint:.   
-0001a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a340: 2063 6f6e 7374 4461 7461 203d 2063 6f70   constData = cop
-0001a350: 792e 6465 6570 636f 7079 2869 6d61 6765  y.deepcopy(image
-0001a360: 5f74 705f 6461 7461 290a 2020 2020 2020  _tp_data).      
-0001a370: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001a380: 7220 6669 656c 6420 696e 2066 6965 6c64  r field in field
-0001a390: 7354 6f49 676e 6f72 653a 0a20 2020 2020  sToIgnore:.     
-0001a3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a3b0: 2020 2069 6620 6669 656c 6420 696e 2063     if field in c
-0001a3c0: 6f6e 7374 4461 7461 3a0a 2020 2020 2020  onstData:.      
-0001a3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a3e0: 2020 2020 2020 6465 6c20 636f 6e73 7444        del constD
-0001a3f0: 6174 615b 6669 656c 645d 0a20 2020 2020  ata[field].     
-0001a400: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001a410: 6972 7374 5469 6d65 506f 696e 7420 3d20  irstTimePoint = 
-0001a420: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0001a430: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0001a440: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
-0001a450: 2020 2020 636f 6e73 7444 6174 6120 3d20      constData = 
-0001a460: 6d69 7174 632e 6669 6e64 436f 6d6d 6f6e  miqtc.findCommon
-0001a470: 4469 6374 456c 656d 656e 7473 2869 6d61  DictElements(ima
-0001a480: 6765 5f74 705f 6461 7461 2c63 6f6e 7374  ge_tp_data,const
-0001a490: 4461 7461 290a 0a20 2020 2020 2020 2020  Data)..         
-0001a4a0: 2020 2066 6972 7374 496d 6167 6520 3d20     firstImage = 
-0001a4b0: 4661 6c73 650a 0a20 2020 2020 2020 2023  False..        #
-0001a4c0: 2054 4f44 4f20 6368 6563 6b20 7769 7468   TODO check with
-0001a4d0: 696e 2069 6d61 6765 2074 696d 6573 202d  in image times -
-0001a4e0: 3e20 746f 2069 6d61 6765 2064 6566 6175  > to image defau
-0001a4f0: 6c74 2e20 2874 7269 636b 7920 7369 6e63  lt. (tricky sinc
-0001a500: 6520 7765 2064 6f6e 2774 2068 6176 6520  e we don't have 
-0001a510: 7468 6520 6461 6661 756c 7420 696e 6465  the dafault inde
-0001a520: 7820 6865 7265 2e20 4f6e 6c79 2061 2073  x here. Only a s
-0001a530: 7562 7365 7420 6d69 6768 7420 6265 2075  ubset might be u
-0001a540: 7064 6174 6520 6865 7265 290a 2020 2020  pdate here).    
-0001a550: 2020 2020 2320 6368 6563 6b20 7769 7468      # check with
-0001a560: 696e 2069 6d61 6765 2069 7465 6d73 202d  in image items -
-0001a570: 3e20 6865 6164 6572 0a20 2020 2020 2020  > header.       
-0001a580: 2068 6561 6465 7255 7064 6174 6520 3d20   headerUpdate = 
-0001a590: 636f 7079 2e64 6565 7063 6f70 7928 636f  copy.deepcopy(co
-0001a5a0: 6e73 7444 6174 6129 0a20 2020 2020 2020  nstData).       
-0001a5b0: 2068 6561 6465 7255 7064 6174 6564 5465   headerUpdatedTe
-0001a5c0: 7374 203d 2063 6f70 792e 6465 6570 636f  st = copy.deepco
-0001a5d0: 7079 2868 6561 6465 7229 0a20 2020 2020  py(header).     
-0001a5e0: 2020 206d 6971 7463 2e72 6563 7572 7369     miqtc.recursi
-0001a5f0: 7665 6c79 5570 6461 7465 4469 6374 7328  velyUpdateDicts(
-0001a600: 6865 6164 6572 5570 6461 7465 6454 6573  headerUpdatedTes
-0001a610: 742c 6865 6164 6572 5570 6461 7465 290a  t,headerUpdate).
-0001a620: 2020 2020 2020 2020 7570 6461 7465 4469          updateDi
-0001a630: 6666 203d 2044 6565 7044 6966 6628 6865  ff = DeepDiff(he
-0001a640: 6164 6572 2c68 6561 6465 7255 7064 6174  ader,headerUpdat
-0001a650: 6564 5465 7374 290a 2020 2020 2020 2020  edTest).        
-0001a660: 2320 6368 6563 6b20 6966 2068 6561 6465  # check if heade
-0001a670: 7255 7064 6174 6520 776f 756c 6420 6f76  rUpdate would ov
-0001a680: 6572 7772 6974 6520 616e 7974 6869 6e67  erwrite anything
-0001a690: 2066 726f 6d20 6375 7272 656e 7420 6865   from current he
-0001a6a0: 6164 6572 2028 7368 6f75 6c64 206e 6f74  ader (should not
-0001a6b0: 2068 6170 7065 6e29 2c20 6966 2073 6f20   happen), if so 
-0001a6c0: 646f 6e74 2072 656d 6f76 6520 6672 6f6d  dont remove from
-0001a6d0: 2069 7465 6d73 0a20 2020 2020 2020 2069   items.        i
-0001a6e0: 6620 6e6f 7420 2776 616c 7565 735f 6368  f not 'values_ch
-0001a6f0: 616e 6765 6427 2069 6e20 7570 6461 7465  anged' in update
-0001a700: 4469 6666 2061 6e64 206e 6f74 2027 7479  Diff and not 'ty
-0001a710: 7065 5f63 6861 6e67 6573 2720 696e 2075  pe_changes' in u
-0001a720: 7064 6174 6544 6966 6620 616e 6420 6e6f  pdateDiff and no
-0001a730: 7420 2764 6963 7469 6f6e 6172 795f 6974  t 'dictionary_it
-0001a740: 656d 5f72 656d 6f76 6564 2720 696e 2075  em_removed' in u
-0001a750: 7064 6174 6544 6966 663a 0a20 2020 2020  pdateDiff:.     
-0001a760: 2020 2020 2020 2068 6561 6465 722e 636c         header.cl
-0001a770: 6561 7228 290a 2020 2020 2020 2020 2020  ear().          
-0001a780: 2020 6865 6164 6572 2e75 7064 6174 6528    header.update(
-0001a790: 6865 6164 6572 5570 6461 7465 6454 6573  headerUpdatedTes
-0001a7a0: 7429 0a0a 2020 2020 2020 2020 2020 2020  t)..            
-0001a7b0: 2320 7265 6d6f 7665 2063 6f6e 7374 2076  # remove const v
-0001a7c0: 616c 7565 7320 6672 6f6d 2064 6174 610a  alues from data.
-0001a7d0: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
-0001a7e0: 632e 7265 6375 7273 6976 654d 616b 654e  c.recursiveMakeN
-0001a7f0: 6f6e 6544 6963 7446 6965 6c64 7345 6d70  oneDictFieldsEmp
-0001a800: 7479 5374 7228 636f 6e73 7444 6174 6129  tyStr(constData)
-0001a810: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0001a820: 2069 6d61 6765 2c69 6d61 6765 5f64 6174   image,image_dat
-0001a830: 6120 696e 2064 6174 612e 6974 656d 7328  a in data.items(
-0001a840: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001a850: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-0001a860: 616e 6365 2869 6d61 6765 5f64 6174 612c  ance(image_data,
-0001a870: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
-0001a880: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-0001a890: 5f64 6174 6120 3d20 5b69 6d61 6765 5f64  _data = [image_d
-0001a8a0: 6174 615d 0a20 2020 2020 2020 2020 2020  ata].           
-0001a8b0: 2020 2020 2066 6f72 2069 6d61 6765 5f74       for image_t
-0001a8c0: 705f 6461 7461 2069 6e20 696d 6167 655f  p_data in image_
-0001a8d0: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-0001a8e0: 2020 2020 2020 2020 2020 6d69 7174 632e            miqtc.
-0001a8f0: 7265 6375 7273 6976 656c 7955 7064 6174  recursivelyUpdat
-0001a900: 6544 6963 7473 2869 6d61 6765 5f74 705f  eDicts(image_tp_
-0001a910: 6461 7461 2c63 6f6e 7374 4461 7461 2920  data,constData) 
-0001a920: 2020 2020 2020 2020 200a 0a20 2020 2020           ..     
-0001a930: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001a940: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-0001a950: 2020 2020 2020 2320 544f 444f 206c 6f67        # TODO log
-0001a960: 3f0a 2020 2020 200a 0a20 2020 2064 6566  ?.     ..    def
-0001a970: 2069 6e74 6572 6d65 6469 6174 654e 6176   intermediateNav
-0001a980: 4669 6c65 4578 6973 7473 2873 656c 6629  FileExists(self)
-0001a990: 3a0a 2020 2020 2020 2020 6966 206f 732e  :.        if os.
-0001a9a0: 7061 7468 2e65 7869 7374 7328 7365 6c66  path.exists(self
-0001a9b0: 2e67 6574 5f69 6e74 5f6e 6176 5f66 696c  .get_int_nav_fil
-0001a9c0: 6528 2929 3a0a 2020 2020 2020 2020 2020  e()):.          
-0001a9d0: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
-0001a9e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001a9f0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-0001aa00: 616c 7365 0a0a 0a20 2020 2064 6566 2068  alse...    def h
-0001aa10: 6561 6465 7246 6965 6c64 4669 6c6c 6564  eaderFieldFilled
-0001aa20: 2873 656c 662c 6669 656c 643a 7374 7229  (self,field:str)
-0001aa30: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
-0001aa40: 662e 6669 6e64 546d 7046 6965 6c64 3228  f.findTmpField2(
-0001aa50: 6669 656c 6429 203d 3d20 2222 3a0a 2020  field) == "":.  
-0001aa60: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001aa70: 2046 616c 7365 0a20 2020 2020 2020 2072   False.        r
-0001aa80: 6574 7572 6e20 5472 7565 0a0a 2020 2020  eturn True..    
-0001aa90: 6465 6620 636f 6e76 6572 7454 6f44 6566  def convertToDef
-0001aaa0: 6175 6c74 4461 7465 5469 6d65 466f 726d  aultDateTimeForm
-0001aab0: 6174 2873 656c 662c 6966 646f 293a 0a20  at(self,ifdo):. 
-0001aac0: 2020 2020 2020 2022 2222 2043 6865 636b         """ Check
-0001aad0: 7320 6966 2061 6c6c 2069 7465 6d73 2720  s if all items' 
-0001aae0: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
-0001aaf0: 2066 6965 6c64 7320 6d61 7463 6820 6465   fields match de
-0001ab00: 6661 756c 7420 6461 7465 7469 6d65 2066  fault datetime f
-0001ab10: 6f72 6d61 7420 6f72 2061 2063 7573 746f  ormat or a custo
-0001ab20: 6d20 6f6e 6520 6465 6669 6e65 6420 696e  m one defined in
-0001ab30: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
-0001ab40: 2d66 6f72 6d61 7427 0a20 2020 2020 2020  -format'.       
-0001ab50: 2020 2020 2061 6e64 2063 6f6e 7665 7274       and convert
-0001ab60: 7320 746f 2064 6566 6175 6c74 2066 6f72  s to default for
-0001ab70: 6d61 742e 2054 6872 6f77 7320 6578 6365  mat. Throws exce
-0001ab80: 7074 696f 6e20 6966 2064 6174 6574 696d  ption if datetim
-0001ab90: 6520 6361 6e6e 6f74 2062 6520 7061 7273  e cannot be pars
-0001aba0: 6564 2022 2222 0a20 2020 2020 2020 2063  ed """.        c
-0001abb0: 7573 746f 6d44 6174 6554 696d 6546 6f72  ustomDateTimeFor
-0001abc0: 6d61 7446 6f75 6e64 203d 2046 616c 7365  matFound = False
-0001abd0: 0a20 2020 2020 2020 2068 6561 6465 7243  .        headerC
-0001abe0: 7573 746f 6d44 6174 6554 696d 6546 6f72  ustomDateTimeFor
-0001abf0: 6d61 7420 3d20 6669 6e64 4669 656c 6428  mat = findField(
-0001ac00: 6966 646f 5b73 656c 662e 696d 6167 6553  ifdo[self.imageS
-0001ac10: 6574 4865 6164 6572 4b65 795d 2c27 696d  etHeaderKey],'im
-0001ac20: 6167 652d 6461 7465 7469 6d65 2d66 6f72  age-datetime-for
-0001ac30: 6d61 7427 290a 2020 2020 2020 2020 6966  mat').        if
-0001ac40: 2068 6561 6465 7243 7573 746f 6d44 6174   headerCustomDat
-0001ac50: 6554 696d 6546 6f72 6d61 7420 213d 2022  eTimeFormat != "
-0001ac60: 223a 0a20 2020 2020 2020 2020 2020 2069  ":.            i
-0001ac70: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
-0001ac80: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
-0001ac90: 6765 2d64 6174 6574 696d 652d 666f 726d  ge-datetime-form
-0001aca0: 6174 275d 203d 2022 2220 2320 7265 6d6f  at'] = "" # remo
-0001acb0: 7665 2063 7573 746f 6d20 666f 726d 6174  ve custom format
-0001acc0: 0a20 2020 2020 2020 2020 2020 2063 7573  .            cus
-0001acd0: 746f 6d44 6174 6554 696d 6546 6f72 6d61  tomDateTimeForma
-0001ace0: 7446 6f75 6e64 203d 2054 7275 650a 2020  tFound = True.  
-0001acf0: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
-0001ad00: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
-0001ad10: 6772 6573 734d 7367 2822 4368 6563 6b69  gressMsg("Checki
-0001ad20: 6e67 2064 6174 6574 696d 6520 666f 726d  ng datetime form
-0001ad30: 6174 222c 206c 656e 2869 6664 6f5b 7365  at", len(ifdo[se
-0001ad40: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-0001ad50: 4b65 795d 292c 6d6f 6475 6c6f 3d31 290a  Key]),modulo=1).
-0001ad60: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
-0001ad70: 2c69 7465 6d20 696e 2069 6664 6f5b 7365  ,item in ifdo[se
-0001ad80: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-0001ad90: 4b65 795d 2e69 7465 6d73 2829 3a0a 2020  Key].items():.  
-0001ada0: 2020 2020 2020 2020 2020 7072 6f67 2e70            prog.p
-0001adb0: 726f 6772 6573 7328 290a 2020 2020 2020  rogress().      
-0001adc0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-0001add0: 6e73 7461 6e63 6528 6974 656d 2c6c 6973  nstance(item,lis
-0001ade0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0001adf0: 2020 2020 2020 2020 6974 656d 203d 205b          item = [
-0001ae00: 6974 656d 5d0a 2020 2020 2020 2020 2020  item].          
-0001ae10: 2020 7375 6249 7465 6d44 6566 6175 6c74    subItemDefault
-0001ae20: 203d 2069 7465 6d5b 305d 0a20 2020 2020   = item[0].     
-0001ae30: 2020 2020 2020 2069 7465 6d43 7573 746f         itemCusto
-0001ae40: 6d44 6174 6554 696d 6546 6f72 6d61 7420  mDateTimeFormat 
-0001ae50: 3d20 2222 0a20 2020 2020 2020 2020 2020  = "".           
-0001ae60: 2069 6620 2769 6d61 6765 2d64 6174 6574   if 'image-datet
-0001ae70: 696d 652d 666f 726d 6174 2720 696e 2073  ime-format' in s
-0001ae80: 7562 4974 656d 4465 6661 756c 743a 0a20  ubItemDefault:. 
-0001ae90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001aea0: 7465 6d43 7573 746f 6d44 6174 6554 696d  temCustomDateTim
-0001aeb0: 6546 6f72 6d61 7420 3d20 7375 6249 7465  eFormat = subIte
-0001aec0: 6d44 6566 6175 6c74 5b27 696d 6167 652d  mDefault['image-
-0001aed0: 6461 7465 7469 6d65 2d66 6f72 6d61 7427  datetime-format'
-0001aee0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001aef0: 2020 7375 6249 7465 6d44 6566 6175 6c74    subItemDefault
-0001af00: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
-0001af10: 2d66 6f72 6d61 7427 5d20 3d20 2222 2023  -format'] = "" #
-0001af20: 2072 656d 6f76 6520 6375 7374 6f6d 2066   remove custom f
-0001af30: 6f72 6d61 740a 2020 2020 2020 2020 2020  ormat.          
-0001af40: 2020 2020 2020 6375 7374 6f6d 4461 7465        customDate
-0001af50: 5469 6d65 466f 726d 6174 466f 756e 6420  TimeFormatFound 
-0001af60: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-0001af70: 2020 2066 6f72 2073 7562 4974 656d 2069     for subItem i
-0001af80: 6e20 6974 656d 3a0a 2020 2020 2020 2020  n item:.        
-0001af90: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0001afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afb0: 2066 6f72 6d61 7420 3d20 6d69 7174 762e   format = miqtv.
-0001afc0: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
-0001afd0: 7269 7174 275d 0a20 2020 2020 2020 2020  riqt'].         
-0001afe0: 2020 2020 2020 2020 2020 2064 6174 6574             datet
-0001aff0: 696d 652e 6461 7465 7469 6d65 2e73 7472  ime.datetime.str
-0001b000: 7074 696d 6528 7375 6249 7465 6d5b 2769  ptime(subItem['i
-0001b010: 6d61 6765 2d64 6174 6574 696d 6527 5d2c  mage-datetime'],
-0001b020: 666f 726d 6174 290a 2020 2020 2020 2020  format).        
-0001b030: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
-0001b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b050: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0001b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b070: 2066 6f72 6d61 7420 3d20 6865 6164 6572   format = header
-0001b080: 4375 7374 6f6d 4461 7465 5469 6d65 466f  CustomDateTimeFo
-0001b090: 726d 6174 0a20 2020 2020 2020 2020 2020  rmat.           
-0001b0a0: 2020 2020 2020 2020 2020 2020 2064 7420               dt 
-0001b0b0: 3d20 6461 7465 7469 6d65 2e64 6174 6574  = datetime.datet
-0001b0c0: 696d 652e 7374 7270 7469 6d65 2873 7562  ime.strptime(sub
-0001b0d0: 4974 656d 5b27 696d 6167 652d 6461 7465  Item['image-date
-0001b0e0: 7469 6d65 275d 2c66 6f72 6d61 7429 0a20  time'],format). 
-0001b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b100: 2020 2020 2020 2073 7562 4974 656d 5b27         subItem['
-0001b110: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
-0001b120: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
-0001b130: 7469 6d65 2e73 7472 6674 696d 6528 6474  time.strftime(dt
-0001b140: 2c6d 6971 7476 2e64 6174 655f 666f 726d  ,miqtv.date_form
-0001b150: 6174 735b 276d 6172 6971 7427 5d29 0a20  ats['mariqt']). 
-0001b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b170: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
-0001b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b190: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0001b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1b0: 2020 2020 666f 726d 6174 203d 2069 7465      format = ite
-0001b1c0: 6d43 7573 746f 6d44 6174 6554 696d 6546  mCustomDateTimeF
-0001b1d0: 6f72 6d61 740a 2020 2020 2020 2020 2020  ormat.          
-0001b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1f0: 2020 6474 203d 2064 6174 6574 696d 652e    dt = datetime.
-0001b200: 6461 7465 7469 6d65 2e73 7472 7074 696d  datetime.strptim
-0001b210: 6528 7375 6249 7465 6d5b 2769 6d61 6765  e(subItem['image
-0001b220: 2d64 6174 6574 696d 6527 5d2c 666f 726d  -datetime'],form
-0001b230: 6174 290a 2020 2020 2020 2020 2020 2020  at).            
-0001b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b250: 7375 6249 7465 6d5b 2769 6d61 6765 2d64  subItem['image-d
-0001b260: 6174 6574 696d 6527 5d20 3d20 6461 7465  atetime'] = date
-0001b270: 7469 6d65 2e64 6174 6574 696d 652e 7374  time.datetime.st
-0001b280: 7266 7469 6d65 2864 742c 6d69 7174 762e  rftime(dt,miqtv.
-0001b290: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
-0001b2a0: 7269 7174 275d 290a 2020 2020 2020 2020  riqt']).        
-0001b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2c0: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-0001b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2e0: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
-0001b2f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b300: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0001b310: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
-0001b320: 6570 7469 6f6e 2827 496e 7661 6c69 6420  eption('Invalid 
-0001b330: 6461 7465 7469 6d65 2076 616c 7565 272c  datetime value',
-0001b340: 7375 6249 7465 6d5b 2769 6d61 6765 2d64  subItem['image-d
-0001b350: 6174 6574 696d 6527 5d2c 2022 646f 6573  atetime'], "does
-0001b360: 206e 6f74 206d 6174 6368 2066 6f72 6d61   not match forma
-0001b370: 7420 6465 6661 756c 7420 6f72 2063 7573  t default or cus
-0001b380: 746f 6d20 666f 726d 6174 2229 0a20 2020  tom format").   
-0001b390: 2020 2020 2069 6620 6375 7374 6f6d 4461       if customDa
-0001b3a0: 7465 5469 6d65 466f 726d 6174 466f 756e  teTimeFormatFoun
-0001b3b0: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
-0001b3c0: 656c 662e 7072 6f76 2e6c 6f67 2822 4375  elf.prov.log("Cu
-0001b3d0: 7374 6f6d 2064 6174 6574 696d 6520 666f  stom datetime fo
-0001b3e0: 726d 6174 7320 666f 756e 642e 2054 6865  rmats found. The
-0001b3f0: 7920 7769 6c6c 2062 6520 7265 706c 6163  y will be replac
-0001b400: 6564 2062 7920 7468 6520 6465 6661 756c  ed by the defaul
-0001b410: 7420 666f 726d 6174 2e22 2920 2020 0a20  t format.")   . 
-0001b420: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
-0001b430: 7228 2920 2020 200a 0a0a 2020 2020 6465  r()    ...    de
-0001b440: 6620 5f5f 696e 6974 496e 7465 726d 6564  f __initIntermed
-0001b450: 6961 7465 4669 6c65 7328 7365 6c66 293a  iateFiles(self):
-0001b460: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-0001b470: 7465 726d 6564 6961 7465 4669 6c65 7344  termediateFilesD
-0001b480: 6566 5f63 6f72 6520 3d20 7b0a 2020 2020  ef_core = {.    
-0001b490: 2020 2020 2020 2020 2768 6173 6865 7327          'hashes'
-0001b4a0: 3a20 7b0a 2020 2020 2020 2020 2020 2020  : {.            
-0001b4b0: 2020 2020 2763 7265 6174 696f 6e46 6374      'creationFct
-0001b4c0: 273a 2027 6372 6561 7465 5f69 6d61 6765  ': 'create_image
-0001b4d0: 5f73 6861 3235 365f 6669 6c65 2829 272c  _sha256_file()',
-0001b4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b4f0: 2027 7375 6666 6978 273a 2027 5f69 6d61   'suffix': '_ima
-0001b500: 6765 2d68 6173 6865 732e 7478 7427 2c0a  ge-hashes.txt',.
-0001b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b520: 2763 6f6c 7327 3a20 5b6d 6971 7476 2e63  'cols': [miqtv.c
-0001b530: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-0001b540: 7427 5d5b 2768 6173 6827 5d5d 2c0a 2020  t']['hash']],.  
-0001b550: 2020 2020 2020 2020 2020 2020 2020 276f                'o
-0001b560: 7074 696f 6e61 6c27 3a20 5b5d 7d2c 0a20  ptional': []},. 
-0001b570: 2020 2020 2020 2020 2020 2027 7575 6964             'uuid
-0001b580: 7327 3a20 7b0a 2020 2020 2020 2020 2020  s': {.          
-0001b590: 2020 2020 2020 2763 7265 6174 696f 6e46        'creationF
-0001b5a0: 6374 273a 2027 6372 6561 7465 5f75 7569  ct': 'create_uui
-0001b5b0: 645f 6669 6c65 2829 272c 0a20 2020 2020  d_file()',.     
-0001b5c0: 2020 2020 2020 2020 2020 2027 7375 6666             'suff
-0001b5d0: 6978 273a 2027 5f69 6d61 6765 2d75 7569  ix': '_image-uui
-0001b5e0: 6473 2e74 7874 272c 0a20 2020 2020 2020  ds.txt',.       
-0001b5f0: 2020 2020 2020 2020 2027 636f 6c73 273a           'cols':
-0001b600: 205b 6d69 7174 762e 636f 6c5f 6865 6164   [miqtv.col_head
-0001b610: 6572 5b27 6d61 7269 7174 275d 5b27 7575  er['mariqt']['uu
-0001b620: 6964 275d 5d2c 0a20 2020 2020 2020 2020  id']],.         
-0001b630: 2020 2020 2020 2027 6f70 7469 6f6e 616c         'optional
-0001b640: 273a 205b 5d7d 2c0a 2020 2020 2020 2020  ': []},.        
-0001b650: 2020 2020 2764 6174 6574 696d 6527 3a20      'datetime': 
-0001b660: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-0001b670: 2020 2763 7265 6174 696f 6e46 6374 273a    'creationFct':
-0001b680: 2027 6372 6561 7465 5f73 7461 7274 5f74   'create_start_t
-0001b690: 696d 655f 6669 6c65 2829 272c 0a20 2020  ime_file()',.   
-0001b6a0: 2020 2020 2020 2020 2020 2020 2027 7375               'su
-0001b6b0: 6666 6978 273a 2027 5f69 6d61 6765 2d73  ffix': '_image-s
-0001b6c0: 7461 7274 2d74 696d 6573 2e74 7874 272c  tart-times.txt',
-0001b6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b6e0: 2027 636f 6c73 273a 205b 6d69 7174 762e   'cols': [miqtv.
-0001b6f0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-0001b700: 7174 275d 5b27 7574 6327 5d5d 2c0a 2020  qt']['utc']],.  
-0001b710: 2020 2020 2020 2020 2020 2020 2020 276f                'o
-0001b720: 7074 696f 6e61 6c27 3a20 5b5d 7d2c 0a20  ptional': []},. 
-0001b730: 2020 2020 2020 2020 2020 2027 6e61 7669             'navi
-0001b740: 6761 7469 6f6e 273a 207b 0a20 2020 2020  gation': {.     
-0001b750: 2020 2020 2020 2020 2020 2027 6372 6561             'crea
-0001b760: 7469 6f6e 4663 7427 3a20 2763 7265 6174  tionFct': 'creat
-0001b770: 655f 696d 6167 655f 6e61 7669 6761 7469  e_image_navigati
-0001b780: 6f6e 5f66 696c 6528 2927 2c0a 2020 2020  on_file()',.    
-0001b790: 2020 2020 2020 2020 2020 2020 2773 7566              'suf
-0001b7a0: 6669 7827 3a20 275f 696d 6167 652d 6e61  fix': '_image-na
-0001b7b0: 7669 6761 7469 6f6e 2e74 7874 272c 0a20  vigation.txt',. 
-0001b7c0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001b7d0: 636f 6c73 273a 205b 6d69 7174 762e 636f  cols': [miqtv.co
-0001b7e0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-0001b7f0: 275d 5b27 7574 6327 5d5d 2c0a 2020 2020  ']['utc']],.    
-0001b800: 2020 2020 2020 2020 2020 2020 276f 7074              'opt
-0001b810: 696f 6e61 6c27 3a20 5b6d 6971 7476 2e63  ional': [miqtv.c
-0001b820: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-0001b830: 7427 5d5b 276c 6f6e 275d 2c20 6d69 7174  t']['lon'], miqt
-0001b840: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-0001b850: 7269 7174 275d 5b27 6c61 7427 5d2c 206d  riqt']['lat'], m
-0001b860: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-0001b870: 276d 6172 6971 7427 5d5b 2761 6c74 275d  'mariqt']['alt']
-0001b880: 2c20 6d69 7174 762e 636f 6c5f 6865 6164  , miqtv.col_head
-0001b890: 6572 5b27 6d61 7269 7174 275d 5b27 6867  er['mariqt']['hg
-0001b8a0: 7427 5d2c 206d 6971 7476 2e63 6f6c 5f68  t'], miqtv.col_h
-0001b8b0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-0001b8c0: 2775 6e63 6572 7427 5d5d 7d2c 0a20 2020  'uncert']]},.   
-0001b8d0: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-0001b8e0: 7365 6c66 2e6e 6f6e 436f 7265 4669 656c  self.nonCoreFiel
-0001b8f0: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
-0001b900: 6d49 6e66 6f46 696c 6573 203d 205b 5d0a  mInfoFiles = [].
-0001b910: 0a20 2020 2064 6566 205f 5f67 6574 5f69  .    def __get_i
-0001b920: 6e74 5f66 696c 655f 7072 6566 6978 2873  nt_file_prefix(s
-0001b930: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-0001b940: 2220 6465 7065 6e64 7320 6f6e 2027 696d  " depends on 'im
-0001b950: 6167 652d 6576 656e 7427 2061 6e64 2027  age-event' and '
-0001b960: 696d 6167 652d 7365 6e73 6f72 2720 736f  image-sensor' so
-0001b970: 2069 7420 6361 6e20 6368 616e 6765 2064   it can change d
-0001b980: 7572 696e 6720 7570 6174 6520 2222 220a  uring upate """.
-0001b990: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-0001b9a0: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
-0001b9b0: 2e64 6972 2e74 6f28 7365 6c66 2e64 6972  .dir.to(self.dir
-0001b9c0: 2e64 742e 696e 7465 726d 6564 6961 7465  .dt.intermediate
-0001b9d0: 292c 2073 656c 662e 6669 6e64 546d 7046  ), self.findTmpF
-0001b9e0: 6965 6c64 2827 696d 6167 652d 7365 742d  ield('image-set-
-0001b9f0: 6e61 6d65 2729 290a 0a20 2020 2064 6566  name'))..    def
-0001ba00: 2067 6574 5f69 6e74 5f68 6173 685f 6669   get_int_hash_fi
-0001ba10: 6c65 2873 656c 6629 3a0a 2020 2020 2020  le(self):.      
-0001ba20: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
-0001ba30: 6765 745f 696e 745f 6669 6c65 5f70 7265  get_int_file_pre
-0001ba40: 6669 7828 2920 2b20 7365 6c66 2e69 6e74  fix() + self.int
-0001ba50: 6572 6d65 6469 6174 6546 696c 6573 4465  ermediateFilesDe
-0001ba60: 665f 636f 7265 5b27 6861 7368 6573 275d  f_core['hashes']
-0001ba70: 5b27 7375 6666 6978 275d 0a0a 2020 2020  ['suffix']..    
-0001ba80: 6465 6620 6765 745f 696e 745f 7575 6964  def get_int_uuid
-0001ba90: 5f66 696c 6528 7365 6c66 293a 0a20 2020  _file(self):.   
-0001baa0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001bab0: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
-0001bac0: 7072 6566 6978 2829 202b 2073 656c 662e  prefix() + self.
-0001bad0: 696e 7465 726d 6564 6961 7465 4669 6c65  intermediateFile
-0001bae0: 7344 6566 5f63 6f72 655b 2775 7569 6473  sDef_core['uuids
-0001baf0: 275d 5b27 7375 6666 6978 275d 0a0a 2020  ']['suffix']..  
-0001bb00: 2020 6465 6620 6765 745f 696e 745f 7374    def get_int_st
-0001bb10: 6172 7454 696d 6573 5f66 696c 6528 7365  artTimes_file(se
-0001bb20: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-0001bb30: 7572 6e20 7365 6c66 2e5f 5f67 6574 5f69  urn self.__get_i
-0001bb40: 6e74 5f66 696c 655f 7072 6566 6978 2829  nt_file_prefix()
-0001bb50: 202b 2073 656c 662e 696e 7465 726d 6564   + self.intermed
-0001bb60: 6961 7465 4669 6c65 7344 6566 5f63 6f72  iateFilesDef_cor
-0001bb70: 655b 2764 6174 6574 696d 6527 5d5b 2773  e['datetime']['s
-0001bb80: 7566 6669 7827 5d0a 0a20 2020 2064 6566  uffix']..    def
-0001bb90: 2067 6574 5f69 6e74 5f6e 6176 5f66 696c   get_int_nav_fil
-0001bba0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-0001bbb0: 2072 6574 7572 6e20 7365 6c66 2e5f 5f67   return self.__g
-0001bbc0: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
-0001bbd0: 6978 2829 202b 2073 656c 662e 696e 7465  ix() + self.inte
-0001bbe0: 726d 6564 6961 7465 4669 6c65 7344 6566  rmediateFilesDef
-0001bbf0: 5f63 6f72 655b 276e 6176 6967 6174 696f  _core['navigatio
-0001bc00: 6e27 5d5b 2773 7566 6669 7827 5d0a 0a    n']['suffix']..
+00017ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ad0: 2020 2020 205b 666c 6f61 7428 696d 6167       [float(imag
+00017ae0: 655f 6474 735b 6669 6c65 5d5b 305d 2e6c  e_dts[file][0].l
+00017af0: 6f6e 292c 2066 6c6f 6174 2869 6d61 6765  on), float(image
+00017b00: 5f64 7473 5b66 696c 655d 5b30 5d2e 6c61  _dts[file][0].la
+00017b10: 7429 5d0a 2020 2020 2020 2020 2020 2020  t)].            
+00017b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b30: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00017b40: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00017b50: 2054 7275 6520 696e 205b 6d61 7468 2e69   True in [math.i
+00017b60: 736e 616e 2878 2920 666f 7220 7820 696e  snan(x) for x in
+00017b70: 2067 656f 6d65 7472 795b 2763 6f6f 7264   geometry['coord
+00017b80: 696e 6174 6573 275d 5d3a 0a20 2020 2020  inates']]:.     
+00017b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ba0: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
+00017bb0: 2020 2020 2020 2020 2020 2020 2023 2076               # v
+00017bc0: 6964 656f 0a20 2020 2020 2020 2020 2020  ideo.           
+00017bd0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00017be0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00017bf0: 6620 6465 705f 6e6f 745f 7a65 726f 3a0a  f dep_not_zero:.
+00017c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c10: 2020 2020 2020 2020 6765 6f6d 6574 7279          geometry
+00017c20: 203d 2020 7b27 7479 7065 273a 2022 4d75   =  {'type': "Mu
+00017c30: 6c74 6950 6f69 6e74 222c 2027 636f 6f72  ltiPoint", 'coor
+00017c40: 6469 6e61 7465 7327 3a0a 2020 2020 2020  dinates':.      
+00017c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c70: 2020 5b5b 666c 6f61 7428 642e 6c6f 6e29    [[float(d.lon)
+00017c80: 2c20 666c 6f61 7428 642e 6c61 7429 2c20  , float(d.lat), 
+00017c90: 666c 6f61 7428 642e 6465 7029 5d20 666f  float(d.dep)] fo
+00017ca0: 7220 6420 696e 2069 6d61 6765 5f64 7473  r d in image_dts
+00017cb0: 5b66 696c 655d 5d0a 2020 2020 2020 2020  [file]].        
+00017cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017cd0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+00017ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017cf0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00017d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d10: 6765 6f6d 6574 7279 203d 2020 7b27 7479  geometry =  {'ty
+00017d20: 7065 273a 2022 4d75 6c74 6950 6f69 6e74  pe': "MultiPoint
+00017d30: 222c 2027 636f 6f72 6469 6e61 7465 7327  ", 'coordinates'
+00017d40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d60: 2020 2020 2020 2020 2020 5b5b 666c 6f61            [[floa
+00017d70: 7428 642e 6c6f 6e29 2c20 666c 6f61 7428  t(d.lon), float(
+00017d80: 642e 6c61 7429 5d20 666f 7220 6420 696e  d.lat)] for d in
+00017d90: 2069 6d61 6765 5f64 7473 5b66 696c 655d   image_dts[file]
+00017da0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00017db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017dc0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00017dd0: 2020 2020 2020 2020 2020 2020 6966 2054              if T
+00017de0: 7275 6520 696e 205b 6d61 7468 2e69 736e  rue in [math.isn
+00017df0: 616e 2878 2920 666f 7220 7820 696e 205b  an(x) for x in [
+00017e00: 6974 656d 2066 6f72 2073 7562 6c69 7374  item for sublist
+00017e10: 2069 6e20 6765 6f6d 6574 7279 5b27 636f   in geometry['co
+00017e20: 6f72 6469 6e61 7465 7327 5d20 666f 7220  ordinates'] for 
+00017e30: 6974 656d 2069 6e20 7375 626c 6973 745d  item in sublist]
+00017e40: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00017e50: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00017e60: 6e75 650a 0a20 2020 2020 2020 2020 2020  nue..           
+00017e70: 2020 2020 2067 656f 6a73 6f6e 5b27 6665       geojson['fe
+00017e80: 6174 7572 6573 275d 2e61 7070 656e 6428  atures'].append(
+00017e90: 7b27 7479 7065 273a 2027 4665 6174 7572  {'type': 'Featur
+00017ea0: 6527 2c20 2770 726f 7065 7274 6965 7327  e', 'properties'
+00017eb0: 3a20 7b27 6964 273a 2066 696c 657d 2c20  : {'id': file}, 
+00017ec0: 2767 656f 6d65 7472 7927 3a20 6765 6f6d  'geometry': geom
+00017ed0: 6574 7279 207d 290a 2020 2020 2020 2020  etry }).        
+00017ee0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00017ef0: 2020 2020 206f 203d 206f 7065 6e28 7365       o = open(se
+00017f00: 6c66 2e67 6574 5f69 6e74 5f6e 6176 5f66  lf.get_int_nav_f
+00017f10: 696c 6528 292e 7265 706c 6163 6528 222e  ile().replace(".
+00017f20: 7478 7422 2c20 222e 6765 6f6a 736f 6e22  txt", ".geojson"
+00017f30: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00017f40: 2020 2020 2020 2020 2277 222c 2065 7272          "w", err
+00017f50: 6f72 733d 2269 676e 6f72 6522 2c20 656e  ors="ignore", en
+00017f60: 636f 6469 6e67 3d27 7574 662d 3827 290a  coding='utf-8').
+00017f70: 2020 2020 2020 2020 2020 2020 6a73 6f6e              json
+00017f80: 2e64 756d 7028 6765 6f6a 736f 6e2c 206f  .dump(geojson, o
+00017f90: 2c20 656e 7375 7265 5f61 7363 6969 3d46  , ensure_ascii=F
+00017fa0: 616c 7365 2c20 696e 6465 6e74 3d34 290a  alse, indent=4).
+00017fb0: 2020 2020 2020 2020 2020 2020 6f2e 636c              o.cl
+00017fc0: 6f73 6528 290a 0a20 2020 2020 2020 2020  ose()..         
+00017fd0: 2020 2073 656c 662e 7072 6f76 2e61 6464     self.prov.add
+00017fe0: 4172 6775 6d65 6e74 2822 696e 7075 744e  Argument("inputN
+00017ff0: 6176 6967 6174 696f 6e46 696c 6522 2c6e  avigationFile",n
+00018000: 6176 5f70 6174 682c 6f76 6572 7772 6974  av_path,overwrit
+00018010: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
+00018020: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00018030: 6728 2270 6172 7365 6420 6672 6f6d 2069  g("parsed from i
+00018040: 6e70 7574 4e61 7669 6761 7469 6f6e 4669  nputNavigationFi
+00018050: 6c65 3a20 2220 2b20 7374 7228 6e61 765f  le: " + str(nav_
+00018060: 6865 6164 6572 292c 646f 6e74 5368 6f77  header),dontShow
+00018070: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00018080: 2020 2073 2e73 746f 7028 290a 2020 2020     s.stop().    
+00018090: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+000180a0: 7275 652c 2022 4e61 7669 6761 7469 6f6e  rue, "Navigation
+000180b0: 2064 6174 6120 6372 6561 7465 6422 202b   data created" +
+000180c0: 2072 6574 7572 6e4d 7367 0a20 2020 2020   returnMsg.     
+000180d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000180e0: 2020 2020 2073 2e73 746f 7028 290a 2020       s.stop().  
+000180f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00018100: 2046 616c 7365 2c20 224e 6f20 696d 6167   False, "No imag
+00018110: 6520 636f 6f72 6469 6e61 7465 7320 666f  e coordinates fo
+00018120: 756e 6422 202b 2072 6574 7572 6e4d 7367  und" + returnMsg
+00018130: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
+00018140: 496d 6167 654e 6176 6967 6174 696f 6e46  ImageNavigationF
+00018150: 696c 6528 7365 6c66 2c20 6e61 765f 7061  ile(self, nav_pa
+00018160: 7468 3a20 7374 722c 206e 6176 5f68 6561  th: str, nav_hea
+00018170: 6465 723d 6d69 7174 762e 706f 735f 6865  der=miqtv.pos_he
+00018180: 6164 6572 5b27 7061 6e67 6165 6127 5d2c  ader['pangaea'],
+00018190: 2064 6174 655f 666f 726d 6174 3d6d 6971   date_format=miq
+000181a0: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
+000181b0: 2770 616e 6761 6561 275d 2c20 6f76 6572  'pangaea'], over
+000181c0: 7772 6974 653d 4661 6c73 652c 2063 6f6c  write=False, col
+000181d0: 5f73 6570 6172 6174 6f72 203d 2022 5c74  _separator = "\t
+000181e0: 222c 2076 6964 656f 5361 6d70 6c65 5365  ", videoSampleSe
+000181f0: 636f 6e64 733d 312c 0a20 2020 2020 2020  conds=1,.       
+00018200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018210: 2020 2020 2020 2020 2020 2020 206f 6666               off
+00018220: 7365 745f 783d 302c 206f 6666 7365 745f  set_x=0, offset_
+00018230: 793d 302c 206f 6666 7365 745f 7a3d 302c  y=0, offset_z=0,
+00018240: 616e 676c 6573 5f69 6e5f 7261 6420 3d20  angles_in_rad = 
+00018250: 4661 6c73 652c 2072 6563 6f72 6473 3262  False, records2b
+00018260: 6549 6e76 6572 7465 643d 5b5d 293a 0a20  eInverted=[]):. 
+00018270: 2020 2020 2020 2022 2222 2044 6570 7265         """ Depre
+00018280: 6361 7465 6420 2d20 7573 6520 6372 6561  cated - use crea
+00018290: 7465 5f69 6d61 6765 5f6e 6176 6967 6174  te_image_navigat
+000182a0: 696f 6e5f 6669 6c65 2022 2222 0a20 2020  ion_file """.   
+000182b0: 2020 2020 2073 656c 662e 6372 6561 7465       self.create
+000182c0: 5f69 6d61 6765 5f6e 6176 6967 6174 696f  _image_navigatio
+000182d0: 6e5f 6669 6c65 286e 6176 5f70 6174 682c  n_file(nav_path,
+000182e0: 206e 6176 5f68 6561 6465 722c 2064 6174   nav_header, dat
+000182f0: 655f 666f 726d 6174 2c20 6f76 6572 7772  e_format, overwr
+00018300: 6974 652c 2063 6f6c 5f73 6570 6172 6174  ite, col_separat
+00018310: 6f72 2c20 7669 6465 6f53 616d 706c 6553  or, videoSampleS
+00018320: 6563 6f6e 6473 2c20 6f66 6673 6574 5f78  econds, offset_x
+00018330: 2c20 6f66 6673 6574 5f79 2c20 6f66 6673  , offset_y, offs
+00018340: 6574 5f7a 2c20 616e 676c 6573 5f69 6e5f  et_z, angles_in_
+00018350: 7261 642c 2072 6563 6f72 6473 3262 6549  rad, records2beI
+00018360: 6e76 6572 7465 6429 0a0a 0a20 2020 2064  nverted)...    d
+00018370: 6566 2063 7265 6174 655f 696d 6167 655f  ef create_image_
+00018380: 7368 6132 3536 5f66 696c 6528 7365 6c66  sha256_file(self
+00018390: 2c72 6552 6561 6441 6c6c 3d54 7275 6529  ,reReadAll=True)
+000183a0: 3a0a 2020 2020 2020 2020 2222 2220 4372  :.        """ Cr
+000183b0: 6561 7465 7320 696e 202f 696e 7465 726d  eates in /interm
+000183c0: 6564 6961 7465 2061 2074 6578 7420 6669  ediate a text fi
+000183d0: 6c65 2063 6f6e 7461 696e 696e 6720 7065  le containing pe
+000183e0: 7220 696d 6167 6520 6974 7320 5348 4132  r image its SHA2
+000183f0: 3536 2068 6173 682e 0a20 2020 2020 2020  56 hash..       
+00018400: 2020 2020 2049 6620 7265 5265 6164 416c       If reReadAl
+00018410: 6c20 6973 2054 7275 6520 616c 6c20 696d  l is True all im
+00018420: 6167 6573 2720 6861 7368 6573 2061 7265  ages' hashes are
+00018430: 2064 6574 6572 6d69 6e65 642e 204f 7468   determined. Oth
+00018440: 6572 7769 7365 206f 6e6c 7920 666f 7220  erwise only for 
+00018450: 7468 6f73 6520 6669 6c65 730a 2020 2020  those files.    
+00018460: 2020 2020 2020 2020 7768 6963 6820 6172          which ar
+00018470: 6520 6e6f 7420 7965 7420 696e 2074 6865  e not yet in the
+00018480: 2069 6e74 6572 6d65 6469 6174 6520 6669   intermediate fi
+00018490: 6c65 2063 6f6e 7461 696e 696e 6720 7468  le containing th
+000184a0: 6520 696d 6167 6520 6861 7368 6573 2020  e image hashes  
+000184b0: 2222 220a 2020 2020 2020 2020 6861 7368  """.        hash
+000184c0: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
+000184d0: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
+000184e0: 7328 7365 6c66 2e67 6574 5f69 6e74 5f68  s(self.get_int_h
+000184f0: 6173 685f 6669 6c65 2829 293a 0a20 2020  ash_file()):.   
+00018500: 2020 2020 2020 2020 2068 6173 6865 7320           hashes 
+00018510: 3d20 6d69 7174 662e 7461 6246 696c 6544  = miqtf.tabFileD
+00018520: 6174 6128 7365 6c66 2e67 6574 5f69 6e74  ata(self.get_int
+00018530: 5f68 6173 685f 6669 6c65 2829 2c20 5b6d  _hash_file(), [m
+00018540: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00018550: 276d 6172 6971 7427 5d5b 2769 6d67 275d  'mariqt']['img']
+00018560: 2c20 6d69 7174 762e 636f 6c5f 6865 6164  , miqtv.col_head
+00018570: 6572 5b27 6d61 7269 7174 275d 5b27 6861  er['mariqt']['ha
+00018580: 7368 275d 5d2c 206b 6579 5f63 6f6c 3d6d  sh']], key_col=m
+00018590: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+000185a0: 276d 6172 6971 7427 5d5b 2769 6d67 275d  'mariqt']['img']
+000185b0: 290a 0a20 2020 2020 2020 2069 6d61 6765  )..        image
+000185c0: 7349 6e52 6177 203d 2073 656c 662e 696d  sInRaw = self.im
+000185d0: 6167 6573 496e 496d 6167 6573 4469 7228  agesInImagesDir(
+000185e0: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
+000185f0: 2869 6d61 6765 7349 6e52 6177 2920 3e20  (imagesInRaw) > 
+00018600: 303a 0a0a 2020 2020 2020 2020 2020 2020  0:..            
+00018610: 6164 6465 645f 6861 7368 6573 203d 2030  added_hashes = 0
+00018620: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+00018630: 6720 3d20 6d69 7174 632e 5072 696e 744b  g = miqtc.PrintK
+00018640: 6e6f 776e 5072 6f67 7265 7373 4d73 6728  nownProgressMsg(
+00018650: 2243 6865 636b 696e 6720 6861 7368 6573  "Checking hashes
+00018660: 222c 206c 656e 2869 6d61 6765 7349 6e52  ", len(imagesInR
+00018670: 6177 292c 6d6f 6475 6c6f 3d35 290a 2020  aw),modulo=5).  
+00018680: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
+00018690: 6c65 2069 6e20 696d 6167 6573 496e 5261  le in imagesInRa
+000186a0: 773a 0a20 2020 2020 2020 2020 2020 2020  w:.             
+000186b0: 2020 2070 726f 672e 7072 6f67 7265 7373     prog.progress
+000186c0: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+000186d0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+000186e0: 5f5f 616c 6c55 5549 4473 4368 6563 6b65  __allUUIDsChecke
+000186f0: 6420 616e 6420 6e6f 7420 6d69 7174 692e  d and not miqti.
+00018700: 696d 6167 6543 6f6e 7461 696e 7356 616c  imageContainsVal
+00018710: 6964 5555 4944 2866 696c 6529 5b30 5d3a  idUUID(file)[0]:
+00018720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018730: 2020 2020 2023 2072 656d 6f76 6520 6672       # remove fr
+00018740: 6f6d 2075 7569 6420 6669 6c65 0a20 2020  om uuid file.   
+00018750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018760: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+00018770: 7473 2873 656c 662e 6765 745f 696e 745f  ts(self.get_int_
+00018780: 7575 6964 5f66 696c 6528 2929 3a0a 2020  uuid_file()):.  
+00018790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000187a0: 2020 2020 2020 7265 7320 3d20 6f70 656e        res = open
+000187b0: 2873 656c 662e 6765 745f 696e 745f 7575  (self.get_int_uu
+000187c0: 6964 5f66 696c 6528 292c 2022 7222 290a  id_file(), "r").
+000187d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000187e0: 2020 2020 2020 2020 6c69 6e65 7320 3d20          lines = 
+000187f0: 7265 732e 7265 6164 6c69 6e65 7328 290a  res.readlines().
+00018800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018810: 2020 2020 2020 2020 7265 732e 636c 6f73          res.clos
+00018820: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+00018830: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00018840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018850: 2020 2020 2020 6c69 6e65 7320 3d20 5b5d        lines = []
+00018860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018870: 2020 2020 2069 203d 2030 0a20 2020 2020       i = 0.     
+00018880: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00018890: 696e 654e 7220 3d20 690a 2020 2020 2020  ineNr = i.      
+000188a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000188b0: 7220 6c69 6e65 2069 6e20 6c69 6e65 733a  r line in lines:
+000188c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000188d0: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
+000188e0: 6174 682e 6261 7365 6e61 6d65 2866 696c  ath.basename(fil
+000188f0: 6529 2069 6e20 6c69 6e65 3a0a 2020 2020  e) in line:.    
+00018900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018910: 2020 2020 2020 2020 6c69 6e65 4e72 203d          lineNr =
+00018920: 2069 0a20 2020 2020 2020 2020 2020 2020   i.             
+00018930: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00018940: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+00018950: 2020 2020 2020 2020 2020 2020 2069 202b               i +
+00018960: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00018970: 2020 2020 2020 2020 6966 206c 696e 654e          if lineN
+00018980: 7220 213d 2030 3a0a 2020 2020 2020 2020  r != 0:.        
+00018990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000189a0: 6465 6c20 6c69 6e65 735b 6c69 6e65 4e72  del lines[lineNr
+000189b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000189c0: 2020 2020 2020 2020 2020 7265 7320 3d20            res = 
+000189d0: 6f70 656e 2873 656c 662e 6765 745f 696e  open(self.get_in
+000189e0: 745f 7575 6964 5f66 696c 6528 292c 2022  t_uuid_file(), "
+000189f0: 7722 290a 2020 2020 2020 2020 2020 2020  w").            
+00018a00: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00018a10: 7772 6974 656c 696e 6573 286c 696e 6573  writelines(lines
+00018a20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00018a30: 2020 2020 2020 2020 2020 7265 732e 636c            res.cl
+00018a40: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
+00018a50: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00018a60: 4578 6365 7074 696f 6e28 2022 4669 6c65  Exception( "File
+00018a70: 2022 202b 2066 696c 6520 2b20 2220 646f   " + file + " do
+00018a80: 6573 206e 6f74 2063 6f74 6169 6e20 6120  es not cotain a 
+00018a90: 7661 6c69 6420 5555 4944 2e20 5275 6e20  valid UUID. Run 
+00018aa0: 6372 6561 7465 5f75 7569 645f 6669 6c65  create_uuid_file
+00018ab0: 2829 2066 6972 7374 2122 290a 0a20 2020  () first!")..   
+00018ac0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00018ad0: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
+00018ae0: 2e62 6173 656e 616d 6528 6669 6c65 290a  .basename(file).
+00018af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b00: 6966 206e 6f74 2072 6552 6561 6441 6c6c  if not reReadAll
+00018b10: 2061 6e64 2066 696c 655f 6e61 6d65 2069   and file_name i
+00018b20: 6e20 6861 7368 6573 3a0a 2020 2020 2020  n hashes:.      
+00018b30: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+00018b40: 7368 6573 5b66 696c 655f 6e61 6d65 5d20  shes[file_name] 
+00018b50: 3d20 6861 7368 6573 5b66 696c 655f 6e61  = hashes[file_na
+00018b60: 6d65 5d5b 6d69 7174 762e 636f 6c5f 6865  me][miqtv.col_he
+00018b70: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00018b80: 6861 7368 275d 5d0a 2020 2020 2020 2020  hash']].        
+00018b90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00018ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018bb0: 2020 6861 7368 6573 5b66 696c 655f 6e61    hashes[file_na
+00018bc0: 6d65 5d20 3d20 6d69 7174 632e 7368 6132  me] = miqtc.sha2
+00018bd0: 3536 4861 7368 4669 6c65 2866 696c 6529  56HashFile(file)
+00018be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018bf0: 2020 2020 2061 6464 6564 5f68 6173 6865       added_hashe
+00018c00: 7320 2b3d 2031 0a20 2020 2020 2020 2020  s += 1.         
+00018c10: 2020 2070 726f 672e 636c 6561 7228 290a     prog.clear().
+00018c20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00018c30: 7265 5265 6164 416c 6c20 6f72 2061 6464  reReadAll or add
+00018c40: 6564 5f68 6173 6865 7320 3e20 303a 0a20  ed_hashes > 0:. 
+00018c50: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00018c60: 6173 685f 6669 6c65 203d 206f 7065 6e28  ash_file = open(
+00018c70: 7365 6c66 2e67 6574 5f69 6e74 5f68 6173  self.get_int_has
+00018c80: 685f 6669 6c65 2829 2c20 2277 2229 0a20  h_file(), "w"). 
+00018c90: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00018ca0: 6173 685f 6669 6c65 2e77 7269 7465 2820  ash_file.write( 
+00018cb0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00018cc0: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+00018cd0: 5d2b 225c 7422 2b6d 6971 7476 2e63 6f6c  ]+"\t"+miqtv.col
+00018ce0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00018cf0: 5d5b 2768 6173 6827 5d2b 225c 6e22 290a  ]['hash']+"\n").
+00018d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d10: 666f 7220 6669 6c65 5f6e 616d 6520 696e  for file_name in
+00018d20: 2068 6173 6865 733a 0a20 2020 2020 2020   hashes:.       
+00018d30: 2020 2020 2020 2020 2020 2020 2068 6173               has
+00018d40: 685f 6669 6c65 2e77 7269 7465 2866 696c  h_file.write(fil
+00018d50: 655f 6e61 6d65 2b22 5c74 222b 6861 7368  e_name+"\t"+hash
+00018d60: 6573 5b66 696c 655f 6e61 6d65 5d2b 225c  es[file_name]+"\
+00018d70: 6e22 290a 0a20 2020 2020 2020 2020 2020  n")..           
+00018d80: 2020 2020 2068 6173 685f 6669 6c65 2e63       hash_file.c
+00018d90: 6c6f 7365 2829 0a20 2020 2020 2020 2020  lose().         
+00018da0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00018db0: 7565 2c20 2241 6464 6564 2022 2b73 7472  ue, "Added "+str
+00018dc0: 2861 6464 6564 5f68 6173 6865 7329 2b22  (added_hashes)+"
+00018dd0: 2068 6173 6865 7320 746f 2068 6173 6820   hashes to hash 
+00018de0: 6669 6c65 220a 2020 2020 2020 2020 2020  file".          
+00018df0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00018e00: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+00018e10: 7275 652c 2022 416c 6c20 6861 7368 6573  rue, "All hashes
+00018e20: 2065 7869 7374 220a 0a20 2020 2020 2020   exist"..       
+00018e30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00018e40: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
+00018e50: 2022 4e6f 2069 6d61 6765 7320 666f 756e   "No images foun
+00018e60: 6420 746f 2068 6173 6822 0a20 2020 2020  d to hash".     
+00018e70: 2020 200a 2020 2020 6465 6620 6372 6561     .    def crea
+00018e80: 7465 496d 6167 6553 4841 3235 3646 696c  teImageSHA256Fil
+00018e90: 6528 7365 6c66 2c72 6552 6561 6441 6c6c  e(self,reReadAll
+00018ea0: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+00018eb0: 2222 2220 4465 7072 6563 6174 6564 202d  """ Deprecated -
+00018ec0: 2075 7365 2063 7265 6174 655f 696d 6167   use create_imag
+00018ed0: 655f 7368 6132 3536 5f66 696c 6520 2222  e_sha256_file ""
+00018ee0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00018ef0: 2073 656c 662e 6372 6561 7465 5f69 6d61   self.create_ima
+00018f00: 6765 5f73 6861 3235 365f 6669 6c65 2872  ge_sha256_file(r
+00018f10: 6552 6561 6441 6c6c 290a 0a0a 2020 2020  eReadAll)...    
+00018f20: 6465 6620 6372 6561 7465 5f73 7461 7274  def create_start
+00018f30: 5f74 696d 655f 6669 6c65 2873 656c 6629  _time_file(self)
+00018f40: 3a0a 2020 2020 2020 2020 2222 2220 4372  :.        """ Cr
+00018f50: 6561 7465 7320 696e 202f 696e 7465 726d  eates in /interm
+00018f60: 6564 6961 7465 2061 2074 6578 7420 6669  ediate a text fi
+00018f70: 6c65 2063 6f6e 7461 696e 696e 6720 7065  le containing pe
+00018f80: 7220 696d 6167 6520 6974 7320 7374 6172  r image its star
+00018f90: 7420 7469 6d65 2070 6172 7365 6420 6672  t time parsed fr
+00018fa0: 6f6d 2074 6865 2066 696c 6520 6e61 6d65  om the file name
+00018fb0: 2022 2222 0a0a 2020 2020 2020 2020 7320   """..        s 
+00018fc0: 3d20 6d69 7174 632e 5072 696e 744c 6f61  = miqtc.PrintLoa
+00018fd0: 6469 6e67 4d73 6728 2243 7265 6174 696e  dingMsg("Creatin
+00018fe0: 6720 696e 7465 726d 6564 6961 7465 2073  g intermediate s
+00018ff0: 7461 7274 7469 6d65 2066 696c 6520 2229  tarttime file ")
+00019000: 0a20 2020 2020 2020 2069 6d61 6765 7349  .        imagesI
+00019010: 6e52 6177 203d 2073 656c 662e 696d 6167  nRaw = self.imag
+00019020: 6573 496e 496d 6167 6573 4469 7253 6f72  esInImagesDirSor
+00019030: 7465 644c 6973 7428 290a 2020 2020 2020  tedList().      
+00019040: 2020 6966 206c 656e 2869 6d61 6765 7349    if len(imagesI
+00019050: 6e52 6177 2920 3e20 303a 0a0a 2020 2020  nRaw) > 0:..    
+00019060: 2020 2020 2020 2020 6f20 3d20 6f70 656e          o = open
+00019070: 2873 656c 662e 6765 745f 696e 745f 7374  (self.get_int_st
+00019080: 6172 7454 696d 6573 5f66 696c 6528 292c  artTimes_file(),
+00019090: 2022 7722 290a 2020 2020 2020 2020 2020   "w").          
+000190a0: 2020 6f2e 7772 6974 6528 6d69 7174 762e    o.write(miqtv.
+000190b0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+000190c0: 7174 275d 5b27 696d 6727 5d20 2b0a 2020  qt']['img'] +.  
+000190d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190e0: 2020 225c 7422 2b6d 6971 7476 2e63 6f6c    "\t"+miqtv.col
+000190f0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00019100: 5d5b 2775 7463 275d 2b22 5c6e 2229 0a0a  ]['utc']+"\n")..
+00019110: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00019120: 6669 6c65 2069 6e20 696d 6167 6573 496e  file in imagesIn
+00019130: 5261 773a 0a20 2020 2020 2020 2020 2020  Raw:.           
+00019140: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
+00019150: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
+00019160: 6528 6669 6c65 290a 0a20 2020 2020 2020  e(file)..       
+00019170: 2020 2020 2020 2020 2064 7420 3d20 6d69           dt = mi
+00019180: 7174 632e 7061 7273 6546 696c 6544 6174  qtc.parseFileDat
+00019190: 6554 696d 6541 7355 5443 2866 696c 655f  eTimeAsUTC(file_
+000191a0: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+000191b0: 2020 2020 2020 6f2e 7772 6974 6528 6669        o.write(fi
+000191c0: 6c65 5f6e 616d 652b 225c 7422 202b 2064  le_name+"\t" + d
+000191d0: 742e 7374 7266 7469 6d65 286d 6971 7476  t.strftime(miqtv
+000191e0: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
+000191f0: 6172 6971 7427 5d29 2b22 5c6e 2229 0a0a  ariqt'])+"\n")..
+00019200: 2020 2020 2020 2020 2020 2020 6f2e 636c              o.cl
+00019210: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
+00019220: 2020 732e 7374 6f70 2829 0a20 2020 2020    s.stop().     
+00019230: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00019240: 7565 2c20 2243 7265 6174 6564 2073 7461  ue, "Created sta
+00019250: 7274 2074 696d 6520 6669 6c65 220a 2020  rt time file".  
+00019260: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00019270: 2020 2020 2020 2020 732e 7374 6f70 2829          s.stop()
+00019280: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00019290: 7572 6e20 4661 6c73 652c 2022 4e6f 2069  urn False, "No i
+000192a0: 6d61 6765 7320 666f 756e 6420 746f 2072  mages found to r
+000192b0: 6561 6420 7374 6172 7420 7469 6d65 7322  ead start times"
+000192c0: 0a20 2020 2020 2020 200a 2020 2020 6465  .        .    de
+000192d0: 6620 6372 6561 7465 5374 6172 7454 696d  f createStartTim
+000192e0: 6546 696c 6528 7365 6c66 293a 0a20 2020  eFile(self):.   
+000192f0: 2020 2020 2022 2222 2044 6570 7265 6361       """ Depreca
+00019300: 7465 6420 2d20 7573 6520 6372 6561 7465  ted - use create
+00019310: 5f73 7461 7274 5f74 696d 655f 6669 6c65  _start_time_file
+00019320: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+00019330: 7572 6e20 7365 6c66 2e63 7265 6174 655f  urn self.create_
+00019340: 7374 6172 745f 7469 6d65 5f66 696c 6528  start_time_file(
+00019350: 290a 0a0a 2020 2020 6465 6620 6372 6561  )...    def crea
+00019360: 7465 4163 7175 6973 6974 696f 6e53 6574  teAcquisitionSet
+00019370: 7469 6e67 7345 5849 4646 696c 6528 7365  tingsEXIFFile(se
+00019380: 6c66 2c6f 7665 7272 6964 653d 4661 6c73  lf,override=Fals
+00019390: 6529 3a0a 2020 2020 2020 2020 2222 2220  e):.        """ 
+000193a0: 4372 6561 7465 7320 696e 202f 696e 7465  Creates in /inte
+000193b0: 726d 6564 6961 7465 2061 2074 6578 7420  rmediate a text 
+000193c0: 6669 6c65 2063 6f6e 7461 696e 696e 6720  file containing 
+000193d0: 7065 7220 696d 6167 6520 6120 6469 6374  per image a dict
+000193e0: 206f 6620 6578 6966 2074 6167 7320 616e   of exif tags an
+000193f0: 6420 7468 6569 7220 7661 6c75 6573 2070  d their values p
+00019400: 6172 7365 6420 6672 6f6d 2074 6865 2069  arsed from the i
+00019410: 6d61 6765 2022 2222 0a0a 2020 2020 2020  mage """..      
+00019420: 2020 696e 745f 6163 7175 6973 6974 696f    int_acquisitio
+00019430: 6e53 6574 7469 6e67 5f66 696c 6520 3d20  nSetting_file = 
+00019440: 7365 6c66 2e5f 5f67 6574 5f69 6e74 5f66  self.__get_int_f
+00019450: 696c 655f 7072 6566 6978 2829 202b 2027  ile_prefix() + '
+00019460: 5f69 6d61 6765 2d61 6371 7569 7369 7469  _image-acquisiti
+00019470: 6f6e 2d73 6574 7469 6e67 732e 7478 7427  on-settings.txt'
+00019480: 0a20 2020 2020 2020 2068 6561 6465 7220  .        header 
+00019490: 3d20 7b20 206d 6971 7476 2e63 6f6c 5f68  = {  miqtv.col_h
+000194a0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+000194b0: 2769 6d67 275d 3a20 206d 6971 7476 2e63  'img']:  miqtv.c
+000194c0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000194d0: 7427 5d5b 2769 6d67 275d 2c0a 2020 2020  t']['img'],.    
+000194e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194f0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00019500: 5b27 6d61 7269 7174 275d 5b27 6163 7175  ['mariqt']['acqu
+00019510: 6927 5d3a 6d69 7174 762e 636f 6c5f 6865  i']:miqtv.col_he
+00019520: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00019530: 6163 7175 6927 5d7d 0a20 2020 2020 2020  acqui']}.       
+00019540: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+00019550: 7473 2869 6e74 5f61 6371 7569 7369 7469  ts(int_acquisiti
+00019560: 6f6e 5365 7474 696e 675f 6669 6c65 2920  onSetting_file) 
+00019570: 616e 6420 6e6f 7420 6f76 6572 7269 6465  and not override
+00019580: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00019590: 6c66 2e61 6464 5f69 7465 6d5f 696e 666f  lf.add_item_info
+000195a0: 5f74 6162 5f66 696c 6528 696e 745f 6163  _tab_file(int_ac
+000195b0: 7175 6973 6974 696f 6e53 6574 7469 6e67  quisitionSetting
+000195c0: 5f66 696c 652c 225c 7422 2c68 6561 6465  _file,"\t",heade
+000195d0: 7229 0a20 2020 2020 2020 2020 2020 2072  r).            r
+000195e0: 6574 7572 6e20 5472 7565 2c20 2252 6573  eturn True, "Res
+000195f0: 756c 7420 6669 6c65 2065 7869 7374 7322  ult file exists"
+00019600: 0a0a 2020 2020 2020 2020 696d 6167 6573  ..        images
+00019610: 496e 5261 7720 3d20 7365 6c66 2e69 6d61  InRaw = self.ima
+00019620: 6765 7349 6e49 6d61 6765 7344 6972 536f  gesInImagesDirSo
+00019630: 7274 6564 4c69 7374 2829 0a20 2020 2020  rtedList().     
+00019640: 2020 2069 6620 6c65 6e28 696d 6167 6573     if len(images
+00019650: 496e 5261 7729 203e 2030 3a0a 0a20 2020  InRaw) > 0:..   
+00019660: 2020 2020 2020 2020 206f 203d 206f 7065           o = ope
+00019670: 6e28 696e 745f 6163 7175 6973 6974 696f  n(int_acquisitio
+00019680: 6e53 6574 7469 6e67 5f66 696c 652c 2022  nSetting_file, "
+00019690: 7722 290a 2020 2020 2020 2020 2020 2020  w").            
+000196a0: 6f2e 7772 6974 6528 6d69 7174 762e 636f  o.write(miqtv.co
+000196b0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+000196c0: 275d 5b27 696d 6727 5d20 2b20 225c 7422  ']['img'] + "\t"
+000196d0: 2b6d 6971 7476 2e63 6f6c 5f68 6561 6465  +miqtv.col_heade
+000196e0: 725b 276d 6172 6971 7427 5d5b 2761 6371  r['mariqt']['acq
+000196f0: 7569 275d 2b22 5c6e 2229 0a20 0a20 2020  ui']+"\n"). .   
+00019700: 2020 2020 2020 2020 2069 6d61 6765 7345           imagesE
+00019710: 7869 6673 203d 206d 6971 7469 2e67 6574  xifs = miqti.get
+00019720: 496d 6167 6573 416c 6c45 7869 6656 616c  ImagesAllExifVal
+00019730: 7565 7328 696d 6167 6573 496e 5261 772c  ues(imagesInRaw,
+00019740: 7365 6c66 2e70 726f 7629 0a20 2020 2020  self.prov).     
+00019750: 2020 2020 2020 2066 6f72 2066 696c 6520         for file 
+00019760: 696e 2069 6d61 6765 7345 7869 6673 3a0a  in imagesExifs:.
+00019770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019780: 6669 6c65 5f6e 616d 6520 3d20 6f73 2e70  file_name = os.p
+00019790: 6174 682e 6261 7365 6e61 6d65 2866 696c  ath.basename(fil
+000197a0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+000197b0: 2020 206f 2e77 7269 7465 2866 696c 655f     o.write(file_
+000197c0: 6e61 6d65 2b22 5c74 222b 7374 7228 696d  name+"\t"+str(im
+000197d0: 6167 6573 4578 6966 735b 6669 6c65 5d29  agesExifs[file])
+000197e0: 2b22 5c6e 2229 0a0a 2020 2020 2020 2020  +"\n")..        
+000197f0: 2020 2020 6f2e 636c 6f73 6528 290a 0a20      o.close().. 
+00019800: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00019810: 6164 645f 6974 656d 5f69 6e66 6f5f 7461  add_item_info_ta
+00019820: 625f 6669 6c65 2869 6e74 5f61 6371 7569  b_file(int_acqui
+00019830: 7369 7469 6f6e 5365 7474 696e 675f 6669  sitionSetting_fi
+00019840: 6c65 2c22 5c74 222c 6865 6164 6572 290a  le,"\t",header).
+00019850: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00019860: 726e 2054 7275 652c 2022 4372 6561 7465  rn True, "Create
+00019870: 6420 6163 7175 6973 6974 696f 6e20 7365  d acquisition se
+00019880: 7474 696e 6773 2066 696c 6522 0a20 2020  ttings file".   
+00019890: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000198a0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+000198b0: 6c73 652c 2022 4e6f 2069 6d61 6765 7320  lse, "No images 
+000198c0: 666f 756e 6422 0a0a 0a20 2020 2064 6566  found"...    def
+000198d0: 2069 6d61 6765 7349 6e49 6d61 6765 7344   imagesInImagesD
+000198e0: 6972 2873 656c 6629 3a0a 2020 2020 2020  ir(self):.      
+000198f0: 2020 7265 7475 726e 2063 6f70 792e 6465    return copy.de
+00019900: 6570 636f 7079 2873 656c 662e 5f69 6d61  epcopy(self._ima
+00019910: 6765 7349 6e49 6d61 6765 7344 6972 290a  gesInImagesDir).
+00019920: 0a20 2020 2064 6566 2069 6d61 6765 7349  .    def imagesI
+00019930: 6e49 6d61 6765 7344 6972 536f 7274 6564  nImagesDirSorted
+00019940: 4c69 7374 2873 656c 6629 3a0a 2020 2020  List(self):.    
+00019950: 2020 2020 7265 7475 726e 2063 6f70 792e      return copy.
+00019960: 6465 6570 636f 7079 2873 656c 662e 5f69  deepcopy(self._i
+00019970: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
+00019980: 536f 7274 6564 4c69 7374 290a 0a0a 2020  SortedList)...  
+00019990: 2020 6465 6620 7061 7273 6549 7465 6d44    def parseItemD
+000199a0: 6174 6166 726f 6d54 6162 4669 6c65 4461  atafromTabFileDa
+000199b0: 7461 2873 656c 662c 2069 7465 6d73 3a20  ta(self, items: 
+000199c0: 6469 6374 2c20 6669 6c65 3a20 7374 722c  dict, file: str,
+000199d0: 2063 6f6c 733a 206c 6973 742c 206f 7074   cols: list, opt
+000199e0: 696f 6e61 6c3a 206c 6973 7420 3d20 5b5d  ional: list = []
+000199f0: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
+00019a00: 743a 7374 723d 6d69 7174 762e 6461 7465  t:str=miqtv.date
+00019a10: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
+00019a20: 275d 293a 0a20 2020 2020 2020 2022 2222  ']):.        """
+00019a30: 2070 6172 7365 7320 6461 7461 2066 726f   parses data fro
+00019a40: 6d20 636f 6c75 6d6e 7320 696e 2063 6f6c  m columns in col
+00019a50: 7320 616e 6420 7772 6974 6573 2069 6e66  s and writes inf
+00019a60: 6f20 746f 2069 7465 6d73 2e20 436f 6c75  o to items. Colu
+00019a70: 6d6e 2027 696d 6167 652d 6669 6c65 6e61  mn 'image-filena
+00019a80: 6d65 2720 6d75 7374 2062 6520 696e 2066  me' must be in f
+00019a90: 696c 6520 616e 6420 646f 6573 206e 6f74  ile and does not
+00019aa0: 206e 6565 6420 746f 2062 6520 7061 7373   need to be pass
+00019ab0: 6564 2069 6e20 636f 6c73 2e20 0a20 2020  ed in cols. .   
+00019ac0: 2020 2020 2020 2020 2046 696c 6520 6d75           File mu
+00019ad0: 7374 2062 6520 7461 6220 7365 7061 7261  st be tab separa
+00019ae0: 7465 6420 616e 6420 636f 6c75 6d6e 7320  ted and columns 
+00019af0: 6e61 6d65 7320 6d75 7374 2065 7175 616c  names must equal
+00019b00: 2069 7465 6d20 6669 656c 6420 6e61 6d65   item field name
+00019b10: 7322 2222 0a20 2020 2020 2020 2074 6d70  s""".        tmp
+00019b20: 5f64 6174 6120 3d20 6d69 7174 662e 7461  _data = miqtf.ta
+00019b30: 6246 696c 6544 6174 6128 6669 6c65 2c20  bFileData(file, 
+00019b40: 636f 6c73 2b5b 2769 6d61 6765 2d66 696c  cols+['image-fil
+00019b50: 656e 616d 6527 5d2b 6f70 7469 6f6e 616c  ename']+optional
+00019b60: 2c20 6b65 795f 636f 6c3d 2769 6d61 6765  , key_col='image
+00019b70: 2d66 696c 656e 616d 6527 2c20 6f70 7469  -filename', opti
+00019b80: 6f6e 616c 3d6f 7074 696f 6e61 6c2c 636f  onal=optional,co
+00019b90: 6e76 6572 743d 5472 7565 290a 2020 2020  nvert=True).    
+00019ba0: 2020 2020 7365 6c66 2e77 7269 7465 5061      self.writePa
+00019bb0: 7273 6564 4461 7461 546f 4974 656d 7328  rsedDataToItems(
+00019bc0: 746d 705f 6461 7461 2c69 7465 6d73 2c73  tmp_data,items,s
+00019bd0: 656c 662e 6966 646f 5f74 6d70 5b6d 6971  elf.ifdo_tmp[miq
+00019be0: 7476 2e69 6d61 6765 5f73 6574 5f68 6561  tv.image_set_hea
+00019bf0: 6465 725f 6b65 795d 2c20 6461 7465 7469  der_key], dateti
+00019c00: 6d65 5f66 6f72 6d61 743d 6461 7465 7469  me_format=dateti
+00019c10: 6d65 5f66 6f72 6d61 7429 0a0a 0a20 2020  me_format)...   
+00019c20: 2064 6566 2070 7261 7365 4974 656d 4461   def praseItemDa
+00019c30: 7461 4672 6f6d 4669 6c65 2873 656c 662c  taFromFile(self,
+00019c40: 6974 656d 733a 6469 6374 2c66 696c 653a  items:dict,file:
+00019c50: 7374 722c 7365 7061 7261 746f 723a 7374  str,separator:st
+00019c60: 722c 6865 6164 6572 3a64 6963 742c 2064  r,header:dict, d
+00019c70: 6174 6574 696d 655f 666f 726d 6174 3a73  atetime_format:s
+00019c80: 7472 3d6d 6971 7476 2e64 6174 655f 666f  tr=miqtv.date_fo
+00019c90: 726d 6174 735b 276d 6172 6971 7427 5d29  rmats['mariqt'])
+00019ca0: 3a0a 2020 2020 2020 2020 2222 2220 7061  :.        """ pa
+00019cb0: 7273 6573 2064 6174 6120 6672 6f6d 2066  rses data from f
+00019cc0: 726f 6d20 6669 6c65 2074 6f20 6974 656d  rom file to item
+00019cd0: 732e 2068 6561 6465 7220 6469 6374 206d  s. header dict m
+00019ce0: 7573 7420 6265 206f 6620 7374 7275 6374  ust be of struct
+00019cf0: 7572 653a 207b 3c69 7465 6d2d 6669 656c  ure: {<item-fiel
+00019d00: 642d 6e61 6d65 3e3a 3c63 6f6c 756d 6e2d  d-name>:<column-
+00019d10: 6e61 6d65 3e7d 0a20 2020 2020 2020 2020  name>}.         
+00019d20: 2020 2061 6e64 206d 7573 7420 636f 6e74     and must cont
+00019d30: 6169 6e20 656e 7472 7920 2769 6d61 6765  ain entry 'image
+00019d40: 2d66 696c 656e 616d 6527 2022 2222 0a20  -filename' """. 
+00019d50: 2020 2020 2020 2069 6620 6e6f 7420 2769         if not 'i
+00019d60: 6d61 6765 2d66 696c 656e 616d 6527 2069  mage-filename' i
+00019d70: 6e20 6865 6164 6572 3a0a 2020 2020 2020  n header:.      
+00019d80: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+00019d90: 7074 696f 6e28 2268 6561 6465 7220 646f  ption("header do
+00019da0: 6573 206e 6f74 2063 6f6e 7461 696e 2027  es not contain '
+00019db0: 696d 6167 652d 6669 6c65 6e61 6d65 2722  image-filename'"
+00019dc0: 290a 2020 2020 2020 2020 0a20 2020 2020  ).        .     
+00019dd0: 2020 2074 6d70 5f64 6174 6120 3d20 6d69     tmp_data = mi
+00019de0: 7174 662e 7461 6246 696c 6544 6174 6128  qtf.tabFileData(
+00019df0: 6669 6c65 2c20 6865 6164 6572 2c63 6f6c  file, header,col
+00019e00: 5f73 6570 6172 6174 6f72 3d73 6570 6172  _separator=separ
+00019e10: 6174 6f72 2c20 6b65 795f 636f 6c3d 2769  ator, key_col='i
+00019e20: 6d61 6765 2d66 696c 656e 616d 6527 2c63  mage-filename',c
+00019e30: 6f6e 7665 7274 3d54 7275 6529 0a20 2020  onvert=True).   
+00019e40: 2020 2020 2073 656c 662e 7772 6974 6550       self.writeP
+00019e50: 6172 7365 6444 6174 6154 6f49 7465 6d73  arsedDataToItems
+00019e60: 2874 6d70 5f64 6174 612c 6974 656d 732c  (tmp_data,items,
+00019e70: 7365 6c66 2e69 6664 6f5f 746d 705b 6d69  self.ifdo_tmp[mi
+00019e80: 7174 762e 696d 6167 655f 7365 745f 6865  qtv.image_set_he
+00019e90: 6164 6572 5f6b 6579 5d2c 2064 6174 6574  ader_key], datet
+00019ea0: 696d 655f 666f 726d 6174 3d64 6174 6574  ime_format=datet
+00019eb0: 696d 655f 666f 726d 6174 290a 0a0a 2020  ime_format)...  
+00019ec0: 2020 6465 6620 7772 6974 6550 6172 7365    def writeParse
+00019ed0: 6444 6174 6154 6f49 7465 6d73 2873 656c  dDataToItems(sel
+00019ee0: 662c 6461 7461 3a64 6963 742c 6974 656d  f,data:dict,item
+00019ef0: 733a 6469 6374 2c68 6561 6465 723a 6469  s:dict,header:di
+00019f00: 6374 2c20 6461 7465 7469 6d65 5f66 6f72  ct, datetime_for
+00019f10: 6d61 743a 7374 723d 6d69 7174 762e 6461  mat:str=miqtv.da
+00019f20: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
+00019f30: 7174 275d 293a 0a0a 2020 2020 2020 2020  qt']):..        
+00019f40: 2320 6576 616c 2073 7472 696e 6773 2061  # eval strings a
+00019f50: 7320 6469 6374 206f 7220 6c69 7374 0a20  s dict or list. 
+00019f60: 2020 2020 2020 206d 6971 7463 2e72 6563         miqtc.rec
+00019f70: 7572 7369 7665 4576 616c 2864 6174 6129  ursiveEval(data)
+00019f80: 0a0a 2020 2020 2020 2020 2320 706f 7465  ..        # pote
+00019f90: 6e74 6169 6c6c 7920 7265 6d6f 7665 2063  ntailly remove c
+00019fa0: 6f6e 7374 2064 6174 6120 6672 6f6d 2069  onst data from i
+00019fb0: 7465 6d73 2061 6e64 2070 7574 2069 6e20  tems and put in 
+00019fc0: 6865 6164 6572 0a20 2020 2020 2020 2073  header.        s
+00019fd0: 656c 662e 6578 7472 6163 7443 6f6e 7374  elf.extractConst
+00019fe0: 4461 7461 5661 6c75 6573 2864 6174 612c  DataValues(data,
+00019ff0: 6865 6164 6572 290a 0a20 2020 2020 2020  header)..       
+0001a000: 2064 6174 6120 3d20 6d69 7174 632e 7265   data = miqtc.re
+0001a010: 6375 7273 6976 656c 7952 656d 6f76 6545  cursivelyRemoveE
+0001a020: 6d70 7479 4669 656c 6473 2864 6174 612c  mptyFields(data,
+0001a030: 636f 6e74 656e 7432 6265 5265 6d6f 7665  content2beRemove
+0001a040: 643d 4e6f 6e65 290a 0a20 2020 2020 2020  d=None)..       
+0001a050: 2023 2061 6464 2027 696d 6167 652d 6669   # add 'image-fi
+0001a060: 6c65 6e61 6d65 2720 6669 656c 640a 2020  lename' field.  
+0001a070: 2020 2020 2020 666f 7220 696d 672c 2065        for img, e
+0001a080: 6e74 7279 2069 6e20 6461 7461 2e69 7465  ntry in data.ite
+0001a090: 6d73 2829 3a0a 0a20 2020 2020 2020 2020  ms():..         
+0001a0a0: 2020 2023 206c 6973 740a 2020 2020 2020     # list.      
+0001a0b0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0001a0c0: 6e63 6528 656e 7472 792c 6c69 7374 293a  nce(entry,list):
+0001a0d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a0e0: 2066 6f72 206c 6973 7449 7465 6d20 696e   for listItem in
+0001a0f0: 2065 6e74 7279 3a0a 2020 2020 2020 2020   entry:.        
+0001a100: 2020 2020 2020 2020 2020 2020 6c69 7374              list
+0001a110: 4974 656d 5b27 696d 6167 652d 6669 6c65  Item['image-file
+0001a120: 6e61 6d65 275d 203d 2069 6d67 0a20 2020  name'] = img.   
+0001a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a140: 2023 2063 6f76 6572 7420 6461 7465 7469   # covert dateti
+0001a150: 6d65 2073 7472 696e 670a 2020 2020 2020  me string.      
+0001a160: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001a170: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
+0001a180: 2720 696e 206c 6973 7449 7465 6d3a 0a20  ' in listItem:. 
+0001a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a1a0: 2020 2020 2020 2064 7420 3d20 6461 7465         dt = date
+0001a1b0: 7469 6d65 2e64 6174 6574 696d 652e 7374  time.datetime.st
+0001a1c0: 7270 7469 6d65 286c 6973 7449 7465 6d5b  rptime(listItem[
+0001a1d0: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
+0001a1e0: 5d2c 2064 6174 6574 696d 655f 666f 726d  ], datetime_form
+0001a1f0: 6174 290a 2020 2020 2020 2020 2020 2020  at).            
+0001a200: 2020 2020 2020 2020 2020 2020 6c69 7374              list
+0001a210: 4974 656d 5b27 696d 6167 652d 6461 7465  Item['image-date
+0001a220: 7469 6d65 275d 203d 2064 742e 7374 7266  time'] = dt.strf
+0001a230: 7469 6d65 286d 6971 7476 2e64 6174 655f  time(miqtv.date_
+0001a240: 666f 726d 6174 735b 276d 6172 6971 7427  formats['mariqt'
+0001a250: 5d29 0a20 2020 2020 2020 2020 2020 2065  ]).            e
+0001a260: 6c69 6620 6973 696e 7374 616e 6365 2865  lif isinstance(e
+0001a270: 6e74 7279 2c64 6963 7429 3a0a 2020 2020  ntry,dict):.    
+0001a280: 2020 2020 2020 2020 2020 2020 656e 7472              entr
+0001a290: 795b 2769 6d61 6765 2d66 696c 656e 616d  y['image-filenam
+0001a2a0: 6527 5d20 3d20 696d 670a 2020 2020 2020  e'] = img.      
+0001a2b0: 2020 2020 2020 2020 2020 2320 636f 7665            # cove
+0001a2c0: 7274 2064 6174 6574 696d 6520 7374 7269  rt datetime stri
+0001a2d0: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
+0001a2e0: 2020 2069 6620 2769 6d61 6765 2d64 6174     if 'image-dat
+0001a2f0: 6574 696d 6527 2069 6e20 656e 7472 793a  etime' in entry:
+0001a300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a310: 2020 2020 2064 7420 3d20 6461 7465 7469       dt = dateti
+0001a320: 6d65 2e64 6174 6574 696d 652e 7374 7270  me.datetime.strp
+0001a330: 7469 6d65 2865 6e74 7279 5b27 696d 6167  time(entry['imag
+0001a340: 652d 6461 7465 7469 6d65 275d 2c20 6461  e-datetime'], da
+0001a350: 7465 7469 6d65 5f66 6f72 6d61 7429 0a20  tetime_format). 
+0001a360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a370: 2020 2065 6e74 7279 5b27 696d 6167 652d     entry['image-
+0001a380: 6461 7465 7469 6d65 275d 203d 2064 742e  datetime'] = dt.
+0001a390: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
+0001a3a0: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
+0001a3b0: 6971 7427 5d29 0a20 2020 2020 2020 2020  iqt']).         
+0001a3c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001a3d0: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
+0001a3e0: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+0001a3f0: 6f6e 2822 6461 7461 2065 6e74 7269 6573  on("data entries
+0001a400: 206d 7573 7420 6265 2064 6963 7420 6f72   must be dict or
+0001a410: 206c 6973 7420 6966 2064 6963 7473 2229   list if dicts")
+0001a420: 0a0a 2020 2020 2020 2020 6d69 7174 632e  ..        miqtc.
+0001a430: 7265 6375 7273 6976 656c 7955 7064 6174  recursivelyUpdat
+0001a440: 6544 6963 7473 2869 7465 6d73 2c64 6174  eDicts(items,dat
+0001a450: 6129 0a0a 0a20 2020 2040 7374 6174 6963  a)...    @static
+0001a460: 6d65 7468 6f64 0a20 2020 2064 6566 2065  method.    def e
+0001a470: 7874 7261 6374 436f 6e73 7444 6174 6156  xtractConstDataV
+0001a480: 616c 7565 7328 6461 7461 3a64 6963 742c  alues(data:dict,
+0001a490: 6865 6164 6572 3a64 6963 7429 3a0a 2020  header:dict):.  
+0001a4a0: 2020 2020 2020 2222 2220 5265 6d6f 7665        """ Remove
+0001a4b0: 7320 6669 656c 6473 2074 6861 7420 6172  s fields that ar
+0001a4c0: 6520 636f 6e73 7461 6e74 2066 6f72 2061  e constant for a
+0001a4d0: 6c6c 2065 6e74 7269 6573 2066 726f 6d20  ll entries from 
+0001a4e0: 6461 7461 2064 6963 7420 616e 6420 7075  data dict and pu
+0001a4f0: 7420 7468 656d 2069 6e20 6865 6164 6572  t them in header
+0001a500: 2064 6963 742e 200a 2020 2020 2020 2020   dict. .        
+0001a510: 2020 2020 4561 6368 2065 6e74 7279 206f      Each entry o
+0001a520: 6620 6461 7461 206d 7573 7420 6265 2061  f data must be a
+0001a530: 2064 6963 7420 7769 7468 2074 6865 2073   dict with the s
+0001a540: 616d 6520 7365 7420 6f66 206b 6579 732e  ame set of keys.
+0001a550: 2022 2222 0a20 2020 200a 2020 2020 2020   """.    .      
+0001a560: 2020 6669 656c 6473 546f 4967 6e6f 7265    fieldsToIgnore
+0001a570: 203d 205b 2769 6d61 6765 2d64 6174 6574   = ['image-datet
+0001a580: 696d 6527 5d0a 2020 2020 2020 2020 636f  ime'].        co
+0001a590: 6e73 7444 6174 6120 3d20 7b7d 0a20 2020  nstData = {}.   
+0001a5a0: 2020 2020 2066 6972 7374 496d 6167 6520       firstImage 
+0001a5b0: 3d20 5472 7565 0a20 2020 2020 2020 2066  = True.        f
+0001a5c0: 6f72 2069 6d61 6765 2c69 6d61 6765 5f64  or image,image_d
+0001a5d0: 6174 6120 696e 2064 6174 612e 6974 656d  ata in data.item
+0001a5e0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0001a5f0: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
+0001a600: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+0001a610: 696d 6167 655f 6461 7461 2c6c 6973 7429  image_data,list)
+0001a620: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a630: 2020 696d 6167 655f 6461 7461 203d 205b    image_data = [
+0001a640: 696d 6167 655f 6461 7461 5d0a 0a20 2020  image_data]..   
+0001a650: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0001a660: 6669 7273 7449 6d61 6765 2061 6e64 2063  firstImage and c
+0001a670: 6f6e 7374 4461 7461 203d 3d20 7b7d 3a0a  onstData == {}:.
+0001a680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a690: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+0001a6a0: 2020 0a20 2020 2020 2020 2020 2020 2066    .            f
+0001a6b0: 6972 7374 5469 6d65 506f 696e 7420 3d20  irstTimePoint = 
+0001a6c0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+0001a6d0: 2066 6f72 2069 6d61 6765 5f74 705f 6461   for image_tp_da
+0001a6e0: 7461 2069 6e20 696d 6167 655f 6461 7461  ta in image_data
+0001a6f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a700: 2020 2320 7665 7279 2066 6972 7374 2064    # very first d
+0001a710: 6174 6120 666f 7220 636f 6d70 6172 6973  ata for comparis
+0001a720: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+0001a730: 2020 2069 6620 6669 7273 7449 6d61 6765     if firstImage
+0001a740: 2061 6e64 2066 6972 7374 5469 6d65 506f   and firstTimePo
+0001a750: 696e 743a 0a20 2020 2020 2020 2020 2020  int:.           
+0001a760: 2020 2020 2020 2020 2063 6f6e 7374 4461           constDa
+0001a770: 7461 203d 2063 6f70 792e 6465 6570 636f  ta = copy.deepco
+0001a780: 7079 2869 6d61 6765 5f74 705f 6461 7461  py(image_tp_data
+0001a790: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001a7a0: 2020 2020 2020 666f 7220 6669 656c 6420        for field 
+0001a7b0: 696e 2066 6965 6c64 7354 6f49 676e 6f72  in fieldsToIgnor
+0001a7c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001a7d0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+0001a7e0: 656c 6420 696e 2063 6f6e 7374 4461 7461  eld in constData
+0001a7f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a800: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0001a810: 6c20 636f 6e73 7444 6174 615b 6669 656c  l constData[fiel
+0001a820: 645d 0a20 2020 2020 2020 2020 2020 2020  d].             
+0001a830: 2020 2020 2020 2066 6972 7374 5469 6d65         firstTime
+0001a840: 506f 696e 7420 3d20 4661 6c73 650a 2020  Point = False.  
+0001a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a860: 2020 636f 6e74 696e 7565 0a0a 2020 2020    continue..    
+0001a870: 2020 2020 2020 2020 2020 2020 636f 6e73              cons
+0001a880: 7444 6174 6120 3d20 6d69 7174 632e 6669  tData = miqtc.fi
+0001a890: 6e64 436f 6d6d 6f6e 4469 6374 456c 656d  ndCommonDictElem
+0001a8a0: 656e 7473 2869 6d61 6765 5f74 705f 6461  ents(image_tp_da
+0001a8b0: 7461 2c63 6f6e 7374 4461 7461 290a 0a20  ta,constData).. 
+0001a8c0: 2020 2020 2020 2020 2020 2066 6972 7374             first
+0001a8d0: 496d 6167 6520 3d20 4661 6c73 650a 0a20  Image = False.. 
+0001a8e0: 2020 2020 2020 2023 2054 4f44 4f20 6368         # TODO ch
+0001a8f0: 6563 6b20 7769 7468 696e 2069 6d61 6765  eck within image
+0001a900: 2074 696d 6573 202d 3e20 746f 2069 6d61   times -> to ima
+0001a910: 6765 2064 6566 6175 6c74 2e20 2874 7269  ge default. (tri
+0001a920: 636b 7920 7369 6e63 6520 7765 2064 6f6e  cky since we don
+0001a930: 2774 2068 6176 6520 7468 6520 6461 6661  't have the dafa
+0001a940: 756c 7420 696e 6465 7820 6865 7265 2e20  ult index here. 
+0001a950: 4f6e 6c79 2061 2073 7562 7365 7420 6d69  Only a subset mi
+0001a960: 6768 7420 6265 2075 7064 6174 6520 6865  ght be update he
+0001a970: 7265 290a 2020 2020 2020 2020 2320 6368  re).        # ch
+0001a980: 6563 6b20 7769 7468 696e 2069 6d61 6765  eck within image
+0001a990: 2069 7465 6d73 202d 3e20 6865 6164 6572   items -> header
+0001a9a0: 0a20 2020 2020 2020 2068 6561 6465 7255  .        headerU
+0001a9b0: 7064 6174 6520 3d20 636f 7079 2e64 6565  pdate = copy.dee
+0001a9c0: 7063 6f70 7928 636f 6e73 7444 6174 6129  pcopy(constData)
+0001a9d0: 0a20 2020 2020 2020 2068 6561 6465 7255  .        headerU
+0001a9e0: 7064 6174 6564 5465 7374 203d 2063 6f70  pdatedTest = cop
+0001a9f0: 792e 6465 6570 636f 7079 2868 6561 6465  y.deepcopy(heade
+0001aa00: 7229 0a20 2020 2020 2020 206d 6971 7463  r).        miqtc
+0001aa10: 2e72 6563 7572 7369 7665 6c79 5570 6461  .recursivelyUpda
+0001aa20: 7465 4469 6374 7328 6865 6164 6572 5570  teDicts(headerUp
+0001aa30: 6461 7465 6454 6573 742c 6865 6164 6572  datedTest,header
+0001aa40: 5570 6461 7465 290a 2020 2020 2020 2020  Update).        
+0001aa50: 7570 6461 7465 4469 6666 203d 2044 6565  updateDiff = Dee
+0001aa60: 7044 6966 6628 6865 6164 6572 2c68 6561  pDiff(header,hea
+0001aa70: 6465 7255 7064 6174 6564 5465 7374 290a  derUpdatedTest).
+0001aa80: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+0001aa90: 6966 2068 6561 6465 7255 7064 6174 6520  if headerUpdate 
+0001aaa0: 776f 756c 6420 6f76 6572 7772 6974 6520  would overwrite 
+0001aab0: 616e 7974 6869 6e67 2066 726f 6d20 6375  anything from cu
+0001aac0: 7272 656e 7420 6865 6164 6572 2028 7368  rrent header (sh
+0001aad0: 6f75 6c64 206e 6f74 2068 6170 7065 6e29  ould not happen)
+0001aae0: 2c20 6966 2073 6f20 646f 6e74 2072 656d  , if so dont rem
+0001aaf0: 6f76 6520 6672 6f6d 2069 7465 6d73 0a20  ove from items. 
+0001ab00: 2020 2020 2020 2069 6620 6e6f 7420 2776         if not 'v
+0001ab10: 616c 7565 735f 6368 616e 6765 6427 2069  alues_changed' i
+0001ab20: 6e20 7570 6461 7465 4469 6666 2061 6e64  n updateDiff and
+0001ab30: 206e 6f74 2027 7479 7065 5f63 6861 6e67   not 'type_chang
+0001ab40: 6573 2720 696e 2075 7064 6174 6544 6966  es' in updateDif
+0001ab50: 6620 616e 6420 6e6f 7420 2764 6963 7469  f and not 'dicti
+0001ab60: 6f6e 6172 795f 6974 656d 5f72 656d 6f76  onary_item_remov
+0001ab70: 6564 2720 696e 2075 7064 6174 6544 6966  ed' in updateDif
+0001ab80: 663a 0a20 2020 2020 2020 2020 2020 2068  f:.            h
+0001ab90: 6561 6465 722e 636c 6561 7228 290a 2020  eader.clear().  
+0001aba0: 2020 2020 2020 2020 2020 6865 6164 6572            header
+0001abb0: 2e75 7064 6174 6528 6865 6164 6572 5570  .update(headerUp
+0001abc0: 6461 7465 6454 6573 7429 0a0a 2020 2020  datedTest)..    
+0001abd0: 2020 2020 2020 2020 2320 7265 6d6f 7665          # remove
+0001abe0: 2063 6f6e 7374 2076 616c 7565 7320 6672   const values fr
+0001abf0: 6f6d 2064 6174 610a 2020 2020 2020 2020  om data.        
+0001ac00: 2020 2020 6d69 7174 632e 7265 6375 7273      miqtc.recurs
+0001ac10: 6976 654d 616b 654e 6f6e 6544 6963 7446  iveMakeNoneDictF
+0001ac20: 6965 6c64 7345 6d70 7479 5374 7228 636f  ieldsEmptyStr(co
+0001ac30: 6e73 7444 6174 6129 0a20 2020 2020 2020  nstData).       
+0001ac40: 2020 2020 2066 6f72 2069 6d61 6765 2c69       for image,i
+0001ac50: 6d61 6765 5f64 6174 6120 696e 2064 6174  mage_data in dat
+0001ac60: 612e 6974 656d 7328 293a 0a20 2020 2020  a.items():.     
+0001ac70: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0001ac80: 7420 6973 696e 7374 616e 6365 2869 6d61  t isinstance(ima
+0001ac90: 6765 5f64 6174 612c 6c69 7374 293a 0a20  ge_data,list):. 
+0001aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acb0: 2020 2069 6d61 6765 5f64 6174 6120 3d20     image_data = 
+0001acc0: 5b69 6d61 6765 5f64 6174 615d 0a20 2020  [image_data].   
+0001acd0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001ace0: 2069 6d61 6765 5f74 705f 6461 7461 2069   image_tp_data i
+0001acf0: 6e20 696d 6167 655f 6461 7461 3a0a 2020  n image_data:.  
+0001ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad10: 2020 6d69 7174 632e 7265 6375 7273 6976    miqtc.recursiv
+0001ad20: 656c 7955 7064 6174 6544 6963 7473 2869  elyUpdateDicts(i
+0001ad30: 6d61 6765 5f74 705f 6461 7461 2c63 6f6e  mage_tp_data,con
+0001ad40: 7374 4461 7461 2920 2020 2020 2020 2020  stData)         
+0001ad50: 200a 0a20 2020 2020 2020 2065 6c73 653a   ..        else:
+0001ad60: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+0001ad70: 730a 2020 2020 2020 2020 2020 2020 2320  s.            # 
+0001ad80: 544f 444f 206c 6f67 3f0a 2020 2020 200a  TODO log?.     .
+0001ad90: 0a20 2020 2064 6566 2069 6e74 6572 6d65  .    def interme
+0001ada0: 6469 6174 654e 6176 4669 6c65 4578 6973  diateNavFileExis
+0001adb0: 7473 2873 656c 6629 3a0a 2020 2020 2020  ts(self):.      
+0001adc0: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+0001add0: 7374 7328 7365 6c66 2e67 6574 5f69 6e74  sts(self.get_int
+0001ade0: 5f6e 6176 5f66 696c 6528 2929 3a0a 2020  _nav_file()):.  
+0001adf0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001ae00: 2054 7275 650a 2020 2020 2020 2020 656c   True.        el
+0001ae10: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001ae20: 7265 7475 726e 2046 616c 7365 0a0a 0a20  return False... 
+0001ae30: 2020 2064 6566 2068 6561 6465 7246 6965     def headerFie
+0001ae40: 6c64 4669 6c6c 6564 2873 656c 662c 6669  ldFilled(self,fi
+0001ae50: 656c 643a 7374 7229 3a0a 2020 2020 2020  eld:str):.      
+0001ae60: 2020 6966 2073 656c 662e 6669 6e64 546d    if self.findTm
+0001ae70: 7046 6965 6c64 3228 6669 656c 6429 203d  pField2(field) =
+0001ae80: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+0001ae90: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+0001aea0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+0001aeb0: 7565 0a0a 2020 2020 6465 6620 636f 6e76  ue..    def conv
+0001aec0: 6572 7454 6f44 6566 6175 6c74 4461 7465  ertToDefaultDate
+0001aed0: 5469 6d65 466f 726d 6174 2873 656c 662c  TimeFormat(self,
+0001aee0: 6966 646f 293a 0a20 2020 2020 2020 2022  ifdo):.        "
+0001aef0: 2222 2043 6865 636b 7320 6966 2061 6c6c  "" Checks if all
+0001af00: 2069 7465 6d73 2720 2769 6d61 6765 2d64   items' 'image-d
+0001af10: 6174 6574 696d 6527 2066 6965 6c64 7320  atetime' fields 
+0001af20: 6d61 7463 6820 6465 6661 756c 7420 6461  match default da
+0001af30: 7465 7469 6d65 2066 6f72 6d61 7420 6f72  tetime format or
+0001af40: 2061 2063 7573 746f 6d20 6f6e 6520 6465   a custom one de
+0001af50: 6669 6e65 6420 696e 2027 696d 6167 652d  fined in 'image-
+0001af60: 6461 7465 7469 6d65 2d66 6f72 6d61 7427  datetime-format'
+0001af70: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+0001af80: 2063 6f6e 7665 7274 7320 746f 2064 6566   converts to def
+0001af90: 6175 6c74 2066 6f72 6d61 742e 2054 6872  ault format. Thr
+0001afa0: 6f77 7320 6578 6365 7074 696f 6e20 6966  ows exception if
+0001afb0: 2064 6174 6574 696d 6520 6361 6e6e 6f74   datetime cannot
+0001afc0: 2062 6520 7061 7273 6564 2022 2222 0a20   be parsed """. 
+0001afd0: 2020 2020 2020 2063 7573 746f 6d44 6174         customDat
+0001afe0: 6554 696d 6546 6f72 6d61 7446 6f75 6e64  eTimeFormatFound
+0001aff0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+0001b000: 2068 6561 6465 7243 7573 746f 6d44 6174   headerCustomDat
+0001b010: 6554 696d 6546 6f72 6d61 7420 3d20 6669  eTimeFormat = fi
+0001b020: 6e64 4669 656c 6428 6966 646f 5b73 656c  ndField(ifdo[sel
+0001b030: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0001b040: 4b65 795d 2c27 696d 6167 652d 6461 7465  Key],'image-date
+0001b050: 7469 6d65 2d66 6f72 6d61 7427 290a 2020  time-format').  
+0001b060: 2020 2020 2020 6966 2068 6561 6465 7243        if headerC
+0001b070: 7573 746f 6d44 6174 6554 696d 6546 6f72  ustomDateTimeFor
+0001b080: 6d61 7420 213d 2022 223a 0a20 2020 2020  mat != "":.     
+0001b090: 2020 2020 2020 2069 6664 6f5b 7365 6c66         ifdo[self
+0001b0a0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+0001b0b0: 6579 5d5b 2769 6d61 6765 2d64 6174 6574  ey]['image-datet
+0001b0c0: 696d 652d 666f 726d 6174 275d 203d 2022  ime-format'] = "
+0001b0d0: 2220 2320 7265 6d6f 7665 2063 7573 746f  " # remove custo
+0001b0e0: 6d20 666f 726d 6174 0a20 2020 2020 2020  m format.       
+0001b0f0: 2020 2020 2063 7573 746f 6d44 6174 6554       customDateT
+0001b100: 696d 6546 6f72 6d61 7446 6f75 6e64 203d  imeFormatFound =
+0001b110: 2054 7275 650a 2020 2020 2020 2020 7072   True.        pr
+0001b120: 6f67 203d 206d 6971 7463 2e50 7269 6e74  og = miqtc.Print
+0001b130: 4b6e 6f77 6e50 726f 6772 6573 734d 7367  KnownProgressMsg
+0001b140: 2822 4368 6563 6b69 6e67 2064 6174 6574  ("Checking datet
+0001b150: 696d 6520 666f 726d 6174 222c 206c 656e  ime format", len
+0001b160: 2869 6664 6f5b 7365 6c66 2e69 6d61 6765  (ifdo[self.image
+0001b170: 5365 7449 7465 6d73 4b65 795d 292c 6d6f  SetItemsKey]),mo
+0001b180: 6475 6c6f 3d31 290a 2020 2020 2020 2020  dulo=1).        
+0001b190: 666f 7220 6669 6c65 2c69 7465 6d20 696e  for file,item in
+0001b1a0: 2069 6664 6f5b 7365 6c66 2e69 6d61 6765   ifdo[self.image
+0001b1b0: 5365 7449 7465 6d73 4b65 795d 2e69 7465  SetItemsKey].ite
+0001b1c0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+0001b1d0: 2020 7072 6f67 2e70 726f 6772 6573 7328    prog.progress(
+0001b1e0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0001b1f0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+0001b200: 6974 656d 2c6c 6973 7429 3a0a 2020 2020  item,list):.    
+0001b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b220: 6974 656d 203d 205b 6974 656d 5d0a 2020  item = [item].  
+0001b230: 2020 2020 2020 2020 2020 7375 6249 7465            subIte
+0001b240: 6d44 6566 6175 6c74 203d 2069 7465 6d5b  mDefault = item[
+0001b250: 305d 0a20 2020 2020 2020 2020 2020 2069  0].            i
+0001b260: 7465 6d43 7573 746f 6d44 6174 6554 696d  temCustomDateTim
+0001b270: 6546 6f72 6d61 7420 3d20 2222 0a20 2020  eFormat = "".   
+0001b280: 2020 2020 2020 2020 2069 6620 2769 6d61           if 'ima
+0001b290: 6765 2d64 6174 6574 696d 652d 666f 726d  ge-datetime-form
+0001b2a0: 6174 2720 696e 2073 7562 4974 656d 4465  at' in subItemDe
+0001b2b0: 6661 756c 743a 0a20 2020 2020 2020 2020  fault:.         
+0001b2c0: 2020 2020 2020 2069 7465 6d43 7573 746f         itemCusto
+0001b2d0: 6d44 6174 6554 696d 6546 6f72 6d61 7420  mDateTimeFormat 
+0001b2e0: 3d20 7375 6249 7465 6d44 6566 6175 6c74  = subItemDefault
+0001b2f0: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
+0001b300: 2d66 6f72 6d61 7427 5d0a 2020 2020 2020  -format'].      
+0001b310: 2020 2020 2020 2020 2020 7375 6249 7465            subIte
+0001b320: 6d44 6566 6175 6c74 5b27 696d 6167 652d  mDefault['image-
+0001b330: 6461 7465 7469 6d65 2d66 6f72 6d61 7427  datetime-format'
+0001b340: 5d20 3d20 2222 2023 2072 656d 6f76 6520  ] = "" # remove 
+0001b350: 6375 7374 6f6d 2066 6f72 6d61 740a 2020  custom format.  
+0001b360: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0001b370: 7374 6f6d 4461 7465 5469 6d65 466f 726d  stomDateTimeForm
+0001b380: 6174 466f 756e 6420 3d20 5472 7565 0a20  atFound = True. 
+0001b390: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+0001b3a0: 7562 4974 656d 2069 6e20 6974 656d 3a0a  ubItem in item:.
+0001b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b3c0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0001b3d0: 2020 2020 2020 2020 2066 6f72 6d61 7420           format 
+0001b3e0: 3d20 6d69 7174 762e 6461 7465 5f66 6f72  = miqtv.date_for
+0001b3f0: 6d61 7473 5b27 6d61 7269 7174 275d 0a20  mats['mariqt']. 
+0001b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b410: 2020 2064 6174 6574 696d 652e 6461 7465     datetime.date
+0001b420: 7469 6d65 2e73 7472 7074 696d 6528 7375  time.strptime(su
+0001b430: 6249 7465 6d5b 2769 6d61 6765 2d64 6174  bItem['image-dat
+0001b440: 6574 696d 6527 5d2c 666f 726d 6174 290a  etime'],format).
+0001b450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b460: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+0001b470: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0001b480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b490: 2020 2020 2020 2020 2066 6f72 6d61 7420           format 
+0001b4a0: 3d20 6865 6164 6572 4375 7374 6f6d 4461  = headerCustomDa
+0001b4b0: 7465 5469 6d65 466f 726d 6174 0a20 2020  teTimeFormat.   
+0001b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b4d0: 2020 2020 2064 7420 3d20 6461 7465 7469       dt = dateti
+0001b4e0: 6d65 2e64 6174 6574 696d 652e 7374 7270  me.datetime.strp
+0001b4f0: 7469 6d65 2873 7562 4974 656d 5b27 696d  time(subItem['im
+0001b500: 6167 652d 6461 7465 7469 6d65 275d 2c66  age-datetime'],f
+0001b510: 6f72 6d61 7429 0a20 2020 2020 2020 2020  ormat).         
+0001b520: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001b530: 7562 4974 656d 5b27 696d 6167 652d 6461  ubItem['image-da
+0001b540: 7465 7469 6d65 275d 203d 2064 6174 6574  tetime'] = datet
+0001b550: 696d 652e 6461 7465 7469 6d65 2e73 7472  ime.datetime.str
+0001b560: 6674 696d 6528 6474 2c6d 6971 7476 2e64  ftime(dt,miqtv.d
+0001b570: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
+0001b580: 6971 7427 5d29 0a20 2020 2020 2020 2020  iqt']).         
+0001b590: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0001b5a0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0001b5b0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0001b5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b5d0: 2020 2020 2020 2020 2020 2020 666f 726d              form
+0001b5e0: 6174 203d 2069 7465 6d43 7573 746f 6d44  at = itemCustomD
+0001b5f0: 6174 6554 696d 6546 6f72 6d61 740a 2020  ateTimeFormat.  
+0001b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b610: 2020 2020 2020 2020 2020 6474 203d 2064            dt = d
+0001b620: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
+0001b630: 2e73 7472 7074 696d 6528 7375 6249 7465  .strptime(subIte
+0001b640: 6d5b 2769 6d61 6765 2d64 6174 6574 696d  m['image-datetim
+0001b650: 6527 5d2c 666f 726d 6174 290a 2020 2020  e'],format).    
+0001b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b670: 2020 2020 2020 2020 7375 6249 7465 6d5b          subItem[
+0001b680: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
+0001b690: 5d20 3d20 6461 7465 7469 6d65 2e64 6174  ] = datetime.dat
+0001b6a0: 6574 696d 652e 7374 7266 7469 6d65 2864  etime.strftime(d
+0001b6b0: 742c 6d69 7174 762e 6461 7465 5f66 6f72  t,miqtv.date_for
+0001b6c0: 6d61 7473 5b27 6d61 7269 7174 275d 290a  mats['mariqt']).
+0001b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b6e0: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
+0001b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b700: 2020 2020 2020 2020 2020 2020 7072 6f67              prog
+0001b710: 2e63 6c65 6172 2829 0a20 2020 2020 2020  .clear().       
+0001b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b730: 2020 2020 2072 6169 7365 206d 6971 7463       raise miqtc
+0001b740: 2e49 6664 6f45 7863 6570 7469 6f6e 2827  .IfdoException('
+0001b750: 496e 7661 6c69 6420 6461 7465 7469 6d65  Invalid datetime
+0001b760: 2076 616c 7565 272c 7375 6249 7465 6d5b   value',subItem[
+0001b770: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
+0001b780: 5d2c 2022 646f 6573 206e 6f74 206d 6174  ], "does not mat
+0001b790: 6368 2066 6f72 6d61 7420 6465 6661 756c  ch format defaul
+0001b7a0: 7420 6f72 2063 7573 746f 6d20 666f 726d  t or custom form
+0001b7b0: 6174 2229 0a20 2020 2020 2020 2069 6620  at").        if 
+0001b7c0: 6375 7374 6f6d 4461 7465 5469 6d65 466f  customDateTimeFo
+0001b7d0: 726d 6174 466f 756e 643a 0a20 2020 2020  rmatFound:.     
+0001b7e0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+0001b7f0: 2e6c 6f67 2822 4375 7374 6f6d 2064 6174  .log("Custom dat
+0001b800: 6574 696d 6520 666f 726d 6174 7320 666f  etime formats fo
+0001b810: 756e 642e 2054 6865 7920 7769 6c6c 2062  und. They will b
+0001b820: 6520 7265 706c 6163 6564 2062 7920 7468  e replaced by th
+0001b830: 6520 6465 6661 756c 7420 666f 726d 6174  e default format
+0001b840: 2e22 2920 2020 0a20 2020 2020 2020 2070  .")   .        p
+0001b850: 726f 672e 636c 6561 7228 2920 2020 200a  rog.clear()    .
+0001b860: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+0001b870: 496e 7465 726d 6564 6961 7465 4669 6c65  IntermediateFile
+0001b880: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0001b890: 2073 656c 662e 696e 7465 726d 6564 6961   self.intermedia
+0001b8a0: 7465 4669 6c65 7344 6566 5f63 6f72 6520  teFilesDef_core 
+0001b8b0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+0001b8c0: 2768 6173 6865 7327 3a20 7b0a 2020 2020  'hashes': {.    
+0001b8d0: 2020 2020 2020 2020 2020 2020 2763 7265              'cre
+0001b8e0: 6174 696f 6e46 6374 273a 2027 6372 6561  ationFct': 'crea
+0001b8f0: 7465 5f69 6d61 6765 5f73 6861 3235 365f  te_image_sha256_
+0001b900: 6669 6c65 2829 272c 0a20 2020 2020 2020  file()',.       
+0001b910: 2020 2020 2020 2020 2027 7375 6666 6978           'suffix
+0001b920: 273a 2027 5f69 6d61 6765 2d68 6173 6865  ': '_image-hashe
+0001b930: 732e 7478 7427 2c0a 2020 2020 2020 2020  s.txt',.        
+0001b940: 2020 2020 2020 2020 2763 6f6c 7327 3a20          'cols': 
+0001b950: 5b6d 6971 7476 2e63 6f6c 5f68 6561 6465  [miqtv.col_heade
+0001b960: 725b 276d 6172 6971 7427 5d5b 2768 6173  r['mariqt']['has
+0001b970: 6827 5d5d 2c0a 2020 2020 2020 2020 2020  h']],.          
+0001b980: 2020 2020 2020 276f 7074 696f 6e61 6c27        'optional'
+0001b990: 3a20 5b5d 7d2c 0a20 2020 2020 2020 2020  : []},.         
+0001b9a0: 2020 2027 7575 6964 7327 3a20 7b0a 2020     'uuids': {.  
+0001b9b0: 2020 2020 2020 2020 2020 2020 2020 2763                'c
+0001b9c0: 7265 6174 696f 6e46 6374 273a 2027 6372  reationFct': 'cr
+0001b9d0: 6561 7465 5f75 7569 645f 6669 6c65 2829  eate_uuid_file()
+0001b9e0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0001b9f0: 2020 2027 7375 6666 6978 273a 2027 5f69     'suffix': '_i
+0001ba00: 6d61 6765 2d75 7569 6473 2e74 7874 272c  mage-uuids.txt',
+0001ba10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ba20: 2027 636f 6c73 273a 205b 6d69 7174 762e   'cols': [miqtv.
+0001ba30: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+0001ba40: 7174 275d 5b27 7575 6964 275d 5d2c 0a20  qt']['uuid']],. 
+0001ba50: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001ba60: 6f70 7469 6f6e 616c 273a 205b 5d7d 2c0a  optional': []},.
+0001ba70: 2020 2020 2020 2020 2020 2020 2764 6174              'dat
+0001ba80: 6574 696d 6527 3a20 7b0a 2020 2020 2020  etime': {.      
+0001ba90: 2020 2020 2020 2020 2020 2763 7265 6174            'creat
+0001baa0: 696f 6e46 6374 273a 2027 6372 6561 7465  ionFct': 'create
+0001bab0: 5f73 7461 7274 5f74 696d 655f 6669 6c65  _start_time_file
+0001bac0: 2829 272c 0a20 2020 2020 2020 2020 2020  ()',.           
+0001bad0: 2020 2020 2027 7375 6666 6978 273a 2027       'suffix': '
+0001bae0: 5f69 6d61 6765 2d73 7461 7274 2d74 696d  _image-start-tim
+0001baf0: 6573 2e74 7874 272c 0a20 2020 2020 2020  es.txt',.       
+0001bb00: 2020 2020 2020 2020 2027 636f 6c73 273a           'cols':
+0001bb10: 205b 6d69 7174 762e 636f 6c5f 6865 6164   [miqtv.col_head
+0001bb20: 6572 5b27 6d61 7269 7174 275d 5b27 7574  er['mariqt']['ut
+0001bb30: 6327 5d5d 2c0a 2020 2020 2020 2020 2020  c']],.          
+0001bb40: 2020 2020 2020 276f 7074 696f 6e61 6c27        'optional'
+0001bb50: 3a20 5b5d 7d2c 0a20 2020 2020 2020 2020  : []},.         
+0001bb60: 2020 2027 6e61 7669 6761 7469 6f6e 273a     'navigation':
+0001bb70: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+0001bb80: 2020 2027 6372 6561 7469 6f6e 4663 7427     'creationFct'
+0001bb90: 3a20 2763 7265 6174 655f 696d 6167 655f  : 'create_image_
+0001bba0: 6e61 7669 6761 7469 6f6e 5f66 696c 6528  navigation_file(
+0001bbb0: 2927 2c0a 2020 2020 2020 2020 2020 2020  )',.            
+0001bbc0: 2020 2020 2773 7566 6669 7827 3a20 275f      'suffix': '_
+0001bbd0: 696d 6167 652d 6e61 7669 6761 7469 6f6e  image-navigation
+0001bbe0: 2e74 7874 272c 0a20 2020 2020 2020 2020  .txt',.         
+0001bbf0: 2020 2020 2020 2027 636f 6c73 273a 205b         'cols': [
+0001bc00: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+0001bc10: 5b27 6d61 7269 7174 275d 5b27 7574 6327  ['mariqt']['utc'
+0001bc20: 5d5d 2c0a 2020 2020 2020 2020 2020 2020  ]],.            
+0001bc30: 2020 2020 276f 7074 696f 6e61 6c27 3a20      'optional': 
+0001bc40: 5b6d 6971 7476 2e63 6f6c 5f68 6561 6465  [miqtv.col_heade
+0001bc50: 725b 276d 6172 6971 7427 5d5b 276c 6f6e  r['mariqt']['lon
+0001bc60: 275d 2c20 6d69 7174 762e 636f 6c5f 6865  '], miqtv.col_he
+0001bc70: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+0001bc80: 6c61 7427 5d2c 206d 6971 7476 2e63 6f6c  lat'], miqtv.col
+0001bc90: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+0001bca0: 5d5b 2761 6c74 275d 2c20 6d69 7174 762e  ]['alt'], miqtv.
+0001bcb0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+0001bcc0: 7174 275d 5b27 6867 7427 5d2c 206d 6971  qt']['hgt'], miq
+0001bcd0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+0001bce0: 6172 6971 7427 5d5b 2775 6e63 6572 7427  ariqt']['uncert'
+0001bcf0: 5d5d 7d2c 0a20 2020 2020 2020 207d 0a0a  ]]},.        }..
+0001bd00: 2020 2020 2020 2020 7365 6c66 2e6e 6f6e          self.non
+0001bd10: 436f 7265 4669 656c 6449 6e74 6572 6d65  CoreFieldInterme
+0001bd20: 6469 6174 6549 7465 6d49 6e66 6f46 696c  diateItemInfoFil
+0001bd30: 6573 203d 205b 5d0a 0a20 2020 2064 6566  es = []..    def
+0001bd40: 205f 5f67 6574 5f69 6e74 5f66 696c 655f   __get_int_file_
+0001bd50: 7072 6566 6978 2873 656c 6629 3a0a 2020  prefix(self):.  
+0001bd60: 2020 2020 2020 2222 2220 6465 7065 6e64        """ depend
+0001bd70: 7320 6f6e 2027 696d 6167 652d 6576 656e  s on 'image-even
+0001bd80: 7427 2061 6e64 2027 696d 6167 652d 7365  t' and 'image-se
+0001bd90: 6e73 6f72 2720 736f 2069 7420 6361 6e20  nsor' so it can 
+0001bda0: 6368 616e 6765 2064 7572 696e 6720 7570  change during up
+0001bdb0: 6174 6520 2222 220a 2020 2020 2020 2020  ate """.        
+0001bdc0: 7265 7475 726e 206f 732e 7061 7468 2e6a  return os.path.j
+0001bdd0: 6f69 6e28 7365 6c66 2e64 6972 2e74 6f28  oin(self.dir.to(
+0001bde0: 7365 6c66 2e64 6972 2e64 742e 696e 7465  self.dir.dt.inte
+0001bdf0: 726d 6564 6961 7465 292c 2073 656c 662e  rmediate), self.
+0001be00: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
+0001be10: 6167 652d 7365 742d 6e61 6d65 2729 290a  age-set-name')).
+0001be20: 0a20 2020 2064 6566 2067 6574 5f69 6e74  .    def get_int
+0001be30: 5f68 6173 685f 6669 6c65 2873 656c 6629  _hash_file(self)
+0001be40: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0001be50: 2073 656c 662e 5f5f 6765 745f 696e 745f   self.__get_int_
+0001be60: 6669 6c65 5f70 7265 6669 7828 2920 2b20  file_prefix() + 
+0001be70: 7365 6c66 2e69 6e74 6572 6d65 6469 6174  self.intermediat
+0001be80: 6546 696c 6573 4465 665f 636f 7265 5b27  eFilesDef_core['
+0001be90: 6861 7368 6573 275d 5b27 7375 6666 6978  hashes']['suffix
+0001bea0: 275d 0a0a 2020 2020 6465 6620 6765 745f  ']..    def get_
+0001beb0: 696e 745f 7575 6964 5f66 696c 6528 7365  int_uuid_file(se
+0001bec0: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+0001bed0: 7572 6e20 7365 6c66 2e5f 5f67 6574 5f69  urn self.__get_i
+0001bee0: 6e74 5f66 696c 655f 7072 6566 6978 2829  nt_file_prefix()
+0001bef0: 202b 2073 656c 662e 696e 7465 726d 6564   + self.intermed
+0001bf00: 6961 7465 4669 6c65 7344 6566 5f63 6f72  iateFilesDef_cor
+0001bf10: 655b 2775 7569 6473 275d 5b27 7375 6666  e['uuids']['suff
+0001bf20: 6978 275d 0a0a 2020 2020 6465 6620 6765  ix']..    def ge
+0001bf30: 745f 696e 745f 7374 6172 7454 696d 6573  t_int_startTimes
+0001bf40: 5f66 696c 6528 7365 6c66 293a 0a20 2020  _file(self):.   
+0001bf50: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001bf60: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
+0001bf70: 7072 6566 6978 2829 202b 2073 656c 662e  prefix() + self.
+0001bf80: 696e 7465 726d 6564 6961 7465 4669 6c65  intermediateFile
+0001bf90: 7344 6566 5f63 6f72 655b 2764 6174 6574  sDef_core['datet
+0001bfa0: 696d 6527 5d5b 2773 7566 6669 7827 5d0a  ime']['suffix'].
+0001bfb0: 0a20 2020 2064 6566 2067 6574 5f69 6e74  .    def get_int
+0001bfc0: 5f6e 6176 5f66 696c 6528 7365 6c66 293a  _nav_file(self):
+0001bfd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001bfe0: 7365 6c66 2e5f 5f67 6574 5f69 6e74 5f66  self.__get_int_f
+0001bff0: 696c 655f 7072 6566 6978 2829 202b 2073  ile_prefix() + s
+0001c000: 656c 662e 696e 7465 726d 6564 6961 7465  elf.intermediate
+0001c010: 4669 6c65 7344 6566 5f63 6f72 655b 276e  FilesDef_core['n
+0001c020: 6176 6967 6174 696f 6e27 5d5b 2773 7566  avigation']['suf
+0001c030: 6669 7827 5d0a 0a                        fix']..
```

## Comparing `mariqt-0.5.2.dist-info/LICENSE` & `mariqt-0.5.3.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `mariqt-0.5.2.dist-info/METADATA` & `mariqt-0.5.3.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mariqt
-Version: 0.5.2
+Version: 0.5.3
 Summary: The MareHub & Marine Imaging Community Image QA/QC and curation toolbox
 Author: Timm Schoening
 Author-email: tschoening@geomar.de
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: GNU General Public License v3 (GPLv3)
 Classifier: Operating System :: OS Independent
 License-File: LICENSE
```

## Comparing `mariqt-0.5.2.dist-info/RECORD` & `mariqt-0.5.3.dist-info/RECORD`

 * *Files 19% similar despite different names*

```diff
@@ -8,24 +8,24 @@
 mariqt/misc.py,sha256=BF_ItP_gnkS1Z6zb9P7O4cRi3XMgJR-Bm2OmzX7AK9M,3090
 mariqt/navigation.py,sha256=kYKHzibCKJNtXlDaIqzqZ7rmvjzFvpCUnFfz6yR7QJI,40059
 mariqt/provenance.py,sha256=daR6sIK6tSFaBsanKvIuFyjR78NNOTzd4N3AdQRxdFw,7345
 mariqt/reports.py,sha256=YP03HvFe0BG0y4efvQhRpeGifijqqPpCB_gg4qX-MVw,22316
 mariqt/settings.py,sha256=bqjUJnTiKwFsbGP4cRQiwHQhsTi4191pb36R8GSKp58,4376
 mariqt/tests.py,sha256=BWJy4ejhsSINzhR_88HGfYeXVnPKbdMwDE-u2qLl6C0,8323
 mariqt/variables.py,sha256=TtGb3UVwJnE5tmDEOxuZlCFofebgEWiKr7Soh_DFk5g,9613
-mariqt/version.py,sha256=LADBavpB8x-lrtqob-7SCQZXFPfLZCu34A0lBsgTGGI,21
+mariqt/version.py,sha256=IIIADjPr2y0W_XfgU1cH-K2HswMouXAPagGe6_twaIk,21
 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json,sha256=HyHwLO2Wc6KWE3YBctExeEHtDNz4HQldPkczvTdpFp0,6175
 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json,sha256=qKNwXPjk7NSpYI3PYGEItxsoyPUDTzJUNaJlqloWIHA,42461
 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json,sha256=krwoig3eWpFjG61HIsdX7N-7QXFJ3v9mRZ63vham7rM,3218
 mariqt/sources/dship.py,sha256=5PxhsraSImnSchTG0h0HlLHorJQZPSDSOzspRGhD6bg,12135
 mariqt/sources/dship_settings.py,sha256=VoLc-YMD4Elwz0YpCFMy8mz0QQnKI0AJHPUHzQX9kJg,4586
 mariqt/sources/elements.py,sha256=5Cgchy_MJq4CiLVi2xqpxlOGqL5-PKl426XnzoCIEVI,2177
-mariqt/sources/ifdo.py,sha256=uhgMAk60q_yLj2n2_2Vj-v3VcL8RpztXpnZw4J9TVtM,113679
+mariqt/sources/ifdo.py,sha256=bgGwNA4U6za-YsqqA_02HqQV0e8MOOmYz12Lfs4eqgI,114743
 mariqt/sources/ofop.py,sha256=mSMZLvWszr_Yfd7rDf_4V4jIz3DMQh7Qe7eHLUnMOK8,5533
 mariqt/sources/svgs.py,sha256=T089b6F0wYLbUZQ8XhvCqqNmZqrvyTpx3kqRojlg_pM,650149
 mariqt/sources/underway.py,sha256=mIweaYmKbxPvmZHSFd3k5JY4mnFZ-7X3u_MdCPNjQL0,3728
-mariqt-0.5.2.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
-mariqt-0.5.2.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
-mariqt-0.5.2.dist-info/METADATA,sha256=B1NM209V0Tm5Bp6X3O7wqwA6M3WSFd-O1Pila48P18Y,1133
-mariqt-0.5.2.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
-mariqt-0.5.2.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
-mariqt-0.5.2.dist-info/RECORD,,
+mariqt-0.5.3.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
+mariqt-0.5.3.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
+mariqt-0.5.3.dist-info/METADATA,sha256=GNKHnIp9ZK2_Hjrlgq3A_Hidm4zfjwpK_mwm0EIaX_c,1133
+mariqt-0.5.3.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
+mariqt-0.5.3.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
+mariqt-0.5.3.dist-info/RECORD,,
```

